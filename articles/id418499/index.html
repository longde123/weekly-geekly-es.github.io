<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞🏾 🎅🏼 👼🏽 SAMBA meningkatkan pengalaman klasik di Debian 8 ✳️ 👨🏽‍🎨 👐🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Latar belakang 
 Ada jaringan lokal kecil dari perusahaan, di mana sekitar 10 tahun yang lalu domain pada Samba ke-3 + LDAP + BIND (di gateway) dibesa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SAMBA meningkatkan pengalaman klasik di Debian 8</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418499/"><h2>  Latar belakang </h2><br>  Ada jaringan lokal kecil dari perusahaan, di mana sekitar 10 tahun yang lalu domain pada Samba ke-3 + LDAP + BIND (di gateway) dibesarkan di Debian 5.  Bahkan, dia hanya membutuhkan otentikasi pengguna, dan file bola.  Selama bertahun-tahun, server telah ditingkatkan ke versi baru Debian tanpa masalah.  Saat ini, ia memiliki Debian 8 dan Samba 4.2 dari paket. <br><br>  Sejak Windows 7, pengenalan komputer ke domain, tanpa kruk terkenal dengan mengedit registri, tidak berfungsi.  Kruk yang sama bekerja di Win 8 dan Win 10 hingga versi 1803. Selain ketidakmampuan untuk memasukkan komputer ke domain, masalah lain terakumulasi, dan sebagai hasilnya, diputuskan untuk melakukan peningkatan klasik.  Karena kesederhanaan struktur LAN, diputuskan untuk menggunakan DNS Samba internal. <br><br>  Saya ingin segera mengatakan bahwa artikel itu bukan panduan yang tepat, tetapi pengalaman menjalankan operasi ini.  Fase pra-pengujian sangat dianjurkan.  Dalam kasus saya, gambar server diambil untuk pengujian dan digunakan pada mesin virtual VirtualBox. Juga, untuk menguji perilaku klien domain yang ada, Win XP SP3 dan Win 10 1709 dan 1803 mesin klien dibuat. <br><br>  Saya juga ingin mencatat bahwa kesalahan berulang kali disebabkan oleh kesalahan ketik biasa.  Berhati-hatilah. <br><a name="habracut"></a><br><h2>  Deskripsi lingkungan </h2><br>  OS: Debian 8 <br>  Domain: samdom.local <br>  Nama Server: pdc <br>  server ip: 10.10.1.220 <br><cut></cut><br><h2>  Proses transisi </h2><br><h4>  Memperbarui paket ke versi terbaru + menginstal yang hilang. </h4><br>  Dalam kasus saya, setelah pembaruan, hanya pengguna KRB5 yang harus dikirim. <br><br><pre><code class="hljs sql">apt-get <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> samba smbclient krb5-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> winbind</code> </pre> <br>  Saat memasang pengguna krb5, sistem akan menanyakan beberapa pertanyaan tentang nama server dan nama domain.  Kami mengisi data server kami. <br><cut></cut><br><h4>  Samba berhenti </h4><br><pre> <code class="hljs sql">service samba-ad-dc <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> service smbd <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> service nmbd <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> service winbind <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span></code> </pre> <br><h4>  Transfer basis lama dan konfigurasi samba </h4><br><pre> <code class="hljs swift">mv /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba.<span class="hljs-type"><span class="hljs-type">NT</span></span> mv /etc/samba/smb.conf /etc/samba/smb.conf.<span class="hljs-type"><span class="hljs-type">NT</span></span></code> </pre> <br>  Saya memindahkan database lama ke /var/lib/samba.NT sehingga Anda perlu membuat kembali direktori / var / lib / samba <br><br><pre> <code class="hljs swift">mkdir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba</code> </pre> <br>  Dokumentasi merekomendasikan memindahkan semua database ke folder terpisah.  Dalam kasus saya, hanya gencache_notrans.tdb terletak secara terpisah, jadi saya harus mentransfernya saja. <br><br><pre> <code class="hljs swift">cp -p /run/samba/gencache_notrans.tdb /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba.<span class="hljs-type"><span class="hljs-type">NT</span></span></code> </pre> <br>  Dokumentasi juga mengatakan bahwa hanya enam database yang dibutuhkan: <br><br><blockquote>  secrets.tdb <br>  schannel_store.tdb <br>  passdb.tdb <br>  gencache_notrans.tdb <br>  group_mapping.tdb <br>  account_policy.tdb </blockquote><br>  Namun, keberadaan file lain di folder itu tidak menghalangi proses transisi. <br><cut></cut><br><h4>  Mulai proses peningkatan klasik </h4><br><pre> <code class="hljs powershell">samba<span class="hljs-literal"><span class="hljs-literal">-tool</span></span> domain classicupgrade —dbdir=/var/lib/samba.NT -<span class="hljs-literal"><span class="hljs-literal">-realm</span></span>=samdom.local -<span class="hljs-literal"><span class="hljs-literal">-dns</span></span><span class="hljs-literal"><span class="hljs-literal">-backend</span></span>=SAMBA_INTERNAL /etc/samba/smb.conf.NT</code> </pre> <br>  Saya perhatikan bahwa dokumentasi tidak merekomendasikan penggunaan domain tingkat atas lokal., Tetapi dalam kasus saya ini terjadi secara historis. <br><br>  Pada lembar yang muncul di layar, kata sandi administrator akan berkedip, yang dapat Anda tuliskan jika diinginkan). <br><br>  Jika Anda memiliki masalah, sebelum upaya baru untuk meningkatkan klasik, Anda harus ingat untuk menghapus file database dan smb.conf yang dibuat dalam proses. <br><br><pre> <code class="hljs powershell">rm <span class="hljs-operator"><span class="hljs-operator">-f</span></span> /etc/samba/smb.conf rm <span class="hljs-literal"><span class="hljs-literal">-rf</span></span> /var/lib/samba/*</code> </pre> <br>  Jika semuanya berjalan dengan baik, Anda bisa pergi ke langkah berikutnya. <br><br><h4>  Memeriksa dan mengedit konfigurasi server </h4><br>  Di /etc/resolv.conf seharusnya (jika tidak secara otomatis dibuat untuk Anda) <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samdom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameserver</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.220</span></span></code> </pre> <br>  Di / etc / hosts <br><br><pre> <code class="hljs css">127<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.localdomain</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.220</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pdc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.samdom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pdc</span></span></code> </pre> <br>  File / etc / hostname harus memiliki nama host yang disingkat <br><br><pre> <code class="hljs">pdc</code> </pre> <br>  Di / etc / network / interfaces <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dns-nameservers</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.220</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dns-search</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samdom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span></code> </pre> <br><h4>  Mengarahkan permintaan dns </h4><br>  Jika server Anda akan mengarahkan permintaan DNS ke Internet (dan INTERNAL_DNS Samba digunakan), Anda perlu menambahkan baris dari ip ISP Anda di bagian [global] di smb.conf: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dns</span></span> forwarder = ip</code> </pre> <br>  Dalam "Samba" 4.2, Anda hanya dapat menentukan satu ip.  Berikut ini - beberapa, dengan spasi. <br>  Jika lalu lintas keluar dikendalikan di gateway Anda, maka jangan lupa untuk membuka paket udp dari server ke port 53. <br><br><h4>  Konfigurasikan Kerberos </h4><br>  Kami membawa /etc/krb5.conf ke formulir yang serupa: <br><br><pre> <code class="hljs pgsql">[libdefaults] default_realm = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> dns_lookup_realm = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> dns_lookup_kdc = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> krb4_config = /etc/krb.conf krb4_realms = /etc/krb.realms kdc_timesync = <span class="hljs-number"><span class="hljs-number">1</span></span> ccache_type = <span class="hljs-number"><span class="hljs-number">4</span></span> forwardable = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> proxiable = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> v4_instance_resolve = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> v4_name_convert = { host = { rcmd = host ftp = ftp } plain = { something = something-<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> } } fcc-mit-ticketflags = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> [realms] SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> = { kdc = pdc admin_server = pdc default_domain = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> } [domain_realm] .samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span></code> </pre> <br><h4>  Sinkronisasi waktu </h4><br>  Jika paket ntp tidak layak, maka atur: <br><br><pre> <code class="hljs swift">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install ntp</code> </pre> <br>  Dalam kasus saya tidak ada direktori / var / lib / samba / ntp_signd /.  Dibuat secara manual. <br><br>  Selanjutnya, Anda perlu memberinya hak: <br><br><pre> <code class="hljs swift">chown root:ntp /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba/ntp_signd/ chmod <span class="hljs-number"><span class="hljs-number">750</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba/ntp_signd/</code> </pre> <br>  Selanjutnya, Anda perlu membawa file /etc/ntp.conf ke bentuk yang serupa: <br><br><pre> <code class="hljs pgsql"># <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span> clock (Note: This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> the localhost address!) <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">127.127</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> fudge <span class="hljs-number"><span class="hljs-number">127.127</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> stratum <span class="hljs-number"><span class="hljs-number">10</span></span> # The source, <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> we are receiving the <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>pool.ntp.org iburst prefer driftfile /var/lib/ntp/ntp.drift logfile /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/ntp ntpsigndsocket /var/lib/samba/ntp_signd/ # <span class="hljs-keyword"><span class="hljs-keyword">Access</span></span> control # <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> restriction: <span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> allow querying <span class="hljs-type"><span class="hljs-type">time</span></span> (incl. ms-sntp) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> this machine <span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> kod nomodify notrap nopeer mssntp # Allow everything <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> localhost <span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> # Allow that our <span class="hljs-type"><span class="hljs-type">time</span></span> source can <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> provide <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>pool.ntp.org mask <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> nomodify notrap nopeer noquery</code> </pre> <br><h4>  Menghapus slapd dan me-reboot </h4><br><pre> <code class="hljs cs">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">remove</span></span> slapd reboot</code> </pre> <br><h4>  Pengujian </h4><br>  Dalam dokumentasi, pengujian dilakukan dari akun Administrator.  Kami secara historis mengembangkan bahwa tindakan administratif berasal dari domain_admin.  Selanjutnya, perintah dan output yang benar akan ditampilkan. <br><br>  <b>Pengujian samba:</b> <br><br><pre> <code class="hljs pgsql">root@debian:/root# smbclient -L localhost -U% <span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>=[SAMDOM] OS=[Unix] <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>=[Samba <span class="hljs-number"><span class="hljs-number">4.1</span></span><span class="hljs-number"><span class="hljs-number">.17</span></span>-Debian] Sharename <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> <span class="hljs-comment"><span class="hljs-comment">--------- ---- ------- netlogon Disk sysvol Disk IPC$ IPC IPC Service (Samba 4.1.17-Debian) Domain=[SAMDOM] OS=[Unix] Server=[Samba 4.1.17-Debian] Server Comment --------- ------- Workgroup Master --------- -------</span></span></code> </pre> <br>  Jika Anda mendapatkan kesalahan di sini: <br><blockquote>  Koneksi ke loclhost gagal (Galat NT_STATUS_UNSUCCESSFUL) </blockquote><br>  periksa apakah samba mulai.  Dalam satu tes, saya lupa menghapus (mematikan) slapd dan juga melihat kesalahan ini. <br><br>  Sekali lagi periksa: <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> smbclient //localhost/netlogon <span class="hljs-literal"><span class="hljs-literal">-Udomain_admin</span></span> <span class="hljs-literal"><span class="hljs-literal">-c</span></span> <span class="hljs-string"><span class="hljs-string">'ls'</span></span> Enter Administrator<span class="hljs-string"><span class="hljs-string">'s password: Domain=[SAMDOM] OS=[Unix] Server=[Samba xyz] . D 0 Tue Nov 1 08:40:00 2016 .. D 0 Tue Nov 1 08:40:00 2016 49386 blocks of size 524288. 42093 blocks available</span></span></code> </pre> <br>  <b>Menguji DNS</b> <br><br><pre> <code class="hljs pgsql">root@debian:/root# nslookup samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>: <span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span> Address: <span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span>#<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-type"><span class="hljs-type">Name</span></span>: samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> Address: <span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span></code> </pre> <br><pre> <code class="hljs pgsql">$ host -t SRV _ldap._tcp.samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>. _ldap._tcp.samdom.example.com has SRV <span class="hljs-type"><span class="hljs-type">record</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">389</span></span> pdc.samdom.example.com.</code> </pre> <br><pre> <code class="hljs pgsql">$ host -t SRV _kerberos._udp.samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>. _kerberos._udp.samdom.example.com has SRV <span class="hljs-type"><span class="hljs-type">record</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">88</span></span> pdc.samdom.example.com.</code> </pre> <br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> host <span class="hljs-literal"><span class="hljs-literal">-t</span></span> A pdc.samdom.local. dc1.samdom.example.com has address <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">1.220</span></span></code> </pre> <br>  <b>Menguji Kerberos</b> <br><br><pre> <code class="hljs pgsql">root@debian:/root# kinit domain_admin@SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain_admin@SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Warning</span></span>: Your <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> will expire <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> days <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>  <span class="hljs-number"><span class="hljs-number">27</span></span>  <span class="hljs-number"><span class="hljs-number">2015</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span></code> </pre><br><pre> <code class="hljs ruby">root@debian<span class="hljs-symbol"><span class="hljs-symbol">:/root</span></span><span class="hljs-comment"><span class="hljs-comment"># klist Ticket cache: FILE:/tmp/krb5cc_0 Default principal: domain_admin</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SAMDOM</span></span></span><span class="hljs-comment">.LOCAL Valid starting Expires Service principal 16.10.2015 15:07:12 17.10.2015 01:07:12 krbtgt/SAMDOM.LOCAL</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SAMDOM</span></span></span><span class="hljs-comment">.LOCAL renew until 17.10.2015 15:07:07</span></span></code> </pre> <br><h2>  Pengaturan tambahan </h2><br>  <b>Agar nama dan grup domain muncul di linux, Anda harus memperbaiki /etc/nsswitch.conf alih-alih angka</b> <br><br>  String harus direduksi menjadi bentuk berikut: <br><blockquote>  passwd: file <u>winbind</u> <br>  grup: file <u>winbind</u> </blockquote><br>  Harap dicatat bahwa winbind hanya ditambahkan ke baris ini.  Untuk detailnya, lihat dokumentasi. <br>  Dalam kasus saya, saya juga menghapus penyebutan ldap dari file ini. <br><br><pre> <code class="hljs">reboot</code> </pre> <br>  <b>Jika Anda, seperti saya, sebelum upgrade klasik dns, server berada di komputer lain dan Anda menggunakan server DHCP, jangan lupa untuk mengubah pengaturan server DHCP yang menunjuk ke server DNS</b> <br><br><h4>  Konfigurasikan folder jaringan </h4><br>  Pengembang tidak disarankan untuk menggunakan pengontrol domain AD sebagai server file.  Namun, dalam kasus saya tidak ada server lain. <br><br>  Pengaturan ini dijelaskan dengan sangat baik dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> untuk "Samba" dan Anda perlu melihatnya di sana.  Singkatnya, lalu: <br><br>  <b>Penting untuk memeriksa samba dukungan ACL.</b> <br><br><pre> <code class="hljs perl">smbd -b | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> HAVE_LIBACL HAVE_LIBACL</code> </pre> <br>  <b>Jangan lupa bahwa bagian tersebut harus dipasang dengan opsi user_xattr dan acl.</b> <br><br>  <b>Hanya pengguna dan grup dengan SeDiskOperatorPrivilege yang dapat mengonfigurasi hak bola:</b> <br><br>  Misalnya, untuk memberikan hak tersebut ke grup Admin Domain, Anda harus menjalankan perintah: <br><pre> <code class="hljs pgsql">net rpc rights <span class="hljs-keyword"><span class="hljs-keyword">grant</span></span> "Samdom\Domain Admins" SeDiskOperatorPrivilege -U "Samdom\domain_admin"</code> </pre> <br>  <b>Langsung untuk menambahkan bola yang Anda butuhkan:</b> <br><br>  Buat direktori dan berikan hak yang diperlukan: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># mkdir -p /srv/samba/Demo/ # chown root:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Domain Admins"</span></span></span><span class="hljs-meta"> /srv/samba/Demo/ # chmod 0770 /srv/samba/Demo/</span></span></code> </pre> <br>  tambahkan ke smb.conf <br><br><pre> <code class="hljs pgsql">[Demo] <span class="hljs-type"><span class="hljs-type">path</span></span> = /srv/samba/Demo/ <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span></code> </pre> <br>  Setelah itu, muat ulang konfigurasi samba dengan perintah: <br><br><pre> <code class="hljs pgsql">smbcontrol <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> reload-config</code> </pre> <br>  Seperti sebelumnya, bola bisa disembunyikan dengan menambahkan deskripsi: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">browseable</span></span> = <span class="hljs-literal"><span class="hljs-literal">no</span></span></code> </pre> <br>  Selanjutnya, hak didistribusikan dari windows mesin, dari akun dengan <u>SeDiskOperatorPrivilege</u> .  Untuk melakukan ini, buka "manajemen komputer". <br>  Berpegang teguh pada komputer jarak jauh (kontroler domain pdc dalam kasus kami).  Bagikan hak melalui: "Folder bersama" -&gt; "Sumber daya bersama". <br><br>  Ada kemungkinan bahwa ketika Anda pergi ke item "Folder Bersama", Anda akan mendapatkan kesalahan "Nomor prosedur di luar batas yang diizinkan (1745)."  Saya mengabaikannya, karena saya tidak menemukan sesuatu yang dapat dimengerti di Internet dan itu tidak menyebabkan masalah selama pengujian dan operasi. <br><br>  Masalah dapat terjadi jika Anda berbagi folder jaringan lama dengan cara ini.  Sebelum peningkatan klasik, hak atas bola ditetapkan melalui smb.conf, pengguna linux, grup, lainnya, dan setfacl.  Setelah peningkatan klasik, sekolah dengan hak untuk berubah, mengganti nama, dll mulai muncul secara bertahap.  Setfacl rekursif tidak membantu, karena tiang tembok dengan pewarisan hak muncul. <br><br>  Perlu dicatat bahwa dalam dokumentasi, direkomendasikan untuk mendistribusikan hak dari jendela mesin, melalui akses jarak jauh. <br><br>  Akibatnya, karena volume file yang tidak terlalu besar, keputusan dibuat untuk mentransfer data ke mesin windows selama jam-jam tidak bekerja, membuat ulang folder jaringan sesuai dengan rekomendasi pengembang samba dan mengunggah kembali file. <br><br><h4>  Folder beranda pengguna di server </h4><br>  Manajemen folder rumah pengguna juga telah berubah. <br>  Perlu dicatat bahwa proses dari konfigurasi juga dijelaskan dengan sangat baik dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> . <br>  Saya hanya akan menjelaskan fitur utama untuk kasus saya. <br><br>  Sebelumnya, setiap pengguna mendapatkan bola mereka sendiri.  Sekarang hanya folder bersama yang dibagikan, dan pengguna hanya memiliki akses ke direktori mereka. <br><br>  Penyetelan dilakukan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Microsoft Remote Server Administration Tools (RSAT)</a> .  RSAT memiliki fitur yang tidak menyenangkan.  Ketika memutakhirkan Win 10 ke versi baru, itu harus diinstal ulang. <br><br>  Bola rumah bisa diambil secara manual, melalui properti pengguna di snap-in Users and Computers.  Tab profil.  Disk U: \\ pdc \ user-share \ username <br><br>  Namun, lebih mudah untuk melakukan ini melalui kebijakan domain, yang sangat jelas dijelaskan dalam dokumentasi di atas dalam paragraf <b>"Menggunakan Preferensi Kebijakan Grup"</b> . <br><br>  Jangan lupa bahwa bola biasa dapat disembunyikan dengan menambahkan deskripsi: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">browseable</span></span> = <span class="hljs-literal"><span class="hljs-literal">no</span></span></code> </pre> <br><h4>  Level Domain Naik </h4><br>  Domain ditingkatkan tanpa masalah ke level 2008_R2 dengan perintah: <br><br><pre> <code class="hljs pgsql">samba-tool <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> <span class="hljs-comment"><span class="hljs-comment">--domain=2008_R2 --forest=2008_R2</span></span></code> </pre> <br>  Anda dapat melihat level dengan perintah: <br><br><pre> <code class="hljs pgsql">samba-tool <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-keyword"><span class="hljs-keyword">show</span></span></code> </pre> <br><h4>  Jika smbd.log dibombardir dengan kesalahan CUPS </h4><br>  Dalam kasus saya, masalah ini muncul: <br><br><blockquote>  Tidak dapat terhubung ke server CUPS localhost: 631 </blockquote><br>  Diperbaiki oleh artikel singkat ini. <br><br><h2>  Peningkatan berikutnya ke masalah dan solusi Debian 9 </h2><br>  Di <br><br><pre> <code class="hljs powershell">apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> dist<span class="hljs-literal"><span class="hljs-literal">-upgrade</span></span></code> </pre> <br>  Ada masalah, yaitu, samba dan winbind tidak ingin diperbarui.  Pergi ke konflik ketergantungan. <br><br>  Metode dari artikel membantu tautan yang sayangnya tidak saya simpan. <br>  Berikut adalah kutipan langsung darinya: <br><br><blockquote>  jika Samba dalam mode AD-DC, itu dan winbind gagal. <br>  lakukan perintah ini, lalu coba jalankan pemutakhiran lagi <br><br>  systemctl menghentikan smbd nmbd winbind <br>  systemctl menonaktifkan smbd nmbd winbind <br>  systemctl membuka kedai samba-ad-dc <br>  systemctl mulai samba-ad-dc <br>  systemctl mengaktifkan samba-ad-dc <br></blockquote><br><br><h4>  Setelah memperbarui versi SAMBA, disarankan agar: "Pemeriksaan database Samba AD DC". </h4><br><br> <code># samba-tool dbcheck --cross-ncs</code> <br> <br>  Sejak di Deb 9 SAMBA versi 4.5 saya mendapat banyak kesalahan "replPropertyMetaData". <br>  Proses pemecahan masalah dijelaskan dalam dokumentasi: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wiki.samba.org/index.php/Updating_Samba#Fixing_replPropertyMetaData_Attributes</a> <br><br>  Dan sampai pada pelaksanaan perintah: <br><br> <code>samba-tool dbcheck --cross-ncs --fix --yes</code> <br> <br><h2>  Daftar sumber yang digunakan </h2><br>  Dokumentasi SAMBA: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Memigrasikan Domain Samba NT4 ke Samba AD (Peningkatan Klasik)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menyiapkan Samba sebagai Pengontrol Domain Direktori Aktif</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menyiapkan Share Menggunakan Windows ACL</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Folder Beranda Pengguna</a> <br>  Artikel bagus: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengontrol domain Debian 8 (... yang sudah memiliki Samba4 bawaan)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kesalahan Samba: Tidak dapat terhubung ke server CUPS localhost: 631</a> <br>  Artikel oleh penulis bahasa Inggris yang tidak dikenal yang menjelaskan cara meningkatkan ke Debian 9 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id418499/">https://habr.com/ru/post/id418499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id418487/index.html">Tentang pekerjaan di Jerman</a></li>
<li><a href="../id418489/index.html">Karya konstruksi kolom dunia: evolusi standar tiga arah, sekte studio JBL</a></li>
<li><a href="../id418491/index.html">Uji ketahanan otomasi</a></li>
<li><a href="../id418493/index.html">Bluetooth Kisah orang pertama</a></li>
<li><a href="../id418497/index.html">"Aku tidak mengenali kamu dalam makeup" (c)</a></li>
<li><a href="../id418501/index.html">Korban GDPR: yang sudah berhenti bekerja karena peraturan baru tentang data pribadi</a></li>
<li><a href="../id418503/index.html">Setelah 2020, Inggris akan memperoleh pelabuhan antariksa pertama - di Skotlandia</a></li>
<li><a href="../id418505/index.html">Tinjauan Umum dan Perbandingan Platform Perangkat Lunak Quantum Gerbang-Level</a></li>
<li><a href="../id418507/index.html">Apa yang diberikan kosmonautika kepada kita?</a></li>
<li><a href="../id418509/index.html">Rekognisi Amazon mengakui 28 anggota kongres AS sebagai penjahat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>