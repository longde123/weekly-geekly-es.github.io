<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öõÔ∏è üë©‚Äçüíº üë©‚Äçüé§ Mad Converter GIF'ok a stickers animados para Telegram üâê üî∂ ü§≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En lugar de mil palabras ... 


 ¬°xZibit tambi√©n est√° contento, porque aqu√≠ los GIF se insertan en adhesivos para insertarse en GIF para KDPV! 

 Y ah...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mad Converter GIF'ok a stickers animados para Telegram</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460411/">  <i>En lugar de mil palabras ...</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z_/rg/73/z_rg73ltg3tgl4zh602urowmjps.gif"></div><br>  <i>¬°xZibit tambi√©n est√° contento, porque aqu√≠ los GIF se insertan en adhesivos para insertarse en GIF para KDPV!</i> <br><br>  Y ahora sobre los detalles de implementaci√≥n. <br><a name="habracut"></a><br>  Todo comenz√≥ con una discusi√≥n en el chat del desarrollador de Telegram sobre la pr√≥xima funci√≥n: <br><br><img src="https://habrastorage.org/webt/zu/s5/x1/zus5x1ydd89sejezp98ztbnygto.png" alt="Bohdan Horbeshko, [04/04/19 20:21] Hmm, pero el bot probablemente solo aceptar√° gifs y luego convertir√° ... | Vitaly, [07/04/19 20:22] del gif a Jason? Hubiera buscado :))) | Bohdan Horbeshko, [04.07.19 20:22] ¬øY por qu√© no? Hay un editor de modelos de PlayCanvas en JSON. El | Vitaly, [04/04/19 8:23 p.m.] y c√≥mo el gif? exportar p√≠xel por p√≠xel? :) | Bohdan Horbeshko, [04/04/19 20:24] Por supuesto, el mundo de TI ha visto y no tolerar√° tales distorsiones."><br><br>  Un hombre dijo, ¬°un hombre lo hizo!  El primer prototipo en Pillow y svgwrite, que analiza los GIF en p√≠xeles y los convierte en cuadrados vectoriales con vistas previas en SVG, se escribi√≥ en un d√≠a libre. <br><br>  La diversi√≥n comenz√≥ m√°s ... <br><br><h3>  JSON es un formato abierto, dijeron ... </h3><br>  Hasta ahora, con los formatos en Telegram, segu√≠an enga√±ando.  Soporte para animaciones GIF; de hecho, se convierten a video MP4.  Soporte para adhesivos: se cargan a PNG, pero se convierten a WebP.  Esta vez todo es m√°s honesto: que en la entrada, luego en la salida. <br><br>  Para las pegatinas animadas, Telegram no utiliza GIF, videos o incluso alg√∫n formato de gr√°ficos vectoriales bien establecido como SVG o, ¬°Dios no lo quiera, Cthulhu!  - Flash.  Utiliza un formato novedoso que surgi√≥ bajo el ala de Airbnb: Lottie.  Hasta ahora, ten√≠a cierta fama entre los desarrolladores m√≥viles, pero gracias a Telegram, puede ganar m√°s popularidad. <br><br>  En esencia, los archivos Lottie son proyectos de Adobe After Effects serializados con JSON que maximizan todas las caracter√≠sticas de este programa.  Con la pantalla, por desgracia, no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">todo es tan color de rosa</a> .  Aunque hay muchas implementaciones "oficiales" ya preparadas de la biblioteca para renderizar Lottie, solo para las plataformas cubiertas por Telegram: Android, iOS, Qt y Web, solo una parte de las capacidades del formato se implementa en todas ellas.  Telegram fue a√∫n m√°s lejos y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">limit√≥ la</a> lista de caracter√≠sticas admitidas, as√≠ como "apareci√≥" con su propio formato, que difiere de la Lottie habitual simplemente empacando en GZip y el par√°metro <code>"tgs": 1</code> .  ¬°Creo que s√© d√≥nde trabaja Denis Popov ahora!  :-) <br><br>  Y si todo est√° bastante bien con la documentaci√≥n para bibliotecas para diferentes plataformas, entonces, por desgracia, no fue posible encontrar al menos alguna descripci√≥n del dispositivo de formato, solo el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esquema JSON</a> en las fuentes de lottie-web.  Tuve que modificar las animaciones existentes en el camino para comprender los conceptos generales del formato.  Tambi√©n hubo discrepancias entre los archivos reales y el esquema: en particular, en las <a href="">capas de tipo 4</a> , de acuerdo con el esquema, los objetos anidados se almacenan en la propiedad <code>"it"</code> ; sin embargo, en los archivos reales la clave se llama <code>"shapes"</code> y <code>"it"</code> no funciona. <br><br>  Los matices aclarados del formato: <br><br><ul><li>  Un archivo consta de capas.  A diferencia del GIF, aqu√≠ cada capa puede tener una hora de inicio y finalizaci√≥n arbitraria para la visualizaci√≥n.  Se pueden aplicar varias transformaciones a la capa (m√°s precisamente, <b>es necesario</b> ): escalado, rotaci√≥n, cambio de transparencia, etc.  Las capas pueden incluso ser tridimensionales (prohibido para Telegram). </li><li>  Una capa consta de "formas".  Tienen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muchos</a> tipos, algunos no se pueden usar en Telegram.  En la pr√°ctica, para que aparezca una capa, debe incluir tres formas: una ruta (en las animaciones terminadas, este suele ser el tipo <code>"sh"</code> - curvas Bezier; el convertidor hasta ahora solo usa el tipo <code>"rc"</code> - rect√°ngulos), el relleno (el tipo <code>"fl"</code> ) y la transformaci√≥n ( escriba <code>"tr"</code> ). </li><li>  Incluso puede incluir elementos r√°ster, crear capas de texto y establecer relaciones entre los par√°metros de capa y forma a trav√©s de expresiones.  Todos estos art√≠culos tambi√©n est√°n prohibidos en Telegram. </li></ul><br>  El primer problema se sigue directamente de aqu√≠: la <b>redundancia</b> .  Aunque los valores predeterminados para los par√°metros de transformaci√≥n se han agregado recientemente al esquema JSON, no se implementan en bibliotecas.  Entonces preguntarles expl√≠citamente todav√≠a es necesario. <br><br>  Parece que esto no es un problema en absoluto?  Incluso un simple GZip hace un buen trabajo al comprimir datos que se repiten descaradamente, y 1 MB de JSON sin procesar se convierte m√°gicamente en un par de decenas de kilobytes, que se arrastran silenciosamente hasta el l√≠mite establecido de 64 kB.  Ah√≠ estaba! <br><br>  Carga, lo que significa una animaci√≥n gordita que muestra con calma lottie-web en Telegram, y aqu√≠, en lugar de un pixel art condicionalmente hermoso, la mirada borrosa est√°tica es esta: <br><br><img src="https://habrastorage.org/webt/vd/10/_x/vd10_xlbyqsapibkpdsqndlplai.png"><br><br>  ¬øQu√© es eso?  Pero result√≥ que claramente hay un <b>l√≠mite</b> no especificado <b>de 1 MB</b> en los datos descomprimidos.  Un representante del equipo de Telegram lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">confirm√≥</a> r√°pidamente y anunci√≥ el pr√≥ximo aumento en el l√≠mite a 2 MB. <br><br>  Incluso si resuelven estos problemas, los usuarios de versiones anteriores de Telegram no podr√°n acceder a las etiquetas que van m√°s all√° de 1 MB de datos sin comprimir y no contienen transformaciones.  Por lo tanto, probablemente tendr√° que cumplir con las restricciones en el futuro. <br><br><h3>  La transparencia es importante. </h3><br>  Pillow, junto con OpenCV, se puede llamar el est√°ndar de la industria para el procesamiento de im√°genes en Python.  Adem√°s, tambi√©n est√° bien enfocado para las funciones GIF: admite colores indexados y da acceso a la paleta.  Admite la conversi√≥n de un mapa de p√≠xeles en una matriz NumPy, que es importante para el procesamiento productivo.  ¬°Incluso recopila estad√≠sticas sobre colores!  Pero tambi√©n hubo desventajas: <br><br><ol><li>  No hab√≠a forma documentada de obtener el √≠ndice de color transparente.  Tuve que asumir como soluci√≥n temporal que el color transparente es el m√°s com√∫n, pero en GIF reales no siempre es as√≠. </li><li>  Lo mismo con un retraso entre cuadros: Pillow proporciona solo los cuadros en s√≠ mismos como una secuencia de im√°genes, sin informaci√≥n sobre los retrasos. </li><li>  A veces, los marcos parciales se superponen incorrectamente. </li></ol><br>  Por lo tanto, tuve que buscar un reemplazo.  El m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gif2numpy</a> actu√≥ como tal.  Est√° "afilado" para las funciones GIF y proporciona acceso a todas las propiedades t√©cnicas tanto de la imagen como de los cuadros individuales, incluido <abbr title="Extensi√≥n de control gr√°fico">GCE</abbr> .  As√≠, resuelve el problema de los retrasos en la lectura. <br><br>  Result√≥ que la transparencia, gif2numpy no lo admite en absoluto: los colores se convierten inmediatamente en tres canales con profundidad de bits en bytes, sin tener en cuenta la profundidad de bits y guardar los √≠ndices de color.  Afortunadamente, el m√≥dulo consta de un archivo, por lo que no fue dif√≠cil incluirlo en el proyecto y modificarlo reservando el color <code>#FE00FE</code> para transparencia. <br><br>  El problema del marco parcial no era trivial de resolver.  gif2numpy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">intenta superponer</a> dichos fotogramas en el anterior, sin embargo, no verifica los par√°metros de superposici√≥n, por lo que el resultado correcto tampoco siempre sale.  Para no perder el tiempo con las banderas, el procesamiento de im√°genes preliminares usando <code>gifsicle</code> con la clave <code>--unoptimize</code> se <code>--unoptimize</code> convierte cuadros parciales en cuadros completos.  Y al mismo tiempo, los lleva a usar la paleta global, lo que elimin√≥ la necesidad de procesar por separado el color transparente al usar su propia paleta de cuadros. <br><br><h3>  Aprietame mas fuerte </h3><br>  Los cuadrados son buenos, pero con tales limitaciones necesitas mostrar m√°s imaginaci√≥n, de lo contrario, incluso los GIF en miniatura no se "arrastrar√°n" en Telegram. <br><br>  <abbr title="Ejecutar codificaci√≥n de longitud">Primero se us√≥</abbr> algo similar a <abbr title="Ejecutar codificaci√≥n de longitud">RLE</abbr> : los cuadrados adyacentes horizontalmente del mismo color se combinan en un rect√°ngulo. <br><br>  El siguiente paso es la explotaci√≥n de las caracter√≠sticas de Lottie.  Dado que cada capa tiene un tiempo de inicio y finalizaci√≥n arbitrario, puede aplicar una t√©cnica que durante mucho tiempo ha sido utilizada por los c√≥decs de video, y en parte en el propio GIF: los cuadrados que permanecen en el mismo lugar durante varios cuadros se pueden combinar en una capa, durante la cual los cambios de visualizaci√≥n varios otros  Lo cual se implementa hasta ahora solo para pares de capas adyacentes. <br><br><h3>  Planes de desarrollo </h3><br>  Las ideas que se pueden aplicar aqu√≠ son masivas: <br><br><ul><li>  <b>Reconocer √°reas de un solo color de cualquier tama√±o.</b>  Puede dividirlos en un conjunto de rect√°ngulos, para los cuales hay un <a href="">buen algoritmo</a> .  Tambi√©n es aconsejable convertirlos en un contorno, pero esto se ve ensombrecido por la necesidad de especificar todos los puntos de las curvas de Bezier en Lottie; los rect√°ngulos en algunos casos pueden ser m√°s ventajosos. </li><li>  <b>Reconocer el movimiento.</b>  La t√©cnica, nuevamente, se ha usado durante mucho tiempo en c√≥decs de video.  Si el mismo contorno no cambia de forma de cuadro a cuadro, sino solo las coordenadas, en lugar de duplicarlo en varias capas, col√≥quelo en una capa con transformaci√≥n. </li><li>  <b>Reconocer la "cobertura" de un √°rea con otra.</b>  Un ejemplo: <br><br><pre> <code class="plaintext hljs">...... .O..O. ...... .OOOO. ......</code> </pre><br>  Los p√≠xeles de un color diferente se superponen en un rect√°ngulo de un color.  En lugar de dividir este rect√°ngulo en un mont√≥n de peque√±os, o transformarlo en un contorno de forma compleja, simplemente puede superponerlos en la parte superior de todo el rect√°ngulo. </li><li>  <b>Vectorizaci√≥n de curvas y elipses, reconocimiento de gradientes.</b>  Esto arruinar√° el encanto de los p√≠xeles, pero mejorar√° la compresibilidad de algunos GIF por orden de magnitud.  Los gradientes est√°n incluso en los "Koloboks" antediluvianos, ¬°lo garantizo! <img src="https://habrastorage.org/getpro/habr/post_images/98f/cc9/e83/98fcc9e832a79a6a2ffeb8f7fd2a64ae.gif" alt=": D"></li><li>  <b>Compresi√≥n con p√©rdida.</b>  En primer lugar, la eliminaci√≥n del difuminado, e incluso en im√°genes excesivamente suaves, no obstaculizar√° la moderaci√≥n del color.  El gifsicle mencionado anteriormente probablemente se encargar√° de esto. </li></ul><br><h3>  Referencias </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes</a>  Miedo en lugares. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El canal</a> en el que subo paquetes de GIF convertidos con √©xito. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460411/">https://habr.com/ru/post/460411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460397/index.html">Inicio r√°pido con WebComponents</a></li>
<li><a href="../460399/index.html">Indicador de carga de SVG en Vue.js</a></li>
<li><a href="../460403/index.html">Ventajas y desventajas de HugePages</a></li>
<li><a href="../460405/index.html">¬øPor qu√© necesitas mec√°nicas de juego ocultas?</a></li>
<li><a href="../460409/index.html">Arduino y teclados (gu√≠a completa)</a></li>
<li><a href="../460413/index.html">7 sitios y aplicaciones √∫tiles para aprender ingl√©s</a></li>
<li><a href="../460415/index.html">Apple Watch 4 (44 mm, 2019) vs Pebble Steel Classic (2014)</a></li>
<li><a href="../460419/index.html">Recuperaci√≥n de calor de gases de combusti√≥n: respetuoso con el medio ambiente</a></li>
<li><a href="../460421/index.html">Interruptor √≥ptico TP-Link T2600G-28SQ para proveedores de servicios: una revisi√≥n detallada</a></li>
<li><a href="../460423/index.html">WAL en PostgreSQL: 3. Punto de control</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>