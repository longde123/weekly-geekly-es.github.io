<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë©üèΩ üöå üîó Les math√©matiques dans Gamedev sont simples. Matrices et transformations affines üí¨ üë¥üèæ üò°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Je m'appelle Grisha et je suis le fondateur de CGDevs. Aujourd'hui, je veux continuer le sujet des math√©matiques dans le jeu dev. Dans...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Les math√©matiques dans Gamedev sont simples. Matrices et transformations affines</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432544/"> Bonjour √† tous!  Je m'appelle Grisha et je suis le fondateur de CGDevs.  Aujourd'hui, je veux continuer le sujet des math√©matiques dans le jeu dev.  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> , nous avons montr√© des exemples de base d'utilisation de vecteurs et d'int√©grales dans des projets Unity, et parlons maintenant des matrices et des transformations affines.  Si vous connaissez bien l'arithm√©tique matricielle;  Vous savez ce qu'est TRS et comment travailler avec lui;  qu'est-ce que la transformation des chefs de m√©nage - vous ne trouverez probablement rien de nouveau pour vous.  Nous parlerons dans le contexte des graphismes 3D.  Si vous √™tes int√©ress√© par ce sujet - bienvenue au chat. <br><br><img src="https://habrastorage.org/webt/uv/qk/z8/uvqkz8zsqguqq3sl4c_clkwknx8.jpeg"><br><a name="habracut"></a><br>  Commen√ßons par l'un des concepts les plus importants dans le contexte de l'article - <i>les transformations affines</i> .  <i>Les transformations affines</i> sont, par essence, la transformation du syst√®me de coordonn√©es (ou espace) en multipliant le vecteur par une matrice sp√©ciale.  Par exemple, des transformations telles que le mouvement, la rotation, la mise √† l'√©chelle, la r√©flexion, etc. Les principales propri√©t√©s des transformations affines sont que vous restez dans le m√™me espace (il est impossible de faire en deux dimensions √† partir d'un vecteur en trois dimensions) et que si les lignes se croisent / sont parall√®les / ont √©t√© crois√©s avant la conversion, cette propri√©t√© sera conserv√©e apr√®s la conversion.  De plus, ils ont beaucoup de propri√©t√©s math√©matiques qui n√©cessitent une connaissance de la th√©orie des groupes, des ensembles et de l'alg√®bre lin√©aire, ce qui facilite le travail avec eux. <br><br><h2>  Matrice TRS </h2><br>  Le deuxi√®me concept important en infographie est la <i>matrice TRS</i> .  En l'utilisant, vous pouvez d√©crire les op√©rations les plus courantes utilis√©es lors de l'utilisation d'images de synth√®se.  <i>Une matrice TRS</i> est une composition de trois matrices de transformation.  Matrices de d√©placement (translation), rotation sur chaque axe (rotation) et mise √† l'√©chelle (√©chelle). <br>  Elle ressemble √† √ßa. <br><br><img src="https://habrastorage.org/webt/9p/cv/lp/9pcvlphst8r4db6bwww36jdwtuo.png"><br><br>  O√π: <br>  <b>Le mouvement</b> est <i>t</i> = nouveau Vector3 (d, h, l). <br>  <b>Mise √† l'√©chelle</b> - <i>s</i> = nouveau Vector3 (nouveau Vector3 (a, e, i) .magnitude, nouveau Vector3 (b, f, j) .magnitude, nouveau Vector3 (c, g, k) .magnitude); <br><br>  <b>Une rotation</b> est une matrice de la forme: <br><br><img src="https://habrastorage.org/webt/in/4c/_n/in4c_nqanxcmlg4lah2colkjioo.png"><br><br>  Allons maintenant un peu plus loin dans le contexte Unity.  Pour commencer, la matrice TRS est une chose tr√®s pratique, mais elle ne doit pas √™tre utilis√©e partout.  √âtant donn√© qu'une simple indication de la position ou de l'ajout de vecteurs dans une unit√© fonctionnera plus rapidement, mais dans de nombreux algorithmes math√©matiques, les matrices sont beaucoup plus pratiques que les vecteurs.  La fonctionnalit√© TRS dans Unity est largement impl√©ment√©e dans la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Matrix4x4</a> , mais elle n'est pas pratique du point de vue de l'application.  Puisque, en plus d'appliquer la matrice par multiplication, elle peut g√©n√©ralement stocker des informations sur l'orientation de l'objet, et pour certaines transformations, je voudrais pouvoir calculer non seulement la position, mais aussi changer l'orientation de l'objet dans son ensemble (par exemple, une r√©flexion qui n'est pas impl√©ment√©e dans Unity) <br><br>  Tous les exemples sont donn√©s ci-dessous pour le syst√®me de coordonn√©es local (l'origine du GameObject est consid√©r√©e comme l'origine des coordonn√©es, √† l'int√©rieur de laquelle se trouve l'objet. Si l'objet est la racine de la hi√©rarchie dans l'unit√©, alors l'origine est le monde (0,0,0)). <br><br>  √âtant donn√© que l'utilisation de la matrice TRS vous permet de d√©crire la position d'un objet dans l'espace, nous avons besoin d'une d√©composition de TRS en valeurs sp√©cifiques de position, de rotation et d'√©chelle pour Unity.  Pour ce faire, vous pouvez √©crire des m√©thodes d'extension pour la classe Matrix4x4 <br><br><div class="spoiler">  <b class="spoiler_title">Obtenir la position, la rotation et l'√©chelle</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix</span></span></span><span class="hljs-function">)</span></span> { Vector3 position; position.x = matrix.m03; position.y = matrix.m13; position.z = matrix.m23; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Quaternion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractRotation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix</span></span></span><span class="hljs-function">)</span></span> { Vector3 forward; forward.x = matrix.m02; forward.y = matrix.m12; forward.z = matrix.m22; Vector3 upwards; upwards.x = matrix.m01; upwards.y = matrix.m11; upwards.z = matrix.m21; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Quaternion.LookRotation(forward, upwards); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractScale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix</span></span></span><span class="hljs-function">)</span></span> { Vector3 scale; scale.x = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00, matrix.m10, matrix.m20, matrix.m30).magnitude; scale.y = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01, matrix.m11, matrix.m21, matrix.m31).magnitude; scale.z = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02, matrix.m12, matrix.m22, matrix.m32).magnitude; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scale; }</code> </pre> <br></div></div><br>  De plus, pour un travail pratique, vous pouvez impl√©menter quelques extensions de classe Transform pour y travailler avec TRS. <br><br><div class="spoiler">  <b class="spoiler_title">Transformation d'expansion</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplyLocalTRS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Transform tr, Matrix4x4 trs</span></span></span><span class="hljs-function">)</span></span> { tr.localPosition = trs.ExtractPosition(); tr.localRotation = trs.ExtractRotation(); tr.localScale = trs.ExtractScale(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractLocalTRS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Transform tr</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Matrix4x4.TRS(tr.localPosition, tr.localRotation, tr.localScale); }</code> </pre> <br></div></div><br>  Sur ce point, les avantages de l'unit√© s'arr√™tent, car les matrices dans Unity sont tr√®s pauvres en fonctionnement.  De nombreux algorithmes n√©cessitent une arithm√©tique matricielle, qui n'est pas impl√©ment√©e dans l'unit√© m√™me dans des op√©rations compl√®tement basiques, telles que l'ajout de matrices et la multiplication de matrices par un scalaire.  De plus, en raison de la particularit√© de l'impl√©mentation de vecteurs dans Unity3d, il existe √©galement un certain nombre d'inconv√©nients associ√©s au fait que vous pouvez cr√©er un vecteur 4x4, mais ne pouvez pas faire 1x4 hors de la bo√Æte.  Puisque nous parlerons davantage de la transformation du Householder pour les r√©flexions, nous mettons d'abord en place les op√©rations n√©cessaires pour cela. <br><br>  Ajouter / soustraire et multiplier par un scalaire est simple.  Cela semble plut√¥t volumineux, mais il n'y a rien de compliqu√© ici, car l'arithm√©tique est simple. <br><br><div class="spoiler">  <b class="spoiler_title">Op√©rations matricielles de base</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MutiplyByNumber</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 * number, matrix.m10 * number, matrix.m20 * number, matrix.m30 * number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 * number, matrix.m11 * number, matrix.m21 * number, matrix.m31 * number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 * number, matrix.m12 * number, matrix.m22 * number, matrix.m32 * number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 * number, matrix.m13 * number, matrix.m23 * number, matrix.m33 * number) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DivideByNumber</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 / number, matrix.m10 / number, matrix.m20 / number, matrix.m30 / number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 / number, matrix.m11 / number, matrix.m21 / number, matrix.m31 / number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 / number, matrix.m12 / number, matrix.m22 / number, matrix.m32 / number), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 / number, matrix.m13 / number, matrix.m23 / number, matrix.m33 / number) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Plus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, Matrix4x4 matrixToAdding</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 + matrixToAdding.m00, matrix.m10 + matrixToAdding.m10, matrix.m20 + matrixToAdding.m20, matrix.m30 + matrixToAdding.m30), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 + matrixToAdding.m01, matrix.m11 + matrixToAdding.m11, matrix.m21 + matrixToAdding.m21, matrix.m31 + matrixToAdding.m31), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 + matrixToAdding.m02, matrix.m12 + matrixToAdding.m12, matrix.m22 + matrixToAdding.m22, matrix.m32 + matrixToAdding.m32), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 + matrixToAdding.m03, matrix.m13 + matrixToAdding.m13, matrix.m23 + matrixToAdding.m23, matrix.m33 + matrixToAdding.m33) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Minus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix, Matrix4x4 matrixToMinus</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m00 - matrixToMinus.m00, matrix.m10 - matrixToMinus.m10, matrix.m20 - matrixToMinus.m20, matrix.m30 - matrixToMinus.m30), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m01 - matrixToMinus.m01, matrix.m11 - matrixToMinus.m11, matrix.m21 - matrixToMinus.m21, matrix.m31 - matrixToMinus.m31), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m02 - matrixToMinus.m02, matrix.m12 - matrixToMinus.m12, matrix.m22 - matrixToMinus.m22, matrix.m32 - matrixToMinus.m32), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(matrix.m03 - matrixToMinus.m03, matrix.m13 - matrixToMinus.m13, matrix.m23 - matrixToMinus.m23, matrix.m33 - matrixToMinus.m33) ); }</code> </pre> <br></div></div><br>  Mais pour la r√©flexion, nous avons besoin de l'op√©ration de multiplication matricielle dans un cas particulier particulier.  Multiplication d'un vecteur de dimension 4x4 par 1x4 (transpos√©) Si vous √™tes familier avec les math√©matiques matricielles, alors vous savez qu'avec cette multiplication vous devez regarder les nombres extr√™mes de la dimension, et vous obtiendrez la dimension de la matrice en sortie, c'est-√†-dire dans ce cas 4x4.  Il y a suffisamment d'informations sur la fa√ßon dont les matrices sont multipli√©es, nous ne peindrons donc pas cela.  Voici un exemple d'un cas sp√©cifique qui sera utile √† l'avenir. <br><br><div class="spoiler">  <b class="spoiler_title">Multipliez un vecteur par un transpos√©</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MultiplyVectorsTransposed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector4 vector, Vector4 transposeVector</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] vectorPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {vector.x, vector.y, vector.z, vector.w}, transposedVectorPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {transposeVector.x, transposeVector.y, transposeVector.z, transposeVector.w}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> matrixDimension = vectorPoints.Length; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[matrixDimension * matrixDimension]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; matrixDimension; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; matrixDimension; j++) { values[i + j * matrixDimension] = vectorPoints[i] * transposedVectorPoints[j]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Matrix4x4( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">0</span></span>], values[<span class="hljs-number"><span class="hljs-number">1</span></span>], values[<span class="hljs-number"><span class="hljs-number">2</span></span>], values[<span class="hljs-number"><span class="hljs-number">3</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">4</span></span>], values[<span class="hljs-number"><span class="hljs-number">5</span></span>], values[<span class="hljs-number"><span class="hljs-number">6</span></span>], values[<span class="hljs-number"><span class="hljs-number">7</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">8</span></span>], values[<span class="hljs-number"><span class="hljs-number">9</span></span>], values[<span class="hljs-number"><span class="hljs-number">10</span></span>], values[<span class="hljs-number"><span class="hljs-number">11</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(values[<span class="hljs-number"><span class="hljs-number">12</span></span>], values[<span class="hljs-number"><span class="hljs-number">13</span></span>], values[<span class="hljs-number"><span class="hljs-number">14</span></span>], values[<span class="hljs-number"><span class="hljs-number">15</span></span>]) ); }</code> </pre> <br></div></div><br><h2>  Transformation du chef de m√©nage </h2><br>  √Ä la recherche de la fa√ßon de refl√©ter un objet par rapport √† n'importe quel axe, je rencontre souvent des conseils pour mettre une √©chelle n√©gative dans la direction n√©cessaire.  C'est un tr√®s mauvais conseil dans le contexte d'Unity, car il casse beaucoup de syst√®mes dans le moteur (butching, collisions, etc.) Dans certains algorithmes, cela se transforme en calculs assez banals si vous devez r√©fl√©chir de mani√®re non triviale par rapport √† Vector3.up ou Vector3.forward, mais dans une direction arbitraire.  La m√©thode de r√©flexion dans une unit√© pr√™te √† l'emploi n'est pas impl√©ment√©e, j'ai donc impl√©ment√© <i>la m√©thode Householder</i> . <br><br>  <i>La transformation Householder</i> est utilis√©e non seulement en infographie, mais dans ce contexte, c'est une transformation lin√©aire qui refl√®te un objet par rapport √† un plan qui passe par ¬´l'origine¬ª et est d√©termin√©e par la normale au plan.  Dans de nombreuses sources, il est d√©crit de mani√®re assez compliqu√©e et incompr√©hensible, bien que sa formule soit √©l√©mentaire. <br><br>  <i>H = I-2 * n * (n ^ T)</i> <br><br>  O√π <i>H</i> est la matrice de transformation, <i>I</i> dans notre cas est Matrix4x4.identity, et <i>n</i> = nouveau Vector4 (planeNormal.x, planeNormal.y, planeNormal.z, 0).  Le symbole T signifie transposition, c'est-√†-dire qu'apr√®s multiplication de <i>n * (n ^ T),</i> nous obtenons une matrice 4x4. <br><br>  Les m√©thodes mises en ≈ìuvre seront utiles et l'enregistrement sera tr√®s compact. <br><br><div class="spoiler">  <b class="spoiler_title">Transformation du chef de m√©nage</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Matrix4x4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HouseholderReflection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matrix4x4 matrix4X4, Vector3 planeNormal</span></span></span><span class="hljs-function">)</span></span> { planeNormal.Normalize(); Vector4 planeNormal4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(planeNormal.x, planeNormal.y, planeNormal.z, <span class="hljs-number"><span class="hljs-number">0</span></span>); Matrix4x4 householderMatrix = Matrix4x4.identity.Minus( MultiplyVectorsTransposed(planeNormal4, planeNormal4).MutiplyByNumber(<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> householderMatrix * matrix4X4; }</code> </pre> <br></div></div><br>  Important: planeNormal doit √™tre normalis√© (ce qui est logique), et la derni√®re coordonn√©e n doit √™tre 0, afin qu'il n'y ait aucun effet d'√©tirement dans la direction, car cela d√©pend de la longueur du vecteur n. <br><br>  Maintenant, pour plus de commodit√© dans Unity, nous impl√©mentons la m√©thode d'extension pour la transformation <br><br><div class="spoiler">  <b class="spoiler_title">R√©flexion de la transformation dans le syst√®me de coordonn√©es local</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LocalReflect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Transform tr, Vector3 planeNormal</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> trs = tr.ExtractLocalTRS(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reflected = trs.HouseholderReflection(planeNormal); tr.ApplyLocalTRS(reflected); }</code> </pre> <br></div></div><br>  C'est tout pour aujourd'hui, si cette s√©rie d'articles continue d'√™tre int√©ressante, je d√©voilerai √©galement d'autres applications des math√©matiques au d√©veloppement de jeux.  Cette fois, il n'y aura pas de projet, car tout le code est plac√© dans l'article, mais le projet avec une application sp√©cifique sera dans l'article suivant.  Sur la photo, vous pouvez deviner de quoi parlera le prochain article. <br><br><img src="https://habrastorage.org/webt/ln/0u/iv/ln0uivbr1o7yxfbiwyyumcbbkc8.png"><br><br>  Merci de votre attention! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432544/">https://habr.com/ru/post/fr432544/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432526/index.html">√âvaluation de nouveaux projets</a></li>
<li><a href="../fr432536/index.html">Qualit√© de l'air dans la maison en hiver</a></li>
<li><a href="../fr432538/index.html">Maison intelligente, je t'ai quand m√™me fait</a></li>
<li><a href="../fr432540/index.html">50 ans plus tard. La m√®re de toutes les d√©mos</a></li>
<li><a href="../fr432542/index.html">Des scientifiques chinois ont d√©velopp√© un papier thermique r√©inscriptible pratique</a></li>
<li><a href="../fr432546/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 278 (du 3 au 9 d√©cembre)</a></li>
<li><a href="../fr432548/index.html">Un exemple d'utilisation d'une biblioth√®que Java pour cr√©er un bot Telegram</a></li>
<li><a href="../fr432550/index.html">Pr√©sentation de 3CX v16 Alpha et de la mise √† jour de WebMeeting 3CX</a></li>
<li><a href="../fr432552/index.html">"L'esprit est en ligne." Formule de conscience</a></li>
<li><a href="../fr432554/index.html">Douglas Engelbart: Renforcer la soci√©t√© du ¬´QI collectif¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>