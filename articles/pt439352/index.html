<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìô üôèüèª üîª Criando um bot de prot√≥tipo para batalhas no Clash Royale üôÜüèø üëÇüèº üë©üèº‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aconteceu a voc√™ que voc√™ se envolve em algum tipo de jogo simples, pensando que a intelig√™ncia artificial pode lidar com isso? Eu costumava e decidi ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando um bot de prot√≥tipo para batalhas no Clash Royale</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/binarydistrict/blog/439352/">  Aconteceu a voc√™ que voc√™ se envolve em algum tipo de jogo simples, pensando que a intelig√™ncia artificial pode lidar com isso?  Eu costumava e decidi tentar criar um bot player desse tipo.  Al√©m disso, agora existem muitas ferramentas para vis√£o computacional e aprendizado de m√°quina que permitem criar modelos sem uma compreens√£o profunda dos detalhes da implementa√ß√£o.  Os mortais comuns podem fazer um prot√≥tipo sem construir redes neurais por meses a partir do zero. <br><br><img src="https://habrastorage.org/webt/fs/7g/yb/fs7gyb9v-o6bessxnliwetns8u0.png"><br><br>  Abaixo do corte, voc√™ encontrar√° o processo de cria√ß√£o de um bot de prova de conceito para o jogo Clash Royale, no qual eu usei as bibliotecas Scala, Python e CV.  Usando vis√£o computacional e aprendizado de m√°quina, tentei criar um bot para um jogo que interage como um jogador ao vivo. <br><a name="habracut"></a><br>  Meu nome √© Sergey Tolmachev, sou desenvolvedor l√≠der do Scala na plataforma Waves e ensino <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um curso Scala</a> no distrito bin√°rio, e no meu tempo livre estudo outras tecnologias, como a IA.  E eu queria refor√ßar as habilidades adquiridas com alguma experi√™ncia pr√°tica.  Ao contr√°rio das competi√ß√µes de IA, em que seu bot joga contra bots de outros usu√°rios, o Clash Royale pode jogar contra pessoas, o que parece engra√ßado.  Seu bot pode aprender a derrotar jogadores reais! <br><br><h2>  Mec√¢nica de jogo em Clash Royale </h2><br>  A mec√¢nica do jogo √© bastante simples.  Voc√™ e seu oponente t√™m tr√™s edif√≠cios: uma fortaleza e duas torres.  Os jogadores antes do jogo coletam baralhos - 8 unidades dispon√≠veis, que s√£o usadas na batalha.  Eles t√™m n√≠veis diferentes e podem ser bombeados, coletando mais cards dessas unidades e comprando atualiza√ß√µes. <br>  Ap√≥s o in√≠cio do jogo, voc√™ pode colocar as unidades dispon√≠veis a uma dist√¢ncia segura das torres inimigas, enquanto gasta unidades de mana, que s√£o restauradas lentamente durante o jogo.  As unidades s√£o enviadas para os edif√≠cios inimigos e distra√≠das pelos inimigos encontrados ao longo do caminho.  O jogador s√≥ pode controlar a posi√ß√£o inicial das unidades - ele pode afetar o movimento adicional e os danos apenas definindo outras unidades. <br><br>  Ainda existem feiti√ßos que podem ser jogados em qualquer lugar do campo, pois geralmente causam danos √†s unidades de maneiras diferentes.  Magias podem clonar, congelar ou acelerar unidades em uma √°rea. <br><br><img src="https://habrastorage.org/webt/bk/xs/s2/bkxss2pfmjmvheqvnex86yy2wdk.png"><br><br>  O objetivo do jogo √© destruir os edif√≠cios inimigos.  Para uma vit√≥ria completa, voc√™ deve destruir a fortaleza ou, ap√≥s dois minutos do jogo, destruir mais pr√©dios (as regras dependem dos modos de jogo, mas, em geral, s√£o assim). <br><br>  Durante o jogo, voc√™ precisa levar em considera√ß√£o o movimento das unidades, o n√∫mero poss√≠vel de mana e as cartas inimigas atuais.  Voc√™ tamb√©m precisa considerar como a instala√ß√£o da unidade afeta o campo de jogo. <br><br><h2>  Construindo uma solu√ß√£o </h2><br>  O Clash Royale √© um jogo para celular, ent√£o decidi execut√°-lo no Android e interagir com ele atrav√©s do ADB.  Isso daria suporte ao trabalho com o simulador ou com um dispositivo real. <br><br>  Decidi que o bot, como muitas outras IAs de jogos, deveria funcionar no algoritmo Perception-Analysis-Action.  Todo o ambiente do jogo √© exibido na tela e a intera√ß√£o ocorre clicando na tela.  Portanto, o bot deve ser um programa cuja entrada descreve o estado atual do jogo: a localiza√ß√£o e as caracter√≠sticas das unidades e edif√≠cios, as cartas poss√≠veis atuais e a quantidade de mana.  Na sa√≠da, o bot deve fornecer uma matriz de coordenadas onde a unidade deve ser gravada. <br><br>  Mas antes de criar o bot em si, era necess√°rio resolver o problema de extrair informa√ß√µes sobre o estado atual do jogo a partir da captura de tela.  De um modo geral, o conte√∫do adicional do artigo √© dedicado a esta tarefa. <br><br>  Para resolver esse problema, decidi usar o Computer Vision.  Talvez essa n√£o seja a melhor solu√ß√£o: um curr√≠culo sem muita experi√™ncia e recursos tem claramente limita√ß√µes e n√£o pode reconhecer tudo no n√≠vel humano. <br><br>  Seria mais preciso coletar dados da mem√≥ria, mas eu n√£o tinha essa experi√™ncia.  A raiz √© necess√°ria e, em geral, essa solu√ß√£o parece mais complicada.  Tamb√©m n√£o est√° claro se a velocidade em torno do tempo real pode ser alcan√ßada aqui se voc√™ procurar objetos com uma JVM de pilha dentro do dispositivo.  Al√©m disso, eu queria resolver o problema do CV mais do que isso. <br>  Em teoria, algu√©m poderia criar um servidor proxy e obter informa√ß√µes de l√°.  Mas o protocolo de rede do jogo geralmente muda, os proxies na Internet aparecem, mas rapidamente se tornam desatualizados e n√£o s√£o suportados. <br><br><h2>  Recursos dispon√≠veis do jogo </h2><br>  Para come√ßar, decidi me familiarizar com os materiais dispon√≠veis no jogo.  Eu encontrei um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">clube de artes√£os</a> retirando recursos empacotados de jogos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[1]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[2]</a> .  Antes de tudo, eu estava interessado em imagens de unidades, mas no pacote de jogos descompactado elas s√£o apresentadas na forma de um mapa de pe√ßas (das quais uma unidade consiste). <br><br>  Tamb√©m achei scripts colados (embora n√£o perfeitos) de quadros de anima√ß√£o de unidade - eles foram √∫teis para treinar o modelo de reconhecimento. <br><br><img src="https://habrastorage.org/webt/b_/bp/zm/b_bpzm14pv9snavxmruq0k5q0cm.png"><br><br>  Al√©m disso, nos recursos, voc√™ pode encontrar csv com v√°rios dados do jogo - a quantidade de HP, danos a unidades de diferentes n√≠veis etc. Isso √© √∫til ao criar l√≥gica de bot.  Por exemplo, a partir dos dados, ficou claro que o campo foi dividido em 18 x 29 c√©lulas, e as unidades s√≥ podem ser colocadas nelas.  Havia tamb√©m todas as imagens de mapas de unidades, que ser√£o √∫teis para n√≥s mais tarde. <br><br><h2>  Vis√£o computacional para os pregui√ßosos </h2><br>  Depois de procurar solu√ß√µes CV dispon√≠veis, ficou claro que, em qualquer caso, elas precisariam ser treinadas em um conjunto de dados rotulado.  Tirei screenshots e j√° estava pronto para marcar um certo n√∫mero de screenshots com as m√£os.  Isso provou ser uma tarefa assustadora. <br><br>  Encontrar programas de reconhecimento dispon√≠veis levou algum tempo.  Eu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">decidi</a> por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">labelImg</a> .  Todos os aplicativos de anota√ß√£o que encontrei eram bastante primitivos: muitos n√£o suportavam atalhos de teclado, a sele√ß√£o de objetos e seus tipos era muito menos conveniente do que no labelImg. <br><br>  Durante a marca√ß√£o, mostrou-se √∫til ter o c√≥digo-fonte do aplicativo.  Tirei screenshots a cada dois segundos da partida.  Existem muitos objetos nas capturas de tela (por exemplo, um ex√©rcito de esqueletos), e eu fiz uma modifica√ß√£o no labelImg - por padr√£o, ao marcar a pr√≥xima imagem, as etiquetas da anterior foram tiradas.  Muitas vezes, eles simplesmente precisavam ser movidos para uma nova posi√ß√£o das unidades, remover as unidades mortas e adicionar algumas aparecidas, e n√£o marcar do zero. <br><br><img src="https://habrastorage.org/webt/cx/dh/rf/cxdhrf-uctqed-l84x2mg_9j4u8.png"><br><br>  O processo acabou consumindo muitos recursos - em dois dias no modo silencioso, publiquei cerca de 200 capturas de tela.  A amostra parece muito pequena, mas decidi come√ßar a experimentar.  Voc√™ sempre pode adicionar mais exemplos e melhorar a qualidade do modelo. <br><br>  No momento da marca√ß√£o, eu n√£o sabia qual ferramenta de treinamento eu usaria, ent√£o decidi salvar os resultados da marca√ß√£o no formato VOC - um dos mais conservadores e aparentemente universais. <br><br>  A quest√£o pode surgir: por que n√£o procurar imagens pixel-a-pixel de unidades por completa coincid√™ncia?  O problema √© que, para isso, seria necess√°rio procurar um grande n√∫mero de quadros diferentes de anima√ß√£o de unidades diferentes.  Dificilmente funcionaria.  Eu queria criar uma solu√ß√£o universal que suporte permiss√µes diferentes.  Al√©m disso, as unidades podem ter uma cor diferente, dependendo do efeito aplicado a elas - congelamento, acelera√ß√£o. <br><br><h2>  Por que eu escolhi YOLO </h2><br>  Comecei a explorar poss√≠veis solu√ß√µes de reconhecimento de imagem.  Eu olhei para a aplica√ß√£o de v√°rios algoritmos: OpenCV, TensorFlow, Torch.  Eu queria fazer o reconhecimento o mais r√°pido poss√≠vel, sacrificando a precis√£o e obtendo o POC o mais r√°pido poss√≠vel. <br><br>  Depois de ler os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigos</a> , percebi que minha tarefa n√£o se encaixa nos classificadores HOG / LBP / SVM / HAAR / ....  Embora sejam r√°pidos, teriam que ser aplicados v√°rias vezes - de acordo com o classificador de cada unidade - e depois um por um para aplic√°-los √† imagem para pesquisa.  Al√©m disso, seu princ√≠pio de opera√ß√£o em teoria daria resultados ruins: as unidades podem ter uma forma diferente, por exemplo, ao mover para a esquerda e para cima. <br><br>  Teoricamente, usando uma rede neural, voc√™ pode aplic√°-la uma vez a uma imagem e obter todas as unidades de tipos diferentes com suas posi√ß√µes, ent√£o comecei a procurar redes neurais.  O TensorFlow encontrou suporte para Redes Neurais Convolucionais (CNN).  Descobriu-se que n√£o √© necess√°rio treinar redes neurais do zero - voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">treinar novamente a poderosa rede existente</a> . <br><br>  Ent√£o eu encontrei um algoritmo YOLO mais pr√°tico que promete menos complexidade e, portanto, tinha que fornecer um algoritmo de busca em alta velocidade sem sacrificar muita precis√£o (e, em alguns casos, superando outros modelos). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O site da YOLO</a> promete uma enorme diferen√ßa de velocidade usando o modelo min√∫sculo e uma rede menor e otimizada.  O YOLO tamb√©m permite que voc√™ treine novamente a rede neural pronta para sua tarefa, e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">darknet</a> - uma estrutura de c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aberto</a> para usar v√°rios neur√¥nios cujos criadores desenvolveram o YOLO - √© um aplicativo C nativo simples, e todo o trabalho com ele ocorre atrav√©s de suas chamadas de par√¢metros. <br><br>  O TensorFlow, escrito em Python, √© de fato uma biblioteca Python e √© usado usando scripts auto-escritos que voc√™ precisa descobrir ou refinar para atender √†s suas necessidades.  Provavelmente, para alguns, a flexibilidade do TensorFlow √© uma vantagem, mas sem entrar em detalhes, dificilmente √© poss√≠vel peg√°-lo e us√°-lo rapidamente.  Portanto, no meu projeto, a escolha recaiu no YOLO. <br><br><h2>  Constru√ß√£o de modelo </h2><br>  Para trabalhar no treinamento de modelos, instalei o Ubuntu 18.10, entreguei pacotes de montagem, pacote OpenCL da NVIDIA e outras depend√™ncias e constru√≠ darknet. <br><br>  O Github possui uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">se√ß√£o com etapas simples para treinar novamente o modelo YOLO</a> : voc√™ precisa fazer o download do modelo e das configura√ß√µes, alter√°-los e iniciar a reciclagem. <br><br>  Primeiro, eu queria tentar treinar um modelo YOLO simples, depois Tiny e compar√°-los.  Entretanto, para o treinamento de modelos simples, voc√™ precisa de 4 GB de mem√≥ria da placa de v√≠deo e eu s√≥ tinha uma placa gr√°fica NVIDIA GeForce GTX 1060 de 3 GB comprada para jogos.  Portanto, pude treinar imediatamente apenas o modelo Tiny. <br><br>  A marca√ß√£o das unidades nas imagens que eu tinha estava no formato VOC e o YOLO trabalhava com seu pr√≥prio formato, ent√£o usei o utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">convert2Yolo</a> para converter arquivos de anota√ß√£o. <br><br>  Depois de uma noite de treinamento nas minhas 200 capturas de tela, obtive os primeiros resultados e eles me surpreenderam - o modelo realmente conseguiu reconhecer algo corretamente!  Percebi que estava indo na dire√ß√£o certa e decidi dar mais exemplos de ensino. <br><br><img src="https://habrastorage.org/webt/ek/rh/ik/ekrhikfcntuxljeawh09ikegnp0.png"><br><br>  Eu n√£o queria continuar exibindo capturas de tela e lembrei-me dos quadros das anima√ß√µes de unidade.  Marquei todas as imagens pequenas com suas aulas e tentei treinar a rede nesse set.  O resultado foi muito ruim.  Suponho que o modelo n√£o possa selecionar os padr√µes corretos em imagens pequenas para uso em imagens grandes. <br><br>  Depois disso, decidi coloc√°-los em cen√°rios prontos de arenas de batalha e criar programaticamente um arquivo de marca√ß√£o VOC.  O resultado foi uma captura de tela sint√©tica com layout 100% preciso autom√°tico. <br><br>  Eu escrevi um script em Scala que divide a captura de tela em 16 quadrados 4x4 e coloca as unidades no centro delas, para que elas n√£o se cruzem.  O script tamb√©m me permitiu personalizar a cria√ß√£o de exemplos de treinamento - ao sofrer danos, as unidades s√£o pintadas na cor de sua equipe (vermelho / azul) e, durante a classifica√ß√£o, reconhe√ßo unidades de cores diferentes.  Al√©m da mancha, unidades de diferentes equipes que receberam danos apresentam pequenas diferen√ßas nas roupas.  Al√©m disso, aumentei e diminu√≠ um pouco aleatoriamente as unidades, para que o modelo aprendesse a n√£o depender muito do tamanho da unidade.  Como resultado, aprendi como criar dezenas de milhares de exemplos de treinamento que s√£o aproximadamente semelhantes √†s capturas de tela reais. <br><br><img src="https://habrastorage.org/webt/uv/zi/_u/uvzi_uwhmohzcx0a7ylmpbyjady.png"><br><br>  A gera√ß√£o n√£o foi perfeita.  Muitas vezes, as unidades eram colocadas no topo de edif√≠cios, embora no jogo estivessem atr√°s deles;  n√£o houve exemplos de partes sobrepostas da unidade, embora essa n√£o seja uma situa√ß√£o rara no jogo.  Mas at√© agora decidi negligenci√°-lo. <br><br><img src="https://habrastorage.org/webt/zo/wk/uq/zowkuqkijfqocemk7_qflhhgavg.png"><br><br>  O modelo obtido ap√≥s v√°rias noites de treinamento com uma mistura de 200 capturas de tela reais e 5.000 imagens geradas que foram recriadas durante o processo de treinamento uma vez por dia, quando testadas nessas capturas de tela, deu maus resultados.  N√£o √© surpreendente, porque as imagens geradas t√™m muitas diferen√ßas em rela√ß√£o √†s reais. <br><br>  Portanto, coloquei o modelo resultante para treinar novamente em uma amostra m√©dia, na qual havia apenas 200 das minhas capturas de tela.  Depois disso, ela come√ßou a trabalhar muito melhor. <br><br><div class="spoiler">  <b class="spoiler_title">Vergonha</b> <div class="spoiler_text">  Pe√ßo desculpas por lidar com medidas n√£o cient√≠ficas como "muito melhores", mas n√£o sei como validar imagens cruzadas rapidamente, ent√£o tentei v√°rias capturas de tela de um conjunto sem treinamento e verifiquei se os resultados me satisfaziam.  Esta √© a coisa mais importante.  N√≥s somos pregui√ßosos e estamos fazendo um prot√≥tipo, certo? <br><br>  Os pr√≥ximos passos para melhorar o modelo foram compreens√≠veis - marque com as m√£os mais capturas de tela reais e treine-as no modelo, pr√©-treinadas nas capturas de tela geradas. <br></div></div><br><h2>  Vamos ao que interessa </h2><br>  Decidi escrever um bot em Python - ele tem muitas ferramentas dispon√≠veis para o ML.  Decidi usar meu modelo com o OpenCV, que do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.5 aprendeu a usar modelos de redes neurais</a> , e at√© encontrei um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplo simples</a> .  Tendo experimentado v√°rias bibliotecas para trabalhar com o ADB, escolhi o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pure-python-adb</a> - tudo o que preciso √© simplesmente implementado l√°: a fun√ß√£o de captura de tela e a opera√ß√£o no dispositivo shell;  Eu bato usando o 'toque de entrada'. <br><br>  Ent√£o, tendo recebido uma captura de tela do jogo, reconhecendo as unidades e cutucando-a na tela, continuei trabalhando no reconhecimento do estado do jogo.  Al√©m das unidades, eu precisava reconhecer o n√≠vel atual de mana e as cartas dispon√≠veis para o jogador. <br><br>  O n√≠vel de mana no jogo √© exibido como uma barra de progresso e n√∫meros.  Sem pensar duas vezes, comecei a cortar o n√∫mero, inverter e reconhecer usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pytesseract</a> . <br><br>  Para determinar os cart√µes dispon√≠veis e sua posi√ß√£o, usei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">detector de ponto</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chave KAZE da OpenCV</a> .  At√© agora, eu n√£o queria voltar a aprender a rede neural novamente e escolhi um m√©todo que fosse mais r√°pido e f√°cil, embora, no final, tenha a precis√£o m√≠nima necess√°ria no caso em que voc√™ precisa procurar muitos objetos. <br><br>  Ao iniciar o bot, contei os pontos-chave de todas as imagens do mapa (existem v√°rias d√∫zias no total) e, durante o jogo, procurei correspond√™ncias de todas as cartas com a √°rea de cartas do jogador para reduzir o n√∫mero de erros e aumentar a velocidade.  Eles foram classificados pela precis√£o e pela coordenada <i>x</i> para obter a ordem dos mapas - informa√ß√µes sobre como eles est√£o localizados na tela. <br><br>  Tendo brincado um pouco com os par√¢metros, na pr√°tica eu cometi muitos erros, embora algumas imagens complexas de cart√µes, que √†s vezes eram confundidas com outras pelo algoritmo, fossem reconhecidas com grande precis√£o.  Eu tive que adicionar um buffer de tr√™s elementos: se tr√™s forem reconhecidos em uma linha, obtemos os mesmos valores, ent√£o acreditamos condicionalmente que podemos confiar neles. <br><br><img src="https://habrastorage.org/webt/vr/8a/mj/vr8amjw6_mpuh8kzethfk0zbkya.png"><br><br>  Depois de receber todas as informa√ß√µes necess√°rias (unidades e sua posi√ß√£o aproximada, mana e cards dispon√≠veis), voc√™ pode tomar algumas decis√µes. <br><br>  Para come√ßar, decidi usar algo simples: por exemplo, se houver mana suficiente em uma carta acess√≠vel, jogue-a no campo.  Mas o bot ainda n√£o sabe "jogar" as cartas - sabe quais as cartas que temos, onde fica o campo, √© necess√°rio clicar no cart√£o desejado e depois na c√©lula desejada no campo. <br><br>  Conhecendo a resolu√ß√£o da captura de tela, voc√™ pode entender as coordenadas do mapa e a c√©lula de campo desejada.  Agora, vinculei √† resolu√ß√£o exata da tela, mas, se necess√°rio, posso ignorar isso.  A fun√ß√£o de decis√£o retornar√° uma matriz de torneiras que precisam ser feitas em um futuro pr√≥ximo.  Em geral, nosso bot ser√° um loop infinito (simplificado): <br><br><pre><code class="plaintext hljs">:     =        :         ( )               :         =  ()         =  ()         =  ()         += (, , , )</code> </pre> <br><br>  At√© agora, o bot s√≥ pode colocar unidades em um ponto, mas j√° possui informa√ß√µes suficientes para construir uma estrat√©gia mais complexa. <br><br><h3>  Primeiros problemas </h3><br>  Na realidade, encontrei um problema inesperado e muito desagrad√°vel.  Criar uma captura de tela atrav√©s do ADB leva cerca de 100 ms, o que gera um atraso significativo - eu esperava um atraso m√°ximo, levando em considera√ß√£o todos os c√°lculos e a op√ß√£o de a√ß√£o, mas n√£o em uma etapa da cria√ß√£o de uma captura de tela.  N√£o foi poss√≠vel encontrar uma solu√ß√£o simples e r√°pida.  Em teoria, usando o emulador Android, voc√™ pode tirar capturas de tela diretamente da janela do aplicativo ou criar um utilit√°rio para transmitir imagens de um telefone com compress√£o via UDP e conectar o bot a ele, mas tamb√©m n√£o encontrei solu√ß√µes r√°pidas aqui. <br><br><h2>  Ent√£o </h2><br>  Depois de avaliar com seriedade o estado do meu projeto, decidi me concentrar neste modelo por enquanto.  Passei v√°rias semanas do meu tempo livre fazendo isso, e o reconhecimento da unidade √© apenas parte da jogabilidade. <br><br>  Decidi desenvolver partes do bot gradualmente - para criar a l√≥gica b√°sica da percep√ß√£o, depois uma l√≥gica simples do jogo e a intera√ß√£o com o jogo, e ent√£o ser√° poss√≠vel melhorar partes individuais do bot.  Quando o n√≠vel do modelo de reconhecimento de unidade se torna suficiente, adicionar informa√ß√µes sobre a HP e o n√≠vel de unidades pode levar o desenvolvimento do bot do jogo a um est√°gio totalmente novo.  Talvez esse seja o pr√≥ximo objetivo, mas, no momento, n√£o vale a pena focar nessa tarefa. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Reposit√≥rio do projeto Github</a> <br><br>  Passei muito tempo no projeto e, francamente, estou cansado disso, mas n√£o me arrependo nem um pouco - tenho uma nova experi√™ncia em ML / CV. <br><br>  Talvez eu volte mais tarde para ele - ficarei feliz se algu√©m se juntar a mim.  Se voc√™ estiver interessado, participe do grupo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Telegram</a> e tamb√©m participe do meu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">curso Scala</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439352/">https://habr.com/ru/post/pt439352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439342/index.html">DIYorDIE Winter Meetup 17 de fevereiro</a></li>
<li><a href="../pt439344/index.html">Como um troll: como os monopolistas regem as patentes</a></li>
<li><a href="../pt439346/index.html">Laravel + Docker: nossa experi√™ncia de sucesso</a></li>
<li><a href="../pt439348/index.html">A vis√£o diminui ap√≥s a corre√ß√£o da vis√£o a laser - o que fazer? Ou, doutor, me fa√ßa um aprimoramento</a></li>
<li><a href="../pt439350/index.html">Intelig√™ncia Artificial como M√°quina de Inven√ß√£o</a></li>
<li><a href="../pt439354/index.html">Rust News # 5 (janeiro de 2019)</a></li>
<li><a href="../pt439356/index.html">M√©tricas n√£o triviais da efic√°cia das campanhas publicit√°rias</a></li>
<li><a href="../pt439358/index.html">Metadados de arquivo do Excel</a></li>
<li><a href="../pt439360/index.html">Treinamento Cisco 200-125 CCNA v3.0. Cisco Certified Network Specialist (CCNA). Dia 3. Sub-redes</a></li>
<li><a href="../pt439362/index.html">Como ensinamos Engenharia de Software no HSE de S√£o Petersburgo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>