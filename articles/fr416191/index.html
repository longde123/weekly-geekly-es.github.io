<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöû ü•Ö üßëüèæ Impl√©mentation de bas niveau de l'arborescence des pr√©fixes trie en PHP üõ∏ üßòüèº üë©‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©face 
 L'impl√©mentation de PHP trie d√©crite ici rend le dictionnaire trop gras jusqu'√† pr√©sent, ce qui prend donc un certain temps pour se charger ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Impl√©mentation de bas niveau de l'arborescence des pr√©fixes trie en PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416191/"><h2>  Pr√©face </h2><br>  L'impl√©mentation de PHP trie d√©crite ici rend le dictionnaire trop gras jusqu'√† pr√©sent, ce qui prend donc un certain temps pour se charger en m√©moire, ce qui nivelle la assez bonne vitesse de son travail.  La vitesse de recherche est d'environ 80 000 mots par seconde.  Le dictionnaire est compos√© de la liste des lemmes du dictionnaire opencorpora.org et comprend 389844 mots.  Sous forme non compress√©e, le dictionnaire p√®se ~ 150 Mo et le gzip compress√© ~ 6 Mo.  Cependant, de tr√®s bons r√©sultats de performances prouvent qu'en PHP pur, vous pouvez cr√©er un arbre de pr√©fixes de tri enti√®rement fonctionnel. <br><a name="habracut"></a><br>  Je demande aux programmeurs √† l'avance avec l'√©toffe des critiques litt√©raires de ne pas √©crire de commentaires malveillants.  Cet article devrait √™tre int√©ressant pour les d√©butants, comme moi-m√™me.  Trop paresseux pour lire, vous pouvez imm√©diatement voir le code sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> . <br><br><h2>  Comment tout a commenc√© </h2><br>  Depuis un certain temps maintenant, j'√©chappe √† l'id√©e d'√©crire un analyseur morphologique pour mes projets PHP, qui sera capable de mener rapidement une analyse morphologique de mots donn√©s, ainsi que de transformer des mots dans la forme morphologique souhait√©e. <br><br>  PHP a d√©j√† une biblioth√®que similaire appel√©e phpmorhy.  Cela fonctionne assez rapidement et je l'utiliserais et n'inventerais rien, mais le compilateur de dictionnaire est fait comme une application non PHP distincte, ce qui me rend impossible d'utiliser cette biblioth√®que.  La biblioth√®que elle-m√™me est construite sur la base du dictionnaire AOT tant attendu, ce qui r√©duit encore son utilit√©. <br><br>  Des semaines et des mois ont pass√©, j'ai lu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article de</a> Khabrovchanin, puis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article de</a> I. Segalovich sur un algorithme morphologique rapide pour un moteur de recherche, puis un tas d'articles diff√©rents. <br><br>  Peu √† peu, j'ai m√ªri pour √©crire mon propre <s>lunapark avec le blackjack et les os d'un</s> analyseur morphologique.  Je pense: " <i>Eh bien, les progr√®s ont progress√©, en PHP, vous pouvez d√©j√† analyser le g√©nome humain!</i> " <br><br>  J'ai pris le dictionnaire opencorpora.org, je l'ai mis dans mysql et j'ai obtenu une vitesse de recherche de 2 000 mots par seconde.  Il faut, je pense, charger le dictionnaire en m√©moire.  Et ici, il s'av√®re que pour avoir des structures de donn√©es r√©guli√®res disponibles en PHP comme un tableau ou un objet, vous devez stocker environ 3 Go de RAM pour un dictionnaire de 3 millions.  Toutes les impl√©mentations de php trie qui me sont parvenues n'√©taient appropri√©es que comme tutoriel pour d√©montrer la logique du travail, car elles-m√™mes √©taient construites sur des structures de stockage de donn√©es PHP natives. <br><br><h2>  Dispositif de stockage de dictionnaire et principe de fonctionnement </h2><br>  Partout o√π j'ai pu lire, √©couter ou regarder dans l'arbre des pr√©fixes trie, il n'est pas expliqu√© exactement comment les donn√©es seront stock√©es en m√©moire.  Ici, nous avons le n≈ìud, et voici ses h√©ritiers, et voici le drapeau de la fin du mot, qui n'est pas repr√©sent√© sous le capot.  J'ai donc d√ª inventer moi-m√™me une m√©thode de stockage. <br><br>  Comme vous le savez, l'arborescence des pr√©fixes trie est constitu√©e de n≈ìuds.  Un n≈ìud stocke un pr√©fixe, des liens vers les n≈ìuds suivants (descendants) et un pointeur sur le fait que ce pr√©fixe est le dernier de la cha√Æne.  Tout indique intelligiblement √† propos de Trie des Indiens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Les n≈ìuds de mon impl√©mentation trie sont des blocs de donn√©es d'une longueur fixe de 154 octets.  Les 6 premiers octets (48 bits) contiennent le masque de bits des h√©ritiers.  Les 46 premiers bits sont l'alphabet russe, les chiffres, les guillemets, le tiret et l'apostrophe.  L'apostrophe a √©t√© ajout√©e car dans le dictionnaire opencorpora.org il y a le mot "cote d'ivoire", qui utilise le signe de l'apostrophe.  Le 47e bit est utilis√© pour stocker l'indicateur de fin de mot.  Les 148 octets suivants apr√®s le masque de bits sont utilis√©s pour stocker les r√©f√©rences aux h√©ritiers du n≈ìud.  3 octets par caract√®re (46 * 3 = 148). <br><br>  Les n≈ìuds sont stock√©s sous forme de donn√©es binaires dans une cha√Æne.  L'acc√®s √† la section souhait√©e est effectu√© √† l'aide de la fonction substr () et du d√©ballage ult√©rieur (). <br><br>  L'utilisation de n≈ìuds de longueur fixe simplifie le processus d'adressage.  Pour passer au n≈ìud souhait√©, il suffit de conna√Ætre son num√©ro de s√©rie (id) et la longueur du n≈ìud.  Nous multiplions le num√©ro de s√©rie par la longueur et d√©couvrons le d√©calage par rapport au d√©but de la ligne - tout est tr√®s simple. <br><br><h4>  fig.  1 Sch√©ma de stockage </h4><br><img src="https://habrastorage.org/webt/z_/m8/yg/z_m8yg9qtvtn5niwisxq_tjehsa.png"><br><br><h2>  Inconv√©nients </h2><br>  Le sch√©ma de stockage utilis√© simplifie l'adressage, mais il consomme de l'espace.  Le stockage de 380 000 mots n√©cessite un peu plus d'un million de n≈ìuds.  154 octets * 1000000 n≈ìuds = 146,86 m√©gaoctets.  C'est-√†-dire  environ 400 octets par mot.  Si vous √©crivez des mots dans un simple fichier texte encod√© en utf8, ces m√™mes 380 000 mots peuvent tenir dans 16 m√©gaoctets. <br><br><h2>  Plans </h2><br>  Pour utiliser la m√©moire de mani√®re plus rationnelle, je veux passer √† une longueur variable de n≈ìuds, puis en tant que lien, je devrai enregistrer non pas l'identifiant du n≈ìud, mais son emplacement en octets.  L'emplacement du lien vers le n≈ìud souhait√© sera d√©termin√© comme suit.  Sur l'exemple du mot "abv." <br><br>  La lettre "a" est la premi√®re de l'alphabet, par cons√©quent, son n≈ìud est √©galement le premier, respectivement, le d√©calage 0. Lire 6 octets, √† partir de 0. <br><br><pre><code class="php hljs">$str = substr($dic, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>);</code> </pre> <br>  D√©ballez la ligne: <br><br><pre> <code class="php hljs">$mask = (ord($str[<span class="hljs-number"><span class="hljs-number">5</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">40</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">4</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">32</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">3</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">2</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + ord($str[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br>  On regarde le masque du 2√®me bit (lettre "b") <br><br><pre> <code class="php hljs">bit_get($mask, <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  Le bit est d√©fini, nous comptons maintenant le nombre de bits lev√©s dans le masque √† 2. Disons que le bit de la lettre "a" est √©galement lev√© √† notre n≈ìud, donc notre bit de la lettre "b" sera le deuxi√®me bit lev√©.  Compter le d√©calage pour lire le lien <br><br><pre> <code class="php hljs">$offset = <span class="hljs-number"><span class="hljs-number">6</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br>  Masque de 6 octets + 3 octets, que le premier lien occupe, il s'av√®re 9 octets.  Nous lisons le morceau de ficelle souhait√©. <br><br><pre> <code class="php hljs">$str = substr($dic, $offset, <span class="hljs-number"><span class="hljs-number">3</span></span>);</code> </pre> <br>  D√©compressez le lien: <br><br><pre> <code class="php hljs">$ref = (ord($str[<span class="hljs-number"><span class="hljs-number">2</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (ord($str[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + ord($str[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br>  Allez au n≈ìud suivant et r√©p√©tez tout √† nouveau.  Dans la derni√®re lettre, nous v√©rifions la pr√©sence de 47 bits dans le masque, s'il est d√©fini, il y a un mot de recherche dans notre trie. <br><br>  J'esp√®re qu'il sera possible de maintenir une vitesse d'au moins 50 000 mots par seconde. <br><br><h2>  Remerciements </h2><br>  Je tiens √† remercier les participants du forum nulled.cc et php.ru pour leur aide avec les fonctions bit √† bit. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416191/">https://habr.com/ru/post/fr416191/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416179/index.html">Une porte qui nous accueille par son nom et ne s'ouvre qu'aux employ√©s du d√©partement</a></li>
<li><a href="../fr416181/index.html">Modulation d'amplitude sur les doigts</a></li>
<li><a href="../fr416183/index.html">Test des donn√©es: exigences et niveaux</a></li>
<li><a href="../fr416187/index.html">Suite √† la rencontre ¬´Nouvelles fonctionnalit√©s de PostgreSQL 11¬ª (Partie 2)</a></li>
<li><a href="../fr416189/index.html">Le traitement de Scrum "m√©canique". Partie 3. Travail SM</a></li>
<li><a href="../fr416193/index.html">Comment les robots peuvent travailler ensemble avec les humains (et non √† la place)</a></li>
<li><a href="../fr416195/index.html">Dijkstra pour le temps lin√©aire</a></li>
<li><a href="../fr416197/index.html">Les moteurs du nouveau programme DARPA r√©ussissent les tests</a></li>
<li><a href="../fr416199/index.html">La sonde Dawn a envoy√© des photos d√©taill√©es des points blancs de Ceres: c'est du soda ordinaire</a></li>
<li><a href="../fr416201/index.html">3 super jeux de soci√©t√© de science-fiction en anglais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>