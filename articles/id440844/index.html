<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☣️ 🤳🏼 🏇🏽 Google Drive sebagai penyimpanan untuk aplikasi web 🔘 🕠 🐓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kata Pengantar 
 Aplikasi web saya menyimpan data di localStorage . Ini nyaman sampai saya ingin pengguna melihat hal yang sama ketika mengakses situs...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Google Drive sebagai penyimpanan untuk aplikasi web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440844/"><h1>  Kata Pengantar </h1><br>  Aplikasi web saya menyimpan data di <code>localStorage</code> .  Ini nyaman sampai saya ingin pengguna melihat hal yang sama ketika mengakses situs dari perangkat yang berbeda.  Artinya, penyimpanan jarak jauh diperlukan. <br><br>  Tetapi aplikasi ini "dihosting" pada Halaman GitHub dan tidak memiliki bagian server.  Saya memutuskan untuk tidak membuat server, tetapi untuk menyimpan data dengan pihak ketiga.  Ini memberikan keuntungan signifikan: <br><br><ol><li>  Tidak perlu membayar untuk server, tidak ada salahnya kepala tentang stabilitas dan ketersediaannya. </li><li>  Lebih sedikit kode, lebih sedikit kesalahan. </li><li>  Pengguna tidak perlu mendaftar di aplikasi saya (ini menjengkelkan bagi banyak orang). </li><li>  Privasi lebih tinggi, dan pengguna tahu bahwa datanya disimpan di tempat yang kemungkinan besar lebih dipercayanya daripada saya. </li></ol><br>  Pertama, pilihan jatuh pada <a href="">remoteStorage.js</a> .  Mereka menawarkan protokol pertukaran data terbuka, API yang cukup bagus, kemampuan untuk berintegrasi dengan Google Drive dan Dropbox, serta server mereka.  Tapi jalan ini ternyata menjadi jalan buntu (mengapa - cerita yang terpisah). <br><br>  Pada akhirnya, saya memutuskan untuk menggunakan Google Drive secara langsung, dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Perpustakaan Klien Google API</a> (selanjutnya GAPI) sebagai perpustakaan untuk mengaksesnya. <br><br>  Sayangnya, dokumentasi Google mengecewakan, dan perpustakaan GAPI terlihat belum selesai, apalagi, ia memiliki beberapa versi, dan tidak selalu jelas yang mana yang dimaksud.  Oleh karena itu, solusi untuk masalah saya harus dikumpulkan berkeping-keping dari dokumentasi, pertanyaan dan jawaban tentang StackOverflow dan posting acak di Internet. <br><br>  Saya harap artikel ini menghemat waktu Anda jika Anda memutuskan untuk menggunakan Google Drive di aplikasi Anda. <br><a name="habracut"></a><br><h1>  Persiapan </h1><br>  Berikut ini adalah deskripsi cara mendapatkan kunci untuk bekerja dengan Google API.  Jika Anda tidak tertarik, langsung ke bagian selanjutnya. <br><br><div class="spoiler">  <b class="spoiler_title">Menerima kunci</b> <div class="spoiler_text">  Di Google Developer Console, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buat</a> proyek baru, masukkan nama. <br><br>  Di "Control Panel" klik "Enable API and Services" dan nyalakan Google Drive. <br><br>  Selanjutnya, buka API dan Layanan -&gt; bagian Kredensial, klik "Buat Kredensial".  Ada tiga hal yang perlu Anda lakukan: <br><br><ol><li>  Konfigurasikan "Jendela Permintaan Akses OAuth".  Masukkan nama aplikasi, domain Anda di bagian "Domain Resmi" dan tautan ke halaman utama aplikasi.  Bidang lainnya opsional. <br></li><li>  Di bagian "Kredensial", klik "Buat Kredensial" -&gt; "Pengidentifikasi Klien OAuth".  Pilih jenis "Aplikasi Web".  Di jendela pengaturan, tambahkan "Sumber Javascript yang Diizinkan" dan "URI Pengalihan yang Diizinkan": <br><ul><li>  Domain Anda (wajib) <br></li><li>  <code>http://localhost:8000</code> (opsional untuk bekerja secara lokal). <br></li></ul><br><img src="https://habrastorage.org/webt/gg/rv/hc/ggrvhc5j0yclrw6brc5ij0uaape.png"><br></li><li>  Di bagian "Kredensial", klik "Buat Kredensial" -&gt; "Kunci API".  Di pengaturan tombol, tentukan batasan: <br><ul><li>  Jenis aplikasi yang diizinkan -&gt; perujuk HTTP (situs web) <br></li><li>  Terima permintaan http dari sumber rujukan berikut (situs) -&gt; domain Anda dan hosting lokal (seperti dalam poin 2). <br></li><li>  API Valid -&gt; Google Drive API <br></li></ul><br><img src="https://habrastorage.org/webt/rj/uo/26/rjuo26cmoytw5p9up_xcbrpy270.png"><br></li></ol><br>  Bagian Kredensial akan terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/fa/9i/he/fa9ihekdcod48ffftoavoyhejbe.png"><br><br>  Di sini kita sudah selesai.  Kami lolos ke kode. <br></div></div><br><h1>  Inisialisasi dan login </h1><br>  Cara yang disarankan Google untuk mengaktifkan GAPI adalah dengan menempelkan kode berikut ke dalam HTML Anda: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://apis.google.com/js/api.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"this.onload=function(){}; gapi.load('client:auth2', initClient)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onreadystatechange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"if (this.readyState === 'complete') this.onload()"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Setelah memuat pustaka, fungsi <code>initClient</code> akan dipanggil, yang harus kita tulis sendiri.  Penampilannya yang khas adalah sebagai berikut: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gapi.client.init({ <span class="hljs-comment"><span class="hljs-comment">//   API apiKey: GOOGLE_API_KEY, //    clientId: GOOGLE_CLIENT_ID, // ,     Google Drive API v3 discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'], //    application data folder (. ) scope: 'https://www.googleapis.com/auth/drive.appfolder' }).then(() =&gt; { //    / (. ) gapi.auth2.getAuthInstance().isSignedIn.listen(onSignIn) //   initApp() }, error =&gt; { console.log('Failed to init GAPI client', error) //    initApp({showAlert: 'google-init-failed-alert'}) }) }</span></span></code> </pre> <br>  Untuk penyimpanan data, kita akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">folder Data Aplikasi</a> .  Keuntungannya dibandingkan folder biasa: <br><br><ol><li>  Pengguna tidak melihatnya secara langsung: file darinya tidak menyumbat ruang pribadinya, dan ia tidak dapat merusak data kami. </li><li>  Aplikasi lain tidak melihatnya dan tidak dapat merusaknya juga. </li><li>  Lingkup, yang disebutkan di atas, memberikan akses aplikasi ke sana, tetapi tidak memberikan akses ke file pengguna lainnya.  Artinya, kami tidak akan menakuti seseorang dengan permintaan akses ke data pribadinya. </li></ol><br>  Setelah inisialisasi sukses Google API, fungsi melakukan hal berikut: <br><br><ol><li>  Mulai menangkap peristiwa masuk / keluar - kemungkinan besar, ini harus selalu dilakukan. </li><li>  Menginisialisasi aplikasi.  Ini dapat dilakukan sebelum memuat dan menginisialisasi GAPI - seperti yang Anda inginkan.  Prosedur inisialisasi saya sedikit berbeda jika Google tidak tersedia.  Seseorang mungkin mengatakan bahwa ini tidak terjadi :) Tapi, pertama, Anda bisa pintar dengan kunci dan hak akses di masa depan.  Kedua, misalnya, di Cina, Google dilarang. </li></ol><br>  Masuk dan keluar hanya dilakukan: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isGapiLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gapi &amp;&amp; gapi.auth2 } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logIn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isGapiLoaded()) { <span class="hljs-comment"><span class="hljs-comment">//    Google    gapi.auth2.getAuthInstance().signIn() } } function logOut() { if (isGapiLoaded()) { gapi.auth2.getAuthInstance().signOut() } }</span></span></code> </pre> <br>  Anda akan menerima hasil masuk pada penangan <code>onSignIn</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLoggedIn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isGapiLoaded() &amp;&amp; gapi.auth2.getAuthInstance().isSignedIn.get() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSignIn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLoggedIn()) { <span class="hljs-comment"><span class="hljs-comment">//   } else { //   } //   .    "" }</span></span></code> </pre> <br>  Sayangnya, bekerja dengan file tidak begitu jelas. <br><br><h1>  Pembantu janji </h1><br>  GAPI tidak mengembalikan Janji normal.  Sebaliknya, antarmuka Thennable-nya sendiri digunakan, yang mirip dengan janji-janji, tetapi tidak cukup.  Oleh karena itu, untuk kenyamanan kerja (terutama menggunakan <code>async/await</code> ), kami akan membuat pembantu kecil: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">gapiCall, argObj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { gapiCall(argObj).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resp</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp &amp;&amp; (resp.status &lt; <span class="hljs-number"><span class="hljs-number">200</span></span> || resp.status &gt; <span class="hljs-number"><span class="hljs-number">299</span></span>)) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'GAPI call returned bad status'</span></span>, resp) reject(resp) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { resolve(resp) } }, err =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'GAPI call failed'</span></span>, err) reject(err) }) }) }</code> </pre> <br>  Fungsi ini mengambil metode dan parameter GAPI sebagai argumen pertama dan mengembalikan Janji.  Maka Anda akan melihat cara menggunakannya. <br><br><h1>  Bekerja dengan file </h1><br>  Anda harus selalu ingat bahwa <b>nama file di Google Drive tidak unik</b> .  Anda dapat membuat sejumlah file dan folder dengan nama yang sama.  Hanya pengenal yang unik. <br><blockquote>  Untuk tugas-tugas dasar, Anda tidak perlu bekerja dengan folder, jadi semua fungsi di bawah ini berfungsi dengan file di root folder Data Aplikasi.  Komentar menunjukkan apa yang perlu diubah untuk bekerja dengan folder.  Dokumentasi dari Google ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </blockquote><h2>  Buat file kosong </h2><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEmptyFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, mimeType</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resp = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> prom(gapi.client.drive.files.create, { <span class="hljs-attr"><span class="hljs-attr">resource</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: name, <span class="hljs-comment"><span class="hljs-comment">//     // mimeType = 'application/vnd.google-apps.folder' mimeType: mimeType || 'text/plain', //  'appDataFolder'   ID  parents: ['appDataFolder'] }, fields: 'id' }) //    —    return resp.result.id }</span></span></code> </pre> <br>  Fungsi asinkron ini membuat file kosong dan mengembalikan pengenalnya (string).  Jika file seperti itu sudah ada, file baru dengan nama yang sama akan dibuat dan ID-nya akan dikembalikan.  Jika Anda tidak menginginkan ini, Anda harus terlebih dahulu memeriksa apakah tidak ada file dengan nama yang sama (lihat di bawah). <br><blockquote>  Google Drive bukan basis data lengkap.  Misalnya, jika Anda ingin beberapa pengguna bekerja dari akun Google yang sama <b>secara bersamaan</b> dari perangkat yang berbeda, mungkin ada masalah dengan menyelesaikan konflik karena kurangnya transaksi.  Untuk tugas seperti itu, lebih baik tidak menggunakan Google Drive. </blockquote><h2>  Bekerja dengan konten file </h2><br>  GAPI (untuk JavaScript berbasis browser) tidak menyediakan metode untuk bekerja dengan konten file (sangat aneh, bukan?).  Sebagai gantinya, ada metode <code>request</code> umum (pembungkus tipis di atas permintaan AJAX sederhana). <br><br>  Melalui trial and error, saya sampai pada implementasi berikut: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fileId, content</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ,  ,     JSON return prom(gapi.client.request, { path: `/upload/drive/v3/files/${fileId}`, method: 'PATCH', params: {uploadType: 'media'}, body: typeof content === 'string' ? content : JSON.stringify(content) }) } async function download(fileId) { const resp = await prom(gapi.client.drive.files.get, { fileId: fileId, alt: 'media' }) // resp.body      // resp.result —    resp.body  JSON. //   ,  resp.result  false // ..    ,   return resp.result || resp.body }</span></span></code> </pre><br><h2>  Pencarian file </h2><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ret = [] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> token <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> resp = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> prom(gapi.client.drive.files.list, { <span class="hljs-comment"><span class="hljs-comment">//  'appDataFolder'   ID  spaces: 'appDataFolder', fields: 'files(id, name), nextPageToken', pageSize: 100, pageToken: token, orderBy: 'createdTime', q: query }) ret = ret.concat(resp.result.files) token = resp.result.nextPageToken } while (token) // :    [{id: '...', name: '...'}], //     return ret }</span></span></code> </pre> <br>  Fungsi ini, jika Anda tidak menentukan <code>query</code> , mengembalikan semua file di folder aplikasi (array objek dengan bidang <code>id</code> dan <code>name</code> ), diurutkan berdasarkan waktu pembuatan. <br><br>  Jika Anda menentukan string <code>query</code> (sintaksnya dijelaskan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ), itu hanya akan mengembalikan file yang cocok dengan kueri.  Misalnya, untuk memeriksa apakah file bernama <code>config.json</code> , Anda perlu melakukannya <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> find(<span class="hljs-string"><span class="hljs-string">'name = "config.json"'</span></span>)).length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// ()  }</span></span></code> </pre><br><h2>  Menghapus File </h2><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fileId</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> prom(gapi.client.drive.files.delete, { <span class="hljs-attr"><span class="hljs-attr">fileId</span></span>: fileId }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err.status === <span class="hljs-number"><span class="hljs-number">404</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> err } }</code> </pre> <br>  Fungsi ini menghapus file dengan ID dan mengembalikan <code>true</code> jika berhasil dihapus, dan <code>false</code> jika tidak ada file seperti itu. <br><br><h1>  Sinkronkan </h1><br>  Dianjurkan agar program bekerja terutama dengan <code>localStorage</code> , dan Google Drive hanya digunakan untuk menyinkronkan data dari <code>localStorage</code> . <br><br>  Berikut ini adalah strategi sinkronisasi konfigurasi sederhana: <br><br><ol><li>  Konfigurasi baru diunduh dari Google Drive dengan login, dan kemudian setiap 3 menit, menimpa salinan lokal; </li><li>  Perubahan lokal dituangkan ke Google Drive, menimpa apa yang ada di sana; </li><li>  <code>fileID</code> konfigurasi <code>fileID</code> -cache di <code>localStorage</code> untuk mempercepat pekerjaan dan mengurangi jumlah permintaan; </li><li>  Situasi yang ditangani dengan benar (salah) adalah ketika Google Drive memiliki beberapa file konfigurasi, dan ketika seseorang menghapus file konfigurasi kami atau merusaknya. </li><li>  Detail sinkronisasi tidak memengaruhi kode aplikasi lainnya.  Untuk bekerja dengan konfigurasi, Anda hanya menggunakan dua fungsi: <code>getConfig()</code> dan <code>saveConfig(newConfig)</code> . </li></ol><br>  Dalam aplikasi nyata, Anda mungkin ingin menerapkan penanganan konflik yang lebih fleksibel saat memuat / membongkar konfigurasi. <br><br><div class="spoiler">  <b class="spoiler_title">Lihat kode</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     const SYNC_PERIOD = 1000 * 60 * 3 // 3  //    const DEFAULT_CONFIG = { // ... } //  ID  ,      let configSyncTimeoutId async function getConfigFileId() { //  configFileId let configFileId = localStorage.getItem('configFileId') if (!configFileId) { //     Google Drive const configFiles = await find('name = "config.json"') if (configFiles.length &gt; 0) { //   (  )  configFileId = configFiles[0].id } else { //   configFileId = await createEmptyFile('config.json') } //  ID localStorage.setItem('configFileId', configFileId) } return configFileId } async function onSignIn() { //   / (. ) if (isLoggedIn()) { //   //  (  -?)    scheduleConfigSync(0) } else { //   //          //   config file ID localStorage.removeItem('configFileId') //  localStorage   ,    } } function getConfig() { let ret try { ret = JSON.parse(localStorage.getItem('config')) } catch(e) {} //    ,    return ret || {...DEFAULT_CONFIG} } async function saveConfig(newConfig) { //    ,     localStorage.setItem('config', JSON.stringify(newConfig)) if (isLoggedIn()) { //  config file ID const configFileId = await getConfigFileId() //     Google Drive upload(configFileId, newConfig) } } async function syncConfig() { if (!isLoggedIn()) { return } //  config file ID const configFileId = await getConfigFileId() try { //   const remoteConfig = await download(configFileId) if (!remoteConfig || typeof remoteConfig !== 'object') { //    ,   upload(configFileId, getConfig()) } else { //  ,    localStorage.setItem('config', JSON.stringify(remoteConfig)) } //  ,  localStorage   } catch(e) { if (e.status === 404) { // -   ,   fileID     localStorage.removeItem('configFileId') syncConfig() } else { throw e } } } function scheduleConfigSync(delay) { //   ,    if (configSyncTimeoutId) { clearTimeout(configSyncTimeoutId) } configSyncTimeoutId = setTimeout(() =&gt; { //      syncConfig() .catch(e =&gt; console.log('Failed to synchronize config', e)) .finally(() =&gt; scheduleSourcesSync()) }, typeof delay === 'undefined' ? SYNC_PERIOD : delay) } function initApp() { //      scheduleConfigSync() }</span></span></code> </pre><br></div></div><br><h1>  Kesimpulan </h1><br>  Menurut saya, penyimpanan data untuk situs web di Google Drive cocok untuk proyek kecil dan pembuatan prototipe.  Ini tidak hanya mudah diimplementasikan dan didukung, tetapi juga membantu mengurangi jumlah entitas yang tidak perlu di alam semesta.  Dan artikel saya, saya harap, akan membantu Anda menghemat waktu jika Anda memilih jalur ini. <br><br>  <b>PS</b> Kode proyek sebenarnya ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di GitHub</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Anda dapat</a> mencobanya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id440844/">https://habr.com/ru/post/id440844/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id440832/index.html">Snapdragon 855: Platform Mobile untuk 5G, AI, dan Augmented Reality</a></li>
<li><a href="../id440834/index.html">Konferensi DUMP-2019: kami mengundang Anda untuk berbicara di bagian DevOps dan Seluler</a></li>
<li><a href="../id440836/index.html">Perlindungan perangkat lunak terhadap penyalinan dan peretasan: metode dan strategi dasar</a></li>
<li><a href="../id440838/index.html">Bagaimana kami memilih sistem DLP (pengalaman praktis)</a></li>
<li><a href="../id440842/index.html">Buku “Bagaimana mengelola intelektual. Saya, kutu buku dan Geeks "</a></li>
<li><a href="../id440846/index.html">Timer kinerja</a></li>
<li><a href="../id440848/index.html">Model Core yang solid tanpa cangkang elektronik, yaitu Core sama dengan ukuran keseluruhan atom</a></li>
<li><a href="../id440850/index.html">Bahasa Inggris di India: tamasya bersejarah</a></li>
<li><a href="../id440852/index.html">Mengapa pemuda Amerika berpura-pura suka bekerja</a></li>
<li><a href="../id440854/index.html">Penambang Crypto menyusup ke Microsoft Store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>