<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÄ üíÜüèø üëö Combiner des projets dans diff√©rents centres de donn√©es üß§ ‚ôãÔ∏è üî†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous examinerons pourquoi l'approche traditionnelle de combinaison des r√©seaux locaux au niveau L2 est inefficace avec une augmentat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Combiner des projets dans diff√©rents centres de donn√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/436648/"><img src="https://habrastorage.org/webt/zy/ry/ey/zyryeyqpveem2dyaws3drxmvori.png"><br><br>  Dans cet article, nous examinerons pourquoi l'approche traditionnelle de combinaison des r√©seaux locaux au niveau L2 est inefficace avec une augmentation significative du nombre d'√©quipements, ainsi que les probl√®mes que nous avons pu r√©soudre dans le processus de combinaison de projets situ√©s sur diff√©rents sites. <br><br><h2>  Circuit L2 normal </h2><br>  √Ä mesure que l'infrastructure informatique se d√©veloppe dans le centre de donn√©es, les clients doivent combiner serveurs, stockage et pare-feu en un seul r√©seau.  Pour cela, Selectel sugg√®re initialement d'utiliser un r√©seau local. <br><br>  Le r√©seau local est organis√© comme un r√©seau "campus" classique au sein du m√™me centre de donn√©es, seuls les commutateurs d'acc√®s sont situ√©s directement dans les racks avec les serveurs.  Les commutateurs d'acc√®s sont en outre combin√©s en un seul commutateur de couche d'agr√©gation.  Chaque client peut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commander une connexion</a> au r√©seau local pour tout appareil qu'il loue ou place avec nous dans le centre de donn√©es. <br><a name="habracut"></a><br>  Pour organiser un r√©seau local, des commutateurs d'acc√®s et d'agr√©gation d√©di√©s sont utilis√©s afin que les probl√®mes du r√©seau Internet n'affectent pas le r√©seau local. <br><br><img src="https://habrastorage.org/webt/j5/a5/re/j5a5re8shkxu356b54gjja2-mbg.png" title="Exemple de sch√©ma pour un client"><br>  Peu importe dans quel rack se trouve le prochain serveur - Selectel combine les serveurs en un seul r√©seau local, et vous n'avez pas √† penser aux commutateurs ou √† l'emplacement du serveur.  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commander un serveur</a> lorsque cela est n√©cessaire et il sera connect√© au r√©seau local. <br><br>  L2 fonctionne tr√®s bien lorsque la taille du centre de donn√©es est petite, lorsque tous les racks ne sont pas pleins.  Mais √† mesure que le nombre de racks, de serveurs dans les racks, de commutateurs, de clients augmente, le circuit devient beaucoup plus difficile √† entretenir. <br><br><img src="https://habrastorage.org/webt/tg/kw/im/tgkwimba1eybjn6vngl8yohqsm0.png" title="Exemple de sch√©ma pour plusieurs clients"><br>  Les serveurs d'un client peuvent √™tre situ√©s dans plusieurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">centres de donn√©es</a> pour garantir la tol√©rance aux catastrophes ou s'il est impossible de placer le serveur dans un centre de donn√©es existant (par exemple, tous les racks et tous les emplacements sont occup√©s).  Entre plusieurs centres de donn√©es, la connectivit√© est √©galement n√©cessaire - entre les serveurs d'un r√©seau local. <br><br>  √Ä mesure que le nombre de centres de donn√©es, de racks, de serveurs augmente, le circuit devient plus compliqu√©.  Dans un premier temps, la connectivit√© entre les serveurs de diff√©rents centres de donn√©es s'est effectu√©e simplement au niveau des commutateurs d'agr√©gation utilisant la technologie VLAN. <br><br><img src="https://habrastorage.org/webt/dj/jd/rf/djjdrfihfysh2jo3tblzpa4evmk.png" title="Un exemple de sch√©ma pour un seul client dans plusieurs centres de donn√©es"><br>  Mais l'espace d'identification des VLAN est tr√®s limit√© (4095 ID de VLAN).  Ainsi, pour chaque centre de donn√©es, vous devez utiliser votre propre ensemble de VLAN, ce qui r√©duit le nombre d'identifiants possibles pouvant √™tre utilis√©s entre les centres de donn√©es. <br><br><h2>  Probl√®mes L2 </h2><br>  Lors de l'utilisation d'un sch√©ma au niveau L2 √† l'aide d'un VLAN, un fonctionnement incorrect de l'un des serveurs du centre de donn√©es peut entra√Æner des interruptions dans la fourniture de services sur d'autres serveurs.  Les probl√®mes les plus courants sont les suivants: <br><br><ul><li> Probl√®mes avec STP (Spanning-Tree Protocol) </li><li>  Probl√®mes avec Broadcast Storms </li><li>  Probl√®mes avec un traitement de multidiffusion incorrect </li><li>  Facteur humain (transfert de lien, transfert de VLAN) </li><li>  Probl√®mes d'organisation de r√©servation pour L2 </li><li>  Probl√®mes avec le trafic unicast inconnu </li><li>  Probl√®mes avec le nombre d'adresses MAC </li></ul><br>  Les probl√®mes avec STP sont souvent li√©s aux param√®tres des serveurs clients ou de l'√©quipement client.  Contrairement aux points d'√©change de trafic populaires, nous ne pouvons pas filtrer compl√®tement STP sur les ports d'acc√®s et les ports de d√©sactivation lorsqu'une PDU STP arrive.  Chez STP, un certain nombre de fabricants d'√©quipements de r√©seau impl√©mentent des fonctionnalit√©s de base des commutateurs de centre de donn√©es comme la d√©tection de boucles dans le r√©seau. <br><br>  Si STP ne fonctionne pas correctement c√¥t√© client, le domaine STP entier d'au moins un commutateur d'acc√®s peut √™tre affect√©.  L'utilisation d'extensions STP, telles que MSTP, n'est pas non plus une solution, car le nombre de ports, VLAN, commutateurs d√©passe souvent l'√©volutivit√© architecturale du protocole STP. <br><br><h3>  Diffusion </h3><br>  Le r√©seau du centre de donn√©es peut √™tre construit sur des appareils de diff√©rents fabricants.  Parfois, m√™me les diff√©rences dans la version du logiciel du commutateur sont suffisantes pour que les commutateurs g√®rent STP diff√©remment.  Ainsi, par exemple, dans le centre de donn√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dubrovka 3</a> , il y a 280 racks, ce qui d√©passe le nombre maximal possible de commutateurs dans un domaine STP. <br><br>  Avec l'utilisation g√©n√©ralis√©e de STP dans un tel r√©seau, le temps de r√©ponse √† tout changement, en particulier, la simple activation ou d√©sactivation du port, d√©passera tous les seuils d'attente.  Vous ne voulez pas que lorsque l'un des clients active le port, votre connectivit√© r√©seau disparaisse pendant plusieurs minutes? <br><br>  Les probl√®mes de trafic de diffusion surviennent souvent √† la fois en raison d'actions incorrectes sur le serveur (par exemple, la cr√©ation d'un pont entre plusieurs ports de serveur), ainsi qu'en raison d'une configuration logicielle incorrecte sur les serveurs.  Nous essayons de niveler les probl√®mes possibles avec la quantit√© de trafic de diffusion qui arrive √† notre r√©seau.  Mais nous pouvons le faire sur un port de connexion de serveur, et si 5 serveurs sont inclus dans un commutateur, chacun ne d√©passant pas les seuils d√©finis, alors ensemble, ils peuvent g√©n√©rer suffisamment de trafic pour d√©clencher le contr√¥le sur le commutateur d'agr√©gation.  D'apr√®s notre propre pratique, les probl√®mes li√©s √† une temp√™te de diffusion c√¥t√© serveur peuvent √™tre caus√©s par une d√©faillance sp√©cifique de la carte r√©seau du serveur. <br><br>  En prot√©geant l'int√©gralit√© du r√©seau, le commutateur d'agr√©gation ¬´mettra¬ª le port sur lequel l'anomalie du r√©seau s'est produite.  Malheureusement, cela entra√Ænera l'inop√©rabilit√© des cinq serveurs √† l'origine de cet incident, ainsi que l'inop√©rabilit√© d'autres serveurs (jusqu'√† plusieurs racks dans le centre de donn√©es). <br><br><h3>  Multidiffusion </h3><br>  Les probl√®mes de traitement incorrect du trafic de multidiffusion sont des probl√®mes tr√®s sp√©cifiques qui surviennent dans le complexe en raison d'un fonctionnement incorrect du logiciel sur le serveur et du logiciel sur le commutateur.  Par exemple, Corosync est configur√© en mode multidiffusion entre plusieurs serveurs.  L'√©change de Hello-paquets se fait r√©guli√®rement en petits volumes.  Mais dans certains cas, les serveurs sur lesquels Corosync est install√© peuvent transmettre un grand nombre de paquets.  Ce volume n√©cessite d√©j√† soit une configuration sp√©ciale des commutateurs, soit l'utilisation des m√©canismes de traitement appropri√©s (jointure IGMP et autres).  En cas de mauvais fonctionnement des m√©canismes ou lorsque des seuils sont d√©clench√©s, des interruptions de service peuvent affecter d'autres clients.  Bien s√ªr, moins il y a de clients sur le commutateur, moins il est probable que des probl√®mes d'un autre client se produisent. <br><br>  Le facteur humain est un type de probl√®me plut√¥t impr√©vu qui peut survenir lors de l'utilisation d'√©quipements r√©seau.  Lorsque l'administrateur r√©seau est seul et qu'il construit son travail avec comp√©tence, documente les actions et r√©fl√©chit aux cons√©quences de ses actions, la probabilit√© d'erreur est alors assez faible.  Mais lorsque la quantit√© d‚Äô√©quipement en fonctionnement du centre de donn√©es augmente, quand il y a beaucoup d‚Äôemploy√©s, quand il y a beaucoup de t√¢ches, alors une approche compl√®tement diff√©rente de l‚Äôorganisation du travail est n√©cessaire. <br><br>  Certains types d'actions typiques sont automatis√©s pour √©viter les erreurs humaines, mais de nombreux types d'actions ne peuvent pas √™tre automatis√©s pour le moment, ou le prix de l'automatisation de telles actions est d√©raisonnablement √©lev√©.  Par exemple, la commutation physique des cordons de brassage sur un panneau de brassage, la connexion de nouveaux liens, le remplacement de liens existants.  Tout ce qui concerne le contact physique avec SCS.  Oui, il existe des panneaux de brassage qui permettent de commuter √† distance, mais ils sont tr√®s chers, n√©cessitent beaucoup de travail pr√©paratoire et sont tr√®s limit√©s dans leurs capacit√©s. <br><br>  Aucun panneau de brassage automatique ne posera un nouveau c√¢ble si n√©cessaire.  Vous pouvez faire une erreur lors de la configuration d'un commutateur ou d'un routeur.  Indiquez le mauvais num√©ro de port, le num√©ro VLAN, √† sceller lorsque vous entrez une valeur num√©rique.  Lorsque vous sp√©cifiez des param√®tres suppl√©mentaires, ne tenez pas compte de leur influence sur la configuration existante.  Avec la complexit√© croissante du sch√©ma, compliquant le sch√©ma de redondance (par exemple, en raison du sch√©ma actuel atteignant la limite de mise √† l'√©chelle), la probabilit√© d'erreurs humaines augmente.  Tout le monde peut avoir une erreur humaine, que l'appareil soit √† l'√©tape de configuration, un serveur, un commutateur, un routeur ou une sorte de p√©riph√©rique de transit. <br><br>  Organiser la redondance sur L2, √† premi√®re vue, semble √™tre une t√¢che simple pour les petits r√©seaux.  Le cours Cisco ICND couvre les bases de l'utilisation de STP en tant que protocole initialement con√ßu pour fournir une redondance L2.  STP a beaucoup de restrictions qui sont appel√©es ¬´par conception¬ª dans ce protocole.  Nous ne devons pas oublier que tout domaine STP a une "largeur" ‚Äã‚Äãtr√®s limit√©e, c'est-√†-dire que le nombre de p√©riph√©riques dans un domaine STP est assez petit par rapport au nombre de racks dans le centre de donn√©es.  Le protocole STP dans sa version originale divise les liens en utilis√© et sauvegarde, ce qui ne permet pas une utilisation compl√®te des liaisons montantes pendant le fonctionnement normal. <br><br>  L'utilisation d'autres protocoles de r√©servation L2 impose ses limites.  Par exemple, ERPS (Ethernet Ring Protection Switching) - pour la topologie physique utilis√©e, pour le nombre de sonneries sur un appareil, pour l'utilisation de toutes les liaisons.  L'utilisation d'autres protocoles implique, en r√®gle g√©n√©rale, des modifications propri√©taires de diff√©rents fabricants ou limite la construction du r√©seau √† une technologie s√©lectionn√©e (par exemple, l'usine TRILL / SPBm utilisant l'√©quipement Avaya). <br><br><h3>  Unicast inconnu </h3><br>  Je voudrais surtout souligner le sous-type de probl√®mes avec le trafic unicast inconnu.  Qu'est ce que c'est  Trafic destin√© √† une adresse IP sp√©cifique via L3, mais diffus√© sur le r√©seau via L2, c'est-√†-dire qu'il est transmis √† tous les ports appartenant √† ce VLAN.  Cette situation peut se produire pour un certain nombre de raisons, par exemple, lors de la r√©ception de DDoS vers une adresse IP inoccup√©e.  Ou si, lors d'une faute de frappe dans la configuration du serveur, une adresse qui n'existe pas sur le r√©seau a √©t√© sp√©cifi√©e comme sauvegarde, et sur le serveur il y a historiquement un enregistrement ARP statique √† cette adresse.  Unicast inconnu appara√Æt lorsque toutes les entr√©es dans les tables ARP sont pr√©sentes, mais en l'absence de l'adresse MAC du r√©cepteur dans les tables de commutation des commutateurs de transit. <br><br>  Par exemple, le port derri√®re lequel se trouve l'h√¥te r√©seau avec l'adresse donn√©e passe tr√®s souvent √† l'√©tat d√©sactiv√©.  Ce type de trafic est limit√© par les commutateurs de transit et est souvent servi de la m√™me mani√®re que la diffusion ou la multidiffusion.  Mais contrairement √† eux, le trafic unicast inconnu peut √™tre initi√© "√† partir d'Internet", et pas seulement √† partir du r√©seau du client.  Le risque de trafic unicast inconnu est particuli√®rement √©lev√© lorsque les r√®gles de filtrage sur les routeurs frontaliers permettent l'usurpation d'adresses IP de l'ext√©rieur. <br><br>  M√™me le simple nombre d'adresses MAC peut parfois √™tre un probl√®me.  Il semblerait qu'avec une taille de centre de donn√©es de 200 racks, 40 serveurs par rack, il est peu probable que le nombre d'adresses MAC d√©passe largement le nombre de serveurs dans le centre de donn√©es.  Mais ce n'est plus une affirmation vraie, car l'un des syst√®mes de virtualisation peut √™tre lanc√© sur les serveurs, et chaque machine virtuelle peut √™tre repr√©sent√©e par son adresse MAC, voire plusieurs (lors de l'√©mulation de plusieurs cartes r√©seau dans une machine virtuelle, par exemple).  Au total, nous pouvons obtenir plus de plusieurs milliers d'adresses MAC l√©gitimes √† partir d'un rack sur 40 serveurs. <br><br>  Un tel nombre d'adresses MAC peut affecter la pl√©nitude de la table de commutation sur certains mod√®les de commutateurs.  De plus, pour certains mod√®les de commutateurs, lors du remplissage de la table de commutation, le hachage est utilis√© et certaines adresses MAC peuvent provoquer des collisions de hachage conduisant √† l'apparition d'un trafic de monodiffusion inconnu.  La recherche al√©atoire d'adresses MAC sur un serveur lou√© √† une vitesse de, disons, 4 000 adresses par seconde, peut entra√Æner un d√©bordement de la table de commutation sur le commutateur d'acc√®s.  Naturellement, les commutateurs appliquent des restrictions sur le nombre d'adresses MAC qui peuvent √™tre apprises sur les ports de commutateur, mais selon la mise en ≈ìuvre sp√©cifique de ce m√©canisme, les donn√©es peuvent √™tre interpr√©t√©es de diff√©rentes mani√®res. <br><br>  Encore une fois, l'envoi de trafic √† l'adresse MAC filtr√©e par ce m√©canisme entra√Æne l'apparition d'un trafic unicast inconnu.  La chose la plus d√©sagr√©able dans cette situation est que les interrupteurs sont rarement test√©s par le fabricant pour l'auto-gu√©rison apr√®s les cas avec d√©bordement de la table de commutation.  Un seul d√©bordement de la table, provoqu√©, par exemple, par une erreur d'un client dans les param√®tres hping ou dans l'√©criture d'un script qui surveille son infrastructure, peut entra√Æner un red√©marrage du commutateur et une interruption de la communication pour tous les serveurs situ√©s dans le rack.  Si un tel d√©bordement se produit sur le commutateur de niveau d'agr√©gation, le red√©marrage du commutateur peut entra√Æner une interruption de 15 minutes de l'ensemble du r√©seau local du centre de donn√©es. <br><br>  Je voudrais souligner que l'utilisation de L2 n'est justifi√©e que pour des cas limit√©s et impose de nombreuses restrictions.  La taille du segment, le nombre de segments L2 - ce sont tous les param√®tres qui doivent √™tre √©valu√©s chaque fois que vous ajoutez un nouveau VLAN avec la connectivit√© L2.  Et plus les segments L2 sont petits, plus le r√©seau est simple et, par cons√©quent, plus fiable. <br><br><h2>  Cas d'utilisation typiques de L2 </h2><br>  Comme d√©j√† mentionn√©, avec le d√©veloppement progressif des infrastructures dans un centre de donn√©es, un r√©seau local L2 est utilis√©.  Malheureusement, cette utilisation est √©galement impliqu√©e dans le d√©veloppement de projets dans un autre centre de donn√©es ou dans une autre technologie (par exemple, des machines virtuelles dans le cloud). <br><br><h3>  Liaison front-end et back-end, sauvegarde </h3><br>  En r√®gle g√©n√©rale, l'utilisation d'un r√©seau local commence par la s√©paration des fonctionnalit√©s des services frontaux et principaux, en allouant le SGBD √† un serveur distinct (pour am√©liorer les performances, pour s√©parer le type de syst√®me d'exploitation sur le serveur d'applications et le SGBD).  Initialement, l'utilisation de L2 √† ces fins semble justifi√©e, dans le segment il n'y a que quelques serveurs, souvent ils sont m√™me situ√©s dans le m√™me rack. <br><br><img src="https://habrastorage.org/webt/je/gf/1p/jegf1phbpite5kxigvt3vxmyj6a.png" title="Segment L2 simple"><br>  Les serveurs sont inclus dans un VLAN, dans un ou plusieurs commutateurs.  √Ä mesure que la quantit√© d'√©quipement augmente, de plus en plus de nouveaux serveurs sont inclus dans les commutateurs de nouveaux racks du centre de donn√©es, √† partir desquels le domaine L2 commence √† se d√©velopper en largeur. <br><br><img src="https://habrastorage.org/webt/j5/a5/re/j5a5re8shkxu356b54gjja2-mbg.png" title="Extension de segment L2"><br>  De nouveaux serveurs apparaissent, notamment des serveurs de base de donn√©es de sauvegarde, des serveurs de sauvegarde, etc.  Tant que le projet vit dans un centre de donn√©es, les probl√®mes de mise √† l'√©chelle ne se posent g√©n√©ralement pas.  Les d√©veloppeurs d'applications s'habituent simplement au fait que sur le prochain serveur du r√©seau local, l'adresse IP ne change que dans le dernier octet, et vous n'avez pas besoin d'√©crire de r√®gles de routage distinctes. <br><br>  Les d√©veloppeurs sont invit√©s √† appliquer un sch√©ma similaire lorsque le projet se d√©veloppe, lorsque les serveurs suivants sont d√©j√† lou√©s dans un autre centre de donn√©es ou lorsqu'une partie du projet se d√©place vers les machines virtuelles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le cloud</a> .  Dans l'image, tout semble tr√®s simple et beau: <br><br><img src="https://habrastorage.org/webt/bx/2y/ho/bx2yholhikhhkjpdaavttkfgucm.png" title="Un exemple de combinaison de deux sites en utilisant L2"><br>  Il semblerait que vous ayez juste besoin de connecter deux commutateurs d'agr√©gation dans DC1 et DC2 avec un VLAN.  Mais qu'est-ce qui se cache derri√®re cette simple action? <br><br><h3>  R√©servation de ressources </h3><br>  Tout d'abord, nous augmentons la largeur du domaine L2, de sorte que tous les probl√®mes potentiels du r√©seau local de DC1 peuvent survenir dans DC2.  Qui aimera que ses serveurs soient situ√©s dans DC2, et l'incident li√© √† l'inaccessibilit√© du r√©seau local se produira en raison d'actions incorrectes √† l'int√©rieur de DC1? <br><br>  Deuxi√®mement, vous devez prendre soin de sauvegarder ce VLAN.  Le commutateur d'agr√©gation dans chaque centre de donn√©es est le point de d√©faillance.  Le c√¢ble entre les centres de donn√©es est un autre point de d√©faillance.  Chaque point de d√©faillance doit √™tre r√©serv√©.  Deux commutateurs d'agr√©gation, deux c√¢bles des commutateurs d'agr√©gation aux commutateurs d'acc√®s, deux c√¢bles entre les centres de donn√©es ... Chaque fois que le nombre de composants augmente, et le circuit devient plus compliqu√©. <br><br><img src="https://habrastorage.org/webt/nq/ku/ws/nqkuws41ips807benbzzemxfzry.png" title="Exemple de sch√©ma L2 redondant"><br>  La complexit√© du sch√©ma est due √† la n√©cessit√© de r√©server chaque √©l√©ment du syst√®me.  Pour une sauvegarde compl√®te des appareils et des liens, vous devez dupliquer presque tous les √©l√©ments.  Sur un r√©seau aussi important, il n'est plus possible d'utiliser STP pour organiser les sauvegardes.  Il serait possible de pr√©senter tous les √©l√©ments du r√©seau, en particulier les commutateurs d'acc√®s, en tant que composants du nuage MPLS, puis la redondance serait obtenue en raison de la fonctionnalit√© du protocole MPLS. <br><br>  Mais les appareils MPLS sont g√©n√©ralement deux fois plus chers que les appareils non MPLS.  Et il convient de noter que le commutateur MPU en 1U, qui a un bon degr√© d'√©volutivit√©, la mise en ≈ìuvre de la fonctionnalit√© MPLS compl√®te dans le plan de contr√¥le, dans la pratique, n'existait que r√©cemment.  En cons√©quence, je veux me d√©barrasser ou minimiser l'impact des probl√®mes L2 sur le r√©seau existant, mais en m√™me temps garder la possibilit√© de r√©server des ressources. <br><br><h2>  Transition vers L3 </h2><br>  Si chaque lien du r√©seau est repr√©sent√© comme un segment IP distinct et chaque p√©riph√©rique comme un routeur distinct, nous n'avons pas besoin de redondance au niveau L2.  La redondance des liaisons et des routeurs est assur√©e par des protocoles de routage dynamique et une redondance de routage dans le r√©seau. <br><br>  √Ä l'int√©rieur du centre de donn√©es, nous pouvons enregistrer les sch√©mas d'interaction entre les serveurs existants via L2, et l'acc√®s aux serveurs dans un autre centre de donn√©es se fera via L3. <br><br><img src="https://habrastorage.org/webt/hc/2q/n4/hc2qn4wcnecwsrrkxh-daualss8.png" title="Connectivit√© du site avec L3"><br>  Ainsi, les centres de donn√©es sont interconnect√©s par la connectivit√© L3.  Autrement dit, il est √©mul√© qu'un routeur est install√© entre les centres de donn√©es (en fait, plusieurs, pour la sauvegarde).  Cela vous permet de diviser les domaines L2 entre les centres de donn√©es, d'utiliser votre propre VLAN dans chaque centre de donn√©es et de communiquer entre eux.  Pour chaque client, vous pouvez utiliser des plages d'adresses IP r√©p√©titives, les r√©seaux sont compl√®tement isol√©s les uns des autres et vous ne pouvez pas acc√©der au r√©seau d'un autre client √† partir du r√©seau d'un client (sauf lorsque les deux clients acceptent une telle connexion). <br><br>  Nous vous recommandons d'utiliser des segments IP de l'adressage 10.0.0.0/8 pour les r√©seaux locaux.  Pour le premier centre de donn√©es, le r√©seau sera, par exemple, 10.0.1.0/24, pour le second - 10.0.2.0/24.  Selectel sur le routeur prescrit l'adresse IP de ce sous-r√©seau.  En r√®gle g√©n√©rale, les adresses .250-.254 sont r√©serv√©es aux p√©riph√©riques r√©seau Selectel, et une adresse .254 sert de passerelle vers d'autres r√©seaux locaux.  L'itin√©raire est attribu√© √† tous les appareils de tous les centres de donn√©es: <br><br> <code>route add 10.0.0.0 mask 255.0.0.0 gw 10.0.x.254</code> <br> <br>  O√π x est le num√©ro du centre de donn√©es.  En raison de cette route, les serveurs des centres de donn√©es se ¬´voient¬ª par routage. <br><br><img src="https://habrastorage.org/webt/hf/x6/h1/hfx6h13labuqr97rfirrzwtw8nk.png" title="Exemple de routage pour combiner deux sites sur L3"><br>  La pr√©sence d'un tel itin√©raire simplifie la mise √† l'√©chelle du sch√©ma dans le cas, par exemple, de l'apparition d'un troisi√®me centre de donn√©es.  Ensuite, pour les serveurs du troisi√®me centre de donn√©es, les adresses IP de la plage suivante, 10.0.3.0/24, sont enregistr√©es, sur le routeur - l'adresse 10.0.3.254. <br><br><img src="https://habrastorage.org/webt/r_/lg/n5/r_lgn5-xrch-wfcytnqvyy7ujiy.png" title="Exemple de routage pour combiner trois sites sur L3"><br>  Une caract√©ristique distinctive de la mise en ≈ìuvre d'un tel syst√®me est qu'il ne n√©cessite pas de r√©servation suppl√©mentaire en cas de d√©faillance du centre de donn√©es ou des canaux de communication externes.  Ainsi, par exemple, si le centre de donn√©es 1 tombe en panne, la connexion entre le centre de donn√©es 2 et le centre de donn√©es 3 est compl√®tement pr√©serv√©e, et lors de la mise en ≈ìuvre du sch√©ma avec le flux L2 entre les centres de donn√©es via l'un d'eux, comme dans la figure: <br><br><img src="https://habrastorage.org/webt/dj/jd/rf/djjdrfihfysh2jo3tblzpa4evmk.png" title="Op√©ration de routage lors de l'enregistrement des sch√©mas L2"><br>  La connexion entre le centre de donn√©es 2 et le centre de donn√©es 3 d√©pend de l'efficacit√© du centre de donn√©es 1. Ou bien, l'organisation de liaisons suppl√©mentaires et l'utilisation de sch√©mas de r√©servation L2 complexes sont n√©cessaires.  Et tout en enregistrant le sch√©ma L2, l'ensemble du r√©seau est toujours tr√®s sensible aux commutations incorrectes, √† la formation de boucles de commutation, √† diverses temp√™tes de trafic et √† d'autres probl√®mes. <br><br><h3>  Segments L3 dans les projets </h3><br>  En plus d'utiliser diff√©rents segments L3 dans diff√©rents centres de donn√©es, il est logique d'allouer un r√©seau L3 distinct pour les serveurs de diff√©rents projets, souvent r√©alis√©s √† l'aide de technologies diff√©rentes.  Par exemple, des serveurs mat√©riels dans le centre de donn√©es dans un sous-r√©seau IP, des serveurs virtuels dans le m√™me centre de donn√©es, mais dans le cloud VMware, dans un autre sous-r√©seau IP, certains serveurs li√©s √† la mise en sc√®ne dans le troisi√®me sous-r√©seau IP .  Ensuite, des erreurs al√©atoires dans l'un des segments ne conduisent pas √† une panne compl√®te de tous les serveurs inclus dans le r√©seau local. <br><br><img src="https://habrastorage.org/webt/v3/zi/gd/v3zigd00-7klicdt31likdem460.png" title="Segmentation des r√©seaux de diff√©rents projets au niveau L3"><br><h2>  R√©servation de routeur </h2><br>  Tout cela est impressionnant, mais il y a un seul point d'√©chec entre les projets - c'est le routeur.  Que faire dans ce cas?  En fait, le routeur n'est pas seul.  Deux routeurs sont allou√©s pour chaque centre de donn√©es et pour chaque client, ils forment Virtual IP .254 en utilisant le protocole VRRP. <br><br>  L'utilisation de VRRP entre deux appareils adjacents avec un segment L2 commun est justifi√©e.  Pour les centres de donn√©es g√©ographiquement distribu√©s, diff√©rents routeurs sont utilis√©s et MPLS est organis√© entre eux.  Ainsi, chaque client se connectant au r√©seau local de cette mani√®re est connect√© √† un L3VPN distinct con√ßu pour lui sur ces routeurs MPLS.  Et le sch√©ma, en approximation de la r√©alit√©, ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/9y/ae/s8/9yaes8vvilol5-zrhikhychdvs4.png" title="Organisation de r√©servation"><br>  L'adresse de passerelle pour chaque segment .254 est r√©serv√©e par VRRP entre les deux routeurs. <br><br><h2>  Conclusion </h2><br>  En r√©sumant tout ce qui pr√©c√®de - le changement du type de r√©seau local de L2 √† L3 nous a permis de maintenir la capacit√© de mise √† l'√©chelle, a augment√© le niveau de fiabilit√© et de tol√©rance aux pannes, et nous a √©galement permis de mettre en ≈ìuvre des plans de redondance suppl√©mentaires.  De plus, cela a contourn√© les restrictions et les ¬´pi√®ges¬ª existants de L2. <br><br>  √Ä mesure que les projets et les centres de donn√©es se d√©veloppent, les solutions standard existantes atteignent leur limite d'√©volutivit√©.  Cela signifie qu'ils ne sont plus adapt√©s √† une r√©solution efficace des probl√®mes.  Les exigences de fiabilit√© et de stabilit√© du syst√®me dans son ensemble sont en constante augmentation, ce qui √† son tour affecte le processus de planification.  Il est important de prendre en compte le fait que des pr√©visions de croissance optimistes doivent √™tre prises en compte afin qu‚Äô√† l‚Äôavenir il n‚Äôexiste aucun syst√®me qui ne puisse pas √™tre mis √† l‚Äô√©chelle. <br><br>  Dites-nous - utilisez-vous d√©j√† L3VPN?  Rendez-vous dans les commentaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436648/">https://habr.com/ru/post/fr436648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436638/index.html">Redistribution des fen√™tres entre les moniteurs apr√®s s'√™tre r√©veill√© du mode veille</a></li>
<li><a href="../fr436640/index.html">Mon exp√©rience de la publicit√© et du d√©veloppement d'applications Android et iOS</a></li>
<li><a href="../fr436642/index.html">Ticket to Ride.Europe - √©tapes modestes dans l'arithm√©tique du jeu</a></li>
<li><a href="../fr436644/index.html">Symboles et modules synth√©tiques (WinDbg / DbgEng)</a></li>
<li><a href="../fr436646/index.html">Translucide sur Android et ajuster</a></li>
<li><a href="../fr436650/index.html">3 strat√©gies de mon√©tisation d'applications gagnantes en 2019</a></li>
<li><a href="../fr436652/index.html">MPS 2018.3: plans de g√©n√©ration, am√©liorations du langage d'assemblage et de packaging et du langage de l'√©diteur, interface mise √† jour</a></li>
<li><a href="../fr436654/index.html">D√©veloppement d'une √©quipe pour interroger les donn√©es de la base de donn√©es - partie 4, conclusion</a></li>
<li><a href="../fr436656/index.html">Automatisation pour les ind√©pendants: comment int√©grer la fiscalit√© √† un projet informatique</a></li>
<li><a href="../fr436658/index.html">L'avenir du commerce de d√©tail: les principales tendances num√©riques bas√©es sur NRF Retail's Big Show 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>