<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😴 💆🏼 🕓 DIY: cara kami mengotomatiskan pemantauan gudang 🏇🏻 ♍️ 👶🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="X5 mengelola 43 pusat distribusi dan 4.029 truk sendiri, mereka menyediakan pasokan produk tanpa gangguan di 15.752 toko. Dalam artikel ini saya akan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DIY: cara kami mengotomatiskan pemantauan gudang</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/478872/"> X5 mengelola 43 pusat distribusi dan 4.029 truk sendiri, mereka menyediakan pasokan produk tanpa gangguan di 15.752 toko.  Dalam artikel ini saya akan berbagi pengalaman membuat dari awal sistem interaktif untuk memantau acara gudang.  Informasi ini akan berguna untuk logistik perusahaan dagang dengan puluhan pusat distribusi yang mengelola berbagai macam produk. <br><br><img src="https://habrastorage.org/webt/n9/vj/a8/n9vja8bvwihda94_ccnjymzg_ee.jpeg"><br><a name="habracut"></a><br>  Sebagai aturan, konstruksi pemantauan dan sistem manajemen proses bisnis dimulai dengan pemrosesan pesan dan insiden.  Pada saat yang sama, momen teknologi penting terlewatkan terkait dengan kemungkinan mengotomatiskan fakta terjadinya peristiwa bisnis dan merekam insiden.  Sebagian besar sistem bisnis kelas WMS, TMS, dll., Memiliki alat bawaan untuk memantau proses mereka sendiri.  Tetapi, jika ini adalah sistem dari pabrikan yang berbeda atau fungsi pemantauan tidak cukup berkembang, Anda harus memesan perbaikan yang mahal atau melibatkan konsultan khusus untuk pengaturan tambahan. <br><br>  Pertimbangkan suatu pendekatan di mana kita hanya memerlukan sebagian kecil dari konsultasi terkait dengan penentuan sumber (tabel) untuk mendapatkan indikator dari sistem. <br><br>  Kekhususan gudang kami terletak pada kenyataan bahwa beberapa sistem manajemen gudang (WMS Exceed) beroperasi pada kompleks logistik yang sama.  Gudang dibagi sesuai dengan kategori penyimpanan barang (kering, alkohol, beku, dll.) Tidak hanya secara logis.  Dalam satu kompleks logistik adalah beberapa bangunan gudang yang terpisah, operasi pada masing-masing dikelola oleh WMS mereka sendiri. <br><br><img src="https://habrastorage.org/webt/hh/nh/za/hhnhza-jfuaimoyj9zzo3_fc-cu.jpeg"><br><br>  Untuk membentuk gambaran umum tentang proses yang terjadi di gudang, manajer menganalisis laporan masing-masing WMS beberapa kali sehari, memproses pesan dari operator gudang (penerima, pemetik, penumpuk) dan merangkum indikator operasi aktual untuk ditampilkan di papan informasi. <br><br>  Untuk menghemat waktu manajer, kami memutuskan untuk mengembangkan sistem yang tidak mahal untuk pengendalian operasional acara gudang.  Sistem baru, selain menampilkan indikator "panas" dari pekerjaan operasional proses gudang, juga harus membantu manajer dalam memperbaiki insiden dan tugas pemantauan untuk menghilangkan penyebab yang mempengaruhi indikator yang diberikan.  Setelah melakukan audit umum arsitektur TI perusahaan, kami menyadari bahwa bagian-bagian tertentu dari sistem yang diperlukan sudah ada di lanskap kami dan bagi mereka ada pemeriksaan pengaturan dan layanan dukungan yang diperlukan.  Tetap hanya untuk mengurangi keseluruhan konsep menjadi solusi arsitektur tunggal dan mengevaluasi ruang lingkup pengembangan. <br><br>  Setelah menilai jumlah pekerjaan yang perlu dilakukan untuk membangun sistem baru, diputuskan untuk membagi proyek menjadi beberapa tahap: <br><br><ol><li>  Pengumpulan indikator pada proses gudang, visualisasi dan kontrol indikator dan penyimpangan </li><li>  Otomatisasi standar proses dan pendaftaran aplikasi dalam layanan layanan bisnis untuk penyimpangan </li><li>  Pemantauan proaktif dengan peramalan beban dan membuat rekomendasi kepada manajer. </li></ol><br>  Pada tahap pertama, sistem harus mengumpulkan potongan data operasional yang disiapkan dari semua kompleks WMS.  Membaca berlangsung hampir dalam waktu nyata (interval kurang dari 5 menit).  Kuncinya adalah bahwa data harus diperoleh dari DBMS dari beberapa lusin gudang ketika menyebarkan sistem ke seluruh jaringan.  Data operasional yang diterima diproses oleh logika inti sistem untuk menghitung penyimpangan dari indikator yang direncanakan dan menghitung statistik.  Data yang diproses dengan cara ini harus ditampilkan di tablet manajer atau di papan informasi gudang dalam bentuk grafik dan diagram yang jelas. <br><br><img src="https://habrastorage.org/webt/ng/wx/hs/ngwxhslq4vhztxuvfxbid1jrjcu.jpeg"><br><br>  Ketika memilih sistem yang cocok untuk implementasi uji coba tahap pertama, kami memilih Zabbix.  Sistem ini sudah digunakan untuk memantau kinerja TI sistem gudang.  Dengan menambahkan instalasi terpisah untuk mengumpulkan metrik bisnis untuk operasi gudang, Anda bisa mendapatkan gambaran menyeluruh tentang kesehatan gudang. <br><br>  Arsitektur umum sistem adalah seperti yang ditunjukkan pada gambar. <br><br><img src="https://habrastorage.org/webt/ae/hw/ai/aehwaikaxfqux5e74ycreykdh5y.png"><br><br>  Setiap instance WMS didefinisikan sebagai host untuk sistem pemantauan.  Metrik dikumpulkan oleh server pusat di jaringan pusat data dengan menjalankan skrip dengan kueri SQL yang disiapkan.  Jika Anda perlu memantau sistem yang tidak merekomendasikan akses langsung ke database (misalnya, SAP EWM), Anda dapat menggunakan panggilan skrip untuk fungsi API terdokumentasi untuk menulis indikator atau menulis program python / vbascript sederhana. <br><br>  Proxy Zabbix dikerahkan ke jaringan gudang untuk mendistribusikan beban dari server utama.  Melalui Proxy, bekerja dengan semua instance WMS lokal disediakan.  Pada permintaan parameter berikutnya oleh server Zabbix di host dengan proksi Zabbix, sebuah skrip dijalankan untuk meminta metrik dari basis data WMS. <br><br>  Untuk menampilkan grafik dan indikator gudang di server Zabbix pusat, gunakan Grafana.  Selain menghasilkan dashboard yang disiapkan dengan infografis gudang, Grafana akan digunakan untuk mengontrol penyimpangan indikator dan mentransfer peringatan otomatis ke sistem layanan gudang untuk bekerja dengan insiden bisnis. <br><br>  Sebagai contoh, perhatikan penerapan kontrol pemuatan zona penerimaan gudang.  Sebagai indikator utama dari proses di bagian gudang yang dipilih: <br><br><ul><li>  jumlah kendaraan di area penerimaan, dengan mempertimbangkan status (direncanakan, tiba, dokumen, bongkar, keberangkatan; </li><li>  kemacetan zona penempatan dan pengisian ulang (sesuai dengan kondisi penyimpanan). </li></ul><br><h3>  Pengaturan </h3><br>  Instalasi dan konfigurasi komponen utama sistem (SQLcl, Zabbix, Grafana) dijelaskan dalam berbagai sumber dan kami tidak akan mengulanginya di sini.  Penggunaan SQLcl bukan SQLplus adalah karena fakta bahwa SQLcl (antarmuka baris perintah Oracle DBMS ditulis dalam java) tidak memerlukan instalasi tambahan dari Oracle Client dan bekerja di luar kotak. <br><br>  Saya akan menjelaskan poin-poin utama yang harus diperhatikan ketika menggunakan Zabbix untuk memantau kinerja proses bisnis gudang, dan salah satu cara yang mungkin untuk mengimplementasikannya.  Juga, posting ini bukan tentang keamanan.  Keamanan koneksi dan penggunaan metode yang disajikan membutuhkan elaborasi tambahan dalam proses transfer solusi percontohan untuk operasi yang produktif. <br><br>  Hal utama adalah bahwa ketika mengimplementasikan sistem seperti itu, dimungkinkan untuk dilakukan tanpa pemrograman, menggunakan pengaturan yang disediakan oleh sistem. <br><br>  Sistem pemantauan Zabbix menyediakan beberapa opsi untuk mengumpulkan metrik dari sistem yang dipantau.  Ini dapat dilakukan dengan secara langsung polling host yang dipantau, atau dengan metode pengiriman data yang lebih maju ke server melalui zabbix_sender host, termasuk metode untuk menetapkan parameter penemuan tingkat rendah.  Untuk mengatasi masalah kami, metode polling langsung dari host oleh server pusat cukup cocok.  ini memungkinkan Anda untuk mendapatkan kontrol penuh atas urutan mendapatkan metrik dan memastikan penggunaan satu paket pengaturan / skrip tanpa perlu mendistribusikannya ke setiap host yang dikendalikan. <br><br>  Sebagai "eksperimental" untuk debugging dan tuning sistem, kami menggunakan lembar kerja WMS untuk mengontrol penerimaan: <br><br><ol><li>  TS pada penerimaan, semua yang tiba: Semua TS dengan status untuk periode "- 72 jam dari waktu saat ini" - pengidentifikasi permintaan SQL: <b>getCars</b> . </li><li>  Sejarah semua status kendaraan: Status semua kendaraan dengan kedatangan 72 jam - Pengidentifikasi kueri SQL: <b>carsHistory</b> . </li><li>  Kendaraan terjadwal untuk penerimaan: Status semua kendaraan dengan status "Dijadwalkan", interval waktu " <b>-24</b> jam" dan "+24 jam" dari waktu saat ini - pengidentifikasi permintaan SQL: <b>carsIn</b> . </li></ol><br>  Jadi, setelah kami memutuskan satu set metrik gudang, kami akan menyiapkan pertanyaan SQL untuk database WMS.  Untuk menjalankan kueri, disarankan untuk tidak menggunakan database utama, tetapi salinan "panas" - siaga. <br><br>  Kami terhubung ke Oracle DBMS siaga untuk akuisisi data.  Alamat IP untuk menghubungkan ke basis uji <i>192.168.1.106</i> .  Parameter koneksi disimpan di server Zabbix di TNSNames.ORA dari folder SQLcl yang berfungsi: <br><br><pre><code class="plaintext hljs"># cat /opt/sqlcl/bin/TNSNames.ORA WH1_1= (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.106)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = WH1_1) ) )</code> </pre> <br>  Ini akan memungkinkan kami untuk menjalankan kueri SQL ke setiap host melalui EZconnect, yang hanya menentukan nama pengguna / kata sandi dan basis data: <br><br><pre> <code class="plaintext hljs"># sql znew/Zabmon1@WH1_1</code> </pre> <br>  Kueri SQL yang disiapkan disimpan di folder yang berfungsi di server Zabbix: <br><br><pre> <code class="plaintext hljs">/etc/zabbix/sql</code> </pre> <br>  dan memungkinkan akses ke pengguna zabbix dari server kami: <br><br><pre> <code class="plaintext hljs"># chown zabbix:zabbix -R /etc/zabbix/sql</code> </pre> <br>  File permintaan menerima nama pengenal unik untuk akses dari server Zabbix.  Setiap permintaan basis data melalui SQLcl mengembalikan beberapa parameter kepada kami.  Dengan adanya spesifikasi Zabbix, yang hanya dapat memproses satu metrik dalam kueri, kami akan menggunakan skrip tambahan untuk mengurai hasil kueri ke dalam metrik individual. <br><br>  Kami sedang mempersiapkan skrip utama, sebut saja wh_Metrics.sh, untuk memanggil kueri SQL ke basis data, menyimpan hasilnya, dan mengembalikan metrik teknis dengan indikator keberhasilan data: <br><br><pre> <code class="plaintext hljs">#!/bin/sh ##  &lt;/i&gt; export ORACLE_HOME=/usr/lib/oracle/11.2/client64 export PATH=$PATH:$ORACLE_HOME/bin export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/usr/lib64:/usr/lib:$ORACLE_HOME/bin export TNS_ADMIN=$ORACLE_HOME/network/admin export JAVA_HOME=/ alias sql="opt/sqlcl/bin/sql" ##      sql-     scriptLocation=/etc/zabbix/sql sqlFile=$scriptLocation/sqlScript_"$2".sql ##        resultFile=/etc/zabbix/sql/mon_"$1"_main.log ##      username="$3" password="$4" tnsname="$1" ##     var=$(sql -s $username/$password@$tnsname &lt; $sqlFile) ##        echo $var | cut -f5-18 -d " " &gt; $resultFile ##    if grep -q ora "$resultFile"; then echo null &gt; $resultFile echo 0 else echo 1 fi</code> </pre> <br>  Kami menempatkan file yang sudah selesai dengan skrip di folder untuk hosting skrip eksternal sesuai dengan pengaturan konfigurasi proxy Zabbix (secara default - <i>/ usr / lokal / share / zabbix /</i> skrip <i>eksternal</i> ). <br><br>  Identifikasi database dari mana skrip akan menerima hasil akan dikirimkan oleh parameter skrip.  Pengidentifikasi basis data harus sesuai dengan baris pengaturan dalam file TNSNames.ORA. <br><br>  Hasil dari permintaan query SQL disimpan dalam file dari bentuk <i>mon_base_id_main.log, di mana base_id =</i> DB identifier diperoleh sebagai parameter skrip.  Pemisahan file hasil oleh pengidentifikasi database disediakan jika ada permintaan dari server secara bersamaan ke beberapa database.  Kueri mengembalikan array nilai dua dimensi yang diurutkan. <br><br>  Skrip berikut, sebut saja getMetrica.sh, diperlukan untuk mendapatkan metrik yang ditentukan dari file dengan hasil permintaan: <br><br><pre> <code class="plaintext hljs">#!/bin/sh ##       resultFile=/etc/zabbix/sql/mon_”$1”_main.log ##      : ##    ,      (RSLT)   ## {1 1 2 2…}   ( IFS) ##          IFS=' ' str=$(cat $resultFile) status_id=null read –ra RSLT &lt;&lt;&lt; “$str” for i in “${RSLT[@]}”; do if [[ “$status_id” == null ]]; then status_id=”$I" elif [[ “$status_id” == “$2” ]]; then echo “$i” break else status_id=null fi done</code> </pre> <br>  Sekarang kami siap untuk menyiapkan Zabbix dan mulai memantau kinerja proses penerimaan gudang. <br><br>  Pada setiap simpul basis data, agen Zabbix diinstal dan dikonfigurasi. <br><br>  Di server utama, kami mendefinisikan semua server dengan proksi Zabbix.  Untuk pengaturan, pergi ke jalur berikut: <br><br>  Administrasi → Proxy → Buat Proxy <br><br><img src="https://habrastorage.org/webt/8q/me/go/8qmego2bjp0vwjvwtmm4ptitgey.png"><br><br>  Tentukan host yang dikendalikan: <br><br>  Pengaturan → Hosts → Buat host <br><br><img src="https://habrastorage.org/webt/3j/sd/re/3jsdreqz1uryqdmecrigz5om93s.png"><br><br>  Nama host harus cocok dengan nama host yang ditentukan dalam file konfigurasi agen. <br><br>  Kami menunjukkan grup untuk node, serta alamat IP atau nama DNS dari node dari database. <br><br>  Kami membuat metrik dan menentukan propertinya: <br><br>  Pengaturan → Node → <b>'nama simpul'</b> → Item data&gt; Buat item data <br><br>  1) Buat metrik dasar untuk menanyakan semua parameter dari database <br><br><img src="https://habrastorage.org/webt/ya/k6/c9/yak6c93lgu_z04plz-4yxp3yz2m.png"><br><br>  Kami menetapkan nama elemen data, menunjukkan jenis "Verifikasi eksternal".  Di bidang "Kunci", kami mendefinisikan skrip tempat kami mentransfer nama database Oracle, nama kueri sql, login, dan kata sandi untuk menghubungkan ke database sebagai parameter.  Atur interval pembaruan untuk permintaan menjadi 5 menit (300 detik). <br><br>  2) Buat metrik yang tersisa untuk setiap status kendaraan.  Nilai-nilai metrik ini akan dibentuk berdasarkan hasil pemeriksaan metrik utama. <br><br><img src="https://habrastorage.org/webt/rl/nx/qo/rlnxqoeunhfppnh6fylzyczac9s.png"><br><br>  Kami menetapkan nama elemen data, menunjukkan jenis "Verifikasi eksternal".  Di bidang "Kunci", kami mendefinisikan skrip tempat kami mentransfer nama database Oracle dan kode status, nilai yang ingin kami lacak sebagai parameter.  Kami menetapkan interval pembaruan untuk permintaan 10 detik lebih lama dari metrik utama (310 detik) sehingga hasilnya dapat ditulis ke file. <br><br>  Untuk mendapatkan metrik dengan benar, urutan pemeriksaan diaktifkan adalah penting.  Untuk menghindari konflik saat menerima data, pertama-tama, aktifkan metrik utama GetCarsByStatus dengan panggilan skrip - wh_Metrics.sh. <br><br>  Pengaturan → Node → 'nama simpul' → Elemen data → Subfilter “Pemeriksaan eksternal”.  Kami menandai centang yang diperlukan dan klik "Aktifkan". <br><br><img src="https://habrastorage.org/webt/uh/1z/ab/uh1zabbmrkzul1r9lphjwb18afc.png"><br><br>  Selanjutnya, aktifkan metrik yang tersisa dalam satu operasi, pilih semuanya bersama-sama: <br><br><img src="https://habrastorage.org/webt/d2/p3/by/d2p3by_p-hsqvoclaae0gi0wk-o.png"><br><br>  Zabbix kini telah mulai mengumpulkan metrik bisnis gudang. <br><br>  Dalam artikel berikut, kami akan memeriksa secara lebih terperinci koneksi Grafana dan pembentukan dasbor informasi untuk operasi gudang untuk berbagai kategori pengguna.  Grafana juga memantau penyimpangan di gudang dan, tergantung pada batas dan frekuensi penyimpangan, mencatat insiden dalam sistem pusat layanan manajemen gudang melalui API atau hanya mengirim pemberitahuan kepada manajer melalui email. <br><br><img src="https://habrastorage.org/webt/jp/ik/gm/jpikgmphn_imh-5mxw9vjm3jrtu.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id478872/">https://habr.com/ru/post/id478872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id478854/index.html">Pertempuran server web. Bagian 1 - HTTP bercerai dari kenyataan:</a></li>
<li><a href="../id478856/index.html">SD-WAN - tren dan perkiraan terkini untuk tahun 2020</a></li>
<li><a href="../id478858/index.html">Membandingkan Sesi Pembuatan Profil di Admin XHProf</a></li>
<li><a href="../id478862/index.html">Bagaimana pengujian frontend diatur di Yandex.Market dan mengapa kami menolak rilis mingguan</a></li>
<li><a href="../id478866/index.html">Meet Space - Produk Baru dari JetBrains</a></li>
<li><a href="../id478878/index.html">Sepotong kode paling populer dalam sejarah StackOverflow memiliki bug!</a></li>
<li><a href="../id478884/index.html">Cara menyiapkan RTSP di situs pada tahun 2020, atau mengapa babi hutan tidak punya waktu untuk melarikan diri</a></li>
<li><a href="../id478886/index.html">Komponen Sudut dengan Konten Inline</a></li>
<li><a href="../id478888/index.html">Beberapa pemikiran tentang modular css dan masalah dukungan kode</a></li>
<li><a href="../id478890/index.html">Di mana paket saya? AI akan memfasilitasi tugas pengiriman</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>