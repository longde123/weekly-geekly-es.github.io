<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”º ğŸ… ğŸ‘©â€ğŸ‘§ Dockerç»„æˆ å¦‚ä½•ç­‰å¾…ç›´åˆ°å®¹å™¨å‡†å¤‡å¥½ ğŸ‘¨ğŸ¾â€ğŸ’» â›¹ğŸ¼ ğŸ‘°ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 å…³äºè¿è¡Œå®¹å™¨å’Œç¼–å†™docker-compose.ymlçš„æ–‡ç« å¾ˆå¤šã€‚ ä½†æ˜¯å¯¹äºæˆ‘æ¥è¯´å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œé—®é¢˜ä»ç„¶ä¸æ¸…æ¥šï¼Œå¦‚æœæŸä¸ªå®¹å™¨åœ¨å¦ä¸€ä¸ªå®¹å™¨å‡†å¤‡å¥½å¤„ç†å…¶è¯·æ±‚æˆ–å®ŒæˆæŸäº›å·¥ä½œä¹‹å‰ä¸åº”è¯¥å¯åŠ¨ï¼Œé‚£ä¹ˆå¦‚ä½•æ­£ç¡®è¿›è¡Œã€‚ 

 åœ¨æˆ‘ä»¬å¼€å§‹ç§¯æä½¿ç”¨docker-composeè€Œä¸æ˜¯å¯åŠ¨å•ä¸ªdockerä¹‹åï¼Œè¿™ä¸ª...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dockerç»„æˆ å¦‚ä½•ç­‰å¾…ç›´åˆ°å®¹å™¨å‡†å¤‡å¥½</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454552/"><h1> å¼•è¨€ </h1><br> å…³äºè¿è¡Œå®¹å™¨å’Œç¼–å†™<b>docker-compose.ymlçš„</b>æ–‡ç« å¾ˆå¤šã€‚ ä½†æ˜¯å¯¹äºæˆ‘æ¥è¯´å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œé—®é¢˜ä»ç„¶ä¸æ¸…æ¥šï¼Œå¦‚æœæŸä¸ªå®¹å™¨åœ¨å¦ä¸€ä¸ªå®¹å™¨å‡†å¤‡å¥½å¤„ç†å…¶è¯·æ±‚æˆ–å®ŒæˆæŸäº›å·¥ä½œä¹‹å‰ä¸åº”è¯¥å¯åŠ¨ï¼Œé‚£ä¹ˆå¦‚ä½•æ­£ç¡®è¿›è¡Œã€‚ <br><a name="habracut"></a><br> åœ¨æˆ‘ä»¬å¼€å§‹ç§¯æä½¿ç”¨<b>docker-compose</b>è€Œä¸æ˜¯å¯åŠ¨å•ä¸ªdockerä¹‹åï¼Œè¿™ä¸ªé—®é¢˜å°±å˜å¾—å¾ˆé‡è¦ã€‚ <br><br><h1> è¿™æ˜¯ä¸ºäº†ä»€ä¹ˆ </h1><br> å®é™…ä¸Šï¼Œè®©å®¹å™¨Bä¸­çš„åº”ç”¨ç¨‹åºä¾èµ–äºå®¹å™¨Aä¸­æœåŠ¡çš„å¯ç”¨æ€§ã€‚å¹¶ä¸”åœ¨å¯åŠ¨æ—¶ï¼Œå®¹å™¨Bä¸­çš„åº”ç”¨ç¨‹åºä¸ä¼šæ¥æ”¶æ­¤æœåŠ¡ã€‚ åº”è¯¥æ€ä¹ˆåŠï¼Ÿ <br><br> æœ‰ä¸¤ç§é€‰æ‹©ï¼š <br><br><ul><li> é¦–å…ˆæ˜¯æ­»ï¼ˆæœ€å¥½å¸¦æœ‰é”™è¯¯ä»£ç ï¼‰ </li><li> ç¬¬äºŒä¸ªæ˜¯ç­‰å¾…ï¼Œå¦‚æœå®¹å™¨Bä¸­çš„åº”ç”¨ç¨‹åºæœªå“åº”æ‰€åˆ†é…çš„è¶…æ—¶ï¼Œåˆ™æ— è®ºå¦‚ä½•éƒ½ä¼šæ­»äº¡ </li></ul><br> å®¹å™¨Bæ­»äº¡åï¼Œ <b>docker-compose</b> ï¼ˆå½“ç„¶å–å†³äºé…ç½®ï¼‰å°†é‡æ–°å¯åŠ¨å®ƒï¼Œå®¹å™¨Bä¸­çš„åº”ç”¨ç¨‹åºå°†å†æ¬¡å°è¯•è®¿é—®å®¹å™¨Aä¸­çš„æœåŠ¡ã€‚ <br><br> è¿™å°†ä¸€ç›´æŒç»­åˆ°å®¹å™¨Aä¸­çš„æœåŠ¡å‡†å¤‡å¥½å“åº”è¯·æ±‚ï¼Œæˆ–è€…ç›´åˆ°æˆ‘ä»¬æ³¨æ„åˆ°å®¹å™¨ä¸æ–­è¶…è½½ã€‚ <br> å®é™…ä¸Šï¼Œè¿™æ˜¯å¤šå®¹å™¨ä½“ç³»ç»“æ„çš„å¸¸è§„æ–¹æ³•ã€‚ <br><br> ä½†æ˜¯ï¼Œå°¤å…¶æ˜¯ï¼Œæˆ‘ä»¬é¢ä¸´ç€è¿™æ ·çš„æƒ…å†µï¼šå®¹å™¨Aå¯åŠ¨å¹¶ä¸ºå®¹å™¨Bå‡†å¤‡æ•°æ®ã€‚å®¹å™¨Bä¸­çš„åº”ç”¨ç¨‹åºæ— æ³•æ£€æŸ¥æ•°æ®æ˜¯å¦å·²å‡†å¤‡å°±ç»ªï¼Œè€Œæ˜¯ç«‹å³å¼€å§‹ä½¿ç”¨å®ƒä»¬ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±æ¥æ”¶å’Œå¤„ç†æœ‰å…³æ•°æ®å‡†å¤‡å°±ç»ªçš„ä¿¡å·ã€‚ <br><br> æˆ‘è®¤ä¸ºæ‚¨ä»ç„¶å¯ä»¥ç»™å‡ºä¸€äº›ç”¨ä¾‹ã€‚ ä½†æœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨éœ€è¦ç¡®åˆ‡äº†è§£ä¸ºä»€ä¹ˆè¦è¿™æ ·åšã€‚ å¦åˆ™ï¼Œæœ€å¥½ä½¿ç”¨æ ‡å‡†çš„<b>docker-compose</b>å·¥å…·ã€‚ <br><br><h1> ä¸€ç‚¹æ€æƒ³ </h1><br> å¦‚æœæ‚¨ä»”ç»†é˜…è¯»äº†æ–‡æ¡£ï¼Œåˆ™æ‰€æœ‰å†…å®¹éƒ½å†™åœ¨é‚£é‡Œã€‚ å³æ¯ä¸ª <br> è¯¥éƒ¨é—¨æ˜¯ç‹¬ç«‹çš„ï¼Œå¿…é¡»æ³¨æ„æ‰€æœ‰æœåŠ¡ <br> ä»–å°†ä¸ä¹‹ä¸€èµ·å·¥ä½œã€‚ <br><br> å› æ­¤ï¼Œé—®é¢˜ä¸æ˜¯å¯åŠ¨æˆ–ä¸å¯åŠ¨å®¹å™¨ï¼Œè€Œæ˜¯ <br> åœ¨å®¹å™¨å†…ï¼Œä»…æ£€æŸ¥æ‰€æœ‰å¿…è¦æœåŠ¡çš„å‡†å¤‡æƒ…å†µ <br> ç„¶åå°†æ§åˆ¶æƒè½¬ç§»åˆ°å®¹å™¨åº”ç”¨ç¨‹åºã€‚ <br><br><h1> å¦‚ä½•å®æ–½ </h1><br> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ <b>docker-compose</b>æè¿°å¯¹æˆ‘æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™</a>éƒ¨åˆ† <br> ä»¥åŠå…³äºæ­£ç¡®ä½¿ç”¨<b>entrypoint</b>å’Œ<b>cmdçš„æ–‡ç« </b> ã€‚ <br><br> æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¾—åˆ°ï¼š <br><br><ul><li> æˆ‘ä»¬åœ¨å®¹å™¨Aä¸­åŒ…è£…äº†ä¸€ä¸ªé™„å½•A </li><li> å®ƒå¯åŠ¨å¹¶å¼€å§‹åœ¨ç«¯å£8000ä¸Šå“åº”ç¡®å®š </li><li> è¿˜æœ‰åº”ç”¨ç¨‹åºBï¼Œæˆ‘ä»¬ä»å®¹å™¨Bå¼€å§‹ï¼Œä½†æ˜¯å®ƒåº”è¯¥ä¸æ—©äºåº”ç”¨ç¨‹åºAå¼€å§‹å“åº”ç«¯å£8000ä¸Šçš„è¯·æ±‚è€Œå¼€å§‹å·¥ä½œ </li></ul><br> å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸¤ç§è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ã€‚ <br><br> é¦–å…ˆæ˜¯åœ¨å®¹å™¨ä¸­ç¼–å†™æ‚¨è‡ªå·±çš„<b>å…¥å£ç‚¹</b> ï¼Œè¯¥<b>å…¥å£</b>ç‚¹å°†æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥ï¼Œç„¶åå¯åŠ¨æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚ <br><br> ç¬¬äºŒç§æ˜¯ä½¿ç”¨å·²ç»å†™å…¥çš„æ‰¹å¤„ç†æ–‡ä»¶<b>wait-for-it.sh</b> ã€‚ <br> æˆ‘ä»¬å°è¯•äº†ä¸¤ç§æ–¹å¼ã€‚ <br><br><h2> ç¼–å†™è‡ªå·±çš„å…¥å£ç‚¹ </h2><br> ä»€ä¹ˆæ˜¯<b>å…¥å£ç‚¹</b> ï¼Ÿ <br><br> è¿™åªæ˜¯æ‚¨åœ¨<b>Dockerfile</b>ä¸­çš„<b>ENTRYPOINT</b>å­—æ®µä¸­åˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ å¦‚å‰æ‰€è¿°ï¼Œè¯¥æ–‡ä»¶æ‰§è¡Œæ£€æŸ¥ï¼Œç„¶åå¯åŠ¨å®¹å™¨çš„ä¸»åº”ç”¨ç¨‹åºã€‚ <br><br> æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†ï¼š <br><br> åˆ›å»ºä¸€ä¸ª<i>Entrypoint</i>æ–‡ä»¶å¤¹ã€‚ <br><br> å®ƒå…·æœ‰ä¸¤ä¸ªå­æ–‡ä»¶å¤¹<i>-container_A</i>å’Œ<i>container_B</i> ã€‚ æˆ‘ä»¬å°†åœ¨å…¶ä¸­åˆ›å»ºå®¹å™¨ã€‚ <br><br> å¯¹äºå®¹å™¨Aï¼Œè®©æˆ‘ä»¬åœ¨pythonä¸Šä½¿ç”¨ä¸€ä¸ªç®€å•çš„httpæœåŠ¡å™¨ã€‚ å¯åŠ¨åï¼Œä»–å¼€å§‹å“åº”ç«¯å£8000ä¸Šçš„è·å–è¯·æ±‚ã€‚ <br><br> ä¸ºäº†ä½¿å®éªŒæ›´åŠ æ˜ç¡®ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰è®¾ç½®äº†15ç§’çš„å»¶è¿Ÿã€‚ <br><br> ç»“æœ<b>æ˜¯å®¹å™¨A</b>çš„ä»¥ä¸‹<b>dockeræ–‡ä»¶</b> ï¼š <br><br><pre><code class="plaintext hljs">FROM python:3 EXPOSE 8000 CMD sleep 15 &amp;&amp; python3 -m http.server --cgi</code> </pre> <br> å¯¹äºå®¹å™¨Bï¼Œä¸ºå®¹å™¨Båˆ›å»ºä»¥ä¸‹<b>dockeræ–‡ä»¶</b> ï¼š <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04 RUN apt-get update RUN apt-get install -y curl COPY ./entrypoint.sh /usr/bin/entrypoint.sh ENTRYPOINT [ "entrypoint.sh" ] CMD ["echo", "!!!!!!!! Container_A is available now !!!!!!!!"]</code> </pre><br> å¹¶å°†æˆ‘ä»¬çš„entrypoint.shå¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­ã€‚ æˆ‘ä»¬ä¼šåƒè¿™æ · <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash set -e host="conteiner_a" port="8000" cmd="$@" &gt;&amp;2 echo "!!!!!!!! Check conteiner_a for available !!!!!!!!" until curl http://"$host":"$port"; do &gt;&amp;2 echo "Conteiner_A is unavailable - sleeping" sleep 1 done &gt;&amp;2 echo "Conteiner_A is up - executing command" exec $cmd</span></span></code> </pre><br> å®¹å™¨Bä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼š <br><br><ul><li> å¯åŠ¨æ—¶ï¼Œå®ƒå°†å¯åŠ¨<b>ENTRYPOINT</b> ï¼Œå³ å¯åŠ¨<b>entrypoint.sh</b> </li><li>  <b>entrypoint.sh</b>ä½¿ç”¨<b>curl</b>å¯åŠ¨å®¹å™¨Açš„è½®è¯¢ç«¯å£8000.ç›´åˆ°æ¥æ”¶åˆ°200å“åº”ä¸ºæ­¢ï¼ˆå³åœ¨è¿™ç§æƒ…å†µä¸‹<b>curl</b>å°†ä»¥é›¶ç»“æœç»“æŸå¹¶ä¸”å¾ªç¯å°†ç»“æŸï¼‰ </li><li> æ”¶åˆ°200æ—¶ï¼Œå¾ªç¯ç»“æŸï¼Œæ§åˆ¶æƒä¼ é€’åˆ°<b>$ cmd</b>å˜é‡ä¸­æŒ‡å®šçš„å‘½ä»¤ã€‚ å®ƒæŒ‡ç¤ºäº†æˆ‘ä»¬åœ¨<b>CMD</b>å­—æ®µçš„dockeræ–‡ä»¶ä¸­æŒ‡ç¤ºçš„å†…å®¹ï¼Œå³  <i>å›å£°â€œ !!! Container_Aç°åœ¨å¯ç”¨!!!!!!!!â€</i> ä¸Šé¢çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« ä¸­</a>ä»‹ç»äº†ä¸ºä»€ä¹ˆä¼šè¿™æ · </li><li> æˆ‘ä»¬æ‰“å°- <i>!!!</i>  <i>Container_Aç°åœ¨å¯ç”¨ï¼ï¼ï¼</i>  <i>å¹¶å¾—å‡ºç»“è®ºã€‚</i> </li></ul><br> æˆ‘ä»¬å°†ä»<b>docker-compose</b>å¼€å§‹ä¸€åˆ‡ã€‚ <br><br>  <b>docker-compose.yml</b>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰è¿™ä¸ªï¼š <br><br><pre> <code class="plaintext hljs">version: '3' networks: waiting_for_conteiner: services: conteiner_a: build: ./conteiner_A container_name: conteiner_a image: conteiner_a restart: unless-stopped networks: - waiting_for_conteiner ports: - 8000:8000 conteiner_b: build: ./conteiner_B container_name: conteiner_b image: waiting_for_conteiner.entrypoint.conteiner_b restart: "no" networks: - waiting_for_conteiner</code> </pre><br> æ­¤å¤„ï¼Œåœ¨<b>conteiner_aä¸­ï¼Œ</b>æ— éœ€æŒ‡å®š<i>ç«¯å£ï¼š8000ï¼š8000</i> ã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†èƒ½å¤Ÿä»å¤–éƒ¨éªŒè¯å…¶ä¸­è¿è¡Œçš„httpæœåŠ¡å™¨çš„æ“ä½œã€‚ <br><br> åŒæ ·ï¼Œå®¹å™¨Båœ¨å…³é—­åä¹Ÿä¸ä¼šé‡æ–°å¯åŠ¨ã€‚ <br><br> æˆ‘ä»¬æ¨å‡ºï¼š <br><br><pre> <code class="plaintext hljs">docker-compose up â€”-build</code> </pre><br> æˆ‘ä»¬çœ‹åˆ°æœ‰15ç§’çš„æ—¶é—´ï¼Œå…³äºå®¹å™¨Aä¸å¯ç”¨çš„æ¶ˆæ¯ï¼Œç„¶å <br><br><pre> <code class="plaintext hljs">conteiner_b | Conteiner_A is unavailable - sleeping conteiner_b | % Total % Received % Xferd Average Speed Time Time Time Current conteiner_b | Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt; conteiner_b | &lt;html&gt; conteiner_b | &lt;head&gt; conteiner_b | &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt; conteiner_b | &lt;title&gt;Directory listing for /&lt;/title&gt; conteiner_b | &lt;/head&gt; conteiner_b | &lt;body&gt; conteiner_b | &lt;h1&gt;Directory listing for /&lt;/h1&gt; conteiner_b | &lt;hr&gt; conteiner_b | &lt;ul&gt; conteiner_b | &lt;li&gt;&lt;a href=".dockerenv"&gt;.dockerenv&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="bin/"&gt;bin/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="boot/"&gt;boot/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="dev/"&gt;dev/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="etc/"&gt;etc/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="home/"&gt;home/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="lib/"&gt;lib/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="lib64/"&gt;lib64/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="media/"&gt;media/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="mnt/"&gt;mnt/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="opt/"&gt;opt/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="proc/"&gt;proc/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="root/"&gt;root/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="run/"&gt;run/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="sbin/"&gt;sbin/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="srv/"&gt;srv/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="sys/"&gt;sys/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="tmp/"&gt;tmp/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="usr/"&gt;usr/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;li&gt;&lt;a href="var/"&gt;var/&lt;/a&gt;&lt;/li&gt; conteiner_b | &lt;/ul&gt; conteiner_b | &lt;hr&gt; conteiner_b | &lt;/body&gt; conteiner_b | &lt;/html&gt; 100 987 100 987 0 0 98700 0 --:--:-- --:--:-- --:--:-- 107k conteiner_b | Conteiner_A is up - executing command conteiner_b | !!!!!!!! Container_A is available now !!!!!!!!</code> </pre><br> æˆ‘ä»¬å¾—åˆ°æ‚¨çš„è¦æ±‚çš„ç­”æ¡ˆï¼Œæ‰“å°<nobr><i>ï¼</i></nobr>  <nobr><i>ç°åœ¨å¯ä»¥ä½¿ç”¨Container_A !!!!!!!!</i></nobr> å¹¶å¾—å‡ºç»“è®ºã€‚ <br><br><h2> ä½¿ç”¨wait-for-it.sh </h2><br> å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒæŒ‰ç…§æ–‡æ¡£ä¸­çš„è¯´æ˜ï¼Œæ­¤è·¯å¾„å¯¹æˆ‘ä»¬ä¸èµ·ä½œç”¨ã€‚ <br> å³ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå¦‚æœåœ¨<b>Dockerfile</b> <b>ä¸­</b>å†™å…¥<b>ENTRYPOINT</b>å’Œ<b>CMD</b> ï¼Œåˆ™åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œå°†æ‰§è¡Œæ¥è‡ª<b>ENTRYPOINT</b>çš„å‘½ä»¤ï¼Œå¹¶å°†<b>CMD</b>çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚ <br><br> è¿˜ä¼—æ‰€å‘¨çŸ¥ï¼Œå¯ä»¥åœ¨<b>docker</b> <b>-compose.ymlä¸­</b>é‡æ–°å®šä¹‰<b>Dockerfileä¸­</b>æŒ‡å®šçš„<b>ENTRYPOINT</b>å’Œ<b>CMD</b> ã€‚ <br><br>  <b>wait-it-sh.sh</b>å¯åŠ¨<b>æ ¼å¼</b>å¦‚ä¸‹ï¼š <br><br><pre> <code class="plaintext hljs">wait-for-it.sh __ -- ___</code> </pre><br> ç„¶åï¼Œå¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a>ä¸­æ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<b>docker</b> <b>-compose.ymlä¸­</b>å®šä¹‰ä¸€ä¸ªæ–°<b>çš„ENTRYPOINT</b> ï¼Œå¹¶å°†ä»<b>Dockerfileä¸­</b>æ›¿æ¢<b>CMD</b> ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š <br><br>  <b>å®¹å™¨Açš„Dockeræ–‡ä»¶</b>ä¿æŒä¸å˜ï¼š <br><br><pre> <code class="plaintext hljs">FROM python:3 EXPOSE 8000 CMD sleep 15 &amp;&amp; python3 -m http.server --cgi</code> </pre><br>  <b>å®¹å™¨Bçš„Dockeræ–‡ä»¶</b> <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04 COPY ./wait-for-it.sh /usr/bin/wait-for-it.sh CMD ["echo", "!!!!!!!! Container_A is available now !!!!!!!!"]</code> </pre><br>  <b>Docker-compose.yml</b>çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="plaintext hljs">version: '3' networks: waiting_for_conteiner: services: conteiner_a: build: ./conteiner_A container_name: conteiner_a image: conteiner_a restart: unless-stopped networks: - waiting_for_conteiner ports: - 8000:8000 conteiner_b: build: ./conteiner_B container_name: conteiner_b image: waiting_for_conteiner.wait_for_it.conteiner_b restart: "no" networks: - waiting_for_conteiner entrypoint: ["wait-for-it.sh", "-s" , "-t", "20", "conteiner_a:8000", "--"]</code> </pre><br> æˆ‘ä»¬è¿è¡Œ<b>wait-it-it</b>å‘½ä»¤ï¼Œå‘Šè¯‰å®ƒç­‰å¾…20ç§’ï¼Œç›´åˆ°å®¹å™¨Aç”Ÿæ•ˆï¼Œå¹¶æŒ‡å®šå¦ä¸€ä¸ªå‚æ•°<b>â€œ-â€</b> ï¼Œè¯¥å‚æ•°åº”å°†<b>wait-for-it</b>å‚æ•°ä¸å®Œæˆåå°†å¯åŠ¨çš„ç¨‹åºåˆ†å¼€ã€‚ <br><br> æˆ‘ä»¬å°è¯•ï¼ <br> ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ä»€ä¹ˆä¹Ÿæ²¡å¾—åˆ°ã€‚ <br><br> å¦‚æœæ£€æŸ¥ä½¿ç”¨å“ªäº›å‚æ•°è¿è¡Œwait-for-itï¼Œåˆ™å°†çœ‹åˆ°ä»…å°†åœ¨<b>å…¥å£ç‚¹ä¸­</b>æŒ‡å®šçš„<b>å†…å®¹ä¼ é€’ç»™å®ƒ</b> ï¼Œè€Œæœªé™„åŠ å®¹å™¨ä¸­çš„<b>CMD</b> ã€‚ <br><br><h3> å·¥ä½œé€‰é¡¹ </h3><br> ç„¶åï¼Œåªæœ‰ä¸€ç§é€‰æ‹©ã€‚ æˆ‘ä»¬åœ¨<b>Dockerfile</b>çš„<b>CMD</b>ä¸­æŒ‡å®šçš„<b>å†…å®¹</b> ï¼Œæˆ‘ä»¬å¿…é¡»è½¬ç§»åˆ°<b>docker-compose.ymlä¸­</b>çš„<b>å‘½ä»¤</b> ã€‚ <br><br> ç„¶åï¼Œä¿æŒå®¹å™¨B <b>çš„Dockerfile</b>ä¸å˜ï¼Œå¹¶ä¸”<b>docker-compose.yml</b>å°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="plaintext hljs">version: '3' networks: waiting_for_conteiner: services: conteiner_a: build: ./conteiner_A container_name: conteiner_a image: conteiner_a restart: unless-stopped networks: - waiting_for_conteiner ports: - 8000:8000 conteiner_b: build: ./conteiner_B container_name: conteiner_b image: waiting_for_conteiner.wait_for_it.conteiner_b restart: "no" networks: - waiting_for_conteiner entrypoint: ["wait-for-it.sh", "-s" ,"-t", "20", "conteiner_a:8000", "--"] command: ["echo", "!!!!!!!! Container_A is available now !!!!!!!!"]</code> </pre><br> åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œå®ƒå¯ä»¥å·¥ä½œã€‚ <br><br> æ€»ä¹‹ï¼Œå¿…é¡»è¯´ï¼Œæˆ‘ä»¬è®¤ä¸ºæ­£ç¡®çš„æ–¹æ³•æ˜¯ç¬¬ä¸€ã€‚ å®ƒç”¨é€”æœ€å¹¿æ³›ï¼Œå¯ä»¥è®©æ‚¨ä»¥ä»»ä½•å¯èƒ½çš„æ–¹å¼è¿›è¡Œå‡†å¤‡æƒ…å†µæ£€æŸ¥ã€‚  <b>ç­‰å¾…å®ƒ</b>åªæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å®ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥å•ç‹¬ä½¿ç”¨å®ƒï¼Œä¹Ÿå¯ä»¥å°†å…¶åµŒå…¥åˆ°<b>entrypoint.shä¸­</b> ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN454552/">https://habr.com/ru/post/zh-CN454552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN454536/index.html">ç»å…¸å¿ƒç‡ä¼ æ„Ÿå™¨çš„æ”¾å¤§å™¨</a></li>
<li><a href="../zh-CN454538/index.html">å‰ç«¯æ¯å‘¨æ‘˜è¦ï¼ˆ2019å¹´5æœˆ27æ—¥è‡³6æœˆ2æ—¥ï¼‰</a></li>
<li><a href="../zh-CN454540/index.html">367ä¸Šå‘¨ï¼ˆ2019å¹´5æœˆ27æ—¥è‡³6æœˆ2æ—¥ï¼‰å‰ç«¯ä¸–ç•Œä¸­çš„æ–°é²œææ–™æ‘˜è¦</a></li>
<li><a href="../zh-CN454542/index.html">æœ€å°çš„æœ‰çº¿ç”µè§†ç½‘ç»œã€‚ ç¬¬7éƒ¨åˆ†ï¼šå…‰æ¥æ”¶å™¨</a></li>
<li><a href="../zh-CN454546/index.html">æ‚¨éœ€è¦å¤šå°‘ç¨‹åºå‘˜æ‰èƒ½å–æ¯å’–å•¡ï¼Ÿ</a></li>
<li><a href="../zh-CN454556/index.html">OpenStreetMapç¬¬462å·ä¸–ç•Œæ–°é—»ï¼ˆ05.21.2019-27.05.2019ï¼‰</a></li>
<li><a href="../zh-CN454558/index.html">PHPæ‘˜è¦157å·ï¼ˆ2019å¹´5æœˆ20æ—¥è‡³6æœˆ3æ—¥ï¼‰</a></li>
<li><a href="../zh-CN454562/index.html">ä¸ºä»€ä¹ˆå­—èŠ‚ç çš„æ¦‚å¿µæ²¡æœ‰ä»¥å‰é‚£ä¹ˆé‡è¦</a></li>
<li><a href="../zh-CN454568/index.html">Mozillaç§°Googleçš„æ•°å­—ç­¾åWebè½¯ä»¶åŒ…åˆ†å‘â€œä¸å¥½â€</a></li>
<li><a href="../zh-CN454570/index.html">åœ¨C ++ 17ä¸­é‡æ–°åˆ›å»ºæ—§çš„DOSæ¸¸æˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>