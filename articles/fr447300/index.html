<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏿 🧔🏽 🐹 Création de VirtualBox pour Windows ℹ️ 🍘 ➖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 
 C'est un fait bien connu de nombreux utilisateurs de la version Windows de VirtualBox (à partir de maintenant, VB ; à ne pas confondre avec Vi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Création de VirtualBox pour Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447300/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f6/4c2/1ba/2f64c21bac5d7f0c050e7442bd08960e.png"></div><br><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Intro </h4><br>  C'est un fait bien connu de nombreux utilisateurs de la version Windows de VirtualBox (à partir de maintenant, <em>VB</em> ; à ne pas confondre avec Visual Basic) qu'à partir de la version 4.3.14, les développeurs ont ajouté le soi-disant "durcissement" conçu pour empêcher injections malveillantes dans VB.  Bien que les intentions soient bonnes, la mise en œuvre a provoqué de nombreux conflits avec des produits totalement légitimes tels que les antivirus, les modules cryptographiques et même certaines mises à jour de Windows lui-même, et lorsqu'un tel conflit se produit, VB cesse simplement de fonctionner.  Les utilisateurs doivent attendre au moins un mois avant la sortie de la nouvelle version VB avec les exclusions appropriées ajoutées.  Le pire des cas est que l'application ou la mise à jour en conflit doit être désinstallée ou VB lui-même doit être rétrogradé à la version 4.3.12 qui était la dernière sans durcissement.  De nombreuses demandes pour ajouter une liste d'exclusion contrôlée par l'utilisateur, ou une option pour désactiver le renforcement, sont toutes restées sans réponse.  La seule réponse des développeurs sonne comme "si vous ne voulez pas le construire vous-même à partir du code source".  On dirait que nous devrons le faire. <br><br>  Bien que les instructions de construction soient <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">décrites</a> sur le Wiki officiel du projet, elles sont incomplètes et quelque peu dépassées, tandis que la procédure de construction échoue souvent avec de vagues messages d'erreur.  Donc, quand j'ai fini par le faire fonctionner, j'ai pensé que cela valait la peine d'être documenté en détail dans un article séparé.  Cette instruction est mise à jour de temps en temps et est actuellement adaptée à la construction de la version 6.0.4 de VB.  Cependant, si vous avez besoin d'informations sur la création de versions antérieures de VB ou de bibliothèques auxiliaires, vous pouvez toujours les obtenir à partir de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">historique des modifications</a> . <br><br><a name="habracut"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Table des matières </h4><blockquote>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Énoncé du problème</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un mot d'avertissement</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Préparation de l'environnement de construction</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quirks d'installation des applications</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Touches finales</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Création de VirtualBox</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Épilogue</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amendements</a> <br></blockquote><br><a name="task"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Énoncé du problème </h4><br>  Au début, je voulais rester simple en reconstruisant simplement les composants binaires et en les copiant sur la version installée à partir de la distribution officielle.  Cependant, cela s'est avéré loin d'être simple car l'installation repose sur une API système obscure et nécessite l'installation des pilotes et l'enregistrement des composants COM.  Je me suis demandé s'il était viable d'apprendre comment tout cela fonctionnait et d'écrire un script pour automatiser ces tâches, mais après mûre réflexion, j'ai décidé d'aller grand et de construire une distribution complète qui serait aussi proche que possible de la distribution officielle, uniquement sans durcissement. <br><br>  Je dois dire que cette tâche s'est avérée très difficile et je ne l'ai pas accomplie à 100%.  Ce que je suis tombé sur les suppléments invités qui sont fournis pour Windows (32 et 64 bits), OS / 2, Linux et certains autres systèmes * NIX.  Les commentaires dans le Makefile correspondant mentionnent qu'ils sont tous construits sur différentes machines distantes, et je n'étais certainement pas impatient de gérer une telle usine de construction.  Donc ma dernière solution était de tout construire à partir des codes sources, à l'exception des ajouts, mais de prendre l'image ISO officielle avec eux et de la mettre dans ma distribution telle quelle.  Je n'ai pas vérifié si les ajouts ont le même mécanisme de durcissement, mais même s'ils le font, je n'ai jamais entendu de plaintes à ce sujet. <br><br><a name="warnings"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Un mot d'avertissement </h4><br><h5>  • Considérations de sécurité </h5><br>  Le durcissement n'a pas été ajouté sur un coup de tête, c'était une solution pour fermer une vulnérabilité dans VB.  Malheureusement, Oracle refuse de fournir la description détaillée du problème, même s'il a été corrigé il y a de nombreuses années.  Généralement, cela a quelque chose à voir avec le mécanisme d'injection de DLL dans Windows qui, en cas de VB, peut conduire à une élévation de privilèges non autorisée sur l'ordinateur hôte, et il existe des exploits de travail pour cette vulnérabilité.  Soyez donc averti si vous décidez d'utiliser la version sans durcissement de toute façon. <br><br><h5>  • Signature des chauffeurs </h5><br>  À partir de Vista, dans les versions Windows 64 bits, les utilisateurs ne peuvent plus charger de pilotes arbitraires.  Les pilotes doivent être signés par un certificat avec une chaîne de certificats croisés qui monte à l'autorité de certification racine Microsoft (et dans Windows 10 avec Secure Boot activé, les pilotes doivent être signés par Microsoft eux-mêmes).  Avant de vous lancer dans la construction de VB, vous devez décider comment résoudre ce problème.  Vous pouvez soit dépenser de l'argent et acheter votre propre certificat, soit essayer de contacter des sociétés tierces qui fournissent des services de signature pour des projets open source (si elles acceptent de signer des pilotes vulnérables), ou configurer votre Windows en mode test qui permet de charger les pilotes signé avec un certificat de test généré localement. <br><br>  Dans l'article, j'impliquerai principalement ce dernier scénario, mais je mentionnerai comment la procédure change si vous avez un certificat commercial «adulte». <br><br><a name="environment"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Préparation de l'environnement de construction </h4><br>  Le guide officiel recommande d'utiliser Windows 7 à 10 comme système de génération.  J'ai fait tout le travail dans Windows 7 SP1 x64, et je ne pense pas que la version du système d'exploitation affecte beaucoup la procédure.  N'oubliez pas que la machine (réelle ou virtuelle) que vous allez utiliser pour créer VB doit avoir une connexion Internet. <br><br>  L'environnement de construction nécessite pas mal d'outils.  Si certains programmes ont une version portable, je préfère prendre cela au lieu d'utiliser le programme d'installation. <br><br>  Désormais, les programmes suivants ne peuvent être obtenus qu'en tant que distributions installables (au moins, officiellement).  Pour Visual Studio et SDK / WDK, il est important de suivre l'ordre d'installation tel que spécifié ci-dessous.  Une fois que vous avez terminé avec eux, je recommande fortement d'exécuter Windows Update et de récupérer les dernières mises à jour pour tous les produits Microsoft. <br><ul><li>  <b>Visual Studio 2010 Professional</b> <br>  Vous avez besoin exactement de la version 2010, et elle devrait être professionnelle ou supérieure.  La version 2010 Express manque d'ATL qui est nécessaire pour construire l'API COM, utilisée par tous les frontends pour communiquer.  J'ai essayé de passer à VS 2013 ou 2015 Community Edition afin que ce ne soit pas obligatoire d'avoir un programme payant (qui n'est même plus vendu), mais j'ai échoué jusqu'à présent. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDK Windows v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Visual Studio 2010 SP1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise à jour du compilateur Visual C ++ 2010 SP1 pour SDK 7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kit de développement de pilotes Windows (WDK) v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDK Windows v8.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Activeperl</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ActivePython 2.7</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cygwin</a></b> </li></ul><br>  Les autres programmes sont téléchargés sous forme d'archives portables ou de codes sources: <br><ul><li>  <b><a href="">Qt 5.6.3</a></b> (code source) </li><li>  <b>MinGW-w64 4.5.4</b> : <ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Version 32 bits</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Version 64 bits</a></b> </li></ul></li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDL v1.2.x</a></b> (bibliothèque de développement pour Visual C ++) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cURL</a></b> (code source) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenSSL 1.1.1</a></b> (code source) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gSOAP 2.8.x</a></b> (la version 2.8.41 ou supérieure est recommandée) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libvpx 1.7.0</a></b> (code source; les versions plus récentes ne prennent pas en charge VS 2010) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libopus 1.3</a></b> (code source) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MiKTeX Portable</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NASM</a></b> <br>  Je recommande d'utiliser la version portable 64 bits. </li><li> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WiX</a></b> <br>  Je recommande d'utiliser une archive portable (nommée comme <code>wix311-binaries.zip</code> ). </li></ul><br>  Vous aurez également besoin des archives suivantes: <br><ul><li>  <b><a href="">DocBook XML DTD 4.5</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Feuilles de style DocBook XSL 1.69.1</a></b> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Pourquoi devriez-vous vouloir tout cela?</b> <div class="spoiler_text">  Si vous ne voulez pas construire exactement le même paquet que moi, vous pourrez peut-être vous débarrasser de certains des outils susmentionnés.  Je vais donc ici donner quelques détails sur leur objectif dans le processus de construction. <br><br><ul><li>  <b>SDK 8.1</b> <br>  La construction réelle est effectuée à l'aide du SDK 7.1, mais vous aurez besoin du programme SignTool à partir de 8.1, car celui à partir de 7.1 ne peut pas effectuer la double signature SHA-1 / SHA-256.  Si le SDK 8.1 est installé ailleurs, vous pouvez simplement copier <code>signtool.exe</code> avec toutes ses dépendances à partir de là et spécifier le chemin d'accès dans le fichier <code>LocalConfig.kmk</code> (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ci</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dessous</a> ). </li><li>  <b>WiX</b> <br>  Il s'agit du cadre de création de packages MSI.  Bien que la distribution VB finale soit un EXE, elle contient deux fichiers MSI à l'intérieur, vous avez donc besoin de WiX pour les construire.  Cependant, si vous avez uniquement l'intention de créer les fichiers binaires VB sans les empaqueter, vous pouvez le faire sans WiX. </li><li>  <b>Sdl</b> <br>  Cette bibliothèque est utilisée pour un <code>VBoxSDL.exe</code> frontal simpliste supplémentaire qui peut être utilisé à la place de <code>VirtualBox.exe</code> .  En théorie, si vous n'avez pas besoin de ce composant, vous devriez pouvoir exécuter la build sans avoir SDL, mais je ne l'ai pas essayé. </li><li>  <b>gSOAP</b> <br>  Cette bibliothèque est utilisée pour créer <code>VBoxWebSrv.exe</code> , service de gestion à distance VB.  Si vous n'avez pas gSOAP, ce composant sera ignoré en silence lors de la construction. </li><li>  <b>libvpx</b> , <b>libopus</b> <br>  Ce sont les codecs vidéo et audio utilisés pour enregistrer l'écran de la VM.  Si vous ne les avez pas, la construction se terminera toujours avec succès et VB aura toujours toutes les options de capture vidéo, mais ces options seront ignorées (même si l'animation de capture sera lue, aucun enregistrement réel ne sera sauvegardé) . </li><li>  <b>Cygwin</b> <br>  Requis pour construire libvpx. </li><li>  <b>MiKTeX</b> <br>  MiKTeX est utilisé pour compiler la documentation PDF ( <code>doc\UserManual.pdf</code> ).  Sans ce programme, le PDF sera silencieusement omis de la construction et de l'emballage. </li><li>  <b>NASM</b> <br>  L'assembleur utilisé lors de la construction d'OpenSSL.  Vous pouvez également le construire sans utiliser l'assembleur, mais je recommande toujours de l'utiliser pour générer un code plus optimisé. </li></ul></div></div><br>  Voici le résumé de tous les outils et bibliothèques que j'utilise, y compris leurs versions exactes (si possible) et les chemins d'installation que j'ai choisis sur mon système de construction.  La désignation " <code>{x32|x64}</code> " est utilisée pour des emplacements d'installation de versions 32 et 64 bits distincts. <table><tbody><tr><th>  Programme / outil </th><th>  La version </th><th>  Chemin d'installation </th></tr><tr><td>  Studio visuel </td><td>  Professionnel 2010 </td><td> <code>C:\Program Files (x86)\Microsoft Visual Studio 10.0\</code> </td> </tr><tr><td>  SDK </td><td>  7.1 </td><td> <code>C:\Program Files\Microsoft SDKs\Windows\v7.1\</code> </td> </tr><tr><td>  SDK </td><td>  8.1 </td><td> <code>C:\Programs\DevKits\8.1\</code> </td> </tr><tr><td>  Wdk </td><td>  7.1.0 </td><td> <code>C:\WinDDK\7600.16385.1\</code> </td> </tr><tr><td>  Activeperl </td><td>  5.26.1 Build 2601 x64 </td><td> <code>C:\Programs\Perl\</code> </td> </tr><tr><td>  ActivePython </td><td>  2.7.14.2717 x64 </td><td> <code>C:\Programs\Python\</code> </td> </tr><tr><td>  WiX </td><td>  3.11.1.2318 </td><td> <code>C:\Programs\WiX\</code> </td> </tr><tr><td>  Qt </td><td>  5.6.3 </td><td> <code>C:\Programs\Qt\5.6.3-{x32|x64}\</code> </td> </tr><tr><td>  MinGW-32 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw32\</code> </td> </tr><tr><td>  MinGW-64 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw64\</code> </td> </tr><tr><td>  Cygwin </td><td>  - </td><td> <code>C:\Programs\cygwin64\</code> </td> </tr><tr><td>  Sdl </td><td>  1.2.15 </td><td> <code>C:\Programs\SDL\{x32|x64}\</code> </td> </tr><tr><td>  cURL </td><td>  7.64.1 </td><td> <code>C:\Programs\curl\{x32|x64}\</code> </td> </tr><tr><td>  Openssl </td><td>  1.1.1b </td><td> <code>C:\Programs\OpenSSL\{x32|x64}\</code> </td> </tr><tr><td>  gSOAP </td><td>  2.8.82 </td><td> <code>C:\Programs\gSOAP\</code> </td> </tr><tr><td>  libvpx </td><td>  1.7.0 </td><td> <code>C:\Programs\libvpx\</code> </td> </tr><tr><td>  libopus </td><td>  1,3 </td><td> <code>C:\Programs\libopus\</code> </td> </tr><tr><td>  MiKTeX Portable </td><td>  2.9.6942 </td><td> <code>C:\Programs\MiKTeX\</code> </td> </tr><tr><td>  NASM </td><td>  2.14.02 x64 </td><td> <code>C:\Programs\nasm\</code> </td> </tr><tr><td>  DocBook XML DTD </td><td>  4.5 </td><td> <code>C:\Programs\DocBook\xml\</code> </td> </tr><tr><td>  Feuilles de style DocBook XSL </td><td>  1.69.1 </td><td> <code>C:\Programs\DocBook\xsl\</code> </td> </tr></tbody></table><a name="environment-inst"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Quirks d'installation des applications </h4><br>  Ici, je donne quelques instructions sur l'installation de certains des outils susmentionnés où la procédure n'est pas évidente ou nécessite des actions supplémentaires. <br><br><h5>  • SDK Windows v7.1 </h5>  L'installation de ce SDK échouera probablement car il inclut les versions obsolètes du compilateur et des bibliothèques d'exécution.  Après avoir installé VS 2010, il existe des versions plus récentes de celles présentes dans le système, de sorte que les anciennes échouent à l'installation et le programme d'installation principal considère qu'il s'agit d'une erreur critique.  Pour contourner ce problème, vous devez décocher les cases correspondantes ou, avant l'installation du SDK, désinstaller les packages nommés comme <i>«Microsoft Visual C ++ 2010 &lt;arch&gt; Redistributable»</i> , <i>«Microsoft Visual C ++ 2010 &lt;arch&gt; Runtime»</i> , <i>«Microsoft Compilateurs Visual C ++ ... "</i>  Laissez le SDK installer les anciennes versions de ceux-ci, puis exécutez Windows Update pour obtenir les dernières versions disponibles. <br><br>  Lorsque vous installez le SDK, assurez-vous de vérifier les exemples de programme (Développement de code natif Windows -&gt; Exemples): ils contiennent certains scripts utilisés par les règles de génération VB.  Sans eux, vous ne pourrez pas créer les packages MSI. <br><br><h5>  • SDK Windows v8.1 </h5>  Il vous suffit d'installer le composant "Kit de développement logiciel Windows". <br><br><h5>  • WDK v7.1 </h5>  Il vous suffit d'installer le composant "Build Environments". <br><br><h5>  • Qt 5.6.3 </h5>  À partir de Qt 5.7.0, pour le construire, vous avez besoin de Visual Studio 2012 ou version ultérieure, nous sommes donc bloqués avec 5.6.x. <br>  Puisqu'il n'y a pas de builds officiels pour Visual Studio 2010, nous devrons construire Qt à partir du code source nous-mêmes. <br><br><ol><li>  Décompressez l'archive de code source de Qt dans <code>C:\Programs\Qt\</code> et renommez le répertoire <code>qt-everywhere-opensource-src-5.6.3</code> en <code>5.6.3-src</code> . </li><li>  À côté, créez un répertoire <code>build-x32</code> où la construction aura lieu. </li><li>  Ouvrez la console et exécutez les commandes suivantes pour préparer l'environnement: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre>  La commande <code>color</code> est facultative, elle supprime la couleur verte qui a été définie par le script <code>SetEnv.Cmd</code> . </li><li>  Nous devons maintenant exécuter le script <code>configure.bat</code> partir de <code>5.6.3-src</code> .  VB n'utilise pas la plupart de ce que Qt inclut, nous pouvons donc réduire considérablement le temps de construction en désactivant divers composants, mais veuillez noter que certaines options sont cruciales pour VB.  En particulier, j'ai découvert que: <ul><li>  OpenGL ES 2 n'est pas pris en charge (lors de la création de VB, le compilateur ne parvient pas à trouver certains fichiers d'en-tête). </li><li>  La prise en charge de FreeType doit être activée (sinon le plugin <code>qoffscreen</code> ne sera pas construit, et il est requis pour VB). </li></ul>  Voici la ligne de commande complète avec laquelle je me suis retrouvé: <pre> <code class="dos hljs">..\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-src\configure.bat -prefix c:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 -mp -opensource -confirm-license -nomake tests -nomake examples -no-compile-examples -release -shared -pch -no-ltcg -accessibility -no-sql-sqlite -opengl desktop -no-openvg -no-nis -no-iconv -no-evdev -no-mtdev -no-inotify -no-eventfd -largefile -no-system-proxies -qt-zlib -qt-pcre -no-icu -qt-libpng -qt-libjpeg -qt-freetype -no-fontconfig -qt-harfbuzz -no-angle -incredibuild-xge -no-plugin-manifests -qmake -qreal double -rtti -strip -no-ssl -no-openssl -no-libproxy -no-dbus -no-audio-backend -no-wmf-backend -no-qml-debug -no-direct2d -directwrite -no-style-fusion -native-gestures -skip qt3d -skip qtactiveqt -skip qtandroidextras -skip qtcanvas3d -skip qtconnectivity -skip qtdeclarative -skip qtdoc -skip qtenginio -skip qtgraphicaleffects -skip qtlocation -skip qtmacextras -skip qtmultimedia -skip qtquickcontrols -skip qtquickcontrols2 -skip qtscript -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview -skip qtx11extras -skip qtxmlpatterns</code> </pre> </li><li>  Le chemin d'installation de Qt spécifié ici (dans l'option <code>-prefix</code> ) est codé en dur dans les fichiers de code source intermédiaires par le script de configuration, donc les fichiers binaires s'en souviendront également.  Toute application basée sur Qt construite à l'aide de cette bibliothèque recherchera d'abord les plugins requis dans ce chemin, et seulement s'ils ne peuvent pas être trouvés, elle utilisera son propre emplacement actuel.  Dans la plupart des cas, cela est OK, mais supposons que sur l'ordinateur où notre VB est installé, il existe une autre version de Qt située dans <code>c:\Programs\Qt\5.6.3-x32</code> , mais compilée avec différentes options ou par un compilateur différent?  Ensuite, VB essaiera de charger ces plugins (incompatibles) et de planter. <br>  Il existe deux façons d'éviter ce problème.  Le premier consiste à ajouter à l'installation un fichier supplémentaire nommé <code>qt.conf</code> avec le texte suivant: <pre> <code class="plaintext hljs">[Paths] Plugins=.</code> </pre>  L'autre consiste à corriger ce chemin d'installation enregistré avant de construire Qt, afin qu'il pointe vers le répertoire de l'application.  J'ai décidé de suivre cette dernière voie, je n'aimais pas l'idée d'avoir des fichiers supplémentaires à ce que la distribution Oracle VB avait.  Vous devez ouvrir le fichier <code>C:\Programs\Qt\build-x32\qtbase\src\corelib\global\qconfig.cpp</code> créé par le script de configuration, recherchez la ligne suivante: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=c:/Programs/Qt/5.6.3-x32"</span></span>;</code> </pre>  et remplacez le chemin par un seul point, de sorte que cette ligne ressemble à ceci: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=."</span></span>;</code> </pre>  Cette modification n'affectera que le comportement d'exécution du VB.  L'étape d'installation de Qt lui-même utilisera le chemin d'origine, car il est maintenant stocké dans les Makefiles que nous ne modifions pas. </li><li>  Ensuite, exécutez la génération à l'aide de la commande <code>nmake</code> </li><li>  Et installez la bibliothèque <code>nmake install</code> aide de <code>nmake install</code> </li></ol><br>  Ouvrez maintenant une nouvelle fenêtre de console et faites de même pour la version 64 bits.  Vous devrez remplacer «x32» par «x64» dans tous les chemins, et les commandes de préparation de l'environnement ressembleront à ceci: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre> <br>  Une fois l'installation terminée, les répertoires <code>build-x32</code> , <code>build-x64</code> et <code>5.6.3-src</code> peuvent être supprimés. <br><br><h5>  • MinGW </h5>  Décompressez simplement les archives 32 et 64 bits dans leurs répertoires d'installation respectifs. <br><br><h5>  • Cygwin </h5>  Lors de l'installation, vous devez choisir les packages <code>make</code> et <code>yasm</code> . <br><br><h5>  • SDL </h5><ol><li>  Décompressez l'archive SDL deux fois dans des chemins distincts: <code>C:\Programs\SDL\x32\</code> et <code>C:\Programs\SDL\x64\</code> . </li><li>  Déplacez tout le contenu du sous-répertoire <code>C:\Programs\SDL\x64\lib\x64\</code> vers son répertoire parent (c'est-à-dire dans <code>C:\Programs\SDL\x64\lib\</code> ), puis supprimez les sous-répertoires <code>C:\Programs\SDL\x64\lib\x86</code> et <code>x64</code> . </li><li>  Faites de même pour la version 32 bits: déplacez le contenu de <code>C:\Programs\SDL\x32\lib\x86\</code> vers <code>C:\Programs\SDL\x32\lib\</code> , puis supprimez <code>C:\Programs\SDL\x64\lib\x86</code> et <code>x64</code> . </li></ol><br><h5>  • NASM </h5>  <code>nasm-2.14.02-win64.zip</code> l'archive <code>nasm-2.14.02-win64.zip</code> dans <code>C:\Programs\</code> , puis renommez le répertoire résultant <code>nasm-2.14.02</code> en <code>nasm</code> . <br><br><h5>  • OpenSSL </h5><ol><li>  Décompressez l'archive OpenSSL dans <code>C:\Programs\OpenSSL\</code> deux fois, renommant les copies du répertoire <code>openssl-1.1.1b</code> en <code>openssl-1.1.1b-x32</code> et <code>openssl-1.1.1b-x64</code> . </li><li>  Ouvrez la console, générez et installez la version 32 bits en exécutant: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x32\ perl Configure VC-WIN32 no-shared --prefix=C:\Programs\OpenSSL\x32 --openssldir=C:\Programs\OpenSSL\x32\ssl nmake nmake test nmake install</code> </pre>  Si l'étape de configuration génère un avertissement effrayant à propos d'un compilateur manquant, veuillez ignorer ce message, il ment de manière scandaleuse. <br>  Si vous ne souhaitez pas utiliser NASM, sautez simplement la commande avec la modification <code>PATH</code> et pour le script <code>Configure</code> , spécifiez le paramètre supplémentaire <code>no-asm</code> . </li><li>  Ouvrez maintenant une nouvelle fenêtre de console et faites de même pour la version 64 bits: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x64\ perl Configure VC-WIN64A no-shared --prefix=C:\Programs\OpenSSL\x64 --openssldir=C:\Programs\OpenSSL\x64\ssl nmake nmake test nmake install</code> </pre>  La désactivation de NASM est la même qu'en 32 bits. </li><li>  Vous pouvez maintenant supprimer les répertoires <code>C:\Programs\OpenSSL\openssl-1.1.1b-x32</code> et <code>openssl-1.1.1b-x64</code> . </li></ol><br><h5>  • cURL </h5><ol><li>  Décompressez l'archive cURL dans <code>C:\Programs\curl\</code> et renommez le sous <code>curl-7.64.1</code> répertoire résultant <code>curl-7.64.1</code> en <code>curl-7.64.1-x32</code> . </li><li>  Ouvrez le fichier <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\MakefileBuild.vc</code> dans un éditeur de texte et recherchez le bloc de code suivant (autour des lignes n ° 61 à 69): <pre> <code class="plaintext hljs">!IF "$(VC)"=="6" CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /Gm /Zi /D_DEBUG /GZ CFLAGS = /I. /I../lib /I../include /nologo /W4 /wd4127 /GX /DWIN32 /YX /FD /c /DBUILDING_LIBCURL !ELSE CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /D_DEBUG /RTC1 /Z7 /LDd CFLAGS = /I. /I ../lib /I../include /nologo /W4 /wd4127 /EHsc /DWIN32 /FD /c /DBUILDING_LIBCURL !ENDIF</code> </pre>  Après ces lignes, ajoutez la nouvelle directive: <pre> <code class="plaintext hljs">CFLAGS = $(CFLAGS) /DCURL_DISABLE_LDAP</code> </pre>  Si vous ne le faites pas, la construction de VB échouera avec des erreurs de lien. </li><li>  Ouvrez maintenant le fichier <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\gen_resp_file.bat</code> , et après la toute première ligne ( <code>@echo OFF</code> ) insérez cette commande: <pre> <code class="plaintext hljs">cd .</code> </pre>  Il ne fait rien, sauf la réinitialisation du code <code>ERRORLEVEL</code> .  Le script est si simple qu'il est possible de le terminer sans exécuter de commande qui changerait le code d'erreur.  Donc, si ce code était différent de zéro avant de démarrer le script, il conservera sa valeur à la sortie du script, et <code>nmake</code> penserait que c'est le script qui a renvoyé ce code d'erreur et terminerait la génération avec échec.  L'ajout de ce faux <code>cd</code> résout le problème. </li><li>  Faites maintenant une copie complète de <code>curl-7.64.1-x32</code> sous le nom <code>curl-7.64.1-x64</code> . </li><li>  Ouvrez la console, créez la version 32 bits et copiez les fichiers dont nous avons besoin: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x32\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x32 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x86 SSL_PATH=C:\Programs\OpenSSL\x32 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x32\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\include\curl ..\..\x32\include\curl\</code> </pre> </li><li>  Ouvrez une autre fenêtre de console et créez la version 64 bits: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x64\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x64 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x64 SSL_PATH=C:\Programs\OpenSSL\x64 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x64\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\include\curl ..\..\x64\include\curl\ <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\bin\curl.exe ..\..\x64\curl.exe</code> </pre>  Notez qu'en plus de ce que nous avons fait pour la version 32 bits, nous copions ici également le fichier <code>curl.exe</code> .  Nous l'utiliserons plus tard pour télécharger l'image des ajouts d'invités. </li><li>  Les répertoires <code>C:\Programs\curl\curl-7.64.1-x32</code> et <code>curl-7.64.1-x64</code> ne sont plus nécessaires et peuvent être supprimés. </li></ol><br><h5>  • libvpx </h5><ol><li>  Décompressez l'archive libvpx dans <code>C:\Programs\libvpx-build\</code> . </li><li>  Lancez le terminal Cygwin, la construction y sera effectuée.  Notre plate-forme cible est Visual Studio 2010;  le système de build ne le prend en charge que partiellement: il tentera d'exécuter la build réelle à l'aide de <code>msbuild.exe</code> mais cela ne fonctionne pas pour une raison quelconque;  Je n'ai pas réussi à comprendre pourquoi.  Au lieu de cela, nous pouvons simplement exécuter Visual Studio lui-même et l'utiliser pour créer le projet.  Heureusement, il peut être utilisé à partir de la ligne de commande, il n'est donc pas nécessaire de lancer l'IDE réel (bien que vous puissiez le faire si vous le souhaitez, auquel cas vous devrez modifier la variable <code>PATH</code> et ajouter le chemin <code>C:\Programs\cygwin64\bin</code> , ou de toute autre manière, permettre à VS de trouver <code>yasm.exe</code> situé là et requis pour la construction).  Ainsi, pour effectuer la construction des deux architectures, exécutez les commandes suivantes dans le terminal Cygwin: <pre> <code class="bash hljs">mkdir -p /cygdrive/c/Programs/libvpx-build/build32 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build32 ../libvpx-1.7.0/configure --target=x86-win32-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|Win32"</span></span> make install mkdir -p /cygdrive/c/Programs/libvpx-build/build64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build64 ../libvpx-1.7.0/configure --target=x86_64-win64-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|x64"</span></span> make install</code> </pre> </li><li>  Fermez Cygwin, nous n'en aurons plus besoin.  Le répertoire <code>C:\Programs\libvpx-build</code> peut être supprimé. </li></ol><br><h5>  • libopus </h5><ol><li>  Décompressez l'archive opus dans <code>C:\Programs\libopus-build\</code> , allez dans le sous <code>opus-1.3\win32\VS2015</code> répertoire <code>opus-1.3\win32\VS2015</code> . </li><li>  Ce projet est conçu pour la nouvelle version de Visual Studio, nous devons donc le modifier pour le faire construire dans notre version 2010. Vous pouvez le faire en utilisant l'IDE ou un éditeur de texte brut.  J'ai choisi ce dernier.  Ouvrez le fichier <code>opus.vcxproj</code> et procédez comme suit: <ol><li>  Trouver toutes les lignes contenant le texte <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span>v140<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  et remplacez <code>v140</code> par <code>v100</code> .  Si vous utilisez IDE, il s'agit de l'option de configuration "Platrofm Toolset" située sur la page Configuration Properties -&gt; General.  N'oubliez pas les sélecteurs de configuration et de plate-forme en haut de la boîte de dialogue. </li><li>  Ensuite, recherchez ce bloc de code: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemDefinitionGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClCompile</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  et ajoutez une nouvelle balise à l'intérieur: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span>ProgramDatabase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  Dans l'EDI, vous pouvez le faire en ouvrant la page Propriétés de configuration -&gt; C / C ++ -&gt; Général et en définissant "Debug Information Format" dans "ProgramDatabase (/ Zi)".  En fait, vous pouvez le définir sur n'importe quelle autre valeur valide, nous n'avons pas du tout besoin de la base de données de débogage, mais avec une valeur non valide, le projet ne parviendra pas à se construire. </li></ol></li><li>  Maintenant, construisons la version Release pour les deux plates-formes (en utilisant soit l'IDE VS, soit la ligne de commande) et copions la bibliothèque <code>opus.lib</code> et le sous <code>include\</code> répertoire <code>include\</code> dans notre chemin de destination: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\win32\VS2015 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\x64 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\Win32 <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /EC:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\include C:\Programs\libopus\include\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|x64" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> x64\Release\opus.lib C:\Programs\libopus\lib\x64\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|Win32" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> Win32\Release\opus.lib C:\Programs\libopus\lib\Win32\</code> </pre> </li><li>  Le répertoire <code>C:\Programs\libopus-build</code> peut être supprimé. </li></ol><br><h5>  • gSOAP </h5>  Ouvrez l'archive, allez dans le sous <code>gsoap-2.8\gsoap</code> répertoire <code>gsoap-2.8\gsoap</code> et décompressez son contenu dans <code>C:\Programs\gSOAP\</code> .  OpenSSL 1.1.x nécessite gSOAP version 2.8.41 ou supérieure.  Si, pour une raison quelconque, vous souhaitez utiliser une ancienne version, vous devrez appliquer le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">correctif</a> créé par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mattias Ellert</a> .  L'application d'un correctif peut se faire soit manuellement (le format est simple: ouvrez les fichiers mentionnés, supprimez les lignes marquées avec moins, ajoutez des lignes marquées avec plus; le reste est le contexte), ou obtenez l'outil de <code>patch</code> porté pour Windows et utilisez-le. <br><br><h5>  • MiKTeX </h5><ol><li>  Décompressez l'archive dans <code>C:\Programs\MiKTeX\</code> . </li><li>  Ouvrez la console et installez des modules supplémentaires: <pre> <code class="dos hljs">"C:\Programs\MiKTeX\texmfs\install\miktex\bin\mpm.exe" --verbose --install=koma-script --install=ucs --install=tabulary --install=url --install=fancybox --install=fancyvrb --install=bera --install=charter --install=mptopdf</code> </pre> </li></ol><br><h5>  • DocBook </h5>  Pour la DTD XML, vous devez créer un répertoire et y décompresser le contenu de l'archive.  Pour les feuilles de style XSL, tout le contenu est déjà dans un seul répertoire, vous devez donc l'extraire et le renommer ensuite. <br><br><a name="final-touches"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Touche finale </h4><br>  L'environnement de génération est presque prêt, quelques étapes supplémentaires sont nécessaires.  Téléchargez l'archive du code source de VirtualBox (si vous ne l'avez pas encore fait) et décompressez-la là où vous souhaitez travailler.  J'ai choisi <code>C:\Devel\</code> à cet effet, y ai mis les codes sources décompressés et renommé le sous-répertoire en <code>VirtualBox-src</code> . <br><br><h5>  • Ajout de certificats </h5><br>  Si vous n'avez pas de certificat payant, je vous recommande de créer au moins un certificat personnel auto-signé: il est plus facile de faire charger Windows des pilotes auto-signés que des pilotes non signés.  Pour ce faire, ouvrez la console avec des privilèges élevés et exécutez les commandes suivantes qui ajouteront deux certificats (SHA-1 et SHA-256) et les importeront dans votre stockage personnel: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> makecert.exe -a sha1 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_1.cer makecert.exe -a sha256 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_256.cer certmgr.exe -add C:\Devel\testcert_1.cer -s -r localMachine root certmgr.exe -add C:\Devel\testcert_256.cer -s -r localMachine root</code> </pre>  Vous pouvez, bien sûr, choisir votre propre nom pour les certificats au lieu de "Roga and Kopyta Ltd", et le chemin pour stocker les fichiers.  Maintenant, nous devons obtenir les empreintes des certificats générés.  Ouvrez la console de gestion des certificats (en exécutant <code>certmgr.msc</code> ) et accédez au stockage personnel.  Vous y verrez les deux nouveaux certificats nommés "Roga et Kopyta Ltd".  Double-cliquez sur le premier;  dans la boîte de dialogue qui apparaît, accédez à l'onglet <i>Détails</i> .  Le champ "Algorithme de signature" contient le nom de l'algorithme: sha256RSA ou sha1RSA.  Faites défiler vers le bas pour le champ "Thumbprint" qui contient la séquence de nombres hexadécimaux.  Copiez cette valeur complète et notez-la quelque part.  Faites de même pour le deuxième certificat;  n'oubliez pas de marquer quelle empreinte numérique était pour SHA-1 et laquelle pour SHA-256. <br><br><h5>  • Construction de xmllint </h5><br>  L'une des étapes de construction nécessite le programme <code>xmllint</code> .  Je ne l'ai pas mis dans la liste des exigences de construction car ses sources sont regroupées dans l'archive VirtualBox.  Mais vous devrez toujours le construire vous-même, car les règles de construction VB ne le font pas.  J'ai choisi <code>C:\Programs\xmllint</code> comme répertoire de destination. <ol><li>  Copiez le répertoire <code>C:\Devel\VirtualBox-src\src\libs\libxml2-2.9.4</code> dans <code>C:\Programs\</code> pour vous assurer que sa construction n'affecte en aucun cas VB. </li><li>  Ouvrez la console et exécutez les commandes suivantes: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libxml2-<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>\win32 cscript.exe configure.js cruntime=/MT prefix=C:\Programs\xmllint iconv=no nmake /f Makefile.msvc nmake /f Makefile.msvc install</code> </pre> </li><li>  Supprimez le répertoire <code>C:\Programs\libxml2-2.9.4</code> . </li></ol><br><h5>  • Modifications des fichiers VB </h5><br>  Avant de commencer la construction, nous devons également apporter des modifications au code source VB.  L'ensemble complet d'entre eux est présenté ici sous la forme d'un fichier de patch téléchargeable qui peut être appliqué soit manuellement, soit en utilisant l'outil de <code>patch</code> (que vous devez télécharger séparément): <br><br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Vbox_build.patch</b></a> <br><br>  S'il n'y a eu aucun problème lors de l'application du patch, vous pouvez passer à l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">étape suivante</a> .  Cependant, si vous avez eu des problèmes et avez besoin de plus d'informations sur des changements particuliers, ou si vous voulez simplement comprendre ce qui est changé et pourquoi, vous êtes invités à continuer et à lire les détails fournis ci-dessous.  Veuillez noter que les modifications viennent ici dans un ordre différent par rapport au fichier de patch.  Les chemins d'accès aux fichiers sont spécifiés par rapport au répertoire de code source VB <code>C:\Devel\VirtualBox-src</code> . <ol><li>  Fichier <code>configure.vbs</code> : <ul><li>  La ligne de code: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>), <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  est remplacé par: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" /?"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  Cette ligne effectue la vérification du compilateur, mais elle oublie que <code>cl.exe</code> sans aucun argument renvoie une erreur et est donc considéré comme un compilateur non valide.  Ajout du " <code>/?</code>  "L'argument fait sortir l'aide et quitter avec le code non-erreur 0. </li><li>  Passons maintenant à la fonction <code>CheckForMinGW32Sub</code> .  Comme son nom l'indique, il vérifie la validité du MinGW 32 bits.  Cependant, il est conçu pour la version 3.3.3, alors que j'utilise 4.5.4 qui a une structure de fichiers / répertoires différente, j'ai donc remplacé la fonction entière par le code suivant (qui est fondamentalement juste une copie de <code>CheckForMinGWw64Sub</code> adapté pour le Variante 32 bits): <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> CheckForMinGW32Sub(strPathMingW32, strPathW32API) g_strSubOutput = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> strPathW32API = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> strPathW32API = strPathMingW32 LogPrint <span class="hljs-string"><span class="hljs-string">"trying: strPathMingW32="</span></span> &amp;strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">" strPathW32API="</span></span> &amp; strPathW32API <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/gcc.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/ld.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/objdump.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dllwrap.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dlltool.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/as.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"include/bfd.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"lib32/libgcc_s.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt1.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt2.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcrt.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcr100.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/_mingw.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/stdint.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/windows.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">"/bin/gcc.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" -dumpversion"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dim</span></span> offVer, iMajor, iMinor, iPatch, strVer <span class="hljs-comment"><span class="hljs-comment">' extract the version. strVer = Trim(Replace(Replace(g_strShellOutput, vbCr, ""), vbLf, "")) if (Mid(strVer, 2, 1) = ".") _ And (Mid(strVer, 4, 1) = ".") then iMajor = Int(Left(strVer, 1)) ' Is Int() the right thing here? I want atoi()!!! iMinor = Int(Mid(strVer, 3, 1)) iPatch = Int(Mid(strVer, 5)) else LogPrint "Malformed version: '" &amp; strVer &amp; "'" strVer = "" end if if strVer &lt;&gt; "" then if (iMajor = 4) And (iMinor &gt;= 4) then CheckForMinGW32Sub = True g_strSubOutput = strVer else LogPrint "MinGW32 version '" &amp; iMajor &amp; "." &amp; iMinor &amp; "." &amp; iPatch &amp; "' is not supported (or configure.vbs failed to parse it correctly)." end if else LogPrint "Couldn't locate the GCC version in the output!" end if else LogPrint "Failed to run gcc.exe!" end if end if end function</span></span></code> </pre> </li><li>  Notre prochaine fonction est <code>CheckForCurlSub</code> , et le bloc de code à éditer est: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.dll"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre>  Il vérifie la validité de libcurl, mais il nécessite une version liée dynamiquement et échoue si aucun fichier DLL ne peut être trouvé.  Nous utilisons une version liée statiquement, donc la vérification de la DLL doit malheureusement nous laisser: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre> </li><li>  Allez maintenant dans la fonction <code>CheckForPython</code> où la variable <code>VBOX_BLD_PYTHON</code> est générée: <pre> <code class="vbscript hljs"> CfgPrint <span class="hljs-string"><span class="hljs-string">"VBOX_BLD_PYTHON := "</span></span> &amp; strPathPython &amp; <span class="hljs-string"><span class="hljs-string">"\python.exe"</span></span></code> </pre>  La barre oblique inverse devant <code>python.exe</code> doit être remplacée par la suivante: <code>"/python.exe"</code> (sans ce correctif, certaines vérifications pendant la procédure de génération échoueront; je n'ai remarqué aucun autre effet indésirable, mais c'est plus joli sans messages d'échec, et en tout cas mieux vaut prévenir que guérir). </li><li>  La version Windows du script de configuration ne prend pas en charge libvpx et libopus, je les ai donc ajoutées moi-même.  Bien sûr, le moyen le plus simple était de coder en dur les chemins vers les bibliothèques, mais j'ai préféré l'implémenter comme tous les autres composants, en passant le chemin dans la ligne de commande et en vérifiant correctement la validité.  Le code principal pour cela se compose des deux fonctions de vérification: <pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'' ' Checks for libvpx sub CheckForVpx(strOptVpx) dim strPathVpx, str strVpx = "libvpx" PrintHdr strVpx if strOptVpx = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathVpx = "lib/" &amp; strVsBuildArch &amp; "/vpxmd.lib" strPathVpx = "" if LogFileExists(strOptVpx, "include/vpx/vpx_encoder.h") _ And LogFileExists(strOptVpx, strLibPathVpx) _ then strPathVpx = UnixSlashes(PathAbs(strOptVpx)) CfgPrint "SDK_VBOX_VPX_INCS := " &amp; strPathVpx &amp; "/include" CfgPrint "SDK_VBOX_VPX_LIBS := " &amp; strPathVpx &amp; "/" &amp; strLibPathVpx else MsgError "Can't locate " &amp; strVpx &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strVpx, strPathVpx end sub '' ' Checks for libopus sub CheckForOpus(strOptOpus) dim strPathOpus, str strOpus = "libopus" PrintHdr strOpus if strOptOpus = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathOpus = "lib/" &amp; strVsBuildArch &amp; "/opus.lib" strPathOpus = "" if LogFileExists(strOptOpus, "include/opus.h") _ And LogFileExists(strOptOpus, strLibPathOpus) _ then strPathOpus = UnixSlashes(PathAbs(strOptOpus)) CfgPrint "SDK_VBOX_OPUS_INCS := " &amp; strPathOpus &amp; "/include" CfgPrint "SDK_VBOX_OPUS_LIBS := " &amp; strPathOpus &amp; "/" &amp; strLibPathOpus else MsgError "Can't locate " &amp; strOpus &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strOpus, strPathOpus end sub</span></span></code> </pre>  L' <code>usage</code> fonction est utilisée pour imprimer la liste des arguments de ligne de commande;  y ajouter nos deux nouveaux arguments: <pre> <code class="vbscript hljs"> Print <span class="hljs-string"><span class="hljs-string">" --with-libvpx=PATH "</span></span> Print <span class="hljs-string"><span class="hljs-string">" --with-libopus=PATH "</span></span></code> </pre>  Au début de la fonction <code>Main</code> nombreuses variables sont définies pour stocker les chemins d'accès aux composants, nous devons en ajouter deux nouvelles: <pre> <code class="vbscript hljs"> strOptVpx = <span class="hljs-string"><span class="hljs-string">""</span></span> strOptOpus = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre>  Un peu plus loin, le bloc de <code>select-case</code> qui traite les arguments et remplit les variables;  en ajoutant notre contribution: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libvpx"</span></span> strOptVpx = strPath <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libopus"</span></span> strOptOpus = strPath</code> </pre>  Et, enfin, presque à la toute fin du fichier, il y a la chaîne de tous ces appels de fonction de vérification, c'est là que nous ajoutons l'appel de nos deux nouvelles fonctions: <pre> <code class="vbscript hljs"> CheckForVpx strOptVpx CheckForOpus strOptOpus</code> </pre> </li></ul></li><li>  Le fichier suivant est <code>src\VBox\Runtime\Makefile.kmk</code> .  Nous devons trouver les définitions des variables <code>VBoxRT_LIBS.win</code> et <code>VBoxRT-x86_LIBS.win</code> , et y ajouter deux nouvelles bibliothèques, <code>crypt32.lib</code> et <code>bcrypt.lib</code> .  Donc, le code suivant: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib</code> </pre>  se transforme en: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/bcrypt.lib</code> </pre>  (ne manquez pas la barre oblique inverse après <code>delayimp.lib</code> !);  et, respectivement, ce bloc: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib</code> </pre>  devient: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/bcrypt.lib</code> </pre>  Cette modification est nécessaire pour une liaison réussie de <code>VBoxRT.dll</code> .  Je ne suis pas sûr à 100% pourquoi il en est ainsi, la version Oracle n'a pas la dépendance au moment du chargement sur <code>crypt32.dll</code> , elle est chargée au moment de l'exécution, donc le fichier LIB ne devrait pas être requis.  Cependant sans lui, l'éditeur de liens ne peut pas trouver certaines fonctions et échoue.  Je soupçonne que cela pourrait être lié aux options de construction d'OpenSSL, mais je ne l'ai pas vérifié, l'ajout de la dépendance est plus facile.  Et la deuxième dépendance, <code>bcrypt.dll</code> , est une exigence pour le nouveau OpenSSL 1.1.1. </li><li>  Si vous avez gSOAP de la version 2.8.79 ou supérieure, vous devrez modifier le fichier <code>src\VBox\Runtime\r3\win\VBoxRT-openssl-1.1plus.def</code> et ajouter les lignes suivantes à la liste des exportations: <pre> <code class="plaintext hljs"> OpenSSL_version_num DH_generate_parameters_ex DH_new ASN1_STRING_get0_data</code> </pre>  Cette liste définit quelles fonctions sont exportées par la bibliothèque <code>VBoxRT.dll</code> (qui contient OpenSSL à l'intérieur).  Lorsque l'outil <code>VBoxWebSrv.exe</code> est lié, selon la version de gSOAP, il peut nécessiter des fonctions OpenSSL supplémentaires.  Puisqu'ils manquent dans la liste des exportations, l'éditeur de liens ajoute OpenSSL lui-même et se plaint immédiatement de tonnes de conflits entre cet OpenSSL externe et sa propre copie déjà intégrée à <code>VBoxRT</code> .  L'ajout des exportations susmentionnées résout le problème. </li><li>  Comme je l'ai mentionné au début, je ne crée pas les ajouts d'invités, mais j'ai besoin que leur image ISO fasse partie de la distribution.  Les règles de construction sont conçues pour ce scénario, mais elles s'attendent à ce que l'image ISO prête apparaisse comme par magie au bon endroit au bon moment.  J'ai ajouté cette magie dans le fichier <code>src\VBox\Makefile.kmk</code> .  Recherchez le code suivant: <pre> <code class="plaintext hljs"> ifdef VBOX_WITH_ADDITIONS include $(PATH_SUB_CURRENT)/Additions/Makefile.kmk endif</code> </pre>  et juste en dessous, il y a la règle pour le téléchargement automatique du fichier image: <pre> <code class="plaintext hljs"> ifndef VBOX_WITHOUT_ADDITIONS_ISO $(VBOX_PATH_ADDITIONS_ISO)/VBoxGuestAdditions.iso: $(QUIET)$(MKDIR) -p $(@D) $(VBOX_RETRY) $(TOOL_CURL_FETCH) http://download.virtualbox.org/virtualbox/$(VBOX_VERSION_STRING_RAW)/VBoxGuestAdditions_$(VBOX_VERSION_STRING_RAW).iso -o $@ endif</code> </pre>  Si vous modifiez les fichiers manuellement au lieu d'appliquer le correctif, veuillez noter que les commandes de règle doivent commencer par le caractère de tabulation. </li><li>  Avant la version 6.0, la documentation était l'un des sous-systèmes qui s'est construit avec succès sans aucune modification.  Je ne sais pas ce qui n'allait pas, mais il a été considérablement repensé de telle sorte qu'il ne fonctionne plus sur mon système de génération.  Je n'ai aucune idée de la façon dont Oracle construit lui-même la documentation (peut-être sur un système * NIX), mais pour moi, les règles de construction ont continué à perdre des barres obliques dans les chemins, ou à en ajouter un excès, et en conséquence, elles n'ont pas réussi à trouver les fichiers cibles en raison de disparités dans les fichiers de catalogue.  J'ai finalement réussi à combiner quelques modifications qui ont permis de construire la documentation sans erreur.  Tout d'abord, l'un des répertoires cibles était manquant, de sorte que certains des fichiers intermédiaires n'ont pas pu être créés.  Ce problème est résolu dans le fichier <code>doc\manual\Makefile.kmk</code> , à l'intérieur du bloc de code suivant: <pre> <code class="plaintext hljs">define def_vbox_refentry_to_user_sect1 $$(VBOX_PATH_MANUAL_OUTBASE)/$(1)/user_$(2): $(3) \ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl \ $$(VBOX_XML_CATALOG) $$(VBOX_XML_CATALOG_DOCBOOK) $$(VBOX_XML_CATALOG_MANUAL) \ $$(VBOX_VERSION_STAMP) | $$(dir $$@) $$(call MSG_TOOL,xsltproc $$(notdir $$(filter %.xsl,$$^)),,$$(filter %.xml,$$^),$$@) $$(QUIET)$$(RM) -f "$$@" $$(QUIET)$$(call VBOX_XSLTPROC_WITH_CAT) --output $$@ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl $$&lt; endef</code> </pre>  Juste après le <code>$$(RM)</code> j'ai ajouté une commande pour créer le répertoire manquant: <pre> <code class="plaintext hljs"> $$(QUIET)$$(MKDIR) -p "$$(@D)"</code> </pre> <br>  Quant aux barres obliques, les correctifs se trouvent dans le fichier <code>doc\manual\Config.kmk</code> .  Je n'ai pas pu trouver de solution «normale» pour cela, mais il existe une solution de contournement suffisamment bonne pour des raisons pratiques, ce qui implique de dupliquer les règles de substitution de chemin pour les chemins incorrects.  Tout d'abord, sous la ligne: <pre> <code class="plaintext hljs"> VBOX_FILE_URL_MAYBE_SLASH = $(if $(eq $(KBUILD_HOST),win),/,)</code> </pre> I've created two new variables which basically contain the same paths as their origins, but with triple slash after the disk letter instead of a single slash: <pre> <code class="plaintext hljs"> VBOX_PATH_MANUAL_SRC_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_SRC)) VBOX_PATH_MANUAL_OUTBASE_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_OUTBASE))</code> </pre> A little bit below that, there is a rule for creating the catalog file: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> For each line which contains the variable <code>VBOX_PATH_MANUAL_SRC</code> or <code>VBOX_PATH_MANUAL_OUTBASE</code> (except for the line with the <code>file://</code> prefix), I've appended the copy of the whole line, but with the variable replaced with its triple-slash counterpart. The result looks like this: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> Even further down, there is another rule for creating an auxiliary catalog file; the starting line is: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG_MANUAL): $(MAKEFILE_CURRENT) | $$(dir $$@)</code> </pre> Here I'm doing the same operation as above. In addition, in the beginning of the generated file there are several lines defining the entries in the <code>common/</code> subdirectory: <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> With these we have the opposite problem: triple slash after the <code>file</code> is replaced with a single slash. I worked this around by getting rid of the <code>file</code> protocol altogether and replacing those URIs with direct file system paths in the target address (the <code>uri</code> attribute). The result for these lines looks like this (including the aforementioned fix): <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> </li><li> When VB is built with signing, most of its binaries receive the integrity check flag (the linker option <code>/IntegrityCheck</code> ) which forces Windows to check digital signatures and forbids launching applications which are signed incorrectly. If you have a valid paid certificate that's not a problem; however with a self-signed certificate VB will refuse to start, even if Windows is booted in the test mode. I've modified the file <code>Config.kmk</code> in such a way that this flag is only added when you have a full-grown certificate (the criterion of that is presence of a cross-certificate in <code>LocalConfig.kmk</code> ; see <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">below</a> ). The changes look like this: <ul><li> A new variable <code>VBOX_INTEGRITY_CHECK</code> is added, which contains the desired value of the option: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) VBOX_INTEGRITY_CHECK := /IntegrityCheck else VBOX_INTEGRITY_CHECK := /IntegrityCheck:NO endif</code> </pre> </li><li> Below that there is the <code>editbin</code> call: <pre> <code class="plaintext hljs"> $(VBOX_VCC_EDITBIN) /LargeAddressAware /DynamicBase /NxCompat /Release /IntegrityCheck \ /Version:$(VBOX_VERSION_MAJOR)0$(VBOX_VERSION_MINOR).$(VBOX_VERSION_BUILD) \ "$@"</code> </pre> Here I've replaced the unconditional <code>/IntegrityCheck</code> with the new variable <code>$(VBOX_INTEGRITY_CHECK)</code> . </li><li> Next, look for the blocks of the following kinds: <pre> <code class="plaintext hljs">ifdef VBOX_SIGNING_MODE TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre>  ou <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_WITH_HARDENING) TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre> where « <code>XXXXXX</code> » stands for various component names. There are 6 such blocks in total, 3 of each kind. Here I've modified the condition by adding a check for cross-certificate. The first line then turns into, respectively: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE)</code> </pre>  ou <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) &amp;&amp; defined(VBOX_WITH_HARDENING)</code> </pre> </li></ul></li><li> Two more files modified by me do not take immediate part in building of VB: <code>src\VBox\Installer\win\Scripts\PackDriversForSubmission.cmd</code> and <code>UnpackBlessedDrivers.cmd</code> . These auxiliary scripts can be used if you intend to send the drivers into Microsoft for Windows 10 signing. The first script prepares a CAB archive for sending; the second one unpacks the resultant ZIP archive with the signed drivers and verifies the signatures. In the packing script all I did was just fixing several typos. In the unpacking script I added ability to specify path to the <code>signtool</code> program, and got rid of the <code>unzip</code> tool by replacing it with a small Perl script. The signing procedure is described below. If you don't plan to get the Microsoft signature you can simply ignore all these changes in the scripts. </li></ol><br><a name="final-touches-localconfig"></a><h5> • VB build configuration file </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, nous devons créer le fichier </font></font><code>LocalConfig.kmk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le répertoire des sources VB et y écrire tous les chemins et paramètres de construction. </font><font style="vertical-align: inherit;">Vous pouvez utiliser le texte suivant comme modèle:</font></font><pre> <code class="plaintext hljs">VBOX_WITH_HARDENING := VBOX_PATH_WIX := C:\Programs\WiX VBOX_GSOAP_INSTALLED := 1 VBOX_PATH_GSOAP := C:\Programs\gSOAP VBOX_WITH_COMBINED_PACKAGE := 1 VBOX_WITH_QT_PAYLOAD := 1 VBOX_WITH_QTGUI_V5 := 1 VBOX_SIGNING_MODE := release VBOX_CERTIFICATE_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_CERTIFICATE_SHA2_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_SHA2_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_TSA_URL := http://timestamp.digicert.com VBOX_TSA_SHA2_URL := http://timestamp.digicert.com VBOX_TSA_URL_ARGS := /t "$(VBOX_TSA_URL)" VBOX_TSA_SHA2_URL_ARGS := /tr "$(VBOX_TSA_SHA2_URL)" /td sha256 VBOX_CROSS_CERTIFICATE_FILE := VBOX_CROSS_CERTIFICATE_FILE_ARGS := VBOX_CROSS_CERTIFICATE_SHA2_FILE := VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS := VBOX_PATH_SIGN_TOOLS := C:\Programs\DevKits\8.1\bin\x64 VBOX_PATH_SELFSIGN := C:\WinDDK\7600.16385.1\bin\selfsign VBOX_PATH_WISUMINFO := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSumInf.vbs" VBOX_PATH_WISUBSTG := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSubStg.vbs" VBOX_WITH_DOCS := 1 VBOX_WITH_DOCS_CHM := 1 VBOX_WITH_DOCS_PACKING := 1 VBOX_WITH_ADDITIONS := VBOX_WITH_ADDITIONS_PACKING := 1 VBOX_HAVE_XMLLINT := 1 VBOX_XMLLINT := C:\Programs\xmllint\bin\xmllint.exe VBOX_PATH_DOCBOOK := C:/Programs/DocBook/xsl VBOX_PATH_DOCBOOK_DTD := C:/Programs/DocBook/xml VBOX_PATH_HTML_HELP_WORKSHOP := "C:\Program Files (x86)\HTML Help Workshop" VBOX_PDFLATEX := C:\Programs\MiKTeX\texmfs\install\miktex\bin\pdflatex.exe VBOX_PDFLATEX_CMD := $(VBOX_PDFLATEX) -halt-on-error -interaction batchmode TOOL_CURL_FETCH := C:\Programs\curl\x64\curl.exe PATH_TOOL_NASM := C:/Programs/nasm VBOX_INSTALLER_LANGUAGES := en_US VBOX_WITH_TESTCASES := VBOX_WITH_VALIDATIONKIT := VBOX_WITH_VBOX_IMG := 1 VBOX_WITH_RECORDING := 1 VBOX_WITH_AUDIO_RECORDING := 1 SDK_VBOX_VPX := 1 VBOX_WITH_LIBVPX := 1 SDK_VBOX_OPUS := 1 VBOX_WITH_LIBOPUS := 1 VBOX_BUILD_PUBLISHER := _OSE</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vous devrez modifier ce modèle: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les variables </font></font><code>VBOX_CERTIFICATE_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>VBOX_CERTIFICATE_SHA2_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doivent contenir les noms des certificats SHA-1 et SHA-256, respectivement.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les variables </font></font><code>VBOX_CERTIFICATE_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>VBOX_CERTIFICATE_SHA2_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doivent contenir les empreintes de ces certificats; </font><font style="vertical-align: inherit;">vous les avez copiés précédemment à partir de la console de gestion des certificats.</font></font></li><li> If you have a paid certificate you should delete the lines defining the variables <code>VBOX_CROSS_CERTIFICATE_FILE_ARGS</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS</code> , then in the variables <code>VBOX_CROSS_CERTIFICATE_FILE</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE</code> (without « <code>_ARGS</code> ») put the full path to the cross-certificate (without it the drivers will not be accepted). You can download it from the web site of the company that issued the certificate, or <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">from Microsoft</a> . </li><li> You can fine-tune the signing process using various additional variables and macros to redefine the certificate storage, timestamp server, or even construct a full command line for the <code>signtool</code> program. You can take a look into the file <code>Config.kmk</code> below the comment «Code Signing», there you'll find which variables are defined and how they are used. </li><li> If you've installed some of the programs into paths different from mine, you need to fix those paths in the template. It's strongly recommended to keep the path style for each variable (forward/backward slashes), sometimes it's critical for successful build. </li><li> Fox WiX you need to specify the path to its binaries. With the portable version, it is just the directory where you unpacked it; if you used the installer, the binaries will be located in the subdirectory <code>bin</code> . Please, note, that the path must not contain spaces! If it does you have to convert it into the 8.3 format (you can use <code>dir /x</code> for that). Unfortunately, enclosing the path in quotes does not work with this variable. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La variable </font></font><code>VBOX_BUILD_PUBLISHER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spécifie le suffixe de marque dans le numéro de version. </font><font style="vertical-align: inherit;">Par défaut, il s'agit de "_OSE" (c'est-à-dire que la version complète du produit est "6.0.4_OSE"). </font><font style="vertical-align: inherit;">Vous pouvez spécifier ici tout autre suffixe ou le mettre à vide pour vous en débarrasser complètement. </font><font style="vertical-align: inherit;">Mais si vous supprimez complètement la variable, elle utilisera la valeur par défaut "_OSE".</font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les autres variables sont principalement utilisées pour déclarer les composants à construire. </font><font style="vertical-align: inherit;">Et, bien sûr, la déclaration principale vient tout en haut: désactivez le durcissement.</font></font><br><br><a name="build-vb"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Création de virtualbox </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, nous pouvons maintenant commencer à construire VirtualBox lui-même. </font><font style="vertical-align: inherit;">Si vous préférez normalement construire pour différentes plates-formes en parallèle, vous devrez vous en passer pour l'instant, ou utiliser deux copies d'arborescence source distinctes, car VB a un fichier de configuration commun qui est généré avant la construction et contient des données dépendantes de la plate-forme. </font><font style="vertical-align: inherit;">Il ne serait pas agréable pour le compilateur de le jeter soudainement de l'environnement de construction 64 bits dans l'environnement 32 bits au milieu du processus de construction. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez besoin de signatures de pilotes compatibles Windows 10, veuillez vous reporter aux informations fournies après la description de la procédure principale.</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commençons par la version 64 bits. </font><font style="vertical-align: inherit;">Ouvrez la console et exécutez les commandes suivantes:</font></font><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=amd64 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x64 --with-openssl=C:\Programs\OpenSSL\x64 --with-openssl32=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x64 --with-libcurl32=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x64 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/obj/Installer/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch_amd64.msi</code> </pre> The <code>configure.vbs</code> script verifies the environment and generates configuration files ( <code>AutoConfig.kmk</code> and <code>env.bat</code> ). The first <code>kmk</code> command builds the binaries and collect them into <code>out\win.amd64\bin\</code> . And the last command packs them all into the intermediate MSI package. Important notes: <ul><li> You must use forward slashes in the last command. With backslashes, <code>kmk</code> would fail to find the build rules. </li><li> Even though we are building the 64-bit version, the target package is located in <code>out\win.x86\…</code> , because the final stage of the build will be performed from the 32-bit build environment. </li><li> If you've changed the branding suffix you need to change the name of the target package by replacing the «_OSE» with what you specified in the variable <code>VBOX_BUILD_PUBLISHER</code> . </li><li> The revision number in the MSI package name (128164) can be found in the file <code>Config.kmk</code> inside the <code>VBOX_SVN_REV_FALLBACK</code> variable definition. Please, note, that this value may be different from revisions of the official distribution (for instance, the version 6.0.4 has release number 128413). Unfortunately, I have no idea why. </li></ul></li><li> Now we need to build the 32-bit version and pack everything together. For that, open a new console window, and run the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=x86 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x32 --with-openssl=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/bin/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch.exe</code> </pre> Same as with the 64-bit, you need to replace the «_OSE» suffix with what you have. <br> Notice how in the last command we are building an <code>EXE</code> , and not an <code>MSI</code> . This is the final installer which will cause the 32-bit package to be built automatically, from dependencies. </li><li> Even if you have a paid certificate you will find that you cannot install this distribution into Windows 10 booted with Secure Boot enabled. This OS has stricter requirements, and the drivers must be signed by none other than Microsoft themselves. The procedure is explained in details on various Internet resources and is unrelated to this article, so I'm not going to go deep into this topic. Instead I'll outline the main steps you need to take for integrating this task with the VB build procedure. <ul><li> The main requirement here is that you must have not just a normal code signing certificate, but an EV one (Extended Validation). Also you need to register an account at <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Hardware Dev Center</a> and add your certificate there. </li><li> Now, during building the 64-bit version of VB, just after you've got all binary components (that is, after the first <code>kmk</code> run which was without arguments), you need to create a CAB archive with the drivers. There is a batch script template for that; the build system modifies it according to the current task and puts it into <code>out\win.amd64\release\repack\</code> . Go into this path and run the following command: <pre> <code class="dos hljs">PackDriversForSubmission.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -x</code> </pre> When the script finishes, the file <code>VBoxDrivers-6.0.4r128164-amd64.cab</code> will appear in the same directory. </li><li> You need to sign this CAB archive with your EV certificate. Then go to the Microsoft Hardware Dev Center, create a new submission, upload your signed archive, select the desired target OS version (make sure it's 64-bit) and send the submission. </li><li> It will take several minutes to process, after which you will have a ZIP archive where all the drivers have been signed by Microsoft in addition to your signature, and all the CAT files generated anew. Download this archive and place it somewhere so that the build system had access to it. </li><li> Unpack the archive and put all the files from the subdirectories directly into <code>out\win.amd64\release\bin\</code> overwriting the existing files. You can do it either manually or using another script from the same path <code>out\win.amd64\release\repack\</code> by running the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> _MY_SIGNTOOL=C:\Programs\DevKits\<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>\bin\x64\signtool.exe UnpackBlessedDrivers.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -n -i <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>\to\signed.zip</code> </pre> Of course, you need to put here the correct paths to <code>signtool.exe</code> and the ZIP archive. </li><li> Now you can run the second <code>kmk</code> command which packs all the components into an MSI installer. If you were doing all this in the same console window, don't forget to switch back to the base directory of the VB project. </li><li> Finally, proceed with building of the 32-bit version of VB, and perform all the same additional steps: after the first <code>kmk</code> switch to <code>out\win.x86\release\repack\</code> , create the CAB archive, sign it, send to Microsoft (now choosing the 32-bit OS version), replace the drivers with their counter-signed versions, and run the final <code>kmk</code> for building the complete VB distribution. </li></ul></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si aucun de nous n'a rien gâché, toute cette longue chaîne devrait vous apporter un nouveau programme d'installation de VirtualBox brillant qui ne diffère de celui d'Oracle que par son icône, l'image About, et, bien sûr, le manque profond de durcissement. Il n'est pas difficile de remplacer également l'icône et l'image, mais je n'entrerai pas dans ce sujet ici. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour plus de commodité, j'ai créé un </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier batch unique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui automatise la construction complète de VB. Vous pouvez l'utiliser si vous avez besoin de créer régulièrement le programme d'installation complet.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encore quelques mots sur l'installation de la distribution résultante si vous utilisez un certificat auto-signé. </font><font style="vertical-align: inherit;">Comme il a été soudainement découvert, dans Windows 8/10, il ne suffit pas de démarrer en mode test, l'installation échoue toujours en affirmant que les signatures de pilote ne sont pas valides. </font><font style="vertical-align: inherit;">Vous pouvez contourner ce problème en ajoutant les certificats dans votre stockage racine CA:</font></font><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez la boîte de dialogue Propriétés du programme d'installation VB en cliquant dessus avec le bouton droit et en sélectionnant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Propriétés</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis passez à l' </font><font style="vertical-align: inherit;">onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signatures numériques</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous y trouverez deux signatures, toutes deux nommées "Roga et Kopyta Ltd", l'une est sha1, l'autre sha256. </font><font style="vertical-align: inherit;">Sélectionnez le premier, cliquez sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Détails</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre boîte de dialogue apparaît, dans laquelle vous devez cliquer sur le bouton </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher le certificat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li> One more dialog, click <i>Install Certificate</i> . </li><li> In the Import wizard, select the location «Local Machine», click <i>Next</i> . After UAC confirmation (if needed), there's the certificate store selection. Select «Place all certificates in the following store», then click <i>Browse</i> and choose the store named «Trusted Root Certification Authorities». Then <i>Next</i> , <i>Finish</i> . You're done, the certificate is installed. </li><li> Close all the dialogs but the very first one, select the second signature (sha256) and repeat the steps 2 to 4 for it too. </li><li> Close all the dialogs, run the installer. Now it should work fine. </li></ol><br><a name="afterword"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"> Epilogue </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand j'ai fini d'écrire l'article, j'ai été moi-même surpris par son volume. Au début, je comptais entrer dans de nombreux détails sur les raisons de choisir telle ou telle façon de résoudre chaque problème, expliquer exactement quel était le problème et quelles solutions alternatives pourraient être applicables. Mais très vite, il est devenu clair que, s'il était chargé de tous ces détails, le texte serait monstrueusement énorme. Je dois donc m'excuser pour les recettes ressemblant à "faites-le et ne posez pas de questions". J'ai une forte aversion pour eux-mêmes, mais je ne pouvais tout simplement pas trouver d'autre moyen. Parfois, j'essayais toujours de décrire ce qui se passait, pour adoucir l'impression.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une grande quantité de détails sur le système de construction VB devaient rester derrière la scène; car j'ai tous deux hésité à gonfler le texte et, parfois, j'étais trop paresseux pour aller chercher une approche différente et plus efficace pour résoudre un problème. Après tout, mon objectif principal, au départ, était de me procurer une version fonctionnelle de la version actuelle de VirtualBox. 4.3.12 était déjà bien dépassé à ce moment-là, mais je ne pouvais pas risquer de mettre à jour l'un de mes outils les plus activement utilisés vers la version renforcée qui pourrait simplement cesser de fonctionner à tout moment. Bien que, de temps en temps, je revienne et, ayant trouvé quelque chose de nouveau, l'ajoute à cet article. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'espère que cet article trouvera son public. Si vous êtes intéressé à voir et analyser le résultat final mais que vous ne voulez pas mettre en place toute la pile de programmes, vous pouvez obtenir ma version de la distribution ici:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version 6.0.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tous les pilotes (et autres fichiers) sont signés avec un certificat auto-signé non approuvé, donc pour l'installer dans la version Windows 64 bits, vous devrez redémarrer en mode test. </font><font style="vertical-align: inherit;">Si vous avez des questions, des suggestions, des recommandations, n'hésitez pas à m'écrire ici dans les commentaires, ou via des messages personnels. </font><font style="vertical-align: inherit;">Que l'Open Source soit avec vous!</font></font><br><br><a name="history"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amendements </font></font></h4><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archive</font></font></b> <div class="spoiler_text"><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> • Article russe publié le 21/01/2016 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VirtualBox 5.0.12. </font></font></li></ol><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> • Mise à jour du 24/05/2016 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'article est mis à jour pour VB 5.0.20, l'un des principaux changements étant la double signature SHA-1 / SHA-256. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajout de la désactivation des contrôles de signature forcée si des certificats auto-signés sont utilisés. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajout d'informations sur la solution de contournement de l'échec d'installation de la distribution auto-signée. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les versions de la bibliothèque ont été mises à jour. </font></font></li><li> Disabled some unused components for speeding up the build process. </li><li> Minor fixes and improvements. </li></ol><br><h5> • Update of 29.07.2016 </h5><ol><li> The article is updated for VB 5.1.2; the most important change is upgrading to Qt5. The differences from VB 5.0.x procedure are specified where applicable. </li><li> Library versions were updated. </li><li> The full build batch was updated to check error codes after each operation. </li><li> Minor fixes and improvements. </li></ol><br><h5> • Update of 15.09.2016 </h5><ol><li> The article is updated for VB 5.1.6. </li><li> Library versions were updated. </li><li> Added NASM for building OpenSSL. </li><li> Added OpenSSL into cURL; this fixes the broken function of checking for updates and downloading the Extension Pack. </li><li> The full build batch now reads the VB version automatically. </li><li> Various minor fixes and improvements. </li></ol><br><h5> • Update of 30.11.2016 </h5><ol><li> The article is updated for VB 5.1.10. </li><li> Library versions were updated; particularly OpenSSL was upgraded to version 1.1.x. </li><li> Fixed some installation errors: <ul><li> path to the Qt plugins now points to the installation directory; </li><li> added forgotten OpenSSL libraries to the 32-bit components of the 64-bit VB version. </li></ul></li><li> The article no longer contains information about building older VB versions. If needed, the previous versions of it are available in the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub project</a> . </li></ol><br><h5> • Update of 2.12.2016 </h5><ol><li> Switched to using statically linked OpenSSL. </li></ol><br><h5> • Update of 20.06.2017 </h5><ol><li> The article is updated for VB 5.1.22. </li><li> cURL, OpenSSL, and gSOAP were updated; adapted the build instructions for cURL, gSOAP and VB. </li></ol><br><h5> • Update of 1.12.2017 </h5><ol><li> The article is updated for VB 5.2.2. </li><li> Switched from MinGW-32 3.3.3 to 4.5.4. </li><li> Qt, cURL, OpenSSL, gSOAP, and some build tools were updated; adapted the build instructions for cURL, gSOAP and VB. </li><li> Switched to using local archives of DocBook XML/XSL instead of online versions. </li><li> Using cURL program instead of wget for downloading the Guest Additions ISO image. </li><li> Various minor fixes and improvements. </li></ol><br><h5> • Update of 4.12.2017 </h5><ol><li> The libxml version was fixed in the build instructions. </li></ol><br><h5> • Update of 4.09.2018 </h5><ol><li> The article is updated for VB 5.2.18. </li><li> cURL, OpenSSL, gSOAP and some build tools were updated; adapted the build instructions for cURL. </li></ol><br><h5> • Update of 12.12.2018 </h5><ol><li> The article is updated for VB 5.2.22. </li><li> Enabled screen recording functionality which is disabled in OSE version by default; added libraries libopus and libvpx for encoding. </li><li> cURL, OpenSSL, and gSOAP were updated. </li><li> The full set of VirtualBox source code changes is now published as a single patch file for easier application. </li></ol></div></div><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> • Mise à jour du 25/01/2019 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'article est mis à jour pour VB 6.0.2. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amélioration de la désactivation de la génération d'ajouts d'invités. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cURL et gSOAP ont été mis à jour; </font><font style="vertical-align: inherit;">Les feuilles de style DocBook XSL ont été rétrogradées à la version 1.69.1 (la documentation est mieux adaptée à cette version).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le lot de construction complet a été divisé du texte de l'article en un fichier téléchargeable. </font></font></li></ol><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> • Mise à jour du 04/08/2019 </font></font></h5><ol><li> The article has been translated into English for the first time. Also numerous minor changes were introduced into the Russian version. </li><li> Added information about drivers signing for Windows 10. </li><li> The article is updated for VB 6.0.4. </li><li> cURL, OpenSSL, gSOAP, and some tools were updated. </li><li> The full build batch no longer has to be placed at the specific path. Also, it now contains the basic template for automated Windows 10 drivers signing. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447300/">https://habr.com/ru/post/fr447300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447288/index.html">Top 5 des pièces stables. Tout ce que vous devez savoir</a></li>
<li><a href="../fr447290/index.html">Docteur promenades, promenades</a></li>
<li><a href="../fr447292/index.html">14 nouveaux produits dans Visual Studio 2019</a></li>
<li><a href="../fr447294/index.html">Live Share désormais inclus avec Visual Studio 2019</a></li>
<li><a href="../fr447298/index.html">Gestion des connaissances grâce à des modèles de compétences</a></li>
<li><a href="../fr447302/index.html">Système d'exploitation Week-end</a></li>
<li><a href="../fr447304/index.html">Avaricious ne paie pas deux fois - nous configurons la mémoire sur la plate-forme AMD B450 et obtenons des performances gratuites</a></li>
<li><a href="../fr447306/index.html">Transformateur Tesla sur une carte de pouce carré</a></li>
<li><a href="../fr447308/index.html">Conception instantanée</a></li>
<li><a href="../fr447310/index.html">Comment nous sommes passés du développement Web au développement de jeux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>