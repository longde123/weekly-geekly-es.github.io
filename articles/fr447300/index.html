<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèø üßîüèΩ üêπ Cr√©ation de VirtualBox pour Windows ‚ÑπÔ∏è üçò ‚ûñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 
 C'est un fait bien connu de nombreux utilisateurs de la version Windows de VirtualBox (√† partir de maintenant, VB ; √† ne pas confondre avec Vi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation de VirtualBox pour Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447300/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f6/4c2/1ba/2f64c21bac5d7f0c050e7442bd08960e.png"></div><br><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Intro </h4><br>  C'est un fait bien connu de nombreux utilisateurs de la version Windows de VirtualBox (√† partir de maintenant, <em>VB</em> ; √† ne pas confondre avec Visual Basic) qu'√† partir de la version 4.3.14, les d√©veloppeurs ont ajout√© le soi-disant "durcissement" con√ßu pour emp√™cher injections malveillantes dans VB.  Bien que les intentions soient bonnes, la mise en ≈ìuvre a provoqu√© de nombreux conflits avec des produits totalement l√©gitimes tels que les antivirus, les modules cryptographiques et m√™me certaines mises √† jour de Windows lui-m√™me, et lorsqu'un tel conflit se produit, VB cesse simplement de fonctionner.  Les utilisateurs doivent attendre au moins un mois avant la sortie de la nouvelle version VB avec les exclusions appropri√©es ajout√©es.  Le pire des cas est que l'application ou la mise √† jour en conflit doit √™tre d√©sinstall√©e ou VB lui-m√™me doit √™tre r√©trograd√© √† la version 4.3.12 qui √©tait la derni√®re sans durcissement.  De nombreuses demandes pour ajouter une liste d'exclusion contr√¥l√©e par l'utilisateur, ou une option pour d√©sactiver le renforcement, sont toutes rest√©es sans r√©ponse.  La seule r√©ponse des d√©veloppeurs sonne comme "si vous ne voulez pas le construire vous-m√™me √† partir du code source".  On dirait que nous devrons le faire. <br><br>  Bien que les instructions de construction soient <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©crites</a> sur le Wiki officiel du projet, elles sont incompl√®tes et quelque peu d√©pass√©es, tandis que la proc√©dure de construction √©choue souvent avec de vagues messages d'erreur.  Donc, quand j'ai fini par le faire fonctionner, j'ai pens√© que cela valait la peine d'√™tre document√© en d√©tail dans un article s√©par√©.  Cette instruction est mise √† jour de temps en temps et est actuellement adapt√©e √† la construction de la version 6.0.4 de VB.  Cependant, si vous avez besoin d'informations sur la cr√©ation de versions ant√©rieures de VB ou de biblioth√®ques auxiliaires, vous pouvez toujours les obtenir √† partir de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">historique des modifications</a> . <br><br><a name="habracut"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Table des mati√®res </h4><blockquote>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√ânonc√© du probl√®me</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un mot d'avertissement</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©paration de l'environnement de construction</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quirks d'installation des applications</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Touches finales</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©ation de VirtualBox</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âpilogue</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amendements</a> <br></blockquote><br><a name="task"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  √ânonc√© du probl√®me </h4><br>  Au d√©but, je voulais rester simple en reconstruisant simplement les composants binaires et en les copiant sur la version install√©e √† partir de la distribution officielle.  Cependant, cela s'est av√©r√© loin d'√™tre simple car l'installation repose sur une API syst√®me obscure et n√©cessite l'installation des pilotes et l'enregistrement des composants COM.  Je me suis demand√© s'il √©tait viable d'apprendre comment tout cela fonctionnait et d'√©crire un script pour automatiser ces t√¢ches, mais apr√®s m√ªre r√©flexion, j'ai d√©cid√© d'aller grand et de construire une distribution compl√®te qui serait aussi proche que possible de la distribution officielle, uniquement sans durcissement. <br><br>  Je dois dire que cette t√¢che s'est av√©r√©e tr√®s difficile et je ne l'ai pas accomplie √† 100%.  Ce que je suis tomb√© sur les suppl√©ments invit√©s qui sont fournis pour Windows (32 et 64 bits), OS / 2, Linux et certains autres syst√®mes * NIX.  Les commentaires dans le Makefile correspondant mentionnent qu'ils sont tous construits sur diff√©rentes machines distantes, et je n'√©tais certainement pas impatient de g√©rer une telle usine de construction.  Donc ma derni√®re solution √©tait de tout construire √† partir des codes sources, √† l'exception des ajouts, mais de prendre l'image ISO officielle avec eux et de la mettre dans ma distribution telle quelle.  Je n'ai pas v√©rifi√© si les ajouts ont le m√™me m√©canisme de durcissement, mais m√™me s'ils le font, je n'ai jamais entendu de plaintes √† ce sujet. <br><br><a name="warnings"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Un mot d'avertissement </h4><br><h5>  ‚Ä¢ Consid√©rations de s√©curit√© </h5><br>  Le durcissement n'a pas √©t√© ajout√© sur un coup de t√™te, c'√©tait une solution pour fermer une vuln√©rabilit√© dans VB.  Malheureusement, Oracle refuse de fournir la description d√©taill√©e du probl√®me, m√™me s'il a √©t√© corrig√© il y a de nombreuses ann√©es.  G√©n√©ralement, cela a quelque chose √† voir avec le m√©canisme d'injection de DLL dans Windows qui, en cas de VB, peut conduire √† une √©l√©vation de privil√®ges non autoris√©e sur l'ordinateur h√¥te, et il existe des exploits de travail pour cette vuln√©rabilit√©.  Soyez donc averti si vous d√©cidez d'utiliser la version sans durcissement de toute fa√ßon. <br><br><h5>  ‚Ä¢ Signature des chauffeurs </h5><br>  √Ä partir de Vista, dans les versions Windows 64 bits, les utilisateurs ne peuvent plus charger de pilotes arbitraires.  Les pilotes doivent √™tre sign√©s par un certificat avec une cha√Æne de certificats crois√©s qui monte √† l'autorit√© de certification racine Microsoft (et dans Windows 10 avec Secure Boot activ√©, les pilotes doivent √™tre sign√©s par Microsoft eux-m√™mes).  Avant de vous lancer dans la construction de VB, vous devez d√©cider comment r√©soudre ce probl√®me.  Vous pouvez soit d√©penser de l'argent et acheter votre propre certificat, soit essayer de contacter des soci√©t√©s tierces qui fournissent des services de signature pour des projets open source (si elles acceptent de signer des pilotes vuln√©rables), ou configurer votre Windows en mode test qui permet de charger les pilotes sign√© avec un certificat de test g√©n√©r√© localement. <br><br>  Dans l'article, j'impliquerai principalement ce dernier sc√©nario, mais je mentionnerai comment la proc√©dure change si vous avez un certificat commercial ¬´adulte¬ª. <br><br><a name="environment"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Pr√©paration de l'environnement de construction </h4><br>  Le guide officiel recommande d'utiliser Windows 7 √† 10 comme syst√®me de g√©n√©ration.  J'ai fait tout le travail dans Windows 7 SP1 x64, et je ne pense pas que la version du syst√®me d'exploitation affecte beaucoup la proc√©dure.  N'oubliez pas que la machine (r√©elle ou virtuelle) que vous allez utiliser pour cr√©er VB doit avoir une connexion Internet. <br><br>  L'environnement de construction n√©cessite pas mal d'outils.  Si certains programmes ont une version portable, je pr√©f√®re prendre cela au lieu d'utiliser le programme d'installation. <br><br>  D√©sormais, les programmes suivants ne peuvent √™tre obtenus qu'en tant que distributions installables (au moins, officiellement).  Pour Visual Studio et SDK / WDK, il est important de suivre l'ordre d'installation tel que sp√©cifi√© ci-dessous.  Une fois que vous avez termin√© avec eux, je recommande fortement d'ex√©cuter Windows Update et de r√©cup√©rer les derni√®res mises √† jour pour tous les produits Microsoft. <br><ul><li>  <b>Visual Studio 2010 Professional</b> <br>  Vous avez besoin exactement de la version 2010, et elle devrait √™tre professionnelle ou sup√©rieure.  La version 2010 Express manque d'ATL qui est n√©cessaire pour construire l'API COM, utilis√©e par tous les frontends pour communiquer.  J'ai essay√© de passer √† VS 2013 ou 2015 Community Edition afin que ce ne soit pas obligatoire d'avoir un programme payant (qui n'est m√™me plus vendu), mais j'ai √©chou√© jusqu'√† pr√©sent. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDK Windows v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Visual Studio 2010 SP1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mise √† jour du compilateur Visual C ++ 2010 SP1 pour SDK 7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kit de d√©veloppement de pilotes Windows (WDK) v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDK Windows v8.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Activeperl</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ActivePython 2.7</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cygwin</a></b> </li></ul><br>  Les autres programmes sont t√©l√©charg√©s sous forme d'archives portables ou de codes sources: <br><ul><li>  <b><a href="">Qt 5.6.3</a></b> (code source) </li><li>  <b>MinGW-w64 4.5.4</b> : <ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Version 32 bits</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Version 64 bits</a></b> </li></ul></li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SDL v1.2.x</a></b> (biblioth√®que de d√©veloppement pour Visual C ++) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cURL</a></b> (code source) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenSSL 1.1.1</a></b> (code source) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gSOAP 2.8.x</a></b> (la version 2.8.41 ou sup√©rieure est recommand√©e) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libvpx 1.7.0</a></b> (code source; les versions plus r√©centes ne prennent pas en charge VS 2010) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libopus 1.3</a></b> (code source) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MiKTeX Portable</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NASM</a></b> <br>  Je recommande d'utiliser la version portable 64 bits. </li><li> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WiX</a></b> <br>  Je recommande d'utiliser une archive portable (nomm√©e comme <code>wix311-binaries.zip</code> ). </li></ul><br>  Vous aurez √©galement besoin des archives suivantes: <br><ul><li>  <b><a href="">DocBook XML DTD 4.5</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Feuilles de style DocBook XSL 1.69.1</a></b> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Pourquoi devriez-vous vouloir tout cela?</b> <div class="spoiler_text">  Si vous ne voulez pas construire exactement le m√™me paquet que moi, vous pourrez peut-√™tre vous d√©barrasser de certains des outils susmentionn√©s.  Je vais donc ici donner quelques d√©tails sur leur objectif dans le processus de construction. <br><br><ul><li>  <b>SDK 8.1</b> <br>  La construction r√©elle est effectu√©e √† l'aide du SDK 7.1, mais vous aurez besoin du programme SignTool √† partir de 8.1, car celui √† partir de 7.1 ne peut pas effectuer la double signature SHA-1 / SHA-256.  Si le SDK 8.1 est install√© ailleurs, vous pouvez simplement copier <code>signtool.exe</code> avec toutes ses d√©pendances √† partir de l√† et sp√©cifier le chemin d'acc√®s dans le fichier <code>LocalConfig.kmk</code> (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ci</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dessous</a> ). </li><li>  <b>WiX</b> <br>  Il s'agit du cadre de cr√©ation de packages MSI.  Bien que la distribution VB finale soit un EXE, elle contient deux fichiers MSI √† l'int√©rieur, vous avez donc besoin de WiX pour les construire.  Cependant, si vous avez uniquement l'intention de cr√©er les fichiers binaires VB sans les empaqueter, vous pouvez le faire sans WiX. </li><li>  <b>Sdl</b> <br>  Cette biblioth√®que est utilis√©e pour un <code>VBoxSDL.exe</code> frontal simpliste suppl√©mentaire qui peut √™tre utilis√© √† la place de <code>VirtualBox.exe</code> .  En th√©orie, si vous n'avez pas besoin de ce composant, vous devriez pouvoir ex√©cuter la build sans avoir SDL, mais je ne l'ai pas essay√©. </li><li>  <b>gSOAP</b> <br>  Cette biblioth√®que est utilis√©e pour cr√©er <code>VBoxWebSrv.exe</code> , service de gestion √† distance VB.  Si vous n'avez pas gSOAP, ce composant sera ignor√© en silence lors de la construction. </li><li>  <b>libvpx</b> , <b>libopus</b> <br>  Ce sont les codecs vid√©o et audio utilis√©s pour enregistrer l'√©cran de la VM.  Si vous ne les avez pas, la construction se terminera toujours avec succ√®s et VB aura toujours toutes les options de capture vid√©o, mais ces options seront ignor√©es (m√™me si l'animation de capture sera lue, aucun enregistrement r√©el ne sera sauvegard√©) . </li><li>  <b>Cygwin</b> <br>  Requis pour construire libvpx. </li><li>  <b>MiKTeX</b> <br>  MiKTeX est utilis√© pour compiler la documentation PDF ( <code>doc\UserManual.pdf</code> ).  Sans ce programme, le PDF sera silencieusement omis de la construction et de l'emballage. </li><li>  <b>NASM</b> <br>  L'assembleur utilis√© lors de la construction d'OpenSSL.  Vous pouvez √©galement le construire sans utiliser l'assembleur, mais je recommande toujours de l'utiliser pour g√©n√©rer un code plus optimis√©. </li></ul></div></div><br>  Voici le r√©sum√© de tous les outils et biblioth√®ques que j'utilise, y compris leurs versions exactes (si possible) et les chemins d'installation que j'ai choisis sur mon syst√®me de construction.  La d√©signation " <code>{x32|x64}</code> " est utilis√©e pour des emplacements d'installation de versions 32 et 64 bits distincts. <table><tbody><tr><th>  Programme / outil </th><th>  La version </th><th>  Chemin d'installation </th></tr><tr><td>  Studio visuel </td><td>  Professionnel 2010 </td><td> <code>C:\Program Files (x86)\Microsoft Visual Studio 10.0\</code> </td> </tr><tr><td>  SDK </td><td>  7.1 </td><td> <code>C:\Program Files\Microsoft SDKs\Windows\v7.1\</code> </td> </tr><tr><td>  SDK </td><td>  8.1 </td><td> <code>C:\Programs\DevKits\8.1\</code> </td> </tr><tr><td>  Wdk </td><td>  7.1.0 </td><td> <code>C:\WinDDK\7600.16385.1\</code> </td> </tr><tr><td>  Activeperl </td><td>  5.26.1 Build 2601 x64 </td><td> <code>C:\Programs\Perl\</code> </td> </tr><tr><td>  ActivePython </td><td>  2.7.14.2717 x64 </td><td> <code>C:\Programs\Python\</code> </td> </tr><tr><td>  WiX </td><td>  3.11.1.2318 </td><td> <code>C:\Programs\WiX\</code> </td> </tr><tr><td>  Qt </td><td>  5.6.3 </td><td> <code>C:\Programs\Qt\5.6.3-{x32|x64}\</code> </td> </tr><tr><td>  MinGW-32 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw32\</code> </td> </tr><tr><td>  MinGW-64 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw64\</code> </td> </tr><tr><td>  Cygwin </td><td>  - </td><td> <code>C:\Programs\cygwin64\</code> </td> </tr><tr><td>  Sdl </td><td>  1.2.15 </td><td> <code>C:\Programs\SDL\{x32|x64}\</code> </td> </tr><tr><td>  cURL </td><td>  7.64.1 </td><td> <code>C:\Programs\curl\{x32|x64}\</code> </td> </tr><tr><td>  Openssl </td><td>  1.1.1b </td><td> <code>C:\Programs\OpenSSL\{x32|x64}\</code> </td> </tr><tr><td>  gSOAP </td><td>  2.8.82 </td><td> <code>C:\Programs\gSOAP\</code> </td> </tr><tr><td>  libvpx </td><td>  1.7.0 </td><td> <code>C:\Programs\libvpx\</code> </td> </tr><tr><td>  libopus </td><td>  1,3 </td><td> <code>C:\Programs\libopus\</code> </td> </tr><tr><td>  MiKTeX Portable </td><td>  2.9.6942 </td><td> <code>C:\Programs\MiKTeX\</code> </td> </tr><tr><td>  NASM </td><td>  2.14.02 x64 </td><td> <code>C:\Programs\nasm\</code> </td> </tr><tr><td>  DocBook XML DTD </td><td>  4.5 </td><td> <code>C:\Programs\DocBook\xml\</code> </td> </tr><tr><td>  Feuilles de style DocBook XSL </td><td>  1.69.1 </td><td> <code>C:\Programs\DocBook\xsl\</code> </td> </tr></tbody></table><a name="environment-inst"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Quirks d'installation des applications </h4><br>  Ici, je donne quelques instructions sur l'installation de certains des outils susmentionn√©s o√π la proc√©dure n'est pas √©vidente ou n√©cessite des actions suppl√©mentaires. <br><br><h5>  ‚Ä¢ SDK Windows v7.1 </h5>  L'installation de ce SDK √©chouera probablement car il inclut les versions obsol√®tes du compilateur et des biblioth√®ques d'ex√©cution.  Apr√®s avoir install√© VS 2010, il existe des versions plus r√©centes de celles pr√©sentes dans le syst√®me, de sorte que les anciennes √©chouent √† l'installation et le programme d'installation principal consid√®re qu'il s'agit d'une erreur critique.  Pour contourner ce probl√®me, vous devez d√©cocher les cases correspondantes ou, avant l'installation du SDK, d√©sinstaller les packages nomm√©s comme <i>¬´Microsoft Visual C ++ 2010 &lt;arch&gt; Redistributable¬ª</i> , <i>¬´Microsoft Visual C ++ 2010 &lt;arch&gt; Runtime¬ª</i> , <i>¬´Microsoft Compilateurs Visual C ++ ... "</i>  Laissez le SDK installer les anciennes versions de ceux-ci, puis ex√©cutez Windows Update pour obtenir les derni√®res versions disponibles. <br><br>  Lorsque vous installez le SDK, assurez-vous de v√©rifier les exemples de programme (D√©veloppement de code natif Windows -&gt; Exemples): ils contiennent certains scripts utilis√©s par les r√®gles de g√©n√©ration VB.  Sans eux, vous ne pourrez pas cr√©er les packages MSI. <br><br><h5>  ‚Ä¢ SDK Windows v8.1 </h5>  Il vous suffit d'installer le composant "Kit de d√©veloppement logiciel Windows". <br><br><h5>  ‚Ä¢ WDK v7.1 </h5>  Il vous suffit d'installer le composant "Build Environments". <br><br><h5>  ‚Ä¢ Qt 5.6.3 </h5>  √Ä partir de Qt 5.7.0, pour le construire, vous avez besoin de Visual Studio 2012 ou version ult√©rieure, nous sommes donc bloqu√©s avec 5.6.x. <br>  Puisqu'il n'y a pas de builds officiels pour Visual Studio 2010, nous devrons construire Qt √† partir du code source nous-m√™mes. <br><br><ol><li>  D√©compressez l'archive de code source de Qt dans <code>C:\Programs\Qt\</code> et renommez le r√©pertoire <code>qt-everywhere-opensource-src-5.6.3</code> en <code>5.6.3-src</code> . </li><li>  √Ä c√¥t√©, cr√©ez un r√©pertoire <code>build-x32</code> o√π la construction aura lieu. </li><li>  Ouvrez la console et ex√©cutez les commandes suivantes pour pr√©parer l'environnement: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre>  La commande <code>color</code> est facultative, elle supprime la couleur verte qui a √©t√© d√©finie par le script <code>SetEnv.Cmd</code> . </li><li>  Nous devons maintenant ex√©cuter le script <code>configure.bat</code> partir de <code>5.6.3-src</code> .  VB n'utilise pas la plupart de ce que Qt inclut, nous pouvons donc r√©duire consid√©rablement le temps de construction en d√©sactivant divers composants, mais veuillez noter que certaines options sont cruciales pour VB.  En particulier, j'ai d√©couvert que: <ul><li>  OpenGL ES 2 n'est pas pris en charge (lors de la cr√©ation de VB, le compilateur ne parvient pas √† trouver certains fichiers d'en-t√™te). </li><li>  La prise en charge de FreeType doit √™tre activ√©e (sinon le plugin <code>qoffscreen</code> ne sera pas construit, et il est requis pour VB). </li></ul>  Voici la ligne de commande compl√®te avec laquelle je me suis retrouv√©: <pre> <code class="dos hljs">..\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-src\configure.bat -prefix c:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 -mp -opensource -confirm-license -nomake tests -nomake examples -no-compile-examples -release -shared -pch -no-ltcg -accessibility -no-sql-sqlite -opengl desktop -no-openvg -no-nis -no-iconv -no-evdev -no-mtdev -no-inotify -no-eventfd -largefile -no-system-proxies -qt-zlib -qt-pcre -no-icu -qt-libpng -qt-libjpeg -qt-freetype -no-fontconfig -qt-harfbuzz -no-angle -incredibuild-xge -no-plugin-manifests -qmake -qreal double -rtti -strip -no-ssl -no-openssl -no-libproxy -no-dbus -no-audio-backend -no-wmf-backend -no-qml-debug -no-direct2d -directwrite -no-style-fusion -native-gestures -skip qt3d -skip qtactiveqt -skip qtandroidextras -skip qtcanvas3d -skip qtconnectivity -skip qtdeclarative -skip qtdoc -skip qtenginio -skip qtgraphicaleffects -skip qtlocation -skip qtmacextras -skip qtmultimedia -skip qtquickcontrols -skip qtquickcontrols2 -skip qtscript -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview -skip qtx11extras -skip qtxmlpatterns</code> </pre> </li><li>  Le chemin d'installation de Qt sp√©cifi√© ici (dans l'option <code>-prefix</code> ) est cod√© en dur dans les fichiers de code source interm√©diaires par le script de configuration, donc les fichiers binaires s'en souviendront √©galement.  Toute application bas√©e sur Qt construite √† l'aide de cette biblioth√®que recherchera d'abord les plugins requis dans ce chemin, et seulement s'ils ne peuvent pas √™tre trouv√©s, elle utilisera son propre emplacement actuel.  Dans la plupart des cas, cela est OK, mais supposons que sur l'ordinateur o√π notre VB est install√©, il existe une autre version de Qt situ√©e dans <code>c:\Programs\Qt\5.6.3-x32</code> , mais compil√©e avec diff√©rentes options ou par un compilateur diff√©rent?  Ensuite, VB essaiera de charger ces plugins (incompatibles) et de planter. <br>  Il existe deux fa√ßons d'√©viter ce probl√®me.  Le premier consiste √† ajouter √† l'installation un fichier suppl√©mentaire nomm√© <code>qt.conf</code> avec le texte suivant: <pre> <code class="plaintext hljs">[Paths] Plugins=.</code> </pre>  L'autre consiste √† corriger ce chemin d'installation enregistr√© avant de construire Qt, afin qu'il pointe vers le r√©pertoire de l'application.  J'ai d√©cid√© de suivre cette derni√®re voie, je n'aimais pas l'id√©e d'avoir des fichiers suppl√©mentaires √† ce que la distribution Oracle VB avait.  Vous devez ouvrir le fichier <code>C:\Programs\Qt\build-x32\qtbase\src\corelib\global\qconfig.cpp</code> cr√©√© par le script de configuration, recherchez la ligne suivante: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=c:/Programs/Qt/5.6.3-x32"</span></span>;</code> </pre>  et remplacez le chemin par un seul point, de sorte que cette ligne ressemble √† ceci: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=."</span></span>;</code> </pre>  Cette modification n'affectera que le comportement d'ex√©cution du VB.  L'√©tape d'installation de Qt lui-m√™me utilisera le chemin d'origine, car il est maintenant stock√© dans les Makefiles que nous ne modifions pas. </li><li>  Ensuite, ex√©cutez la g√©n√©ration √† l'aide de la commande <code>nmake</code> </li><li>  Et installez la biblioth√®que <code>nmake install</code> aide de <code>nmake install</code> </li></ol><br>  Ouvrez maintenant une nouvelle fen√™tre de console et faites de m√™me pour la version 64 bits.  Vous devrez remplacer ¬´x32¬ª par ¬´x64¬ª dans tous les chemins, et les commandes de pr√©paration de l'environnement ressembleront √† ceci: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre> <br>  Une fois l'installation termin√©e, les r√©pertoires <code>build-x32</code> , <code>build-x64</code> et <code>5.6.3-src</code> peuvent √™tre supprim√©s. <br><br><h5>  ‚Ä¢ MinGW </h5>  D√©compressez simplement les archives 32 et 64 bits dans leurs r√©pertoires d'installation respectifs. <br><br><h5>  ‚Ä¢ Cygwin </h5>  Lors de l'installation, vous devez choisir les packages <code>make</code> et <code>yasm</code> . <br><br><h5>  ‚Ä¢ SDL </h5><ol><li>  D√©compressez l'archive SDL deux fois dans des chemins distincts: <code>C:\Programs\SDL\x32\</code> et <code>C:\Programs\SDL\x64\</code> . </li><li>  D√©placez tout le contenu du sous-r√©pertoire <code>C:\Programs\SDL\x64\lib\x64\</code> vers son r√©pertoire parent (c'est-√†-dire dans <code>C:\Programs\SDL\x64\lib\</code> ), puis supprimez les sous-r√©pertoires <code>C:\Programs\SDL\x64\lib\x86</code> et <code>x64</code> . </li><li>  Faites de m√™me pour la version 32 bits: d√©placez le contenu de <code>C:\Programs\SDL\x32\lib\x86\</code> vers <code>C:\Programs\SDL\x32\lib\</code> , puis supprimez <code>C:\Programs\SDL\x64\lib\x86</code> et <code>x64</code> . </li></ol><br><h5>  ‚Ä¢ NASM </h5>  <code>nasm-2.14.02-win64.zip</code> l'archive <code>nasm-2.14.02-win64.zip</code> dans <code>C:\Programs\</code> , puis renommez le r√©pertoire r√©sultant <code>nasm-2.14.02</code> en <code>nasm</code> . <br><br><h5>  ‚Ä¢ OpenSSL </h5><ol><li>  D√©compressez l'archive OpenSSL dans <code>C:\Programs\OpenSSL\</code> deux fois, renommant les copies du r√©pertoire <code>openssl-1.1.1b</code> en <code>openssl-1.1.1b-x32</code> et <code>openssl-1.1.1b-x64</code> . </li><li>  Ouvrez la console, g√©n√©rez et installez la version 32 bits en ex√©cutant: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x32\ perl Configure VC-WIN32 no-shared --prefix=C:\Programs\OpenSSL\x32 --openssldir=C:\Programs\OpenSSL\x32\ssl nmake nmake test nmake install</code> </pre>  Si l'√©tape de configuration g√©n√®re un avertissement effrayant √† propos d'un compilateur manquant, veuillez ignorer ce message, il ment de mani√®re scandaleuse. <br>  Si vous ne souhaitez pas utiliser NASM, sautez simplement la commande avec la modification <code>PATH</code> et pour le script <code>Configure</code> , sp√©cifiez le param√®tre suppl√©mentaire <code>no-asm</code> . </li><li>  Ouvrez maintenant une nouvelle fen√™tre de console et faites de m√™me pour la version 64 bits: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x64\ perl Configure VC-WIN64A no-shared --prefix=C:\Programs\OpenSSL\x64 --openssldir=C:\Programs\OpenSSL\x64\ssl nmake nmake test nmake install</code> </pre>  La d√©sactivation de NASM est la m√™me qu'en 32 bits. </li><li>  Vous pouvez maintenant supprimer les r√©pertoires <code>C:\Programs\OpenSSL\openssl-1.1.1b-x32</code> et <code>openssl-1.1.1b-x64</code> . </li></ol><br><h5>  ‚Ä¢ cURL </h5><ol><li>  D√©compressez l'archive cURL dans <code>C:\Programs\curl\</code> et renommez le sous <code>curl-7.64.1</code> r√©pertoire r√©sultant <code>curl-7.64.1</code> en <code>curl-7.64.1-x32</code> . </li><li>  Ouvrez le fichier <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\MakefileBuild.vc</code> dans un √©diteur de texte et recherchez le bloc de code suivant (autour des lignes n ¬∞ 61 √† 69): <pre> <code class="plaintext hljs">!IF "$(VC)"=="6" CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /Gm /Zi /D_DEBUG /GZ CFLAGS = /I. /I../lib /I../include /nologo /W4 /wd4127 /GX /DWIN32 /YX /FD /c /DBUILDING_LIBCURL !ELSE CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /D_DEBUG /RTC1 /Z7 /LDd CFLAGS = /I. /I ../lib /I../include /nologo /W4 /wd4127 /EHsc /DWIN32 /FD /c /DBUILDING_LIBCURL !ENDIF</code> </pre>  Apr√®s ces lignes, ajoutez la nouvelle directive: <pre> <code class="plaintext hljs">CFLAGS = $(CFLAGS) /DCURL_DISABLE_LDAP</code> </pre>  Si vous ne le faites pas, la construction de VB √©chouera avec des erreurs de lien. </li><li>  Ouvrez maintenant le fichier <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\gen_resp_file.bat</code> , et apr√®s la toute premi√®re ligne ( <code>@echo OFF</code> ) ins√©rez cette commande: <pre> <code class="plaintext hljs">cd .</code> </pre>  Il ne fait rien, sauf la r√©initialisation du code <code>ERRORLEVEL</code> .  Le script est si simple qu'il est possible de le terminer sans ex√©cuter de commande qui changerait le code d'erreur.  Donc, si ce code √©tait diff√©rent de z√©ro avant de d√©marrer le script, il conservera sa valeur √† la sortie du script, et <code>nmake</code> penserait que c'est le script qui a renvoy√© ce code d'erreur et terminerait la g√©n√©ration avec √©chec.  L'ajout de ce faux <code>cd</code> r√©sout le probl√®me. </li><li>  Faites maintenant une copie compl√®te de <code>curl-7.64.1-x32</code> sous le nom <code>curl-7.64.1-x64</code> . </li><li>  Ouvrez la console, cr√©ez la version 32 bits et copiez les fichiers dont nous avons besoin: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x32\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x32 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x86 SSL_PATH=C:\Programs\OpenSSL\x32 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x32\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\include\curl ..\..\x32\include\curl\</code> </pre> </li><li>  Ouvrez une autre fen√™tre de console et cr√©ez la version 64 bits: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x64\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x64 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x64 SSL_PATH=C:\Programs\OpenSSL\x64 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x64\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\include\curl ..\..\x64\include\curl\ <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\bin\curl.exe ..\..\x64\curl.exe</code> </pre>  Notez qu'en plus de ce que nous avons fait pour la version 32 bits, nous copions ici √©galement le fichier <code>curl.exe</code> .  Nous l'utiliserons plus tard pour t√©l√©charger l'image des ajouts d'invit√©s. </li><li>  Les r√©pertoires <code>C:\Programs\curl\curl-7.64.1-x32</code> et <code>curl-7.64.1-x64</code> ne sont plus n√©cessaires et peuvent √™tre supprim√©s. </li></ol><br><h5>  ‚Ä¢ libvpx </h5><ol><li>  D√©compressez l'archive libvpx dans <code>C:\Programs\libvpx-build\</code> . </li><li>  Lancez le terminal Cygwin, la construction y sera effectu√©e.  Notre plate-forme cible est Visual Studio 2010;  le syst√®me de build ne le prend en charge que partiellement: il tentera d'ex√©cuter la build r√©elle √† l'aide de <code>msbuild.exe</code> mais cela ne fonctionne pas pour une raison quelconque;  Je n'ai pas r√©ussi √† comprendre pourquoi.  Au lieu de cela, nous pouvons simplement ex√©cuter Visual Studio lui-m√™me et l'utiliser pour cr√©er le projet.  Heureusement, il peut √™tre utilis√© √† partir de la ligne de commande, il n'est donc pas n√©cessaire de lancer l'IDE r√©el (bien que vous puissiez le faire si vous le souhaitez, auquel cas vous devrez modifier la variable <code>PATH</code> et ajouter le chemin <code>C:\Programs\cygwin64\bin</code> , ou de toute autre mani√®re, permettre √† VS de trouver <code>yasm.exe</code> situ√© l√† et requis pour la construction).  Ainsi, pour effectuer la construction des deux architectures, ex√©cutez les commandes suivantes dans le terminal Cygwin: <pre> <code class="bash hljs">mkdir -p /cygdrive/c/Programs/libvpx-build/build32 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build32 ../libvpx-1.7.0/configure --target=x86-win32-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|Win32"</span></span> make install mkdir -p /cygdrive/c/Programs/libvpx-build/build64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build64 ../libvpx-1.7.0/configure --target=x86_64-win64-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|x64"</span></span> make install</code> </pre> </li><li>  Fermez Cygwin, nous n'en aurons plus besoin.  Le r√©pertoire <code>C:\Programs\libvpx-build</code> peut √™tre supprim√©. </li></ol><br><h5>  ‚Ä¢ libopus </h5><ol><li>  D√©compressez l'archive opus dans <code>C:\Programs\libopus-build\</code> , allez dans le sous <code>opus-1.3\win32\VS2015</code> r√©pertoire <code>opus-1.3\win32\VS2015</code> . </li><li>  Ce projet est con√ßu pour la nouvelle version de Visual Studio, nous devons donc le modifier pour le faire construire dans notre version 2010. Vous pouvez le faire en utilisant l'IDE ou un √©diteur de texte brut.  J'ai choisi ce dernier.  Ouvrez le fichier <code>opus.vcxproj</code> et proc√©dez comme suit: <ol><li>  Trouver toutes les lignes contenant le texte <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span>v140<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  et remplacez <code>v140</code> par <code>v100</code> .  Si vous utilisez IDE, il s'agit de l'option de configuration "Platrofm Toolset" situ√©e sur la page Configuration Properties -&gt; General.  N'oubliez pas les s√©lecteurs de configuration et de plate-forme en haut de la bo√Æte de dialogue. </li><li>  Ensuite, recherchez ce bloc de code: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemDefinitionGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClCompile</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  et ajoutez une nouvelle balise √† l'int√©rieur: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span>ProgramDatabase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  Dans l'EDI, vous pouvez le faire en ouvrant la page Propri√©t√©s de configuration -&gt; C / C ++ -&gt; G√©n√©ral et en d√©finissant "Debug Information Format" dans "ProgramDatabase (/ Zi)".  En fait, vous pouvez le d√©finir sur n'importe quelle autre valeur valide, nous n'avons pas du tout besoin de la base de donn√©es de d√©bogage, mais avec une valeur non valide, le projet ne parviendra pas √† se construire. </li></ol></li><li>  Maintenant, construisons la version Release pour les deux plates-formes (en utilisant soit l'IDE VS, soit la ligne de commande) et copions la biblioth√®que <code>opus.lib</code> et le sous <code>include\</code> r√©pertoire <code>include\</code> dans notre chemin de destination: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\win32\VS2015 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\x64 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\Win32 <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /EC:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\include C:\Programs\libopus\include\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|x64" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> x64\Release\opus.lib C:\Programs\libopus\lib\x64\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|Win32" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> Win32\Release\opus.lib C:\Programs\libopus\lib\Win32\</code> </pre> </li><li>  Le r√©pertoire <code>C:\Programs\libopus-build</code> peut √™tre supprim√©. </li></ol><br><h5>  ‚Ä¢ gSOAP </h5>  Ouvrez l'archive, allez dans le sous <code>gsoap-2.8\gsoap</code> r√©pertoire <code>gsoap-2.8\gsoap</code> et d√©compressez son contenu dans <code>C:\Programs\gSOAP\</code> .  OpenSSL 1.1.x n√©cessite gSOAP version 2.8.41 ou sup√©rieure.  Si, pour une raison quelconque, vous souhaitez utiliser une ancienne version, vous devrez appliquer le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">correctif</a> cr√©√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mattias Ellert</a> .  L'application d'un correctif peut se faire soit manuellement (le format est simple: ouvrez les fichiers mentionn√©s, supprimez les lignes marqu√©es avec moins, ajoutez des lignes marqu√©es avec plus; le reste est le contexte), ou obtenez l'outil de <code>patch</code> port√© pour Windows et utilisez-le. <br><br><h5>  ‚Ä¢ MiKTeX </h5><ol><li>  D√©compressez l'archive dans <code>C:\Programs\MiKTeX\</code> . </li><li>  Ouvrez la console et installez des modules suppl√©mentaires: <pre> <code class="dos hljs">"C:\Programs\MiKTeX\texmfs\install\miktex\bin\mpm.exe" --verbose --install=koma-script --install=ucs --install=tabulary --install=url --install=fancybox --install=fancyvrb --install=bera --install=charter --install=mptopdf</code> </pre> </li></ol><br><h5>  ‚Ä¢ DocBook </h5>  Pour la DTD XML, vous devez cr√©er un r√©pertoire et y d√©compresser le contenu de l'archive.  Pour les feuilles de style XSL, tout le contenu est d√©j√† dans un seul r√©pertoire, vous devez donc l'extraire et le renommer ensuite. <br><br><a name="final-touches"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Touche finale </h4><br>  L'environnement de g√©n√©ration est presque pr√™t, quelques √©tapes suppl√©mentaires sont n√©cessaires.  T√©l√©chargez l'archive du code source de VirtualBox (si vous ne l'avez pas encore fait) et d√©compressez-la l√† o√π vous souhaitez travailler.  J'ai choisi <code>C:\Devel\</code> √† cet effet, y ai mis les codes sources d√©compress√©s et renomm√© le sous-r√©pertoire en <code>VirtualBox-src</code> . <br><br><h5>  ‚Ä¢ Ajout de certificats </h5><br>  Si vous n'avez pas de certificat payant, je vous recommande de cr√©er au moins un certificat personnel auto-sign√©: il est plus facile de faire charger Windows des pilotes auto-sign√©s que des pilotes non sign√©s.  Pour ce faire, ouvrez la console avec des privil√®ges √©lev√©s et ex√©cutez les commandes suivantes qui ajouteront deux certificats (SHA-1 et SHA-256) et les importeront dans votre stockage personnel: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> makecert.exe -a sha1 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_1.cer makecert.exe -a sha256 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_256.cer certmgr.exe -add C:\Devel\testcert_1.cer -s -r localMachine root certmgr.exe -add C:\Devel\testcert_256.cer -s -r localMachine root</code> </pre>  Vous pouvez, bien s√ªr, choisir votre propre nom pour les certificats au lieu de "Roga and Kopyta Ltd", et le chemin pour stocker les fichiers.  Maintenant, nous devons obtenir les empreintes des certificats g√©n√©r√©s.  Ouvrez la console de gestion des certificats (en ex√©cutant <code>certmgr.msc</code> ) et acc√©dez au stockage personnel.  Vous y verrez les deux nouveaux certificats nomm√©s "Roga et Kopyta Ltd".  Double-cliquez sur le premier;  dans la bo√Æte de dialogue qui appara√Æt, acc√©dez √† l'onglet <i>D√©tails</i> .  Le champ "Algorithme de signature" contient le nom de l'algorithme: sha256RSA ou sha1RSA.  Faites d√©filer vers le bas pour le champ "Thumbprint" qui contient la s√©quence de nombres hexad√©cimaux.  Copiez cette valeur compl√®te et notez-la quelque part.  Faites de m√™me pour le deuxi√®me certificat;  n'oubliez pas de marquer quelle empreinte num√©rique √©tait pour SHA-1 et laquelle pour SHA-256. <br><br><h5>  ‚Ä¢ Construction de xmllint </h5><br>  L'une des √©tapes de construction n√©cessite le programme <code>xmllint</code> .  Je ne l'ai pas mis dans la liste des exigences de construction car ses sources sont regroup√©es dans l'archive VirtualBox.  Mais vous devrez toujours le construire vous-m√™me, car les r√®gles de construction VB ne le font pas.  J'ai choisi <code>C:\Programs\xmllint</code> comme r√©pertoire de destination. <ol><li>  Copiez le r√©pertoire <code>C:\Devel\VirtualBox-src\src\libs\libxml2-2.9.4</code> dans <code>C:\Programs\</code> pour vous assurer que sa construction n'affecte en aucun cas VB. </li><li>  Ouvrez la console et ex√©cutez les commandes suivantes: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libxml2-<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>\win32 cscript.exe configure.js cruntime=/MT prefix=C:\Programs\xmllint iconv=no nmake /f Makefile.msvc nmake /f Makefile.msvc install</code> </pre> </li><li>  Supprimez le r√©pertoire <code>C:\Programs\libxml2-2.9.4</code> . </li></ol><br><h5>  ‚Ä¢ Modifications des fichiers VB </h5><br>  Avant de commencer la construction, nous devons √©galement apporter des modifications au code source VB.  L'ensemble complet d'entre eux est pr√©sent√© ici sous la forme d'un fichier de patch t√©l√©chargeable qui peut √™tre appliqu√© soit manuellement, soit en utilisant l'outil de <code>patch</code> (que vous devez t√©l√©charger s√©par√©ment): <br><br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Vbox_build.patch</b></a> <br><br>  S'il n'y a eu aucun probl√®me lors de l'application du patch, vous pouvez passer √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tape suivante</a> .  Cependant, si vous avez eu des probl√®mes et avez besoin de plus d'informations sur des changements particuliers, ou si vous voulez simplement comprendre ce qui est chang√© et pourquoi, vous √™tes invit√©s √† continuer et √† lire les d√©tails fournis ci-dessous.  Veuillez noter que les modifications viennent ici dans un ordre diff√©rent par rapport au fichier de patch.  Les chemins d'acc√®s aux fichiers sont sp√©cifi√©s par rapport au r√©pertoire de code source VB <code>C:\Devel\VirtualBox-src</code> . <ol><li>  Fichier <code>configure.vbs</code> : <ul><li>  La ligne de code: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>), <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  est remplac√© par: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" /?"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  Cette ligne effectue la v√©rification du compilateur, mais elle oublie que <code>cl.exe</code> sans aucun argument renvoie une erreur et est donc consid√©r√© comme un compilateur non valide.  Ajout du " <code>/?</code>  "L'argument fait sortir l'aide et quitter avec le code non-erreur 0. </li><li>  Passons maintenant √† la fonction <code>CheckForMinGW32Sub</code> .  Comme son nom l'indique, il v√©rifie la validit√© du MinGW 32 bits.  Cependant, il est con√ßu pour la version 3.3.3, alors que j'utilise 4.5.4 qui a une structure de fichiers / r√©pertoires diff√©rente, j'ai donc remplac√© la fonction enti√®re par le code suivant (qui est fondamentalement juste une copie de <code>CheckForMinGWw64Sub</code> adapt√© pour le Variante 32 bits): <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> CheckForMinGW32Sub(strPathMingW32, strPathW32API) g_strSubOutput = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> strPathW32API = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> strPathW32API = strPathMingW32 LogPrint <span class="hljs-string"><span class="hljs-string">"trying: strPathMingW32="</span></span> &amp;strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">" strPathW32API="</span></span> &amp; strPathW32API <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/gcc.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/ld.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/objdump.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dllwrap.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dlltool.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/as.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"include/bfd.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"lib32/libgcc_s.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt1.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt2.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcrt.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcr100.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/_mingw.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/stdint.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/windows.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">"/bin/gcc.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" -dumpversion"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dim</span></span> offVer, iMajor, iMinor, iPatch, strVer <span class="hljs-comment"><span class="hljs-comment">' extract the version. strVer = Trim(Replace(Replace(g_strShellOutput, vbCr, ""), vbLf, "")) if (Mid(strVer, 2, 1) = ".") _ And (Mid(strVer, 4, 1) = ".") then iMajor = Int(Left(strVer, 1)) ' Is Int() the right thing here? I want atoi()!!! iMinor = Int(Mid(strVer, 3, 1)) iPatch = Int(Mid(strVer, 5)) else LogPrint "Malformed version: '" &amp; strVer &amp; "'" strVer = "" end if if strVer &lt;&gt; "" then if (iMajor = 4) And (iMinor &gt;= 4) then CheckForMinGW32Sub = True g_strSubOutput = strVer else LogPrint "MinGW32 version '" &amp; iMajor &amp; "." &amp; iMinor &amp; "." &amp; iPatch &amp; "' is not supported (or configure.vbs failed to parse it correctly)." end if else LogPrint "Couldn't locate the GCC version in the output!" end if else LogPrint "Failed to run gcc.exe!" end if end if end function</span></span></code> </pre> </li><li>  Notre prochaine fonction est <code>CheckForCurlSub</code> , et le bloc de code √† √©diter est: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.dll"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre>  Il v√©rifie la validit√© de libcurl, mais il n√©cessite une version li√©e dynamiquement et √©choue si aucun fichier DLL ne peut √™tre trouv√©.  Nous utilisons une version li√©e statiquement, donc la v√©rification de la DLL doit malheureusement nous laisser: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre> </li><li>  Allez maintenant dans la fonction <code>CheckForPython</code> o√π la variable <code>VBOX_BLD_PYTHON</code> est g√©n√©r√©e: <pre> <code class="vbscript hljs"> CfgPrint <span class="hljs-string"><span class="hljs-string">"VBOX_BLD_PYTHON := "</span></span> &amp; strPathPython &amp; <span class="hljs-string"><span class="hljs-string">"\python.exe"</span></span></code> </pre>  La barre oblique inverse devant <code>python.exe</code> doit √™tre remplac√©e par la suivante: <code>"/python.exe"</code> (sans ce correctif, certaines v√©rifications pendant la proc√©dure de g√©n√©ration √©choueront; je n'ai remarqu√© aucun autre effet ind√©sirable, mais c'est plus joli sans messages d'√©chec, et en tout cas mieux vaut pr√©venir que gu√©rir). </li><li>  La version Windows du script de configuration ne prend pas en charge libvpx et libopus, je les ai donc ajout√©es moi-m√™me.  Bien s√ªr, le moyen le plus simple √©tait de coder en dur les chemins vers les biblioth√®ques, mais j'ai pr√©f√©r√© l'impl√©menter comme tous les autres composants, en passant le chemin dans la ligne de commande et en v√©rifiant correctement la validit√©.  Le code principal pour cela se compose des deux fonctions de v√©rification: <pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'' ' Checks for libvpx sub CheckForVpx(strOptVpx) dim strPathVpx, str strVpx = "libvpx" PrintHdr strVpx if strOptVpx = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathVpx = "lib/" &amp; strVsBuildArch &amp; "/vpxmd.lib" strPathVpx = "" if LogFileExists(strOptVpx, "include/vpx/vpx_encoder.h") _ And LogFileExists(strOptVpx, strLibPathVpx) _ then strPathVpx = UnixSlashes(PathAbs(strOptVpx)) CfgPrint "SDK_VBOX_VPX_INCS := " &amp; strPathVpx &amp; "/include" CfgPrint "SDK_VBOX_VPX_LIBS := " &amp; strPathVpx &amp; "/" &amp; strLibPathVpx else MsgError "Can't locate " &amp; strVpx &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strVpx, strPathVpx end sub '' ' Checks for libopus sub CheckForOpus(strOptOpus) dim strPathOpus, str strOpus = "libopus" PrintHdr strOpus if strOptOpus = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathOpus = "lib/" &amp; strVsBuildArch &amp; "/opus.lib" strPathOpus = "" if LogFileExists(strOptOpus, "include/opus.h") _ And LogFileExists(strOptOpus, strLibPathOpus) _ then strPathOpus = UnixSlashes(PathAbs(strOptOpus)) CfgPrint "SDK_VBOX_OPUS_INCS := " &amp; strPathOpus &amp; "/include" CfgPrint "SDK_VBOX_OPUS_LIBS := " &amp; strPathOpus &amp; "/" &amp; strLibPathOpus else MsgError "Can't locate " &amp; strOpus &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strOpus, strPathOpus end sub</span></span></code> </pre>  L' <code>usage</code> fonction est utilis√©e pour imprimer la liste des arguments de ligne de commande;  y ajouter nos deux nouveaux arguments: <pre> <code class="vbscript hljs"> Print <span class="hljs-string"><span class="hljs-string">" --with-libvpx=PATH "</span></span> Print <span class="hljs-string"><span class="hljs-string">" --with-libopus=PATH "</span></span></code> </pre>  Au d√©but de la fonction <code>Main</code> nombreuses variables sont d√©finies pour stocker les chemins d'acc√®s aux composants, nous devons en ajouter deux nouvelles: <pre> <code class="vbscript hljs"> strOptVpx = <span class="hljs-string"><span class="hljs-string">""</span></span> strOptOpus = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre>  Un peu plus loin, le bloc de <code>select-case</code> qui traite les arguments et remplit les variables;  en ajoutant notre contribution: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libvpx"</span></span> strOptVpx = strPath <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libopus"</span></span> strOptOpus = strPath</code> </pre>  Et, enfin, presque √† la toute fin du fichier, il y a la cha√Æne de tous ces appels de fonction de v√©rification, c'est l√† que nous ajoutons l'appel de nos deux nouvelles fonctions: <pre> <code class="vbscript hljs"> CheckForVpx strOptVpx CheckForOpus strOptOpus</code> </pre> </li></ul></li><li>  Le fichier suivant est <code>src\VBox\Runtime\Makefile.kmk</code> .  Nous devons trouver les d√©finitions des variables <code>VBoxRT_LIBS.win</code> et <code>VBoxRT-x86_LIBS.win</code> , et y ajouter deux nouvelles biblioth√®ques, <code>crypt32.lib</code> et <code>bcrypt.lib</code> .  Donc, le code suivant: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib</code> </pre>  se transforme en: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/bcrypt.lib</code> </pre>  (ne manquez pas la barre oblique inverse apr√®s <code>delayimp.lib</code> !);  et, respectivement, ce bloc: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib</code> </pre>  devient: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/bcrypt.lib</code> </pre>  Cette modification est n√©cessaire pour une liaison r√©ussie de <code>VBoxRT.dll</code> .  Je ne suis pas s√ªr √† 100% pourquoi il en est ainsi, la version Oracle n'a pas la d√©pendance au moment du chargement sur <code>crypt32.dll</code> , elle est charg√©e au moment de l'ex√©cution, donc le fichier LIB ne devrait pas √™tre requis.  Cependant sans lui, l'√©diteur de liens ne peut pas trouver certaines fonctions et √©choue.  Je soup√ßonne que cela pourrait √™tre li√© aux options de construction d'OpenSSL, mais je ne l'ai pas v√©rifi√©, l'ajout de la d√©pendance est plus facile.  Et la deuxi√®me d√©pendance, <code>bcrypt.dll</code> , est une exigence pour le nouveau OpenSSL 1.1.1. </li><li>  Si vous avez gSOAP de la version 2.8.79 ou sup√©rieure, vous devrez modifier le fichier <code>src\VBox\Runtime\r3\win\VBoxRT-openssl-1.1plus.def</code> et ajouter les lignes suivantes √† la liste des exportations: <pre> <code class="plaintext hljs"> OpenSSL_version_num DH_generate_parameters_ex DH_new ASN1_STRING_get0_data</code> </pre>  Cette liste d√©finit quelles fonctions sont export√©es par la biblioth√®que <code>VBoxRT.dll</code> (qui contient OpenSSL √† l'int√©rieur).  Lorsque l'outil <code>VBoxWebSrv.exe</code> est li√©, selon la version de gSOAP, il peut n√©cessiter des fonctions OpenSSL suppl√©mentaires.  Puisqu'ils manquent dans la liste des exportations, l'√©diteur de liens ajoute OpenSSL lui-m√™me et se plaint imm√©diatement de tonnes de conflits entre cet OpenSSL externe et sa propre copie d√©j√† int√©gr√©e √† <code>VBoxRT</code> .  L'ajout des exportations susmentionn√©es r√©sout le probl√®me. </li><li>  Comme je l'ai mentionn√© au d√©but, je ne cr√©e pas les ajouts d'invit√©s, mais j'ai besoin que leur image ISO fasse partie de la distribution.  Les r√®gles de construction sont con√ßues pour ce sc√©nario, mais elles s'attendent √† ce que l'image ISO pr√™te apparaisse comme par magie au bon endroit au bon moment.  J'ai ajout√© cette magie dans le fichier <code>src\VBox\Makefile.kmk</code> .  Recherchez le code suivant: <pre> <code class="plaintext hljs"> ifdef VBOX_WITH_ADDITIONS include $(PATH_SUB_CURRENT)/Additions/Makefile.kmk endif</code> </pre>  et juste en dessous, il y a la r√®gle pour le t√©l√©chargement automatique du fichier image: <pre> <code class="plaintext hljs"> ifndef VBOX_WITHOUT_ADDITIONS_ISO $(VBOX_PATH_ADDITIONS_ISO)/VBoxGuestAdditions.iso: $(QUIET)$(MKDIR) -p $(@D) $(VBOX_RETRY) $(TOOL_CURL_FETCH) http://download.virtualbox.org/virtualbox/$(VBOX_VERSION_STRING_RAW)/VBoxGuestAdditions_$(VBOX_VERSION_STRING_RAW).iso -o $@ endif</code> </pre>  Si vous modifiez les fichiers manuellement au lieu d'appliquer le correctif, veuillez noter que les commandes de r√®gle doivent commencer par le caract√®re de tabulation. </li><li>  Avant la version 6.0, la documentation √©tait l'un des sous-syst√®mes qui s'est construit avec succ√®s sans aucune modification.  Je ne sais pas ce qui n'allait pas, mais il a √©t√© consid√©rablement repens√© de telle sorte qu'il ne fonctionne plus sur mon syst√®me de g√©n√©ration.  Je n'ai aucune id√©e de la fa√ßon dont Oracle construit lui-m√™me la documentation (peut-√™tre sur un syst√®me * NIX), mais pour moi, les r√®gles de construction ont continu√© √† perdre des barres obliques dans les chemins, ou √† en ajouter un exc√®s, et en cons√©quence, elles n'ont pas r√©ussi √† trouver les fichiers cibles en raison de disparit√©s dans les fichiers de catalogue.  J'ai finalement r√©ussi √† combiner quelques modifications qui ont permis de construire la documentation sans erreur.  Tout d'abord, l'un des r√©pertoires cibles √©tait manquant, de sorte que certains des fichiers interm√©diaires n'ont pas pu √™tre cr√©√©s.  Ce probl√®me est r√©solu dans le fichier <code>doc\manual\Makefile.kmk</code> , √† l'int√©rieur du bloc de code suivant: <pre> <code class="plaintext hljs">define def_vbox_refentry_to_user_sect1 $$(VBOX_PATH_MANUAL_OUTBASE)/$(1)/user_$(2): $(3) \ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl \ $$(VBOX_XML_CATALOG) $$(VBOX_XML_CATALOG_DOCBOOK) $$(VBOX_XML_CATALOG_MANUAL) \ $$(VBOX_VERSION_STAMP) | $$(dir $$@) $$(call MSG_TOOL,xsltproc $$(notdir $$(filter %.xsl,$$^)),,$$(filter %.xml,$$^),$$@) $$(QUIET)$$(RM) -f "$$@" $$(QUIET)$$(call VBOX_XSLTPROC_WITH_CAT) --output $$@ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl $$&lt; endef</code> </pre>  Juste apr√®s le <code>$$(RM)</code> j'ai ajout√© une commande pour cr√©er le r√©pertoire manquant: <pre> <code class="plaintext hljs"> $$(QUIET)$$(MKDIR) -p "$$(@D)"</code> </pre> <br>  Quant aux barres obliques, les correctifs se trouvent dans le fichier <code>doc\manual\Config.kmk</code> .  Je n'ai pas pu trouver de solution ¬´normale¬ª pour cela, mais il existe une solution de contournement suffisamment bonne pour des raisons pratiques, ce qui implique de dupliquer les r√®gles de substitution de chemin pour les chemins incorrects.  Tout d'abord, sous la ligne: <pre> <code class="plaintext hljs"> VBOX_FILE_URL_MAYBE_SLASH = $(if $(eq $(KBUILD_HOST),win),/,)</code> </pre> I've created two new variables which basically contain the same paths as their origins, but with triple slash after the disk letter instead of a single slash: <pre> <code class="plaintext hljs"> VBOX_PATH_MANUAL_SRC_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_SRC)) VBOX_PATH_MANUAL_OUTBASE_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_OUTBASE))</code> </pre> A little bit below that, there is a rule for creating the catalog file: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> For each line which contains the variable <code>VBOX_PATH_MANUAL_SRC</code> or <code>VBOX_PATH_MANUAL_OUTBASE</code> (except for the line with the <code>file://</code> prefix), I've appended the copy of the whole line, but with the variable replaced with its triple-slash counterpart. The result looks like this: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> Even further down, there is another rule for creating an auxiliary catalog file; the starting line is: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG_MANUAL): $(MAKEFILE_CURRENT) | $$(dir $$@)</code> </pre> Here I'm doing the same operation as above. In addition, in the beginning of the generated file there are several lines defining the entries in the <code>common/</code> subdirectory: <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> With these we have the opposite problem: triple slash after the <code>file</code> is replaced with a single slash. I worked this around by getting rid of the <code>file</code> protocol altogether and replacing those URIs with direct file system paths in the target address (the <code>uri</code> attribute). The result for these lines looks like this (including the aforementioned fix): <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> </li><li> When VB is built with signing, most of its binaries receive the integrity check flag (the linker option <code>/IntegrityCheck</code> ) which forces Windows to check digital signatures and forbids launching applications which are signed incorrectly. If you have a valid paid certificate that's not a problem; however with a self-signed certificate VB will refuse to start, even if Windows is booted in the test mode. I've modified the file <code>Config.kmk</code> in such a way that this flag is only added when you have a full-grown certificate (the criterion of that is presence of a cross-certificate in <code>LocalConfig.kmk</code> ; see <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">below</a> ). The changes look like this: <ul><li> A new variable <code>VBOX_INTEGRITY_CHECK</code> is added, which contains the desired value of the option: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) VBOX_INTEGRITY_CHECK := /IntegrityCheck else VBOX_INTEGRITY_CHECK := /IntegrityCheck:NO endif</code> </pre> </li><li> Below that there is the <code>editbin</code> call: <pre> <code class="plaintext hljs"> $(VBOX_VCC_EDITBIN) /LargeAddressAware /DynamicBase /NxCompat /Release /IntegrityCheck \ /Version:$(VBOX_VERSION_MAJOR)0$(VBOX_VERSION_MINOR).$(VBOX_VERSION_BUILD) \ "$@"</code> </pre> Here I've replaced the unconditional <code>/IntegrityCheck</code> with the new variable <code>$(VBOX_INTEGRITY_CHECK)</code> . </li><li> Next, look for the blocks of the following kinds: <pre> <code class="plaintext hljs">ifdef VBOX_SIGNING_MODE TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre>  ou <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_WITH_HARDENING) TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre> where ¬´ <code>XXXXXX</code> ¬ª stands for various component names. There are 6 such blocks in total, 3 of each kind. Here I've modified the condition by adding a check for cross-certificate. The first line then turns into, respectively: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE)</code> </pre>  ou <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) &amp;&amp; defined(VBOX_WITH_HARDENING)</code> </pre> </li></ul></li><li> Two more files modified by me do not take immediate part in building of VB: <code>src\VBox\Installer\win\Scripts\PackDriversForSubmission.cmd</code> and <code>UnpackBlessedDrivers.cmd</code> . These auxiliary scripts can be used if you intend to send the drivers into Microsoft for Windows 10 signing. The first script prepares a CAB archive for sending; the second one unpacks the resultant ZIP archive with the signed drivers and verifies the signatures. In the packing script all I did was just fixing several typos. In the unpacking script I added ability to specify path to the <code>signtool</code> program, and got rid of the <code>unzip</code> tool by replacing it with a small Perl script. The signing procedure is described below. If you don't plan to get the Microsoft signature you can simply ignore all these changes in the scripts. </li></ol><br><a name="final-touches-localconfig"></a><h5> ‚Ä¢ VB build configuration file </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, nous devons cr√©er le fichier </font></font><code>LocalConfig.kmk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le r√©pertoire des sources VB et y √©crire tous les chemins et param√®tres de construction. </font><font style="vertical-align: inherit;">Vous pouvez utiliser le texte suivant comme mod√®le:</font></font><pre> <code class="plaintext hljs">VBOX_WITH_HARDENING := VBOX_PATH_WIX := C:\Programs\WiX VBOX_GSOAP_INSTALLED := 1 VBOX_PATH_GSOAP := C:\Programs\gSOAP VBOX_WITH_COMBINED_PACKAGE := 1 VBOX_WITH_QT_PAYLOAD := 1 VBOX_WITH_QTGUI_V5 := 1 VBOX_SIGNING_MODE := release VBOX_CERTIFICATE_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_CERTIFICATE_SHA2_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_SHA2_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_TSA_URL := http://timestamp.digicert.com VBOX_TSA_SHA2_URL := http://timestamp.digicert.com VBOX_TSA_URL_ARGS := /t "$(VBOX_TSA_URL)" VBOX_TSA_SHA2_URL_ARGS := /tr "$(VBOX_TSA_SHA2_URL)" /td sha256 VBOX_CROSS_CERTIFICATE_FILE := VBOX_CROSS_CERTIFICATE_FILE_ARGS := VBOX_CROSS_CERTIFICATE_SHA2_FILE := VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS := VBOX_PATH_SIGN_TOOLS := C:\Programs\DevKits\8.1\bin\x64 VBOX_PATH_SELFSIGN := C:\WinDDK\7600.16385.1\bin\selfsign VBOX_PATH_WISUMINFO := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSumInf.vbs" VBOX_PATH_WISUBSTG := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSubStg.vbs" VBOX_WITH_DOCS := 1 VBOX_WITH_DOCS_CHM := 1 VBOX_WITH_DOCS_PACKING := 1 VBOX_WITH_ADDITIONS := VBOX_WITH_ADDITIONS_PACKING := 1 VBOX_HAVE_XMLLINT := 1 VBOX_XMLLINT := C:\Programs\xmllint\bin\xmllint.exe VBOX_PATH_DOCBOOK := C:/Programs/DocBook/xsl VBOX_PATH_DOCBOOK_DTD := C:/Programs/DocBook/xml VBOX_PATH_HTML_HELP_WORKSHOP := "C:\Program Files (x86)\HTML Help Workshop" VBOX_PDFLATEX := C:\Programs\MiKTeX\texmfs\install\miktex\bin\pdflatex.exe VBOX_PDFLATEX_CMD := $(VBOX_PDFLATEX) -halt-on-error -interaction batchmode TOOL_CURL_FETCH := C:\Programs\curl\x64\curl.exe PATH_TOOL_NASM := C:/Programs/nasm VBOX_INSTALLER_LANGUAGES := en_US VBOX_WITH_TESTCASES := VBOX_WITH_VALIDATIONKIT := VBOX_WITH_VBOX_IMG := 1 VBOX_WITH_RECORDING := 1 VBOX_WITH_AUDIO_RECORDING := 1 SDK_VBOX_VPX := 1 VBOX_WITH_LIBVPX := 1 SDK_VBOX_OPUS := 1 VBOX_WITH_LIBOPUS := 1 VBOX_BUILD_PUBLISHER := _OSE</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vous devrez modifier ce mod√®le: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les variables </font></font><code>VBOX_CERTIFICATE_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>VBOX_CERTIFICATE_SHA2_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doivent contenir les noms des certificats SHA-1 et SHA-256, respectivement.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les variables </font></font><code>VBOX_CERTIFICATE_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>VBOX_CERTIFICATE_SHA2_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doivent contenir les empreintes de ces certificats; </font><font style="vertical-align: inherit;">vous les avez copi√©s pr√©c√©demment √† partir de la console de gestion des certificats.</font></font></li><li> If you have a paid certificate you should delete the lines defining the variables <code>VBOX_CROSS_CERTIFICATE_FILE_ARGS</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS</code> , then in the variables <code>VBOX_CROSS_CERTIFICATE_FILE</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE</code> (without ¬´ <code>_ARGS</code> ¬ª) put the full path to the cross-certificate (without it the drivers will not be accepted). You can download it from the web site of the company that issued the certificate, or <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">from Microsoft</a> . </li><li> You can fine-tune the signing process using various additional variables and macros to redefine the certificate storage, timestamp server, or even construct a full command line for the <code>signtool</code> program. You can take a look into the file <code>Config.kmk</code> below the comment ¬´Code Signing¬ª, there you'll find which variables are defined and how they are used. </li><li> If you've installed some of the programs into paths different from mine, you need to fix those paths in the template. It's strongly recommended to keep the path style for each variable (forward/backward slashes), sometimes it's critical for successful build. </li><li> Fox WiX you need to specify the path to its binaries. With the portable version, it is just the directory where you unpacked it; if you used the installer, the binaries will be located in the subdirectory <code>bin</code> . Please, note, that the path must not contain spaces! If it does you have to convert it into the 8.3 format (you can use <code>dir /x</code> for that). Unfortunately, enclosing the path in quotes does not work with this variable. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La variable </font></font><code>VBOX_BUILD_PUBLISHER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sp√©cifie le suffixe de marque dans le num√©ro de version. </font><font style="vertical-align: inherit;">Par d√©faut, il s'agit de "_OSE" (c'est-√†-dire que la version compl√®te du produit est "6.0.4_OSE"). </font><font style="vertical-align: inherit;">Vous pouvez sp√©cifier ici tout autre suffixe ou le mettre √† vide pour vous en d√©barrasser compl√®tement. </font><font style="vertical-align: inherit;">Mais si vous supprimez compl√®tement la variable, elle utilisera la valeur par d√©faut "_OSE".</font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les autres variables sont principalement utilis√©es pour d√©clarer les composants √† construire. </font><font style="vertical-align: inherit;">Et, bien s√ªr, la d√©claration principale vient tout en haut: d√©sactivez le durcissement.</font></font><br><br><a name="build-vb"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cr√©ation de virtualbox </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, nous pouvons maintenant commencer √† construire VirtualBox lui-m√™me. </font><font style="vertical-align: inherit;">Si vous pr√©f√©rez normalement construire pour diff√©rentes plates-formes en parall√®le, vous devrez vous en passer pour l'instant, ou utiliser deux copies d'arborescence source distinctes, car VB a un fichier de configuration commun qui est g√©n√©r√© avant la construction et contient des donn√©es d√©pendantes de la plate-forme. </font><font style="vertical-align: inherit;">Il ne serait pas agr√©able pour le compilateur de le jeter soudainement de l'environnement de construction 64 bits dans l'environnement 32 bits au milieu du processus de construction. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez besoin de signatures de pilotes compatibles Windows 10, veuillez vous reporter aux informations fournies apr√®s la description de la proc√©dure principale.</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commen√ßons par la version 64 bits. </font><font style="vertical-align: inherit;">Ouvrez la console et ex√©cutez les commandes suivantes:</font></font><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=amd64 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x64 --with-openssl=C:\Programs\OpenSSL\x64 --with-openssl32=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x64 --with-libcurl32=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x64 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/obj/Installer/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch_amd64.msi</code> </pre> The <code>configure.vbs</code> script verifies the environment and generates configuration files ( <code>AutoConfig.kmk</code> and <code>env.bat</code> ). The first <code>kmk</code> command builds the binaries and collect them into <code>out\win.amd64\bin\</code> . And the last command packs them all into the intermediate MSI package. Important notes: <ul><li> You must use forward slashes in the last command. With backslashes, <code>kmk</code> would fail to find the build rules. </li><li> Even though we are building the 64-bit version, the target package is located in <code>out\win.x86\‚Ä¶</code> , because the final stage of the build will be performed from the 32-bit build environment. </li><li> If you've changed the branding suffix you need to change the name of the target package by replacing the ¬´_OSE¬ª with what you specified in the variable <code>VBOX_BUILD_PUBLISHER</code> . </li><li> The revision number in the MSI package name (128164) can be found in the file <code>Config.kmk</code> inside the <code>VBOX_SVN_REV_FALLBACK</code> variable definition. Please, note, that this value may be different from revisions of the official distribution (for instance, the version 6.0.4 has release number 128413). Unfortunately, I have no idea why. </li></ul></li><li> Now we need to build the 32-bit version and pack everything together. For that, open a new console window, and run the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=x86 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x32 --with-openssl=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/bin/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch.exe</code> </pre> Same as with the 64-bit, you need to replace the ¬´_OSE¬ª suffix with what you have. <br> Notice how in the last command we are building an <code>EXE</code> , and not an <code>MSI</code> . This is the final installer which will cause the 32-bit package to be built automatically, from dependencies. </li><li> Even if you have a paid certificate you will find that you cannot install this distribution into Windows 10 booted with Secure Boot enabled. This OS has stricter requirements, and the drivers must be signed by none other than Microsoft themselves. The procedure is explained in details on various Internet resources and is unrelated to this article, so I'm not going to go deep into this topic. Instead I'll outline the main steps you need to take for integrating this task with the VB build procedure. <ul><li> The main requirement here is that you must have not just a normal code signing certificate, but an EV one (Extended Validation). Also you need to register an account at <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Hardware Dev Center</a> and add your certificate there. </li><li> Now, during building the 64-bit version of VB, just after you've got all binary components (that is, after the first <code>kmk</code> run which was without arguments), you need to create a CAB archive with the drivers. There is a batch script template for that; the build system modifies it according to the current task and puts it into <code>out\win.amd64\release\repack\</code> . Go into this path and run the following command: <pre> <code class="dos hljs">PackDriversForSubmission.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -x</code> </pre> When the script finishes, the file <code>VBoxDrivers-6.0.4r128164-amd64.cab</code> will appear in the same directory. </li><li> You need to sign this CAB archive with your EV certificate. Then go to the Microsoft Hardware Dev Center, create a new submission, upload your signed archive, select the desired target OS version (make sure it's 64-bit) and send the submission. </li><li> It will take several minutes to process, after which you will have a ZIP archive where all the drivers have been signed by Microsoft in addition to your signature, and all the CAT files generated anew. Download this archive and place it somewhere so that the build system had access to it. </li><li> Unpack the archive and put all the files from the subdirectories directly into <code>out\win.amd64\release\bin\</code> overwriting the existing files. You can do it either manually or using another script from the same path <code>out\win.amd64\release\repack\</code> by running the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> _MY_SIGNTOOL=C:\Programs\DevKits\<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>\bin\x64\signtool.exe UnpackBlessedDrivers.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -n -i <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>\to\signed.zip</code> </pre> Of course, you need to put here the correct paths to <code>signtool.exe</code> and the ZIP archive. </li><li> Now you can run the second <code>kmk</code> command which packs all the components into an MSI installer. If you were doing all this in the same console window, don't forget to switch back to the base directory of the VB project. </li><li> Finally, proceed with building of the 32-bit version of VB, and perform all the same additional steps: after the first <code>kmk</code> switch to <code>out\win.x86\release\repack\</code> , create the CAB archive, sign it, send to Microsoft (now choosing the 32-bit OS version), replace the drivers with their counter-signed versions, and run the final <code>kmk</code> for building the complete VB distribution. </li></ul></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si aucun de nous n'a rien g√¢ch√©, toute cette longue cha√Æne devrait vous apporter un nouveau programme d'installation de VirtualBox brillant qui ne diff√®re de celui d'Oracle que par son ic√¥ne, l'image About, et, bien s√ªr, le manque profond de durcissement. Il n'est pas difficile de remplacer √©galement l'ic√¥ne et l'image, mais je n'entrerai pas dans ce sujet ici. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour plus de commodit√©, j'ai cr√©√© un </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier batch unique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui automatise la construction compl√®te de VB. Vous pouvez l'utiliser si vous avez besoin de cr√©er r√©guli√®rement le programme d'installation complet.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encore quelques mots sur l'installation de la distribution r√©sultante si vous utilisez un certificat auto-sign√©. </font><font style="vertical-align: inherit;">Comme il a √©t√© soudainement d√©couvert, dans Windows 8/10, il ne suffit pas de d√©marrer en mode test, l'installation √©choue toujours en affirmant que les signatures de pilote ne sont pas valides. </font><font style="vertical-align: inherit;">Vous pouvez contourner ce probl√®me en ajoutant les certificats dans votre stockage racine CA:</font></font><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez la bo√Æte de dialogue Propri√©t√©s du programme d'installation VB en cliquant dessus avec le bouton droit et en s√©lectionnant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Propri√©t√©s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis passez √† l' </font><font style="vertical-align: inherit;">onglet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signatures num√©riques</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous y trouverez deux signatures, toutes deux nomm√©es "Roga et Kopyta Ltd", l'une est sha1, l'autre sha256. </font><font style="vertical-align: inherit;">S√©lectionnez le premier, cliquez sur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tails</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre bo√Æte de dialogue appara√Æt, dans laquelle vous devez cliquer sur le bouton </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher le certificat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li> One more dialog, click <i>Install Certificate</i> . </li><li> In the Import wizard, select the location ¬´Local Machine¬ª, click <i>Next</i> . After UAC confirmation (if needed), there's the certificate store selection. Select ¬´Place all certificates in the following store¬ª, then click <i>Browse</i> and choose the store named ¬´Trusted Root Certification Authorities¬ª. Then <i>Next</i> , <i>Finish</i> . You're done, the certificate is installed. </li><li> Close all the dialogs but the very first one, select the second signature (sha256) and repeat the steps 2 to 4 for it too. </li><li> Close all the dialogs, run the installer. Now it should work fine. </li></ol><br><a name="afterword"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"> Epilogue </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand j'ai fini d'√©crire l'article, j'ai √©t√© moi-m√™me surpris par son volume. Au d√©but, je comptais entrer dans de nombreux d√©tails sur les raisons de choisir telle ou telle fa√ßon de r√©soudre chaque probl√®me, expliquer exactement quel √©tait le probl√®me et quelles solutions alternatives pourraient √™tre applicables. Mais tr√®s vite, il est devenu clair que, s'il √©tait charg√© de tous ces d√©tails, le texte serait monstrueusement √©norme. Je dois donc m'excuser pour les recettes ressemblant √† "faites-le et ne posez pas de questions". J'ai une forte aversion pour eux-m√™mes, mais je ne pouvais tout simplement pas trouver d'autre moyen. Parfois, j'essayais toujours de d√©crire ce qui se passait, pour adoucir l'impression.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une grande quantit√© de d√©tails sur le syst√®me de construction VB devaient rester derri√®re la sc√®ne; car j'ai tous deux h√©sit√© √† gonfler le texte et, parfois, j'√©tais trop paresseux pour aller chercher une approche diff√©rente et plus efficace pour r√©soudre un probl√®me. Apr√®s tout, mon objectif principal, au d√©part, √©tait de me procurer une version fonctionnelle de la version actuelle de VirtualBox. 4.3.12 √©tait d√©j√† bien d√©pass√© √† ce moment-l√†, mais je ne pouvais pas risquer de mettre √† jour l'un de mes outils les plus activement utilis√©s vers la version renforc√©e qui pourrait simplement cesser de fonctionner √† tout moment. Bien que, de temps en temps, je revienne et, ayant trouv√© quelque chose de nouveau, l'ajoute √† cet article. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'esp√®re que cet article trouvera son public. Si vous √™tes int√©ress√© √† voir et analyser le r√©sultat final mais que vous ne voulez pas mettre en place toute la pile de programmes, vous pouvez obtenir ma version de la distribution ici:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version 6.0.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tous les pilotes (et autres fichiers) sont sign√©s avec un certificat auto-sign√© non approuv√©, donc pour l'installer dans la version Windows 64 bits, vous devrez red√©marrer en mode test. </font><font style="vertical-align: inherit;">Si vous avez des questions, des suggestions, des recommandations, n'h√©sitez pas √† m'√©crire ici dans les commentaires, ou via des messages personnels. </font><font style="vertical-align: inherit;">Que l'Open Source soit avec vous!</font></font><br><br><a name="history"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amendements </font></font></h4><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archive</font></font></b> <div class="spoiler_text"><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Article russe publi√© le 21/01/2016 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VirtualBox 5.0.12. </font></font></li></ol><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Mise √† jour du 24/05/2016 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'article est mis √† jour pour VB 5.0.20, l'un des principaux changements √©tant la double signature SHA-1 / SHA-256. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajout de la d√©sactivation des contr√¥les de signature forc√©e si des certificats auto-sign√©s sont utilis√©s. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajout d'informations sur la solution de contournement de l'√©chec d'installation de la distribution auto-sign√©e. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les versions de la biblioth√®que ont √©t√© mises √† jour. </font></font></li><li> Disabled some unused components for speeding up the build process. </li><li> Minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 29.07.2016 </h5><ol><li> The article is updated for VB 5.1.2; the most important change is upgrading to Qt5. The differences from VB 5.0.x procedure are specified where applicable. </li><li> Library versions were updated. </li><li> The full build batch was updated to check error codes after each operation. </li><li> Minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 15.09.2016 </h5><ol><li> The article is updated for VB 5.1.6. </li><li> Library versions were updated. </li><li> Added NASM for building OpenSSL. </li><li> Added OpenSSL into cURL; this fixes the broken function of checking for updates and downloading the Extension Pack. </li><li> The full build batch now reads the VB version automatically. </li><li> Various minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 30.11.2016 </h5><ol><li> The article is updated for VB 5.1.10. </li><li> Library versions were updated; particularly OpenSSL was upgraded to version 1.1.x. </li><li> Fixed some installation errors: <ul><li> path to the Qt plugins now points to the installation directory; </li><li> added forgotten OpenSSL libraries to the 32-bit components of the 64-bit VB version. </li></ul></li><li> The article no longer contains information about building older VB versions. If needed, the previous versions of it are available in the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub project</a> . </li></ol><br><h5> ‚Ä¢ Update of 2.12.2016 </h5><ol><li> Switched to using statically linked OpenSSL. </li></ol><br><h5> ‚Ä¢ Update of 20.06.2017 </h5><ol><li> The article is updated for VB 5.1.22. </li><li> cURL, OpenSSL, and gSOAP were updated; adapted the build instructions for cURL, gSOAP and VB. </li></ol><br><h5> ‚Ä¢ Update of 1.12.2017 </h5><ol><li> The article is updated for VB 5.2.2. </li><li> Switched from MinGW-32 3.3.3 to 4.5.4. </li><li> Qt, cURL, OpenSSL, gSOAP, and some build tools were updated; adapted the build instructions for cURL, gSOAP and VB. </li><li> Switched to using local archives of DocBook XML/XSL instead of online versions. </li><li> Using cURL program instead of wget for downloading the Guest Additions ISO image. </li><li> Various minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 4.12.2017 </h5><ol><li> The libxml version was fixed in the build instructions. </li></ol><br><h5> ‚Ä¢ Update of 4.09.2018 </h5><ol><li> The article is updated for VB 5.2.18. </li><li> cURL, OpenSSL, gSOAP and some build tools were updated; adapted the build instructions for cURL. </li></ol><br><h5> ‚Ä¢ Update of 12.12.2018 </h5><ol><li> The article is updated for VB 5.2.22. </li><li> Enabled screen recording functionality which is disabled in OSE version by default; added libraries libopus and libvpx for encoding. </li><li> cURL, OpenSSL, and gSOAP were updated. </li><li> The full set of VirtualBox source code changes is now published as a single patch file for easier application. </li></ol></div></div><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Mise √† jour du 25/01/2019 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'article est mis √† jour pour VB 6.0.2. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Am√©lioration de la d√©sactivation de la g√©n√©ration d'ajouts d'invit√©s. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cURL et gSOAP ont √©t√© mis √† jour; </font><font style="vertical-align: inherit;">Les feuilles de style DocBook XSL ont √©t√© r√©trograd√©es √† la version 1.69.1 (la documentation est mieux adapt√©e √† cette version).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le lot de construction complet a √©t√© divis√© du texte de l'article en un fichier t√©l√©chargeable. </font></font></li></ol><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Mise √† jour du 04/08/2019 </font></font></h5><ol><li> The article has been translated into English for the first time. Also numerous minor changes were introduced into the Russian version. </li><li> Added information about drivers signing for Windows 10. </li><li> The article is updated for VB 6.0.4. </li><li> cURL, OpenSSL, gSOAP, and some tools were updated. </li><li> The full build batch no longer has to be placed at the specific path. Also, it now contains the basic template for automated Windows 10 drivers signing. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447300/">https://habr.com/ru/post/fr447300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447288/index.html">Top 5 des pi√®ces stables. Tout ce que vous devez savoir</a></li>
<li><a href="../fr447290/index.html">Docteur promenades, promenades</a></li>
<li><a href="../fr447292/index.html">14 nouveaux produits dans Visual Studio 2019</a></li>
<li><a href="../fr447294/index.html">Live Share d√©sormais inclus avec Visual Studio 2019</a></li>
<li><a href="../fr447298/index.html">Gestion des connaissances gr√¢ce √† des mod√®les de comp√©tences</a></li>
<li><a href="../fr447302/index.html">Syst√®me d'exploitation Week-end</a></li>
<li><a href="../fr447304/index.html">Avaricious ne paie pas deux fois - nous configurons la m√©moire sur la plate-forme AMD B450 et obtenons des performances gratuites</a></li>
<li><a href="../fr447306/index.html">Transformateur Tesla sur une carte de pouce carr√©</a></li>
<li><a href="../fr447308/index.html">Conception instantan√©e</a></li>
<li><a href="../fr447310/index.html">Comment nous sommes pass√©s du d√©veloppement Web au d√©veloppement de jeux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>