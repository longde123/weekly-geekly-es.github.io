<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïäÔ∏è üöç ‚óΩÔ∏è Wie man mit dem Mikrocontroller von JS spricht üë± üìé üë®üèΩ‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warum wird ein Mikrocontroller ben√∂tigt? Zum Beispiel, um zu Hause eine Brauerei zu gr√ºnden. Wenn Ihre Brauerei nicht ausreicht, k√∂nnen Sie etwas Gr√∂√ü...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man mit dem Mikrocontroller von JS spricht</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/450826/">  Warum wird ein Mikrocontroller ben√∂tigt?  Zum Beispiel, um zu Hause eine Brauerei zu gr√ºnden.  Wenn Ihre Brauerei nicht ausreicht, k√∂nnen Sie etwas Gr√∂√üeres tun: einen Questraum bauen, eine Pr√§sentation arrangieren, einen interaktiven Brunnen, der ein Bild mit Tropfen zeichnet, oder einen Ausstellungsstand f√ºr ein gro√ües Unternehmen.  Mit einem Mikrocontroller k√∂nnen Sie alles machen - alles h√§ngt von Ihrer Vorstellungskraft ab. <br><br>  Es gibt ein Missverst√§ndnis, dass Sie zum Erstellen Ihrer eigenen Dr√ºsen den Assembler C / C ++ kennen m√ºssen, in der Lage sein m√ºssen, den Speicher zu verwalten und die Elektrizit√§t genau zu verstehen.  Fr√ºher war es so, aber die Technologie entwickelt sich und jetzt reicht f√ºr die vollst√§ndige Umsetzung des Projekts nur JS aus! <br><br><img src="https://habrastorage.org/webt/cc/wc/ou/ccwcoucl5o2c-9xayxy04jc8fsq.jpeg"><br><br>  Ok, wir kennen JavaScript, aber wie kann man es mit Hardware verbinden?  Welche Art von Eisen gibt es und was kann es?  Wie konfiguriere ich das gesamte System?  Bei der Dekodierung des Berichts wird Victor Nakoryakova von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FrontendConf</a> lernen: wie man nur JS verwendet, um Servos zu steuern, wie man das System physisch mit einem PC kombiniert und wie man Kommunikationsoptionen f√ºr die Anwendung auf JS verwendet.  Wir werden Serialport- und Firmata-Pakete, Serialport mit selbstgeschriebener Firmware in C ++, Espruino und die Programmierung des Controllers direkt auf JS, Raspberry Pi, HTTP im lokalen Netzwerk sowie HTTP und MQTT √ºber die Cloud diskutieren. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yqeTaf44vNk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <strong>Victor Nakoryakov</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">nagelxx</a> ) - technischer Direktor, Mitbegr√ºnder von Amperka.  Er mag fortschrittliche Entwicklungstechnologien, funktionale Programmierung und physikalisches Rechnen.  Amperka produziert und vertreibt elektronische Module, damit Laien mit ihren eigenen H√§nden intelligente Ger√§te, Trainingskits und einzelne Bausteine ‚Äã‚Äãerstellen k√∂nnen, die ihrem Ger√§t hinzugef√ºgt werden k√∂nnen - Motoren, GPS, SMS. <br><br><h2>  Wo man JavaScript schreibt </h2><br>  <strong>Espruino verf√ºgt √ºber einen eigenst√§ndigen Mikrocontroller mit JavaScript.</strong>  Mit der Espruino-Plattform k√∂nnen Sie JS direkt auf den Mikrocontroller schreiben.  Dies ist an sich eine autonome Sache: an einen Computer angeschlossen, geflasht, und dann funktioniert es unabh√§ngig. <br><br>  <strong>Der Raspberry Pi</strong> ist ein kleiner Computer mit GPIO. <br><br>  <strong>In einer Webanwendung</strong> zum Frontend oder Backend. <br><br>  Ich werde die Funktionsweise des Systems am Beispiel eines Frosches zeigen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gehen Sie</a> von Ihrem Telefon zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">toad.amperka.ru</a> - eine einfache Weboberfl√§che wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">angezeigt</a> . <br><br><img src="https://habrastorage.org/webt/pd/ya/be/pdyabe5bjmklkee0jjco7nontue.jpeg"><br><br>  Die linke Spalte steuert das linke Auge, das rechte - das rechte.  Das Prinzip ist einfach - ich habe den Knopf gedr√ºckt, der Servomotor dreht das Auge. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/z5/re/ocz5rert1d774i6ic7dzkaahjpa.gif" width="350"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Videodemonstration</a> eines Standes mit einem Frosch w√§hrend des Berichts. <br><br><h2>  Wie der Frosch funktioniert </h2><br>  Wenn Sie toad.amperka.ru √∂ffnen, erhalten Sie eine statische Webseite mit statischem JS, die die Bibliothek <a href="">MQTT.js</a> verwendet.  Diese Bibliothek kontaktiert den MQTT-Broker in der Cloud. <br><br><img src="https://habrastorage.org/webt/5r/7h/it/5r7hit4db5ds9369m2fgmsua8t4.jpeg"><br><br>  Wenn Sie Redis, Publish / Subscribe, RabbitMQ oder andere Nachrichtenwarteschlangen kennen, haben Sie sofort verstanden, worum es ging.  <strong>MQTT ist ein Machine-to-Machine-Nachrichtenbroker</strong> .  Leicht und einfach, damit auch schwache Dr√ºsen es nutzen k√∂nnen. <br><br>  MQTT erfordert einen Broker auf dem Server.  Aber Sie m√ºssen es nicht einmal anheben - mieten.  F√ºr ein paar Dollar im Monat haben Sie Ihren eigenen MQTT-Broker.  Kein Backend erforderlich. <br><br>  Auf der anderen Seite gibt es einen Controller vom MQTT-Broker.  Es gibt viele verschiedene Ger√§te mit dieser Rolle, z. B. den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wi-Fi-Steckplatz</a> .  Dies ist ein Controller, der eine Verbindung zum Internet herstellen kann. <br><br><img src="https://habrastorage.org/webt/th/dz/jc/thdzjcdluwlertps_bl5lbkdjui.jpeg"><br><br>  Es funktioniert auf Basis des beliebten ESP8266-Chips.  Es wurde die M√∂glichkeit hinzugef√ºgt, √ºber Micro-USB mit Strom zu versorgen und externe Peripherieger√§te √ºber Dreifachkontakte anzuschlie√üen, um eine Verbindung zu anderen Ger√§ten herzustellen. <br><br><h2>  So programmieren Sie Hardware in JS </h2><br>  Nichts Au√üergew√∂hnliches, JS regul√§r - fast voll ES6.  Einige Funktionen und Objekte zum Arbeiten auf niedriger Ebene mit elektrischen Signalen wurden der Standardbibliothek hinzugef√ºgt.  Zum Beispiel Funktionen zum einfachen digitalen Lesen und Schreiben. <br><br>  <strong>digitalRead - digitale Anzeige</strong> .  Dies ist eine Frage an die Steuerung: "Gibt es drei Volt an Pin Nummer 4?"  Wenn Spannung anliegt, wird TRUE zur√ºckgegeben, wenn nicht, FALSE.  Dies implementiert das Lesen einfacher bin√§rer Sensoren: Tasten, Schalter, Reed-Schl√∂sser und Infrarot-Bewegungssensoren. <br><br>  <strong>digitalWrite ist eine einfache digitale Aufnahme</strong> .  Wir sagen, digitalWrite TRUE - 3V passt zum Pin.  Wir sagen digitalWrite FALSE - 0V.  Mit diesem einfachen Prinzip k√∂nnen Sie einen LED-Streifen anz√ºnden / l√∂schen oder eine Atomrakete abschie√üen.  Wir senden ein schwaches Signal an das Relais, es pendelt eine gro√üe Last und die Rakete flog. <br><br>  Es gibt auch Funktionen zum Arbeiten mit Zwischenwerten zwischen 0 und 3V: <br><br><ul><li>  analogRead; </li><li>  analogWrite; </li><li>  setWatch; </li><li>  digitalPulse. </li></ul><br>  Mit Befehlen k√∂nnen Sie alle Arten von Drehungen abfragen und Funktionen f√ºr die Fuzzy-Aufnahme bereitstellen. <br><br>  Als n√§chstes kommen die Objekte f√ºr die Arbeit mit Schnittstellen, die in der Welt der Mikrocontroller akzeptiert werden.  Wenn wir im Web HTTP, WebSocket und TCP verstehen und mit diesen vertraut sind, gilt f√ºr einen Mikrocontroller Folgendes: <br><br><ul><li>  Seriell - serielle Schnittstelle; </li><li>  I2C-Bus </li><li>  SPI-Bus </li><li>  OneWire-Bus. </li></ul><br><h2>  Wie man einen Servomotor tritt </h2><br>  Als Beispiel erkl√§re ich Ihnen, wie Sie einen Motor steuern, der in einem Injektionsger√§t steht.  Das Motorprotokoll ist einfach.  0 V werden an den Steuerstift angelegt - die untere Grenze.  Einmal alle 20 Œºs muss es getreten werden, was eine stabile Einheit von 3 V ergibt, und nach einer Weile auf 0 zur√ºckgesetzt werden. <br><br><img src="https://habrastorage.org/webt/io/1t/aj/io1tajdpojik7cxsab0mrddw0bi.jpeg"><br><br>  Dann wiederholt sich alles wieder.  Je nach L√§nge der Einheit erhalten wir unterschiedliche Drehzahlen.  Mit einer Pulsl√§nge von 1.500 Œºs steht der Motor still.  Wenn es in die eine oder andere Richtung abweicht, dreht es sich im oder gegen den Uhrzeigersinn.  Die Gr√∂√üe der Abweichung beeinflusst die Drehzahl. <br><br><h2>  Wie man programmiert </h2><br>  Die Programmierung der Espruino-Plattform erfolgt in der gleichnamigen Espruino-IDE.  Die Mikrocontroller-Karte ist √ºber ein Micro-USB-Kabel mit dem Computer verbunden.  Das einzige ist, dass Sie den Treiber installieren m√ºssen, was 1,5 Minuten dauert.  Der Treiber ist f√ºr MAC und Windows installiert, und unter Linux funktioniert alles sofort. <br><br>  Hier ist ein Beispiel f√ºr ein Programm, das mit einem Klick in die Umgebung geladen wird.  Einmal pro Sekunde blinkt eine LED: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> on = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ on = !on; LED1.write(on); },<span class="hljs-number"><span class="hljs-number">500</span></span>);</code> </pre> <br>  Links in der Umgebung befindet sich der REPL-Interpreter.  Geben Sie "1 + 1" ein.  Das Programm gibt die Antwort "2".  Wunder! <br><br>  Das Wunder ist, dass beim Dr√ºcken der Tasten die Nummer ‚Äû1‚Äú, das ‚Äû+‚Äú - Zeichen und das n√§chste Ger√§t √ºber das Kabel zur Steuerung gelangen.  Wenn Sie die EINGABETASTE dr√ºcken, wird der Ausdruck im Mikrocontroller und nicht im Computer ausgef√ºhrt.  Der Mikrocontroller erhielt das Ergebnis ‚Äû2‚Äú und gab es per Kabel an den Computer zur√ºck.  Auf dem Monitor wurde ‚Äû2‚Äú angezeigt. <br><br><blockquote>  JavaScript wird in der Hardware ausgef√ºhrt. </blockquote><br>  Neben der Unterhaltung mit Arithmetik k√∂nnen Sie die Motoren drehen.  Sie ben√∂tigen die analogWrite-Funktion, die eine Rechteckwelle sendet.  Wir sprechen dar√ºber, welchen Stift wir geben sollen.  Auf meinem Board ist es beispielsweise als A7 signiert.  Dann geben wir die Dauer an - zum Beispiel 1300 Œºs von 20 000 Œºs werden wir eine bedienen.  Ebenfalls erforderlich ist eine Option, mit der die H√§ufigkeit dieses Tritts festgelegt wird - 50 Mal pro Sekunde, dies sind 20.000 Œºs. <br><br><pre> <code class="javascript hljs">&gt;analogWrite(A7, <span class="hljs-number"><span class="hljs-number">1300</span></span> / <span class="hljs-number"><span class="hljs-number">2000</span></span>, {<span class="hljs-attr"><span class="hljs-attr">freq</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>}} =<span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt;</code> </pre> <br>  Wir werden f√ºr 1500 passen - wir werden zwingen, uns mit gr√∂√üerer Geschwindigkeit in die andere Richtung zu drehen. <br><br><pre> <code class="javascript hljs">&gt;analogWrite(A7, <span class="hljs-number"><span class="hljs-number">2300</span></span> / <span class="hljs-number"><span class="hljs-number">2000</span></span>, {<span class="hljs-attr"><span class="hljs-attr">freq</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>}} =<span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt;</code> </pre> <br>  Oder sag halt. <br><br><pre> <code class="javascript hljs">&gt;digitalWrite(A7, <span class="hljs-number"><span class="hljs-number">0</span></span>) =<span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt;</code> </pre> <br>  Mit den gleichen Funktionen k√∂nnen Sie ein ganzes Programm schreiben, das abh√§ngig von externen Faktoren - Dr√ºcken von Tasten, Sensorablesungen - das tut, was Sie wollen. <br><br><h3>  Bibliotheken </h3><br>  Es ist nicht immer bequem, die Details der Protokollimplementierung abzurufen.  Daher wurden f√ºr alle Arten von Eisen viele Bibliotheken erstellt, von klein bis riesig.  Sie enthalten alle technischen Merkmale.  Die Bibliotheken verwenden verst√§ndliche Methoden: Lesen Sie Daten von einem NFC-Tag, lesen Sie die Kohlendioxidkonzentration in ppm oder senden Sie eine Nachricht an Telegram. <br><ul><li>  servo.write; </li><li>  barometer.init; </li><li>  barometer.read; </li><li>  Barometer.Temperatur; </li><li>  nfc.listen; </li><li>  nfc.on ('tag', ...); </li><li>  nfc.readPage; </li><li>  nfc.writePage; </li><li>  relay.turnOn; </li><li>  relay.turnOff; </li><li>  gas.calibrate; </li><li>  gas.read ('CO2'); </li><li>  telegram.sendMessage. </li></ul><br>  Es ist n√ºtzlich, Befehle auf niedriger Ebene zu verstehen, aber um mit dem Erstellen zu beginnen, ist es nicht erforderlich, dies zu wissen. <br><br><h2>  Kundencode </h2><br>  Wenn wir also auf eine der Schaltfl√§chen in der linken oder rechten Spalte unseres Frosches klicken, wird der Wert, den wir f√ºr das entsprechende Servo festlegen m√∂chten, an das Thema Kr√∂te / Auge / links oder rechts gesendet. <br><br><img src="https://habrastorage.org/webt/y1/3e/mt/y13emt_fcb-qdw2j_tihccn8ukm.jpeg"><br><br><pre> <code class="javascript hljs">&lt;button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"toad__eye__control"</span></span> data-queue=<span class="hljs-string"><span class="hljs-string">"left"</span></span> data-payload=<span class="hljs-string"><span class="hljs-string">"1300"</span></span>&gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;</span></span></code> </pre> <br>  1300 ist die Pulsdauer.  Woher kommen die Linken und 1300?  Ich habe sie gerade als Datenattribute zum HTML hinzugef√ºgt. <br><br>  In JS schreiben wir einfachen Code. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mqtt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mqtt'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> client = mqtt.connect(<span class="hljs-string"><span class="hljs-string">`ws://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.hostname}</span></span></span><span class="hljs-string">:9001`</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEyeControlClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { queue, payload } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataset; client.publish(<span class="hljs-string"><span class="hljs-string">`toad/eye/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${queue}</span></span></span><span class="hljs-string">`</span></span>, payload); } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">".toad__eye__control"</span></span>) .forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> e.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, onEyeControlClick));</code> </pre> <br>  Lassen Sie uns den Code in Teilen analysieren.  Zu Beginn stellen wir eine Verbindung zum Broker her, der standardm√§√üig auf Port 9001 funktioniert: <code>const client = mqtt.connect(`ws://${location.hostname}:9001`);</code>  . <br><br>  Wenn wir auf eine der Schaltfl√§chen klicken, ver√∂ffentlichen wir eine neue Nachricht mit Nutzdaten, die wir vom <code>client.publish(`toad/eye/${queue}`, payload);</code> : <code>client.publish(`toad/eye/${queue}`, payload);</code>  . <br><br>  Als n√§chstes ver√∂ffentlichen wir das Thema, das ebenfalls auf Basis von Datenattributen gebildet wird.  Dies ist unser gesamter JS-Code im Browser. <br><br><h2>  Board Code </h2><br>  Wenn der Wi-Fi-Steckplatz gestartet wird, abonniert er die f√ºr ihn interessanten Themen und empf√§ngt die Daten.  Wenn sie ankommen, reagiert der Steckplatz und l√§sst die Motoren arbeiten. <br><br><img src="https://habrastorage.org/webt/5r/7h/it/5r7hit4db5ds9369m2fgmsua8t4.jpeg"><br><br>  Der Code auf der Tafel ist herk√∂mmlicherweise in mehrere Teile unterteilt.  Zu Beginn verbinden wir Bibliotheken.  Dies ist insbesondere nur die <strong>Bibliothek, in der Servo ausgef√ºhrt wird</strong> , um keine Details abzurufen.  Sie sind im Amperka-Bereich. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ssid = <span class="hljs-string"><span class="hljs-string">"Droidxx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = <span class="hljs-string"><span class="hljs-string">"****"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> brokerHostname = <span class="hljs-string"><span class="hljs-string">"toad.amperka.ru"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> leftEye = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"@amperka/servo"</span></span>).connect(A5); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rightEye = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"@amperka/servo"</span></span>).connect(A7).</code> </pre> <br>  Jeder kann seine eigenen Bibliotheken erstellen und ver√∂ffentlichen.  Wir haben mehrere Dutzend f√ºr unsere eigenen und andere beliebte Module hergestellt.  Alle Open Source - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kommen Sie herein, verwenden Sie es</a> . <br><br>  Dann brauchen wir <strong>Bibliotheken f√ºr die Arbeit mit Wi-Fi- und MQTT-Brokern</strong> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wifi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"Wifi"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mqtt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"tinyMQTT"</span></span>).create(brokerHostname);</code> </pre> <br>  Es gibt kein Betriebssystem, daher ist selbst das Herstellen einer Verbindung zu Wi-Fi ein manueller Vorgang.  Die Verbindungspflege liegt bei Ihnen, ist aber nicht so schwierig.  Um eine Verbindung zum Netzwerk herzustellen, rufen wir einfach die Methode "connect" auf, die bei Erfolg oder Misserfolg "callback" aufruft und die Ergebnisse der Operation meldet. <br><br><pre> <code class="javascript hljs">wifi.connect(ssid, { <span class="hljs-attr"><span class="hljs-attr">password</span></span>: password }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Error connecting:"</span></span>, e); wifi.disconnect(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Wi-Fi OK, connecting to broker ..."</span></span>); mqtt.connect(); } });</code> </pre> <br>  Wenn alles in Ordnung ist, stellen Sie eine Verbindung zum MQTT-Broker her. <br><br>  Nach erfolgreicher Verbindung abonnieren wir interessante Themen, dh alles, was mit Kr√∂te / Auge beginnt. <br><br><pre> <code class="javascript hljs">mqtt.on(<span class="hljs-string"><span class="hljs-string">"connected"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ mqtt.subscribe(<span class="hljs-string"><span class="hljs-string">"toad/eye/*"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Connected to broker"</span></span>, brokerHostname); });</code> </pre> <br>  Wenn wir eine Nachricht erhalten, finden wir heraus, woher sie stammt.  Dies ist einer einfachen URL-Analyse sehr √§hnlich.  Je nach Thema entscheiden wir, welches Auge wir beeinflussen.  Wenn Sie etwas bewusst werden, schreiben wir in diesem Auge, was in "Nutzlast" in Mikrosekunden kam. <br><br><pre> <code class="javascript hljs">mqtt.on(<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> eye = (msg.topic === <span class="hljs-string"><span class="hljs-string">"toad/eye/left"</span></span>) ? leftEye : (msg.topic === <span class="hljs-string"><span class="hljs-string">"toad/eye/right"</span></span>) ? rightEye : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eye) { eye.write(<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(msg.message), <span class="hljs-string"><span class="hljs-string">"us"</span></span>); } });</code> </pre> <br>  Das ist die ganze Magie eines Frosches. <br><br><h2>  Espruino JS Einschr√§nkungen </h2><br>  Wir gingen √ºber die Espruino-Plattform.  Das Drehen der Fr√∂sche ist nicht ihre einzige Option.  Die Plattform hat jedoch ihre eigenen Schw√§rme, sodass wir andere Optionen in Betracht ziehen. <br><br>  <strong>"Gesamt" 1‚Äì4 MB RAM</strong> .  Der Arbeitsspeicher ist begrenzt.  Auf dem Code und den Daten werden gleichzeitig nur wenige Megabyte angegeben.  Es mag scheinen, dass in einer Zeit, in der RAM durch Gigs gemessen wird, dies nicht ausreicht.  F√ºr eine Gruppe kleiner Ger√§te reicht dies jedoch aus.  Bei 2 Mb k√∂nnen Sie wundersch√∂ne Dinge tun - genug f√ºr den Brunnen. <br><br>  <strong>Nicht so einfach mit NPM</strong> .  Dieses Problem betrifft die Espruino-IDE.  Wenn wir "erfordern" schreiben, schaut Espruino an einer Stelle, an einer anderen, und wenn nicht, erzeugt es einen Fallback auf NPM.  Zu diesem Zeitpunkt kann es langsamer werden.  Espruino ist nicht immer in der Lage, komplexe Pakete zu verarbeiten.  Seine Leistung in diesem Sinne ist viel geringer als die des gleichen Webpacks oder Pakets.  Dies ist ein Problem, aber wenn Sie die Toolchain selbst konfigurieren und verstehen, was im Inneren des B√ºgeleisens geschieht, gibt es kein Problem. <br><br>  <strong>Sortiment von Eisen.</strong>  Nicht jede Hardware, die als Entwicklungsplattform bezeichnet wird, wird Espruino ziehen.  Nach den Standards der Mikrocontroller-Welt ist Espruino uners√§ttlich - es ben√∂tigt 500 KB RAM.  Eine solche Erinnerung wird kein St√ºck Eisen geben.  Das kanonische Arduino Uno oder Arduino Nano hat nur 2 KB RAM - daher ist es dort unm√∂glich.  Es ist m√∂glich, mit Espruino an Hardware zu arbeiten, was wir mit der offiziellen Hardware von Espruino tun. <br><br><img src="https://habrastorage.org/webt/gb/fx/9-/gbfx9-t4nskmti1hepnxlkz-lx0.png"><br><br>  Espruino ist ein Ein-Personen-Unternehmen, das h√§ufig mit neuen Produkten auf Kickstarter geht und immer erfolgreich sammelt.  Wenn Sie die Plattform unterst√ºtzen m√∂chten - kaufen Sie offiziell. <br><br>  Es gibt eine dritte Option: Nehmen Sie ein ausreichend leistungsf√§higes Devboard von Drittanbietern.  Zum Beispiel die Firma ST, die "Nuclear" und "Discovery" produziert.  Eisen mit der Bezeichnung STM32 zieht wahrscheinlich den Espruino. <br><br>  Lassen Sie uns zwei alternative Optionen durchgehen.  Der erste ist der Raspberry Pi. <br><br><h2>  Himbeer pi </h2><br><blockquote>  Dies ist ein vollwertiger Linux-Computer in Visitenkartengr√∂√üe. </blockquote><br><br><img src="https://habrastorage.org/webt/y_/af/ws/y_afwsgmlr9e7fvkesyrwlvobak.jpeg"><br><br>  Zus√§tzlich gibt es Eingangs- / Ausgangspins.  Wenn Sie Raspberry Pi zur Verf√ºgung haben, verwenden Sie die folgende Ger√§tetopologie. <br><br><img src="https://habrastorage.org/webt/if/1a/jf/if1ajfsmxsvwwcap7ac_cpu8i2k.jpeg"><br><br>  Hier ist die Cloud optional - ein mobiles Ger√§t kann √ºber Hostname, API oder ein System zur automatischen Erkennung eines Ger√§ts im Netzwerk eine direkte Verbindung zum Ger√§t herstellen.  Ich habe einen Smart-TV und eine Backup-Festplatte zu Hause.  Sie sind von allen anderen Ger√§ten aus zug√§nglich, nur weil sie sich im selben LAN befinden. <br><br>  Das Prinzip ist das gleiche.  Stellen Sie das Ger√§t auf den Raspberry Pi im Netzwerk und erstellen Sie den Client so, dass er √ºber HTTP oder WebSocket eine direkte Verbindung zu ihm herstellt, wobei Vermittler umgangen werden.  Die Cloud verwendet die Anwendung auf Raspberry Pi f√ºr ihre Zwecke: Sie protokolliert Sensoren oder sendet Wettervorhersagen. <br><br>  Die n√§chstm√∂gliche Topologie mit vollem Backend. <br><br><img src="https://habrastorage.org/webt/if/1a/jf/if1ajfsmxsvwwcap7ac_cpu8i2k.jpeg"><br><br>  Der Server steigt in der Cloud auf.  Sein Client ist dieselbe mobile Anwendung, die eine Verbindung √ºber HTTP oder WebSocket aufrechterh√§lt.  Andererseits wird die Verbindung bereits √ºber den Raspberry Pi √ºber HTTP oder denselben MQTT gehalten. <br><br>  Bei diesem Ansatz liegt der Vorteil in der vollst√§ndigen Kontrolle: Validierung, Autorisierung, Verweigerung gegen√ºber Kunden.  Gleichzeitig ist die weltweite Verf√ºgbarkeit ein Ger√§t in Moskau, und die Kommunikation mit ihm ist √ºber Wladiwostok m√∂glich. <br><br><h3>  Himbeer-Pi-Einschr√§nkungen </h3><br>  <strong>Langes Laden.</strong>  Raspberry Pi ist ein vollst√§ndiger Computer und der Start dauert einige Zeit.  Als Festplatte wird eine SD-Karte verwendet.  Selbst die schnellste Karte verliert immer noch eine normale Festplatte, ganz zu schweigen von der SSD.  Mit der Zeit n√§hert sich die Last einer Minute. <br><br>  <strong>Der n√§chste Nachteil ist der Energieverbrauch</strong> .  Sprechen Sie in Bezug auf die Energieeffizienz √ºber den Raspberry Pi als mobiles Ger√§t.  Es wird nicht lange von der Batterie dauern - die Rechnung geht an die Uhr.  Damit das Ger√§t sechs Monate oder ein Jahr lang funktioniert, sind ein kompetentes Programm f√ºr den Mikrocontroller und ein Satz Batterien erforderlich. <br><br>  <strong>Der schlechte GPIO ist ein universeller Ein- / Ausgang</strong> .  Die Funktionen von Welleneinspeisung, Wellenlesen und Arbeiten mit analogen Signalen bei Raspberry Pi sind viel schw√§cher als bei Mikrocontrollern, f√ºr die dies die Hauptaufgabe ist.  Bei einem Raspberry Pi ist es beispielsweise nicht m√∂glich, das Servo im Hardwaremodus zu steuern. <br><br><img src="https://habrastorage.org/webt/0r/sz/oj/0rszojmbxar2o-zhp26divehxj4.jpeg"><br><br>  Die Einschr√§nkung ist bedingt, da sie durch die Erweiterung umgangen werden kann.  Zum Beispiel das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Troyka Cap-St√ºck</a> Eisen, das die gesamte Kontrolle √ºber das Arbeiten mit Signalen auf sich selbst √ºbernimmt.  Raspberry Pi kommuniziert mit ihr √ºber ein hochrangiges Paket.  Gibt Befehle zum Drehen des Servos und es funktioniert.  Mit diesen Erweiterungskarten k√∂nnen Sie alles anschlie√üen, was Sie wollen. <br><br><h2>  Arduino </h2><br>  Sie k√∂nnen das √ºbliche <strong>Arduino nehmen</strong> , das jeder satt hat.  Aber JavaScript muss irgendwohin verschoben werden, wo Node JS gedreht werden kann - ein alter Computer oder der gleiche Raspberry Pi. <br><br><img src="https://habrastorage.org/webt/fc/z2/gx/fcz2gxhtqtz7gsoqbopfki6tlqm.jpeg"><br><br>  Wir verbinden einen alten unn√∂tigen Computer √ºber ein USB-Kabel mit Arduino.  F√ºllen Sie in Arduino die Standard- <a href="">Firmata-</a> Firmware <a href="">einmal aus</a> .  Sie verwandelt Arduino in einen Zombie, der den Anweisungen eines Meisters folgt - eines alten Computers.  Der Meister sagt, er soll dieses und jenes Signal an diesen und jenen Stift senden, und Arduino sendet. <br><br>  F√ºr die Kommunikation werden Bibliotheken mit NPM - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SerialPort</a> und Firmata mit einer eindeutigen API verwendet.  Sie befinden sich also wieder in der JS-Welt und schreiben ein √ºbergeordnetes Programm, das Sie an Ihren Server senden.  Sie vertrauen darauf, dass Arduino mit Signalen arbeitet, und sie f√ºhrt es aus. <br><br>  Nicht immer mit Firmata wird es gelingen, alles zu verwalten.  Es kann eine Interaktion mit der Hardware erm√∂glichen, f√ºr die es bestimmt ist: Servos, LED-Streifen, Mediencontroller.  Wenn jedoch die F√§higkeit, ein ganz bestimmtes Gyroskop oder einen bestimmten Beschleunigungsmesser abzulesen, nicht ber√ºcksichtigt wird, funktioniert dies nicht.  Dann m√ºssen Sie ein Programm in C auf einem normalen Arduino schreiben. <br><br>  Aber das ist noch nicht alles - wenn Sie nicht in C schreiben m√∂chten, verwenden Sie das Open Source-Tool <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">XOD.io.</a> <br><br><img src="https://habrastorage.org/webt/-p/-9/j0/-p-9j0ex1ngdm7pfdq-lv5dej9u.jpeg"><br><br>  Dies ist eine visuelle Programmierumgebung, in der das von Ihnen erstellte Diagramm in Code umgewandelt wird und Sie es bereits kompilieren und f√ºllen k√∂nnen.  Mit XOD.io k√∂nnen Personen, die mit den Feinheiten und Nuancen der Mikrocontroller-Programmierung nicht vertraut sind, schnell einfache Programme erstellen.  Wenn Sie mit Firmata aufgewachsen sind, aber immer noch nicht die Kraft haben, auf niedrigem Niveau zu schreiben, verwenden Sie XOD.io. <br><br><blockquote>  Die n√§chste <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FrontendConf-</a> Konferenz findet im Oktober statt.  Wenn Sie √ºber JavaScript Bescheid wissen, das die meisten Front-End-Entwickler nicht kennen, entwickeln Sie Schnittstellen, die bequem zu verwenden sind, oder finden Sie den Gral der Leistung und sind bereit zu erkennen, wo es sich befindet. Wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">warten auf Anwendungen</a> f√ºr Berichte. <br><br>  Wir sammeln interessante Berichte im Programm, Konferenznachrichten, Videos und Artikel im regul√§ren Newsletter - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">melden Sie sich an</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450826/">https://habr.com/ru/post/de450826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450816/index.html">HTTP-Header f√ºr den verantwortlichen Entwickler</a></li>
<li><a href="../de450818/index.html">Von der hohen Ceph-Latenz zum Kernel-Patch mit eBPF / BCC</a></li>
<li><a href="../de450820/index.html">FrontendConf-Programmkomitee: Rahmenbedingungen, Horizonte, Welterfahrung und Mission der Konferenz</a></li>
<li><a href="../de450822/index.html">Verschwindende Rahmenbedingungen</a></li>
<li><a href="../de450824/index.html">Der Zustand von CSS</a></li>
<li><a href="../de450828/index.html">Wenn die Stadt einschl√§ft ...</a></li>
<li><a href="../de450830/index.html">Nikita Dubko √ºber Konferenzen, Betrugssyndrom und Berichterstattung</a></li>
<li><a href="../de450832/index.html">Die Geschichte einer Animation</a></li>
<li><a href="../de450834/index.html">Analyseseiten - und ist das in Russland generell legal?</a></li>
<li><a href="../de450836/index.html">Auf Schienen hinter Wolken: Wie man Glas in einem Wolkenkratzer w√§scht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>