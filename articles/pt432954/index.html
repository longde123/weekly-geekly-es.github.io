<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëèüèº üíÇüèº üñêüèΩ E novamente no espa√ßo: como o unic√≥rnio Stellarium visitou üß£ ü§£ ‚åöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Durante todo o per√≠odo de sua exist√™ncia, as pessoas fizeram um esfor√ßo tremendo para estudar quase toda a √°rea do c√©u estrelado. At√© o momento, exami...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>E novamente no espa√ßo: como o unic√≥rnio Stellarium visitou</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/432954/">  Durante todo o per√≠odo de sua exist√™ncia, as pessoas fizeram um esfor√ßo tremendo para estudar quase toda a √°rea do c√©u estrelado.  At√© o momento, examinamos centenas de milhares de aster√≥ides, cometas, nebulosas e estrelas, gal√°xias e planetas.  Para ver toda essa beleza, n√£o √© necess√°rio sair de casa e comprar um telesc√≥pio.  Voc√™ pode instalar o Stellarium - um planet√°rio virtual no seu computador e olhar para o c√©u noturno, confortavelmente deitado no sof√° ... Mas √© confort√°vel?  Para descobrir a resposta a esta pergunta, verificaremos o Stellarium quanto a erros no c√≥digo do computador. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b8/c8b/129/4b8c8b12983537442bfea4700cadca97.png"></div><br><a name="habracut"></a><br><h2>  Um pouco sobre o projeto ... </h2><br>  De acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o</a> no site da Wikipedia, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Stellarium</a> √© um planet√°rio virtual de c√≥digo aberto dispon√≠vel para Linux, Mac OS X, Microsoft Windows, Symbian, Android e iOS, al√©m do MeeGo.  O programa usa as tecnologias OpenGL e Qt para criar um c√©u realista em tempo real.  Com o Stellarium, voc√™ pode ver o que pode ver com um telesc√≥pio m√©dio e at√© grande.  O programa tamb√©m fornece observa√ß√µes de eclipses solares e o movimento de cometas. <br><br>  O Stellarium foi criado pelo programador franc√™s Fabian Chereau, que lan√ßou o projeto no ver√£o de 2001.  Outros desenvolvedores de destaque incluem Robert Spearman, Johannes Gadzhozik, Matthew Gates, Timothy Reeves, Bogdan Marinov e Johan Meeris, respons√°vel pela obra de arte. <br><br><h2>  ... e sobre o analisador </h2><br>  A an√°lise do projeto foi realizada no analisador de c√≥digo est√°tico PVS-Studio.  Esta √© uma ferramenta para detectar erros e poss√≠veis vulnerabilidades no c√≥digo fonte dos programas escritos em C, C ++ e C # (em breve em Java!).  √â executado no Windows, Linux e macOS.  Ele foi desenvolvido para aqueles que precisam melhorar a qualidade de seu c√≥digo. <br><br>  A an√°lise foi bastante simples.  Primeiro, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">baixei</a> o projeto Stellarium do GitHub e instalei todos os pacotes necess√°rios para a montagem.  Como o projeto foi criado usando o Qt Creator, usei o sistema de rastreamento de inicializa√ß√£o do compilador, incorporado √† vers√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aut√¥noma</a> do analisador.  L√°, voc√™ pode visualizar o relat√≥rio de an√°lise conclu√≠do. <br><br>  Novos leitores e usu√°rios do <b><i>Stellarium</i></b> podem ter se perguntado: por que o unic√≥rnio aparece no t√≠tulo do artigo e como ele est√° relacionado √† an√°lise de c√≥digo?  Eu respondo: sou um dos desenvolvedores do PVS-Studio, e o unic√≥rnio √© nosso mascote travesso favorito.  Ent√£o suba! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfc/8f2/aab/bfc8f2aaba0bf61f3b40d4d0765dd027.png"></div><br>  Espero que, gra√ßas a este artigo, os leitores aprendam algo novo por si mesmos, e os desenvolvedores do Stellarium possam eliminar alguns erros e melhorar a qualidade do c√≥digo. <br><br>  Traga seu caf√© com um croissant de ar e sinta-se confort√°vel, porque estamos indo para a parte mais interessante - uma vis√£o geral dos resultados da an√°lise e an√°lise de erros! <br><br><h2>  Condi√ß√µes suspeitas </h2><br>  Para maior prazer de leitura, sugiro que n√£o olhe diretamente para o aviso do analisador, mas tente aqui e mais adiante encontrar voc√™ mesmo os erros. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QZipReaderPrivate::scanFiles() { .... <span class="hljs-comment"><span class="hljs-comment">// find EndOfDirectory header int i = 0; int start_of_directory = -1; EndOfDirectory eod; while (start_of_directory == -1) { const int pos = device-&gt;size() - int(sizeof(EndOfDirectory)) - i; if (pos &lt; 0 || i &gt; 65535) { qWarning() &lt;&lt; "QZip: EndOfDirectory not found"; return; } device-&gt;seek(pos); device-&gt;read((char *)&amp;eod, sizeof(EndOfDirectory)); if (readUInt(eod.signature) == 0x06054b50) break; ++i; } .... }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aviso do</a> <b>PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V654</a> A condi√ß√£o 'start_of_directory == - 1' do loop √© sempre verdadeira.  qzip.cpp 617 <br><br>  Voc√™ conseguiu encontrar um erro?  Se sim, ent√£o elogie. <br><br>  O erro est√° na condi√ß√£o do <i>loop while</i> .  √â sempre verdade, pois a vari√°vel <i>start_of_directory</i> n√£o muda no corpo do loop.  Muito provavelmente, o ciclo n√£o ser√° eterno, pois cont√©m <i>retorno</i> e <i>quebra</i> , mas esse c√≥digo parece estranho. <br><br>  Parece-me que no c√≥digo eles esqueceram de fazer a atribui√ß√£o <i>start_of_directory = pos</i> no local em que a assinatura est√° sendo verificada.  Ent√£o a declara√ß√£o de <i>quebra</i> √© talvez sup√©rflua.  Nesse caso, o c√≥digo pode ser reescrito assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> start_of_directory = <span class="hljs-number"><span class="hljs-number">-1</span></span>; EndOfDirectory eod; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (start_of_directory == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = device-&gt;size() - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)) - i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt; <span class="hljs-number"><span class="hljs-number">65535</span></span>) { qWarning() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"QZip: EndOfDirectory not found"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } device-&gt;seek(pos); device-&gt;read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)&amp;eod, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readUInt(eod.signature) == <span class="hljs-number"><span class="hljs-number">0x06054b50</span></span>) start_of_directory = pos; ++i; }</code> </pre> <br>  No entanto, n√£o tenho certeza de como deve ser o c√≥digo.  √â melhor que os pr√≥prios desenvolvedores do projeto analisem essa parte do programa e fa√ßam as altera√ß√µes necess√°rias. <br><br>  Outra condi√ß√£o estranha: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StelProjectorCylinder</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StelProjector { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersectViewportDiscontinuityInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3d&amp; capN, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> capD)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capN, capD)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cap.intersects(cap1) &amp;&amp; cap.intersects(cap2) &amp;&amp; cap.intersects(cap2); } };</code> </pre> <br>  <b>PVS-Studio Warning:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V501</a> Existem sub-express√µes id√™nticas 'cap.intersects (cap2)' √† esquerda e √† direita do operador '&amp;&amp;'.  StelProjectorClasses.hpp 175 <br><br>  Como voc√™ provavelmente j√° adivinhou, o erro est√° na √∫ltima linha da fun√ß√£o: o programador cometeu um erro de digita√ß√£o e, no final, descobriu que a fun√ß√£o retorna o resultado independentemente do valor de <i>cap3</i> . <br><br>  Esse tipo de erro √© extremamente comum: em quase todos os projetos testados, encontramos erros de digita√ß√£o relacionados a nomes do formul√°rio <i>nome1</i> e <i>nome2</i> e similares.  Normalmente, esses erros est√£o relacionados √† copiar e colar. <br><br>  Essa inst√¢ncia de c√≥digo √© um excelente exemplo de outro padr√£o de erro comum, para o qual realizamos um mini-estudo separado.  Meu colega Andrei Karpov chamou o " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">efeito de √∫ltima linha</a> ".  Se voc√™ n√£o estiver familiarizado com este material, sugiro abrir uma guia no navegador para ler mais tarde, mas por enquanto, vamos continuar. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> BottomStelBar::updateText(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> updatePos) { .... updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location-&gt;text() != newLocation || updatePos) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fov-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fps-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (updatePos) { .... } }</code> </pre> <br>  <b>Avisos do PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V560</a> Uma parte da express√£o condicional √© sempre verdadeira: updatePos.  StelGuiItems.cpp 732 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A</a> express√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V547</a> 'updatePos' sempre √© verdadeira.  StelGuiItems.cpp 831 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V763 O</a> par√¢metro 'updatePos' √© sempre reescrito no corpo da fun√ß√£o antes de ser usado.  StelGuiItems.cpp 690 </li></ul><br>  O valor do par√¢metro <i>updatePos √©</i> sempre substitu√≠do antes de ser usado, ou seja,  a fun√ß√£o funcionar√° da mesma forma, independentemente do valor passado para ela. <br><br>  Parece estranho, n√£o √©?  Em todos os lugares em que o par√¢metro <i>updatePos</i> est√° <i>envolvido</i> , √© <i>verdade</i> .  Isso significa que as condi√ß√µes <i>if (location-&gt; text ()! = NewLocation || updatePos)</i> e <i>if (updatePos)</i> sempre ser√£o verdadeiras. <br><br>  Outro trecho: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> LandscapeMgr::onTargetLocationChanged(StelLocation loc) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pl &amp;&amp; flagEnvironmentAutoEnabling) { QSettings* conf = StelApp::getInstance().getSettings(); setFlagAtmosphere(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_atmosphere"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagFog(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_fog"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagLandscape(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } .... }</code> </pre> <br>  <b>Avisos do PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V792</a> A fun√ß√£o 'toBool' localizada √† direita do operador '&amp;' ser√° chamada independentemente do valor do operando esquerdo.  Talvez seja melhor usar '&amp;&amp;'.  LandscapeMgr.cpp 782 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V792</a> A fun√ß√£o 'toBool' localizada √† direita do operador '&amp;' ser√° chamada independentemente do valor do operando esquerdo.  Talvez seja melhor usar '&amp;&amp;'.  LandscapeMgr.cpp 783 </li></ul><br>  O analisador detectou uma express√£o suspeita nos argumentos para as <i>fun√ß√µes setFlagAtmosphere</i> e <i>setFlagFog</i> .  De fato: nos dois lados do operador de bit <i>e existem</i> valores do tipo <i>bool</i> .  Em vez do operador <i>&amp;</i> , voc√™ deve usar o operador <i>&amp;&amp;</i> , e agora vou explicar o porqu√™. <br><br>  Sim, o resultado dessa express√£o sempre estar√° correto.  Antes de usar o ‚Äúe‚Äù bit a bit, os dois operandos ser√£o promovidos para <i>int</i> .  No C ++, essa convers√£o √© <a href="">inequ√≠voca</a> : false √© convertido em 0 e true √© convertido em 1. Portanto, o resultado dessa express√£o ser√° o mesmo que se o operador <i>&amp;&amp;</i> fosse usado. <br><br>  Mas h√° uma nuance.  Ao calcular o resultado da opera√ß√£o <i>&amp;&amp;</i> , √© utilizado o chamado "c√°lculo lento".  Se o valor do operando esquerdo for <i>falso</i> , o valor correto nem ser√° calculado, porque o "e" l√≥gico, em qualquer caso, retornar√° <i>falso</i> .  Isso √© feito para economizar recursos de computa√ß√£o e permite que voc√™ escreva projetos mais complexos.  Por exemplo, voc√™ pode verificar se o ponteiro n√£o √© nulo e, se houver, desreferenci√°-lo para executar uma verifica√ß√£o adicional.  Exemplo: <i>if (ptr &amp;&amp; ptr-&gt; foo ())</i> . <br><br>  Esse ‚Äúc√°lculo pregui√ßoso‚Äù n√£o √© realizado usando o operador bit a bit <i>&amp;</i> : expression <i>conf-&gt; value ("...", true) .toBool ()</i> ser√° avaliado sempre, independentemente do valor <i>pl-&gt; hasAtmosphere ()</i> . <br><br>  Em casos raros, isso √© feito de prop√≥sito.  Por exemplo, se a computa√ß√£o do operando certo tiver "efeitos colaterais", o resultado ser√° usado posteriormente.  Tamb√©m n√£o √© muito bom faz√™-lo, porque complica a compreens√£o do c√≥digo e a manuten√ß√£o dele.  Al√©m disso, a ordem de c√°lculo dos operandos <i>e</i> n√£o <i>est√°</i> definida, portanto, em alguns casos, usando esses "truques", voc√™ pode obter um comportamento indefinido. <br><br>  Se voc√™ precisar salvar efeitos colaterais - fa√ßa-o em uma linha separada e salve o resultado em uma vari√°vel separada.  As pessoas que trabalhar√£o com esse c√≥digo no futuro ser√£o gratas a voc√™ :) <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/301/5a6/971/3015a69710bc07f948b5233dac04fc87.png"></div><br>  Prosseguimos para o pr√≥ximo t√≥pico. <br><br><h2>  Manuseio incorreto de mem√≥ria </h2><br>  Vamos come√ßar o t√≥pico da mem√≥ria din√¢mica com este fragmento: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/************ Basic Edge Operations ****************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/* __gl_meshMakeEdge creates one edge, * two vertices, and a loop (face). * The loop consists of the two new half-edges. */</span></span> GLUEShalfEdge* __gl_meshMakeEdge(GLUESmesh* mesh) { GLUESvertex* newVertex1 = allocVertex(); GLUESvertex* newVertex2 = allocVertex(); GLUESface* newFace = allocFace(); GLUEShalfEdge* e; <span class="hljs-comment"><span class="hljs-comment">/* if any one is null then all get freed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( newVertex1 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newVertex2 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newFace == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex1 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex1); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex2 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex2); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newFace != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newFace); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } e = MakeEdge(&amp;mesh-&gt;eHead); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } MakeVertex(newVertex1, e, &amp;mesh-&gt;vHead); MakeVertex(newVertex2, e-&gt;Sym, &amp;mesh-&gt;vHead); MakeFace(newFace, e, &amp;mesh-&gt;fHead); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e; }</code> </pre> <br>  <b>Avisos do PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V773</a> A fun√ß√£o foi encerrada sem liberar o ponteiro 'newVertex1'.  √â poss√≠vel um vazamento de mem√≥ria.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V773</a> A fun√ß√£o foi encerrada sem liberar o ponteiro 'newVertex2'.  √â poss√≠vel um vazamento de mem√≥ria.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V773</a> A fun√ß√£o foi encerrada sem liberar o ponteiro 'newFace'.  √â poss√≠vel um vazamento de mem√≥ria.  mesh.c 312 </li></ul><br>  A fun√ß√£o aloca mem√≥ria para v√°rias estruturas e a passa para os ponteiros <i>newVertex1</i> , <i>newVertex2</i> (nomes interessantes, certo?) E <i>newFace</i> .  Se um deles for zero, toda a mem√≥ria reservada dentro da fun√ß√£o ser√° liberada, ap√≥s o que o fluxo de controle sair√° da fun√ß√£o. <br><br>  O que acontece se a mem√≥ria das tr√™s estruturas for alocada corretamente e a fun√ß√£o <i>MakeEdge (&amp; mesh-&gt; eHead)</i> retornar <i>NULL</i> ?  O fluxo de controle alcan√ßar√° o segundo <i>retorno</i> . <br><br>  Como os ponteiros <i>newVertex1</i> , <i>newVertex2</i> e <i>newFace</i> s√£o vari√°veis ‚Äã‚Äãlocais, eles deixar√£o de existir ap√≥s a sa√≠da da fun√ß√£o.  Mas a libera√ß√£o da mem√≥ria que lhes pertencia n√£o acontecer√°.  Ele permanecer√° reservado, mas n√£o teremos mais acesso a ele. <br><br>  Tais situa√ß√µes s√£o chamadas de vazamento de mem√≥ria.  Um cen√°rio t√≠pico com esse erro: com o uso prolongado do programa, ele come√ßa a consumir mais e mais RAM, at√© o esgotamento. <br><br>  Deve-se notar que, neste exemplo, o terceiro <i>retorno</i> n√£o <i>√©</i> errado.  As <i>fun√ß√µes MakeVertex</i> e <i>MakeFace</i> transferem os endere√ßos da mem√≥ria alocada para outras estruturas de dados, delegando assim a responsabilidade por sua libera√ß√£o. <br><br>  A pr√≥xima falha est√° no m√©todo, que leva 90 linhas.  Por conveni√™ncia, reduzi, deixando apenas √°reas problem√°ticas. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AstroCalcDialog::drawAngularDistanceGraph() { .... QVector&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; xs, ys; .... }</code> </pre> <br>  Apenas uma linha restante.  Deixe-me dar uma dica: esta √© a √∫nica men√ß√£o aos objetos <i>xs</i> e <i>ys</i> . <br><br>  <b>Avisos do PVS-Studio:</b> <br><br><ul><li>  O objeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V808</a> 'xs' do tipo 'QVector' foi criado, mas n√£o foi utilizado.  AstroCalcDialog.cpp 5329 </li><li>  O objeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V808</a> 'ys' do tipo 'QVector' foi criado, mas n√£o foi utilizado.  AstroCalcDialog.cpp 5329 </li></ul><br>  Os vetores <i>xs</i> e <i>ys</i> s√£o criados, mas n√£o s√£o usados ‚Äã‚Äãem nenhum lugar.  Acontece que toda vez que voc√™ usa o m√©todo <i>drawAngularDistanceGraph</i> , <i>ocorre</i> uma cria√ß√£o e exclus√£o extras de um cont√™iner vazio.  Acho que esse an√∫ncio permaneceu no c√≥digo ap√≥s a refatora√ß√£o.  Obviamente, isso n√£o √© um erro, mas voc√™ deve remover o c√≥digo extra. <br><br><h2>  Moldes de tipo estranho </h2><br>  Outro exemplo depois de um pouco de formata√ß√£o √© assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SatellitesDialog::updateSatelliteData() { .... <span class="hljs-comment"><span class="hljs-comment">// set default buttonColor = QColor(0.4, 0.4, 0.4); .... }</span></span></code> </pre> <br>  Para entender qual √© o erro, voc√™ precisar√° examinar os prot√≥tipos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dos construtores da classe Qcolor</a> : <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7d/84e/798/f7d84e79849bca96f7a27016aec0e9d3.png"></div><br>  <b>Avisos do PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V674</a> O literal '0.4' do tipo 'double' est√° sendo implicitamente convertido para o tipo 'int' enquanto chama a fun√ß√£o 'QColor'.  Inspecione o primeiro argumento.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V674</a> O literal '0.4' do tipo 'double' est√° sendo implicitamente convertido para o tipo 'int' enquanto chama a fun√ß√£o 'QColor'.  Inspecione o segundo argumento.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V674</a> O literal '0.4' do tipo 'double' est√° sendo implicitamente convertido para o tipo 'int' enquanto chama a fun√ß√£o 'QColor'.  Inspecione o terceiro argumento.  SatellitesDialog.cpp 413 </li></ul><br>  A classe <i>Qcolor</i> n√£o possui construtores que aceitam o tipo <i>double</i> ; portanto, os argumentos no exemplo ser√£o implicitamente convertidos em <i>int</i> .  Isso faz com que os campos <i>r</i> , <i>g</i> , <i>b</i> do objeto <i>buttonColor</i> tenham um valor <i>0</i> . <br><br>  Se o programador pretendia criar um objeto a partir de valores do tipo <i>double</i> , ele deveria usar um construtor diferente. <br><br>  Por exemplo, voc√™ pode usar um construtor que aceite <i>Qrgb</i> escrevendo: <br><br><pre> <code class="cpp hljs">buttonColor = QColor(QColor::fromRgbF(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  Poderia ter sido feito de maneira diferente.  Qt usa valores reais no intervalo [0,0, 1,0] ou valores inteiros no intervalo [0, 255] para indicar cores RGB. <br><br>  Portanto, o programador pode traduzir os valores de real para inteiro escrevendo assim: <br><br><pre> <code class="cpp hljs">buttonColor = QColor((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  ou apenas <br><br><pre> <code class="cpp hljs">buttonColor = QColor(<span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>);</code> </pre> <br>  Voc√™ est√° entediado?  N√£o se preocupe: h√° erros mais interessantes pela frente. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/aa0/297/f18aa02975f89e9e6cc7c661706fc608.png"></div><br>  <font color="#999999"><i>"Unic√≥rnio no espa√ßo".</i></font>  <font color="#999999"><i>Vista do Stellarium.</i></font> <br><br><h2>  Outros erros </h2><br>  No final, deixei voc√™s mais deliciosos :) Vamos falar com um deles. <br><br><pre> <code class="cpp hljs">HipsTile* HipsSurvey::getTile(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> order, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pix) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (order == orderMin &amp;&amp; !allsky.isNull()) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * order)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (pix % nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = (pix / nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> s = allsky.width() / nbw; QImage image = allsky.copy(x, y, s, s); .... } .... }</code> </pre> <br>  <b>Aviso do PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V634</a> A prioridade da opera√ß√£o '*' √© maior que a da opera√ß√£o '&lt;&lt;'.  √â poss√≠vel que par√™nteses sejam usados ‚Äã‚Äãna express√£o.  StelHips.cpp 271 <br><br>  Bem, voc√™ conseguiu detectar o erro?  Considere a express√£o <i>(12 * 1 &lt;&lt; (2 * ordem)) em</i> mais detalhes.  O analisador lembra que a opera√ß√£o ' <i>*</i> ' tem uma prioridade mais alta que a opera√ß√£o de troca de bits ' <i>&lt;&lt;</i> '.  √â f√°cil ver que a multiplica√ß√£o de <i>12</i> por <i>1 n√£o faz</i> sentido e os colchetes em torno de <i>2 * da ordem</i> n√£o <i>s√£o</i> necess√°rios. <br><br><pre> <code class="cpp hljs"> ,    : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span> * order));     &lt;i&gt;<span class="hljs-number"><span class="hljs-number">12</span></span> &lt;/i&gt;     .</code> </pre> <br>  Nota  Al√©m disso, quero observar que, se o valor do operando direito ' <i>&lt;&lt;</i> ' for maior ou igual ao n√∫mero de bits do operando esquerdo, o resultado n√£o ser√° definido.  Como literais num√©ricos s√£o <i>int</i> por padr√£o, que leva <i>32</i> bits, o valor do par√¢metro <i>order</i> n√£o deve exceder <i>15</i> .  Caso contr√°rio, a avalia√ß√£o da express√£o pode resultar em comportamento indefinido. <br><br>  N√≥s continuamos.  O m√©todo abaixo √© muito confuso, mas tenho certeza de que um leitor sofisticado lidar√° com a detec√ß√£o de erros :) <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdBoth) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdNegative) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdPositive) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  <b>PVS-Studio Warning:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V779</a> C√≥digo inacess√≠vel detectado.  √â poss√≠vel que haja um erro.  qcustomplot.cpp 19512. <br><br>  O fato √© que todos os ramos <i>if ... else</i> t√™m um <i>retorno</i> .  Portanto, o fluxo de controle nunca atinge as duas √∫ltimas linhas. <br><br>  Em geral, este exemplo ser√° executado normalmente e funcionar√° corretamente.  Mas a presen√ßa de c√≥digo inacess√≠vel por si s√≥ √© um sinal.  Nesse caso, indica a estrutura incorreta do m√©todo, o que complica bastante a legibilidade e a compreensibilidade do c√≥digo. <br><br>  Esse fragmento de c√≥digo deve ser refatorado, obtendo uma fun√ß√£o mais elegante na sa√≠da.  Por exemplo, assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (inSignDomain) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdBoth: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdNegative: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdPositive: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  O √∫ltimo em nossa an√°lise ser√° o erro que eu mais gostei.  O c√≥digo do local do problema √© curto e simples: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Voc√™ notou algo suspeito?  Nem todo mundo pode :) <br><br>  <b>PVS-Studio Warning:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V603</a> O objeto foi criado, mas n√£o est√° sendo usado.  Se voc√™ deseja chamar o construtor, 'this-&gt; Plane :: Plane (....)' deve ser usado.  Plane.cpp 29 <br><br>  O programador esperava que alguns dos campos do objeto fossem inicializados dentro do construtor aninhado, mas acabou assim: quando o construtor <i>Plane (Vec3f &amp; v1, Vec3f &amp; v2, Vec3f &amp; v3)</i> √© chamado, um objeto tempor√°rio sem nome √© criado dentro dele, que √© imediatamente exclu√≠do.  Como resultado, uma parte do objeto permanece n√£o inicializada. <br><br>  Para que o c√≥digo funcione corretamente, voc√™ deve usar o recurso conveniente e seguro do C ++ 11 - o construtor de delega√ß√£o: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f&amp; v1, Vec3f&amp; v2, Vec3f&amp; v3) : Plane(v1, v2, v3, SPolygon::CCW) { distance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; sDistance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; }</code> </pre> <br>  Mas se voc√™ usar o compilador para vers√µes mais antigas da linguagem, poder√° escrever assim: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Plane::Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Ou ent√£o: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Noto que os dois √∫ltimos m√©todos s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muito perigosos</a> .  Portanto, voc√™ deve ter muito cuidado e entender bem como esses m√©todos funcionam. <br><br><h2>  Conclus√£o </h2><br>  Que conclus√µes podem ser tiradas sobre a qualidade do c√≥digo do Stellarium?  Honestamente, n√£o houve muitos erros.  Al√©m disso, em todo o projeto, n√£o encontrei um √∫nico erro no qual o c√≥digo esteja vinculado a um comportamento indefinido.  Para o projeto de c√≥digo-fonte aberto, a qualidade do c√≥digo acabou sendo de alto n√≠vel, para a qual tiro meu chap√©u para os desenvolvedores.  Voc√™s s√£o √≥timos!  Fiquei satisfeito e interessado em revisar seu projeto. <br><br>  E o pr√≥prio planet√°rio - eu o uso com bastante frequ√™ncia.  Infelizmente, morando em uma cidade, raramente consigo desfrutar de um c√©u noturno claro, e o Stellarium me permite estar em qualquer lugar do mundo sem me levantar do sof√°.  √â realmente confort√°vel! <br><br>  Eu gosto especialmente do modo "Constellation art".  A vis√£o das figuras enormes cobrindo o c√©u inteiro em uma dan√ßa estranha √© de tirar o f√¥lego. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/613/3d5/107/6133d51079ac983aa11a017acd1945ee.png"></div><br>  <font color="#999999"><i>"Uma dan√ßa estranha."</i></font>  <font color="#999999"><i>Vista do Stellarium.</i></font> <br><br>  Os terr√°queos tendem a cometer erros, e n√£o h√° nada de vergonhoso no fato de esses erros vazarem no c√≥digo.  Para isso, s√£o desenvolvidas ferramentas de an√°lise de c√≥digo, como o PVS-Studio.  Se voc√™ √© um dos terr√°queos - <strike>como ele,</strike> sugiro que fa√ßa o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">download e experimente voc√™ mesmo</a> . <br><br>  Espero que voc√™ esteja interessado em ler meu artigo e tenha aprendido algo novo e √∫til para si mesmo.  E desejo aos desenvolvedores uma corre√ß√£o precoce dos erros encontrados. <br><br>  Assine nossos canais e fique atento √†s novidades do mundo da programa√ß√£o! <br><br><ul><li>  Vk: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@pvsstudio_rus</a> </li><li>  Telegrama: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@pvsstudio_rus</a> </li><li>  Instagram: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@pvsstudio_rus</a> </li><li>  Twitter: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@pvsstudio_rus</a> </li><li>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@PVSStudioTool</a> </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br>  Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link para a tradu√ß√£o: George Gribkov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Into Space Again: como o unic√≥rnio visitou o Stellarium</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt432954/">https://habr.com/ru/post/pt432954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt432940/index.html">50 tons de token</a></li>
<li><a href="../pt432942/index.html">Padr√µes e antipadr√µes de Corutin em Kotlin</a></li>
<li><a href="../pt432944/index.html">Otimiza√ß√£o for√ßada da consulta do PostgreSQL</a></li>
<li><a href="../pt432946/index.html">Unity - Armadilhas do Desenvolvimento de Jogos 2D</a></li>
<li><a href="../pt432948/index.html">Nuvens inteligentes, empresas inteligentes: como a IA transforma a ind√∫stria de computa√ß√£o em nuvem</a></li>
<li><a href="../pt432956/index.html">Monstros do Id: como Doom foi criado</a></li>
<li><a href="../pt432958/index.html">O novo paradoxo qu√¢ntico esclarece em que casos nossas id√©ias sobre a realidade acabam erradas.</a></li>
<li><a href="../pt432960/index.html">Por que os consumidores n√£o t√™m medo de roubo de identidade</a></li>
<li><a href="../pt432964/index.html">Sobre o poder, bom ou nada: uma nova iniciativa legislativa na Federa√ß√£o Russa</a></li>
<li><a href="../pt432966/index.html">Carregador de inicializa√ß√£o criptografado para STM32</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>