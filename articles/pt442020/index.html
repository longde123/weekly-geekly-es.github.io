<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôáüèª üòù ‚úä Novo codec AV1: acelere o carregamento de v√≠deo em um navegador üëÇüèª üà∏ üë®üèΩ‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste guia, aprenderemos como usar o v√≠deo na Web, como √© habitual em 2019. O Chrome e o Firefox come√ßaram a oferecer suporte ao novo codec AV1 - para...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Novo codec AV1: acelere o carregamento de v√≠deo em um navegador</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442020/"> Neste guia, aprenderemos como usar o v√≠deo na Web, como √© habitual em 2019. O Chrome e o Firefox come√ßaram a oferecer suporte ao novo codec AV1 - para eles, o v√≠deo pode ser produzido pela metade. <br><br>  Falaremos separadamente sobre como substituir GIFs por v√≠deo em AV1 e H.264 - e seu tamanho cair√° de 20 a 40 vezes. <br><br><img src="https://habrastorage.org/webt/e6/ma/qx/e6maqxoeu5hqqh3ilpk5vh6ozvk.jpeg" alt="AV1 no navegador"><br><br>  O YouTube j√° o usa no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">TestTube</a> .  A Netflix disse que o AV1 ser√° " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">o codec da pr√≥xima gera√ß√£o</a> ". <br><br>  N√≥s, do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Marciano Mal,</a> j√° o usamos em nosso site e no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Amplifer</a> .  Neste artigo, compartilharei a experi√™ncia de implementar o AV1 e mostrarei passo a passo como incorporar um v√≠deo para que ele funcione em todos os navegadores. <br><a name="habracut"></a><br><h2>  Codecs e cont√™ineres </h2><br>  Com imagens, tudo √© simples: JPEG com PNG para todos os navegadores ou crie arquivos mais compactos no WebP para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">navegadores modernos</a> .  Sempre podemos ter certeza de que os arquivos <code>.png</code> ter√£o um formato PNG (com a rara exce√ß√£o de bombas PNG <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">contra as</a> quais o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">imgproxy</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">pode proteger</a> ). <br><br>  Arquivos de v√≠deo s√£o mais complicados.  A extens√£o do arquivo ( <code>.mp4</code> , <code>.wmv</code> , <code>.webm</code> ou <code>.mov</code> ) fala apenas sobre o cont√™iner.  Enquanto os arquivos de v√≠deo consistem em tr√™s componentes diferentes: <br><br><ol><li>  <b>O codec de v√≠deo</b> determina o quanto voc√™ pode compactar o v√≠deo e o que precisa sacrificar.  Os principais codecs de v√≠deo da Web: H.264, HEVC, VP9 e, agora, AV1. </li><li>  <b>O codec de √°udio</b> comprime o som.  Obviamente, n√£o √© necess√°rio se n√£o houver som no v√≠deo.  As op√ß√µes populares s√£o MP3, Opus e AAC. </li><li>  <b>O cont√™iner</b> armazena v√≠deo (compactado por algum tipo de codec de v√≠deo) e fluxo de √°udio (compactado por algum tipo de codec de √°udio).  Al√©m de dados adicionais, como legendas e meta-informa√ß√µes.  Recipientes populares: MP4, MOV, WebM. </li></ol><br>  Quando vemos a extens√£o do arquivo <code>.mp4</code> , podemos apenas dizer que o cont√™iner MP4 foi usado.  Mas os codecs podem ser diferentes - o autor pode usar o H.264 e AAC, AV1 e Opus, ou qualquer outra coisa. <br><br><h2>  Eis AV1 </h2><br>  O AV1 √© um codec de v√≠deo lan√ßado h√° um ano, em mar√ßo de 2018. Foi criado para superar os codecs da gera√ß√£o anterior - HEVC, VP9, ‚Äã‚ÄãH.264 e VP8. <br><br><img src="https://habrastorage.org/webt/l1/pr/n6/l1prn6kicyr6f7smayebyp7m85m.jpeg" alt="Gr√°fico de gera√ß√£o de codecs de v√≠deo"><br>  <i>Diagrama de codec de gera√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Tsahi Levent-Levy</a></i> <br><br><blockquote>  Se voc√™ se interessou em como exatamente o AV1 conseguiu superar o restante dos codecs na compacta√ß√£o, leia os detalhes t√©cnicos nas tradu√ß√µes em Habr√©: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V√≠deo de pr√≥xima gera√ß√£o: Apresentando o AV1</a> <br>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Codec AV1 de pr√≥xima gera√ß√£o: filtro direcional corretivo CDEF</a> ‚Äù <br></blockquote><br>  Devido a novas otimiza√ß√µes, o AV1 compacta o v√≠deo 30-50% melhor que o H.264 ou VP8 e at√© 30% melhor que o HEVC.  Mas o codec foi lan√ßado recentemente e at√© agora tem v√°rias doen√ßas na inf√¢ncia: <br><br><ul><li>  O codificador atual n√£o est√° otimizado.  O AV1 compacta o v√≠deo <i>muito</i> lentamente (um novo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">codificador r√°pido no Rust</a> j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">est√°</a> em desenvolvimento).  O codec n√£o √© adequado para streaming.  Se estamos falando de v√≠deos est√°ticos nos desembarques - esse problema n√£o √© relevante para n√≥s. </li><li>  At√© o momento, o codec √© suportado apenas no Chrome e no Firefox no Windows.  Ainda n√£o h√° suporte para o Safari e Edge (embora a Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">j√°</a> esteja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">testando</a> ).  Voc√™ precisar√° de pelo menos 2 arquivos: AV1 para Chrome e Firefox e H.264 para outros navegadores. </li></ul><br>  O mais interessante do AV1 √© que os quadrados de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">jackaliza√ß√£o</a> " n√£o aparecem com taxas de bits baixas. <br><br><img src="https://habrastorage.org/webt/kd/fi/gm/kdfigmacjbsduq4reyw7fsjvygo.png" alt="Compara√ß√£o da qualidade da imagem para diferentes codecs em diferentes taxas de bits"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Comparando a</a> qualidade da imagem para diferentes codecs com taxas de bits diferentes - o AV1 vence</i> <br><br><h2>  Cozinhar AV1 corretamente </h2><br>  Vamos finalmente come√ßar a praticar.  Primeiro, vamos decidir sobre o cont√™iner.  Em teoria, o AV1 pode ser colocado em recipientes diferentes, mas o MP4 √© mais compacto e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">recomendado</a> na especifica√ß√£o.  Para o som no AV1, tomamos o Opus, porque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">comprime o som perfeitamente</a> . <br><br>  Para que o v√≠deo funcione em todos os navegadores, geraremos 3 arquivos: <br><br><ol><li>  Para desktop Chrome e Firefox no Windows ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">31% do mercado</a> em mar√ßo de 2019): cont√™iner MP4 com AV1 para v√≠deo e Opus para som. </li><li>  Para Safari e Edge ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">16% do mercado</a> ) - MP4 com HEVC e AAC. </li><li>  De resto: um arquivo MP4 grande com H.264 e AAC. </li></ol><br>  Voc√™ pode usar apenas AV1 e H.264 - o v√≠deo tamb√©m funcionar√° para todos. <br><br>  Para compacta√ß√£o, recomendo usar o console <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">FFmpeg</a> .  Existem muitos utilit√°rios gr√°ficos, mas √© mais f√°cil salvar op√ß√µes no console e iniciar a convers√£o automaticamente.  Certifique-se de usar a vers√£o mais recente do FFmpeg.  As vers√µes anteriores √† <b>4.1</b> n√£o suportam AV1 no MP4. <br><br>  Para Mac OS X: <br><br><ol><li>  Instale o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Homebrew</a> . </li><li> <code>brew install ffmpeg</code> </li> </ol><br>  Para o Linux, √© melhor usar uma vers√£o nova do site oficial - enquanto em muitas distribui√ß√µes n√£o h√° vers√£o com suporte para AV1 no MP4: <br><br><ol><li> <code>wget https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>tar -xf ffmpeg-release-amd64-static.tar.xz</code> </li> <li> <code>sudo cp ffmpeg-4.1-64bit-static/ff* /usr/local/bin/</code> </li> </ol><br>  Para Windows, voc√™ pode instalar o FFmpeg <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">por William Diaz</a> . <br><br>  Passamos √† convers√£o do arquivo H.264, necess√°rio para navegadores mais antigos.  Como todos os nossos arquivos usam o cont√™iner MP4, <code>.hevc.mp4</code> <code>.h264.mp4</code> posteriores <code>.av1.mp4</code> , <code>.hevc.mp4</code> e <code>.h264.mp4</code> .  N√£o se assuste com a longa equipe, analisaremos tudo: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  SOURCE.mov     - ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf "scale=trunc(iw/2)*2:trunc(ih/2)*2" video.h264.mp4</span></span></code> </pre><br>  Agora abra <code>video.h264.mp4</code> .  Se a qualidade for boa e o tamanho for grande, tente aumentar <code>-crf</code> ( <code>-crf 26</code> e <code>-crf 28</code> ).  Esta op√ß√£o reduzir√° o tamanho do arquivo ao custo de qualidade reduzida.  Equilibrar qualidade e tamanho √© uma arte. <br><br><blockquote>  Se n√£o houver arquivo de v√≠deo original, voc√™ poder√° converter o arquivo H.264 antigo em AV1. </blockquote><br>  Agora √© hora de converter o AV1 - lembro que ser√° mais longo que o H.264.  O codec ainda n√£o usa toda a pot√™ncia do processador (faz sentido come√ßar a converter v√°rios arquivos em paralelo). <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libopus -c:v libaom-av1 -crf 34 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br>  <code>-crf</code> com <code>-crf</code> novamente para <code>-crf</code> equil√≠brio perfeito entre qualidade e tamanho. <br><br>  Agora o mesmo para HEVC. <br><br><pre> <code class="bash hljs">ffmpeg -i SOURCE.mov -map_metadata -1 -c:a libfdk_aac -c:v libx265 -crf 24 -preset veryslow -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.hevc.mp4</code> </pre><br>  Copie <code>video.h264.mp4</code> , <code>video.hevc.mp4</code> e <code>video.av1.mp4</code> na raiz do seu site. <br><br><h3>  Compreendendo as op√ß√µes do FFmpeg </h3><br>  Os comandos acima parecem um feiti√ßo de invoca√ß√£o de dem√¥nios?  N√£o se preocupe, isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">n√£o</a> √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">PostCSS</a> .  Vejamos as op√ß√µes. <br><br>  <code>-i SOURCE.mov</code> indica o arquivo de entrada, de onde o FFmpeg ir√° capturar os fluxos de v√≠deo e √°udio, compact√°-los e empacot√°-los em um novo cont√™iner. <br><br>  <code>-map_metadata -1</code> remover√° as meta informa√ß√µes do v√≠deo (por exemplo, o programa em que o v√≠deo foi criado).  Essas informa√ß√µes raramente s√£o √∫teis na Web. <br><br>  <code>-c:a libopus</code> ou <code>-c:a libfdk_aac</code> define os codecs de √°udio.  Se voc√™ n√£o precisar de som, substitua-o por <code>-an</code> . <br><br>  <code>-c:v libaom-av1</code> seleciona o codec de v√≠deo - uma biblioteca que comprime os quadros do fluxo de v√≠deo. <br><br>  <code>-crf 34</code> - Fator de taxa constante, um equil√≠brio de qualidade e tamanho.  √â como um controle deslizante de qualidade JPEG, mas segue em uma dire√ß√£o diferente (0 √© a melhor qualidade e o maior arquivo).  A escala de CRF √© diferente para H.264 e AV1 - para H.264 sobe para 51, para AV1 sobe para 61. CRF para AV1 e H.264 ser√° diferente. <br><br><blockquote>  O Facebook encontrou uma correspond√™ncia aproximada entre os valores de CRF para H.264 e AV1: <br>  19 ‚Üí 27, 23 ‚Üí 33, 27 ‚Üí 39, 31 ‚Üí 45, 35 ‚Üí 51, 39 ‚Üí 57. <br></blockquote><br>  <code>-preset veryslow</code> obriga os codecs H.264 e HEVC a compactar ainda mais o arquivo √† custa de um aumento acentuado no tempo de convers√£o. <br><br>  <code>-profile:v main</code> usado pelo H.264 para selecionar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">um perfil de codec</a> .  Somente "Principal" funcionar√° no Safari. <br><br>  <code>-b:v 0</code> define a taxa de bits m√≠nima para AV1 para que o v√≠deo tenha qualidade consistente. <br><br>  <code>-pix_fmt yuv420p</code> (formato de pixel) √© uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">maneira</a> complicada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">de</a> reduzir o tamanho do arquivo.  Deixa a resolu√ß√£o original para brilho, mas reduz a resolu√ß√£o para cores.  Nossos olhos v√™em a cor pior, portanto n√£o percebem esse truque.  Remova esta op√ß√£o se, no seu caso, ela interferir. <br><br>  <code>-movflags +faststart</code> move tudo que √© importante para o in√≠cio do arquivo, para que o navegador possa reproduzir o v√≠deo at√© a conclus√£o do download. <br><br>  <code>-vf "scale=trunc(iw/2)*2:trunc(ih/2)*2"</code> mudar√° o tamanho dos lados do v√≠deo para os pares mais pr√≥ximos (alguns codecs podem funcionar com uma resolu√ß√£o de 300 √ó 200 e 302 √ó 200, mas n√£o funcionar√£o com 301 √ó 200).  Se voc√™ tiver certeza de que em todos os lugares a resolu√ß√£o √© dividida por 2 - voc√™ pode remover esta op√ß√£o. <br><br>  <code>-strict experimental</code> necess√°rio um <code>-strict experimental</code> para o AV1, seu codificador ainda √© experimental. <br><br>  <code>video.av1.mp4</code> define o nome do arquivo resultante. <br><br><h3>  Lan√ßamos v√≠deo nos navegadores </h3><br>  Agora precisamos de cada navegador para baixar o v√≠deo que ele suporta.  Para isso, &lt;source&gt; possui um atributo <code>type</code> .  E eu aconselho voc√™ a ler sobre as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">op√ß√µes em &lt;video&gt;</a> . <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controls</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.hevc.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=hevc,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08,opus"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=avc1.4D401E,mp4a.40.2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  &lt;source&gt; s√£o como express√µes <code>if‚Ä¶else</code> - o navegador as l√™ de cima para baixo at√© encontrar aquela cujo <code>type</code> ele suporta. <br><br>  No <code>type</code> voc√™ pode especificar todo o formato do arquivo: cont√™iner ( <code>video/mp4</code> para MP4), codec de v√≠deo ( <code>av01.0.05M.08</code> para AV1, <code>hevc</code> para HEVC e <code>avc1.4D401E</code> para H.264) e codec de √°udio ( <code>opus</code> para Opus e <code>mp4a.40.2</code> para AAC). <br><br><h2>  B√¥nus: como converter GIF para AV1 e H.264 </h2><br>  Em 2019, usar GIFs para v√≠deos curtos √© um grande pecado.  O GIF pesa 20 a 40 vezes mais que o H.264 ou AV1.  O GIF atinge a CPU com mais for√ßa e faz com que a bateria vaze mais rapidamente.  Se voc√™ precisar de um v√≠deo em loop curto, use codecs de v√≠deo.  E o FFmpeg pode converter v√≠deo diretamente do GIF. <br><br>  Converta GIF para H.264: <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an -c:v libx264 -crf 24 -preset veryslow -profile:v main -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> video.h264.mp4</code> </pre><br>  Gere um AV1 ainda menor: <br><br><pre> <code class="bash hljs">ffmpeg -i IMAGE.gif -map_metadata -1 -an opus -c:v libaom-av1 -crf 50 -b:v 0 -pix_fmt yuv420p -movflags +faststart -vf <span class="hljs-string"><span class="hljs-string">"scale=trunc(iw/2)*2:trunc(ih/2)*2"</span></span> -strict experimental video.av1.mp4</code> </pre><br>  Agora insira <code>animation.h264.mp4</code> e <code>animation.av1.mp4</code> no HTML. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoplay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">muted</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">playsinline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.av1.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4; codecs=av01.0.05M.08"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"animation.h264.mp4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"video/mp4"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  As op√ß√µes de <code>autoplay</code> e <code>loop</code> tornam o v√≠deo um "GIF" - um v√≠deo em loop que √© reproduzido imediatamente ap√≥s o carregamento da p√°gina.  <code>playsinline</code> impede o Safari de abrir o v√≠deo em tela cheia quando voc√™ clica no v√≠deo. <br><br><h2>  Tempo de retirada </h2><br>  AV1 ainda √© experimental.  Mas j√° pode ser usado para deixar um quarto dos seus usu√°rios mais felizes.  Um par de comandos FFmpeg ir√° gerar arquivos de v√≠deo.  O &lt;video&gt; foi criado desde o in√≠cio para renderizar v√≠deos de acordo com os recursos do navegador.  J√° usamos o AV1 na produ√ß√£o e tudo funciona bem (exceto pelo tempo de espera at√© o codificador AV1 terminar o trabalho). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442020/">https://habr.com/ru/post/pt442020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442010/index.html">Python e FPGA. Teste</a></li>
<li><a href="../pt442012/index.html">Experi√™ncia: coletamos um diret√≥rio de unidades que emitiram um passaporte</a></li>
<li><a href="../pt442014/index.html">Anunciado o Dart 2.2: C√≥digo de m√°quina mais eficiente, suporte para literais definidos</a></li>
<li><a href="../pt442016/index.html">Os hackers s√£o piores do que pintar ou como proteger aplicativos da web</a></li>
<li><a href="../pt442018/index.html">Lei da primavera em termos de constitui√ß√£o. Por que pode</a></li>
<li><a href="../pt442022/index.html">Design no CodeFest. Mas isso n√£o √© certo</a></li>
<li><a href="../pt442024/index.html">Uma estrat√©gia nacional de intelig√™ncia artificial est√° sendo criada na R√∫ssia</a></li>
<li><a href="../pt442026/index.html">Trojan.Multi.BroSubsc.gen - o Kaspersky trabalha</a></li>
<li><a href="../pt442028/index.html">Ester√≥ides de carreira. Caminho Samurai</a></li>
<li><a href="../pt442032/index.html">Reintrodu√ß√£o de bisonte (pequena vit√≥ria dos zo√≥logos)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>