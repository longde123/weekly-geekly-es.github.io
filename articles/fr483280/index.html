<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëµüèø üßìüèª üè¨ Syst√®me de fichiers ESP32 et SPIFFS üèúÔ∏è üèá üë®üèæ‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SPIFFS - (Serial Peripheral Interface Flash File System) syst√®me de fichiers pour m√©moire flash connect√© via une interface p√©riph√©rique s√©rie. En term...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Syst√®me de fichiers ESP32 et SPIFFS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483280/"><p><img src="https://habrastorage.org/webt/dk/uh/vq/dkuhvq6yoyqdkd4tcxoysp1cldg.png"></p><br><p>  <strong>SPIFFS</strong> - (Serial Peripheral Interface Flash File System) syst√®me de fichiers pour m√©moire flash connect√© via une interface p√©riph√©rique s√©rie.  En termes simples: il y a un microcontr√¥leur ESP32 (Figure 1), il a une m√©moire NOR non volatile r√©inscriptible int√©gr√©e, qui stocke: Pr√©f√©rences, chargeur de d√©marrage, firmware (croquis compil√©), syst√®me de fichiers (SPIFFS) et autre chose quelque chose comme une mise √† jour en direct (OTA). </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/4k/dn/lc/4kdnlcaw_rmw1zh3saprrt8g-lm.png"></p><br><p>  Figure 1. Sch√©ma fonctionnel du microcontr√¥leur ESP32 </p><br><p>  <strong>La m√©moire NOR</strong> est un type de m√©moire r√©inscriptible non volatile qui a une vitesse de lecture assez √©lev√©e, une vitesse d'√©criture et d'effacement relativement faible, par rapport au type de <strong>m√©moire NAND</strong> .  Il est presque impossible de rencontrer une m√©moire NOR de grande capacit√©, g√©n√©ralement limit√©e √† 128 Mo.  Dans le cas de ESP32 - <strong>quatre</strong> . </p><br><p>  Aujourd'hui, SPIFFS pr√©sente certains inconv√©nients. <del>  d√©fauts </del>  , notamment: le manque de prise en charge des dossiers;  pas une pile en temps r√©el, donc la m√™me op√©ration peut prendre des temps diff√©rents;  manque de capacit√© √† trouver et r√©parer les blocs cass√©s.  Si les lacunes √©num√©r√©es ne sont pas critiques pour vous, nous continuons √† lire le paragraphe suivant. </p><br><h2 id="davayte-pogovorim-ob-ispolzovanii">  Parlons de l'utilisation </h2><br><p>  Malheureusement, <a href="" rel="nofollow"><strong>pr√™t</strong></a> √† l'emploi, la m√©moire du microcontr√¥leur n'est pas marqu√©e comme SPIFFS, pour le marquer, vous devez utiliser le <a href="" rel="nofollow"><strong>plug-in ESP32FS</strong></a> pour l'environnement de d√©veloppement Arduino IDE. </p><br><p>  Une fois le plugin t√©l√©charg√©, il doit √™tre install√©: </p><br><ul><li>  Assurez-vous que la derni√®re version de l'environnement de d√©veloppement <strong>Arduino IDE</strong> et le <strong>pilote</strong> de votre appareil sur l' <strong>ESP32 sont install√©s</strong> .  J'ai le pilote <strong>M5Stack CP210X que</strong> je t√©l√©charge √† partir de <a href="https://m5stack.com/pages/download" rel="nofollow">ce</a> lien; </li><li>  Copiez le dossier des <strong>outils</strong> t√©l√©charg√©s avec le plugin int√©gr√© dans le dossier <strong>/ Arduino / tools / ESP32FS /</strong> ; </li><li>  Sous <strong>macOS, le</strong> dossier se trouve dans <strong>~ / Documents / Arduino /</strong> ; </li><li>  Red√©marrez l'ordinateur et enregistrez dans l'environnement de d√©veloppement dans le menu <strong>Outils</strong> l' <strong>√©l√©ment ESP32 Sketch Data Upload</strong> appara√Æt (Figure 2) - cela signifie que vous avez tout fait correctement; </li></ul><br><p><img src="https://habrastorage.org/webt/-x/nx/hh/-xnxhhpznuyuzorp80sfkjugpwm.png"></p><br><p>  Figure 2. Menu <strong>Outils</strong> </p><br><ul><li>  Faites attention au dossier de <strong>donn√©es</strong> situ√© √† c√¥t√© du croquis.  Tous les fichiers situ√©s dans ce dossier seront charg√©s dans la m√©moire de l'appareil pendant le formatage; </li><li>  N'h√©sitez pas √† s√©lectionner l'√©l√©ment indiqu√© et attendez la fin du formatage de la zone m√©moire.  Veuillez noter que les autres sections de la m√©moire ne seront <strong>PAS</strong> affect√©es, ce qui signifie que le firmware restera dans la m√©moire de l'appareil et fonctionnera.  De m√™me avec l'esquisse, lorsqu'elle est compil√©e dans le firmware et t√©l√©charg√©e sur l'appareil, le syst√®me de fichiers ne sera pas affect√©. </li></ul><br><h2 id="esli-hochetsya-komforta">  Si vous voulez du confort </h2><br><ul><li><p>  Si vous souhaitez toucher des fichiers et voir des informations sur l'espace libre, t√©l√©chargez le croquis <a href="https://github.com/dsiberia9s/A-Explorer/tree/master/BRIDGE" rel="nofollow"><strong>BRIDGE</strong></a> et flashez votre appareil dessus. </p><br></li><li><p>  T√©l√©chargez √©galement <del>  et compiler </del>  gestionnaire de fichiers multiplateforme <strong><a href="https://github.com/dsiberia9s/A-Explorer" rel="nofollow">A-Explorer</a></strong> (figure 3).  Sur <strong>GitHub, les</strong> binaires seront bient√¥t dans le dossier <strong>bin</strong> . </p><br><p><img src="https://habrastorage.org/webt/mp/6d/rg/mp6drgioq7tnnceb7zwowdfsgds.png"></p><br><p>  Figure 3 a.  Gestionnaire de fichiers A-Explorer pour macOS </p><br><p><img src="https://habrastorage.org/webt/bs/hw/ko/bshwkodnhxaqb8jonxgpxdanlqo.jpeg"></p><br><p>  Figure 3, b.  Gestionnaire de fichiers A-Explorer pour Windows </p><br></li></ul><br><p>  Ce gestionnaire de fichiers vous permettra de trouver des informations sur l'espace libre, de t√©l√©charger / t√©l√©charger / supprimer des fichiers.  Il y a une indication de l'avancement de l'op√©ration. </p><br><p>  Comme vous pouvez le voir sur la figure 3, le plug-in a allou√© environ <strong>1,38 Mo de</strong> m√©moire sous SPIFFS. </p><br><h2 id="kto-takoy-etot-bridge">  Qui est ce BRIDGE? </h2><br><p>  <strong>BRIDGE</strong> est une esquisse, et tout d'abord, une fonction du m√™me nom qui fonctionne avec le syst√®me de fichiers SPIFFS et A-Explorer est un shell graphique pour cela.  Ce dernier envoie une commande ou une autre, et cette fonction la traite sur l'appareil lui-m√™me √† l'aide des <strong>biblioth√®ques</strong> <strong>FS</strong> et <strong>SPIFFS</strong> .  Voyons ce qui est int√©ressant dans ces biblioth√®ques. </p><br><p>  Commen√ßons par regarder les m√©thodes publiques <strong>de la classe SPIFFS</strong> : </p><br><ul><li><p>  M√©thode de d√©but bool√©en (bool formatOnFail = false, const char * basePath = "/ spiffs", uint8_t maxOpenFiles = 10).  Cette m√©thode tente d'initialiser une instance de la classe.  Le premier argument est vrai ou faux au cas o√π le syst√®me de fichiers devrait √™tre format√© s'il n'est pas format√©.  Le deuxi√®me argument prend le chemin o√π se trouvera la racine du syst√®me de fichiers.  Le troisi√®me argument d√©terminera le nombre de fichiers ouverts simultan√©ment.  Il vaut mieux laisser les deux derniers param√®tres par d√©faut et ne pas les changer.  Si le syst√®me de fichiers est manquant (le plugin ci-dessus n'a pas √©t√© utilis√©).  alors la fonction retournera false. </p><br></li><li><p>  La m√©thode bool format () v√©rifie si le syst√®me de fichiers est format√© - renvoie vrai, sinon - faux. </p><br></li><li><p>  M√©thode size_t totalBytes ().  Cette m√©thode retourne le size_t-number du nombre total d'octets allou√©s au syst√®me de fichiers. </p><br></li><li><p>  M√©thode Size_t usedBytes ().  Cette m√©thode renvoie le nombre size_t d'octets utilis√©s dans le syst√®me de fichiers. </p><br></li><li><p>  M√©thode Void end ().  Cette m√©thode d√©sinitialise cette classe.  Apr√®s avoir appel√© cette m√©thode, cela n'a aucun sens d'appeler d'autres m√©thodes. </p><br></li></ul><br><p>  Tout dans cette classe, il n'y a rien de particuli√®rement int√©ressant.  Passons √† <strong>la classe FS</strong> et voyons ce qui peut √™tre utile √† partir de l√†. </p><br><ul><li><p>  La premi√®re chose qui attire votre attention est la m√©thode d'initialisation de la classe bool begin ().  Cette m√©thode ne n√©cessite pas d'arguments et il n'est pas n√©cessaire de l'appeler, car nous utiliserons imm√©diatement la m√©thode suivante. </p><br></li><li><p>  La m√©thode File open ( <em>chemin const char,</em> mode <em>const char</em> ) et son fr√®re File open (const String &amp; path, mode const char *).  Ces m√©thodes prennent deux arguments, dont le premier est un pointeur symbolique et cha√Æne vers le chemin du fichier, et le second est le mode d'ouverture, qui peut √™tre la constante suivante: </p><br></li></ul><br><p>  <strong>FILE_READ</strong> - ouvert en lecture seule; </p><br><p>  <strong>FILE_WRITE</strong> - ouvert pour l'√©criture uniquement; </p><br><p>  <strong>FILE_APPEND</strong> - ouvert pour l'√©crasement. </p><br><p>  Apr√®s avoir ouvert le fichier, nous pouvons maintenant effectuer toutes les op√©rations sur celui-ci. </p><br><ul><li>  La m√©thode size_t write (uint8_t) vous permet d'√©crire un entier non sign√© 8 bits √† la fin du fichier. </li><li>  La m√©thode d'√©criture size_t (const uint8_t * buf, size_t size) vous permet d'√©crire une s√©rie d'entiers non sign√©s de la longueur sp√©cifi√©e dans le deuxi√®me argument. </li><li>  La m√©thode int available () compte le nombre de caract√®res de la fin au pointeur. </li><li>  La m√©thode int read () lit un caract√®re du fichier et le renvoie sous forme d'entier, tandis que le curseur d√©cale d'une unit√© vers la droite. </li><li>  La m√©thode size_t readBytes (char * buffer, size_t length) lit les caract√®res dans le tampon point√© par le premier argument et le nombre de caract√®res transmis par le deuxi√®me argument.  Renvoie le nombre de caract√®res lus. </li><li>  La m√©thode String readString () lit une ligne dans un fichier. </li><li>  La m√©thode int peek () fonctionne de mani√®re similaire √† la m√©thode int read (), seul le curseur reste en place. </li><li>  Les m√©thodes bool√©enne (uint32_t pos, mode SeekMode) et bool√©enne (uint32_t pos, mode SeekMode) positionnent le curseur √† l'emplacement sp√©cifi√©.  La position est pass√©e comme premier argument et la deuxi√®me r√®gle ( <strong>SeekSet</strong> - positionnez le curseur).  En cas de succ√®s - renvoie vrai, sinon - faux. </li><li>  La m√©thode size_t position () renvoie la position du curseur. </li><li>  La m√©thode size_t size () renvoie la taille du fichier en octets. </li><li>  La m√©thode const char * name () renvoie le nom du fichier. </li><li>  La m√©thode const char * fullName (), en tenant compte du chemin complet. </li><li>  La m√©thode bool isFile () renvoie true si l'objet ouvert est un fichier.  Sinon - un mensonge. </li><li>  La m√©thode bool isDirectory () renvoie true si l'objet ouvert est un dossier.  Sinon - un mensonge. </li><li>  La m√©thode File openNextFile () renvoie un pointeur sur le fichier suivant √† la racine, sinon NULL. </li><li>  Les m√©thodes bool existent (const char * path) et bool exist (const String &amp; path) prennent le nom complet du fichier comme argument, et si un tel fichier existe, il renvoie true, sinon il renvoie false. </li><li>  Les m√©thodes bool remove (const char * path) et bool remove (const String &amp; path) essaient de supprimer le fichier dont le nom est pass√© par argument.  En cas de succ√®s, renvoie vrai, sinon - faux. </li><li>  M√©thode bool rename (const char <em>pathFrom, const char</em> pathTo) et bool rename (const String &amp; pathFrom, const String &amp; pathTo);  accepte le nom de fichier complet comme premier argument et le second comme nouveau nom de fichier complet et renommez-le. </li></ul><br><p>  Oui, oui, vous pouvez prendre cette fonction et l'ex√©cuter dans un thread s√©par√© dans n'importe quel autre croquis </p><br><p>  <strong>Merci beaucoup pour votre temps!</strong>  <strong>Je serais heureux si cet article vous profite.</strong> </p><br><h3 id="spisok-literatury-i-ili-istochnikov">  R√©f√©rences et (ou) sources: </h3><br><ul><li>  Syst√®me de fichiers SPIFFS <a href="https://docs.espressif.com/projects/esp-idf/en/latest/api-reference/storage/spiffs.html" rel="nofollow">ici</a> </li><li>  Travailler avec le syst√®me de fichiers de l'addon ESP8266 dans l'IDE Arduino <a href="http://wikihandbk.com/wiki/ESP8266:%25D0%259F%25D1%2580%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B2%25D0%25BA%25D0%25B8/Arduino/%25D0%25A0%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0_%25D1%2581_%25D1%2584%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9_%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25BE%25D0%25B9_%25D0%25B2_%25D0%25B0%25D0%25B4%25D0%25B4%25D0%25BE%25D0%25BD%25D0%25B5_ESP8266_%25D0%25B4%25D0%25BB%25D1%258F_IDE_Arduino" rel="nofollow">ici</a> </li><li>  T√©l√©chargement du syst√®me de fichiers Arduino ESP32 <a href="https://github.com/me-no-dev/arduino-esp32fs-plugin" rel="nofollow">ici</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483280/">https://habr.com/ru/post/fr483280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483268/index.html">Le livre "Fashion, Faith, Fantasy and the New Physics of the Universe"</a></li>
<li><a href="../fr483270/index.html">L'√©volution des applications HighLoad sur l'exemple d'un portail r√©gional de services publics</a></li>
<li><a href="../fr483272/index.html">Le chemin de la restauration √† l'entreprise informatique</a></li>
<li><a href="../fr483276/index.html">Nouvelles fonctionnalit√©s de Python 3.8 et il est temps de passer √† Python 2</a></li>
<li><a href="../fr483278/index.html">Accord de partenariat ou comment ne pas ruiner une entreprise au d√©part</a></li>
<li><a href="../fr483284/index.html">Comment j'ai analys√© le programme</a></li>
<li><a href="../fr483290/index.html">Penser le design en gestion de projet ou pourquoi un chef de projet a-t-il besoin de techniques cr√©atives</a></li>
<li><a href="../fr483294/index.html">Nous √©crivons une ¬´calculatrice¬ª. Partie II R√©solvez des √©quations, effectuez un rendu dans LaTeX, acc√©l√©rez les fonctions pour surligner</a></li>
<li><a href="../fr483298/index.html">Comment quitter correctement, pour que plus tard ...</a></li>
<li><a href="../fr483302/index.html">Premiers pas avec Google Sheets en Python. De l'enregistrement √† la lecture des donn√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>