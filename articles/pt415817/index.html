<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßöüèΩ ü§æüèæ üë∂üèΩ Fazemos um overclock do backup. Palestra Yandex üõÄüèª üè¥ üë®üèª‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="V√°rias palestras programadas ser√£o baseadas no primeiro Y. Subbotnik em bancos de dados realizados na primavera . Primeiro, o desenvolvedor Andrei Bor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fazemos um overclock do backup. Palestra Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/415817/">  V√°rias palestras programadas ser√£o baseadas no primeiro Y. Subbotnik em bancos de dados realizados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">na primavera</a> .  Primeiro, o desenvolvedor Andrei Borodin falou no Y. Subbotnik.  Ele falou sobre o WAL-G, uma ferramenta simples e eficaz para fazer backup do PostgreSQL na nuvem, bem como algoritmos e tecnologias que permitem ao WAL-G criar backups mais rapidamente.  A principal caracter√≠stica do WAL-G s√£o os backups delta.  Na palestra, voc√™ aprender√° sobre a implementa√ß√£o deles e como o suporte a essa tecnologia est√° se desenvolvendo no PostgreSQL. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/bXuN4Na0cEo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  oi!  Sou desenvolvedor Yandex de Yekaterinburg.  Para a tecnologia de backup r√°pido.  Fazemos backup h√° algum tempo; houve relatos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vladimir Borodin</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Evgeny Dyukov</a> sobre como pesquisamos e o que desenvolvemos para armazenar dados com seguran√ßa, confiabilidade, conveni√™ncia e efici√™ncia.  Esta s√©rie √© dedicada aos mais recentes desenvolvimentos nesta √°rea. <br><br>  Vamos falar sobre backups no PostgreSQL em princ√≠pio.  O utilit√°rio padr√£o para transfer√™ncia de dados - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pg_dump</a> - √© definido como um utilit√°rio do console que cria um arquivo com uma representa√ß√£o l√≥gica dos seus dados. <br><a name="habracut"></a><br>  O fato de ser uma c√≥pia l√≥gica √© bastante conveniente.  Voc√™ sempre pode transferir dados entre vers√µes diferentes, pode cortar seu banco de dados em peda√ßos, e esta √© uma ferramenta padr√£o que, por exemplo, vem em uma caixa com o utilit√°rio de administra√ß√£o PgAdmin. <br><br><img src="https://habrastorage.org/webt/3j/zs/kh/3jzskhrdbobeb5pfvdyebjvv9bi.jpeg"><br>  Primeiro de tudo, sobre o pg_dump, voc√™ precisa saber que esta √© uma ferramenta de desenvolvedor. <br><br>  Esta n√£o √© uma ferramenta de manuten√ß√£o de banco de dados.  O pg_dump n√£o foi projetado para funcionar com um banco de dados altamente carregado. <br><br><img src="https://habrastorage.org/webt/rb/sk/yf/rbskyfdmcwqb9ctu6-idvcj6ywm.jpeg"><br>  Suponha que tudo seja s√©rio e voc√™ queira usar a tecnologia "Recupera√ß√£o pontual", que usa a API do PostgreSQL para trabalhar com backups online.  Voc√™ chama a fun√ß√£o pg_start_backup e faz uma c√≥pia do arquivo do banco de dados.  De fato, pg_start_backup for√ßa o banco de dados a executar o CHECKPOINT;  e habilite grava√ß√µes de p√°gina inteira no log de grava√ß√£o antecipada.  A c√≥pia do banco de dados que voc√™ cria quando chama a API n√£o √© uma c√≥pia consistente dos dados.  Voc√™ tamb√©m precisa de um log write-ahead para poder restaurar seu banco de dados durante a chamada pg_stop_backup, ou seja, no final do backup. <br><br><img src="https://habrastorage.org/webt/0a/aw/v1/0aawv1w0gp9okkkbjuja0k-ywg4.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  Ap√≥s o t√©rmino da remo√ß√£o do backup e na presen√ßa de um registro inicial, voc√™ pode recuperar o ponto desejado na vida √∫til do seu banco de dados. <br><br>  O utilit√°rio pg_basebackup √© fornecido na caixa, que implementa toda essa tecnologia de forma can√¥nica e permite fazer backup com a funcionalidade m√≠nima necess√°ria. <br><br>  Se voc√™ ainda √© mais s√©rio do que antes, usa algum tipo de software de gerenciamento de backup e, geralmente, √© o Barman. <br><br>  Ele tem v√°rias vantagens.  A principal vantagem √© um utilit√°rio muito comum, possui uma comunidade enorme, um grande n√∫mero de perguntas sobre o Stack Overflow. <br><br><img src="https://habrastorage.org/webt/hk/_s/xx/hk_sxxzzua_byoapw4kvxdexymm.jpeg"><br><br>  Voc√™ s√≥ precisa pegar um servidor de backup e fazer backup de todo o seu PostgreSQL l√°.  Isso √© muito conveniente - desde que um servidor de backup seja suficiente para voc√™. <br><br>  Assim que voc√™ tiver muitos servidores de backup, precisar√° monitorar se algum deles est√° cheio.  Em caso de falha de algum servidor de backup, voc√™ precisa entender quais bancos de dados est√£o em perigo.  Voc√™ precisa entender em princ√≠pio onde copiar um novo cluster de banco de dados ao cri√°-lo. <br><br>  Existe um utilit√°rio de remo√ß√£o de backup muito mais simples chamado WAL-E. <br><br><img src="https://habrastorage.org/webt/jf/l1/a0/jfl1a07ymxdr0luksh1zg_cb7ii.jpeg"><br>  O WAL-E executa quatro comandos principais.  O comando WAL-PUSH envia um arquivo WAL para a nuvem e o WAL-FETCH pega um arquivo WAL se restore_command precisar ser restaurado. <br><br>  Tamb√©m h√° BACKUP-PUSH (implementa a remo√ß√£o da API de backup) e BACKUP-FETCH (coleta todos os dados da nuvem).  Os dados s√£o armazenados na nuvem; portanto, voc√™ n√£o precisa monitorar nada, isso j√° √© um problema de servi√ßo em nuvem, como garantir a disponibilidade dos seus dados quando voc√™ precisar.  Esta √© provavelmente a principal vantagem do WAL-E. <br><br><img src="https://habrastorage.org/webt/tz/2e/h5/tz2eh51uc_vtsp-oylcltmgep1i.jpeg"><br>  Existem muitas funcionalidades.  H√° uma lista de backups, h√° uma pol√≠tica de reten√ß√£o, ou seja, queremos armazenar backups nos √∫ltimos sete dias, por exemplo, ou nos √∫ltimos cinco backups, algo assim.  E o WAL-E pode fazer backup para uma enorme variedade de servi√ßos em nuvem: S3, Azure, Google, pode chamar o sistema de arquivos local de nuvem. <br><br><img src="https://habrastorage.org/webt/n9/wj/uz/n9wjuz9n4tg_w8cvkkbp4g7_imi.jpeg"><br>  Tem v√°rias propriedades.  Primeiro, ele √© escrito em Python e usa ativamente o pipeline do Unix, em parte por causa disso, possui depend√™ncias e n√£o √© muito produtivo.  Isso √© normal porque o WAL-E se concentra na facilidade de uso e na configura√ß√£o, para que voc√™ n√£o cometa erros ao fazer um plano de backup.  E essa √© uma ideia muito boa. <br><br>  Existem muitos recursos escritos no WAL-E, e onde os autores o desenvolveram ainda n√£o foi muito claro para os autores.  Surgiu a ideia de que eu precisava de uma nova ferramenta. <br><br><img src="https://habrastorage.org/webt/ov/tj/ed/ovtjeduv1bhofpvnrbv2oong4ok.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  Sua principal caracter√≠stica √© que ele √© reescrito no Go, n√£o possui quase depend√™ncias externas, se voc√™ n√£o usar criptografia externa, e √© muito mais produtivo. <br><br><img src="https://habrastorage.org/webt/fl/pl/h2/flplh2x6ugfya5ydixenji9hmxg.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  O WAL-G foi originalmente criado por dois autores do Citus Data, e a principal vantagem √© mostrada neste histograma - a velocidade de envio dos "eixos".  Vemos que o WAL-E √© r√°pido, pode ser qualquer coisa, pode ser uma grande coluna perto de zero. <br><br><img src="https://habrastorage.org/webt/r_/si/dn/r_sidnqgiipagw5sosfzo8ze90e.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  O WAL-G possui uma largura de banda bastante est√°vel.  Em testes no Citus Data, ele mostrou que envia de forma est√°vel cerca de 800 Mb / s de "eixos". <br><br>  Al√©m disso, no WAL-G, por exemplo, escrevi um recurso que implementa backup de uma r√©plica.  Voc√™ n√£o precisa carregar seu mestre de banco de dados com uma carga de leitura; √© poss√≠vel remover o backup da r√©plica. <br><br><img src="https://habrastorage.org/webt/ck/bl/jj/ckbljjqa0ujh35rnlmncx5guauw.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  Mas h√° um pequeno problema.  No momento em que voc√™ come√ßa a fazer o backup, nomeie-o de alguma forma.  O nome inclui uma linha do tempo, que ser√° alterada se uma r√©plica for promovida.  Se ocorrer um failover na cadeia de r√©plicas antes da r√©plica com a qual voc√™ est√° fazendo backup, voc√™ notar√° algumas das r√©plicas, a linha do tempo ser√° alterada.  O WAL-G entende que essa situa√ß√£o n√£o √© consistente, pois, tendo um nome na linha do tempo antiga, o nome promete que voc√™ poder√° continuar o desenvolvimento do hist√≥rico do banco de dados em qualquer dire√ß√£o existente.  Mas isso n√£o √© verdade.  Voc√™ j√° foi a uma das dire√ß√µes; n√£o pode pular para outra linha do tempo com o carro de volta.  Portanto, o WAL-G entende essa situa√ß√£o e n√£o faz upload de um arquivo JSON fiscal na nuvem.  Voc√™ cria uma c√≥pia f√≠sica.  Mas √© necess√°ria interven√ß√£o do administrador para que esta c√≥pia possa ser usada. <br><br><img src="https://habrastorage.org/webt/no/yo/nv/noyonvp7l8d-0myokmscgjts31w.jpeg"><br><br>  Implementamos c√≥pias delta no WAL-G, tamb√©m trabalhei nesse desenvolvimento.  Isso permite que voc√™ obtenha menos dados no pr√≥ximo backup de base, n√£o fa√ßa uma c√≥pia dessas p√°ginas de dados que n√£o foram alteradas no backup anterior. <br><br><img src="https://habrastorage.org/webt/dt/cn/ag/dtcnaglkk_z3i6rsm_hvs56m28o.jpeg"><br>  Ao configurar o WAL-G, voc√™ especifica o n√∫mero de etapas que est√£o mais distantes do backup base, do backup delta e da pol√≠tica de c√≥pia delta.  Voc√™ faz uma c√≥pia do √∫ltimo delta existente ou faz um delta do backup completo original.  Isso √© necess√°rio no caso em que o mesmo componente do banco de dados sempre muda no seu banco de dados, os mesmos dados est√£o constantemente mudando. <br><br>  Por que, em princ√≠pio, precisamos de c√≥pias delta do banco de dados?  Em teoria, voc√™ tem um WAL e pode rolar para qualquer lugar. <br><br>  Em um servidor ocupado, a reprodu√ß√£o do WAL de cinco segundos f√≠sicos do passado pode levar quatro segundos f√≠sicos do presente.  Se voc√™ for solicitado a rolar o WAL em quatro dias, isso significa que √© poss√≠vel que a pessoa que solicita isso espere mais tr√™s dias.  Nem sempre √© uma situa√ß√£o aceit√°vel. <br><br>  Voc√™ precisa de backups b√°sicos para todos os dias, mas, no entanto, n√£o √© poss√≠vel armazenar 7 ou 14 c√≥pias completas do seu banco de dados, mesmo que o WAL-G os arquive, ele ainda ser√° muito grande.  E, neste caso, c√≥pias delta ajudam. <br><br><img src="https://habrastorage.org/webt/xw/aw/-l/xwaw-ll2y9911p6gjynx3dxhfb0.jpeg"><br>  Ao desenvolver c√≥pias delta, v√°rios formatos poss√≠veis de arquivos de dados foram discutidos.  Antes de tudo, o formato foi proposto; quando n√£o perturbamos a p√°gina, simplesmente a anulamos.  Mas chegamos √† conclus√£o de que essa n√£o √© uma maneira muito eficaz, os zeros s√£o efetivamente compactados, mas recusamos esse m√©todo de armazenamento, porque √© dif√≠cil depur√°-lo em caso de situa√ß√µes de emerg√™ncia. <br><br><img src="https://habrastorage.org/webt/y1/cd/m-/y1cdm-xvhv7sq-4wt8e3y_xzaia.jpeg"><br>  A pr√≥xima tecnologia considerada √© primeiro armazenar o n√∫mero do bloco e depois o bloco alterado.  Mas aqui nos deparamos com a peculiaridade do armazenamento em arquivos TAR, que precisamos primeiro indicar o tamanho dos arquivos TAR nos quais armazenamos nossa c√≥pia delta e depois come√ßar a grav√°-la.  Eu queria fazer a implementa√ß√£o da tecnologia com um m√≠nimo de RAM consumida, ent√£o tivemos que usar o terceiro formato no qual lemos completamente cada arquivo de dados, procuramos as p√°ginas de dados alteradas, primeiro armazenamos o n√∫mero dos blocos alterados no arquivo TAR e somente ent√£o os pr√≥prios blocos alterados. <br><br><img src="https://habrastorage.org/webt/ew/le/eo/ewleeouqovcrezeke5wv6nndmby.jpeg"><br><img src="https://habrastorage.org/webt/mj/qx/rg/mjqxrg9h-jhu0nlatbxarh1jaaw.jpeg"><br><br>  Esse recurso ainda n√£o foi implementado.  Estou olhando para ela ou procurando algu√©m que queira fazer uma solicita√ß√£o pull no WAL-G.  Ao se recuperar de uma c√≥pia delta, o banco de dados sobrevive a cada uma das reencarna√ß√µes do banco de dados em cada etapa do backup delta.  √Äs vezes, no meio da vida, alguns arquivos s√£o exclu√≠dos.  Ao mesmo tempo, n√£o precisar√≠amos nos preocupar com a condi√ß√£o deles se eles fossem exclu√≠dos de qualquer maneira e depois recriados a partir da c√≥pia delta.  Esse n√£o parece ser um recurso muito complicado; portanto, se voc√™ estiver interessado em escrever algo sobre o Go, consulte esse recurso. <br><br><img src="https://habrastorage.org/webt/g3/fa/7d/g3fa7d6otwscpktvrov045nvmni.jpeg"><br>  Agende sobre o uso de rede, CPU e disco.  No WAL-E, como podemos ver, o backup aqui ainda n√£o terminou, come√ßou √†s uma da manh√£ em Moscou e n√£o terminou no √∫ltimo relat√≥rio que vemos.  O cronograma do WAL-G terminou, funciona mais r√°pido e √© muito mais uniforme em termos de consumo de recursos. <br><br>  O mais interessante √© o gr√°fico do consumo de recursos durante uma c√≥pia delta.  Vemos que todos os recursos se tornaram quase zero.  A carga na CPU √© quase a carga padr√£o no banco de dados; √† noite, algumas consultas s√£o executadas.  Vemos um grande ponto de leitura.  Eu tamb√©m lido com isso, tamb√©m gostaria de receber um pedido ou farei eu mesmo no ver√£o.  O ponto principal √© que ainda precisamos ler nossos dados para descobrir o que mudou neles.  Esta leitura poderia ter sido evitada. <br><br><img src="https://habrastorage.org/webt/6g/bz/w7/6gbzw7p2zf7bbczdq3hnc-z1ni8.jpeg"><br><br>  H√° uma exclus√£o no WAL-G quando indicamos o n√∫mero de backups ou a data a partir da qual precisamos armazenar todos os WALs e todos os backups de base.  E o WAL-G j√° est√° lidando com a quest√£o de quais WALs e backups b√°sicos s√£o necess√°rios.  At√© o momento, n√£o temos recursos que excluam tudo.  No WAL-E, √© tamb√©m uma ocasi√£o para uma solicita√ß√£o de recebimento.  Um comando interessante DELETE TUDO ainda n√£o foi implementado. <br><br><img src="https://habrastorage.org/webt/5q/1t/aw/5q1tawrrz1gj-l4wu1igxubfd4q.jpeg"><br><br>  H√° uma lista de backups. <br><br><img src="https://habrastorage.org/webt/kq/gs/mw/kqgsmwqqiezwwifwb8puxmzlugm.jpeg"><br>  Definimos a vari√°vel de ambiente necess√°ria para o WAL-G funcionar e chamamos o utilit√°rio do console WAL-G.  Os backups que precisamos visualizar s√£o exibidos. <br><br><img src="https://habrastorage.org/webt/id/uv/rg/iduvrgdmb1nca0nbfcpvs0cxfc8.jpeg"><br>  O WAL-G implementa v√°rias tecnologias para backups paralelos e geralmente v√°rias opera√ß√µes.  Por exemplo, essa tecnologia √© usada para enviar "eixos" para o arquivo.  Assim que o PostgreSQL chama archive_command para enviar um arquivo, o WAL-G procura ver se h√° mais arquivos por perto prontos. <br><br>  Em geral, esse n√£o √© um recurso muito documentado, √© muito est√°vel nas vers√µes mais recentes do PostgreSQL; muitas tecnologias o utilizam.  Examinamos se h√° arquivos WAL prontos no status de arquivamento e tamb√©m os enviamos junto com o que pediu para enviar o banco de dados para o arquivamento.  E quando o PostgreSQL pede que eles enviem, n√≥s j√° os enviamos, estamos prontos.  Isso acelera significativamente o envio de WALs em bases carregadas e permite que voc√™ n√£o seja um thread √∫nico.  Normalmente, o PostgreSQL prepara um arquivo, depois espera que ele v√°, prepara o pr√≥ximo.  Conseguimos evitar esse trabalho consistente. <br><br><img src="https://habrastorage.org/webt/pc/3k/5f/pc3k5fkukjj7o5zqxm7hsjr3way.jpeg"><br>  Durante o WAL-FETCH, quando o cluster √© restaurado, tamb√©m tentamos fazer o download dos N arquivos a seguir necess√°rios e equilibrar as pausas entre o in√≠cio da pr√©-defini√ß√£o de novos arquivos WAL, para que possamos utilizar todos os recursos que temos o m√°ximo poss√≠vel: seja executado na rede ou executar em um disco em casos raros. <br><br><img src="https://habrastorage.org/webt/pd/v2/mn/pdv2mnfn4_ne1jbp00nhl35n7y4.jpeg"><br>  Tudo isso √© definido por vari√°veis ‚Äã‚Äãde ambiente. <br><br><img src="https://habrastorage.org/webt/oe/ro/k5/oerok5u-varh4b3rcwq4dgwarmm.jpeg"><br>  Tamb√©m h√° simultaneidade de fazer uma c√≥pia.  Embora esse recurso n√£o esteja presente em v√°rias vers√µes - A.B foi lan√ßada na vers√£o 0.1.10 em junho de 2018 -, j√° que o paralelismo da leitura do disco permite garantir a execu√ß√£o em uma rede ou em um disco.  Isso n√£o √© muito bom com um banco de dados carregado.  O WAL-E tinha um recurso que permitia a otimiza√ß√£o.  At√© agora, n√£o temos isso.  √â necess√°rio limitar a velocidade da remo√ß√£o do backup, para que a base possa viver sua pr√≥pria vida e servir a carga. <br><br>  Nossa principal caracter√≠stica n√£o √© realmente sobre tecnologia. <br><br>  Dois anos atr√°s, Zhenya Dyukov implementou a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tecnologia delta-backup</a> para Barman, ainda n√£o foi realizada, a comunidade ainda est√° discutindo isso. <br><br>  H√° quase um ano, Zhenya corrigiu o bug do WAL-E e o enviamos por seis meses ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link para o GitHub</a> - aprox. Ed.).  Muitas vezes, em solu√ß√µes de c√≥digo aberto, h√° um problema com o fato de que elas n√£o s√£o muito bem mantidas. <br><br><img src="https://habrastorage.org/webt/jy/hg/mf/jyhgmfxdz_srayrm8vsxdnq-a3q.jpeg"><br>  Com o WAL-G, tudo √© bem simples: usamos e eu mantenho.  Se voc√™ ou voc√™ precisar de algo, basta relatar que tem um problema.  Vamos tentar resolv√™-lo. <br><br>  A solicita√ß√£o padr√£o da comunidade √© simples - "vamos fazer isso mais". <br><br>  Mais criptografia, mais plataformas.  Talvez n√£o apenas o PostgreSQL, mas o MySQL ainda fa√ßa backup ou algo mais?  Eu vejo algumas outras coisas. <br><br><img src="https://habrastorage.org/webt/yi/sg/ck/yisgckbaa1bhbae-ixrx_u-fetm.jpeg"><br>  Antes de tudo, agora, ao enviar o "eixo", pudemos entender quais blocos de banco de dados foram alterados, digitalize esses arquivos WAL e salve informa√ß√µes sobre o que foi alterado. <br><br>  E quando o cron chega com outro backup delta, n√£o conseguimos digitalizar todo o banco de dados, arquivar esse dente da leitura do disco e apenas saber quais p√°ginas precisamos arrastar para a nuvem. <br><br>  Tentamos usar a tecnologia de rastreamento de p√°gina.  Ele implementa o rastreamento de altera√ß√µes de p√°gina no n√≠vel do kernel do banco de dados.  O backup √© removido muito rapidamente.  O principal problema com o PTRACK √© que ele √© muito invasivo.  Ele cont√©m muitas altera√ß√µes no n√∫cleo do PostgreSQL em locais muito sens√≠veis, portanto √© improv√°vel que seja adotado em breve. <br><br><img src="https://habrastorage.org/webt/4z/ea/px/4zeapxt_ji4odqmc57wnjpxilik.jpeg"><br>  Al√©m disso, seus deltas s√£o ligeiramente diferentes dos que temos agora.  Ao remover o delta baseado em LSN, removemos todas as altera√ß√µes no arquivo delta ocorridas desde o in√≠cio anterior at√© a hora atual. <br><br><img src="https://habrastorage.org/webt/ul/oh/pi/ulohpi0sz8mtyz5g018fxactms8.jpeg"><br>  No caso do PTRACK, obtemos altera√ß√µes no arquivo delta, a partir do delta anterior recebido.  N√£o temos o tempo delta exato antes do in√≠cio do backup, antes do in√≠cio das altera√ß√µes.  Este n√£o √© o principal problema do PTRACK, em geral, ele funciona bem, mas at√© agora √© dif√≠cil de aceitar. <br><br><img src="https://habrastorage.org/webt/9-/qv/ou/9-qvouutaphuo35-ag0q_w1nnww.jpeg"><br>  O PTRACK n√£o permite a remo√ß√£o delta no modo LATEST_FULL, porque armazena um mapa de blocos alterados da remo√ß√£o anterior deste mapa.  A Oracle tem uma tecnologia interessante, existem 8 cart√µes anteriores que eles salvam por precau√ß√£o.  Talvez possamos fazer algo semelhante, mas at√© agora n√£o estamos trabalhando nessa dire√ß√£o. <br><br><img src="https://habrastorage.org/webt/bx/do/z-/bxdoz-i2yzsnya6y6kzqbc30e3y.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  Em setembro passado, tentei oferecer √† comunidade uma tecnologia baseada no fato de que apenas adicionamos os ganchos necess√°rios ao kernel e implementamos o rastreamento de p√°ginas alteradas na extens√£o para que o patch de rastreamento de p√°ginas n√£o seja muito invasivo.  Depois de discutir essa tecnologia, chegamos √† conclus√£o de que precisamos de v√°rios prot√≥tipos e adicionaremos ganchos quando houver prot√≥tipos.  Talvez veremos como eles funcionam.  Atualmente, estou trabalhando em prot√≥tipos dessas extens√µes que poderiam usar ganchos do kernel para rastrear altera√ß√µes no banco de dados. <br><br>  H√° uma express√£o na comunidade de que todo postgresista deve ter sua pr√≥pria ferramenta de backup.  Isso √© ruim.  Todo mundo faz suas pr√≥prias coisas, o que faz uma tarefa cr√≠tica.  Deve haver uma coisa em que tudo estar√° na caixa, tudo ser√° perfeito em um mundo ideal. <br><br>  O que eu gostaria de ver em uma caixa no basebackup?  Gostar√≠amos de ver, provavelmente, arquivando na nuvem.  E c√≥pias delta. <br><br><img src="https://habrastorage.org/webt/6w/ea/zh/6weazhzi3fkxbhvzz2tlrdj4ujg.jpeg"><br>  Eu tamb√©m gostaria de compacta√ß√£o, simultaneidade, criptografia, limita√ß√£o, listagem de backups, verifica√ß√£o, valida√ß√£o de backups ... Muitas coisas.  Entendemos que se tudo isso agora for oferecido √† comunidade, resultar√° em v√°rias dezenas de patches, que s√£o bastante dif√≠ceis de discutir e implementar por meio do commitfest.  Portanto, agora ainda estamos usando uma ferramenta separada, mas h√° um desejo de dedicar tempo e tecnologia √† comunidade para melhorar o PostgreSQL. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415817/">https://habr.com/ru/post/pt415817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415805/index.html">Modifica√ß√£o do m√≥dulo de barreira GSM Doorhan para controle da Internet</a></li>
<li><a href="../pt415809/index.html">Como usar soy, requirejs, backbone js em plugins para o Atlassian Jira</a></li>
<li><a href="../pt415811/index.html">AI, curso pr√°tico. Vis√£o geral de redes neurais para classifica√ß√£o de imagens</a></li>
<li><a href="../pt415813/index.html">Algumas notas sobre o estado atual do Cloud Gaming</a></li>
<li><a href="../pt415815/index.html">Na vanguarda da ci√™ncia: uma an√°lise dos artigos do arxiv.org</a></li>
<li><a href="../pt415819/index.html">Relat√≥rio do Clube de Roma de 2018, Cap√≠tulo 3.16: Governo Global</a></li>
<li><a href="../pt415821/index.html">A maneira de organizar uma casa "inteligente" com o controle el√©trico mais amplo poss√≠vel</a></li>
<li><a href="../pt415823/index.html">FindFace fecha para meros mortais</a></li>
<li><a href="../pt415829/index.html">Introdu√ß√£o √†s classes de dados</a></li>
<li><a href="../pt415831/index.html">Os Novos Dez Mandamentos de Roskosmos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>