<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÉ ‚≠êÔ∏è üòî Sch√©mas angulaires, ou comment j'ai √©crit mon mod√®le pour cli angulaire üõÉ üõê üåÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, je m'appelle Maxim. Depuis plusieurs ann√©es, je fais du d√©veloppement front-end. Je dois souvent g√©rer la mise en page de divers mod√®les html...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sch√©mas angulaires, ou comment j'ai √©crit mon mod√®le pour cli angulaire</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469509/"><p>  Bonjour, je m'appelle Maxim.  Depuis plusieurs ann√©es, je fais du d√©veloppement front-end.  Je dois souvent g√©rer la mise en page de divers mod√®les html.  Dans mon travail quotidien, j'utilise g√©n√©ralement le g√©n√©rateur de webpack avec un moteur de mod√®le de pug personnalis√©, et j'utilise √©galement la m√©thodologie BEM.  Afin de me faciliter la vie, j'utilise un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">merveilleux paquet</a> . </p><br><p>  R√©cemment, j'avais besoin de faire un petit projet sur Angular, et comme j'avais l'habitude de travailler avec mes outils pr√©f√©r√©s, je ne voulais pas revenir au html nu.  √Ä cet √©gard, le probl√®me s'est pos√© de savoir comment se faire des amis bempug avec un angulaire, et pas seulement se faire des amis, mais aussi g√©n√©rer des composants √† partir de cli avec la structure dont j'avais besoin. </p><br><p>  Peu importe comment j'ai fait tout cela, bienvenue au chat. </p><a name="habracut"></a><br><p>  Pour commencer, cr√©ez un projet de test sur lequel nous allons tester notre mod√®le. </p><br><p>  Nous ex√©cutons en ligne de commande: </p><br><p> <code>ng g test-project</code> . </p><br><p>  Dans les param√®tres, j'ai choisi le pr√©processeur scss, car il est plus pratique pour moi de travailler avec. </p><br><p>  Le projet a √©t√© cr√©√©, mais les mod√®les de composants par d√©faut dans notre html, le corrigent maintenant.  Tout d'abord, vous devez vous faire des amis cli angulaires avec le moteur de mod√®le de pug, pour cela j'ai utilis√© le paquet ng-cli-pug-loader </p><br><p>  Installez le package, pour cela, allez dans le dossier du projet et ex√©cutez: </p><br><p>  <code>ng add ng-cli-pug-loader</code> . </p><br><p>  Vous pouvez maintenant utiliser des fichiers de mod√®le de pug.  Ensuite, nous r√©√©crivons le d√©corateur racine du composant AppComponent pour: </p><br><pre> <code class="javascript hljs"> @Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-root'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'./app.component.pug'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./app.component.scss'</span></span>] })</code> </pre> <br><p>  Par cons√©quent, nous modifions l'extension de fichier app.component.html en app.component.pug et le contenu est √©crit dans la syntaxe du mod√®le.  Dans ce fichier, j'ai tout supprim√© sauf le routeur. </p><br><p>  Enfin, commen√ßons √† cr√©er notre g√©n√©rateur de composants! </p><br><p>  Pour g√©n√©rer des mod√®les, nous devons cr√©er notre propre sch√©ma.  J'utilise le paquet schematics-cli de @ angular-devkit.  Installez le package globalement avec la commande: </p><br><p>  <code>npm install -g @angular-devkit/schematics-cli</code> . </p><br><p>  J'ai cr√©√© le sch√©ma dans un r√©pertoire s√©par√© en dehors du projet avec la commande: </p><br><p>  <code>schematics blank --name=bempug-component</code> . </p><br><p>  Nous allons dans le sch√©ma cr√©√©, nous sommes maintenant int√©ress√©s par le fichier src / collection.json.  Cela ressemble √† ceci: </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"$schema"</span></span>: <span class="hljs-string"><span class="hljs-string">"../node_modules/@angular-devkit/schematics/collection-schema.json"</span></span>, <span class="hljs-string"><span class="hljs-string">"schematics"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"bempug-component"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A blank schematic."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"factory"</span></span>: <span class="hljs-string"><span class="hljs-string">"./bempug-component/index#bempugComponent"</span></span> } } }</code> </pre> <br><p>  Il s'agit d'un fichier de description de notre sch√©ma, o√π le param√®tre est "usine": "./bempug-component/index#bempugComponent": il s'agit de la description de la fonction principale de "l'usine" de notre g√©n√©rateur. </p><br><p>  Au d√©part, cela ressemble √† ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Rule, SchematicContext, Tree } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular-devkit/schematics'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// You don't have to export the function as default. You can also have more than one rule factory // per file. export function bempugComponent(options: any): Rule { return (tree: Tree, _context: SchematicContext) =&gt; { return tree; }; }</span></span></code> </pre> <br><p>  Vous pouvez faire l'exportation de la fonction par d√©faut, puis le param√®tre "usine" peut √™tre r√©√©crit en "./bempug-component/index". </p><br><p>  Ensuite, dans le r√©pertoire de notre sch√©ma, cr√©ez le fichier schema.json, il d√©crira tous les param√®tres de notre sch√©ma. </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"$schema"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://json-schema.org/schema"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"SchemanticsForMenu"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bempug Schema"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$default"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$source"</span></span>: <span class="hljs-string"><span class="hljs-string">"argv"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"index"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"path"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The path to create the component."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"visible"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"project"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The name of the project."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$default"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$source"</span></span>: <span class="hljs-string"><span class="hljs-string">"projectName"</span></span> } } } }</code> </pre> <br><p>  Les param√®tres sont dans les propri√©t√©s, √† savoir: </p><br><ul><li>  nom nom de l'entit√© (dans notre cas ce sera un composant); </li><li>  Chemin est le chemin par lequel le g√©n√©rateur va cr√©er les fichiers de composants; </li><li>  Projet est le projet lui-m√™me, dans lequel le composant sera g√©n√©r√©; </li></ul><br><p>  Ajoutez quelques param√®tres suppl√©mentaires au fichier qui seront n√©cessaires √† l'avenir. </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"module"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The declaring module."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">"m"</span></span> }, <span class="hljs-string"><span class="hljs-string">"componentModule"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Patern module per Component"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">"mc"</span></span> }, <span class="hljs-string"><span class="hljs-string">"export"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Export component from module?"</span></span> }</code> </pre> <br><ul><li>  module ici sera stock√© un lien vers le module dans lequel le composant sera inclus, ou plut√¥t le module composant; </li><li>  componentModule il y a un drapeau indiquant s'il faut cr√©er pour le composant son propre module (alors je suis arriv√© √† la conclusion qu'il sera toujours cr√©√© et d√©fini sur true); </li><li>  export: c'est le drapeau pour exporter √† partir du module dans lequel nous importons notre module composant; </li></ul><br><p>  Ensuite, cr√©ez une interface avec les param√®tres de notre fichier de composants schema.d.ts. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface BemPugOptions { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: string; project?: string; path?: string; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>?: string; componentModule?: boolean; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>?: string; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span>?: boolean; bemPugMixinPath?: string; }</code> </pre> <br><p>  Dans ce document, les propri√©t√©s dupliquent les propri√©t√©s de schema.json.  Ensuite, pr√©parez notre usine, acc√©dez au fichier index.ts.  Dans ce document, nous cr√©ons deux fonctions filterTemplates, qui seront responsables de la cr√©ation d'un module pour un composant en fonction de la valeur de componentModule, et setupOptions, qui d√©finit les param√®tres n√©cessaires pour l'usine. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterTemplates</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options: BemPugOptions</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rule</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options.componentModule) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function"> =&gt;</span></span> !path.match(<span class="hljs-regexp"><span class="hljs-regexp">/\.module\.ts$/</span></span>) &amp;&amp; !path.match(<span class="hljs-regexp"><span class="hljs-regexp">/-item\.ts$/</span></span>) &amp;&amp; !path.match(<span class="hljs-regexp"><span class="hljs-regexp">/\.bak$/</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function"> =&gt;</span></span> !path.match(<span class="hljs-regexp"><span class="hljs-regexp">/\.bak$/</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options: BemPugOptions, host: Tree</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workspace = getWorkspace(host); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!options.project) { options.project = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(workspace.projects)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> project = workspace.projects[options.project]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (options.path === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> projectDirName = project.projectType === <span class="hljs-string"><span class="hljs-string">'application'</span></span> ? <span class="hljs-string"><span class="hljs-string">'app'</span></span> : <span class="hljs-string"><span class="hljs-string">'lib'</span></span>; options.path = <span class="hljs-string"><span class="hljs-string">`/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${project.root}</span></span></span><span class="hljs-string">/src/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${projectDirName}</span></span></span><span class="hljs-string">`</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parsedPath = parseName(options.path, options.name); options.name = parsedPath.name; options.path = parsedPath.path; }</code> </pre><br><p>  Ensuite, nous √©crivons dans la fonction principale: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bempugComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options: BemPugOptions</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rule</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">host: Tree, context: SchematicContext</span></span></span><span class="hljs-function">) =&gt;</span></span> { setupOptions(options, host); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templateSource = apply(url(<span class="hljs-string"><span class="hljs-string">'./files'</span></span>), [ filterTemplates(options), template({ ...strings, ...options }), move(options.path || <span class="hljs-string"><span class="hljs-string">''</span></span>) ]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rule = chain([ branchAndMerge(chain([ mergeWith(templateSource), ])) ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rule(host, context); } }</code> </pre><br><p>  L'usine est pr√™te et elle peut d√©j√† g√©n√©rer des fichiers de composants en traitant des mod√®les √† partir du dossier de fichiers, qui n'est pas encore disponible.  Cela n'a pas d'importance, nous cr√©ons un dossier de fichiers de composants bempug dans notre dossier de sch√©ma dans mon cas.  Dans le dossier des fichiers, cr√©ez le dossier <code>__name@dasherize__</code> , lors de la g√©n√©ration, l'usine remplacera <code>__name@dasherize__</code> par le nom du composant. </p><br><p>  Ensuite, dans le <code>__name@dasherize__</code> cr√©ez des fichiers </p><br><ul><li>  <code>__name@dasherize__</code> .component.pug pug component template </li><li>  <code>__name@dasherize__</code> .component.spec.ts fichier de test unitaire pour le composant </li><li>  <code>__name@dasherize__</code> .component.ts fichier du composant lui-m√™me </li><li>  <code>__name@dasherize__</code> -component.module.ts module module </li><li>  <code>__name@dasherize__</code> -component.scss feuille de style des composants </li></ul><br><p>  Nous allons maintenant ajouter la prise en charge de la mise √† jour des modules √† notre usine, pour cela, nous allons cr√©er le fichier add-to-module-context.ts pour stocker les param√®tres dont l'usine aura besoin pour travailler avec le module. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'typescript'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddToModuleContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// source of the module file source: ts.SourceFile; // the relative path that points from // the module file to the component file relativePath: string; // name of the component class classifiedName: string; }</span></span></code> </pre> <br><p>  Ajoutez le support du module √† l'usine. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stringUtils = { dasherize, classify }; <span class="hljs-comment"><span class="hljs-comment">// You don't have to export the function as default. You can also have more than one rule factory // per file. function filterTemplates(options: BemPugOptions): Rule { if (!options.componentModule) { return filter(path =&gt; !path.match(/\.module\.ts$/) &amp;&amp; !path.match(/-item\.ts$/) &amp;&amp; !path.match(/\.bak$/)); } return filter(path =&gt; !path.match(/\.bak$/)); } function setupOptions(options: BemPugOptions, host: Tree): void { const workspace = getWorkspace(host); if (!options.project) { options.project = Object.keys(workspace.projects)[0]; } const project = workspace.projects[options.project]; if (options.path === undefined) { const projectDirName = project.projectType === 'application' ? 'app' : 'lib'; options.path = `/${project.root}/src/${projectDirName}`; } const parsedPath = parseName(options.path, options.name); options.name = parsedPath.name; options.path = parsedPath.path; options.module = options.module || findModuleFromOptions(host, options) || ''; } export function createAddToModuleContext(host: Tree, options: ModuleOptions, componentPath: string): AddToModuleContext { const result = new AddToModuleContext(); if (!options.module) { throw new SchematicsException(`Module not found.`); } // Reading the module file const text = host.read(options.module); if (text === null) { throw new SchematicsException(`File ${options.module} does not exist.`); } const sourceText = text.toString('utf-8'); result.source = ts.createSourceFile(options.module, sourceText, ts.ScriptTarget.Latest, true); result.relativePath = buildRelativePath(options.module, componentPath); result.classifiedName = stringUtils.classify(`${options.name}ComponentModule`); return result; } function addDeclaration(host: Tree, options: ModuleOptions, componentPath: string) { const context = createAddToModuleContext(host, options, componentPath); const modulePath = options.module || ''; const declarationChanges = addImportToModule( context.source, modulePath, context.classifiedName, context.relativePath); const declarationRecorder = host.beginUpdate(modulePath); for (const change of declarationChanges) { if (change instanceof InsertChange) { declarationRecorder.insertLeft(change.pos, change.toAdd); } } host.commitUpdate(declarationRecorder); }; function addExport(host: Tree, options: ModuleOptions, componentPath: string) { const context = createAddToModuleContext(host, options, componentPath); const modulePath = options.module || ''; const exportChanges = addExportToModule( context.source, modulePath, context.classifiedName, context.relativePath); const exportRecorder = host.beginUpdate(modulePath); for (const change of exportChanges) { if (change instanceof InsertChange) { exportRecorder.insertLeft(change.pos, change.toAdd); } } host.commitUpdate(exportRecorder); }; export function addDeclarationToNgModule(options: ModuleOptions, exports: boolean, componentPath: string): Rule { return (host: Tree) =&gt; { addDeclaration(host, options, componentPath); if (exports) { addExport(host, options, componentPath); } return host; }; } export function bempugComponent(options: BemPugOptions): Rule { return (host: Tree, context: SchematicContext) =&gt; { setupOptions(options, host); deleteCommon(host); const templateSource = apply(url('./files'), [ filterTemplates(options), template({ ...strings, ...options }), move(options.path || '') ]); const rule = chain([ branchAndMerge(chain([ mergeWith(templateSource), addDeclarationToNgModule(options, !!options.export, `${options.path}/${options.name}/${options.name}-component.module` || '') ])) ]); return rule(host, context); } }</span></span></code> </pre><br><p>  D√©sormais, lors de l'ajout du param√®tre -m &lt;r√©f√©rence de module&gt; √† la commande cli, notre module de composant ajoutera une importation au module sp√©cifi√© et en ajoutera l'exportation lors de l'ajout de l'indicateur ‚Äìexport.  Ensuite, nous ajoutons le support BEM.  Pour ce faire, j'ai pris les sources du package npm bempug et cr√©√© le code dans un fichier bempugMixin.pug, que j'ai plac√© dans le dossier commun et √† l'int√©rieur dans un autre dossier commun afin que le mixin soit copi√© dans le dossier commun du projet sur l'angulaire. </p><br><p>  Notre t√¢che est que ce mixage soit connect√© dans chacun de nos fichiers mod√®les, et non dupliqu√© lors de la g√©n√©ration de nouveaux composants, pour cela nous ajoutons cette fonctionnalit√© √† notre usine. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Rule, SchematicContext, Tree, filter, apply, template, move, chain, branchAndMerge, mergeWith, url, SchematicsException } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular-devkit/schematics'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {BemPugOptions} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./schema"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {getWorkspace} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@schematics/angular/utility/config"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {parseName} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@schematics/angular/utility/parse-name"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {normalize, strings} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@angular-devkit/core"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AddToModuleContext } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./add-to-module-context'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'typescript'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {classify, dasherize} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@angular-devkit/core/src/utils/strings"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {buildRelativePath, findModuleFromOptions, ModuleOptions} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@schematics/angular/utility/find-module"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {addExportToModule, addImportToModule} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@schematics/angular/utility/ast-utils"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {InsertChange} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@schematics/angular/utility/change"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stringUtils = { dasherize, classify }; <span class="hljs-comment"><span class="hljs-comment">// You don't have to export the function as default. You can also have more than one rule factory // per file. function filterTemplates(options: BemPugOptions): Rule { if (!options.componentModule) { return filter(path =&gt; !path.match(/\.module\.ts$/) &amp;&amp; !path.match(/-item\.ts$/) &amp;&amp; !path.match(/\.bak$/)); } return filter(path =&gt; !path.match(/\.bak$/)); } function setupOptions(options: BemPugOptions, host: Tree): void { const workspace = getWorkspace(host); if (!options.project) { options.project = Object.keys(workspace.projects)[0]; } const project = workspace.projects[options.project]; if (options.path === undefined) { const projectDirName = project.projectType === 'application' ? 'app' : 'lib'; options.path = `/${project.root}/src/${projectDirName}`; } const parsedPath = parseName(options.path, options.name); options.name = parsedPath.name; options.path = parsedPath.path; options.module = options.module || findModuleFromOptions(host, options) || ''; options.bemPugMixinPath = buildRelativePath(`${options.path}/${options.name}/${options.name}.component.ts`, `/src/app/common/bempugMixin.pug`); } export function createAddToModuleContext(host: Tree, options: ModuleOptions, componentPath: string): AddToModuleContext { const result = new AddToModuleContext(); if (!options.module) { throw new SchematicsException(`Module not found.`); } // Reading the module file const text = host.read(options.module); if (text === null) { throw new SchematicsException(`File ${options.module} does not exist.`); } const sourceText = text.toString('utf-8'); result.source = ts.createSourceFile(options.module, sourceText, ts.ScriptTarget.Latest, true); result.relativePath = buildRelativePath(options.module, componentPath); result.classifiedName = stringUtils.classify(`${options.name}ComponentModule`); return result; } function addDeclaration(host: Tree, options: ModuleOptions, componentPath: string) { const context = createAddToModuleContext(host, options, componentPath); const modulePath = options.module || ''; const declarationChanges = addImportToModule( context.source, modulePath, context.classifiedName, context.relativePath); const declarationRecorder = host.beginUpdate(modulePath); for (const change of declarationChanges) { if (change instanceof InsertChange) { declarationRecorder.insertLeft(change.pos, change.toAdd); } } host.commitUpdate(declarationRecorder); }; function addExport(host: Tree, options: ModuleOptions, componentPath: string) { const context = createAddToModuleContext(host, options, componentPath); const modulePath = options.module || ''; const exportChanges = addExportToModule( context.source, modulePath, context.classifiedName, context.relativePath); const exportRecorder = host.beginUpdate(modulePath); for (const change of exportChanges) { if (change instanceof InsertChange) { exportRecorder.insertLeft(change.pos, change.toAdd); } } host.commitUpdate(exportRecorder); }; export function addDeclarationToNgModule(options: ModuleOptions, exports: boolean, componentPath: string): Rule { return (host: Tree) =&gt; { addDeclaration(host, options, componentPath); if (exports) { addExport(host, options, componentPath); } return host; }; } function deleteCommon(host: Tree) { const path = `/src/app/common/bempugMixin.pug`; if(host.exists(path)) { host.delete(`/src/app/common/bempugMixin.pug`); } } export function bempugComponent(options: BemPugOptions): Rule { return (host: Tree, context: SchematicContext) =&gt; { setupOptions(options, host); deleteCommon(host); const templateSource = apply(url('./files'), [ filterTemplates(options), template({ ...strings, ...options }), move(options.path || '') ]); const mixinSource = apply(url('./common'), [ template({ ...strings, ...options }), move('/src/app/' || '') ]); const rule = chain([ branchAndMerge(chain([ mergeWith(templateSource), mergeWith(mixinSource), addDeclarationToNgModule(options, !!options.export, `${options.path}/${options.name}/${options.name}-component.module` || '') ]), 14) ]); return rule(host, context); } }</span></span></code> </pre><br><p>  Il est temps de commencer √† remplir nos fichiers mod√®les. </p><br><p>  <code>__name@dasherize__.component.pug</code> : </p><br><pre> <code class="javascript hljs">include &lt;%= bemPugMixinPath %&gt; +b(<span class="hljs-string"><span class="hljs-string">'&lt;%= name %&gt;'</span></span>) +e(<span class="hljs-string"><span class="hljs-string">'item'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">m</span></span>:<span class="hljs-string"><span class="hljs-string">'test'</span></span>}) | <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag"> %&gt;</span></span></span><span class="xml"> works</span></span></code> </pre> <br><p>  Ce qui est sp√©cifi√© dans &lt;% =%&gt; lors de la g√©n√©ration sera remplac√© par le nom du composant. </p><br><p> <code>__name@dasherize__.component.spec.ts:</code> </p> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">async</span></span>, ComponentFixture, TestBed } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core/testing'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {NO_ERRORS_SCHEMA} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { &lt;%= classify(name) %&gt;ComponentModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./&lt;%= name %&gt;-component.module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { &lt;%= classify(name) %&gt;Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./&lt;%= name %&gt;.component'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'&lt;%= classify(name) %&gt;Component'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> component: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">classify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">) %&gt;</span></span></span><span class="xml">Component; let fixture: ComponentFixture</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;%= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">classify(name)</span></span></span></span><span class="xml"><span class="hljs-tag"> %&gt;</span></span></span><span class="xml">Component&gt;; beforeEach(async(() =&gt; { TestBed.configureTestingModule({ imports: [</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">classify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">) %&gt;</span></span></span><span class="xml">ComponentModule], declarations: [], schemas: [ NO_ERRORS_SCHEMA ] }) .compileComponents(); })); beforeEach(() =&gt; { fixture = TestBed.createComponent(</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">classify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">) %&gt;</span></span></span><span class="xml">Component); component = fixture.componentInstance; fixture.detectChanges(); }); it('should create', () =&gt; { expect(component).toBeTruthy(); }); });</span></span></code> </pre> <br><p>  Dans ce cas, &lt;% = classify (name)%&gt; est utilis√© pour convertir le nom en CamelCase. </p><br><p> <code>__name@dasherize__.component.ts:</code> </p> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Component, OnInit, ViewEncapsulation} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; @Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-&lt;%=dasherize(name)%&gt;-component'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;%=dasherize(name)%&gt;.component.pug'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./&lt;%=dasherize(name)%&gt;-component.scss'</span></span>], <span class="hljs-attr"><span class="hljs-attr">encapsulation</span></span>: ViewEncapsulation.None }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> &lt;%</span></span>= classify(name) %&gt;Component implements OnInit { <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() {} ngOnInit(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { } }</code> </pre><br><p> <code>__name@dasherize__-component.module.ts:</code> </p> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NgModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { CommonModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {&lt;%= classify(name) %&gt;Component} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./&lt;%= name %&gt;.component'</span></span>; @NgModule({ <span class="hljs-attr"><span class="hljs-attr">declarations</span></span>: [ <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">classify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">) %&gt;</span></span></span><span class="xml">Component, ], imports: [ CommonModule ], exports: [ </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">classify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">) %&gt;</span></span></span><span class="xml">Component, ] }) export class </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">classify</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">) %&gt;</span></span></span><span class="xml">ComponentModule { }</span></span></code> </pre> <br><p> <code>__name@dasherize__-component.scss:</code> </p> <br><pre> <code class="css hljs">.&lt;%= <span class="hljs-selector-tag"><span class="hljs-selector-tag">name</span></span> %&gt;{ }</code> </pre> <br><p>  Nous faisons la construction de notre sch√©ma avec la commande `` npm run build``. </p><br><p>  Tout est pr√™t pour g√©n√©rer des composants dans le projet! </p><br><p>  Pour v√©rifier, revenez √† notre projet Angular et cr√©ez un module. <br> <code>ng gm test-schema</code> <br>  Ensuite, nous faisons `` npm link &lt;chemin absolu vers le dossier du projet avec notre sch√©ma&gt; '', afin d'ajouter notre sch√©ma aux node_modules du projet. </p><br><p>  Et nous essayons le circuit avec la commande <code>ng g bempug-component:bempug-component test -m /src/app/test-schema/test-schema.module.ts ‚Äìexport</code> . <br>  Notre sch√©ma cr√©era un composant et l'ajoutera au module sp√©cifi√© avec l'exportation. <br>  Le sch√©ma est pr√™t, vous pouvez commencer √† faire l'application sur des technologies famili√®res. </p><br><p>  Vous pouvez voir la version finale <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , et le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">package est √©galement disponible en npm</a> . </p><br><p>  Lors de la cr√©ation du sch√©ma, j'ai utilis√© des articles sur ce sujet, j'exprime ma gratitude aux auteurs. </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://blog.angular.io/schematics-an-introduction-dc1dfbc2a2b2</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://medium.com/@tomastrajan/total-guide-to-custom-angular-schematics-5c50cf90cdb4</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://developer.okta.com/blog/2019/02/13/angular-schematics</a> ; </li></ul><br><p>  Merci pour votre attention, tous ceux qui ont lu jusqu'au bout, vous √™tes les meilleurs! <br>  Et un autre projet passionnant m'attend.  A tr√®s bient√¥t! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469509/">https://habr.com/ru/post/fr469509/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469497/index.html">Cr√©ez des niveaux 2D isom√©triques avec le syst√®me Tilemap</a></li>
<li><a href="../fr469499/index.html">Comment nous avons conquis Parallels avec Apple</a></li>
<li><a href="../fr469503/index.html">Cybers√©curit√©: nous prot√©geons les donn√©es des abonn√©s contre les fuites en 2019</a></li>
<li><a href="../fr469505/index.html">3 fa√ßons pratiques d'amener les entreprises sur les march√©s √©trangers: approches et techniques de vraies entreprises</a></li>
<li><a href="../fr469507/index.html">Troisi√®me vuln√©rabilit√© du client Steam Windows, mais pas 0day</a></li>
<li><a href="../fr469515/index.html">Pr√©paration de l'application pour Istio</a></li>
<li><a href="../fr469521/index.html">J'ai achet√© une moto pour rouler, pas pour tomber</a></li>
<li><a href="../fr469523/index.html">D√©pendance des performances du code sur le contexte de la d√©claration des variables en JavaScript</a></li>
<li><a href="../fr469525/index.html">Syst√®me de contr√¥le automatis√© pour une pelle mini√®re</a></li>
<li><a href="../fr469527/index.html">L'interphone est-il une oreille d'espion?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>