<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîâ üë©üèΩ‚Äçüåæ üèåÔ∏è JSON-RPC? Fa√ßa o REST complicado üéôÔ∏è üî¶ ü§πüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Estou certo de que o t√≠tulo causou uma rea√ß√£o saud√°vel - "Bem, come√ßou de novo ..." Mas deixe-me chamar sua aten√ß√£o por 5 a 10 minutos, e tentarei n√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JSON-RPC? Fa√ßa o REST complicado</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476576/"><p><img src="https://habrastorage.org/webt/q0/at/ek/q0atekvadeakqoxlbkht27oxt8c.jpeg"></p><br><p>  Estou certo de que o t√≠tulo causou uma rea√ß√£o saud√°vel - "Bem, come√ßou de novo ..." Mas deixe-me chamar sua aten√ß√£o por 5 a 10 minutos, e tentarei n√£o enganar as expectativas. </p><br><p> A estrutura do artigo ser√° a seguinte: uma declara√ß√£o estereotipada √© tomada e a ‚Äúnatureza‚Äù do surgimento desse estere√≥tipo √© revelada.  Espero que isso permita que voc√™ analise a escolha do paradigma de troca de dados em seus projetos sob um novo √¢ngulo. </p><br><p>  Para deixar claro o que √© RPC, proponho considerar o padr√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JSON-RPC 2.0</a> .  N√£o h√° clareza com o REST.  E n√£o deveria ser.  Tudo o que voc√™ precisa saber sobre o REST - √© indistingu√≠vel do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HTTP</a> . </p><a name="habracut"></a><br><h2 id="rpc-zaprosy-bystree-i-effektivnee-potomu-chto-pozvolyayut-delat-batch-zaprosy">  As solicita√ß√µes de RPC s√£o mais r√°pidas e eficientes porque permitem solicita√ß√µes em lote. </h2><br><p>  O ponto √© que, no RPC, √© poss√≠vel fazer uma chamada para v√°rios procedimentos em uma solicita√ß√£o.  Por exemplo, crie um usu√°rio, adicione um avatar a ele e, na mesma solicita√ß√£o, assine-o sobre alguns t√≥picos.  Apenas um pedido e quanto bom! </p><br><p>  De fato, se voc√™ tiver apenas um n√≥ de back-end, isso parecer√° mais r√°pido com uma solicita√ß√£o em lote.  Como tr√™s solicita√ß√µes REST exigir√£o tr√™s vezes mais recursos de um n√≥ para estabelecer conex√µes. </p><br><p><img src="https://habrastorage.org/webt/wd/o9/yy/wdo9yyuiainix3lto2vtfwl4jtu.jpeg"></p><br><p>  Observe que a primeira solicita√ß√£o no caso de REST deve retornar o ID do usu√°rio para solicita√ß√µes subsequentes.  O que tamb√©m afeta negativamente o resultado geral. </p><br><p>  Mas essas infra-estruturas podem ser encontradas, talvez, em solu√ß√µes internas e no Enterprise.  Como √∫ltimo recurso, em pequenos projetos WEB.  Por√©m, as solu√ß√µes WEB completas, e tamb√©m chamadas HighLoad, n√£o devem ser constru√≠das assim.  Sua infraestrutura deve atender aos crit√©rios de alta disponibilidade e carga de trabalho.  E a imagem est√° mudando. </p><br><p><img src="https://habrastorage.org/webt/q5/x_/js/q5x_js3bh9se9vzjejgpyqfeexq.jpeg"></p><br><p>  Verde indica os canais de atividade da infraestrutura no mesmo cen√°rio.  Observe como o RPC se comporta agora.  A solicita√ß√£o usa a infraestrutura apenas um ombro do balanceador para o back-end.  Enquanto o REST ainda perde na primeira solicita√ß√£o, compensa o tempo perdido usando toda a infraestrutura. </p><br><p>  Basta digitar no script n√£o dois pedidos de enriquecimento, mas, digamos, cinco ou dez ... e a resposta √† pergunta "quem vence agora?" Torna-se √≥bvia. </p><br><p>  Proponho olhar ainda mais amplo para o problema.  O diagrama mostra como os canais de infraestrutura s√£o usados, mas a infraestrutura n√£o se limita aos canais.  Um componente importante de uma infraestrutura muito carregada s√£o caches.  Vamos pegar algum artefato do usu√°rio agora.  V√°rias vezes.  Diga 32 vezes. </p><br><p><img src="https://habrastorage.org/webt/vp/ts/es/vptseszry2ujpaxxlorxj5dk3gu.jpeg"></p><br><p>  Veja como a infraestrutura no RPC se "visivelmente recuperou" para atender √†s demandas de alta carga.  O fato √© que o REST usa toda a pot√™ncia do protocolo HTTP, ao contr√°rio do RPC.  No diagrama acima, esse poder √© realizado atrav√©s do m√©todo de solicita√ß√£o - GET. </p><br><p>  Os m√©todos HTTP, entre outras coisas, t√™m estrat√©gias de cache.  Voc√™ pode conhec√™-los na documenta√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HTTP</a> .  Para o RPC, as solicita√ß√µes POST que n√£o s√£o consideradas idempotentes s√£o usadas, ou seja, a repeti√ß√£o repetida das mesmas solicita√ß√µes POST pode retornar resultados diferentes (por exemplo, ap√≥s o envio de cada coment√°rio, outra c√≥pia desse coment√°rio ser√° exibida) ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fonte</a> ). </p><br><p>  Conseq√ºentemente, as RPCs n√£o podem usar com efici√™ncia os caches de infraestrutura.  Isso leva ao fato de que voc√™ precisa "importar" caches de software.  O diagrama mostra Redis nesta fun√ß√£o.  O cache flex√≠vel, por sua vez, requer que o desenvolvedor tenha uma camada de c√≥digo adicional e altera√ß√µes significativas na arquitetura. </p><br><p>  Vamos agora calcular quantas solicita√ß√µes "deram √† luz" REST e RPC na infraestrutura em considera√ß√£o? </p><br><div class="scrollable-table"><table><thead><tr><th>  Inqu√©ritos </th><th>  Caixa de entrada </th><th>  backend </th><th>  para DBMS </th><th>  para cache suave (Redis) </th><th>  TOTAL </th></tr></thead><tbody><tr><td>  REST </td><td>  1/32 * </td><td>  1 </td><td>  1 </td><td>  0 0 </td><td>  3/35 </td></tr><tr><td>  Rpc </td><td>  32. </td><td>  32. </td><td>  1 </td><td>  31 </td><td>  96 </td></tr></tbody></table></div><br><p>  [*] no melhor caso (se o cache local for usado) 1 solicita√ß√£o (uma!), nas piores 32 solicita√ß√µes recebidas. </p><br><p>  Em compara√ß√£o com o primeiro esquema, a diferen√ßa √© impressionante.  A vit√≥ria no REST agora √© aparente.  Mas eu proponho n√£o parar por a√≠.  A infraestrutura desenvolvida inclui CDN.  Freq√ºentemente, ele tamb√©m resolve o problema de combater ataques DDoS e DoS.  Temos: </p><br><p><img src="https://habrastorage.org/webt/k2/9f/ky/k29fkywcpnld_poisd1s7g9oxhs.jpeg"></p><br><p>  Aqui para RPC, tudo se torna muito deplor√°vel.  O RPC simplesmente n√£o pode delegar trabalho com o carregamento da CDN.  S√≥ se pode confiar em sistemas para combater ataques. </p><br><p>  √â poss√≠vel acabar com isso?  E novamente, n√£o.  Os m√©todos HTTP, como mencionado acima, t√™m sua pr√≥pria "m√°gica".  E por boas raz√µes, o m√©todo GET √© totalmente usado na Internet.  Observe que esse m√©todo √© capaz de acessar parte do conte√∫do, √© capaz de definir condi√ß√µes que podem interpretar os elementos da infraestrutura antes de transferir o controle para o seu c√≥digo etc.  Tudo isso permite criar infraestruturas flex√≠veis e gerenci√°veis ‚Äã‚Äãque podem digerir fluxos de solicita√ß√µes realmente grandes.  E no RPC, esse m√©todo ... √© ignorado. </p><br><p>  Ent√£o, por que o mito √© t√£o persistente que as solicita√ß√µes em lote (RPC) s√£o mais r√°pidas?  Pessoalmente, parece-me que a maioria dos projetos simplesmente n√£o atinge esse n√≠vel de desenvolvimento quando o REST √© capaz de mostrar sua for√ßa.  Al√©m disso, em pequenos projetos, √© mais prov√°vel que ele mostre sua fraqueza. </p><br><p>  A escolha de REST ou RPC n√£o √© uma escolha volunt√°ria de um indiv√≠duo no projeto.  Essa escolha deve atender aos requisitos do projeto.  Se o projeto puder extrair do REST tudo o que ele realmente puder e for realmente necess√°rio, o REST ser√° uma excelente op√ß√£o. </p><br><p>  Mas se, para obter todos os lucros do REST, voc√™ precisar√° contratar devops para dimensionar rapidamente a infraestrutura, administradores para gerenciar a infraestrutura, um arquiteto para projetar todas as camadas do servi√ßo WEB ... e o projeto vender√° tr√™s pacotes de margarina por dia ... iria parar no RPC desde  esse protocolo √© mais utilit√°rio.  Ele n√£o exige um conhecimento profundo da opera√ß√£o de caches e infraestrutura, mas concentra o desenvolvedor em chamadas simples e compreens√≠veis para os procedimentos necess√°rios.  O neg√≥cio ficar√° satisfeito. </p><br><h2 id="rpc-zaprosy-nadezhnee-potomu-chto-mogut-vypolnyat-batch-zaprosy-v-ramkah-odnoy-tranzakcii">  Solicita√ß√µes de RPC s√£o mais confi√°veis ‚Äã‚Äãporque podem executar solicita√ß√µes em lote em uma √∫nica transa√ß√£o </h2><br><p>  Essa propriedade do RPC √© uma vantagem definitiva, pois  f√°cil manter o banco de dados em um estado consistente.  Mas com o REST, tudo √© mais complicado.  As solicita√ß√µes podem chegar inconsistentemente em diferentes n√≥s de back-end. </p><br><p>  Essa ‚Äúdesvantagem‚Äù do REST √© o outro lado das vantagens descritas acima - a capacidade de usar efetivamente todos os recursos de infraestrutura.  Se a infra-estrutura √© mal projetada, e ainda mais se a arquitetura do projeto e o banco de dados em particular s√£o mal projetados, isso √© realmente um grande problema. </p><br><p>  Mas as solicita√ß√µes em lote s√£o t√£o confi√°veis ‚Äã‚Äãquanto parecem?  Vejamos o caso: crie um usu√°rio, enrique√ßa seu perfil com alguma descri√ß√£o e envie a ele um SMS com um segredo para concluir o registro.  I.e.  tr√™s chamadas em uma solicita√ß√£o em lote. </p><br><p><img src="https://habrastorage.org/webt/i5/ry/4k/i5ry4k9evunfpvdeowewzqkpmkm.jpeg"></p><br><p>  Vamos considerar o esquema.  Apresenta a infraestrutura com elementos de alta disponibilidade.  Existem dois canais de comunica√ß√£o independentes com gateways SMS.  Mas ... o que vemos?  Ao enviar SMS, ocorre o erro 503 - o servi√ßo est√° temporariamente indispon√≠vel.  Porque  Se o envio do SMS for compactado em uma solicita√ß√£o em lote, a solicita√ß√£o inteira dever√° ser revertida.  A√ß√µes no DBMS s√£o canceladas.  O cliente recebe um erro. </p><br><p>  A pr√≥xima tentativa √© uma loteria.  A solicita√ß√£o vai para o mesmo n√≥ novamente e retorna um erro, ou voc√™ tem sorte e ela ser√° executada.  Mas o principal √© que pelo menos uma vez que nossa infraestrutura j√° funcionou em v√£o.  Houve uma carga, mas nenhum lucro. </p><br><p>  Bem, vamos imaginar que tensionamos (!) E pensamos na op√ß√£o em que a solicita√ß√£o poderia ser parcialmente conclu√≠da com √™xito.  E o restante, tentaremos cumprir novamente ap√≥s algum intervalo de tempo (Qual? Decide a frente?).  Mas a loteria permaneceu.  Uma solicita√ß√£o para enviar um SMS com uma probabilidade de 50/50 falhar√° novamente. </p><br><p>  Concordo que, do lado do cliente, o servi√ßo n√£o parece t√£o confi√°vel quanto gostar√≠amos ... mas e o REST? </p><br><p><img src="https://habrastorage.org/webt/yu/ol/yy/yuolyyficausbg8c3jgzmddc1kk.jpeg"></p><br><p>  O REST usa magia HTTP novamente, mas agora com c√≥digos de resposta.  Se ocorrer um erro 503 no gateway do SMS, o back-end transmitir√° esse erro ao balanceador.  O balanceador que recebe esse erro e sem interromper a conex√£o com o cliente envia a solicita√ß√£o para outro n√≥ que processa a solicita√ß√£o com √™xito.  I.e.  o cliente recebe o resultado esperado e a infraestrutura confirma sua alta classifica√ß√£o de "altamente acess√≠vel".  O usu√°rio est√° feliz. </p><br><p>  E, novamente, isso n√£o √© tudo.  O balanceador n√£o recebeu apenas o c√≥digo de resposta 503. √â aconselh√°vel fornecer esse c√≥digo com o cabe√ßalho "Repetir ap√≥s" ao responder. O cabe√ßalho deixa claro para o balanceador que voc√™ n√£o deve perturbar esse n√≥ nessa rota por um tempo especificado. E as seguintes solicita√ß√µes de envio de SMS ser√° enviado imediatamente para um n√≥ que n√£o apresenta problemas com o gateway do SMS. </p><br><p>  Como podemos ver, a confiabilidade do JSON-RPC √© superestimada.  De fato, √© mais f√°cil organizar a consist√™ncia do banco de dados.  Mas a v√≠tima, neste caso, ser√° a confiabilidade do sistema como um todo. </p><br><p>  A conclus√£o √© amplamente semelhante √† anterior.  Quando a infraestrutura √© simples, a obviedade do JSON-RPC √© sem d√∫vida a sua vantagem.  Se um projeto envolver alta disponibilidade com uma carga alta, o REST parecer√° uma solu√ß√£o mais precisa, embora mais complexa. </p><br><h2 id="porog-vhoda-v-rest-nizhe">  Limite de entrada REST abaixo </h2><br><p>  Penso que a an√°lise acima, desmistificando os estere√≥tipos estabelecidos sobre o RPC, mostrou claramente que o limiar para entrar no REST √© sem d√∫vida mais alto do que no RPC.  Isso se deve √† necessidade de um profundo entendimento do HTTP, bem como √† necessidade de ter conhecimento suficiente sobre os elementos de infraestrutura existentes que podem e devem ser usados ‚Äã‚Äãem projetos WEB. </p><br><p>  Ent√£o, por que muitas pessoas pensam que o REST ser√° mais f√°cil?  Minha opini√£o pessoal √© que essa aparente simplicidade vem do REST se manifesta.  I.e.  O REST n√£o √© um protocolo, mas um conceito ... O REST n√£o possui um padr√£o, existem algumas recomenda√ß√µes ... O REST n√£o √© mais complicado que o HTTP.  A aparente liberdade e anarquia atraem "artistas livres". </p><br><p>  Sem d√∫vida, o REST n√£o √© mais complicado que o HTTP.  Mas o pr√≥prio HTTP √© um protocolo bem projetado que foi provado por d√©cadas.  Se n√£o houver um entendimento profundo do pr√≥prio HTTP, o REST n√£o poder√° ser julgado. </p><br><p>  Mas sobre RPC - voc√™ pode.  √â o suficiente para atender a sua especifica√ß√£o.  Ent√£o, voc√™ precisa de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JSON-RPC idiota</a> ?  Ou √© REST astuto?  Depende de voc√™. </p><br><p>  Espero sinceramente que n√£o tenha perdido tempo em v√£o. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt476576/">https://habr.com/ru/post/pt476576/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt476554/index.html">Transmiss√£o WebRTC baseada em nuvem no DigitalOcean</a></li>
<li><a href="../pt476556/index.html">Narrativa e "masmorras": como um designer de jogos associar locais a um enredo</a></li>
<li><a href="../pt476558/index.html">Revis√£o do ONYX BOOX Max 3: leitor de tela m√°ximo</a></li>
<li><a href="../pt476566/index.html">Como entender se os ativos digitais s√£o valores mobili√°rios? Instru√ß√£o SEC</a></li>
<li><a href="../pt476570/index.html">Opini√£o privada sobre Yandex.Turbo</a></li>
<li><a href="../pt476578/index.html">9 principais benef√≠cios da tecnologia Blockchain no software esportivo</a></li>
<li><a href="../pt476580/index.html">Horizontal vs. crescimento vertical do desenvolvedor. Opini√µes de ivi e Yandex</a></li>
<li><a href="../pt476582/index.html">Contador DWT</a></li>
<li><a href="../pt476590/index.html">Como compactar o aplicativo VueJS + NodeJS + MongoDB no Docker</a></li>
<li><a href="../pt476592/index.html">CLRium # 6: faltam 9 dias</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>