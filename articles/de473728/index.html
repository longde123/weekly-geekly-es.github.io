<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç∑ ü§öüèø üöú Typische Implementierung der √úberwachung. Nikolay Sivko üëºüèΩ üòÑ üç™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entschl√ºsselung des Berichts ‚ÄûTypische Implementierung der √úberwachung‚Äú durch Nikolay Sivko. 


 Ich hei√üe Nikolai Sivko. Ich √ºberwache auch. Okmeter ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Typische Implementierung der √úberwachung. Nikolay Sivko</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473728/"><p>  Entschl√ºsselung des Berichts ‚ÄûTypische Implementierung der √úberwachung‚Äú durch Nikolay Sivko. </p><br><p>  Ich hei√üe Nikolai Sivko.  Ich √ºberwache auch.  Okmeter ist die 5 √úberwachung, die ich mache.  Ich habe beschlossen, alle Menschen vor der H√∂lle der √úberwachung zu retten und jemanden vor diesem Leiden zu retten.  Ich versuche immer, in meinen Pr√§sentationen kein Okmeter zu bewerben.  Nat√ºrlich werden die Bilder von dort sein.  Aber die Idee von dem, was ich sagen m√∂chte, ist, dass wir die √úberwachung zu einem etwas anderen Ansatz machen, als es normalerweise jeder tut.  Wir reden viel dar√ºber.  Wenn wir versuchen, jeden einzelnen Menschen davon zu √ºberzeugen, wird er am Ende √ºberzeugt.  Ich m√∂chte genau √ºber unseren Ansatz sprechen, damit Sie, wenn Sie die √úberwachung selbst durchf√ºhren, unseren Rechen vermeiden. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/btKYOueAAzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/za/jq/fi/zajqfi-zfkopot4qxgmw79zgnp8.png"></p><br><p>  √úber das Okmeter auf den Punkt gebracht.  Wir machen das Gleiche wie Sie, aber es gibt alle m√∂glichen Chips.  Chips: </p><br><ul><li>  Detaillierung; </li><li>  eine gro√üe Anzahl vorkonfigurierter Trigger, die auf den Problemen unserer Kunden basieren; </li><li>  Automatische Konfiguration </li></ul><br><p><img src="https://habrastorage.org/webt/nj/n0/vs/njn0vsnh6hfcyvjuejxy7qtopek.png"></p><br><p>  Ein typischer Kunde kommt zu uns.  Er hat zwei Aufgaben: </p><br><p>  1) zu verstehen, dass alles von der √úberwachung zusammengebrochen ist, wenn es √ºberhaupt nichts gibt. </p><br><p>  2) schnell beheben. </p><br><p>  Er kommt, um die Antworten zu √ºberwachen, was mit ihm passiert. </p><br><p><img src="https://habrastorage.org/webt/ig/ff/fl/igffflnnpqwybqqxxw1yd0nb9tw.png"></p><br><p>  Das erste, was Leute tun, die nichts haben, ist, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://www.pingdom.com/</a> und andere Dienste zur √úberpr√ºfung zu stellen.  Der Vorteil dieser L√∂sung ist, dass sie in 5 Minuten durchgef√ºhrt werden kann.  Durch Kundenanrufe erfahren Sie nichts mehr √ºber das Problem.  Es gibt Probleme mit der Genauigkeit, so dass sie Probleme √ºberspringen.  F√ºr einfache Websites reicht dies jedoch aus. </p><br><p><img src="https://habrastorage.org/webt/cz/hb/td/czhbtddbrnh7n0msqxzrqxn8_wq.png"></p><br><p>  Das zweite, was wir bef√ºrworten, ist, anhand der Statistiken der tats√§chlichen Benutzer anhand der Protokolle zu z√§hlen.  So oft erh√§lt ein bestimmter Benutzer 5xx Fehler.  Was ist die Antwortzeit von Benutzern.  Es gibt Nachteile, aber im Allgemeinen funktioniert so etwas. </p><br><p><img src="https://habrastorage.org/webt/4g/ka/bk/4gkabkle1j9w96av-pkspnlwtis.png"></p><br><p>  √úber nginx: Wir haben es so gemacht, dass jeder Client, der sofort kommt, den Agenten in das Frontend stellt und alles automatisch von ihm √ºbernommen wird. Es beginnt zu analysieren, Fehler treten auf und so weiter.  Er hat fast nichts zu konfigurieren. </p><br><p><img src="https://habrastorage.org/webt/cf/ef/5p/cfef5pftq8hwwmmb1zqfwiqyf7m.png"></p><br><p>  Die meisten Clients haben jedoch keine Timer in den Standard-Nginx-Protokollen.  Diese 90 Prozent der Kunden m√∂chten die Antwortzeit ihrer Website nicht wissen.  Wir sind die ganze Zeit damit konfrontiert.  Das Nginx-Protokoll muss erweitert werden.  Ab sofort werden automatisch Histogramme angezeigt.  Dies ist wahrscheinlich ein wichtiger Aspekt der Tatsache, dass die Zeit gemessen werden muss. </p><br><p><img src="https://habrastorage.org/webt/qv/yx/_x/qvyx_xrqm7dg8vqcxkonum__aws.png"></p><br><p>  Was ziehen wir da raus?  In der Praxis nehmen wir Metriken in solchen Dimensionen.  Dies sind keine flachen Metriken.  Die Metrik hei√üt index.request.rate - die Anzahl der Abfragen pro Sekunde.  Es wird detailliert von: </p><br><ul><li>  der Host, von dem Sie die Protokolle entfernt haben; </li><li>  das Protokoll, aus dem diese Daten entnommen wurden; </li><li>  http nach Methode; </li><li>  http Status; </li><li>  Cache-Status. </li></ul><br><p>  Dies ist NICHT jede spezifische URL mit allen Argumenten.  Wir m√∂chten nicht 100.000 Metriken aus dem Protokoll entfernen. </p><br><p><img src="https://habrastorage.org/webt/u6/ah/0r/u6ah0rgp43jp3mnzdrqjpet5sza.png"></p><br><p>  Wir wollen 1000 Metriken nehmen.  Daher versuchen wir, die URL nach M√∂glichkeit zu normalisieren.  Nimm die oberste URL.  Und f√ºr URLs, die aussagekr√§ftig sind, zeigen wir ein separates Balkendiagramm, separat 5xx. </p><br><p><img src="https://habrastorage.org/webt/ij/dr/ir/ijdrirnx6vwpo9jfteyepp3ax_e.png"></p><br><p>  Hier ist ein Beispiel, wie diese einfache Metrik zu verwendbaren Grafiken wird.  Dies ist unser DSL an der Spitze.  Ich habe dieses DSL versucht, um die ungef√§hre Logik zu erkl√§ren.  Wir haben alle Nginx-Anfragen pro Sekunde entgegengenommen und auf allen Maschinen, die wir haben, ausgelegt.  Ich habe Kenntnisse dar√ºber, wie wir es ausgleichen, wie viel RPS wir insgesamt haben (Anfrage pro Sekunde, Anfragen pro Sekunde). </p><br><p><img src="https://habrastorage.org/webt/mc/hv/sv/mchvsvendei8dswx2umciwkg8qu.png"></p><br><p>  Auf der anderen Seite k√∂nnen wir diese Metrik filtern und nur 4xx anzeigen.  Auf einem 4xx-Diagramm k√∂nnen sie entsprechend dem tats√§chlichen Status angeordnet werden.  Ich erinnere Sie daran, dass dies dieselbe Metrik ist. </p><br><p><img src="https://habrastorage.org/webt/uk/14/vc/uk14vcumvrmenkg4mubhonkv5gu.png"></p><br><p>  In der Grafik k√∂nnen Sie 4xx nach URL anzeigen.  Dies ist die gleiche Metrik. </p><br><p><img src="https://habrastorage.org/webt/1l/n4/g8/1ln4g8sgwvteebpsdsbg_xmtly8.png"></p><br><p>  Wir schie√üen auch ein Histogramm aus den Protokollen.  Ein Histogramm ist die Metrik response_time.histrogram, bei der es sich tats√§chlich um RPS mit einem zus√§tzlichen Ebenenparameter handelt.  Dies ist nur eine Unterbrechung der Zeit, in der die Anforderung einen Bucket erh√§lt. </p><br><p><img src="https://habrastorage.org/webt/cb/3b/nh/cb3bnh0wosk9il_ntyywe3z1kiq.png"></p><br><p>  Wir zeichnen eine Anfrage: Fassen Sie das gesamte Histogramm zusammen und sortieren Sie es in Ebenen: </p><br><ul><li>  Langsame Anfragen </li><li>  schnelle Anfragen; </li><li>  durchschnittliche Anfragen; </li></ul><br><p>  Wir haben ein Bild, das bereits von Servern zusammengefasst wurde.  Die Metrik ist dieselbe.  Ihre physikalische Bedeutung ist verst√§ndlich.  Aber wir nutzen es auf ganz andere Weise. </p><br><p><img src="https://habrastorage.org/webt/og/_q/0a/og_q0acmw4ianhc6n5sc3z4aokq.png"></p><br><p>  In der Tabelle k√∂nnen Sie das Histogramm nur anhand einer URL anzeigen, die mit "/ api" beginnt.  Daher betrachten wir das Histogramm separat.  Wir schauen uns an, wie viel in diesem Moment.  Wir sehen, wie viele RPS in der URL "/ api" enthalten waren.  Dieselbe Metrik, aber eine andere Anwendung. </p><br><p><img src="https://habrastorage.org/webt/lt/jw/46/ltjw46topobrcyeyyhkkigncknm.png"></p><br><p>  Ein paar Worte zu Timings in Nginx.  Es gibt request_time, die die Zeit vom Beginn der Anforderung bis zur √úbertragung des letzten Bytes an den Socket an den Client enth√§lt.  Und es gibt upstream_response_time.  Sie m√ºssen beide gemessen werden.  Wenn wir request_time einfach entfernen, werden dort Verz√∂gerungen aufgrund von Clientverbindungsproblemen mit Ihrem Server angezeigt. Dort werden Verz√∂gerungen angezeigt, wenn Limit Request C Burst konfiguriert ist und der Client im Bad ist.  Sie werden nicht verstehen, ob Sie den Server reparieren oder den Hoster anrufen m√ºssen.  Dementsprechend entfernen wir beide und es ist ungef√§hr klar, was passiert. </p><br><p><img src="https://habrastorage.org/webt/uy/xy/a9/uyxya9gyu-fr0ccab75sa7fjt3q.png"></p><br><p>  Mit der Aufgabe zu verstehen, ob die Website funktioniert oder nicht, glaube ich, dass wir mehr oder weniger verstanden haben.  Es gibt Fehler.  Es gibt Ungenauigkeiten.  Allgemeine Grunds√§tze sind wie folgt. </p><br><p>  Nun zur √úberwachung der mehrschichtigen Architektur.  Denn selbst der einfachste Online-Shop hat mindestens ein Frontend, gefolgt von einer Bitrix und einer Basis.  Dies sind bereits viele Links.  Der allgemeine Punkt ist, dass Sie einige Indikatoren aus jedem Level schie√üen m√ºssen.  Das hei√üt, der Benutzer denkt √ºber das Frontend nach.  Frontend denkt √ºber Backend nach.  Das Backend denkt an das benachbarte Backend.  Und alle denken an die Basis.  Also gehen wir nach Schichten, nach Abh√§ngigkeiten durch.  Wir decken alles mit einer Art Metrik ab.  Wir bekommen etwas am Ausgang. </p><br><p><img src="https://habrastorage.org/webt/nq/ov/rx/nqovrxw3la9pl8bkrufpklydrii.png"></p><br><p>  Warum nicht auf eine Schicht beschr√§nkt sein?  In der Regel befindet sich zwischen den Schichten ein Netzwerk.  Ein gro√ües Netzwerk unter Last ist eine √§u√üerst instabile Substanz.  Deshalb passiert dort alles.  Plus, die Messungen, die Sie machen, auf welcher Schicht liegen kann.  Wenn Sie Messungen auf Schicht ‚ÄûA‚Äú und Schicht ‚ÄûB‚Äú durchf√ºhren und diese √ºber das Netzwerk miteinander interagieren, k√∂nnen Sie ihre Messwerte vergleichen und einige Anomalien und Inkonsistenzen feststellen. </p><br><p><img src="https://habrastorage.org/webt/7a/kq/ov/7akqovksuz3bhdmaxez5vcibepk.png"></p><br><p>  √úber das Backend.  Wir m√∂chten verstehen, wie das Backend √ºberwacht wird.  Was tun, um schnell zu verstehen, was passiert?  Ich erinnere Sie daran, dass wir bereits die Aufgabe √ºbernommen haben, Ausfallzeiten zu minimieren.  Und was das Backend betrifft, empfehlen wir normalerweise Verst√§ndnis: </p><br><ul><li>  Wie viel frisst diese Ressource? </li><li>  Sind wir an eine Grenze gesto√üen? </li><li>  Was ist mit der Laufzeit los?  Zum Beispiel die JVM-Laufzeitplattform, die Golang-Laufzeit und andere Laufzeit. </li><li>  Wenn wir dies alles bereits behandelt haben, ist es f√ºr uns interessant, bereits n√§her an unserem Code zu sein.  Wir k√∂nnen entweder die automatische Intrumetrie (statsd, * -metric) verwenden, die uns dies alles zeigt.  Oder weisen Sie sich selbst an, indem Sie Timer, Z√§hler usw. einstellen. </li></ul><br><p><img src="https://habrastorage.org/webt/wk/xq/6p/wkxq6ptxbigdvp3evm4t2mqh3lq.png"></p><br><p>  √úber die Ressourcen.  Unser Standardagent entfernt den Ressourcenverbrauch aller Prozesse.  Daher m√ºssen wir f√ºr das Backend keine Daten separat erfassen.  Wir nehmen und sehen, wie viel die CPU den Prozess verbraucht, zum Beispiel Python auf den maskierten Servern.  Wir zeigen alle Server im Cluster in demselben Diagramm, weil wir verstehen m√∂chten, ob wir Ungleichgewichte haben und ob auf demselben Computer etwas explodiert ist.  Wir sehen den Gesamtverbrauch von gestern bis heute. </p><br><p><img src="https://habrastorage.org/webt/t0/fl/oe/t0floe26e2hgev70o5fs18yf4ua.png"></p><br><p>  Gleiches gilt f√ºr die Erinnerung.  Wenn wir es so zeichnen.  Wir w√§hlen Python RSS (RSS ist die Gr√∂√üe der Speicherseiten, die dem Prozess vom Betriebssystem zugewiesen wurden und sich derzeit im RAM befinden).  Summe nach Host.  Wir schauen nirgendwo hin, wo Erinnerungen flie√üen.  √úberall ist der Speicher gleichm√§√üig verteilt.  Grunds√§tzlich haben wir eine Antwort auf unsere Fragen erhalten. </p><br><p><img src="https://habrastorage.org/webt/zl/cu/yz/zlcuyz_bgzybypkgcndsotzdcsk.png"></p><br><p>  Laufzeitbeispiel.  Unser Agent ist in Golang geschrieben.  Der Golang-Agent sendet sich Metriken seiner Laufzeit.  Dies ist insbesondere die Anzahl der Sekunden, die der Golang-Garbage Collector pro Sekunde f√ºr die Garbage Collection ben√∂tigt.  Wir sehen hier, dass einige Server andere Metriken haben als andere Server.  Wir haben eine Anomalie gesehen.  Wir versuchen dies zu erkl√§ren. </p><br><p><img src="https://habrastorage.org/webt/oj/ir/pu/ojirpuokww_ym6e1hg1yrwz_8ao.png"></p><br><p>  Es gibt eine andere Laufzeitmetrik.  Wie viel Speicher wird pro Zeiteinheit zugewiesen?  Wir sehen, dass Agenten mit einem Typ, der oben steht, mehr Speicher zuweisen als Agenten, die niedriger sind.  Unten finden Sie Agenten mit einem weniger aggressiven Garbage Collector.  Das ist logisch.  Je mehr Speicher durch Sie geleitet und freigegeben wird, desto gr√∂√üer ist die Belastung des Garbage Collector.  Gem√§√ü unseren internen Metriken verstehen wir au√üerdem, warum wir auf diesen Computern so viel Speicher und auf diesen Computern weniger Speicher ben√∂tigen. </p><br><p><img src="https://habrastorage.org/webt/8h/4s/yq/8h4syq_g35fjhfdztsheuybzyrc.png"></p><br><p>  Wenn wir √ºber Instrumentierung sprechen, kommen alle Arten von Tools wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://pinba.org/</a> f√ºr PHP.  Pinba ist eine Erweiterung f√ºr PHP von Badoo, die Sie installieren und mit PHP verbinden.  Sie k√∂nnen Protobuf sofort √ºber UDP entfernen und senden.  Sie haben einen Pinba-Server.  Wir haben jedoch einen eingebetteten Pinba-Server im Agenten erstellt.  PHP sendet sich selbst, wie viel CPU und Speicher f√ºr solche Skripte ausgegeben wurden, wie viel Verkehr von solchen Skripten bereitgestellt wird und so weiter.  Hier ist ein Beispiel mit Pinba.  Wir zeigen die Top 5 Skripte zum CPU-Verbrauch.  Wir sehen einen violetten Ausrei√üer, der ein verschmierter Punkt von PHP ist.  Wir werden den verschmierten Punkt von PHP reparieren oder verstehen, warum es die CPU auffrisst.  Wir haben den Umfang des Problems bereits eingegrenzt, damit wir die folgenden Schritte verstehen.  Wir schauen uns den Code an und reparieren ihn. </p><br><p><img src="https://habrastorage.org/webt/kx/el/vv/kxelvvi9xxzv4bfefhf4m0xbhay.png"></p><br><p>  Gleiches gilt f√ºr den Verkehr.  Wir schauen uns die Top 5 Verkehrsskripte an.  Wenn uns das wichtig ist, dann gehen wir und verstehen. </p><br><p><img src="https://habrastorage.org/webt/nz/io/zs/nziozsp_7pzn3ej88j8t3bdpenk.png"></p><br><p>  Dies ist eine Tabelle √ºber unsere internen Tools.  Wenn wir den Timer durch statsd stellen und die Metriken messen.  Wir haben es so gestaltet, dass die Gesamtzeit, die in der CPU oder in Erwartung einer Ressource verbracht wird, entsprechend dem Handler, den wir gerade verarbeiten, und gem√§√ü den wichtigen Phasen Ihres Codes festgelegt wird: Sie haben auf den Kassander gewartet, auf die Elasticsearch gewartet.  Das Diagramm zeigt die f√ºnf wichtigsten Stufen f√ºr den Handler / metric / query.  In der Grafik k√∂nnen Sie die Top 5 Handler f√ºr den CPU-Verbrauch anzeigen, also was im Inneren passiert.  Es ist klar, was zu beheben ist. </p><br><p>  √úber das Backend k√∂nnen Sie tiefer gehen.  Es gibt Dinge, die nachverfolgen.  Das hei√üt, Sie k√∂nnen diese bestimmte Benutzeranforderung mit einem solchen oder einem solchen Cookie sehen, und IP hat so viele Anforderungen an die Datenbank generiert, dass sie so lange gewartet haben.  Wir k√∂nnen nicht zur√ºckverfolgen.  Wir verfolgen nicht.  Wir k√∂nnen immer noch glauben, dass wir keine Anwendungen und Leistungs√ºberwachung durchf√ºhren. </p><br><p><img src="https://habrastorage.org/webt/pr/zy/yf/przyyfqriaulwy_fe4swdvq2bco.png"></p><br><p>  √úber die Datenbank.  Das selbe.  Datenbanken sind der gleiche Prozess.  Er verbraucht Ressourcen.  Wenn die Basis sehr latenzempfindlich ist, gibt es leicht unterschiedliche Funktionen.  Wir empfehlen zu √ºberpr√ºfen, ob nicht weniger Ressourcen und keine Verschlechterung der Ressourcen vorhanden sind.  Es ist ideal zu verstehen, dass Sie verstehen, was sich genau in Ihrem Code ge√§ndert hat, wenn die Basis mehr zu verbrauchen begann als verbraucht. </p><br><p><img src="https://habrastorage.org/webt/az/zc/lj/azzcljm0hkvcfxc1lgeqeukrdgq.png"></p><br><p>  √úber die Ressourcen.  Auf die gleiche Weise untersuchen wir, wie viel der MySQL-Prozess auf unserer Festplatte generiert.  Wir sehen, dass es im Durchschnitt so viel gibt, aber einige Spitzen passieren.  Zum Beispiel kommt viel Insert herein und es beginnt um 15.15, 16.15, 17.15 Uhr mit dem Schreiben auf die Festplatte. </p><br><p><img src="https://habrastorage.org/webt/u8/vb/rc/u8vbrcgbovxfcalnkk7sph4rw2i.png"></p><br><p>  √úber die Verschlechterung der Ressourcen.  Beispielsweise wurde ein RAID-Akku in den Wartungsmodus versetzt.  Sie h√∂rte auf, ein Controller wie eine lebende Batterie zu sein.  Zu diesem Zeitpunkt wird der Schreibcache getrennt, und die Latenz der Schreibplatten nimmt zu.  Wenn zu diesem Zeitpunkt die Datenbank beim Warten auf eine Festplatte langweilig wird und Sie ungef√§hr wissen, dass Sie beim Schreiben auf eine Festplatte eine andere Latenz hatten, √ºberpr√ºfen Sie den Akku in RAID. </p><br><p><img src="https://habrastorage.org/webt/j_/ap/qb/j_apqbgrlnp5zkiopa794hq0v4y.png"></p><br><p>  Ressourcen auf Abruf.  Hier ist es nicht so einfach.  Kommt auf die Basis an.  Die Basis sollte in der Lage sein, √ºber sich selbst zu sagen: Welche Anforderungen werden an Ressourcen usw. gestellt?  Der Marktf√ºhrer dabei ist PostgreSQL.  Er hat pg_stat_statements.  Sie k√∂nnen verstehen, welche Art von Anforderung Sie mit viel CPU, Lese- und Schreibfestplatte und Datenverkehr haben. </p><br><p>  In MySQL ist ehrlich gesagt alles viel schlimmer.  Es hat Leistungsschema.  Es funktioniert irgendwie ab Version 5.7.  Im Gegensatz zu einer einzelnen Ansicht in PostgreSQL ist performance_schema eine 27- oder 23-Systemansichtstabelle in MySQL.  Wenn Sie Abfragen an den falschen Tabellen (in der falschen Ansicht) durchf√ºhren, k√∂nnen Sie manchmal MySQL verschwenden. </p><br><p>  Redis hat Teamstatistiken.  Sie sehen, dass ein bestimmter Befehl viel CPU usw. verbraucht. </p><br><p>  Cassandra hat Zeiten, um bestimmte Tabellen abzufragen.  Da die Cassandra jedoch so konzipiert ist, dass eine Art von Abfrage an die Tabelle gesendet wird, reicht dies f√ºr die √úberwachung aus. </p><br><p><img src="https://habrastorage.org/webt/qx/gt/wo/qxgtwoplv8i3wnce0ncygyipfgw.png"></p><br><p>  Das ist Redis.  Wir sehen, dass lila viel CPU verbraucht.  Violett ist ein Setex.  Setex - Schl√ºsseldatensatz mit TTL-Installation.  Wenn uns das wichtig ist, lassen Sie uns damit umgehen.  Wenn dies f√ºr uns nicht wichtig ist, wissen wir nur, wohin alle Ressourcen gehen. </p><br><p><img src="https://habrastorage.org/webt/78/x_/ng/78x_nghhya3bc-3zd2xtgd2kyxy.png"></p><br><p>  Cassandra.  Wir sehen die Top 5 Tabellen f√ºr Leseanforderungen nach der Gesamtantwortzeit.  Wir sehen diesen Anstieg.  Dies sind Abfragen an die Tabelle, und wir verstehen ungef√§hr, dass eine Abfrage an diese Tabelle einen Code ergibt.  Cassandra ist keine SQL-Datenbank, in die wir verschiedene Abfragen f√ºr Tabellen durchf√ºhren k√∂nnen.  Cassandra wird immer elender. </p><br><p><img src="https://habrastorage.org/webt/z3/ho/s3/z3hos3wz7mgt5yvh3jbw9sgodxi.png"></p><br><p>  Ein paar Worte zum Workflow arbeiten mit Vorf√§llen.  Wie ich es sehe. </p><br><p>  √úber Alarm.  Unsere Sicht auf den Vorfall-Workflow unterscheidet sich von der allgemein akzeptierten. </p><br><p><img src="https://habrastorage.org/webt/px/zd/n4/pxzdn4r9vdjznfd6hrr2x63nmxi.png"></p><br><p>  Sehr kritisch.  Wir benachrichtigen Sie per SMS und √ºber alle Echtzeit-Kommunikationskan√§le. </p><br><p>  Severy Info ist eine Gl√ºhbirne, die Ihnen bei der Arbeit mit Vorf√§llen helfen kann.  Info wird nirgendwo benachrichtigt.  Info h√§ngt nur und sagt Ihnen, dass etwas passiert. </p><br><p>  Schwere Warnung ist etwas, das benachrichtigt werden kann, vielleicht auch nicht. </p><br><p><img src="https://habrastorage.org/webt/op/hd/az/ophdazu-e1tchrtymsdxetidpq8.png"></p><br><p>  Kritische Beispiele. </p><br><p>  Die Seite funktioniert √ºberhaupt nicht.  Zum Beispiel 5xx 100% oder die Antwortzeit hat sich erh√∂ht und Benutzer haben begonnen zu gehen. </p><br><p>  Gesch√§ftslogikfehler.  Was ist kritisch.  Es ist notwendig, Geld pro Sekunde zu messen.  Geld pro Sekunde ist eine gute Datenquelle f√ºr Critical.  Zum Beispiel die Anzahl der Bestellungen, die Werbung f√ºr Anzeigen und andere. </p><br><p><img src="https://habrastorage.org/webt/it/n3/em/itn3emdzqhe7lapptysa1nvlwjy.png"></p><br><p>  Workflow mit Critical, sodass dieser Vorfall nicht verschoben werden kann.  Sie k√∂nnen nicht auf OK klicken und nach Hause gehen.  Wenn Critical zu Ihnen gekommen ist und Sie mit der U-Bahn fahren, m√ºssen Sie aus der U-Bahn aussteigen, nach drau√üen gehen, eine Bank nehmen und mit der Reparatur beginnen.  Ansonsten ist es nicht kritisch.  Aus diesen √úberlegungen konstruieren wir den verbleibenden Schweregrad f√ºr das Restattribut. </p><br><p><img src="https://habrastorage.org/webt/pq/ct/ww/pqctww-7nkjkjjdvmujjl9ntjrm.png"></p><br><p>  Warnung.  Warnbeispiele. </p><br><ul><li>  Der Speicherplatz ist knapp. </li><li>  Der interne Dienst funktioniert lange, aber wenn Sie nicht √ºber Kritisch verf√ºgen, bedeutet dies, dass Sie trotzdem bedingt sind. </li><li>  Viele Fehler auf der Netzwerkschnittstelle. </li><li>  Am umstrittensten ist, dass der Server nicht verf√ºgbar ist.  Wenn Sie mehr als einen Server haben und der Server nicht verf√ºgbar ist, ist dies eine Warnung.  Wenn Sie nicht 1 Backend von 100 haben, ist es dumm, von SMS aufzuwachen, und Sie werden nerv√∂se Administratoren bekommen. </li></ul><br><p>  Alle anderen Severy sollen Ihnen helfen, mit Critical umzugehen. </p><br><p><img src="https://habrastorage.org/webt/ze/rv/je/zervjevqnr3gnnaqugze3h1jf-g.png"></p><br><p>  Warnung.  Wir bef√ºrworten diesen Ansatz f√ºr die Arbeit mit Warning.  Vorzugsweise Warnung tags√ºber schlie√üen.  Die meisten unserer Kunden haben die Warnmeldung deaktiviert.  Sie haben also nicht die sogenannte √úberwachungsblindheit.  Dies bedeutet, dass Briefe in der Mail gefaltet werden, ohne ein separates Verzeichnis zu lesen.  Clients haben die Warnmeldung deaktiviert. </p><br><p>  (Soweit ich wei√ü, ist reine √úberwachung unn√∂tige Warnungen und Ausl√∂ser, die Ausnahmen hinzugef√ºgt werden - Hinweis des Autors des Beitrags) </p><br><p>  Wenn Sie die reine √úberwachungstechnik verwenden und 5 neue Warnungen haben, k√∂nnen Sie diese in einem leisen Modus reparieren.  Sie hatten heute keine Zeit, das Problem zu beheben, aber sie haben es auf morgen verschoben, wenn auch nicht kritisch.  Wenn die Warnung aufleuchtet und sich selbst l√∂scht, muss dies bei der √úberwachung verdreht werden, damit Sie sich erneut nicht darum k√ºmmern.  Dann werden Sie toleranter gegen√ºber ihnen sein und dementsprechend wird sich das Leben verbessern. </p><br><p><img src="https://habrastorage.org/webt/xp/92/lv/xp92lvui1q6xbawczc9ltl0osys.png"></p><br><p>  Beispiele f√ºr Informationen.  Es ist fraglich, dass die hohe CPU-Auslastung vieler kritisch ist.  Wenn nichts davon betroffen ist, k√∂nnen Sie diese Benachrichtigung ignorieren. </p><br><p><img src="https://habrastorage.org/webt/xb/nn/p1/xbnnp13tktiqtspilpycu2oaxba.png"></p><br><p>  Warnung (vielleicht sehe ich Info - eine Notiz des Autors des Beitrags) Dies sind die Lichter, die leuchten, wenn Sie kommen, um das Kritische zu reparieren.  Sie sehen zwei Warnschilder nebeneinander (m√∂glicherweise gibt es einen Info-Link - Hinweis des Autors des Beitrags).  Sie k√∂nnen Ihnen bei der L√∂sung des Vorfalls mit Critical helfen.  Warum ist die hohe CPU-Auslastung nicht separat in SMS oder in einem Brief klar. </p><br><p>  Sinnlose Informationen sind auch schlecht.  Wenn Sie sie als Ausnahme konfigurieren, werden Sie Info zu sehr lieben. </p><br><p><img src="https://habrastorage.org/webt/ra/rc/uc/rarcucyuedf9vp6v6keycnnjbz4.png"></p><br><p>  Allgemeine Grunds√§tze f√ºr das Alarmdesign.  Warnung sollte den Grund zeigen.  Das ist perfekt.  Dies ist jedoch schwer zu erreichen.  Hier arbeiten wir Vollzeit an der Aufgabe und es stellt sich heraus, dass sie teilweise erfolgreich ist. </p><br><p>  Alle reden √ºber die Notwendigkeit von Sucht, Auto-Magie.  Wenn Sie keine Benachrichtigungen f√ºr etwas erhalten, an dem Sie nicht interessiert sind, wird es nicht zu viel geben.  In meiner Praxis zeigen Statistiken, dass eine Person im Moment eines kritischen Vorfalls mit ihren Augen etwa hundert Gl√ºhbirnen diagonal betrachtet.  Er wird dort den richtigen finden und wird nicht glauben, dass die Abh√§ngigkeit irgendwelche Gl√ºhbirnen verborgen hat, die mir jetzt helfen w√ºrden.  In der Praxis funktioniert dies.  Sie m√ºssen lediglich unn√∂tige Warnungen bereinigen. </p><br><p><img src="https://habrastorage.org/webt/wq/i8/mm/wqi8mmyravgx7yllannlhsgdvg8.png"></p><br><p>  (Hier wurde das Video √ºbersprungen - Anmerkung des Autors des Beitrags) </p><br><p><img src="https://habrastorage.org/webt/ys/t_/0d/yst_0dqqfwqnra1yz0krnccw7ae.png"></p><br><p>  Es w√§re sch√∂n, diese Ausfallzeiten zu klassifizieren, damit Sie sp√§ter damit arbeiten k√∂nnen.  Ziehen Sie beispielsweise organisatorische Schlussfolgerungen.  Sie m√ºssen verstehen, warum Sie gelogen haben.  Wir schlagen vor, in folgende Klassen zu klassifizieren / zu unterteilen: </p><br><ul><li>  von Menschen gemacht </li><li>  Hoster eingerichtet </li><li>  kamen Bots </li></ul><br><p>  Wenn Sie sie klassifizieren, werden alle gl√ºcklich sein. </p><br><p><img src="https://habrastorage.org/webt/_c/kz/ll/_ckzllbldi_jkamyonco194favy.png"></p><br><p>  SMS ist angekommen.  Was machen wir  Zuerst laufen wir, um alles zu reparieren.  Bisher ist uns nichts wichtig, au√üer dass die Ausfallzeit endet.  Weil wir motiviert sind, weniger zu l√ºgen.  Wenn der Vorfall geschlossen ist, sollte er f√ºr das √úberwachungssystem geschlossen werden.  Wir glauben, dass der Vorfall durch √úberwachung √ºberpr√ºft werden sollte.  Wenn Ihre √úberwachung nicht konfiguriert ist, reicht es aus, um sicherzustellen, dass das Problem behoben ist.  Dies muss verdreht werden.  Nachdem der Vorfall geschlossen wurde, wird er nicht wirklich geschlossen.  Er wartet, w√§hrend Sie dem Grund auf den Grund gehen.  Tats√§chlich muss jeder F√ºhrer in erster Linie sicherstellen, dass die Probleme nicht erneut auftreten.  Damit die Probleme nicht erneut auftreten, m√ºssen Sie dem Grund auf den Grund gehen.  Nachdem wir dem Grund auf den Grund gegangen sind, haben wir Daten, um sie zu klassifizieren.  Wir analysieren die Gr√ºnde.  Wenn wir dann dem Grund auf den Grund gehen, m√ºssen wir dies in Zukunft tun, damit der Vorfall nicht erneut auftritt: </p><br><ul><li>  Es braucht zwei Leute pro Viertel, um diese und jene Logik in das Backend zu schreiben. </li><li>  m√ºssen mehr Repliken setzen. </li></ul><br><p>  Es muss sichergestellt werden, dass nicht genau derselbe Vorfall passiert.  Wenn Sie in einem solchen Workflow durch N Iterationen arbeiten, erwartet Sie Gl√ºck, gute Betriebszeit. </p><br><p>  Warum haben wir sie klassifiziert?  Wir k√∂nnen die Statistiken f√ºr das Quartal verwenden und verstehen, welche Ausfallzeiten Sie am meisten verursacht haben.  Dann arbeiten Sie in diese Richtung.  Sie k√∂nnen an allen Fronten arbeiten, was nicht sehr effektiv ist, besonders wenn Sie dort nur wenige Ressourcen haben. </p><br><p><img src="https://habrastorage.org/webt/b9/os/oh/b9osohrb-qilf4mcb7ddcqjckju.png"></p><br><p>  Wir haben dort berechnet, dass wir so viel Zeit liegen, zum Beispiel 90% wegen des Hosters.  Wir berechnen, dass wir diesen Hoster wechseln.  Wenn sich Leute mit uns anlegen, schicken wir sie zu Kursen.   ,      - ‚Äî  .   .     ,     .    ,    . </p><br><p><img src="https://habrastorage.org/webt/js/gl/wp/jsglwpchvythu9tvkjnbruwtcr8.png"></p><br><p>  .      : </p><br><ul><li>  . </li><li>  . </li></ul><br><p>     ,    ,    .      ,    ,  . </p><br><p><img src="https://habrastorage.org/webt/nn/rb/fl/nnrbflbnglbwbwggjdxuipfuxss.png"></p><br><p> :    ,  .     : ,  ,    .   False Positive ( ),   ,    .       ? </p><br><p> :      .    10- frontend ,      .    9 frontend     nginx,   10-  ,     warning alert  .            .     ,     .          .    . </p><br><p> :       . ,      ,   load avarage 4  , -   load avarage 20  . </p><br><p> :        load avarage.      100       .   CPU usage   Hadoop  .          .       .    .     ,       ,     .      PostgreSQL    autovacuum,  worker autovacuum      .          99  . Warning     .  Critical     .    Critical 10 5  ,     Critical. </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frage: Wann und wie wird der Schwellenwert ermittelt? </font><font style="vertical-align: inherit;">Wer macht das?</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antwort: Sie kommen zu uns und sagen: Wir m√∂chten einige Kritiker unseres Projekts fragen. </font><font style="vertical-align: inherit;">Wenn Sie jetzt 10 5xx pro Sekunde eingeben, wie viele Benachrichtigungen w√ºrden Sie vor einer Woche erhalten?</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Frage: Was ist die Last all dieser guten √úberwachung? </font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antwort: Im Durchschnitt ist es im Allgemeinen unsichtbar. </font><font style="vertical-align: inherit;">Wenn Sie jedoch 50.000 RPS analysieren, sind es 1% bis 10% einer CPU. </font><font style="vertical-align: inherit;">Da wir nur √ºberwachen, haben wir unseren Agenten optimiert. </font><font style="vertical-align: inherit;">Wir messen die Leistung der Agenten. </font><font style="vertical-align: inherit;">Wenn Sie nicht √ºber die Ressourcen verf√ºgen, um auf dem Server zu √ºberwachen, machen Sie etwas falsch. </font><font style="vertical-align: inherit;">Es sollten immer Ressourcen zur √úberwachung vorhanden sein. </font><font style="vertical-align: inherit;">Wenn Sie dies nicht tun, sind Sie f√ºr die Verwaltung Ihres Projekts genauso blind.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473728/">https://habr.com/ru/post/de473728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473716/index.html">Mausgesteuerte Widgets. Ziehen und Ablegen innerhalb des Fensters</a></li>
<li><a href="../de473718/index.html">So f√ºgen Sie NoVerify Schecks hinzu, ohne eine einzige Zeile Go-Code zu schreiben</a></li>
<li><a href="../de473720/index.html">Zwei M√∂glichkeiten, um zuverl√§ssige Komponententests durchzuf√ºhren</a></li>
<li><a href="../de473722/index.html">Fernisolation, Angst und Depression</a></li>
<li><a href="../de473726/index.html">Es reicht nicht aus zu wissen, was Mutex, Semaphore und Async / Warten sind. Sie m√ºssen alles von Quanten wissen</a></li>
<li><a href="../de473732/index.html">Die Geschichte des Betrugs beim Bau eines Kabelnetzes unter der Arktis f√ºr 1 Milliarde US-Dollar</a></li>
<li><a href="../de473740/index.html">CreateRemoteThread f√ºr Linux</a></li>
<li><a href="../de473742/index.html">Epson Engineering-Drucker f√ºr CAD und GIS und ein paar Worte zum Thema "Robustes Design"</a></li>
<li><a href="../de473748/index.html">Bezierkurve im Dienste der Arbeits√∂konomen</a></li>
<li><a href="../de473750/index.html">Stereopi + WebRTC = Telepr√§senz zu Hause</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>