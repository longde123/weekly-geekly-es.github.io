<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåì üë¥ üëÜüèø Servidor web simple para SPA / PWA en 5 minutos üëéüèø ‚¨ÜÔ∏è üìÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C√≥mo crear un servidor web simple usando solo instrucciones est√°ndar de nodejs 


 A menudo, se requiere un servidor web simple para desarrollar aplic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor web simple para SPA / PWA en 5 minutos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481898/"><h1 id="kak-sozdat-prostoy-veb-server-ispolzuya-tolko-standartnye-instrukcii-nodejs">  C√≥mo crear un servidor web simple usando solo instrucciones est√°ndar de nodejs </h1><br><p> A menudo, se requiere un servidor web simple para desarrollar aplicaciones MPA / SPA / PWA.  Una vez, en un gran mitin en respuesta a la pregunta: "¬øQu√© estabas haciendo?", Dije que estaba creando un servidor web para alojar una aplicaci√≥n PWA.  Todos nos re√≠mos durante mucho tiempo y s√≠, por cierto, PWA no es pegamento.  Al igual que SPA, no es un sal√≥n de belleza.  Estos son todo tipo de aplicaciones web.  Y SSR no es un pa√≠s :-).  Si inicia dicha aplicaci√≥n simplemente abriendo la p√°gina de inicio de index.html a trav√©s de un navegador, no funcionar√° como deber√≠a, en el mejor de los casos obtendremos una versi√≥n sin conexi√≥n.  Me encanta JavaScript y resolver√© el problema utilizando solo los medios disponibles, por as√≠ decirlo. </p><a name="habracut"></a><br><p>  Comencemos con el plan: </p><br><ol><li>  Si no hay <a href="https://nodejs.org/dist/">NodeJS,</a> descargue LTS, inst√°lelo, no cambie la configuraci√≥n, haga clic en Siguiente </li><li>  En nuestro lugar apartado, donde se recopilan todos los proyectos, cree la carpeta <strong>simple-web-server</strong> </li><li>  En la carpeta del proyecto, ejecute el comando npm init --yes // sin --yes, el inicializador har√° muchas preguntas </li><li>  En el archivo <strong>package.json</strong> en la secci√≥n de <strong>scripts</strong> , agregue la propiedad y su valor - <strong>"main": "index.js"</strong> - para que podamos iniciar r√°pidamente nuestro servidor usando el comando npm run </li><li>  Crear una carpeta <strong>lib</strong> Se recomienda poner todo su c√≥digo en ella, lo que no requiere montaje y pasos adicionales para su funcionamiento. </li><li>  Cree un archivo <strong>index.js</strong> en la carpeta <strong>lib</strong> <strong>.</strong> Este es nuestro futuro servidor. </li><li>  Cree una carpeta <strong>dist</strong> : esta ser√° la carpeta en la que habr√° archivos de acceso p√∫blico, incluido index.html, en otras palabras, la est√°tica que distribuir√° nuestro servidor </li><li>  Abra el archivo /index.js </li><li>  Escribe un c√≥digo </li></ol><br><p>  Entonces, ¬øqu√© sabemos sobre lo que debe hacer nuestro servidor? </p><br><ol><li>  Manejar solicitudes </li><li>  Leer archivos </li><li>  Responder a la solicitud con el contenido del archivo </li></ol><br><p>  Primero, cree nuestro servidor, imp√≥rtelo al archivo <strong>idex.js</strong> </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createServer} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>);</code> </pre> <br><p>  Esta instrucci√≥n destruye el objeto del m√≥dulo <a href="http.html"><strong>http</strong></a> y asigna una expresi√≥n, la funci√≥n <a href="http_createserver.asp"><strong>createServer</strong></a> , al identificador de variable <a href="http_createserver.asp"><strong>createServer</strong></a> . </p><br><p>  Cree un nuevo servidor usando la siguiente declaraci√≥n </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = createServer();</code> </pre> <br><p>  Cuando va al host del servidor por primera vez, el navegador env√≠a una solicitud para recibir el documento.  Por lo tanto, para procesar este evento, necesitamos escuchar dichas solicitudes.  El servidor que creamos tiene un m√©todo de <strong>escucha</strong> , como par√°metro pasamos el n√∫mero de puerto 3000. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> eventsEmitter = server.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>);</code> </pre> <br><p>  La expresi√≥n de este m√©todo ser√° un objeto <a href="https://nodejs.org/api/events.html"><strong>EventEmitter</strong></a> que se almacenar√° en una variable con el identificador <strong>eventsEmitter</strong> .  Este objeto es observable.  Nos suscribimos a sus eventos utilizando la llamada al m√©todo <a href="https://nodejs.org/api/events.html"><strong>on / addEventListener</strong></a> con dos par√°metros de <strong>funci√≥n de</strong> <strong>cadena</strong> requeridos.  El primer par√°metro indica qu√© eventos son de inter√©s para nosotros; <a href="&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhihkoA1ytysBl3-LDVXNIknSPYQuQ#"><strong>solicite que el</strong></a> segundo sea una funci√≥n que procesar√° este evento. </p><br><pre> <code class="javascript hljs"> eventsEmitter.on(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span>; });</code> </pre> <br><p>  Abre el <a href="http://localhost:3000/">enlace</a> en el navegador </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ad7/533/9ab/ad75339aba986a5e052325240422696c.png" alt="imagen"></p><br><p>  Entonces, nos decidimos por las instrucciones del depurador.  Vemos que como par√°metros obtenemos dos objetos <a href="&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhihkoA1ytysBl3-LDVXNIknSPYQuQ#http_class_"><strong>req</strong></a> , <a href="&amp;xid=17259,15700021,15700186,15700190,15700259,15700271,15700302&amp;usg=ALkJrhihkoA1ytysBl3-LDVXNIknSPYQuQ#http_class_"><strong>res</strong></a> . Estos objetos son instancias de objetos de tipo <a href="https://nodejs.org/api/stream.html">flujo,</a> por lo tanto <a href="https://nodejs.org/api/stream.html">,</a> <a href="https://nodejs.org/api/stream.html"><strong>req</strong></a> es el flujo de lectura y <a href="https://nodejs.org/api/stream.html"><strong>res</strong></a> es el flujo de escritura. </p><br><p>  Procesamos la solicitud y podemos decir que "el asunto est√° en el sombrero".  Todo lo que queda es leer y devolver el archivo.  Primero debe comprender qu√© tipo de archivo necesitamos.  En el depurador, despu√©s de estudiar todas las propiedades del par√°metro <strong>req</strong> , vi que tiene la propiedad <strong>url</strong> .  Pero solo no hay nada como <strong>index.html en √©l</strong> . </p><br><p>  Veamos nuevamente nuestro navegador: vemos que no hemos indicado esto expl√≠citamente.  Intentemos nuevamente, pero ya especificaremos expl√≠citamente <a href="http://localhost:3000/index.html">index.html</a> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b98/ff2/fb4/b98ff2fb48f53fd0e89b94103a2802b7.png" alt="imagen"></p><br><p>  Ahora est√° claro que el nombre del archivo viene en la solicitud en la propiedad de <strong>URL</strong> y nada m√°s que esto, no necesitamos leer el archivo de la solicitud.  Lo descomponemos usando un par de llaves, especificamos el nombre de la propiedad <strong>url</strong> y, a trav√©s del operador <strong>:</strong> establecemos un nombre arbitrario usando un identificador de variable v√°lido, en mi caso <strong>requestUrl</strong> . </p><br><pre> <code class="javascript hljs"> eventsEmitter.addListener(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, ({<span class="hljs-attr"><span class="hljs-attr">url</span></span>: requestUrl}, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">debugger</span></span> });</code> </pre> <br><p>  Genial, ¬øqu√© sigue?  En verdad, no me gusta el hecho de que index.html siempre tendr√° que especificarse expl√≠citamente, as√≠ que resuelva este problema de inmediato.  Decid√≠ que la forma m√°s f√°cil de hacer esto es usar la funci√≥n est√°ndar <a href="https://nodejs.org/api/path.html"><strong>extname;</strong></a> est√° incluida en el paquete est√°ndar <br>  NodeJS del m√≥dulo de <a href="https://nodejs.org/api/path.html"><strong>ruta</strong></a> lo importamos utilizando la siguiente instrucci√≥n. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  Ahora puede llamarlo pasando la expresi√≥n del identificador requestUrl como par√°metro y obtener la expresi√≥n para la cadena del formato aproximado <code>'.extension'</code> .  Si la solicitud no especifica expl√≠citamente un archivo, se devolver√° una cadena vac√≠a.  Usando este principio, agregaremos el valor predeterminado de <strong>'index.html'</strong> .  Escribimos las siguientes instrucciones </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = extname(requestUrl) === <span class="hljs-string"><span class="hljs-string">''</span></span> ? DEFAULT_FILE_NAME : requestUrl;</code> </pre> <br><p>  Estoy seguro de que el usuario del servidor querr√° anular este nombre y tambi√©n configurar una variable de entorno utilizando la siguiente instrucci√≥n </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>}} = process;<span class="hljs-string"><span class="hljs-string">`</span></span></code> </pre> <br><p>  En el <a href="https://nodejs.org/api/process.html"><strong>proceso de</strong></a> variable global <a href="https://nodejs.org/api/process.html"><strong>, hay</strong></a> mucha informaci√≥n √∫til, solo enterrar√© una parte de ella, en particular, la propiedad <a href="https://nodejs.org/api/process.html"><strong>env</strong></a> que contiene todas las propiedades del entorno del usuario y ya buscaremos <strong>DEFAULT_FILE_NAME</strong> si el usuario no la especifica; usamos index.html de manera predeterminada. </p><br><blockquote>  IMPORTANTE: si el valor de la propiedad de entorno DEFAULT_FILE_NAME no est√° definido, la asignaci√≥n de un valor predeterminado no funcionar√°.  Vale la pena recordar esto, pero no ahora, estamos haciendo todo al m√≠nimo :-) </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/0db/3cf/e97/0db3cfe97b528ef15c02994bad3781f3.png" alt="imagen"></p><br><p>  Ahora que tenemos un enlace relativo al archivo, necesitamos obtener la ruta absoluta al archivo en el sistema de archivos de nuestro servidor.  Decidimos que todos los archivos p√∫blicos se almacenar√°n en la carpeta <strong>dist</strong> , por lo que para obtener la <strong>ruta absoluta al archivo</strong> , utilizaremos otra funci√≥n de <a href="https://nodejs.org/api/path.html"><strong>resoluci√≥n</strong></a> del m√≥dulo que ya conocemos <br>  <a href="https://nodejs.org/api/path.html"><strong>ruta</strong></a> simplemente ind√≠quelo en la instrucci√≥n creada anteriormente en la l√≠nea 5 </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {resolve, extname} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>);</code> </pre> <br><p>  A continuaci√≥n, en la l√≠nea 10, escribimos una instrucci√≥n que recibir√° y guardar√° la <strong>ruta absoluta a la</strong> variable <strong>filePath.</strong> Tambi√©n "wang" de antemano que el nombre de esta carpeta se puede redefinir para mayor flexibilidad.  Por lo tanto, ampl√≠o la instrucci√≥n en la l√≠nea 6, agregando el nombre <br>  variable de entorno <strong>DIST_FOLDER</strong> ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/128/919/e1f/128919e1ffb4aed7911e31764414ee4b.png" alt="imagen"></p><br><p>  Ahora todo est√° listo para leer el archivo.  Puede leer un archivo de diferentes maneras Asincr√≥nicamente, Sincr√≥nicamente, o puede usar <a href="https://nodejs.org/api/stream.html">secuencias</a> .  Usar√© streams :-) es hermoso y m√°s efectivo, desde el punto de vista de los recursos gastados.  Primero, cree un archivo de prueba en la carpeta <strong>dist</strong> para que haya algo que leer :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Ahora necesitamos una funci√≥n que cree una secuencia de lectura de archivos, tambi√©n se incluye en la distribuci√≥n est√°ndar de NodeJS, la extraemos del m√≥dulo <a href="https://nodejs.org/api/fs.html"><strong>fs</strong></a> usando las siguientes instrucciones </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {createReadStream} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>);</code> </pre> <br><p>  y en la l√≠nea 12 en el cuerpo del procesador de solicitudes usamos la siguiente declaraci√≥n </p><br><pre> <code class="javascript hljs"> createReadStream(filePath)</code> </pre> <br><p>  Como resultado, la instancia del objeto read-stream se devolver√° us√°ndolo <br>  podemos cambiar las secuencias de lectura a la secuencia de escritura, tambi√©n podemos transformar las secuencias y muchas otras cosas √∫tiles.  Entonces el par√°metro <strong>res</strong> es un flujo de lectura, ¬øverdad? </p><br><p>  Intentemos cambiar inmediatamente la secuencia de lectura de archivos que creamos en la secuencia de escritura de <strong>resoluci√≥n</strong> para <br>  de esto, en la l√≠nea 12 continuamos la instrucci√≥n llamando al m√©todo de <strong>tuber√≠a</strong> , y como par√°metro pasamos nuestra <strong>resoluci√≥n de</strong> flujo de escritura </p><br><pre> <code class="javascript hljs"> createReadStream(filePath).pipe(res);</code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/412/712/851/412712851c4ce2bcc2bf4a2bcb36ef86.png" alt="imagen"></p><br><p>  ¬øEso es todo?  Nooo  ¬øY qui√©n se encargar√° de los errores?  ¬øQu√© tipo de errores?  Intentemos subir el archivo CSS al archivo index.html, pero no lo crearemos y veremos qu√© sucede :-) </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"index1.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> TESTING 1,2,3... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/487/052/185/487052185b1c4adc32a05f658c7dafb6.jpg" alt="imagen"></p><br><p>  Esperado, pero el servidor se bloque√≥!  Este no es el caso en absoluto.  El hecho es que, por defecto, los errores no se <strong>detectan</strong> en las secuencias y debe hacerlo usted mismo :-) <strong>createReadStream</strong> devuelve la secuencia en la que se produce el error.  Por lo tanto, agregamos un controlador de errores.  Usando la llamada al m√©todo <strong>on</strong> . Especificando el nombre del evento de <strong>error</strong> y el controlador de una funci√≥n.  Terminar√° la secuencia de lectura de lectura con un c√≥digo de respuesta 404. </p><br><pre> <code class="javascript hljs"> createReadStream(filePath) .on(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, error =&gt; res.writeHead(<span class="hljs-number"><span class="hljs-number">404</span></span>).end()) .pipe(res);</code> </pre> <br><p>  cheque! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/747/29e/584/74729e584b652a032a34c5a82d754a2d.jpg" alt="imagen"></p><br><p>  Otra cosa  Por cierto, el servidor a√∫n no est√° listo y si tratamos de abrirlo en otro navegador, la p√°gina no funcionar√° correctamente :-) quien lo adivin√≥, escriba en los comentarios, ¬øqu√© olvid√≥ hacer?  El hecho es que cuando un servidor responde a la solicitud de un servidor con un archivo, una extensi√≥n no es suficiente para que el navegador entienda de qu√© tipo son este archivo y otros navegadores: ni Chrome ni las versiones anteriores funcionar√°n con los archivos descargados sin especificar el encabezado de respuesta Tipo de contenido. procesar el archivo, entre otras cosas, nuestro servidor debe especificar el <a href="https://developer.mozilla.org/ru/docs/Web/HTTP/Basics_of_HTTP/MIME_types">tipo MIME.</a> Para ello, crearemos una variable separada con todos los tipos comunes de mayo.  Tambi√©n brindamos la oportunidad de expandirlos pasando como una variable de entorno </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-attr"><span class="hljs-attr">env</span></span>: {DEFAULT_FILE_NAME = <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>, DIST_FOLDER = <span class="hljs-string"><span class="hljs-string">'dist'</span></span>, DEFAULT_MIME_TYPES = <span class="hljs-string"><span class="hljs-string">'{}'</span></span>}} = process; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {text} = mimeTypes = { <span class="hljs-string"><span class="hljs-string">'html'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpeg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'jpg'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'png'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span>, <span class="hljs-string"><span class="hljs-string">'js'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/javascript'</span></span>, <span class="hljs-string"><span class="hljs-string">'css'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/css'</span></span>, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: <span class="hljs-string"><span class="hljs-string">'plain/text'</span></span>, <span class="hljs-string"><span class="hljs-string">'json'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, ...JSON.parse(DEFAULT_MIME_TYPES) };</code> </pre> <br><p>  Bueno, ahora necesita especificar de alguna manera el tipo MIME antes de cambiar la secuencia de lectura a la secuencia de escritura.  Utilic√© los nombres de extensi√≥n de archivo como claves, por lo que obtendremos la extensi√≥n de archivo con la conocida funci√≥n <strong>extname</strong> </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileExtension = extname(url).split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>).pop();</code> </pre> <br><p>  y con la ayuda del controlador de eventos de <strong>tuber√≠a</strong> , configuramos el tipo MIME deseado </p><br><pre> <code class="plaintext hljs">res.on('pipe', () =&gt; res.setHeader(contentType, mimeTypes[fileExtension] || text));</code> </pre> <br><p>  Cheque </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9e/bad/f34/b9ebadf34d25b2fa8991387d880bc331.jpg" alt="imagen"></p><br><p>  Eso es todo: el servidor est√° listo.  Por supuesto, no es perfecto, pero para un comienzo r√°pido, eso es todo.  Si est√° interesado en desarrollar esta idea, escriba los comentarios :-) </p><br><p>  <a href="http-server">C√≥digo completo del proyecto</a> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/5YhIxvbMLp8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/TssbLe5I2Ec" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/481898/">https://habr.com/ru/post/481898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../481886/index.html">C√≥mo crear r√°pidamente un diario de asistencia</a></li>
<li><a href="../481890/index.html">Importaci√≥n de colas de uranio alemanas a Rusia. Parte 2. Enriquecimiento</a></li>
<li><a href="../481892/index.html">Qubits en lugar de bits: ¬øqu√© futuro tienen las computadoras cu√°nticas para nosotros?</a></li>
<li><a href="../481894/index.html">C√≥mo la puesta en marcha de la biotecnolog√≠a rusa ayuda a combatir el c√°ncer</a></li>
<li><a href="../481896/index.html">PHP Vs ASP.NET: ¬øC√≥mo elegir el correcto?</a></li>
<li><a href="../481902/index.html">Modelando el funcionamiento de una central t√©rmica real para optimizar modos: vapor y matem√°ticas</a></li>
<li><a href="../481904/index.html">Vladimir Marshinin, tambi√©n conocido como mavl: "La llamada" No copiar otras tarjetas "le permite evitar problemas de licencia de OpenStreetMap"</a></li>
<li><a href="../481906/index.html">Cerebro chino, o en defensa de la primavera</a></li>
<li><a href="../481910/index.html">Escribir comportamiento de deslizamiento vertical flexible</a></li>
<li><a href="../481912/index.html">Como una semana fui pasante en SRE-ingeniero. Mira a trav√©s de los ojos de un ingeniero de software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>