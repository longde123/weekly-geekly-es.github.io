<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧔🏼 🖨️ 🛑 关于Centos存储库镜像并选择最佳的镜像库 🎛️ 🕊️ 🧠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="去年，我们为多个Linux发行版托管了在线镜像。 这不是一个复杂的过程，对于像Ubuntu这样的大型项目，它几乎是完全自动化的。 在其他情况下，您需要以一种或另一种方式（例如，在邮件列表中）联系该项目，并明确表达您的需求。 


 从技术上讲，它通常是按计划进行的rsync 。 有人为此提供了一组现...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>关于Centos存储库镜像并选择最佳的镜像库</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476262/"> 去年，我们为多个Linux发行版托管了在线镜像。 这不是一个复杂的过程，对于像Ubuntu这样的大型项目，它几乎是完全自动化的。 在其他情况下，您需要以一种或另一种方式（例如，在邮件列表中）联系该项目，并明确表达您的需求。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i5/vh/_l/i5vh_lmncsc_yjc6woir34ypw8o.png" alt="百胜重制"></div><br> 从技术上讲，它通常是按计划进行的<code>rsync</code> 。 有人为此提供了一组现成的脚本，例如Fedora，有人只是说您需要在这里从该服务器与推荐的参数集进行同步。 最昂贵的资源是位置，我们最近达到4 TB，在我们的情况下这是昂贵的，因为它不会产生任何利润。 作为回报，我们获得了所使用发行版的本地可用性，这使得可以消除服务器的强制Internet访问，从而简化了服务器的初始配置。 当然，即使我们参与程度不是很明显，我们也很高兴加入了一些大型活动。 <br><br> 我们的镜像是公开的，每个人都可以从中获得更新，如果通过上诉统计判断，这实际上是发生的。 这主要是俄罗斯，但不仅如此。 关于结果以及如何在本文的Centos第七版示例中选择通用服务器进行更新。 <a name="habracut"></a><br><br> 我们将讨论默认情况下安装了<code>fastestmirror</code>插件的<code>yum</code>软件包管理器，并且我们只会对选择特定镜像的过程感兴趣。 <br><br><h2> 镜像列表 </h2><br> 众所周知，除非另有说明，否则在<code>/etc/yum.repos.d/</code>目录中的文件中指定存储库列表。 这是<code>/etc/yum.repos.d/Centos-Base.repo</code>文件中的<code>Base</code>存储库设置： <br><br><pre> <code class="bash hljs">[base] name=CentOS-<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span> - Base mirrorlist=http://mirrorlist.centos.org/?release=<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span>&amp;arch=<span class="hljs-variable"><span class="hljs-variable">$basearch</span></span>&amp;repo=os&amp;infra=<span class="hljs-variable"><span class="hljs-variable">$infra</span></span> <span class="hljs-comment"><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span></code> </pre> <br> 在这里，您可以看到两个选项，它们指定了可以获取数据的位置。 第一个<b>baseurl</b>直接指向镜像，这里不需要选择。 第二个镜像列表指示一个链接，通过该链接将返回10个镜像的列表，从中可以进行选择，该选项处于活动状态。 我们还在链接内看到几个变量，它们最终都反映出存储库目录树中的特定位置： <br><br><ul><li>  <b>发行</b>版本： <code>6</code> <code>8-stream</code> 。 较旧的版本已从现有基础架构中撤出，但是其存储库的快照可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://vault.centos.org/</a>找到。 </li><li>  <b>arch</b>是<code>i386</code>或<code>x86_64</code>类的体系结构。 对于某些版本，某些体系结构将引用备用存储库和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">另一个镜像系统</a> ，但是与此同时，镜像选择基础结构仍然很常见。 对于版本7，唯一受支持的基本镜像是<code>x86_64</code> ，它是<code>i386</code>的替代产品。 对于第一个，将在镜子的基本结构中形成一个列表，对于第二个， </li><li>  <b>repo-</b>在我们的例子中是<code>os</code> ，但是它可以是<code>updates</code>或其他<code>updates</code> ，实际上存储库的类型反映了我们需要的数据。 对于版本8，等效的<code>os</code>将是<code>baseos</code> </li><li>  <b>在下面</b> -我可以仔细地假设<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">它仍然没有使用</a> ，至少在形成镜像列表时找不到它的处理。 它等于<code>stock</code> ，但是如果省略此参数，则不会出现可见的变化 </li><li>  <b>cc</b>是国家代码；对于美国和加拿大，它也是州代码。 它不在上面的文件的示例中，因为在请求时，国家/地区是根据所请求的IP地址计算的。 此变量可用于消除地理位置错误。 对于俄罗斯， <code>cc=ru</code> </li></ul><br> 对于Centos的第7版，我们获得以下行： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http</a> ://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock，它将显示10种以下类型的镜像的列表： <br><br><pre> <code class="bash hljs">http://&lt;   1&gt;/7.xxx/os/x86_64/ http://&lt;   2&gt;/7.xxx/os/x86_64/ ... http://&lt;   10&gt;/7.xxx/os/x86_64/</code> </pre> <br> 请注意，每个镜像的特定路径与查询中的变量完全匹配。 尽管可以使用完整版本，但仍指示完整版本，尽管您也可以使用它： <code>http://&lt;  &gt;/7/os/x86_64/</code>也存在，使用指向最新版本的符号链接实现。 <br><br><div class="spoiler">  <b class="spoiler_title">所有这些都直接对应于服务器上的目录层次结构。</b> <div class="spoiler_text"><pre>  ./centos
 ├──6
 │├──centosplus
 ││├──i386
 ...│└──x86_64
     ...
 │
 ├──7
 │├──原子
 ││└──x86_64
 │├──centosplus
 ││└──x86_64
 │├──cr
 ││└──x86_64
 │├──网络
 ││└──x86_64
 │├──额外
 ││└──x86_64
 │├──脚凳
 ││└──x86_64
 │├──操作系统
 ││└──x86_64
 ││└──仓库
 ││└──[repomd.xml]
 │├──rt
 ││└──x86_64
 │├──更新
 ││└──x86_64
 │...
 │
 ├──7.0.1406
 ├──7.1.1503
 ├──7.2.1511
 ├──7.3.1611
 ├──7.4.1708
 ├──7.5.1804
 ├──7.6.1810
 ├──7.7.1908
 ├──8
 ├──8流
 ├──8.0.1905 
 ... </pre></div></div><br><h3> 实作 </h3><br> 现在可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/CentOS/mirrorlists-code</a>上找到实现，我们对镜像列表的形成方式很感兴趣。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pearl</a>脚本<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">makemirrorlists-combined.pl做到了这一点</a> 。 它的主要任务是通过将<code>repodata/repomd.xml</code>的哈希值与给定版本和体系结构的引用进行比较，以检查镜像的生命力。 因此，对于版本，存储库类型和体系结构的所有可用组合，文件必须存在。 <br><br> 验证按照以下顺序进行（我引用了代码）： <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment"># phase 1 -- this US state or Canada province # phase 2 -- this country # phase 3 -- other nearby countries # phase 4 -- mirrors from the same continent # phase 5 -- a random mirror from each continent (for fallback only) # note: phase 5 will be executed once for each continent (with "redo") # phase 6 -- random mirrors from any continent (for fallback only) # phase 7 -- centos servers from the same continent # phase 8 -- centos servers from other continents (used also for fallback)</span></span></code> </pre><br> 条款1和2起作用，或者不仅检查国家代码，而且检查州代码。 本质上，尝试选择最近的地理位置服务器。 对于每个步骤，都会从数据库中进行查询，例如： <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">columns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mirrors <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Direct'</span></span>, <span class="hljs-string"><span class="hljs-string">'Indirect'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> = <span class="hljs-string"><span class="hljs-string">'Active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> cc = <span class="hljs-string"><span class="hljs-string">'$cc'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> $commonqueryparams $skipregion $altarch_where <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RAND</span></span>();</code> </pre><br> 然后，如上所述，通过比较散列来检查此列表中的反射镜是否具有生命力。 如果招募了10个人，则所需任务已完成，工作已完成。 如果您没有输入，请继续下一步，将常规列表设置为10，或者直到我们用尽所有选项为止。 将结果保存到文件中，并使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ml.py</a>脚本传输到Python呈现的零件的前端，该脚本的任务是在首先通过IP地址找到请求源的国家/地区之后，选择并提供所需的文件。 还考虑了形成不同列表的IPv4或IPv6协议的类型。 <br><br> 返回使用<code>ORDER BY RAND()</code>的查询，这是否意味着列表将是随机的？ 是的，DBMS中实施的随机性如何，但这仅适用于每个步骤中的顺序。 也就是说，如果对于一个特定的国家，键入了超过10个所需的存储库和体系结构类型的镜像（对于俄罗斯，只有17个），那么最后，每次我们都会得到一个国家10个不同镜像的随机列表。 如果数量较少，则列表顶部将<b>始终</b>有一个国家/地区的经过改组的存储库，最近国家/地区的经过进一步改组的存储库，依此类推。 结果，我们得到一个不完全随机的列表，该列表由几个随机部分组成。 一个国家没有那么多工作镜像时很重要，例如，俄罗斯的IPv6镜像只有7个，它们将始终排在列表的首位： <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=en（该请求必须来自IPv6地址）</b> <div class="spoiler_text"> <code>http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ <br> http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ <br> http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ <br> http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ <br> http://dedic.sh/centos/7.7.1908/os/x86_64/ <br> <br> http://ftp.funet.fi/pub/mirrors/centos.org/7.7.1908/os/x86_64/ <br> http://centos.mirror.far.fi/7.7.1908/os/x86_64/ <br> http://mirrors.glesys.net/CentOS/7.7.1908/os/x86_64/ <br></code> </div></div><br> 更糟糕的是， <code>i386</code>架构是Centos 7和单独的镜像系统的替代架构。 在俄罗斯，只有这样一种服务器支持替代体系结构；它将始终排在首位： <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=en</b> <div class="spoiler_text"> <code>http://mirrors.powernet.com.ru/centos-altarch/7.7.1908/os/i386/ <br> <br> http://mirror.vpsnet.com/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.huaweicloud.com/centos-altarch/7.7.1908/os/i386/ <br> http://linux.darkpenguin.net/distros/CentOS-AltArch/7.7.1908/os/i386/ <br> http://ftp.agdsn.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror1.hs-esslingen.de/pub/Mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror.infonline.de/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.rz.uni-frankfurt.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.yz.yamagata-u.ac.jp/pub/linux/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.daticum.com/centos-altarch/7.7.1908/os/i386/ <br></code> </div></div><br> 该列表不再是随机的，如果您专注于第一行，则该选择是预先确定的。 对替代Centos体系结构的存储库的支持是一个原则<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题</a> ，但是对于许多人来说，纯利他主义在这里。 <br><br> 连续扫描存储库，并且不考虑缓存机制，结果大约每3小时更新一次。 引用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mirrorlist_crawler_deployment_notes.txt中的内容</a> ： <br><blockquote> <code>- A full scan of all repos and all versions without any cached data is going to take close to 3 hours, but typically altarch is &lt;10min, C6 &lt;25min, C7 &lt;25min with all the repos enabled</code> </blockquote> <br> 实际上，我开始每分钟一次在俄罗斯为Base Centos 7存储库接收针对IPv4和IPv6的镜像列表选项-http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=en，结果是这样的经过几天的观察： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/qh/sn/fxqhsn08lhen5mke-jlprhlgjxa.png" alt="镜像列表更新计数"></div><br> 蓝色的IPv4列表，红色的IPv6。 更改不会每25分钟发生一次，但不会每3小时一次-一切都介于半小时到两小时之间。 具有<code>i386</code>架构和备用镜的图片完全不同<code>i386</code> &amp;infra=stock&amp;cc= <code>http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=ru</code>大约需要一周的观察时间： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/xy/wb/osxywbdutbktiud6-scyrul_lok.png" alt="altmirrors列表更新计数"></div><br> 我们可以预期，每15分钟就会有一个新列表，在30分钟内会发生一些变化。 但是！ 请记住，活动镜像越少，顺序的随机性就越小，而在俄罗斯，首先始终是相同的镜像。 <br><br><h2> 最快的镜子 </h2><br> 总而言之，镜像列表最多是偶然形成的，这对于负载平衡来说可能还不错。 最糟糕的是，我们可以期望仅从列表中选择第一个镜像，因此我们将别无选择。 此外，在像我们这样的大国中，国家的区域划分也可以发挥作用，方法是将Petropavlovsk-Kamchatsky <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://mirror.vilkam.ru</a>的镜子放在清单顶部，以索契的客户为重。 因此，最好从该列表中评估镜像的可用性。 这是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">由最快的镜像</a>插件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">完成的</a> 。 其实质简化为一个简单的动作： <br><br><pre> <code class="python hljs">time_before = time.time() sock.connect((self.host, self.port)) result = time.time() - time_before</code> </pre><br> 没有<code>HTTP</code>或<code>ICMP</code> ，打开节点的套接字，考虑花费了多少时间，对结果应用<code>sort()</code> 。 上一步中获得的所有10个镜像均以完整<code>URL</code>的形式作为参数发送，其中仅使用主机名。 该插件易于与<code>yum</code>分开工作，只需注释掉第52和55行： <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># from yum.plugins import TYPE_CORE requires_api_version = '2.5' # plugin_type = (TYPE_CORE,)</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">并且可以使用。</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ ./fastestmirror.py http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ http://dedic.sh/centos/7.7.1908/os/x86_64/ http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/ http://mirror.awanti.com/centos/7.7.1908/os/x86_64/ http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/repodata/repodm.xml http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/ http://mirror.docker.ru/centos/7.7.1908/os/x86_64/ http://mirror.logol.ru/centos/7.7.1908/os/x86_64/ http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/ http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/ http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/ http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/ * mirror.corbina.net : 0.085000 secs * mirrors.powernet.com.ru : 0.097000 secs * mirror.sale-dedic.com : 0.117000 secs * ftp.nsc.ru : 0.181000 secs * mirror.reconn.ru : 0.184000 secs * mirror.yandex.ru : 0.222000 secs * dedic.sh : 0.261000 secs * mirror.tversu.ru : 0.295000 secs * mirror.awanti.com : 0.345000 secs * mirror.linux-ia64.org : 0.386000 secs * mirrors.datahouse.ru : 0.403000 secs * mirror.docker.ru : 0.435000 secs * mirror.logol.ru : 0.474000 secs * centos-mirror.rbc.ru : 0.519000 secs * mirror.truenetwork.ru : 0.587000 secs * mirror.axelname.ru : 0.528000 secs * mirror.vilkam.ru : 0.709000 secs Result: [<span class="hljs-string"><span class="hljs-string">'http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://dedic.sh/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.awanti.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.docker.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.logol.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/'</span></span>]</code> </pre></div></div><br> 处理是在多个线程中进行的，因此您不必等待很长时间，即使对于俄罗斯列出的所有17个镜像也是如此。 工作的结果以两个列表的形式进行了调试，并且未进行排序，尽管看起来似乎是这样，但它们以两个列表的形式显示了执行时间。 在<code>Result</code>从较小的响应到较大的响应排序之后的第二秒，是他按接收到的顺序用于进一步的工作。 <br><br>  <a href="">Dnf</a>还使用RPM库集中的<a href="">最快镜像</a> ，但是在那里可以通过<code>libcurl</code>解决，并且一般来说，所有操作都比较复杂。 <br><br> 最后，这完全取决于接收到来自镜像的响应的速度，同时应考虑缓存，即，并非总是直接计算延迟。 时间间隔受本地计算机的内部性能及其工作负载的影响很大。 显示相似结果的关闭节点可能会经常更改位置。 但是在这里实现了这一目标，在我看来，主要目标不是将索契的一个节点更新到彼得罗巴甫洛夫斯克-堪察加，去莫斯科或伏尔加格勒是可以接受的。 我们还要注意什么，是从<code>fastestmirror</code>之前第一步收到的列表中进行选择的，如果此数据尚未在缓存中，则第一次尝试时最接近的镜像可能不是最佳的，仅仅是因为即使不进入也不会对其进行分析前十名。 <br><br> 实际上，每周一次的调查每10分钟获得以下第一名的结果。  <code>fastestmirror</code>比较<code>fastestmirror</code>和<code>fastestmirror</code>期间在比较中赢得了多少个节点的次数： <br><blockquote> <code>1422,1013 mirror.logol.ru <br> 534,986 mirror.docker.ru <br> 28,8 mirrors.datahouse.ru <br> 16 centos-mirror.rbc.ru <br> 6 mirror.sale-dedic.com <br> 5,7 mirror.reconn.ru <br> 2 dedic.sh <br> 1 mirror.corbina.net</code> </blockquote> <br> 和IPv6版本列表： <br><blockquote> <code>1989,1980 mirror.reconn.ru <br> 18,34 mirror.sale-dedic.com <br> 7 dedic.sh <br></code> </blockquote><br> 可以看出，选择并不是直接明确的，但是在这里，我进行调查的起点附近很可能会起作用-多达几面镜子，相差不到一毫秒。 第二点，IPv6列表不同，而且更糟-最近的IPv6主机比最近的IPv4主机更远，选择范围更小。 鉴于IPv6的优先级不是很好。  <code>fping</code>的结果<code>fping</code>简洁，获胜的节点更少，但通常与<code>fastestmirror</code>相同。 <br><br><h2> 成熟的地图集 </h2><br> 有了本地选择，一切都差不多了，现在让我们看看整个国家的情况。 我们为什么要使用服务<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://atlas.ripe.net/-</a>在RIPE NCC的主持下，一组用于与它们一起工作的探针（探针）和工具，我会立即警告您，这不是最快，最灵活的网站。 任何人都可以进行探查，也可以使用此网络。 但是要运行测试，您需要一种内部货币，该内部货币是从您注册之后并处于活动状态的设备中累积的。 在俄罗斯，我选择了同时支持IPv6和IPv4的所有设备，其中有82台设备被淘汰，根据测量结果，必须淘汰其中的一部分，因此<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在400多个设备中</a> ，有67 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">个设备</a>仍然存在。 <br><br> 您可以运行多种测试选项，当然， <code>fastestmirror</code>没有使用什么<code>fastestmirror</code> ，但是有定期的<code>ping</code> 。 对于所有镜像， <code>mirror.linux-ia64.org</code>要每3小时从所有选定的设备（分别针对IPv6和IPv4 <code>ICMP</code>筛选出<code>ICMP</code>的<code>mirror.linux-ia64.org</code>和完成测试后出现的<code>mirror.linux-ia64.org</code>除外。每个请求10个。 记录平均响应时间。 在整个测量中，每个反射镜约50个，取中值并将其与该探头上的其他反射镜进行比较。 响应时间最短的镜子获胜。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/ap/gf/cgapgfond47sh3phyalhc30s0na.jpeg" alt="镜子和探针图"></div><br> 探针（蓝色标记）和反射镜（红色标记）分布不均匀，并且倾向于大写字母，因此不应将结果视为重要的东西。 原始数据从测量编号<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">23159879</a>到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">23159901</a>开始可用，如果需要，可以对它们进行更严格的分析。  IPv4的首位汇总总数： <br><blockquote> <code>22 mirror.docker.ru <br> 12 mirror.awanti.com <br> 10 centos-mirror.rbc.ru <br> 6 dedic.sh <br> 4 mirror.truenetwork.ru <br> 3 mirror.corbina.net <br> 3 mirrors.powernet.com.ru <br> 2 ftp.nsc.ru <br> 2 mirrors.datahouse.ru <br> 1 mirror.reconn.ru <br> 1 mirror.vilkam.ru <br> 1 mirror.yandex.ru <br></code> </blockquote><br> 和IPv6： <br><blockquote> <code>20 dedic.sh <br> 20 mirror.reconn.ru <br> 10 mirror.yandex.ru <br> 8 mirror.sale-dedic.com <br> 5 ftp.nsc.ru <br> 3 mirror.corbina.net <br> 1 mirrors.powernet.com.ru <br></code> </blockquote><br> 可以说，对于几乎所有的镜子，我都会提醒他们有17个消费者。 有趣的<code>mirror.yandex.ru</code> <code>mirror.vilkam.ru</code>和Petropavlovsk-Kamchatsky的<code>mirror.vilkam.ru</code>一起<code>mirror.yandex.ru</code>在最后。 同时，Yandex几乎可以在任何地方使用，每次都失去一点响应能力，但是<code>mirror.vilkam.ru</code>赢了一次，但与哈巴罗夫斯克（ <code>mirror.vilkam.ru</code>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">6606探针</a>相比，坦白地说，它比其他人还多： <br><blockquote> <code>centos-mirror.rbc.ru,105.4163369 <br> dedic.sh,109.2160474 <br> ftp.nsc.ru,106.4012836 <br> mirror.awanti.com,107.0802782 <br> mirror.corbina.net,98.5339837 <br> mirror.docker.ru,102.7883347 <br> mirror.logol.ru,105.9588192 <br> mirror.reconn.ru,106.5717624 <br> mirror.sale-dedic.com,106.1676841 <br> mirror.truenetwork.ru,110.9780753 <br> mirror.tversu.ru,107.9966083 <br> mirror.vilkam.ru,25.1486164 <br> mirror.yandex.ru,99.7320257 <br> mirrors.datahouse.ru,103.6546383 <br> mirrors.powernet.com.ru,116.4087614 <br></code> </blockquote><br> 最好的结果在1毫秒或几毫秒的范围内，而最差的结果在Salekhard的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">探针22767</a>中响应： <br><blockquote> <code>centos-mirror.rbc.ru,59.9632155 <br> dedic.sh,63.765421 <br> ftp.nsc.ru,59.349309 <br> mirror.awanti.com,75.8998928571 <br> mirror.corbina.net,59.906047 <br> mirror.docker.ru,65.8720585 <br> mirror.logol.ru,63.2041255 <br> mirror.reconn.ru,63.7120505 <br> mirror.sale-dedic.com,63.052342 <br> mirror.truenetwork.ru,61.2567465 <br> mirror.tversu.ru,66.2593372222 <br> mirror.vilkam.ru,138.3730595 <br> mirror.yandex.ru,63.4150445 <br> mirrors.datahouse.ru,59.304435 <br> mirrors.powernet.com.ru,78.7411795 <br></code> </blockquote><br><h2> 后记 </h2><br> 对于那些到达这个地方的人，我将回答将会提出的问题-我们的镜像<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://mirrors.powernet.com.ru</a> ，下面是它的用法： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nl/rm/nb/nlrmnbe9g8tnuvym2u6jlyurnzc.png" alt="mirrors.powernet.com.ru数据流量"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tk/99/rn/tk99rnmoigycgl4ataoygkhs100.png" alt="mirrors.powernet.com.ru带宽流量"></div><br> 此外，来自我们网络的流量份额可以忽略不计。 <br><br> 这是地方的结束方式： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/qk/zc/apqkzcw2htintu4idmjk5sixyfk.png" alt="mirrors.powernet.com.ru磁盘"></div><br> 当我们添加新的分发时，很容易区分的步骤。 当一切开始时，是VirtualBox在办公室计算机上的Windows上运行，该办公室中存储了我们广告部门的视频档案。 然后我们转到了战斗虚拟化系统，它变得容易一些： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/po/nl/hq/ponlhqp1327wrr6hmvpczednm8q.png" alt="图片"></div><br> 为了进行比较， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mirror.truenetwork.ru</a>从两台服务器返回3 Gb / s的流量。 一切对我们来说都比较温和，总的来说，这足以让我们享受流程，以及当有人在更新系统时注意到突然熟悉的台词时，来自朋友和订户的罕见而热情的评论。 而且，有时在各种文章和手册中，背景在闪烁，在日志或屏幕截图中可以看到指向我们镜像的链接。 <br><br> 您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处查看</a> Centos中所有已知镜像的状态，并在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>了解如何加入该项目，它既简单又负责，但当然也没有用。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN476262/">https://habr.com/ru/post/zh-CN476262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN476252/index.html">邮件迁移：如何轻松地从一台服务器移动到另一台服务器</a></li>
<li><a href="../zh-CN476254/index.html">从学生到事件，或者如何在没有知识和经验的情况下进入IT公司</a></li>
<li><a href="../zh-CN476256/index.html">在俄罗斯斯卡拉运动的脚步。 第三部分</a></li>
<li><a href="../zh-CN476258/index.html">GitLab数据库迁移到外部PostgreSQL</a></li>
<li><a href="../zh-CN476260/index.html">我们在rpm WireMock中收集-一个实用程序，用于在Ubuntu的PPA的Fedora COPR类似物中通过Web服务创建存根</a></li>
<li><a href="../zh-CN476264/index.html">用于学习外语的电报机器人：从填字游戏到说话</a></li>
<li><a href="../zh-CN476266/index.html">在Mars Digital Technologies实习。 我们如何在M＆M's应用深度学习</a></li>
<li><a href="../zh-CN476268/index.html">PVS-Studio团队在2018-2019年会议上提供的Bug发现挑战解决方案</a></li>
<li><a href="../zh-CN476270/index.html">我们的胜利：TopCoder Open 2019</a></li>
<li><a href="../zh-CN476272/index.html">在2018-2019年会议的PVS-Studio展位上回答任务</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>