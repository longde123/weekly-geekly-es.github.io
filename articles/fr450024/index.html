<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíë üÜí üçø √Ä propos des impl√©mentations open source de la fonction de hachage GOST R 34.11-2012 et leur impact sur la signature √©lectronique de GOST R 34.10-2012 üóØÔ∏è üèùÔ∏è üë®üèª‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä un moment donn√©, l'impl√©mentation d'algorithmes cryptographiques nationaux dans la biblioth√®que libgcrypt m'a beaucoup inspir√©. Il est devenu possib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√Ä propos des impl√©mentations open source de la fonction de hachage GOST R 34.11-2012 et leur impact sur la signature √©lectronique de GOST R 34.10-2012</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450024/"><img src="https://habrastorage.org/webt/_f/ce/y_/_fcey_1t2afkou2xu5zql3xuzbk.png" align="left">  √Ä un moment donn√©, l'impl√©mentation d'algorithmes cryptographiques nationaux dans la biblioth√®que libgcrypt m'a beaucoup inspir√©.  Il est devenu possible d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ces algorithmes</a> dans Kleopatra et dans Kmail et GnuPg en g√©n√©ral, pour consid√©rer la biblioth√®que libgcrypt comme une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">alternative √† openssl</a> avec le moteur GOST.  Et tout √©tait super jusqu'√† vendredi dernier. <br><a name="habracut"></a><br>  On m'a demand√© de v√©rifier la signature √©lectronique de GOST R 34.10-2012-256 pour un document cr√©√© dans Microsoft Office sur MS Windows.  Et j'ai d√©cid√© de le v√©rifier dans Kleopatra (j'ai Linux).  Et qu'en pensez-vous, la signature s'est av√©r√©e fausse.  Des doutes se sont gliss√©s.  J'ai d√©cid√© de v√©rifier sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">openssl avec le</a> moteur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GOST</a> .  La signature a √©t√© v√©rifi√©e avec succ√®s.  Re-sign√© d'urgence le fichier dans Kleopatra et il n'a pas r√©ussi le contr√¥le sur MS Windows.  Nous avons essay√© de signer et de v√©rifier d'autres fichiers, tout allait bien.  La question √©tait quel est le probl√®me?  Le hachage du document √©tant impliqu√© dans la signature, il a √©t√© d√©cid√© de v√©rifier le calcul du hachage par diff√©rents programmes.  Tout d'abord, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des impl√©mentations open-source pour stribog ont √©t√© impliqu√©es</a> : <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La fameuse impl√©mentation de Degtyarev</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Impl√©mentation de Libgcrypt</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Libressl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Moteur openssl</a> </li></ul><br>  Et puis il y a eu un choc!  Le hachage calcul√© par la "c√©l√®bre impl√©mentation de Degtyarev" co√Øncidait avec le hachage calcul√© en openssl avec le GOST endine, mais ne correspondait pas √† la valeur de hachage calcul√©e √† l'aide de libgcrypt et libressl. <br><br>  Comment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ru_crypt</a> avait raison quand il a √©crit au d√©but de son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> : <br><blockquote>  Je vous pr√©viens imm√©diatement que je n'ai pas v√©rifi√© l'exactitude des impl√©mentations. </blockquote><br>  Soit dit en passant, la norme GOST R 34.10-2012 indique √©galement que les exemples de contr√¥le sont fournis √† titre indicatif uniquement.  Il faut bien comprendre que les cas de test ne garantissent pas que diff√©rentes impl√©mentations donnent le m√™me r√©sultat pour toutes les occasions. <br><br>  Pour calculer les valeurs de hachage, les utilitaires suivants ont √©t√© utilis√©s: <br><br>  1) openssl <br><br><pre><code class="bash hljs">$ openssl dgst [‚Äìmd_gost12_256|-md_gost12_512] &lt;file&gt;</code> </pre> <br>  2) libressl <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$libressl</span></span> dgst [‚Äìstreebog256|streebog512] &lt;file&gt;</code> </pre> <br>  3) libgcrypt <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$gchash</span></span> [stribog256|stribog512] &lt;file&gt;</code> </pre> <br>  4) La fameuse impl√©mentation de Degtyarev <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$gost3411</span></span>-2012 [-2|-5] &lt;file&gt;</code> </pre> <br>  Voici aussi une chose int√©ressante: dans la transcription latine, les stribogs √©crivent soit stribog soit streebog.  Ce serait bien de parvenir √† l'uniformit√©.  Et il semble donc que ce sont des fonctions diff√©rentes.  Personnellement, je pr√©f√®re la premi√®re option - stribog. <br><br>  J'avais besoin d'un arbitre. <br><br>  En tant qu'arbitre, il a √©t√© d√©cid√© d'utiliser le jeton PKCS # 11 RUTOKEN EDS-2.0, qui prend en charge les normes cryptographiques russes GOST R 34.10-2012, GOST R 34.11-2012, VKO GOST R 34.10-2012 (RFC 7836) avec une longueur de cl√© de 256 et 512 bits. et est certifi√© par le FSB de Russie comme moyen de protection des informations cryptographiques (CPSI) et moyen de signature √©lectronique. <br><br>  De plus, le jeton RUTOKEN EDS-2.0 est largement distribu√© et de nombreux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">certificats de magasins y sont</a> stock√©s pour l'acc√®s aux services de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âtat</a> et √† d'autres portails. <br>  Pour calculer la valeur de hachage sur le jeton, nous utiliserons le script test_digest.tcl dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tcl</a> : <br><br><div class="spoiler">  <b class="spoiler_title">test_digest.tcl</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#! /usr/bin/env tclsh package require pki lappend auto_path . package require pki::pkcs11 #     PKCS#11 set pkcs11_module "/usr/local/lib64/librtpkcs11ecp_2.0.so" #set pkcs11_module "/usr/local/lib64/libls11sw2016.so" puts "Connect the Token and press Enter" gets stdin yes set handle [pki::pkcs11::loadmodule $pkcs11_module] set slots [pki::pkcs11::listslots $handle] foreach slotinfo $slots { set slotid [lindex $slotinfo 0] set slotlabel [lindex $slotinfo 1] set slotflags [lindex $slotinfo 2] if {[lsearch -exact $slotflags TOKEN_PRESENT] != -1} { set token_slotlabel $slotlabel set token_slotid $slotid #    break } } proc usage {use error} { puts "Copyright(C) Orlov Vladimir (http://soft.lissi.ru) 2019" if {$use == 1} { puts $error puts "Usage:\ndigest &lt;stribog256|stribog512&gt; &lt;file for digest&gt;\n" } } set countcert [llength $argv] if { $countcert != 2 } { usage 1 "Bad usage!" exit } set digest_algo [lindex $argv 0] if {$digest_algo != "stribog256" &amp;&amp; $digest_algo != "stribog512"} { usage 1 "Bad usage!" exit } set file [lindex $argv 1] if {![file exists $file]} { usage 1 "File $file not exist" exit } puts "Loading file for digest: $file" set fd [open $file] chan configure $fd -translation binary set cert_user [read $fd] close $fd if {$cert_user == "" } { usage 1 "Bad file: $file" exit } set aa [dict create pkcs11_handle $handle pkcs11_slotid $token_slotid] set digest_hex [pki::pkcs11::digest $digest_algo $cert_user $aa] puts "digest_hex=\n$digest_hex" exit</code> </pre> <br></div></div><br>  Quand cette diff√©rence de mise en ≈ìuvre appara√Æt-elle?  Jusqu'√† pr√©sent, il a √©t√© possible de d√©terminer que cette diff√©rence se produit lors du calcul du hachage des fichiers doc cr√©√©s dans MS Office.  De plus, le hachage des 143 premiers octets est consid√©r√© comme le m√™me, et lors du calcul du hachage √† partir de 144 octets, les valeurs sont diff√©rentes. <br><br>  Les 143 premiers octets en hexad√©cimal ressemblent √† ceci: <br><br><pre> <code class="bash hljs">d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff0900060000000000000000000000010000000100000000000000001000002400000001000000feffffff0000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</code> </pre> <br>  Enregistrez-les dans le fichier Doc1_143_hex.txt. <br><br>  Les 144 premiers octets en hexad√©cimal ressemblent √† ceci: <br><br><pre> <code class="bash hljs">d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff0900060000000000000000000000010000000100000000000000001000002400000001000000feffffff0000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</code> </pre> <br>  Enregistrez-les dans le fichier Doc1_144_hex.txt. <br><br>  Il est pratique d'utiliser le script hex2bin.tcl pour traduire de la forme hexad√©cimale en forme binaire: <br><br><pre> <code class="plaintext hljs">#!/usr/bin/tclsh proc usage {use error} { if {$use == 1} { puts $error puts "Usage:\nhex2bin &lt;file with hex&gt; &lt;file for bin&gt;\n" } } set countcert [llength $argv] if { $countcert != 2 } { usage 1 "Bad usage!" exit } set file [lindex $argv 0] if {![file exists $file]} { usage 1 "File $file not exist" exit } set fd [open $file] chan configure $fd -translation binary set cert_user [read $fd] close $fd if {$cert_user == "" } { usage 1 "Bad file with hex: $file" exit } set cert_user [binary format H* $cert_user] set fd [open [lindex $argv 1] w] chan configure $fd -translation binary puts -nonewline $fd $cert_user close $fd</code> </pre> <br>  Convertissez le code hexad√©cimal en binaire: <br><pre> <code class="bash hljs">$./hex2bin Doc1_143_hex.txt Doc1_143.bin $./hex2bin Doc1_144_hex.txt Doc1_144.bin $</code> </pre> <br>  Vous pouvez maintenant v√©rifier comment le hachage est calcul√© par diff√©rentes impl√©mentations: <br>  Tout d'abord, consid√©rez le hachage du fichier Doc1_143, bin: <br><br><pre> <code class="bash hljs">$ ./openssl dgst -md_gost12_256 Doc1_143.bin md_gost12_256(Doc1_143.bin)= e63bd3edc44f9a03fece4198b690a8ae291b973ae61b2a0f512a9a7479431a63 $ ./libressl dgst -streebog256 Doc1_143.bin streebog256(Doc1_143.bin)= e63bd3edc44f9a03fece4198b690a8ae291b973ae61b2a0f512a9a7479431a63 $ ./gchash stribog256 Doc1_143.bin e63bd3edc44f9a03fece4198b690a8ae291b973ae61b2a0f512a9a7479431a63 Doc1_143.bin $ ./gost3411-2012 -2 Doc1_143.bin GOST R 34.11-2012 (Doc1_143.bin) = e63bd3edc44f9a03fece4198b690a8ae291b973ae61b2a0f512a9a7479431a63 $</code> </pre> <br>  Le moment le plus important est venu, le moment de la v√©rification sur un syst√®me de protection des informations cryptographiques certifi√©: <br><br><pre> <code class="bash hljs">$ ./test_digest.tcl stribog256 Doc1_143.bin Connect the Token and press Enter Loading file <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> digest: Doc1_143.bin digest_hex= e63bd3edc44f9a03fece4198b690a8ae291b973ae61b2a0f512a9a7479431a63 $</code> </pre> <br>  Comme vous pouvez le voir, tout s'est termin√© pour de bon. <br><br>  Voyons ce qui se passe pour le fichier Doc1_144.bin: <br><br><pre> <code class="bash hljs">$ ./openssl dgst -md_gost12_256 Doc1_144.bin md_gost12_256(Doc1_144.bin)= c766085540caaa8953bfcf7a1ba220619cee50d65dc242f82f23ba4b180b18e0 $ ./libressl dgst -streebog256 Doc1_144.bin streebog256(Doc1_144.bin)= 3965c99777eb1b64c783496fe950aa6540bc7baa399a3889995145afbdd76250 $</code> </pre> <br>  Voil√†, les valeurs des hachages ne correspondent pas.  Pour la puret√© de l'exp√©rience, nous v√©rifions les impl√©mentations restantes: <br><br><pre> <code class="bash hljs">$ ./gchash_1.7.10 stribog256 Doc1_144.bin 3965c99777eb1b64c783496fe950aa6540bc7baa399a3889995145afbdd76250 Doc1_144.bin $ ./gost3411-2012 -2 Doc1_144.bin GOST R 34.11-2012 (Doc1_144.bin) = c766085540caaa8953bfcf7a1ba220619cee50d65dc242f82f23ba4b180b18e0 $ ./test_digest.tcl stribog256 Doc1_144.bin Connect the Token and press Enter Loading file <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> digest: Doc1_144.bin digest_hex= c766085540caaa8953bfcf7a1ba220619cee50d65dc242f82f23ba4b180b18e0 $</code> </pre> <br>  Le hachage calcul√© par la "c√©l√®bre impl√©mentation de Degtyarev" correspond au hachage calcul√© dans openssl avec le moteur GOST, mais ne correspond pas √† la valeur de hachage calcul√©e √† l'aide de libgcrypt et libressl. <br><br>  Nous obtenons un r√©sultat similaire si nous consid√©rons le hachage stribog512. <br><br>  Il y a une conclusion.  Si vous souhaitez que la signature √©lectronique de GOST R 34.10-2012, g√©n√©r√©e par libressl et libgcrypt (ou peut-√™tre d'autres), soit compatible avec la mise en ≈ìuvre openssl et, surtout, avec la mise en ≈ìuvre dans le CIPF certifi√© dans le syst√®me de certification FSB de Russie, utilisez v√©rifi√© impl√©mentations pour le calcul des hachages.  J'esp√®re que cette publication √©vite de nombreux malentendus, et les auteurs de la mise en ≈ìuvre de stribog dans libressl, libgrypt et peut-√™tre d'autres aideront √† √©liminer ces divergences.  Aujourd'hui, je dois admettre que dans les produits ci-dessus, ce n'est en fait pas GOST R 34.10-2012 qui est impl√©ment√©, mais autre chose.  Il s'agit d'un algorithme diff√©rent.  L'exemple de test donn√© serait probablement int√©ressant √† inclure comme exemple de test pour GOST R 34.10-2012.  Et je vais √©diter libgcrypt pour Kleopatra et KMail.  La l√©gende de Cl√©opart et de la cryptographie russe √©tait inachev√©e. <br><br>  PS L'article √©tait d√©j√† pr√™t lorsque mon coll√®gue a dit que la divergence entre les impl√©mentations appara√Æt lorsqu'une s√©quence suffisamment longue de 0xFF est rencontr√©e.  Elle, d'ailleurs, cette s√©quence est pr√©sente au d√©but des fichiers doc de MS Office.  J'ai v√©rifi√© la fa√ßon dont c'est.  Le fichier contient 189 octets. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450024/">https://habr.com/ru/post/fr450024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450008/index.html">Rechercher des bogues dans LLVM 8 √† l'aide de l'analyseur PVS-Studio</a></li>
<li><a href="../fr450010/index.html">Stockage, sauvegarde et catalogage des photographies</a></li>
<li><a href="../fr450016/index.html">Cr√©ation d'un syst√®me de v√©rification formel √† partir de z√©ro. Partie 1: machine virtuelle de caract√®res en PHP et Python</a></li>
<li><a href="../fr450018/index.html">Un duo de maths a cartographi√© un territoire sans fin de surfaces minimales</a></li>
<li><a href="../fr450020/index.html">La Silicon Valley est venue aux √©coliers du Kansas. Cela a conduit √† des protestations.</a></li>
<li><a href="../fr450026/index.html">Chiffrement d'acc√©l√©ration: nous √©tudions l'acc√©l√©rom√®tre d'un appareil Android √† l'aide de l'exemple de la t√¢che NeoQUEST-2019</a></li>
<li><a href="../fr450028/index.html">Construire une architecture orient√©e services sur Rails + Kafka</a></li>
<li><a href="../fr450030/index.html">Je ne peux pas utiliser Rift S et vous ne r√©ussirez pas non plus</a></li>
<li><a href="../fr450032/index.html">Comment cr√©er un th√®me sombre sans casser les choses: apprendre avec l'√©quipe Yandex Mail</a></li>
<li><a href="../fr450034/index.html">Pourquoi vous devriez participer aux hackathons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>