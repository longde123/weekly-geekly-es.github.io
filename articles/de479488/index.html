<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„äóÔ∏è ü¶ó ‚ö†Ô∏è Von einem Laptop - ein Heimserver mit redundanter Stromversorgung f√ºr den Mikrotik-Router ü§Ωüèº üç± üòò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kurz 
 Ein Artikel, in dem Fans einfache Schemata selbst l√∂ten und herausfinden k√∂nnen, warum sie so hergestellt werden. 

 Und auch f√ºr diejenigen, d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Von einem Laptop - ein Heimserver mit redundanter Stromversorgung f√ºr den Mikrotik-Router</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479488/"><img src="https://habrastorage.org/webt/pl/gi/hh/plgihhkmxbo7cvnzhnbtwwdi85w.jpeg"><br><br><h1>  Kurz </h1><br>  Ein Artikel, in dem Fans einfache Schemata selbst l√∂ten und herausfinden k√∂nnen, warum sie so hergestellt werden. <br><br>  Und auch f√ºr diejenigen, die einen solchen Server wirklich brauchen. <br><br>  Hier gibt es keine Superleistungen, aber es gibt eine billige, kompakte und kosteng√ºnstige L√∂sung, die in einigen F√§llen eine umfangreiche Ausr√ºstung ersetzt: <br><br><ul><li>  einen Heimserver aus einem alten Laptop und einem Router-Netzteil gemacht, </li><li>  erkl√§rt das Energieschema des Routers aus Lade- und Laptop-Akku, </li><li>  Das Schema zum Einschalten des Laptops beim Einschalten wird erl√§utert. </li></ul><a name="habracut"></a><br><h1>  Idee </h1><br>  Ich brauchte einen kleinen Dateiserver, der auch Stromausf√§llen von bis zu 15 Minuten standhalten musste. <br><br>  Ich beschloss, es von einem alten Laptop zu machen. <br><br>  Ein Laptop (Asus A8J) wurde speziell f√ºr das Experiment mit einer kaputten Matrix, aber mit einem aktiven Akku und einem L√ºfter gekauft. <br><br>  <i>(Hinweis: Wenn Sie bereits einen Laptop haben, ist es nicht erforderlich, die Matrix zu brechen, wie bei der bekannten Aufgabe zum Wasserkocher. Wenn Ihr Router jedoch wie meiner mit einem 4G-Modem arbeitet, ist es besser, die Matrix zu deaktivieren, und ich werde erkl√§ren, warum.</i> <i><br><br></i>  <i>Das Arbeiten ohne Matrix ist unangenehm. Verwenden Sie zuerst einen externen Monitor und dann SSH.)</i> <br><br>  Dabei machte ich auf die Tatsache aufmerksam, dass der Mikrotik-Router (ich habe RB-951G) von 9 bis 30 V mit Strom versorgt werden kann, und es entstand die Idee, ihn von einem Laptop aus zu speisen. <br><br>  Es stellte sich als sehr erfolgreiche Kombination heraus: Bei vorhandener Netzspannung wird der Router vom Laptop-Ladeger√§t (19-20 V) und bei einem Netzausfall vom Akku desselben Laptops (12 bis 9 V, wenn dieser entladen ist) mit Strom versorgt, d. H.  alles ist in normalen Grenzen. <br><br>  <i>Genauer gesagt wird die Spannung am Router aufgrund eines Abfalls der Dioden um 0,2 bis 0,4 V niedriger sein, aber immer noch im akzeptablen Bereich (mit Ausnahme der unteren Grenze der Batterieentladung, die wir nicht sicher kennen, aber in meinem Fall ist es unwahrscheinlich, dass sie erreicht wird .</i> <i><br><br></i>  <i>Und wenn ja, passiert dem Router nichts Schlimmes.</i> <br><br><h1>  Router-Energieschema </h1><br><img src="https://habrastorage.org/webt/x8/ym/3x/x8ym3xsabcnw62ea6dmynhylwic.jpeg"><br><br>  Da hier eine h√∂here Spannung (20 V) Vorrang hat, ist der Schaltkreis sehr einfach und besteht aus zwei Dioden. <br><br>  Es ist auch zweckm√§√üig, dass kein Spannungsschutz notwendig ist. <br><br>  Bei l√§ngerer Abwesenheit des Netzwerks wird die Batterie bis zu dem Punkt entladen, an dem der eingebaute Controller die Last abschaltet und somit keine √úberentladung auftritt. <br><br>  Wenn die Stromversorgung eingeschaltet wird, beginnt der Akku zu laden und der Router wird vom Ladeger√§t mit Strom versorgt. <br><br>  <i>Theoretisch k√∂nnen wir in einem erfolglosen Fall den zul√§ssigen Strom des Ladeger√§ts und / oder des Akkus √ºberschreiten (da wir den zus√§tzlichen Strom von 0,4 bis 0,8 A mit 20 V zum Router f√ºhren), aber in der Praxis tritt der √úberstrom nicht auf, und dies ist der Grund: Ich habe das DVD-Laufwerk vom Laptop, dem Controller, entfernt WIFI sowie die Matrix.</i>  <i>Dementsprechend sank der Stromverbrauch.</i> <br><br>  Um die Spannungsverluste zu reduzieren, haben wir Schottky-Dioden ausgew√§hlt. Insbesondere habe ich eine Baugruppe aus zwei Dioden (ich erinnere mich nicht an den Typ) verwendet, die in Computer-Netzteilen enthalten sind und wie ein leistungsstarker Transistor aussehen. <br><br>  <i>Die Stromaufnahme des Routers zusammen mit dem darin enthaltenen 4G-Modem kann im schlimmsten Fall bis zu 1,7 A betragen - bei einer Stromversorgung von 9 V.</i> <i><br><br></i>  <i>(Das Schaltnetzteil im Router verbraucht konstant Strom. Je niedriger die Eingangsspannung, desto h√∂her der Stromverbrauch.)</i> <br><br>  Best√ºckungsdioden halten einem Dauerstrom von 20 A stand, und das ist auch praktisch. <br><br>  Sie m√ºssen nicht gegen Ausgangskurzschl√ºsse sch√ºtzen.  Diese Rolle wird, wenn √ºberhaupt, von internen Lade- und Batterieschutzschaltungen √ºbernommen. <br><br>  Wenn jemand separate Schottky-Dioden verwenden m√∂chte, muss er diese f√ºr einen Strom von mindestens 5 A und mindestens geringf√ºgig k√ºhlen, z. B. durch die Leiterbahnen auf der Platine. <br><br><h1>  Notebook-Schaltung </h1><br><img src="https://habrastorage.org/webt/tz/lz/aw/tzlzawj3w4knkung90wa0vakney.jpeg"><br><br>  Es gab aber noch ein anderes Problem: Der Laptop selbst schaltet sich nicht ein, wenn die Netzspannung angezeigt wird.  <i>Es gibt keine solche Option im BIOS.</i>  <i>(Aus irgendeinem Grund verf√ºgen viele Laptops nicht √ºber eine Reihe n√ºtzlicher Funktionen, z. B. k√∂nnen sie immer noch nicht von der Speicherkarte gebootet werden.)</i> <br><br>  Obwohl solche Unterbrechungen, um den Akku vollst√§ndig zu entladen, praktisch nicht vorkommen, wollte ich diese Frage schon beenden. <br><br>  Auf meinem Laptop schlie√üt der Netzschalter den Stromkreis auf Minus (wahrscheinlich auch Ihren). <br><br>  Am selben Eingang habe ich den Draht vom Anschluss meines Ger√§ts gel√∂tet. <br><br>  Im Ger√§t wird dieser Eingang durch einen Minus-Transistor geschlossen, der Laptop schaltet sich ein. <br><br>  Um den Transistor bei unsachgem√§√üer Beschaltung zu sch√ºtzen, wurde der Kollektorschaltung ein Widerstand R8 hinzugef√ºgt. <br><br>  Es wird √ºberpr√ºft, ob sich der Laptop stabil einschaltet, selbst wenn dieser Widerstand um das Dreifache erh√∂ht wird.  (Dies ist auch besser f√ºr Sie, um auf Ihrem Laptop zu √ºberpr√ºfen, da die Eingabeparameter der Taste variieren k√∂nnen). <br><br>  Zur Steuerung des Transistors wurde ein RC-Impulsgenerator auf einem CD4093-Chip mit Schmitt-Triggern und Elementen R4, R5, C3 hergestellt.  Die Dauer des Impulses und Pause f√ºr ca. 1 s, Genauigkeit ist nicht wichtig. <br><br>  Es ist wichtig, dass der Betrieb des Generators mit einer Pause beginnt. <br><br>  <i>Und hier ist der Grund, warum ich einen Impulsgenerator gemacht habe: Mein Laptop lie√ü sich manchmal nicht einschalten, als ich zum ersten Mal die Taste dr√ºckte, aber er wurde eingeschaltet, als ich die zweite Taste dr√ºckte. Ich wei√ü nicht warum.</i>  <i>In jedem Fall erwies es sich als universelle und zuverl√§ssige L√∂sung.</i> <br><br>  Wenn der Laptop eingeschaltet ist, m√ºssen Sie den Knopf nicht mehr ‚Äûdr√ºcken‚Äú und wir stoppen den Generator. <br><br>  Die Schaltung lernt das Einschalten des Laptops mit einem anderen Kabel, das an +5 V eines beliebigen USB-Steckers angel√∂tet ist. <br><br>  <i>Mein Laptop liefert nur + 5V an USB, wenn es eingeschaltet ist.</i> <i><br><br></i>  <i>(Wenn Ihre USB-Spannung immer anliegt, wenn Sie √ºber das Netzwerk mit Strom versorgt werden, m√ºssen Sie die entsprechende Option im BIOS deaktivieren oder nach einem anderen Verbindungspunkt f√ºr dieses Signal suchen.)</i> <br>  Die Mikroschaltung wird vom +20 V-Eingang √ºber den einfachsten Stabilisator von R1 und VD3 und C2 mit Strom versorgt, um sich vor Stromimpulsen zu sch√ºtzen. <br><br>  Die Stromversorgung dieser Schaltung √ºber +5 V USB wurde ebenfalls so hergestellt, dass bei einem Stromausfall die Generatorleistung nicht abf√§llt und falsche Impulse entstehen, die den Laptop ausschalten k√∂nnen. <br><br>  Beide Stromversorgungen werden √ºber die einfachste Schaltung an zwei Dioden VD1, VD2, ebenso wie am Router, nur sehr stromsparend an die Mikroschaltung geliefert. <br><br><h1>  Aufbau </h1><br><img src="https://habrastorage.org/webt/bg/i3/eb/bgi3ebghkos-hpssa5w7wrsrsie.jpeg"><br><br>  Der Anschluss ist 10-polig: PLD-10 + PBD-10, 2 Dr√§hte werden parallel an den Stromkabeln verwendet. <br><br>  Von den restlichen 4 sind zwei durch den Eingang der Taste und + 5V USB belegt, 2 weitere werden nicht verwendet. <br><br>  <i>Die Position der Kontakte ist so gew√§hlt, dass beim Einschalten des Steckers in umgekehrter Position nichts brennt, der Router mit Strom versorgt wird und die Funktion zum Einschalten des Laptops nicht funktioniert.</i> <br><br>  Das Ger√§t wird auf ein Steckbrett montiert und in einen Schrumpfschlauch gelegt. <br><br>  Es ist keine zus√§tzliche K√ºhlung erforderlich. <br>  Sie k√∂nnen es in das Fach legen, in dem sich das DVD-Laufwerk befand. <br>  Teile k√∂nnen in einem sehr weiten Bereich durch Analoga ersetzt werden. <br>  Ich gebe kein allgemeines Foto, weil  kaputte Laptops und so sahen sie es alle. <br><br><h1>  Was ist passiert? </h1><br><img src="https://habrastorage.org/webt/q0/ym/hx/q0ymhxprycrw8yq0wg_h-szf8ue.jpeg"><br><br>  Es hat seit einem Monat gearbeitet. <br><br>  Der Verbrauch von mindestens 13 Watt (gemessen mit einem Stromz√§hler) bei aktiver Arbeit steigt auf 25 Watt. <br><br>  2 Hardwareprobleme wurden erkannt: <br><br>  Glitch No. 1: Wenn Sie den Ladeanschluss des Laptops ausschalten, wird der Laptop manchmal sofort ausgeschaltet. <br><br>  <i>Dies liegt h√∂chstwahrscheinlich daran, dass ich das Kabel vom Laden zum Ger√§t direkt auf der Platine und sogar mit + 5V USB und dem Kabel vom Taster gef√ºhrt habe.</i> <i><br><br></i>  <i>Wenn Sie den Ladestecker des Kabels abziehen, f√§llt eine Reihe von ziemlich "steilen" Impulsen von +19 auf +12 V und umgekehrt, und sogar mit einem "Sprung", und dies kann durch die Kapazit√§t der Kabel andere Laptop-Schaltungen st√∂ren.</i> <i><br><br></i>  <i>Wenn Sie diesen Anschluss jedoch nicht trennen und den Ladevorgang nicht vom Netzwerk trennen, passiert nichts Schlimmes.</i>  <i>Anscheinend sitzt dann die Spannung am Draht aufgrund der im Ladevorgang befindlichen Kondensatoren langsam und es treten keine St√∂rungen auf.</i> <br><br>  Ich habe die Installation nicht repariert, aber im Allgemeinen lohnt es sich nat√ºrlich nicht, die Dr√§hte so wie ich auf der Leiterplatte zu verlegen.  Sie m√ºssen irgendwie abgeschirmt oder au√üerhalb des Laptops oder zumindest vom Board entfernt getragen werden.  (Es ist ein bisschen so, dass alle meine Dr√§hte eine konstante Spannung haben.) <br>  Der Kondensator C1 zwischen dem Minus und dem Plus des Ladevorgangs wurde hinzugef√ºgt, und es scheint, dass der Fehler Nr. 1 verschwunden ist. <br><br>  Glitch No. 2: Der Laptop konnte nicht mit einem Knopf ausgeschaltet werden. <br><br>  Um den Laptop korrekt auszuschalten, schalten Sie zuerst die Stromversorgung aus (trennen Sie das Laden nur f√ºr den Fall vom Netzwerk, nicht vom Laptop, wie wir es aus fr√ºheren Erfahrungen kennen). <br>  Und dann dr√ºcken wir den Ein- / Ausschalter.  Das Betriebssystem wird heruntergefahren und der Laptop ausgeschaltet. <br><br>  ABER.  In diesem Moment liegt noch Spannung an den USB-Leistungskondensatoren (da keine Ger√§te verbraucht werden) im Laptop an, es setzt sich langsam hin und irgendwann gibt die Schaltung einen falschen Impuls an die Taste und der Laptop schaltet sich wieder ein! <br><br>  <i>Um dies zu verhindern, wurde ein R2-Widerstand hinzugef√ºgt, der es schafft, die Kondensatoren in einer Sekunde zu entladen, und alles wurde normal.</i>  <i>Wenn Sie ein solches Problem haben, sollte der Widerstand um den Faktor 2 reduziert werden. Es lohnt sich nicht, den Widerstand zu niedrig zu machen, weil</i>  <i>er wird sich aalen.</i> <i><br><br></i>  <i>Dies erh√∂ht den Energieverbrauch praktisch nicht.</i> <br><br><h1>  Betriebssystem und Programme </h1><br>  Ich habe Ubuntu Server 14.04 installiert und Samba konfiguriert, alles funktioniert und das reicht f√ºrs Erste. <br><br>  Es gab folgende Nachteile: <br><br>  1) Der Laptop-L√ºfter war unabh√§ngig von der Prozessorauslastung sehr laut. <br><br>  Ich habe das Fancontrol-Programm ausprobiert, aber sie konnte keinen Zugriff auf die L√ºftersteuerung finden. <br>  Beim St√∂bern im Internet wurde ein anderes Programm gefunden: asusfan, die freundlichen Leute, die einst speziell f√ºr mein Laptop-Modell gemacht wurden.  Es hat sofort nach der Kompilierung und Installation funktioniert, und jetzt wird der L√ºfter automatisch geregelt und macht nur wenig Ger√§usche, und die Ressource wird gespart. <br><br>  2) Mit dem Befehl hdparm -S 241 / dev / sda kann die Festplatte nicht f√ºr die Nacht angehalten werden. <br><br>  Das Protokollierungsprogramm jbd2 ‚Äûzieht‚Äú es alle 5-10 Minuten, auch wenn eine Stunde lang keine Aktion ausgef√ºhrt wurde. <br><br>  Die Foren schreiben, dass dies ein nicht behebbares Problem mit dem ext4-Dateisystem oder dessen Implementierung in Ubuntu ist. <br><br>  Dann werde ich versuchen, zu xfs (oder vielleicht zu SSD) zu wechseln, aber im Moment - "Und so geht es!" (C). <br><br><h1>  Weitere Ideen (die in diesem Stadium bleiben) </h1><br><ul><li>  Stellen Sie bei einigen Ger√§ten wie dem GSM-Relay eine unabh√§ngige Verbindung her, um das System neu zu starten. </li><li>  Stellen Sie auf demselben GSM-Ger√§t eine Verbindung her, um ein USB-Flash-Laufwerk √ºber Fernzugriff mit einem "Backup" -System zu verbinden, damit Sie von diesem System booten und die Konfiguration korrigieren k√∂nnen, wenn das Hauptsystem nicht bootet. </li></ul><br>  Warum √ºber GSM, nicht √ºber Ethernet? <br><br>  Erstens wegen der m√∂glichen Schwachstellen von Ethernet-Controllern, von denen ich irgendwo geh√∂rt habe. <br>  Zweitens m√ºssen Sie m√∂glicherweise den Router neu starten, d. H.  brauchen ein unabh√§ngiges System. <br><br>  Aber die Mikrotik-Router sind in dieser Hinsicht ziemlich zuverl√§ssig und daher ist dies eigentlich nicht erforderlich, und der Server scheint auch ohne Fragen zu funktionieren. <br><br><h1>  Danksagung </h1><br>  Der Router hat mir (zu 99%) geholfen, den Kameraden @rifei zu konfigurieren, wof√ºr ich ihm vielmals danke. <br><br>  Und auch all jenen, die im Internet Anweisungen wie "wie man das Programm auf Ubuntu 14.04 ausf√ºhrt" usw. schrieben, da ich selbst eine komplette Teekanne darin bin, aber durch das Lesen von 100500 solcher Anweisungen habe ich es geschafft, alles einzurichten. <br><br>  Und separat - f√ºr diejenigen, die alle m√∂glichen n√ºtzlichen Programme erstellt und ver√∂ffentlicht haben, die hier erw√§hnt und nicht erw√§hnt werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de479488/">https://habr.com/ru/post/de479488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de479474/index.html">Warum ist die Selbstorganisation von Teams in Scrum so wichtig und warum kann es keine Manager geben?</a></li>
<li><a href="../de479478/index.html">Java-Plug-In ohne Schmerzen</a></li>
<li><a href="../de479480/index.html">SARIF SDK und seine Fehler</a></li>
<li><a href="../de479482/index.html">SARIF SDK und seine Fehler</a></li>
<li><a href="../de479486/index.html">Heterogene Programmierung und oneAPI Toolkit. Der improvisierte Vortrag von Intel-Experten beantwortet Ihre Fragen</a></li>
<li><a href="../de479492/index.html">Serverloses Rechnen basierend auf OpenWhisk, Teil 3</a></li>
<li><a href="../de479496/index.html">Analysieren von WTF-Aufgaben in JavaScript</a></li>
<li><a href="../de479498/index.html">Wie aus linearer Zeit Windows in O (n¬≤) wird</a></li>
<li><a href="../de479502/index.html">Wie √ºberlebt man die schwerste Eiszeit der Erdgeschichte?</a></li>
<li><a href="../de479504/index.html">Erstellen Sie einen auf Raspberry Pi basierenden RDP Thin Client</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>