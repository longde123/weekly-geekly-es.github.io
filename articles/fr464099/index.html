<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ üó£Ô∏è ü§Ωüèº Analyse du langage VKScript: JavaScript, √™tes-vous? üöÇ üëéüèø üêè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR 



 VKScript n'est pas JavaScript. La s√©mantique de ce langage est fondamentalement diff√©rente de la s√©mantique de JavaScript. Voir la conclus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analyse du langage VKScript: JavaScript, √™tes-vous?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464099/"><h1>  TL; DR </h1><br><hr><br><p>  VKScript n'est <b>pas</b> JavaScript.  La s√©mantique de ce langage est fondamentalement diff√©rente de la s√©mantique de JavaScript.  Voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conclusion</a> . </p><br><a name="habracut"></a><h1>  Qu'est-ce que VKScript? </h1><br><hr><br><p> <b>VKScript</b> est un langage de programmation de script de type JavaScript utilis√© dans la m√©thode API d' <code>execute</code> VKontakte, qui permet aux clients de t√©l√©charger exactement les informations dont ils ont besoin.  En substance, VKScript est un analogue de GraphQL utilis√© par Facebook dans le m√™me but. </p><br><p>  Comparez GraphQL et VKScript: </p><br><div class="scrollable-table"><table><tbody><tr><th></th><th>  GraphQL </th><th>  VKScript </th></tr><tr><td>  Impl√©mentations </td><td>  De nombreuses impl√©mentations open source dans diff√©rents langages de programmation </td><td>  La seule impl√©mentation au sein de l'API VK </td></tr><tr><td>  Bas√© sur </td><td>  Nouvelle langue </td><td>  Javascript </td></tr><tr><td>  Les possibilit√©s </td><td>  Demande de donn√©es, filtrage limit√©;  les arguments de requ√™te ne peuvent pas utiliser les r√©sultats des requ√™tes pr√©c√©dentes </td><td>  Tout post-traitement de donn√©es √† la discr√©tion du client;  Les requ√™tes API sont pr√©sent√©es sous forme de m√©thodes et peuvent utiliser toutes les donn√©es des requ√™tes pr√©c√©dentes </td></tr></tbody></table></div><br><p>  Description de VKScript √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page de m√©thode dans la documentation de l'API VK</a> (la seule documentation en langue officielle): </p><br><blockquote><div class="scrollable-table"><table><tbody><tr><th>  code </th><td>  code d'algorithme en <b>VKScript</b> - un format similaire √† <b>JavaScript</b> ou <b>ActionScript</b> <i>(la compatibilit√© avec <b>ECMAScript est</b> suppos√©e)</i> .  L'algorithme doit se terminer par la commande <b>return% expression%</b> .  Les op√©rateurs doivent √™tre s√©par√©s par des points-virgules. <br>  cha√Æne </td></tr></tbody></table></div><br><p>  Les √©l√©ments suivants sont pris en charge: </p><br><ul><li>  op√©rations arithm√©tiques </li><li>  op√©rations logiques </li><li>  cr√©ation de tableaux et de listes ([X, Y]) </li><li>  <b>parseInt</b> et <b>parseDouble</b> </li><li>  concat√©nation (+) </li><li>  <b>si</b> construire </li><li>  filtre de tableau par param√®tre (@.) </li><li>  Appels de m√©thode <b>API</b> , param√®tre de <b>longueur</b> </li><li>  boucles utilisant l'instruction <b>while</b> </li><li>  M√©thodes Javascript: <b>tranche</b> , <b>push</b> , <b>pop</b> , <b>shift</b> , <b>unshift</b> , <b>splice</b> , <b>substr</b> , <b>split</b> </li><li>  <b>supprimer l'</b> op√©rateur </li><li>  affectation aux √©l√©ments du tableau, par exemple: row.user.action = "test"; </li><li>  recherchez dans un tableau ou une cha√Æne - <b>indexOf</b> , par exemple: ¬´123¬ª .indexOf (2) = 1, [1, 2, 3] .indexOf (3) = 2. Renvoie -1 si l'√©l√©ment n'est pas trouv√©. </li></ul><br><p>  La cr√©ation de fonctions n'est actuellement pas prise en charge. </p><br></blockquote><br><p>  La documentation cit√©e indique que "la compatibilit√© ECMAScript est pr√©vue."  Mais en est-il ainsi?  Essayons de comprendre comment cette langue fonctionne de l'int√©rieur. </p><br><br><h1>  Table des mati√®res </h1><br><hr><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Machine virtuelle VKScript</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©mantique des objets VKScript</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a> </li></ol><br><a name="vm"></a><h1>  Machine virtuelle VKScript </h1><br><hr><br><p>  Comment analyser un programme en l'absence d'une copie locale?  C'est vrai - envoyez des demandes au point de terminaison public et analysez les r√©ponses.  Essayons, par exemple, d'ex√©cuter le code suivant: </p><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>  Nous obtenons une <code>Runtime error occurred during code invocation: Too many operations</code> .  Cela sugg√®re que dans la mise en ≈ìuvre du langage, il y a une limite au nombre d'actions effectu√©es.  Essayons de d√©finir la valeur limite exacte: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <code>Runtime error occurred during code invocation: Too many operations</code> . </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <code>{"response": null}</code> - Le code a √©t√© ex√©cut√© avec succ√®s. </li></ul><br><p>  Ainsi, la limite du nombre d'op√©rations est d'environ 1 000 cycles ¬´inactifs¬ª.  Mais, en m√™me temps, il est clair qu'un tel cycle n'est probablement pas une op√©ration ¬´unitaire¬ª.  Essayons de trouver une op√©ration qui n'est pas divis√©e par le compilateur en plusieurs plus petites. </p><br><p>  Le candidat le plus √©vident pour le r√¥le d'une telle op√©ration est la soi-disant d√©claration vide ( <code>;</code> ).  Cependant, apr√®s avoir ajout√© au code avec <code>i &lt; 999</code> 50 caract√®res <code>;</code>  , la limite n'est pas d√©pass√©e.  Cela signifie que soit l'instruction vide est lev√©e par le compilateur et ne gaspille pas les op√©rations, soit une it√©ration de la boucle prend plus de 50 op√©rations (ce qui n'est probablement pas le cas). </p><br><p>  La prochaine chose qui me vient √† l'esprit apr√®s <code>;</code>  - calcul d'une expression simple (par exemple, comme ceci: <code>1;</code> ).  Essayons d'ajouter certaines de ces expressions √† notre code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    1; //       "Too many operations"</span></span></code> </pre> <br><p>  Ainsi, 2 op√©rations <code>1;</code>  d√©penser plus d'op√©rations que 50 op√©rations <code>;</code>  .  Cela confirme l'hypoth√®se selon laquelle une instruction vide ne gaspille pas les instructions. </p><br><p>  Essayons de r√©duire le nombre d'it√©rations du cycle et ajoutons <code>1;</code> suppl√©mentaire <code>1;</code>  .  Il est facile de remarquer que pour chaque it√©ration il y en a 5 suppl√©mentaires <code>1;</code>  par cons√©quent, une it√©ration du cycle passe 5 fois plus d'op√©rations qu'une op√©ration <code>1;</code>  . </p><br><p>  Mais y a-t-il une op√©ration encore plus simple?  Par exemple, l'ajout de l'op√©rateur unaire <code>~</code> ne n√©cessite pas le calcul d'expressions suppl√©mentaires, et l'op√©ration elle-m√™me est effectu√©e sur le processeur.  Il est logique de supposer que l'ajout de cette op√©ration √† l'expression augmente le nombre total d'op√©rations de 1. </p><br><p>  Ajoutez cet op√©rateur √† notre code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; ~<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><p>  Et oui, nous pouvons ajouter un tel op√©rateur et une autre expression <code>1;</code>  - plus.  Par cons√©quent, <code>1;</code>  n'est vraiment pas un op√©rateur unitaire. </p><br><p>  Similaire √† l'op√©rateur <code>1;</code>  , nous allons r√©duire le nombre d'it√©rations de la boucle et ajouter les op√©rateurs <code>~</code> .  Une it√©ration s'est av√©r√©e √©quivalente √† 10 op√©rations unitaires <code>~</code> , donc, l'expression <code>1;</code>  passe 2 op√©rations. </p><br><p>  Notez que la limite est d'environ 1000 it√©rations, soit environ 10000 op√©rations simples.  Nous supposons que la limite est exactement de 10 000 op√©rations. </p><br><br><h2>  Mesurer le nombre d'op√©rations dans le code </h2><br><hr><br><p>  Notez que nous pouvons maintenant mesurer le nombre d'op√©rations dans n'importe quel code.  Pour ce faire, ajoutez ce code apr√®s la boucle et ajoutez / supprimez des it√©rations, des op√©rateurs <code>~</code> ou la derni√®re ligne enti√®re, jusqu'√† ce que l'erreur <code>Too many operations</code> disparaisse. </p><br><p>  Quelques r√©sultats de mesure: </p><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Nombre d'op√©rations </th></tr><tr><td> <code>1;</code> </td> <td>  2 </td></tr><tr><td> <code>~1;</code> </td> <td>  3 </td></tr><tr><td> <code>1+1;</code> </td> <td>  4 </td></tr><tr><td> <code>1+1+1;</code> </td> <td>  6 </td></tr><tr><td> <code>(true?1:1);</code> </td> <td>  5 </td></tr><tr><td> <code>(false?1:1);</code> </td> <td>  4 </td></tr><tr><td> <code>if(0)1;</code> </td> <td>  2 </td></tr><tr><td> <code>if(1)1;</code> </td> <td>  4 </td></tr><tr><td> <code>if(0)1;else 1;</code> </td> <td>  4 </td></tr><tr><td> <code>if(1)1;else 1;</code> </td> <td>  5 </td></tr><tr><td> <code>while(0);</code> </td> <td>  2 </td></tr><tr><td> <code>i=1;</code> </td> <td>  3 </td></tr><tr><td> <code>i=i+1;</code> </td> <td>  5 </td></tr><tr><td> <code>var j = 1;</code> </td> <td>  1 </td></tr><tr><td> <code>var j = 0;while(j &lt; 1)j=j+1;</code> </td> <td>  15 </td></tr></tbody></table></div><br><br><h2>  D√©terminer le type de machine virtuelle </h2><br><hr><br><p>  Vous devez d'abord comprendre le fonctionnement de l'interpr√©teur VKScript.  Il existe deux options plus ou moins plausibles: </p><br><ul><li>  L'interpr√©teur parcourt r√©cursivement l'arborescence de syntaxe et effectue une op√©ration sur chaque n≈ìud. </li><li>  Le compilateur traduit l'arbre de syntaxe en une s√©quence d'instructions que l'interpr√®te ex√©cute. </li></ul><br><p>  Il est facile de comprendre que VKScript utilise la deuxi√®me option.  Consid√©rez l'expression <code>(true?1:1);</code>  (5 op√©rations) et <code>(false?1:1);</code>  (4 op√©rations).  Dans le cas de l'ex√©cution s√©quentielle d'instructions, une op√©ration suppl√©mentaire s'explique par une transition qui ¬´contourne¬ª la mauvaise option, et dans le cas d'un bypass AST r√©cursif, les deux options sont √©quivalentes pour l'interpr√©teur.  Un effet similaire est observ√© dans if / else avec une condition diff√©rente. </p><br><p>  Il convient √©galement de pr√™ter attention √† la paire <code>i = 1;</code>  (3 op√©rations) et <code>var j = 1;</code>  (1 op√©ration).  La cr√©ation d'une nouvelle variable ne co√ªte qu'une op√©ration et l'affectation √† une existante co√ªte 3?  Le fait que la cr√©ation d'une op√©ration √† co√ªt variable 1 (et, tr√®s probablement, soit une op√©ration de chargement constant), dit deux choses: </p><br><ul><li>  Lors de la cr√©ation d'une nouvelle variable, il n'y a pas d'allocation de m√©moire explicite pour la variable. </li><li>  Lors de la cr√©ation d'une nouvelle variable, la valeur n'est pas charg√©e dans la cellule m√©moire.  Cela signifie que l'espace pour la nouvelle variable est allou√© l√† o√π la valeur de l'expression a √©t√© calcul√©e, et ensuite cette m√©moire est consid√©r√©e comme allou√©e.  Cela sugg√®re l'utilisation d'une machine √† empiler. </li></ul><br><p>  L'utilisation de la pile explique √©galement que l'expression <code>var j = 1;</code>  s'ex√©cute plus rapidement que l'expression <code>1;</code>  : la derni√®re expression d√©pense des instructions suppl√©mentaires pour supprimer la valeur calcul√©e de la pile. </p><br><br><h2>  D√©terminer la valeur limite exacte </h2><br><p>  Notez que le cycle <code>var j=0;while(j &lt; 1)j=j+1;</code>  (15 op√©rations) est une petite copie du cycle qui a √©t√© utilis√© pour les mesures: </p><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Nombre d'op√©rations </th></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> </td><td>  15 </td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> </td><td>  15 + 998 * 10 = 9995 </td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; ~<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  (limite) </td><td>  9998 </td></tr></tbody></table></div><br><p>  Arr√™te quoi?  Y a-t-il une limite de 9998 instructions?  Il nous manque clairement quelque chose ... </p><br><p>  Notez que le code <code>return 1;</code> est <code>return 1;</code>  effectu√© selon les mesures pour 0 instructions.  Cela s'explique facilement: le compilateur ajoute un <code>return null;</code> implicite <code>return null;</code> √† la fin du code <code>return null;</code>  , et lors de l'ajout de son retour, il √©choue.  En supposant que la limite est de 10000, nous concluons que l'op√©ration <code>return null;</code>  prend 2 instructions (c'est probablement quelque chose comme <code>push null; return;</code> ). </p><br><br><h2>  Blocs de code imbriqu√©s </h2><br><hr><br><p>  Prenons quelques mesures suppl√©mentaires: </p><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Nombre d'op√©rations </th></tr><tr><td> <code>{};</code> </td> <td>  0 </td></tr><tr><td> <code>{var j = 1;};</code> </td> <td>  2 </td></tr><tr><td> <code>{var j = 1, k = 2;};</code> </td> <td>  3 </td></tr><tr><td> <code>{var j = 1; var k = 2;};</code> </td> <td>  3 </td></tr><tr><td> <code>var j = 1; var j = 1;</code> </td> <td>  4 </td></tr><tr><td> <code>{var j = 1;}; var j = 1;</code> </td> <td>  3 </td></tr></tbody></table></div><br><p>  Prenons attention aux faits suivants: </p><br><ul><li>  L'ajout d'une variable √† un bloc n√©cessite une op√©ration suppl√©mentaire. </li><li>  Lors de la "d√©claration √† nouveau d'une variable", la deuxi√®me d√©claration est remplie comme une affectation normale. </li><li>  Mais en m√™me temps, la variable √† l'int√©rieur du bloc n'est pas visible de l'ext√©rieur (voir le dernier exemple). </li></ul><br><p>  Il est facile de comprendre qu'une op√©ration suppl√©mentaire est d√©pens√©e pour supprimer de la pile les variables locales d√©clar√©es dans le bloc.  Par cons√©quent, lorsqu'il n'y a pas de variables locales, rien ne doit √™tre supprim√©. </p><br><br><h1>  Objets, m√©thodes, appels API </h1><br><hr><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Nombre d'op√©rations </th></tr><tr><td> <code>"";</code> </td> <td>  2 </td></tr><tr><td> <code>"abcdef";</code> </td> <td>  2 </td></tr><tr><td> <code>{};</code> </td> <td>  2 </td></tr><tr><td> <code>[];</code> </td> <td>  2 </td></tr><tr><td> <code>[1, 2, 3];</code> </td> <td>  5 </td></tr><tr><td> <code>{a: 1, b: 2, c: 3};</code> </td> <td>  5 </td></tr><tr><td> <code>API.users.isAppUser(1);</code> </td> <td>  3 </td></tr><tr><td> <code>"".substr(0, 0);</code> </td> <td>  6 </td></tr><tr><td> <code>var j={};jx=1;</code> </td> <td>  6 </td></tr><tr><td> <code>var j={x:1};delete jx;</code> </td> <td>  6 </td></tr></tbody></table></div><br><p>  Analysons les r√©sultats.  Vous remarquerez peut-√™tre que la cr√©ation d'une cha√Æne et d'un tableau / objet vide n√©cessite 2 op√©rations, tout comme le chargement d'un nombre.  Lors de la cr√©ation d'un tableau ou d'un objet non vide, les op√©rations consacr√©es au chargement des √©l√©ments du tableau / objet sont ajout√©es.  Cela sugg√®re que la cr√©ation directe d'un objet se produit en une seule op√©ration.  Dans le m√™me temps, aucun temps n'est perdu pour t√©l√©charger les noms de propri√©t√©; par cons√©quent, leur t√©l√©chargement fait partie de l'op√©ration de cr√©ation de l'objet. </p><br><p>  Avec l'appel de m√©thode API, tout est √©galement assez courant - charger une unit√©, appeler la m√©thode, <code>pop</code> r√©sultat (vous pouvez remarquer que le nom de la m√©thode est trait√© dans son ensemble, et non comme prenant des propri√©t√©s).  Mais les trois derniers exemples semblent int√©ressants. </p><br><ul><li> <code>"".substr(0, 0);</code>  - chargement d'une cha√Æne, chargement z√©ro, chargement z√©ro, r√©sultat <code>pop</code> .  Pour une raison, il existe 2 instructions pour appeler une m√©thode (pour une raison quelconque, voir ci-dessous). </li><li> <code>var j={};jx=1;</code>  - cr√©ation d'un objet, chargement d'un objet, chargement d'une unit√©, <code>pop</code> unit√© apr√®s affectation.  Encore une fois, il y a 2 instructions pour l'affectation. </li><li> <code>var j={x:1};delete jx;</code>  - chargement d'une unit√©, cr√©ation d'un objet, chargement d'un objet, suppression.  Il y a 3 instructions par op√©ration de suppression. </li></ul><br><br><a name="semantics"></a><br><h1>  S√©mantique des objets VKScript </h1><br><h2>  Les chiffres </h2><br><hr><br><p>  Retour √† la question d'origine: VKScript est-il un sous-ensemble de JavaScript ou d'un autre langage?  Faisons un test simple: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1000000000</span></span> + <span class="hljs-number"><span class="hljs-number">2000000000</span></span>;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-number"><span class="hljs-number">-1294967296</span></span>};</code> </pre> <br><p>  Comme nous pouvons le voir, l'addition d'entiers conduit √† un d√©bordement, malgr√© le fait que JavaScript n'a pas d'entiers en tant que tels.  Il est √©galement facile de v√©rifier que la division par 0 entra√Æne une erreur et ne renvoie pas <code>Infinity</code> . </p><br><br><h2>  Les objets </h2><br><hr><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {};</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: []}</code> </pre> <br><p>  Arr√™te quoi?  Nous retournons <i>un objet</i> et obtenons un <i>tableau</i> ?  Oui, √ßa l'est.  Dans VKScript, les tableaux et les objets sont repr√©sent√©s par le m√™me type, en particulier, un objet vide et un tableau vide sont une seule et m√™me chose.  Dans ce cas, la propri√©t√© <code>length</code> de l'objet fonctionne et renvoie le nombre de propri√©t√©s. </p><br><p>  Il est int√©ressant de voir comment les m√©thodes de liste se comportent si vous les appelez sur un objet? </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">a</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  La m√©thode <code>pop</code> renvoie la derni√®re propri√©t√© d√©clar√©e, qui est cependant logique.  Modifiez l'ordre des propri√©t√©s: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">b</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">a</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Apparemment, les objets dans VKScript se souviennent de l'ordre dans lequel les propri√©t√©s sont attribu√©es.  Essayons d'utiliser des propri√©t√©s num√©riques: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Voyons maintenant comment fonctionne push: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-string"><span class="hljs-string">'b'</span></span>,<span class="hljs-string"><span class="hljs-string">'x'</span></span>:<span class="hljs-string"><span class="hljs-string">'c'</span></span>}; a.push(<span class="hljs-string"><span class="hljs-string">'d'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"1"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"2"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"3"</span></span>: <span class="hljs-string"><span class="hljs-string">"d"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>};</code> </pre> <br><p>  Comme vous pouvez le voir, la m√©thode push trie les touches num√©riques et ajoute une nouvelle valeur apr√®s la derni√®re touche num√©rique.  Les ¬´trous¬ª ne sont pas remplis dans ce cas. </p><br><p>  Essayez maintenant de combiner ces deux m√©thodes: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-string"><span class="hljs-string">'b'</span></span>,<span class="hljs-string"><span class="hljs-string">'x'</span></span>:<span class="hljs-string"><span class="hljs-string">'c'</span></span>}; a.push(a.pop()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"1"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"2"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"3"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>};</code> </pre> <br><p>  Comme nous le voyons, l'√©l√©ment n'a pas √©t√© supprim√© du tableau.  Cependant, si nous mettons <code>push</code> and <code>pop</code> sur diff√©rentes lignes, le bug dispara√Ætra.  Nous devons aller plus loin! </p><br><br><h2>  Stockage d'objets </h2><br><hr><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = x; xy = <span class="hljs-string"><span class="hljs-string">'z'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: []}</code> </pre> <br><p>  Il s'est av√©r√© que les objets en VKScript sont stock√©s par valeur, contrairement √† JavaScript.  Nous voyons maintenant l'√©trange comportement de la cha√Æne <code>a.push(a.pop());</code>  - apparemment, l'ancienne valeur du tableau a √©t√© enregistr√©e sur la pile, d'o√π elle a √©t√© prise plus tard. </p><br><p>  Cependant, comment les donn√©es sont-elles alors stock√©es dans l'objet si la m√©thode le modifie?  Apparemment, l'instruction ¬´extra¬ª lors de l'appel de la m√©thode est con√ßue sp√©cifiquement pour r√©√©crire les modifications sur l'objet. </p><br><br><h2>  M√©thodes de tableau </h2><br><hr><br><div class="scrollable-table"><table><tbody><tr><th>  La m√©thode </th><th>  Action </th></tr><tr><td> <code>push</code> </td> <td><ul><li>  trier les cl√©s num√©riques par valeur </li><li>  prendre la cl√© num√©rique maximale, en ajouter une </li><li>  √©crire l'argument dans le tableau </li><li>  ajouter des cl√©s non num√©riques √† la fin du tableau </li></ul></td></tr><tr><td> <code>pop</code> </td> <td>  Supprimez le dernier √©l√©ment du tableau (pas n√©cessairement avec une touche num√©rique) et revenez. </td></tr><tr><td>  le reste </td><td><ul><li>  trier les cl√©s num√©riques par valeur, supprimer les ¬´trous¬ª dans le tableau </li><li>  effectuer une op√©ration javascript appropri√©e </li><li>  ajouter des cl√©s non num√©riques √† la fin du tableau </li></ul><br><p>  Lors de l'utilisation de la m√©thode de tranche, les modifications ne sont pas enregistr√©es </p><br></td></tr></tbody></table></div><br><a name="summary"></a><h1>  Conclusion </h1><br><hr><br><p>  VKScript n'est pas JavaScript.  Contrairement √† JavaScript, les objets qu'il contient sont stock√©s par valeur, et non par r√©f√©rence, et ont une s√©mantique compl√®tement diff√©rente.  Cependant, lors de l'utilisation de VKScript pour l'usage auquel il est destin√©, la diff√©rence n'est pas perceptible. </p><br><br><h1>  PS S√©mantique des op√©rateurs </h1><br><hr><br><p>  Les commentaires mentionnaient la combinaison d'objets via <code>+</code> .  √Ä cet √©gard, j'ai d√©cid√© d'ajouter des informations sur le travail des op√©rateurs. </p><br><div class="scrollable-table"><table><tbody><tr><th>  Op√©ratrice </th><th>  Actions </th></tr><tr><td>  + </td><td><ul><li>  Si les deux arguments sont des objets, cr√©ez une copie du premier objet et ajoutez-y les cl√©s du second (avec remplacement). </li><li>  Si les deux arguments sont des nombres, ajoutez en tant que nombres. </li><li>  Sinon, les deux op√©randes sont convertis en cha√Æne et ajout√©s en tant que cha√Ænes. </li></ul></td></tr><tr><td>  Autres op√©rateurs arithm√©tiques </td><td>  Les deux op√©randes sont convertis en un nombre et l'op√©ration correspondante est effectu√©e.  Pour les op√©rations sur les bits, les op√©randes sont √©galement convertis en <code>int</code> . </td></tr><tr><td>  Op√©rateurs de comparaison </td><td>  Si deux cha√Ænes ou deux nombres sont compar√©s, ils sont compar√©s directement.  Si une cha√Æne et un nombre sont compar√©s et que la cha√Æne est une notation correcte pour le nombre, la cha√Æne est convertie en un nombre.  Sinon, une erreur de <code>Comparing values of different or unsupported types</code> est renvoy√©e. </td></tr><tr><td>  Cast to string </td><td>  Les nombres et les cha√Ænes sont donn√©s comme en JavaScript.  Les objets sont r√©pertori√©s sous la forme d'une liste de valeurs s√©par√©es par des virgules dans l'ordre des cl√©s.  <code>false</code> et <code>null</code> sont cast√©s comme <code>""</code> , <code>true</code> cast√© comme <code>"1"</code> . </td></tr><tr><td>  Diffuser vers </td><td>  Si l'argument est une cha√Æne qui est une notation num√©rique valide, le nombre est renvoy√©.  Sinon, une erreur <code>Numeric arguments expected</code> est renvoy√©e. </td></tr></tbody></table></div><br><p>  Pour les op√©rations avec des nombres (sauf pour les bits), si les op√©randes sont <code>int</code> et <code>double</code> , <code>int</code> est <code>double</code> en <code>double</code> .  Si les deux op√©randes sont <code>int</code> , une op√©ration est effectu√©e sur des entiers 32 bits sign√©s (avec d√©bordement). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464099/">https://habr.com/ru/post/fr464099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464089/index.html">Automatiser les requ√™tes HTTP dans le contexte de Spring</a></li>
<li><a href="../fr464091/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 311 (du 12 au 18 ao√ªt)</a></li>
<li><a href="../fr464093/index.html">Produits num√©riques: que faire si un client vient chercher un achat dans un an?</a></li>
<li><a href="../fr464095/index.html">Getters et Setters √† Dart et Flutter</a></li>
<li><a href="../fr464097/index.html">L'√©volution de l'intelligence: pourquoi les robots ont besoin d'√©motions</a></li>
<li><a href="../fr464103/index.html">Projet de norme nationale IoT OpenUNB: examen critique</a></li>
<li><a href="../fr464105/index.html">Serveur natif Commento avec Docker Compose</a></li>
<li><a href="../fr464107/index.html">√âv√©nements num√©riques √† Moscou du 19 au 25 ao√ªt</a></li>
<li><a href="../fr464109/index.html">Parachutes supersoniques spatiaux</a></li>
<li><a href="../fr464111/index.html">Natas Web. Passage de la plateforme CTF visant √† exploiter les vuln√©rabilit√©s du Web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>