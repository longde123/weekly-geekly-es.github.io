<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòõ üìõ üè° Un projet ouvert d'un module de commande de moteur √©lectrique. Technologie de d√©veloppement logiciel üî∫ üîÆ üöµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'√©criture de firmware pour les int√©rieurs de l'√©lectronique embarqu√©e moderne est pratiquement impossible √† √©crire √† partir de z√©ro. Ils ne donnent t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un projet ouvert d'un module de commande de moteur √©lectrique. Technologie de d√©veloppement logiciel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403525/"><img src="https://habrastorage.org/getpro/geektimes/post_images/f61/dfd/0b2/f61dfd0b289e32b873cb88a6ce541cc5.png"><br>  L'√©criture de firmware pour les int√©rieurs de l'√©lectronique embarqu√©e moderne est pratiquement impossible √† √©crire √† partir de z√©ro.  Ils ne donnent tout simplement pas de temps pour cela.  Par cons√©quent, le logiciel pour les syst√®mes embarqu√©s est bas√© sur <br>  plates-formes logicielles pr√™tes √† l'emploi - cadres.  Plus le cadre est d√©velopp√©, plus le d√©veloppement est rapide.  Ici, nous allons parler du cadre que j'ai cr√©√© sp√©cifiquement pour les modules de commande de moteur et qui a √©t√© utilis√© avec succ√®s depuis un certain temps maintenant. <br><a name="habracut"></a><br><h2>  <b>L'architecture du cadre.</b> <br></h2><br>  Le cadre est con√ßu pour fonctionner sur la plate-forme ouverte du module de commande de moteur universel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DMC v2.0</a> . <br><br>  L'architecture logique du cadre peut √™tre repr√©sent√©e sous la forme d'un sch√©ma fonctionnel, illustr√© ci-dessous.  Dans l'organigramme, une liste compl√®te de tous les composants du cadre est omise, car cela nuirait √† la clart√©, mais pour une id√©e g√©n√©rale, je pense, la granularit√© est suffisante. <br><br> <a href=""><img align="left" width="973" src="https://habrastorage.org/getpro/geektimes/post_images/b68/4a6/a74/b684a6a74fe172cfde9fc7b6dcdd4aec.png"><br clear="left"></a>  <a href=""><em>(Cliquer pour agrandir)</em></a> <br><br>  Le framework n'a pas de versions, il est en d√©veloppement constant, et ici j'ai juste essay√© de corriger son √©tat actuel, qui est post√© sur GitHub. <br><br>  Du point de vue des modules logiciels, le framework contient les √©l√©ments cl√©s suivants: <br><br>  - Un ensemble de modules de support au niveau application <br>  - Syst√®me d'exploitation en temps r√©el <b>MQX</b> . <br>  - Middleware: <b>syst√®me de fichiers, shell de commande, piles de protocoles de communication</b> , etc. <br>  - Un ensemble de support de carte de bas niveau (BSP), qui comprend l' <b>acc√®s aux p√©riph√©riques</b> des cartes de module BLEZ66V1 et du module d'alimentation. <br>  - Progiciel pour la <b>surveillance, le d√©bogage et les diagnostics</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FreeMaster</a> . <br>  - Outils de d√©bogage, y compris <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTT</a> ,</b> tra√ßage des outils <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ITM</a> , enregistreurs,</b> terminal <b>VT100</b> . <br>  - Module de <b>g√©n√©ration de fichiers de</b> param√®tres. <br>  - Modules de codes sources g√©n√©r√©s bas√©s sur des algorithmes dans <b>Matlab</b> . <br><br><h2>  <b>Pourquoi MQX est-il s√©lectionn√©?</b> <br></h2><br>  Le syst√®me d'exploitation en temps r√©el (RTOS) MQX est connu depuis longtemps, mais <br>  est apparu dans le domaine public il y a quelques ann√©es.  Ce syst√®me d'exploitation a √©t√© t√©l√©charg√© par Freescal avant que NXP ne les ach√®te.  RTOS avait initialement une licence uniquement pour une utilisation dans les microcontr√¥leurs Freescale, maintenant la licence s'√©tend √©galement aux produits NXP.  RTOS a surv√©cu √† une popularit√© explosive, a subi plusieurs mises √† niveau vers la version 4.2, apr√®s quoi Freescale a d√©cid√© de rendre √† nouveau ses versions ult√©rieures commerciales.  Il s'est donc av√©r√© deux versions, une ouverte et gel√©e en d√©veloppement appel√©e MQX Classic (alias MQX v4.2) et une MQX 5.0 commerciale ferm√©e. <br><br>  Dans le cadre d√©crit, la branche MQX Classic v4.2 est utilis√©e.  Il s'agit d'une version stable et bien test√©e.  La licence permet au d√©veloppeur de modifier le code source de MQX Classic et de l'utiliser dans des produits commerciaux, mais elle ne permet pas la publication de MQX Classic sous forme source.  Mais cela ne devrait pas √™tre un probl√®me, car MQX Classic est disponible en t√©l√©chargement gratuit. <br><br>  La structure de RTOS en termes g√©n√©raux ressemble √† ceci: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/d89/752/c84/d89752c84e3a24d03198b581116e4f47.png"><br><br><h2>  <b>Pourquoi ai-je besoin de RTOS?</b> <br></h2><br>  Une application complexe o√π, en particulier, un contr√¥le moteur est requis est assez complexe et se compose de nombreuses t√¢ches asynchrones, chacune avec son propre cycle de r√©p√©tition et ses √©v√©nements d'activation et d'arr√™t.  Si nous effectuons toutes ces t√¢ches dans un supercycle, nous rencontrons in√©vitablement le probl√®me de retarder l'ex√©cution de certaines t√¢ches par d'autres t√¢ches. <br>  En utilisant RTOS, comme MQX, il est possible de se d√©barrasser de l'interd√©pendance des t√¢ches individuelles sur l'axe du temps sans les r√©√©crire ni m√™me regarder leurs codes sources. <br><br>  Par exemple, notre t√¢che d'enregistreur peut essayer d'√©crire un message aussi longtemps que souhait√© sur une carte SD en attente de sa r√©ponse, la t√¢che USB peut toutes aller au transfert d'une grande quantit√© de donn√©es vers un ordinateur, mais en m√™me temps la t√¢che PID de l'algorithme du moteur sera effectu√©e strictement √† un intervalle sp√©cifi√©, et la t√¢che de mesure de vitesse la rotation ne manquera pas un seul √©v√©nement de changement de signal d'encodeur. <br><br>  Bien que je dois admettre, il existe un autre moyen de plus en plus populaire de se d√©barrasser de la complexit√© sur une seule puce: passer au multitraitement, mais dans ce cas, RTOS fournira un bon service. <br><br><h2>  <b>Les principaux avantages de RTOS MQX.</b> <br><br></h2>  - Le noyau du syst√®me est livr√© avec une large gamme de middleware comprenant un syst√®me de fichiers, une pile TCP / IP, une pile USB, un shell de commande, etc.  Tout dans le code source. <br><br>  - Ensembles BSP pr√™ts √† l'emploi pour diff√©rentes cartes, √©liminant le besoin d'√©crire vos propres biblioth√®ques de travail p√©riph√©riques. <br>  - Documentation d√©taill√©e dans des fichiers pdf avec une navigation facile. <br>  - La pr√©sence d'un plug-in pour l'atelier int√©gr√© IDE IAR avec des informations tr√®s d√©taill√©es sur les structures internes de RTOS, est beaucoup plus d√©taill√©e que pour d'autres RTOS bien connus - uCOS et FreeRTOS. <br>  - Beaucoup d'exemples d'application RTOS et de cas de test. <br><br>  Lorsqu'ils parlent de RTOS, ils soulignent toujours leur capacit√© √† effectuer les t√¢ches √† temps, mais les estimations quantitatives ne sont le plus souvent pas donn√©es ou donn√©es pour certaines plateformes tierces s√©lectionn√©es s√©par√©ment.  Ce n'est clairement pas suffisant pour impl√©menter un contr√¥le dur en temps r√©el √† l'aide de RTOS.  Et pour contr√¥ler les moteurs dont vous avez besoin en temps r√©el, il est exactement difficile. <br><br>  MQX dispose d'un merveilleux cas de test √† cet √©gard, qui vous permet d'obtenir un tableau d√©taill√© du temps d'ex√©cution de tous les services sur la plate-forme sur laquelle vous avez lanc√© le test. <br><br>  Vous trouverez ci-dessous un tableau du temps d'ex√©cution des services sur le microcontr√¥leur de notre module de contr√¥le moteur, avec l'optimisation maximale pour la vitesse d'ex√©cution du code incluse dans le compilateur. <br><br><div class="spoiler">  <b class="spoiler_title">Temps d'ex√©cution du service RTOS MQX Classic</b> <div class="spoiler_text"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/3f4/79a/2e6/3f479a2e65fd274ca81b27321ae31978.png"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/51d/f91/32d/51df9132da3b6d09656d6ee7b2021ebc.png"><br></div></div><br>  Le tableau donne √©galement une id√©e des services pris en charge par RTOS et des options de noyau disponibles.  Le projet de test dans l'IDE IAR est inclus dans le cadre publi√©. <br><br><h2>  <b>Composition du r√©pertoire du projet</b> <br></h2><br>  Le r√©pertoire racine du framework ressemble √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/04e/fde/4a0/04efde4a059a9ba99ba39c7d6c275a8e.png"></div><br>  <b>APP_SRC</b> - un r√©pertoire contenant toutes les sources sauf celles qui appartiennent √† la distribution MQX. <br>  <b>FreeMaster_apps</b> - fichiers de projet √† ex√©cuter dans l'environnement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FreeMaster</a> . <br>  <b>IAR_proj</b> - espace de travail et fichiers de projet pour le plan de travail int√©gr√© IAR pour l'environnement ARM v7.70.2.  Dans cet environnement, l'application finale est compil√©e et d√©bogu√©e. <br>  <b>MQX_SRC</b> est un r√©pertoire contenant toutes les sources de MQX et middleware fournis avec MQX.  √âtant donn√© que la licence ne permet pas la publication open source √† partir de la distribution MQX, il n'y a pas <b>de</b> fichiers " <b>.s"</b> et " <b>.s"</b> dans ce r√©pertoire.  Mais ceux qui acceptent les termes de la licence NXP peuvent recevoir les fichiers manquants. <br>  <b>ParametersManager</b> - r√©pertoire du programme du gestionnaire de param√®tres.  √Ä l'aide de ce programme, des listes de param√®tres d'application sont cr√©√©es et <b>des</b> fichiers ¬´ <b>.s¬ª</b> et ¬´ <b>.h¬ª</b> sont g√©n√©r√©s avec des d√©clarations de param√®tres √† int√©grer dans l'application. <br>  <b>TESTS</b> - un r√©pertoire avec des projets de test de framework.  Voici le projet <b>MQX_benchmark</b> pour g√©n√©rer un rapport avec des timings MQX. <br><br>  Les fichiers <b>MQX_LIBRARY_O0.a</b> et <b>MQX_LIBRARY_O3.a</b> sont le contenu du r√©pertoire <b>MQX_SRC</b> compil√© dans des biblioth√®ques avec une optimisation minimale et une optimisation maximale, respectivement. <br><br><h2>  <b>Le contenu du r√©pertoire IAR_proj</b> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/ea2/d23/744/ea2d23744775a8daec5cbddff606db11.png"></div><br>  Les fichiers <b>U3HB_full.eww</b> et <b>U3HB_MQXLib.eww</b> sont les fichiers d' <b>espace de travail IAR</b> . <br>  Tant qu'il n'y a pas de sources dans le r√©pertoire MQX, seul le fichier <b>U3HB_MQXLib.eww fonctionnera</b> .  Cet espace de travail utilise des biblioth√®ques MQX compil√©es.  Dans l' <b>espace de travail U3HB_full.eww, les</b> sources MQX compl√®tes sont compil√©es.  Le r√©pertoire <b>OUT</b> sert de lieu o√π l'IAR place ses produits de travail, en particulier les fichiers de carte et hexad√©cimaux. <br><br>  Le r√©pertoire des <b>param√®tres</b> est automatiquement cr√©√© par l'IAR.  Il stocke sp√©cifiquement les param√®tres du d√©bogueur.  Si quelque chose ne peut pas √™tre configur√© pendant le d√©bogage dans l'IAR, il vaut parfois la peine d'effacer ce r√©pertoire. <br><br>  Le fichier <b>INT_FLASH_MK66FX1M0LVQ18.icf</b> est un fichier de configuration de l'√©diteur de liens IAR.  Il d√©termine les adresses des r√©gions de m√©moire o√π l'√©diteur de liens place le code, les donn√©es, les vecteurs d'interruption, les piles, etc. <br><br><h2>  <b>Le contenu du r√©pertoire MQX_SRC</b> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/a90/137/f84/a90137f8413885b24fa795dff7397501.png"></div><br>  Les fichiers d'espace de travail <b>MQX_LIBRARY.eww</b> sont utilis√©s pour cr√©er des biblioth√®ques MQX.  Tant que les fichiers ¬´ <b>.s</b> <b>¬ª</b> et ¬´ <b>.s¬ª</b> ne seront pas plac√©s dans les r√©pertoires, ce projet ne sera pas compil√©. <br>  <b>config</b> - le r√©pertoire avec les fichiers de configuration MQX.  La composition des services et pilotes MQX est sp√©cifi√©e dans le <b>fichier de</b> configuration <b>user_config.h</b> . <br>  <b>mfs</b> - syst√®me de fichiers MQX, comprend FAT32 et RAM FS <br>  <b>mqx</b> - le noyau MQX comprend les sous-r√©pertoires suivants: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/640/df2/547/640df25474118976fe26e5f2b609924d.png"></div><br>  <b>rtcs</b> - pile TCP / IP.  Il comprend les sous-r√©pertoires suivants: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/3d4/164/e18/3d4164e187a5d013aab6cf24e159d8d2.png"></div><br>  <b>shell</b> - un r√©pertoire avec des fichiers shell. <br>  <b>usb</b> - r√©pertoire avec fichiers de pile USB <br><br>  La fonctionnalit√© de chaque module logiciel MQX est bien document√©e par le fabricant.  √Ä titre d'exemple, je fournirai des liens vers deux documents: <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Instructions d'utilisation du MQX</a> . <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide de r√©f√©rence MQX.</a> <br>  Le reste doit √™tre recherch√© dans la distribution, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">qui est disponible sur le site NXP</a> . <br><br>  Le cadre lui-m√™me est dans le r√©f√©rentiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Vous trouverez une description plus d√©taill√©e de l'utilisation des logiciels et des exemples d'application dans les articles suivants. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr403525/">https://habr.com/ru/post/fr403525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr403513/index.html">Comment choisir une imprimante 3D?</a></li>
<li><a href="../fr403515/index.html">Certains fichiers syst√®me Windows sont obstru√©s par des fichiers ind√©sirables de m√©tadonn√©es Adobe</a></li>
<li><a href="../fr403517/index.html">Invention d'une m√©thode moins ch√®re de photosynth√®se artificielle</a></li>
<li><a href="../fr403521/index.html">Une br√®ve histoire de la th√©orie physique de la grande unification</a></li>
<li><a href="../fr403523/index.html">Batterie solaire sur le balcon, exp√©rience d'utilisation</a></li>
<li><a href="../fr403531/index.html">De l'enfance sur roues: v√©lo √©lectrique et d√©riveur Razor pour enfants et adolescents</a></li>
<li><a href="../fr403533/index.html">Pseudoscience L'industrie de la viande tente de convaincre le public de l'innocuit√© des graisses satur√©es</a></li>
<li><a href="../fr403535/index.html">Tokamak de d√©marrage thermonucl√©aire</a></li>
<li><a href="../fr403537/index.html">Yachts avec Smart Home √† bord. Fabriqu√© en Russie</a></li>
<li><a href="../fr403539/index.html">Nous avons affaire √† un avocat: est-il l√©gal de t√©l√©charger des torrents, d'acheter des jeux sur Brazilian Steam et pas seulement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>