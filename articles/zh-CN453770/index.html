<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👕 ↙️ 🕵🏼 适用于iOS的Apple订阅通知指南。 他们真的好吗？ 🌮 🧑🏾‍🤝‍🧑🏾 👦🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="因此，您的应用程序具有自动可再生订阅。 它的效果很好，用户无法控制地发行高级订阅并撰写具有美感的评论。 美女！ 


 大家好，我叫Denis，我是Apphud的项目经理，该服务用于分析iOS应用程序的自动续订订阅。 


 作为项目经理，对您而言，了解关键的产品指标至关重要。 最重要的一项是生命时...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>适用于iOS的Apple订阅通知指南。 他们真的好吗？</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/453770/"><p><img src="https://habrastorage.org/getpro/habr/post_images/fa5/f52/a07/fa5f52a07612fe9b040dad35421024ec.jpg"></p><br><p> 因此，您的应用程序具有自动可再生订阅。 它的效果很好，用户无法控制地发行高级订阅并撰写具有美感的评论。 美女！ </p><br><p> 大家好，我叫Denis，我是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apphud</a>的项目经理，该服务用于分析iOS应用程序的自动续订订阅。 </p><br><p> 作为项目经理，对您而言，了解关键的产品指标至关重要。 最重要的一项是生命时间价值（LTV）-使用该应用程序的每个用户在整个时间内的平均收入。 但是，在iOS上自动续订的情况下，如何计算呢？ 如何跟踪用户的续订，取消，续订时间？ <a name="habracut"></a></p><br><p> 直到最近（即直到2017年），唯一的方法就是所谓的“订阅状态轮询”。 您可以随时通过将必要的收据发送到URL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://buy.itunes.apple.com/verifyReceipt</a>来获取有关订阅状态的信息。 收到订阅后，您可以查看有关订阅的基本信息，包括结束日期。 没错，您仍然不会花钱。 </p><br><p> 要实施状态轮询，您必须： </p><br><ol><li> 将有关每个用户的所有订阅的所有检查都转移并存储在服务器上， </li><li> 实现复杂的服务器逻辑，该逻辑将<strong>定期</strong>检查这些检查。 </li></ol><br><p> 这很复杂。 但是在2017年，苹果似乎可以解决这个问题。 在WWDC上，他们起立鼓掌，向他们展示Apple订阅状态更新通知。 </p><br><h2 id="chto-takoe-subscriptions-notifications"> 什么是订阅通知？ </h2><br><p>  Apple订阅状态更新通知是一种机制，用于在发生自动更新的订阅事件时向您的Apple服务器发送webhook。 要启用它们，您必须首先将服务器配置为接受它们：服务器必须支持App Transport Security协议（通常默认情况下所有功能都可以正常运行）。 之后，转到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">App Store Connect，</a>然后在应用程序设置的“ App Store”部分中，插入一个链接，Apple会在事件发生时向其发送POST请求： </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/011/e97/844/011e97844357cc016a2a8258bacfd354.png" alt="配置Apple订阅状态更新通知"></p><br><blockquote> 请注意，Apple建议将“订阅通知”与“状态轮询”结合使用。 错误的迹象... </blockquote><p> 做完了！ 现在，无论何时发布，续订或取消订阅，您都应该收到通知。 </p><br><h2 id="raznovidnosti-uvedomleniy"> 各种通知 </h2><br><p>  Apple发送在各种事件中发生的6种通知。 我们将分析它们中的每一个。 </p><br><h3 id="initial_buy">  INITIAL_BUY </h3><br><p> 当用户首次注册订阅<strong>组</strong>时，Apple会发送此通知。 </p><br><blockquote> 您可以在我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章中</a>阅读有关订阅组的更多信息。 </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/bce/b16/6de/bceb166ded34b6e3efe67b0fbd22ae01.png" alt="活动INITIAL_BUY"></p><br><h3 id="cancel"> 取消 </h3><br><p> 当用户通过Apple Care支持取消订阅并退款时，将调度此事件。 我们强调，这与通过iOS设置通常取消订阅<strong>无关</strong> 。 </p><br><blockquote>通过iOS设置在正常取消期间不会调度<code>CANCEL</code>事件。 </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/52c/692/9ce/52c6929ced9ea6d4d887581722f5612a.png" alt="取消事件"></p><br><h3 id="did_change_renewal_status">  DID_CHANGE_RENEWAL_STATUS </h3><br><p> 此事件最近已添加。 当用户断开连接或（再次）通过iOS设置，App Store应用程序或Apple支持启用订阅续订时，发送该消息： </p><br><blockquote> 不要将此事件与取消订阅并通过Apple Care支持退款时触发的<code>CANCEL</code>事件混淆。 </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/987/be2/829/987be28296f3367163ff3af07a4fb29a.png" alt="事件DID_CHANGE_RENEWAL_STATUS"></p><br><h3 id="renewal"> 更新 </h3><br><p> 当您看到此事件的名称时，想到的第一件事：当续订自动续订时，Apple会发送该事件。 无论如何！ </p><br><p> 在以下情况下调度<code>RENEWAL</code>事件： </p><br><ol><li><p>  <strong>由于用户银行卡的问题，</strong>该用户的订阅被自动取消<strong>...</strong> </p><br></li><li><p> 然后，用户再次续订。 此时，将<code>RENEWAL</code>事件。 </p><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e56/ed6/4e9/e56ed64e9a4f804a69c32b15df6e614f.jpg"></p><br><blockquote> 在定期续订的情况下， <strong>不发送</strong> RENEWAL <code>RENEWAL</code> 。 相反，Apple建议在预期的续约之前和之后通过<code>/VerifyReceipt</code>检查订阅检查，并分析产生的<code>expiration_date</code> </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/2d9/e2d/544/2d9e2d5440a690903f0182b5c08cc9a4.png" alt="更新活动"></p><br><h3 id="interactive_renewal">  INTERACTIVE_RENEWAL </h3><br><p> 在以下情况下调度此事件： </p><br><ol><li><p> 用户取消了订阅， <strong>此后一段时间...</strong> </p><br></li><li><p> 用户续订。 此时<code>INTERACTIVE_RENEWAL</code>发送<code>INTERACTIVE_RENEWAL</code> 。 </p><br><blockquote> 新的订阅（在第2条中指示）可能与第1条的订阅不同，但是它们都必须属于同一购买组。 例如，用户可以取消订阅铜牌费率计划，并在一段时间后通过选择黄金计划来续订其订阅。 在这种情况下，Apple会将<code>INTERACTIVE_RENEWAL</code>事件发送到您的服务器（假设Bronze和Gold订阅属于同一购物组）。 您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>阅读有关订阅组的更多信息。 </blockquote><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b0/d77/fe3/7b0d77fe3921cf4bf9c4d9b4a04bec03.png" alt="活动INTERACTIVE_RENEWAL"></p><br><h3 id="did_change_renewal_pref">  DID_CHANGE_RENEWAL_PREF </h3><br><p> 当用户从同一购物组中的一个订阅切换到另一个订阅时，将发送<code>DID_CHANGE_RENEWAL_PREF</code> ： </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ab1/8d5/359/ab18d53594ec3b04615f38598aa0c787.png" alt="事件DID_CHANGE_RENEWAL_PREF"></p><br><h3 id="chto-v-itoge"> 结果如何？ </h3><br><p>  Apple提供多达6个事件，但在正常模式下自动续订订阅时不会发送其中一个事件。 他们为什么这样做？ 不清楚 此外，这些事件的名称具有误导性。 </p><br><p> 下表总结了事件。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ba/c0f/fc1/3bac0ffc178eaad092d199d6dd0e8d19.png"></p><br><h2 id="kak-ispolzovat-apple-subscriptions-notifications"> 如何使用Apple订阅通知？ </h2><br><p> 由于没有发送您需要计算LTV的最重要事件（以正常模式续订），因此您仍然必须使用状态轮询。 苹果有可能在不久的将来添加此事件，但是即使发生这种情况，如果没有您自己的服务器，您仍然无法做。 该服务器将充当Apple和另一个分析系统（例如，Amplitude，Flurry或Mixpanel）之间的“层”。 通过接收事件并检查支票，您将向其发送有关续订，取消和退款的信息。 </p><br><blockquote><h1 id="odnazhdy-my-stolknulis-s-etoy-problemoy-i-reshili-razrabotat-servis-kotoryy-by-reshil-eti-problemy-tak-rodilas-ideya-servisa-nad-kotorym-my-seychas-rabotaem--servisa-analitiki-podpisok-dlya-ios-kotoryy-zapolnyaet-bresh-v-otpravke-sobytiy-so-storony-apple"> 一旦遇到这个问题并决定开发一种可以解决这些问题的服务。 因此，这个想法源自我们现在正在开发的服务-iOS的订阅分析服务，该服务填补了从Apple发送事件的空白。 </h1><br></blockquote><br><h2 id="zaklyuchenie"> 结论 </h2><br><p>  Apple Subscriptions Notifications并不像它们看起来的那样好，因为仅凭它们，您就无法解决主要问题：找出一个用户为您带来的收入。 苹果公司可能会在将来为开发人员带来更轻松的生活，但有一点可以肯定：当前的订阅通知实施极其不明显，看起来像拐杖。 </p><br><blockquote> 是否想在10分钟内在iOS应用中实现订阅？ 整合<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apphud</a>并： <br><ul><li> 仅使用一种方法进行购买； </li><li> 自动跟踪每个用户的订阅状态； </li><li> 轻松整合订阅优惠 </li><li> 将订阅事件发送到Amplitude，Mixpanel，Slack和Telegram，并考虑到用户的本地货币； </li><li> 降低应用程序的客户流失率并返回未订阅的用户。 </li></ul><br></blockquote><br><h2 id="chto-pochitat"> 读什么？ </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关于自动更新订阅的7件事</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">iOS上的介绍性优惠指南</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apple状态更新通知指南</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN453770/">https://habr.com/ru/post/zh-CN453770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN453756/index.html">确定FSTEC当前威胁的当前方法存在的问题</a></li>
<li><a href="../zh-CN453760/index.html">坦克和处理器巡回训练营</a></li>
<li><a href="../zh-CN453764/index.html">自愿性健忘症：海马操作可消除痛苦记忆</a></li>
<li><a href="../zh-CN453766/index.html">软件无线电-它如何工作？ 第6部分</a></li>
<li><a href="../zh-CN453768/index.html">SMS服务概述：热门服务</a></li>
<li><a href="../zh-CN453772/index.html">雅典娜计划-重塑笔记本</a></li>
<li><a href="../zh-CN453776/index.html">我们在公司中抽调设计师：从初级到艺术总监</a></li>
<li><a href="../zh-CN453778/index.html">我们如何创建在线商业银行。 第一部分：品牌重塑</a></li>
<li><a href="../zh-CN453780/index.html">一般情况下，如何选择Grandstream SIP电话？</a></li>
<li><a href="../zh-CN453782/index.html">无限UIScrollView</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>