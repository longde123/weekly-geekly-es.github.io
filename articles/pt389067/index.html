<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍔 🏂 👩🏽‍🚒 Equipamento sem fio NooLite e Smart Home (Parte 1). Arduino 👨🏿‍💻 👈🏼 👨‍👩‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá queridos leitores do Geektimes! Desta vez, quero chamar sua atenção para uma série de artigos sobre a integração de equipamentos sem fio nooLite e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Equipamento sem fio NooLite e Smart Home (Parte 1). Arduino</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/389067/"><img src="https://habrastorage.org/files/d8c/f00/38e/d8cf0038e7a040fe8e07446481c0a1a0.jpg" alt="nooLite"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olá queridos leitores do Geektimes! </font><font style="vertical-align: inherit;">Desta vez, quero chamar sua atenção para uma série de artigos sobre a integração de equipamentos sem fio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nooLite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em sistemas de automação residencial. </font><font style="vertical-align: inherit;">Esse ciclo será semelhante à série de artigos já publicados ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dois</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">três</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) sobre a integração dos módulos Laurent nos sistemas Smart Home, mas ele abordará o sistema nooLite e, após a leitura deste ciclo, você não terá mais dúvidas sobre o gerenciamento de dispositivos nooLite a partir do seu Smart em casa.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre a série de artigos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ciclo é dividido em três partes. Na primeira parte, você aprenderá sobre como o equipamento sem fio nooLite funciona e como gerenciá-lo em seus projetos do Arduino. A </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segunda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parte descreverá em detalhes a integração do módulo de controle MT1132 no Mega Server do Arduino e as possibilidades de gerenciar uma Smart Home que está sendo aberta nessa conexão. E o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terceiro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> artigo da série será dedicado a um tópico muito interessante - o conceito de criação de dispositivos “100 em 1” baseados no Arduino Mega Server. Um exemplo de criação de uma estação de solda sem fio no AMS será examinado em detalhes, literalmente do nada - com base em apenas um dímero sem fio nooLite. Haverá também uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quarta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parte da qual você aprenderá a criar um cristal mágico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A propósito, a estação de solda, que será discutida no terceiro artigo, já está presente na mais recente montagem do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sob o número 0,14. </font><font style="vertical-align: inherit;">E os leitores mais curiosos não podem esperar pelo terceiro artigo, mas baixem imediatamente o kit de distribuição e descubram como tudo funciona por conta própria. </font></font><br>
<br>
<img src="https://habrastorage.org/files/428/a18/eeb/428a18eeb1f84623bc6c9f8d59e08974.jpg" alt="estação de solda"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o melhor é que pode haver centenas desses dispositivos no AMS e ao mesmo tempo. </font><font style="vertical-align: inherit;">Por exemplo, uma estação de solda, uma estação meteorológica, uma unidade de segurança, um controlador de efeito estufa, etc. E tudo isso pode funcionar simultaneamente ou "iniciar" carregando uma página da web ou mesmo um site inteiro dedicado a um dispositivo específico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas não vamos nos antecipar, vamos deixar o mais interessante no final, mas por enquanto faremos a preparação teórica necessária. </font><font style="vertical-align: inherit;">Prometo que tudo será declarado da maneira mais simples e inteligível. </font><font style="vertical-align: inherit;">Então, vamos começar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipamento NooLite</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O equipamento NooLite já é um sistema conhecido e popular e há muitas informações sobre ele na Internet. </font><font style="vertical-align: inherit;">Vou tentar resumir os pontos principais aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O conceito é muito simples - existem unidades de energia para controlar a luz e várias cargas e painéis de controle que enviam comandos para essas unidades de energia. </font><font style="vertical-align: inherit;">E tudo isso funciona, naturalmente, sem a participação de conexões com fio. </font><font style="vertical-align: inherit;">Na verdade tudo. </font><font style="vertical-align: inherit;">A beleza do sistema é que todos os componentes são pensados, bem feitos e fazem exatamente o que diz: eles controlam com segurança o equipamento conectado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Também existem sensores sem fio, controle de dispositivos de um smartphone e muito mais, mas é impossível cobrir tudo em um artigo. Aqui, focaremos apenas a integração do nooLite com a popular plataforma DIY - Arduino.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De todo o vasto espectro de equipamentos nooLite, estaremos interessados ​​no módulo de controle MT1132, pois ele foi projetado para conectar-se ao Arduino e aos computadores de placa única, como o Raspberry Pi. E funciona em uma interface serial simples. No futuro, direi que gostei do módulo devido à sua simplicidade, previsibilidade e operação confiável. E pude apreciar essas qualidades depois de um mês de luta infrutífera com o módulo de rede no chip W5500, que não queria funcionar normalmente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/af4/5a9/4dc/af45a94dc2684467920e9191ebcafc83.jpg" alt="Módulo MT1132"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E gostei especialmente do fato de que (além da fonte de alimentação) o módulo está conectado ao Arduino com apenas um (!) Wire (RX). O segundo (TX) pode ser omitido por completo. O módulo é "unidirecional", ou seja, foi projetado apenas para enviar sinais de controle. Os planos da empresa Nootehnika incluem o desenvolvimento e o lançamento de uma versão "bidirecional" do módulo.</font></font><br>
<br>
<img src="https://habrastorage.org/files/60c/dfb/d07/60cdfbd0709b41b88b19a00638637d59.jpg" alt="SU111-300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo elemento que precisamos do equipamento nooLite é uma unidade de controle de potência, por exemplo, SU111-300. A conexão da unidade é elementar e pode ser vista na ilustração. Dois fios estão conectados a uma rede de 220 volts e os outros dois à carga. A única coisa que eu gostaria de prestar atenção é que os módulos são fornecidos com um jumper que bloqueia o modo de escurecimento e, se você deseja ajustar a potência, é necessário cortá-lo (e lembre-se de isolar os fios desencapados resultantes).</font></font><br>
<br>
<img src="https://habrastorage.org/files/acf/cd5/4ad/acfcd54ad9ab4c57bf6409799dd3a133.jpg" alt="PU311-2"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não vou me concentrar nos controles remotos porque esse é um controle "manual" e, em conexão com a automação, estamos mais interessados ​​no automático. </font><font style="vertical-align: inherit;">Só posso dizer que os experimentos foram realizados com o controle remoto PU311-2, na forma de um interruptor de parede, que se mostrou da melhor maneira, ou seja, acendeu e apagou a luz de maneira clara e sem falhas. </font><font style="vertical-align: inherit;">Na verdade, o que é bom equipamento e diferente de ruim - você simplesmente não nota bem.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conceito de trabalho. </font><font style="vertical-align: inherit;">Encadernação e desassociação</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de ligar e desligar aparelhos elétricos usando o sistema nooLite, você precisa "vincular" os módulos de controle às unidades de energia correspondentes. Isso é feito usando o chamado procedimento. “Ligações” e “desatamento” descritas em detalhes na documentação do nooLite. Em resumo, tudo se resume a pressionar um par de botões nos blocos vinculados e não apresenta nenhuma dificuldade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso em que o módulo de controle MT1132 é usado em vez do controle remoto, o procedimento ocorre de uma maneira ligeiramente diferente. A saber: como o módulo não possui botões, é necessário gerar e enviar programaticamente um comando de controle no canal desejado e pressionar o botão na unidade de energia, confirmando a "ligação" ou "desatamento".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os canais são "linhas de controle" e há 32 deles no módulo MT1132, conforme evidenciado pelos dois últimos dígitos no nome. </font><font style="vertical-align: inherit;">Isso significa que, com este módulo, você pode gerenciar 32 grupos separados de equipamentos, o que é mais do que suficiente para um apartamento ou uma casa pequena. </font><font style="vertical-align: inherit;">Se você tem uma casa grande, os módulos podem trabalhar em conjunto e escalar para qualquer número de canais.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descrição do protocolo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maravilhoso </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">no</font></a><font style="vertical-align: inherit;"> site da empresa Nootehnika </font><font style="vertical-align: inherit;">que descreve detalhadamente e detalhadamente a conexão do módulo e seu protocolo de controle. </font><font style="vertical-align: inherit;">Não vou desarrumar o artigo com detalhes técnicos desnecessários, qualquer um pode ler este documento, descreverei apenas os pontos principais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar o módulo, precisamos formar um comando de controle composto por 12 bytes. </font><font style="vertical-align: inherit;">Os princípios para a formação dessa equipe estão descritos no documento acima. </font><font style="vertical-align: inherit;">E como você verá abaixo, todas essas regras já estão programadas nas funções de controle e precisamos apenas usá-las para emitir comandos para o módulo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipes de teste</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O nooLite possui um sistema de comando bastante desenvolvido, a partir do qual selecionaremos os mais simples e mais comuns e ilustraremos o sistema usando seu exemplo.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snap</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desatar</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inclusão</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desligado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuração de energia (escurecimento)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entendendo como as equipes básicas funcionam, você pode usar facilmente qualquer outra.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectando o módulo MT1132</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu já disse, o módulo MT1132 está conectado literalmente com um fio (exceto energia). </font><font style="vertical-align: inherit;">O módulo pode ser alimentado por uma tensão de 5 volts e uma tensão de 3,3 volts. </font><font style="vertical-align: inherit;">Portanto, não houve problemas ao conectar o Arduino Mega de 5 volts ou o Arduino Due de 3,3 volts. </font><font style="vertical-align: inherit;">O único ponto é que, com energia reduzida, o alcance da operação confiável do sistema diminui. </font><font style="vertical-align: inherit;">E isso deve ser levado em consideração se você deseja alimentar o módulo a partir de uma tensão de 3,3 volts.</font></font><br>
<br>
<img src="https://habrastorage.org/files/fb8/2a4/d76/fb82a4d769cb49bda099e57591c13157.jpg" alt="Arduino"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O módulo possui pinos RX e TX para receber e enviar sinais via interface serial. </font><font style="vertical-align: inherit;">Crítica para a operação do módulo é a conexão do RX, para receber comandos de controle do controlador. </font><font style="vertical-align: inherit;">Conseqüentemente, o pino RX no lado do módulo está conectado ao pino TX (18) no lado do Arduino. </font><font style="vertical-align: inherit;">Essa pinagem é válida para o Arduino Mega e o Arduino Due.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte do software</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos descobrir como gerenciar toda essa economia a partir de esboços no Arduino. </font><font style="vertical-align: inherit;">Primeiro, inicialize o Serial1, ao qual conectamos o módulo MT1132 (isso é feito na frequência padrão 9600):</font></font><br>
<br>
<pre><code class="java hljs">Serial1.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora o código da função de controle principal:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooSendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> channel, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> command, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> format)</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> buf[<span class="hljs-number"><span class="hljs-number">12</span></span>];<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">12</span></span>; i++) {<font></font>
    buf[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  }<font></font>
<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">85</span></span>;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">1</span></span>] = B01010000;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">2</span></span>] = command;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">3</span></span>] = format;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">5</span></span>] = channel;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">6</span></span>] = data;<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> checkSum = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) {<font></font>
    checkSum += buf[i];<font></font>
  }<font></font>
<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">10</span></span>] = lowByte(checkSum);<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">170</span></span>;<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">12</span></span>); i++) {<font></font>
    Serial1.write(buf[i]);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em princípio, nem precisamos saber como isso funciona; podemos usá-lo no modo "caixa preta" ou em um tipo de API, com uma certa interface destacada. </font><font style="vertical-align: inherit;">Só precisamos saber como usar essa interface. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você pode ver, existem apenas quatro parâmetros - canal, comando, dados e formato. </font><font style="vertical-align: inherit;">Você pode ler por que princípio as solicitações para esta API podem ser lidas no documento mencionado, mas simplificaremos ainda mais nossa tarefa e agruparemos essa interface em comandos simples de controle de dispositivos nooLite.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooBind</span></span></span><span class="hljs-function">  </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooUnbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooOn</span></span></span><span class="hljs-function">    </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooOff</span></span></span><span class="hljs-function">   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooValue</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v)</span></span></span><span class="hljs-function"> </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">6</span></span>, v, <span class="hljs-number"><span class="hljs-number">1</span></span>);}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Equipe relativamente complexa é apenas a última, lá, além do canal, o nível de potência também é definido. </font><font style="vertical-align: inherit;">Também há equipes no esboço em que não vamos nos concentrar agora, mas elas são formadas com a mesma facilidade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade ... é isso! </font><font style="vertical-align: inherit;">Nenhum lugar é mais fácil. </font><font style="vertical-align: inherit;">No código, os comandos de controle são assim:</font></font><br>
<br>
<pre><code class="java hljs">nooBind(ch);<font></font>
nooUnbind(ch);<font></font>
nooOn(ch);<font></font>
nooOff(ch);<font></font>
nooValue(ch, v);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos praticar o gerenciamento do módulo de energia nooLite. </font><font style="vertical-align: inherit;">Então, amarramos o bloco de potência no canal zero:</font></font><br>
<br>
<pre><code class="java hljs">nooBind(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O LED na unidade de energia começa a piscar. </font><font style="vertical-align: inherit;">Pressione o botão no bloco - o LED pára de piscar - o bloco de força está conectado. </font><font style="vertical-align: inherit;">Em vez do canal zero, você pode usar qualquer outro. </font><font style="vertical-align: inherit;">E você pode facilmente gerar o número do canal no código do esboço de acordo com suas necessidades. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ligue a lâmpada (se amarramos a lâmpada no canal zero, os comandos para ela devem ser enviados neste canal):</font></font><br>
<br>
<pre><code class="java hljs">nooOn(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defina a potência (brilho da lâmpada):</font></font><br>
<br>
<pre><code class="java hljs">nooValue(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui você precisa falar um pouco sobre as regras para formar uma equipe que define o nível de poder. O valor da energia não muda de 0 a 255, como se pode pensar, mas de 35 a 155. Se o valor for maior que 155, a potência será máxima, se for 0, isso será equivalente a um comando de desligamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui (apenas no caso) uma fórmula que converte valores "padrão" de 0 a 100 em um formato entendido pelo módulo nooLite:</font></font><br>
<br>
<pre><code class="java hljs">v = x * <span class="hljs-number"><span class="hljs-number">1.2</span></span> + <span class="hljs-number"><span class="hljs-number">34</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando esta fórmula, você pode definir o brilho da lâmpada na porcentagem usual de energia. </font><font style="vertical-align: inherit;">E, é claro, se você precisar ajustar a potência de maneira não linear, poderá criar uma variável v de acordo com qualquer lei ou até mesmo escolher valores fixos. </font><font style="vertical-align: inherit;">Isso será discutido na terceira parte do ciclo, quando ajustaremos a temperatura de aquecimento da estação de solda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desligue o dispositivo:</font></font><br>
<br>
<pre><code class="java hljs">nooOff(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desatar:</font></font><br>
<br>
<pre><code class="java hljs">nooUnbind(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O LED na unidade de energia começa a piscar. </font><font style="vertical-align: inherit;">Confirmamos o desacoplamento pressionando o botão na unidade de energia. </font><font style="vertical-align: inherit;">Agora é isso, agora a unidade de energia parou de responder aos nossos comandos e podemos "encaixá-la" novamente em qualquer um dos 32 canais do módulo nooLite MT1132. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está o esboço completo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código de esboço completo</font></font></b><div class="spoiler_text">byte const PIN_TX = 18; // TX PIN (to RX noolite)<br>
byte const PIN_RX = 19; // RX PIN (to TX noolite)<br>
<br>
void nooSendCommand(byte channel, byte command, byte data, byte format) {<br>
 byte buf[12];<br>
<br>
for (byte i = 0; i &lt; 12; i++) {<br>
 buf[i] = 0;<br>
 }<br>
<br>
buf[0] = 85;<br>
 buf[1] = B01010000;<br>
 buf[2] = command;<br>
 buf[3] = format;<br>
 buf[5] = channel;<br>
 buf[6] = data;<br>
<br>
int checkSum = 0;<br>
 for (byte i = 0; i &lt; 10; i++) {<br>
 checkSum += buf[i];<br>
 }<br>
<br>
buf[10] = lowByte(checkSum);<br>
 buf[11] = 170;<br>
<br>
for (byte i = 0; i &lt; (12); i++) {<br>
 Serial1.write(buf[i]);<br>
 }<br>
}<br>
<br>
void nooBind (byte ch) {nooSendCommand(ch, 15, 0, 0);}<br>
void nooUnbind (byte ch) {nooSendCommand(ch, 9, 0, 0);}<br>
<br>
void nooOn (byte ch) {nooSendCommand(ch, 2, 0, 0);}<br>
void nooOff (byte ch) {nooSendCommand(ch, 0, 0, 0);}<br>
void nooTrigger(byte ch) {nooSendCommand(ch, 4, 0, 0);}<br>
void nooCancel (byte ch) {nooSendCommand(ch, 10, 0, 0);}<br>
<br>
void nooUp (byte ch) {nooSendCommand(ch, 3, 0, 0);}<br>
void nooDown (byte ch) {nooSendCommand(ch, 1, 0, 0);}<br>
void nooRevers (byte ch) {nooSendCommand(ch, 5, 0, 0);}<br>
<br>
void nooValue (byte ch, byte v) {nooSendCommand(ch, 6, v, 1);}<br>
<br>
void setup() {<br>
 Serial1.begin(9600);<br>
<br>
/*     <br>
      loop(),    */<br>
<br>
//nooBind(0);<br>
<br>
//nooOn(0);<br>
 //nooOff(0);<br>
 //nooValue(0, 100);<br>
<br>
//nooUnbind(0); <br>
}<br>
<br>
void loop(){<br>
<br>
}<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subtotal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você pode ver, </font><font style="vertical-align: inherit;">não há nada complicado </font><font style="vertical-align: inherit;">em controlar os módulos de energia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nooLite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando o Arduino, pelo contrário, o controle é fenomenalmente simples: o módulo é conectado com um fio e os comandos são quase uma linguagem humana natural - "ligue o canal 0", "desligue o canal 1", "Definir a potência de 50% no canal 3" não é realmente mais simples.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bônus para quem leu até o fim</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro dia, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foi lançada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma nova versão do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Arduino Mega Server</font></a><font style="vertical-align: inherit;"> no número 0.14, na qual foram superadas todas as doenças infantis da tecnologia e que funcionam de maneira rápida e estável. </font><font style="vertical-align: inherit;">E a mesma versão contém o núcleo de controle integrado de instrumentos nooLite e como tudo funciona, você aprenderá com o próximo artigo da série “Equipamento sem fio nooLite e Smart Home (parte 2). </font><font style="vertical-align: inherit;">Mega Server do Arduino ". </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A segunda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terceira</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quarta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partes do ciclo.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt389067/">https://habr.com/ru/post/pt389067/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt389051/index.html">CNET Smart Home: Campo de testes de gadgets</a></li>
<li><a href="../pt389053/index.html">Casa inteligente. Cérebros</a></li>
<li><a href="../pt389057/index.html">CES 2016: anúncios da LG e Samsung para casa inteligente</a></li>
<li><a href="../pt389063/index.html">Como os carros quadrados dos anos 80 foram aperfeiçoados nos anos 90</a></li>
<li><a href="../pt389065/index.html">Sonda do amanhecer enviou fotos detalhadas das crateras de Ceres</a></li>
<li><a href="../pt389069/index.html">O Remix OS, um sistema operacional com várias janelas baseado no Android, já está disponível para PC</a></li>
<li><a href="../pt389071/index.html">Interferência nos sistemas globais de navegação por satélite</a></li>
<li><a href="../pt389073/index.html">Branto ORB: uma bola quase mágica para controlar sua casa</a></li>
<li><a href="../pt389075/index.html">Venda de Ano Novo</a></li>
<li><a href="../pt389077/index.html">Fundador da Oculus: PC de baixa potência é o principal obstáculo à popularização da realidade virtual</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>