<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ· ğŸ‘¨â€âš–ï¸ ğŸ¤™ğŸ¼ ÙƒÙŠÙ ÙˆØ¬Ø¯Øª Ø¨ÙŠØ¶Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØµØ­ ÙÙŠ Ø­Ù…Ø§ÙŠØ© Android ÙˆÙ„Ù… Ø£Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ¸ÙŠÙØ© ÙÙŠ Google ğŸ–– ğŸš¾ ğŸ™‡ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ø¬ÙˆØ¬Ù„ ÙŠØ­Ø¨ Ø¨ÙŠØ¶ Ø¹ÙŠØ¯ Ø§Ù„ÙØµØ­. Ø¥Ù†Ù‡ ÙŠØ­Ø¨ Ø§Ù„ÙƒØ«ÙŠØ± Ø¨Ø­ÙŠØ« ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§ ÙÙŠ ÙƒÙ„ Ù…Ù†ØªØ¬ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ©. ÙŠÙ…ØªØ¯ ØªÙ‚Ù„ÙŠØ¯ Ø¨ÙŠØ¶ Ø¹ÙŠØ¯ Ø§Ù„ÙØµØ­ ÙÙŠ Android Ù…Ù† Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ÙƒÙŠÙ ÙˆØ¬Ø¯Øª Ø¨ÙŠØ¶Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØµØ­ ÙÙŠ Ø­Ù…Ø§ÙŠØ© Android ÙˆÙ„Ù… Ø£Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ¸ÙŠÙØ© ÙÙŠ Google</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442872/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cx/0o/3t/cx0o3tqoavfz_opnsomw9-65h_i.jpeg" align="left">  Ø¬ÙˆØ¬Ù„ ÙŠØ­Ø¨ Ø¨ÙŠØ¶ Ø¹ÙŠØ¯ Ø§Ù„ÙØµØ­.  Ø¥Ù†Ù‡ ÙŠØ­Ø¨ Ø§Ù„ÙƒØ«ÙŠØ± Ø¨Ø­ÙŠØ« ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§ ÙÙŠ ÙƒÙ„ Ù…Ù†ØªØ¬ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ©.  ÙŠÙ…ØªØ¯ ØªÙ‚Ù„ÙŠØ¯ Ø¨ÙŠØ¶ Ø¹ÙŠØ¯ Ø§Ù„ÙØµØ­ ÙÙŠ Android Ù…Ù† Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ (Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠØ¹Ø±ÙÙˆÙ† Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø³ÙŠØ­Ø¯Ø« Ø¥Ø°Ø§ Ù†Ù‚Ø±Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø·Ø± Ù…Ø¹ Ø¥ØµØ¯Ø§Ø± Android Ø¹Ø¯Ø© Ù…Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª). <br><br>  ÙˆÙ„ÙƒÙ† ÙŠØ­Ø¯Ø« Ø£ÙŠØ¶Ù‹Ø§ Ø£Ù† Ø¨ÙŠØ¶ Ø¹ÙŠØ¯ Ø§Ù„ÙØµØ­ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø£ÙƒØ«Ø± Ø§Ù„Ø£Ù…Ø§ÙƒÙ† ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©.  Ø­ØªÙ‰ Ø£Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø«Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ø·ÙˆØ±Ø©: Ø¨Ù…Ø¬Ø±Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ google "mutex lock" ØŒ ÙˆØ¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ØŒ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰</a> ØµÙØ­Ø© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">foo.bar</a> ÙˆØ­Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª ÙˆØ­ØµÙ„ Ø¹Ù„Ù‰ ÙˆØ¸ÙŠÙØ© ÙÙŠ Google. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/157/242/ffc/157242ffcbf299f7a67641f9df1e551e.jpg" alt="Ø§Ù„ØµÙˆØ±Ø©"><br></div></div><br>  Ø¥Ù„ÙŠÙƒÙ… Ù†ÙØ³ Ø§Ù„Ù‚ØµØ© Ø§Ù„Ù…Ø¯Ù‡Ø´Ø© (ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ù†Ù‡Ø§ÙŠØ© Ø³Ø¹ÙŠØ¯Ø©) Ø­Ø¯Ø« Ù„ÙŠ.  Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø®ÙÙŠØ© Ø­ÙŠØ« Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ ØŒ Ù‚Ù… Ø¨Ø¹ÙƒØ³ ÙƒÙˆØ¯ Ø¬Ø§ÙØ§ ÙˆØ§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© ØŒ ÙˆØ¬Ù‡Ø§Ø² Ø¸Ø§Ù‡Ø±ÙŠ Ø³Ø±ÙŠ ØŒ ÙˆÙ…Ù‚Ø§Ø¨Ù„Ø© ÙÙŠ Google - ÙƒÙ„ Ù‡Ø°Ø§ ØªØ­Øª Ø§Ù„Ù‚Øµ. <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  Droidguard </h3><br>  ÙÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù…Ù…Ù„Ø© ØŒ Ù‚Ù…Øª Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹ ÙˆØ¨Ø¯Ø£Øª ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø°ÙƒÙŠ.  Ø¨Ø§Ø¯Ø¦ Ø°ÙŠ Ø¨Ø¯Ø¡ ØŒ Ø·Ù„Ø¨ Ù…Ù†ÙŠ Android Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ø¯Ø®Ø§Ù„ Ø­Ø³Ø§Ø¨ Google Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ.  "Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù… ØŒ Ù„ÙƒÙ† ÙƒÙŠÙ ÙŠØ­Ø¯Ø« Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ù†Ø¸Ø§Ù… AndroidØŸ"  ØªÙˆÙ‚Ù Ø§Ù„Ù…Ø³Ø§Ø¡ Ù„ÙŠÙƒÙˆÙ† Ø¶Ø¹ÙŠÙÙ‹Ø§. <br><br>  Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØªØ­Ù„ÙŠÙ„Ù‡Ø§ ØŒ Ø£Ø³ØªØ®Ø¯Ù… Burp Suite Ù…Ù† PortSwigger.  Ø³ÙŠÙƒÙˆÙ† Ø¥ØµØ¯Ø§Ø± Ù…Ø¬ØªÙ…Ø¹ Ù…Ø¬Ø§Ù†ÙŠ ÙƒØ§ÙÙŠÙ‹Ø§.  Ø­ØªÙ‰ Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø±Ø¤ÙŠØ© Ø·Ù„Ø¨Ø§Øª https ØŒ ÙŠØ¬Ø¨ Ø£ÙˆÙ„Ø§Ù‹ ØªØ«Ø¨ÙŠØª Ø´Ù‡Ø§Ø¯Ø© Ù…Ù† PortSwigger Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø².  Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØŒ ÙˆØ¬Ø¯Øª ÙÙŠ ØµÙ†Ø§Ø¯ÙŠÙ‚ÙŠ Ø¬Ù‡Ø§Ø² Samsung Galaxy S ÙŠØ¨Ù„Øº Ù…Ù† Ø§Ù„Ø¹Ù…Ø± Ø«Ù…Ø§Ù†ÙŠ Ø³Ù†ÙˆØ§Øª Ù…Ø¹ Ù†Ø¸Ø§Ù… Android 4.4.  Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø´ÙŠØ¡ Ø£Ø¹Ø°Ø¨ ØŒ ÙÙ‚Ø¯ ØªÙˆØ§Ø¬Ù‡ Ù…Ø´ÙƒÙ„Ø§Øª ÙÙŠ https: ØªØ«Ø¨ÙŠØª Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙˆÙƒÙ„ Ø°Ù„Ùƒ. <br><br>  ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠØ¡ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø¨Ø´ÙƒÙ„ Ø®Ø§Øµ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Google API.  ÙŠØ±Ø³Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù† Ù†ÙØ³Ù‡ ØŒ ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ ÙŠØªÙ„Ù‚Ù‰ Ø§Ù„Ø±Ù…ÙˆØ² ... Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„ÙˆØ­ÙŠØ¯Ø© ØºÙŠØ± Ø§Ù„Ù…ÙÙ‡ÙˆÙ…Ø© Ù‡ÙŠ Ø·Ù„Ø¨ POST Ù„Ø®Ø¯Ù…Ø© Ù…ÙƒØ§ÙØ­Ø© Ø¥Ø³Ø§Ø¡Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…. <br><br><img src="https://habrastorage.org/webt/nv/4c/7n/nv4c7njt_zecyvp0vquekhnoxbm.png"><br><br>  Ø¨Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ ØŒ Ù…Ù† Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª ØºÙŠØ± Ù…Ù„Ø­ÙˆØ¸Ø© ØŒ ØªØ¸Ù‡Ø± ÙˆØ§Ø­Ø¯Ø© ØºØ§Ù…Ø¶Ø© ØŒ Ù…Ø¹ Ø§Ø³Ù… <b>droidguard_result</b> .  Ø¥Ù†Ù‡Ø§ Ø³Ù„Ø³Ù„Ø© Base64 Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ù‹Ø§: <br><br><img src="https://habrastorage.org/webt/kp/h3/i-/kph3i-1n7tw9dv-ckitddw4rxdm.png"><br><br>  <b>DroidGuard</b> Ù‡ÙŠ Ø¢Ù„ÙŠØ© Ø¬ÙˆØ¬Ù„ Ù„ÙØµÙ„ Ø§Ù„Ø¨ÙˆØªØ§Øª ÙˆØ§Ù„Ù…Ø­Ø§ÙƒÙŠØ§Øª Ø¹Ù† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©.  ØªØ³ØªØ®Ø¯Ù… SafetyNet Ø£ÙŠØ¶Ù‹Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† DroidGuard ÙÙŠ Ø¹Ù…Ù„Ù‡Ø§.  Ø¬ÙˆØ¬Ù„ Ù„Ø¯ÙŠÙ‡Ø§ Ø´ÙŠØ¡ Ù…Ù…Ø§Ø«Ù„ Ù„Ù„Ù…ØªØµÙØ­Ø§Øª - Botguard. <br><br>  ÙˆÙ„ÙƒÙ† Ù„Ø§ ÙŠØ²Ø§Ù„ ØŒ Ù…Ø§ Ù‡ÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØŒ Ù…Ø§ ÙŠÙ†ØªÙ‚Ù„ ÙÙŠ Ø°Ù„ÙƒØŸ  Ø§Ù„Ø¢Ù† Ø³ÙˆÙ Ù†ÙÙ‡Ù…. <br><br><h3 style=";text-align:right;direction:rtl">  Ù…Ø®Ø§Ø²Ù† Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ </h3><br>  Ù…Ù† Ø£ÙŠÙ† ÙŠØ£ØªÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">www.googleapis.com/androidantiabuse/v1/x/createØŸalt=PROTO&amp;key=AIzaSyBofcZsgLSS7BOnBjZPEkk4rYwzOIz-lTI</a></i> ØŒ Ù…Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø¶Ø¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ Ù†Ø¸Ø§Ù… AndroidØŸ  Ù…Ù† Ø§Ù„Ø³Ù‡Ù„ Ø£Ù† ØªØ¬Ø¯ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø®Ø²Ù‘Ù† Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙÙŠ Ø£Ø­Ø¯ ÙØ¦Ø§Øª Ø®Ø¯Ù…Ø§Øª Google Play Ø§Ù„Ù…Ø¨Ù‡Ù…Ø©: <br><br><pre style=";text-align:right;direction:rtl"><code class="java">public bdd(Context var1, bdh var2) {
  this(var1, "https://www.googleapis.com/androidantiabuse/v1/x/create?alt=PROTO&amp;key=AIzaSyBofcZsgLSS7BOnBjZPEkk4rYwzOIz-lTI", var2);
}
</code></pre><br>
     Burp, <b>Content-Type</b>  POST     â€” <b>application/x-protobuf</b> (Google Protocol Buffers,      Google).  json,  â€”     ,   .<br>
<br>
 protocol buffers  : <br>
<br>
<ul>
<li>          .proto </li>
<li> .proto ,    protoc        (   Android  Java)</li>
<li>     </li>
</ul><br>
     protobuf     .  â€”  -    protobuf      .proto .  â€”    protoc-   Google Play Services.      .<br>
<br>
 apk  Google Play Services   ,     (   ,  apk      ).   dex2jar  .dex    .jar    .       Fernflower  JetBrains.      IntelliJ IDEA ( Android Studio),     Android Studio      .  proguard   ,   Java     protobuf       .<br>
<br>
   ,   protobuf      Build.* (,    ):<br>
<br>
<pre><code class="java">...
var3.a("4.0.33 (910055-30)");
a(var3, "BOARD", Build.BOARD);
a(var3, "BOOTLOADER", Build.BOOTLOADER);
a(var3, "BRAND", Build.BRAND);
a(var3, "CPU_ABI", Build.CPU_ABI);
a(var3, "CPU_ABI2", Build.CPU_ABI2);
a(var3, "DEVICE", Build.DEVICE);
...
</code></pre><br>
    ,  ,   protobuf         .      ,     .    ,    :<br>
<br>
<pre><code class="java">if (!var7.d()) {
    throw new bdf("byteCode");
}
if (!var7.f()) {
    throw new bdf("vmUrl");
}
if (!var7.h()) {
    throw new bdf("vmChecksum");
}
if (!var7.j()) {
	throw new bdf("expiryTimeSecs");
}
</code></pre><br>
  ,       : <b>byteCode</b>, <b>vmUrl</b>, <b>vmChecksum</b>  <b>expiryTimeSecs</b>.       .<br>
<br>
     Google Play Services   , ,    Build.*   (      ).  -  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   </a>.<br>
<br>
       :<br>
<blockquote>00:06:26.761 [main] INFO d.a.response.AntiabuseResponse â€” byteCode size: 34446<br>
00:06:26.761 [main] INFO d.a.response.AntiabuseResponse â€” vmChecksum: C15E93CCFD9EF178293A2334A1C9F9B08F115993<br>
00:06:26.761 [main] INFO d.a.response.AntiabuseResponse â€” vmUrl: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">www.gstatic.com/droidguard/C15E93CCFD9EF178293A2334A1C9F9B08F115993</a><br>
00:06:26.761 [main] INFO d.a.response.AntiabuseResponse â€” expiryTimeSecs: 10</blockquote><br>
  .  ,      <b>vmUrl.</b><br>
<br>
<h3> apk</h3><br>
     .apk ,     SHA-1 .    apk   â€”   150 .    :        Android ,    270  .<br>
<br>
<img src="https://habrastorage.org/webt/-s/di/nj/-sdinjinilpprsvgslvs3e6gsdk.png"><br>
<br>
<code>DroidGuardService</code>,    Google Play Services,      , ,  .dex  .so   ,  reflection,   <code>com.google.ccc.abuse.droidguard.DroidGuard</code>.   - ,  <code>DroidGuardService</code>   DroidGuard  Droidguasso.    Droidguasso â€”   .<br>
<br>
 ,  <code>DroidGuard</code> â€”   JNI    .so . ABI    ,     protobuf    <code>CPU_ABI</code>:   armeabi,  x86,    mips.<br>
<br>
  <code>DroidGuardService</code>   -        <code>DroidGuard</code>.       <code>DroidGuard</code>,     <b>byteCode</b>  protobuf ,   ,    .          <b>droidguard_result</b>.<br>
<br>
     ,    <code>DroidGuard</code>     <code>DroidGuardService</code> (   apk,         ).    .dex    APK,   .jar      .     ,   <code>DroidGuard</code>   .       <code>loadDroidGuardLibrary()</code>:<br>
<br>
<pre><code class="java">static
  {
    try
    {
      loadDroidGuardLibrary();
    }
    catch (Exception ex)
    {
      throw new RuntimeException(ex);
    }
  }
</code></pre><br>
  ,  <code>loadDroidGuardLibrary()</code>   library.txt (    .apk )         <code>System.load(String filename)</code>.      ,  -    apk,     library.txt  .so .      .so    lib    <code>System.loadLibrary(String libname)</code>. <br>
<br>
  .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">smali/baksmali</a> â€” /  dex .    classes.dex    .smali .  <code>com.google.ccc.abuse.droidguard.DroidGuard</code>    ,        <code>System.loadLibrary("droidguard")</code>  <code>loadDroidGuardLibrary()</code>.  smali  ,       :<br>
<br>
<pre><code class="plaintext">.method static constructor &lt;clinit&gt;()V
    .locals 1
    const-string v0, "droidguard"
    invoke-static {v0}, Ljava/lang/System;-&gt;loadLibrary(Ljava/lang/String;)V
    return-void
.end method
</code></pre><br>
   baksmali      .dex,       .jar.       jar ,      . , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a>.<br>
<br>
   <code>DroidGuard</code>   .   â€”   ,          anti-abuse       <code>DroidGuard</code>.<br>
<br>
<pre><code class="kotlin">private fun runDroidguard() {
        var byteCode: ByteArray? = loadBytecode("bytecode.base64");
        byteCode?.let {
            val droidguard = DroidGuard(applicationContext, "addAccount", it)
            val params = mapOf("dg_email" to "test@gmail.com", "dg_gmsCoreVersion" to "910055-30",
                "dg_package" to "com.google.android.gms", "dg_androidId" to UUID.randomUUID().toString())
            droidguard.init()
            val result = droidguard.ss(params)
            droidguard.close()
        }
    }
</code></pre><br>
    Android Studio   ,      DroidGuard.<br>
<br>
<img src="https://habrastorage.org/webt/c-/9w/pz/c-9wpzbrrpibjyflhyrunq3azu0.png"><br>
<br>
  <code>initNative()</code>       java-: <code>hasSystemFeature(), getMemoryInfo(), getPackageInfo()</code>â€¦  -,       . ,   ,    .so .<br>
<br>
<h3>libdroidguard.so</h3><br>
  ,      ,   .dex  .jar .  ,   Hex-Rays IDA       arm  x86,  .   arm,          .     ,      x86    . <br>
<br>
,   Hex-Rays IDA,    -   c-.     <code>Java_com_google_ccc_abuse_droidguard_DroidGuard_ssNative</code>,     :<br>
<br>
<pre><code class="cpp">__int64 __fastcall Java_com_google_ccc_abuse_droidguard_DroidGuard_initNative(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9)  
...
  v14 = (*(_DWORD *)v9 + 684))(v9, a5);  
  v15 = (*(_DWORD *)v9 + 736))(v9, a5, 0);
...
</code></pre><br>
  .       ,      .      JNI,   Android NDK    jni.h.    ,    JNI  â€”  <code>JNIEnv*</code>  <code>jobject (this)</code>.           Java  DroidGuard.    ,      JNI :<br>
<br>
<pre><code class="cpp">__int64 __fastcall Java_com_google_ccc_abuse_droidguard_DroidGuard_initNative(_JNIEnv *env, jobject thiz, jobject context, jstring flow, jbyteArray byteCode, jobject runtimeApi, jobject extras, jint loggingFd, int runningInAppSide)
{
...
  programLength = _env-&gt;functions-&gt;GetArrayLength)(_env, byteCode);  
  programBytes = (jbyte *)_env-&gt;functions-&gt;GetByteArrayElements)(_env, byteCode, 0);
...
</code></pre><br>
        ,     anti-abuse ,   .  ,     Â«   ?Â»  .     -,    â€”  .  AES ,         -   .   â€”  ,    .    ,   70:  int,  byte,  ,  java ,   , if-goto   .<br>
<br>
<h3>Wake up, Neo</h3><br>
          -    .     :  (   )     ,       .    ,         Java.<br>
<br>
-            . ,     ,     dlsym  .   java        5       25  - anti-abuse .  26-           -.  ,       .<br>
<blockquote>Virtual Machine command #26<br>
Method invocation vm-&gt;vm_method_table[2 * 0x77]<br>
Method vmMethod_readString<br>
index is 0x9d<br>
string length is 0x0066<br>
(new key is generated)<br>
encoded string bytes are EB 4E E6 DC 34 13 35 4A DD 55 B3 91 33 05 61 04 C0 54 FD 95 2F 18 72 04 C1 55 E1 92 28 11 66 04 DD 4F B3 94 33 04 35 0A C1 4E B2 DB 12 17 79 4F 92 55 FC DB 33 05 35 45 C6 01 F7 89 29 1F 71 43 C7 40 E1 9F 6B 1E 70 48 DE 4E B8 CD 75 44 23 14 85 14 A7 C2 7F 40 26 42 84 17 A2 BB 21 19 7A 43 DE 44 BD 98 29 1B <br>
decoded string bytes are 59 6F 75 27 72 65 20 6E 6F 74 20 6A 75 73 74 20 72 75 6E 6E 69 6E 67 20 73 74 72 69 6E 67 73 20 6F 6E 20 6F 75 72 20 2E 73 6F 21 20 54 61 6C 6B 20 74 6F 20 75 73 20 61 74 20 64 72 6F 69 64 67 75 61 72 64 2D 68 65 6C 6C 6F 2B 36 33 32 36 30 37 35 34 39 39 36 33 66 36 36 31 40 67 6F 6F 67 6C 65 2E 63 6F 6D <br>
decoded string value is (<b>You're not just running strings on our .so! Talk to us at droidguard@google.com</b>)</blockquote><br>
 ,          .  ,   ,       .  ,        ,             anti-abuse   -.     25-30   -  .   ,    .  , ,  .          Â«droidguard+tag@google.comÂ»:     anti-abuse   tag .<br>
<blockquote>droidguard@google.com: Don't be a stranger!<br>
You got in! Talk to us at droidguard@google.com<br>
Greetings from droidguard@google.com intrepid traveller! Say hi!<br>
Was it easy to find this? droidguard@google.com would like to know<br>
The folks at droidguard@google.com would appreciate hearing from you!<br>
What's all this gobbledygook? Ask droidguard@google.comâ€¦ they'd know!<br>
Hey! Fancy seeing you here. Have you spoken to droidguard@google.com yet?<br>
You're not just running strings on our .so! Talk to us at droidguard@google.com<br>
</blockquote><br>
,    ?  ,      DroidGuard    Google,      .<br>
<br>
<h3>     </h3><br>
         .    ,       .   ,       -  .     ,   .   ,   Hex-Rays IDA,     .               .<br>
<br>
 Java       .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">jelf </a>(   ELF )    <code>Java_com_google_ccc_abuse_droidguard_DroidGuard_initNative</code>  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Capstone</a> (  ,      ,    Java)             .<br>
<br>
   ,     DroidGuard:    anti-abuse ,  apk, ,   ,    ,        -.     ,     Google.          glassdoor      .         .<br>
<br>
     .     DroidGuard   : Â«    ?Â».<br>
<br>
<img src="https://habrastorage.org/webt/go/ql/kf/goqlkffwq02w6daa9-e22xxgdiq.jpeg"><br>
<br>
Â«Â» â€”  .  Google  ,    DroidGuard:   Android   (  !).            DroidGuard.     .<br>
<br>
<h3></h3><br>
      .   DroidGuard     .       ?  !<br>
<br>
      Google . ,        â€”     hr .         .<br>
<br>
    Google    . ,      Google Doc    ,     .      Â«Â»  coursera,     hackerrank,            â€¦<br>
<br>
    . ,     â€”   . Google Doc    IDE.  ,       . ,       ,  5        .          â€”   .   â€”    ,             .   ,    â€¦<br>
<br>
<img src="https://habrastorage.org/webt/5c/nk/uh/5cnkuh5btyvoaz0pyz-zma3flzs.png"><br>
<br>
â€¦          .  ,   ,             .      .      Base64     .        Base64.       ,        Base64,       Java.<br>
<br>
<div class="spoiler"><b class="spoiler_title">    Google</b><div class="spoiler_text">,  ,     ! .   ,       . <br>
</div></div><br>
 3      ,    ,      .      Google  .<br>
<br>
  DroidGuard  ,  ,     . ,   .   ,     :      ,     .<br>
<br>
 ,      Google    .   ,             (   , ).    .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar442872/">https://habr.com/ru/post/ar442872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar442862/index.html">Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø±: Ù†Ø¸Ø±Ø© Ø¯Ø§Ø®Ù„ÙŠØ©</a></li>
<li><a href="../ar442864/index.html">ÙƒÙ… Ø¹Ù…Ø± Ø³ÙŠØ¯Ùƒ</a></li>
<li><a href="../ar442866/index.html">AI Ø§Ù„Ù…Ø¯Ø±Ø¨ÙŠÙ† Ù…Ù† Ø¹Ù‚ÙˆØ¯ Ù…Ù† Ø§Ù„Ø·Ù‡ÙŠ ÙŠØ®Ù„Ù‚ Ø£Ø·Ø¨Ø§Ù‚ Ø¬Ø¯ÙŠØ¯Ø©</a></li>
<li><a href="../ar442868/index.html">Ø±Ø­Ù„Ø© Ù‚ØµÙŠØ±Ø© Ø¥Ù„Ù‰ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯ ÙÙŠ Ù…Ø±ÙƒØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª ÙˆØ³Ù„Ø¨ÙŠØ§Øª</a></li>
<li><a href="../ar442870/index.html">Ø£ÙØ¶Ù„ Ù…Ø§ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø²Ø§ÙˆÙŠ Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ - Ø§Ù„Ù…Ù„Ø®Øµ Ø±Ù‚Ù… 2 (26 ÙŠÙ†Ø§ÙŠØ± - 7 Ù…Ø§Ø±Ø³)</a></li>
<li><a href="../ar442876/index.html">ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ Ù…Ø¹ KSQL Ùˆ Raspberry Pi ÙˆØ§Ù„Ø¥Ø°Ø§Ø¹Ø©</a></li>
<li><a href="../ar442880/index.html">Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</a></li>
<li><a href="../ar442882/index.html">[ÙÙŠØ¯ÙŠÙˆ] "Ù„ÙŠØ³Øª Ù‡Ù†Ø§Ùƒ Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ Piems" ÙˆØ«Ù„Ø§Ø«Ø© Ø£ÙÙƒØ§Ø± Ø£Ø®Ø±Ù‰ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</a></li>
<li><a href="../ar442884/index.html">Ø¨Ø§Ù„ÙØ¹Ù„ ØŒ ØªØªÙŠØ­ Ù„Ùƒ Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙƒØ´Ø®Øµ</a></li>
<li><a href="../ar442886/index.html">Sketch + Node.js: Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…ÙˆØ² Ù„Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ù†ØµØ§Øª ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©. Ø§Ù„Ø¬Ø²Ø¡ 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>