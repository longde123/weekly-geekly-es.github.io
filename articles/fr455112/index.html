<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåπ ‚úãüèø üë®üèæ‚Äçüî¨ Bitrix24: "Rapidement lev√© n'est pas consid√©r√© comme tomb√©" üíÉüèΩ üèüÔ∏è üÖ±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä ce jour, le service Bitrix24 n'a pas des centaines de gigabits de trafic, il n'y a pas une √©norme flotte de serveurs (bien qu'il y en ait beaucoup, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bitrix24: "Rapidement lev√© n'est pas consid√©r√© comme tomb√©"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/455112/">  √Ä ce jour, le service Bitrix24 n'a pas des centaines de gigabits de trafic, il n'y a pas une √©norme flotte de serveurs (bien qu'il y en ait beaucoup, bien s√ªr, des serveurs existants).  Mais pour de nombreux clients, c'est le principal outil de travail en entreprise, c'est une v√©ritable application critique pour l'entreprise.  Par cons√©quent, tomber - enfin, pas question.  Mais que se passe-t-il si la chute se produit, mais le service se ¬´rebelle¬ª si rapidement que personne ne remarque rien?  Et comment g√©rez-vous la mise en ≈ìuvre du basculement sans perdre en qualit√© de travail et en nombre de clients?  Alexander Demidov, directeur des services cloud Bitrix24, a expliqu√© √† notre blog comment le syst√®me de sauvegarde a √©volu√© au cours des 7 ann√©es d'existence du produit. <br><br><img src="https://habrastorage.org/webt/xp/iz/9_/xpiz9_ri1tdppyelfb8nu9tzeg8.jpeg"><br><a name="habracut"></a><br>  ¬´Sous forme de SaaS, nous avons lanc√© Bitrix24 il y a 7 ans.  La principale difficult√©, probablement, √©tait la suivante: avant son lancement en public sous forme de SaaS, ce produit existait simplement sous la forme d'une solution en bo√Æte.  Les clients nous l'ont achet√©, l'ont plac√© sur leurs serveurs, ont cr√©√© un portail d'entreprise - une solution commune pour la communication avec les employ√©s, le stockage de fichiers, la gestion des t√¢ches, le CRM, c'est tout.  Et en 2012, nous avons d√©cid√© que nous voulions le lancer en tant que SaaS, en l'administrant nous-m√™mes, en offrant une tol√©rance aux pannes et une fiabilit√©.  Nous avons acquis de l'exp√©rience dans le processus, car jusque-l√† nous ne l'avions tout simplement pas - nous n'√©tions que des fabricants de logiciels, pas des prestataires de services. <br><br>  Lors du lancement du service, nous avons compris que la chose la plus importante est d'assurer la tol√©rance aux pannes, la fiabilit√© et la disponibilit√© constante du service, car si vous avez un simple site web r√©gulier, un magasin par exemple, et qu'il vous est tomb√© et ment une heure - vous seul souffrez, vous perdez des commandes , vous perdez des clients, mais pour votre client lui-m√™me - pour lui, ce n'est pas tr√®s critique.  Il √©tait boulevers√©, bien s√ªr, mais est all√© acheter sur un autre site.  Et s'il s'agit d'une application √† laquelle tous travaillent au sein de l'entreprise, aux communications, aux solutions est li√©e, alors le plus important est de gagner la confiance des utilisateurs, c'est-√†-dire de ne pas les laisser tomber et de ne pas tomber.  Parce que tout le travail peut se lever si quelque chose √† l'int√©rieur ne fonctionne pas. <br><br><h4>  Bitrix.24 en tant que SaaS </h4><br>  Le premier prototype que nous avons assembl√© un an avant le lancement public, en 2011.  R√©uni dans environ une semaine, regard√©, tordu - il travaillait m√™me.  Autrement dit, il √©tait possible d'entrer dans le formulaire, d'y saisir le nom du portail, un nouveau portail se d√©roulait, une base d'utilisateurs √©tait en cours de cr√©ation.  Nous l'avons examin√©, √©valu√© le produit en principe, l'avons d√©sactiv√© et l'avons finalis√© un an plus tard.  Parce que nous avions une grosse t√¢che: nous ne voulions pas cr√©er deux bases de code diff√©rentes, nous ne voulions pas prendre en charge un produit en bo√Æte s√©par√©, des solutions cloud distinctes - nous voulions faire tout cela dans le m√™me code. <br><br><img src="https://habrastorage.org/webt/lw/zu/fe/lwzufe1w3lchcx7iqtwwh04gqfu.jpeg"><br><br>  Une application web typique √† cette √©poque est un serveur sur lequel un code php est en cours d'ex√©cution, la base mysql, des fichiers sont t√©l√©charg√©s, des documents, des images sont mis dans le t√©l√©chargement papa - eh bien, tout fonctionne.  H√©las, il est impossible d'ex√©cuter un service Web extr√™mement durable √† ce sujet.  Le cache distribu√© n'y est pas pris en charge, la r√©plication de la base de donn√©es n'est pas prise en charge. <br><br>  Nous avons formul√© les exigences: cette capacit√© √† √™tre situ√©e √† diff√©rents endroits, √† prendre en charge la r√©plication, id√©alement √† √™tre situ√©e dans diff√©rents centres de donn√©es g√©ographiquement r√©partis.  S√©parez la logique du produit et, en fait, le stockage des donn√©es.  Dynamiquement pouvoir √©voluer en fonction de la charge, g√©n√©ralement faire de la statique.  De ces consid√©rations, en fait, il y avait des exigences pour le produit, que nous venons de d√©velopper au cours de l'ann√©e.  Pendant ce temps, dans une plate-forme qui s'est av√©r√©e unifi√©e - pour les solutions en bo√Æte, pour notre propre service - nous avons pris en charge les choses dont nous avions besoin.  Prise en charge de la r√©plication mysql au niveau du produit lui-m√™me: c'est-√†-dire que le d√©veloppeur qui √©crit le code ne pense pas √† la fa√ßon dont ses requ√™tes seront distribu√©es, il utilise notre API, et nous pouvons distribuer correctement les requ√™tes d'√©criture et de lecture entre les ma√Ætres et les esclaves. <br><br>  Nous avons pris en charge au niveau du produit divers magasins d'objets cloud: stockage Google, amazon s3, - plus, prise en charge de la pile ouverte rapide.  Par cons√©quent, cela √©tait pratique pour nous en tant que service et pour les d√©veloppeurs qui travaillent avec une solution en bo√Æte: s'ils utilisent simplement notre API pour le travail, ils ne pensent pas o√π le fichier sera enregistr√©, soit localement sur le syst√®me de fichiers, soit dans le stockage de fichiers objet. . <br><br>  En cons√©quence, nous avons imm√©diatement d√©cid√© de r√©server au niveau d'un centre de donn√©es complet.  En 2012, nous avons lanc√© compl√®tement dans Amazon AWS, car nous avions d√©j√† de l'exp√©rience avec cette plate-forme - notre propre site Web y √©tait h√©berg√©.  Nous avons √©t√© attir√©s par le fait que dans chaque r√©gion d'Amazon il y a plusieurs zones d'acc√®s - en fait, dans leur terminologie, plusieurs centres de donn√©es plus ou moins ind√©pendants les uns des autres et nous permettent de r√©server au niveau d'un centre de donn√©es entier: si il √©choue soudainement, les bases de donn√©es ma√Ætre-ma√Ætre sont r√©pliqu√©es, les serveurs d'applications Web sont r√©serv√©s et la statique est d√©plac√©e vers le stockage d'objets s3.  La charge est √©quilibr√©e - √† cette √©poque le coude amazonien, mais un peu plus tard, nous sommes arriv√©s √† nos propres √©quilibreurs, car nous avions besoin d'une logique plus complexe. <br><br><h4>  Ce qu'ils voulaient, ils l'ont obtenu ... </h4><br>  Toutes les choses de base que nous voulions fournir - la tol√©rance aux pannes des serveurs eux-m√™mes, les applications Web, les bases de donn√©es - tout fonctionnait bien.  Le sc√©nario le plus simple: si certaines applications Web √©chouent, alors tout est simple - elles sont d√©sactiv√©es de la balance. <br><br><img src="https://habrastorage.org/webt/0y/vn/7h/0yvn7ho3syy9rpwkz8wo7govryu.jpeg"><br><br>  L'√©quilibreur de machine (alors c'√©tait un elbe amazonien) qui a fait planter la machine elle-m√™me marqu√©e comme malsaine, a d√©sactiv√© la distribution de charge sur eux.  L'autoscaling amazonien a fonctionn√©: lorsque la charge a augment√©, de nouvelles voitures ont √©t√© ajout√©es au groupe d'autoscaling, la charge a √©t√© distribu√©e aux nouvelles voitures - tout allait bien.  Avec nos √©quilibreurs, la logique est √† peu pr√®s la m√™me: si quelque chose arrive au serveur d'applications, nous en supprimons les demandes, jetons ces machines, en d√©marrons de nouvelles et continuons √† travailler.  Le sch√©ma pour toutes ces ann√©es a un peu chang√©, mais continue de fonctionner: il est simple, compr√©hensible, et cela ne pose aucun probl√®me. <br><br>  Nous travaillons partout dans le monde, la charge de pointe des clients est compl√®tement diff√©rente et, dans le bon sens, nous devrions √™tre en mesure d'effectuer √† tout moment certains travaux de maintenance avec tous les composants de notre syst√®me - de mani√®re invisible pour les clients.  Par cons√©quent, nous avons la possibilit√© d'arr√™ter la base de donn√©es du travail, en redistribuant la charge sur le deuxi√®me centre de donn√©es. <br><br>  Comment √ßa marche?  - Nous transf√©rons le trafic vers un centre de donn√©es op√©rationnel - s'il s'agit d'un accident dans un centre de donn√©es, puis compl√®tement, si c'est notre travail pr√©vu avec une base donn√©e, alors nous faisons partie du trafic desservant ces clients, basculons vers un deuxi√®me centre de donn√©es, il s'arr√™te r√©plication.  Si vous avez besoin de nouvelles machines pour les applications Web, car la charge sur le deuxi√®me centre de donn√©es a augment√©, elles d√©marrent automatiquement.  Nous terminons le travail, la r√©plication est restaur√©e et nous renvoyons la totalit√© de la charge.  Si nous devons refl√©ter certains travaux dans le deuxi√®me contr√¥leur de domaine, par exemple, installer des mises √† jour syst√®me ou modifier les param√®tres dans la deuxi√®me base de donn√©es, alors, en g√©n√©ral, nous r√©p√©tons la m√™me chose, juste dans l'autre sens.  Et s'il s'agit d'un accident, nous faisons tout en un rien de temps: dans le syst√®me de surveillance, nous utilisons le m√©canisme des gestionnaires d'√©v√©nements.  Si plusieurs v√©rifications fonctionnent pour nous et que l'√©tat devient critique, alors ce gestionnaire est lanc√©, un gestionnaire qui peut ex√©cuter telle ou telle logique.  Pour chaque base de donn√©es, nous avons enregistr√© quel serveur est le basculement pour elle, et o√π vous devez changer le trafic s'il n'est pas disponible.  Nous - comme cela s'est d√©velopp√© historiquement - utilisons sous une forme ou une autre nagios ou l'une de ses fourchettes.  En principe, des m√©canismes similaires existent dans presque tous les syst√®mes de surveillance, nous n'utilisons pas encore quelque chose de plus compliqu√©, mais peut-√™tre qu'un jour nous le ferons.  Maintenant, la surveillance est d√©clench√©e par l'inaccessibilit√© et a la possibilit√© de changer quelque chose. <br><br><h4>  Avons-nous tout r√©serv√©? </h4><br>  Nous avons de nombreux clients des √âtats-Unis, de nombreux clients d'Europe, de nombreux clients plus proches de l'Est - le Japon, Singapour, etc.  Bien s√ªr, une √©norme proportion de clients en Russie.  Autrement dit, le travail est loin d'√™tre dans une seule r√©gion.  Les utilisateurs veulent une r√©ponse rapide, il y a des exigences pour observer les diff√©rentes lois locales, et dans chaque r√©gion, nous r√©servons pour deux centres de donn√©es, en plus il y a quelques services suppl√©mentaires qui, encore une fois, sont pratiques √† placer dans une r√©gion - pour les clients qui sont dans ce travail r√©gional.  Les gestionnaires REST, les serveurs d'autorisation, ils sont moins critiques pour le client dans son ensemble, vous pouvez basculer entre eux avec un petit d√©lai acceptable, mais vous ne voulez pas inventer des v√©los, comment les surveiller et quoi en faire.  Par cons√©quent, nous essayons au maximum d'utiliser les solutions existantes, et non de d√©velopper une certaine comp√©tence dans des produits suppl√©mentaires.  Et quelque part, nous utilisons trivialement la commutation au niveau du DNS et nous d√©terminons la vivacit√© du service avec les m√™mes DNS.  Amazon a un service Route 53, mais ce n'est pas seulement le DNS dans lequel vous pouvez tout enregistrer, c'est beaucoup plus flexible et pratique.  Gr√¢ce √† lui, vous pouvez cr√©er des services g√©o-distribu√©s avec des g√©olocalisations, lorsque vous l'utilisez pour d√©terminer d'o√π vient le client et leur donner certains enregistrements - avec lui, vous pouvez cr√©er des architectures de basculement.  Les m√™mes v√©rifications de l'√©tat sont configur√©es dans Route 53 lui-m√™me, vous sp√©cifiez des points de terminaison qui sont surveill√©s, d√©finissez des m√©triques et sp√©cifiez les protocoles qui d√©terminent la vivacit√© du service - tcp, http, https;  d√©finir la fr√©quence des v√©rifications qui d√©terminent si le service est en direct ou non.  Et dans le DNS lui-m√™me, vous prescrivez ce qui sera principal, ce qui sera secondaire, o√π basculer si le contr√¥le de sant√© √† l'int√©rieur de la route 53 est d√©clench√©. Tout cela peut √™tre fait avec d'autres outils, mais ce qui est plus pratique - nous le configurons une fois, puis ne pensons pas √† comment nous v√©rifions, comment nous changeons: tout fonctionne par lui-m√™me. <br><br>  <b>Le premier ¬´mais¬ª</b> : comment et comment r√©server la route 53 elle-m√™me?  Cela arrive-t-il si quelque chose lui arrive?  Heureusement, nous n'avons jamais march√© sur ce r√¢teau, mais encore une fois, devant moi, je vais avoir une histoire pourquoi nous pensions que nous devions encore r√©server.  Ici, nous posons la paille √† l'avance.  Plusieurs fois par jour, nous effectuons un d√©chargement complet de toutes les zones que nous avons sur la route 53.  L'API d'Amazon vous permet de les soumettre en toute s√©curit√© √† JSON, et nous avons cr√©√© plusieurs serveurs redondants o√π nous le convertissons, le t√©l√©chargeons sous forme de configurations et, grosso modo, avons une configuration de sauvegarde.  Dans ce cas, nous pouvons le d√©ployer rapidement manuellement, nous ne perdrons pas les donn√©es des param√®tres DNS. <br><br>  <b>Le second ¬´mais¬ª</b> : qu'est-ce qui n'est pas r√©serv√© sur cette photo?  L'√©quilibreur lui-m√™me!  Nous avons simplifi√© la r√©partition des clients par r√©gion.  Nous avons des domaines bitrix24.ru, bitrix24.com, .de - il existe maintenant 13 domaines diff√©rents qui fonctionnent dans des zones tr√®s diff√©rentes.  Nous en sommes arriv√©s √† ce qui suit: chaque r√©gion a ses propres √©quilibreurs.  Il est plus pratique de distribuer par r√©gion, selon l'endroit o√π se trouve la charge de pointe sur le r√©seau.  S'il s'agit d'un √©chec au niveau d'un √©quilibreur, il est simplement mis hors service et supprim√© du DNS.  Si un probl√®me se produit avec un groupe d'√©quilibreurs, ils sont r√©serv√©s sur d'autres sites, et la commutation entre eux se fait en utilisant la m√™me route53, car en raison d'un court ttl, la commutation se produit pendant un maximum de 2, 3, 5 minutes. <br><br>  <b>Le troisi√®me ¬´mais¬ª</b> : qu'est-ce qui n'a pas encore √©t√© r√©serv√©?  S3, √† droite.  Nous, en pla√ßant les fichiers stock√©s par les utilisateurs dans s3, avons sinc√®rement cru qu'il s'agissait d'un per√ßage d'armure et qu'il n'√©tait pas n√©cessaire de r√©server quoi que ce soit l√†-bas.  Mais l'histoire montre ce qui se passe diff√©remment.  En g√©n√©ral, Amazon d√©crit S3 comme un service fondamental, car Amazon utilise lui-m√™me S3 pour stocker des images de machines, des configurations, des images AMI, des instantan√©s ... Et si s3 se bloque, comme cela s'est produit au cours de ces 7 ann√©es, combien de bitrix24 nous avons utilis√©, il est suivi par un fan tire un tas de tout - inaccessibilit√© de d√©marrage des machines virtuelles, dysfonctionnement api et ainsi de suite. <br><br>  Et S3 peut tomber - c'est arriv√© une fois.  Par cons√©quent, nous sommes arriv√©s au sch√©ma suivant: il y a quelques ann√©es, il n'y avait pas de stockage public d'objets s√©rieux en Russie, et nous envisagions la possibilit√© de faire quelque chose de notre propre ... Heureusement, nous n'avons pas commenc√© √† le faire, car nous creuserions cet examen que nous n'avons pas poss√©der, et l'aurait probablement fait.  Maintenant, Mail.ru a des stockages compatibles s3, Yandex l'a, et un certain nombre de fournisseurs l'ont toujours.  En cons√©quence, nous sommes arriv√©s √† la conclusion que nous voulons avoir, d'une part, une sauvegarde, et d'autre part, la possibilit√© de travailler avec des copies locales.  Pour une r√©gion russe particuli√®re, nous utilisons le service Mail.ru Hotbox, qui est compatible api avec s3.  Nous n'avons eu besoin d'aucune modification s√©rieuse du code √† l'int√©rieur de l'application, et nous avons fait le m√©canisme suivant: en s3 il y a des d√©clencheurs qui fonctionnent sur la cr√©ation / suppression d'objets, Amazon a un service comme Lambda - c'est du code en cours d'ex√©cution sans serveur qui s'ex√©cutera juste lorsque certains d√©clencheurs sont d√©clench√©s. <br><br><img src="https://habrastorage.org/webt/yv/y5/cp/yvy5cp7xsn82ryeocsgos7ns7ss.jpeg"><br><br>  Nous l'avons fait tr√®s simplement: si notre d√©clencheur se d√©clenche, nous ex√©cutons le code qui copiera l'objet dans le r√©f√©rentiel Mail.ru.  Pour commencer √† travailler pleinement avec des copies locales de donn√©es, nous avons √©galement besoin d'une synchronisation inverse, afin que les clients situ√©s dans le segment russe puissent travailler avec un stockage plus proche d'eux.  Mail est sur le point de terminer les d√©clencheurs dans son r√©f√©rentiel - il sera possible d'effectuer une synchronisation inverse d√©j√† au niveau de l'infrastructure, mais pour l'instant nous le faisons au niveau de notre propre code.  Si nous voyons que le client a plac√© une sorte de fichier, alors √† notre niveau de code, nous mettons l'√©v√©nement dans la file d'attente, le traitons et effectuons la r√©plication inverse.  Pourquoi est-ce mauvais: si nous avons une sorte de travail avec nos objets en dehors de notre produit, c'est-√†-dire par des moyens externes, nous n'en tiendrons pas compte.  Par cons√©quent, nous attendons la fin lorsque les d√©clencheurs apparaissent au niveau du stockage afin que, peu importe d'o√π nous ex√©cutons le code, l'objet qui nous est envoy√© soit copi√© dans l'autre sens. <br><br>  Au niveau du code, pour chaque client, les deux r√©f√©rentiels sont enregistr√©s: l'un est consid√©r√© comme le principal, l'autre est la sauvegarde.  Si tout va bien, nous travaillons avec le stockage le plus proche de nous: nos clients qui sont chez Amazon, ils travaillent avec S3, et ceux qui travaillent en Russie, ils travaillent avec Hotbox.  Si la case √† cocher fonctionne, le basculement doit se connecter √† nous et nous basculerons les clients vers un autre stockage.  Nous pouvons d√©finir ce drapeau ind√©pendamment par r√©gion et pouvons les changer d'avant en arri√®re.  Dans la pratique, nous ne l'avons pas encore utilis√©, mais nous avons envisag√© ce m√©canisme et nous pensons qu'un jour nous aurons besoin et utiliser ce m√™me commutateur.  Une fois que c'est d√©j√† arriv√©. <br><br><h4>  Oh, et votre Amazone s'est √©chapp√©e ... </h4><br>  En avril, c'est l'anniversaire du d√©but des √©cluses des t√©l√©grammes en Russie.  Amazon est le fournisseur le plus touch√©.  Et, malheureusement, les entreprises russes qui ont travaill√© dans le monde entier ont souffert davantage. <br><br>  Si l'entreprise est mondiale et que la Russie est un tr√®s petit segment, 3-5% - enfin, d'une mani√®re ou d'une autre, vous pouvez en faire don. <br><br>  S'il s'agit d'une entreprise purement russe - je suis s√ªr que vous devez vous localiser localement - eh bien, c'est juste que les utilisateurs eux-m√™mes seront pratiques, confortables, il y aura moins de risques. <br><br>  Et si c'est une entreprise qui travaille dans le monde entier et qui a des parts √† peu pr√®s √©gales de clients de Russie et quelque part dans le monde?  La connectivit√© des segments est importante et ils doivent de toute fa√ßon fonctionner ensemble. <br><br>  Fin mars 2018, Roskomnadzor a envoy√© une lettre aux plus grands op√©rateurs d√©clarant qu'ils pr√©voyaient de bloquer plusieurs millions d'ip Amazon afin de bloquer ... le messager Zello.  Gr√¢ce √† ces m√™mes fournisseurs - ils ont r√©ussi √† divulguer la lettre √† tout le monde, et il √©tait entendu que la connectivit√© avec Amazon pourrait s'effondrer.  C'√©tait vendredi, nous avons couru vers les coll√®gues de servers.ru dans la panique, avec les mots: "Amis, nous avons besoin de plusieurs serveurs qui ne seront pas en Russie, pas en Amazonie, mais, par exemple, quelque part √† Amsterdam", afin d'√™tre en mesure de mettre au moins notre propre vpn et proxy l√†-bas pour certains points de terminaison que nous ne pouvons pas influencer du tout, par exemple les terminaux du m√™me s3 - nous ne pouvons pas essayer de cr√©er un nouveau service et d'obtenir un autre ip, nous vous devez encore y arriver.  En quelques jours, nous avons install√© ces serveurs, les avons √©lev√©s et, en g√©n√©ral, nous avons pr√©par√© le d√©marrage des √©cluses.  Il est curieux que l'ILV, en regardant le battage m√©diatique et la panique suscit√©e, ait d√©clar√©: "Non, nous ne bloquerons rien maintenant."  (Mais c'est exactement jusqu'au moment o√π ils ont commenc√© √† bloquer les t√©l√©grammes.) Apr√®s avoir configur√© les options de contournement et r√©alis√© qu'ils n'√©taient pas entr√©s dans la serrure, nous n'avons n√©anmoins pas d√©mantel√© le tout.  Donc, juste au cas o√π. <br><br><img src="https://habrastorage.org/webt/la/o1/c1/lao1c1iqnqljjdv76qb1s9hg-qo.jpeg"><br><br>  Et en 2019, nous vivons toujours dans des conditions d'√©cluses.  J'ai regard√© hier soir: environ un million d'ip continuent d'√™tre bloqu√©s.  Certes, Amazon a presque compl√®tement d√©bloqu√©, au sommet a atteint 20 millions d'adresses ... En g√©n√©ral, la r√©alit√© est que la connectivit√©, une bonne connectivit√© - ce n'est peut-√™tre pas.  Tout d'un coup.  Ce n'est peut-√™tre pas pour des raisons techniques - incendies, excavatrices, tout √ßa.  Ou, comme nous l'avons vu, pas enti√®rement technique.  Par cons√©quent, quelqu'un de grand et de grand, avec son propre AS-kami, peut probablement le diriger d'autres mani√®res - la connexion directe et d'autres choses sont d√©j√† au niveau l2.  Mais dans une version simple, tout comme nous ou m√™me plus petite, vous pouvez, au cas o√π, avoir une redondance au niveau des serveurs √©lev√©s ailleurs, configur√© √† l'avance vpn, proxy, avec la possibilit√© de changer rapidement de configuration dans les segments que vous avez une connectivit√© critique .  Cela nous a √©t√© utile plus d'une fois, lorsque les verrous Amazon ont commenc√©, nous avons laiss√© passer le trafic S3 dans le pire des cas, mais progressivement tout s'est mal pass√©. <br><br><h4>  Et comment r√©server ... l'ensemble du prestataire? </h4><br>  Maintenant, nous n'avons aucun sc√©nario en cas de d√©faillance de l'ensemble de l'Amazonie.  Nous avons un sc√©nario similaire pour la Russie.  En Russie, nous avons √©t√© h√©berg√©s par un fournisseur, √† partir duquel nous avons choisi d'avoir plusieurs sites.  Et il y a un an, nous avons rencontr√© un probl√®me: m√™me s'il s'agit de deux centres de donn√©es, il peut d√©j√† y avoir des probl√®mes au niveau de la configuration r√©seau du fournisseur qui affecteront de toute fa√ßon les deux centres de donn√©es.  Et nous pouvons obtenir l'inaccessibilit√© sur les deux sites.  Bien s√ªr, c'est ce qui s'est produit.  Nous avons finalement red√©fini l'architecture √† l'int√©rieur.  Cela n'a pas beaucoup chang√©, mais pour la Russie, nous avons maintenant deux sites, qui ne sont pas un fournisseur, mais deux diff√©rents.  Si l'un d'eux √©choue, nous pouvons passer √† un autre. <br><br>  Hypoth√©tiquement, nous envisageons pour Amazon de r√©server au niveau d'un autre fournisseur;  peut-√™tre Google, peut-√™tre quelqu'un d'autre ... Mais jusqu'√† pr√©sent, nous avons observ√© dans la pratique que si Amazon se bloque au m√™me niveau de zone de disponibilit√©, les plantages au niveau d'une r√©gion enti√®re sont assez rares.  Par cons√©quent, nous avons th√©oriquement l'id√©e que, peut-√™tre, nous ferons une r√©serve ¬´Amazon n'est pas Amazon¬ª, mais en pratique cela n'existe pas encore. <br><br><h4>  Quelques mots sur l'automatisation </h4><br>  Avez-vous toujours besoin d'automatisation?  Il convient de rappeler l'effet Dunning-Krueger.  Sur l'axe des x, nos connaissances et notre exp√©rience, que nous acqu√©rons, et sur l'axe des y - la confiance dans nos actions.  Au d√©but, nous ne savons rien et nous ne sommes pas du tout s√ªrs.  Ensuite, nous savons un peu et devenons m√©ga-confiants - c'est ce qu'on appelle le ¬´pic de stupidit√©¬ª, est bien illustr√© par l'image ¬´d√©mence et courage¬ª.  De plus, nous avons d√©j√† appris un peu et sommes pr√™ts √† entrer dans la bataille.  Ensuite, nous marchons sur un r√¢teau m√©ga-s√©rieux, tombons dans une vall√©e de d√©sespoir quand nous semblons savoir quelque chose, mais en fait, nous ne savons pas grand-chose.  Ensuite, √† mesure que vous acqu√©rez de l'exp√©rience, nous devenons plus confiants. <br><br><img src="https://habrastorage.org/webt/ha/-x/uy/ha-xuyf7ttz6wyojkkh5idgrli4.jpeg"><br><br>  Notre logique de basculement automatique vers un accident ou un autre est tr√®s bien d√©crite par ce graphique.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons commenc√© - nous ne savions rien, presque tout le travail a √©t√© fait manuellement. </font><font style="vertical-align: inherit;">Ensuite, nous avons r√©alis√© que tout pouvait √™tre suspendu automatiquement et, comme, dormir paisiblement. </font><font style="vertical-align: inherit;">Et soudain, nous montons sur le m√©ga-r√¢teau: nous avons d√©clench√© de faux positifs, et nous inversons le trafic quand, dans le bon sens, cela n'en valait pas la peine. </font><font style="vertical-align: inherit;">Par cons√©quent, la r√©plication ou autre chose se brise - c'est la vall√©e m√™me du d√©sespoir. </font><font style="vertical-align: inherit;">Et puis nous arrivons √† la compr√©hension que tout doit √™tre trait√© avec sagesse. </font><font style="vertical-align: inherit;">Autrement dit, il est logique de s'appuyer sur l'automatisation, offrant la possibilit√© de fausses alarmes.</font></font> Mais!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> si les cons√©quences peuvent √™tre d√©vastatrices, il est pr√©f√©rable de le confier au quart de travail en service, aux ing√©nieurs de service qui s'assureront qu'ils ont vraiment un accident et effectueront les actions n√©cessaires manuellement ... </font></font><br><br><h4>  Conclusion </h4><br>  7      , ,  - , ‚Äî  -,  ,    ,   ,   ‚Äî   ‚Äî .    - ,     ,   ,   .      ‚Äî         ,    ,           ‚Äî    .     ,  -        ‚Äî    s3,     ,   .         ,      ,  - - .     .     ,      , ‚Äî  :  ,      ‚Äî            ? , -           ,      ,     -   ¬´,   ¬ª. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un compromis raisonnable entre le perfectionnisme et les forces r√©elles, le temps, l'argent que vous pouvez d√©penser pour le plan que vous aurez √©ventuellement. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce texte est une version compl√©t√©e et d√©velopp√©e du rapport d'Alexander Demidov lors de la conf√©rence </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uptime day 4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455112/">https://habr.com/ru/post/fr455112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455100/index.html">Comment organiser le caf√© au bureau</a></li>
<li><a href="../fr455102/index.html">Connexion d'interfaces s√©rie sur IP</a></li>
<li><a href="../fr455104/index.html">BotAuth - connexion et enregistrement √† l'aide de bots</a></li>
<li><a href="../fr455106/index.html">D√©veloppement logiciel. Tendances 2019</a></li>
<li><a href="../fr455110/index.html">Le bonheur des employ√©s d√©pend-il de t√¢ches int√©ressantes? Dites √† Badoo, SKB Kontur, Dodo Pizza, Staply et Alternativa Games</a></li>
<li><a href="../fr455114/index.html">Impl√©mentation de type entier dans CPython</a></li>
<li><a href="../fr455118/index.html">Vers l'avenir avec l'int√©gration des services Jenkins et Oracle APEX</a></li>
<li><a href="../fr455120/index.html">Le Wi-Fi n'est pas pour tout le monde. Comment autoriser par la loi les √©trangers dans le r√©seau?</a></li>
<li><a href="../fr455122/index.html">Alternative de r√©flexion Java plus rapide</a></li>
<li><a href="../fr455128/index.html">Comment nous mod√©rons les annonces</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>