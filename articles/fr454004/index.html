<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèø ‚èØÔ∏è ‚å®Ô∏è VMware NSX pour les plus petits. Partie 6. Configuration VPN ‚ô®Ô∏è üë®üèæ‚Äçüåæ üï§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Premi√®re partie Introduction 
 Deuxi√®me partie Configurer le pare-feu et les r√®gles NAT 
 Troisi√®me partie. Configuration DHCP 
 Quatri√®me partie Conf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VMware NSX pour les plus petits. Partie 6. Configuration VPN</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/454004/"><img src="https://habrastorage.org/webt/wq/yu/qy/wqyuqynprr8iaabtcn7nhbkqkje.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Premi√®re partie</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Introduction</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Deuxi√®me partie</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configurer le pare-feu et les r√®gles NAT</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Troisi√®me partie.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration DHCP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quatri√®me partie</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration du routage</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cinqui√®me partie</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration d'un √©quilibreur de charge</a> <br><br>  Aujourd'hui, nous examinons les options de configuration VPN que NSX Edge nous offre. <br><br>  En g√©n√©ral, nous pouvons diviser les technologies VPN en deux types cl√©s: <br><br><ul><li>  <b>VPN de site √† site.</b>  Le plus souvent, IPSec est utilis√© pour cr√©er un tunnel s√©curis√©, par exemple, entre le r√©seau du bureau principal et le r√©seau sur un site distant ou dans le cloud. <br></li><li>  <b>VPN d'acc√®s √† distance.</b>  Il est utilis√© pour connecter des utilisateurs individuels √† des r√©seaux priv√©s d'organisations √† l'aide du logiciel client VPN. </li></ul><br>  NSX Edge nous permet d'utiliser les deux options. <br>  Nous allons configurer √† l'aide d'un banc de test avec deux NSX Edge, un serveur Linux avec le d√©mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">racoon</a> install√© et un ordinateur portable Windows pour tester le VPN d'acc√®s √† distance. <a name="habracut"></a><br><br><h3>  IPsec </h3><br><ol><li>  Dans l'interface vCloud Director, acc√©dez √† la section Administration et s√©lectionnez vDC.  Dans l'onglet Edge Gateways, s√©lectionnez Edge dont nous avons besoin, cliquez avec le bouton droit et s√©lectionnez Edge Gateway Services. <br><img src="https://habrastorage.org/webt/gx/g_/7s/gxg_7s4odqm4vy8lgxitl79ahtu.png"></li><li>  Dans l'interface NSX Edge, acc√©dez √† l'onglet VPN VPN-IPsec, puis acc√©dez √† la section Sites VPN IPsec et cliquez sur + pour ajouter un nouveau site. <br><br><img src="https://habrastorage.org/webt/9w/kw/yz/9wkwyzxy6fwv6mm6tiw30juuemc.png"></li><li>  Remplissez les champs obligatoires: <br><ul><li>  <b>Activ√©</b> - active le site distant. </li><li>  <b>PFS</b> - garantit que chaque nouvelle cl√© cryptographique n'est associ√©e √† aucune cl√© pr√©c√©dente. </li><li>  <b>L'ID local et le point d'extr√©mit√© local</b> sont l'adresse externe du NSX Edge. </li><li>  <b>Sous-r√©seau local</b> - R√©seaux locaux qui utiliseront le VPN IPsec. </li><li>  <b>ID d'homologue et point d'extr√©mit√© d'homologue</b> - adresse du site distant. </li><li>  <b>Sous</b> -r√©seaux <b>homologues</b> - r√©seaux qui utiliseront le VPN IPsec du c√¥t√© distant. </li><li>  <b>Algorithme de chiffrement</b> - algorithme de chiffrement de tunnel. </li></ul><br><img src="https://habrastorage.org/webt/fr/2h/af/fr2haf6yil98f0e9p2tpjpsdlu8.png"><br><br><ul><li>  <b>Authentification</b> - comment nous authentifierons une f√™te.  Vous pouvez utiliser une cl√© pr√©-partag√©e ou un certificat. </li><li>  <b>Cl√© pr√©-partag√©e</b> - sp√©cifiez la cl√© qui sera utilis√©e pour l'authentification et doit correspondre des deux c√¥t√©s. </li><li>  <b>Groupe Diffie-Hellman</b> - algorithme d'√©change de cl√©s. </li></ul><br>  Apr√®s avoir rempli les champs obligatoires, cliquez sur Conserver. <br><br><img src="https://habrastorage.org/webt/k9/yd/nk/k9ydnkf0ncd8dqajktdkux1wc58.png"></li><li>  C'est fait. <br><br><img src="https://habrastorage.org/webt/z9/ij/ot/z9ijot3wthx7dklptivvra-8pws.png"></li><li>  Apr√®s avoir ajout√© le site, acc√©dez √† l'onglet √âtat d'activation et activez le service IPsec. <br><br><img src="https://habrastorage.org/webt/p9/oc/la/p9oclawmegzrekhuxslid1cvnzu.png"></li><li>  Une fois les param√®tres appliqu√©s, acc√©dez √† l'onglet Statistiques -&gt; VPN IPsec et v√©rifiez l'√©tat du tunnel.  On voit que le tunnel est mont√©. <br><br><img src="https://habrastorage.org/webt/fn/ai/fm/fnaifmaxtxbfs-sumd9t5xyfhn0.png"></li><li>  V√©rifiez l'√©tat du tunnel √† partir de la console de passerelle Edge: <br><ul><li>  show service ipsec - v√©rifier l'√©tat du service. <br><br><img src="https://habrastorage.org/webt/tu/sv/_y/tusv_yq3-jzm_bavjx_fefpv_d0.png"></li><li>  show service ipsec site - informations sur l'√©tat du site et les param√®tres convenus. <br><br><img src="https://habrastorage.org/webt/ct/ex/j0/ctexj0sypvimdsgyaogvob0rx1w.png"></li><li>  show service ipsec sa - v√©rification de statut de Security Association (SA). <br><br><img src="https://habrastorage.org/webt/m2/of/ng/m2ofnggyimplhfnlvfvnec_yawa.png"></li></ul></li><li>  V√©rification de la connectivit√© du site distant: <br><br><pre><code class="plaintext hljs">root@racoon:~# ifconfig eth0:1 | grep inet inet 10.255.255.1 netmask 255.255.255.0 broadcast 0.0.0.0 root@racoon:~# ping -c1 -I 10.255.255.1 192.168.0.10 PING 192.168.0.10 (192.168.0.10) from 10.255.255.1 : 56(84) bytes of data. 64 bytes from 192.168.0.10: icmp_seq=1 ttl=63 time=59.9 ms --- 192.168.0.10 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 59.941/59.941/59.941/0.000 ms</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fichiers de configuration et commandes de diagnostic suppl√©mentaires √† partir du serveur Linux distant:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">root@racoon:~# cat /etc/racoon/racoon.conf log debug; path pre_shared_key "/etc/racoon/psk.txt"; path certificate "/etc/racoon/certs"; listen { isakmp 80.211.43.73 [500]; strict_address; } remote 185.148.83.16 { exchange_mode main,aggressive; proposal { encryption_algorithm aes256; hash_algorithm sha1; authentication_method pre_shared_key; dh_group modp1536; } generate_policy on; } sainfo address 10.255.255.0/24 any address 192.168.0.0/24 any { encryption_algorithm aes256; authentication_algorithm hmac_sha1; compression_algorithm deflate; } === root@racoon:~# cat /etc/racoon/psk.txt 185.148.83.16 testkey === root@racoon:~# cat /etc/ipsec-tools.conf #!/usr/sbin/setkey -f flush; spdflush; spdadd 192.168.0.0/24 10.255.255.0/24 any -P in ipsec esp/tunnel/185.148.83.16-80.211.43.73/require; spdadd 10.255.255.0/24 192.168.0.0/24 any -P out ipsec esp/tunnel/80.211.43.73-185.148.83.16/require; === root@racoon:~# racoonctl show-sa isakmp Destination Cookies Created 185.148.83.16.500 2088977aceb1b512:a4c470cb8f9d57e9 2019-05-22 13:46:13 === root@racoon:~# racoonctl show-sa esp 80.211.43.73 185.148.83.16 esp mode=tunnel spi=1646662778(0x6226147a) reqid=0(0x00000000) E: aes-cbc 00064df4 454d14bc 9444b428 00e2296e c7bb1e03 06937597 1e522ce0 641e704d A: hmac-sha1 aa9e7cd7 51653621 67b3b2e9 64818de5 df848792 seq=0x00000000 replay=4 flags=0x00000000 state=mature created: May 22 13:46:13 2019 current: May 22 14:07:43 2019 diff: 1290(s) hard: 3600(s) soft: 2880(s) last: May 22 13:46:13 2019 hard: 0(s) soft: 0(s) current: 72240(bytes) hard: 0(bytes) soft: 0(bytes) allocated: 860 hard: 0 soft: 0 sadb_seq=1 pid=7739 refcnt=0 185.148.83.16 80.211.43.73 esp mode=tunnel spi=88535449(0x0546f199) reqid=0(0x00000000) E: aes-cbc c812505a 9c30515e 9edc8c4a b3393125 ade4c320 9bde04f0 94e7ba9d 28e61044 A: hmac-sha1 cd9d6f6e 06dbcd6d da4d14f8 6d1a6239 38589878 seq=0x00000000 replay=4 flags=0x00000000 state=mature created: May 22 13:46:13 2019 current: May 22 14:07:43 2019 diff: 1290(s) hard: 3600(s) soft: 2880(s) last: May 22 13:46:13 2019 hard: 0(s) soft: 0(s) current: 72240(bytes) hard: 0(bytes) soft: 0(bytes) allocated: 860 hard: 0 soft: 0 sadb_seq=0 pid=7739 refcnt=0</code> </pre> <br></div></div></li><li>  Tout est pr√™t, le VPN IPsec de site √† site est configur√© et fonctionne. <br><br>  Dans cet exemple, nous avons utilis√© le PSK pour authentifier l'homologue, mais une option d'authentification par certificat est √©galement possible.  Pour ce faire, acc√©dez √† l'onglet Configuration globale, activez l'authentification par certificat et s√©lectionnez le certificat lui-m√™me. <br><br>  De plus, dans les param√®tres du site, il sera n√©cessaire de modifier la m√©thode d'authentification. <br><br><img src="https://habrastorage.org/webt/gv/x0/e8/gvx0e80ogisdslhrxbvcwci54gq.png"><br><br><img src="https://habrastorage.org/webt/uj/uf/xh/ujufxh2n4da4fcfb1hsrnlppv3w.png"><br><br>  Je note que le nombre de tunnels IPsec d√©pend de la taille de la passerelle Edge d√©ploy√©e (lisez √† ce sujet dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premier article</a> ). <br><br><img src="https://habrastorage.org/webt/bf/sq/rv/bfsqrvatekltpr2xy1wx4b35t-q.png"></li></ol><br><h3>  VPN SSL </h3><br>  SSL VPN-Plus est l'une des options du VPN d'acc√®s √† distance.  Il permet aux utilisateurs distants individuels de se connecter en toute s√©curit√© √† des r√©seaux priv√©s derri√®re la passerelle NSX Edge.  Un tunnel crypt√© SSL VPN-plus est √©tabli entre le client (Windows, Linux, Mac) et NSX Edge. <br><br><ol><li>  Pr√©parons-nous.  Dans le panneau de configuration du service Edge Gateway, acc√©dez √† l'onglet SSL VPN-Plus, puis aux param√®tres du serveur.  Nous s√©lectionnons l'adresse et le port sur lesquels le serveur √©coutera les connexions entrantes, activerons la journalisation et s√©lectionnerons les algorithmes de chiffrement n√©cessaires. <br><br><img src="https://habrastorage.org/webt/o4/nt/hq/o4nthq3cjj_sh1pwpz-5bm0q1oo.png"><br><br>  Ici, vous pouvez modifier le certificat que le serveur utilisera. <br><br><img src="https://habrastorage.org/webt/ij/ep/eg/ijepegloixlveu3aa9juqhuegzg.png"></li><li>  Une fois que tout est pr√™t, allumez le serveur et n'oubliez pas de sauvegarder les param√®tres. <br><br><img src="https://habrastorage.org/webt/ml/dz/pj/mldzpjn23fhhyljhr7zlre9tdcm.png"></li><li>  Ensuite, nous devons configurer le pool d'adresses que nous √©mettrons aux clients lorsqu'ils seront connect√©s.  Ce r√©seau est distinct de tout sous-r√©seau existant dans votre environnement NSX, il n'a pas besoin d'√™tre configur√© sur d'autres appareils dans les r√©seaux physiques, √† l'exception des routes qui le pointent. <br><br>  Acc√©dez √† l'onglet Pools IP et cliquez sur +. <br><br><img src="https://habrastorage.org/webt/vb/yx/4x/vbyx4xh7xvbp4aacm0_dsrx4lau.png"></li><li>  Choisissez les adresses, le masque de sous-r√©seau et la passerelle.  Ici, vous pouvez modifier les param√®tres des serveurs DNS et WINS. <br><br><img src="https://habrastorage.org/webt/fy/s4/un/fys4unlo2c_-ees8uduwgw--_oa.png"></li><li>  Le pool r√©sultant. <br><br><img src="https://habrastorage.org/webt/2n/7_/lr/2n7_lrsb5jjtgi9o8vgbkrijck4.png"></li><li>  Ajoutez maintenant les r√©seaux auxquels les utilisateurs se connectant au VPN auront acc√®s.  Acc√©dez √† l'onglet R√©seaux priv√©s et cliquez sur +. <br><br><img src="https://habrastorage.org/webt/cp/xj/c5/cpxjc55glum1i7qbultrqxeelwq.png"></li><li>  Nous remplissons: <br><br><ul><li>  R√©seau - un r√©seau local auquel les utilisateurs distants auront acc√®s. </li><li>  Envoyer du trafic, il a deux options: <br>  - via tunnel - envoyer du trafic vers le r√©seau via le tunnel, <br>  - bypass tunnel - envoie du trafic au r√©seau en contournant directement le tunnel. </li><li>  Activer l'optimisation TCP - marquez si l'option over tunnel est s√©lectionn√©e.  Lorsque l'optimisation est activ√©e, vous pouvez sp√©cifier les num√©ros de port pour lesquels vous souhaitez optimiser le trafic.  Le trafic pour les ports restants de ce r√©seau particulier ne sera pas optimis√©.  Si les num√©ros de port ne sont pas sp√©cifi√©s, le trafic pour tous les ports est optimis√©.  En savoir plus sur cette fonctionnalit√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </li></ul><br><img src="https://habrastorage.org/webt/6z/pm/c7/6zpmc7-cic6jlregwi2ylyt9apu.png"></li><li>  Ensuite, acc√©dez √† l'onglet Authentification et cliquez sur +.  Pour l'authentification, nous utiliserons un serveur local sur NSX Edge lui-m√™me. <br><br><img src="https://habrastorage.org/webt/aq/kx/bp/aqkxbp8ux9csyx2bui2o5hxdtjc.png"></li><li>  Ici, nous pouvons choisir des strat√©gies pour g√©n√©rer de nouveaux mots de passe et configurer des options pour bloquer les comptes d'utilisateurs (par exemple, le nombre de tentatives lorsque le mot de passe n'est pas entr√© correctement). <br><br><img src="https://habrastorage.org/webt/oz/gd/mi/ozgdmimubqauqwo6gymipuvv8va.png"><br><br><img src="https://habrastorage.org/webt/cp/6n/fl/cp6nflis843n8edmtjimkmk2gdo.png"></li><li>  Puisque nous utilisons l'authentification locale, nous devons cr√©er des utilisateurs. <br><br><img src="https://habrastorage.org/webt/sb/ui/kt/sbuikttq8ew3bu8rhqt4kpiq7ho.png"></li><li>  En plus des √©l√©ments de base comme un nom et un mot de passe, vous pouvez ici, par exemple, emp√™cher l'utilisateur de changer le mot de passe ou, √† l'inverse, l'obliger √† changer le mot de passe lors de la prochaine connexion. <br><br><img src="https://habrastorage.org/webt/ki/am/qw/kiamqwt8jphlg5f0b_b2ifa4-wy.png"></li><li>  Une fois tous les utilisateurs n√©cessaires ajout√©s, acc√©dez √† l'onglet Packages d'installation, cliquez sur + et cr√©ez le programme d'installation lui-m√™me, qui t√©l√©chargera l'employ√© distant pour l'installation. <br><br><img src="https://habrastorage.org/webt/wg/js/4t/wgjs4tj0efxxlrj9mcpu-gql2z4.png"></li><li>  Cliquez sur +.  Nous s√©lectionnons l'adresse et le port du serveur auquel le client se connectera et les plates-formes pour lesquelles vous souhaitez g√©n√©rer le package d'installation. <br><br><img src="https://habrastorage.org/webt/gd/sx/i4/gdsxi44atfhzs0yh-wcv8gooqp8.png"><br><br>  Vous pouvez sp√©cifier les param√®tres client pour Windows ci-dessous dans cette fen√™tre.  Choisissez: <br><br><ul><li>  d√©marrer le client √† la connexion - le client VPN sera ajout√© au d√©marrage sur une machine distante; </li><li>  cr√©er une ic√¥ne de bureau - cr√©era une ic√¥ne de client VPN sur le bureau; </li><li>  validation du certificat de s√©curit√© du serveur - validera le certificat du serveur lors de la connexion. <br>  La configuration du serveur est termin√©e. </li></ul><br><img src="https://habrastorage.org/webt/7j/po/ia/7jpoiawbsxmetmvijnvnvtu7mfm.png"></li><li>  T√©l√©chargez maintenant le package d'installation que nous avons cr√©√© √† la derni√®re √©tape sur le PC distant.  Lors de la configuration du serveur, nous avons sp√©cifi√© son adresse externe (185.148.83.16) et son port (445).  C'est √† cette adresse que nous devons acc√©der au navigateur Web.  Dans mon cas, c'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">185.148.83.16</a> : 445. <br><br>  Dans la fen√™tre d'autorisation, vous devez saisir les informations d'identification de l'utilisateur que nous avons cr√©√© pr√©c√©demment. <br><br><img src="https://habrastorage.org/webt/w6/5t/b3/w65tb3thu0i3yvh2wkp0dq5enc4.png"></li><li>  Apr√®s l'autorisation, nous voyons une liste des packages d'installation cr√©√©s disponibles pour t√©l√©chargement.  Nous en avons cr√©√© un seul et le t√©l√©chargeons. <br><br><img src="https://habrastorage.org/webt/62/_m/af/62_mafqhlxpqpqa3wrq5g_9gpvo.png"></li><li>  On clique sur le lien, le t√©l√©chargement du client commence. <br><br><img src="https://habrastorage.org/webt/du/1n/th/du1nth1rhphihfhpctp1hmnk1es.png"></li><li>  D√©compressez l'archive t√©l√©charg√©e et ex√©cutez le programme d'installation. <br><br><img src="https://habrastorage.org/webt/np/bs/69/npbs69o4arrddkvwqxrvomnn5l0.png"></li><li>  Apr√®s l'installation, ex√©cutez le client, dans la fen√™tre d'autorisation, cliquez sur Connexion. <br><br><img src="https://habrastorage.org/webt/og/lq/uc/oglqucpuesvmhe8tj9kphxxeqdk.png"></li><li>  Dans la fen√™tre de v√©rification des certificats, s√©lectionnez Oui. <br><br><img src="https://habrastorage.org/webt/nf/m3/da/nfm3dacakvoreocayzwrmacmjoa.png"></li><li>  Nous saisissons les informations d'identification de l'utilisateur cr√©√© pr√©c√©demment et constatons que la connexion s'est termin√©e avec succ√®s. <br><br><img src="https://habrastorage.org/webt/zz/ot/_r/zzot_riaf24alcpw2cmobskcl0c.png"><br><br><img src="https://habrastorage.org/webt/yq/d5/dz/yqd5dzwb3yarbdaqidoxk-g2l2a.png"></li><li>  V√©rifiez les statistiques du client VPN sur l'ordinateur local. <br><br><img src="https://habrastorage.org/webt/mf/qi/yi/mfqiyi-qzvx7_aiyptg-jb7yocy.jpeg"><br><br><img src="https://habrastorage.org/webt/qv/no/fr/qvnofrg8hclsrdjrp1lo-pdkdom.jpeg"></li><li>  Sur la ligne de commande Windows (ipconfig / all), nous voyons qu'un adaptateur virtuel suppl√©mentaire est apparu et qu'il y a une connectivit√© avec le r√©seau distant, tout fonctionne: <br><br><img src="https://habrastorage.org/webt/01/hf/5t/01hf5tzh6ej5o-6pq8a4wkms2dq.jpeg"><br><br><img src="https://habrastorage.org/webt/qb/km/he/qbkmhe0m1q1hfrhlceovxla3ldw.png"></li><li>  Et enfin - une v√©rification de la console Edge Gateway. <br><br><img src="https://habrastorage.org/webt/2e/ot/wr/2eotwriama_etzynpyasqcimg2k.png"></li></ol><br><h3>  VPN L2 </h3><br>  L2VPN est n√©cessaire lorsque vous devez combiner plusieurs zones g√©ographiques <br>  r√©seaux distribu√©s dans un domaine de diffusion. <br><br>  Cela peut √™tre utile, par exemple, lors de la migration d'une machine virtuelle: lorsqu'une machine virtuelle se d√©place vers un autre site g√©ographique, la machine enregistre les param√®tres d'adressage IP et ne perdra pas la connectivit√© avec d'autres machines situ√©es dans le m√™me domaine L2 avec elle. <br><br>  Dans notre environnement de test, nous allons connecter deux sites entre eux, nous les appellerons respectivement A et B. Nous avons deux NSX et deux r√©seaux rout√©s cr√©√©s de mani√®re identique connect√©s √† diff√©rents Edge.  La machine A a l'adresse 10.10.10.250/24, la machine B a l'adresse 10.10.10.2/24. <br><br><ol><li>  Dans vCloud Director, acc√©dez √† l'onglet Administration, acc√©dez au VDC dont nous avons besoin, acc√©dez √† l'onglet R√©seaux Org VDC et ajoutez deux nouveaux r√©seaux. <br><br><img src="https://habrastorage.org/webt/jh/8x/oa/jh8xoarvrbmyd0cexp1forwc5fo.png"></li><li>  Nous s√©lectionnons le type de r√©seau rout√© et lions ce r√©seau √† notre NSX.  Nous mettons la case √† cocher Cr√©er comme sous-interface. <br><br><img src="https://habrastorage.org/webt/ke/fa/gp/kefagptrkwzznjydhktrom9g2ww.png"></li><li>  En cons√©quence, nous devrions obtenir deux r√©seaux.  Dans notre exemple, ils sont appel√©s r√©seau-a et r√©seau-b avec les m√™mes param√®tres de passerelle et le m√™me masque. <br><br><img src="https://habrastorage.org/webt/s2/fs/m0/s2fsm0dcmiqyrka4acercwf26ww.png"><br><br><img src="https://habrastorage.org/webt/ev/mr/k8/evmrk8fmiyzemartcv_hjakdhus.png"></li><li>  Passons maintenant aux param√®tres du premier NSX.  Ce sera le NSX auquel est connect√© le r√©seau A. Il agira comme un serveur. <br><br>  Revenez √† l'interface NSx Edge / Allez √† l'onglet VPN -&gt; L2VPN.  Nous activons L2VPN, s√©lectionnons le mode de fonctionnement du serveur, dans les param√®tres globaux du serveur, sp√©cifions l'adresse IP externe du NSX, sur laquelle le port du tunnel sera √©cout√©.  Par d√©faut, le socket s'ouvrira sur le port 443, mais il peut √™tre modifi√©.  N'oubliez pas de choisir les param√®tres de cryptage pour le futur tunnel. <br><br><img src="https://habrastorage.org/webt/5s/cp/yl/5scpylcprxcu_wmgtvgwxqi3bv0.png"></li><li>  Acc√©dez √† l'onglet Sites du serveur et ajoutez un festin. <br><br><img src="https://habrastorage.org/webt/9u/az/bm/9uazbmzmfihywslasekwqmrhm1o.png"></li><li>  Allumez le festin, d√©finissez le nom, la description, si n√©cessaire, d√©finissez le nom d'utilisateur et le mot de passe.  Nous aurons besoin de ces donn√©es plus tard lors de la configuration du site client. <br><br>  Dans l'adresse de passerelle Egress Optimization Gateway, d√©finissez l'adresse de la passerelle.  Ceci est n√©cessaire pour qu'il n'y ait pas de conflit d'adresses IP, car la passerelle sur nos r√©seaux a la m√™me adresse.  Ensuite, nous appuyons sur le bouton SELECT SUB-INTERFACES. <br><br><img src="https://habrastorage.org/webt/lh/y8/t2/lhy8t2pxycomacepgel1vess6jy.png"></li><li>  Ici, nous s√©lectionnons la sous-interface souhait√©e.  Enregistrez les param√®tres. <br><br><img src="https://habrastorage.org/webt/_o/hn/3l/_ohn3lperjba15rifdy6yyzvk0u.png"></li><li>  Nous voyons que le site client nouvellement cr√©√© est apparu dans les param√®tres. <br><br><img src="https://habrastorage.org/webt/sd/p_/lf/sdp_lf6amh08k9aexlsxl724ioc.png"></li><li>  Passons maintenant √† la configuration de NSX c√¥t√© client. <br><br>  Nous allons √† NSX c√¥t√© B, allons √† VPN -&gt; L2VPN, allumons L2VPN, d√©finissez le mode L2VPN sur le mode client.  Dans l'onglet Client Global, d√©finissez l'adresse et le port de NSX A, que nous avons indiqu√©s pr√©c√©demment comme IP d'√©coute et port c√¥t√© serveur.  Il est √©galement n√©cessaire de d√©finir les m√™mes param√®tres de chiffrement afin qu'ils soient coh√©rents lors de l'√©l√©vation du tunnel. <br><br><img src="https://habrastorage.org/webt/wn/yx/ug/wnyxug_ioltwju3lcqh-fzqk2sy.png"><br><br>  Faites d√©filer vers le bas, s√©lectionnez la sous-interface √† travers laquelle le tunnel pour L2VPN sera construit. <br>  Dans l'adresse de passerelle Egress Optimization Gateway, d√©finissez l'adresse de la passerelle.  D√©finissez l'ID utilisateur et le mot de passe.  Nous s√©lectionnons la sous-interface et n'oubliez pas d'enregistrer les param√®tres. <br><br><img src="https://habrastorage.org/webt/bi/bf/qj/bibfqjjaw-s5rridzyz_vxtb_ng.png"></li><li>  C'est tout, en fait.  Les param√®tres client et serveur sont presque identiques, √† l'exception de quelques nuances. </li><li>  Maintenant, nous pouvons voir ce que notre tunnel a gagn√© en allant dans Statistiques -&gt; L2VPN sur n'importe quel NSX. <br><br><img src="https://habrastorage.org/webt/dj/uj/iu/djujiuzlvgswhq1osmpajodl4fe.png"></li><li>  Si nous allons maintenant dans la console de n'importe quelle passerelle Edge, nous verrons les adresses des deux machines virtuelles sur chacune d'elles dans la table arp. <br><br><img src="https://habrastorage.org/webt/uy/si/r8/uysir84foday_fr6xip0tku5sca.png"></li></ol><br><br>  C'est tout sur VPN sur NSX Edge.  Demandez si quelque chose n'est pas clair.  Il s'agit √©galement de la derni√®re partie d'une s√©rie d'articles sur l'utilisation de NSX Edge.  Nous esp√©rons qu'ils vous ont √©t√© utiles :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454004/">https://habr.com/ru/post/fr454004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453994/index.html">Meetup Badoo Techleads # 4. √âpuisement professionnel et motivation</a></li>
<li><a href="../fr453996/index.html">Uhhhhhh. Comment vendre sur Internet sans site Web</a></li>
<li><a href="../fr453998/index.html">Aeroexpress: rendez-vous au d√©p√¥t</a></li>
<li><a href="../fr454000/index.html">SOURIRE n'est PAS LASIK. √Ä propos de la correction de la vue au laser</a></li>
<li><a href="../fr454002/index.html">Exp√©rience: comment masquer Tor en utilisant pour contourner les verrous</a></li>
<li><a href="../fr454006/index.html">√Ä propos de l'informatique sans liens: promotions, r√©tention et chiffre d'affaires dans les entreprises de la CEI et des √âtats-Unis</a></li>
<li><a href="../fr454010/index.html">Enseignement sup√©rieur et continu en informatique: r√©sultats de l'√©tude My Circle</a></li>
<li><a href="../fr454012/index.html">La fin de l'√®re des appareils de r√©paration. Comment Apple et Amazon nettoient les anciens marchands d'√©lectronique</a></li>
<li><a href="../fr454016/index.html">3CX v16 Update 1, application 3CX pour iOS Beta et la nouvelle version 3CX Call Flow Designer</a></li>
<li><a href="../fr454018/index.html">R√©sum√© iOS n ¬∞ 6 (17 mai - 30 mai)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>