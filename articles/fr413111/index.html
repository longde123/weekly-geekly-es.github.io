<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüî¨ üîâ üß• STM32 + NetBeans =? üë©‚Äçüé§ üêÇ üêú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme vous le savez, la compatibilit√© avec les outils GNU et la prise en charge de GDB rendent presque tous les environnements de d√©veloppement popula...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>STM32 + NetBeans =?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413111/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ip/g9/vp/ipg9vp8f1dw4qq31hrwfvxyuvza.png" alt="Logo ennuyeux"></div><br>  Comme vous le savez, la compatibilit√© avec les outils GNU et la prise en charge de GDB rendent presque tous les environnements de d√©veloppement populaires adapt√©s au d√©bogage d'une large gamme de plates-formes int√©gr√©es, le plus souvent gratuitement et l√©galement.  En th√©orie. <br><br>  Que se passe-t-il dans la pratique lorsque vous essayez de vous faire des amis avec STM32 et NetBeans, et est-il possible, en principe, d'obtenir un syst√®me viable avec le support des derni√®res pierres - sous la coupe. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  Oui  Mais non. </div></div><a name="habracut"></a><br><h2>  Quelques paroles </h2><br>  Je ne voulais vraiment pas quitter la puce.  Cependant, apr√®s l'achat par Atmela, ils ont d'abord couvert, peut-√™tre, l'une des familles les plus prometteuses du portefeuille de l'entreprise - PIC32MM, puis toute la gamme MIPS.  Il est devenu √©vident que dans un avenir pr√©visible, la transition vers l'ARM est in√©vitable, puisque la puce √©lectronique depuis deux ans n'a pas int√©gr√© le support des contr√¥leurs d'Atmelovsk dans son √©cosyst√®me, elle n'a pas donn√© d'avantages √† ¬´Rester avec nous¬ª.  Au contraire, la politique de prix √† la hausse et les difficult√©s organisationnelles traditionnelles de la fusion ont rendu Atmelovskiye AWP moins attractifs.  Dans le m√™me temps, un projet est apparu sur lequel le PIC32MZ est simplement tomb√©.  Une masse critique a √©t√© acquise. <br><br>  Pourquoi STM: large couverture du march√©, d√©bogage budg√©taire, un environnement open source complet et gratuit bas√© sur l'open source SW4STM32, eh bien, l'aspect politique - ST Microelectronics est soutenu par le gouvernement fran√ßais en tant que ressource strat√©gique, donc une sortie soudaine du march√© ou une prise de contr√¥le ne semble pas menac√©e. <br><br><h2>  D√©bogage - Premi√®res impressions </h2><br>  SW4STM32 a √©t√© install√© de mani√®re traditionnelle - en appuyant plusieurs fois sur le bouton Suivant&gt; (* ci-apr√®s, toutes les exp√©riences ont lieu sur Win7 x64).  Un projet de d√©monstration adapt√© pour tester la fonction souhait√©e a √©t√© supprim√© du package du micrologiciel STM32Cube, tout fonctionnait plus ou moins d√®s la sortie de la bo√Æte.  Le premier d√©marrage de l'√©mulateur JTAG a laiss√© une impression: tout le cycle d'entr√©e en mode d√©bogage, √† partir de la connexion et se terminant par l'arr√™t au d√©but de main () avec la mise √† jour du contexte, il s'av√®re, peut tenir en 1 √† 2 secondes.  Par rapport aux d√©bogueurs √† micropuce (m√™me REAL ICE pour une demi-moiti√©), la diff√©rence de vitesse est multiple! <br>  Et pourtant, quelque chose de d√©sagr√©ablement surpris. <br><br><h2>  Quel est le probl√®me avec Eclipse / SW4STM32 </h2><br>  Une myriade de param√®tres et une organisation illogique, des √©l√©ments de menu cach√©s, des perspectives, des bogues d'interface et des artefacts visuels, des boutons et fonctions chauds manquants sur la barre d'outils, de petits pictogrammes et marqueurs maladroits et illisibles, l'absence de "Find Usages" est en partie subjective, et vous pouvez vous adapter si vous le souhaitez .  Mais: oublie r√©guli√®rement de sauvegarder les fichiers modifi√©s avant l'assemblage, bien que toutes les coches soient n√©cessaires;  avec une sauvegarde manuelle forc√©e, il ne voit pas de changements, et l'assemblage incr√©mental s'av√®re non pertinent;  il n'y a pas de reconstruction compl√®te (Clean and Build) en tant que commande unique, et apr√®s un nettoyage forc√© via Clean Project, l'assembly √©choue (acc√®s aux fichiers?) et ne se termine avec succ√®s qu'apr√®s la 4e tentative - cela ne peut plus √™tre raisonnablement expliqu√©.  M√™me les premi√®res versions de MPLAB X Beta bas√©es sur l'ancienne NetBeans 6.xx n'avaient pas les m√™mes probl√®mes il y a 10 ans que l'environnement de d√©veloppement officiellement support√© pour STM32 aujourd'hui. <br><br>  De plus, avec SW4STM32, 3 copies d'IDE typiques sont d√©j√† compos√©es dans le syst√®me, car √† c√¥t√© de cela, il y a encore MPLAB X fermement clou√© sur NetBeans 8.0.1 et quelque peu cl√¥tur√© (c'est-√†-dire qu'il est impossible de l'utiliser pour d'autres langues / plates-formes), et NetBeans 8.2 pour Java et C / C ++. <br><br>  Il s'av√®re que la configuration de NetBeans 8.2 pour fonctionner avec STM32 √©liminera les probl√®mes pratiques d√©crits d'Eclipse, r√©duira le nombre de copies IDE et le r√©duira √† une seule plate-forme, bien que des versions l√©g√®rement diff√©rentes. <br><br><h2>  Outils NetBeans 8.2 et GNU ARM </h2><br>  NetBeans est pr√©f√©rable d'utiliser 32 bits, car en plus de doubler la consommation de m√©moire, les diff√©rences de la version 64 bits sont introuvables. <br><br>  Google a rapidement trouv√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide de configuration</a> .  La diff√©rence fondamentale √©tait uniquement dans le syst√®me d'exploitation (ils ont Linux contre Win7 x64 pour moi), donc l'installation de l'environnement * nix MSYS, qui fait partie du package MinGW, est devenue un jeu de prix.  Les param√®tres de la cha√Æne d'outils devraient ressembler √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pa/at/55/paat55hytkpcafquqmaeouhiork.png" alt="nb-toolchain"></div><br>  Un point important - lors de l'ajout de la cha√Æne d'outils GNU ARM, s√©lectionnez la famille ¬´GNU MinGW¬ª, auquel cas NetBeans appellera correctement MSYS.  Si Cygwin est d√©j√† install√© sur la machine, il sera logique de l'utiliser, en cons√©quence, la famille GNU ARM devrait s√©lectionner ¬´GNU Cygwin¬ª. <br><br>  R√©aliser une compilation r√©ussie n'a pas √©t√© facile, mais tr√®s simple.  Puisque SW4STM32 utilise le m√™me compilateur, en regardant la ligne de commande de l'appel du compilateur dans SW4STM32 et en copiant les cl√©s manquantes dans Propri√©t√©s du projet ‚Üí Compilateur C ‚Üí Options suppl√©mentaires <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ch/l1/9d/chl19dfpmn67u7v2qcpyqrieoeu.png" alt="nb-compiler"></div><br>  nous obtenons exactement le m√™me r√©sultat de sortie, mais avec une diff√©rence pratique importante - tout est collect√© la premi√®re fois, il y a Clean and Build et cela fonctionne tr√®s bien: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/p8/aa/xyp8aacaqx7cik38y4mqzhlbxlc.png" alt="nb-build1"></div><br>  Mais ce r√©sultat peut √©galement √™tre am√©lior√© en ajoutant le traitement post-construction facultatif.  Ouvrez le Makefile et dans la section .build-post: .build-impl ajoutez: <br><br><pre><code class="hljs powershell">.build<span class="hljs-literal"><span class="hljs-literal">-post</span></span>: .build<span class="hljs-literal"><span class="hljs-literal">-impl</span></span> cp <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_DISTDIR}/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} arm<span class="hljs-literal"><span class="hljs-literal">-none</span></span><span class="hljs-literal"><span class="hljs-literal">-eabi</span></span><span class="hljs-literal"><span class="hljs-literal">-objcopy</span></span> <span class="hljs-literal"><span class="hljs-literal">-O</span></span> ihex <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}}.hex arm<span class="hljs-literal"><span class="hljs-literal">-none</span></span><span class="hljs-literal"><span class="hljs-literal">-eabi</span></span><span class="hljs-literal"><span class="hljs-literal">-size</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}}</code> </pre> <br>  (important - le retrait doit √™tre un caract√®re de tabulation unique, pas des espaces) <br>  Ligne par ligne: 1 - copie le fichier objet (.elf) du dossier de sortie √† la racine du projet, pour un acc√®s plus facile;  2 - g√©n√®re HEX √† partir d'elfe (peut √™tre comment√© si HEX n'est pas n√©cessaire);  3 - affiche la quantit√© de m√©moire occup√©e par segments. <br><br>  Le r√©sultat final: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6e/eb/u3/6eebu3andr0dd6zfgqh869chw7s.png" alt="nb-build2"></div><br>  Jusqu'ici tout va bien. <br><br><h2>  OpenOCD - les premi√®res difficult√©s </h2><br>  Dans les manuels en ligne mentionn√©s ci-dessus, la programmation d'une puce via OpenOCD est simple et routini√®re.  La derni√®re version (0.10.0) est install√©e, le fichier de configuration est extrait (du kit OpenOCD ou du dossier de projet SW4STM32), une commande du formulaire est √©crite dans Propri√©t√©s du projet ‚Üí Ex√©cuter: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x-/6a/5b/x-6a5bkmgaxhecmza5flej2x-iy.png" alt="nb-run"></div><br>  et tout fonctionne tout de suite.  En effet, c'est le cas pour les familles plus jeunes telles que STM32F103 et F407, mais je suis int√©ress√© par F7 et H7.  Avec la premi√®re, la version officielle d'OpenOCD 0.10.0 se bloque avec les erreurs "auto_probe failed" et "undefined debug reason 7";  ces derniers ne sont pas du tout pris en charge.  Nous avons essay√© tous les assemblages officiels disponibles 0.10.0 de janvier 2017 et janvier 2018 - le r√©sultat est identique.  Une recherche par mot-cl√© confirme l'existence du probl√®me, bien que vous ne puissiez pas le nommer massif;  il n'y a pas d'analyse et de solution. <br><br>  Mais il existe une version qui est garantie de fonctionner - √† partir du kit SW4STM32.  Naturellement, il s'av√®re √™tre am√©lior√© et compl√©t√©, avec de nouveaux scripts et un support pour la famille H7.  De plus, la structure des fichiers a √©t√© modifi√©e et les ressources sont stock√©es dans un module distinct dans le plug-in.Par cons√©quent, pour que l'utilitaire consolid√© dans un seul dossier puisse voir ses scripts, le commutateur -s √©tait requis. <br><br>  Board.cfg pour NUCLEO-F767ZI, net des commentaires, et condens√©: <br><br><pre> <code class="hljs powershell">set CHIPNAME STM32F767ZITx source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">erface</span></span>/<span class="hljs-type"><span class="hljs-type">stlink</span></span>-<span class="hljs-type"><span class="hljs-type">v2</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-type"><span class="hljs-type">.cfg</span></span>] transport select hla_swd source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-type"><span class="hljs-type">target</span></span>/<span class="hljs-type"><span class="hljs-type">stm32f7x.cfg</span></span>] set WORKAREASIZE <span class="hljs-number"><span class="hljs-number">0</span></span>x10000 set ENABLE_LOW_POWER <span class="hljs-number"><span class="hljs-number">1</span></span> set STOP_WATCHDOG <span class="hljs-number"><span class="hljs-number">1</span></span> reset_config srst_only srst_nogate connect_assert_srst set CONNECT_UNDER_RESET <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Enfin, lancez via Run Main Project: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/y-/j8/ohy-j8mnmadnqvq4zbcszplzchq.png" alt="nb-prog"></div><br>  Le firmware est r√©ussi, le code est en cours d'ex√©cution. <br><br><h2>  D√©bogage </h2><br>  Le sch√©ma est suppos√© √™tre le plus traditionnel: un serveur GDB local sur OpenOCD, NetBeans s'y connecte via localhost: 3333 via TCP.  En cons√©quence, NetBeans aura besoin du plugin Gdbserver. <br><br>  Il est possible de simplifier le lancement d'OpenOCD via un script bat, et puisqu'une fois la session termin√©e, elle va √† la console, il est logique de boucler le red√©marrage √† l'infini: <br><br><pre> <code class="hljs pgsql">:<span class="hljs-keyword"><span class="hljs-keyword">start</span></span> openocd -f <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>.cfg -sd:/Prog/openocd/scripts goto <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br>  Lancement: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bz/k-/dl/bzk-dlt4v3upg6tijzo16oiaodc.png" alt="oocd-debug"></div><br>  La version de SW4STM32 n'est pas √©crite explicitement, mais le serveur attend une connexion TCP au port 3333. Dans NetBeans, s√©lectionnez Debug ‚Üí Attach Debugger ..., et installez: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/-k/t8/qk-kt8brsnjmi4m8os7gumqbdu4.png" alt="nb-attach"></div><br>  La session est active.  Terminal OpenOCD: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3-/uh/b6/3-uhb6p4mqszlfw9jqk6klyljtc.png" alt="oocd-debug"></div><br>  En apparence, tout semble bien - la session de d√©bogage est active, le code est ex√©cut√©.  Cependant, le probl√®me existe toujours. <br><br><h2>  Le probl√®me </h2><br>  En mode d'ex√©cution libre, l'ex√©cution ne peut pas √™tre arr√™t√©e. <br><br>  Si vous d√©finissez un point d'arr√™t avant de d√©marrer la session, lorsque vous entrez le d√©bogage, il s'arr√™tera avec la mise √† jour du contexte, l'ex√©cution pas √† pas et la visualisation / modification des variables fonctionneront, c'est-√†-dire, en principe, toutes les fonctions de base n√©cessaires au d√©bogage complet: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/s_/71/sqs_71pvec8ufdq6cln9cvbtfkm.png" alt="nb-debug"></div><br>  Mais seulement jusqu'au prochain d√©marrage libre, apr√®s quoi il ne reste plus qu'√† fermer et red√©marrer la session. <br><br>  Une autre bagatelle d√©sagr√©able est associ√©e aux points d'arr√™t logiciels: la fonction SYSTEM_Halt () est d√©finie comme __asm__ ("bkpt"), et son fonctionnement conduit √† l'affichage d'une bo√Æte de dialogue inutile: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9h/fu/gb/9hfugbj1z9u2pyj1peffrzpfozq.png" alt="nb-sigtrap"></div><br>  Lorsque vous cliquez sur Ignorer et suspendre, cela fonctionne comme requis (c'est-√†-dire qu'il arr√™te l'ex√©cution), cependant, il est impossible de d√©finir cette option par d√©faut et de d√©sactiver l'affichage de la fen√™tre par des moyens standard. <br><br>  Avant le tas, je voudrais automatiser le lancement d'OpenOCD et connecter le d√©bogueur directement via NetBeans. <br><br>  Cependant, objectivement, la seule fonction qui ne suffit pas pour un d√©bogage plus ou moins complet est d'arr√™ter l'ex√©cution (il est √©galement n√©cessaire de d√©finir un point d'arr√™t √† la vol√©e). <br><br><h2>  Debug Debugging </h2><br>  Une recherche sur Google a r√©v√©l√© que des probl√®mes similaires avec NetBeans arr√™tant GDB se sont arr√™t√©s, mais ont √©t√© corrig√©s il y a plusieurs ann√©es.  Faute d'une meilleure id√©e, les sources de NetBeans ont √©t√© t√©l√©charg√©es dans l'espoir de parcourir le d√©bogueur en direct.  √âtonnamment, nous avons pu localiser rapidement le probl√®me avant d'appeler l'utilitaire externe GdbKillProc.exe, qui est essentiellement un wrapper pour DebugBreakProcess (pid) √† partir de WinAPI.  Le principe de l'utilitaire se r√©duit √† une interruption non intrusive du processus (analogue de ¬´kill -SIGINT [pid]¬ª sous * nix, ou Ctrl + C dans la console). <br><br>  Mais elle ne travaille pas. <br><br><h2>  Ce qui est test√© </h2><br>  En mode console, le client GDB (arm-none-eabi-gdb.exe) r√©agit correctement √† Ctrl + C, c'est-√†-dire qu'il arr√™te l'ex√©cution du code sans fermer la session et attend d'autres instructions. <br><br>  ps -W et Windows Process Explorer affichent correctement le processus et le PID correspond √† la variable interne dans NetBeans. <br><br>  L'appel manuel ¬´kill -SIGINT [pid]¬ª du package MSYS g√©n√®re une erreur ¬´Aucun processus de ce type¬ª. <br><br>  La v√©rification via "taskkill / pid [pid]" donne "Le processus ... n'a pas pu √™tre interrompu ... Ce processus ne peut √™tre interrompu que de force ...", ce qui semble indiquer un verrouillage du syst√®me.  Avec le commutateur / f, le processus se ferme compl√®tement, ce qui n'est pas bon non plus. <br><br>  Dans le processus, il s'est av√©r√© que dans Windows, la situation avec la g√©n√©ration de signaux d'interruption n'a pas d'importance, ou plut√¥t pas du tout: seul l'analogue SIGTERM est pris en charge par d√©faut, ce qui correspond √† une r√©duction approximative du processus, et il n'y a pas de solution g√©n√©ralement accept√©e. <br><br>  Sur Internet, un utilitaire de suppression de fen√™tres a √©t√© trouv√©, con√ßu pour √©muler Ctrl + C et Ctrl + Brk.  Le processus trouve que l'interruption envoie sans erreur, mais le client GDB ne r√©pond toujours pas. <br><br>  Les exp√©riences ont √©t√© r√©alis√©es en utilisant toutes les versions 32 bits (NetBeans, ARM Tools, MSYS 1.0), √† l'exception de windows-kill, qui refusait de d√©marrer 32 bits ("... impossible de d√©marrer correctement ...").  Peut-√™tre que le probl√®me est pr√©cis√©ment cela, car, selon les donn√©es fragmentaires des forums et des bugtrackers, la profondeur de bits de l'utilitaire et du processus devrait co√Øncider.  La difficult√© ici est que ARM n'offre pas la version x64 de la cha√Æne d'outils pour Windows, y compris le seul moyen d'√©liminer l'h√©t√©rog√©n√©it√© est de faire fonctionner la version x32 de windows-kill, ce qui n'est pas clair si Win x64 est possible en principe. <br><br>  Au milieu du processus, l'OS a √©t√© r√©install√© √† partir de z√©ro, et aucun changement dans le comportement des sujets exp√©rimentaux n'a √©t√© remarqu√©, y compris avec une grande confiance les caract√©ristiques d'un syst√®me particulier peuvent √™tre √©limin√©es. <br><br><h2>  Aide au hall requise </h2><br>  En fait, tout ce qui pr√©c√®de peut √™tre consid√©r√© comme une introduction √† ce paragraphe. <br>  La derni√®re √©tape restante consiste √† rendre le d√©bogage STM32 sous NetBeans r√©el: <br><br>  <i>n√©cessite un m√©canisme logiciel fonctionnel pour envoyer le signal d'interruption SIGINT (Ctrl + C) au processus client Windows GDB</i> <br><br>  Ce qui suit est une recommandation pour d√©finir la configuration minimale suffisante pour v√©rifier / d√©boguer le probl√®me ci-dessus.  Si / quand il peut √™tre r√©solu, l'article sera refait dans un simple guide √©tape par √©tape sur la fa√ßon de configurer NetBeans + OpenOCD pour plusieurs familles et cartes de d√©bogage diff√©rentes.  D'autres fonctionnalit√©s peuvent √™tre compl√©t√©es √† volont√©, ayant d√©j√† une solution de base r√©alisable. <br><br><h2>  Configuration de test </h2><br>  Il est propos√© d'utiliser la carte Blue Pill bas√©e sur le STM32F103C8T6 et le clone ST-Link V2 comme plate-forme mat√©rielle. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8g/m5/5r/8gm55r80dnmbhba7vr90piemhc0.png" alt="pilule bleue"></div><br>  Il faut: <br><br>  1. Installez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cha√Æne d'outils int√©gr√©e GNU Arm</a> <br><br>  2. Installez OpenOCD 0.10.0 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">build sous Win</a> ) <br><br>  3. Enregistrez les dossiers bin des deux packages dans PATH (Panneau de configuration ‚Üí Syst√®me ‚Üí Param√®tres syst√®me avanc√©s ‚Üí Variables d'environnement ... ‚Üí Chemin). <br><br>  4. Dans un endroit pratique pour cr√©er le fichier board.cfg, copiez le contenu: <br><br><pre> <code class="hljs powershell">source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">erface</span></span>/<span class="hljs-type"><span class="hljs-type">stlink</span></span>-<span class="hljs-type"><span class="hljs-type">v2.cfg</span></span>] source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-type"><span class="hljs-type">target</span></span>/<span class="hljs-type"><span class="hljs-type">stm32f1x.cfg</span></span>] transport select <span class="hljs-string"><span class="hljs-string">"hla_swd"</span></span> reset_config none separate set WORKAREASIZE <span class="hljs-number"><span class="hljs-number">0</span></span>x5000 set CHIPNAME STM32F103C8T6 set ENABLE_LOW_POWER <span class="hljs-number"><span class="hljs-number">1</span></span> set STOP_WATCHDOG <span class="hljs-number"><span class="hljs-number">1</span></span> set CLOCK_FREQ <span class="hljs-number"><span class="hljs-number">4000</span></span> set CONNECT_UNDER_RESET <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  5. Choisissez le firmware de test appropri√© (test.elf), le crit√®re principal est que l'ex√©cution et l'arr√™t sont clairement distinguables.  Copiez dans un endroit pratique. <br><br>  6. D'un endroit pratique pour flasher le tableau: <br><br> <code>openocd -f board.cfg -c "program test.elf verify reset exit"</code> <br> <br>  Le firmware devrait d√©marrer.  Exemple de sortie d'OpenOCD sur la console: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/4s/iv/ye4sivaywyegu12-xjodmnhntdw.png" alt="oocd-prog"></div><br>  7. √Ä partir d'un endroit pratique pour d√©marrer le serveur OpenOCD GDB: <br><br> <code>openocd -f board.cfg</code> <br> <br>  Le code est toujours en cours d'ex√©cution;  exemple de sortie (la console reste verrouill√©e par OpenOCD): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eo/ku/hd/eokuhd9oajy5kea8tz_dzcfwhq8.png" alt="oocd-debug"></div><br>  8. Dans une autre console ou ex√©cutez directement arm-none-eabi-gdb.exe √† partir du package GNU ARM Embedded Toolchain et ex√©cutez les commandes: <br><br>  <code>target extended-remote localhost:3333</code> (le code est toujours en cours d'ex√©cution) <br>  <code>continue</code> (le code est en cours d'ex√©cution, la console est verrouill√©e) <br>  <code>Ctrl+C</code> (code arr√™t√©, console active) <br>  <code>continue</code> (courir √† nouveau, la console est verrouill√©e) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/4s/iv/ye4sivaywyegu12-xjodmnhntdw.png" alt="oocd-debug"></div><br>  La t√¢che consiste √† supprimer le client GDB de l'√©tat d'ex√©cution (c'est-√†-dire essentiellement √©muler Ctrl + C) par programme. <br><br>  Pour conna√Ætre l'ID de processus, utilisez ¬´ps -W¬ª √† partir de l'environnement * nix ou Windows Process Explorer (install√© en option). <br><br>  Peut-√™tre que quelqu'un d√©boguera correctement juste apr√®s la configuration initiale de NetBeans - ces informations seront √©galement utiles, en particulier avec une description d√©taill√©e du syst√®me et des fonctionnalit√©s possibles. <br><br>  Veuillez partager vos id√©es dans les commentaires, et j'esp√®re qu'en travaillant ensemble, nous pourrons transformer une exp√©rience audacieuse en un guide utile pour mettre en place un outil encore plus utile. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413111/">https://habr.com/ru/post/fr413111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413101/index.html">Carte de d√©bogage STM32F4 dans le facteur de forme Raspberry Pi</a></li>
<li><a href="../fr413103/index.html">3CX v15.5 Update 5 Int√©gration b√™ta et REST avec AmoCRM publi√©</a></li>
<li><a href="../fr413105/index.html">Notes du fournisseur IoT. Activation et s√©curit√© dans LoraWAN</a></li>
<li><a href="../fr413107/index.html">Traduction du wiki du projet Svelto.ECS. Cadre ECS pour Unity3D</a></li>
<li><a href="../fr413109/index.html">Comment cr√©er une plate-forme d'int√©gration de produits SaaS: exp√©rience de v√©rification d'affiches</a></li>
<li><a href="../fr413113/index.html">Prise en charge de la s√©rialisation JavaScript de classe JavaScript</a></li>
<li><a href="../fr413117/index.html">Comment programmer en toute s√©curit√© dans bash</a></li>
<li><a href="../fr413119/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 317 (28 mai - 3 juin 2018)</a></li>
<li><a href="../fr413121/index.html">Visite photo du coworking √† Moscou #tceh</a></li>
<li><a href="../fr413123/index.html">JOIN dans les bases de donn√©es NoSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>