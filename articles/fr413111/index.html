<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🔬 🔉 🧥 STM32 + NetBeans =? 👩‍🎤 🐂 🐜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme vous le savez, la compatibilité avec les outils GNU et la prise en charge de GDB rendent presque tous les environnements de développement popula...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>STM32 + NetBeans =?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413111/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ip/g9/vp/ipg9vp8f1dw4qq31hrwfvxyuvza.png" alt="Logo ennuyeux"></div><br>  Comme vous le savez, la compatibilité avec les outils GNU et la prise en charge de GDB rendent presque tous les environnements de développement populaires adaptés au débogage d'une large gamme de plates-formes intégrées, le plus souvent gratuitement et légalement.  En théorie. <br><br>  Que se passe-t-il dans la pratique lorsque vous essayez de vous faire des amis avec STM32 et NetBeans, et est-il possible, en principe, d'obtenir un système viable avec le support des dernières pierres - sous la coupe. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  Oui  Mais non. </div></div><a name="habracut"></a><br><h2>  Quelques paroles </h2><br>  Je ne voulais vraiment pas quitter la puce.  Cependant, après l'achat par Atmela, ils ont d'abord couvert, peut-être, l'une des familles les plus prometteuses du portefeuille de l'entreprise - PIC32MM, puis toute la gamme MIPS.  Il est devenu évident que dans un avenir prévisible, la transition vers l'ARM est inévitable, puisque la puce électronique depuis deux ans n'a pas intégré le support des contrôleurs d'Atmelovsk dans son écosystème, elle n'a pas donné d'avantages à «Rester avec nous».  Au contraire, la politique de prix à la hausse et les difficultés organisationnelles traditionnelles de la fusion ont rendu Atmelovskiye AWP moins attractifs.  Dans le même temps, un projet est apparu sur lequel le PIC32MZ est simplement tombé.  Une masse critique a été acquise. <br><br>  Pourquoi STM: large couverture du marché, débogage budgétaire, un environnement open source complet et gratuit basé sur l'open source SW4STM32, eh bien, l'aspect politique - ST Microelectronics est soutenu par le gouvernement français en tant que ressource stratégique, donc une sortie soudaine du marché ou une prise de contrôle ne semble pas menacée. <br><br><h2>  Débogage - Premières impressions </h2><br>  SW4STM32 a été installé de manière traditionnelle - en appuyant plusieurs fois sur le bouton Suivant&gt; (* ci-après, toutes les expériences ont lieu sur Win7 x64).  Un projet de démonstration adapté pour tester la fonction souhaitée a été supprimé du package du micrologiciel STM32Cube, tout fonctionnait plus ou moins dès la sortie de la boîte.  Le premier démarrage de l'émulateur JTAG a laissé une impression: tout le cycle d'entrée en mode débogage, à partir de la connexion et se terminant par l'arrêt au début de main () avec la mise à jour du contexte, il s'avère, peut tenir en 1 à 2 secondes.  Par rapport aux débogueurs à micropuce (même REAL ICE pour une demi-moitié), la différence de vitesse est multiple! <br>  Et pourtant, quelque chose de désagréablement surpris. <br><br><h2>  Quel est le problème avec Eclipse / SW4STM32 </h2><br>  Une myriade de paramètres et une organisation illogique, des éléments de menu cachés, des perspectives, des bogues d'interface et des artefacts visuels, des boutons et fonctions chauds manquants sur la barre d'outils, de petits pictogrammes et marqueurs maladroits et illisibles, l'absence de "Find Usages" est en partie subjective, et vous pouvez vous adapter si vous le souhaitez .  Mais: oublie régulièrement de sauvegarder les fichiers modifiés avant l'assemblage, bien que toutes les coches soient nécessaires;  avec une sauvegarde manuelle forcée, il ne voit pas de changements, et l'assemblage incrémental s'avère non pertinent;  il n'y a pas de reconstruction complète (Clean and Build) en tant que commande unique, et après un nettoyage forcé via Clean Project, l'assembly échoue (accès aux fichiers?) et ne se termine avec succès qu'après la 4e tentative - cela ne peut plus être raisonnablement expliqué.  Même les premières versions de MPLAB X Beta basées sur l'ancienne NetBeans 6.xx n'avaient pas les mêmes problèmes il y a 10 ans que l'environnement de développement officiellement supporté pour STM32 aujourd'hui. <br><br>  De plus, avec SW4STM32, 3 copies d'IDE typiques sont déjà composées dans le système, car à côté de cela, il y a encore MPLAB X fermement cloué sur NetBeans 8.0.1 et quelque peu clôturé (c'est-à-dire qu'il est impossible de l'utiliser pour d'autres langues / plates-formes), et NetBeans 8.2 pour Java et C / C ++. <br><br>  Il s'avère que la configuration de NetBeans 8.2 pour fonctionner avec STM32 éliminera les problèmes pratiques décrits d'Eclipse, réduira le nombre de copies IDE et le réduira à une seule plate-forme, bien que des versions légèrement différentes. <br><br><h2>  Outils NetBeans 8.2 et GNU ARM </h2><br>  NetBeans est préférable d'utiliser 32 bits, car en plus de doubler la consommation de mémoire, les différences de la version 64 bits sont introuvables. <br><br>  Google a rapidement trouvé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide de configuration</a> .  La différence fondamentale était uniquement dans le système d'exploitation (ils ont Linux contre Win7 x64 pour moi), donc l'installation de l'environnement * nix MSYS, qui fait partie du package MinGW, est devenue un jeu de prix.  Les paramètres de la chaîne d'outils devraient ressembler à ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pa/at/55/paat55hytkpcafquqmaeouhiork.png" alt="nb-toolchain"></div><br>  Un point important - lors de l'ajout de la chaîne d'outils GNU ARM, sélectionnez la famille «GNU MinGW», auquel cas NetBeans appellera correctement MSYS.  Si Cygwin est déjà installé sur la machine, il sera logique de l'utiliser, en conséquence, la famille GNU ARM devrait sélectionner «GNU Cygwin». <br><br>  Réaliser une compilation réussie n'a pas été facile, mais très simple.  Puisque SW4STM32 utilise le même compilateur, en regardant la ligne de commande de l'appel du compilateur dans SW4STM32 et en copiant les clés manquantes dans Propriétés du projet → Compilateur C → Options supplémentaires <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ch/l1/9d/chl19dfpmn67u7v2qcpyqrieoeu.png" alt="nb-compiler"></div><br>  nous obtenons exactement le même résultat de sortie, mais avec une différence pratique importante - tout est collecté la première fois, il y a Clean and Build et cela fonctionne très bien: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/p8/aa/xyp8aacaqx7cik38y4mqzhlbxlc.png" alt="nb-build1"></div><br>  Mais ce résultat peut également être amélioré en ajoutant le traitement post-construction facultatif.  Ouvrez le Makefile et dans la section .build-post: .build-impl ajoutez: <br><br><pre><code class="hljs powershell">.build<span class="hljs-literal"><span class="hljs-literal">-post</span></span>: .build<span class="hljs-literal"><span class="hljs-literal">-impl</span></span> cp <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_DISTDIR}/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} arm<span class="hljs-literal"><span class="hljs-literal">-none</span></span><span class="hljs-literal"><span class="hljs-literal">-eabi</span></span><span class="hljs-literal"><span class="hljs-literal">-objcopy</span></span> <span class="hljs-literal"><span class="hljs-literal">-O</span></span> ihex <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}}.hex arm<span class="hljs-literal"><span class="hljs-literal">-none</span></span><span class="hljs-literal"><span class="hljs-literal">-eabi</span></span><span class="hljs-literal"><span class="hljs-literal">-size</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}}</code> </pre> <br>  (important - le retrait doit être un caractère de tabulation unique, pas des espaces) <br>  Ligne par ligne: 1 - copie le fichier objet (.elf) du dossier de sortie à la racine du projet, pour un accès plus facile;  2 - génère HEX à partir d'elfe (peut être commenté si HEX n'est pas nécessaire);  3 - affiche la quantité de mémoire occupée par segments. <br><br>  Le résultat final: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6e/eb/u3/6eebu3andr0dd6zfgqh869chw7s.png" alt="nb-build2"></div><br>  Jusqu'ici tout va bien. <br><br><h2>  OpenOCD - les premières difficultés </h2><br>  Dans les manuels en ligne mentionnés ci-dessus, la programmation d'une puce via OpenOCD est simple et routinière.  La dernière version (0.10.0) est installée, le fichier de configuration est extrait (du kit OpenOCD ou du dossier de projet SW4STM32), une commande du formulaire est écrite dans Propriétés du projet → Exécuter: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x-/6a/5b/x-6a5bkmgaxhecmza5flej2x-iy.png" alt="nb-run"></div><br>  et tout fonctionne tout de suite.  En effet, c'est le cas pour les familles plus jeunes telles que STM32F103 et F407, mais je suis intéressé par F7 et H7.  Avec la première, la version officielle d'OpenOCD 0.10.0 se bloque avec les erreurs "auto_probe failed" et "undefined debug reason 7";  ces derniers ne sont pas du tout pris en charge.  Nous avons essayé tous les assemblages officiels disponibles 0.10.0 de janvier 2017 et janvier 2018 - le résultat est identique.  Une recherche par mot-clé confirme l'existence du problème, bien que vous ne puissiez pas le nommer massif;  il n'y a pas d'analyse et de solution. <br><br>  Mais il existe une version qui est garantie de fonctionner - à partir du kit SW4STM32.  Naturellement, il s'avère être amélioré et complété, avec de nouveaux scripts et un support pour la famille H7.  De plus, la structure des fichiers a été modifiée et les ressources sont stockées dans un module distinct dans le plug-in.Par conséquent, pour que l'utilitaire consolidé dans un seul dossier puisse voir ses scripts, le commutateur -s était requis. <br><br>  Board.cfg pour NUCLEO-F767ZI, net des commentaires, et condensé: <br><br><pre> <code class="hljs powershell">set CHIPNAME STM32F767ZITx source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">erface</span></span>/<span class="hljs-type"><span class="hljs-type">stlink</span></span>-<span class="hljs-type"><span class="hljs-type">v2</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-type"><span class="hljs-type">.cfg</span></span>] transport select hla_swd source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-type"><span class="hljs-type">target</span></span>/<span class="hljs-type"><span class="hljs-type">stm32f7x.cfg</span></span>] set WORKAREASIZE <span class="hljs-number"><span class="hljs-number">0</span></span>x10000 set ENABLE_LOW_POWER <span class="hljs-number"><span class="hljs-number">1</span></span> set STOP_WATCHDOG <span class="hljs-number"><span class="hljs-number">1</span></span> reset_config srst_only srst_nogate connect_assert_srst set CONNECT_UNDER_RESET <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Enfin, lancez via Run Main Project: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/y-/j8/ohy-j8mnmadnqvq4zbcszplzchq.png" alt="nb-prog"></div><br>  Le firmware est réussi, le code est en cours d'exécution. <br><br><h2>  Débogage </h2><br>  Le schéma est supposé être le plus traditionnel: un serveur GDB local sur OpenOCD, NetBeans s'y connecte via localhost: 3333 via TCP.  En conséquence, NetBeans aura besoin du plugin Gdbserver. <br><br>  Il est possible de simplifier le lancement d'OpenOCD via un script bat, et puisqu'une fois la session terminée, elle va à la console, il est logique de boucler le redémarrage à l'infini: <br><br><pre> <code class="hljs pgsql">:<span class="hljs-keyword"><span class="hljs-keyword">start</span></span> openocd -f <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>.cfg -sd:/Prog/openocd/scripts goto <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br>  Lancement: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bz/k-/dl/bzk-dlt4v3upg6tijzo16oiaodc.png" alt="oocd-debug"></div><br>  La version de SW4STM32 n'est pas écrite explicitement, mais le serveur attend une connexion TCP au port 3333. Dans NetBeans, sélectionnez Debug → Attach Debugger ..., et installez: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/-k/t8/qk-kt8brsnjmi4m8os7gumqbdu4.png" alt="nb-attach"></div><br>  La session est active.  Terminal OpenOCD: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3-/uh/b6/3-uhb6p4mqszlfw9jqk6klyljtc.png" alt="oocd-debug"></div><br>  En apparence, tout semble bien - la session de débogage est active, le code est exécuté.  Cependant, le problème existe toujours. <br><br><h2>  Le problème </h2><br>  En mode d'exécution libre, l'exécution ne peut pas être arrêtée. <br><br>  Si vous définissez un point d'arrêt avant de démarrer la session, lorsque vous entrez le débogage, il s'arrêtera avec la mise à jour du contexte, l'exécution pas à pas et la visualisation / modification des variables fonctionneront, c'est-à-dire, en principe, toutes les fonctions de base nécessaires au débogage complet: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/s_/71/sqs_71pvec8ufdq6cln9cvbtfkm.png" alt="nb-debug"></div><br>  Mais seulement jusqu'au prochain démarrage libre, après quoi il ne reste plus qu'à fermer et redémarrer la session. <br><br>  Une autre bagatelle désagréable est associée aux points d'arrêt logiciels: la fonction SYSTEM_Halt () est définie comme __asm__ ("bkpt"), et son fonctionnement conduit à l'affichage d'une boîte de dialogue inutile: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9h/fu/gb/9hfugbj1z9u2pyj1peffrzpfozq.png" alt="nb-sigtrap"></div><br>  Lorsque vous cliquez sur Ignorer et suspendre, cela fonctionne comme requis (c'est-à-dire qu'il arrête l'exécution), cependant, il est impossible de définir cette option par défaut et de désactiver l'affichage de la fenêtre par des moyens standard. <br><br>  Avant le tas, je voudrais automatiser le lancement d'OpenOCD et connecter le débogueur directement via NetBeans. <br><br>  Cependant, objectivement, la seule fonction qui ne suffit pas pour un débogage plus ou moins complet est d'arrêter l'exécution (il est également nécessaire de définir un point d'arrêt à la volée). <br><br><h2>  Debug Debugging </h2><br>  Une recherche sur Google a révélé que des problèmes similaires avec NetBeans arrêtant GDB se sont arrêtés, mais ont été corrigés il y a plusieurs années.  Faute d'une meilleure idée, les sources de NetBeans ont été téléchargées dans l'espoir de parcourir le débogueur en direct.  Étonnamment, nous avons pu localiser rapidement le problème avant d'appeler l'utilitaire externe GdbKillProc.exe, qui est essentiellement un wrapper pour DebugBreakProcess (pid) à partir de WinAPI.  Le principe de l'utilitaire se réduit à une interruption non intrusive du processus (analogue de «kill -SIGINT [pid]» sous * nix, ou Ctrl + C dans la console). <br><br>  Mais elle ne travaille pas. <br><br><h2>  Ce qui est testé </h2><br>  En mode console, le client GDB (arm-none-eabi-gdb.exe) réagit correctement à Ctrl + C, c'est-à-dire qu'il arrête l'exécution du code sans fermer la session et attend d'autres instructions. <br><br>  ps -W et Windows Process Explorer affichent correctement le processus et le PID correspond à la variable interne dans NetBeans. <br><br>  L'appel manuel «kill -SIGINT [pid]» du package MSYS génère une erreur «Aucun processus de ce type». <br><br>  La vérification via "taskkill / pid [pid]" donne "Le processus ... n'a pas pu être interrompu ... Ce processus ne peut être interrompu que de force ...", ce qui semble indiquer un verrouillage du système.  Avec le commutateur / f, le processus se ferme complètement, ce qui n'est pas bon non plus. <br><br>  Dans le processus, il s'est avéré que dans Windows, la situation avec la génération de signaux d'interruption n'a pas d'importance, ou plutôt pas du tout: seul l'analogue SIGTERM est pris en charge par défaut, ce qui correspond à une réduction approximative du processus, et il n'y a pas de solution généralement acceptée. <br><br>  Sur Internet, un utilitaire de suppression de fenêtres a été trouvé, conçu pour émuler Ctrl + C et Ctrl + Brk.  Le processus trouve que l'interruption envoie sans erreur, mais le client GDB ne répond toujours pas. <br><br>  Les expériences ont été réalisées en utilisant toutes les versions 32 bits (NetBeans, ARM Tools, MSYS 1.0), à l'exception de windows-kill, qui refusait de démarrer 32 bits ("... impossible de démarrer correctement ...").  Peut-être que le problème est précisément cela, car, selon les données fragmentaires des forums et des bugtrackers, la profondeur de bits de l'utilitaire et du processus devrait coïncider.  La difficulté ici est que ARM n'offre pas la version x64 de la chaîne d'outils pour Windows, y compris le seul moyen d'éliminer l'hétérogénéité est de faire fonctionner la version x32 de windows-kill, ce qui n'est pas clair si Win x64 est possible en principe. <br><br>  Au milieu du processus, l'OS a été réinstallé à partir de zéro, et aucun changement dans le comportement des sujets expérimentaux n'a été remarqué, y compris avec une grande confiance les caractéristiques d'un système particulier peuvent être éliminées. <br><br><h2>  Aide au hall requise </h2><br>  En fait, tout ce qui précède peut être considéré comme une introduction à ce paragraphe. <br>  La dernière étape restante consiste à rendre le débogage STM32 sous NetBeans réel: <br><br>  <i>nécessite un mécanisme logiciel fonctionnel pour envoyer le signal d'interruption SIGINT (Ctrl + C) au processus client Windows GDB</i> <br><br>  Ce qui suit est une recommandation pour définir la configuration minimale suffisante pour vérifier / déboguer le problème ci-dessus.  Si / quand il peut être résolu, l'article sera refait dans un simple guide étape par étape sur la façon de configurer NetBeans + OpenOCD pour plusieurs familles et cartes de débogage différentes.  D'autres fonctionnalités peuvent être complétées à volonté, ayant déjà une solution de base réalisable. <br><br><h2>  Configuration de test </h2><br>  Il est proposé d'utiliser la carte Blue Pill basée sur le STM32F103C8T6 et le clone ST-Link V2 comme plate-forme matérielle. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8g/m5/5r/8gm55r80dnmbhba7vr90piemhc0.png" alt="pilule bleue"></div><br>  Il faut: <br><br>  1. Installez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chaîne d'outils intégrée GNU Arm</a> <br><br>  2. Installez OpenOCD 0.10.0 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">build sous Win</a> ) <br><br>  3. Enregistrez les dossiers bin des deux packages dans PATH (Panneau de configuration → Système → Paramètres système avancés → Variables d'environnement ... → Chemin). <br><br>  4. Dans un endroit pratique pour créer le fichier board.cfg, copiez le contenu: <br><br><pre> <code class="hljs powershell">source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">erface</span></span>/<span class="hljs-type"><span class="hljs-type">stlink</span></span>-<span class="hljs-type"><span class="hljs-type">v2.cfg</span></span>] source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-type"><span class="hljs-type">target</span></span>/<span class="hljs-type"><span class="hljs-type">stm32f1x.cfg</span></span>] transport select <span class="hljs-string"><span class="hljs-string">"hla_swd"</span></span> reset_config none separate set WORKAREASIZE <span class="hljs-number"><span class="hljs-number">0</span></span>x5000 set CHIPNAME STM32F103C8T6 set ENABLE_LOW_POWER <span class="hljs-number"><span class="hljs-number">1</span></span> set STOP_WATCHDOG <span class="hljs-number"><span class="hljs-number">1</span></span> set CLOCK_FREQ <span class="hljs-number"><span class="hljs-number">4000</span></span> set CONNECT_UNDER_RESET <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  5. Choisissez le firmware de test approprié (test.elf), le critère principal est que l'exécution et l'arrêt sont clairement distinguables.  Copiez dans un endroit pratique. <br><br>  6. D'un endroit pratique pour flasher le tableau: <br><br> <code>openocd -f board.cfg -c "program test.elf verify reset exit"</code> <br> <br>  Le firmware devrait démarrer.  Exemple de sortie d'OpenOCD sur la console: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/4s/iv/ye4sivaywyegu12-xjodmnhntdw.png" alt="oocd-prog"></div><br>  7. À partir d'un endroit pratique pour démarrer le serveur OpenOCD GDB: <br><br> <code>openocd -f board.cfg</code> <br> <br>  Le code est toujours en cours d'exécution;  exemple de sortie (la console reste verrouillée par OpenOCD): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eo/ku/hd/eokuhd9oajy5kea8tz_dzcfwhq8.png" alt="oocd-debug"></div><br>  8. Dans une autre console ou exécutez directement arm-none-eabi-gdb.exe à partir du package GNU ARM Embedded Toolchain et exécutez les commandes: <br><br>  <code>target extended-remote localhost:3333</code> (le code est toujours en cours d'exécution) <br>  <code>continue</code> (le code est en cours d'exécution, la console est verrouillée) <br>  <code>Ctrl+C</code> (code arrêté, console active) <br>  <code>continue</code> (courir à nouveau, la console est verrouillée) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/4s/iv/ye4sivaywyegu12-xjodmnhntdw.png" alt="oocd-debug"></div><br>  La tâche consiste à supprimer le client GDB de l'état d'exécution (c'est-à-dire essentiellement émuler Ctrl + C) par programme. <br><br>  Pour connaître l'ID de processus, utilisez «ps -W» à partir de l'environnement * nix ou Windows Process Explorer (installé en option). <br><br>  Peut-être que quelqu'un déboguera correctement juste après la configuration initiale de NetBeans - ces informations seront également utiles, en particulier avec une description détaillée du système et des fonctionnalités possibles. <br><br>  Veuillez partager vos idées dans les commentaires, et j'espère qu'en travaillant ensemble, nous pourrons transformer une expérience audacieuse en un guide utile pour mettre en place un outil encore plus utile. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413111/">https://habr.com/ru/post/fr413111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413101/index.html">Carte de débogage STM32F4 dans le facteur de forme Raspberry Pi</a></li>
<li><a href="../fr413103/index.html">3CX v15.5 Update 5 Intégration bêta et REST avec AmoCRM publié</a></li>
<li><a href="../fr413105/index.html">Notes du fournisseur IoT. Activation et sécurité dans LoraWAN</a></li>
<li><a href="../fr413107/index.html">Traduction du wiki du projet Svelto.ECS. Cadre ECS pour Unity3D</a></li>
<li><a href="../fr413109/index.html">Comment créer une plate-forme d'intégration de produits SaaS: expérience de vérification d'affiches</a></li>
<li><a href="../fr413113/index.html">Prise en charge de la sérialisation JavaScript de classe JavaScript</a></li>
<li><a href="../fr413117/index.html">Comment programmer en toute sécurité dans bash</a></li>
<li><a href="../fr413119/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 317 (28 mai - 3 juin 2018)</a></li>
<li><a href="../fr413121/index.html">Visite photo du coworking à Moscou #tceh</a></li>
<li><a href="../fr413123/index.html">JOIN dans les bases de données NoSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>