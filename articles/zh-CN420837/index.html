<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🔧 💃🏼 👨‍👩‍👧‍👧 使用SNIA方法测试NVMe设备的软件RAID阵列 💍 🍵 💛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="几个月前，在进行下一个项目时，我们研究实验室的人员研究了NVMe磁盘和软件解决方案，以便找到组装软件阵列的最佳选择。 

 令人惊讶的是，测试结果令人沮丧-NVMe磁盘的巨大速度潜力根本与现有软件产品的演示性能无关。 

 我们的开发人员不喜欢它。 于是他们决定编写自己的产品……营销人员随后高兴地提...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用SNIA方法测试NVMe设备的软件RAID阵列</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raidix/blog/420837/"><img src="https://habrastorage.org/webt/4j/ib/lz/4jiblzb0pamckpjzolpdiq1gr8s.jpeg"><br><br> 几个月前，在进行下一个项目时，我们研究实验室的人员研究了NVMe磁盘和软件解决方案，以便找到组装软件阵列的最佳选择。 <br><br> 令人惊讶的是，测试结果令人沮丧-NVMe磁盘的巨大速度潜力根本与现有软件产品的演示性能无关。 <br><a name="habracut"></a><br> 我们的开发人员不喜欢它。 于是他们决定编写自己的产品……营销人员随后高兴地提出了一个产品RAIDIX ERA。 <br><br> 如今，有十几家公司生产适用于NVMe驱动器的服务器。 支持和开发该技术的产品市场具有巨大的潜力。 在G2M分析报告中，给出了令人信服的数据，这些数据说服了这种数据传输协议将在不久的将来占主导地位。 <br><br><img src="https://habrastorage.org/webt/wd/f6/ol/wdf6olgkq9vam7sfinx9sb843ek.png"><br>  <i><font color="#99999"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">G2M报告中的</a>图表</font></i> <br><br> 当前，英特尔是NVMe组件生产的领导者之一。 我们在他们的设备上进行了测试，以评估现有软件产品管理这种“创新”硬件的功能。 <br><br> 我们与合作伙伴Promobit（BITBLAZE商标下的服务器和数据存储系统制造商）一起组织了英特尔NVMe驱动器和用于管理此类设备的通用软件的测试。 根据SNIA方法进行测试。 <br><br> 在本文中，我们将分享在测试英特尔NVMe硬件系统，来自MDRAID的软件阵列，基于ZFS RAIDZ2的Zvol以及我们的新开发产品期间获得的数字。 <br><br><h2> 硬件配置 </h2><br> 作为测试平台的基础，我们采用了服务器系统Intel Server System R2224WFTZS。 它具有2个用于安装Intel Xeon可扩展处理器的插槽和12个内存通道（总共24个DIMM）DDR 4，频率最高为2666 MHz。 <br><br> 有关服务器平台的更多信息，请<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">访问制造商的网站</a> 。 <br><br> 通过3个背板<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">F2U8X25S3PHS</a>连接的所有NVMe驱动器。 <br><br> 系统中总共有12个NVMe驱动器INTEL SSDPD2MD800G4，固件为CVEK6256004E1P0BGN。 <br><br> 服务器平台配备了两个启用了超线程功能的英特尔®至强®金牌6130 CPU @ 2.10GHz处理器，从而允许从每个内核启动两个线程。 因此，在输出处，我们接收了64个计算线程。 <br><br><h2> 测试准备 </h2><br> 本文中的所有测试均根据SNIA SSS PTSe v 1.1方法论的规范进行。 其中，为了获得稳定和诚实的结果，对存储进行了初步准备。 <br><br>  SNIA允许用户设置线程数和队列深度的参数，因此我们设置64/32，在32个内核上具有64个计算线程。 <br><br> 为了使系统达到稳定的指标水平并排除随机值，每轮进行了16轮测试。 <br><br> 在开始测试之前，我们已对系统进行了初步准备： <br><br><ol><li> 在CentOS 7.4上安装内核版本4.11。 </li><li> 关闭C状态和P状态。 </li><li> 运行tuned-adm实用程序并设置延迟性能概要文件。 </li></ol><br> 每个产品和项目的测试分以下几个阶段进行： <br><br> 根据SNIA规范准备设备（取决于负载类型，与负载类型无关）。 <br><br><ol><li>  IOps测试以4k，8k，16k，32k，64k，128k，1m的块为单位，具有读/写组合的变化0 / 100、5 / 95、35 / 65、50 / 50、65 / 35、95 / 5、100 / 0 。 </li><li>  4k，8k，16k块的延迟测试，读/写组合的变化为0 / 100、65 / 35和100/0。 线程数和队列深度为1-1。 结果记录为平均和最大延迟。 </li><li> 在8个团队的64行中使用128k和1M块进行吞吐量测试。 </li></ol><br> 我们首先测试硬件平台的性能，延迟和吞吐量。 这使我们能够评估拟议设备的潜力，并与应用软件解决方案的功能进行比较。 <br><br><h2> 测试1.硬件测试 </h2><br> 首先，我们决定查看一个Intel DCM D3700 NVMe驱动器的功能。 <br> 在规范中，制造商声明以下性能参数： <br><blockquote> 随机读取（100％跨度）450,000 IOPS <br> 随机写入（100％跨度）88000 IOPS </blockquote><br><h3> 测试1.1一个NVMe驱动器。  IOPS测试 </h3><br> 表格形式的效果结果（IOps）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R5％/ W95％ </th><th>  R35％/ W65％ </th><th>  R50％/ W50％ </th><th>  R65％/ W35％ </th><th>  R95％/ W5％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  84017.8 </td><td>  91393.8 </td><td>  117271.6 </td><td>  133059.4 </td><td>  175086.8 </td><td>  281131.2 </td><td>  390969.2 </td></tr><tr><td>  8k </td><td>  42602.6 </td><td>  45735.8 </td><td>  58980.2 </td><td>  67321.4 </td><td>  101357.2 </td><td>  171316.8 </td><td>  216551.4 </td></tr><tr><td>  16k </td><td>  21618.8 </td><td>  22834.8 </td><td>  29703.6 </td><td>  33821.2 </td><td>  52552.6 </td><td>  89731.2 </td><td>  108347 </td></tr><tr><td>  32k </td><td>  10929.4 </td><td>  11322 </td><td>  14787 </td><td>  16811 </td><td>  26577.6 </td><td>  47185.2 </td><td>  50670.8 </td></tr><tr><td>  64k </td><td>  5494.4 </td><td>  5671.6 </td><td>  7342.6 </td><td>  8285.8 </td><td>  13130.2 </td><td>  23884 </td><td>  27249.2 </td></tr><tr><td>  128k </td><td>  2748.4 </td><td>  2805.2 </td><td>  3617.8 </td><td>  4295.2 </td><td>  6506.6 </td><td>  11997.6 </td><td>  13631 </td></tr><tr><td>  1m </td><td>  351.6 </td><td>  354.8 </td><td>  451.2 </td><td>  684.8 </td><td>  830.2 </td><td>  1574.4 </td><td>  1702.8 </td></tr></tbody></table><br> 图形形式的性能结果（IOps）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/ja/gw/al/jagwaldo3cvyw5bxk9uxgeaqvtq.png"><br><br> 在这个阶段，我们得到的结果还不能完全达到工厂的水平。 很有可能是NUMA（多处理器系统中使用的计算机内存实现方案，当对内存的访问时间由内存相对于处理器的位置确定时）发挥了作用，但目前我们不会关注它。 <br><br><h3> 测试1.2一个NVMe驱动器。 延迟测试 </h3><br> 表格形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  0.02719 </td><td>  0.072134 </td><td>  0.099402 </td></tr><tr><td>  8k </td><td>  0.029864 </td><td>  0.093092 </td><td>  0.121582 </td></tr><tr><td>  16k </td><td>  0.046726 </td><td>  0.137016 </td><td>  0.16405 </td></tr></tbody></table><br> 图形形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/di/dg/cy/didgcy1xldxrxa8e9qec9cfri8y.png"><br><br> 表格形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  6.9856 </td><td>  4.7147 </td><td>  1.5098 </td></tr><tr><td>  8k </td><td>  7.0004 </td><td>  4.3118 </td><td>  1.4086 </td></tr><tr><td>  16k </td><td>  7.0068 </td><td>  4.6445 </td><td>  1.1064 </td></tr></tbody></table><br> 图形形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/j0/sp/1y/j0sp1ynjubpq8yfuikeiogvhzz0.png"><br><br><h3> 测试1.3吞吐量 </h3><br> 最后一步是评估吞吐量。 以下是以下指标： <br><blockquote>  1MB顺序记录-634 MBps。 <br>  1MB顺序读取-1707 MBps。 <br>  128Kb顺序记录-620 MBps。 <br>  128Kb顺序读取-1704 MBps。 </blockquote><br> 处理了一个驱动器之后，我们继续评估由12个驱动器组成的整个平台。 <br><br><h3> 在12个驱动器中测试1.4系统。  IOPS测试 </h3><br> 在这里，为了节省时间而做出了一个坚决的决定，并且仅在使用4k块时才显示结果，这是迄今为止最常见的指示性性能评估方案。 <br><br> 表格形式的效果结果（IOps）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R5％/ W95％ </th><th>  R35％/ W65％ </th><th>  R50％/ W50％ </th><th>  R65％/ W35％ </th><th>  R95％/ W5％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  1363078.6 </td><td>  1562345 </td><td>  1944105 </td><td>  2047612 </td><td>  2176476 </td><td>  3441311 </td><td>  4202364 </td></tr></tbody></table><br> 图形形式的性能结果（IOps）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/lz/nb/za/lznbza47oi8rjwokg-eobx2rfnc.png"><br><br><h3> 在12个驱动器中测试1.5系统。 带宽测试 </h3><br><blockquote>  1MB顺序记录-8612 MBps。 <br>  1MB顺序读取-20481 MBps。 <br>  128Kb顺序记录-7500 MBps。 <br>  128Kb顺序读取-20400 MBps。 </blockquote><br> 我们将在文章结尾再次查看获得的硬件性能指标，并将其与在其上测试的软件数量进行比较。 <br><br><h2> 测试2：测试MDRAID </h2><br> 当我们谈论软件阵列时，首先想到MDRAID。 回想一下，这是Linux的基本软件RAID，它是免费分发的。 <br><br> 让我们看看MDRAID如何处理带有RAID 0阵列级别的建议的12磁盘系统，我们都知道在12个驱动器上构建RAID 0需要特别的勇气，但是现在我们需要这个阵列级别来展示此解决方案的最大功能。 <br><br><h3> 测试2.1 MDRAID。  RAID0。IOPS测试 </h3><br> 表格形式的效果结果（IOps）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R5％/ W95％ </th><th>  R35％/ W65％ </th><th>  R50％/ W50％ </th><th>  R65％/ W35％ </th><th>  R95％/ W5％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  1010396 </td><td>  1049306.6 </td><td>  1312401.4 </td><td>  1459698.6 </td><td>  1932776.8 </td><td>  2692752.8 </td><td>  2963943.6 </td></tr><tr><td>  8k </td><td>  513627.8 </td><td>  527230.4 </td><td>  678140 </td><td>  771887.8 </td><td>  1146340.6 </td><td>  1894547.8 </td><td>  2526853.2 </td></tr><tr><td>  16k </td><td>  261087.4 </td><td>  263638.8 </td><td>  343679.2 </td><td>  392655.2 </td><td>  613912.8 </td><td>  1034843.2 </td><td>  1288299.6 </td></tr><tr><td>  32k </td><td>  131198.6 </td><td>  130947.4 </td><td>  170846.6 </td><td>  216039.4 </td><td>  309028.2 </td><td>  527920.6 </td><td>  644774.6 </td></tr><tr><td>  64k </td><td>  65083.4 </td><td>  65099.2 </td><td>  85257.2 </td><td>  131005.6 </td><td>  154839.8 </td><td>  268425 </td><td>  322739 </td></tr><tr><td>  128k </td><td>  32550.2 </td><td>  32718.2 </td><td>  43378.6 </td><td>  66999.8 </td><td>  78935.8 </td><td>  136869.8 </td><td>  161015.4 </td></tr><tr><td>  1m </td><td>  3802 </td><td>  3718.4 </td><td>  3233.4 </td><td>  3467.2 </td><td>  3546 </td><td>  6150.8 </td><td>  8193.2 </td></tr></tbody></table><br> 图形形式的性能结果（IOps）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/jf/d1/kl/jfd1klb3wv6px-vjbxypjff8nmu.png"><br><br><h3> 测试2.2 MDRAID。  RAID0。延迟测试 </h3><br> 表格形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  0.03015 </td><td>  0.067541 </td><td>  0.102942 </td></tr><tr><td>  8k </td><td>  0.03281 </td><td>  0.082132 </td><td>  0.126008 </td></tr><tr><td>  16k </td><td>  0.050058 </td><td>  0.114278 </td><td>  0.170798 </td></tr></tbody></table><br> 图形形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/6l/_o/im/6l_oimj5-72qy9d6w9tobclq3n4.png"><br><br> 表格形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  6.7042 </td><td>  3.7257 </td><td>  0.8568 </td></tr><tr><td>  8k </td><td>  6.5918 </td><td>  2.2601 </td><td>  0.9004 </td></tr><tr><td>  16k </td><td>  6.3466 </td><td>  2.7741 </td><td>  2.5678 </td></tr></tbody></table><br> 图形形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/ms/-s/or/ms-sorgvctpuijgx_jf2uomifty.png"><br><br><h3> 测试2.3 MDRAID。  RAID0。带宽测试 </h3><br><blockquote>  1MB顺序写入-7820 MBPS。 <br>  1MB顺序读取-20418 MBPS。 <br>  128Kb顺序写入-7622 MBPS。 <br>  128Kb顺序读取-20,380 MBPS。 </blockquote><br><h3> 测试2.4 MDRAID。  RAID 6. IOPS测试 </h3><br> 现在让我们看一下该系统在RAID级别6上的功能。 <br><br> 阵列创建选项 <br><blockquote>  mdadm --create --verbose --chunk 16K / dev / md0 --level = 6 --raid-devices = 12 / dev / nvme0n1 / dev / nvme1n1 / dev / nvme2n1 / dev / nvme3n1 / dev / nvme4n1 / dev / nvme5n1 / dev / nvme8n1 / dev / nvme9n1 / dev / nvme10n1 / dev / nvme11n1 / dev / nvme6n1 / dev / nvme7n1 </blockquote><br> 阵列的总体积为<b>7450.87</b> GiB。 <br><br> 我们在RAID阵列的初步初始化后开始测试。 <br><br> 表格形式的效果结果（IOps）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R5％/ W95％ </th><th>  R35％/ W65％ </th><th>  R50％/ W50％ </th><th>  R65％/ W35％ </th><th>  R95％/ W5％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  39907.6 </td><td>  42849 </td><td>  61609.8 </td><td>  78167.6 </td><td>  108594.6 </td><td>  641950.4 </td><td>  1902561.6 </td></tr><tr><td>  8k </td><td>  19474.4 </td><td>  20701.6 </td><td>  30316.4 </td><td>  39737.8 </td><td>  57051.6 </td><td>  394072.2 </td><td>  1875791.4 </td></tr><tr><td>  16k </td><td>  10371.4 </td><td>  10979.2 </td><td>  16022 </td><td>  20992.8 </td><td>  29955.6 </td><td>  225157.4 </td><td>  1267495.6 </td></tr><tr><td>  32k </td><td>  8505.6 </td><td>  8824.8 </td><td>  12896 </td><td>  16657.8 </td><td>  23823 </td><td>  173261.8 </td><td>  596857.8 </td></tr><tr><td>  64k </td><td>  5679.4 </td><td>  5931 </td><td>  8576.2 </td><td>  11137.2 </td><td>  15906.4 </td><td>  109469.6 </td><td>  320874.6 </td></tr><tr><td>  128k </td><td>  3976.8 </td><td>  4170.2 </td><td>  5974.2 </td><td>  7716.6 </td><td>  10996 </td><td>  68124.4 </td><td>  160453.2 </td></tr><tr><td>  1m </td><td>  768.8 </td><td>  811.2 </td><td>  1177.8 </td><td>  1515 </td><td>  2149.6 </td><td>  4880.4 </td><td>  5499 </td></tr></tbody></table><br> 图形形式的性能结果（IOps）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/p7/as/5s/p7as5s0v49uhmbhznnvjrpmfgf0.png"><br><br><h3> 测试2.5 MDRAID。  RAID 6.延迟测试 </h3><br> 表格形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  0.193702 </td><td>  0.145565 </td><td>  0.10558 </td></tr><tr><td>  8k </td><td>  0.266582 </td><td>  0.186618 </td><td>  0.127142 </td></tr><tr><td>  16k </td><td>  0.426294 </td><td>  0.281667 </td><td>  0.169504 </td></tr></tbody></table><br> 图形形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/ls/zv/3f/lszv3flgx0nduvygoxigvjfdfgk.png"><br><br> 表格形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  6.1306 </td><td>  4.5416 </td><td>  4.2322 </td></tr><tr><td>  8k </td><td>  6.2474 </td><td>  4.5197 </td><td>  3.5898 </td></tr><tr><td>  16k </td><td>  5.4074 </td><td>  5.5861 </td><td>  4.1404 </td></tr></tbody></table><br> 图形形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/fv/id/ri/fvidriesmmcwdstzhrsnmwd-kqa.png"><br><br> 值得注意的是，此处的MDRAID显示了非常好的延迟水平。 <br><br><h3> 测试2.6 MDRAID。  RAID 6.带宽测试 </h3><br><blockquote>  1MB顺序写入-890 MBPS。 <br>  1MB顺序读取-18800 MBPS。 <br>  128Kb顺序写入-870 MBPS。 <br>  128Kb顺序读取-10400 MBPS。 </blockquote><br><h2> 测试3. Zvol over ZFS RAIDZ2 </h2><br>  ZFS具有内置的RAID创建功能和内置的卷管理器，该管理器创建虚拟块设备，许多存储制造商都在使用它。 我们还将通过创建具有RAIDZ2保护的池（类似于RAID 6）并在其之上创建虚拟块卷来利用这些功能。 <br><br> 版本0.79（ZFS）已编译。 阵列和卷创建选项： <br><blockquote>  ashift = 12 /压缩-关闭/重复-关闭/ recordsize = 1M / atime =关闭/缓存文件=无/类型RAID = RAIDZ2 </blockquote><br>  ZFS在新创建的池中显示出非常好的结果。 但是，如果反复配音，性能会大大降低。 <br><br>  SNIA方法很好，因为它允许您在重复覆盖类似文件系统（基于ZFS的文件系统）后看到真实结果。 <br><br><h3> 测试3.1 ZVOL（ZFS）。  RAIDZ2。  IOps测试 </h3><br> 表格形式的效果结果（IOps）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R5％/ W95％ </th><th>  R35％/ W65％ </th><th>  R50％/ W50％ </th><th>  R65％/ W35％ </th><th>  R95％/ W5％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  15719.6 </td><td>  15147.2 </td><td>  14190.2 </td><td>  15592.4 </td><td>  17965.6 </td><td>  44832.2 </td><td>  76314.8 </td></tr><tr><td>  8k </td><td>  15536​​.2 </td><td>  14929.4 </td><td>  15140.8 </td><td>  16551 </td><td>  17898.8 </td><td>  44553.4 </td><td>  76187.4 </td></tr><tr><td>  16k </td><td>  16696.6 </td><td>  15937.2 </td><td>  15982.6 </td><td>  17350 </td><td>  18546.2 </td><td>  44895.4 </td><td>  75549.4 </td></tr><tr><td>  32k </td><td>  11859.6 </td><td>  10915 </td><td>  9698.2 </td><td>  10235.4 </td><td>  11265 </td><td>  26741.8 </td><td>  38167.2 </td></tr><tr><td>  64k </td><td>  7444 </td><td>  6440.2 </td><td>  6313.2 </td><td>  6578.2 </td><td>  7465.6 </td><td>  14145.8 </td><td>  19099 </td></tr><tr><td>  128k </td><td>  4425.4 </td><td>  3785.6 </td><td>  4059.8 </td><td>  3859.4 </td><td>  4246.4 </td><td>  7143.4 </td><td>  10052.6 </td></tr><tr><td>  1m </td><td>  772 </td><td>  730.2 </td><td>  779.6 </td><td>  784 </td><td>  824.4 </td><td>  995.8 </td><td>  1514.2 </td></tr></tbody></table><br> 图形形式的性能结果（IOps）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/0j/cf/fr/0jcffrp4gkeayltgnp5us5rg2q8.png"><br><br> 绩效数字完全令人印象深刻。 同时，纯zvol（重写之前）给出的结果要好得多（高出5-6倍）。 在这里，测试表明，在第一次复制后，性能会下降。 <br><br><h3> 测试3.2 ZVOL（ZFS）。  RAIDZ2。 延迟测试 </h3><br> 表格形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  0.332824 </td><td>  0.255225 </td><td>  0.218354 </td></tr><tr><td>  8k </td><td>  0.3299 </td><td>  0.259013 </td><td>  0.225514 </td></tr><tr><td>  16k </td><td>  0.139738 </td><td>  0.180467 </td><td>  0.233332 </td></tr></tbody></table><br> 图形形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/ys/fj/hb/ysfjhbkrepf-zzj6bvdtx_hhrlm.png"><br><br> 表格形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  90.55 </td><td>  69.9718 </td><td>  84.4018 </td></tr><tr><td>  8k </td><td>  91.6214 </td><td>  86.6109 </td><td>  104.7368 </td></tr><tr><td>  16k </td><td>  108.2192 </td><td>  86.2194 </td><td>  105.658 </td></tr></tbody></table><br> 图形形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/du/ue/_1/duue_1fwxcx-n4dmyd455pdrc40.png"><br><br><h3> 测试3.3 ZVOL（ZFS）。  RAIDZ2。 带宽测试 </h3><br><blockquote>  1MB顺序写入-1150 MBPS。 <br>  1MB顺序读取-5500 MBPS。 <br>  128Kb顺序写入-1100 MBPS。 <br>  128Kb顺序读取-5300 MBPS。 </blockquote><br><h2> 测试4：RAIDIX ERA </h2><br> 现在让我们看一下我们新产品RAIDIX ERA的测试。 <br> 我们创建了RAID6。 条带大小：16kb。 初始化完成后，运行测试。 <br><br> 表格形式的效果结果（IOps）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R5％/ W95％ </th><th>  R35％/ W65％ </th><th>  R50％/ W50％ </th><th>  R65％/ W35％ </th><th>  R95％/ W5％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  354887 </td><td>  363830 </td><td>  486865.6 </td><td>  619349.4 </td><td>  921403.6 </td><td>  2202384.8 </td><td>  4073187.8 </td></tr><tr><td>  8k </td><td>  180914.8 </td><td>  185371 </td><td>  249927.2 </td><td>  320438.8 </td><td>  520188.4 </td><td>  1413096.4 </td><td>  2510729 </td></tr><tr><td>  16k </td><td>  92115.8 </td><td>  96327.2 </td><td>  130661.2 </td><td>  169247.4 </td><td>  275446.6 </td><td>  763307.4 </td><td>  1278465 </td></tr><tr><td>  32k </td><td>  59994.2 </td><td>  61765.2 </td><td>  83512.8 </td><td>  116562.2 </td><td>  167028.8 </td><td>  420216.4 </td><td>  640418.8 </td></tr><tr><td>  64k </td><td>  27660.4 </td><td>  28229.8 </td><td>  38687.6 </td><td>  56603.8 </td><td>  76976 </td><td>  214958.8 </td><td>  299137.8 </td></tr><tr><td>  128k </td><td>  14475.8 </td><td>  14730 </td><td>  20674.2 </td><td>  30358.8 </td><td>  40259 </td><td>  109258.2 </td><td>  160141.8 </td></tr><tr><td>  1m </td><td>  2892.8 </td><td>  3031.8 </td><td>  4032.8 </td><td>  6331.6 </td><td>  7514.8 </td><td>  15871 </td><td>  19078 </td></tr></tbody></table><br> 图形形式的性能结果（IOps）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/px/on/md/pxonmd9exhzvhwqse0wugnzkc9o.png"><br><br><h3> 测试4.2 RAIDIX ERA。  RAID 6.延迟测试 </h3><br> 表格形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  0.16334 </td><td>  0.136397 </td><td>  0.10958 </td></tr><tr><td>  8k </td><td>  0.207056 </td><td>  0.163325 </td><td>  0.132586 </td></tr><tr><td>  16k </td><td>  0.313774 </td><td>  0.225767 </td><td>  0.182928 </td></tr></tbody></table><br> 图形形式的<b>平均响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/hv/ad/xq/hvadxqbbwsigpbfi2d40nhsfevo.png"><br><br> 表格形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R65％/ W35％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  5.371 </td><td>  3.4244 </td><td>  3.5438 </td></tr><tr><td>  8k </td><td>  5.243 </td><td>  3.7415 </td><td>  3.5414 </td></tr><tr><td>  16k </td><td>  7.628 </td><td>  4.2891 </td><td>  4.0562 </td></tr></tbody></table><br> 图形形式的<b>最大响应时间</b> （毫秒）。 读/写混合％。 <br><br><img src="https://habrastorage.org/webt/pk/ys/bb/pkysbbysl2ldmme0fcbptzjh0ug.png"><br><br> 延迟类似于MDRAID产生的延迟。 但是为了得出更准确的结论，应该对更严重的负载下的延迟进行估计。 <br><br><h3> 测试4.3 RAIDIX ERA。  RAID 6.带宽测试 </h3><br><blockquote>  1MB顺序写入-8160 MBPS。 <br>  1MB顺序读取-19700 MBPS。 <br>  128Kb顺序写入-6200 MBPS。 <br>  128Kb顺序读取-19700 MBPS。 </blockquote><br><h2> 结论 </h2><br> 作为测试的结果，有必要将从软件解决方案获得的数字与硬件平台提供给我们的数字进行比较。 <br><br> 为了分析随机负载的性能，我们将比较使用4k块时RAID 6（RAIDZ2）的速度。 <br><table><tbody><tr><th></th><th>  MD RAID 6 </th><th>  RAIDZ2 </th><th>  RAIDIX时代RAID 6 </th><th> 硬体 </th></tr><tr><td>  4k R100％/ W0％ </td><td>  1902561 </td><td>  76314 </td><td>  4073187 </td><td>  4,494,142 </td></tr><tr><td>  4k R65％/ W35％ </td><td>  108594 </td><td>  17965 </td><td>  921403 </td><td>  1823432 </td></tr><tr><td>  4k R0％/ W100％ </td><td>  39907 </td><td>  15719 </td><td>  354887 </td><td>  958054 </td></tr></tbody></table><br><img src="https://habrastorage.org/webt/cm/4g/ff/cm4gffjnga2flpdn0nl3yxiwew0.png"><br><br> 为了分析串行负载的性能，我们将看一下具有128k块的RAID 6（RAIDZ2）。 在线程之间，我们使用了10GB的空间来消除缓存命中并显示实际性能。 <br><table><tbody><tr><th></th><th>  MD RAID 6 </th><th>  RAIDZ2 </th><th>  RAIDIX时代RAID 6 </th><th> 硬体 </th></tr><tr><td> 读取128k seq </td><td>  10400 </td><td>  5300 </td><td>  19700 </td><td>  20,400 </td></tr><tr><td>  128k seq写 </td><td>  870 </td><td>  1100 </td><td>  6200 </td><td>  7500 </td></tr></tbody></table><br><img src="https://habrastorage.org/webt/6l/dw/wt/6ldwwti-7dql_njqadpemrz1mxi.png"><br><br><h3> 结果如何？ </h3><br> 用于NVMe设备的流行且价格合理的软件RAID阵列无法显示出硬件潜力所固有的性能。 <br><br> 在这里，非常需要控制软件，该软件可以激起这种情况并显示与NVMe驱动器的程序控制共生可以非常高效和灵活。 <br><br> 理解此要求，我们公司创建了RAIDIX ERA产品，其开发重点在于解决以下问题： <br><br><ul><li> 混合模式下具有奇偶校验的阵列具有很高的读写性能（几百万IOps）。 </li><li> 包括故障转移和恢复期间的30GBps流性能。 </li><li> 支持RAID级别5、6、7.3。 </li><li> 后台初始化和重建。 </li><li> 灵活设置不同类型的负载（用户端）。 </li></ul><br> 今天，我们可以说这些任务已经完成，产品可以使用了。 <br><br> 同时，在了解了许多相关方对此类技术的兴趣之后，我们不仅准备发布付费版本，而且还发布了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">免费许可证</a> ，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">许可证</a>可以完全用于解决NVMe和SSD驱动器上的问题。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在我们的网站上</a>了解有关RAIDIX ERA的更多信息。 <br><br><h2>  UPD 减少记录大小和volblocksize 8k的ZFS测试 </h2><br>  ZFS选项表 <br><table><tbody><tr><th> 姓名 </th><th> 物业 </th><th> 值 </th><th> 来源 </th></tr><tr><td> 战车 </td><td> 记录大小 </td><td>  8K </td><td> 本地的 </td></tr><tr><td> 战车 </td><td> 压缩 </td><td> 关 </td><td> 默认值 </td></tr><tr><td> 战车 </td><td> 重复的 </td><td> 关 </td><td> 默认值 </td></tr><tr><td> 战车 </td><td> 校验和 </td><td> 关 </td><td> 本地的 </td></tr><tr><td> 战车 </td><td> 卷块大小 </td><td>  -- </td><td>  -- </td></tr><tr><td> 坦克/突袭 </td><td> 记录大小 </td><td>  -- </td><td>  -- </td></tr><tr><td> 坦克/突袭 </td><td> 压缩 </td><td> 关 </td><td> 本地的 </td></tr><tr><td> 坦克/突袭 </td><td> 重复的 </td><td> 关 </td><td> 默认值 </td></tr><tr><td> 坦克/突袭 </td><td> 校验和 </td><td> 关 </td><td> 本地的 </td></tr><tr><td> 坦克/突袭 </td><td> 卷块大小 </td><td>  8k </td><td> 默认值 </td></tr></tbody></table><br> 录音变得更糟，阅读效果更好。 <br> 但是，所有结果都比其他解决方案差很多 <br><table><tbody><tr><th> 块大小 </th><th>  R0％/ W100％ </th><th>  R5％/ W95％ </th><th>  R35％/ W65％ </th><th>  R50％/ W50％ </th><th>  R65％/ W35％ </th><th>  R95％/ W5％ </th><th>  R100％/ W0％ </th></tr><tr><td>  4k </td><td>  13703.8 </td><td>  14399.8 </td><td>  20903.8 </td><td>  25669 </td><td>  31610 </td><td>  66955.2 </td><td>  140849.8 </td></tr><tr><td>  8k </td><td>  15126 </td><td>  16227.2 </td><td>  22393.6 </td><td>  27720.2 </td><td>  34274.8 </td><td>  67008 </td><td>  139480.8 </td></tr><tr><td>  16k </td><td>  11111.2 </td><td>  11412.4 </td><td>  16980.8 </td><td>  20812.8 </td><td>  24680.2 </td><td>  48803.6 </td><td>  83710.4 </td></tr></tbody></table></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN420837/">https://habr.com/ru/post/zh-CN420837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN420825/index.html">今天将是OpenAI和Dota 2专业人士之间的首次较量（获胜者）。 我们了解机器人的工作原理</a></li>
<li><a href="../zh-CN420827/index.html">使用Java EE + WildFly10 + JPA（Hibernate）+ Postgresql + EJB + IntelliJ IDEA创建一个简单的Maven项目</a></li>
<li><a href="../zh-CN420829/index.html">作业系统。 另一面的概述</a></li>
<li><a href="../zh-CN420831/index.html">Cookie发行设备“ Cook 3000”</a></li>
<li><a href="../zh-CN420833/index.html">主要的应用获利错误[以及解决方法]</a></li>
<li><a href="../zh-CN420841/index.html">院前修复程序或“嘿招摇！ 我的错误在哪里？”</a></li>
<li><a href="../zh-CN420843/index.html">9月7日，叶卡捷琳堡-.NET开发人员会议</a></li>
<li><a href="../zh-CN420845/index.html">使用拐杖驯服顽固的家伙：Wi-Fi适配器WF2190（Realtek8812AU无线LAN 802.11ac USB）的孔</a></li>
<li><a href="../zh-CN420847/index.html">布局着色器编程简介</a></li>
<li><a href="../zh-CN420853/index.html">认识Windows伪控制台（ConPTY）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>