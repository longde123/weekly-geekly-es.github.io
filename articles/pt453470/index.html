<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîç ‚öóÔ∏è üëµ Seus mon√≥litos distribu√≠dos est√£o tramando atr√°s de voc√™ üî¥ üßòüèΩ üë©üèø‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! 

 A tradu√ß√£o de hoje aborda n√£o apenas e n√£o muitos microsservi√ßos - um t√≥pico que todo mundo tem nos l√°bios hoje em dia - mas tamb√©m lembr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seus mon√≥litos distribu√≠dos est√£o tramando atr√°s de voc√™</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/453470/">  Ol√° Habr! <br><br>  A tradu√ß√£o de hoje aborda n√£o apenas e n√£o muitos microsservi√ßos - um t√≥pico que todo mundo tem nos l√°bios hoje em dia - mas tamb√©m lembra o qu√£o importante √© chamar uma p√° de p√°.  √Äs vezes, a transi√ß√£o para a arquitetura de microsservi√ßo √© necess√°ria, mas, como o autor mais uma vez enfatiza, exige uma an√°lise cuidadosa das consequ√™ncias.  Aprecie e proveitosa leitura! <br><br><img src="https://habrastorage.org/webt/im/q8/dr/imq8drim-mkatdxhbytwowus1ik.jpeg"><br><a name="habracut"></a><br>  De tempos em tempos, fa√ßo a mesma pergunta. <br><blockquote>  Existe uma verdade t√£o importante que apenas alguns concordam com voc√™?  - Peter Thiel </blockquote>  Antes de me sentar neste post, tentei por um longo tempo sobre esse assunto um t√≥pico, que hoje est√° em uma tend√™ncia s√©ria - trata-se de microsservi√ßos.  Acho que agora tenho algo a dizer;  algumas conclus√µes s√£o baseadas na reflex√£o, outras na experi√™ncia pr√°tica.  Ent√£o eu te digo. <br>  Vamos come√ßar com uma verdade importante que servir√° como ponto de refer√™ncia para n√≥s ao longo do caminho, como uma estrela polar. <br><br>  A maioria das implementa√ß√µes de microsservi√ßos nada mais s√£o do que mon√≥litos distribu√≠dos. <br><br><h4>  Era dos mon√≥litos </h4><br>  Qualquer sistema come√ßou como uma aplica√ß√£o monol√≠tica.  N√£o vou entrar em detalhes sobre este t√≥pico aqui - muitos j√° escreveram sobre muitos.  No entanto, a maior parte das informa√ß√µes sobre mon√≥litos √© dedicada a quest√µes como produtividade e escalabilidade do desenvolvedor, deixando para tr√°s entre par√™nteses o ativo mais valioso de qualquer empresa de Internet: os dados. <br><br><img src="https://habrastorage.org/webt/83/75/yh/8375yhxrmoq8jmhfl-wz97u7slg.png"><br><br>  <i>Arquitetura t√≠pica de aplicativos monol√≠ticos</i> <br><br>  Se os dados s√£o t√£o importantes, por que toda a aten√ß√£o √© dada a outros t√≥picos, mas n√£o a eles?  A resposta, em geral, √© simples: porque eles n√£o s√£o t√£o dolorosos quanto a quest√£o dos dados. <br>  Talvez o mon√≥lito seja o √∫nico est√°gio do ciclo de vida do sistema em que voc√™: <br><br><ul><li>  Entenda completamente o seu modelo de dados; </li><li>  Voc√™ pode cooperar com os dados (presume-se que seu banco de dados esteja selecionado corretamente para o seu aplicativo). </li></ul><br>  Em termos de dados, o mon√≥lito √© ideal.  E como os dados s√£o o ativo mais valioso de qualquer empresa, √© melhor n√£o quebrar o mon√≥lito, a menos que voc√™ tenha um motivo muito bom ou uma combina√ß√£o desses motivos.  Na maioria dos casos, a raz√£o decisiva desse tipo √© a necessidade de escalar (j√° que vivemos no mundo real com suas limita√ß√µes f√≠sicas inerentes). <br><br>  Quando esse momento chegar, seu sistema provavelmente entrar√° em uma nova hip√≥stase: ele se <b>transformar√° em um mon√≥lito distribu√≠do</b> . <br><br><h4>  A era dos mon√≥litos distribu√≠dos </h4><br>  Digamos que as coisas est√£o indo bem na sua empresa e o aplicativo precisa crescer.  Voc√™ tem mais e mais clientes grandes e seus requisitos para cobran√ßa e gera√ß√£o de relat√≥rios mudaram tanto em termos de um conjunto de oportunidades quanto em seu volume. <br><br>  Assumindo seriamente a demoli√ß√£o do mon√≥lito, em particular, voc√™ tentar√° implementar dois pequenos servi√ßos, um dos quais fornecer√° relat√≥rios e o segundo, o faturamento.  Muito provavelmente, esses novos servi√ßos fornecer√£o uma API HTTP e ter√£o um banco de dados dedicado para armazenamento de estado a longo prazo.  Depois de muitos commits, voc√™, como n√≥s da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Unbabel</a> , pode obter algo parecido com a ilustra√ß√£o a seguir. <br><br><img src="https://habrastorage.org/webt/lg/js/9g/lgjs9grnmyupckoplo0to5q-kjm.png"><br><br>  <i>Uma vis√£o geral da arquitetura do sistema ap√≥s desanexar os servi√ßos de cobran√ßa e relat√≥rio do aplicativo monol√≠tico principal</i> <br><br>  Tudo est√° indo conforme o planejado. <br><br><ul><li>  A equipe continua dividindo o mon√≥lito em sistemas menores; </li><li>  Os transportadores de integra√ß√£o / entrega cont√≠nuos funcionam como um rel√≥gio; </li><li>  O cluster Kubernetes √© saud√°vel, os engenheiros s√£o produtivos e felizes com tudo. </li></ul><br>  A vida √© linda. <br><br>  Mas e se eu disser que agora conspira√ß√µes vis est√£o tecendo contra voc√™? <br><br>  Agora, olhando para o seu sistema, voc√™ descobrir√° que os dados foram distribu√≠dos por muitos sistemas diferentes.  Voc√™ come√ßou no est√°gio em que tinha um banco de dados exclusivo onde todos os objetos de dados estavam armazenados e agora seus objetos de dados se espalharam para lugares diferentes.  Talvez voc√™ pense que n√£o h√° problema, pois s√£o necess√°rios microsservi√ßos para criar abstra√ß√µes e selar dados, ocultando a complexidade interna do sistema. <br><br>  Voc√™ est√° absolutamente certo.  Por√©m, com o aumento da escala, surgem problemas mais complexos: agora, a qualquer momento, voc√™ √© obrigado a atender aos requisitos de neg√≥cios (por exemplo, para rastrear alguma m√©trica), exigindo acesso aos dados localizados em mais de um sistema. <br><br>  O que fazer?  De fato, existem muitas op√ß√µes.  Mas com pressa, voc√™ tamb√©m precisa atender a uma enorme fraternidade de clientes que se registraram recentemente com voc√™, para encontrar um equil√≠brio entre "r√°pido" e "bom".  Depois de discutir os detalhes, voc√™ decide construir um sistema adicional que executaria um certo trabalho de ETL, contribuindo para a solu√ß√£o das tarefas finais.  Este sistema precisar√° ter acesso a todas as r√©plicas de leitura que cont√™m as informa√ß√µes necess√°rias.  A figura a seguir mostra como esse sistema poderia funcionar. <br><br><img src="https://habrastorage.org/webt/76/op/x0/76opx0yinpcv5fbxh9x8sais2hm.png"><br><br>  <i>Um exemplo generalizado de um sistema anal√≠tico de ETL (na Unbabel o chamamos de An√°lise Autom√°tica de Tradu√ß√£o)</i> <br><br>  Na Unbabel, usamos essa abordagem, pois: <br><br><ul><li>  N√£o afeta muito o desempenho de cada microsservi√ßo; </li><li>  N√£o requer grandes altera√ß√µes na infraestrutura (basta adicionar um novo microsservi√ßo); </li><li>  Fomos capazes de satisfazer com rapidez suficiente nossos requisitos de neg√≥cios. </li></ul><br>  A experi√™ncia sugere que, por algum tempo, essa abordagem funcione - at√© atingir uma certa escala.  Na Unbabel, ele nos serviu muito bem at√© muito recentemente, quando come√ßamos a enfrentar desafios cada vez mais s√©rios.  Aqui est√£o algumas coisas que se transformaram em dor de cabe√ßa para n√≥s: <br><br>  <b>1. Altera√ß√µes de dados</b> <br><br>  Uma das principais vantagens dos microsservi√ßos √© o encapsulamento.  A representa√ß√£o interna dos dados pode mudar, mas isso n√£o afeta os clientes do sistema, pois eles se comunicam por meio de uma API externa.  No entanto, nossa estrat√©gia exigia acesso direto √† representa√ß√£o interna dos dados e, portanto, assim que a equipe fez apenas algumas altera√ß√µes na apresenta√ß√£o dos dados (por exemplo, renomear um campo ou alterar o tipo de <code>text</code> para <code>uuid</code> ), tamb√©m tivemos que alterar e reimplementar nosso ETL- servi√ßo. <br><br>  <b>2. A necessidade de processar muitos esquemas de dados diferentes</b> <br><br>  √Ä medida que aumentava o n√∫mero de sistemas aos quais precis√°vamos conectar, tivemos que lidar com maneiras cada vez mais heterog√™neas de apresentar dados.  Era √≥bvio que n√£o pod√≠amos dimensionar todos esses esquemas, as rela√ß√µes entre eles e suas representa√ß√µes. <br><br>  <i><b>A raiz de todo mal</b></i> <br><br>  Para obter uma imagem completa do que est√° acontecendo no sistema, tivemos que parar em uma abordagem semelhante a um mon√≥lito.  A diferen√ßa toda era que n√£o t√≠nhamos um sistema e um banco de dados, mas dezenas desses pares, cada um com sua pr√≥pria representa√ß√£o de dados;  al√©m disso, em alguns casos, os mesmos dados foram replicados em v√°rios sistemas. <br><br>  Prefiro chamar esse sistema de mon√≥lito distribu√≠do.  Porque  Como √© totalmente inadequado para rastrear altera√ß√µes no sistema, e a √∫nica maneira de exibir o estado do sistema √© coletar um servi√ßo que se conecta diretamente aos data warehouses de todos os microsservi√ßos.  √â interessante ver quantos colossos da Internet tamb√©m enfrentaram desafios semelhantes em algum momento de seu desenvolvimento.  Um bom exemplo nesse caso que eu sempre gosto de dar √© a rede do LinkedIn. <br><br><img src="https://habrastorage.org/webt/bx/zv/l8/bxzvl8oaw7htdnldzu7fr3toxdm.png"><br><br>  <i>Esse √© o tipo de problema de dados que os fluxos de informa√ß√µes do Linkedin representaram por volta de 2011 - fonte</i> <br><br>  No momento, voc√™ deve estar se perguntando: "o que voc√™s v√£o fazer com tudo isso?"  A resposta √© simples: voc√™ precisa come√ßar a acompanhar as altera√ß√µes e acompanhar as a√ß√µes importantes √† medida que elas ocorrem. <br><br>  <b>Quebrar um mon√≥lito distribu√≠do usando Event Sourcing</b> <br><br>  Como praticamente o resto do mundo, os sistemas na Internet s√£o responsivos.  Portanto, uma solicita√ß√£o para a API pode levar √† inser√ß√£o de um novo registro no banco de dados.  Atualmente, na maioria dos casos, esses detalhes n√£o nos incomodam, pois estamos interessados ‚Äã‚Äãprincipalmente em atualizar o estado do banco de dados.  A atualiza√ß√£o do estado de um banco de dados √© uma consequ√™ncia condicional de algum evento (nesse caso, uma solicita√ß√£o de API).  O fen√¥meno do evento √© simples e, no entanto, o potencial dos eventos √© muito grande - eles podem at√© ser usados ‚Äã‚Äãpara destruir um mon√≥lito distribu√≠do. <br><br>  <b>Um evento nada mais √© do que um fato imut√°vel de alguma modifica√ß√£o que ocorreu no seu sistema</b> .  Na arquitetura de microsservi√ßo, os eventos se tornam cr√≠ticos e ajudam a compreender os fluxos de dados e, com base nisso, deduzir o estado agregado de v√°rios sistemas.  Cada microsservi√ßo que executa uma a√ß√£o interessante do ponto de vista de todo o sistema deve gerar um evento junto com todas as informa√ß√µes essenciais relacionadas ao fato de que esse evento representa. <br><br>  Talvez voc√™ tenha uma pergunta: <br>  "Como os microsservi√ßos que geram eventos me ajudam a resolver o problema do mon√≥lito distribu√≠do?" <br><br>  Se voc√™ possui sistemas que geram eventos, pode haver um log de fatos com as seguintes propriedades: <br><br><ul><li>  Falta de liga√ß√£o a qualquer data warehouse: os eventos geralmente s√£o serializados usando formatos bin√°rios como JSON, Avro ou Protobufs; </li><li>  Imutabilidade: assim que um evento √© gerado, √© imposs√≠vel alter√°-lo; </li><li>  Reprodutibilidade: o estado do sistema em um determinado momento pode ser restaurado;  Para fazer isso, basta "reproduzir" o log de eventos. </li></ul><br>  Usando esse log, voc√™ pode exibir o estado usando qualquer tipo de l√≥gica no n√≠vel do aplicativo.  Voc√™ n√£o est√° mais associado a nenhum conjunto de microsservi√ßos e <i>N</i> maneiras pelas quais os dados s√£o apresentados.  A √∫nica fonte de verdade e seu √∫nico armaz√©m de dados agora √© o reposit√≥rio onde seus eventos est√£o armazenados. <br><br>  Aqui est√£o algumas raz√µes pelas quais o log de eventos me parece ser o caminho para ajudar a quebrar o Mon√≥lito Distribu√≠do: <br><br>  <b>1. A √∫nica fonte da verdade</b> <br><br>  Em vez de manter N fontes de dados que podem ser necess√°rias para conectar-se a (m√∫ltiplos) bancos de dados heterog√™neos, neste novo cen√°rio, a verdade √∫ltima √© armazenada em exatamente um reposit√≥rio: o log de eventos. <br><br>  <b>2. Formato Universal de Dados</b> <br><br>  Na vers√£o anterior do sistema, tivemos que lidar com muitos formatos de dados, pois est√°vamos diretamente conectados ao banco de dados.  No novo layout, podemos agir com muito mais flexibilidade. <br><br>  Digamos que voc√™ gostou de uma foto do Instagram postada por um de seus amigos.  Essa a√ß√£o pode ser descrita: ‚ÄúO <i>usu√°rio X gostou da imagem P</i> ‚Äù.  E aqui est√° um evento que representa esse fato: <br><br><img src="https://habrastorage.org/webt/ff/sp/2x/ffsp2xttqkwolrptkfa3bw66mdc.png"><br><br>  <i>Um evento correspondente √† abordagem AVO (Ator, Verbo, Objeto), simulando o fato de o usu√°rio selecionar a imagem de que gosta.</i> <br><br>  <b>3. enfraquecimento da comunica√ß√£o entre produtores e consumidores</b> <br><br>  Por fim, mas n√£o menos importante, uma das maiores vantagens das opera√ß√µes de eventos √© o enfraquecimento efetivo da comunica√ß√£o entre produtores e consumidores de dados.  Essa situa√ß√£o n√£o apenas simplifica o dimensionamento, mas tamb√©m reduz o n√∫mero de depend√™ncias entre eles.  O √∫nico contrato restante entre os sistemas nesse caso √© o diagrama de eventos. <br><br><hr><br>  No in√≠cio deste artigo, a quest√£o foi colocada: existe uma verdade t√£o importante na qual apenas alguns concordam com voc√™? <br><br>  Deixe-me voltar a ele na conclus√£o desta excurs√£o.  Acredito que a maioria das empresas n√£o considera os dados "entidades de primeira classe" quando inicia a migra√ß√£o para a arquitetura de microsservi√ßo.  Argumenta-se que todas as altera√ß√µes de dados ainda podem ser feitas por meio da API, mas essa abordagem leva a uma complica√ß√£o constante do pr√≥prio servi√ßo. <br><br>  Acredito que a √∫nica abordagem verdadeira para capturar altera√ß√µes de dados em uma arquitetura de microsservi√ßo √© fazer com que os sistemas emitam eventos de acordo com um contrato estritamente definido.  Ter um log de eventos compilado corretamente permite exibir muitos dados com base em qualquer conjunto de requisitos de neg√≥cios.  Nesse caso, voc√™ apenas precisa aplicar regras diferentes aos mesmos fatos.  Em alguns casos, essa fragmenta√ß√£o de dados pode ser evitada se sua empresa (especialmente seus gerentes de produto) tratar os dados como um produto.  No entanto, este √© um t√≥pico para outro artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453470/">https://habr.com/ru/post/pt453470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453458/index.html">Programa√ß√£o reativa real no Svelte 3.0</a></li>
<li><a href="../pt453460/index.html">Quando cansado do virtual</a></li>
<li><a href="../pt453464/index.html">Futuro qu√¢ntico (continua√ß√£o)</a></li>
<li><a href="../pt453466/index.html">HolyJS 2019: Analisando a partir do SEMrush (Parte 2)</a></li>
<li><a href="../pt453468/index.html">A evolu√ß√£o dos aplicativos da web Java</a></li>
<li><a href="../pt453472/index.html">Bicicleta do monitor de energia PZEM004T e ESP8266, com People's Monitoring</a></li>
<li><a href="../pt453474/index.html">Controle do computador via controle remoto de um amplificador usando Arduino e Node.js</a></li>
<li><a href="../pt453478/index.html">Estudamos a sa√∫de dos sat√©lites Starlink Ilona Mask</a></li>
<li><a href="../pt453482/index.html">Introdu√ß√£o ao aprendizado profundo usando o TensorFlow</a></li>
<li><a href="../pt453484/index.html">Contador BCD de 4 bits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>