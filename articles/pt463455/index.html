<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÆÔ∏è üå¨Ô∏è üì∞ Milhares de coisas para corrigir em Java a partir da vers√£o um: uma √≥tima entrevista com Sergey Kuksenko da Oracle üê£ ü§±üèº üõï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sergey Kuksenko √© um engenheiro de desempenho que viu o Java ainda na vers√£o 1.0. Durante esse per√≠odo, ele conseguiu participar do desenvolvimento de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Milhares de coisas para corrigir em Java a partir da vers√£o um: uma √≥tima entrevista com Sergey Kuksenko da Oracle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/463455/"><p><img src="https://habrastorage.org/webt/df/kc/6_/dfkc6_bq7r5jfxx7vr1awxr-mf8.jpeg"></p><br><p>  Sergey Kuksenko √© um engenheiro de desempenho que viu o Java ainda na vers√£o 1.0.  Durante esse per√≠odo, ele conseguiu participar do desenvolvimento de aplicativos m√≥veis, clientes, servidores e m√°quinas virtuais.  Desde 2005, o Java atua no desempenho e atualmente trabalha na Oracle para melhorar o desempenho do JDK.  Um dos palestrantes mais populares da Joker e JPoint. </p><br><p>  Este habrapost √© uma √≥tima entrevista com Sergey, dedicada aos seguintes t√≥picos: </p><br><ul><li>  Culto da Performance; </li><li>  Quando e o que precisa ser otimizado, o design inicial da linguagem e da biblioteca; </li><li>  √Åreas promissoras para maior otimiza√ß√£o; </li><li>  Como participar do desenvolvimento e o que pode ser quebrado por otimiza√ß√µes; </li><li>  Truques do compilador, registro de posicionamento; </li><li>  √â poss√≠vel montar um gato a partir de carne picada; </li><li>  Quando os testes funcionam por cinco dias consecutivos e outras rotinas dom√©sticas; </li><li>  Como se tornar um engenheiro de desempenho; </li><li>  Preparando um relat√≥rio para o pr√≥ximo Coringa. <a name="habracut"></a></li></ul><br><h2 id="o-kulte-proizvoditelnosti">  Sobre o culto √† produtividade </h2><br><p>  <strong>Oleg:</strong> Voc√™ √© nosso antigo orador e esta n√£o √© a nossa primeira entrevista.  Diga-me um pouco, quem √© voc√™ agora, o que voc√™ est√° fazendo? </p><br><p>  <strong>Sergey:</strong> Eu sou o mesmo de muitos anos atr√°s e estou fazendo a mesma coisa.  Trabalho na equipe Java Performance e sou respons√°vel pelo desempenho das m√°quinas Java Oracle, OpenJDK. </p><br><p>  <strong>Oleg:</strong> Ent√£o, eu tenho uma pergunta meio troll: aqui voc√™ √© um engenheiro de desempenho e seus relat√≥rios s√£o sobre todos os tipos de desempenho.  Voc√™ n√£o acha que o problema de desempenho √© superestimado?  Todo mundo corre com ela, mas isso √© mesmo necess√°rio? </p><br><p>  <strong>Sergey:</strong> Esta √© uma boa pergunta.  Tudo depende do outro.  Esse tipo de aten√ß√£o do p√∫blico pode ser considerado excessivo.  A produtividade dos neg√≥cios, por outro lado, √© dinheiro. </p><br><p>  Esse √© o dinheiro real que as pessoas gastam em hardware, em algum tipo de nuvem na Amaz√¥nia.  Se voc√™ n√£o processar suas solicita√ß√µes com rapidez suficiente - √© isso, voc√™ perde clientes, perde dinheiro, perde todo o resto.  Portanto, a solicita√ß√£o de desempenho, √© claro, est√° sempre l√°.  A quest√£o √© qu√£o importante √© em cada caso.  Fico calado sobre o com√©rcio de alta frequ√™ncia. </p><br><p>  <strong>Oleg:</strong> A prop√≥sito, voc√™ acha que o Java √© adequado para isso? </p><br><p>  <strong>Sergey:</strong> Voc√™ teve a oportunidade de conhecer uma pessoa como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Peter Lawrey</a> ? </p><br><p>  <strong>Oleg:</strong> Quem √© o CEO da Chronicle Software, os desenvolvedores do OpenHFT? </p><br><p>  <strong>Sergey:</strong> Este √© um amigo muito famoso de Londres que viaja muito em confer√™ncias.  Eles trabalham em Java em negocia√ß√µes de alta frequ√™ncia, vivem muito bem. </p><br><p>  <strong>Oleg:</strong> Eles est√£o fazendo isso em Java ou √© chamado c√≥digo nativo de Java?  Ainda assim, h√° uma diferen√ßa. </p><br><p>  <strong>Sergey:</strong> Eu n√£o sei nesse n√≠vel, ele n√£o contou.  Em princ√≠pio, se desejado, tudo o que √© necess√°rio pode ser alcan√ßado no pr√≥prio Java. </p><br><p>  <strong>Oleg:</strong> Interessante.  Se voc√™ tomar, por exemplo, uma comunidade de pythonists, eles ter√£o muito menos culto √† produtividade.  Como √© exatamente isso que acontece em nossa comunidade?  Talvez <em>voc√™</em> tenha provocado o culto ao desempenho com seus relat√≥rios?  Voc√™, Shipilev, Pangin, Ivanov e assim por diante. </p><br><p> <strong>Sergey:</strong> Eu n√£o sei como aconteceu.  O culto √† produtividade na confer√™ncia russa √© muito maior do que na americana.  Talvez isso reflita o pr√≥prio p√∫blico.  Em n√≥s, as pessoas querem se envolver mais em produtividade, √© interessante para elas.  E na Am√©rica, eles querem fazer mais pelo que pagam mais.  Mas isso √© uma hip√≥tese, conjectura.  Isso aconteceu. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MvJJgR6nxXQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kogda-i-chto-nuzhno-optimizirovat">  Quando e o que precisa ser otimizado </h2><br><p>  <strong>Oleg:</strong> Voc√™ disse que ainda h√° um pedido de desempenho.  Em que momento voc√™ precisa come√ßar a pensar em desempenho?  Quando o trov√£o atacar√°? </p><br><p>  <strong>Sergey:</strong> Esta √© uma pergunta abstrata geral.  √â melhor recorrer novamente √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">palestra</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alexey Shipilev</a> em uma das confer√™ncias anteriores, onde ele pintou tudo isso o suficiente. </p><br><p>  <strong>Oleg:</strong> Sim, eu lembro da "curva do nome Sh". </p><br><p>  <strong>Sergey:</strong> Voc√™ precisa fazer o desempenho imediatamente, mas dependendo de qual n√≠vel.  N√£o √© necess√°rio escrever refer√™ncias imediatamente.  Sabe-se, por exemplo, que a restri√ß√£o banal do n√≠vel de arquitetura da API entre Set como um conjunto e SortedSet j√° nos imp√µe restri√ß√µes algor√≠tmicas fundamentais. </p><br><p>  Se inserirmos um SortedSet na API (embora ningu√©m precise desse classificado) e, em seguida, ele se espalhar por todo o sistema, essa coisa ter√° que ser realizada com muito esfor√ßo. </p><br><p>  A quest√£o come√ßa no pr√≥prio n√≠vel de design - √© uma quest√£o de restri√ß√µes m√≠nimas.  As menores restri√ß√µes poss√≠veis devem ser usadas para que voc√™ possa brincar com elas mais tarde.  Por exemplo, quando torci v√°rios peda√ßos de Java, vieram √† mente palavr√µes extremamente ruins.  Gostaria de fazer algo com uma das classes base, mas n√£o posso fazer nada, porque a API √© fixa, voc√™ n√£o pode mais alter√°-la, ela j√° foi rastreada.  Mas, para fazer alguns truques e fazer overclock, voc√™ precisa ocultar alguns detalhes. </p><br><p>  Estudo de caso: eu costumava me agachar na classe java.math.BigDecimal.  Houve um grande pedido de lados diferentes para dispers√°-lo de alguma forma.  Existe um caso bom e especial quando o nosso BigDecimal n√£o √© "Grande", √© apenas o decimal e voc√™ precisa l√™-los. </p><br><p>  Agora, √© claro, um wrapper apropriado foi criado para isso.  Mas se n√£o houvesse um construtor p√∫blico saindo do BigDecimal, mas alguns m√©todos e f√°bricas est√°ticos, seria poss√≠vel tornar o BigDecimal abstrato e cuspir duas implementa√ß√µes diferentes que funcionavam conforme necess√°rio.  Mas isso √© imposs√≠vel, porque o construtor se destaca.  Por esse motivo, voc√™ j√° precisa fazer uma verifica√ß√£o desnecess√°ria do tempo de execu√ß√£o, o que permite seguir um caminho r√°pido em alguns casos. </p><br><p>  <strong>Oleg:</strong> Daqui resulta que, ao desenvolver uma biblioteca padr√£o, vale a pena abandonar os designers e fazer construtores em todos os lugares? </p><br><p>  <strong>Sergey:</strong> Est√° ficando tarde. </p><br><p>  <strong>Oleg:</strong> Se n√£o fosse tarde demais, seria uma boa ideia? </p><br><p>  <strong>Sergey:</strong> Ela daria mais espa√ßo para manobra.  Veja: estamos escrevendo novo, e esse novo est√° do lado de fora do construtor.  Duas opera√ß√µes s√£o obtidas: primeiro criamos um objeto, depois chamamos o construtor que o preenche.  E, √†s vezes, seria muito √∫til ocultar a pr√≥pria cria√ß√£o do objeto e criar o objeto errado que temos l√° fora.  Essa √© uma restri√ß√£o de idioma, o original, desde os primeiros dias do Java. </p><br><p>  <strong>Oleg:</strong> Bem, agora todo mundo usa estruturas DI que permitem que voc√™ tor√ßa proxies como quiser e adicione qualquer coisa, ignorando essa limita√ß√£o.  No design original do idioma, voc√™ poderia adicionar algo assim, o cont√™iner de inje√ß√£o de depend√™ncia embutido? </p><br><p>  <strong>Sergey:</strong> Eu tenho uma opini√£o muito espec√≠fica sobre o design inicial da linguagem.  Se voc√™ se lembra da hist√≥ria do Java 1.0, saiu uma press√£o de tempo bastante s√©ria, tudo tinha que ser feito rapidamente. </p><br><p>  Existem milhares de coisas que eu pessoalmente gostaria de ver corrigidas desde a primeira vers√£o.  Mas receio que, mesmo que um dentre esses mil seja escolhido, um-dois-tr√™s, e eles tivessem come√ßado a ser feitos no momento do lan√ßamento do primeiro Java, o Java n√£o teria sido lan√ßado.  Este √© um exemplo padr√£o de que o melhor √© o inimigo do bem. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9E6DKrxOLHo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-eschyo-mozhno-optimizirovat-v-java">  O que mais pode ser otimizado em Java </h2><br><p>  <strong>Oleg:</strong> As pessoas comuns podem consertar algo apenas em seu projeto, e voc√™, como engenheiros de desempenho no JDK, afeta imediatamente centenas de milhares de projetos.  Surge a pergunta: ao longo de mais de 20 anos de desenvolvimento Java, houve alguma √°rea no JDK em que a interven√ß√£o dos engenheiros principais pode levar a um efeito percept√≠vel?  E qu√£o percept√≠vel √© esse "efeito percept√≠vel"? </p><br><p>  <strong>Sergey:</strong> Primeiro, agora o Java n√£o funciona no hardware que, digamos, h√° 10 anos.  Ferro agora e ferro h√° 10 anos s√£o duas grandes diferen√ßas, e √© aconselh√°vel fazer v√°rias otimiza√ß√µes. </p><br><p>  Em segundo lugar, √© claro que √© maravilhoso quando um engenheiro de desempenho se senta e acelera algo, obt√©m grandes n√∫meros, se reporta a seus superiores, ganha dinheiro por um b√¥nus ap√≥s esses overclocking.  Mas uma enorme quantidade de trabalho est√° em andamento em novos projetos.  Um recurso √© adicionado e a tarefa do engenheiro de desempenho n√£o √© fazer overclock no recurso, mas garantir que tudo esteja bem nesse recurso.  Ou, se n√£o estiver ok, crie algum tipo de corre√ß√£o. </p><br><p>  <strong>Oleg:</strong> Como voc√™ pode ter certeza?  Voc√™ n√£o verifica o c√≥digo formalmente.  O que √© um "certifique-se"? </p><br><p>  <strong>Sergey:</strong> Garantir que est√° tudo bem do ponto de vista do desempenho √© a opini√£o subjetiva subjetiva de um engenheiro de desempenho que escrever√° um relat√≥rio e dir√° que "tudo est√° normal nesse recurso".  Dependendo do tamanho do recurso, isso implica algumas vezes em a√ß√£o, outras em esfor√ßos diferentes.  A partir do fato de que voc√™ s√≥ precisa se sentar estupidamente, observe o que est√° sendo feito l√°, fa√ßa benchmarks nesta √°rea, fa√ßa benchmarks, veja o que acontece na sa√≠da e tome uma decis√£o informada razo√°vel. </p><br><p>  <strong>Oleg:</strong> E do ponto de vista do desempenho e dos novos recursos - o Java geralmente avan√ßa?  Existe algo a√≠?  Porque nosso hardware n√£o mudou muito, por exemplo, se falamos sobre a Intel. </p><br><p>  <strong>Sergey:</strong> Por que per√≠odo isso n√£o mudou? </p><br><p>  <strong>Oleg:</strong> Por exemplo, nos √∫ltimos 10 anos. </p><br><p>  <strong>Sergey:</strong> Sim, existe um AVX-512 em hardware h√° uma d√©cada? </p><br><p>  <strong>Oleg:</strong> N√£o.  Ele, provavelmente, nem sempre est√° presente no moderno? </p><br><p>  <strong>Sergey:</strong> Eu definitivamente n√£o.  Temos em nosso laborat√≥rio, mas tudo √© ocupado por compiladores.  Eles est√£o ferrando at√© agora, ent√£o eu n√£o olhei. </p><br><p>  <strong>Oleg:</strong> O suporte ao AVX-512 pode ser considerado um exemplo de recurso t√≠pico? </p><br><p>  <strong>Sergey:</strong> Provavelmente poss√≠vel.  O que exatamente eu fa√ßo: tivemos uma grande camada de trabalho no fato de que existem requisitos modernos para adicionar novos algoritmos criptogr√°ficos.  √â algo em que os algoritmos de criptografia de dez anos simplesmente n√£o podem ser invocados.  Precisamos de novos algoritmos, chaves maiores.  E a adi√ß√£o de novos algoritmos criptogr√°ficos ocorre, eu diria, constantemente. </p><br><p>  <strong>Oleg:</strong> Eles de alguma forma aceleram o hardware? </p><br><p>  <strong>Sergey:</strong> Tudo depende de algoritmos espec√≠ficos.  Existem algoritmos muito bem acelerados.  A prop√≥sito, h√° 10 anos, isso n√£o teria funcionado no hardware da Intel, mas em cerca de 5 a 6 o qu√£o boas instru√ß√µes apareceram, at√© unidades AES com acelera√ß√µes.  Tudo isso foi implementado com um intervalo de tempo m√≠nimo. </p><br><p>  <strong>Oleg:</strong> E a GPU, eles tamb√©m s√£o capazes de multiplicar matrizes? </p><br><p>  <strong>Sergey:</strong> Sobre a GPU - uma conversa em separado.  Temos para isso um projeto do Panam√° no qual todo esse trabalho √© realizado e, algum dia, ele alcan√ßar√° a linha principal do Java com todas as vantagens. </p><br><p>  <strong>Oleg:</strong> Eu tenho alguns conhecidos que est√£o envolvidos, condicionalmente, em matem√°tica financeira.  De algum ponto em diante, eles sempre mudam para C ++ para computa√ß√£o e afirmam que √© muito inconveniente usar todas essas otimiza√ß√µes e hardware da plataforma gerenciada.  Isso pode ser melhorado? </p><br><p>  <strong>Sergey:</strong> Tamb√©m temos um grande pedido para isso e h√° v√°rios requisitos internos.  Por exemplo, para fazer algo funcionar melhor no campo de aprendizado de m√°quina.  Como regra, essa √© uma multiplica√ß√£o matricial banal, que pode ser descartada na GPU.  O trabalho est√° em andamento, digamos assim. </p><br><p>  Temos dois grandes projetos: Valhalla e Panam√°, que devem coletar recursos como a GPU.  Na jun√ß√£o de Valhalla e Panam√°, fica uma API de vetor que funciona com nossas instru√ß√µes SIMD / SSE / AVX diretamente do c√≥digo Java, e a pr√≥pria Valhalla com tipos embutidos √© um grande passo nessa dire√ß√£o. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/M4URPKrbr0A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-mozhno-slomat-optimizaciey-kak-pouchastvovat-v-razrabotke">  O que pode ser quebrado pela otimiza√ß√£o, como participar do desenvolvimento </h2><br><p>  <strong>Oleg:</strong> Os guarda-chuvas que voc√™ mencionou s√£o parecidos.  √â poss√≠vel que um projeto afete outro, inclusive em termos de c√≥digo e perfil de desempenho?  Por exemplo, voc√™ refatorou algo, e o infeliz Ron Presler, derramando l√°grimas, est√° fixando seus testes em um canto √† noite? </p><br><p>  <strong>Sergey:</strong> Isso acontece o tempo todo.  Um exemplo concreto √© a API Vector.  Para que a API Vector funcione bem, nossos vetores nativos devem eventualmente se tornar tipos de valor ou, como agora √© chamado em Java, tipos embutidos.  Voc√™ pode fazer uma solu√ß√£o alternativa no hotspot e implement√°-lo de alguma forma, mas eu quero ter uma solu√ß√£o geral.  Por outro lado, o principal recurso dos tipos embutidos √© precisamente n√£o se preocupar com o layout desses dados, e o layout desses dados √© extremamente importante para a API Vector. </p><br><p>  Porque, de fato, corresponde diretamente ao AVX-512 e tudo mais.  √â claro que voc√™ precisa fazer alguns agachamentos, algumas otimiza√ß√µes que, por um lado, tornar√£o o tipo embutido um tipo normal, mas que ter√£o um layout baseado em hardware.  Naturalmente, ocorrem interse√ß√µes.  Se voc√™ olhar para os grupos de pessoas que movem o Panam√° e movem Valhalla, eles se cruzam mais da metade. </p><br><p>  <strong>Oleg:</strong> Puramente organizacional, aqui voc√™ tem um projeto, algum tipo de problema com o desempenho, mas est√° na jun√ß√£o de v√°rios projetos.  O que fazer depois?  Como resolver isso?  Acontece que isso j√° √© uma troca entre projetos e pessoas, e n√£o entre algumas tarefas abstratas. </p><br><p>  <strong>Sergey:</strong> Tudo √© muito simples aqui: se esse √© um problema de desempenho com um recurso que est√° sendo projetado, voc√™ precisa ir para as pessoas que est√£o projetando e dizer: ‚Äúe assim por diante, o que vamos fazer?  Vamos fazer diferente.  A discuss√£o come√ßa e o problema est√° resolvido. </p><br><p>  Se o c√≥digo j√° existe, ele j√° funciona.  No caso ideal, voc√™ corrige esse problema ou, se n√£o puder corrigi-lo completamente, solta o prot√≥tipo e, em seguida, chega ao propriet√°rio do c√≥digo e diz: "Aqui est√° o prot√≥tipo, o que faremos?"  Al√©m disso, resolvemos esse problema especificamente para cada caso. </p><br><p>  <strong>Oleg:</strong> Temos pessoas interessadas aqui que n√£o podem participar desse processo, esses s√£o usu√°rios finais. </p><br><p>  <strong>Sergey:</strong> Eles n√£o podem participar exatamente o suficiente para que n√£o sejam pagos por seus sal√°rios na Oracle.  Se voc√™ n√£o precisa de um sal√°rio, v√° ao OpenJDK e participe. </p><br><p>  <strong>Oleg:</strong> Qu√£o real √©?  O OpenJDK tem alguns g√™nios como voc√™, onde as pessoas comuns est√£o e onde voc√™ est√°.  Digamos que algo esteja diminuindo a velocidade para mim, o que devo fazer e como? </p><br><p>  <strong>Sergey:</strong> Se voc√™ n√£o conhece o problema, esta √© uma pergunta separada, se algu√©m procurar√° uma solu√ß√£o para voc√™, esta √© uma quest√£o como uma √°rea, um exemplo e assim por diante.  Mesmo que voc√™ n√£o conhe√ßa o problema, talvez fa√ßa sentido escrever no OpenJDK e perguntar.  Se isso √© algo que algu√©m clica imediatamente na cabe√ßa, as pessoas o agarram.  Se n√£o interessar a ningu√©m, ficar√° sem resposta. </p><br><p>  <strong>Oleg:</strong> Suponha que eu conhe√ßa o problema e at√© saiba o que precisa ser corrigido. </p><br><p>  <strong>Sergey:</strong> Se voc√™ conhece o problema, voc√™ vem ao OpenJDK, assina todos os peda√ßos de papel necess√°rios, oferece um patch, ele √© revisado e derramado. </p><br><p>  <strong>Oleg:</strong> √â simples assim? </p><br><p>  <strong>Sergey:</strong> Bem, sim, um pouco de burocracia, espere um pouco.  Ontem, Tagir ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">lany</a> ) pegou uma pequena corre√ß√£o que eu abandonei.  Ele s√≥ quer ser levado at√© o fim.  Ele come√ßou a lembr√°-lo por conta pr√≥pria.  Ele diz: "Droga, o que √© isso, eu fiz tudo, planejado, ningu√©m est√° revisando".  Bem, sim, ningu√©m est√° revisando.  √â julho, metade do escrit√≥rio de Java est√° de f√©rias.  Eles sair√£o de f√©rias e far√£o isso. </p><br><p>  <strong>Oleg:</strong> F√©rias nos EUA s√£o quase as mesmas datas que normalmente na R√∫ssia? </p><br><p>  <strong>Sergey:</strong> N√£o, o sistema de f√©rias nos EUA √© completamente diferente do da R√∫ssia.  Em primeiro lugar, eles s√£o significativamente menores.  E tamb√©m, nos EUA, o sistema de f√©rias est√° ligado √†s escolas.  Quando voc√™ tem filhos em f√©rias - depois em feriados.  Assim que as f√©rias come√ßam, toda a Am√©rica come√ßa a se mover.  E como as aulas aqui terminam em meados de junho e come√ßam em meados de agosto, esse delta para f√©rias n√£o √© t√£o grande - apenas dois meses. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ulWWSKr0Ce0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kompilyatornye-tryuki-razmeschenie-registrov">  Truques do compilador, registrar o posicionamento </h2><br><p>  <strong>Oleg:</strong> J√° aconteceu que voc√™ otimizou algo em casa e depois disso os usu√°rios tiveram que escrever c√≥digo de maneira diferente?  Em termos relativos, se a opera√ß√£o de selecionar uma substring costumava ter um intervalo e agora faz uma c√≥pia completa, essa refatora√ß√£o altera a maneira como voc√™ escreve o c√≥digo. </p><br><p>  <strong>Sergey:</strong> Certamente foi, mas n√£o vou dar exemplos espec√≠ficos agora.  A quest√£o √©: o que as pessoas estabelecem ao escrever c√≥digo.  Se eles precisarem reduzir o desempenho m√°ximo e, para isso, fazem todos os tipos de truques espec√≠ficos do compilador, devem estar preparados para que o compilador evolua com o tempo e precisam modificar constantemente seu c√≥digo de acordo com o estado atual do compilador.  E isso √© √≥timo. </p><br><p>  Suponhamos que, de repente, depois de 20 anos, Graal venha a ser o compilador principal do HotSpot - ent√£o esses pobres ter√£o que reescrever tudo.  Isso s√≥ acontece se voc√™ assumiu uma tarefa t√©cnica - rastrear altera√ß√µes no compilador.  √â muito mais simples escrever o c√≥digo correto sem v√≠nculos diretos, com implementa√ß√µes gerais mais ou menos normais. </p><br><p>  A prop√≥sito, sobre compiladores - n√£o apenas sobre compiladores Java, mas em geral.  Existe a lei de Moore, que n√£o √© uma lei, mas apenas uma observa√ß√£o emp√≠rica de que o n√∫mero de transistores dobra a cada ano e meio. </p><br><p>  E existe exatamente a mesma lei ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lei de Proebsting</a> ) que o desempenho do c√≥digo sem modifica√ß√£o aumenta em 4% a cada um ano e meio ou dois.  Esse 4% √© o que os usu√°rios finais recebem de gra√ßa apenas com a evolu√ß√£o dos compiladores.  N√£o √© hardware, ou seja, compiladores. </p><br><p>  <strong>Oleg:</strong> Gostaria de saber de onde v√™m essas porcentagens.  Isso √© algum tipo de inefici√™ncia inicial?  Mas, algum dia, esse estoque de inefici√™ncias terminar√°. </p><br><p>  <strong>Sergey:</strong> N√£o, √© apenas uma quest√£o de desenvolvimento de tecnologia.  Sa√≠ dos compiladores quando comecei a trabalhar no desempenho.  Mas uma vez que eu estava noivo, e a maior descoberta para mim foi feita em 2005 ou 2006.  Descobri isso em 2008 porque n√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">li o artigo a</a> tempo. </p><br><p>  Uma tarefa muito importante de qualquer gera√ß√£o de c√≥digo √© a aloca√ß√£o de registros.  Sabe-se que, em geral, esse problema √© NP-completo.  √â muito dif√≠cil resolv√™-lo e, portanto, todos os compiladores tentam conduzir algum tipo de algoritmo aproximado com v√°rios graus de qualidade. </p><br><p>  E aqui vem um artigo em que os caras provam que, em alguns casos, que cobrem um grande n√∫mero de compiladores e um grande n√∫mero de representa√ß√µes internas com certas restri√ß√µes, existe um algoritmo polinomial exato para a tarefa de alocar a aloca√ß√£o de registros.  Viva, vamos l√°! </p><br><p>  Isso aconteceu em 2005, os compiladores feitos anteriormente n√£o sabiam disso. </p><br><p>  <strong>Oleg:</strong> Agora voc√™ pode criar um novo alocador para Java? </p><br><p>  <strong>Sergey:</strong> Agora que existe uma solu√ß√£o te√≥rica, ela pode ser reescrita.  N√£o entrei em detalhes, mas sei que os caras da Excelsior implementaram o algoritmo. </p><br><p>  <strong>Oleg:</strong> Recentemente, fizemos uma entrevista com Cliff Click e ele falou sobre o alocador de g√™nios insanamente complexo e insano que ele escreveu para Java.  N√£o quer escrever outro? </p><br><p>  <strong>Sergey:</strong> N√£o. </p><br><p>  <strong>Oleg:</strong> Existe algo normal? </p><br><p>  <strong>Sergey:</strong> N√£o, ele n√£o √© normal.  Do meu ponto de vista utilitarista, direi que procuro em assembler e √†s vezes vejo: "Bem, sim, aqui os registros ficaram ruins".  Se eu recorrer a chutar nossos compiladores e reescrevermos o alocador, o que obteremos?  Obteremos algum ganho, mas √© improv√°vel que eu o veja, exceto nos exemplos em que vi a aloca√ß√£o ineficiente de registros.  Enquanto n√£o houver grandes falhas nessa √°rea, sempre haver√° algo a ser feito e a obten√ß√£o de mais ganhos. </p><br><p>  <strong>Oleg:</strong> Existem √°reas de trabalho no JDK em que todo o compilador do compartimento do motor ou a m√°gica do desempenho chega √† superf√≠cie?  Voc√™ diz que precisa escrever um c√≥digo normal normal e tudo ficar√° bem, mas parece suspeito. </p><br><p>  <strong>Sergey:</strong> Tudo ficar√° bem at√© voc√™ precisar de um super duper.  Se voc√™ precisar muito r√°pido, esteja preparado para sempre reescrev√™-lo.  No momento, se voc√™ pegar um aplicativo grande e abstrato, em geral, como est√° escrito - geralmente n√£o desempenha um papel em termos de desempenho. </p><br><p>  Por um lado, assim que o coletor de lixo √© acionado, ele consome 10-20%, por outro lado, a arquitetura do aplicativo come√ßa a aparecer.  O grande problema que eu vi no monte de aplicativos √© que eles est√£o mudando os dados.  Pegamos os dados daqui, transferimos para l√°, fizemos algumas transforma√ß√µes l√°.  Em geral, qualquer programa faz exatamente isso.  Ele transfere dados de um lugar para outro de alguma forma.  Mas se voc√™ tiver muitas mudan√ßas no programa, o compilador n√£o ajudar√°. </p><br><p>  <strong>Oleg:</strong> Voc√™ pode tentar rastrear algumas coisas simples, como: esse peda√ßo de mem√≥ria est√° mudando de propriet√°rio e se movendo entre objetos nessa dire√ß√£o. </p><br><p>  <strong>Sergey:</strong> N√£o, isso √© um problema de design.  Mas eu n√£o apenas mudo, mas mudo com modifica√ß√µes, fa√ßo algo com elas.  O maior benef√≠cio em aplicativos reais e massivos pode ser obtido se voc√™ pensar a respeito: s√£o necess√°rias muitas mudan√ßas.  Em vez de dez, fazer sete j√° √© bom. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/kxgo7Y4cdA8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JRBWBJ6S4aU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>(Pode parecer que o mesmo v√≠deo foi acidentalmente duplicado aqui. Na verdade, tudo √© mais simples, Habr armazenou a imagem errada do YouTube)</em> </p><br><h2 id="sobiraem-koshku-iz-farsha">  Coletamos um gato de carne picada </h2><br><p>  <strong>Oleg:</strong> Acabamos de ter uma confer√™ncia Hydra sobre computa√ß√£o distribu√≠da.  E muitas pessoas se preocupam muito com um modelo de custo, determinando o custo de cada opera√ß√£o <strong>-</strong> muito granular, muito preciso.  As pessoas realmente querem escrever todas as instru√ß√µes, somar o custo de cada uma delas e ver quantas barras seu c√≥digo precisar√°.  Eu me pergunto como essa abordagem funciona na realidade moderna.    ,   ? </p><br><p> <strong>:</strong> ,      .  ,    .         ,   .  ,     .   ,    ,      ,        .           ? </p><br><p> <strong>:</strong> : ¬´    ¬ª. </p><br><p> <strong>:</strong>  , .   ,     .    ,   ?   .   ‚Äî   ,      .   ,   , -   ,    . </p><br><p> <strong>:</strong>       ,      ? </p><br><p> <strong>:</strong>     ,     ?   ,     .         ? </p><br><p> <strong>:</strong> , -  ? </p><br><p> <strong>:</strong>   ,          ‚Äî ,   .   -  .   ?    ,      ,   ,        ,   . ,           . </p><br><p> <strong>:</strong>    . </p><br><p> <strong>:</strong>      ,       1 .   ,      ,   .     , -  ,  -  . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/O8oN4KSZEXE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/i0Jr2l3jrDA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="pyat-dney-na-testy-i-drugie-zadachi-performance-inzhenera">        performance- </h2><br><p> <strong>:</strong>     OpenJDK    .        ? C++    .       ‚Äî   -? </p><br><p> <strong>:</strong> ,  ,  .     .     OpenJDK  15 .      15    . </p><br><p> <strong>:</strong>   ,      ,       .          . </p><br><p> <strong>:</strong>   !       ,    ,   .     ,    ,  , , ,         .  ,       .     :   ,  ,   (  ,     ),      ‚Äî   .      ,   ,      . </p><br><p> <strong>:</strong> ,      ? </p><br><p> <strong>:</strong> , ,       Java. </p><br><p> <strong>:</strong>   ? </p><br><p> <strong>:</strong> , ,    Valhalla. </p><br><p> <strong>:</strong>    -  ,  ,  ‚Äî   ,      ?     ?               . </p><br><p> <strong>:</strong>    ,  .   ‚Äî       .    ,   ,    ,    .  ,  , .      .    2-3 ,      ,      ,       ,  ‚Äî ,   . </p><br><p> , ,   inline-,        Java        Joker.    .  ,    Java-   ,    runtime-.     red flag: runtime-    0.         ?  ,      out of order- ‚Äî . </p><br><p>     ,   . ,   .     ?             .       .  baseline,   ,       5-6 ,          ‚Äî     .  ,    ,  -  2    ‚Äî     -    .   3%   - ,     .  3%  ? </p><br><p> <strong>:</strong>    ,      ? </p><br><p> <strong>:</strong>     ,     .     performance-,     . ,             ,   ‚Äî . </p><br><p>        ,    ,  .   performance- ‚Äî     ,    - performance-  -       ,   .  ,   ,     . </p><br><p> ,    ,   ,   ,   performance- ‚Äî  class libraries    hotspot,     . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cz93lTJW-do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kak-voyti-v-performance">  ¬´¬ª  performance </h2><br><p> <strong>:</strong> , -     performance-,     . ,      ,       ? </p><br><p> <strong>:</strong>    .     ?    ,    performance-         performance-. </p><br><p>  ,      :  ,       ,   Oracle, Twitter, Netflix  ,    -   .          ,              ‚Äî    .  ,     performance-    ,   . </p><br><p>     -  ,   ,    performance-  ,      ?     ,   ,    . </p><br><p>     ,   performance- ‚Äî    .    :          - performance review,        , , ,  ,  .     ‚Äî  performance   . </p><br><p>    : ¬´ ,  ...¬ª,        ,     ‚Äî  . ,  -     ‚Äî ,   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a> ,    . </p><br><h2 id="podgotovka-k-joker">   Joker </h2><br><p> <strong>:</strong>    Joker  .   ? </p><br><p> <strong>:</strong>  inline-,     . </p><br><p> <strong>:</strong>  ,    value-? </p><br><p> <strong>:</strong> ,       ,    .          .   ,    .   value   Java-   .    value,  value,   by value, -  by value,       value type.     ,         . </p><br><p>      .  ,   ,   ,  R√©mi Forax -        ,    inline-. ,   ,      Kotlin inline-   ,     value- Java,    . </p><br><p>      .         value-,     ,  , mvt (minimum value types),     LW 1.     LW 2 ‚Äî  ,         .  , ,        ,    .   ,      ,  , ,  performance-  ,   ,       ,   ,   . </p><br><p> <strong>:</strong>    ,               - -? </p><br><p> <strong>:</strong>  , -     .   , ,   ,   ,   invokedynamic  . </p><br><p> <strong>:</strong>  ,    , ,   ,  . </p><br><p> <strong>:</strong>    ,    ,    ,            .  ‚Äî ,   ,    .   ,     ? </p><br><p> <strong>:</strong>   , ,  ,    . </p><br><p> <strong>:</strong>  .    , ,   inline-       generic-     ,       inline-.        ,        . </p><br><p> <strong>:</strong>     ,  -    ? </p><br><p> <strong>:</strong>    :     inline- LW2   .    value-,     generic,       . </p><br><blockquote>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´   Java -?        Valhalla¬ª</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Joker</a> ,    - 25-26  2019 .  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463455/">https://habr.com/ru/post/pt463455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463439/index.html">Computador de controle Apollo de bordo: an√°lise por vareta e engenharia de mem√≥ria em v√°rios n√∫cleos costurados</a></li>
<li><a href="../pt463441/index.html">Sampler. Utilit√°rio do console para visualizar o resultado de qualquer comando do shell</a></li>
<li><a href="../pt463443/index.html">JMeter - Faca de Testador Su√≠√ßo (Parte 2)</a></li>
<li><a href="../pt463445/index.html">9 tipos de solu√ß√µes de software de colabora√ß√£o para gerenciar equipes √°geis</a></li>
<li><a href="../pt463447/index.html">Astra Linux 1.6 (Smolensk). O sistema est√° pronto para funcionar com usu√°rios comuns? Exemplos de muletas</a></li>
<li><a href="../pt463459/index.html">Erros ocultos com transi√ß√µes de elemento compartilhado</a></li>
<li><a href="../pt463461/index.html">O que √© e o que n√£o est√° no Go. Parte 1</a></li>
<li><a href="../pt463463/index.html">M√©todo para criar um efeito DRAG e DROP</a></li>
<li><a href="../pt463465/index.html">O livro ‚ÄúJavaScript expressivo. Programa√ß√£o web moderna. 3¬™ edi√ß√£o</a></li>
<li><a href="../pt463469/index.html">Gato de Schrodinger sem caixa: o problema do consenso em sistemas distribu√≠dos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>