<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏽 👨‍👩‍👧‍👦 👨🏼‍🤝‍👨🏻 Désactiver la console locale lors de l'utilisation de x11vnc 👨🏿‍✈️ 👨‍❤️‍💋‍👨 👩‍👩‍👧‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut tout le monde 

 Sur Internet, il existe de nombreux articles sur la façon de configurer une connexion à distance à une session Xorg existante v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Désactiver la console locale lors de l'utilisation de x11vnc</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469885/">  Salut tout le monde <br><br>  Sur Internet, il existe de nombreux articles sur la façon de configurer une connexion à distance à une session Xorg existante via x11vnc, mais je n'ai trouvé nulle part comment épingler le moniteur local et entrer de sorte que toute personne assise à côté de l'ordinateur distant ne voit pas ce que vous faites et non boutons enfoncés dans votre session.  Sous cat, ma façon de rendre x11vnc ressemble plus à la connexion à Windows via RDP. <br><a name="habracut"></a><br>  Donc, disons que vous savez déjà comment utiliser x11vnc, sinon, vous pouvez google ou lire par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  <b>Étant donné:</b> lancez x11nvc, connectez-vous avec le client, tout fonctionne, mais la console informatique locale est également disponible pour la visualisation et la saisie. <br><br>  <b>Nous voulons:</b> couper la console locale (moniteur + clavier + souris) pour que rien ne puisse être vu et saisi. <br><br><h3>  Nous avons réduit les moniteurs </h3><br>  La première chose qui m'est venue à l'esprit était de couper le moniteur via xrandr, par exemple comme ceci: <br><br><pre><code class="bash hljs">$ xrandr --output CRT1 --off</code> </pre> <br>  mais en même temps, l'environnement des fenêtres (j'ai KDE) commence à penser que le moniteur est vraiment éteint et commence à lancer des fenêtres et des panneaux, tout se déplace et devient triste. <br>  Il existe un moyen plus intéressant, qui consiste à mettre le moniteur en veille, vous pouvez le faire par exemple comme ceci: <br><br><pre> <code class="bash hljs">$ xset dpms force off</code> </pre> <br>  mais ici aussi, tout ne se passe pas bien.  Le système réveille le moniteur lors du premier événement.  La béquille la plus simple sous forme de cycle permet: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> xset dpms force off sleep .5 <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  Je ne pensais pas plus loin - c'était de la paresse, ça remplit son rôle - les moniteurs ne montrent rien, même si vous appuyez sur des boutons, remuez la souris, etc. <br><h3>  UPD: </h3>  Merci <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">amarao</a> pour une autre façon de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">passer</a> à une luminosité nulle: <br><pre> <code class="bash hljs">$ xrandr --output CRT1 --brightness 0</code> </pre> <br><br><h3>  Coupez l'entrée </h3><br>  Pour désactiver l'entrée, j'ai utilisé xinput.  Lorsqu'il est lancé sans paramètres, il affiche une liste d'appareils: <br><br><pre> <code class="bash hljs">$ xinput ⎡ Virtual core pointer id=2 [master pointer (3)] ⎜ ↳ Virtual core XTEST pointer id=4 [slave pointer (2)] ⎜ ↳ Logitech USB Laser Mouse id=9 [slave pointer (2)] ⎣ Virtual core keyboard id=3 [master keyboard (2)] ↳ Virtual core XTEST keyboard id=5 [slave keyboard (3)] ↳ Power Button id=6 [slave keyboard (3)] ↳ Power Button id=7 [slave keyboard (3)] ↳ Sleep Button id=8 [slave keyboard (3)] ↳ USB 2.0 Camera: HD 720P Webcam id=10 [slave keyboard (3)] ↳ HID 041e:30d3 id=11 [slave keyboard (3)] ↳ AT Translated Set 2 keyboard id=12 [slave keyboard (3)]</code> </pre> <br>  <b>Les</b> périphériques <b>virtuels de base ...</b> ne peuvent pas être désactivés - une erreur est générée, mais le reste peut être activé et désactivé, par exemple, comme ceci, vous pouvez rester sans souris pendant une minute: <br><br><pre> <code class="bash hljs">xinput <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> 9; sleep 60; xinput <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> 9</code> </pre> <br><h3>  Solution clé en main </h3><br>  Pour mon cas, j'ai fait un script qui s'exécute en session ssh.  Il supprime l'entrée locale et soulève le serveur x11vnc, et une fois le script terminé, tout revient comme il était.  En conséquence, trois scripts se sont révélés, les voici (mis à jour). <br><br>  <b>switch_local_console:</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh case $1 in 1|on) desired=1 ;; 0|off) desired=0 ;; *) echo "USAGE: $0 0|1|on|off" exit 1 ;; esac keyboards=`xinput | grep -v "XTEST" | grep "slave keyboard" | sed -re 's/^.*\sid=([0-9]+)\s.*$/\1/'` mouses=`xinput | grep -v "XTEST" | grep "slave pointer" | sed -re 's/^.*\sid=([0-9]+)\s.*$/\1/'` monitors=`xrandr | grep " connected" | sed -re 's/^(.+) connected.*$/\1/'` for device in $mouses do xinput --set-prop $device "Device Enabled" $desired done for device in $keyboards do xinput --set-prop $device "Device Enabled" $desired done for device in $monitors do xrandr --output $device --brightness $desired done</span></span></code> </pre><br><br>  <b>disable_local_console:</b> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh trap "switch_local_console 1" EXIT while : do switch_local_console 0 sleep 1 done</span></span></code> </pre> <br>  En fait, le script principal (j'ai deux moniteurs, je soulève un serveur commun et un pour chaque moniteur). <br><br>  <b>vnc_server:</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash [[ ":0" == "$DISPLAY" ]] &amp;&amp; echo "Should be run under ssh session" &amp;&amp; exit 1 export DISPLAY=:0 killall x11vnc rm -r /tmp/x11vnc mkdir -p /tmp/x11vnc/{5900,5901,5902} params="-fixscreen V=5 -forever -usepw -noxkb -noxdamage -repeat -nevershared" echo "Starting VNC servers" x11vnc -rfbport 5900 $params 2&gt;&amp;1 | tinylog -k 2 -r /tmp/x11vnc/5900 &amp; x11vnc -rfbport 5901 $params -clip 1920x1080+0+0 2&gt;&amp;1 | tinylog -k 2 -r /tmp/x11vnc/5901 &amp; x11vnc -rfbport 5902 $params -clip 1920x1080+1920+0 2&gt;&amp;1 | tinylog -k 2 -r /tmp/x11vnc/5902 &amp; echo "Waiting VNC servers" while [ `ps afx | grep -c "x11vnc -rfbport"` -ne "4" ] do sleep .5 done echo "Disabling local console" disable_local_console echo "Killing VNC servers" killall x11vnc</span></span></code> </pre> <br>  En fait, tout.  Nous allons par ssh, <b>exécutons vnc_server</b> alors qu'il est vivant, avons accès via vnc et la console locale éteinte. <br><br>  Merci de votre attention, les ajouts et améliorations sont les bienvenus. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469885/">https://habr.com/ru/post/fr469885/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469875/index.html">Comment protéger vos mots de passe en 2019</a></li>
<li><a href="../fr469877/index.html">Oh cette méthode de Newton</a></li>
<li><a href="../fr469879/index.html">Double VPN en un clic. Comment diviser facilement l'adresse IP d'un point d'entrée et de sortie</a></li>
<li><a href="../fr469881/index.html">Les trois premiers jours de la vie d'un billet sur Habré</a></li>
<li><a href="../fr469883/index.html">Est-il possible de programmer l'aléatoire?</a></li>
<li><a href="../fr469893/index.html">Maison avec des éléments de haute technologie pour un chat sans-abri</a></li>
<li><a href="../fr469901/index.html">Une brève histoire de la visualisation des données: de l'Antiquité au 17e siècle</a></li>
<li><a href="../fr469905/index.html">Perdre du quartz à Masstransit</a></li>
<li><a href="../fr469907/index.html">Localisation des applications en dix étapes</a></li>
<li><a href="../fr469911/index.html">DVR: les principales différences entre les appareils modernes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>