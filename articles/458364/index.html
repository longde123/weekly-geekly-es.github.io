<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí™üèΩ üê∏ üïë Casos de redes: c√≥mo Microsoft Azure ayuda a realizar un ataque de phishing üå¥ üëèüèª üë®üèø‚Äçü§ù‚Äçüë®üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Estamos publicando un art√≠culo siguiendo los pasos de nuestro desempe√±o en Fast Track OFFZONE-2019 con el informe "Ofertas de redes de pesca: c√≥mo Mic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Casos de redes: c√≥mo Microsoft Azure ayuda a realizar un ataque de phishing</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458364/">  Estamos publicando un art√≠culo siguiendo los pasos de nuestro desempe√±o en Fast Track OFFZONE-2019 con el informe "Ofertas de redes de pesca: c√≥mo Microsoft Azure ayuda a llevar a cabo un ataque de phishing". <br><br>  Cuando se realiza un ataque de phishing con la distribuci√≥n de archivos adjuntos maliciosos, el problema principal es evitar los filtros de spam en el servidor de correo de la v√≠ctima.  Muchas empresas tienen correo en la nube de Microsoft, por lo que realmente debe ser un gur√∫ de la lista de correo para que un archivo adjunto malicioso pase por alto los filtros de spam entrenados por Microsoft. <br><br>  Cuando llevamos a cabo RedTeam, intentamos usar los medios legales que usan los usuarios.  Por ejemplo, la presencia de un servicio VPN en la empresa nos ayuda a ingresar a la empresa con derechos de usuario y, al mismo tiempo, causar un m√≠nimo de sospecha (o ninguna causa). <br><br>  Hubo una idea para ver c√≥mo Microsoft puede ayudarnos.  Analizamos qu√© tipo de protecci√≥n proporciona Microsoft y decidimos ver qu√© tipo de bestia es esa Azure Information Protection. <br><a name="habracut"></a><br><h3>  Protecci√≥n de la informaci√≥n de Azure </h3><br>  En este estudio, consideraremos Azure Information Protection (AIP), una herramienta que le permite clasificar documentos de acuerdo con su grado de confidencialidad y restringir el acceso a ellos para diferentes usuarios de la organizaci√≥n. <br><br>  Es muy f√°cil de usar: el software se descarga, con la ayuda de los cuales se pueden establecer ciertos derechos para cada documento.  Las etiquetas y los niveles de privacidad est√°n configurados para cada empresa: el administrador tiene tales derechos y obligaciones.  De manera predeterminada, solo se crean 2 niveles: confidencial y altamente confidencial. <br><br><img src="https://habrastorage.org/webt/rx/3y/83/rx3y83hdtlaigtb2gyj8-7x8gjk.png"><br><br>  Tambi√©n es posible permitir el acceso a usuarios individuales y asignarles derechos para usar el documento.  Por ejemplo, si necesita un usuario espec√≠fico para poder cambiar nada en un documento, pero para recibir informaci√≥n, puede configurar el modo Visor espec√≠ficamente para √©l. <br><br><img src="https://habrastorage.org/webt/oj/ci/3b/ojci3b_7akd9_4414puo1jf0yjq.png"><br><br>  Azure Information Protection est√° integrado con Office365 y el usuario no necesita software adicional para abrir el documento y realizar las acciones permitidas con √©l (desde la lectura hasta las ediciones y todos los derechos del documento). <br><br>  Cuando se usa AIP no para Office365: el documento protegido tiene la extensi√≥n pfile y no es posible abrirlo sin el Visor de protecci√≥n de informaci√≥n de Azure. <br>  En general, la soluci√≥n parec√≠a interesante y decidimos realizar un estudio. <br><br>  Para la investigaci√≥n necesitamos: <br><br><ul><li>  elija y registre una cuenta Microsoft adecuada para nosotros </li><li>  registrar 2 empresas (atacante y v√≠ctima) </li><li>  crear un documento malicioso que enviaremos en un correo electr√≥nico de phishing </li></ul><br><h3>  Registro de cuenta de Microsoft </h3><br>  Para este estudio, elegimos una cuenta comercial de Microsoft porque tiene Azure Information Protection.  AIP tambi√©n est√° en otros planes de tarifas, se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  No describiremos en detalle qu√© dificultades tuvieron que encontrarse al registrar una cuenta.  Escribiremos brevemente: es imposible registrar una cuenta comercial por su cuenta desde Rusia.  Todo por sanciones.  Pero puede recurrir a socios (compa√±√≠as oficiales, hay 4 de ellos en Rusia) o registrarse en vacaciones desde Europa, habiendo comprado previamente una tarjeta SIM local all√≠. <br><br>  Registradas 2 empresas.  1 compa√±√≠a: la compa√±√≠a v√≠ctima MyMetalCompany con el dominio mymetalcompany.club y dos usuarios: Petr Petrov, Vasya Vasechkin.  La compa√±√≠a v√≠ctima no usa AIP. <br><br><img src="https://habrastorage.org/webt/y5/vn/sm/y5vnsmscgh6ujw-0aun3wwnwrts.png"><br><br>  2 compa√±√≠a - la compa√±√≠a atacante - Gem Company con un dominio est√°ndar de Microsoft - gemcompany.onmicrosoft.com y el √∫nico usuario - Evil User, que enviar√° correos electr√≥nicos de phishing a Petrov y Vasechkin. <br><br><img src="https://habrastorage.org/webt/qc/c1/hy/qcc1hygeifu80o-wgtvykdpr-10.png"><br><br>  Evil User realizar√° un experimento con un documento malicioso, que se clasifica como DDEDownloader, un documento con un enlace incorporado mediante el cual se descarga y se inicia el script de Power Shell en la l√≠nea de comandos.  Gem Company utiliza AIP. <br><br><h3>  Prueba </h3><br>  Recuerde que nuestro objetivo principal es hacer que el documento malicioso pase filtros de spam y llegue al usuario en la carpeta Bandeja de entrada. <br><br>  Lo primero que debe verificar es si un documento malicioso llega al usuario si lo enviamos en la llamada "forma limpia".  Enviaremos el documento que acaba de generar Evil User al compa√±ero Vasechkin. <br><br>  El resultado fue predecible: a Microsoft no le gust√≥ nuestra carta y decidi√≥ que Vasechkin no val√≠a la pena prestar tanta atenci√≥n a esa basura.  En realidad, la carta no lleg√≥ a Vasechkin. <br><br>  Intentaremos poner a trav√©s de Azure Information Protection que solo Vasechkin puede leer un documento en modo de lectura.  ¬øPor qu√© solo en modo lectura?  Porque es importante para nosotros que el usuario abra el documento, y qu√© acciones puede realizar con este documento es completamente indiferente.  Por lo tanto, el modo de lectura es suficiente.  Tenga en cuenta que no cambiamos nada en el documento.  Simplemente establecemos restricciones para trabajar con el documento.  Luego hay algo de magia con encriptaci√≥n, que organiza AIP, pero en este estudio no nos importa. <br><br><img src="https://habrastorage.org/webt/qx/ks/rl/qxksrlbqynti0r1_nddayqoqjfq.png"><br><br>  Enviaremos dicho documento a Petrov y Vasechkin.  Veamos qu√© pasar√° con cada uno de ellos.  Tenga en cuenta que Petrov generalmente no tiene derechos para trabajar con el documento. <br><br>  ¬°Lo primero a lo que debe prestar atenci√≥n es que el documento malicioso termin√≥ en las bandejas de entrada de Petrov y Vasechkin! <br><br>  Vasechkin abre con calma el documento con Microsoft Word.  No necesita ning√∫n software adicional. <br><br><img src="https://habrastorage.org/webt/v2/vl/dm/v2vldmd3njstqtb1vxgorpkjqw4.png"><br><br>  Vemos que el acceso es limitado, pero todos los contenidos del documento tambi√©n son visibles. <br><br>  Otro punto: un documento protegido por AIP solo se puede abrir en Word, es decir  no puede verlo en el modo de visualizaci√≥n en el cliente de correo o en algunos servicios en l√≠nea. <br><br>  La situaci√≥n de Petrov es todo lo contrario: no puede abrir el documento porque "no tiene documentos" (como dicen en una famosa caricatura). <br><br><img src="https://habrastorage.org/webt/53/ug/kg/53ugkgce8wfa0g6vgggxc2laahk.png"><br><br>  De las desventajas: puede ver la cuenta con la que protegieron el documento mediante AIP.  Esto puede proporcionar alg√∫n tipo de pista para BlueTeam al investigar el incidente.  De lo contrario, todo funciona de acuerdo con las reglas que establecemos. <br><br>  Genial, pero ¬øqu√© sucede si tratamos de poner solo los niveles de privacidad?  No necesitamos a nadie para poder abrir el documento; lo principal en este estudio es ingresar a la bandeja de entrada. <br><br>  Intentaron establecer el nivel confidencial de confidencialidad del documento: el documento se cort√≥ con un filtro de correo no deseado. <br><br>  Adem√°s, se pueden establecer restricciones en la carta.  Aparece un complemento en el cliente de Outlook, que le permite establecer restricciones en la carta, y √©stas (de acuerdo con la forma en que Microsoft escribe en la documentaci√≥n) se aplican a todo el contenido de la carta, incluidos los archivos adjuntos.  El complemento aparece si el usuario est√° usando AIP.  En nuestro caso, Evil User lo usa y tiene ese complemento. <br><br>  Intentaron poner la etiqueta Altamente confidencial en la carta con el archivo adjunto; la carta no entr√≥ en la bandeja de entrada. <br><br>  Entendemos que "para todos los usuarios" no debe establecerse, porque "todos los usuarios" tambi√©n incluyen cuentas de servicio que verifican las cartas entrantes en busca de malware. <br><br><h3>  Sistema de seguimiento </h3><br>  Una de las caracter√≠sticas interesantes de AIP es el sistema de seguimiento, que le permite determinar qui√©n, cu√°ndo y desde d√≥nde abri√≥ el documento o intent√≥ abrirlo. <br><br>  En este caso, vemos que Petrov intent√≥ abrir el documento, pero no tuvo √©xito.  Y Vasechkin abri√≥ el documento.  Cuando se realiza un ataque de phishing, un sistema de este tipo, solo la salvaci√≥n, no tiene que pensar en nada, inmediatamente vemos si el amigo que ha abierto es el archivo adjunto o no. <br><br><img src="https://habrastorage.org/webt/ii/ax/_f/iiax_fvdw_cvcr0mcrqtrltcwl8.png"><br><br>  Tambi√©n puede configurar el sistema de notificaci√≥n para que llegue un correo electr√≥nico cuando intente abrir un documento. <br><br><h3>  Conclusiones </h3><br>  El objetivo del estudio era evitar los filtros de spam de Microsoft utilizando el propio Microsoft (utilizando los medios de protecci√≥n ofrecidos por la empresa). <br><br><ul><li>  El objetivo se logr√≥ con √©xito con un comentario: debe usar AIP espec√≠ficamente para establecer derechos de acceso para usuarios espec√≠ficos.  Eludir otras caracter√≠sticas de seguridad (antivirus, sistemas de detecci√≥n de intrusos que se activan cuando se abre el documento (tomamos un documento deliberadamente malicioso que es detectado por todas las caracter√≠sticas de seguridad) depende de su imaginaci√≥n.  Solo buscamos letras en la bandeja de entrada. </li><li>  Azure Information Protection solo funciona para usuarios autorizados de Office365 (esta es la magia del cifrado).  En casi todas las organizaciones, los usuarios inician sesi√≥n en Office365 y no hay dificultades.  Pero considere que este hecho es necesario. </li><li>  El sistema de seguimiento es generalmente una cosa magn√≠fica y es conveniente y pr√°ctico usarlo. </li><li>  El uso de AIP para proteger documentos (por as√≠ decirlo para su prop√≥sito previsto) tambi√©n es genial y causar√° dolor de cabeza a los atacantes: el acceso a los documentos se vuelve m√°s dif√≠cil de obtener. </li></ul><br>  La presentaci√≥n desde la misma presentaci√≥n se puede encontrar en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . <br><br>  ¬°Gracias a los organizadores de OFFZONE por la conferencia!  Fue interesante! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458364/">https://habr.com/ru/post/458364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458352/index.html">[Peter] Reuni√≥n JUG.ru con Cliff Click - ¬øUna JVM hace eso?</a></li>
<li><a href="../458354/index.html">Introducci√≥n a la inversi√≥n desde cero utilizando IDA PRO</a></li>
<li><a href="../458356/index.html">Estudiamos el calendario</a></li>
<li><a href="../458358/index.html">La m√≠a sigue siendo legal: la experiencia de minar lightcoins en 2019</a></li>
<li><a href="../458362/index.html">Tabla de multiplicaci√≥n de una fila</a></li>
<li><a href="../458370/index.html">C√≥mo los resultados r√°pidos ayudaron a Ivan</a></li>
<li><a href="../458372/index.html">TestMace: un potente IDE para trabajar con API</a></li>
<li><a href="../458374/index.html">TJBOT como una ilustraci√≥n de los servicios de IBM Watson</a></li>
<li><a href="../458376/index.html">No es otro lenguaje de programaci√≥n. Parte 1: l√≥gica de dominio</a></li>
<li><a href="../458378/index.html">Usando Avocode para el dise√±o del sitio. Revisi√≥n para principiantes. Bonificaci√≥n: registre un per√≠odo de prueba de 30 d√≠as</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>