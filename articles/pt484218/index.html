<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÆ üßëüèΩ‚Äçü§ù‚Äçüßëüèª üëèüèΩ Otimizamos a automa√ß√£o: como aceleramos os autotestes em 3 a 4 vezes, preservando os desenvolvimentos antigos ü§ù üåè üèáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="S√£o necess√°rios testes autom√°ticos em projetos. Mas, como se costuma dizer, a automa√ß√£o no sabor e na cor pode ser diferente. Chegamos a um projeto em...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otimizamos a automa√ß√£o: como aceleramos os autotestes em 3 a 4 vezes, preservando os desenvolvimentos antigos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/maxilect/blog/484218/">  S√£o necess√°rios testes autom√°ticos em projetos.  Mas, como se costuma dizer, a automa√ß√£o no sabor e na cor pode ser diferente.  Chegamos a um projeto em que j√° havia autotestes e conseguimos melhorar a cobertura e acelerar a aprova√ß√£o de testes sem uma revolu√ß√£o fundamental.  Sob o gato sobre como n√≥s fizemos isso. <br><br><img src="https://habrastorage.org/webt/fw/47/hn/fw47hntzdwggi-vwvfy1xksgsk4.jpeg" alt="imagem"><br><a name="habracut"></a><br><h2>  Algumas palavras sobre o projeto </h2><br>  Embora n√£o possamos divulgar os detalhes do projeto devido √† NDA, em termos gerais, a tarefa foi a seguinte.  Ingressamos no desenvolvimento do servi√ßo API fintech, que interagiu com o banco de dados, retornando os objetos financeiros necess√°rios (pre√ßos, tarifas, etc.).  Nossa tarefa era testar clientes m√≥veis para esse servi√ßo - aplicativos m√≥veis da Web e nativos. <br><br>  A automa√ß√£o de testes neste projeto foi desenvolvida gradualmente, juntamente com a complexidade do servi√ßo.  Provavelmente, esse foi o per√≠odo de testes de ponta a ponta que apareceram ao mesmo tempo, que encontramos no projeto.  A maioria deles n√£o funcionou nessa √©poca, porque o servi√ßo havia mudado e n√£o havia ningu√©m para dar suporte aos testes - o √∫nico engenheiro de automa√ß√£o saiu do projeto muito antes de chegarmos. <br><br>  Mesmo os testes que parecem corresponder √† funcionalidade √†s vezes ca√≠am devido √† confus√£o com vers√µes ou inacessibilidade de recursos externos.  Para o teste, foi usada uma infraestrutura separada - bancos de teste, onde as vers√µes necess√°rias foram implantadas para experimentos.  Diferentes grupos de trabalho tiveram acesso a ele e nem sempre atuavam em conjunto.  Como resultado das a√ß√µes de um grupo, alguma API importante usada por nosso servi√ßo pode cair, por causa da qual at√© um teste de trabalho parou de passar.  I.e.  o teste n√£o mostrou mais a capacidade de manuten√ß√£o do pr√≥prio servi√ßo, mas relacionado √† infraestrutura de teste como um todo. <br><br><h2>  Como chegamos ao caos </h2><br>  Parece que nessa situa√ß√£o √© necess√°rio abandonar todas as conquistas antigas e construir os testes novamente.  Mas agimos mais "humanamente".  A estrutura de teste em si foi preservada, com foco na solu√ß√£o de problemas espec√≠ficos - passagem lenta dos testes, instabilidade e cobertura insuficiente dos casos de teste.  Para cada um deles havia uma solu√ß√£o. <br><br><h3>  Refatora√ß√£o </h3><br>  Primeiro, reformulamos parcialmente o c√≥digo de testes antigos, contando com padr√µes de design mais modernos. <br><br>  Parte do c√≥digo legado teve que ser removido - era muito dif√≠cil de manter.  Em outra parte, captamos todas as fraquezas - substitu√≠mos o sono padr√£o por gar√ßons normais, fizemos os preparativos para todos os testes na configura√ß√£o global por meio de anota√ß√µes dos participantes do teste, etc.  Muitas pequenas etapas reduziram a m√©dia do teste de ponta a ponta de 3-4 para 1-2 minutos. <br><br><h3>  Abordagem at√¥mica </h3><br>  Para acelerar a cria√ß√£o de novos testes e simplificar o suporte dos antigos, passamos de casos complexos de ponta a ponta. <br><br>  Pessoalmente, n√£o tenho nada contra os testes de ponta a ponta, no entanto, no caso em que voc√™ precisa verificar uma tela espec√≠fica (ou mesmo parte das informa√ß√µes nela), passar por todas as etapas, come√ßando com a autoriza√ß√£o do usu√°rio, √© muito caro.  Imagine que estamos testando uma loja on-line e precisamos verificar apenas o cheque que ser√° enviado ao comprador ap√≥s a compra de um determinado produto.  Em vez de buscar apenas uma tela do sistema, acess√°vamos login e senha, selecion√°vamos o produto, confirmamos a compra etc.  - executaria muitas etapas que n√£o est√£o relacionadas a uma tarefa de teste espec√≠fica.  Mas cada passo leva tempo.  Mesmo com toda a otimiza√ß√£o realizada, o lan√ßamento do teste de ponta a ponta levou at√© 2 minutos, enquanto a verifica√ß√£o de uma tela espec√≠fica levou apenas 10 segundos.  Portanto, sempre que poss√≠vel, passamos a tais verifica√ß√µes "at√¥micas", referindo-nos apenas √† tela que nos interessa como parte do caso de teste. <br><br>  Ao longo do caminho, apenas para compara√ß√£o de tela, implementamos o teste de instant√¢neo, que permite verificar a maior parte da interface do usu√°rio.  Tendo testes e c√≥digo do aplicativo em um reposit√≥rio, podemos usar os m√©todos desse aplicativo nos testes, ou seja,  levante todas as telas necess√°rias neste processo.  Assim, podemos encontrar erros na compara√ß√£o de capturas de tela de teste com refer√™ncias. <br><br>  Agora, temos cerca de 300 testes de captura instant√¢nea, e seu n√∫mero est√° aumentando gradualmente, pois essa abordagem pode reduzir significativamente o tempo necess√°rio para verificar a vers√£o final antes de envi√°-la para produ√ß√£o.  Todo esse conjunto de testes inicia automaticamente quando a solicita√ß√£o pull √© aberta e √© executada em 40 minutos - para que os desenvolvedores recebam rapidamente coment√°rios sobre os problemas na ramifica√ß√£o atual. <br><br>  Obviamente, v√°rios testes de ponta a ponta foram preservados.  Voc√™ n√£o pode ficar sem eles onde precisa verificar grandes cen√°rios de neg√≥cios, mas faz sentido execut√°-los quando todos os detalhes j√° tiverem sido verificados. <br><br><h3>  Zombando </h3><br>  Para excluir a influ√™ncia de uma bancada de teste inst√°vel no resultado do lan√ßamento de nossos testes, lan√ßamos um servidor simulado.  Sobre as decis√µes que consideramos e por que escolhemos o Okhttpmockwebserver, <a href="https://habr.com/ru/company/maxilect/blog/430530/">eu j√° escrevi no Habr√©</a> . <br><br>  Como resultado, a participa√ß√£o dos que ca√≠ram episodicamente devido a causas externas dos testes diminuiu significativamente. <br><br><h3>  Kotlin DSL </h3><br>  Paralelamente, tornamos os testes mais leg√≠veis. <br><br>  Os envolvidos no teste de interface do usu√°rio sabem o qu√£o dif√≠cil √© encontrar a verdade entre v√°rios localizadores no longo "cal√ßado" do teste (especialmente no est√°gio em que ainda eram testes de ponta a ponta).  √â f√°cil navegar neles quando voc√™ est√° em um projeto h√° dois anos e mesmo no meio da noite consegue se lembrar do que √© o qu√™.  Mas se voc√™ veio, mudar para o que est√° acontecendo √© uma grande tarefa separada.  Para que novas pessoas n√£o precisem lidar com isso todas as vezes, decidimos mudar para o Kotlin DSL.  √â implementado de maneira bastante simples e possui uma estrutura simples e compreens√≠vel.  Anteriormente, os testes consistiam em um conjunto de chamadas de baixo n√≠vel id√™nticas - cliques, entrada de texto, rolagens, mas agora tudo isso se transformou em algo mais "comercial" - algo como uma abordagem de BDD.  Tudo √© vis√≠vel e compreens√≠vel. <br><br>  Na minha opini√£o, isso nos fez uma certa reserva para o futuro.  Este projeto j√° enfrentou uma vez a partida de um √∫nico engenheiro de automa√ß√£o.  Para os testes, isso n√£o terminou da melhor maneira - eles simplesmente pararam de apoi√°-los, porque o limite de entrada ficou muito alto.  A compreens√£o de um c√≥digo t√£o seco exigia muito tempo e uma certa qualifica√ß√£o.  Redesenhamos os testes de forma que seja poss√≠vel transferir rapidamente pessoas de outros projetos ou de testes manuais para automa√ß√£o a qualquer momento.  Quase todo mundo pode escrever os testes mais simples no Kotlin DSL.  Portanto, a automa√ß√£o pode deixar a implementa√ß√£o de baixo n√≠vel e escrever rapidamente novos testes simples para conectar as pessoas da equipe funcional.  Eles t√™m conhecimento suficiente da l√≥gica de neg√≥cios e o projeto se beneficiar√° do fato de estarem mais envolvidos no processo de escrever autotestes.  O Kotlin DSL permite que voc√™ descreva os casos de teste exatamente como eles gostariam de ver todas as verifica√ß√µes, deixando a implementa√ß√£o de baixo n√≠vel de m√©todos fora do escopo de seu trabalho. <br><br>  Em geral, tudo isso tornou poss√≠vel aumentar a cobertura dos autotestes mais rapidamente.  Se antes demoravam 16 a 20 horas para implementar o novo conjunto de testes, a nova abordagem, dependendo da complexidade dos testes, levava de 4 a 12 horas (e os custos de m√£o-de-obra para suporte eram reduzidos de 16 a 24 para 8 a 12 horas). semana). <br><br>  Autor do artigo: Ruslan Abdulin. <br><br>  PS Publicamos nossos artigos em v√°rios sites do Runet.  Assine nossas p√°ginas no <a href="https://vk.com/maxilect">VK</a> , <a href="https://www.facebook.com/maxilectru/">FB</a> , <a href="https://www.instagram.com/maxilectteam/">Instagram</a> ou no <a href="https://t.me/maxilect">canal Telegram</a> para conhecer todas as nossas publica√ß√µes e outras not√≠cias do Maxilect. <br><br>  PPS Ajude-nos a tornar os artigos do nosso blog mais interessantes: <a href="https://docs.google.com/forms/d/e/1FAIpQLSeqnPceNuK-JopYVxgF15gNWLIi5oM_AZesioCDGXhvr7Y7tw/viewform">docs.google.com/forms/d/e/1FAIpQLSeqnPceNuK-JopYVxgF15gNWLIi5oM_AZesioCDGXhvr7Y7tw/viewform</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484218/">https://habr.com/ru/post/pt484218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484206/index.html">Uso de mixins no Dart</a></li>
<li><a href="../pt484208/index.html">Usando o aprendizado de m√°quina na an√°lise est√°tica do c√≥digo-fonte do programa</a></li>
<li><a href="../pt484212/index.html">Material gratuito para karma - a hist√≥ria de uma startup bielorrussa que muda o princ√≠pio do consumo</a></li>
<li><a href="../pt484214/index.html">Tensores em TensorFlow</a></li>
<li><a href="../pt484216/index.html">Segunda confer√™ncia Zabbix na R√∫ssia: inscri√ß√µes e datas importantes</a></li>
<li><a href="../pt484220/index.html">Voc√™ j√° encomendou a entrega? Como a Crossroads entrega 6.000 pedidos por dia</a></li>
<li><a href="../pt484222/index.html">Uma tentativa de resolver o problema de escolher bilhetes antes das f√©rias</a></li>
<li><a href="../pt484224/index.html">Classifica√ß√£o LSD bit a bit (classifica√ß√£o Radix)</a></li>
<li><a href="../pt484236/index.html">Fantasmas nas nuvens: detalhes de invadir muitas empresas</a></li>
<li><a href="../pt484238/index.html">O aprendizado de m√°quina enfrentou um problema de matem√°tica n√£o resolvido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>