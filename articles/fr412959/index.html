<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçñ üë©üèº‚Äç‚öïÔ∏è üöí A la question de l'AVR et des records du monde üìí üç∫ üÜô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Faites bien, √ßa va mal tourner 
 La raison de la publication √©tait r√©cente (lorsque j'ai commenc√© √† r√©diger cette publication, elle √©tait vraiment r√©c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A la question de l'AVR et des records du monde</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412959/"><h3>  Faites bien, √ßa va mal tourner </h3><br>  La raison de la publication √©tait r√©cente (lorsque j'ai commenc√© √† r√©diger cette publication, elle √©tait vraiment r√©cente, mais quelque chose a dur√© longtemps dans le dossier Unfinished) sur Habr√© concernant les aspects de la mise en ≈ìuvre du logiciel UART sur le MK d'AVR.  Les questions soulev√©es par elles-m√™mes ne sont pas sans int√©r√™t, mais des r√©ponses si √©tranges sont donn√©es qu'elles jugeaient de son devoir de faire les explications n√©cessaires.  Le sujet est marqu√©, ceux qui veulent lire sur ¬´les rois, le chou et les chaussures¬ª, c'est-√†-dire les exigences des normes, lire la documentation technique (correcte) et les enregistrements dans la programmation en langage assembleur pour AVR, peuvent cliquer sur le bouton ci-dessous. <br><a name="habracut"></a><br>  D√©crivons la question plus en d√©tail - est-il possible d'impl√©menter IRPS (le nom habituel de l'interface, au nom de UART), sur un AVR de type MK (sp√©cifiquement, c'√©tait Tiny13) lorsque vous travaillez √† partir d'un g√©n√©rateur interne.  Le fait est que ce g√©n√©rateur n'a pas de tr√®s bons indicateurs de la pr√©cision de r√©tention de fr√©quence, c'est pourquoi cette question se pose.  Je dois faire une r√©servation tout de suite que cela n'a pas d'importance si nous consid√©rons une impl√©mentation logicielle (comme sugg√©r√© dans le post original) ou si nous utilisons des blocs mat√©riels MK.  Les r√©sultats d'une m√©thode (en termes de param√®tres de pr√©cision dans le temps) sont presque enti√®rement traduits dans une autre. <br><br>  La question fondamentale est de savoir si le g√©n√©rateur interne peut fournir la pr√©cision de fonctionnement requise, car dans le cas d'une r√©ponse n√©gative √† cette question, d'autres √©tudes perdent leur sens.  Pour comparer les deux quantit√©s ind√©pendantes, nous devons conna√Ætre les deux, nous allons donc commencer par d√©terminer la pr√©cision requise du confinement de fr√©quence et les capacit√©s fournies par ce MK particulier dans cette partie.  Une remarque importante √† la phrase pr√©c√©dente - cela ne signifie pas un cas sp√©cifique, ¬´donn√© √† nous dans des sensations¬ª, mais un type sp√©cifique de MK, qui est pr√©sent√© par sa description technique. <br><br>  Pour commencer, nous trouverons quelque chose de plus facile √† trouver (enfin, je le pensais) - des exigences pour la pr√©cision des param√®tres temporels de l'interface.  Nous allons ouvrir la norme pour RS232 et voir tout ce dont vous avez besoin tout de suite.  Il s'est av√©r√© que "vous ne pouvez pas simplement le prendre et ..." car la norme est payante et toutes les copies sur le Web sont ill√©gales.  D'accord, nous apportons la version domestique de GOST au joint C2 et nous n'y trouvons aucun param√®tre de temps, √† l'exception de la dur√©e du front et de la coupure de l'impulsion.  Au d√©but, cela a provoqu√© une l√©g√®re vague - comme cela pourrait √™tre - mais ensuite, il est venu √† comprendre que le joint C2 ne d√©crit que la partie interface de l'IRPS et que les exigences devraient √™tre dans cette derni√®re.  En principe, tout est logique, on ne sait pas seulement pourquoi cela n'est pas explicitement d√©crit dans GOST, mais, en fin de compte, vous pouvez parfois penser par vous-m√™me, bien que cela ne soit toujours pas "bien obtenu". <br><br>  Bien s√ªr, connaissant le protocole de transmission, il est possible, √† partir de consid√©rations g√©n√©rales, de trouver le d√©calage maximal admissible entre les vitesses de l'√©metteur et du r√©cepteur (0,5 / 9,5 = 5,2%), mais ce sera une enqu√™te sur le cheval sph√©rique, vous savez o√π, car: <br><br><ol><li>  les exigences de la norme peuvent et doivent √™tre plus strictes qu'un calcul th√©orique similaire de l'inad√©quation maximale admissible; </li><li>  conna√Ætre le chiffre final de non-correspondance ne nous donnera en aucun cas le budget de l'√©metteur et du r√©cepteur. </li></ol><br>  L'errance sur Internet a conduit √† AppNote d'Atmel (enfin, puisque nous utilisons toujours le MK de cette soci√©t√©), qui parle explicitement d'un d√©calage admissible de 2% avec un budget √©gal, ce qui conduit √† l'exigence de pr√©cision du maintien de la fr√©quence d'√©mission de 1%.  Nous ferons confiance √† une entreprise r√©put√©e et supposerons qu'elle ait acc√®s √† des documents classifi√©s et ce chiffre est correct, d'autant plus qu'il semble plausible.  Je comprends la vuln√©rabilit√© d'un tel poste, mais pour √™tre honn√™te, je suis fatigu√© de chercher la r√©ponse exacte √† une question aussi simple, et j'ai h√¢te de passer √† la partie suivante. <br><br>  La moiti√© suivante de la r√©ponse se trouve √† l'int√©rieur du MK et est d√©termin√©e par la documentation technique correspondante.  D'abord, un peu sur le dispositif du g√©n√©rateur interne, d'autant plus qu'il est plus ou moins d√©crit.  Le g√©n√©rateur utilise une cha√Æne RC comme √©l√©ment de r√©glage de l'heure et, comme la t√¢che de former un condensateur int√©gr√© d'un condensateur exact et d'une r√©sistance exacte est tr√®s simple, la fr√©quence finale d'une instance √† l'autre du MK diff√©rera consid√©rablement.  Pour rendre ce param√®tre plus pr√©visible, les fabricants ont ajout√© un n≈ìud mat√©riel contr√¥l√© via un octet d'√©talonnage.  Cette unit√© vous permet de changer la fr√©quence du g√©n√©rateur sur une large plage et, par cons√©quent, d'obtenir la valeur souhait√©e avec une pr√©cision beaucoup plus √©lev√©e. <br><br>  Il serait int√©ressant de savoir exactement comment le contr√¥le est impl√©ment√© dans le mat√©riel, je vois une option soit avec le contr√¥le de la tension de charge du condensateur via le DAC ou le contr√¥le de la tension de comparaison sur le comparateur.  Ces deux options conduisent cependant √† une non-lin√©arit√© significative des caract√©ristiques de contr√¥le, bien qu'elles soient simples √† mettre en ≈ìuvre.  Mais √©tablir l'impl√©mentation interne du g√©n√©rateur ne fait pas partie de notre t√¢che, nous nous int√©ressons √† ses param√®tres externes. <br><br>  Nous ouvrons donc la documentation (vous pouvez ouvrir le fichier dans la visionneuse, mais j'ai une version typographique de la description imprim√©e par le fabricant lui-m√™me - oui, elle l'√©tait auparavant) et recherchons la section appropri√©e.  Les param√®tres qui nous int√©ressent se trouvent dans la section ¬´Oscillateur RC interne calibr√©¬ª, puis suivez les liens si n√©cessaire.  Et ici, nous (pour s√ªr, je ne suis pas s√ªr de vous) attendions la premi√®re d√©ception - je travaille avec les produits Atmel depuis longtemps (environ 15 ans) et j'ai toujours cru qu'ils avaient une bonne documentation pour MK.  Selon les psychiatres, ¬´il n'y a pas de personnes en bonne sant√©, il n'y a pas de personnes inexplor√©es¬ª et une √©tude approfondie de la section pertinente a confirm√© cette v√©rit√©, car je n'avais pas remarqu√© de tels √©checs dans la documentation auparavant.  Pour ma d√©fense, je peux seulement dire que: <br><br><ol><li>  Je n'ai jamais utilis√© de g√©n√©rateur interne dans les donn√©es MK, donc je ne l'ai pas √©tudi√© particuli√®rement attentivement; </li><li>  quand j'ai commenc√© √† travailler avec ces d√©put√©s (il y a bien plus de 10 ans), j'√©tais jeune (enfin, certainement plus jeune que maintenant) et stupide et je ne comprenais pas pleinement le besoin d'une bonne documentation (compr√©hensible, compl√®te et sans ambigu√Øt√©); </li><li>  Je suis pr√™t √† me pardonner beaucoup, tout simplement parce que je me pardonne beaucoup, et toutes mes lacunes ne sont pas fatales (le dernier argument est particuli√®rement convaincant, n'est-ce pas). </li></ol><br>  Donc, apr√®s avoir fini de m'√©pousseter la t√™te avec de la cendre, je vais commencer √† faire valoir mes pr√©tentions √† la documentation et il n'y a aucune excuse pour le fabricant.  Nous ouvrons la section ci-dessus et commen√ßons √† l'√©tudier attentivement, en allant aux pages n√©cessaires si n√©cessaire (vous cliquez toujours sur les liens).  Ensemble, nous rechercherons les param√®tres suivants caract√©risant les caract√©ristiques temporelles du g√©n√©rateur: pr√©cision nominale, influence de la tension d'alimentation, influence de la temp√©rature et param√®tres de vieillissement - il s'agit de l'ensemble minimal n√©cessaire pour √©valuer les param√®tres de pr√©cision de tout g√©n√©rateur. <br><br>  La premi√®re partie du ballet Marleson est la pr√©cision nominale. <br><br>  Nous trouvons imm√©diatement le param√®tre souhait√© - le tableau de pr√©cision de r√©glage du g√©n√©rateur, dans lequel nous voyons deux lignes ¬´Calibr√© en usine¬ª avec la valeur sp√©cifi√©e ¬± 10% et ¬´Calibrage manuel¬ª avec le m√™me param√®tre ¬± 2%. <br><br>  Concernant ces donn√©es, un certain nombre de questions se posent imm√©diatement - que signifient-elles et comment sont les mesures de ce param√®tre.  Pour la premi√®re ligne, le tableau indique la temp√©rature (de l'environnement ou du MK lui-m√™me - ce n'est pas clair, mais c'est un caprice de ma part) et la tension d'alimentation, en plus, la note dit (√† mon avis, ce n'est pas n√©cessaire) que cette mesure est effectu√©e √† un endroit sp√©cifique dans l'espace conditions ext√©rieures.  On peut supposer que dans ce cas, nous devrions utiliser le facteur d'√©talonnage enregistr√© chez le fabricant, bien qu'il serait pr√©f√©rable de l'indiquer explicitement dans la note.  Tout est plus ou moins clair et est interpr√©t√© presque sans ambigu√Øt√© (bien que dans le contexte de l'√©tude de la documentation technique, il faut dire que tout est flou et permet des variations dans les interpr√©tations, ce qui est inacceptable, mais si nous le faisons, le sujet de la discussion dispara√Æt simplement (et ce qui va suivre) √©crivez, il n'est pas clair, par cons√©quent, faites preuve d'indulgence). <br><br>  Mais avec la deuxi√®me ligne du bo√Ætier, c'est pire - les limites des changements de temp√©rature et de tension d'alimentation sont donn√©es et on fait valoir qu'en utilisant une sorte de proc√©dure d'√©talonnage magique, vous pouvez obtenir des r√©sultats nettement meilleurs que le r√©sultat d'usine dans toute la gamme.  Ma question se pose imm√©diatement - si cela peut √™tre r√©alis√© partout (√† n'importe quel point de la temp√©rature et de l'alimentation) et que le fabricant sait comment le faire, alors pourquoi ne l'a-t-elle pas fait elle-m√™me lors de l'√©talonnage en usine √† un moment pr√©cis des conditions?  Nous passons √† la description de l'octet d'√©talonnage et voyons qu'il prend 128 valeurs et cela couvre la plage de 50% √† 200% de la valeur nominale, ce qui correspond √† 150/128 ~ 1,17% du changement de fr√©quence par valeur d'√©talonnage unitaire, ce qui devrait donner la pr√©cision attendue mieux que dans 1%  Mais alors, nous devons tenir compte du fait que la caract√©ristique d'ajustement n'est clairement pas lin√©aire et dans la plage des grandes valeurs d'√©talonnage, nous avons 60% / 32 ~ 2% de l'√©tape (donn√©es tir√©es du graphique, j'ai exprim√© √† plusieurs reprises mon attitude envers une m√©thode similaire de repr√©sentation des param√®tres techniques, mais je le r√©p√®te - c'est inacceptable la m√©thode, bien que, bien s√ªr, est meilleure que rien), ce qui donne une pr√©cision de 1% et si nous tenons compte de la monotonie de la caract√©ristique d'ajustement (oui, c'est ce que dit la documentation, elle n'est pas dessin√©e dans le graphique, mais clairement indiqu√©e dans le texte. Je refuse cat√©goriquement de comprendre √†  , et surtout pourquoi, la compagnie voulait faire une loi d'ajustement, mais il a r√©ussi), qui est clairement indiqu√© dans les lignes directrices, il est n√©cessaire de tenir compte de la pr√©cision de 2% est tout √† fait r√©alisable.  Je n'aime pas vraiment que je doive regarder le graphique, mais ce n'est pas n√©cessaire et les donn√©es tabulaires sont suffisantes.  Dans cette partie, la documentation doit √™tre consid√©r√©e comme parfaitement compr√©hensible et coh√©rente, le crit√®re d'exactitude est en dehors de l'√©tendue de notre comp√©tence. <br><br>  La deuxi√®me partie du ballet Marlezon.  - l'influence des conditions ext√©rieures. <br><br>  Et puis commence ¬´les ordures, les fum√©es et la sodomie¬ª.  Au lieu de tableaux de valeurs, nous sommes invit√©s √† regarder des images (pour une raison quelconque, on les appelle des graphiques de valeurs typiques dans la documentation) et, comme vous le savez, "le principal avantage de la repr√©sentation graphique des informations est sa visibilit√©, et elle n'a pas d'autres avantages".  Il serait possible d'utiliser m√™me de telles informations et de supprimer les valeurs limites du graphique (¬´bien que cela soit offensant pour l'√©quipe¬ª) si ce graphique n'√©tait pas donn√© dans la section ¬´Caract√©ristiques typiques¬ª.  Je ne sais pas comment quelqu'un, personnellement, je suis profond√©ment convaincu que pour indiquer des significations typiques (ou typiques, je ne sais pas comment √™tre plus correct, dans un film, ils ont dit "apparence typique"), au moins sous la forme d'un graphique, m√™me dans le tableau, cela n'indique tout simplement rien.  Ils ne peuvent pas √™tre guid√©s dans la conception, car ces param√®tres ne sont pas clairs sur ce qu'ils signifient et tout √©cart par rapport aux valeurs typiques est acceptable, contrairement aux valeurs minimales et maximales, dont la transition indique un dysfonctionnement de l'appareil. <br><br>  Eh bien, nous sommes pass√©s, nous allons essayer d'extraire au moins quelques informations et voir que lorsque la temp√©rature passe de -40 √† + 80 ¬∞ , la fr√©quence du g√©n√©rateur change de ¬± 4%.  Une image similaire avec la tension d'alimentation - uniquement des graphiques typiques et l'erreur r√©sultante en -6 + 2% de 3,3 √† 5,5.  Les donn√©es sur le vieillissement du g√©n√©rateur ne sont tout simplement pas fournies, ce qui, en g√©n√©ral, est logique, car dans le contexte des param√®tres d√©j√† donn√©s, la pr√©cision d'un pour cent pendant 5 ans (une valeur caract√©ristique pour le silicium) ne d√©range personne. <br><br>  Nous avons maintenant toutes les donn√©es pour r√©pondre √† notre question initiale - lors de l'√©talonnage en usine, le g√©n√©rateur ne r√©pond pas aux exigences d'interface pour la pr√©cision, lorsqu'il est √©talonn√© pour des conditions d'application sp√©cifiques - il r√©pond aux exigences des limites, mais ne r√©pond pas √† la norme.  Il convient √©galement de tenir compte du fait que si l'√©talonnage de la tension d'alimentation et d'un MK sp√©cifique peut √™tre effectu√© dans la fabrication de l'appareil et esp√®re qu'ils ne changent pas dans le temps, la temp√©rature ne peut √™tre prise en compte qu'√† la vol√©e et n√©cessite une norme de temps externe d'une pr√©cision appropri√©e.  √âtant donn√© que le d√©veloppement d'appareils doit √™tre guid√© par la r√®gle `` nous croyons en Dieu, tout le reste n√©cessite une preuve '', et nous n'avons pas prouv√© la possibilit√© de r√©pondre aux exigences, la bonne r√©ponse est qu'il est impossible de garantir la mise en ≈ìuvre d'IRPS qui r√©pond aux exigences de la norme dans ce MC avec un g√©n√©rateur interne.  Notez que nous avons fait la conclusion ci-dessus lors de l'analyse de la documentation et l'avons formul√©e de mani√®re √† souligner que sur une instance sp√©cifique de MK, tout peut et se passera si les √©toiles montent avec succ√®s.  Autrement dit, notre conclusion contredit le post mentionn√© pr√©c√©demment, comment cela pourrait-il arriver, parce que tout fonctionne tr√®s bien pour une personne - essayons de le comprendre. <br><br>  Maintenant, la critique du poste ci-dessus va commencer.  Tout d'abord, r√©fl√©chissons √† la fa√ßon dont nous pouvons nous assurer que l'appareil est v√©rifi√© pour la conformit√© aux exigences d'une interface particuli√®re.  Je peux sugg√©rer les moyens suivants: <br><br><ol><li>  Un bon moyen est de mesurer les param√®tres critiques de l'interface de l'appareil et de les comparer avec les exigences de la norme - cela peut √™tre fait en utilisant des instruments universels (dans notre cas, l'oscilloscope et la longueur de l'intervalle de bits ou la transmission compl√®te), ou en utilisant un appareil sp√©cialis√© certifi√© pour tester cette interface. </li><li>  Moyen moyen - pour organiser l'interaction avec un autre appareil qui impl√©mente la partie r√©ponse de l'interface et qui a fait ses preuves (r√©pond aux exigences de la norme).  Bien s√ªr, un tel contr√¥le est compl√®tement insuffisant et peut plut√¥t √™tre appliqu√© davantage pour confirmer le dysfonctionnement de l'appareil test√©, mais fait au moins quelque chose. </li><li>  La mauvaise fa√ßon est d'impl√©menter ind√©pendamment la partie r√©ponse de l'interface (dans le m√™me appareil ou dans un autre) et d'interagir avec elle.  Les deux appareils n'√©tant √©videmment pas prouv√©s, l'utilit√© d'un tel contr√¥le est tr√®s, tr√®s douteuse.  Un bon exemple de cette approche est l '"√©cho" sur un canal s√©rie, qui ne prouve rien et ne rapporte gu√®re plus que rien sur la vitesse de l'appareil, en principe, n'est pas cass√© et est capable de transmettre quelque chose d'une mani√®re ou d'une autre. </li><li>  Une fa√ßon terrible est de prendre comme testeur un appareil qui ne r√©pond pas du tout aux exigences de la norme (ou plut√¥t, qui les contredit) et de fonctionner comme au paragraphe pr√©c√©dent. </li></ol><br>  C'est cette derni√®re m√©thode qui a √©t√© utilis√©e dans l'article √† l'√©tude - un r√©cepteur logiciel de canal s√©rie est mis en ≈ìuvre, qui, contrairement aux exigences de la norme, change de fr√©quence, s'adaptant au signal d'entr√©e (en particulier, la longueur du bit de d√©part), ce qui permet de recevoir de mani√®re stable un signal de mauvaise qualit√© en termes de param√®tres temporels.  Cela ne veut pas dire que cela ne devrait jamais √™tre fait, en outre, dans les modems analogiques, le r√©glage de la vitesse entrante a √©t√© adopt√©, qui a √©t√© mis en ≈ìuvre de la m√™me mani√®re, mais c'√©tait pr√©cis√©ment la commutation de la fr√©quence en changeant le diviseur, et ce n'est clairement pas notre cas.  Et c'est dans cette version que tout est parfaitement obtenu et que les informations sont transmises de mani√®re stable dans toutes les conditions ext√©rieures.  Par cons√©quent, si nous parlons de la possibilit√© de transmettre des informations entre deux MC fonctionnant √† partir de g√©n√©rateurs internes √† l'aide d'une interface qui rappelle √† distance l'IRPS, la r√©ponse est oui.  Si nous parlons d'interagir avec des appareils externes qui r√©pondent aux exigences de la norme et rien de plus, nous nous attendrons √† de nombreuses surprises d√©sagr√©ables. <br><br>  La conclusion g√©n√©rale de ce qui pr√©c√®de: <br><br><ol><li>  lors de la conception des appareils, vous devez vous concentrer sur la documentation (RTFM), </li><li>  vous devez √©tudier la documentation et interpr√©ter correctement ce que vous lisez (RTFMF), </li><li>  gardez √† l'esprit que dans notre temps la documentation peut √™tre des malentendus, des inexactitudes (et m√™me des erreurs), donc </li><li>  v√©rifier la coh√©rence et la cr√©dibilit√© des informations re√ßues, et </li><li>  utiliser les informations obtenues exp√©rimentalement uniquement pour confirmer les conclusions tir√©es de l'analyse de la documentation, </li><li>  choisir soigneusement les m√©thodes d'exp√©rimentation pour tester les √©quipements afin d'obtenir un r√©sultat fiable. </li></ol><br>  Eh bien, en conclusion, comme promis, un petit assembleur.  Je me suis permis de r√©√©crire l'extrait de code cit√© par l'auteur sous une forme normale, car l'assembleur int√©gr√© √† GCC n'est rien d'autre qu'une moquerie du programmeur, je peux nommer.  Non, bien s√ªr, je comprends que les d√©veloppeurs du compilateur ont √©t√© guid√©s par de bonnes raisons, mais le r√©sultat ressemble douloureusement √† la phrase ¬´eh bien, √ßa fonctionne¬ª. <br><br><pre><code class="hljs vhdl">.equ delay=<span class="hljs-number"><span class="hljs-number">15</span></span> TX_Byte: cli ; ld r18,Z+ ; cp r18,r1 ; breq Exit_Transmit ; dec r1 cbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>, TX_line Delay_TX: ldi r16,delay Do_Delay_TX: nop dec r16 brne Do_Delay_TX TX_Bit: sbrc r18,<span class="hljs-number"><span class="hljs-number">0</span></span> sbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>,TX_line sbrs r18,<span class="hljs-number"><span class="hljs-number">0</span></span> cbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>,TX_line lsr r18 lsr r17 brcs Delay_TX sbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>, TX_line ldi r16,delay Stop_Bit_TX: nop dec r16 brne Stop_Bit_TX Sei</code> </pre> <br>  Et imm√©diatement une erreur dans le programme attire votre attention - √† la ligne 3 (comment√©e), la valeur du registre 1 doit √™tre nulle, mais l'affectation n'est pas explicitement √©crite dans la fonction.  Apr√®s un cycle de transfert d'un seul octet, cette valeur est garantie par la ligne 12, mais pas lors du premier passage.  Par cons√©quent, l'initialisation doit √™tre ajout√©e, ce qui n√©cessitera une augmentation de la taille du code. <br><br>  Le deuxi√®me inconv√©nient est la formation r√©elle du niveau dans les lignes 4 √† 7, car la m√©thode adopt√©e par l'auteur pour √©mettre le bit suivant entra√Ænera une gigue avant pendant 2 cycles d'horloge √† diff√©rentes transitions (0-1 et 1-0), ce qui entra√Ænera une augmentation des exigences de pr√©cision de maintien de la fr√©quence.  Non pas que cela donnerait une tr√®s forte influence, mais si vous pouvez corriger un d√©faut sans √©tendre le programme, alors pourquoi pas - voir l'√©pigraphe.  La version originale a pris 4 mots et a √©t√© r√©alis√©e en 4 mesures, la nouvelle a pris 4 mots et a √©t√© r√©alis√©e dans les m√™mes 4 mesures.  Oui, la version corrig√©e n√©cessite une √©tude plus approfondie de l'architecture MK, mais qui a dit que ce serait facile.  En revanche, dans la premi√®re version, la modification du port est atomique, et dans la seconde elle ne l'est pas, dans ce cas cela n'a pas d'importance (nous avons explicitement interdit les interruptions), mais le s√©diment reste.  Si le MK en question avait un vrai processeur de bits, comme dans l'architecture 51, alors nous pourrions √©crire un fragment id√©al combinant tous les avantages des deux approches (et m√™me √™tre un peu plus court), mais que pouvons-nous r√™ver d'un r√™ve de pipe ... <br><br>  Le troisi√®me inconv√©nient est la question de plus de style.  J'ai exprim√© √† plusieurs reprises mon attitude envers les constantes magiques que nous voyons dans le pr√©ambule de ce programme.  J'insiste encore une fois - du fait que l'auteur fixe une constante dans le pr√©ambule du programme, et non directement dans l'op√©rateur, la ¬´magie de rue ordinaire¬ª ne va nulle part.  Le fait est que nous devons explicitement pr√©senter au lecteur la m√©thode de formation d'une valeur sp√©cifique, et non cr√©er un synonyme de la valeur obtenue de mani√®re inconnue.  Vous pouvez, bien s√ªr, √©crire un commentaire sur une ligne avec une valeur dans laquelle sp√©cifier la formule de calcul, mais il est pr√©f√©rable d'utiliser explicitement la formule de calcul pour former la constante et alors vous n'avez tout simplement pas besoin d'un commentaire (bien s√ªr, avec les noms parlants des constantes appliqu√©es).  Cela se fait dans le texte ci-dessous, et notez que nous ne convertissons en entier qu'au dernier moment et arrondissons correctement, ce qui nous permet de ne pas perdre la pr√©cision du r√©sultat. <br><br>  Il y a une autre erreur - la longueur du bit de d√©part est quelque peu diff√©rente de l'intervalle de bits pour les donn√©es.  Bien que l'√©cart ne soit pas trop important (3 cycles d'horloge), n√©anmoins, √† des d√©bits binaires √©lev√©s, o√π l'intervalle binaire dure environ 90 cycles d'horloge, il s'agit d√©j√† d'une erreur de quelques pour cent, ce qui est inacceptable.  Cette erreur peut √™tre facilement corrig√©e en ajoutant des commandes pour g√©n√©rer un retard suppl√©mentaire, mais cela augmentera la longueur du programme, de sorte que nous corrigeons simplement sa pr√©sence et que nous nous assurons ensuite que l'architecture correcte du programme (c'est-√†-dire que m√™me ce court terme s'applique √† ce concept) √©limine automatiquement. <br><br>  Eh bien, maintenant que nous avons corrig√© les erreurs (sauf la derni√®re), nous allons essayer d'am√©liorer le programme dans le sens du crit√®re principal (pour atteindre un record, dans ce cas particulier) - la longueur du code.  La premi√®re chose qui attire votre attention est la pr√©sence de deux retards, ce qui est mauvais car il viole le principe DRY (exigence g√©n√©rale) et augmente la taille du code (exigence sp√©cifique).  Il serait possible d'organiser ce fragment sous la forme d'un sous-programme et nous gagnerions toujours en longueur, car nous ajoutons 3 mots de code (1 pour chaque appel √† deux endroits et 1 pour le retour), et nous en √©conomisons 4, mais il y a une mani√®re beaucoup plus belle - soign√©e l'organisation du cycle de transmission d'octets, que l'on peut voir dans le texte suivant. <br><br><pre> <code class="hljs vhdl">.equ delay=<span class="hljs-number"><span class="hljs-number">15</span></span> TX_Byte: cli sec ;   - clt ;  - TransBit: ;    <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r17,<span class="hljs-keyword"><span class="hljs-keyword">port</span></span> bld r17,Tx_line <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>,r17 Delay_TX: ;     ldi r17,delay Do_Delay_TX: nop dec r17 brne Do_Delay_TX TX_Bit: bst r16,<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ror</span></span> r16 clc brne TransBit ;    brcs TransBit ;  - Exit_Transmit: Sei</code> </pre><br>  Notez comment nous utilisons l'octet transmis avec le bit de retenue comme compteur de bits, une belle solution, mais elle a un inconv√©nient - la dur√©e du dernier bit de donn√©es sera plusieurs (2 cycles) plus longue que les autres, en raison du retard dans la transition.  Si nous parlions d'un bit d'arr√™t, alors "ne vous en souciez pas et oubliez", car nous n'avons pas re√ßu l'intervalle minimum entre les transferts, mais c'est un bit significatif, et nous venons de critiquer le programme d'origine pour un tel comportement.  Nous ne serons pas compar√©s au caract√®re biblique de la parabole de la paille aux yeux des autres et prendrons des mesures pour l'√©liminer.  Ce ph√©nom√®ne pourrait facilement √™tre compens√© en introduisant un retard de 2 mesures, mais la longueur du code augmentera, et c'est un param√®tre cl√©.  Par cons√©quent, passons √† la m√©thode classique et modifions l'heure de la m√©moire - nous utilisons un registre s√©par√© pour organiser le compteur des bits transmis, et nous obtenons exactement les m√™mes intervalles de bits avec la m√™me taille de code. <br><br>  L'am√©lioration suivante est associ√©e √† la formation de la dur√©e de l'intervalle de bits, qui dans le programme d'origine est effectu√©e sur un cycle de 4 cycles.  Si nous le faisons √† 3 heures (le plus petit possible dans ce MK), nous pouvons √©conomiser un octet de code et potentiellement am√©liorer les param√®tres de pr√©cision, car la discr√©tion du retard deviendra moindre (l'√©cart ne d√©passe pas la moiti√© de la taille du discret avec un arrondi appropri√©).  Mais il ne faut pas oublier que dans un cas particulier, nous pouvons perdre la pr√©cision, tout d√©pend des donn√©es source.  Une autre circonstance qui pourrait affecter le choix d'une telle dur√©e de cycle - la taille de retard maximale pour un compteur d'octets est de 256 valeurs - pour l'option disponible, vous pouvez utiliser des vitesses de 9600 bauds et plus, mais avec un retard de 3 cycles, ce n'est pas possible.  Il serait tr√®s agr√©able de refl√©ter cette circonstance (la vitesse minimale autoris√©e du port) dans les commentaires du programme et en m√™me temps d'afficher un message d'avertissement en cas de violation de cette exigence.  Eh bien, apportez les modifications appropri√©es aux macros de formation des param√®tres pour former un retard, sans oublier d'utiliser des noms "parlants" pour indiquer les variables. <br><br><pre> <code class="hljs dos">.<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> Freq = <span class="hljs-number"><span class="hljs-number">8000000</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> BaudRate = <span class="hljs-number"><span class="hljs-number">115200</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> PayLoad = <span class="hljs-number"><span class="hljs-number">9</span></span> ;     .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> CycleTime = <span class="hljs-number"><span class="hljs-number">3</span></span> ;    .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> delay=((Freq*<span class="hljs-number"><span class="hljs-number">2</span></span>/BaudRate - PayLoad*<span class="hljs-number"><span class="hljs-number">2</span></span>)+CycleTime)/(CycleTime*<span class="hljs-number"><span class="hljs-number">2</span></span>) TX_Byte: cli ldi r18,<span class="hljs-number"><span class="hljs-number">10</span></span> sec ;   - clt ;  - TransBit: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r17,port bld r17,Tx_line out port,r17 Delay_TX: ldi r17,delay Do_Delay_TX: dec r17 brne Do_Delay_TX TX_Bit: bst r16,<span class="hljs-number"><span class="hljs-number">0</span></span> ror r16 dec r18 brne TransBit Exit_Transmit: sei</code> </pre><br>  Examinons maintenant le r√©sultat - la taille du code a diminu√© de 20 √† 16 mots (si nous ne prenons en compte que la transmission elle-m√™me, puis de mani√®re encore plus frappante - de 18 √† 14, la gigue des fronts a disparu (bien s√ªr, seul le composant de gigue, qui est caus√© par les fonctionnalit√©s du programme, sur le composant mat√©riel, nous nous ne contrevenons pas), la pr√©cision du maintien des intervalles de temps s'est am√©lior√©e, le programme est devenu plus visible et plus facile √† comprendre (gr√¢ce aux commentaires, car m√™me un programme d'assemblage bien √©crit n'est g√©n√©ralement pas auto-document√©). <br><br>  La conclusion de la derni√®re partie est que si nous voulons √©tablir des records du monde dans la programmation en langage assembleur, nous devons √©tudier l'architecture d'un MK particulier tr√®s en profondeur et appliquer les connaissances obtenues pour obtenir le r√©sultat id√©al, en faisant attention √† toutes les subtilit√©s. <br><br>  Eh bien et en conclusion - la t√¢che d'√©crire du code de la taille minimale semble de nos jours quelque peu artificielle, mais, de mani√®re tout √† fait inattendue, re√ßoit la confirmation de sa vitalit√©.  √Ä la fin de l'ann√©e derni√®re (2016, c'est depuis combien de temps cet article attend son tour), un nouveau MK de la famille MSP430 a √©t√© annonc√©, qui avec le prix exceptionnellement bas (26 cents - nous attendons l'apparition d'appareils chinois bas√©s sur lui) a √©galement une taille de m√©moire de programme exceptionnellement petite - 512 octet (non, je ne me suis pas tromp√©, la lettre "k" imm√©diatement apr√®s le num√©ro ne l'est pas).  La taille du code peut donc s'av√©rer critique lors de l'utilisation de cet appareil, et l'√©criture de tels programmes extr√™mes n√©cessite g√©n√©ralement une √©tude approfondie de MK et "le travail en lui-m√™me est une b√©n√©diction". </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412959/">https://habr.com/ru/post/fr412959/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412949/index.html">Les astrologues annoncent une semaine de d√©veloppement iOS dans Avito</a></li>
<li><a href="../fr412951/index.html">DotVVM - Communication entre client et serveur</a></li>
<li><a href="../fr412953/index.html">√âtalonnage de la cam√©ra Intel RealSense d435 √† l'aide d'OpenCV2 et de ROS</a></li>
<li><a href="../fr412955/index.html">Tests d'interface utilisateur dans Xcode avec Embassy et Succulent</a></li>
<li><a href="../fr412957/index.html">Mi Band 4 et Mi Band 5: l'avenir des bracelets intelligents Xiaomi</a></li>
<li><a href="../fr412961/index.html">Partage de l'√©conomie dans les t√©l√©communications</a></li>
<li><a href="../fr412963/index.html">Nouveau Fallout: que sait-on du Vault 76?</a></li>
<li><a href="../fr412967/index.html">Faire un joli widget de r√©glage de la luminosit√©</a></li>
<li><a href="../fr412969/index.html">Des syst√®mes de reconnaissance faciale apparaissent dans les √©coles am√©ricaines, mais leur efficacit√© est remise en question</a></li>
<li><a href="../fr412971/index.html">Cr√©ation d'une application de coloration sur Unity3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>