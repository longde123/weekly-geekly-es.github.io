<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–•ğŸ¼ âœˆï¸ ğŸ¤” èŒ¶å£¶æä¾›çš„Android Camera2 APIï¼Œç¬¬3éƒ¨åˆ†ã€‚åª’ä½“ç¼–è§£ç å™¨å’ŒUDPæµè§†é¢‘ ğŸš¸ ğŸ¥… ğŸš£ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ç‚¹æƒ³å‡ºäº†å¦‚ä½•ä½¿ç”¨Camera2 APIæ‹ç…§å’Œå½•åˆ¶è§†é¢‘ã€‚ å‰©ä¸‹çš„åªæ˜¯å­¦ä¹ å¦‚ä½•å°†è§†é¢‘æµä»Androidè®¾å¤‡ä¼ è¾“åˆ°å¤–éƒ¨å—è‹¦çš„æ¥æ”¶è€…ã€‚ æ­£å¦‚ä¹‹å‰åå¤æåˆ°çš„ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯æœºå™¨äººçš„æ™ºèƒ½åŒ–-æˆ‘ä»¬åœ¨ä¸Šé¢å®‰è£…äº†æ™ºèƒ½æ‰‹æœºï¼Œå¯ä»¥è¯´ï¼Œå°†çŒ´å­å˜æˆäº†äººã€‚ åª’ä½“ç¼–è§£ç å™¨å°†ä¸ºæ­¤æä¾›å¸®åŠ©ã€‚ å½“ç„¶è¿˜æœ‰æ–°çš„Camera2 AP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>èŒ¶å£¶æä¾›çš„Android Camera2 APIï¼Œç¬¬3éƒ¨åˆ†ã€‚åª’ä½“ç¼–è§£ç å™¨å’ŒUDPæµè§†é¢‘</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473036/">å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ç‚¹æƒ³å‡ºäº†å¦‚ä½•ä½¿ç”¨Camera2 APIæ‹ç…§å’Œå½•åˆ¶è§†é¢‘ã€‚ å‰©ä¸‹çš„åªæ˜¯å­¦ä¹ å¦‚ä½•å°†è§†é¢‘æµä»Androidè®¾å¤‡ä¼ è¾“åˆ°å¤–éƒ¨å—è‹¦çš„æ¥æ”¶è€…ã€‚ æ­£å¦‚ä¹‹å‰åå¤æåˆ°çš„ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯æœºå™¨äººçš„æ™ºèƒ½åŒ–-æˆ‘ä»¬åœ¨ä¸Šé¢å®‰è£…äº†æ™ºèƒ½æ‰‹æœºï¼Œå¯ä»¥è¯´ï¼Œå°†çŒ´å­å˜æˆäº†äººã€‚ åª’ä½“ç¼–è§£ç å™¨å°†ä¸ºæ­¤æä¾›å¸®åŠ©ã€‚ å½“ç„¶è¿˜æœ‰æ–°çš„Camera2 APIã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sa/tl/mf/satlmfdhbe-ow-gywoc5-tuxupe.jpeg"></div><br> è°åœ¨ä¹ï¼Œè¯·åœ¨çŒ«ä¸‹ã€‚ <br><a name="habracut"></a><br> æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>æ‰¾åˆ°æœ‰å…³æœºå™¨äººé¡¹ç›®çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†å°±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç›®å‰è€Œè¨€</a> ï¼Œæˆ‘ä»¬å°†ç›´æ¥å°†è§†é¢‘ï¼ˆæˆ–ä¸å…¶è¿æ¥çš„Androidæ™ºèƒ½æ‰‹æœºï¼‰æµå¼ä¼ è¾“åˆ°ä¸ªäººç”µå­è®¡ç®—æœºã€‚ <br><br><h4> ä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼Ÿ </h4><br> å¦‚æ‚¨æ‰€çŸ¥ï¼Œä¸ºäº†å°†è§†é¢‘æµä»æ™ºèƒ½æ‰‹æœºå±å¹•ä¼ è¾“åˆ°å…¶ä»–åœ°æ–¹ï¼Œé¦–å…ˆéœ€è¦å°†å…¶ï¼ˆæµï¼‰è½¬æ¢ä¸ºåˆé€‚çš„å‹ç¼©æ ¼å¼ï¼ˆå®ƒå¤ªåšï¼Œæ— æ³•é€å¸§ä¼ è¾“ï¼‰ï¼Œè®¾ç½®æ—¶é—´æˆ³ï¼ˆæ—¶é—´æˆ³ï¼‰å¹¶ä»¥äºŒè¿›åˆ¶å½¢å¼å‘é€ç»™æ¥æ”¶è€…ã€‚ å®ƒå°†æ‰§è¡Œé€†è§£ç æ“ä½œã€‚ <br><br> ä»2013å¹´Android 4.3å‘è¡Œä¹‹æ—¥èµ·ï¼ŒMedia Codecç±»å°±ä¸€ç›´åœ¨å¤„ç†è¿™äº›ä½çº§çš„é»‘æ‰‹å…šã€‚ <br><br><img src="https://habrastorage.org/webt/ci/oz/xq/ciozxqlqwq8hecadsrkn0-8me6m.png"><br><br> å¦ä¸€ä»¶äº‹æ˜¯ï¼Œä¸ä»Šå¤©ä¸åŒçš„æ˜¯ï¼Œè¾ƒæ—©é‡‡ç”¨è§†é¢‘ç¼–ç å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚ ä¸ºäº†ä»ç›¸æœºä¸Šè·å–å›¾ç‰‡ï¼Œæœ‰å¿…è¦ä½¿ç”¨å¤§é‡çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¥ç§˜å¯†ç </a> ï¼Œå…¶ä¸­å”¯ä¸€çš„é”™è¯¯å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºå½»åº•å´©æºƒï¼Œå°±åƒYakutè¨æ»¡å·«å¸ˆçš„å’’è¯­ä¸€æ ·ã€‚ å†åŠ ä¸Šä»¥å‰çš„Camera APIï¼Œæ‚¨å¿…é¡»è‡ªå·±ç¼–å†™ä¸åŒçš„åŒæ­¥ç¬”ï¼Œè€Œä¸æ˜¯ç°æˆçš„å›è°ƒï¼Œå¹¶ä¸”æ­¤æ´»åŠ¨ä¸é€‚åˆèƒ†å°çš„äººã€‚ <br><br> æœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨ä»è¿œå¤„çœ‹å·¥ä½œ<a href="">ä»£ç ï¼Œ</a>ä»æ€»ä½“ä¸Šçœ‹ï¼Œä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆæ¸…æ¥šã€‚ æ‚¨å¼€å§‹å°†é›¶ä»¶è½¬ç§»åˆ°æ‚¨çš„é¡¹ç›®ä¸­-ç›®å‰å°šä¸æ¸…æ¥šä¸ºä»€ä¹ˆè¦æµ‡ç­‘å®ƒã€‚ ä½†æ˜¯ï¼Œç”±äºéš¾ä»¥ç†è§£ç»†èŠ‚ï¼Œå› æ­¤æ— æ³•çº æ­£ã€‚ <br><br> æ˜¯çš„ï¼Œå¹¶ä¸”ä»å›ºä½“ä¸­ä»¥æŸç§æ–¹å¼è½»æ¾<s>è¿‡æ—¶</s> ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œä¸€å›¢ç³Ÿ <br><br> å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºé‚£äº›æœºæ™ºçš„äººï¼ŒGoogleå»ºè®¾è€…å·²ç»å¼•å…¥äº†<b>Surface</b>çš„ç¥å¥‡æ¦‚å¿µï¼Œé€šè¿‡å®ƒå¯ä»¥é¿å…å‡ºç°åº•å±‚ç»†èŠ‚ã€‚ ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»˜å‡ºäº†ä»€ä¹ˆä»£ä»·ï¼Œå´è¾“äº†ä»€ä¹ˆé’±ï¼Œè¿™å¯¹æˆ‘æ¥è¯´æ˜¯å¾ˆéš¾ç†è§£çš„ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å‡ ä¹å¯ä»¥ç›´è¨€ä¸è®³åœ°è¯´ï¼šâ€œ Androidï¼Œå°†è¿™ä¸ªSurfaceæ‘„åƒå¤´çš„è§†é¢‘æ˜¾ç¤ºåœ¨æ­¤Surfaceä¸Šï¼Œè€Œæ— éœ€æ›´æ”¹å…¶ä¸­çš„ä»»ä½•ä»£ç å¹¶ç»§ç»­å‘é€ã€‚â€ æœ€ä»¤äººæƒŠå¥‡çš„æ˜¯ï¼Œå®ƒæœ‰æ•ˆã€‚ æœ‰äº†æ–°çš„Camera2 APIï¼Œç¨‹åºæœ¬èº«å°±çŸ¥é“ä½•æ—¶å‘é€æ•°æ®ï¼Œå‡ºç°äº†æ–°çš„å›è°ƒï¼ <br><br> æ‰€ä»¥ç°åœ¨è¦ç¼–ç è§†é¢‘-éšåœ°åç—°ã€‚ æˆ‘ä»¬ç°åœ¨è¦åšä»€ä¹ˆã€‚ <br> æˆ‘ä»¬ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­</a>è·å–ä»£ç ï¼Œå¹¶ä¸”åƒå¾€å¸¸ä¸€æ ·ï¼Œå°†æ‰€æœ‰å†…å®¹æ‰”æ‰ï¼Œé™¤äº†æŒ‰é’®å’Œç›¸æœºåˆå§‹åŒ–å¤–ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">è®©æˆ‘ä»¬ä»åº”ç”¨ç¨‹åºçš„å¸ƒå±€å¼€å§‹ã€‚</b> <div class="spoiler_text"><pre><code class="java hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span> xmlns:app=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span> xmlns:tools=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/tools"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> tools:context=<span class="hljs-string"><span class="hljs-string">".MainActivity"</span></span>&gt; &lt;TextureView android:id=<span class="hljs-string"><span class="hljs-string">"@+id/textureView"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"356dp"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"410dp"</span></span> android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"32dp"</span></span> app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintHorizontal_bias=<span class="hljs-string"><span class="hljs-string">"0.49"</span></span> app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintTop_toTopOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> /&gt; &lt;LinearLayout android:layout_width=<span class="hljs-string"><span class="hljs-string">"292dp"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"145dp"</span></span> android:layout_marginStart=<span class="hljs-string"><span class="hljs-string">"16dp"</span></span> android:orientation=<span class="hljs-string"><span class="hljs-string">"vertical"</span></span> app:layout_constraintBottom_toBottomOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintTop_toBottomOf=<span class="hljs-string"><span class="hljs-string">"@+id/textureView"</span></span> app:layout_constraintVertical_bias=<span class="hljs-string"><span class="hljs-string">"0.537"</span></span>&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button1"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">"   "</span></span> /&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button2"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button3"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;/LinearLayout&gt; &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</code> </pre> <br></div></div><br><h4> å¹¶ä»¥Media CodecæŒ‚é’©ç»“æŸ </h4><br> åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åœ¨Surfaceä¸Šæ˜¾ç¤ºäº†æ¥è‡ªæ‘„åƒå¤´çš„å›¾åƒï¼Œå¹¶ä½¿ç”¨MediaRecorderç¼–å†™äº†è§†é¢‘ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬åªéœ€åœ¨â€œæ›²é¢â€åˆ—è¡¨ä¸­æŒ‡å®šä¸¤ä¸ªç»„ä»¶ã€‚ <br><br><pre> <code class="java hljs">(Arrays.asList(surface, mMediaRecorder.getSurface()).</code> </pre><br> è¿™æ˜¯åŒä¸€ä»¶äº‹ï¼Œæˆ‘ä»¬åªæŒ‡å®šmMediaRecorderè€Œä¸æ˜¯ï¼š <br><br><pre> <code class="java hljs">(Arrays.asList(surface, mEncoderSurface),</code> </pre><br> åŸæ¥æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startCameraPreviewSession</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SurfaceTexture texture = mImageView.getSurfaceTexture(); texture.setDefaultBufferSize(<span class="hljs-number"><span class="hljs-number">320</span></span>, <span class="hljs-number"><span class="hljs-number">240</span></span>); surface = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Surface(texture); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); mPreviewBuilder.addTarget(surface); mPreviewBuilder.addTarget(mEncoderSurface); mCameraDevice.createCaptureSession(Arrays.asList(surface, mEncoderSurface), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraCaptureSession.StateCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConfigured</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraCaptureSession session)</span></span></span><span class="hljs-function"> </span></span>{ mSession = session; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mSession.setRepeatingRequest(mPreviewBuilder.build(), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, mBackgroundHandler); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (CameraAccessException e) { e.printStackTrace(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConfigureFailed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraCaptureSession session)</span></span></span><span class="hljs-function"> </span></span>{ } }, mBackgroundHandler); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (CameraAccessException e) { e.printStackTrace(); } }</code> </pre><br> ä»€ä¹ˆæ˜¯mEncoderSurfaceï¼Ÿ è¿™ä¸Media Codecå°†ä½¿ç”¨çš„Surfaceç›¸åŒã€‚ ä»…å¯¹äºåˆå­¦è€…ï¼Œæ‚¨éœ€è¦å¤§çº¦ä»¥è¿™ç§æ–¹å¼æ¥åˆå§‹åŒ–å®ƒä»¬ã€‚ <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUpMediaCodec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mCodec = MediaCodec.createEncoderByType(<span class="hljs-string"><span class="hljs-string">"video/avc"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// H264  } catch (Exception e) { Log.i(LOG_TAG, "  "); } int width = 320; //   int height = 240; //   int colorFormat = MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface; //    int videoBitrate = 500000; //    bps (  ) int videoFramePerSecond = 20; // FPS int iframeInterval = 2; // I-Frame    MediaFormat format = MediaFormat.createVideoFormat("video/avc", width, height); format.setInteger(MediaFormat.KEY_COLOR_FORMAT, colorFormat); format.setInteger(MediaFormat.KEY_BIT_RATE, videoBitrate); format.setInteger(MediaFormat.KEY_FRAME_RATE, videoFramePerSecond); format.setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, iframeInterval); mCodec.configure(format, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE); //     mEncoderSurface = mCodec.createInputSurface(); //  Surface  mCodec.setCallback(new EncoderCallback()); mCodec.start(); //   Log.i(LOG_TAG, " "); }</span></span></code> </pre><br> ç°åœ¨ï¼Œåªéœ€æ³¨å†Œä¸€ä¸ªå›è°ƒã€‚ å½“åª’ä½“ç¼–è§£ç å™¨çªç„¶æ„Ÿè§‰åˆ°å¯ä»¥è¿›ä¸€æ­¥å¹¿æ’­çš„ä¸‹ä¸€ä¸ªæ•°æ®å‡†å¤‡å°±ç»ªæ—¶ï¼Œä»–å°†é€šè¿‡ä»¥ä¸‹æ–¹å¼é€šçŸ¥æˆ‘ä»¬ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EncoderCallback</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MediaCodec</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Callback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInputBufferAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MediaCodec codec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOutputBufferAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MediaCodec codec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, MediaCodec.BufferInfo info)</span></span></span><span class="hljs-function"> </span></span>{ outPutByteBuffer = mCodec.getOutputBuffer(index); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] outDate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[info.size]; outPutByteBuffer.get(outDate); Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">" outDate.length : "</span></span> + outDate.length); mCodec.releaseOutputBuffer(index, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MediaCodec codec, MediaCodec.CodecException e)</span></span></span><span class="hljs-function"> </span></span>{ Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"Error: "</span></span> + e); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOutputFormatChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MediaCodec codec, MediaFormat format)</span></span></span><span class="hljs-function"> </span></span>{ Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"encoder output format changed: "</span></span> + format); } }</code> </pre><br>  outDateå­—èŠ‚æ•°ç»„æ˜¯çœŸæ­£çš„å®è—ã€‚ å®ƒåŒ…å«ç°æˆçš„H264ç¼–ç è§†é¢‘æµç‰‡æ®µï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨å®ƒæ‰§è¡Œæˆ‘ä»¬æƒ³åšçš„ä»»ä½•äº‹æƒ…ã€‚ <br><br> ä»–ä»¬åœ¨è¿™é‡Œ... <br><br><img src="https://habrastorage.org/webt/lh/pe/kz/lhpekzdgk-z95gpos8493tdgdqi.png"><br><br> æœ‰äº›ç‰‡æ®µå¯èƒ½å¤ªå¤§ï¼Œæ— æ³•é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œä½†æ˜¯å¦‚æœæœ‰å¿…è¦ï¼Œç³»ç»Ÿä¸ä¼šè‡ªè¡Œå°†å®ƒä»¬åˆ‡ç¢å¹¶å‘é€ç»™æ¥æ”¶è€…ã€‚ <br> ä½†æ˜¯ï¼Œå¦‚æœå®ƒéå¸¸å¯æ€•ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€šè¿‡æ¨ç¢è¿™æ ·çš„ç¢ç‰‡æ¥ç²‰ç¢è‡ªå·± <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count =<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> temp =outDate.length ; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> {<span class="hljs-comment"><span class="hljs-comment">//    byte[] ds; temp = temp-1024; if(temp&gt;=0) { ds = new byte[1024];} else { ds = new byte[temp+1024];} for(int i =0;i&lt;ds.length;i++) { ds[i]=outDate[i+1024*count]; } count=count+1; try { // Log.i(LOG_TAG, " outDate.length : " + ds.length); DatagramPacket packet = new DatagramPacket(ds, ds.length, address, port); udpSocket.send(packet); } catch (IOException e) { Log.i(LOG_TAG, "   UDP "); } } while (temp&gt;=0);</span></span></code> </pre><br><br> ä½†å°±ç›®å‰è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦äº²çœ¼çœ‹åˆ°ç¼“å†²åŒºä¸­çš„æ•°æ®ç¡®å®æ˜¯H264è§†é¢‘æµã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†å®ƒä»¬å‘é€åˆ°æ–‡ä»¶ä¸­ï¼š <br><br> æˆ‘ä»¬å°†åœ¨è®¾ç½®ä¸­ç¼–å†™ï¼š <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUpMediaCodec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ File mFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string"><span class="hljs-string">"test3.h264"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { outputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BufferedOutputStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(mFile)); Log.i(<span class="hljs-string"><span class="hljs-string">"Encoder"</span></span>, <span class="hljs-string"><span class="hljs-string">"outputStream initialized"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); }</code> </pre><br> åœ¨å›è°ƒä¸­ï¼Œç¼“å†²åŒºåœ¨å“ªé‡Œï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { outputStream.write(outDate, <span class="hljs-number"><span class="hljs-number">0</span></span>, outDate.length);<span class="hljs-comment"><span class="hljs-comment">//     } catch (IOException e) { // TODO Auto-generated catch block e.printStackTrace(); }</span></span></code> </pre><br> æ‰“å¼€åº”ç”¨ç¨‹åºï¼ŒæŒ‰æŒ‰é’®ï¼šâ€œæ‰“å¼€ç›¸æœºå’Œæµâ€ã€‚ å½•åˆ¶è‡ªåŠ¨å¼€å§‹ã€‚ æˆ‘ä»¬ç¨ç­‰ä¸€ä¸‹ï¼Œç„¶åæŒ‰åœæ­¢æŒ‰é’®ã€‚ <br><br> ç”±äºæ ¼å¼ä¸æ˜¯MP4ï¼Œå› æ­¤ä¿å­˜çš„æ–‡ä»¶é€šå¸¸ä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨VLCæ’­æ”¾å™¨æ‰“å¼€è¯¥æ–‡ä»¶æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨ONLINE CONVERT</a>åœ¨çº¿è½¬æ¢å®ƒï¼Œæˆ‘ä»¬å°†ç¡®ä¿æˆ‘ä»¬èµ°åœ¨æ­£ç¡®çš„è½¨é“ä¸Šã€‚ çš„ç¡®ï¼Œå›¾åƒä½äºä¾§é¢ï¼Œä½†æ˜¯å¯ä»¥ä¿®å¤ã€‚ <br><br> é€šå¸¸ï¼Œå¯¹äºå½•åˆ¶ï¼Œæ‹ç…§æˆ–æµåª’ä½“çš„æ¯ä¸ªäº‹ä»¶ï¼Œæœ€å¥½æ¯æ¬¡éƒ½æ‰“å¼€ä¸€ä¸ªæ–°ä¼šè¯å¹¶å…³é—­æ—§ä¼šè¯ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé¦–å…ˆæˆ‘ä»¬æ‰“å¼€ç›¸æœºå¹¶å¯åŠ¨è£¸éœ²çš„é¢„è§ˆã€‚ ç„¶åï¼Œå¦‚æœéœ€è¦æ‹ç…§ï¼Œè¯·å…³é—­é¢„è§ˆå¹¶æ‰“å¼€é¢„è§ˆï¼Œä½†è¦å›ºå®šå›¾åƒé˜…è¯»å™¨ã€‚ å¦‚æœæˆ‘ä»¬åˆ‡æ¢åˆ°è§†é¢‘å½•åˆ¶ï¼Œè¯·å…³é—­å½“å‰ä¼šè¯å¹¶åœ¨è¿æ¥äº†é¢„è§ˆå’ŒMedia Recorderçš„æƒ…å†µä¸‹å¼€å§‹ä¼šè¯ã€‚ æˆ‘æ²¡æœ‰è¿™æ ·åšï¼Œå› æ­¤ä»£ç çš„å¯è§æ€§ä¸ä¼šå—åˆ°å½±å“ï¼Œæ‚¨å¯ä»¥å†³å®šå¦‚ä½•ä¸ºè‡ªå·±æä¾›æ›´å¤šä¾¿åˆ©ã€‚ <br><br> è¿™æ˜¯æ•´ä¸ªä»£ç ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">åŸºæœ¬åª’ä½“ç¼–è§£ç å™¨</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.basicmediacodec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.core.content.ContextCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.Manifest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.ActivityInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.SurfaceTexture; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCaptureSession; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraDevice; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CaptureRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaCodec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaCodecInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaFormat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Environment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.HandlerThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.StrictMode; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.Surface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.TextureView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.BufferedOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.FileOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.ByteBuffer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Surface surface = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonStreamVideo = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonTStopStreamVideo = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HandlerThread mBackgroundThread; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Handler mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MediaCodec mCodec = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  Surface mEncoderSurface; // Surface      BufferedOutputStream outputStream; ByteBuffer outPutByteBuffer; private void startBackgroundThread() { mBackgroundThread = new HandlerThread("CameraBackground"); mBackgroundThread.start(); mBackgroundHandler = new Handler(mBackgroundThread.getLooper()); } private void stopBackgroundThread() { mBackgroundThread.quitSafely(); try { mBackgroundThread.join(); mBackgroundThread = null; mBackgroundHandler = null; } catch (InterruptedException e) { e.printStackTrace(); } } @RequiresApi(api = Build.VERSION_CODES.M) @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT); setContentView(R.layout.activity_main); Log.d(LOG_TAG, " "); if (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(new String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE}, 1); } mButtonOpenCamera1 = findViewById(R.id.button1); mButtonStreamVideo = findViewById(R.id.button2); mButtonTStopStreamVideo = findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { setUpMediaCodec();//    if (myCameras[CAMERA1] != null) {//   if (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonStreamVideo.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { { //    } } }); mButtonTStopStreamVideo.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { if (mCodec != null) { Toast.makeText(MainActivity.this, "  ", Toast.LENGTH_SHORT).show(); myCameras[CAMERA1].stopStreamingVideo(); } } }); mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); try { //      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: " + cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager, cameraID); } } catch (CameraAccessException e) { Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } public class CameraService { private String mCameraID; private CameraDevice mCameraDevice = null; private CameraCaptureSession mSession; private CaptureRequest.Builder mPreviewBuilder; public CameraService(CameraManager cameraManager, String cameraID) { mCameraManager = cameraManager; mCameraID = cameraID; } private CameraDevice.StateCallback mCameraCallback = new CameraDevice.StateCallback() { @Override public void onOpened(CameraDevice camera) { mCameraDevice = camera; Log.i(LOG_TAG, "Open camera with id:" + mCameraDevice.getId()); startCameraPreviewSession(); } @Override public void onDisconnected(CameraDevice camera) { mCameraDevice.close(); Log.i(LOG_TAG, "disconnect camera with id:" + mCameraDevice.getId()); mCameraDevice = null; } @Override public void onError(CameraDevice camera, int error) { Log.i(LOG_TAG, "error! camera id:" + camera.getId() + " error:" + error); } }; private void startCameraPreviewSession() { SurfaceTexture texture = mImageView.getSurfaceTexture(); texture.setDefaultBufferSize(320, 240); surface = new Surface(texture); try { mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); mPreviewBuilder.addTarget(surface); mPreviewBuilder.addTarget(mEncoderSurface); mCameraDevice.createCaptureSession(Arrays.asList(surface, mEncoderSurface), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mSession = session; try { mSession.setRepeatingRequest(mPreviewBuilder.build(), null, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { } }, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } public boolean isOpen() { if (mCameraDevice == null) { return false; } else { return true; } } public void openCamera() { try { if (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID, mCameraCallback, mBackgroundHandler); } } catch (CameraAccessException e) { Log.i(LOG_TAG, e.getMessage()); } } public void closeCamera() { if (mCameraDevice != null) { mCameraDevice.close(); mCameraDevice = null; } } public void stopStreamingVideo() { if (mCameraDevice != null &amp; mCodec != null) { try { mSession.stopRepeating(); mSession.abortCaptures(); } catch (CameraAccessException e) { e.printStackTrace(); } mCodec.stop(); mCodec.release(); mEncoderSurface.release(); closeCamera(); } } } private void setUpMediaCodec() { File mFile = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), "test3.h264"); try { outputStream = new BufferedOutputStream(new FileOutputStream(mFile)); Log.i("Encoder", "outputStream initialized"); } catch (Exception e) { e.printStackTrace(); } try { mCodec = MediaCodec.createEncoderByType("video/avc"); // H264  } catch (Exception e) { Log.i(LOG_TAG, "  "); } int width = 320; //   int height = 240; //   int colorFormat = MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface; //    int videoBitrate = 500000; //    bps (  ) int videoFramePerSecond = 20; // FPS int iframeInterval = 3; // I-Frame    MediaFormat format = MediaFormat.createVideoFormat("video/avc", width, height); format.setInteger(MediaFormat.KEY_COLOR_FORMAT, colorFormat); format.setInteger(MediaFormat.KEY_BIT_RATE, videoBitrate); format.setInteger(MediaFormat.KEY_FRAME_RATE, videoFramePerSecond); format.setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, iframeInterval); mCodec.configure(format, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE); //     mEncoderSurface = mCodec.createInputSurface(); //  Surface  mCodec.setCallback(new EncoderCallback()); mCodec.start(); //   Log.i(LOG_TAG, " "); } private class EncoderCallback extends MediaCodec.Callback { @Override public void onInputBufferAvailable(MediaCodec codec, int index) { } @Override public void onOutputBufferAvailable(MediaCodec codec, int index, MediaCodec.BufferInfo info) { outPutByteBuffer = mCodec.getOutputBuffer(index); byte[] outDate = new byte[info.size]; outPutByteBuffer.get(outDate); try { Log.i(LOG_TAG, " outDate.length : " + outDate.length); outputStream.write(outDate, 0, outDate.length);//     } catch (IOException e) { // TODO Auto-generated catch block e.printStackTrace(); } mCodec.releaseOutputBuffer(index, false); } @Override public void onError(MediaCodec codec, MediaCodec.CodecException e) { Log.i(LOG_TAG, "Error: " + e); } @Override public void onOutputFormatChanged(MediaCodec codec, MediaFormat format) { Log.i(LOG_TAG, "encoder output format changed: " + format); } } @Override public void onPause() { if (myCameras[CAMERA1].isOpen()) { myCameras[CAMERA1].closeCamera(); } stopBackgroundThread(); super.onPause(); } @Override public void onResume() { super.onResume(); startBackgroundThread(); } }</span></span></code> </pre><br></div></div><br> å¹¶ä¸”ä¸è¦å¿˜è®°æ¸…å•ä¸­çš„æƒé™ã€‚ <br><br><pre> <code class="java hljs"> &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.CAMERA"</span></span> /&gt; &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.INTERNET"</span></span>/&gt;</code> </pre><br> å› æ­¤ï¼Œæˆ‘ä»¬ç¡®ä¿åª’ä½“ç¼–è§£ç å™¨æ­£åœ¨è¿è¡Œã€‚ ä½†æ˜¯ï¼Œç”¨å®ƒå°†è§†é¢‘å†™å…¥æ–‡ä»¶æ˜¯ä¸å¯è¡Œçš„ã€‚  Media Recorderå¯ä»¥æ›´å¥½åœ°å¤„ç†æ­¤ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥å¢åŠ å£°éŸ³ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å†æ¬¡ä¸¢å¼ƒæ–‡ä»¶éƒ¨åˆ†ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªä»£ç å—ï¼Œä»¥ä½¿ç”¨udpåè®®å°†è§†é¢‘æµå¼ä¼ è¾“åˆ°ç½‘ç»œã€‚ è¿™ä¹Ÿå¾ˆç®€å•ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åˆå§‹åŒ–UDPæœåŠ¡å™¨ã€‚ <br><br><pre> <code class="java hljs"> DatagramSocket udpSocket; String ip_address = <span class="hljs-string"><span class="hljs-string">"192.168.1.84"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      InetAddress address; int port = 40002; // ,      â€¦â€¦.. try { udpSocket = new DatagramSocket(); Log.i(LOG_TAG, "  udp "); } catch ( SocketException e) { Log.i(LOG_TAG, "   udp "); } try { address = InetAddress.getByName(ip_address); Log.i(LOG_TAG, "  "); } catch (Exception e) {</span></span></code> </pre><br> åœ¨åŒä¸€ä¸ªå›è°ƒä¸­ï¼Œæˆ‘ä»¬å°†å‡†å¤‡æ•°æ®å‘é€åˆ°æ–‡ä»¶æµä¸­ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»¥æ•°æ®æŠ¥çš„å½¢å¼å°†å®ƒä»¬å‘é€åˆ°æˆ‘ä»¬çš„å®¶åº­ç½‘ç»œï¼ˆæˆ‘å¸Œæœ›æ¯ä¸ªäººéƒ½æ‹¥æœ‰å—ï¼Ÿï¼‰ <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { DatagramPacket packet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DatagramPacket(outDate, outDate.length, address, port); udpSocket.send(packet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"   UDP "</span></span>); }</code> </pre><br><br> è¿™å°±æ˜¯å…¨éƒ¨å—ï¼Ÿ <br><br> çœ‹æ¥ï¼Œä½†æ²¡æœ‰ã€‚ è¯¥åº”ç”¨ç¨‹åºå°†åœ¨å¯åŠ¨æ—¶å¯åŠ¨ã€‚ æ‚¨ä¼šçœ‹åˆ°ï¼Œè¯¥ç³»ç»Ÿä¸ä¸»æµä¸åŒï¼Œæˆ‘ä»¬å‘é€å„ç§æ•°æ®æŠ¥åŒ…ã€‚ ä½†æ˜¯æ²¡æœ‰ç†ç”±ææ…Œã€‚ é¦–å…ˆï¼Œå°½ç®¡æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¼‚æ­¥å·¥ä½œï¼Œå³è§¦å‘å›è°ƒã€‚ å…¶æ¬¡ï¼Œå‘é€udpæ•°æ®åŒ…æ˜¯ç›¸åŒçš„å¼‚æ­¥è¿‡ç¨‹ã€‚ æˆ‘ä»¬ä»…å‘Šè¯‰æ“ä½œç³»ç»Ÿå‘é€æ•°æ®åŒ…ä¼šå¾ˆå¥½ï¼Œä½†æ˜¯åœ¨æ­¤é—®é¢˜ä¸Šæˆ‘ä»¬å®Œå…¨ä¾é å®ƒã€‚ å› æ­¤ï¼Œä¸ºäº†ä½¿Androidä¸ä¼šåå›ï¼Œæˆ‘ä»¬å°†åœ¨ç¨‹åºçš„å¼€å¤´æ·»åŠ ä¸¤è¡Œï¼š <br><br><pre> <code class="java hljs"> StrictMode.ThreadPolicy policy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StrictMode.ThreadPolicy.Builder().permitAll().build(); StrictMode.setThreadPolicy(policy);</code> </pre><br> æ€»çš„æ¥è¯´ï¼Œä¸‹é¢çš„å°å‹<s>ä¼˜é›…</s>æ¼”ç¤ºç¨‹åºå°†ä¼šå‡ºç°ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.basicmediacodec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.core.content.ContextCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.Manifest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.ActivityInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.SurfaceTexture; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCaptureSession; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraDevice; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CaptureRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaCodec; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaCodecInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaFormat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.HandlerThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.StrictMode; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.Surface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.TextureView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.BufferedOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.DatagramPacket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.DatagramSocket; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.InetAddress; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.net.SocketException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.ByteBuffer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Surface surface = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonStreamVideo = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonTStopStreamVideo = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HandlerThread mBackgroundThread; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Handler mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MediaCodec mCodec = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  Surface mEncoderSurface; // Surface      BufferedOutputStream outputStream; ByteBuffer outPutByteBuffer; DatagramSocket udpSocket; String ip_address = "192.168.1.84"; InetAddress address; int port = 40002; private void startBackgroundThread() { mBackgroundThread = new HandlerThread("CameraBackground"); mBackgroundThread.start(); mBackgroundHandler = new Handler(mBackgroundThread.getLooper()); } private void stopBackgroundThread() { mBackgroundThread.quitSafely(); try { mBackgroundThread.join(); mBackgroundThread = null; mBackgroundHandler = null; } catch (InterruptedException e) { e.printStackTrace(); } } @RequiresApi(api = Build.VERSION_CODES.M) @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); StrictMode.ThreadPolicy policy = new StrictMode.ThreadPolicy.Builder().permitAll().build(); StrictMode.setThreadPolicy(policy); setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT); setContentView(R.layout.activity_main); Log.d(LOG_TAG, " "); if (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(new String[]{Manifest.permission.CAMERA, Manifest.permission.WRITE_EXTERNAL_STORAGE}, 1); } mButtonOpenCamera1 = findViewById(R.id.button1); mButtonStreamVideo = findViewById(R.id.button2); mButtonTStopStreamVideo = findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { setUpMediaCodec();//    if (myCameras[CAMERA1] != null) {//   if (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonStreamVideo.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { { //    } } }); mButtonTStopStreamVideo.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { if (mCodec != null) { Toast.makeText(MainActivity.this, "  ", Toast.LENGTH_SHORT).show(); myCameras[CAMERA1].stopStreamingVideo(); } } }); try { udpSocket = new DatagramSocket(); Log.i(LOG_TAG, "  udp "); } catch ( SocketException e) { Log.i(LOG_TAG, "   udp "); } try { address = InetAddress.getByName(ip_address); Log.i(LOG_TAG, "  "); } catch (Exception e) { } mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); try { //      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: " + cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager, cameraID); } } catch (CameraAccessException e) { Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } public class CameraService { private String mCameraID; private CameraDevice mCameraDevice = null; private CameraCaptureSession mSession; private CaptureRequest.Builder mPreviewBuilder; public CameraService(CameraManager cameraManager, String cameraID) { mCameraManager = cameraManager; mCameraID = cameraID; } private CameraDevice.StateCallback mCameraCallback = new CameraDevice.StateCallback() { @Override public void onOpened(CameraDevice camera) { mCameraDevice = camera; Log.i(LOG_TAG, "Open camera with id:" + mCameraDevice.getId()); startCameraPreviewSession(); } @Override public void onDisconnected(CameraDevice camera) { mCameraDevice.close(); Log.i(LOG_TAG, "disconnect camera with id:" + mCameraDevice.getId()); mCameraDevice = null; } @Override public void onError(CameraDevice camera, int error) { Log.i(LOG_TAG, "error! camera id:" + camera.getId() + " error:" + error); } }; private void startCameraPreviewSession() { SurfaceTexture texture = mImageView.getSurfaceTexture(); texture.setDefaultBufferSize(320, 240); surface = new Surface(texture); try { mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); mPreviewBuilder.addTarget(surface); mPreviewBuilder.addTarget(mEncoderSurface); mCameraDevice.createCaptureSession(Arrays.asList(surface, mEncoderSurface), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mSession = session; try { mSession.setRepeatingRequest(mPreviewBuilder.build(), null, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { } }, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } public boolean isOpen() { if (mCameraDevice == null) { return false; } else { return true; } } public void openCamera() { try { if (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID, mCameraCallback, mBackgroundHandler); } } catch (CameraAccessException e) { Log.i(LOG_TAG, e.getMessage()); } } public void closeCamera() { if (mCameraDevice != null) { mCameraDevice.close(); mCameraDevice = null; } } public void stopStreamingVideo() { if (mCameraDevice != null &amp; mCodec != null) { try { mSession.stopRepeating(); mSession.abortCaptures(); } catch (CameraAccessException e) { e.printStackTrace(); } mCodec.stop(); mCodec.release(); mEncoderSurface.release(); closeCamera(); } } } private void setUpMediaCodec() { try { mCodec = MediaCodec.createEncoderByType("video/avc"); // H264  } catch (Exception e) { Log.i(LOG_TAG, "  "); } int width = 320; //   int height = 240; //   int colorFormat = MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface; //    int videoBitrate = 500000; //    bps (  ) int videoFramePerSecond = 20; // FPS int iframeInterval = 3; // I-Frame    MediaFormat format = MediaFormat.createVideoFormat("video/avc", width, height); format.setInteger(MediaFormat.KEY_COLOR_FORMAT, colorFormat); format.setInteger(MediaFormat.KEY_BIT_RATE, videoBitrate); format.setInteger(MediaFormat.KEY_FRAME_RATE, videoFramePerSecond); format.setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, iframeInterval); mCodec.configure(format, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE); //     mEncoderSurface = mCodec.createInputSurface(); //  Surface  mCodec.setCallback(new EncoderCallback()); mCodec.start(); //   Log.i(LOG_TAG, " "); } private class EncoderCallback extends MediaCodec.Callback { @Override public void onInputBufferAvailable(MediaCodec codec, int index) { } @Override public void onOutputBufferAvailable(MediaCodec codec, int index, MediaCodec.BufferInfo info) { outPutByteBuffer = mCodec.getOutputBuffer(index); byte[] outDate = new byte[info.size]; outPutByteBuffer.get(outDate); try { DatagramPacket packet = new DatagramPacket(outDate, outDate.length, address, port); udpSocket.send(packet); } catch (IOException e) { Log.i(LOG_TAG, "   UDP "); } mCodec.releaseOutputBuffer(index, false); } @Override public void onError(MediaCodec codec, MediaCodec.CodecException e) { Log.i(LOG_TAG, "Error: " + e); } @Override public void onOutputFormatChanged(MediaCodec codec, MediaFormat format) { Log.i(LOG_TAG, "encoder output format changed: " + format); } } @Override public void onPause() { if (myCameras[CAMERA1].isOpen()) { myCameras[CAMERA1].closeCamera(); } stopBackgroundThread(); super.onPause(); } @Override public void onResume() { super.onResume(); startBackgroundThread(); } }</span></span></code> </pre><br> æˆ‘ä¸çŸ¥é“å…¶ä»–äººä¼šæ€ä¹ˆåšï¼Œä½†æ˜¯åœ¨æˆ‘çš„Red Note 7ä¸Šï¼Œæ‚¨ç”šè‡³å¯ä»¥çœ‹åˆ°å¦‚ä½•åœ¨æ­£ç¡®çš„åœ°å€ä¸‹è½½åƒå­—èŠ‚ <br><br><img src="https://habrastorage.org/webt/9x/3q/gz/9x3qgzrctdcevzw5ym5zi6imgq8.png"><br><br> è€Œä¸”æœ‰å¾ˆå¤šè¿™æ ·çš„udpå¥—æ¥å­—ï¼Œå¤šå°‘ç½‘ç»œå¸¦å®½å°±è¶³å¤Ÿäº†ã€‚ æœ€ä¸»è¦çš„æ˜¯åœ¨å“ªé‡Œæœ‰åœ°å€ã€‚ æ‚¨å°†è¿›è¡Œå¹¿æ’­ã€‚ <br><br><h4> ç°åœ¨è®©æˆ‘ä»¬åœ¨è®¡ç®—æœºä¸ŠæŸ¥æ‰¾æ‰€éœ€çš„åœ°å€ </h4><br> æˆ‘å¿…é¡»è¯´ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªè®¡ç®—æœºç¨‹åºéƒ½èƒ½å¤Ÿé€šè¿‡å•ä¸ªudpé€šé“å¸æ”¶å’Œæ¶ˆåŒ–H264è§†é¢‘æµï¼Œè€Œæ²¡æœ‰ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚ ä½†æ˜¯æœ‰äº›å¯èƒ½ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯éå¸¸è‘—åçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VLC</a>åª’ä½“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ’­æ”¾å™¨</a> ã€‚ è¿™æ˜¯ä¸€ä»¶å¾ˆé…·çš„äº‹æƒ…ï¼Œå¦‚æœæ‚¨å¼€å§‹æè¿°å®ƒçš„åŠŸèƒ½ï¼Œé‚£ä¹ˆä»æœ¬æ–‡ä¸­æ‚¨ä¼šå¾—åˆ°ä¸€æ•´æœ¬ä¹¦ã€‚ å½“ç„¶å¯ä»¥ã€‚ å¦‚æœæ²¡æœ‰ï¼Œæˆ´ä¸Šå®ƒã€‚ <br><br> ä»å‘½ä»¤æè¿°æ¥çœ‹ï¼Œudpæ•°æ®åŒ…å¯ä»¥æ¶ˆåŒ–è¯¥æ’­æ”¾å™¨ã€‚ <br><br><pre> <code class="java hljs">URL syntax: file:<span class="hljs-comment"><span class="hljs-comment">///path/file Plain media file http://host[:port]/file HTTP URL ftp://host[:port]/file FTP URL mms://host[:port]/file MMS URL screen:// Screen capture dvd://[device] DVD device vcd://[device] VCD device cdda://[device] Audio CD device udp://[[&lt;source address&gt;]@[&lt;bind address&gt;][:&lt;bind port&gt;]]</span></span></code> </pre><br> ä»ç†è®ºä¸Šè®²ï¼Œä¸éœ€è¦æ‰€æœ‰è¿™äº›æºåœ°å€å’Œç»‘å®šåœ°å€ã€‚ ä»…éœ€è¦ä¾¦å¬ç«¯å£ã€‚ <br><br><img src="https://habrastorage.org/webt/7-/kw/pi/7-kwpik08ayqmgvd2rta1sqjtae.png"><br><br>  , ,         ( ) <br><br><img src="https://habrastorage.org/webt/ix/9r/sj/ix9rsjovph-xzqgmosv_kgu-in4.jpeg"><br><br>   ,         ? <br><br>      ( ) <br><br> ,   ,  VLC        .  . <br><br><h4>   ? </h4><br>   .  , ,    VLC 3.08 Vetinari?   ,    udp  deprecated     . <br><br> -    .      udp     -: <br><br><ul><li>       .                 ,    .       . </li><li>     </li></ul><br>   , ,      RTP  .     â€”   ,        udp ( ),           .      ,    -   ,           .      .   ,  ,   . <br><br>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>   .    -, ,    â€”          .   udp   . <br>  -   RTP    - . ,       ,      .    VLC ,  udp   . <br><br> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VLC 2.2.6 Umbrella</a> <br><br>       (   VLC),   . <br><br>      . <br><br>    ,        H264. - VLC     ,       (  ,      ).  -      ,  ,  VLC  .   ,  ? <br><br>    . <br><br><img src="https://habrastorage.org/webt/jq/f5/er/jqf5ercz20oa2hxzlbeqmokqgbs.png"><br><br>      Â«Â» . ,  -   ,        . <br><br>            : <br><br><pre> <code class="java hljs">C:\Program Files\VideoLAN\VLC\vlc udp:<span class="hljs-comment"><span class="hljs-comment">//@:40002 --demux h264 --video-filter=transform --transform-type=90</span></span></code> </pre><br>     . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/IbN9eh1uyv4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>   .       JAVA    .       . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN473036/">https://habr.com/ru/post/zh-CN473036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN473024/index.html">æ‚¨éœ€è¦äº†è§£çš„æœ‰å…³ç‰©è”ç½‘çš„çŸ¥è¯†ï¼šåŸºç¡€æ•™è‚²è®¡åˆ’</a></li>
<li><a href="../zh-CN473026/index.html">ç™¾èƒœå’Œæ•°æ®éªŒè¯</a></li>
<li><a href="../zh-CN473028/index.html">åœ¨ä¿„ç½—æ–¯å¼€å§‹ä»æ¬§æ´²è¿›å£æ”¾å°„æ€§åºŸç‰©ï¼Ÿ æ•´ç†å‡ºæ¥</a></li>
<li><a href="../zh-CN473032/index.html">â€œå¸Œæœ›æ˜¯ä¸€ä¸ªåç­–ç•¥ã€‚â€ 2æœˆ3-5æ—¥åœ¨è«æ–¯ç§‘è¿›è¡ŒSREå¯†é›†</a></li>
<li><a href="../zh-CN473034/index.html">è’‚å§†åˆ©å¾·æ€ä¹ˆå</a></li>
<li><a href="../zh-CN473038/index.html">8ä½è«å°”æ–¯ç”µç </a></li>
<li><a href="../zh-CN473042/index.html">Djangoçš„ä¼˜ç¼ºç‚¹</a></li>
<li><a href="../zh-CN473044/index.html">å¦‚ä½•åœ¨App Storeä¸­ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºæœ‰æ•ˆçš„å±å¹•æˆªå›¾</a></li>
<li><a href="../zh-CN473046/index.html">é£æµªï¼Œæ„å¿—åŠ›ï¼šæˆ´å°”åšå›ºè€ç”¨çš„å¹³æ¿ç”µè„‘å¦‚ä½•å¸®åŠ©ä¿„ç½—æ–¯äººèµ¢å¾—å›½é™…å¸†èˆ¹èµ›</a></li>
<li><a href="../zh-CN473050/index.html">AMDå¼ºè¿«Intelä¸ä»…é™ä½æ–°CPUçš„ä»·æ ¼ï¼Œè€Œä¸”é™ä½æ—§CPUçš„ä»·æ ¼ã€‚ è¿™æ˜¯å¦ä¸€åœºä»·æ ¼æˆ˜çš„å¼€å§‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>