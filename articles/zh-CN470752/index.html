<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎯 🧝🏽 📨 解析微信支付 ⛹🏻 🛠️ 👩🏻‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="尽管中国的第三方支付市场非常庞大，但任何电话制造商，每个移动运营商都有其电子钱包，并且在其评级中有数十种名称，可以毫不夸张地说，考虑到电子支付系统，您可以将自己限制在两家公司-腾讯和阿里巴巴。 根据3mbang的数据，2018年，Alipey拥有移动支付市场52.5％的市场份额，而Tensent占有...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>解析微信支付</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470752/">尽管中国的第三方支付市场非常庞大，但任何电话制造商，每个移动运营商都有其电子钱包，并且在其评级中有数十种名称，可以毫不夸张地说，考虑到电子支付系统，您可以将自己限制在两家公司-腾讯和阿里巴巴。 根据3mbang的数据，2018年，Alipey拥有移动支付市场52.5％的市场份额，而Tensent占有36.7％的市场份额（使用移动终端的交易数量）。 如果我们不仅考虑电话，还考虑所有电子设备，那么统计数字似乎有些不同-Alipey为44.5％，Tensent为30.3％。 无论如何，只要有“我需要连接电子支付”的思想，任何新手（或高级）企业家都会在脑海中浮现这两个名字。 在99％的情况下，这已经足够了-无论是开放IP来买卖鞋，街上的面条盘还是一个拥有数百万游客的严肃场所。 所有其他付款-是的，它们是可取的，它们有其优点，但是基本的设置是这两个。 我们将详细考虑它们。 <br><a name="habracut"></a><br> 自然，这个话题太广泛了。 多年来，这两个网络已经发展成为规模庞大，独立且可形成系统的产品（至少在微信的基础上，信使处理器（这是通过腾讯进行支付的主要工具）通过钱包）这一事实说明了它们对于国家存在的重要性微信在某些地区推出了电子身份证测试，我们将无法接受如此庞大的规模。每个网络都已经发展了数百种相关服务-从食品交付，折扣券销售到投资平台 我们将从一个新手商人的角度考虑所有这些问题，他意识到没有电子付款他注定要在2019年破产。因此，我们将从这里开始，并在以后的文章中继续。 <br><br> 因此，微信提供以下支付解决方案： <br><br> 付款编码支付-通过付款代码进行支付。 用户在带有个人付款代码（包含18位条形码或QR码）的页面上打开自己的夹心，卖方通过阅读此代码，从用户帐户中扣除了他确定的金额。 也就是说，从系统方面来看，它看起来像这样： <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appid</span></span></span><span class="hljs-tag">&gt;</span></span>wx11112222aaaabbbb<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appid</span></span></span><span class="hljs-tag">&gt;</span></span> - ID       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attach</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attach</span></span></span><span class="hljs-tag">&gt;</span></span> -   (  ) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">auth_code</span></span></span><span class="hljs-tag">&gt;</span></span>120269300684844649<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">auth_code</span></span></span><span class="hljs-tag">&gt;</span></span> -     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> -   -      <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device_info</span></span></span><span class="hljs-tag">&gt;</span></span>1000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device_info</span></span></span><span class="hljs-tag">&gt;</span></span> -    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goods_tag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goods_tag</span></span></span><span class="hljs-tag">&gt;</span></span> -    ,     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mch_id</span></span></span><span class="hljs-tag">&gt;</span></span>10000100<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mch_id</span></span></span><span class="hljs-tag">&gt;</span></span> - ID  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nonce_str</span></span></span><span class="hljs-tag">&gt;</span></span>8aaee146b1dee7cec9100add9b96cbe2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nonce_str</span></span></span><span class="hljs-tag">&gt;</span></span> -     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">out_trade_no</span></span></span><span class="hljs-tag">&gt;</span></span>1415757673<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">out_trade_no</span></span></span><span class="hljs-tag">&gt;</span></span> -      <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spbill_create_ip</span></span></span><span class="hljs-tag">&gt;</span></span>14.17.22.52<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">spbill_create_ip</span></span></span><span class="hljs-tag">&gt;</span></span> IP  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time_expire</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">time_expire</span></span></span><span class="hljs-tag">&gt;</span></span> ,     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">total_fee</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">total_fee</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sign</span></span></span><span class="hljs-tag">&gt;</span></span>C29DB7DB1FD4136B84AE35604756362C<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sign</span></span></span><span class="hljs-tag">&gt;</span></span> - </code> </pre> <br> 简而言之，这就是卖方发送给舱口的表格，并且每次仅买方的金额和付款代码发生变化。 并且，因此，该方法的危险对于每个人都是立即可见的： <br><br><ol><li> 买方只有在扣款后才能看到金额 </li><li> 了解了付款代码后，不道德的卖家可以随时在买家不知情的情况下从买家的帐户中扣除任何金额。 </li><li> 但是，由于该代码是一次性的，并且每次启动Wichat时都会更改，并且借方金额的通知在同一秒内发生，因此这种付款方式的欺诈行为非常成问题。 这种方法已经扎根于几乎所有的离线商店，麦当劳的自助终端以及几乎所有可以安装条形码扫描器并且客户可以实际访问条形码扫描器的地方 </li></ol><br><img src="https://habrastorage.org/webt/g5/7z/x7/g57zx7alaf4m4riynx_lrbnbwy8.png"><br><br> 本机付款。 完全与第一种方法相反，基于这样一个事实，即卖方使用其数据和订单金额生成一个QR码，而买方通过其微信扫描并确认付款。 优势显而易见： <br><br><ol><li> 买方看到付款之前的应付金额 </li><li> 所有决定均由买方做出-即使他扫描了代码，也可以拒绝付款。 他也决定扫描/不扫描。 </li></ol><br> 这种方法已经扎根，无论您在哪个屏幕上都可以在桌面网站上首先显示更新的QR码。 也可以在只有一种单一产品的地方找到它-例如，通过使用Vichat的本机付款出售Sky Park的门票。 <br><br><img src="https://habrastorage.org/webt/9g/wp/md/9gwpmd1opikumijxxn93qvjmqyy.png"><br><br> 本质上，本机支付是微信中的链接：//在微信内置浏览器中打开的wxpay格式。 <br><br> 上述两种方法的缺点是完全缺乏反馈以及缺乏针对特定用户进行个性化付款的能力。 也就是说，如果我们只出售门票，这对我们来说已经足够了-我们看到付款已经通过，我们发行了门票，那么下一位访客就很合适。 但是，如果我们要给每个用户一张个性化的票证（将其姓名从Wichat中拉出），那么就不可能使用这种付款方式-付款和确认订单后，买卖双方之间的通信就会结束。 卖方看到的最大金额是以下信息：12-31岁的用户123456789向卖方98765454321支付了20元人民币。因此，其他类型的付款越来越受欢迎。 但是稍后再谈。 <br><br>  APP付款或第三方应用程序中的付款。 在这里，一切也都非常简单-使用此类付款的唯一方案是在移动应用程序中。 例如，雀巢供水应用程序。 用户订购水，单击“付款”，雀巢应用程序通过应用程序间通信调用进行付款的微信应用程序。 交易完成后，微信会将信息发送回雀巢应用程序，并通知他订单12345的付款已成功。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j1/pi/sa/j1pisaznwobjydbtlv5rf644oxm.png" width="400"></div><br>  H5付款。 本质上，这是本机付款的更新版本。 由于移动流量已经比台式机流量占据了相当长的一段时间，并且本机付款由于显而易见的原因而没有在手机上扎根（主要是因为要通过手机扫描QR码，并在其屏幕上显示，如果您需要一个复杂的镜子系统，另一个电话或“将代码保存到相册，打开至最低，从图像中选择扫描”系列中的半小时手势，则会出现H5付款。 实际上，这只是weixin中的链接：//产品网页上的格式，单击该格式可启动wichat，并在交易完成后将信息提供给回调 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fe/40/sh/fe40shestiwmlqkuxa6t3ndcdwy.png" width="400"></div><br>  JSAPI付款。  Wichat的首次尝试是将所有内容整合到一个屋顶下，并在其内置浏览器中进行所有交易。 它还支持生成用于脱机支付，嵌入到网站以及在公共帐户中进行支付的代码。 坦率地说，这种尝试没有成功，现在在几个地方都找不到。 但这成为出现较小应用程序的先决条件。 <br><br> 当然，仍然值得一提的是两种付款方式，它们不是纯粹的付款方式，但也很受欢迎： <br><br><ol><li> 付款转账。 在手推车橘子和街头小贩中特别受欢迎。 钱包所有者的个人QR码已打印，扫描后可以将一定数量的款项转给他。 实际上，这是非法的，会受到税收等方面的起诉，因为许可协议明确规定，转让不得用于商业目的和支付商品。 除非卖方有意注册为个人企业家并向微信表明他正在使用其帐户接受商业活动付款。 但是，知识产权工商户是一个单独的大主题，因此不适用于本文，尤其是因为只有中华人民共和国居民才能注册为知识产权。 </li><li> 通过聚合器付款。 如果卖方过于懒惰而无法在每个支付系统中进行注册，则可以在iapppay.com之类的聚合商处进行注册，打印出他的QR码并将其挂在网站上收银机\上方。 好吧，当然，现在所有事情都将在聚合器一侧进行。 </li><li> 最后，最后一种也是最有趣的付款方式是小程序中的付款。 您可以将俄语大致翻译为“小型应用程序”。 小程序实际上是只能在Wichat内置浏览器中运行的网页。 典型的用户案例-用户通过vichata扫描QR码并进入某个公司的应用程序。 之后，它就可以用作登录积分，开发人员可以使用第三方API的全部功能来访问有关用户，其地理位置，偏好和兴趣分析的结果，Internet查询等信息，您将不会记住所有信息。 而且在他的应用程序中，他可以毫无限制地实现所有内容。 然后，一键添加付款。 也就是说，如果上述所有方法都有其可以理解的局限性，则应用程序中的转换和保留仅取决于您。 许多开始使用简单应用程序的公司现在已经成长为巨大的怪物，在这种应用程序中，人们比在任何娱乐网站上花费的时间更多。 </li></ol><br> 从可能的实现示例中： <br><br><ul><li> 小程序KTV同乐迪。 进入房间并扫描桌子上的QR码后，您可以从Wichat应用程序中订购歌曲，购买更多啤酒，参加调查并获得折扣，找到志趣相投的女孩等。 </li><li> 烧烤聚点串吧-到达那里并扫描了桌子上的QR码，您无法致电服务员，但是在应用程序中，您可以订购肉类，参加2 +1啤酒的促销，填写有关您自己的信息并在生日那天获得折扣，交换折扣券等的积分 等 </li><li> 自然，一切不限于此。 但是，在这两个平台中的任何一个框架内，您都可以直接在付款中处理无数其他相关的芯片和机会，这是很好的。 考虑到支付宝最初发展为支付服务（随着社交功能的进一步扭曲）而产生的差异，支付宝的一切都差不多，而微信最初是一个社交平台，后来又将支付锁定在该平台上。 </li></ul><br> 但总的来说，这两个平台的发展或多或少均匀，并提供平等的机会。 下次我们将讨论集成和连接的复杂性。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN470752/">https://habr.com/ru/post/zh-CN470752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN470736/index.html">WWDC 2019：自定义工具和SF符号以及开发iOS应用程序的新方法</a></li>
<li><a href="../zh-CN470742/index.html">CUDA上的Navier-Stokes方程和流体模拟</a></li>
<li><a href="../zh-CN470744/index.html">数学揭示了活细胞反馈的秘密</a></li>
<li><a href="../zh-CN470746/index.html">Facebook使对话成为下一个受欢迎的界面</a></li>
<li><a href="../zh-CN470750/index.html">亚马逊抓住了热门产品</a></li>
<li><a href="../zh-CN470754/index.html">RASA Chatbot：Parallels体验</a></li>
<li><a href="../zh-CN470756/index.html">为Apollo在线聊天Node.js创建一个后端应用程序</a></li>
<li><a href="../zh-CN470758/index.html">2019年9月病毒活动概述</a></li>
<li><a href="../zh-CN470772/index.html">TON：建议和最佳做法</a></li>
<li><a href="../zh-CN470774/index.html">Python 3.8中的新类型注释（协议，最终，TypedDict，文字）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>