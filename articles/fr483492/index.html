<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏽 📢 👨🏿‍🤝‍👨🏼 Résolution de problèmes typiques avec json_encode (PHP) 👓 👋🏿 ❤️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il s'agit d'un court article sur les problèmes les plus probables avec json_encode et leurs solutions. Parfois, lors du codage des données en json, en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Résolution de problèmes typiques avec json_encode (PHP)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483492/"><p>  Il s'agit d'un court article sur les problèmes les plus probables avec <i>json_encode</i> et leurs solutions.  Parfois, lors du codage des données en json, en utilisant <i>json_encode</i> en php, nous obtenons le mauvais résultat que nous attendons.  J'ai souligné les trois problèmes les plus courants auxquels sont confrontés les programmeurs: <br></p><br><ul><li>  accès aux champs </li><li>  encodage de la valeur du texte </li><li>  valeurs numériques </li></ul><a name="habracut"></a><br><h3>  Accès aux champs </h3><br><p>  Le problème est que <i>json_encode</i> n'a accès qu'aux champs publics de l'objet.  Par exemple, si vous avez une classe </p><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $publicProperty; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $protectedProperty; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $privateProperty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($public, $protected, $private)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publicProperty = $public; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;protectedProperty = $protected; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty = $private; } }</code> </pre> <br><p>  alors le résultat du code suivant sera: </p><br><pre> <code class="php hljs">$obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Example(<span class="hljs-string"><span class="hljs-string">"some"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-string"><span class="hljs-string">"here"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($obj); <span class="hljs-comment"><span class="hljs-comment">// {"publicProperty":"some"}</span></span></code> </pre><br><p>  comme vous pouvez le voir, seuls les champs publics ont été inclus dans le json résultant. <br>  Que faire si vous avez besoin de tous les champs? </p><br><h4>  Solution </h4><br><p>  Pour php &lt;5,4: <br>  nous devrons implémenter une méthode dans la classe qui retournera le json fini.  Parce que  à l'intérieur de la classe, il y a accès à tous les champs, vous pouvez former la représentation correcte de l'objet pour <i>json_encode</i> </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $publicProperty; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $protectedProperty; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $privateProperty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($public, $protected, $private)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publicProperty = $public; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;protectedProperty = $protected; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty = $private; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json_encode([ <span class="hljs-string"><span class="hljs-string">'publicProperty'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publicProperty, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;protectedProperty, <span class="hljs-string"><span class="hljs-string">'privateProperty'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty, ]); } }</code> </pre><br><p>  Pour obtenir json-a à partir d'un objet, vous devez maintenant utiliser la méthode <b>toJson</b> , plutôt que d'appliquer directement <i>json_encode</i> à l'objet </p><br><pre> <code class="php hljs">$obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Example(<span class="hljs-string"><span class="hljs-string">"some"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-string"><span class="hljs-string">"here"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $obj-&gt;toJson();</code> </pre><br><p>  Pour php&gt; = 5,4: <br>  il suffira d'implémenter l'interface <b>JsonSerializable</b> pour notre classe, ce qui implique l'ajout d'une méthode <b>jsonSerialize</b> qui retournera une structure représentant l'objet pour <i>json_encode</i> </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonSerializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $publicProperty; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $protectedProperty; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $privateProperty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($public, $protected, $private)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publicProperty = $public; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;protectedProperty = $protected; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty = $private; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsonSerialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'publicProperty'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publicProperty, <span class="hljs-string"><span class="hljs-string">'protectedProperty'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;protectedProperty, <span class="hljs-string"><span class="hljs-string">'privateProperty'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty, ]; } }</code> </pre><br><p>  Maintenant, nous pouvons utiliser <i>json_encode</i> comme avant </p><br><pre> <code class="php hljs">$obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Example(<span class="hljs-string"><span class="hljs-string">"some"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-string"><span class="hljs-string">"here"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($obj); <span class="hljs-comment"><span class="hljs-comment">// {"publicProperty":"some","protectedProperty":"value","privateProperty":"here"}</span></span></code> </pre><br><h4>  Pourquoi ne pas utiliser l'approche avec la méthode toJson? </h4><br><p>  Beaucoup ont probablement remarqué que l'approche de création d'une méthode renvoyant json peut être utilisée dans les versions de php&gt; = 5.4.  Alors pourquoi ne pas en profiter?  Le fait est que votre classe peut être utilisée dans le cadre d'une structure de données différente. </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode([ <span class="hljs-string"><span class="hljs-string">'status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'some message'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Example(<span class="hljs-string"><span class="hljs-string">"some"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>, <span class="hljs-string"><span class="hljs-string">"here"</span></span>), ]);</code> </pre><br><p>  et le résultat sera déjà complètement différent. <br>  En outre, la classe peut être utilisée par d'autres programmeurs, pour qui ce type d'obtention de json à partir d'un objet peut ne pas être complètement évident. <br></p><br><br><h4>  Et si j'ai beaucoup de champs en classe? </h4><br><p>  Dans ce cas, vous pouvez utiliser la fonction get_object_vars </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonSerializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $publicProperty; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $protectedProperty; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $privateProperty; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $someProp1; ... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $someProp100500; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($public, $protected, $private)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publicProperty = $public; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;protectedProperty = $protected; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty = $private; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsonSerialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $fields = get_object_vars(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); <span class="hljs-comment"><span class="hljs-comment">// -  ... return $fields; } }</span></span></code> </pre><br><h4>  Et si vous avez besoin de champs privés d'une classe qui ne peuvent pas être modifiés? </h4><br><p>  Une situation peut survenir lorsque vous devez obtenir <b>des</b> champs <b>privés</b> ( <b>privés</b> , car l'accès aux champs <b>protégés</b> peut être obtenu par héritage) dans json.  Dans ce cas, il faudra utiliser la réflexion: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $publicProperty = <span class="hljs-string"><span class="hljs-string">"someValue"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $protectedProperty; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $privateProperty1; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $privateProperty2; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $privateProperty3; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($privateProperty1, $privateProperty2, $privateProperty3, $protectedProperty)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;protectedProperty = $protectedProperty; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty1 = $privateProperty1; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty2 = $privateProperty2; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;privateProperty3 = $privateProperty3; } } $obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Example(<span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">"21E021"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $reflection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReflectionClass($obj); $public = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($reflection-&gt;getProperties() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $property) { $property-&gt;setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $public[$property-&gt;getName()] = $property-&gt;getValue($obj); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($public); <span class="hljs-comment"><span class="hljs-comment">//{"publicProperty":"someValue","protectedProperty":false,"privateProperty1":"value1","privateProperty2":12,"privateProperty3":"21E021"}</span></span></code> </pre><br><h3>  Encodage des valeurs de texte </h3><br><h4>  Signes cyrilliques et autres en UTF8 </h4><br><p>  Le deuxième type de problème <i>json_encode</i> courant est <i>celui des</i> problèmes de codage.  Souvent, les valeurs de texte qui doivent être codées en json ont des caractères en UTF8 (y compris cyrillique), par conséquent, ces caractères seront présentés sous la forme de codes: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode(<span class="hljs-string"><span class="hljs-string">" or ₳ ƒ 元 ﷼ ₨ ௹ ￥ ₴ ￡ ฿ ＄"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// "\u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u0430 or \u20b3 \u0192 \u5143 \ufdfc \u20a8 \u0bf9 \uffe5 \u20b4 \uffe1 \u0e3f \uff04"</span></span></code> </pre><br><p>  L'affichage de ces caractères est traité très simplement - en ajoutant l'indicateur <b>JSON_UNESCAPED_UNICODE comme</b> deuxième argument de la fonction <i>json_encode</i> : <br></p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode(<span class="hljs-string"><span class="hljs-string">" or ₳ ƒ 元 ﷼ ₨ ௹ ￥ ₴ ￡ ฿ ＄"</span></span>, JSON_UNESCAPED_UNICODE); <span class="hljs-comment"><span class="hljs-comment">// " or ₳ ƒ 元 ﷼ ₨ ௹ ￥ ₴ ￡ ฿ ＄"</span></span></code> </pre><br><h3>  Symboles dans d'autres encodages </h3><br><p>  La fonction <i>json_encode</i> traite les valeurs de chaîne comme des chaînes en UTF8, ce qui peut provoquer une erreur si le codage est différent.  Considérons un petit morceau de code (cet exemple de code est aussi simple que possible pour illustrer une situation problématique) </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode([<span class="hljs-string"><span class="hljs-string">"p"</span></span> =&gt; $_GET[<span class="hljs-string"><span class="hljs-string">'p'</span></span>]]);</code> </pre><br><p>  À première vue, rien ne présage de problèmes, et qu'est-ce qui peut mal tourner ici?  Je le pensais aussi.  Dans la grande majorité des cas, tout fonctionnera, et pour cette raison, trouver le problème m'a pris un peu plus de temps lorsque j'ai rencontré le résultat de <i>json_encode</i> était faux. <br></p><br><p>  Pour recréer cette situation, supposons que p = <b>% EF% F2% E8% F6% E0</b> (par exemple: <a href="http://localhost/%3F%3D%25EF%25F2%25E8%25F6%25E0" rel="nofollow">localhost? =% EF% F2% E8% F6% E0</a> ). <br>  * Les variables des tableaux superglobaux $ _GET et $ _REQUEST sont déjà décodées. <br></p><br><pre> <code class="php hljs">$decoded = urldecode(<span class="hljs-string"><span class="hljs-string">"%EF%F2%E8%F6%E0"</span></span>); var_dump(json_encode($decoded)); <span class="hljs-comment"><span class="hljs-comment">// bool(false) var_dump(json_last_error_msg()); // string(56) "Malformed UTF-8 characters, possibly incorrectly encoded"</span></span></code> </pre><br><p>  Comme vous pouvez le voir sur l'erreur: le problème avec l'encodage de la chaîne transmise (ce n'est pas UTF8).  La solution au problème est évidente - apporter de la valeur à UTF8 </p><br><pre> <code class="php hljs">$decoded = urldecode(<span class="hljs-string"><span class="hljs-string">"%EF%F2%E8%F6%E0"</span></span>); $utf8 = utf8_encode($decoded); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($utf8); <span class="hljs-comment"><span class="hljs-comment">// "ïòèöà"</span></span></code> </pre><br><h2>  Valeurs numériques </h2><br><p>  La dernière erreur typique est liée au codage des valeurs numériques. </p><br><p>  Par exemple: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode([<span class="hljs-string"><span class="hljs-string">"string_float"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"3.0"</span></span>]); <span class="hljs-comment"><span class="hljs-comment">// {"string_float":"3.0"}</span></span></code> </pre><br><p>  Comme vous le savez, php n'est pas un langage strictement typé et vous permet d'utiliser des nombres sous forme de chaîne, dans la plupart des cas, cela ne conduit pas à des erreurs dans l'application php.  Mais comme json est très souvent utilisé pour transférer des messages entre applications, ce format d'écriture de nombres peut provoquer des problèmes dans une autre application.  Il est conseillé d'utiliser l'indicateur <b>JSON_NUMERIC_CHECK</b> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode([<span class="hljs-string"><span class="hljs-string">"string_float"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"3.0"</span></span>], JSON_NUMERIC_CHECK); <span class="hljs-comment"><span class="hljs-comment">// {"string_float":3}</span></span></code> </pre><br><p>  Déjà mieux.  Mais comme vous pouvez le voir, "3.0" est devenu 3, qui dans la plupart des cas sera interprété comme int.  Nous utilisons un indicateur <b>JSON_PRESERVE_ZERO_FRACTION de plus</b> pour une conversion correcte en float: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode([<span class="hljs-string"><span class="hljs-string">"string_float"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"3.0"</span></span>], JSON_NUMERIC_CHECK | JSON_PRESERVE_ZERO_FRACTION); <span class="hljs-comment"><span class="hljs-comment">// {"string_float":3.0}</span></span></code> </pre><br><p>  Je vous demande également de prêter attention au fragment de code suivant, qui illustre un certain nombre de problèmes possibles avec <i>json_encode</i> et les valeurs numériques: </p><br><pre> <code class="php hljs">$data = [ <span class="hljs-string"><span class="hljs-string">"0000021"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   6.12345678910111213, //     ( ) "+81011321515", //  "21E021", //   ]; echo json_encode($data, JSON_NUMERIC_CHECK); //[ // 21, // 6.1234567891011, // 81011321515, // 2.1e+22 // ]</span></span></code> </pre><br><p>  Merci d'avoir lu. </p><br><p>  Je serai heureux de voir dans les commentaires une description des problèmes que vous avez rencontrés qui n'ont pas été mentionnés dans l'article </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483492/">https://habr.com/ru/post/fr483492/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483476/index.html">La morale du transport robotisé: le problème du chariot, risques et conséquences</a></li>
<li><a href="../fr483478/index.html">Soleil, vent et eau ver 0.1</a></li>
<li><a href="../fr483480/index.html">Mots croisés "Sentez-vous comme un analyste SOC"</a></li>
<li><a href="../fr483482/index.html">US Federal Communications Commission pro V2V, V2I et V2X</a></li>
<li><a href="../fr483484/index.html">«Faites semblant»: comment les véhicules sans pilote «cèdent leurs droits»</a></li>
<li><a href="../fr483494/index.html">Any et AnyObject dans Swift. Quelle est leur différence?</a></li>
<li><a href="../fr483496/index.html">Transformez DSLogic U2Basic en DSLogic Plus</a></li>
<li><a href="../fr483500/index.html">Pourquoi les feux arrière sur la Cadillac XLR peuvent coûter plus cher que la Corolla utilisée</a></li>
<li><a href="../fr483502/index.html">Soleil, vent et eau ver 0,2</a></li>
<li><a href="../fr483506/index.html">Rêves d'un vide profond (partie 1). Pompe à vapeur-huile à diffusion: réanimation et un peu de théorie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>