<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõµ üññüèº üë∞üèø Estrategias de implementaci√≥n en Kubernetes: rodando, recreado, azul / verde, canario, oscuro (prueba A / B) üîÄ üöâ ‚õ∞Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev.: Este material de revisi√≥n de Weaveworks presenta las estrategias de implementaci√≥n de aplicaciones m√°s populares y habla sobre la posibil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estrategias de implementaci√≥n en Kubernetes: rodando, recreado, azul / verde, canario, oscuro (prueba A / B)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/471620/">  <i><b>Nota</b></i>  <i><b>perev.:</b> Este material de revisi√≥n de Weaveworks presenta las estrategias de implementaci√≥n de aplicaciones m√°s populares y habla sobre la posibilidad de implementar las m√°s avanzadas utilizando el operador de Kubernetes, Flagger.</i>  <i>Est√° escrito en un lenguaje simple y contiene diagramas visuales que hacen posible que incluso los ingenieros novatos comprendan el problema.</i> <br><br><img src="https://habrastorage.org/webt/fh/bq/eq/fhbqeq1e_cjmxhj_-d15uvfna-a.png"><br>  <i>El diagrama est√° tomado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otra revisi√≥n</a> de las estrategias de implementaci√≥n realizadas en Container Solutions.</i> <br><br>  Uno de los mayores problemas en el desarrollo de aplicaciones nativas en la nube hoy en d√≠a es la implementaci√≥n de implementaci√≥n.  Con el enfoque de microservicio, los desarrolladores ya est√°n trabajando con aplicaciones totalmente modulares y dise√±√°ndolas, lo que permite a diferentes equipos escribir c√≥digo y realizar cambios en la aplicaci√≥n al mismo tiempo. <br><br>  Las implementaciones m√°s cortas y frecuentes tienen las siguientes ventajas: <br><br><ul><li>  Se reduce el tiempo de comercializaci√≥n. </li><li>  Las nuevas funciones llegan a los usuarios m√°s r√°pido. </li><li>  Los comentarios de los usuarios llegan al equipo de desarrollo m√°s r√°pido.  Esto significa que el equipo puede complementar funciones y solucionar problemas m√°s r√°pidamente. </li><li>  La moral de los desarrolladores aumenta: es m√°s interesante trabajar con una gran cantidad de funciones en el desarrollo. </li></ul><a name="habracut"></a><br>  Pero con el aumento de las frecuencias de lanzamiento, tambi√©n aumentan las posibilidades de afectar negativamente la confiabilidad de la aplicaci√≥n o la experiencia del usuario.  Es por eso que es importante que los equipos de operaciones y DevOps creen procesos y administren estrategias de implementaci√≥n de una manera que minimice el riesgo para el producto y los usuarios.  (Obtenga m√°s informaci√≥n sobre la automatizaci√≥n de canalizaciones de CI / CD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ). <br><br>  En esta publicaci√≥n, discutiremos varias estrategias de implementaci√≥n en Kubernetes, incluidas las implementaciones continuas y m√©todos m√°s avanzados, como las implementaciones canarias y sus variaciones. <br><br><h2>  Estrategias de implementaci√≥n </h2><br>  Existen varios tipos diferentes de estrategias de implementaci√≥n que puede utilizar en funci√≥n de su objetivo.  Por ejemplo, es posible que deba realizar cambios en un determinado entorno para realizar m√°s pruebas, o en un subconjunto de usuarios / clientes, o tal vez deba realizar pruebas limitadas en los usuarios antes de hacer que alguna funci√≥n <i>est√© disponible p√∫blicamente</i> . <br><br><h3>  Rolling (despliegue gradual, "rodante") </h3><br>  Esta es una estrategia de implementaci√≥n est√°ndar en Kubernetes.  Gradualmente, uno por uno, reemplaza los pods con la versi√≥n anterior de la aplicaci√≥n con pods con la nueva versi√≥n, sin tiempo de inactividad del cl√∫ster. <br><br><img src="https://habrastorage.org/webt/zk/gb/4n/zkgb4n3ppub2pjxw5qobxhi3y6e.png"><br><br>  Kubernetes espera hasta que las nuevas c√°psulas est√©n listas para trabajar (verific√°ndolas con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pruebas de preparaci√≥n</a> ) antes de comenzar a colapsar las antiguas.  Si se produce un problema, dicha actualizaci√≥n continua se puede interrumpir sin detener todo el cl√∫ster.  En el archivo de implementaci√≥n tipo YAML, la nueva imagen reemplaza a la imagen anterior: <br><br><pre><code class="plaintext hljs">apiVersion: apps/v1beta1 kind: Deployment metadata: name: awesomeapp spec: replicas: 3 template: metadata: labels: app: awesomeapp spec: containers: - name: awesomeapp image: imagerepo-user/awesomeapp:new ports: - containerPort: 8080</code> </pre> <br>  Los par√°metros para una actualizaci√≥n continua se pueden especificar en el archivo de manifiesto: <br><br><pre> <code class="plaintext hljs">spec: replicas: 3 strategy: type: RollingUpdate rollingUpdate: maxSurge: 25% maxUnavailable: 25% template: ...</code> </pre><br><h3>  Recreate (recreaci√≥n) </h3><br>  En este tipo de despliegue m√°s simple, las vainas viejas se matan de una vez y se reemplazan por otras nuevas: <br><br><img src="https://habrastorage.org/webt/s8/cc/f4/s8ccf4olujogufddg0vav3jhens.png"><br><br>  El manifiesto correspondiente se parece a esto: <br><br><pre> <code class="plaintext hljs">spec: replicas: 3 strategy: type: Recreate template: ...</code> </pre> <br><h3>  Azul / Verde (despliegue azul-verde) </h3><br>  La estrategia de implementaci√≥n azul-verde (a veces tambi√©n llamada rojo / negro, es decir, rojo-negro) implica el despliegue simult√°neo de las versiones antigua (verde) y nueva (azul) de la aplicaci√≥n.  Despu√©s de colocar ambas versiones, los usuarios comunes obtienen acceso al verde, mientras que el azul est√° disponible para que el equipo de QA automatice las pruebas a trav√©s de un servicio separado o reenv√≠o directo de puertos: <br><br><img src="https://habrastorage.org/webt/th/zp/ee/thzpeewsyc4kfooyoffzlq7wsbg.png"><br><br><pre> <code class="plaintext hljs">apiVersion: apps/v1beta1 kind: Deployment metadata: name: awesomeapp-02 spec: template: metadata: labels: app: awesomeapp version: "02"</code> </pre> <br>  Una vez que se ha probado la versi√≥n azul (nueva) y se ha aprobado su lanzamiento, el servicio cambia a ella y se minimiza el verde (antiguo): <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Service metadata: name: awesomeapp spec: selector: app: awesomeapp version: "02" ...</code> </pre> <br><h3>  Canarias (despliegue canario) </h3><br>  Los rollos canarios se ven como azul verdoso, pero se manejan mejor y utilizan un enfoque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">progresivo por</a> pasos.  Este tipo incluye varias estrategias diferentes, incluidos los lanzamientos "ocultos" y las pruebas A / B. <br><br>  Esta estrategia se usa cuando es necesario experimentar alguna funcionalidad nueva, como regla, en el backend de la aplicaci√≥n.  La esencia del enfoque es crear dos servidores casi id√©nticos: uno sirve a casi todos los usuarios y el otro, con nuevas caracter√≠sticas, solo sirve a un peque√±o subconjunto de usuarios, despu√©s de lo cual se comparan sus resultados.  Si todo va bien, la nueva versi√≥n se est√° implementando gradualmente en toda la infraestructura. <br><br>  Aunque esta estrategia solo se puede implementar usando las herramientas de Kubernetes, reemplazando los pods viejos por otros nuevos, es mucho m√°s conveniente y f√°cil usar una malla de servicio como Istio. <br><br>  Por ejemplo, puede tener dos manifiestos diferentes en Git: el normal con la etiqueta 0.1.0 y el "canario" con la etiqueta 0.2.0.  Al cambiar los pesos en el manifiesto de la puerta de enlace virtual Istio, puede controlar la distribuci√≥n del tr√°fico entre estas dos implementaciones: <br><br><img src="https://habrastorage.org/webt/gi/sc/0j/gisc0jek9mx_ayulquedmg_fapi.png"><br><br>  Para un tutorial sobre la implementaci√≥n de implementaciones canarias con Istio, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Flujos de trabajo de GitOps con Istio</a> .  <i>( <b>Nota de traducci√≥n</b> : Tambi√©n tradujimos material sobre rollos de canario en Istio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ).</i> <br><br><h4>  Despliegues de Canarias con Weaveworks Flagger </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Weaveworks Flagger</a> hace que sea f√°cil y eficiente administrar implementaciones de canarios. <br><br>  Flagger automatiza el trabajo con ellos.  Utiliza Istio o AWS App Mesh para enrutar y cambiar el tr√°fico, as√≠ como las m√©tricas de Prometheus para analizar los resultados.  Adem√°s, el an√°lisis de las implementaciones canarias se puede complementar con webhooks para pruebas de aceptaci√≥n, pruebas de estr√©s y cualquier otro tipo de verificaci√≥n. <br><br>  Basado en la implementaci√≥n de Kubernetes y, si es necesario, en el escalado horizontal de pod (HPA), Flagger crea conjuntos de objetos (implementaciones de Kubernetes, servicios ClusterIP y servicios virtuales Istio o App Mesh) para el an√°lisis e implementaci√≥n de implementaciones canarias: <br><br><img src="https://habrastorage.org/webt/-u/vo/wj/-uvowj-rfdu9kwnslkjfmxj1_p4.png"><br><br>  Implementando un <i>bucle de control</i> , Flagger cambia gradualmente el tr√°fico al servidor canario, mientras mide simult√°neamente indicadores clave de rendimiento, como el porcentaje de solicitudes HTTP exitosas, la duraci√≥n promedio de la solicitud y el estado del pod.  Seg√∫n el an√°lisis de KPI (indicadores clave de rendimiento), la porci√≥n canaria crece o se colapsa, y los resultados del an√°lisis se publican en Slack.  Puede encontrar una descripci√≥n y una demostraci√≥n de este proceso en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Progressive Delivery for App Mesh</a> . <br><br><img src="https://habrastorage.org/webt/gt/vc/o2/gtvco2gxt0zgw2iqy00bs892phe.png"><br><br><h3>  Despliegue oscuro (oculto) o A / B </h3><br>  El despliegue encubierto es otra variaci√≥n de la estrategia canaria (Flagger tambi√©n puede trabajar con ella, por cierto).  La diferencia entre los despliegues encubiertos y los canarios es que los despliegues encubiertos se ocupan de la interfaz y no del servidor, como los canarios. <br><br>  Otro nombre para estas implementaciones es prueba A / B.  En lugar de abrir el acceso a la nueva funci√≥n a todos los usuarios, se ofrece solo a una parte limitada de ellos.  Por lo general, estos usuarios no saben que son probadores pioneros (de ah√≠ el t√©rmino "implementaci√≥n encubierta"). <br><br>  Mediante el uso de <i>conmutadores de</i> funci√≥n y otras herramientas, puede supervisar c√≥mo los usuarios interact√∫an con la nueva funci√≥n, si los cautiva o si encuentran que la nueva interfaz de usuario es confusa y otros tipos de m√©tricas. <br><br><img src="https://habrastorage.org/webt/hs/gw/jo/hsgwjoo8bij97zvuhrv9evmix-s.png"><br><br><h4>  Despliegues de Flagger y A / B </h4><br>  Adem√°s del enrutamiento ponderado, Flagger tambi√©n puede dirigir el tr√°fico al servidor canario, seg√∫n la configuraci√≥n de HTTP.  Para las pruebas A / B, puede usar encabezados HTTP o cookies para redirigir a un segmento espec√≠fico de usuarios.  Esto es especialmente efectivo para aplicaciones frontend que requieren <i>afinidad de sesi√≥n</i> para el servidor.  Para obtener m√°s informaci√≥n, consulte la documentaci√≥n de Flagger. <br><br>  <i>El autor agradece a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Stefan Prodan</a> , ingeniero de Weaveworks (y creador de Flagger), por todas estas impresionantes implementaciones.</i> <br><br><h2>  PD del traductor </h2><br>  Lea tambi√©n en nuestro blog: <br><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Descripci√≥n general y comparaci√≥n de los controladores de Ingress para Kubernetes</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Werf es nuestra herramienta de CI / CD en Kubernetes (revisi√≥n e informe de video)</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Montaje y despliegue del mismo tipo de microservicios con werf y GitLab CI</a> "; </li><li>  ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øQu√© es GitOps?</a>  ". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471620/">https://habr.com/ru/post/471620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471604/index.html">No te olvides de Open Graph</a></li>
<li><a href="../471608/index.html">Sistema para evitar colisiones: Parte 1. Legislaci√≥n como conocimientos tradicionales para el desarrollador</a></li>
<li><a href="../471610/index.html">Servidor REST en Prolog, ¬øc√≥mo se ve?</a></li>
<li><a href="../471614/index.html">Versi√≥n Rustup 1.20.0: soporte para perfiles, mejoras en la actualizaci√≥n y comandos de documentaci√≥n</a></li>
<li><a href="../471618/index.html">C / C ++ de Python (impulso)</a></li>
<li><a href="../471622/index.html">Xamarin.Forms: un ejemplo simple de emulaci√≥n de tarjeta basada en host</a></li>
<li><a href="../471624/index.html">Dar una presentaci√≥n con un dise√±o UI / UX perfecto</a></li>
<li><a href="../471626/index.html">IA para las personas: palabras simples sobre tecnolog√≠a</a></li>
<li><a href="../471628/index.html">Yo solo refactor√© 15 mil l√≠neas heredadas. Fueron las peores dos semanas de mi vida.</a></li>
<li><a href="../471630/index.html">Placer prohibido: en qu√© pa√≠ses est√° bloqueado PornHub y por qu√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>