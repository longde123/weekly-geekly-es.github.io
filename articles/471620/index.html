<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛵 🖖🏼 👰🏿 Estrategias de implementación en Kubernetes: rodando, recreado, azul / verde, canario, oscuro (prueba A / B) 🔀 🚉 ⛰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev.: Este material de revisión de Weaveworks presenta las estrategias de implementación de aplicaciones más populares y habla sobre la posibil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estrategias de implementación en Kubernetes: rodando, recreado, azul / verde, canario, oscuro (prueba A / B)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/471620/">  <i><b>Nota</b></i>  <i><b>perev.:</b> Este material de revisión de Weaveworks presenta las estrategias de implementación de aplicaciones más populares y habla sobre la posibilidad de implementar las más avanzadas utilizando el operador de Kubernetes, Flagger.</i>  <i>Está escrito en un lenguaje simple y contiene diagramas visuales que hacen posible que incluso los ingenieros novatos comprendan el problema.</i> <br><br><img src="https://habrastorage.org/webt/fh/bq/eq/fhbqeq1e_cjmxhj_-d15uvfna-a.png"><br>  <i>El diagrama está tomado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otra revisión</a> de las estrategias de implementación realizadas en Container Solutions.</i> <br><br>  Uno de los mayores problemas en el desarrollo de aplicaciones nativas en la nube hoy en día es la implementación de implementación.  Con el enfoque de microservicio, los desarrolladores ya están trabajando con aplicaciones totalmente modulares y diseñándolas, lo que permite a diferentes equipos escribir código y realizar cambios en la aplicación al mismo tiempo. <br><br>  Las implementaciones más cortas y frecuentes tienen las siguientes ventajas: <br><br><ul><li>  Se reduce el tiempo de comercialización. </li><li>  Las nuevas funciones llegan a los usuarios más rápido. </li><li>  Los comentarios de los usuarios llegan al equipo de desarrollo más rápido.  Esto significa que el equipo puede complementar funciones y solucionar problemas más rápidamente. </li><li>  La moral de los desarrolladores aumenta: es más interesante trabajar con una gran cantidad de funciones en el desarrollo. </li></ul><a name="habracut"></a><br>  Pero con el aumento de las frecuencias de lanzamiento, también aumentan las posibilidades de afectar negativamente la confiabilidad de la aplicación o la experiencia del usuario.  Es por eso que es importante que los equipos de operaciones y DevOps creen procesos y administren estrategias de implementación de una manera que minimice el riesgo para el producto y los usuarios.  (Obtenga más información sobre la automatización de canalizaciones de CI / CD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> ). <br><br>  En esta publicación, discutiremos varias estrategias de implementación en Kubernetes, incluidas las implementaciones continuas y métodos más avanzados, como las implementaciones canarias y sus variaciones. <br><br><h2>  Estrategias de implementación </h2><br>  Existen varios tipos diferentes de estrategias de implementación que puede utilizar en función de su objetivo.  Por ejemplo, es posible que deba realizar cambios en un determinado entorno para realizar más pruebas, o en un subconjunto de usuarios / clientes, o tal vez deba realizar pruebas limitadas en los usuarios antes de hacer que alguna función <i>esté disponible públicamente</i> . <br><br><h3>  Rolling (despliegue gradual, "rodante") </h3><br>  Esta es una estrategia de implementación estándar en Kubernetes.  Gradualmente, uno por uno, reemplaza los pods con la versión anterior de la aplicación con pods con la nueva versión, sin tiempo de inactividad del clúster. <br><br><img src="https://habrastorage.org/webt/zk/gb/4n/zkgb4n3ppub2pjxw5qobxhi3y6e.png"><br><br>  Kubernetes espera hasta que las nuevas cápsulas estén listas para trabajar (verificándolas con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pruebas de preparación</a> ) antes de comenzar a colapsar las antiguas.  Si se produce un problema, dicha actualización continua se puede interrumpir sin detener todo el clúster.  En el archivo de implementación tipo YAML, la nueva imagen reemplaza a la imagen anterior: <br><br><pre><code class="plaintext hljs">apiVersion: apps/v1beta1 kind: Deployment metadata: name: awesomeapp spec: replicas: 3 template: metadata: labels: app: awesomeapp spec: containers: - name: awesomeapp image: imagerepo-user/awesomeapp:new ports: - containerPort: 8080</code> </pre> <br>  Los parámetros para una actualización continua se pueden especificar en el archivo de manifiesto: <br><br><pre> <code class="plaintext hljs">spec: replicas: 3 strategy: type: RollingUpdate rollingUpdate: maxSurge: 25% maxUnavailable: 25% template: ...</code> </pre><br><h3>  Recreate (recreación) </h3><br>  En este tipo de despliegue más simple, las vainas viejas se matan de una vez y se reemplazan por otras nuevas: <br><br><img src="https://habrastorage.org/webt/s8/cc/f4/s8ccf4olujogufddg0vav3jhens.png"><br><br>  El manifiesto correspondiente se parece a esto: <br><br><pre> <code class="plaintext hljs">spec: replicas: 3 strategy: type: Recreate template: ...</code> </pre> <br><h3>  Azul / Verde (despliegue azul-verde) </h3><br>  La estrategia de implementación azul-verde (a veces también llamada rojo / negro, es decir, rojo-negro) implica el despliegue simultáneo de las versiones antigua (verde) y nueva (azul) de la aplicación.  Después de colocar ambas versiones, los usuarios comunes obtienen acceso al verde, mientras que el azul está disponible para que el equipo de QA automatice las pruebas a través de un servicio separado o reenvío directo de puertos: <br><br><img src="https://habrastorage.org/webt/th/zp/ee/thzpeewsyc4kfooyoffzlq7wsbg.png"><br><br><pre> <code class="plaintext hljs">apiVersion: apps/v1beta1 kind: Deployment metadata: name: awesomeapp-02 spec: template: metadata: labels: app: awesomeapp version: "02"</code> </pre> <br>  Una vez que se ha probado la versión azul (nueva) y se ha aprobado su lanzamiento, el servicio cambia a ella y se minimiza el verde (antiguo): <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Service metadata: name: awesomeapp spec: selector: app: awesomeapp version: "02" ...</code> </pre> <br><h3>  Canarias (despliegue canario) </h3><br>  Los rollos canarios se ven como azul verdoso, pero se manejan mejor y utilizan un enfoque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">progresivo por</a> pasos.  Este tipo incluye varias estrategias diferentes, incluidos los lanzamientos "ocultos" y las pruebas A / B. <br><br>  Esta estrategia se usa cuando es necesario experimentar alguna funcionalidad nueva, como regla, en el backend de la aplicación.  La esencia del enfoque es crear dos servidores casi idénticos: uno sirve a casi todos los usuarios y el otro, con nuevas características, solo sirve a un pequeño subconjunto de usuarios, después de lo cual se comparan sus resultados.  Si todo va bien, la nueva versión se está implementando gradualmente en toda la infraestructura. <br><br>  Aunque esta estrategia solo se puede implementar usando las herramientas de Kubernetes, reemplazando los pods viejos por otros nuevos, es mucho más conveniente y fácil usar una malla de servicio como Istio. <br><br>  Por ejemplo, puede tener dos manifiestos diferentes en Git: el normal con la etiqueta 0.1.0 y el "canario" con la etiqueta 0.2.0.  Al cambiar los pesos en el manifiesto de la puerta de enlace virtual Istio, puede controlar la distribución del tráfico entre estas dos implementaciones: <br><br><img src="https://habrastorage.org/webt/gi/sc/0j/gisc0jek9mx_ayulquedmg_fapi.png"><br><br>  Para un tutorial sobre la implementación de implementaciones canarias con Istio, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Flujos de trabajo de GitOps con Istio</a> .  <i>( <b>Nota de traducción</b> : También tradujimos material sobre rollos de canario en Istio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> ).</i> <br><br><h4>  Despliegues de Canarias con Weaveworks Flagger </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Weaveworks Flagger</a> hace que sea fácil y eficiente administrar implementaciones de canarios. <br><br>  Flagger automatiza el trabajo con ellos.  Utiliza Istio o AWS App Mesh para enrutar y cambiar el tráfico, así como las métricas de Prometheus para analizar los resultados.  Además, el análisis de las implementaciones canarias se puede complementar con webhooks para pruebas de aceptación, pruebas de estrés y cualquier otro tipo de verificación. <br><br>  Basado en la implementación de Kubernetes y, si es necesario, en el escalado horizontal de pod (HPA), Flagger crea conjuntos de objetos (implementaciones de Kubernetes, servicios ClusterIP y servicios virtuales Istio o App Mesh) para el análisis e implementación de implementaciones canarias: <br><br><img src="https://habrastorage.org/webt/-u/vo/wj/-uvowj-rfdu9kwnslkjfmxj1_p4.png"><br><br>  Implementando un <i>bucle de control</i> , Flagger cambia gradualmente el tráfico al servidor canario, mientras mide simultáneamente indicadores clave de rendimiento, como el porcentaje de solicitudes HTTP exitosas, la duración promedio de la solicitud y el estado del pod.  Según el análisis de KPI (indicadores clave de rendimiento), la porción canaria crece o se colapsa, y los resultados del análisis se publican en Slack.  Puede encontrar una descripción y una demostración de este proceso en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Progressive Delivery for App Mesh</a> . <br><br><img src="https://habrastorage.org/webt/gt/vc/o2/gtvco2gxt0zgw2iqy00bs892phe.png"><br><br><h3>  Despliegue oscuro (oculto) o A / B </h3><br>  El despliegue encubierto es otra variación de la estrategia canaria (Flagger también puede trabajar con ella, por cierto).  La diferencia entre los despliegues encubiertos y los canarios es que los despliegues encubiertos se ocupan de la interfaz y no del servidor, como los canarios. <br><br>  Otro nombre para estas implementaciones es prueba A / B.  En lugar de abrir el acceso a la nueva función a todos los usuarios, se ofrece solo a una parte limitada de ellos.  Por lo general, estos usuarios no saben que son probadores pioneros (de ahí el término "implementación encubierta"). <br><br>  Mediante el uso de <i>conmutadores de</i> función y otras herramientas, puede supervisar cómo los usuarios interactúan con la nueva función, si los cautiva o si encuentran que la nueva interfaz de usuario es confusa y otros tipos de métricas. <br><br><img src="https://habrastorage.org/webt/hs/gw/jo/hsgwjoo8bij97zvuhrv9evmix-s.png"><br><br><h4>  Despliegues de Flagger y A / B </h4><br>  Además del enrutamiento ponderado, Flagger también puede dirigir el tráfico al servidor canario, según la configuración de HTTP.  Para las pruebas A / B, puede usar encabezados HTTP o cookies para redirigir a un segmento específico de usuarios.  Esto es especialmente efectivo para aplicaciones frontend que requieren <i>afinidad de sesión</i> para el servidor.  Para obtener más información, consulte la documentación de Flagger. <br><br>  <i>El autor agradece a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Stefan Prodan</a> , ingeniero de Weaveworks (y creador de Flagger), por todas estas impresionantes implementaciones.</i> <br><br><h2>  PD del traductor </h2><br>  Lea también en nuestro blog: <br><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Descripción general y comparación de los controladores de Ingress para Kubernetes</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Werf es nuestra herramienta de CI / CD en Kubernetes (revisión e informe de video)</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Montaje y despliegue del mismo tipo de microservicios con werf y GitLab CI</a> "; </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¿Qué es GitOps?</a>  ". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471620/">https://habr.com/ru/post/471620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471604/index.html">No te olvides de Open Graph</a></li>
<li><a href="../471608/index.html">Sistema para evitar colisiones: Parte 1. Legislación como conocimientos tradicionales para el desarrollador</a></li>
<li><a href="../471610/index.html">Servidor REST en Prolog, ¿cómo se ve?</a></li>
<li><a href="../471614/index.html">Versión Rustup 1.20.0: soporte para perfiles, mejoras en la actualización y comandos de documentación</a></li>
<li><a href="../471618/index.html">C / C ++ de Python (impulso)</a></li>
<li><a href="../471622/index.html">Xamarin.Forms: un ejemplo simple de emulación de tarjeta basada en host</a></li>
<li><a href="../471624/index.html">Dar una presentación con un diseño UI / UX perfecto</a></li>
<li><a href="../471626/index.html">IA para las personas: palabras simples sobre tecnología</a></li>
<li><a href="../471628/index.html">Yo solo refactoré 15 mil líneas heredadas. Fueron las peores dos semanas de mi vida.</a></li>
<li><a href="../471630/index.html">Placer prohibido: en qué países está bloqueado PornHub y por qué</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>