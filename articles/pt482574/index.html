<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüé® üé± üåµ Esta√ß√£o de trabalho criptogr√°fica de chave p√∫blica com base em padr√µes para a plataforma Android üå≤ üë®üèø‚Äçüöí üëãüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√â hora de demonstrar como a esta√ß√£o de trabalho criptogr√°fica baseada em padr√µes de chave p√∫blica cryptoarmpkcs funciona em uma das plataformas m√≥veis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Esta√ß√£o de trabalho criptogr√°fica de chave p√∫blica com base em padr√µes para a plataforma Android</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482574/"><img src="https://habrastorage.org/webt/wk/yl/uo/wkyluohcupxsoers-aqpuyn9sje.png" alt="imagem" width="150" align="left">  √â hora de demonstrar como a esta√ß√£o de trabalho criptogr√°fica baseada em <a href="https://habr.com/ru/post/476210/">padr√µes de</a> chave p√∫blica <a href="https://habr.com/ru/post/476210/">cryptoarmpkcs</a> funciona em uma das plataformas m√≥veis, a saber, o Android. <br><br>  O conceito estabelecido durante o desenvolvimento do utilit√°rio cryptoarmpkcs √© que o usu√°rio deve experimentar um m√≠nimo de inconveni√™ncia ao criar e verificar uma assinatura eletr√¥nica.  √â por isso que propomos o uso <a href="https://habr.com/ru/post/400943/">de</a> tokens criptogr√°ficos <a href="https://habr.com/ru/post/400943/">PKCS # 11</a> e / ou cont√™ineres <a href="https://habr.com/ru/post/460205/">PKCS # 12</a> como meio-chave para um certificado pessoal.  Devo dizer que o uso do PKCS # 12 em muitos casos √© quase o √∫nico poss√≠vel, por exemplo, quando os tokens do PKCS # 11 n√£o s√£o suportados para determinadas plataformas. <a name="habracut"></a>  Por isso, decidimos come√ßar a portar o utilit√°rio cryptoarmpkcs para a plataforma Android com suporte para cont√™ineres seguros PKCS # 12. <br><br>  Imediatamente, observamos que, como o projeto foi realizado nas plataformas C e Tcl / Tk, a transfer√™ncia n√£o causou dificuldades fundamentais.  Isso foi poss√≠vel gra√ßas √† tecnologia <a href="https://www.androwish.org/home/home" rel="nofollow">Androwish</a> .  N√£o houve problemas com a implanta√ß√£o e a <a href="https://www.androwish.org/home/wiki%3Fname%3DAndroWish%2BSDK" rel="nofollow">configura√ß√£o do ambiente</a> (meu ambiente de trabalho √© Linux - Mageia-7.0).  Darei a voc√™ apenas um script para implantar as Ferramentas de Linha de Comando do Android (sdk-tools-linux-xxxx.zip): <br><br><pre><code class="plaintext hljs">#!/bin/sh if [ $# -ne 1 ] then echo "./InstallAndroidSDK.sh &lt;sdk-tools-linux-xxxxxxxx.zip&gt;" echo "       1" exit 1 fi if [ ! -f $1 ] then echo "./InstallAndroidSDK.sh &lt;sdk-tools-linux-xxxxxxxx.zip&gt;" echo " $1 " exit 1 fi # SDK-TOOLS   tools #unzip sdk-tools-linux-4333796.zip unzip $1 #  android-sdk-linux mkdir android-sdk-linux #  tools  android-sdk-linux mv tools android-sdk-linux cd android-sdk-linux/tools/bin ./sdkmanager "platform-tools" "platforms;android-29"</code> </pre> <br>  O mais not√°vel √© que o ambiente androwish inclui dois int√©rpretes, undrowish-xxx e vanillawish-xxx, cuja composi√ß√£o √© completamente id√™ntica √† balalaica (pacotes) que na verdade fazem parte do andrewow.  A diferen√ßa entre undrowish e vanillawish √© que no vanillawish o back-end √© baseado no tipo SDL / AGG / freet: <br><br><img src="https://habrastorage.org/webt/z9/bh/0i/z9bh0i5sthrh3rw91ryufxe2r6e.png"><br><br>  A presen√ßa desses dois utilit√°rios permite que voc√™ desenvolva um aplicativo sem usar o pr√≥prio Android e seu emulador com a m√°xima aproxima√ß√£o ao dispositivo real.  Antes de tudo, √© claro, undroidwish-xxx. <br><br>  O pr√≥prio pacote Android personalizado foi criado no ambiente AWSDK.  A √°rvore do seu projeto deve ser movida e a pasta ~ / AWSDK / assets / app.  Nesse caso, o m√≥dulo principal do seu projeto deve ser renomeado para main.tcl.  Se voc√™ usar balalaikas adicionais com bibliotecas din√¢micas, as bibliotecas dever√£o ser colocadas nas pastas ~ / AWSDK / libs / x86 para o emulador e ~ / AWSDK / libs / armeabi para o dispositivo real. <br><br>  Depois disso, basta executar o comando: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$wish</span></span> ~/AWSDK/tools/bones</code> </pre> <br>  e siga as instru√ß√µes dela: <br><br><img src="https://habrastorage.org/webt/xc/cw/oz/xccwozk2wqru-phbemgfb-zwju0.png"><br><br>  O pacote apk coletado estar√° na pasta ~ / AWSDK / build / outputs / apk. <br><br>  Se voc√™ tiver um dispositivo ou emulador real conectado, o pacote poder√° ser instalado imediatamente. <br>  Nesse caso, o dispositivo real deve estar no modo de depura√ß√£o. <br><br>  Mas voltando ao aplicativo em si.  O que tinha que ser mudado nele. <br><br>  Naturalmente, primeiro, as altera√ß√µes est√£o relacionadas ao tamanho da tela.  Eu tive que redesenhar a principal (janela inicial).  Como resultado, em vez de uma √∫nica janela em um computador comum: <br><br><img src="https://habrastorage.org/webt/k_/03/ga/k_03gaygu5xrm1pdkctclsrg6hi.png" width="700"><br><br>  Apareceram tr√™s janelas no Android: <br><br><img src="https://habrastorage.org/webt/ap/je/d-/apjed-0aw70egcpccbk14hhyk7i.png"><br><br>  A primeira janela √© informativa.  Convencionalmente, √© dividido em v√°rias partes.  A primeira parte, localizada na parte superior, cont√©m o nome do utilit√°rio e seu logotipo. <br><br>  Em seguida, vem o logotipo do fabricante, a ajuda de informa√ß√µes e tr√™s bot√µes para completar a p√°gina. <br>  A p√°gina √© gravada usando o componente de tela.  Existem dois tipos de bot√µes na p√°gina: um na forma de um ret√¢ngulo transl√∫cido (meio) e os outros dois na forma de um ret√¢ngulo arredondado.  Para criar bot√µes com cantos arredondados, <a href="http://tclbitprint.sourceforge.net/" rel="nofollow">foi utilizado o tkpath</a> "balalaica".  Pessoalmente, essa balalaica causou uma impress√£o muito boa em mim.  Naturalmente, ao trabalhar com telas, a maior parte do c√≥digo √© geometria.  A seguir est√° o script create_titul_page.tcl para criar a primeira p√°gina do aplicativo.  Todo mundo pode edit√°-lo para se adequar √† sua vis√£o. <br><br><div class="spoiler">  <b class="spoiler_title">Script create_titul_page.tcl</b> <div class="spoiler_text"><pre> <code class="bash hljs">package require Tk package require tkpath 0.3.0 global mydir <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> mydir [file dirname [info script]] <span class="hljs-comment"><span class="hljs-comment">#  #  image create photo logo_product -file [file join $mydir "imageme" "validcertkey_51x24.png"] #  image create photo logo_orel -file [file join $mydir "imageme" "__425x200.png"] -format "png -alpha 1.0" #  tcl/tk image create photo logo_and -file [file join $mydir "imageme" "AndTk_inv_147x173.png"] -format "png -alpha 1.0" #  image create photo svitok -file [file join $mydir "imageme" "blue_svitok.png"] -format "png -alpha 1.0" # image create photo tileand -file [file join $mydir "imageme" "tile_green_and_32x32.png"] -format "png -alpha 1.0" #/ (  - ) proc scaleImage {im xfactor {yfactor 0}} { set mode -subsample if {$xfactor&gt;=0 &amp;&amp; $yfactor&gt;=0} { set mode -zoom } else { set xfactor [expr $xfactor * -1] } if {$yfactor == 0} {set yfactor $xfactor} set t [image create photo] $t copy $im $im blank $im copy $t -shrink $mode $xfactor $yfactor image delete $t } proc createtile {w backg} { image create photo tiled tiled copy $backg -to 0 0 $::scrwidth $::scrheight -shrink $backg copy tiled image delete tiled #   $w create image 0 0 \ -image $backg \ -anchor nw } proc create_rectangle {canv img x1 y1 x2 y2 color alfa {wbd 0} {colorline black} } { image create photo $img -format "default -colorformat rgb" set rgb1 [winfo rgb $canv $color] set cr [lindex $rgb1 0] set cg [lindex $rgb1 1] set cb [lindex $rgb1 2] set fill [format "#%04x%04x%04x" $cr $cg $cb ] #   $img put $fill -to 0 0 [expr {$x2 - $x1}] [expr {$y2 -$y1}] #  set dimg [$img data -format png] # image   alpha  image create photo $img -data $dimg -format "png -alpha $alfa" # $img put [list $rgb1] -to 0 0 [expr {$x2 - $x1}] [expr {$y2 -$y1}] #   set imgr [$canv create image $x1 $y1 -image $img -anchor nw] set cc [subst {butImg $img}] $canv bind $imgr &lt;ButtonPress-1&gt; $cc #    if {$wbd &gt; 0 } { set item [$canv create rect $x1 $y1 $x2 $y2 -outline $colorline -width $wbd ] $canv bind $item &lt;ButtonPress-1&gt; $cc } return $imgr } proc butImg {img} { tk_messageBox -title "" -icon info -message " =$img" -detail "::screenwidth=$::scrwidth\n::screenheight=$::scrheight" -parent . if {$img == "exit"} { set answer [tk_dialog .dialog2 " " " \n ?" question 0 "" "" ] if {$answer == 0} { exit } } } proc page_titul {fr logo_manufacturer} { global mydir #     tkp::canvas $fr.can -borderwidth 0 -height [winfo screenheight .] -width [winfo screenwidth .] -relief flat #   createtile "$fr.can" "tileand" pack $fr.can -anchor center -expand 1 -fill both -side top -padx 0 -pady 0 #     #update        update # set aa [winfo height $fr.labtitul] set aa $::padly #   set ha [image width $logo_manufacturer] set xman [expr {($::scrwidth - $ha) / 2 }] $fr.can create image $xman $aa -image $logo_manufacturer -anchor nw -tag tag_logo set blogo [$fr.can bbox tag_logo] set wexit [lindex $blogo 3] if {$::typetlf } { set dlx [expr {$::padlx / 1}] $fr.can create text [expr $dlx + 6] [expr {$wexit + $::padly + 6}] -anchor nw -text " " -fill black -font {{Roboto Condensed Medium} 15 } $fr.can create text $dlx [expr {$wexit + $::padly}] -anchor nw -text " " -fill white -font {{Roboto Condensed Medium} 15 } -tag id_text0 update set blogo [$fr.can bbox id_text0] set wexit [lindex $blogo 3] $fr.can create text [expr $dlx + 4] [expr {$wexit + $::padly + 4 - 80}] -anchor nw -text "  Android" -fill black -font {{Roboto Condensed Medium} 13} $fr.can create text $dlx [expr {$wexit + $::padly - 80}] -anchor nw -text "  Android" -fill white -font {{Roboto Condensed Medium} 13} -tag id_text1 set blogo [$fr.can bbox id_text1] set wexit [lindex $blogo 3] $fr.can create text [expr $dlx + 3] [expr {$wexit + $::padly + 3 - 50}] -anchor nw -text "‚Ññ 63  \" \n  6  2011 \"" -fill black -font {{Roboto} 10} $fr.can create text $dlx [expr {$wexit + $::padly - 50}] -anchor nw -text "‚Ññ 63  \" \n  6  2011 \"" -fill white -font {{Roboto} 10} -tag id_text2 set blogo [$fr.can bbox id_text2] set wexit [lindex $blogo 3] $fr.can create text [expr $dlx + 2] [expr {$wexit + $::padly + 2 - 40}] -text ": .. \nhttp://soft.lissi.ru, http://www.lissi.ru\n+7(495)589-99-53\ne-mail: support@lissi.ru\n\n" \ -anchor nw -fill black -font {{Roboto} 9} $fr.can create text $dlx [expr {$wexit + $::padly - 40}] -text ": .. \nhttp://soft.lissi.ru, http://www.lissi.ru\n+7(495)589-99-53\ne-mail: support@lissi.ru\n\n" \ -anchor nw -fill white -tag id_text3 -font {{Roboto} 9} } else { $fr.can create text [expr $::padlx + 2] [expr {$wexit + $::padly + 2}] -anchor nw -text " " -fill black -font {{Nimbus Sans Narrow} 20} $fr.can create text $::padlx [expr {$wexit + $::padly}] -anchor nw -text " " -fill white -font {{Nimbus Sans Narrow} 20} -tag id_text0 set blogo [$fr.can bbox id_text0] set wexit [lindex $blogo 3] $fr.can create text [expr $::padlx + 2] [expr {$wexit + $::padly + 2 - 20}] -anchor nw -text "  Android" -fill black -font {{Nimbus Sans Narrow} 18} $fr.can create text $::padlx [expr {$wexit + $::padly - 20}] -anchor nw -text "  Android" -fill white -font {{Nimbus Sans Narrow} 18} -tag id_text1 set blogo [$fr.can bbox id_text1] set wexit [lindex $blogo 3] $fr.can create text [expr $::padlx + 2] [expr {$wexit + $::padly + 2}] -anchor nw -text "‚Ññ 63  \" \n  6  2011 \"" -fill black -font {{Nimbus Sans Narrow} 14} $fr.can create text $::padlx [expr {$wexit + $::padly}] -anchor nw -text "‚Ññ 63  \" \n  6  2011 \"" -fill white -font {{Nimbus Sans Narrow} 14} -tag id_text2 set blogo [$fr.can bbox id_text2] set wexit [lindex $blogo 3] $fr.can create text [expr $::padlx + 1] [expr {$wexit + $::padly + 1}] -text ": .. \nhttp://soft.lissi.ru, http://www.lissi.ru\n+7(495)589-99-53\ne-mail: support@lissi.ru\n\n" \ -anchor nw -fill black -font {{Nimbus Sans Narrow} 12} $fr.can create text $::padlx [expr {$wexit + $::padly}] -text ": .. \nhttp://soft.lissi.ru, http://www.lissi.ru\n+7(495)589-99-53\ne-mail: support@lissi.ru\n\n" \ -anchor nw -fill white -tag id_text3 -font {{Nimbus Sans Narrow} 12} -tag id_text3 set blogo [$fr.can bbox id_text2] } set blogo [$fr.can bbox id_text3] set wland [lindex $blogo 3] $fr.can create image $::padlx $wland -image logo_and -anchor nw -tag tag_land set ha [image height logo_and] set wa [image width logo_and] set ha1 [expr {$ha - ($ha / 2 ) }] $fr.can create image [expr {$wa - 80 }] [expr {$wland + $ha1}] -image svitok -anchor nw -tag tag_land if {$::typetlf} { set x1 [expr {$::padlx / 2}] set y1 [expr {$wland + 120}] set x2 [expr {$::::scrwidth - $x1}] set y2 [expr {$y1 + 120}] set wd 8 set rr 18 } else { set x1 [expr {$::padlx / 2}] set y1 [expr {$wland + 40}] set x2 [expr {$::::scrwidth - $x1}] set y2 [expr {$y1 + 40}] set wd 4 set rr 6 } set g5 [$fr.can gradient create linear -stops {{0 lightgreen} {1 green}}] set S3 [$fr.can style create -stroke "skyblue" -fill $g5 -strokewidth $wd -fillopacity 0.6] set im1 [$fr.can create prect $x1 $y1 $x2 $y2 -rx $rr -style $S3] $fr.can bind $im1 &lt;ButtonPress-1&gt; {butImg "img1"} #  set blogo [$fr.can bbox $im1] set by2 [lindex $blogo 3] set by1 [lindex $blogo 1] set bb [expr {($by2 - $by1) / 2}] set bx2 [lindex $blogo 2] set bx1 [lindex $blogo 0] set bbx [expr {($bx2 - $bx1) / 2}] set txt1 [$fr.can create text [expr {$x1 + $::padlx * 2}] [expr {$y1 + 1 }] -anchor nw -text " " -fill black -font {{Arial} 10 normal}] #  set btxt1 [$fr.can bbox $txt1] #   Y set ty2 [lindex $btxt1 3] set ty1 [lindex $btxt1 1] set tt [expr {$ty2 - $ty1}] set tt [expr {$tt / 2}] set offsy [expr {($by1 + $bb) - ($ty1 + $tt)}] #   X set tx2 [lindex $btxt1 2] set tx1 [lindex $btxt1 0] set ttx [expr {$tx2 - $tx1}] set ttx [expr {$ttx / 2}] set offsx [expr {($bx1 + $bbx) - ($tx1 + $ttx)}] $fr.can move $txt1 $offsx $offsy $fr.can bind $txt1 &lt;ButtonPress-1&gt; {butImg "img1"} if {$::typetlf} { set y1 [expr $y2 + 40] set x2 [expr {$::::scrwidth - $x1}] set y2 [expr {$y1 + 120}] } else { set y1 [expr {$y1 + 60}] set x2 [expr {$::::scrwidth - $x1}] set y2 [expr {$y1 + 40}] } set im1 [create_rectangle $fr.can "but2" $x1 $y1 $x2 $y2 "#2b972d" 0.6 $wd "skyblue"] #  set blogo [$fr.can bbox $im1] set by2 [lindex $blogo 3] set by1 [lindex $blogo 1] set bb [expr {($by2 - $by1) / 2}] set bx2 [lindex $blogo 2] set bx1 [lindex $blogo 0] set bbx [expr {($bx2 - $bx1) / 2}] set txt1 [$fr.can create text [expr {$x1 + $::padlx * 2}] [expr {$y1 + 1 }] -anchor nw -text "   " -fill black -font {{Roboto Condensed Medium} 12}] #  set btxt1 [$fr.can bbox $txt1] #   Y set ty2 [lindex $btxt1 3] set ty1 [lindex $btxt1 1] set tt [expr {$ty2 - $ty1}] set tt [expr {$tt / 2}] set offsy [expr {($by1 + $bb) - ($ty1 + $tt)}] #   X set tx2 [lindex $btxt1 2] set tx1 [lindex $btxt1 0] set ttx [expr {$tx2 - $tx1}] set ttx [expr {$ttx / 2}] set offsx [expr {($bx1 + $bbx) - ($tx1 + $ttx)}] $fr.can move $txt1 $offsx $offsy $fr.can bind $txt1 &lt;ButtonPress-1&gt; {butImg "but2"} if {$::typetlf} { set x1 [expr {$::padlx / 2}] set y1 [expr $y2 + 40] set x2 [expr {$::::scrwidth - $x1}] set y2 [expr {$y1 + 120}] } else { set x1 [expr {$::padlx / 2}] set y1 [expr {$y1 + 60}] set x2 [expr {$::::scrwidth - $x1}] set y2 [expr {$y1 + 40}] } set S3 [$fr.can style create -stroke skyblue -fill $g5 -strokewidth $wd -fillopacity 0.6] set im1 [$fr.can create prect $x1 $y1 $x2 $y2 -rx $rr -style $S3] set blogo [$fr.can bbox $im1] $fr.can bind $im1 &lt;ButtonPress-1&gt; {butImg "exit"} set by2 [lindex $blogo 3] set by1 [lindex $blogo 1] set bb [expr {($by2 - $by1) / 2}] set bx2 [lindex $blogo 2] set bx1 [lindex $blogo 0] set bbx [expr {($bx2 - $bx1) / 2}] set txt1 [$fr.can create text [expr {$x1 + $::padlx * 2}] [expr {$y1 + 1 }] -anchor nw -text " " -fill black -font {Arial 10 normal}] $fr.can bind $txt1 &lt;ButtonPress-1&gt; {butImg "exit"} set btxt1 [$fr.can bbox $txt1] #   Y set ty2 [lindex $btxt1 3] set ty1 [lindex $btxt1 1] set tt [expr {$ty2 - $ty1}] set tt [expr {$tt / 2}] set offsy [expr {($by1 + $bb) - ($ty1 + $tt)}] #   X set tx2 [lindex $btxt1 2] set tx1 [lindex $btxt1 0] set ttx [expr {$tx2 - $tx1}] set ttx [expr {$ttx / 2}] set offsx [expr {($bx1 + $bbx) - ($tx1 + $ttx)}] $fr.can move $txt1 $offsx $offsy } #  #   set ::scrwidth [winfo screenwidth .] set ::scrheight [winfo screenheight .] set ::typetlf 0 #,    if {$::scrwidth &lt; $::scrheight} { set ::typetlf 1 } set ::padls 20 set ::padlx 15 set ::padly 15 if {$::typetlf} { wm attributes . -fullscreen 1 scaleImage icon_openfile_18x16 3 scaleImage ::img::view_18x16 3 #  scaleImage logo_orel 2 #  scaleImage logo_product 2 # tcl/tk scaleImage logo_and 3 #  scaleImage svitok 4 set ::padls 50 set ::padlx 75 set ::padly 50 } else { #    scaleImage logo_orel -2 set ::scrwidth 370 set ::scrheight 700 wm minsize . $::scrwidth $::scrheight set geometr $::scrwidth append geometr "x" append geometr $::scrheight append geometr "+0+0" wm geometry . $geometr } #   set name_product "CryptoArmPKCS-A" label .labtitul -image logo_product -compound left -fg snow -text $name_product -font {Arial 10 bold} -anchor w -width [winfo screenwidth .] -pady $::padls -padx 10 -bg #222222 pack .labtitul -anchor nw -expand 0 -fill x -side top -padx 1 -pady 0 #   set i 0 ttk::frame .fr$i -pad 0 -padding 0 page_titul ".fr$i" "logo_orel" pack .fr$i -side top -anchor center -expand 1 -fill both -side top -padx 0 -pady 0 update</span></span></code> </pre> <br></div></div><br>  Para executar este script, use um dos utilit√°rios undroidwish ou vanillawish: <br><br><pre> <code class="bash hljs">$ /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin64/undroidwish-e5dc71ed9d-linux64 create_titul_page.tcl</code> </pre> <br>  ou <br><br><pre> <code class="bash hljs">$/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin64/vanillawish-e5dc71ed9d-linux64 create_titul_page.tcl</code> </pre> <br>  O resultado √© mostrado na primeira captura de tela. <br><br>  A segunda p√°gina lista a funcionalidade suportada pelo utilit√°rio cryptoarmpkcs-A.  Cada linha √© um bot√£o; quando clicada, uma p√°gina funcional ser√° exibida.  A geometria dos bot√µes nesta p√°gina √© determinada pela fonte usada.  A seguir, o script create_page_functions.tcl para criar a segunda p√°gina / funcional do aplicativo.  Todos tamb√©m podem edit√°-lo para suas fun√ß√µes. <br><br><div class="spoiler">  <b class="spoiler_title">Script create_page_functions.tcl</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">package require Tk package require tkpath 0.3.0 global mydir set mydir [file dirname [info script]] #/ (  - ) proc scaleImage {im xfactor {yfactor 0}} { set mode -subsample if {$xfactor&gt;=0 &amp;&amp; $yfactor&gt;=0} { set mode -zoom } else { set xfactor [expr $xfactor * -1] } if {$yfactor == 0} {set yfactor $xfactor} set t [image create photo] $t copy $im $im blank $im copy $t -shrink $mode $xfactor $yfactor image delete $t } proc createtile {w backg} { image create photo tiled tiled copy $backg -to 0 0 $::scrwidth $::scrheight -shrink $backg copy tiled image delete tiled #   $w create image 0 0 \ -image $backg \ -anchor nw } proc butCliked {num fr} { pack forget .fr1 set ::tekFrfunc $fr pack $fr -side top -anchor center -expand 1 -fill both -side top -padx 0 -pady 0 tk_dialog .dialog1 "Dear user:" "Button $num was clicked\nFr=$fr" info 0 OK } proc butImg {img} { tk_messageBox -title "" -icon info -message " =$img" -detail "::screenwidth=$::scrwidth\n::screenheight=$::scrheight" -parent . if {$img == "exit"} { set answer [tk_dialog .dialog2 " " " \n ?" question 0 "" "" ] if {$answer == 0} { exit } } } proc butReturn {} { pack forget $::tekFrfunc pack .fr1 -side top -anchor center -expand 1 -fill both -side top -padx 0 -pady 0 # tk_dialog .dialog1 "Dear user:" "Button $num was clicked\nFr=$fr" info 0 OK } proc page_func {fr tile titul functions} { #  upvar $functions but #    if {$::typetlf} { set feFONT_button "-family {Roboto} -size 9 -weight bold -slant roman" set widl 10 } else { set feFONT_button "-family {Arial} -size 12 -weight bold -slant roman" set widl 5 } catch {font delete fontTEMP_drawer} eval font create fontTEMP_drawer $feFONT_button #    set drawerCNT 0 set strMaxWidthPx 15 set Ndrawers [expr {[array size but] - 1}] while { $drawerCNT &lt;= $Ndrawers } { set strWidthPx [font measure fontTEMP_drawer "$but($drawerCNT)"] if { $strWidthPx &gt; $strMaxWidthPx } { set strMaxWidthPx $strWidthPx } incr drawerCNT } set drawerWidthPx [expr $strMaxWidthPx + 10] set xxx [expr {($::::scrwidth - $drawerWidthPx) / 2}] if {$fr != ".fr1"} { set hret [expr $::scrheight / 4] } else { set hret $::scrheight } set hret [expr $::scrheight / 4] tkp::canvas $fr.can -borderwidth 0 -height $hret -width $::scrwidth -relief flat #   createtile "$fr.can" $tile pack $fr.can -anchor center -expand 1 -fill both -side top -padx 0 -pady 0 if {$titul != "" } { set allfunc $titul catch {font delete fontTEMP_titul} set font_titul "-family {Roboto Condensed Medium} -size 15" eval font create fontTEMP_titul $font_titul set funcWidthPx [font measure fontTEMP_titul "$allfunc"] set dlx [expr {($::::scrwidth - $funcWidthPx) / 2}] $fr.can create text [expr $dlx + 6] [expr {6 + 6}] -anchor nw -text "$allfunc" -fill black -font fontTEMP_titul $fr.can create text $dlx 6 -anchor nw -text "$allfunc" -fill white -font fontTEMP_titul -tag id_text0 set blogo [$fr.can bbox id_text0] set boxbut [expr ([lindex $blogo 3] + 6 + 6)] } else { set boxbut [expr 6 + 6] } #      #.  #  set BDwidth_canvas 0 set maxTextHeightPx [font metrics fontTEMP_drawer -linespace] set maxTextHeightPx [expr {$maxTextHeightPx + ( $maxTextHeightPx / 2)}] set drawerHeightPx $maxTextHeightPx set xLocTextPx [expr {($::::scrwidth - $drawerWidthPx) / 2}] set yLocTextPx [expr $BDwidth_canvas + ($drawerHeightPx / 2) + $boxbut] set canvasHeightPx [expr $Ndrawers * $drawerHeightPx] set drawerCNT 0 set Ndrawers [expr {[array size but] - 1}] while { $drawerCNT &lt;= $Ndrawers } { set yLineLocPx [ expr (( $drawerCNT ) * $drawerHeightPx + $boxbut)] #   $fr.can create line \ $xLocTextPx $yLineLocPx \ [expr $drawerWidthPx + $xLocTextPx] $yLineLocPx \ -fill "#a0a0a0" -width $widl $fr.can create text [expr $xLocTextPx + 5] $yLocTextPx \ -anchor w \ -font fontTEMP_drawer \ -text "$but($drawerCNT)" \ -tag textlineTag($drawerCNT) if {$drawerCNT == 0} { if {$fr == ".fr1"} { $fr.can bind textlineTag($drawerCNT) &lt;ButtonRelease-1&gt; {butImg "but1"} } else { $fr.can bind textlineTag($drawerCNT) &lt;ButtonRelease-1&gt; {butReturn} } } else { frame .fn$drawerCNT -background white -relief flat -pady 0 -padx 0 set titul $but($drawerCNT) set cmd "$fr.can bind textlineTag($drawerCNT) &lt;ButtonRelease-1&gt; {butCliked $drawerCNT .fn$drawerCNT}" set cmd [subst "$cmd"] eval $cmd set but1(0) "   " page_func ".fn$drawerCNT" voda "$titul" "but1" } incr drawerCNT set yLocTextPx [ expr $yLocTextPx + $drawerHeightPx] #  if { $drawerCNT &gt; $Ndrawers } { set yLineLocPx [ expr (( $drawerCNT ) * $drawerHeightPx + $boxbut)] $fr.can create line $xLocTextPx $yLineLocPx \ [expr $drawerWidthPx + $xLocTextPx] $yLineLocPx \ -fill "#a0a0a0" -width $widl } } } #  #   set ::scrwidth [winfo screenwidth .] set ::scrheight [winfo screenheight .] set ::typetlf 0 #,    if {$::scrwidth &lt; $::scrheight} { set ::typetlf 1 } set ::padls 20 set ::padlx 15 set ::padly 15 if {$::typetlf} { wm attributes . -fullscreen 1 #  scaleImage logo_product 2 set ::padls 50 set ::padlx 75 set ::padly 50 } else { #    set ::scrwidth 370 set ::scrheight 700 wm minsize . $::scrwidth $::scrheight set geometr $::scrwidth append geometr "x" append geometr $::scrheight append geometr "+0+0" wm geometry . $geometr } #  image create photo voda -file [file join $mydir "imageme" "voda_400x800.png"] #  image create photo logo_product -file [file join $mydir "imageme" "validcertkey_51x24.png"] #   set name_product "CryptoArmPKCS-A" label .labtitul -image logo_product -compound left -fg snow -text $name_product -font {Arial 10 bold} -anchor w -width [winfo screenwidth .] -pady $::padls -padx 10 -bg #222222 pack .labtitul -anchor nw -expand 0 -fill x -side top -padx 1 -pady 0 #    set i 1 ttk::frame .fr$i -pad 0 -padding 0 #   set but(0) " " set but(1) " " set but(2) "   (PKCS7)" set but(3) "  " set but(4) " /" set but(5) " " set but(6) " ASN1-" set but(7) " " set but(8) "  PKCS12/PFX" set but(9) " " set but(10) " /" set but(11) " " set but(12) " " if {$::typetlf} { scaleImage voda 3 2 } #    page_func ".fr$i" voda "" "but" #    pack .fr$i -side top -anchor center -expand 1 -fill both -side top -padx 0 -pady 0</code> </pre> <br></div></div><br>  Este script tamb√©m prepara espa√ßos em branco para cada bot√£o de fun√ß√£o: <br><br><img src="https://habrastorage.org/webt/fj/c-/c3/fjc-c36qj38izh7addk9xwfko1e.png" width="700"><br><br>  Os espa√ßos em branco s√£o preenchidos com widgets cl√°ssicos e tem√°ticos (quadro de etiqueta, bot√£o etc.).  Uma dessas telas preenchidas pode ser vista na primeira captura de tela √† direita.  Como no primeiro est√°gio, focamos no trabalho com o cont√™iner PKCS # 12, o c√≥digo foi usado quase sem altera√ß√µes no cryptoarmpkcs-A.  Nesta fase, as seguintes fun√ß√µes s√£o implementadas: <br><br><ul><li>  Assine o documento (Cades-BES, CAdes-T, CAdes-XLT1); </li><li>  Trabalhamos com ES (PKCS7), incluindo a adi√ß√£o de um assinante; </li><li>  Exibir certificados / solicita√ß√µes de certificado: <br><br><img src="https://habrastorage.org/webt/9r/da/9k/9rda9ke9orswhxlrprakaq0fuk4.jpeg" width="700"></li><li>  Trabalhamos com PKCS12 / PFX; </li><li>  Sobre Utilit√°rios / Distribui√ß√µes: <br><br><img src="https://habrastorage.org/webt/xp/xd/o4/xpxdo41xj5nrfvmjikqcjsan9zu.jpeg" width="700"></li></ul><br>  Outras fun√ß√µes est√£o mais relacionadas aos tokens PKCS # 11.  A sua portabilidade √© adiada para o Ano Novo.  Est√° planejado conectar um token de software e uma <a href="https://habr.com/ru/post/403563/">nuvem de tokens</a> . <br><br>  Do ponto de vista da funcionalidade, quase tudo √© semelhante ao utilit√°rio cryptoarmpkcs.  Mas existem algumas diferen√ßas.  Por exemplo, depois de assinar um documento, o utilit√°rio pergunta se a assinatura ser√° verificada no site dos Servi√ßos de Estado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ua/9z/r3/ua9zr3bq-ozzvlulrgh9g2rpu_a.png" width="300"></div><br>  Quando voc√™ clica em Sim, um navegador ser√° carregado com uma p√°gina para verificar a assinatura de documentos e certificados.  Fa√ßa imediatamente uma reserva de que esta p√°gina n√£o foi muito projetada para a tela de um smartphone.  Isso ser√° percept√≠vel ao escolher uma assinatura e, se a assinatura for desconectada, o arquivo com o documento.  Mas se tudo estiver bem, obteremos um resultado positivo: <br><br><img src="https://habrastorage.org/webt/rw/w1/59/rww159ldlgdtmaswjcgap3vt5dg.jpeg"><br><br>  Deve-se ter em mente que a verifica√ß√£o da assinatura e do certificado no site do Servi√ßo de Estado s√≥ √© desbotada se o certificado foi recebido em um centro de certifica√ß√£o credenciado.  Caso contr√°rio, a assinatura sempre ser√° inv√°lida. <br><br>  Para chamar o navegador, tive que adicionar algumas linhas ao procedimento openUrl: <br><br><pre> <code class="plaintext hljs">proc openURL {url} { global typesys global macos # global windowsOS #,      Android if {$::typetlf} { #  borg activity android.intent.action.VIEW $url text/html return } . . . }</code> </pre> <br>  O navegador Android √© chamado da seguinte maneira: <br><br><pre> <code class="plaintext hljs">borg activity android.intent.action.VIEW &lt;URL&gt; text/html</code> </pre><br>  Um pequeno recurso √© ao adicionar um novo assinante a um documento assinado anteriormente.  O certificado do novo assinante (ou melhor, mesmo o cont√™iner PKCS # 12 com o certificado e a chave privada) deve ser pr√©-selecionado na p√°gina "Assinar um documento" ou "Trabalhar com PKCS12 / PFX", que o utilit√°rio lembrar√°: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kf/lt/bn/kfltbnylcgqsgofdkjeroxglmuu.png" width="300"></div><br>  Nas opera√ß√µes de longo prazo, o rel√≥gio continua como antes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4a/9b/4k/4a9b4kldtawc1yhvviwwxret2la.png" width="300"></div><br>  Resta dizer onde baixar distribui√ß√µes e parab√©ns pelo pr√≥ximo ano novo e desejar a todos tudo de bom para 2020! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7b/c91/bd6/d7bc91bd6cd0ccd324e119282e6c04b8.png" alt="imagem" align="left" width="200">  Ent√£o, distribui√ß√µes para Linux, OS X, Windows e Android: <br><br><ul><li>  <a href="" rel="nofollow">Linux32</a> </li><li>  <a href="" rel="nofollow">Linux64</a> </li><li>  <a href="" rel="nofollow">OS X</a> </li><li>  <a href="" rel="nofollow">WIN32</a> </li><li>  <a href="" rel="nofollow">WIN64</a> </li><li>  <a href="" rel="nofollow">AndroWishApp-debug.apk</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt482574/">https://habr.com/ru/post/pt482574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt482564/index.html">Se todas as hist√≥rias foram escritas no estilo de fic√ß√£o cient√≠fica</a></li>
<li><a href="../pt482566/index.html">A √∫ltima gera√ß√£o de redes sem fio</a></li>
<li><a href="../pt482568/index.html">Hist√≥ria do porn√¥ na Internet. Parte 2</a></li>
<li><a href="../pt482570/index.html">Switches ExtremeSwitching X465. Gigabit Universal e Multigigabit</a></li>
<li><a href="../pt482572/index.html">O homem que criou o "pior videogame do mundo"</a></li>
<li><a href="../pt482576/index.html">Um presente para todos debaixo da √°rvore de Natal</a></li>
<li><a href="../pt482584/index.html">T significa criatividade</a></li>
<li><a href="../pt482588/index.html">Reflex√£o de v√©spera de ano novo</a></li>
<li><a href="../pt482590/index.html">Somos champignons</a></li>
<li><a href="../pt482596/index.html">Sistema operacional interestelar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>