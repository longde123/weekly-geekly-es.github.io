<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôäÔ∏è ü¶â üïö Principios de PIM üíß üë©‚Äçüë©‚Äçüëß üîë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El protocolo PIM es un conjunto de protocolos para transmitir multidifusi√≥n en una red entre enrutadores. Las relaciones de vecindad se construyen de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Principios de PIM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450582/"> El protocolo PIM es un conjunto de protocolos para transmitir multidifusi√≥n en una red entre enrutadores.  Las relaciones de vecindad se construyen de la misma manera que en el caso de los protocolos de enrutamiento din√°mico.  PIMv2 env√≠a mensajes de saludo cada 30 segundos a la direcci√≥n de multidifusi√≥n reservada 224.0.0.13 (All-PIM-Routers).  El mensaje contiene Temporizadores de retenci√≥n, generalmente 3.5 * Hello Timer, es decir, 105 segundos por defecto. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e67/8a0/1fc/e678a01fc7879ecf22bc6f9a3825f9a6.jpg" alt="Mi imagen"></a> <br>  PIM utiliza dos modos principales de operaci√≥n: modo denso y disperso.  Comencemos con el modo Denso. <a name="habracut"></a><br>  <b>√Årboles de distribuci√≥n basados ‚Äã‚Äãen la fuente.</b> <br>  Se recomienda utilizar el modo de modo denso en el caso de una gran cantidad de clientes de varios grupos de multidifusi√≥n.  Cuando un enrutador recibe tr√°fico de multidifusi√≥n, lo primero que hace es verificar la regla RPF.  RPF: esta regla se utiliza para verificar el origen de una multidifusi√≥n con una tabla de enrutamiento de unidifusi√≥n.  Es necesario que el tr√°fico llegue a la interfaz detr√°s de la cual este host est√° oculto seg√∫n la versi√≥n de la tabla de enrutamiento de unidifusi√≥n.  Este mecanismo resuelve el problema de la aparici√≥n de bucles durante la transmisi√≥n multidifusi√≥n. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/6cd/08c/fb6/6cd08cfb6842680447d56860334af52c.png" alt="Mi imagen"></a> <br>  R3 del mensaje de multidifusi√≥n reconocer√° la fuente de la multidifusi√≥n (IP de origen) y verificar√° las dos secuencias de R1 y R2 de su tabla de unidifusi√≥n.  El flujo de la interfaz indicada por la tabla (R1 a R3) se transmitir√° m√°s, y el flujo de R2 se eliminar√°, porque para llegar al origen de la multidifusi√≥n, es necesario enviar paquetes a trav√©s de S0 / 1. <br>  La pregunta es, ¬øqu√© sucede si tiene dos rutas equivalentes con la misma m√©trica?  En este caso, el enrutador elegir√° el siguiente salto para estas rutas.  Quien tiene una direcci√≥n IP m√°s alta, gan√≥.  Si necesita cambiar este comportamiento, puede usar ECMP.  M√°s detalles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br>  Despu√©s de verificar la regla RPF, el enrutador env√≠a un paquete de multidifusi√≥n a todos sus vecinos PIM, excepto el que recibi√≥ el paquete.  Otros enrutadores PIM repiten este proceso.  La ruta que un paquete de multidifusi√≥n ha pasado de la fuente a los destinatarios finales forma un √°rbol llamado: √°rbol de distribuci√≥n basado en la fuente, √°rbol de la ruta m√°s corta (SPT), √°rbol de la fuente.  Tres nombres diferentes, elija cualquiera. <br>  C√≥mo resolver el problema con el hecho de que algunos enrutadores no renunciaron a un flujo de multidifusi√≥n y no hay nadie a quien enviarlo, y el enrutador de nivel superior lo env√≠a.  Para esto, se invent√≥ el mecanismo Prune. <br>  <b>Mensaje de poda.</b> <br>  Por ejemplo, R2 continuar√° enviando multidifusi√≥n R3, aunque R3 por la regla de RPF lo descarta.  ¬øPor qu√© cargar el canal?  R3 env√≠a un mensaje de poda PIM y R2, al recibir este mensaje, elimina la interfaz S0 / 1 de la lista de interfaces de salida para este flujo, la lista de interfaces desde las cuales se debe enviar este tr√°fico. <br><blockquote>  La siguiente es una definici√≥n m√°s formal de un mensaje PIM Prune: <br>  El mensaje PIM Prune es enviado por un enrutador a un segundo enrutador para hacer que el segundo enrutador elimine el enlace en el que se recibe la poda de un SPT particular (S, G). </blockquote><br>  Despu√©s de recibir el mensaje de poda, R2 establece el temporizador de poda en 3 minutos.  Despu√©s de tres minutos, comenzar√° a enviar tr√°fico nuevamente hasta que reciba el siguiente mensaje de Poda.  Esto est√° en PIMv1. <br>  Y en PIMv2 se agrega el temporizador de actualizaci√≥n de estado (por defecto 60 segundos).  Tan pronto como se haya enviado un mensaje de poda desde R3, este temporizador comienza en R3.  Despu√©s de que este temporizador caduque, R3 enviar√° un mensaje de Actualizaci√≥n de estado que restablecer√° el Temporizador de poda de 3 minutos a R2 para este grupo. <br>  Razones para enviar un mensaje de Prune: <br><ul><li>  Cuando un paquete de multidifusi√≥n falla una comprobaci√≥n de RPF. </li><li>  Cuando no hay clientes conectados localmente que solicitaron un grupo de multidifusi√≥n (IGMP Join) y no hay vecinos PIM a los que se pueda enviar tr√°fico de multidifusi√≥n (interfaz sin poda). </li></ul><br>  <b>Mensaje de injerto.</b> <br>  Imagine que R3 no quer√≠a tr√°fico de R2, envi√≥ Prune y recibi√≥ multidifusi√≥n de R1.  Pero de repente, el canal cay√≥ entre R1-R3 y R3 se qued√≥ sin multidifusi√≥n.  Puede esperar 3 minutos hasta que Primer Timer expire en R2.  3 minutos para esperar mucho tiempo, para no esperar, debe enviar un mensaje que muestre instant√°neamente esta interfaz S0 / 1 en R2 desde el estado recortado.  Este mensaje ser√° un mensaje de injerto.  Despu√©s de recibir el mensaje de Graft, R2 enviar√° un Graft-ACK en respuesta. <br>  <b>Poda de anulaci√≥n.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/bc7/1d0/e9f/bc71d0e9f81b292e75d4a016a9b657ef.png" alt="Mi imagen"></a> <br>  Veamos este esquema.  R1 transmite multidifusi√≥n en un segmento con dos enrutadores.  R3 recibe y transmite tr√°fico, R2 recibe, pero no tiene a nadie para transmitir tr√°fico.  Env√≠a un mensaje de poda a R1 en este segmento.  R1 deber√≠a eliminar Fa0 / 0 de la lista y detener la transmisi√≥n en este segmento, pero ¬øqu√© pasar√° con R3?  Y R3 est√° en el mismo segmento, tambi√©n recibi√≥ este mensaje de Prune y se dio cuenta de la tragedia de la situaci√≥n.  Antes de que R1 deje de transmitir, establece el temporizador en 3 segundos y detiene la transmisi√≥n despu√©s de 3 segundos.  3 segundos: tanto tiempo para R3, para no perder su multidifusi√≥n.  Por lo tanto, R3, tan pronto como sea posible, env√≠a un mensaje Pim Join para este grupo y R1 ya no piensa en dejar de transmitir.  Acerca de las publicaciones de Join a continuaci√≥n. <br>  <b>Afirmar mensaje.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f1d/9d1/d68/f1d9d1d6855fdc188deb28c75bde2d0d.png" alt="Mi imagen"></a> <br>  Imagine esta situaci√≥n: dos enrutadores transmiten a la misma red a la vez.  Reciben el mismo flujo de la fuente y ambos lo transmiten a la misma red detr√°s de la interfaz e0.  Por lo tanto, deben determinar qui√©n ser√° la √∫nica emisora ‚Äã‚Äãpara esta red.  Se utilizan mensajes de afirmaci√≥n para esto.  Cuando R2 y R3 detectan la duplicaci√≥n del tr√°fico de multidifusi√≥n, es decir, la multidifusi√≥n que transmiten en R2 y R3, que ellos mismos transmiten, los enrutadores entienden que algo est√° mal aqu√≠.  En este caso, los enrutadores env√≠an mensajes de afirmaci√≥n, que incluyen la distancia administrativa y la m√©trica de ruta por la cual se alcanza el origen de multidifusi√≥n - 10.1.1.10.  El ganador se determina de la siguiente manera: <br><ol><li>  El que tiene menor AD. </li><li>  Si AD son iguales, entonces qui√©n tiene la m√©trica m√°s baja. </li><li>  Si hay igualdad, entonces el que tiene una IP m√°s alta en la red a la que transmiten esta multidifusi√≥n. </li></ol><br>  Al ganar este voto, el enrutador se convierte en el enrutador designado.  Pim Hello tambi√©n se usa para seleccionar DR.  Al comienzo del art√≠culo, se mostr√≥ un mensaje de saludo PIM, all√≠ puede ver el campo DR.  El ganador es el que tiene una direcci√≥n IP m√°s alta en este enlace. <br>  Placa √∫til: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/3de/e1a/c84/3dee1ac8448b1fceaa9f1972eff802b7.png" alt="Mi imagen"></a> <br>  <b>Mesa MROUTE.</b> <br>  Despu√©s de la revisi√≥n inicial de la operaci√≥n del protocolo PIM, necesitamos descubrir c√≥mo trabajar con la tabla de enrutamiento de multidifusi√≥n.  La tabla de enrutamiento almacena informaci√≥n sobre qu√© flujos fueron solicitados por los clientes y qu√© flujos fluyen desde los servidores de multidifusi√≥n. <br>  Por ejemplo, al recibir un Informe de membres√≠a IGMP o Unirse a PIM en alguna interfaz, se agrega una entrada del tipo (*, G) a la tabla de enrutamiento: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/3ed/52c/afd3ed52cef0f9f105a0b58dff18edee.jpg" alt="Mi imagen"></a> <br>  Esta entrada significa que se recibi√≥ una solicitud de tr√°fico con la direcci√≥n 238.38.38.38.  El indicador DC significa que la multidifusi√≥n funcionar√° en modo Denso y C significa que el destinatario est√° conectado directamente al enrutador, es decir, el enrutador recibi√≥ el Informe de membres√≠a IGMP y la Uni√≥n PIM. <br>  Si hay un registro como (S, G) significa que tenemos una transmisi√≥n de multidifusi√≥n: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a78/cf2/332/a78cf23325ddc6e0c3d65322340d7ff6.jpg" alt="Mi imagen"></a> <br>  En el campo S - 192.168.1.11, hemos registrado la direcci√≥n IP de la fuente de multidifusi√≥n, ser√° verificada por la regla RPF.  En caso de problemas, lo primero que debe hacer es verificar la tabla Unicast para la ruta a la fuente.  En el campo Interfaz entrante indica la interfaz a la que llega la multidifusi√≥n.  En la tabla de enrutamiento de unidifusi√≥n, la ruta a la fuente debe hacer referencia a la interfaz especificada aqu√≠.  La interfaz de salida indica d√≥nde se redirigir√° la multidifusi√≥n.  Si est√° vac√≠o, no hubo solicitudes de este tr√°fico al enrutador.  Puede encontrar m√°s informaci√≥n sobre todas las banderas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br>  <b>PIM en modo disperso.</b> <br>  La estrategia en modo disperso es lo opuesto al modo denso.  Cuando el modo Sparse recibe tr√°fico de multidifusi√≥n, enviar√° tr√°fico solo a trav√©s de aquellas interfaces en las que hubo solicitudes para esta secuencia, por ejemplo, mensajes de Informe PIM Join o IGMP solicitando este tr√°fico. <br>  Elementos similares para SM y DM: <br><ul><li>  Las relaciones de vecindad se construyen de la misma manera que en PIM DM. </li><li>  La regla RPF funciona. </li><li>  La elecci√≥n de DR es similar. </li><li>  El motor Prune Overrides y los mensajes Assert son similares. </li></ul><br>  Para controlar qui√©n necesita d√≥nde, d√≥nde y qu√© tr√°fico de multidifusi√≥n se necesita en la red, se necesita un centro de informaci√≥n com√∫n.  Tal centro tendremos Rendezvous Point (RP).  Cualquiera que quiera alg√∫n tipo de tr√°fico de multidifusi√≥n o alguien comenz√≥ a recibir tr√°fico de multidifusi√≥n de la fuente, luego lo env√≠a al RP. <br>  Cuando el RP recibe tr√°fico de multidifusi√≥n, lo enviar√° a los enrutadores que previamente solicitaron este tr√°fico. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/025/d45/651/025d4565117dce5f8da07609c823c63e.jpg" alt="Mi imagen"></a> <br>  Imagine una topolog√≠a en la que RP es R3.  Tan pronto como R1 recibe tr√°fico de S1, encapsula este paquete de multidifusi√≥n en un mensaje de registro PIM de unidifusi√≥n y lo env√≠a a RP.  ¬øC√≥mo sabe qui√©n es RP?  En este caso, est√° configurado est√°ticamente, y hablaremos sobre el ajuste din√°mico de RP m√°s adelante. <br><blockquote>  ip pim rp-address 3.3.3.3 </blockquote><br>  RP buscar√°: ¬øhubo alguna informaci√≥n de alguien que quisiera recibir este tr√°fico?  Supongamos que no lo fue.  Luego, RP enviar√° a R1 un mensaje PIM Register-Stop, lo que significa que nadie necesita esta multidifusi√≥n, el registro es denegado.  R1 no enviar√° multidifusiones.  Pero la fuente de multidifusi√≥n lo enviar√°, por lo que R1, despu√©s de recibir Register-Stop, iniciar√° el temporizador de registro-supresi√≥n, que es de 60 segundos.  5 segundos antes de que expire el temporizador, R1 enviar√° un mensaje de registro vac√≠o con un bit de registro nulo (es decir, sin un paquete de multidifusi√≥n encapsulado) al lado RP.  RP a su vez actuar√° as√≠: <br><ul><li>  Si no hubo y no hubo destinatarios, responder√° con un mensaje de Registro-Detenci√≥n. </li><li>  Si aparecieron los destinatarios, entonces no le responder√° de ninguna manera.  R1, despu√©s de no haber recibido un rechazo para su registro dentro de los 5 segundos, estar√° encantado y enviar√° a Registrar un mensaje con la multidifusi√≥n encapsulada a RP. </li></ul><br>  A medida que la multidifusi√≥n alcanza el RP, parece estar resuelto, ahora intentemos responder a la pregunta de c√≥mo el RP lleva el tr√°fico a los destinatarios.  Aqu√≠ debe introducir un nuevo concepto: √°rbol de ruta ra√≠z (RPT).  Un RPT es un √°rbol con una ra√≠z en el RP que crece hacia los destinatarios que se bifurcan en cada enrutador PIM-SM.  RP lo crea al recibir mensajes de uni√≥n PIM y agrega una nueva rama al √°rbol.  Y tambi√©n lo hace cada enrutador aguas abajo.  La regla general se ve as√≠: <br><ul><li>  Cuando un enrutador PIM-SM recibe un mensaje de uni√≥n PIM en cualquier interfaz, excepto la interfaz detr√°s de la cual se oculta el RP, agrega una nueva rama al √°rbol. </li><li>  Tambi√©n se agrega una rama cuando el enrutador PIM-SM recibe un informe de membres√≠a IGMP de un host conectado directamente. </li></ul><br>  Imagine que tenemos un cliente de multidifusi√≥n en el enrutador R5 para el grupo 228.8.8.8.  Tan pronto como R5 recibe un informe de membres√≠a IGMP del host, R5 env√≠a una uni√≥n PIM en la direcci√≥n de RP, y agrega una interfaz que mira al host en el √°rbol.  A continuaci√≥n, R4 recibe una uni√≥n PIM de R5, agrega la interfaz Gi0 / 1 al √°rbol y env√≠a la uni√≥n PIM en la direcci√≥n de RP.  Finalmente, RP (R3) recibe una uni√≥n PIM y agrega Gi0 / 0 al √°rbol.  De este modo, se obtiene el registro del destinatario de multidifusi√≥n.  Estamos construyendo un √°rbol con la ra√≠z R3-Gi0 / 0 ‚Üí R4-Gi0 / 1 ‚Üí R5-Gi0 / 0. <br>  Despu√©s de eso, PIM Join se enviar√° a R1 y R1 comenzar√° a enviar tr√°fico de multidifusi√≥n.  Es importante tener en cuenta que si el host solicit√≥ tr√°fico antes de que comenzara la transmisi√≥n de multidifusi√≥n, entonces el RP no enviar√° PIM Join y no enviar√° nada al lado R1. <br>  Si de repente, mientras se env√≠a una multidifusi√≥n, el host deja de querer recibirla, tan pronto como el RP recibe PIM Prune en la interfaz Gi0 / 0, inmediatamente env√≠a el PIM Register-Stop directamente a R1, y luego el mensaje PIM Prune a trav√©s de la interfaz Gi0 / 1.  Unicast env√≠a la detenci√≥n del registro PIM a la direcci√≥n desde la que lleg√≥ el registro PIM. <br>  Como dijimos antes, tan pronto como el enrutador env√≠a una uni√≥n PIM a otra, por ejemplo, R5 en R4, se agrega una entrada a R4: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/9f7/730/678/9f7730678743efb4e9670d18fcd54525.jpg" alt="Mi imagen"></a> <br>  Y el temporizador inicia que para restablecer este temporizador, R5 debe enviar mensajes PIM constantemente, de lo contrario, R4 se excluir√° de la lista saliente.  R5 enviar√° cada 60 mensajes PIM Join. <br>  <b>Conmutaci√≥n de √°rbol de ruta m√°s corta.</b> <br>  Agregaremos una interfaz entre R1 y R5, veremos c√≥mo fluir√° el tr√°fico con esta topolog√≠a. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/113/eb0/afd113eb01e7deda4c389fbb1a02060a.jpg" alt="Mi imagen"></a> <br>  Digamos que el tr√°fico fue enviado y recibido de acuerdo con el antiguo esquema R1-R2-R3-R4-R5 y aqu√≠ conectamos y configuramos la interfaz entre R1 y R5. <br>  En primer lugar, tenemos que reconstruir la tabla de enrutamiento de unidifusi√≥n en R5 y ahora se alcanza la red 192.168.1.0/24 a trav√©s de la interfaz R5 Gi0 / 2.  Ahora, cuando R5 recibe una multidifusi√≥n en la interfaz Gi0 / 1, comprende que la regla RPF no se cumple y que ser√≠a m√°s l√≥gico recibir una multidifusi√≥n en Gi0 / 2.  Deber√≠a desconectarse del RPT y construir un √°rbol m√°s corto llamado √Årbol de ruta m√°s corta (SPT).  Para hacer esto, a trav√©s de Gi0 / 2, env√≠a una uni√≥n PIM a R1 y R1 comienza a enviar multidifusiones a trav√©s de Gi0 / 2 tambi√©n.  Ahora R5 debe darse de baja del RPT, para no obtener dos copias.  Para hacer esto, env√≠a un mensaje de Prune que indica la direcci√≥n IP de la fuente e inserta un bit especial: RPT-bit.  Esto significa que no necesito enviar tr√°fico, tengo un mejor √°rbol aqu√≠.  El RP tambi√©n env√≠a mensajes al lado R1 PIM Prune, pero no env√≠a un mensaje de Registro-Detenci√≥n.  Otra caracter√≠stica: R5 ahora enviar√° constantemente PIM Prune a RP, ya que R1 contin√∫a enviando PIM Register a RP cada minuto.  RP hasta que haya nuevas personas que deseen que este tr√°fico lo rechace.  R5 notifica al RP que contin√∫a recibiendo multidifusi√≥n a trav√©s de SPT. <br>  <b>B√∫squeda din√°mica de RP.</b> <b><br></b>  <b>RP autom√°tico</b> <br>  Esta tecnolog√≠a es propiedad de Cisco y no es particularmente popular, pero sigue viva.  Auto-RP consta de dos pasos principales: <br>  1) RP env√≠a mensajes de anuncio de RP a la direcci√≥n reservada - 224.0.1.39, declar√°ndose RP para todos o para ciertos grupos.  Este mensaje se env√≠a cada minuto. <br>  2) Se requiere un agente de mapeo de RP que enviar√° mensajes de RP-Discovery que indiquen para qu√© grupos qu√© RP escuchar.  Es a partir de este mensaje que los enrutadores PIM ordinarios determinar√°n el RP por s√≠ mismos.  El Mapping Agent puede ser el enrutador RP o cualquier enrutador PIM separado.  RP-Discovery se env√≠a a la direcci√≥n 224.0.1.40 con un temporizador de un minuto. <br>  Veamos el proceso con m√°s detalle: <br>  Establecer R3 como RP: <br><blockquote>  ip pim send-rp -nounce loopback 0 alcance 10 </blockquote><br>  R2 como agente de mapeo: <br><blockquote>  ip pim send-rp-discovery loopback 0 alcance 10 </blockquote><br>  Y en todos los dem√°s, esperaremos RP a trav√©s de Auto-RP: <br><blockquote>  ip pim autorp oyente </blockquote><br>  Una vez que configuremos R3, comenzar√° a enviar RP-Announce: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/aae/ae2/565/aaeae25659fbacd4ba49ae4c5486f46f.jpg" alt="Mi imagen"></a> <br>  Y R2, despu√©s de configurar el agente de mapeo, esperar√° el mensaje RP-Announce.  Solo cuando encuentre al menos un RP comenzar√° a enviar RP-Discovery: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fb8/e44/7c2/fb8e447c26e33ecda18cb82c5f05c938.jpg" alt="Mi imagen"></a> <br>  Por lo tanto, tan pronto como los enrutadores regulares (PIM RP Listener) reciban este mensaje, sabr√°n d√≥nde buscar el RP. <br>  Uno de los principales problemas de Auto-RP es que para recibir mensajes de RP-Announce y RP-Discovery, debe enviar PIM Join a las direcciones 224.0.1.39-40, y para enviar, necesita saber d√≥nde est√° el RP.  El cl√°sico problema del pollo y los huevos.  Para resolver este problema, se invent√≥ el PIM Sparse-Dense-Mode.  Si el enrutador no conoce RP, entonces funciona en modo denso, si lo sabe, entonces en modo disperso.  Cuando PIM Sparse-mode y el comando de escucha ip pim autorp se configuran en las interfaces de los enrutadores comunes, el enrutador funcionar√° en modo denso solo para el protocolo multicast directamente Auto-RP (224.0.1.39-40). <br>  <b>BootStrap Router (BSR).</b> <br>  Esta funci√≥n funciona de manera similar a Auto-RP.  Cada RP env√≠a un mensaje de agente de mapeo, que recopila informaci√≥n de mapeo y luego le dice a todos los otros enrutadores.  Describimos el proceso de manera similar a Auto-RP: <br>  1) Una vez que configuramos R3 como candidato para ser un RP, el comando: <br><blockquote>  ip pim rp-candidato loopback 0 </blockquote><br>  Que R3 no har√° nada, para comenzar a enviar mensajes especiales, √©l, para empezar, necesita encontrar un agente de mapeo.  As√≠, pasamos al segundo paso. <br>  2) Configure R2 como agente de mapeo: <br><blockquote>  ip pim bsr-candidato loopback 0 </blockquote><br>  R2 comienza a enviar mensajes PIM Bootstrap, donde se indica a s√≠ mismo como un agente de mapeo: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/729/3a4/ad1/7293a4ad164ed8342ff42ceffee9a32b.jpg" alt="Mi imagen"></a> <br>  Este mensaje se env√≠a a la direcci√≥n 224.0.013, que el protocolo PIM utiliza para sus otros mensajes.  Los env√≠a en todas las direcciones y, por lo tanto, no hay problema de pollo y huevos, como fue el caso en Auto-RP. <br>  3) Tan pronto como el RP reciba un mensaje del BSR del enrutador, enviar√° inmediatamente un mensaje de unidifusi√≥n a la direcci√≥n del BSR del enrutador: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5ed/217/8c1/5ed2178c151886f79c1e6197b9b5385b.jpg" alt="Mi imagen"></a> <br>  Despu√©s de eso, cuando el BSR recibe informaci√≥n sobre el RP, lo enviar√° con multidifusi√≥n a la direcci√≥n 224.0.0.13, que todos los enrutadores PIM escuchan.  Por lo tanto, no existe un an√°logo del <i>comando de escucha ip pim autorp</i> para enrutadores regulares en BSR. <br>  <b>Anycast RP con Multicast Source Discovery Protocol (MSDP).</b> <br>  Auto-RP y BSR nos permiten distribuir la carga en el RP de la siguiente manera: cada grupo de multidifusi√≥n tiene solo un RP activo.  No funcionar√° hacer que la distribuci√≥n de carga para un grupo de multidifusi√≥n sea RP m√∫ltiple.  MSDP hace esto emitiendo enrutadores RP la misma direcci√≥n IP con una m√°scara de 255.255.255.255.  MSDP reconoce la informaci√≥n utilizando uno de los m√©todos: est√°tico, Auto-RP o BSR. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/406/51a/032/40651a032dadaaf6e0c51cbf06c3fbf3.png" alt="Mi imagen"></a> <br>  En la imagen tenemos una configuraci√≥n de Auto-RP con MSDP.  Ambos RP est√°n configurados con la direcci√≥n IP 172.16.1.1/32 en la interfaz Loopback 1 y se utilizan para todos los grupos.  Cuando RP-Announce, ambos enrutadores hablan de s√≠ mismos, refiri√©ndose a esta direcci√≥n.  Una vez recibida la informaci√≥n, el agente de mapeo Auto-RP env√≠a RP-Discovery sobre el RP con la direcci√≥n 172.16.1.1/32.  Sobre la red 172.16.1.1/32, les decimos a los enrutadores que usan IGP y, respectivamente.  Por lo tanto, los enrutadores PIM solicitan o registran flujos desde el RP indicado como siguiente salto en la ruta a la red 172.16.1.1/32.  El protocolo MSDP en s√≠ est√° dise√±ado para que los RP intercambien mensajes de informaci√≥n de multidifusi√≥n. <br>  Considere la siguiente topolog√≠a: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/2ba/f2d/dc4/2baf2ddc4deb54ebb671a6fb52282a41.jpg" alt="Mi imagen"></a> <br>  El Switch6 transmite tr√°fico a la direcci√≥n 238.38.38.38 y hasta ahora solo RP-R1 lo sabe.  Aqu√≠ Switch7 y Switch8 solicitaron este grupo.  Los enrutadores R5 y R4 enviar√°n PIM Join a R1 y R3, respectivamente.  Por qu√©  La ruta hasta el 13.13.13.13 en R5 se referir√° a R1 de acuerdo con la m√©trica IGP, como en R4. <br>  RP-R1 conoce la transmisi√≥n y comienza a transmitirla hacia R5, pero R4 no sabe nada al respecto, ya que R1 simplemente no la enviar√°.  Por lo tanto, se requiere MSDP.  Lo configuramos en R1 y R5: <br><blockquote>  ip msdp peer 3.3.3.3 connect-source Loopback1 en R1 </blockquote><br><blockquote>  ip msdp peer 1.1.1.1 connect-source Loopback3 en R3 </blockquote><br>  Levantar√°n una sesi√≥n entre ellos y al recibir cualquier transmisi√≥n lo informar√°n a su vecino RP. <br>  RP-R1 tan pronto como reciba la transmisi√≥n del Switch6, enviar√° inmediatamente Unicast MSDP Source-Active un mensaje que contendr√° informaci√≥n como (S, G): informaci√≥n sobre el origen y el destino de la multidifusi√≥n.  Ahora, cuando RP-R3 sepa que una fuente como Switch6, enviar√° una uni√≥n PIM hacia Switch6 cuando reciba una solicitud de R4 para este flujo, gui√°ndose por la tabla de enrutamiento.  Por lo tanto, despu√©s de que R1 haya recibido dicha uni√≥n PIM, comenzar√° a enviar tr√°fico hacia RP-R3. <br>  MSDP se ejecuta sobre TCP, los RP se env√≠an mensajes de mantenimiento para verificar la viabilidad.  El temporizador es de 60 segundos. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La funci√≥n de dividir pares de MSDP en diferentes dominios sigue siendo incomprensible, ya que los mensajes Keepalive y SA no indican pertenecer a ning√∫n dominio. </font><font style="vertical-align: inherit;">Adem√°s, en esta topolog√≠a, la configuraci√≥n se prob√≥ con la indicaci√≥n de varios dominios; no hubo diferencias en la operaci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si alguien puede aclarar, lea con gusto los comentarios. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre esto pienso terminar el art√≠culo. </font><font style="vertical-align: inherit;">A continuaci√≥n hay materiales √∫tiles y enlaces que se utilizaron:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CCIE Routing and Switching v5.0 Official Cert Guide, Volume 2, Fifth Edition, Narbik Kocharians, Terry Vinson. </font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redes para los m√°s peque√±os. </font><font style="vertical-align: inherit;">Parte nueve. </font><font style="vertical-align: inherit;">Multidifusi√≥n</font></font></a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450582/">https://habr.com/ru/post/450582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450568/index.html">Cada veneno tiene su propio ant√≠doto. C√≥mo guardar o al menos intentar (upd: sobre ant√≠dotos para envenenamiento dom√©stico)</a></li>
<li><a href="../450572/index.html">Samba DC como segundo controlador en el dominio AD de Windows 2012R2 y carpetas m√≥viles para clientes en Windows y Linux</a></li>
<li><a href="../450574/index.html">Crea un juego web multijugador .io</a></li>
<li><a href="../450576/index.html">Nuevas reglas para el anonimato del mensajero</a></li>
<li><a href="../450578/index.html">¬øQu√© se escucha en el aire? Recibimos y decodificamos las se√±ales m√°s interesantes. Parte 2, VHF</a></li>
<li><a href="../450586/index.html">Fish Redux - Nueva Biblioteca Redux para Flutter</a></li>
<li><a href="../450592/index.html">En Alemania, el costo de viajar en un autom√≥vil el√©ctrico puede ser mayor que en un autom√≥vil diesel</a></li>
<li><a href="../450594/index.html">N√∫meros pares de Fibonacci</a></li>
<li><a href="../450596/index.html">11. Check Point Getting Started R80.20. Pol√≠tica de prevenci√≥n de amenazas</a></li>
<li><a href="../450598/index.html">Sobre la "lluvia amarilla" y el "agente naranja"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>