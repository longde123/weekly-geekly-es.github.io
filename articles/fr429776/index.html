<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺 💇 👩🏿‍🎤 Synopsis du rapport «Monolith pour des centaines de versions client» (HL2018, Badoo, Vladimir Yants) 👦🏻 👋 🏠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Poursuite d'une série d'abrégés avec HL2018. Les gars de Badoo (Vladimir Yants vyants et Nikolai Krapivny) m'ont aidé à vérifier ce recueil , dont je ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Synopsis du rapport «Monolith pour des centaines de versions client» (HL2018, Badoo, Vladimir Yants)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429776/">  Poursuite d'une série d'abrégés avec HL2018.  Les gars de Badoo (Vladimir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Yants vyants</a> et Nikolai Krapivny) m'ont aidé à vérifier ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">recueil</a> , dont je les remercie beaucoup.  J'espère que cela a un effet positif sur la qualité du message du rapport. <br><br><img src="https://habrastorage.org/webt/8w/zh/nr/8wzhnrc5cvcugbedz9xrxkx8jm8.jpeg" alt="image"><br><a name="habracut"></a><br><h3>  Caractéristiques du processus de développement: </h3><br>  La responsabilité du développeur ne prend pas fin avec la sortie du backend.  Il est responsable avant l'implémentation sur les plateformes. <br><br><img src="https://habrastorage.org/webt/je/gx/03/jegx038nczykw6kld4fu1ynaalq.jpeg" alt="image"><br><br>  Il y a un test manuel, mais le client n'est pas prêt au moment de la publication et est libéré avec un délai (imprévisible).  Souvent, nous ne savons pas quand les clients commenceront à le mettre en œuvre.  Parfois (pas souvent), les fonctionnalités commencent à être exécutées après une longue période.  Par conséquent, le test avec vos mains est difficile et tout n'est pas possible.  Par conséquent, des autotests sont nécessaires. <br><br><h2>  Les tests </h2><br><h3>  Tests unitaires </h3><br>  Écrit en phpunit. <br><br>  Testez une petite unité.  Ils ne vont pas à la base de données ou aux services (ils ne doivent interagir avec rien). <br><br>  Legacy a encore et complique le processus de test. <br><br>  Ils ont développé la bibliothèque softMocks - elle inclut tous les crochets inclus / requis et la remplace par celle modifiée. <br><br>  Vous pouvez liquider toutes les méthodes: statique, privée, finale. <br>  La bibliothèque est disponible en open source. <br><br>  Problème: les softmocks se détendent et vous permettent d'écrire du code non testé (et de le couvrir de tests). <br><br>  Accepté les règles: <br><br><ul><li>  Le nouveau code devrait être facile à tester phpunit </li><li>  SoftMocks - cas extrême (ancien code / long / cher / compliqué) </li></ul><br>  Nous examinons la révision du code pour ces règles. <br><br><h2>  Test de qualité </h2><br><h3>  Test de mutation </h3><br><ul><li>  Prenez le code </li><li>  Prenez la couverture du code </li><li>  Nous analysons le code et appliquons des mutations (change + =&gt; -; true =&gt; false, etc.) </li><li>  Pour chaque mutation, nous exécutons une suite (ensemble) de tests. </li><li>  Si les tests échouent, alors env.  Sinon, ils ne sont pas assez efficaces.  Nous comprenons, modifions / ajoutons des tests. </li></ul><br>  Il existe des solutions toutes faites (Humbug, Infection), mais elles ne convenaient pas (non compatible avec les softmocks, il y a des difficultés avec la couverture du code).  Par conséquent, ils ont écrit le leur. <br><br>  Les tests de mutation ne sont pas encore disponibles pour les tests manuels.  Disponible pour s'exécuter manuellement, à partir de la console.  Maintenant, nous l'implémentons dans le pipeline CI, nous construisons le processus.  Le résultat sera sur Habr. <br><br><h3>  Tests d'intégration </h3><br>  Tester le fonctionnement de plusieurs composants conjointement;  Nous vérifions le travail avec la base et / ou les services. <br><br>  Approche standard des tests de bases de données (DBUnit): <br><br><ol><li>  Augmenter la base de données de test </li><li>  Remplissez-le </li><li>  Exécutez le test </li><li>  Nous nettoyons la base de données </li></ol><br>  Les problèmes: <br><br><ul><li>  Il est nécessaire de prendre en charge les tables de données et les jeux de données (pertinence du contenu de la base de données) </li><li>  Il faut du temps pour préparer la base de données </li><li>  Les lancements parallèles rendent les tests instables et provoquent des blocages </li></ul><br>  Solution: bibliothèque DBMocks (propre solution) <br><br>  Principe de fonctionnement: <br><br><ul><li>  Méthodes de pilote de base de données interceptées à l'aide de SoftMocks lors du test de configuration </li><li>  De la demande parsim db + table </li><li>  Tmpfs crée des tables temporaires avec le même schéma </li><li>  Toutes les requêtes vont uniquement aux tables temporaires </li><li>  Sur TearDown, ils sont supprimés. </li></ul><br>  La bibliothèque est petite, mais pas encore ouverte en open source. <br><br>  Résultats: <br><br><ul><li>  Les tests ne peuvent pas corrompre les données des tables d'origine </li><li>  Les tests sont isolés les uns des autres (peuvent être exécutés en parallèle) </li><li>  Test de la compatibilité des requêtes avec la version MySQL </li></ul><br><h3>  Tests API </h3><br><ul><li>  Imitez une session client </li><li>  Capable d'envoyer des demandes backend </li><li>  Le backend répond presque comme un vrai client </li></ul><br>  En règle générale, ces tests nécessitent un utilisateur autorisé.  Il doit être créé avant le test et supprimé après.  Cela introduit des risques supplémentaires (réplication, tâches d'arrière-plan). <br><br>  Solution: Nous avons créé un pool d'utilisateurs de test.  J'ai appris à les nettoyer. <br><br><img src="https://habrastorage.org/webt/yh/ny/jk/yhnyjk6mfogisbdjyro_g-egtwm.jpeg" alt="image"><br><br>  Les utilisateurs de test sont dans le même environnement que les vrais, car devel! = Prod.  Il est nécessaire d'isoler les utilisateurs test et live. <br><br>  Pour l'isolement, l'indicateur is_test_user a été ajouté pour l'utilisateur.  Et ces utilisateurs sont également exclus de l'analyse et des résultats des tests A / B. <br><br>  Il peut être rendu moins cher en envoyant des utilisateurs de test «en Antarctique», où personne ne les verra (sauf pour les pingouins). <br><br><h3>  API QA </h3><br>  Un outil pour préparer l'environnement dans les tests api, en fait une porte dérobée dans le backend pour changer rapidement les paramètres utilisateur / environnement. <br><br><ul><li>  Méthodes API bien documentées </li><li>  Gérez les données rapidement et facilement. </li><li>  Les développeurs écrivent le backend </li><li>  Ne peut être appliqué qu'aux utilisateurs de test. </li></ul><br>  Permet à l'utilisateur de modifier des données immuables (par exemple, la date d'enregistrement). <br><br>  Protection requise: <br><br><ul><li>  Au niveau du réseau (disponible uniquement depuis le réseau du bureau) </li><li>  Un secret est transmis à chaque demande, dont la validité est vérifiée </li><li>  Les méthodes fonctionnent uniquement avec les utilisateurs de test. </li></ul><br>  Il existe un programme BugsBounty sur HackerOne.  Ils paient pour les vulnérabilités trouvées.  Un problème avec l'API QA a été trouvé en l'utilisant. <br><br><h3>  Se moquer à distance </h3><br>  Moki pour le backend distant. <br><br>  Travaillez sur la base de moquettes molles.  Le test demande au backend de s'initialiser pour la session fictive.  Dès réception de la demande, le backend vérifie la liste des mox pour la session et les applique à l'aide de SoftMocks. <br><br>  Exemple de test: <br><br><img src="https://habrastorage.org/webt/gh/uk/7y/ghuk7yxvowxd5x3gqxald-3wrnm.jpeg" alt="image"><br><br>  Les tests API sont trop pratiques.  Il est tentant de les écrire au lieu de Unit.  Mais les tests API sont beaucoup plus lents. <br><br>  Adopté un ensemble de règles: <br><br><ul><li>  Le but des tests API est de tester le protocole et l'intégration </li><li>  Vérifier le flux complexe </li><li>  Une petite variabilité ne peut pas être testée. </li><li>  Lors de la révision du code, nous testons également les tests. </li></ul><br><h3>  Tests de l'interface utilisateur </h3><br>  La commande backend n'écrit pas. <br><br>  La fonctionnalité est couverte par les tests Ui lorsqu'elle se stabilise. <br>  Utilisé par le sélénium pour le Web.  Pour calebasse mobile. <br><br><h2>  Essai de fonctionnement </h2><br>  100 000 tests unitaires.  6.000 intégration, 14.000 tests api. <br>  Dans 1 flux, le temps est de 40 min / 90 min / 10 heures. <br><br>  Made TestCloud - un cloud pour exécuter des tests. <br><br><img src="https://habrastorage.org/webt/lh/bn/yx/lhbnyxws1gdtptpwew0rnwwk58i.jpeg" alt="image"><br><br>  La répartition du test entre les threads: <br><br><ul><li>  Vous pouvez également (mal, tous les tests sont différents, il s'avère inégal dans le temps) </li><li>  Exécutez plusieurs threads et alimentez les tests phpunit un à la fois (surcharge d'initialisation. Long!) </li></ul><br>  Solution: <br><br><ul><li>  Collecte de statistiques sur le temps d'exécution. </li><li>  Disposition des tests pour que le morceau ne dure pas plus de 30 secondes </li></ul><br>  Le problème avec les tests api est long, beaucoup de ressources et ne permettent pas aux autres de s'exécuter. <br><br>  Pour résoudre, nous avons divisé le cloud en 2 parties: <br><br><ol><li>  Exécute uniquement des tests rapides. </li><li>  Exécute les deux types de tests. </li></ol><br>  Le résultat est une accélération du temps pour: <br><br><ul><li>  Unité - 1 min </li><li>  Intégration - 5 min </li><li>  API - 15 minutes. </li></ul><br><h2>  Exécution de la couverture de code </h2><br>  Quels tests effectuer?  Affiche la couverture du code. <br><br><ol><li>  Nous obtenons des différences de branche </li><li>  Créer une liste de fichiers modifiés </li><li>  Obtenez une liste de tests pour ces fichiers. </li><li>  nous exécutons la suite exécutée uniquement à partir de ces tests. </li></ol><br>  La couverture se forme une fois par jour, la nuit, pour la branche maître.  Les résultats (diff) sont ajoutés à la base de données. <br><br>  Avantages: <br><br><ul><li>  Nous exécutons moins de tests: moins de charge matérielle et des retours de test plus rapides </li><li>  Vous pouvez exécuter des tests pour les correctifs.  Cela vous permet de déployer rapidement le correctif.  Dans les patchs, la vitesse est la plus importante. </li></ul><br>  Inconvénients: <br><br><ul><li>  Sortie backend 2 fois par jour.  Après le déjeuner, la couverture est moins pertinente (mais lorsque nous déployons un rythme, nous conduisons toujours une suite complète). </li><li>  Les tests Api génèrent une couverture étendue.  Pour eux, cette approche n'apporte pas beaucoup d'économies. </li></ul><br>  Si le développeur a besoin de voir immédiatement la couverture du code, c'est-à-dire un outil qui peut être lancé dans la console et obtenir immédiatement une nouvelle mesure pour la couverture d'un fichier / composant particulier. <br>  Il est considéré comme délicat: les données sur le maître de coverege sont prises, tous les tests modifiés sont ajoutés, il s'avère une petite suite sur laquelle la couverture est déjà considérée. <br><br><h2>  Résumé </h2><br><ul><li>  Besoin de tous les niveaux de test </li><li>  Quantité! = Qualité.  Examinez le code et testez les mutations </li><li>  Isolez les utilisateurs de test des vrais. </li><li>  Les backends dans le backend simplifient et accélèrent les tests d'écriture </li><li>  Collectez des statistiques sur les tests. </li></ul><br><h2>  Les références </h2><br><ul><li>  Diapositives: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bit.ly/yants-HL18</a> </li><li>  Notre protocole: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Comment nous prenons en charge 100 versions différentes de clients à Badoo» / Yaroslav Golub</a> </li><li>  SoftMocks: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«SoftMocks: notre runkit de remplacement pour PHP 7» / Yuri Nasretdinov</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/badoo/soft-mocks</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Badoo bugsbounty</a> </li><li>  Tests d'interface utilisateur: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Automatisation des tests mobiles multiplateforme et livraison continue» / Sathish Gogineni</a> </li><li>  TestCloud: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Parallélisation optimale des tests unitaires ou 17000 tests en 4 minutes» / Ilya Kudinov</a> </li><li>  QAAPI: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un regard sur les tests de l'autre côté des barricades.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">/ Rapport de Dmitry Marushchenko à LoveQA</a> </li><li>  Backend: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Badoo.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tout sur le backend de l'application mobile Badoo</a> / Nikolay Krapivny </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429776/">https://habr.com/ru/post/fr429776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429766/index.html">Le gourou .NET Dino Esposito: "Ne soyez pas un passager dans un train qui descend"</a></li>
<li><a href="../fr429768/index.html">"DNS sur HTTPS" est publié dans la RFC 8484 - mais tout le monde n'en est pas satisfait</a></li>
<li><a href="../fr429770/index.html">Comment la prolifération des appareils Internet modifie les habitudes de paiement</a></li>
<li><a href="../fr429772/index.html">Distribuer et conquérir: des outils pour créer et tester des newsletters</a></li>
<li><a href="../fr429774/index.html">Créez votre propre palette de couleurs</a></li>
<li><a href="../fr429778/index.html">Concept d'interface vocale de système informatique pour aider les personnes souffrant de troubles de la parole</a></li>
<li><a href="../fr429780/index.html">C ++ moderne! = (Le plus) nouveau standard</a></li>
<li><a href="../fr429782/index.html">L'histoire de la façon dont nous avons accéléré les tests 12 fois</a></li>
<li><a href="../fr429786/index.html">Fast Sin and Cos sur ASM intégré pour Delphi</a></li>
<li><a href="../fr429788/index.html">Une autre raison pour laquelle les conteneurs Docker sont ralentis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>