<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèª üèûÔ∏è üêê La longue histoire du guide - comment j'ai √©crit un service pour des sentiers de randonn√©e intelligents pendant 5 ans üß¶ üò∑ üëåüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beaucoup ont un ou plusieurs de leurs projets √† domicile. Ce sont de petits utilitaires, des pi√®ces exp√©rimentales, des √©chantillons de nouvelles tech...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La longue histoire du guide - comment j'ai √©crit un service pour des sentiers de randonn√©e intelligents pendant 5 ans</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471216/"><p> Beaucoup ont un ou plusieurs de leurs projets √† domicile.  Ce sont de petits utilitaires, des pi√®ces exp√©rimentales, des √©chantillons de nouvelles technologies, des ¬´tueurs¬ª Facebook et bien plus encore.  De mani√®re moins fr√©quente, de tels projets sont engag√©s depuis longtemps. </p><br><p>  Dans l'article, je partagerai mon exp√©rience et vous dirai comment pendant 5 ans j'ai travaill√© occasionnellement sur le d√©veloppement d'un guide intelligent pour Saint-P√©tersbourg, comment j'ai r√©ussi √† ne pas abandonner cette entreprise, comment l'attitude envers le projet a chang√© et ce qui s'est finalement produit. </p><br><p><img src="https://habrastorage.org/webt/ee/8f/lg/ee8flg22vilx7tptxu7jal6iity.jpeg"></p><a name="habracut"></a><br><blockquote>  De nombreuses solutions techniques et v√©los douteux sont d√©crits ci-dessous, mais ne soyez pas surpris - presque tous sont justifi√©s par les objectifs et les ressources disponibles √† ce moment (= g√©n√©ralement mes connaissances et mon temps) </blockquote><br><h2 id="ideya">  Id√©e </h2><br><p>  Dans toute grande ville touristique, il y a des centaines de guides, bons et pas tr√®s bons, o√π les itin√©raires principaux sont peints, les principaux points et un tas d'autres informations utiles sont indiqu√©s. <br>  Mais les itin√©raires y sont constants et limit√©s, et les sites touristiques ne sont g√©n√©ralement que les plus importants, comme "que voir en 3 jours". </p><br><p>  Par cons√©quent, l'id√©e est venue de construire des itin√©raires intelligents.  L'utilisateur s√©lectionne les points A et B et ne re√ßoit pas l'itin√©raire le plus court classique, mais quelque chose √† proximit√©, mais en passant par les attractions √† proximit√©. </p><br><p>  Le public d'un tel guide n'est pas seulement des touristes, mais aussi des r√©sidents locaux qui souhaitent diversifier leurs itin√©raires typiques vers la maison / le travail / le magasin (et il y avait de telles critiques dans l'application!) Ou tout simplement mieux conna√Ætre la ville. </p><br><p>  <strong>TL; DR</strong> <br>  L'essentiel est l'application Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wander</a> , qui ne fonctionne d√©sormais que pour Saint-P√©tersbourg. </p><br><h2 id="akt-1-prototip">  Acte 1: Prototype </h2><br><p> L'id√©e est revenue √† l'universit√© en 2014, je ne suis m√™me pas s√ªr que l'id√©e √©tait √† l'origine de moi, sur un certain cours, il √©tait n√©cessaire de se diviser en groupes, de proposer des projets et de les terminer en tant que document de fin d'√©tudes.  Ils se sont √©cras√©s et ont g√©n√©r√© l'id√©e du projet, puis le nom <code>TravelPath</code> commenc√©. </p><br><p>  C'√©tait cens√© √™tre un service Web, je connaissais un peu PHP, alors j'ai choisi PHP. <br>  Il fallait r√©soudre plusieurs probl√®mes: </p><br><p>  <strong>1. Base d'attractions</strong> <br>  Ici, nous avons rencontr√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenStreetMap</a> , il s'est av√©r√© que c'est le projet le plus cool qui nous convient parfaitement.  OSM est un projet de carte communautaire communautaire √† but non lucratif.  Comme Wikipedia, uniquement sur les cartes. <br>  T√©l√©chargez la carte au format xml de Saint-P√©tersbourg - <a href="">il</a> y a une liste de ressources o√π vous pouvez le faire. <br>  √Ä cette √©poque, je me souviens, les fichiers cartographiques pesaient plus de 1 Go, donc un analyseur en streaming est √©crit qui s√©lectionne des objets de cat√©gories pr√©s√©lectionn√©es - monuments, parcs, √©glises, mus√©es. <br>  OSM poss√®de une documentation compl√®te sur les balises, les attributs et tout ce dont vous avez besoin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , gr√¢ce √† cela, il ne sera pas difficile de comprendre comment obtenir les donn√©es dont vous avez besoin √† partir des cartes. </p><br><p>  Les donn√©es cartographiques sont cr√©√©es par des passionn√©s, donc pas partout et pas toujours les objets ont les balises n√©cessaires, certains endroits ont des erreurs, des probl√®mes.  Mais pour les grandes villes, les donn√©es sont de tr√®s bonne qualit√©. </p><br><p>  Si j'ai mis √† jour correctement mon ancien code, j'ai utilis√© les balises suivantes pour r√©cup√©rer des objets: </p><br><ul><li>  <code>building</code> signifiant <code>cathedral</code> , <code>chapel</code> , <code>church</code> est devenue une cat√©gorie d' <code>church</code> </li><li>  <code>amenity</code> avec des valeurs de <code>fountain</code> tombe en <code>monument</code> </li><li>  <code>tourism</code> avec des valeurs d' <code>artwork</code> d' <code>artwork</code> et de <code>viewpoint</code> va au <code>monument</code> , au <code>zoo</code> et au <code>museum</code> au <code>museum</code> et au <code>park</code> √† <code>theme_park</code> au <code>park</code> </li><li>  <code>historic</code> avec <code>boundary_stone</code> , <code>castle</code> , <code>memorial</code> , les valeurs des <code>monument</code> vont √† la cat√©gorie des <code>monument</code> </li><li>  <code>leisure</code> avec une valeur dans le <code>park</code> finissent naturellement dans le <code>park</code> </li></ul><br><p>  Nous mettons tous les objets re√ßus dans une base de donn√©es avec coordonn√©es et r√©jouissons-nous!  Plus de 1 200 points ont √©t√© d√©bloqu√©s √† Saint-P√©tersbourg. </p><br><p>  <strong>2. Construire un itin√©raire</strong> <br>  Il n'√©tait pas destin√© √† impl√©menter des syst√®mes complexes dans le cadre du cours, et les connaissances techniques √† l'√©poque √©taient rares, nous avons donc d√©cid√© de diviser l'itin√©raire en deux parties: le choix des objets dans l'itin√©raire et l'itin√©raire lui-m√™me.  En partie, cela a d√©termin√© le sort de l'avenir, car plus tard, je ne voulais pas changer ce sch√©ma. </p><br><p>  La construction d'un itin√©raire entre les points s√©lectionn√©s a √©t√© donn√©e par l'API Google Maps, qui a assez bien construit les itin√©raires en voiture, mais √† l'√©poque ne savait pas marcher, du moins en Russie. </p><br><p>  Le choix des objets devait √™tre r√©alis√© par vous-m√™me.  Il s'est av√©r√© le sch√©ma suivant de la demande: </p><br><p><img src="https://habrastorage.org/webt/qf/ji/cu/qfjicujbis8zm-4ojiuumt9vkqk.jpeg"></p><br><p>  Le principal inconv√©nient de l'approche est la s√©lection de points sur l'itin√©raire sans tenir compte de la carte, uniquement sur la base des coordonn√©es GPS.  Et dans l'ensemble, cela fonctionne assez bien, surtout lorsqu'il y a un r√©seau routier fr√©quent.  Des probl√®mes rares sont perceptibles le long des rivi√®res avec des ponts rares, par exemple. </p><br><p>  Ensuite, nous arrivons √† un algorithme pour s√©lectionner des points dans l'itin√©raire.  D'une part, il faut que l'itin√©raire ne d√©vie pas beaucoup sur le c√¥t√©, mais d'autre part il s√©lectionne quand m√™me quelques points dans les quartiers donn√©s. </p><br><p>  Pas un √©nonc√© tr√®s clair du probl√®me, le m√™me algorithme est sorti, quelque chose de similaire √† A * ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> ): on pense que de chaque point il y a des transitions √† chacun.  De plus, dans A *, le prix pour aller au sommet n lors de la recherche de la route AB est g√©n√©ralement exprim√© comme suit: <code>f(n) = g(An) + h(nB)</code> , o√π <code>g(x,y)</code> est la longueur du chemin de x √† y, et <code>h(x,y)</code> est une estimation heuristique de la distance de x √† y.  Mon prix est le m√™me - <code>f(n) = h(x,n) + h(n,y) * q</code> , o√π q est une constante inf√©rieure √† 1. En modifiant la valeur de q, vous pouvez affecter le nombre de points dans l'itin√©raire. </p><br><p>  Nous impl√©mentons l'algorithme et, cheers, tout fonctionne, fixons l'interface, achetons un domaine, le t√©l√©chargeons sur l'h√©bergement, r√©digeons des rapports et autres formalit√©s administratives et r√©jouissons-nous!  Cela ressemblait √† quelque chose comme √ßa (et n'a pas beaucoup chang√© apr√®s): </p><br><p><img src="https://habrastorage.org/webt/b3/fw/uz/b3fwuz0lqz_x3z2adx9qv-usau8.jpeg"></p><br><p>  <strong>Total: j'ai</strong> eu un prototype d'une id√©e sympa, j'ai fait connaissance avec OSM, Google API, travaill√© en √©quipe, obtenu un cr√©dit √† l'universit√©, et c'√©tait aussi int√©ressant. </p><br><h2 id="akt-2-pervaya-polnocennaya-web-versiya">  Acte 2: Premi√®re version Web compl√®te </h2><br><p>  J'ai vraiment aim√© l'id√©e et j'ai d√©cid√© de la d√©velopper davantage, mais d√©j√† une.  Et il √©tait clair tout de suite ce qu'il fallait d'abord: √† cette √©poque, Google Maps n'√©tait pas encore en mesure de construire des itin√©raires p√©destres, seuls des automobiles √©taient en cours de construction.  Et l'id√©e de l'application est principalement ax√©e sur la marche, ce qui signifie que vous devez pouvoir cr√©er des itin√©raires le long des ruelles ombrag√©es des parcs, des passerelles pi√©tonnes, des ponts et bien plus encore. </p><br><p>  C'√©tait en 2015, et j'ai continu√© √† travailler sur TravelPath, j'ai pris la correction de cette faille fatale - j'ai commenc√© √† construire des moyens par moi-m√™me. </p><br><p>  Je n'ai pas chang√© la technologie, <code>PHP</code> + <code>MySQL</code> .  Bien s√ªr, j'ai imm√©diatement r√©alis√© que ce n'√©tait pas la meilleure pile technique pour une telle t√¢che (construire des routes en PHP? S√©rieusement?). <br>  Mais j'√©tais limit√© dans le temps et je n'√©tais pas pr√™t √† passer √† une pile plus raisonnable, et deuxi√®mement, jusqu'√† pr√©sent, le projet √©tait √©crit "sur la table" - je voudrais utiliser une telle application √† partir d'un appareil mobile, et √† l'√©poque, cela ne signifiait que le d√©veloppement natif.  Autrement dit, son inapplicabilit√© sous la forme d'une version Web √©tait √©vidente, m√™me en d√©pit de certaines tentatives pour cr√©er une interface adaptative. </p><br><p>  Les t√¢ches suivantes sont survenues: </p><br><p>  <strong>1. Obtention d'un graphe de ville</strong> <br>  Ici, le m√™me OSM nous sauve.  Encore une fois, t√©l√©chargez le graphique au format xml, analysez-le, en s√©lectionnant uniquement les types de routes n√©cessaires et √©merveillez-vous de la quantit√© de donn√©es - √† cette √©poque, plus de 3 millions de sommets et 500k bords sont sortis.  La premi√®re id√©e est que le graphique peut ne pas √™tre li√©. <br>  Les cours, les territoires ferm√©s, les choses incompr√©hensibles ne sont pas tr√®s int√©ressants pour construire un itin√©raire, donc nous s√©lectionnons un point, en parcourons tout le graphique, en marquant les sommets pass√©s et en obtenant la partie connect√©e du graphique. <br>  Au total, plus de 600k cr√™tes et 150k bords sont sortis. <br>  Enregistr√© le re√ßu dans la base de donn√©es et laiss√© jusqu'√† des temps meilleurs. </p><br><p>  <strong>2. Construire un itin√©raire</strong> <br>  Il y a des donn√©es, tout est laiss√© au petit: cr√©ez des routes dessus.  Nous n'avons pas eu √† inventer quelque chose de nouveau - rappelez-vous le cours des algorithmes, lisez attentivement les articles sur l'utilisation des graphiques, prenez l'algorithme A *, impl√©mentez-le en PHP et <del>  r√©jouis-toi </del>  frustr√© par la lenteur avec laquelle tout fonctionne. </p><br><p>  Il y a beaucoup de donn√©es, par cons√©quent, lors de la construction du graphique, nous n'utilisons pas le graphique complet, mais nous n'en lisons qu'une partie - tout ce qui tombe dans le rectangle obtenu √† partir de tous les points s√©lectionn√©s de l'itin√©raire. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qc/p7/9k/qcp79klhlir-x7udd5im-0h-cw0.jpeg"></div><br><p>  (cadre rouge = ~ un tel graphique a √©t√© lu pour construire le chemin) </p><br><p>  Il en va de m√™me pour les points candidats pour l'itin√©raire - nous ne prenons pas en compte tout, mais seulement ceux entre le d√©but et la fin + une petite valeur. <br>  Apr√®s avoir s√©lectionn√© la taille de ce rectangle (la constante par laquelle nous l'agrandissons), nous essayons de garantir que nous lisons la taille de donn√©es minimale requise. <br>  Il y avait aussi l'id√©e de diviser la ville en carr√©s, de construire d'abord l'itin√©raire par des carr√©s, puis de lire le graphique √† l'int√©rieur de ces carr√©s et de chercher un chemin uniquement le long de celle-ci.  Et vous pouvez pr√©-calculer les chemins entre tous les carr√©s voisins.  Ou encore plus - pour calculer et enregistrer le chemin entre tous les sites.  √Ä la vol√©e, il ne reste plus qu'√† construire les chemins de l'initiale au premier objet, et du dernier objet √† la ligne d'arriv√©e. <br>  Mais les mains n'ont pas atteint la r√©alisation de tels v√©los. </p><br><p>  <strong>3. Acheminement dans un d√©lai raisonnable</strong> <br>  Il est imm√©diatement devenu clair que le goulot d'√©tranglement est le stockage et le travail avec les donn√©es - l'algorithme de recherche lui-m√™me n'est pas particuli√®rement acc√©l√©r√©.  Et des rep√®res sur le genou confirment que la plupart du temps est consacr√© √† la lecture de la base de donn√©es et √† des manipulations similaires. <br>  Que faut-il faire dans de tels cas?  Ne stockez pas ce graphique.  Mais j'ai une fa√ßon sp√©ciale, <code>MySQL</code> et rien de plus, mais le probl√®me doit √™tre r√©solu. </p><br><ol><li>  Le tout premier - les donn√©es ont √©t√© normalis√©es, ce qui √©tait pratique lors de l'analyse, mais la lecture de dizaines de milliers d'enregistrements et m√™me de deux tableaux est p√©nible.  La solution √©vidente est de cr√©er l'un des deux tableaux (pour les sommets et les ar√™tes), uniquement pour les ar√™tes, dans lesquels dans chaque enregistrement les coordonn√©es des deux sommets et leur id. </li><li>  Nous comptons √† l'avance les sommets les plus proches du graphe des vues, et ne le faisons pas √† la vol√©e √† chaque fois. </li><li>  Un temps consid√©rable est consacr√© √† la recherche du point du graphique le plus proche de l'utilisateur donn√©.  Pour acc√©l√©rer cela, j'ai divis√© le graphique entier en petits secteurs, en utilisant la formule de coordonn√©es, vous pouvez instantan√©ment obtenir l'ID du secteur, puis s√©lectionner le sommet uniquement √† l'int√©rieur du secteur, et non dans le graphique entier, ce qui est beaucoup plus rapide. </li></ol><br><p>  Apr√®s toutes les manipulations, nous obtenons la construction de tout itin√©raire de marche raisonnable √† Saint-P√©tersbourg en 2 secondes, ce qui sonne bien - c'est un temps d'attente acceptable pour les utilisateurs. <br>  Le sch√©ma final est sorti comme ceci: </p><br><p><img src="https://habrastorage.org/webt/gk/f0/mh/gkf0mhnk5i9xnnnm6g1eym_a3ce.jpeg"></p><br><p>  <strong>Total: Je me</strong> suis encore mieux familiaris√© avec les donn√©es OSM, en pratique j'ai r√©solu des probl√®mes de graphes (le cas o√π les algorithmes de graphes √©taient enfin utiles), j'ai √©crit mes premiers benchmarks. </p><br><h2 id="akt-3-pervaya-normalnaya-web-versiya">  Acte 3: La premi√®re version Web normale </h2><br><p>  Voici les premi√®res r√©flexions sur le projet en tant que produit qui peut √™tre utile √† quelqu'un, et non sur l'artisanat sur la table. <br>  Vous devez donc r√©soudre les deux probl√®mes les plus importants: </p><br><ol><li>  Il √©tait imm√©diatement √©vident que la construction d'itin√©raires comme je l'ai fait dans le dernier paragraphe est erron√©e. </li><li>  Un guide dans le navigateur peut ne pas √™tre pratique pour personne - vous voulez vous promener dans la ville, chercher une application pratique o√π vous pouvez lire ce qui est sp√©cial et ainsi de suite.  En bref, au moins - vous avez besoin d'une interface adaptative sympa, et dans le bon sens d'une application mobile. </li></ol><br><p>  Mais √† ce stade, j'ai d√©cid√© de ne traiter que le premier point.  Nous √©tudions Internet sur ce sujet et l√† encore OSM aide, ou plut√¥t le projet qui est n√© gr√¢ce √† eux - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OSRM</a> . <br>  Sur la base des donn√©es cartographiques d'OSM, l'Open Source Routing Machine peut cr√©er une vari√©t√© d'itin√©raires en temps utile.  Oui, et un projet open source avec une bonne documentation que vous pouvez installer sur votre serveur et utiliser. <br>  En prime, il dispose √©galement d'une API assez pratique. <br>  Et antaresm a d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crit</a> sur OSRM sur un habr qui m'a aid√© √† l'√©poque.  Certes, beaucoup d'eau a coul√© et l'article est obsol√®te.  Mais merci beaucoup √† l'auteur!  La documentation r√©elle et assez bonne est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Apr√®s une installation r√©ussie, nous jetons, presque sans regret, tout notre code sur les routes et commen√ßons √† suivre les routes dans l'API OSRM, et le diagramme final se pr√©sente comme suit: </p><br><p><img src="https://habrastorage.org/webt/by/2_/sg/by2_sgklt4qfns1b6l_i544t9z8.jpeg"></p><br><p>  Nous ne touchons m√™me pas la partie client - de son c√¥t√©, l'API de notre service ne change en rien. </p><br><p>  <strong>Total</strong> : J'ai pens√© √† l'utilisation r√©elle de l'application par d'autres, il s'est av√©r√© que c'√©tait une architecture normale et de bons itin√©raires.  La version Web est toujours disponible, bien qu'elle n'ait pas chang√© depuis lors.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://travelpath.ru/</a> </p><br><h2 id="akt-4-android-prilozhenie">  Acte 4: application Android </h2><br><p>  Malgr√© la solution √† un probl√®me pass√©, il est toujours clair que le projet est toujours inutile pour tout le monde sauf moi.  Parce que vous avez besoin d'une interface normale et, surtout, d'une application mobile, pas d'une version de navigateur.  Maintenant, la technologie a progress√© et, peut-√™tre, il sera d√©j√† possible de faire une application de navigateur de ce type qui fonctionne bien pour les clients mobiles, mais pas en 2015-2016.  Ce qui signifiait une possibilit√© tr√®s √©troite d'utiliser le projet sous la forme d'une version Web - pour s'asseoir √† la maison, s√©lectionner √† l'avance des endroits int√©ressants √† visiter.  Par cons√©quent, si nous parlons d'un produit normal, vous avez besoin d'une application mobile avec une bonne interface. </p><br><p>  Puis en 2016, j'ai commenc√© √† √©crire en Java (mais le backend) et j'ai pens√© que sous Android, ils √©crivaient aussi en Java.  Pourquoi ne pas essayer le d√©veloppement d'applications, cela devrait √™tre une exp√©rience int√©ressante. <br>  Le deuxi√®me probl√®me est que je ne sais pas concevoir et je ne ferai pas moi-m√™me une bonne interface.  Je suis venu visiter mon premier lieu de travail (un petit studio Le-Dantu) et j'ai invit√© mon coll√®gue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">burovk √†</a> participer au projet.  Curieusement, il a accept√©, pour lequel merci beaucoup :) </p><br><p>  <strong>Les premiers sch√©mas et prototypes</strong> <br>  Tout d'abord, nous essayons de trouver un nouveau nom, car TravelPath n'est pas une abr√©viation tr√®s parlante.  Et donc gr√¢ce aux efforts de Cyril appara√Æt ¬´Wander¬ª avec un dr√¥le de logo: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6t/8y/7f/6t8y7fht6pqmxvwnajhrtimxe5u.png"></div><br><p>  Je l'ai fortement associ√© √† un homme moustachu, mais en g√©n√©ral je l'aime bien. </p><br><p>  Ensuite, les premi√®res dispositions de la future application apparaissent: </p><br><p><img src="https://habrastorage.org/webt/t4/u6/x8/t4u6x8pszrlpk7vop64rizgsywu.jpeg"></p><br><p>  Nous pensons √©galement, discutons, que la deuxi√®me option appara√Æt, qui devient la premi√®re version de l'application: </p><br><p><img src="https://habrastorage.org/webt/uk/nr/py/uknrpyeckiz1gdqogmtyngojun4.jpeg"></p><br><p>  Du c√¥t√© du d√©veloppement, j'ai d√©lib√©r√©ment d√©cid√© de ne pas utiliser toutes sortes de frameworks √† la mode qui font une magie diff√©rente - car il y a de gros risques √† les utiliser sans comprendre le travail, et √©tudier les bases et eux prend trop de temps.  Google, nous lisons les quais officiels, les articles √©ducatifs et nous surmontons les difficult√©s. </p><br><p>  Des probl√®mes et des t√¢ches dont on se souvient: </p><br><ul><li>  Pour Android, il existe <code>ProGuard</code> - un utilitaire qui compresse le code source lors de l'assemblage, supprime les inutilis√©s, modifie les noms et plus encore.  Il est raisonnable qu'il existe, mais lorsque vous vous lancez dans le d√©veloppement et que vous le faites vous-m√™me - il n'est pas √©vident qu'il existe des champs de renommage et cela peut affecter le comportement.  Et que tout se passe uniquement dans l'assemblage prod.  √Ä la suite de la sortie, tout est cool, mais pour une raison quelconque, il n'y a pas de statistiques.  Vous commencez √† d√©biter du backend - et le client envoie un non-sens, au lieu des noms de champs normaux - <code>a, b, c</code> , etc.  B√©quilles pour que l'API soit capable d'analyser habilement cela, puis vous d√©couvrez que ProGuard a essay√© et vous devez sp√©cifier les classes n√©cessaires comme exception dans sa configuration.  Rien d'inhabituel en g√©n√©ral, mais l'horloge de d√©bogage s'est envol√©e. </li><li>  Une t√¢che int√©ressante consistait √† mettre √† jour les donn√©es de l'application.  La base de donn√©es principale est livr√©e avec un fichier <code>apk</code> et je le mets √† jour avant chaque version.  Mais vous devez √©galement prendre en charge la mise √† jour sur le r√©seau afin que les clients disposent toujours de nouvelles donn√©es en cas de changement. <br>  Dans la premi√®re version, j'ai d√©cid√© de me concentrer uniquement sur l'heure de la derni√®re mise √† jour.  L'application stocke l'heure de l'objet le plus r√©cent, √† chaque d√©marrage, elle demande au backend avec cette heure si quelque chose de nouveau est apparu.  Des mises √† jour lui sont envoy√©es, le client se souvient √† nouveau de l'heure du plus r√©cent des objets re√ßus (mais pas de l'heure de la mise √† jour elle-m√™me, c'est important). <br>  Il s'est av√©r√© que j'avais mal pens√© - car un an plus tard, une cinqui√®me cat√©gorie est apparue - les b√¢timents.  Et lors de la mise √† niveau de l'ancienne vers la nouvelle version, un probl√®me se pose.  J'ai d√ª changer un peu et le client envoie du temps pour chaque cat√©gorie, pas celle g√©n√©rale.  Mais le sch√©ma n'est toujours pas parfait - lors de l'ajout de nouveaux champs aux objets, des probl√®mes surviennent qui ne peuvent pas √™tre r√©solus comme √ßa.  Il y a des id√©es sur la fa√ßon de faire mieux, mais les mains n'ont pas atteint et en g√©n√©ral la t√¢che n'est pas tr√®s prioritaire.  Moralit√© - il vaut la peine d'aborder soigneusement ces questions et de r√©fl√©chir un peu √† l'avance. </li></ul><br><p>  Et je veux √©galement dire ce que tout le monde sait d√©j√† - Stack Overflow est incroyablement cool et cela est particuli√®rement visible lorsque vous vous lancez dans le d√©veloppement de quelque chose d'ext√©rieur comme je l'ai fait - √©crivez imm√©diatement l'application, et pas en douceur √† partir des cours, des guides, des exemples de d√©monstration .  Et quand il n'y a personne √† demander √† un ami.  Mais √† c√¥t√© de lui, les discussions sur le d√©veloppement Android ont √©galement aid√© - vous pouvez y poser des questions plus abstraites et demander des conseils sur la meilleure fa√ßon de faire quelque chose. </p><br><p>  5 d√©cembre 2016, l'application arrive sur Google Play <br>  Il n'avait que des fonctions de base - tracer un itin√©raire, afficher des informations sur les points.  Mais m√™me cela semblait un succ√®s!  Le succ√®s, bien s√ªr, seulement √† leurs propres yeux.  Il √©tait entendu que l'application est encore brute et doit √™tre am√©lior√©e. </p><br><p>  <strong>La premi√®re version compl√®te et les m√©dias</strong> <br>  Par cons√©quent, je consid√®re la prochaine version comme une version compl√®te et un premier lancement. <br>  Tout d'abord, nous avons examin√© √† la fois le design et le logo - maintenant, il est devenu comme ceci: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4c/0q/ii/4c0qii9_t77tgksfkp31mldx94k.png" width="96"></div><br><p>  Et ils ont ajout√© des fonctionnalit√©s importantes pour le guide - favoris, points de vue sur la carte elle-m√™me, une liste d'attractions avec une recherche.  L'application mise √† jour ressemblait √† ceci: </p><br><p><img src="https://habrastorage.org/webt/eo/fh/2j/eofh2jhc1tjz8lyrc1t-ra9kpnk.jpeg"></p><br><p>  Une autre id√©e est venue: contacter la Nuit des Mus√©es et cr√©er un mode s√©par√© pour l'√©v√©nement √† Saint-P√©tersbourg. <br>  La Nuit des mus√©es est une f√™te internationale annuelle o√π les mus√©es sont ouverts la nuit, souvent avec des programmes sp√©ciaux.  Un seul billet est valable et beaucoup essaient de se d√©placer dans de nombreux mus√©es √† la fois.  En m√™me temps, il n'y a pas de navigateur / carte pour mobile - seulement quelques fonctionnalit√©s sur le site officiel de l'√©v√©nement. <br>  On dirait qu'il correspond parfaitement √† l'id√©e de Wander et est √©galement en demande.  J'ai contact√© les organisateurs de l'√©v√©nement, mais malheureusement, l'id√©e n'a pas √©t√© appr√©ci√©e et elle est rest√©e dans mon esprit jusqu'√† des temps meilleurs. </p><br><p>  En fin de compte, cela s'est av√©r√© cool et, enfin, l'application a pu √™tre pleinement utilis√©e.  Le 2 juin 2018, une version est sortie et nous avons d√©cid√© d'essayer de la montrer au monde - nous avons achet√© de la publicit√© sur VKontakte et Instagram.  Mais surtout, ils ont √©crit √† quelques m√©dias.  Le journal a √©crit une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">note</a> sur le lancement de l'application, apr√®s qu'un certain nombre de publications de P√©tersbourg - The Village, Dog et autres - ont √©t√© √©crites ou r√©imprim√©es avec un fan.  Et enfin il y avait du trafic!  Les installations se sont pr√©cipit√©es avec un pic, des graphiques d'activit√© √† l'int√©rieur de l'application aussi.  Bien s√ªr, nous n'avons pas eu √† nous r√©jouir longtemps - mais nous avons eu les premiers utilisateurs, un retour utile et en g√©n√©ral c'√©tait tr√®s motivant.  Le m√™me √©t√©, le trafic provenant de la recherche Google Play √©tait visible, ce qui √©tait tr√®s agr√©able, mais plus tard, le r√©sultat n'a pas pu √™tre reproduit. <br>  Dans l'ensemble, cela a donn√© une motivation assez forte et a aid√© √† continuer √† travailler sur l'application. </p><br><p>  <strong>Que faire ensuite?</strong>  <strong>Nuit des mus√©es, Google mal√©fique, itin√©raires circulaires</strong> </p><br><p>  La saison est pass√©e, l'activit√© dans l'application a chut√© de fa√ßon spectaculaire et il √©tait clair que les fonctionnalit√©s de sciage ne sont pas tr√®s utiles - personne ne les verra, il n'y a pas de budget pour le marketing.  Il fallait trouver quelque chose, puis nous sommes revenus √† l'id√©e repouss√©e avec la Nuit des mus√©es. <br>  Mais encore une fois, il n'a pas √©t√© possible de s'entendre sur un partenariat, mais cette fois, nous avons d√©cid√© de ne pas repousser l'id√©e, mais de tout faire par nous-m√™mes.  Il s'est av√©r√© un certain nombre de fonctionnalit√©s utiles dans un mode de guide s√©par√©: mus√©es sur la carte, itin√©raires uniquement pour les participants, br√®ves informations, favoris. </p><br><p>  En plus de ce mode, m√™me √† partir de l'arri√©r√©, nous avons obtenu la pr√©servation de l'itin√©raire et, surtout, la fonctionnalit√© sur les itin√©raires circulaires. </p><br><p>  Les itin√©raires circulaires √©taient toujours plus importants que les itin√©raires AB, mais ils √©taient obstin√©ment ignor√©s.  Pourtant, les gens se prom√®nent souvent dans le m√©tro / la maison / le travail / l'h√¥tel que de A √† B. Finalement, ils ont atteint leurs mains et j'ai trouv√© une simple heuristique: <br>  Nous obtenons tous les points √† l'int√©rieur du rayon donn√©.  Le rayon est le limiteur de la longueur de l'itin√©raire.  Nous s√©lectionnons d'abord un point (conditionnellement al√©atoire).  Tous les autres sont tri√©s par ordre croissant de l'angle entre lui, le centre et le point donn√©.          /  ,  . </p><br><p>       ,            . </p><br><p>     ,  ,   : </p><br><p><img src="https://habrastorage.org/webt/fe/nx/6s/fenx6slnfgifc85nw-prhsv51mq.jpeg"></p><br><p>    ,   ,       ,     ,  ,    .     ‚Äî  ,         , . </p><br><p>        Kotlin   , ,   Wander.   ,     .    ,   .         ,     java   ‚Äî       . </p><br><p>     ,  ,  ,   .          ‚Äî    The Village.        -        1000 ,    1400   . ,      Wander  , , ,       .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . </p><br><p>    Google  .            ‚Äî  2018      ,         API.        ‚Äî         2018-        <code>Places API</code>   .         API,   -  ‚Äî        .        . </p><br><p>        ‚Äî  <code>Places API</code> ,          .        ,      .  ,         ‚Äî   Google Maps,    .           . </p><br><p> <strong></strong> :  android        Google Play,       .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">burovk</a> ,    Wander    ,       . </p><br><h2 id="ty-teper-ne-tolko-razrabotchik">      </h2><br><p>    ,   ,       ,     ‚Äî       .      ,  ,    ,      ‚Äî     .   ,   ‚Äî ,      .    ,         ,     . </p><br><ul><li>                 ‚Äî          <code>git tag v1.0.5</code> . </li><li>   ,   ,   ,    . </li><li>         -   ,       . </li><li>            ‚Äî      ,    //etc       . </li></ul><br><p>        Android  .      , ,      ,       . </p><br><p>       ‚Äî      ,    . </p><br><h2 id="plany">  </h2><br><p>  !  ,       .  , ,    ,           ,      ,   . <br>      : </p><br><ol><li>     ‚Äî ? -   ? </li><li>   .   ,    ‚Äî   . </li><li>   IOS </li><li>   </li></ol><br><p>     . ,   IOS      ,    . </p><br><p>      ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google Play</a> . </p><br><h2 id="vyvody">  Conclusions </h2><br><ul><li>      ,   ‚Äî .      ,          .           . ,       . </li><li>   ‚Äî  ,      .   backend ,       ,    android   Kotlin,   ,  ,     .     ,     . </li><li>      ‚Äî .      - ,           .   -   .   ,    ‚Äî   . </li></ul><br><p>     .         IOS (   ) ‚Äî   ! </p><br><p>  PS <br>         ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/414433/</a> .         . ,       (    -!),       . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471216/">https://habr.com/ru/post/fr471216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471198/index.html">Nous √©tudions l'√©nonc√© du th√©or√®me central limite en utilisant la distribution exponentielle</a></li>
<li><a href="../fr471202/index.html">Comment je n'ai pas pu allumer mon MacBook en raison de la d√©sinstallation de TeamViewer</a></li>
<li><a href="../fr471204/index.html">Reconna√Ætre la date et l'heure dans un discours naturel</a></li>
<li><a href="../fr471210/index.html">Dieu ... Ballade sur un programmeur</a></li>
<li><a href="../fr471212/index.html">10 trucs et astuces pour vous aider √† devenir le meilleur d√©veloppeur sur VueJS</a></li>
<li><a href="../fr471220/index.html">Cockpit - simplifiez les t√¢ches administratives typiques sous Linux gr√¢ce √† une interface Web pratique</a></li>
<li><a href="../fr471222/index.html">La compr√©hension des politiques de confidentialit√© des applications et des services aidera les r√©seaux de neurones</a></li>
<li><a href="../fr471226/index.html">Linux a plusieurs visages: comment travailler sur n'importe quelle distribution</a></li>
<li><a href="../fr471228/index.html">Grokay PyTorch</a></li>
<li><a href="../fr471232/index.html">Mon exp√©rience de connexion du LPS331AP √† Omega Onion2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>