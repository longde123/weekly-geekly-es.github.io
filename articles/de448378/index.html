<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéæ üêá ü§òüèª DHCP-Sicherheit in Windows 10: Erkundung der kritischen Sicherheitsanf√§lligkeit CVE-2019-0726 üòë üè∏ ‚õΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bild: Pexels 

 Mit der Ver√∂ffentlichung der Januar-Updates f√ºr Windows erregte die Nachricht von der kritisch gef√§hrlichen Sicherheitsanf√§lligkeit CV...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DHCP-Sicherheit in Windows 10: Erkundung der kritischen Sicherheitsanf√§lligkeit CVE-2019-0726</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/448378/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/sw/gb/5n/swgb5nnwlka74q3klyp10gk-ofu.jpeg"></a> <br><br>  <i>Bild: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pexels</a></i> <br><br>  Mit der Ver√∂ffentlichung der Januar-Updates f√ºr Windows <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erregte</a> die Nachricht von der kritisch gef√§hrlichen Sicherheitsanf√§lligkeit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CVE-2019-0547</a> in DHCP-Clients die √ñffentlichkeit.  Die hohe CVSS-Bewertung und die Tatsache, dass Microsoft die Leistungsbewertung nicht sofort ver√∂ffentlichte, was es den Benutzern schwer machte, sich f√ºr ein dringendes Systemupdate zu entscheiden, weckte das Interesse.  Einige Ver√∂ffentlichungen schlugen sogar vor, dass das Fehlen eines Index als Beweis daf√ºr interpretiert werden kann, dass in naher Zukunft ein funktionierender Exploit auftreten wird. <a name="habracut"></a><br><br>  L√∂sungen wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MaxPatrol 8</a> k√∂nnen Computer im Netzwerk identifizieren, die f√ºr bestimmte Angriffe anf√§llig sind.  Andere L√∂sungen wie PT NAD erkennen solche Angriffe selbst.  Um dies zu erm√∂glichen, m√ºssen sowohl die Regeln zum Erkennen von Schwachstellen in Produkten als auch die Regeln zum Erkennen von Angriffen auf diese Produkte beschrieben werden.  Um dies zu erm√∂glichen, muss jede einzelne Sicherheitsanf√§lligkeit den Vektor, die Methode und die Bedingungen ihrer Operation herausfinden, dh buchst√§blich alle Details und Nuancen, die mit der Operation verbunden sind.  Ein viel vollst√§ndigeres und tieferes Verst√§ndnis ist erforderlich als das, was normalerweise aus Beschreibungen auf Anbieterseiten oder in CVE zusammengestellt werden kann, wie z. <br><br><blockquote>  Die Sicherheitsanf√§lligkeit tritt auf, weil das Betriebssystem Objekte im Speicher falsch verarbeitet. </blockquote><br>  Um den Produkten des Unternehmens die Regeln zum Erkennen von Angriffen auf eine neu erstellte Sicherheitsanf√§lligkeit in DHCP sowie die Regeln zum Identifizieren der von ihr betroffenen Ger√§te hinzuzuf√ºgen, sollten Sie die Details verstehen.  Bei bin√§ren Sicherheitsl√ºcken wird Patch-Diff h√§ufig verwendet, um einen Einblick in die zugrunde liegenden Fehler zu erhalten, dh einen Vergleich der √Ñnderungen, die am Bin√§rcode einer Anwendung, Bibliothek oder eines Kernels des Betriebssystems vorgenommen wurden, mit einem bestimmten Patch. Dieses Update behebt diesen Fehler.  Aber die erste Stufe ist immer die Aufkl√§rung. <br><br>  <b>Hinweis</b> : <i>Um direkt zur Beschreibung der Sicherheitsanf√§lligkeit zu gelangen und die zugrunde liegenden DHCP-Konzepte zu umgehen, k√∂nnen Sie die ersten Seiten √ºberspringen und direkt zum Abschnitt "DecodeDomainSearchListData-Funktion" wechseln.</i> <br><br><h2>  Aufkl√§rung </h2><br>  Wir wenden uns an die Suchmaschine und zeigen alle derzeit bekannten Schwachstellendetails an.  Dieses Mal gibt es ein Minimum an Details, und alle sind kostenlose Prozessionen der Informationen, die aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Originalver√∂ffentlichung</a> auf der MSRC-Website stammen.  Diese Situation ist typisch f√ºr Fehler, die Microsoft w√§hrend eines internen Audits entdeckt hat. <br><br>  Aus der Ver√∂ffentlichung geht hervor, dass wir mit einer Sicherheitsl√ºcke des Typs Speicherbesch√§digung konfrontiert sind, die sowohl in Client- als auch in Serversystemen von Windows 10 Version 1803 enthalten ist und sich in dem Moment manifestiert, in dem ein Angreifer speziell gestaltete Antworten an einen DHCP-Client sendet.  Nach einigen Tagen ab diesem Moment auf der Seite werden auch die Leistungsindizes angezeigt: <br><br><img src="https://habrastorage.org/webt/oi/kr/ha/oikrhaavmkrvqdgzpfxqp4oquiy.png"><br><br>  Wie Sie sehen k√∂nnen, bewertete MSRC "2 - Ausbeutung weniger wahrscheinlich".  Dies bedeutet, dass ein Fehler mit hoher Wahrscheinlichkeit entweder √ºberhaupt nicht betriebsbereit ist oder der Betrieb mit solchen Schwierigkeiten behaftet ist, deren √úberwindung zu hohe Arbeitskosten erfordert.  Zugegebenerma√üen neigt Microsoft dazu, solche Sch√§tzungen nicht zu untersch√§tzen.  Dies wird teilweise durch das Risiko von Reputationsverlusten und teilweise durch eine gewisse Unabh√§ngigkeit des Reaktionszentrums innerhalb des Unternehmens beeinflusst.  Nehmen wir daher an: Da die Gefahr der Ausbeutung im Bericht als unwahrscheinlich angegeben wird, ist dies sicherlich der Fall.  Eigentlich h√§tte dies die Analyse vervollst√§ndigen k√∂nnen, aber es w√§re nicht √ºberfl√ºssig, die Sicherheitsanf√§lligkeit noch einmal zu √ºberpr√ºfen und zumindest herauszufinden.  Letztendlich wiederholen sich Fehler trotz aller unbestreitbaren Pers√∂nlichkeit und manifestieren sich an anderen Orten. <br><br>  Von derselben Seite laden wir den Patch (Sicherheitsupdate) herunter, der in Form eines MSU-Archivs bereitgestellt wird, entpacken ihn und suchen nach Dateien, die h√∂chstwahrscheinlich mit der Verarbeitung von DHCP-Antworten auf der Clientseite zusammenh√§ngen.  In letzter Zeit ist es viel schwieriger geworden, dies zu tun, da Updates nicht in Form von separaten Paketen bereitgestellt wurden, die bestimmte Fehler beheben, sondern als einzelnes kumulatives Paket, das alle monatlichen Korrekturen enth√§lt.  Dies erh√∂hte das √ºberm√§√üige Rauschen erheblich, dh √Ñnderungen, die nicht mit unserer Aufgabe zusammenh√§ngen. <br><br>  Bei der Suche werden unter dem gesamten Dateisatz mehrere f√ºr den Filter geeignete Bibliotheken gefunden, die wir mit ihren Versionen auf einem nicht gepatchten System vergleichen.  Die Bibliothek dhcpcore.dll sieht am vielversprechendsten aus.  In diesem Fall f√ºhrt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BinDiff</a> nur minimale √Ñnderungen durch: <br><br> <a href=""><img src="https://habrastorage.org/webt/vr/ml/oe/vrmloeuvnuyeqib2f8rarowqnri.png"></a> <br><br>  Abgesehen von kosmetischen √Ñnderungen an einer einzelnen Funktion - DecodeDomainSearchListData.  Wenn Sie mit dem DHCP-Protokoll und seinen nicht allzu h√§ufig verwendeten Optionen vertraut sind, k√∂nnen Sie bereits davon ausgehen, dass diese Funktion die Liste verarbeitet.  Wenn nicht, fahren Sie mit der zweiten Phase fort - dem Studium des Protokolls. <br><br><h2>  DHCP und seine Optionen </h2><br>  DHCP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 2131</a> | <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wiki</a> ) ist ein erweiterbares Protokoll, dessen Nachschubfunktionen √ºber das Optionsfeld bereitgestellt werden.  Jede Option wird durch ein eindeutiges Tag (Nummer, Kennung), die Gr√∂√üe der in der Option enthaltenen Daten und die Daten selbst beschrieben.  Diese Vorgehensweise ist typisch f√ºr Netzwerkprotokolle, und eine der in das Protokoll ‚Äûimplantierten‚Äú Optionen ist die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 3397</a> beschriebene Dom√§nensuchoption.  Damit kann der DHCP-Server die Standarddom√§nennamenendungen auf Clients festlegen, die als DNS-Suffixe f√ºr die auf diese Weise konfigurierte Verbindung verwendet werden. <br><br>  Nehmen wir zum Beispiel die folgenden Namensendungen f√ºr unseren Kunden an: <br><br><pre><code class="bash hljs">.microsoft.com .wikipedia.org</code> </pre> <br><img src="https://habrastorage.org/webt/_a/7o/ag/_a7oag6njc0p-kdww7o32ggatxc.png"><br><br>  Bei jedem Versuch, die Adresse anhand des Dom√§nennamens zu ermitteln, ersetzen die DNS-Abfragen nacheinander die Suffixe aus dieser Liste, bis eine erfolgreiche Zuordnung gefunden wurde.  Wenn der Benutzer beispielsweise ru in die Adressleiste des Browsers eingegeben hat, werden DNS-Abfragen zuerst f√ºr ru.microsoft.com und dann f√ºr ru.wikipedia.org generiert: <br><br><img src="https://habrastorage.org/webt/qu/8v/kz/qu8vkzddg_pkqvt1o4dwstz2eho.png"><br><br>  Tats√§chlich sind moderne Browser zu intelligent und reagieren daher auf Weiterleitungen zur Suchmaschine auf Namen, die dem FQDN nicht √§hnlich sind.  Daher legen wir im Folgenden die Schlussfolgerung von weniger verdorbenen Versorgungsunternehmen bei: <br><br><img src="https://habrastorage.org/webt/ke/tq/f3/ketqf3pyckb-rp2en-dygbswtrq.png"><br><br>  Dem Leser scheint dies die Sicherheitsanf√§lligkeit zu sein, da die blo√üe M√∂glichkeit, DNS-Suffixe durch einen DHCP-Server zu ersetzen, mit dem sich jedes Ger√§t im Netzwerk identifizieren kann, eine Bedrohung f√ºr Clients darstellt, die Netzwerkparameter √ºber DHCP anfordern .  Aber nein: Wie aus dem RFC hervorgeht, wird dies als rechtm√§√üiges, dokumentiertes Verhalten angesehen.  Tats√§chlich ist der DHCP-Server von Natur aus eine dieser vertrauensw√ºrdigen Komponenten, die einen starken Einfluss auf die Ger√§te haben k√∂nnen, die auf sie zugreifen. <br><br><h2>  Domain-Suchoption </h2><br>  Die Domain-Suchoption ist mit 0x77 (119) nummeriert.  Wie alle Optionen wird es mit einem Einzelbyte-Tag mit der Optionsnummer codiert.  Wie bei den meisten anderen Optionen wird unmittelbar nach dem Tag eine Einzelbyte-Gr√∂√üe der Daten nach der Gr√∂√üe angezeigt.  Optionsinstanzen k√∂nnen in der DHCP-Nachricht mehrmals vorhanden sein.  In diesem Fall werden Daten aus all diesen Abschnitten in der Reihenfolge verkettet, in der sie in der Nachricht erscheinen. <br><br><img src="https://habrastorage.org/webt/cp/dg/yz/cpdgyzwd_4zxdxiujznhojbfczk.png"><br><br>  In dem vorgestellten Beispiel aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 3397</a> sind die Daten in drei Abschnitte mit jeweils 9 Bytes unterteilt.  Wie Sie auf dem Bild sehen k√∂nnen, werden die Subdomainnamen im vollst√§ndig qualifizierten Dom√§nennamen mit einer Einzelbyte-L√§nge des Namens codiert, unmittelbar gefolgt vom Namen selbst.  Die Codierung des vollst√§ndig qualifizierten Dom√§nennamens endet mit einem Null-Byte (dh einem Subdom√§nennamen mit der Gr√∂√üe Null). <br><br>  Dar√ºber hinaus verwendet die Option die einfachste Methode zur Datenkomprimierung oder vielmehr nur Analysepunkte.  Anstelle der Gr√∂√üe des Dom√§nennamens kann das Feld den Wert 0xc0 enthalten.  Das n√§chste Byte setzt dann den Offset relativ zum Anfang der Optionsdaten, mit denen nach dem Ende des Dom√§nennamens gesucht werden soll. <br><br>  In diesem Beispiel wird daher eine Liste von zwei Dom√§nensuffixen codiert: <br><br><pre> <code class="bash hljs">.eng.apple.com .marketing.apple.com</code> </pre><br><h2>  DecodeDomainSearchListData-Funktion </h2><br>  Mit der DHCP-Optionsnummer 0x77 (119) kann der Server DNS-Suffixe auf Clients konfigurieren.  Aber nicht auf Computern mit Windows-Betriebssystemen.  Microsoft-Systeme haben diese Option traditionell ignoriert, sodass das Ende von DNS-Namen bei Bedarf in der Vergangenheit durch Gruppenrichtlinien gerollt wurde.  Dies wurde bis vor kurzem fortgesetzt, als in der n√§chsten Version von Windows 10, Version 1803, die Verarbeitung f√ºr die Dom√§nensuchoption hinzugef√ºgt wurde.  Gemessen am Namen der Funktion in dhcpcore.dll, in der die √Ñnderungen vorgenommen wurden, liegt der betreffende Fehler im hinzugef√ºgten Handler. <br><br>  An die Arbeit gehen.  Wir k√§mmen den Code ein wenig und finden Folgendes heraus.  Die DecodeDomainSearchListData-Prozedur dekodiert in voller √úbereinstimmung mit dem Namen die Daten aus der Dom√§nensuchoption der vom Server empfangenen Nachricht.  Bei der Eingabe empf√§ngt es ein Datenarray, das auf die im vorherigen Absatz beschriebene Weise gepackt wurde, und bei der Ausgabe wird eine nullterminierte Zeichenfolge generiert, die eine durch Kommas getrennte Liste von Dom√§nennamenenden enth√§lt.  Diese Funktion konvertiert beispielsweise die Daten aus dem obigen Beispiel in eine Zeichenfolge: <br><br><pre> <code class="bash hljs"> eng.apple.com,marketing.apple.com</code> </pre> <br>  DecodeDomainSearchListData wird von der UpdateDomainSearchOption-Prozedur aufgerufen, die die zur√ºckgegebene Liste auf den Wert "DhcpDomainSearchList" des Registrierungsschl√ºssels setzt: <br> <code>HKLM\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\{INTERFACE_GUID}\</code> <br>  Speichern der Hauptparameter einer bestimmten Netzwerkschnittstelle. <br><br><img src="https://habrastorage.org/webt/po/cq/zk/pocqzkd8ldtqb8ecrh_oyiajgba.png"><br><br>  Die Funktion DecodeDomainSearchListData wird in zwei Durchg√§ngen ausgef√ºhrt.  Beim ersten Durchgang werden alle Aktionen au√üer dem Schreiben in den Ausgabepuffer ausgef√ºhrt.  Somit ist der erste Durchgang der Berechnung der Speichergr√∂√üe gewidmet, die erforderlich ist, um die zur√ºckgegebenen Daten aufzunehmen.  Beim zweiten Durchgang wird bereits Speicher f√ºr diese Daten zugewiesen und der zugewiesene Speicher wird gef√ºllt.  Die Funktion ist ziemlich klein, ungef√§hr 250 Anweisungen, und ihre Hauptaufgabe besteht darin, jede der drei m√∂glichen Optionen f√ºr das im Eingabestream dargestellte Zeichen zu verarbeiten: 1) 0x00, 2) 0xc0 oder 3) alle anderen Werte.  Die hypothetische Korrektur f√ºr den DHCP-bezogenen Fehler besteht im Wesentlichen darin, zu Beginn des zweiten Durchgangs eine √úberpr√ºfung der Gr√∂√üe des resultierenden Puffers hinzuzuf√ºgen.  Wenn diese Gr√∂√üe Null ist, wird der Speicher nicht f√ºr den Puffer zugewiesen und die Funktion beendet sofort die Ausf√ºhrung und gibt einen Fehler zur√ºck: <br><br><img src="https://habrastorage.org/webt/fn/ym/4g/fnym4gbsu66h64bn03lwrqttxlm.png"><br><br>  Es stellt sich heraus, dass sich die Sicherheitsanf√§lligkeit in F√§llen manifestiert, in denen die Gr√∂√üe des Zielpuffers Null ist.  Gleichzeitig pr√ºft die Funktion zu Beginn der Ausf√ºhrung die Eingabedaten, deren Gr√∂√üe nicht weniger als zwei Bytes betragen darf.  F√ºr den Betrieb ist es daher erforderlich, eine nicht leere Option f√ºr Dom√§nensuffixe so auszuw√§hlen, dass die Gr√∂√üe des Ausgabepuffers Null ist. <br><br><h2>  Bedienung </h2><br>  Das erste, was Ihnen in den Sinn kommt, ist, dass Sie die zuvor beschriebenen Analysepunkte verwenden k√∂nnen, damit nicht leere Eingabedaten eine leere Ausgabezeile erzeugen: <br><br><img src="https://habrastorage.org/webt/fz/px/vp/fzpxvpozmhgp7sbxoavng5hork8.png"><br><br>  Ein Server, der so konfiguriert ist, dass er eine Option mit solchen Inhalten in der Antwort sendet, f√ºhrt tats√§chlich zu einer Zugriffsverletzung auf nicht aktualisierten Clients.  Dies geschieht aus folgendem Grund.  Wenn die Funktion bei jedem Schritt einen Teil des vollst√§ndig qualifizierten Dom√§nennamens analysiert, kopiert sie ihn in den Zielpuffer und setzt einen Punkt danach.  In dem Beispiel aus dem RFC werden die Daten in der folgenden Reihenfolge in den Puffer kopiert: <br><br><pre> <code class="bash hljs">1). eng. 2). eng.apple. 3). eng.apple.com.</code> </pre> <br>  Wenn die Dom√§ne keine Dom√§nengr√∂√üe enth√§lt, ersetzt die Funktion das vorherige Zeichen des Zielpuffers durch ein Komma: <br><br><pre> <code class="bash hljs">4). eng.apple.com,</code> </pre> <br>  und analysiert weiter: <br><br><pre> <code class="bash hljs">5). eng.apple.com,marketing. 6). eng.apple.com,marketing.apple. 7). eng.apple.com,marketing.apple.com. 8). eng.apple.com,marketing.apple.com,</code> </pre> <br>  Am Ende der Eingabe muss nur noch das letzte Komma durch ein Nullzeichen ersetzt werden, und Sie erhalten eine Zeile zum Schreiben in die Registrierung: <br><br><pre> <code class="bash hljs">9). eng.apple.com,marketing.apple.com</code> </pre> <br>  Was passiert, wenn ein Angreifer einen auf die beschriebene Weise gebildeten Puffer sendet?  Wenn Sie sich das Beispiel ansehen, sehen Sie, dass die darin enthaltene Liste aus einem Element besteht - einer leeren Zeichenfolge.  Beim ersten Durchgang berechnet die Funktion die Gr√∂√üe der Ausgabedaten.  Da die Daten keinen einzelnen Dom√§nennamen ungleich Null enthalten, ist die Gr√∂√üe Null. <br><br>  Beim zweiten Durchgang wird ein dynamischer Speicherblock zugewiesen, um Daten darin abzulegen und die Daten selbst zu kopieren.  Die Analysefunktion st√∂√üt jedoch sofort auf ein Nullzeichen, das das Ende des Dom√§nennamens kennzeichnet, und ersetzt daher, wie gesagt, das vorherige Zeichen von einem Punkt durch ein Komma.  Und hier stehen wir vor einem Problem.  Der Zielpuffer-Iterator befindet sich an Position Null.  Es gibt kein vorheriges Zeichen.  Das vorherige Zeichen geh√∂rt zum Header des dynamischen Speicherblocks.  Und dasselbe Zeichen wird durch 0x2c ersetzt, dh durch ein Komma. <br><br>  Dies geschieht jedoch nur auf 32-Bit-Systemen.  Wenn Sie unsigned int verwenden, um die aktuelle Position des Zielpuffer-Iterators zu speichern, werden Anpassungen an der Verarbeitung auf x64-Systemen vorgenommen.  Achten wir genauer auf den Code, der f√ºr das Schreiben eines Kommas in den Puffer verantwortlich ist: <br><br><img src="https://habrastorage.org/webt/cv/wr/da/cvwrdacd4nzbpec5skyyqubd5sg.png"><br><br>  Die Einheit wird unter Verwendung des 32-Bit-eax-Registers von der aktuellen Position subtrahiert, w√§hrend der Code beim Adressieren des Puffers auf das vollst√§ndige 64-Bit-Rax-Register zugreift.  In der AMD64-Architektur machen alle Operationen mit 32-Bit-Registern den oberen Teil des Registers ung√ºltig.  Dies bedeutet, dass im Rax-Register, das zuvor Null enthielt, nach der Subtraktion nicht der Wert ‚Äì1, sondern 0xffffffff gespeichert wird.  Daher wird auf 64-Bit-Systemen der Wert 0x2c in die Adresse buf [0xffffffff] geschrieben, dh weit √ºber die Grenzen des f√ºr den Puffer zugewiesenen Speichers hinaus. <br><br>  Die erhaltenen Daten stimmen gut mit der Leistungsbewertung von Microsoft √ºberein, da ein Angreifer, um diese Sicherheitsanf√§lligkeit auszunutzen, lernen muss, wie er auf einem DHCP-Client Heap-Spray aus der Ferne ausf√ºhrt, und gleichzeitig eine ausreichende Kontrolle √ºber die Zuweisung des dynamischen Speichers hat, um vordefinierte Werte, n√§mlich ein Komma, aufzuzeichnen und Null Byte, erzeugt in der vorbereiteten Adresse und f√ºhrte zu kontrollierten negativen Konsequenzen.  Andernfalls f√ºhrt das Schreiben von Daten an eine nicht verifizierte Adresse dazu, dass der Prozess svchost.exe zusammen mit allen derzeit darin gehosteten Diensten gel√∂scht wird und diese Dienste vom Betriebssystem erneut gestartet werden.  Eine Tatsache, die Angreifer unter bestimmten Bedingungen auch zu ihrem eigenen Vorteil nutzen k√∂nnen. <br><br>  Das scheint alles zu sein, was √ºber den untersuchten Fehler gesagt werden kann.  Es bleibt nur das Gef√ºhl, dass dies noch lange nicht zu Ende ist.  Als ob wir nicht alle Optionen in Betracht gezogen h√§tten.  In diesen Zeilen muss noch etwas verborgen sein. <br><br><h2>  CVE-2019-0726 </h2><br>  Wahrscheinlich so wie es ist.  Wenn Sie sich den Datentyp, der den Fehler verursacht, genau ansehen und ihn mit dem genauen Auftreten dieses Fehlers vergleichen, werden Sie feststellen, dass die Liste der Dom√§nennamen so ge√§ndert werden kann, dass der resultierende Puffer eine Gr√∂√üe ungleich Null hat, aber versucht, au√üerhalb des Fehlers zu schreiben das gleiche wird getan.  Dazu muss das erste Element in der Liste eine leere Zeichenfolge sein, und alle anderen k√∂nnen normale Dom√§nenenden enthalten.  Zum Beispiel: <br><br><img src="https://habrastorage.org/webt/b2/me/mx/b2memx0tuctb6b7oozdlqwykubw.png"><br><br>  Die vorgestellte Option enth√§lt zwei Elemente.  Das erste Domain-Suffix ist leer und endet sofort mit einem Null-Byte.  Das zweite Suffix ist .ru.  Die berechnete Zeilengr√∂√üe am Ausgang betr√§gt drei Bytes, wodurch die durch die Januar-Aktualisierung der Leere des Zielpuffers auferlegte √úberpr√ºfung √ºberwunden werden kann.  Gleichzeitig erzwingt Null am Anfang der Daten die Funktion, ein Komma mit dem vorherigen Zeichen in die resultierende Zeichenfolge zu schreiben. Da jedoch die aktuelle Position des Iterators in der Zeichenfolge Null ist, wie im oben betrachteten Fall, erfolgt die Aufzeichnung erneut au√üerhalb des zugewiesenen Puffers. <br><br>  Nun ist es notwendig, die in der Praxis erzielten theoretischen Ergebnisse zu best√§tigen.  Wir simulieren eine Situation, in der der DHCP-Server eine Nachricht mit der Option sendet, die als Antwort auf eine Anforderung vom Client angezeigt wird, und sofort eine Ausnahme abfangen, wenn versucht wird, ein Komma an die unter der resultierenden Pufferzeile zugewiesene Position 0xffffffff zu schreiben: <br><br><img src="https://habrastorage.org/webt/o3/zk/us/o3zkus_tpdsnpbtff_rqnlu1cdw.png"><br><br>  Hier enth√§lt das r8-Register einen Zeiger auf die eingehenden Optionen, rdi ist die Adresse des ausgew√§hlten Zielpuffers und rax ist die Position in diesem Puffer, an der das Zeichen geschrieben werden soll.  Wir haben solche Ergebnisse auf einem vollst√§ndig aktualisierten System erhalten (Stand Januar 2019). <br><br>  Wir schreiben √ºber das entdeckte Problem in Microsoft und ... sie verlieren den Brief.  Ja, dies passiert manchmal sogar bei seri√∂sen Anbietern.  Kein System ist perfekt, und in diesem Fall m√ºssen Sie nach anderen Kommunikationswegen suchen.  Daher kontaktieren wir eine Woche sp√§ter, ohne in dieser Zeit auch nur eine automatische Antwort zu erhalten, den Manager direkt √ºber Twitter. Nach den Ergebnissen einer mehrt√§gigen Analyse der Anwendung stellen wir fest, dass die gesendeten Details nichts mit CVE-2019-0547 zu tun haben und eine unabh√§ngige Sicherheitsanf√§lligkeit darstellen neue CVE-Kennung.  Einen Monat sp√§ter, im M√§rz, erscheint die entsprechende Korrektur und der Fehler erh√§lt die Nummer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CVE-2019-0726</a> . <br><br>  Auf diese Weise k√∂nnen Sie manchmal versuchen, die Details der 1-Tages-Sicherheitsanf√§lligkeit herauszufinden, um versehentlich 0-Tage zu entdecken, indem Sie einfach Ihrer Intuition vertrauen. <br><br>  <b>Gepostet von</b> Mikhail Tsvetkov, Spezialist f√ºr Anwendungsanalysen bei Positive Technologies. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448378/">https://habr.com/ru/post/de448378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448366/index.html">Rust 1.34 Release</a></li>
<li><a href="../de448368/index.html">SQL: die Aufgabe der Arbeitszeit</a></li>
<li><a href="../de448372/index.html">H√∂ren Sie auf, exzellente Arbeitssuchende mit Ihren falschen Fragen abzulehnen.</a></li>
<li><a href="../de448374/index.html">Es gibt neue Hinweise auf vulkanische Aktivit√§ten, die das massivste Aussterben in der Geschichte verursacht haben.</a></li>
<li><a href="../de448376/index.html">Mathematik sagt Zellen, was sie sein sollen</a></li>
<li><a href="../de448382/index.html">Wie wir die Qualit√§t der Dokumentation bewertet haben</a></li>
<li><a href="../de448386/index.html">9 erstaunlich einfache M√∂glichkeiten, Menschen dazu zu bringen, auf Ihre Nachrichten zu antworten</a></li>
<li><a href="../de448388/index.html">In Russland das erste digitale Diktat</a></li>
<li><a href="../de448390/index.html">Wie man eine Uhr f√ºr Ilona Mask macht</a></li>
<li><a href="../de448392/index.html">Zwei Ans√§tze zur Strukturierung eines Aktivit√§tsdiagramms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>