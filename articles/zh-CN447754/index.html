<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍💼 🙋🏾 👩‍👩‍👧‍👦 适用于macOS的菜单栏应用 🙋🏻 👩‍🏫 🛀🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="菜单栏上的应用程序早已为macOS用户所熟知。 其中一些应用程序具有“正常”部分，其他应用程序仅位于菜单栏中。 
 在本指南中，您将编写一个应用程序，该应用程序在弹出窗口中显示名人的一些报价。 在创建此应用程序的过程中，您将学到： 



- 在菜单栏中分配应用程序图标 
- 使应用程序仅托管在菜单...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>适用于macOS的菜单栏应用</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447754/">菜单栏上的应用程序早已为macOS用户所熟知。 其中一些应用程序具有“正常”部分，其他应用程序仅位于菜单栏中。 <br> 在本指南中，您将编写一个应用程序，该应用程序在弹出窗口中显示名人的一些报价。 在创建此应用程序的过程中，您将学到： <br><br><ul><li> 在菜单栏中分配应用程序图标 </li><li> 使应用程序仅托管在菜单栏上 </li><li> 添加自定义菜单 </li><li> 根据用户的要求显示一个弹出窗口，并在必要时使用<b>事件监视</b>将其隐藏 </li></ul><br><blockquote>  <b>注意：</b>本指南假定您熟悉Swift和macOS。 </blockquote><a name="habracut"></a><br><h2> 开始使用 </h2><br> 启动Xcode。 接下来，在<b>File / New / Project ...</b>菜单上，选择<b>macOS / Application / Cocoa App</b>模板，然后单击<b>Next</b> 。 <br><br> 在下一个屏幕上，输入Quotes作为<b>产品名称</b> ，选择您的<b>组织名称</b>和<b>组织标识符</b> 。 然后，确保已选择Swift作为应用程序语言，并选中了<b>使用Storyboards</b>复选框。 取消选中“ <b>创建基于文档的应用程序”</b> ，“ <b>使用核心数据”</b> ，“ <b>包含单元测试”</b>和“ <b>包括UI测试”复选框</b> 。 <br><br><img src="https://habrastorage.org/webt/4c/_f/g6/4c_fg6hmxqq0k_vqkm8-zqrt_ok.png"><br><br> 最后，再次单击<b>下一步</b> ，指定保存项目的位置，然后单击<b>创建</b> 。 <br> 创建新项目后，打开<b>AppDelegate.swift</b>并将以下属性添加到类中： <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusItem = <span class="hljs-type"><span class="hljs-type">NSStatusBar</span></span>.system.statusItem(withLength:<span class="hljs-type"><span class="hljs-type">NSStatusItem</span></span>.squareLength)</code> </pre> <br> 在这里，我们在菜单栏中创建状态项（应用程序图标），固定长度对用户可见。 <br><br> 然后，我们需要将图片分配给菜单栏中的该新项目，以便区分新应用程序。 <br><br> 在项目导航器中，转到Assets.xcassets， <a href="">上传图片</a>并将其拖动到资产目录中。 <br><br> 选择图片并打开属性检查器。 将“ <b>渲染为”</b>选项更改为“ <b>模板图像”</b> 。 <br><br> <a href=""><img src="https://habrastorage.org/webt/wv/es/-o/wves-ouas8duyvk97fki1swuedk.png"></a> <br><br> 如果您使用自己的图像，请确保该图像是黑白图像，并将其配置为“ <b>模板”图像，</b>以使该图标在深色和浅色菜单栏上看起来都很好。 <br><br> 返回<b>AppDelegate.swift</b> ，并将以下代码添加到<b>applicationDidFinishLaunching（_ :)</b> <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) }</code> </pre> <br> 在这里，我们将刚刚添加的应用程序图标分配给应用程序图标，并在单击它时分配<b>操作</b> 。 <br><br> 将以下方法添加到该类： <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteText = <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteAuthor = <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(quoteText) — \(quoteAuthor)"</span></span>) }</code> </pre> <br> 此方法只是将报价单打印到控制台。 <br><br> 注意<b>objc</b>方法<b>指令</b> 。 这使您可以使用此方法作为对按钮单击的响应。 <br><br> 生成并运行该应用程序，您将在菜单栏中看到新的应用程序。 万岁！ <br> 每次单击菜单栏中的图标时，Xcode控制台中都会显示著名的Mark Twain谚语。 <br><br><h2> 我们将主窗口和图标隐藏在扩展坞中 </h2><br> 在直接处理功能之前，我们需要做一些小事情： <br><br><ul><li> 删除停靠图标 </li><li> 删除不必要的应用程序主窗口 </li></ul><br> 要删除停靠图标，请打开<b>Info.plist</b> 。 添加一个新的<b>Application is agent（UIElement）</b>键，并将其值设置为<b>YES</b> 。 <br><br><img src="https://habrastorage.org/webt/-c/g_/pn/-cg_pnrysiiynfs2xfab8fyblhk.png"><br><br> 现在是时候处理主应用程序窗口了。 <br><br><ul><li> 打开<b>Main.storyboard</b> </li><li> 选择“ <b>窗口控制器”场景</b>并将其删除 </li><li>  <b>查看Controller场景</b>假，我们将尽快使用它 </li></ul><br><br> <a href=""><img src="https://habrastorage.org/webt/td/1q/vr/td1qvrwqe8qpgp2xvadbifvu_4o.png"></a> <br><br> 生成并运行该应用程序。 现在，应用程序在扩展坞中既没有主窗口又没有不必要的图标。 太好了！ <br><br><h2> 将菜单添加到状态项 </h2><br> 对于认真的应用程序，单击响应显然是不够的。 添加功能的最简单方法是添加菜单。 在<b>AppDelegate</b>的末尾添加此功能。 <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constructMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> menu = <span class="hljs-type"><span class="hljs-type">NSMenu</span></span>() menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Print Quote"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">AppDelegate</span></span>.printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"P"</span></span>)) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>.separator()) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Quit Quotes"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.terminate(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"q"</span></span>)) statusItem.menu = menu }</code> </pre> <br> 然后在<b>applicationDidFinishLaunching（_ :)</b>的末尾添加此调用 <br><br><pre> <code class="swift hljs">constructMenu()</code> </pre> <br> 我们创建<b>NSMenu</b> ，向其中添加3个<b>NSMenuItem</b>实例，并将此菜单设置为应用程序图标菜单。 <br><br> 一些要点： <br><br><ul><li> 菜单项<b>的标题</b>是出现在菜单中的文本。 一个本地化应用程序的好地方（如有必要）。 </li><li>  <b>动作</b> （如按钮或其他控件的<b>动作）</b>是用户单击菜单项时调用的方法 </li><li>  <b>keyEquivalent</b>是键盘快捷键，可用于选择菜单项。 小写字符使用<b>Cmd</b>作为修饰符，小写字符使用<b>Cmd + Shift</b> 。 仅在应用程序位于最顶部且处于活动状态时，此方法才有效。 在我们的情况下，必须显示菜单或其他窗口，因为我们的应用程序在扩展坞中没有图标 </li><li>  <b>spacerItem</b>是处于非活动状态的菜单项，其形式为其他元素之间的灰线。 用它来分组 </li><li>  <b>printQuote</b>是您已经在<b>AppDelegate中</b>定义的方法，而<b>终止</b>是<b>NSApplication</b>定义的方法。 </li></ul><br> 启动应用程序，然后单击应用程序图标将看到一个菜单。 <br><br><img src="https://habrastorage.org/webt/-w/2v/lv/-w2vlv2nfi_vxgosiihbqd19m5g.png"><br><br> 尝试单击菜单-选择“ <b>打印报价”</b>会在Xcode控制台中显示报价，而“ <b>退出报价”将</b>终止应用程序。 <br><br><h2> 添加一个弹出窗口 </h2><br> 您已经看到从代码中添加菜单是多么容易，但是在Xcode控制台中显示引号显然不是用户对应用程序的期望。 现在，我们将添加一个简单的视图控制器，以正确的方式显示引号。 <br><br> 转到<b>File / New / File ...</b>菜单，选择<b>macOS / Source / Cocoa Class</b>模板，然后单击<b>Next</b> 。 <br><br> <a href=""><img src="https://habrastorage.org/webt/m5/vd/7w/m5vd7wewsgjt16zajhbas3ca9mi.png"></a> <br><br><ul><li> 将类命名为<b>QuotesViewController</b> </li><li> 成为<b>NSViewController</b>的继承者 </li><li> 确保未选中“ <b>同时为用户界面创建XIB文件”</b>复选框 </li><li> 将语言设置为Swift </li></ul><br> 最后，再次单击“ <b>下一步”</b> ，选择一个保存文件的位置，然后单击“ <b>创建”</b> 。 <br> 现在打开<b>Main.storyboard</b> 。 展开<b>View Controller Scene，</b>然后选择<b>View Controller实例</b> 。 <br><br> <a href=""><img src="https://habrastorage.org/webt/c4/dd/em/c4ddemmj9moxiu_whrzl7ilme_4.png"></a> <br><br> 首先选择<b>Identity Inspector</b>并将类更改为<b>QuotesViewController</b> ，然后将<b>Storyboard ID</b>设置为<b>QuotesViewController</b> <br><br> 现在，将以下代码添加到<b>QuotesViewController.swift</b>文件的末尾： <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuotesViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: Storyboard instantiation static func freshController() -&gt; QuotesViewController { //1. let storyboard = NSStoryboard(name: NSStoryboard.Name("Main"), bundle: nil) //2. let identifier = NSStoryboard.SceneIdentifier("QuotesViewController") //3. guard let viewcontroller = storyboard.instantiateController(withIdentifier: identifier) as? QuotesViewController else { fatalError("Why cant i find QuotesViewController? - Check Main.storyboard") } return viewcontroller } }</span></span></code> </pre> <br> 这是怎么回事： <br><br><ol><li> 我们有一个指向<b>Main.storyboard</b>的链接。 </li><li> 创建一个与我们刚在上方安装的<b>场景标识符</b>匹配的<b>场景标识符</b> 。 </li><li> 创建<b>QuotesViewController</b>的实例并返回它。 </li></ol><br> 您创建此方法后，现在使用<b>QuotesViewController的</b>每个人都不需要知道如何创建它。 它只是工作。 <br><br> 注意<b>guard</b>语句中的<b>fatalError</b> 。 最好使用它或<b>assert assertFailure，</b>以便在开发中出现问题时，您自己和开发团队的其他成员都可以知道。 <br><br> 现在回到<b>AppDelegate.swift</b> 。 添加一个新的属性。 <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> popover = <span class="hljs-type"><span class="hljs-type">NSPopover</span></span>()</code> </pre> <br> 然后，将<b>pplicationDidFinishLaunching（_ :)替换为</b>以下代码： <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationDidFinishLaunching</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aNotification: Notification)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(togglePopover(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) } popover.contentViewController = <span class="hljs-type"><span class="hljs-type">QuotesViewController</span></span>.freshController() }</code> </pre><br> 您已更改click操作，以调用<b>togglePopover（_ :)</b>方法，稍后我们将进行编写。 另外，我们没有配置和添加菜单，而是配置了一个弹出窗口，该弹出窗口将显示<b>QuotesViewController中的内容</b> 。 <br><br> 将以下三种方法添加到<b>AppDelegate</b> ： <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">togglePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> popover.isShown { closePopover(sender: sender) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showPopover(sender: sender) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showPopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { popover.show(relativeTo: button.bounds, of: button, preferredEdge: <span class="hljs-type"><span class="hljs-type">NSRectEdge</span></span>.minY) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { popover.performClose(sender) }</code> </pre> <br>  <b>showPopover（）</b>显示一个弹出窗口。 您只需指出它的来源，macOS便将其定位并绘制一个箭头，就像它从菜单栏中出现一样。 <br><br>  <b>closePopover（）</b>仅关闭弹出窗口，而<b>togglePopover（）</b>是根据其状态显示或隐藏弹出窗口的方法。 <br><br> 启动应用程序，然后单击其图标。 <br><br><img src="https://habrastorage.org/webt/j6/gu/oq/j6guoqowcbou3xwtqr2cdunm4ns.png"><br><br> 一切都很好，但是内容在哪里？ <br><br><h2> 我们实现Quote View Controller </h2><br> 首先，您需要一个用于存储引号和属性的模型。 转到<b>File / New / File ...</b>菜单，然后选择<b>macOS / Source / Swift File模板</b> ，然后选择<b>Next</b> 。 将文件命名为<b>Quote</b> ，然后单击<b>Create</b> 。 <br><br> 打开<b>Quote.swift</b>文件，并向其中添加以下代码： <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> author: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> all: [<span class="hljs-type"><span class="hljs-type">Quote</span></span>] = [ <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Efficiency is doing better what is already being done."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Peter Drucker"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"To infinity and beyond!"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Buzz Lightyear"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"May the Force be with you."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Han Solo"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Simplicity is the ultimate sophistication"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Leonardo da Vinci"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"It's not just what it looks like and feels like. Design is how it works."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Steve Jobs"</span></span>) ] } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomStringConvertible</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\"\(text)\" — \(author)"</span></span> } }</code> </pre> <br> 在这里，我们定义了一个简单的报价结构和一个返回所有报价的静态属性。 由于我们使<b>Quote</b>符合<b>CustomStringConvertible</b>协议，因此我们可以轻松地获取格式方便的文本。 <br><br> 有进步，但是我们仍然需要控件来显示所有这一切。 <br><br><h2> 添加界面元素 </h2><br> 打开Main.storyboard，然后拉出视图控制器上的3个按钮（ <b>Push Button</b> ）和标签（ <b>Multiline Label）</b> 。 <br><br> 放置按钮和标签，使它们看起来像这样： <br><br><img src="https://habrastorage.org/webt/1v/ry/2_/1vry2_ydfrxoqiqdsklo2uouwne.png"><br><br> 将左按钮以20的间距连接到左边缘，并垂直居中。 <br> 将右按钮以20的间距连接到右边缘，并垂直居中。 <br> 将底部按钮以20的间距连接到底部边缘，并水平居中。 <br> 将标记的左右边缘与按钮之间的间距为20，垂直居中。 <br><br> <a href=""><img src="https://habrastorage.org/webt/jl/zi/tl/jlzitledfqmcexzv636ya6ir6sq.png"></a> <br><br> 您将看到几个布局错误，因为没有足够的信息可以<b>自动布局</b>解决它。 <br><br> 将“ <b>水平内容拥抱优先级”设置</b>为249，以允许调整标签的大小。 <br><br> <a href=""><img src="https://habrastorage.org/webt/a6/qp/s0/a6qps0r2_vobhsjkbcfiqohklgc.png"></a> <br><br> 现在执行以下操作： <br><br><ul><li> 将左按钮<b>图像</b>设置为<b>NSGoLeftTemplate</b>并清除<b>标题</b> </li><li> 将右按钮<b>图像</b>设置为<b>NSGoRightTemplate</b>并清除<b>标题</b> </li><li> 将下面按钮的<b>标题</b>设置为“ <b>退出报价”</b> 。 </li><li> 将标签的<b>文本对齐方式</b>设置为居中。 </li><li> 检查标签上的“换行符”是否设置为<b>“自动换行”</b> 。 </li></ul><br><br> 现在打开<b>QuotesViewController.swift</b>并将以下代码添加到<b>QuotesViewController</b>类的实现中： <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textLabel: <span class="hljs-type"><span class="hljs-type">NSTextField!</span></span></code> </pre> <br><br> 将此扩展添加到类实现中。 现在在<b>QuotesViewController.swift中有</b>两个类扩展。 <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: Actions extension QuotesViewController { @IBAction func previous(_ sender: NSButton) { } @IBAction func next(_ sender: NSButton) { } @IBAction func quit(_ sender: NSButton) { } }</span></span></code> </pre> <br> 我们仅添加了用于显示引号的标签的<b>插座</b> ，以及将与按钮连接的3个存根方法。 <br><br><h2> 将代码与Interface Builder连接 </h2><br> 注意：Xcode在您的代码左侧<b>-IBAction</b>和<b>IBOutlet</b>关键字旁边放置了圆圈。 <br><br><img src="https://habrastorage.org/webt/kv/48/k_/kv48k_pvgucw0v1jexqsna44dda.png"><br><br> 我们将使用它们将代码连接到UI。 <br><br> 按住<b>Alt</b>键的同时，在<b>项目导航器中</b>单击<b>Main.storyboard</b> 。 因此， <b>情节提要板</b>在右侧的<b>助手编辑器中</b>打开，在左侧的代码中打开。 <br><br> 将<b>textLabel</b>左侧的<b>圆圈</b>拖到<b>界面构建器中</b>的标签上。 以相同的方式，分别将上<b>一个</b> ， <b>下一个</b>和<b>退出</b>方法与左，右和下按钮组合。 <br><br> <a href=""><img src="https://habrastorage.org/webt/7-/qu/yb/7-quybzu1bexw545popvn_mbeea.png"></a> <br><br> 启动您的应用程序。 <br><br><img src="https://habrastorage.org/webt/tr/b2/6w/trb26wseu6kdpeyqyjdbeojwoxu.png"><br><br> 我们使用了默认的弹出窗口大小。 如果您想要更大或更小的弹出窗口，只需在<b>情节提要中</b>调整其大小即可。 <br><br><h2> 为按钮编写代码 </h2><br> 如果您尚未隐藏<b>助手编辑器</b> ，请单击<b>Cmd-Return</b>或V <b>iew&gt;标准编辑器&gt;显示标准编辑器</b> <br><br> 打开<b>QuotesViewController.swift</b>并将以下属性添加到类实现中： <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quotes = <span class="hljs-type"><span class="hljs-type">Quote</span></span>.all <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentQuoteIndex: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">didSet</span></span> { updateQuote() } }</code> </pre> <br>  <b>quotes</b>属性包含所有引号， <b>currentQuoteIndex</b>是当前显示的引号的索引。  <b>CurrentQuoteIndex</b>还具有一个<b>属性观察器，</b>以在索引更改时用新的引号更新标签的内容。 <br><br> 现在添加以下方法： <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() currentQuoteIndex = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { textLabel.stringValue = <span class="hljs-type"><span class="hljs-type">String</span></span>(describing: quotes[currentQuoteIndex]) }</code> </pre> <br> 当视图加载时，我们将引号索引设置为0，这又导致对接口的更新。  <b>updateQuote（）</b>只是更新文本标签以显示报价。 对应的<b>currentQuoteIndex</b> 。 <br><br> 最后，使用以下代码更新这些方法： <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">previous</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex - <span class="hljs-number"><span class="hljs-number">1</span></span> + quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.shared.terminate(sender) }</code> </pre> <br>  <b>next（）</b>和<b>previous（）</b>方法在所有引用中循环。  <b>退出</b>关闭应用程序。 <br><br> 启动应用程序： <br><br><img src="https://habrastorage.org/webt/wi/qh/ju/wiqhjuzkw5c8f7bmtofythu147k.png"><br><br><h2> 事件监控 </h2><br> 用户还希望我们的应用程序做一件事-当用户单击窗口外的某个地方时，隐藏弹出窗口。 为此，我们需要一种名为<b>macOS全局事件监视器</b>的机制。 <br><br> 创建一个新的Swift文件，将其命名为<b>EventMonitor</b> ，并将其内容替换为以下代码： <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Cocoa public class EventMonitor { private var monitor: Any? private let mask: NSEvent.EventTypeMask private let handler: (NSEvent?) -&gt; Void public init(mask: NSEvent.EventTypeMask, handler: @escaping (NSEvent?) -&gt; Void) { self.mask = mask self.handler = handler } deinit { stop() } public func start() { monitor = NSEvent.addGlobalMonitorForEvents(matching: mask, handler: handler) } public func stop() { if monitor != nil { NSEvent.removeMonitor(monitor!) monitor = nil } } }</code> </pre> <br> 初始化此类的实例时，我们将为它传递一个将要监听的事件掩码（例如击键，鼠标滚轮等）和一个事件处理程序。 <br> 当我们准备开始监听时， <b>start（）</b>调用<b>addGlobalMonitorForEventsMatchingMask（_：handler :)</b> ，它返回我们正在保存的对象。 一旦掩码中包含的事件发生，系统就会调用您的处理程序。 <br><br> 要停止监视事件，请在<b>stop（）中</b>调用<b>removeMonitor</b> <b>（）</b> ，然后通过<b>将</b>其<b>设置</b>为nil来删除该对象。 <br><br> 我们剩下的就是在正确的时间调用<b>start（）</b>和<b>stop（）</b> 。 该类还会在反初始化程序上调用<b>stop（）</b>进行清理。 <br><br><h2> 连接事件监视器 </h2><br> 上一次打开<b>AppDelegate.swift</b>并添加一个新属性： <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventMonitor: <span class="hljs-type"><span class="hljs-type">EventMonitor?</span></span></code> </pre> <br> 然后在<b>applicationDidFinishLaunching（_ :)</b>的末尾添加此代码以配置<b>事件监视器</b> 。 <br><br><pre> <code class="swift hljs">eventMonitor = <span class="hljs-type"><span class="hljs-type">EventMonitor</span></span>(mask: [.leftMouseDown, .rightMouseDown]) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> strongSelf = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, strongSelf.popover.isShown { strongSelf.closePopover(sender: event) } }</code> </pre> <br> 当您单击向左或向右按​​钮时，这将通知您的应用程序。 请注意：处理程序将不会响应您在应用程序内部的鼠标单击而被调用。 这就是为什么当您在弹出窗口中单击时弹出窗口不会关闭的原因。 <br><br> 我们对<b>自身</b>使用<b>弱</b>引用，以避免在<b>AppDelegate</b>和<b>EventMonitor</b>之间形成强链接循环的危险。 <br><br> 在<b>showPopover（_ :)</b>方法的末尾添加以下代码： <br><br><pre> <code class="swift hljs">eventMonitor?.start()</code> </pre><br> 当弹出窗口出现时，我们开始监视事件。 <br><br> 现在，将代码添加到<b>closePopover（_ :)</b>方法的末尾： <br><br><pre> <code class="swift hljs">eventMonitor?.stop()</code> </pre><br> 当弹出窗口关闭时，我们在这里结束监视。 <br><br> 该应用程序已准备就绪！ <br><br><h2> 结论 </h2><br>  <a href="">在这里，</a>您将找到该项目的完整代码。 <br><br> 您已经了解了如何在菜单栏上的应用程序中设置菜单和弹出窗口。 为什么不尝试使用多个标签或带格式的文本来更好地查看引号？ 还是连接后端以接收来自Internet的报价？ 还是要使用键盘在引号之间导航？ <br><br> 研究的好地方是官方文档： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NSMenu</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NSPopover</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NSStatusItem</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN447754/">https://habr.com/ru/post/zh-CN447754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN447736/index.html">无人机视频-社交网络的新趋势</a></li>
<li><a href="../zh-CN447738/index.html">朱利安·阿桑奇（Julian Assange）被英国警察逮捕</a></li>
<li><a href="../zh-CN447742/index.html">什么是DevOps方法，谁需要它</a></li>
<li><a href="../zh-CN447744/index.html">爬Elbrus-侦察战。 技术部分2。中断，异常，系统计时器</a></li>
<li><a href="../zh-CN447750/index.html">数据中心的新处理器-我们分析最近几个月的公告</a></li>
<li><a href="../zh-CN447784/index.html">航天日音乐</a></li>
<li><a href="../zh-CN447786/index.html">背景：Fedor机器人，你是什么？</a></li>
<li><a href="../zh-CN447788/index.html">我们创建了一个新闻聚合器，重点关注加密货币-intwt.com</a></li>
<li><a href="../zh-CN447790/index.html">学习在RIDE和RIDE4DAPPS上编写Waves智能合约。 第1部分（多用户钱包）</a></li>
<li><a href="../zh-CN447792/index.html">暗纹与法律：美国监管者如何尝试控制产品机制并减少科技公司的影响</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>