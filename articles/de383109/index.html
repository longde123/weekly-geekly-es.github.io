<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📍 🥜 👖 Automatische Authentifizierung eines Android-Geräts im WLAN der Moskauer Metro 🚧 🤚 🧒🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie Sie wissen, verfügen fast alle Autos der Moskauer U-Bahn über WLAN-Zugangspunkte, über die Benutzer auf das Internet zugreifen und die Zeit der Fa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatische Authentifizierung eines Android-Geräts im WLAN der Moskauer Metro</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/383109/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie wissen, verfügen fast alle Autos der Moskauer U-Bahn über WLAN-Zugangspunkte, über die Benutzer auf das Internet zugreifen und die Zeit der Fahrt mit der U-Bahn von zu Hause aus angenehm verbringen können: Nachrichten lesen, E-Mails abrufen, Siegel auf YouTube ansehen usw. . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jedes Gerät muss authentifiziert werden, bevor es Zugriff auf das Internet erhält. Zum ersten Mal wird dem Benutzer eine SMS mit einem Code an die angegebene Telefonnummer gesendet. Danach merkt sich das System die MAC-Adresse des Geräts. In Zukunft muss der Benutzer zur Authentifizierung nur noch auf den Link „Enter the Internet“ klicken und etwas warten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Nachteil einer solchen Organisation des Systems besteht darin, dass der Benutzer, selbst wenn er keinen Browser benötigt und beispielsweise mit einer speziellen Anwendung in die E-Mail gelangen oder Twitter lesen möchte, den Browser starten, versuchen muss, auf eine Seite zuzugreifen und auf die Weiterleitung zu warten Klicken Sie auf den Link, warten Sie, bis die Begrüßungsseite geladen ist (optional: siehe Werbung), und erst danach kann er die gewünschte Anwendung verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie nicht häufig in der U-Bahn sind, kann ein solches System Sie nicht irritieren, aber im täglichen Gebrauch stört es Sie dennoch, wie ein bekannter und charismatischer Politiker sagte: „Genug, um dies zu ertragen!“. Heute werden wir die Authentifizierung automatisieren in der Moskauer U-Bahn.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst benötigen wir die Tasker-Anwendung. Sie können es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (für ein wenig Geld) oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">irgendwo hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (auf eigene Gefahr und Gefahr) bekommen. Persönlich habe ich die erste Option vorgezogen und es nicht bereut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tasker ist eine Anwendung, mit der abhängig von bestimmten Bedingungen (Datum / Uhrzeit / Ort / Gerätestatus / Sensorwerte usw.) bestimmte Aktionen ausgeführt werden können (Senden von Nachrichten / Anzeigen von Benachrichtigungen / Ein- / Ausschalten von Geräten / Rendern einfacher Schnittstellen usw.). d.). Die Liste der Bedingungen und Aktionen ist einfach riesig und hängt von der Version von Android und der Hardware des Geräts ab. Es macht also keinen Sinn, sie vollständig zu übernehmen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie Tasker gestartet haben, müssen Sie zunächst die Benutzeroberfläche ins Englische übersetzen, da die Übersetzung auf beiden Beinen lahm ist: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einstellungen-&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Benutzeroberfläche- </font><i><font style="vertical-align: inherit;">&gt; Sprache-&gt; Englisch</font></i><font style="vertical-align: inherit;"> und die Anwendung neu starten. </font><font style="vertical-align: inherit;">Jetzt haben wir vier Registerkarten:</font></font><br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Profile steuern die Verbindung zwischen dem Gerätestatus / verschiedenen Ereignissen und Aufgaben.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgaben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aufgaben beschreiben die Reihenfolge der Aktionen, die ausgeführt werden müssen.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Szenen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Szenen sind wie selbst erstellte Formulare, die Aufgaben erstellen und anpassen können, sowie Steuerelemente, auf denen sie Aufgaben ausführen können.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vars</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Eine Liste globaler Variablen, mit denen Daten zwischen Aufgabenstarts gespeichert werden können.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gehen Sie zur Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgaben,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erstellen Sie eine neue Aufgabe und nennen Sie sie Metro Auth:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/58a/b9f/a77/58ab9fa777894cc2ab48e7d8e40ceb78.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dem sich öffnenden Fenster müssen wir zunächst mehrere Variablen definieren. </font><font style="vertical-align: inherit;">Variablen sind wie folgt definiert:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/1e0/95a/df8/1e095adf89564c41a1f500df8d671ada.png"></div><br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Variablenname</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Der Name der Variablen muss mit dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Symbol beginnen </font><font style="vertical-align: inherit;">und aus Kleinbuchstaben bestehen. </font><font style="vertical-align: inherit;">Wenn der Variablenname mindestens einen Großbuchstaben enthält, wird die Variable global, aber wir brauchen sie nicht.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der Wert der Variablen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir müssen also die folgenden Variablen erstellen:</font></font><br>
<ul>
<li><i>%url</i> —    ,          .        —   (     ).   HTTPS  ,     HTTP;</li>
<li><i>%forms</i> —    HTML-,      .       — '<i>auth-form,hidden_form</i>',        - ,         ,          (  );</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wenn diese Variable auf einen anderen Wert als Null gesetzt wird, werden zusätzliche Debugging-Informationen angezeigt, mit deren Hilfe wir die obige Liste der Formulare erstellen können.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neben einfachen Aktionen bietet Tasker die Möglichkeit, mithilfe verschiedener Tools Skripte beliebiger Komplexität zu schreiben. </font><font style="vertical-align: inherit;">Wir werden einfaches JavaScript verwenden:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/69d/789/3e2/69d7893e20f5443784f873e8fd6e01ab.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier müssen Sie das maximale </font><font style="vertical-align: inherit;">Ausführungszeitlimit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skripts </font><font style="vertical-align: inherit;">festlegen </font><font style="vertical-align: inherit;">- 50 Sekunden, nur für den Fall. </font><font style="vertical-align: inherit;">Das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontrollkästchen Auto Exit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist für den automatischen Abschluss einer Aktion nach Abschluss des Hauptthreads des Skripts verantwortlich. </font><font style="vertical-align: inherit;">Wenn asynchrone Anforderungen (unser Fall) oder die Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setTimeout verwendet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> werden </font><font style="vertical-align: inherit;">, müssen Sie dieses Kontrollkästchen deaktivieren und den Abschluss der Aktion selbst mithilfe der Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exit ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bestimmen </font><i><font style="vertical-align: inherit;">. </font></i><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde das Skript selbst in zwei Formatierungsoptionen präsentieren: Eine anständige Formatierung ist erforderlich, wenn Sie das Skript untersuchen möchten, ohne sich die Augen zu brechen, und die Formatierung auf einem schmalen Bildschirm ermöglicht es dem Skript, auf dem schmalen Bildschirm des Telefons mehr oder weniger anständig auszusehen. </font><font style="vertical-align: inherit;">Anfangs wurde das Skript in der "schmalen" Version auf dem Telefon eingegeben, und erst dann habe ich es für den Artikel neu formatiert:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript in anständiger Formatierung</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUrl</span>(<span class="hljs-params">url1,url2</span>)</span>{<font></font>
    url1=url1.split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">return</span> url2.length?<font></font>
        (<span class="hljs-regexp">/^http(s?):\/\//i</span>.test(url2)?url2:<font></font>
            (url2[<span class="hljs-number">0</span>]==<span class="hljs-string">'/'</span>?url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>).join(<span class="hljs-string">'/'</span>)+url2:url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>).join(<span class="hljs-string">'/'</span>)+<span class="hljs-string">'/'</span>+url2)<font></font>
        ):url1;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVars</span>(<span class="hljs-params">form,tag</span>)</span>{<font></font>
    vars=<span class="hljs-string">''</span>;<font></font>
    fields=form.getElementsByTagName(tag);<font></font>
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;fields.length;i++)<font></font>
        vars=vars+(i?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+fields[i].name+<span class="hljs-string">'='</span>+fields[i].value;
    <span class="hljs-keyword">return</span> vars;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">submit</span>(<span class="hljs-params">xhr,request,form</span>)</span>{<font></font>
    request.url=getUrl(request.url,form.action);<font></font>
    request.method=form.method;<font></font>
    vars1=getVars(form,<span class="hljs-string">'input'</span>);<font></font>
    vars2=getVars(form,<span class="hljs-string">'textarea'</span>);<font></font>
    request.vars=vars1||vars2?(vars1?vars1:<span class="hljs-string">''</span>)+(vars1&amp;&amp;vars2?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+(vars2?vars2:<span class="hljs-string">''</span>):<span class="hljs-literal">null</span>;<font></font>
    getPage(request,processPage,xhr);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processPage</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
    redir=xhr.getResponseHeader(<span class="hljs-string">'Location'</span>);
    <span class="hljs-keyword">if</span>(redir){
        <span class="hljs-keyword">if</span>(redir==request.url) finalize(<span class="hljs-string">':  '</span>);
        <span class="hljs-keyword">else</span>{<font></font>
            log(<span class="hljs-string">'\n\n'</span>);<font></font>
            getPage({<span class="hljs-string">'url'</span>:redir},processPage,xhr);<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        forms=local(<span class="hljs-string">'forms'</span>).split(<span class="hljs-string">','</span>);<font></font>
        id=<span class="hljs-literal">null</span>;
        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)
            <span class="hljs-keyword">if</span>(xhr.response.getElementById(forms[i])) id=forms[i];
        <span class="hljs-keyword">if</span>(id)submit(xhr,request,xhr.response.getElementById(id));
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))){<font></font>
            log(<span class="hljs-string">'  :\n'</span>);<font></font>
            forms=xhr.response.getElementsByTagName(<span class="hljs-string">'form'</span>);
            <span class="hljs-keyword">if</span>(forms.length)
                <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)<font></font>
                    log((i?<span class="hljs-string">', "'</span>:<span class="hljs-string">'"'</span>)+forms[i].id+<span class="hljs-string">'"'</span>);
            <span class="hljs-keyword">else</span> log(<span class="hljs-string">''</span>);<font></font>
            finalize();<font></font>
        } <span class="hljs-keyword">else</span> finalize(<span class="hljs-string">' '</span>);<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkConn</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
    redir=xhr.getResponseHeader(<span class="hljs-string">'Location'</span>);
    <span class="hljs-keyword">if</span>(redir){<font></font>
        log(<span class="hljs-string">'\n\n'</span>);<font></font>
        getPage({<span class="hljs-string">'url'</span>:redir},processPage,xhr);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        log(<span class="hljs-string">'  '</span>);<font></font>
        finalize();<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">txt</span>)</span>{<font></font>
    logs=logs+(txt?txt:<span class="hljs-string">''</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestToText</span>(<span class="hljs-params">request</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">'URL: '</span>+request.url+<span class="hljs-string">'\nMethod: '</span>+request.method+<span class="hljs-string">', Vars: '</span>+request.vars+<span class="hljs-string">'\n\n'</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finalize</span>(<span class="hljs-params">txt</span>)</span>{<font></font>
    log(txt);<font></font>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))) alert(logs);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(txt) flashLong(txt);<font></font>
    exit();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPage</span>(<span class="hljs-params">request,func,xhr</span>)</span>{
    <span class="hljs-keyword">if</span>(!request.method) request.method=<span class="hljs-string">'GET'</span>;
    <span class="hljs-keyword">if</span>(!request.vars) request.vars=<span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span>(!xhr){<font></font>
        xhr=<span class="hljs-keyword">new</span> XMLHttpRequest();<font></font>
        xhr.responseType=<span class="hljs-string">"document"</span>;<font></font>
        xhr.timeout=<span class="hljs-number">20</span>*<span class="hljs-number">1000</span>;<font></font>
    }<font></font>
    xhr.open(request.method,request.url,<span class="hljs-literal">true</span>);<font></font>
    xhr.onload=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span>(xhr.status==<span class="hljs-number">200</span> || xhr.status==<span class="hljs-number">401</span>){<font></font>
            log (requestToText(request)+<span class="hljs-string">'HTTP status: '</span>+xhr.status+<span class="hljs-string">' '</span>+xhr.statusText+<span class="hljs-string">'\n'</span>);<font></font>
            func(xhr,request);<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            log(requestToText(request));<font></font>
            finalize(<span class="hljs-string">' HTTP: '</span>+xhr.status+<span class="hljs-string">' '</span>+xhr.statusText);<font></font>
        }<font></font>
    }<font></font>
    xhr.onerror=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        log(requestToText(request));<font></font>
        finalize(<span class="hljs-string">':  '</span>);<font></font>
    }<font></font>
    xhr.ontimeout=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        log(requestToText(request));<font></font>
        finalize(<span class="hljs-string">':  '</span>);<font></font>
    }<font></font>
    xhr.send(request.vars);<font></font>
}<font></font>
<font></font>
logs=<span class="hljs-string">''</span>;<font></font>
getPage({<span class="hljs-string">'url'</span>:local(<span class="hljs-string">'url'</span>)},checkConn);
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skript in schmaler Bildschirmformatierung</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUrl</span>(<span class="hljs-params">url1,url2</span>)</span>{<font></font>
  url1=url1.split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">return</span> url2.length?<font></font>
    (<span class="hljs-regexp">/^http(s?):\/\//i</span>.test(url2)?<font></font>
      url2:<font></font>
        (url2[<span class="hljs-number">0</span>]==<span class="hljs-string">'/'</span>?<font></font>
        url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>).join(<span class="hljs-string">'/'</span>)+url2:<font></font>
        url1.split(<span class="hljs-string">'/'</span>).slice(<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>).join(<span class="hljs-string">'/'</span>)+
      <span class="hljs-string">'/'</span>+url2)<font></font>
    ):url1;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVars</span>(<span class="hljs-params">form,tag</span>)</span>{<font></font>
  vars=<span class="hljs-string">''</span>;<font></font>
  fields=form.getElementsByTagName(<font></font>
    tag);<font></font>
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;fields.length;i++)<font></font>
    vars=vars+(i?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+fields[i].name+
      <span class="hljs-string">'='</span>+fields[i].value;
  <span class="hljs-keyword">return</span> vars;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">submit</span>(<span class="hljs-params">xhr,request,form</span>)</span>{<font></font>
  request.url=getUrl(request.url,<font></font>
    form.action);<font></font>
  request.method=form.method;<font></font>
  vars1=getVars(form,<span class="hljs-string">'input'</span>);<font></font>
  vars2=getVars(form,<span class="hljs-string">'textarea'</span>);<font></font>
  request.vars=vars1||vars2?<font></font>
    (vars1?vars1:<span class="hljs-string">''</span>)+<font></font>
    (vars1&amp;&amp;vars2?<span class="hljs-string">'&amp;'</span>:<span class="hljs-string">''</span>)+<font></font>
    (vars2?vars2:<span class="hljs-string">''</span>)<font></font>
    :<span class="hljs-literal">null</span>;<font></font>
  getPage(request,processPage,xhr);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processPage</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
  redir=xhr.getResponseHeader(<font></font>
    <span class="hljs-string">'Location'</span>);
  <span class="hljs-keyword">if</span>(redir){
    <span class="hljs-keyword">if</span>(redir==request.url)<font></font>
      finalize(<span class="hljs-string">':  '</span>+
        <span class="hljs-string">''</span>);
    <span class="hljs-keyword">else</span>{<font></font>
      log(<span class="hljs-string">'\n\n'</span>);<font></font>
      getPage({<span class="hljs-string">'url'</span>:redir},processPage,<font></font>
        xhr);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    forms=local(<span class="hljs-string">'forms'</span>).split(<span class="hljs-string">','</span>);<font></font>
    id=<span class="hljs-literal">null</span>;
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)
      <span class="hljs-keyword">if</span>(xhr.response.getElementById(<font></font>
          forms[i]))<font></font>
        id=forms[i];<font></font>
    <span class="hljs-keyword">if</span>(id)submit(xhr,request,<font></font>
      xhr.response.getElementById(id));<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))){<font></font>
      log(<span class="hljs-string">'  :\n'</span>);<font></font>
      forms=xhr.response.<font></font>
        getElementsByTagName(<span class="hljs-string">'form'</span>);
      <span class="hljs-keyword">if</span>(forms.length)
        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;forms.length;i++)<font></font>
          log((i?<span class="hljs-string">', "'</span>:<span class="hljs-string">'"'</span>)+forms[i].id+<span class="hljs-string">'"'</span>);
      <span class="hljs-keyword">else</span> log(<span class="hljs-string">''</span>);<font></font>
      finalize();<font></font>
    } <span class="hljs-keyword">else</span> finalize(
      <span class="hljs-string">' '</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkConn</span>(<span class="hljs-params">xhr,request</span>)</span>{<font></font>
  redir=xhr.getResponseHeader(<font></font>
    <span class="hljs-string">'Location'</span>);
  <span class="hljs-keyword">if</span>(redir){<font></font>
    log(<span class="hljs-string">'\n\n'</span>);<font></font>
    getPage({<span class="hljs-string">'url'</span>:redir},processPage,<font></font>
      xhr);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    log(<span class="hljs-string">'  '</span>+
      <span class="hljs-string">''</span>);<font></font>
    finalize();<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">log</span>(<span class="hljs-params">txt</span>)</span>{logs=logs+(txt?txt:<span class="hljs-string">''</span>);}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">requestToText</span>(<span class="hljs-params">request</span>)</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'URL: '</span>+request.url+
    <span class="hljs-string">'\nMethod: '</span>+request.method+
    <span class="hljs-string">', Vars: '</span>+request.vars+<span class="hljs-string">'\n\n'</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finalize</span>(<span class="hljs-params">txt</span>)</span>{<font></font>
  log(txt);<font></font>
  <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Number</span>(local(<span class="hljs-string">'debug'</span>))) alert(logs);
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(txt) flashLong(txt);<font></font>
  exit();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPage</span>(<span class="hljs-params">request,func,xhr</span>)</span>{
  <span class="hljs-keyword">if</span>(!request.method)<font></font>
    request.method=<span class="hljs-string">'GET'</span>;
  <span class="hljs-keyword">if</span>(!request.vars)request.vars=<span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span>(!xhr){<font></font>
    xhr=<span class="hljs-keyword">new</span> XMLHttpRequest();<font></font>
    xhr.responseType=<span class="hljs-string">"document"</span>;<font></font>
    xhr.timeout=<span class="hljs-number">20</span>*<span class="hljs-number">1000</span>;<font></font>
  }<font></font>
  xhr.open(request.method,<font></font>
    request.url,<span class="hljs-literal">true</span>);<font></font>
  xhr.onload=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">if</span>(xhr.status==<span class="hljs-number">200</span> ||<font></font>
        xhr.status==<span class="hljs-number">401</span>){<font></font>
      log (requestToText(request)+<font></font>
        <span class="hljs-string">'HTTP status: '</span>+xhr.status+<span class="hljs-string">' '</span>+<font></font>
        xhr.statusText+<span class="hljs-string">'\n'</span>);<font></font>
        func(xhr,request);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      log(requestToText(request));<font></font>
      finalize(<span class="hljs-string">' HTTP: '</span>+<font></font>
        xhr.status+<span class="hljs-string">' '</span>+xhr.statusText);<font></font>
    }<font></font>
  }<font></font>
  xhr.onerror=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
    log(requestToText(request));<font></font>
    finalize(<span class="hljs-string">':  '</span>+
      <span class="hljs-string">''</span>);<font></font>
  }<font></font>
  xhr.ontimeout=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
    log(requestToText(request));<font></font>
    finalize(<span class="hljs-string">':  '</span>+
      <span class="hljs-string">''</span>);<font></font>
  }<font></font>
  xhr.send(request.vars);<font></font>
}<font></font>
<font></font>
logs=<span class="hljs-string">''</span>;<font></font>
getPage({<span class="hljs-string">'url'</span>:local(<span class="hljs-string">'url'</span>)},checkConn);
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Eingeben eines Skripts über die Telefontastatur begünstigt leider keine Kommentare, aber ich werde den Algorithmus kurz beschreiben:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es wird versucht, die in der Variablen </font><i><font style="vertical-align: inherit;">% url</font></i><font style="vertical-align: inherit;"> angegebene Seite zu laden</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Antwort keinen HTTP- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speicherort-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Header hat </font><font style="vertical-align: inherit;">, werden wir nicht umgeleitet, was bedeutet, dass im Moment keine Authentifizierung erforderlich ist. Beenden Sie den Vorgang</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir laden die Seite, auf die wir geleitet wurden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn ein </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Standortheader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vorhanden ist </font><font style="vertical-align: inherit;">, fahren Sie mit Schritt 3 fort</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Seite ein Formular aus der Liste in der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Forms enthält </font><font style="vertical-align: inherit;">, zeigen Sie das Senden an und fahren Sie mit Schritt 3 fort</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In anderen Fällen haben wir uns erfolgreich authentifiziert</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Abschluss des Skripts haben wir folgende Aufgabe:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/acb/140/3e1/acb1403e172e48acb699aa299c48bace.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem ersten Symbol in der unteren Reihe können Sie versuchen, es zu starten. Jetzt ist es an der Zeit, in die U-Bahn zu gehen, um sie einzurichten! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der U-Bahn, die eine Verbindung zum Zugangspunkt herstellt, versuchen wir, die Aufgabe zu starten. Wenn es keine offensichtlichen Probleme mit der Serververfügbarkeit gibt, wird eine Meldung ähnlich der in der folgenden Abbildung links gezeigten angezeigt. Unten sehen wir die Kennung des Formulars auf der zuletzt geladenen Seite - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auth-form</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dieses Formular ist eindeutig unser Kunde. Wir geben seinen Namen in die Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Formulare ein</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und führen die Aufgabe erneut aus. Wir erhalten ungefähr das, was in der folgenden Abbildung in der Mitte dargestellt ist. Die neue Formularkennung lautet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hidden_form</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fügen Sie es der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% forms hinzu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jetzt </font><i><font style="vertical-align: inherit;">lautet der</font></i><font style="vertical-align: inherit;"> Wert ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auth-form, hidden_form</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'. </font><font style="vertical-align: inherit;">Wir starten die Aufgabe erneut und sehen ungefähr, was in der folgenden Abbildung rechts gezeigt wird - entweder gibt es ein Formular ohne Kennung oder die Markierung „nicht vorhanden“ (abhängig von der U-Bahnlinie). </font><font style="vertical-align: inherit;">Wenn wir jetzt den Browser starten, ist klar, dass wir die Authentifizierung bestanden haben. </font><font style="vertical-align: inherit;">Setzen Sie die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf "0" und schließen Sie die Aufgabe - hier sind wir fertig.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/a9c/0c2/6eb/a9c0c26eb5874153a28dc89c0240262b.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen Sie den automatischen Start der Aufgabe konfigurieren, wenn Sie mit dem gewünschten Zugriffspunkt verbunden sind. </font><font style="vertical-align: inherit;">Wir gehen zur Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und erstellen ein neues Profil, das aktiviert wird, nachdem eine Verbindung zum Zugangspunkt der Moskauer U-Bahn hergestellt wurde. </font><font style="vertical-align: inherit;">Nachdem wir die Beschreibung des Zugangspunkts erstellt haben, fragt uns der Tasker, mit welcher Aufgabe dieses Profil verknüpft werden soll. Wählen Sie natürlich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metro Auth</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/3a5/7ef/5b5/3a57ef5b534f48f5a6b3ab5e00206a1f.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine weitere Nuance: Obwohl selten, fliegt die Authentifizierung immer noch, obwohl keine Trennung vom Punkt stattgefunden hat. </font><font style="vertical-align: inherit;">Wenn es keine Trennung gab, gab es keine erneute Verbindung, was bedeutet, dass der Tasker die Task nicht erneut startet. Daher konfigurieren wir den Tasker so, dass die Authentifizierung automatisch alle 2 Minuten überprüft wird (das minimal mögliche Intervall). Dazu müssen wir lange auf die bereits konfigurierte Bedingung klicken, um das Menü aufzurufen. in dem eine temporäre Bedingung hinzugefügt werden soll, in der das Intervall festgelegt werden soll.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/2b7/28a/9af/2b728a9affee411abb30c1174d941fb2.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist also alles. </font><font style="vertical-align: inherit;">Von nun an und bis Sie die Bezeichner in der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Forms</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ändern müssen, </font><font style="vertical-align: inherit;">lautet der Algorithmus Ihrer Aktionen beim Betreten des Wagens wie folgt:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WLAN einschalten;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warten Sie auf die Meldung „Authentifizierung ist abgeschlossen“ auf dem Bildschirm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lächle auf mysteriöse Weise und gehe deinem Geschäft nach.</font></font></li>
</ol><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Auf den Rat  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Self_Perfection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe das Projekt exportiert und in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine Datei eingefügt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Diese Datei muss heruntergeladen und in den Ordner </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ sdcard / Tasker / projects gelegt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> werden. Führen Sie dann Tasker aus, drücken Sie lange auf das </font><i><font style="vertical-align: inherit;">Haussymbol</font></i><font style="vertical-align: inherit;"> in der unteren linken Ecke, um das Menü aufzurufen und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importieren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auszuwählen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In dieser Version habe ich alle zwei Minuten in einem separaten Profil ausgecheckt - dies sollte effizienter funktionieren.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de383109/">https://habr.com/ru/post/de383109/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de383097/index.html">Windows 10 Insider Preview 10525 Tötet Google Chrome</a></li>
<li><a href="../de383099/index.html">Die Zukunft von BMW: Zylinderwasser und ein Torpedo in der Kabine</a></li>
<li><a href="../de383101/index.html">BioLite bietet eine umweltfreundliche Stromquelle</a></li>
<li><a href="../de383103/index.html">Sony SmartBand 2 erfasst Herzfrequenz und Stress</a></li>
<li><a href="../de383107/index.html">Time to Close: Geschichten von Chicagos berühmten Börsen</a></li>
<li><a href="../de383111/index.html">Es gibt einen Bürgerkrieg für Bitcoin</a></li>
<li><a href="../de383115/index.html">"3D-Palette" bringt die Dinge auf dem Desktop des Besitzers eines 3D-Stifts in Ordnung</a></li>
<li><a href="../de383117/index.html">AfterShokz Trekz Titanium ™: Neue Version von Kopfhörern mit Knochenleitung</a></li>
<li><a href="../de383119/index.html">Eine weitere Überprüfung von Sailfish OS oder das Mehl der Auswahl eines geeigneten mobilen Betriebssystems</a></li>
<li><a href="../de383121/index.html">Квадрокоптер научили находить уязвимые сети и гаджеты на большой высоте</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>