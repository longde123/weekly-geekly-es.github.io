<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßö üë®üèΩ‚Äç‚úàÔ∏è üåä A evolu√ß√£o da pesquisa - como comprar um piano em tr√™s cliques üòî ‚õ™Ô∏è ‚õ≥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anteriormente, no Avito, era poss√≠vel encontrar o produto certo usando a filtragem de palavras-chave ou a navega√ß√£o em √°rvore de categorias. Esse m√©to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A evolu√ß√£o da pesquisa - como comprar um piano em tr√™s cliques</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/429076/"><p>  Anteriormente, no Avito, era poss√≠vel encontrar o produto certo usando a filtragem de palavras-chave ou a navega√ß√£o em √°rvore de categorias.  Esse m√©todo, embora parecesse familiar, nem sempre era conveniente - para encontrar um produto ou servi√ßo, era necess√°rio fazer um grande n√∫mero de cliques.  Mais de um ano atr√°s, ganhamos relev√¢ncia, gra√ßas √† qual a pesquisa se tornou melhor, e agora √© mais f√°cil e conveniente encontrar um produto ou servi√ßo, mesmo na p√°gina principal.  Com essa inova√ß√£o, mercadorias inadequadas e francamente ‚Äúlixo‚Äù deixaram de cair na quest√£o.  E esta √© apenas uma das etapas para melhorar sua pesquisa.  Estamos mudando gradualmente a infraestrutura, o que nos permite trabalhar com mais intensidade na qualidade da pesquisa, melhor√°-la mais rapidamente e lan√ßar novos recursos que beneficiam vendedores e compradores no Avito. </p><br><p>  No artigo, mostrarei como a pesquisa no Avito mudou: como come√ßamos e agora estamos avan√ßando no sentido de melhorar a vida de nossos usu√°rios e compartilharemos nossas inova√ß√µes tanto no produto quanto em seu preenchimento - a parte t√©cnica.  N√£o haver√° carne hardcore aqui, mas espero que voc√™ goste. </p><br><img src="https://habrastorage.org/webt/19/zx/he/19zxhesvegeiygbo4haapoe4mic.png"><a name="habracut"></a><br><p>  Algumas notas introdut√≥rias: Avito √© o servi√ßo de an√∫ncios mais popular da R√∫ssia.  Temos mais de 450 mil an√∫ncios por dia e o n√∫mero mensal de visitantes √∫nicos chega a 35 milh√µes, o que faz mais de 140 milh√µes de pesquisas por dia. </p><br><h1 id="tipichnyy-scenariy-poiska-ranshe">  Cen√°rio de pesquisa t√≠pico antes </h1><br><p>  Vejamos um exemplo simples de como uma pesquisa funcionou h√° mais de um ano.  Suponha que voc√™ precise de um piano (bem, por que n√£o?).  Vamos para a p√°gina principal, digitamos "piano". </p><br><img src="https://habrastorage.org/webt/yh/jq/di/yhjqdiamdihyfnkermrcwkhwzpq.png"><br><p>  Na extradi√ß√£o, voc√™ provavelmente receber√° motores, servi√ßos de transporte para piano ou algo semelhante, mas n√£o um instrumento musical. </p><br><img src="https://habrastorage.org/webt/wy/dp/rm/wydprmf6to16xbqxq6mfkpfqlno.png"><br><p>  Isso acontece porque teremos a classifica√ß√£o pela data da veicula√ß√£o - e esses servi√ßos s√£o colocados com mais frequ√™ncia. </p><br><img src="https://habrastorage.org/webt/bt/m8/rz/btm8rzqberfol38jrn2uln1ipju.jpeg"><br><p>  Para ver o piano, voc√™ precisa especificar a categoria.  Clicamos no cabe√ßalho "Hobbies e lazer", descemos a √°rvore de categorias para "Instrumentos musicais" e, em seguida, "Instrumentos para teclado". </p><br><img src="https://habrastorage.org/webt/d1/h2/oq/d1h2oqqqz5gv9snlihpiu51yzau.png"><br><img src="https://habrastorage.org/webt/be/c2/zf/bec2zflrha8wktusuudqo1w3o08.png"><br><p>  E somente depois disso vemos o piano que est√°vamos procurando. </p><br><img src="https://habrastorage.org/webt/-c/wz/71/-cwz71ifodfnrcda86qj03u__5y.png"><br><p>  Acontece que, para encontrar o an√∫ncio desejado, havia as seguintes op√ß√µes: </p><br><ul><li>  refinamento da categoria ao pesquisar por palavras-chave, </li><li>  classifica√ß√£o por frescura e pre√ßo, </li><li>  filtros </li><li>  pesquise apenas pelo nome. </li></ul><br><h1 id="chto-izmenilos-blagodarya-relevantnosti">  O que mudou devido √† relev√¢ncia </h1><br><p>  Devido √† relev√¢ncia, os an√∫ncios que n√£o se encaixam deixaram de ser inclu√≠dos na emiss√£o.  Agora, se voc√™ estiver procurando um piano na p√°gina principal, provavelmente n√£o ver√° os servi√ßos de carregadores que o ajudam a transport√°-lo, mas ver√° imediatamente o instrumento musical que deseja.  Ao mesmo tempo, uma nova classifica√ß√£o foi adicionada - "Por padr√£o".  √â formado por dois indicadores: relev√¢ncia do an√∫ncio para a consulta de texto e atualiza√ß√£o. </p><br><img src="https://habrastorage.org/webt/oc/p_/ry/ocp_rycbztfxg1fdvec-3usu0cm.png"><br><p>  No topo, voc√™ v√™ os mais recentes dos relevantes. </p><br><img src="https://habrastorage.org/webt/cg/md/pq/cgmdpq3ogawjuoqf4cr66l17gr0.png"><br><p>  No Avito, por uma taxa adicional, voc√™ pode aumentar seu an√∫ncio.  E com a introdu√ß√£o da relev√¢ncia, as melhorias pagas funcionam com mais efici√™ncia.  Antes de tudo, eles funcionar√£o se o seu an√∫ncio for relevante para a consulta de texto. </p><br><p>  A introdu√ß√£o da relev√¢ncia n√£o significa que abandonamos completamente as transi√ß√µes para a √°rvore de categorias.  Apenas na maioria dos casos, reduzimos o n√∫mero de cliques no an√∫ncio desejado ao pesquisar na p√°gina principal.  Se voc√™ ainda precisar de servi√ßos de transporte, embora tenha digitado "piano" na pesquisa, acesse a √°rvore de categorias e encontrar√° esses an√∫ncios.  A pesquisa tamb√©m come√ßou a funcionar com mais efici√™ncia e dentro da categoria, por exemplo, ‚ÄúItens pessoais‚Äù e ‚ÄúEletrodom√©sticos‚Äù. </p><br><h1 id="kak-nayti-nuzhnyy-tovar-v-tri-klika">  Como encontrar o produto certo em tr√™s cliques </h1><br><p>  A pesquisa est√° se tornando mais conveniente para os usu√°rios, n√£o apenas devido √† qualidade dos resultados da pesquisa.  Existem outras maneiras de melhorar isso.  Um deles est√° encaminhando para a categoria.  Por exemplo, estamos procurando Lamborghini Gayardo (sim, voc√™ gosta de tocar piano e quer tocar Lamborghini).  Para entrar na categoria de um carro de um modelo espec√≠fico, √© necess√°rio fazer dois cliques extras.  Com relev√¢ncia, provavelmente voc√™ conseguir√° o que deseja. </p><br><img src="https://habrastorage.org/webt/vd/d0/-y/vdd0-ymtzuq15oeaxe_bdikffne.png"><br><p>  Mas h√° um m√©todo adicional que o jogar√° imediatamente em carros.  A emiss√£o ser√° reduzida, o carro certo ser√° selecionado nos filtros e voc√™ realmente receber√° carros na emiss√£o. </p><br><img src="https://habrastorage.org/webt/xq/b_/7v/xqb_7v4xa6vmvo4rtt88h8yvttk.png"><br><img src="https://habrastorage.org/webt/vo/lk/yo/volkyo_aktkx5cemgpd9fvy2hp4.png"><br><p>  Outra maneira √© expandir as tags.  Por exemplo, quando voc√™ digita a palavra "palet√≥", recebe dicas. </p><br><img src="https://habrastorage.org/webt/mv/7q/si/mv7qsiygsxehsjbl0pkctnhykjo.png"><br><p>  A captura de tela acima mostra as dicas: o tipo de jaqueta - feminina, masculina, para meninas, para meninos.  Se voc√™ clicar em "Para meninas", voc√™ entrar√° imediatamente na categoria em que os filtros apropriados ser√£o selecionados.  Um conjunto de tags de expans√£o adicionais tamb√©m aparecer√° aqui: jaqueta de inverno, couro, nova e assim por diante.  Se voc√™ descer manualmente a √°rvore de categorias at√© o produto desejado, precisar√° executar mais a√ß√µes. </p><br><img src="https://habrastorage.org/webt/4k/hq/vg/4khqvgdpjs1sgxhb_icjrxl__v0.png"><br><h1 id="v-chem-raznica-mezhdu-poiskom-i-filtrami">  Qual √© a diferen√ßa entre pesquisa e filtros </h1><br><p>  Quando falei no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RIT ++</a> , o p√∫blico fez uma pergunta: qual √© a diferen√ßa entre a pesquisa de texto e os filtros?  Tudo √© bem simples.  Voc√™ tamb√©m pode encontrar o an√∫ncio desejado sem uma solicita√ß√£o de texto descendo a √°rvore de categorias.  Nesse caso, a pesquisa ainda encontrar√° bens e servi√ßos, n√£o pelo texto fornecido, mas pelo conjunto de par√¢metros passados ‚Äã‚Äãdos filtros correspondentes da categoria selecionada. </p><br><p>  Cada categoria tem seu pr√≥prio conjunto de filtros.  Por exemplo, na categoria "Carros" - alguns filtros, na categoria "Coisas pessoais" - outros filtros.  Ou seja, os filtros est√£o rigidamente vinculados a uma categoria. </p><br><h1 id="razmeschenie-obyavleniya-za-dve-minuty">  Coloca√ß√£o do an√∫ncio em dois minutos </h1><br><p>  Uma inova√ß√£o importante apareceu para os vendedores que eles sentem ao enviar seu an√∫ncio.  Se o seu an√∫ncio n√£o contiver nenhum "proibido" ou n√£o for uma duplicata - o bom an√∫ncio habitual - voc√™ o ver√° na emiss√£o quase que imediatamente.  Na verdade, esse atraso dura cerca de dois minutos, mas, em casos raros, pode ser estendido at√© 30 minutos.  Anteriormente, um an√∫ncio sempre aparecia no site somente ap√≥s meia hora. </p><br><h1 id="avito-pomoschnik">  Avito Assistant </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Avito Helper</a> √© uma extens√£o do Chrome que exibe o pre√ßo de um produto similar no Avito em sites de terceiros.  Na extens√£o, voc√™ pode comparar pre√ßos em muitas lojas on-line com os pre√ßos do Avito ou simplesmente procurar os bens e servi√ßos necess√°rios em nosso servi√ßo, sem ir diretamente ao site ou aplicativo.  Conseguimos implementar o "Assistente", inclusive gra√ßas a novas mudan√ßas na infraestrutura. </p><br><img src="https://habrastorage.org/webt/d5/hv/cw/d5hvcwkpl7-npnqilrei9wfcz80.png"><br><h1 id="arhitektura">  Arquitetura </h1><br><h2 id="pilim-monolit">  Serrar um mon√≥lito </h2><br><p>  Avito tem um mon√≥lito em PHP.  H√° um ano, toda a funcionalidade de pesquisa que funciona no Avito estava nesse mon√≥lito.  A pesquisa no mon√≥lito funcionou com quatro plataformas: Android, iOS, a vers√£o m√≥vel no navegador e na √°rea de trabalho.  Para fornecer a sa√≠da, as consultas SQL correspondentes foram geradas no Sphinx dentro desse c√≥digo, o processamento estava em andamento e a sa√≠da foi enviada no formato JSON ou HTML.  Os usu√°rios viram o que estavam procurando. </p><br><img src="https://habrastorage.org/webt/cw/l_/rn/cwl_rnema8zlhzfu4gnrrgrz1jq.jpeg"><br><h2 id="chto-u-nas-seychas">  O que temos agora </h2><br><p>  Se voc√™ implementar novos recursos, ser√° muito dif√≠cil integrar esse mon√≥lito.  Portanto, decidimos desenvolver um servi√ßo de pesquisa, que chamamos de "Pesquisado".  Agora o mon√≥lito vai para esse servi√ßo de pesquisa e o servi√ßo vai para o Sphinx. </p><br><img src="https://habrastorage.org/webt/wk/rf/up/wkrfupfza_kexfbo_yiafhq-lz4.jpeg"><br><h2 id="prichiny-sozdaniya-poiskovogo-servisa">  Raz√µes para criar um servi√ßo de pesquisa </h2><br><p>  Ao desenvolver servi√ßos, voc√™ sempre precisa entender por que est√° fazendo isso.  A primeira vantagem √≥bvia √© a remo√ß√£o da l√≥gica de baixo n√≠vel.  No nosso caso, isso est√° ocultando a cozinha para o processamento de consultas SphinxQL.  Al√©m disso, podemos fornecer mais facilmente a funcionalidade de pesquisa para sistemas de terceiros. </p><br><p>  Execu√ß√£o de consulta ass√≠ncrona.  Essa vantagem √© bastante √≥bvia e, dependendo da implementa√ß√£o, um ou outro sucesso pode ser alcan√ßado.  Nosso servi√ßo foi implementado no Golang e havia funcionalidades que podiam ser paralelizadas - tr√™s solicita√ß√µes no Sphinx, que resultaram em bons resultados. </p><br><p>  Implanta√ß√£o r√°pida.  Identificamos uma funcionalidade separada com menos c√≥digo, testes extras (o mon√≥lito tem muitos testes, n√£o apenas a funcionalidade de pesquisa), e √© mais f√°cil implement√°-la.  Mais importante ainda, devido a uma abordagem bem-sucedida da implementa√ß√£o desse servi√ßo, fomos capazes de reduzir coisas interessantes e implementar algoritmos avan√ßados de classifica√ß√£o - para fazer um processamento bastante complicado que n√£o poder√≠amos fazer em um mon√≥lito.  Isso nos fornece uma base muito boa para experimentar a qualidade da pesquisa. </p><br><p>  Como b√¥nus, temos a oportunidade de mudar de Sphinx para Elastic, porque a l√≥gica de baixo n√≠vel agora est√° oculta. </p><br><p>  Este diagrama j√° mostra o caso em que h√° um mon√≥lito, o servi√ßo "Pesquisado" e o servi√ßo de terceiros "Avito Assistant". </p><br><img src="https://habrastorage.org/webt/ed/3s/ws/ed3swsgnqulgqx9lokpg6l4po8g.jpeg"><br><h2 id="kak-rabotaet-poiskovyy-servis">  Como funciona um servi√ßo de pesquisa? </h2><br><p>  Possui um conjunto de agregadores.  Cada agregador executa uma certa l√≥gica de neg√≥cios relacionada ao processamento da emiss√£o.  Ele pode formar esse problema de uma certa maneira. </p><br><p>  A solicita√ß√£o chega no agendador.  O planejador seleciona o agregador de acordo com os crit√©rios de consulta em termos de seus par√¢metros (ou se o agregador desejado for especificado na pr√≥pria solicita√ß√£o).  O agregador vai para a Sphinx.  Ap√≥s receber uma resposta do Sphinx, ele gera uma sa√≠da e fornece a resposta ao cliente. </p><br><img src="https://habrastorage.org/webt/f9/56/lj/f956ljoot6y6pas3k94vkb8bo3k.gif"><br><p>  Nesse caso, a solicita√ß√£o estava fora, n√£o na nuvem em que nosso servi√ßo de pesquisa funciona.  Mas outra op√ß√£o tamb√©m √© poss√≠vel: alguns de nossos servi√ßos, dentro da nuvem, por exemplo, o Avito Assistant, se voltam para um servi√ßo de pesquisa.  Essa solicita√ß√£o j√° vai para outro agregador - h√° outra l√≥gica de neg√≥cios.  Veja como funciona: </p><br><img src="https://habrastorage.org/webt/vb/gb/yu/vbgbyukk8a5yynkv5kupow23s6y.gif"><br><h2 id="kak-rabotaet-asinhronnoe-vypolnenie-zaprosov-na-agregatore">  Como funciona a execu√ß√£o ass√≠ncrona de consulta no agregador </h2><br><p>  O agregador consiste em v√°rios perfis.  Um perfil √©, grosso modo, uma entidade na qual voc√™ pode obter um an√∫ncio de algum tipo ou de uma maneira espec√≠fica.  Por exemplo, isso pode ser explicado atrav√©s de uma analogia: existem an√∫ncios "Premium", "VIP" e regulares no Avito.  O agregador recebe uma solicita√ß√£o do planejador, enquanto solicita√ß√µes paralelas s√£o executadas para o conjunto de perfis conhecidos no agregador.  O perfil possui um driver que acessa fisicamente o n√≠vel subjacente, neste caso no Sphinx, mas pode ser qualquer outra fonte de dados </p><br><img src="https://habrastorage.org/webt/la/np/ic/lanpiclts0oo-uhfktoxszkxl3g.jpeg"><br><p>  O agregador pode simplesmente fornecer ao planejador os resultados das consultas aos perfis e tamb√©m pode executar a√ß√µes mais complexas, por exemplo, misturar esses resultados usando um ou outro algoritmo. </p><br><img src="https://habrastorage.org/webt/zy/_o/ji/zy_ojiffyfpbt4h9vmkcyciqsuy.jpeg"><br><h2 id="hranenie-poiskovogo-indeksa">  Armazenamento de √≠ndice de pesquisa </h2><br><p>  Devido ao fato de usarmos o Kubernetes na arquitetura, no RIT ++ me perguntaram sobre o armazenamento do √≠ndice de pesquisa - ele √© armazenado no Kubernetes?  N√£o, temos a Sphinx vivendo em m√°quinas f√≠sicas.  No Kubernetes, estamos implantando um servi√ßo de pesquisa que processa a l√≥gica de pesquisa.  A nuvem tamb√©m cont√©m um √≠ndice de pesquisa de amostra para o ambiente de desenvolvimento no qual os testes s√£o executados, mas √© indesej√°vel colocar um √≠ndice de combate l√°, porque os servi√ßos que funcionam no Kubernetes s√£o, antes de tudo, servi√ßos sem estado. </p><br><h2 id="nagruzka-na-poiskovyy-servis">  Carga do servi√ßo de pesquisa </h2><br><p>  Agora, este servi√ßo est√° em batalha, serve 100% da carga, com algumas exce√ß√µes.  A carga que ele suporta √© de aproximadamente 200 krpm.  Atraso: mediana - at√© 17 ms, percentil 95 - at√© 120 ms, percentil 99 - at√© 320 ms. </p><br><img src="https://habrastorage.org/webt/bt/46/ny/bt46nyowpcuqysikxjcpp2weov8.png"><br><img src="https://habrastorage.org/webt/bn/fj/hx/bnfjhx1hqse5b4lfok8cgv3ez04.png"><br><h2 id="itogo-po-poiskovomu-servisu">  Servi√ßo total de pesquisa </h2><br><p>  O servi√ßo de pesquisa √© escrito em Golang, implantado no Kubernetes, o agregador trabalha de forma ass√≠ncrona com v√°rios perfis.  O perfil funciona com o driver especificado, o driver acessa a fonte de dados especificada, por exemplo, Sphinx.  O n√∫mero de solicita√ß√µes que nosso servi√ßo atende √© de at√© 200 krpm no momento.  Atraso: mediana - at√© 17 ms, percentil 95 - at√© 120 ms, percentil 99 - at√© 320 ms. </p><br><h2 id="vnedrenie-servisa-v-rabochuyu-sistemu">  Implementa√ß√£o do servi√ßo em um sistema de trabalho </h2><br><p>  O problema da dupla funcionalidade √© bastante √≥bvio, temos que suportar duas bases de c√≥digo que devem executar a mesma tarefa.  Precisamos de um retorno.  N√≥s o chamamos de ‚Äúcanudos‚Äù - lembramos de ‚Äúcanudos leigos‚Äù.  Al√©m disso, precisamos de controle de tr√°fego, √© desej√°vel que seja r√°pido, atrav√©s de um painel. </p><br><h2 id="kak-rabotaet-solomka">  Como √© que o "canudo" </h2><br><p>  A consulta de pesquisa chega ao "Straw", que funciona dentro do mon√≥lito e pode fazer uma chamada adicional para uma nova pesquisa ou uma antiga.  Ela faz uma chamada para uma nova pesquisa, ele a realiza e, se for bem-sucedida, obtemos o resultado de uma nova pesquisa. </p><br><img src="https://habrastorage.org/webt/y1/xa/wm/y1xawmqms1bxqtotevfsl7bfatu.gif"><br><p>  H√° situa√ß√µes em que alguma consulta ao servi√ßo de pesquisa est√° falhando: por exemplo, e at√© que algum tipo de funcionalidade seja implementada dentro do servi√ßo de pesquisa.  Ent√£o, necessariamente, prometemos esse pedido - "The Straw" o executar√° na busca antiga.  A pesquisa antiga do mon√≥lito ser√° direcionada para o Sphinx e a resposta ser√° enviada para o cliente.  O cliente n√£o sentir√° nada. </p><br><img src="https://habrastorage.org/webt/cr/zu/za/crzuzaufpka6dvpjsjy_m5qq0jc.gif"><br><p>  Um esquema razoavelmente confi√°vel, e √© sempre interessante ver o que acontece na pr√°tica.  O Departamento de Arquitetura da Avito aprimora constantemente nossa nuvem, ajustando-a, tornando-a mais confi√°vel e produtiva.  Em algum momento, houve problemas que, ao atender um dos n√≥s com uma intensidade suficientemente alta, os erros vieram do mon√≥lito (100 erros por segundo). </p><br><img src="https://habrastorage.org/webt/tu/zv/wm/tuzvwmgmpzid5objz-4bmvl157y.png"><br><p>  Ao mesmo tempo, o atraso do servi√ßo aumentou acentuadamente - na imagem abaixo, voc√™ pode ver picos. </p><br><img src="https://habrastorage.org/webt/pq/of/z5/pqofz5fynz2bsibynewd3gro2cw.png"><br><p>  O "canudo" resolveu essa situa√ß√£o notavelmente, e os erros HTTP resultantes estavam no mesmo n√≠vel - uma unidade de erros para todo o Avito.  Nossos visitantes n√£o perceberam nada. </p><br><img src="https://habrastorage.org/webt/wx/ya/ij/wxyaij2xka5dhghoa74ovncverq.png"><br><h2 id="avtomatizaciya-eksperimentov">  Automa√ß√£o de experimentos </h2><br><p>  Queremos que a pesquisa se desenvolva rapidamente e implantar novos recursos nela foi mais f√°cil.  Para isso, √© necess√°ria infraestrutura adequada.  Configuramos a automa√ß√£o dos testes A / B.  Usando o painel, podemos iniciar novos experimentos, configur√°-los com base nas inova√ß√µes adicionadas e, portanto, executar experimentos sem rolar o mon√≥lito. </p><br><p>  No estado inicial, quando nenhuma experi√™ncia foi iniciada, todos os visitantes veem a funcionalidade de pesquisa usual. </p><br><img src="https://habrastorage.org/webt/go/rz/qp/gorzqpca1whra33-df1c6ss18yk.jpeg"><br><p>  Em um experimento t√≠pico, os usu√°rios s√£o divididos em grupos.  O grupo de controle - com a funcionalidade usual para nossos visitantes.  Existem v√°rios grupos de teste - com inova√ß√µes.  Quando precisamos criar um novo experimento, no servi√ßo de pesquisa, implementamos uma nova funcionalidade de pesquisa (adicionamos novos agregadores) e, por meio do painel, configuramos o experimento com os grupos necess√°rios, vinculando-os a novos agregadores. </p><br><p>  Ao analisar experimentos, comparamos o comportamento dos visitantes no grupo de controle com os testes e, com base nisso, tiramos conclus√µes sobre o sucesso do experimento. </p><br><img src="https://habrastorage.org/webt/gd/g5/r2/gdg5r20saoh4inq46d5jggjcxee.gif"><br><p>  Suponha que tenhamos desenvolvido uma nova f√≥rmula de classifica√ß√£o.  O que precisamos fazer para experimentar com ela? </p><br><ol><li>  No servi√ßo de pesquisa, implante o agregador apropriado (seja "Agregador 2"). </li><li>  Crie uma experi√™ncia por meio de um painel e conecte um dos grupos dessa experi√™ncia a esse agregador. </li><li>  Agora, se uma consulta chegar na pesquisa que se enquadra no grupo de teste, ela ser√° direcionada para o servi√ßo de pesquisa no "Agregador 2". </li></ol><br><p>  Podemos continuar criando novas experi√™ncias e associando seus grupos de teste a novos agregadores. </p><br><h1 id="itogo-po-infrastrukture-poiska">  Infraestrutura total de pesquisa </h1><br><p>  H√° um cluster de servidores Sphinx 3. Ele cont√©m 13 krps de consultas SphinxQL e possui mais de 45 milh√µes de an√∫ncios ativos. </p><br><p>  Sphinx 3.0 √© est√°vel e agrada com seu desempenho.  A prop√≥sito, os bin√°rios s√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dom√≠nio p√∫blico</a> .  Al√©m disso, gra√ßas ao Avito, novos recursos s√£o filmados no Sphinx 3, por exemplo, a opera√ß√£o do produto escalar de vetores e os erros encontrados s√£o corrigidos. </p><br><p>  N√≥s usamos a arquitetura de servi√ßo.  Temos o servi√ßo de busca "Iskalo" e o servi√ßo "Avito Assistant".  Parte da funcionalidade permaneceu no mon√≥lito, mas continuamos trabalhando no seu corte. </p><br><h1 id="vyvody">  Conclus√µes </h1><br><p>  No ano passado, um sistema avan√ßado de desenvolvimento de funcionalidades de pesquisa foi recebido.  Tivemos a oportunidade de realizar experimentos r√°pidos e flex√≠veis.  E agora a busca por usu√°rios se tornou mais conveniente, mais r√°pida e melhor ajuda a resolver seus problemas. </p><br><h1 id="chto-dalshe">  O que vem a seguir </h1><br><p>  Al√©m disso, continuaremos removendo do mon√≥lito o que resta: renderiza√ß√£o, filtros.  Vamos trabalhar para melhorar a qualidade da pesquisa, continuar a encantar nossos visitantes.  Espero que voc√™ tamb√©m. </p><br><p>  Se voc√™ tiver d√∫vidas sobre o trabalho de nossa pesquisa, gostar√≠amos de saber mais detalhes t√©cnicos, escreva nos coment√°rios.  Eu responderei com prazer.  A prop√≥sito, recentemente, Andrey Drozdov falou no Highload ++ 2018 com um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio sobre otimiza√ß√£o de v√°rios crit√©rios dos resultados da pesquisa</a> , aqui est√° sua <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apresenta√ß√£o</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429076/">https://habr.com/ru/post/pt429076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429066/index.html">Como a tripula√ß√£o da aeronave se prepara para a partida</a></li>
<li><a href="../pt429068/index.html">Um post muito corporativo: abertura em Moscou ou por que 10 e 11 de novembro s√£o bons dias para comprar eletr√¥nicos</a></li>
<li><a href="../pt429070/index.html">O Linux n√£o pode ser carregado em novos MacBooks devido ao chip T2</a></li>
<li><a href="../pt429072/index.html">Por que a Kodak morreu e a Fujifilm floresceu: a hist√≥ria de dois cineastas</a></li>
<li><a href="../pt429074/index.html">Boas a√ß√µes para o Google Money: novo desafio de impacto da IA</a></li>
<li><a href="../pt429078/index.html">Como criar arte processual em menos de 100 linhas de c√≥digo</a></li>
<li><a href="../pt429082/index.html">Tail√¢ndia sem estere√≥tipos</a></li>
<li><a href="../pt429084/index.html">A segunda vida do forno el√©trico "Kharkov"</a></li>
<li><a href="../pt429086/index.html">Festa de cerveja alternativa</a></li>
<li><a href="../pt429088/index.html">Executando consultas GraphQL com OdataToEntity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>