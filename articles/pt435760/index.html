<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÜ üë©üèº‚Äçüé® üéûÔ∏è Inside Quake: Definindo superf√≠cies vis√≠veis üëÇüèΩ üÜé üíö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O veterano de programa√ß√£o gr√°fica tridimensional Michael Abrash, usando o exemplo do desenvolvimento do primeiro Quake, fala sobre a necessidade de pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inside Quake: Definindo superf√≠cies vis√≠veis</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435760/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/tr/43/0h/tr430h9jofgiadwjb0nh59bltoc.png" alt="imagem"></div><br>  <i>O veterano de programa√ß√£o gr√°fica tridimensional Michael Abrash, usando o exemplo do desenvolvimento do primeiro Quake, fala sobre a necessidade de pensamento criativo em programa√ß√£o.</i> <br><br>  H√° muitos anos, trabalhei na agora extinta empresa de adaptadores de v√≠deo Video Seven.  L√° eu ajudei a desenvolver um clone VGA.  Meu colega Tom Wilson, que trabalhou por muitos meses 24 horas para desenvolver o chip Video Seven VGA, tentou tornar o VGA o mais r√°pido poss√≠vel e tinha certeza de que seu desempenho foi otimizado quase ao m√°ximo.  No entanto, quando Tom j√° estava dando os retoques finais no design do chip, ouvimos rumores de que nosso concorrente Paradise havia conseguido um desempenho ainda maior em seu clone de desenvolvimento ao adicionar FIFO a ele. <br><br>  Este foi o fim dos rumores - n√£o sab√≠amos o que era o FIFO, nem quanto ele ajudou, nada mais.  No entanto, Tom, geralmente uma pessoa amig√°vel e descontra√≠da, se transformou em um fan√°tico ativo e obcecado com muita cafe√≠na no sangue.  Com base nessas informa√ß√µes, ele tentou descobrir o que o Paradise era capaz de fazer.  No final, ele chegou √† conclus√£o de que o Paradise provavelmente inseriu um buffer de grava√ß√£o FIFO entre o barramento do sistema e o VGA, de modo que, quando a CPU estivesse gravando na mem√≥ria de v√≠deo, os dados gravados fossem imediatamente para o FIFO, e isso permitiria que a CPU continuasse processando em vez de ficar ociosa toda vez quando ele estava escrevendo na mem√≥ria do visor. <br><br>  Tom n√£o tinha elementos l√≥gicos, nem tempo suficiente para implementar um FIFO completo, mas conseguiu implementar o FIFO com uma √∫nica profundidade de opera√ß√£o, o que permitiu ao processador ultrapassar o chip VGA por uma opera√ß√£o de grava√ß√£o.  Tom n√£o tinha certeza de que isso daria bons resultados, mas era a √∫nica coisa que ele poderia fazer, ent√£o implementou esse sistema e transferiu o chip para a produ√ß√£o. <br><a name="habracut"></a><br>  Verificou-se que o FIFO de uma opera√ß√£o funciona incrivelmente legal: naquela √©poca, os sete chips VGA Video Seven eram os mais r√°pidos do mercado;  eles se tornaram evid√™ncia da genialidade de Tom e do que o criador √© capaz sob a press√£o das circunst√¢ncias.  No entanto, o melhor dessa hist√≥ria √© que o projeto FIFO do Paradise n√£o teve nada a ver com o design do Tom, e <u>n√£o funcionou</u> .  A Paradise inseriu um buffer FIFO de <u>leitura</u> entre a mem√≥ria do monitor e o est√°gio de sa√≠da de v√≠deo do chip VGA, o que possibilitou a leitura antecipada da sa√≠da de v√≠deo para que, quando a CPU precisasse acessar a mem√≥ria do monitor, os pixels pudessem ser retirados do FIFO e o comando da CPU fosse executado instantaneamente.  Isso realmente melhorou o desempenho, mas n√£o tanto quanto o buffer de grava√ß√£o FIFO de Tom. <br><br>  E esse caso pode ser considerado uma boa par√°bola sobre a pr√≥pria natureza do processo criativo que uma pessoa pode alcan√ßar.  Recortes de not√≠cias sobre o chip Paradise quase n√£o continham informa√ß√µes factuais, mas for√ßaram Tom a ir al√©m dos limites que ele subconscientemente estabeleceu, desenvolvendo o design inicial do chip.  Acredito que este √© o elemento mais importante de qualquer design engenhoso, seja no campo de hardware, software ou em qualquer outra esfera criativa, e foi ele quem nasceu nas not√≠cias de Tom sobre Paradise: a capacidade de detectar os limites que voc√™ construiu no processo de trabalhar no projeto e super√°-los fronteiras. <br><br>  O problema, √© claro, √© como superar as fronteiras, cuja exist√™ncia voc√™ nem conhece.  N√£o existe uma f√≥rmula para o sucesso, mas dois princ√≠pios podem servir bem a esse prop√≥sito: primeiro, simplifique; depois, tente constantemente algo novo. <br><br>  Normalmente, quando voc√™ sente que o c√≥digo est√° ficando complicado, voc√™ come√ßa a fazer pequenas altera√ß√µes na estrutura congelada e h√° uma alta probabilidade de aumentar a produtividade e reduzir a quantidade de c√≥digo inventando o design novamente.  Uma estrutura realmente boa deve trazer um momento de profunda satisfa√ß√£o quando tudo se encaixa, e voc√™ fica surpreso com o qu√£o pequena √© a quantidade de c√≥digo necess√°ria e com o desempenho de todos os casos de fronteira. <br><br>  No processo de revis√£o da estrutura, √© importante estudar todas as id√©ias que v√™m √† mente, n√£o importa qu√£o loucas elas possam parecer.  Muitas das grandes id√©ias que ouvi a princ√≠pio pareciam absurdas porque n√£o se encaixavam na minha imagem atual do mundo.  Muitas vezes, essas id√©ias s√£o realmente loucas, mas, assim como as not√≠cias sobre os chips da Paradise estimularam a imagina√ß√£o de Tom, a explora√ß√£o agressiva de id√©ias aparentemente ilus√≥rias pode abrir novas possibilidades para voc√™. <br><br>  Boa ilustra√ß√£o: a evolu√ß√£o do mecanismo gr√°fico Quake 3D. <br><br><h2>  A tarefa de gr√°ficos 3D mais complexa do mundo </h2><br>  Passei os √∫ltimos sete meses trabalhando no Quake, herdeiro da id Software pela DOOM, e presumo que mais tr√™s meses depois, quando voc√™ ler este artigo, o Quake ser√° lan√ßado como shareware. <br><br>  Em termos de gr√°ficos, Quake ser√° para o DOOM o que o DOOM era para o seu antecessor, Wolfenstein 3D.  Quake adiciona 3D arbitr√°rio real (o jogador pode olhar para cima e para baixo, inclinar-se para os lados e at√© cair para um lado), ilumina√ß√£o e sombras detalhadas, monstros e personagens em 3D em vez de sprites DOOM.  Em breve vou falar sobre tudo isso com mais detalhes, mas este m√™s quero falar sobre o problema, que em meu livro chamo de mais dif√≠cil em gr√°ficos tridimensionais: determinar superf√≠cies vis√≠veis (desenhar a superf√≠cie correspondente para cada pixel) e sobre uma tarefa muito pr√≥xima - sobre recorte (o mais r√°pido poss√≠vel, descartando pol√≠gonos invis√≠veis como forma de acelerar a determina√ß√£o de superf√≠cies vis√≠veis).  Por uma quest√£o de brevidade, usarei a abrevia√ß√£o VSD para denotar a defini√ß√£o de determina√ß√£o e sele√ß√£o vis√≠vel da superf√≠cie. <br><br>  Por que considero o VSD a tarefa mais dif√≠cil dos gr√°ficos 3D?  Embora as tarefas de rasteriza√ß√£o, por exemplo, mapeamento de textura, sejam igualmente surpreendentes e importantes, elas t√™m um escopo bastante limitado e, ap√≥s o advento dos aceleradores 3D, sua solu√ß√£o ser√° transferida para o hardware;  al√©m disso, sua escala depende apenas da resolu√ß√£o da tela, ou seja, s√£o bastante modestas. <br><br>  Por outro lado, o VSD √© uma tarefa ilimitada e dezenas de abordagens est√£o sendo usadas para resolv√™-lo.  Mais importante, por√©m, o desempenho do VSD em uma solu√ß√£o ing√™nua varia de acordo com a complexidade da cena, que geralmente aumenta como uma fun√ß√£o quadr√°tica ou c√∫bica e, portanto, rapidamente se torna o fator limitante na cria√ß√£o de mundos realistas.  Acredito que nos pr√≥ximos anos, o VSD se tornar√° um problema cada vez mais dominante nos gr√°ficos 3D em tempo real para PCs, porque os detalhes dos mundos 3D aumentar√£o constantemente.  Atualmente, um n√≠vel de tamanho s√≥lido do Quake pode conter cerca de 10.000 pol√≠gonos, ou seja, quase tr√™s vezes mais do que um n√≠vel compar√°vel de DOOM. <br><br><h2>  Estrutura de n√≠vel de terremoto </h2><br>  Antes de investigar o VSD, deixe-me mencionar que cada n√≠vel do Quake √© armazenado como uma enorme √°rvore tridimensional do BSP.  Essa √°rvore do BSP, como qualquer outro BSP, divide o espa√ßo, neste caso, ao longo dos planos dos pol√≠gonos.  No entanto, diferentemente da √°rvore do BSP que demonstrei anteriormente, a √°rvore do Quake BSP n√£o armazena pol√≠gonos nos n√≥s da √°rvore como parte dos planos de divis√£o, mas em folhas vazias (n√£o preenchidas), como mostra a Figura 1 na vista superior. <br><br><div style="text-align:center;"><img src="https://www.bluesnews.com/abrash/images/fig1.gif"></div><br>  <i>Figura 1. No Quake, os pol√≠gonos s√£o armazenados em folhas vazias.</i>  <i>√Åreas escuras s√£o folhas cheias (volumes cheios, como o interior das paredes)</i> <br><br>  A ordem correta de renderiza√ß√£o pode ser obtida renderizando as folhas na ordem BSP ‚Äúfrente para tr√°s‚Äù ou ‚Äútr√°s para frente‚Äù.  Al√©m disso, como as folhas do BSP s√£o sempre convexas e os pol√≠gonos s√£o os limites das folhas do BSP voltadas para dentro, os pol√≠gonos de qualquer folha nunca podem se sobrepor e podem ser desenhados em qualquer ordem.  (Esta √© uma propriedade geral do poliedro convexo.) <br><br><h2>  Recorte e defini√ß√£o de superf√≠cies vis√≠veis </h2><br>  Idealmente, o processo VSD deve funcionar da seguinte maneira: primeiro, voc√™ precisa descartar todos os pol√≠gonos que est√£o fora da pir√¢mide de visibilidade e tamb√©m cortar todas as partes invis√≠veis dos pol√≠gonos que est√£o parcialmente vis√≠veis.  Em seguida, voc√™ precisa desenhar apenas os pixels de cada pol√≠gono que s√£o realmente vis√≠veis do ponto de vista atual, como mostra a Figura 2 na vista superior, sem perder tempo redesenhando repetidamente os pixels;  observe quantos pol√≠gonos na Figura 2 voc√™ precisa desenhar.  E, finalmente, em um mundo ideal, verificar a visibilidade de partes dos pol√≠gonos deve ser barato e o tempo de processamento deve ser o mesmo para todos os pontos de vista poss√≠veis, para que o jogo funcione sem problemas. <br><br><div style="text-align:center;"><img src="https://www.bluesnews.com/abrash/images/fig2.gif"></div><br>  <i>Figura 2. A arquitetura VSD ideal renderiza apenas as partes vis√≠veis dos pol√≠gonos vis√≠veis.</i> <br><br>  No processo de realiza√ß√£o dessa tarefa, √© f√°cil determinar quais pol√≠gonos est√£o completamente fora do escopo da pir√¢mide de visibilidade ou parcialmente cortados, e √© bem poss√≠vel descobrir exatamente quais pixels desenhar.  Infelizmente, o mundo est√° longe de ser o ideal e todas essas verifica√ß√µes s√£o caras, portanto, o truque √© acelerar ou pular verifica√ß√µes diferentes, criando o resultado necess√°rio. <br><br>  Como expliquei em detalhes em artigos anteriores, com um BSP, voc√™ pode percorrer o mundo com facilidade e baixo custo, em ordem de frente para tr√°s ou de tr√°s para frente.  A solu√ß√£o VSD mais simples √© simplesmente atravessar a √°rvore de tr√°s para a frente, truncar cada pol√≠gono com uma pir√¢mide de visibilidade e desenh√°-la se seu rosto estiver direcionado para a c√¢mera e n√£o cortado completamente (algoritmo do artista).  Mas isso √© uma solu√ß√£o adequada? <br><br>  Para mundos relativamente simples, √© bastante aplic√°vel.  No entanto, ele n√£o escala bem.  Um dos problemas √© que, quando novos pol√≠gonos s√£o adicionados ao mundo para eliminar pol√≠gonos invis√≠veis, s√£o necess√°rias mais e mais transforma√ß√µes e verifica√ß√µes;  ap√≥s um certo limite, isso come√ßar√° a diminuir significativamente o desempenho. <br><br>  Felizmente, esse problema espec√≠fico tem uma boa solu√ß√£o alternativa.  Como mencionado acima, cada folha na √°rvore do BSP descreve um subespa√ßo convexo, e os n√≥s conectados √† folha limitam o espa√ßo.  Menos √≥bvio √© que cada n√≥ na √°rvore do BSP tamb√©m descreve um subespa√ßo - um subespa√ßo que consiste em todos os filhos do n√≥, como mostra a Figura 3. √â poss√≠vel assim: cada n√≥ divide em duas partes o subespa√ßo criado pelos n√≥s localizados acima em √°rvore e os elementos filhos do n√≥, enquadrando ainda mais esse subespa√ßo em todas as folhas provenientes do n√≥. <br><br><div style="text-align:center;"><img src="https://www.bluesnews.com/abrash/images/fig3.gif"></div><br>  <i>Figura 3: O n√≥ E descreve um subespa√ßo escuro que cont√©m as folhas 5, 6, 7 e o n√≥ F.</i> <br><br>  Como o subespa√ßo do n√≥ √© limitado e convexo, podemos verificar se ele est√° completamente fora da pir√¢mide de visibilidade.  Nesse caso, <u>todos os</u> filhos do n√≥ ser√£o definitivamente cortados completamente e poder√£o ser descartados sem processamento adicional.  Como a parte principal do mundo geralmente est√° localizada fora da pir√¢mide de visibilidade, muitos pol√≠gonos do mundo podem ser cortados quase sem custo por enormes fragmentos de subespa√ßos de n√≥s.  A execu√ß√£o de uma verifica√ß√£o ideal para subespa√ßos de recorte √© bastante dispendiosa, portanto, geralmente para cada n√≥, paralelogramos ou esferas restritos s√£o usados ‚Äã‚Äãpara verifica√ß√µes de recorte. <br><br>  Ou seja, cortar ao longo da pir√¢mide de visibilidade n√£o √© um problema e voc√™ pode usar o BSP para retroceder.  Ent√£o qual √© o problema? <br><br><h2>  Redesenhar </h2><br>  O problema que o principal autor das tecnologias DOOM e Quake que John Carmack enfrentou ao desenvolver o Quake foi que, em um mundo complexo, muitas cenas na pir√¢mide de visibilidade possuem um grande n√∫mero de pol√≠gonos.  A maioria desses pol√≠gonos √© parcial ou completamente sobreposta por outros pol√≠gonos, mas o algoritmo do artista descrito acima requer desenhar cada pixel de cada pol√≠gono na pir√¢mide de visibilidade.  No entanto, eles geralmente s√£o renderizados apenas para serem redesenhados por outros.  No n√≠vel de 10.000 pol√≠gonos do Quake, √© f√°cil obter o pior caso de redesenho quando os pixels s√£o desenhados 10 ou mais vezes;  isto √©, em alguns quadros, cada pixel, em m√©dia, ser√° desenhado 10 ou mais vezes.  Nenhum rasterizador √© r√°pido o suficiente para compensar a ordem de magnitude necess√°ria para renderizar uma cena;  pior, o algoritmo do artista cria enormes diferen√ßas de desempenho entre os melhores e os piores casos, o que leva a uma mudan√ßa significativa na taxa de quadros ao mover o visualizador. <br><br>  Portanto, John enfrentou o problema de reduzir a quantidade de redesenho para n√≠veis aceit√°veis.  Idealmente, cada pixel deve ser desenhado apenas uma vez, mas no m√°ximo duas ou tr√™s vezes.  Quanto a cortar a pir√¢mide de visibilidade, idealmente, era necess√°rio que todos os pol√≠gonos invis√≠veis na pir√¢mide fossem cortados com quase nenhum custo extra.  Uma vantagem seria tamb√©m que seria poss√≠vel desenhar apenas as partes vis√≠veis dos pol√≠gonos parcialmente vis√≠veis, mas, ao mesmo tempo, um equil√≠brio deve ser mantido: a opera√ß√£o deve gastar menos que redesenhar. <br><br>  Quando cheguei √† identifica√ß√£o no in√≠cio de mar√ßo, John j√° tinha um prot√≥tipo do mecanismo e um plano geral, por isso assumi que nosso trabalho seria simplesmente concluir e otimizar esse mecanismo.  No entanto, se eu conhecesse a hist√≥ria do id, poderia descobrir o que era.  John criou n√£o apenas DOOM, mas tamb√©m mecanismos para o Wolf 3D e v√°rios outros jogos anteriores, e durante o processo de desenvolvimento, ele criou v√°rias vers√µes diferentes de cada mecanismo (uma vez que ele criou quatro mecanismos em quatro semanas), ou seja, em quatro anos ele escreveu cerca de 20 mecanismos .  O desejo incans√°vel de John por mais e mais tecnologias novas e de alta qualidade do mecanismo Quake terminar√° somente ap√≥s o lan√ßamento do jogo. <br><br>  Tr√™s meses ap√≥s minha chegada, apenas um elemento da estrutura VSD original permaneceu no mecanismo, e o desejo de John de "tentar coisas novas" foi t√£o longe que eu nunca tinha visto uma coisa dessas antes. <br><br><h2>  Bando de √°rvore </h2><br>  No projeto Quake original de John, a renderiza√ß√£o foi feita da frente para tr√°s usando uma segunda √°rvore do BSP que rastreia partes da tela j√° desenhadas e ainda vazias que precisavam ser preenchidas com os pol√≠gonos restantes.  Logicamente, essa √°rvore do BSP pode ser considerada uma √°rea bidimensional que descreve as partes preenchidas e vazias da tela, como mostra a Figura 4, mas, na verdade, √© uma √°rvore tridimensional, conhecida como ‚Äú√°rvore de vigas‚Äù.  Uma √°rvore de vigas √© um conjunto de setores 3D (cachos) delimitados por planos projetados a partir de algum ponto central (no nosso caso, o ponto de vista), como mostra a Figura 5. <br><br><div style="text-align:center;"><img src="https://www.bluesnews.com/abrash/images/fig4.gif"></div><br>  <i>Figura 4. A √°rvore de vigas do Quake efetivamente divide a tela em uma √°rea 2D</i> <br><br><div style="text-align:center;"><img src="https://www.bluesnews.com/abrash/images/fig5.gif"></div><br>  <i>Figura 5. A √°rvore de vigas do Quake consiste em setores ou vigas 3D projetados do ponto de vista at√© as bordas dos pol√≠gonos.</i> <br><br>  No projeto de John, uma √°rvore de feixe consiste inicialmente em um √∫nico feixe descrevendo a pir√¢mide de visibilidade;  tudo fora deste pacote √© considerado preenchido (ou seja, n√£o h√° necessidade de desenhar nada l√°) e tudo dentro do pacote √© considerado vazio.  Ao atingir um novo pol√≠gono percorrendo a √°rvore BSP do mundo de frente para tr√°s, esse pol√≠gono foi transformado em uma viga desenhando planos de suas bordas atrav√©s do ponto de vista, e todas as partes da viga que cruzavam vigas vazias na viga foram consideradas desenhadas e adicionadas √† viga como uma viga cheia.  Isso continuou, at√© os pol√≠gonos terminarem ou at√© a √°rvore de feixes ficar completamente cheia.  Depois que a √°rvore de vigas foi conclu√≠da, as partes vis√≠veis dos pol√≠gonos presos na √°rvore de vigas foram desenhadas. <br><br>  A vantagem de trabalhar com uma √°rvore de feixes tridimensional em vez da regi√£o 2D foi que, para determinar em qual lado do plano de feixes est√° o v√©rtice do pol√≠gono, basta verificar o sinal do produto vetorial do raio para o v√©rtice e o normal para o plano, porque todos os planos de feixes passam pelo in√≠cio coordenadas (ponto de vista).  Al√©m disso, como o plano do feixe √© completamente descrito por uma √∫nica normal, para gerar um feixe a partir da borda do pol√≠gono, apenas o produto escalar da borda e o feixe dessa borda at√© o ponto de vista s√£o suficientes.  Finalmente, para o recorte de grupo pela pir√¢mide de visibilidade descrita acima, pode-se usar as esferas delimitadoras dos n√≥s do BSP. <br><br>  Inicialmente, a propriedade da √°rvore de pacote configur√°vel (que termina quando a √°rvore de pacote configur√°vel fica cheia) parecia atraente porque parecia limitar o desempenho nos piores casos.  Infelizmente, ainda eram poss√≠veis cenas nas quais era poss√≠vel ver tudo at√© o c√©u ou a parede traseira do mundo; portanto, na pior das hip√≥teses, voc√™ ainda tinha que verificar todos os pol√≠gonos na pir√¢mide de visibilidade em rela√ß√£o √† √°rvore.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problemas semelhantes tamb√©m podem ocorrer com pequenas rachaduras devido a limita√ß√µes na precis√£o num√©rica. </font><font style="vertical-align: inherit;">√â gasto muito tempo cortando a √°rvore de feixes e, em cenas com alta visibilidade, por exemplo, quando vistas de cima, o custo total do processamento dos feixes reduziu a taxa de quadros do Quake √†s velocidades das tartarugas. </font><font style="vertical-align: inherit;">Ou seja, no final, verificou-se que a solu√ß√£o com √°rvores de feixes sofre quase as mesmas doen√ßas que o algoritmo do artista: o pior caso √© muito pior que o caso m√©dio e n√£o escala bem com a crescente complexidade do n√≠vel.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Novo mecanismo 3D todos os dias </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depois que a √°rvore de vigas come√ßou a funcionar, John trabalhou incansavelmente para acelerar o mecanismo 3D, tentando constantemente melhorar sua estrutura, em vez de fazer altera√ß√µes na implementa√ß√£o. Pelo menos uma vez por semana, e muitas vezes todos os dias, ele foi ao meu escrit√≥rio e disse: ‚ÄúOntem √† noite eu n√£o conseguia dormir, ent√£o era isso que eu pensava ...‚Äù, e eu sabia que ele estava novamente pressionando meu c√©rebro levemente. John tentou v√°rias maneiras de melhorar o bun tree e obteve algum sucesso, mas muito mais interessante foi a abund√¢ncia de abordagens completamente diferentes que ele gerou. Alguns deles foram pouco mencionados, enquanto outros foram implementados da noite para o dia ou em um fim de semana de intensa codifica√ß√£o. Nos dois casos, foram descartados ou evolu√≠ram como resultado at√© come√ßarem a atender aos crit√©rios necess√°rios. Aqui est√£o alguns exemplos de tais abordagens. Vou falar sobre eles em m√≠nimos detalhes,esperando que eles despertem sua imagina√ß√£o, assim como o buffer FIFO do Paradise despertou a imagina√ß√£o de Tom Wilson.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subdivis√£o de radiodifus√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : os raios s√£o liberados em uma tela dividida em uma grade 8x8; essa √© uma opera√ß√£o muito eficiente, porque a primeira interse√ß√£o com a superf√≠cie pode ser encontrada simplesmente restringindo o feixe √† √°rvore BSP, come√ßando do ponto de vista, at√© que a folha cheia seja alcan√ßada. Se os raios vizinhos n√£o ca√≠rem na mesma superf√≠cie, um raio ser√° emitido no meio entre eles, e isso continuar√° at√© que todos os raios vizinhos caiam em uma superf√≠cie ou em pixels vizinhos; ent√£o, um bloco √© desenhado em torno de cada raio do pol√≠gono em que o raio caiu. Essa abordagem √© muito bem dimensionada e √© limitada pelo n√∫mero de pixels, e o redesenho n√£o ocorre. Seu problema est√° caindo: h√° uma alta probabilidade de que pequenos pol√≠gonos apare√ßam entre os raios e desapare√ßam. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Superf√≠cies sem pico</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: O mundo √© representado como um conjunto de planos de superf√≠cie. Os pol√≠gonos aparecem indiretamente nas interse√ß√µes dos planos e s√£o removidos dos planos no √∫ltimo est√°gio antes da renderiza√ß√£o. Isso fornece recorte r√°pido e uma quantidade muito pequena de dados (em compara√ß√£o com pol√≠gonos, os planos s√£o descritos de maneira muito mais compacta), mas leva muito tempo para extrair pol√≠gonos dos planos. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buffer de desenho</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: √© semelhante ao buffer z, mas com apenas um bit por pixel, indicando se o pixel j√° foi desenhado. Isso elimina o redesenho, mas, ao custo de verificar o loop interno no buffer, opera√ß√µes adicionais de grava√ß√£o e falhas de cache, e o pior de tudo, a complexidade do c√≥digo aumenta significativamente. Op√ß√µes para essa abordagem: verificar o buffer de renderiza√ß√£o um byte de cada vez e ignorar completamente bytes completamente sobrepostos ou ramificar cada byte do buffer de renderiza√ß√£o em um dos 256 loops internos implantados para renderizar de 0 a 8 pixels; nesse processo, voc√™ pode, teoricamente, tirar proveito da capacidade dos processadores x86 de executar divis√£o fracion√°ria de perspectiva paralela ao processar 8 pixels. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renderiza√ß√£o de intervalo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Os pol√≠gonos s√£o rasterizados em intervalos, que s√£o adicionados √† lista global de intervalos e s√£o cortados dessa lista para que somente o intervalo mais pr√≥ximo permane√ßa em cada pixel. √â necess√°ria uma pequena classifica√ß√£o indo da frente para tr√°s, porque se houver interse√ß√µes, o intervalo j√° na lista √© mais pr√≥ximo. Isso elimina a necessidade de redesenho, mas √† custa de intervalos aritm√©ticos de c√°lculo; al√©m disso, cada pol√≠gono ainda deve ser convertido em intervalos. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portais</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: s√£o rastreados orif√≠cios nos quais n√£o h√° pol√≠gonos nas superf√≠cies, porque a faixa de visibilidade s√≥ pode ser expandida atrav√©s desses portais. </font><font style="vertical-align: inherit;">A renderiza√ß√£o √© realizada de frente para tr√°s e, quando um portal √© detectado, os pol√≠gonos e portais atr√°s dele s√£o limitados a seus limites at√© que n√£o haja pol√≠gonos e portais vis√≠veis. </font><font style="vertical-align: inherit;">Com a aplica√ß√£o recursiva desse princ√≠pio, ele permite desenhar apenas as partes vis√≠veis dos pol√≠gonos vis√≠veis, mas ao custo de uma quantidade significativa de recorte nos portais.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avan√ßo </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No final, John decidiu que a √°rvore em vigas √© uma estrutura de segunda ordem que reflete as informa√ß√µes j√° indiretamente contidas na √°rvore BSP do mundo; portanto, ele resolveu o problema de extrair informa√ß√µes de visibilidade diretamente da √°rvore BSP do mundo. Ele passou uma semana nisso, criando uma arquitetura de visibilidade DOOM (2D) ideal na qual uma √∫nica passagem linear da √°rvore DOOM BSP cria visibilidade 2D redesenhada. No entanto, resolver o mesmo problema para o 3D acabou sendo um problema muito mais complicado e, no final da semana, John j√° estava perdendo a paci√™ncia com a crescente complexidade e as constantes falhas no c√≥digo de visibilidade. Embora a solu√ß√£o com processamento direto do BSP j√° estivesse pr√≥xima da vers√£o de trabalho, exigia cada vez mais refinamento, e a arquitetura simples e clara n√£o era de todo. Quando sa√≠ do trabalho uma sexta-feiraJohn estava se preparando para colocar a solu√ß√£o de processamento BSP direto em funcionamento no fim de semana.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na segunda-feira de manh√£, John parecia um homem invadindo um mundo diferente e tamb√©m como um homem que n√£o dormia muito. Durante todo o fim de semana, ele trabalhou em uma solu√ß√£o com processamento direto do BSP, obteve um trabalho satisfat√≥rio e tamb√©m anotou como finaliz√°-lo. √Äs 3:30 da manh√£ de segunda-feira, quando John estava deitado na cama e pensando em portais, ele pensou que voc√™ pode pr√©-calcular e salvar em cada folha uma lista de todas as folhas vis√≠veis nesta folha e depois desenhar apenas as vis√≠veis durante a execu√ß√£o do programa sai de tr√°s para frente, dependendo da folha em que o ponto de vista est√°, ignorando completamente todas as outras folhas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A complexidade era de tamanho: o conjunto inicialmente descompactado de conjunto potencialmente vis√≠vel (PVS) ocupava v√°rios megabytes. No entanto, o PVS pode ser armazenado como um vetor de bit com 1 bit por folha. √â muito f√°cil compactar essa estrutura com uma compacta√ß√£o simples de zero bytes. John tamb√©m sugeriu alterar a heur√≠stica do BSP para gerar menos folhas. Isso foi o oposto do que propus h√° v√°rios meses, a saber, a escolha do pr√≥ximo separador de pol√≠gonos, separando o menor n√∫mero de outros pol√≠gonos e, de acordo com os dados mais recentes, ele se mostrou a melhor heur√≠stica. A abordagem de John permitiu limitar o espa√ßo fora do n√≠vel, para que o manipulador do BSP pudesse remover superf√≠cies externas que o jogador nunca veria,como resultado, reduzindo o tamanho do PVS para um n√≠vel suficientemente grande para 20 kilobytes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em troca desses 20 kilobytes, o recorte de folhas fora do escopo da pir√¢mide de visibilidade √© acelerado (porque apenas as folhas no PVS s√£o levadas em considera√ß√£o) e, para recorte dentro da pir√¢mide de visibilidade, voc√™ s√≥ precisa de um pequeno redesenho (o PVS da folha cont√©m todas as folhas vis√≠veis de qualquer lugar da folha, portanto um pequeno redesenho, geralmente da ordem de 50%, mas capaz de atingir at√© 150%). Melhor ainda, a pr√©-computa√ß√£o do PVS resulta em uma equaliza√ß√£o de desempenho; o pior caso agora n√£o √© muito pior do que o melhor, porque voc√™ n√£o precisa mais de processamento VSD adicional, apenas mais pol√≠gonos e talvez um pouco de redesenho extra no caso de cenas complexas. Quando John me mostrou seu prot√≥tipo de trabalho, lancei especialmente a cena mais dif√≠cil - o local em que a taxa de quadros diminuiu para n√∫meros de um d√≠gito e funcionou sem problemas,sem lentid√£o percept√≠vel.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John disse que o c√°lculo preliminar do PVS era um desenvolvimento l√≥gico das abordagens que ele estava considerando, e n√£o houve momento de "eureka". </font><font style="vertical-align: inherit;">No entanto, essa foi a descoberta de um design totalmente novo e qualitativamente melhor, que, juntamente com um rasterizador com arestas de classifica√ß√£o que elimina completamente o redesenho, est√° muito pr√≥ximo dos requisitos ‚Äúideais‚Äù que selecionamos desde o in√≠cio.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Simplifique e tente algo novo </font></font></h2><br>  O que isso significa?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exatamente o que eu disse no come√ßo: simplifique e tente algo novo. </font><font style="vertical-align: inherit;">PVSs pr√©-computados s√£o mais simples do que qualquer outro esquema que analisamos anteriormente (embora pr√©-computar PVSs seja uma tarefa interessante que discutiremos em outro momento). </font><font style="vertical-align: inherit;">Em ess√™ncia, PVSs pr√©-calculados s√£o apenas uma vers√£o limitada do algoritmo do artista durante a execu√ß√£o do programa. </font><font style="vertical-align: inherit;">Isso significa que essa abordagem n√£o √© particularmente profunda?</font></font><br><br>  Nem um pouco.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas as estruturas verdadeiramente excelentes parecem simples e at√© √≥bvias, mas somente depois que s√£o inventadas. </font><font style="vertical-align: inherit;">Mas o pr√≥prio processo de inven√ß√£o requer incr√≠vel perseveran√ßa e vontade de experimentar muitas id√©ias diferentes at√© encontrar a correta, como aconteceu neste caso.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meu amigo Chris Hecker tem uma teoria de que todas as abordagens se resumem a uma, porque todas elas refletem o mesmo estado e funcionalidade internos. Do ponto de vista das teorias subjacentes, isso √© verdade: n√£o importa como voc√™ calcule o mapeamento de textura em perspectiva - usando divis√£o ou c√°lculos hiperb√≥licos incrementais, os n√∫meros executam a mesma tarefa. No entanto, quando se trata de implementa√ß√£o, uma enorme diferen√ßa pode ser feita com uma simples mudan√ßa da solu√ß√£o no tempo ou com uma melhoria na otimiza√ß√£o dos recursos de hardware ou do cache. Meu amigo Terje Mathisen gosta de repetir que "quase toda a programa√ß√£o pode ser vista como exerc√≠cios de armazenamento em cache"; Foi exatamente isso que Jo√£o fez. N√£o importa o qu√£o r√°pido ele fa√ßa seus c√°lculos de VSD, eles nunca se tornar√£o t√£o r√°pidos quanto pr√©-computar e procurar visibilidade.Sua atitude mais inteligente foi afastar-se da mentalidade de ‚Äúacelera√ß√£o de c√≥digo‚Äù e perceber que, de fato, √© poss√≠vel pr√©-calcular (essencialmente, armazenar em cache) o PVS e procur√°-los.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A coisa mais dif√≠cil do mundo √© se afastar da solu√ß√£o usual e razoavelmente boa para um problema complexo e tentar encontrar outra solu√ß√£o melhor. </font><font style="vertical-align: inherit;">Parece-me que, para isso, √© melhor tentar novas id√©ias malucas e sempre, sempre tentar simplificar. </font><font style="vertical-align: inherit;">Um dos objetivos de John era ter menos c√≥digo em cada jogo 3D subsequente do que no anterior; </font><font style="vertical-align: inherit;">ele acreditava que, se aprender mais, poder√° resolver problemas com mais efici√™ncia em uma quantidade menor de c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E enquanto esse sistema est√° funcionando muito bem para ele.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aprenda agora, pague antecipadamente </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° mais uma coisa que gostaria de mencionar no final do artigo. Quanto me lembro, Dr. O Dobb's Journal sempre disse que compartilhar informa√ß√µes de programa√ß√£o √© uma b√™n√ß√£o. Conhe√ßo muitos programadores que deram um salto em seu desenvolvimento gra√ßas a Tiny C Hendrix, ou D-Flat Stevens, ou simplesmente por ler o </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fich√°rio</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anual do </font><u><font style="vertical-align: inherit;">DDJ</font></u><font style="vertical-align: inherit;"> . (Entre eles, por exemplo, eu sou.) Muitas empresas consideram compreensivelmente a troca de informa√ß√µes de uma maneira completamente diferente - como uma potencial perda de lucro, e √© isso que torna o </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDJ</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> t√£o valioso para a comunidade de programadores.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gra√ßas a essa filosofia, a id Software me permitiu contar neste artigo como o Quake funciona antes mesmo de ser lan√ßado. E foi por isso que a id postou o c√≥digo fonte completo da Wolfenstein 3D em ftp.idsoftware.com/idstuff/source </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[aprox. tradu√ß√£o: agora os c√≥digos-fonte s√£o definidos no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; voc√™ n√£o pode recompilar o c√≥digo e vend√™-lo, mas pode descobrir como um jogo de sucesso em larga escala funciona; examine o arquivo wolfsrc.txt no diret√≥rio acima para obter detalhes sobre como o c√≥digo pode ser usado.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, lembre-se: quando √© legal, a longo prazo, a troca de informa√ß√µes beneficia todos n√≥s. Voc√™ pode pagar a d√≠vida pelas informa√ß√µes recebidas aqui e em outros lugares, compartilhando tudo o que pode escrevendo um artigo ou um livro ou publicando conhecimento na Web. Nenhum de n√≥s aprende no v√°cuo; todos estamos nos ombros de gigantes - Wirth, Knut e milhares de outros. Substitua seus ombros para construir o futuro!</font></font><br><br><h2>  Refer√™ncias </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foley, James D. </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et al. </font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Computer Graphics: Principles and Practice</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Addison Wesley, 1990, ISBN 0-201-12110-7 (pacotes, √°rvores BSP, VSD). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teller, Seth, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Computa√ß√µes de visibilidade em ambientes poli√©dricos densamente ocultos</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (disserta√ß√£o), est√° dispon√≠vel em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://theory.lcs.mit.edu/~seth/,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> juntamente com outros artigos sobre a defini√ß√£o de visibilidade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teller, Seth, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©-processamento de visibilidade para orienta√ß√µes interativas</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , procedimentos SIGGRAPH 91, pp. </font><font style="vertical-align: inherit;">61-69.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt435760/">https://habr.com/ru/post/pt435760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt435746/index.html">Gera√ß√£o din√¢mica de DAG no fluxo de ar</a></li>
<li><a href="../pt435748/index.html">Lan√ßamento do Metasploit Framework 5.0</a></li>
<li><a href="../pt435750/index.html">Resumo dos eventos de TI de janeiro</a></li>
<li><a href="../pt435752/index.html">Moscow Python Conf ++ 2019 - a primeira confer√™ncia em que n√≥s mesmos preparamos alguns palestrantes</a></li>
<li><a href="../pt435756/index.html">Venda de Ano Novo</a></li>
<li><a href="../pt435764/index.html">Ol√° mundo! Ou Habr em ingl√™s, v1.0</a></li>
<li><a href="../pt435766/index.html">Ol√° mundo! Ou Habr de l√≠ngua inglesa, v1.0</a></li>
<li><a href="../pt435770/index.html">Hackers secretos VS C√≥digo</a></li>
<li><a href="../pt435774/index.html">Ilha do Pico: como fazer Tussent aconchegante do inferno bas√°ltico</a></li>
<li><a href="../pt435776/index.html">V√≠deo a bordo dos processos de prepara√ß√£o e pouso, bem como um panorama do lado oposto da lua de Chang'e-4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>