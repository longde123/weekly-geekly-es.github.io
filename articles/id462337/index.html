<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûñ ‚òÆÔ∏è üë©üèΩ‚Äçü§ù‚Äçüë®üèº Statistik situs dan repositori kecil Anda üë©üèº üçà ‚ùÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Utilitas Webalizer dan alat Google Analytics telah membantu saya selama bertahun-tahun untuk mendapatkan ide tentang apa yang terjadi di situs web. Se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Statistik situs dan repositori kecil Anda</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462337/"> Utilitas Webalizer dan alat Google Analytics telah membantu saya selama bertahun-tahun untuk mendapatkan ide tentang apa yang terjadi di situs web.  Sekarang saya mengerti bahwa mereka memberikan informasi yang sangat berguna.  Memiliki akses ke file access.log Anda, sangat mudah untuk mengetahui statistik dan mengimplementasikan alat yang cukup mendasar seperti sqlite, html, sql, dan bahasa pemrograman scripting apa pun. <br><br>  Sumber data untuk Webalizer adalah file access.log server.  Beginilah tampilan kolom dan angka, yang hanya jumlah lalu lintas totalnya yang jelas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n1/br/xb/n1brxbufrqnd4t0j6nzlbv1jkzq.png" alt="gambar"></div><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u1/fe/mk/u1femkuxt4sompxtu4dhyr75ito.png" alt="gambar"></div><br>  Alat seperti Google Analytics mengumpulkan data dari halaman yang dimuat sendiri.  Mereka menunjukkan kepada kita beberapa diagram dan garis, yang seringkali sulit untuk menarik kesimpulan yang tepat.  Mungkin dibutuhkan lebih banyak usaha?  Saya tidak tahu. <br><br>  Jadi, apa yang ingin saya lihat dalam statistik kunjungan situs? <br><br><h4>  Lalu lintas pengguna dan bot </h4><br>  Seringkali lalu lintas situs memiliki batas dan Anda perlu melihat seberapa banyak lalu lintas yang bermanfaat digunakan.  Misalnya, seperti ini: <br><br><img src="https://habrastorage.org/webt/zx/ns/in/zxnsin0lv74jmiaupcbtmwbuaca.png" alt="gambar"><br><br><div class="spoiler">  <b class="spoiler_title">Permintaan laporan SQL</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'StackedArea: Traffic generated by Users and Bots'</span></span>, strftime(<span class="hljs-string"><span class="hljs-string">'%d.%m'</span></span>, datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> USG.AGENT_BOT!=<span class="hljs-string"><span class="hljs-string">'na'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.BYTES <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>)/<span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Bots, KB'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> USG.AGENT_BOT=<span class="hljs-string"><span class="hljs-string">'na'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.BYTES <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>)/<span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Users, KB'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FCT_ACCESS_USER_AGENT_DD FCT, DIM_USER_AGENT USG <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> FCT.DIM_USER_AGENT_ID=USG.DIM_USER_AGENT_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>) &gt;= <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">'now'</span></span>, <span class="hljs-string"><span class="hljs-string">'-14 day'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> strftime(<span class="hljs-string"><span class="hljs-string">'%d.%m'</span></span>, datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> FCT.EVENT_DT</code> </pre> <br></div></div><br>  Dari grafik, Anda dapat melihat aktivitas bot yang konstan.  Akan menarik untuk mempelajari secara rinci perwakilan yang paling aktif. <br><br><h4>  Bot yang mengganggu </h4><br>  Kami mengklasifikasikan bot berdasarkan informasi agen pengguna.  Statistik tambahan tentang lalu lintas harian, jumlah permintaan yang berhasil dan tidak berhasil memberikan ide bagus tentang aktivitas bot. <br><br><img src="https://habrastorage.org/webt/ly/ue/2g/lyue2grwohunkb13gxwqrrsmrz4.png" alt="gambar"><br><br><div class="spoiler">  <b class="spoiler_title">Permintaan laporan SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Table: Annoying Bots'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(USG.AGENT_BOT) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Bot'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.BYTES)/<span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">14.0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'KB per Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.IP_CNT) / <span class="hljs-number"><span class="hljs-number">14.0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'IPs per Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> STS.STATUS_GROUP <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Client Error'</span></span>, <span class="hljs-string"><span class="hljs-string">'Server Error'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.REQUEST_CNT / <span class="hljs-number"><span class="hljs-number">14.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Error Requests per Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> STS.STATUS_GROUP <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Successful'</span></span>, <span class="hljs-string"><span class="hljs-string">'Redirection'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.REQUEST_CNT / <span class="hljs-number"><span class="hljs-number">14.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Success Requests per Day'</span></span>, USG.USER_AGENT_NK <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Agent'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FCT_ACCESS_USER_AGENT_DD FCT, DIM_USER_AGENT USG, DIM_HTTP_STATUS STS <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> FCT.DIM_USER_AGENT_ID = USG.DIM_USER_AGENT_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> FCT.DIM_HTTP_STATUS_ID = STS.DIM_HTTP_STATUS_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> USG.AGENT_BOT != <span class="hljs-string"><span class="hljs-string">'na'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>) &gt;= <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">'now'</span></span>, <span class="hljs-string"><span class="hljs-string">'-14 day'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> USG.USER_AGENT_NK <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br></div></div><br>  Dalam hal ini, analisis menghasilkan keputusan untuk membatasi akses ke situs dengan menambahkan robots.txt ke file <br><br> <code>User-agent: AhrefsBot <br> Disallow: / <br> User-agent: dotbot <br> Disallow: / <br> User-agent: bingbot <br> Crawl-delay: 5</code> <br>  Dua bot pertama menghilang dari meja, dan robot MS bergerak turun dari baris pertama. <br><br><h4>  Hari dan waktu dari sebagian besar aktivitas </h4><br>  Lalu lintas muncul.  Untuk mempelajarinya secara rinci, perlu untuk mengidentifikasi waktu kemunculannya, sementara itu tidak perlu untuk menampilkan semua jam dan hari pengukuran waktu.  Jadi akan lebih mudah untuk menemukan permintaan individual dalam file log jika Anda membutuhkan analisis terperinci. <br><br><img src="https://habrastorage.org/webt/0d/az/jb/0dazjba9u6qctbppnqmvmlbfapo.png" alt="gambar"><br><br><div class="spoiler">  <b class="spoiler_title">Permintaan laporan SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Line: Day and Hour of Hits from Users and Bots'</span></span>, strftime(<span class="hljs-string"><span class="hljs-string">'%d.%m-%H'</span></span>, datetime(EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Date Time'</span></span>, HIB <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Bots, Hits'</span></span>, HIU <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Users, Hits'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> EVENT_DT, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> AGENT_BOT!=<span class="hljs-string"><span class="hljs-string">'na'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> LINE_CNT <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> HIB, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> AGENT_BOT=<span class="hljs-string"><span class="hljs-string">'na'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> LINE_CNT <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> HIU <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FCT_ACCESS_REQUEST_REF_HH <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> datetime(EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>) &gt;= <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">'now'</span></span>, <span class="hljs-string"><span class="hljs-string">'-14 day'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> EVENT_DT <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(LINE_CNT) <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> EVENT_DT</code> </pre> <br></div></div><br>  Kami mengamati jam paling aktif 11, 14 dan 20 dari hari pertama pada grafik.  Tapi hari berikutnya pukul 13.00 bot sudah aktif. <br><br><h4>  Aktivitas pengguna harian rata-rata mingguan </h4><br>  Dengan aktivitas dan lalu lintas sedikit tahu.  Pertanyaan selanjutnya adalah aktivitas para pengguna itu sendiri.  Untuk statistik seperti itu, jumlah besar agregasi, misalnya, seminggu, diinginkan. <br><br><img src="https://habrastorage.org/webt/2j/cq/-a/2jcq-aaudo2zn21ewcr8ukr3mrq.png" alt="gambar"><br><br><div class="spoiler">  <b class="spoiler_title">Permintaan laporan SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'Line: Average Daily User Activity by Week'</span></span>, strftime(<span class="hljs-string"><span class="hljs-string">'%W week'</span></span>, datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Week'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span>*<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.PAGE_CNT)/<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.IP_CNT),<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Pages per IP per Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span>*<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.FILE_CNT)/<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.IP_CNT),<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Files per IP per Day'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FCT_ACCESS_USER_AGENT_DD FCT, DIM_USER_AGENT USG, DIM_HTTP_STATUS HST <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> FCT.DIM_USER_AGENT_ID=USG.DIM_USER_AGENT_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> FCT.DIM_HTTP_STATUS_ID = HST.DIM_HTTP_STATUS_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> USG.AGENT_BOT=<span class="hljs-string"><span class="hljs-string">'na'</span></span> <span class="hljs-comment"><span class="hljs-comment">/* users only */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> HST.STATUS_GROUP <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Successful'</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* good pages */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>) &gt; <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">'now'</span></span>, <span class="hljs-string"><span class="hljs-string">'-3 month'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> strftime(<span class="hljs-string"><span class="hljs-string">'%W week'</span></span>, datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> FCT.EVENT_DT</code> </pre> <br></div></div><br>  Statistik untuk minggu ini menunjukkan bahwa rata-rata satu pengguna membuka 1,6 halaman per hari.  Jumlah file yang diminta per pengguna dalam hal ini tergantung pada penambahan file baru ke situs. <br><br><h4>  Semua permintaan dan statusnya </h4><br>  Webalizer selalu menunjukkan kode halaman tertentu dan selalu ingin melihat jumlah permintaan dan kesalahan yang berhasil. <br><br><img src="https://habrastorage.org/webt/-0/tl/l_/-0tll_vfgjgf2yzzofonmztakke.png" alt="gambar"><br><br><div class="spoiler">  <b class="spoiler_title">Permintaan laporan SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'Line: All Requests by Status'</span></span>, strftime(<span class="hljs-string"><span class="hljs-string">'%d.%m'</span></span>, datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> STS.STATUS_GROUP=<span class="hljs-string"><span class="hljs-string">'Successful'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.REQUEST_CNT <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Success'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> STS.STATUS_GROUP=<span class="hljs-string"><span class="hljs-string">'Redirection'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.REQUEST_CNT <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Redirect'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> STS.STATUS_GROUP=<span class="hljs-string"><span class="hljs-string">'Client Error'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.REQUEST_CNT <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Customer Error'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> STS.STATUS_GROUP=<span class="hljs-string"><span class="hljs-string">'Server Error'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> FCT.REQUEST_CNT <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Server Error'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FCT_ACCESS_USER_AGENT_DD FCT, DIM_HTTP_STATUS STS <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> FCT.DIM_HTTP_STATUS_ID=STS.DIM_HTTP_STATUS_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>) &gt;= <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">'now'</span></span>, <span class="hljs-string"><span class="hljs-string">'-14 day'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> strftime(<span class="hljs-string"><span class="hljs-string">'%d.%m'</span></span>, datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> FCT.EVENT_DT</code> </pre> <br></div></div><br>  Laporan menampilkan permintaan, bukan klik (klik), tidak seperti LINE_CNT, metrik REQUEST_CNT dianggap sebagai COUNT (DISTINCT STG.REQUEST_NK).  Tujuannya adalah untuk menunjukkan acara yang efektif, misalnya, bot MS ratusan kali sehari melakukan polling file robots.txt dan, dalam hal ini, polling tersebut akan dihitung sekali.  Ini memungkinkan Anda untuk menghaluskan lompatan pada grafik. <br><br>  Dari grafik, Anda dapat melihat banyak kesalahan - ini adalah halaman yang tidak ada.  Hasil analisis adalah penambahan pengalihan dari halaman jarak jauh. <br><br><h4>  Permintaan salah </h4><br>  Untuk tinjauan rinci tentang permintaan, Anda dapat menampilkan statistik terperinci. <br><br><img src="https://habrastorage.org/webt/sv/67/o4/sv67o47nnbg41zchmmaioaguv1e.png" alt="gambar"><br><br><div class="spoiler">  <b class="spoiler_title">Permintaan laporan SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Table: Top Error Requests'</span></span>, REQ.REQUEST_NK <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Request'</span></span>, <span class="hljs-string"><span class="hljs-string">'Error'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Request Status'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.LINE_CNT) / <span class="hljs-number"><span class="hljs-number">14.0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'Hits per Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.IP_CNT) / <span class="hljs-number"><span class="hljs-number">14.0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'IPs per Day'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ROUND</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(FCT.BYTES)/<span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">14.0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">'KB per Day'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> FCT_ACCESS_REQUEST_REF_HH FCT, DIM_REQUEST_V_ACT REQ <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> FCT.DIM_REQUEST_ID = REQ.DIM_REQUEST_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> FCT.STATUS_GROUP <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Client Error'</span></span>, <span class="hljs-string"><span class="hljs-string">'Server Error'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> datetime(FCT.EVENT_DT, <span class="hljs-string"><span class="hljs-string">'unixepoch'</span></span>) &gt;= <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">'now'</span></span>, <span class="hljs-string"><span class="hljs-string">'-14 day'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> REQ.REQUEST_NK <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span></code> </pre> <br></div></div><br>  Daftar ini akan berisi semua dialer, misalnya, permintaan ke /wp-login.php. Dengan menyesuaikan aturan untuk menulis ulang permintaan oleh server, Anda dapat menyesuaikan respons server terhadap permintaan tersebut dan mengirimkannya ke halaman awal. <br><br>  Jadi, beberapa laporan sederhana berdasarkan file log server memberikan gambaran yang cukup lengkap tentang apa yang terjadi di situs. <br><br><h4>  Bagaimana cara mendapatkan informasi? </h4><br>  Database sqlite sudah cukup.  Mari kita buat tabel: bantu untuk proses log ETL. <br><br><img src="https://habrastorage.org/webt/zw/nr/4i/zwnr4iijmghgjtw9kytl2h5ohha.png" alt="gambar"><br><br>  Tabel panggung, tempat kami akan menulis file log menggunakan PHP.  Dua tabel agregat.  Buat tabel harian dengan statistik tentang agen pengguna dan status permintaan.  Setiap jam dengan statistik tentang permintaan, grup status, dan agen.  Empat tabel pengukuran yang relevan. <br><br>  Hasilnya adalah model relasional berikut: <br><br><div class="spoiler">  <b class="spoiler_title">Model data</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ge/no/8t/geno8thwxmohdagflkzzurien-u.png" alt="gambar"><br></div></div><br>  Script untuk membuat objek dalam database sqlite: <br><br><div class="spoiler">  <b class="spoiler_title">Pembuatan objek DDL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> DIM_USER_AGENT; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> DIM_USER_AGENT ( DIM_USER_AGENT_ID <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> AUTOINCREMENT, USER_AGENT_NK <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'na'</span></span>, AGENT_OS <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'na'</span></span>, AGENT_ENGINE <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'na'</span></span>, AGENT_DEVICE <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'na'</span></span>, AGENT_BOT <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'na'</span></span>, UPDATE_DT <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> (USER_AGENT_NK) ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> DIM_USER_AGENT (DIM_USER_AGENT_ID) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>);</code> </pre> </div></div><br><h4>  Panggung </h4><br>  Dalam kasus file access.log, Anda perlu membaca, mem-parsing dan menulis semua permintaan ke database.  Ini dapat dilakukan baik secara langsung menggunakan bahasa scripting, atau menggunakan sqlite. <br><br>  Format file log: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//67.221.59.195 - - [28/Dec/2012:01:47:47 +0100] "GET /files/default.css HTTP/1.1" 200 1512 "https://project.edu/" "Mozilla/4.0" //host ident auth time method request_nk protocol status bytes ref browser $log_pattern = '/^([^ ]+) ([^ ]+) ([^ ]+) (\[[^\]]+\]) "(.*) (.*) (.*)" ([0-9\-]+) ([0-9\-]+) "(.*)" "(.*)"$/';</span></span></code> </pre><br><h4>  Propaganda Kunci </h4><br>  Saat data mentah ada di database, Anda perlu merekam kunci yang tidak ada di tabel pengukuran.  Maka akan mungkin untuk membangun referensi ke pengukuran.  Misalnya, dalam tabel DIM_REFERRER, kuncinya adalah kombinasi dari tiga bidang. <br><br><div class="spoiler">  <b class="spoiler_title">Permintaan perambatan kunci SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/* Propagate the referrer from access log */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> DIM_REFERRER (HOST_NK, PATH_NK, QUERY_NK, UPDATE_DT) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> CLS.HOST_NK, CLS.PATH_NK, CLS.QUERY_NK, STRFTIME(<span class="hljs-string"><span class="hljs-string">'%s'</span></span>,<span class="hljs-string"><span class="hljs-string">'now'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> UPDATE_DT <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> REFERRER_HOST <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> HOST_NK, REFERRER_PATH <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PATH_NK, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(REFERRER_QUERY,<span class="hljs-string"><span class="hljs-string">'&amp;sid'</span></span>)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(REFERRER_QUERY, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(REFERRER_QUERY,<span class="hljs-string"><span class="hljs-string">'&amp;sid'</span></span>)<span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-comment"><span class="hljs-comment">/*  sid -   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> REFERRER_QUERY <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> QUERY_NK <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> STG_ACCESS_LOG ) CLS <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> DIM_REFERRER TRG <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> (CLS.HOST_NK = TRG.HOST_NK <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> CLS.PATH_NK = TRG.PATH_NK <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> CLS.QUERY_NK = TRG.QUERY_NK) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TRG.DIM_REFERRER_ID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre> </div></div><br>  Propagasi ke tabel agen pengguna mungkin mengandung logika bot, misalnya, kutipan sql: <br><br><pre> <code class="sql hljs">CASE WHEN INSTR(LOWER(CLS.BROWSER),'yandex.com')&gt;0 THEN 'yandex' WHEN INSTR(LOWER(CLS.BROWSER),'googlebot')&gt;0 THEN 'google' WHEN INSTR(LOWER(CLS.BROWSER),'bingbot')&gt;0 THEN 'microsoft' WHEN INSTR(LOWER(CLS.BROWSER),'ahrefsbot')&gt;0 THEN 'ahrefs' WHEN INSTR(LOWER(CLS.BROWSER),'mj12bot')&gt;0 THEN 'majestic-12' WHEN INSTR(LOWER(CLS.BROWSER),'compatible')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'http')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'libwww')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'spider')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'java')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'python')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'robot')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'curl')&gt;0 OR INSTR(LOWER(CLS.BROWSER),'wget')&gt;0 THEN 'other' ELSE 'na' <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> AGENT_BOT</code> </pre> <br><h4>  Tabel Unit </h4><br>  Terakhir, kami akan memuat tabel agregat, misalnya, tabel harian dapat dimuat sebagai berikut: <br><br><div class="spoiler">  <b class="spoiler_title">Permintaan pemuatan agregat SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/* Load fact from access log */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> FCT_ACCESS_USER_AGENT_DD (EVENT_DT, DIM_USER_AGENT_ID, DIM_HTTP_STATUS_ID, PAGE_CNT, FILE_CNT, REQUEST_CNT, LINE_CNT, IP_CNT, <span class="hljs-keyword"><span class="hljs-keyword">BYTES</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> STG <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> STRFTIME( <span class="hljs-string"><span class="hljs-string">'%s'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(TIME_NK,<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>) || <span class="hljs-string"><span class="hljs-string">'-'</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(TIME_NK,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Jan'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'01'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Feb'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'02'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Mar'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'03'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Apr'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'04'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'May'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'05'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Jun'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'06'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Jul'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'07'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Aug'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'08'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Sep'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'09'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Oct'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'10'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'Nov'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'11'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'12'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> || <span class="hljs-string"><span class="hljs-string">'-'</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">SUBSTR</span></span>(TIME_NK,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) || <span class="hljs-string"><span class="hljs-string">' 00:00:00'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> EVENT_DT, BROWSER <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> USER_AGENT_NK, REQUEST_NK, IP_NR, <span class="hljs-keyword"><span class="hljs-keyword">STATUS</span></span>, LINE_NK, <span class="hljs-keyword"><span class="hljs-keyword">BYTES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> STG_ACCESS_LOG ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(STG.EVENT_DT <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> EVENT_DT, USG.DIM_USER_AGENT_ID, HST.DIM_HTTP_STATUS_ID, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(STG.REQUEST_NK,<span class="hljs-string"><span class="hljs-string">'.'</span></span>)=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> STG.REQUEST_NK <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> PAGE_CNT, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSTR</span></span>(STG.REQUEST_NK,<span class="hljs-string"><span class="hljs-string">'.'</span></span>)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> STG.REQUEST_NK <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> FILE_CNT, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> STG.REQUEST_NK) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> REQUEST_CNT, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> STG.LINE_NK) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> LINE_CNT, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> STG.IP_NR) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> IP_CNT, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">BYTES</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BYTES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> STG, DIM_HTTP_STATUS HST, DIM_USER_AGENT USG <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> STG.STATUS = HST.STATUS_NK <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> STG.USER_AGENT_NK = USG.USER_AGENT_NK <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(STG.EVENT_DT <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>) &gt; $param_epoch_from <span class="hljs-comment"><span class="hljs-comment">/* load epoch date */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>(STG.EVENT_DT <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>) &lt; strftime(<span class="hljs-string"><span class="hljs-string">'%s'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>(<span class="hljs-string"><span class="hljs-string">'now'</span></span>, <span class="hljs-string"><span class="hljs-string">'start of day'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> STG.EVENT_DT, HST.DIM_HTTP_STATUS_ID, USG.DIM_USER_AGENT_ID</code> </pre> </div></div><br>  Basis data sqlite memungkinkan Anda menulis kueri kompleks.  DENGAN berisi persiapan data dan kunci.  Kueri utama mengumpulkan semua referensi ke dimensi. <br><br>  Kondisi tidak akan mengizinkan memuat cerita lagi: CAST (STG.EVENT_DT AS INTEGER)&gt; $ param_epoch_from, di mana parameternya adalah hasil dari permintaan <br>  'SELECT COALESCE (MAX (EVENT_DT), \' 3600 \ ') SEBAGAI LAST_EVENT_EPOCH DARI FCT_ACCESS_USER_AGENT_DD' <br><br>  Kondisi hanya akan memuat sehari penuh: CAST (STG.EVENT_DT AS INTEGER) &lt;strftime ('% s', date ('now', 'start of day')) <br><br>  Menghitung halaman atau file dilakukan dengan cara primitif, dengan mencari titik. <br><br><h4>  Laporan </h4><br>  Dalam sistem visualisasi yang kompleks, dimungkinkan untuk membuat model-meta berdasarkan objek database, mengelola secara dinamis filter dan aturan agregasi.  Pada akhirnya, semua alat yang layak menghasilkan kueri SQL. <br><br>  Dalam contoh ini, kami akan membuat kueri SQL yang sudah jadi dan menyimpannya sebagai tampilan dalam database - ini adalah laporannya. <br><br><h4>  Visualisasi </h4><br>  Bluff: Grafik indah dalam JavaScript digunakan sebagai alat visualisasi. <br><br>  Untuk ini, perlu menggunakan PHP untuk memeriksa semua laporan dan menghasilkan file html dengan tabel. <br><br><pre> <code class="php hljs">$sqls = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_USER_VS_BOT'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_ANNOYING_BOT'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_TOP_HOUR_HIT'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_USER_ACTIVE'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_REQUEST_STATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_TOP_REQUEST_PAGE'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_TOP_REQUEST_REFERRER'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_NEW_REQUEST'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_TOP_REQUEST_SUCCESS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SELECT * FROM RPT_ACCESS_TOP_REQUEST_ERROR'</span></span> );</code> </pre> <br>  Alat ini hanya memvisualisasikan tabel hasil. <br><br><h4>  Kesimpulan </h4><br>  Menggunakan analisis web sebagai contoh, artikel tersebut menjelaskan mekanisme yang diperlukan untuk membangun gudang data.  Seperti dapat dilihat dari hasilnya, alat yang paling sederhana sudah cukup untuk analisis mendalam dan visualisasi data. <br><br>  Di masa depan, dengan menggunakan contoh penyimpanan ini, kami akan mencoba menerapkan struktur seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengubah pengukuran secara perlahan</a> , data master, tingkat agregasi, dan integrasi data dari sumber yang berbeda. <br><br>  Selain itu, kami akan melihat lebih dekat pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">alat manajemen proses ETL</a> paling sederhana berdasarkan satu tabel. <br><br>  Mari kita kembali ke topik pengukuran kualitas data dan mengotomatisasi proses ini. <br><br>  Kami akan mempelajari masalah lingkungan teknis dan pemeliharaan gudang data, di mana kami menerapkan server penyimpanan dengan sumber daya minimal, misalnya, berdasarkan Raspberry Pi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id462337/">https://habr.com/ru/post/id462337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id462327/index.html">Mencicit tumor kanker: para ilmuwan dari NUST "MISiS" telah mengembangkan USG laser untuk diagnosis kanker</a></li>
<li><a href="../id462329/index.html">Memindahkan catu daya ke bagian depan sasis</a></li>
<li><a href="../id462331/index.html">GAZ-66 mainan di panel kontrol. Bagian 2</a></li>
<li><a href="../id462333/index.html">Membuat chatbot percakapan sederhana dengan python</a></li>
<li><a href="../id462335/index.html">Jangan membaca, baca kembali</a></li>
<li><a href="../id462339/index.html">Bagaimana pelatihan genggam terkait dengan standar internal Amazon dan bagaimana pengaruhnya terhadap pandangan dunia perusahaan?</a></li>
<li><a href="../id462347/index.html">Sepuluh hari pertama dalam perjalanan dari burung hantu ke burung awal: tidur, diet, diet dan olahraga</a></li>
<li><a href="../id462349/index.html">RESTinio adalah server HTTP asinkron. Contoh sederhana dari praktik: mengembalikan sejumlah besar data sebagai respons</a></li>
<li><a href="../id462353/index.html">FAQ Keamanan Protokol LoRaWAN</a></li>
<li><a href="../id462355/index.html">Pemrograman JavaScript Asinkron (Panggilan Balik, Janji, RxJ)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>