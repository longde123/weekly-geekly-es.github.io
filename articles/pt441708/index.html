<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçà üòñ ü•© API do contrato do GT: zool√≥gico de servi√ßos üë©üèº‚ÄçüöÄ üëä üï¥üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Com o aumento do n√∫mero de componentes em um sistema de software, o n√∫mero de pessoas que participam do seu desenvolvimento geralmente tamb√©m aumenta....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API do contrato do GT: zool√≥gico de servi√ßos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wargaming/blog/441708/"><img src="https://habrastorage.org/webt/iz/gg/o8/izggo8dsjxgjso5tku-q65ezmwq.jpeg"><br><br>  Com o aumento do n√∫mero de componentes em um sistema de software, o n√∫mero de pessoas que participam do seu desenvolvimento geralmente tamb√©m aumenta.  Como resultado, para manter o ritmo de desenvolvimento e a facilidade de manuten√ß√£o, as abordagens para a organiza√ß√£o da API devem ser objeto de aten√ß√£o especial. <br><br>  Se voc√™ quiser ter uma vis√£o mais detalhada de como a equipe da Wargaming Platform lida com a complexidade de um sistema de mais de cem servi√ßos da web interagindo entre si, ent√£o seja bem-vindo ao gato. <br><a name="habracut"></a><br>  Ol√° pessoal!  Meu nome √© Valentine e sou engenheiro na plataforma da Wargaming.  Para quem n√£o sabe o que √© e o que √© a plataforma, deixarei aqui um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link</a> para a recente publica√ß√£o de um de meus colegas - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">max_posedon</a> <br><br>  No momento, trabalho na empresa h√° mais de cinco anos e encontrei parcialmente o per√≠odo de crescimento ativo do World of Tanks.  Para descobrir as quest√µes levantadas neste artigo, preciso come√ßar com uma breve digress√£o sobre a hist√≥ria da Wargaming Platform. <br><br><h2>  Um pouco de hist√≥ria </h2><br>  A crescente popularidade dos "tanques" acabou parecendo uma avalanche e, como √© geralmente o caso nesses casos, a infraestrutura em torno do jogo come√ßou a se desenvolver rapidamente.  Como resultado, o jogo rapidamente superou v√°rios servi√ßos da Web e, no momento em que entrei para a equipe, a pontua√ß√£o deles j√° estava em dezenas (agora, a prop√≥sito, mais de 100 componentes da plataforma funcionam e beneficiam a empresa). <br><br>  Com o passar do tempo, novos jogos foram lan√ßados e o entendimento dos meandros das integra√ß√µes entre os servi√ßos da web n√£o era mais f√°cil.  A situa√ß√£o s√≥ piorou quando equipes de outros escrit√≥rios da Wargaming ingressaram no desenvolvimento da plataforma.  O desenvolvimento foi distribu√≠do, com todas as consequ√™ncias na forma de dist√¢ncia, fuso hor√°rio e barreira do idioma.  E h√° mais servi√ßos.  Encontrar uma pessoa que entenda como a plataforma como um todo funciona n√£o √© t√£o f√°cil.  As informa√ß√µes frequentemente precisavam ser coletadas em partes de diferentes fontes. <br><br>  As interfaces de v√°rios servi√ßos da web podem diferir bastante no desempenho estil√≠stico, o que dificulta o processo de integra√ß√£o com a plataforma.  E as depend√™ncias diretas entre componentes reduziram a flexibilidade do desenvolvimento, complicando a decomposi√ß√£o da funcionalidade na plataforma.  Para piorar a situa√ß√£o, os jogos - clientes da plataforma - conheciam bem nossa topologia, pois precisavam se integrar diretamente a cada servi√ßo da plataforma.  Isso lhes deu a oportunidade, usando conex√µes horizontais, de fazer lobby para a implementa√ß√£o de certas melhorias diretamente no componente ao qual est√£o integradas.  Isso levou ao aparecimento de funcionalidades duplicadas em v√°rios componentes da plataforma, bem como √† incapacidade de estender a funcionalidade existente para outros jogos.  Tornou-se √≥bvio que continuar construindo uma plataforma em torno de cada jogo espec√≠fico √© um ramo sem sa√≠da do desenvolvimento.  Precis√°vamos de mudan√ßas t√©cnicas e organizacionais, como resultado das quais poder√≠amos controlar a complexidade crescente de um sistema em r√°pido crescimento e tornar toda a funcionalidade da plataforma adequada para uso em qualquer jogo. <br><br>  Sobre isso, quero terminar a excurs√£o hist√≥rica e, finalmente, falar sobre uma de nossas solu√ß√µes t√©cnicas, que ajuda a manter sob controle a complexidade causada pelo n√∫mero cada vez maior de servi√ßos.  Al√©m disso, reduz o custo de desenvolvimento de novas funcionalidades e simplifica bastante a integra√ß√£o com a plataforma. <br><br><h2>  Conhe√ßa a API do contrato </h2><br>  Dentro da plataforma, chamamos de API do contrato.  Na sua ess√™ncia, √© uma estrutura de integra√ß√£o representada por um conjunto de bibliotecas de documenta√ß√£o e cliente para cada tecnologia de nossa pilha (Erlang / Elixir, Java / Scala, Python).  Ele est√° sendo desenvolvido, em primeiro lugar, para simplificar a integra√ß√£o dos componentes da plataforma.  Segundo, para nos ajudar a resolver v√°rios dos seguintes problemas: <br><br><ul><li>  diferen√ßas estil√≠sticas das interfaces do programa </li><li>  a presen√ßa de depend√™ncias diretas entre componentes </li><li>  manter a documenta√ß√£o atualizada </li><li>  funcionalidade de introspec√ß√£o e depura√ß√£o de ponta a ponta </li></ul><br>  Ent√£o, as primeiras coisas primeiro. <br><br><h2>  Diferen√ßas estil√≠sticas nas interfaces de software </h2><br>  Na minha opini√£o, esse problema surgiu como resultado de uma combina√ß√£o de v√°rios fatores: <br><br><ul><li>  <b>Falta de um padr√£o estrito de como deve ser a API.</b>  O conjunto de recomenda√ß√µes geralmente n√£o tem o efeito desejado, a API ainda √© diferente.  Especialmente se o desenvolvimento for realizado por equipes de diferentes escrit√≥rios da empresa.  Cada equipe tem seus pr√≥prios h√°bitos e pr√°ticas.  Coletivamente, essas APIs geralmente n√£o se parecem com partes de um todo. </li><li>  <b>Falta de um √∫nico diret√≥rio com os nomes e formatos de entidades espec√≠ficas da empresa.</b>  Como regra, voc√™ n√£o pode obter uma entidade do resultado de uma API e pass√°-la para a API de outro servi√ßo.  Isso requer transforma√ß√£o. </li><li>  <b>Falta de um sistema de revis√£o centralizada obrigat√≥rio para a API.</b>  Sempre h√° prazos e n√£o h√° tempo para coletar atualiza√ß√µes e, al√©m disso, fazer altera√ß√µes na API, que na verdade geralmente acabam sendo testadas pela metade. </li></ul><br>  A primeira coisa que fizemos ao projetar a API do contrato foi dizer que a partir de agora a API pertence √† plataforma, e n√£o a um √∫nico componente.  Isso levou ao fato de que o desenvolvimento de novas funcionalidades come√ßa com uma solicita√ß√£o de recebimento para uma API de armazenamento centralizado.  Atualmente, usamos o reposit√≥rio GIT como armazenamento.  Por conveni√™ncia, dividimos toda a API em fun√ß√µes comerciais separadas, formalizamos a estrutura dessa fun√ß√£o e a denominamos Contrato. <br><br>  Desde ent√£o, cada nova fun√ß√£o comercial em nossa API de contrato deve ser descrita em um formato especial e passar pela solicita√ß√£o de recebimento com uma revis√£o obrigat√≥ria.  N√£o h√° outra maneira de publicar uma nova API na API do contrato.  No mesmo reposit√≥rio, definimos um diret√≥rio de entidades espec√≠ficas do neg√≥cio e sugerimos que os desenvolvedores do contrato os reutilizassem em vez de descrever essas entidades. <br><br>  Portanto, obtivemos uma API de plataforma conceitualmente integrada que parecia um √∫nico produto, apesar de ter sido realmente implementada em muitos componentes da plataforma usando v√°rias pilhas tecnol√≥gicas. <br><br><h2>  A presen√ßa de depend√™ncias diretas entre componentes </h2><br>  Esse nosso problema se manifestou no fato de que cada componente da plataforma precisava saber quem atende especificamente a funcionalidade de que precisa. <br><br>  E n√£o foi nem a dificuldade de manter esse diret√≥rio atualizado, mas o fato de as depend√™ncias diretas complicarem significativamente a migra√ß√£o da funcionalidade de neg√≥cios de um componente da plataforma para outro.  O problema foi especialmente grave quando come√ßamos a decomposi√ß√£o de nossos mon√≥litos em componentes menores.  Verificou-se que convencer o cliente a substituir a integra√ß√£o de trabalho por qualquer funcionalidade com a mesma do ponto de vista comercial, mas outra do ponto de vista t√©cnico, n√£o √© uma tarefa de gerenciamento trivial.  O cliente simplesmente n√£o entende o ponto, j√° que tudo funciona bem para ele.  Como resultado, foram criadas camadas de mau cheiro de compatibilidade com vers√µes anteriores que apenas complicaram o suporte da plataforma e tiveram um efeito ruim na qualidade do servi√ßo.  E como j√° est√°vamos padronizando a API da plataforma, foi necess√°rio resolver simultaneamente esse problema. <br><br>  Enfrentamos uma escolha de v√°rias op√ß√µes.  Destes, consideramos especialmente com cuidado: <br><br><ul><li>  Implementa√ß√£o de protocolos de <i>descoberta</i> de <i>servi√ßo</i> em cada um dos componentes. </li><li>  Usando um mediador para redirecionar solicita√ß√µes do cliente para o componente de plataforma correto. </li><li>  Usando um <i>intermedi√°rio de mensagens</i> como um barramento de mensagens. </li></ul><br>  Como resultado de alguns pensamentos e experi√™ncias, a escolha recaiu sobre o intermedi√°rio de mensagens, apesar do fato de ele nos ver como um poss√≠vel ponto √∫nico de falha e aumentar a sobrecarga de opera√ß√£o da plataforma.  Um papel importante na sele√ß√£o foi desempenhado pelo fato de a plataforma naquele momento j√° possuir experi√™ncia em trabalhar com o RabbitMQ.  E o pr√≥prio corretor foi bem dimensionado e tinha mecanismos internos para garantir a toler√¢ncia a falhas.  Como b√¥nus, tivemos a oportunidade de implementar uma <i>arquitetura orientada a eventos</i> ( <i>arquitetura orientada a eventos</i> ou <i>EDA</i> ) "sob o cap√¥".  O que posteriormente abriu diante de n√≥s possibilidades mais amplas de intera√ß√£o entre servi√ßos, em compara√ß√£o com a intera√ß√£o ponto a ponto. <br><br>  Ent√£o, topologicamente, a plataforma come√ßou a se transformar de um gr√°fico com conectividade aleat√≥ria em uma estrela.  E os componentes da plataforma inverteram suas depend√™ncias e tiveram a oportunidade de interagir entre si exclusivamente por meio de contratos registrados em um reposit√≥rio centralizado, sem a necessidade de saber quem implementa especificamente um contrato espec√≠fico.  Em outras palavras, todos os componentes da plataforma puderam interagir entre si usando um √∫nico ponto de integra√ß√£o, o que simplificou bastante a vida dos desenvolvedores. <br><br><h2>  Mantendo a documenta√ß√£o atualizada </h2><br>  Os problemas associados √† falta de documenta√ß√£o ou √† perda de sua relev√¢ncia s√£o quase sempre encontrados.  E quanto maior o ritmo de desenvolvimento, mais frequentemente ele se manifesta.  Depois disso, coletar todas as especifica√ß√µes da API em um √∫nico local e formato para mais de cem servi√ßos em uma equipe distribu√≠da e multinacional √© uma tarefa dif√≠cil. <br><br>  Ao desenvolver a API do contrato, estabelecemos o objetivo de resolver esse problema tamb√©m.  E n√≥s fizemos isso.  Um formato estritamente definido para a descri√ß√£o do contrato nos permitiu construir um processo de acordo com o qual, imediatamente ap√≥s o surgimento de um novo contrato, a montagem autom√°tica da documenta√ß√£o √© iniciada.  Isso nos d√° confian√ßa de que nossa documenta√ß√£o da API est√° sempre atualizada.  Esse processo √© totalmente automatizado e n√£o requer esfor√ßo de desenvolvimento ou gerenciamento. <br><br><h2>  Funcionalidade de ponta a ponta para introspec√ß√£o e depura√ß√£o </h2><br>  √Ä medida que dividimos nossos mon√≥litos em componentes menores, naturalmente, come√ßaram a surgir dificuldades na depura√ß√£o da funcionalidade de ponta a ponta.  Se o servi√ßo de uma fun√ß√£o de neg√≥cios foi distribu√≠do por v√°rios componentes da plataforma, muitas vezes para localizar e depurar o problema, era preciso procurar representantes de cada um dos componentes.  O que √†s vezes era poss√≠vel com dificuldade, dada a diferen√ßa de 11 horas com alguns de nossos colegas. <br><br>  Com o advento da API Contract, e em particular gra√ßas ao intermedi√°rio de mensagens subjacente, conseguimos receber c√≥pias das mensagens envolvidas na execu√ß√£o de uma fun√ß√£o comercial, sem efeitos colaterais nos participantes da intera√ß√£o.  Para isso, nem √© necess√°rio saber qual dos componentes da plataforma √© respons√°vel pelo processamento de um contrato espec√≠fico.  E ap√≥s a localiza√ß√£o do problema, podemos obter o identificador do componente quebrado a partir dos metadados da mensagem do problema. <br><br><h2>  O que mais desenvolvemos no topo da API do contrato </h2><br>  Al√©m de seu principal objetivo e solucionar os problemas acima, a API do Contrato nos permitiu implementar uma s√©rie de servi√ßos √∫teis. <br><br><h3>  Gateway para acessar a funcionalidade da plataforma </h3><br>  A padroniza√ß√£o da API na forma de contratos nos permitiu desenvolver um √∫nico ponto de acesso √† funcionalidade da plataforma via HTTP.  Al√©m disso, com o advento de novas funcionalidades (contratos), n√£o precisamos modificar esse ponto de acesso de forma alguma.  √â compat√≠vel com todos os contratos futuros.  Isso permite que voc√™ trabalhe com a plataforma como um √∫nico produto usando a interface HTTP usual. <br><br><h3>  Servi√ßo de Opera√ß√µes em Massa </h3><br>  Qualquer contrato pode ser lan√ßado como parte de uma opera√ß√£o em massa, com a capacidade de rastrear seu status e, em seguida, receber um relat√≥rio sobre os resultados dessa opera√ß√£o.  Este servi√ßo, assim como o anterior, √© compat√≠vel com todos os contratos futuros com anteced√™ncia. <br><br><h3>  Manipula√ß√£o de erro de plataforma unificada </h3><br>  O protocolo da API do contrato tamb√©m padroniza os erros.  Isso nos permitiu implementar um interceptador de erros, que analisa sua gravidade e notifica o sistema de monitoramento sobre poss√≠veis problemas nos componentes da plataforma.  E, no futuro, ele poder√° decidir independentemente sobre a descoberta de um bug no componente da plataforma.  O interceptador de erros os captura diretamente do intermedi√°rio de mensagens e n√£o sabe nada sobre a finalidade de um contrato ou erro, agindo apenas com base em meta-informa√ß√µes.  Isso permite que ele, assim como todos os servi√ßos descritos nesta se√ß√£o, seja compat√≠vel com todos os contratos futuros. <br><br><h3>  Gerar automaticamente interfaces de usu√°rio </h3><br>  Contratos estritamente formalizados permitem a cria√ß√£o autom√°tica de componentes da interface do usu√°rio.  Desenvolvemos um servi√ßo que permite gerar uma interface administrativa com base em uma cole√ß√£o de contratos e incorpor√°-la a qualquer uma das ferramentas da plataforma.  Assim, os administradores que escrevemos anteriormente com nossas m√£os agora podem ser gerados (embora apenas parcialmente at√© agora) no modo autom√°tico. <br><br><h3>  Log de plataforma </h3><br>  Este componente ainda n√£o foi implementado e est√° em desenvolvimento.  Por√©m, no futuro, permitir√° "on the fly" ativar e desativar o registro de qualquer fun√ß√£o comercial na plataforma, extraindo essas informa√ß√µes diretamente do intermedi√°rio de mensagens, sem efeitos colaterais que afetem adversamente os componentes em intera√ß√£o. <br><br><h2>  O principal objetivo da API do contrato </h2><br>  Mas, ainda assim, o principal objetivo da API do contrato √© reduzir o custo da integra√ß√£o de componentes da plataforma. <br><br>  Os desenvolvedores s√£o abstra√≠dos do n√≠vel de transporte pelas bibliotecas que desenvolvemos para cada uma de nossas pilhas de tecnologia.  Isso nos d√° algum espa√ßo de manobra, caso tenhamos que mudar o intermedi√°rio de mensagens ou at√© mudar para a intera√ß√£o ponto a ponto.  A interface externa da biblioteca permanecer√° inalterada. <br><br>  A biblioteca sob o cap√¥ gera uma mensagem de acordo com certas regras e a envia ao broker, ap√≥s o que, ap√≥s aguardar uma mensagem de resposta, retorna o resultado ao desenvolvedor.  Fora, parece uma solicita√ß√£o s√≠ncrona regular (ou ass√≠ncrona, dependente da implementa√ß√£o).  Como demonstra√ß√£o, darei alguns exemplos. <br><br>  Exemplo de chamada de contrato em Python <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> platform_client <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Client client = Client(contracts_path=CONTRACTS_PATH, url=AMQP_URL, app_id=<span class="hljs-string"><span class="hljs-string">'client'</span></span>) client.call(<span class="hljs-string"><span class="hljs-string">"ban-management.create-ban.v1"</span></span>, { <span class="hljs-string"><span class="hljs-string">"wgid"</span></span>: <span class="hljs-number"><span class="hljs-number">1234567890</span></span>, <span class="hljs-string"><span class="hljs-string">"reason"</span></span>: <span class="hljs-string"><span class="hljs-string">"Fraudulent activity"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru.wot"</span></span>, <span class="hljs-string"><span class="hljs-string">"component"</span></span>: <span class="hljs-string"><span class="hljs-string">"game"</span></span>, <span class="hljs-string"><span class="hljs-string">"bantype"</span></span>: <span class="hljs-string"><span class="hljs-string">"access_denied"</span></span>, <span class="hljs-string"><span class="hljs-string">"author_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"v_nikonovich"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span>: <span class="hljs-string"><span class="hljs-string">"2038-01-19 03:14:07Z"</span></span> }) { <span class="hljs-string"><span class="hljs-string">u'ban_id'</span></span>: <span class="hljs-number"><span class="hljs-number">31415926</span></span>, <span class="hljs-string"><span class="hljs-string">u'wgid'</span></span>: <span class="hljs-number"><span class="hljs-number">1234567890</span></span>, <span class="hljs-string"><span class="hljs-string">u'title'</span></span>: <span class="hljs-string"><span class="hljs-string">u'ru.wot'</span></span>, <span class="hljs-string"><span class="hljs-string">u'component'</span></span>: <span class="hljs-string"><span class="hljs-string">u'game'</span></span>, <span class="hljs-string"><span class="hljs-string">u'reason'</span></span>: <span class="hljs-string"><span class="hljs-string">u'Fraudulent activity'</span></span>, <span class="hljs-string"><span class="hljs-string">u'bantype'</span></span>: <span class="hljs-string"><span class="hljs-string">u'access_denied'</span></span>, <span class="hljs-string"><span class="hljs-string">u'status'</span></span>: <span class="hljs-string"><span class="hljs-string">u"active"</span></span>, <span class="hljs-string"><span class="hljs-string">u'started_at'</span></span>: <span class="hljs-string"><span class="hljs-string">u"2019-02-15T15:15:15Z"</span></span>, <span class="hljs-string"><span class="hljs-string">u'expires_at'</span></span>: <span class="hljs-string"><span class="hljs-string">u"2038-01-19 03:14:07Z"</span></span> }</code> </pre> <br>  A mesma chamada de contrato, mas usando o Elixir <br><pre> <code class="plaintext hljs">:platform_client.call("ban-management.create-ban.v1", %{ "wgid" =&gt; 1234567890, "reason" =&gt; "Fraudulent activity", "title" =&gt; "ru.wot", "component" =&gt; "game", "bantype" =&gt; "access_denied", "author_id" =&gt; "v_nikonovich", "expires_at" =&gt; "2038-01-19 03:14:07Z" }) {:ok, %{ "ban_id" =&gt; 31415926, "wgid" =&gt; 1234567890, "title" =&gt; "ru.wot", "conponent" =&gt; "game", "reason" =&gt; "Fraudulent activity", "bantype" =&gt; "access_denied", "status" =&gt; "active", "started_at" =&gt; "2019-02-15T15:15:15Z", "expires_at" =&gt; "2038-01-19 03:14:07Z" }}</code> </pre><br>  No lugar do contrato "ban-management.create-ban.v1", pode haver qualquer outra funcionalidade da plataforma, por exemplo: "account-management.rename-account.v1" ou "notification-center.create-sms-notification.v1".  E tudo isso estar√° dispon√≠vel atrav√©s desse √∫nico ponto de integra√ß√£o com a plataforma. <br><br>  A vis√£o geral ficar√° incompleta se voc√™ n√£o demonstrar a API do contrato do ponto de vista do desenvolvedor do servidor.  Considere uma situa√ß√£o em que um desenvolvedor precisa implementar um manipulador para o mesmo contrato ban-management.create-ban.v1. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> platform_server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BlockingServer, handler <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomServer</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BlockingServer)</span></span></span><span class="hljs-class">:</span></span> @handler(<span class="hljs-string"><span class="hljs-string">'ban-management.create-ban.v1'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_create_ban</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, params, context)</span></span></span><span class="hljs-function">:</span></span> response = do_some_usefull_job(params) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response d = CustomServer(app_id=<span class="hljs-string"><span class="hljs-string">"server"</span></span>, amqp_url=AMQP_URL, contracts_path=CONTRACTS_PATH) d.serve()</code> </pre><br>  Esse c√≥digo ser√° suficiente para come√ßar a atender a um determinado contrato.  A biblioteca do servidor descompactar√° e verificar√° se os par√¢metros de solicita√ß√£o est√£o corretos e depois chamar√° o manipulador de contratos com os par√¢metros de solicita√ß√£o prontos para processamento.  Portanto, o desenvolvedor do servidor √© protegido por uma biblioteca que, no caso de receber par√¢metros de solicita√ß√£o incorretos, envia um erro de valida√ß√£o ao cliente e registra o fato de um problema. <br><br>  Devido ao fato de que, sob o cap√¥, a API do contrato √© implementada com base em eventos, temos a oportunidade de ir al√©m do escopo do script Solicita√ß√£o / Resposta e implementar uma ampla variedade de intera√ß√µes entre servi√ßos. <br><br>  Por exemplo: <br><br><ul><li>  fa√ßa um pedido e esque√ßa (sem esperar por uma resposta) </li><li>  fa√ßa solicita√ß√µes para v√°rios contratos simultaneamente (mesmo sem usar um loop de eventos) </li><li>  fa√ßa uma solicita√ß√£o e receba respostas de v√°rios manipuladores de uma s√≥ vez (se fornecidos pelo script de integra√ß√£o) </li><li>  registrar um manipulador de resposta (acionado se o manipulador de contrato relatou a conclus√£o, aceita o resultado do trabalho do manipulador de contrato, ou seja, sua resposta) </li></ul><br>  E essa n√£o √© uma lista completa de cen√°rios que podem ser expressos por meio de um modelo de intera√ß√£o de eventos.  Esta √© uma lista daqueles que estamos usando atualmente. <br><br><h2>  Em vez de uma conclus√£o </h2><br>  Estamos usando a API do contrato h√° v√°rios anos.  Portanto, n√£o √© poss√≠vel falar sobre todos os cen√°rios de seu uso na estrutura de um artigo de revis√£o.  Pelo mesmo motivo, n√£o sobrecarreguei o artigo com detalhes t√©cnicos.  Ela j√° ficou bastante volumosa.  Fa√ßa perguntas e tentarei respond√™-las diretamente nos coment√°rios.  Se um t√≥pico for particularmente interessante, ser√° poss√≠vel divulg√°-lo com mais detalhes em um artigo separado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441708/">https://habr.com/ru/post/pt441708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441698/index.html">Desconectar: ‚Äã‚Äão que acontece quando voc√™ sai do Facebook?</a></li>
<li><a href="../pt441700/index.html">Como um quebra-cabe√ßa infantil ajuda a revelar os segredos do magnetismo</a></li>
<li><a href="../pt441702/index.html">Sobre o armazenamento de dados pessoais, Roskomnadzor e sites de namoro</a></li>
<li><a href="../pt441704/index.html">Por que voc√™ n√£o deve esperar pelas manifesta√ß√µes morais dos robomobiles</a></li>
<li><a href="../pt441706/index.html">Como uma d√∫zia de empresas l√≠deres est√£o tentando criar um lidar poderoso e barato</a></li>
<li><a href="../pt441710/index.html">Os jogos para celular do navegador desafiam voc√™</a></li>
<li><a href="../pt441712/index.html">Solu√ß√£o matem√°tica para problemas de relatividade</a></li>
<li><a href="../pt441714/index.html">Como as locomotivas a vapor foram organizadas</a></li>
<li><a href="../pt441716/index.html">Programa√ß√£o para n√£o programadores. Biografia de junho</a></li>
<li><a href="../pt441718/index.html">Security Week 09: vulnerabilidade de 19 anos no WinRAR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>