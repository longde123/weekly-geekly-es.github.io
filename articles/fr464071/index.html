<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèº üêî üèÇüèΩ R√©volution ou douleur? Rapport Yandex React Hooks ‚ûï üé∑ ü•£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je m'appelle Artyom Berezin, je suis d√©veloppeur de plusieurs services internes Yandex. Depuis six mois, je travaille activement avec React Hooks. Ce ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©volution ou douleur? Rapport Yandex React Hooks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/464071/"> Je m'appelle Artyom Berezin, je suis d√©veloppeur de plusieurs services internes Yandex.  Depuis six mois, je travaille activement avec React Hooks.  Ce faisant, il y a eu des difficult√©s √† surmonter.  Maintenant, je veux partager cette exp√©rience avec vous.  Dans le rapport, j'ai examin√© l'API React Hook d'un point de vue pratique - pourquoi avons-nous besoin de hooks, vaut-il la peine de changer, ce qui est pr√©f√©rable de prendre en compte lors du portage.  Il est facile de faire des erreurs pendant la transition, mais les √©viter n'est pas non plus si difficile. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/xm/xa/7n/xmxa7ngpjx3l902ndjcetpyhsp0.jpeg"></a> <br><br>  - Les crochets ne sont qu'une autre fa√ßon de d√©crire la logique de vos composants.  Il vous permet d'ajouter aux composants fonctionnels des fonctionnalit√©s qui n'√©taient auparavant inh√©rentes qu'aux composants des classes. <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/hd/r8/4b/hdr84b-fmfibqz-gwcb0k8feny8.jpeg"><br><br>  Tout d'abord, c'est le soutien de l'√©tat interne, puis - le soutien des effets secondaires.  Par exemple - demandes de r√©seau ou demandes √† WebSocket: abonnement, d√©sabonnement de certains canaux.  Ou, peut-√™tre, nous parlons de demandes √† d'autres API de navigateur asynchrones ou synchrones.  De plus, les crochets nous donnent acc√®s au cycle de vie du composant, √† son d√©but de vie, c'est-√†-dire au montage, √† la mise √† jour de ses accessoires et √† sa mort. <br><br><img src="https://habrastorage.org/webt/9d/f4/lk/9df4lk5afueo28ftgmebxggxuw0.jpeg"><br><br>  Probablement la fa√ßon la plus simple d'illustrer en comparaison.  Voici le code le plus simple qui ne peut √™tre qu'avec un composant dans les classes.  Le composant change quelque chose.  Il s'agit d'un compteur r√©gulier qui peut √™tre augment√© ou diminu√©, un seul champ en √©tat.  En g√©n√©ral, je pense que si vous √™tes familier avec React, le code est compl√®tement √©vident pour vous. <br><br><img src="https://habrastorage.org/webt/iy/ms/2_/iyms2_hexuxc_nx5cnxwux8crva.jpeg"><br><br>  Un composant similaire qui remplit exactement la m√™me fonction, mais √©crit dans des crochets, semble beaucoup plus compact.  Selon mes calculs, en moyenne, lors du portage de composants sur des classes vers des composants sur des crochets, le code diminue environ une fois et demie, et cela pla√Æt. <br><br>  Quelques mots sur le fonctionnement des crochets.  Un hook est une fonction globale d√©clar√©e dans React et appel√©e √† chaque fois qu'un composant est rendu.  React suit les appels √† ces fonctions et peut changer son comportement ou d√©cider ce qu'il doit retourner. <br><br><img src="https://habrastorage.org/webt/yy/wy/xf/yywyxfylah95eiqs8saijtqbf-a.jpeg"><br><br>  Il existe certaines restrictions sur l'utilisation des crochets qui les distinguent des fonctions ordinaires.  Tout d'abord, ils ne peuvent pas √™tre utilis√©s dans des composants sur des classes, une telle restriction s'applique simplement car ils ne sont pas cr√©√©s pour eux, mais pour des composants fonctionnels.  Les crochets ne peuvent pas √™tre appel√©s √† l'int√©rieur de fonctions internes, √† l'int√©rieur de boucles, de conditions.  Uniquement au premier niveau d'imbrication, √† l'int√©rieur des fonctions du composant.  Cette restriction est impos√©e par React lui-m√™me afin de pouvoir suivre les hooks appel√©s.  Et il les empile dans un certain ordre dans son cerveau.  Ensuite, si cet ordre change soudainement ou si certains disparaissent, des erreurs complexes, insaisissables, difficiles √† d√©boguer sont possibles. <br><br>  Mais si vous avez une logique assez compliqu√©e et que vous souhaitez utiliser, par exemple, des crochets √† l'int√©rieur des crochets, alors c'est tr√®s probablement un signe que vous devez faire un crochet.  Supposons que vous √©tablissiez plusieurs crochets connect√©s les uns aux autres dans un crochet personnalis√© s√©par√©.  Et √† l'int√©rieur, vous pouvez utiliser d'autres crochets personnalis√©s, cr√©ant ainsi une hi√©rarchie de crochets, mettant en √©vidence la logique g√©n√©rale. <br><br><img src="https://habrastorage.org/webt/wr/av/h_/wravh_lbocryqocrjlnwqs8rrr4.jpeg"><br><br>  Les crochets offrent certains avantages par rapport aux cours.  Tout d'abord, comme suit du pr√©c√©dent, en utilisant des crochets personnalis√©s, vous pouvez t√¢tonner beaucoup plus facilement la logique.  Auparavant, en utilisant l'approche avec des composants d'ordre sup√©rieur, nous avons pr√©sent√© une sorte de logique partag√©e, et c'√©tait un wrapper sur le composant.  Maintenant, nous mettons cette logique √† l'int√©rieur des crochets.  Ainsi, l'arborescence des composants est r√©duite: son imbrication est r√©duite et il devient plus facile pour React de suivre les modifications des composants, de recalculer l'arborescence, de recalculer le DOM virtuel, etc. Cela r√©sout le probl√®me de ce que l'on appelle l'enveloppeur-enfer.  Ceux qui travaillent avec Redux, je pense, le savent. <br><br>  Le code √©crit √† l'aide de crochets est beaucoup plus facile √† minimiser avec des minimiseurs modernes comme Terser ou UglifyJS ancien.  Le fait est que nous n'avons pas besoin de sauvegarder les noms des m√©thodes, nous n'avons pas besoin de penser aux prototypes.  Apr√®s la transpilation, si la cible est ES3 ou ES5, nous obtenons g√©n√©ralement un tas de prototypes qui corrigent.  Ici, tout cela n'a pas besoin d'√™tre fait, il est donc plus facile de le minimiser.  Et, comme nous n'utilisons pas de classes, nous n'avons pas besoin d'y penser.  Pour les d√©butants, c'est souvent un gros probl√®me et, probablement, l'une des principales raisons des bugs: nous oublions que cela peut √™tre une fen√™tre, que nous devons lier une m√©thode, par exemple, dans le constructeur ou d'une autre mani√®re. <br><br>  De plus, l'utilisation de crochets vous permet de mettre en √©vidence la logique qui contr√¥le tout effet secondaire.  Auparavant, cette logique, en particulier lorsque nous avions plusieurs effets secondaires pour un composant, devait √™tre divis√©e en diff√©rentes m√©thodes du cycle de vie du composant.  Et, depuis l'apparition des crochets de minimisation, React.memo est apparu, maintenant les composants fonctionnels se pr√™tent √† la m√©morisation, c'est-√†-dire que ce composant ne sera pas recr√©√© ou mis √† jour avec nous si ses accessoires n'ont pas chang√©.  Cela ne pouvait pas √™tre fait avant, maintenant c'est possible.  Tous les composants fonctionnels peuvent √™tre envelopp√©s dans un m√©mo.  √âgalement √† l'int√©rieur du crochet useMemo est apparu, que nous pouvons utiliser pour calculer certaines valeurs lourdes, ou instancier certaines classes utilitaires une seule fois. <br><br>  Le rapport sera incomplet si je ne parle pas de quelques crochets de base.  Tout d'abord, ce sont des crochets de gestion d'√©tat. <br><br><img src="https://habrastorage.org/webt/ud/wg/vl/udwgvlovxonthzvnknxeewerxea.jpeg"><br><br>  Tout d'abord - useState. <br><br><img src="https://habrastorage.org/webt/0c/xb/pk/0cxbpky3iayxkvaxutbik_ohbcw.jpeg"><br><br>  Un exemple est similaire √† celui du d√©but du rapport.  useState est une fonction qui prend une valeur initiale et renvoie un tuple √† partir de la valeur actuelle et de la fonction pour modifier cette valeur.  Toute magie est servie par React en interne.  Nous pouvons simplement lire cette valeur ou la modifier. <br><br>  Contrairement aux classes, nous pouvons utiliser autant d'objets d'√©tat que n√©cessaire, divise l'√©tat en √©l√©ments logiques afin de ne pas les m√©langer dans un seul objet, comme dans les classes.  Et ces pi√®ces seront compl√®tement isol√©es les unes des autres: elles peuvent √™tre chang√©es ind√©pendamment les unes des autres.  Le r√©sultat, par exemple, de ce code: on change deux variables, on calcule le r√©sultat et on affiche les boutons qui nous permettent de changer la premi√®re variable ici et l√†, et la deuxi√®me variable ici et l√†.  Rappelez-vous cet exemple, car plus tard, nous ferons une chose similaire, mais beaucoup plus compliqu√©e. <br><br><img src="https://habrastorage.org/webt/qh/cb/7r/qhcb7rezzu2hu5ymyqw8nw1bl9e.jpeg"><br><br>  Il existe un tel useState sur les st√©ro√Ødes pour les amateurs de Redux.  Il vous permet de changer l'√©tat de mani√®re plus coh√©rente √† l'aide d'un r√©ducteur.  Je pense que ceux qui connaissent Redux ne peuvent m√™me pas expliquer, pour ceux qui ne sont pas familiers, je vais le dire. <br><br>  Un r√©ducteur est une fonction qui accepte un √©tat et un objet, g√©n√©ralement appel√© action, qui d√©crit comment cet √©tat doit changer.  Plus pr√©cis√©ment, il passe certains param√®tres, et √† l'int√©rieur du r√©ducteur, il d√©cide d√©j√†, en fonction de leurs param√®tres, de la fa√ßon dont l'√©tat va changer, et par cons√©quent, un nouvel √©tat doit √™tre renvoy√©, mis √† jour. <br><br><img src="https://habrastorage.org/webt/k6/5x/gd/k65xgdpidy6wnhmuxabw3sqqtk0.jpeg"><br><br>  De cette fa√ßon, il est utilis√© dans le code du composant.  Nous avons un crochet useReducer, il prend une fonction de r√©ducteur, et le deuxi√®me param√®tre est la valeur initiale de l'√©tat.  Renvoie, comme useState, l'√©tat actuel et la fonction pour le modifier est dispatch.  Si vous transmettez un objet action √† envoyer, nous invoquerons un changement d'√©tat. <br><br><img src="https://habrastorage.org/webt/un/sl/ng/unslngsedmksssjrthxjmzhn7bu.jpeg"><br><br>  Utilisation tr√®s importante Crochet effet.  Il vous permet d'ajouter des effets secondaires au composant, offrant une alternative au cycle de vie.  Dans cet exemple, nous utilisons une m√©thode simple avec useEffect: il s'agit simplement de demander des donn√©es au serveur, avec l'API, par exemple, et d'afficher ces donn√©es sur la page. <br><br><img src="https://habrastorage.org/webt/bb/tc/gf/bbtcgfyw89tgu_jarnwwaagxmnq.jpeg"><br><br>  UseEffect a un mode avanc√©, c'est lorsque la fonction pass√©e √† useEffect renvoie une autre fonction, alors cette fonction sera appel√©e dans le cycle suivant, lorsque cet useEffect sera appliqu√©. <br><br>  J'ai oubli√© de mentionner, useEffect est appel√© de mani√®re asynchrone, juste apr√®s que le changement soit appliqu√© au DOM.  Autrement dit, il garantit qu'il sera ex√©cut√© apr√®s le rendu du composant et peut conduire au rendu suivant si certaines valeurs changent. <br><br><img src="https://habrastorage.org/webt/gl/yd/cj/glydcjxiui-c60mgjzhnfobsqcm.jpeg"><br><br>  Nous rencontrons ici pour la premi√®re fois un concept tel que les d√©pendances.  Certains hooks - useEffect, useCallback, useMemo - prennent un tableau de valeurs comme deuxi√®me argument, ce qui nous permettra de dire quoi suivre.  Les changements dans ce tableau conduisent √† une sorte d'effets.  Par exemple, ici, hypoth√©tiquement, nous avons une sorte de composant pour choisir un auteur dans une liste.  Et une assiette avec des livres de cet auteur.  Et lorsque l'auteur change, useEffect sera appel√©.  Lorsque cet authorId est modifi√©, une demande sera appel√©e et les livres seront charg√©s. <br><br>  En outre, je mentionnerai en passant des crochets comme useRef, c'est une alternative √† React.createRef, quelque chose de similaire √† useState, mais les modifications apport√©es √† ref ne conduisent pas au rendu.  Parfois pratique pour certains hacks.  useImperativeHandle nous permet de d√©clarer certaines ¬´m√©thodes publiques¬ª sur le composant.  Si vous utilisez useRef dans le composant parent, il peut extraire ces m√©thodes.  Pour √™tre honn√™te, je l'ai essay√© une fois √† des fins √©ducatives, dans la pratique, ce n'√©tait pas utile.  useContext est juste une bonne chose, il vous permet de prendre la valeur actuelle du contexte si le fournisseur a d√©fini cette valeur quelque part plus haut dans le niveau de la hi√©rarchie. <br><br>  Il existe un moyen d'optimiser les applications React sur les hooks: la m√©morisation.  La m√©morisation peut √™tre divis√©e en interne et externe.  D'abord √† l'ext√©rieur. <br><br><img src="https://habrastorage.org/webt/ao/wq/-e/aowq-evnbye1bnr6lspo9sthw9y.jpeg"><br><br>  Il s'agit de React.memo, pratiquement une alternative √† la classe React.PureComponent, qui suivait les changements d'accessoires et les composants modifi√©s uniquement lorsque les accessoires ou l'√©tat changeaient. <br><br>  Ici, une chose similaire, cependant, sans √âtat.  Il surveille √©galement les modifications des accessoires et si les accessoires ont chang√©, un rendu se produit.  Si les accessoires n'ont pas chang√©, le composant n'est pas mis √† jour et nous √©conomisons sur cela. <br><br><img src="https://habrastorage.org/webt/lk/0l/dn/lk0ldneyzriaeesmzxfnvvkl1h4.jpeg"><br><br>  M√©thodes internes d'optimisation.  Tout d'abord, c'est une chose de bas niveau - useMemo, rarement utilis√©.  Il vous permet de calculer une valeur et de la recalculer uniquement si les valeurs sp√©cifi√©es dans les d√©pendances ont chang√©. <br><br><img src="https://habrastorage.org/webt/ve/fs/ml/vefsmlmbjqbg6-1lejt5_qofoow.jpeg"><br><br>  Il existe un cas particulier de useMemo pour une fonction appel√©e useCallback.  Il est principalement utilis√© pour m√©moriser la valeur des fonctions de gestionnaire d'√©v√©nements qui seront transmises aux composants enfants afin que ces composants enfants ne puissent plus √™tre rendus.  Il est utilis√© simplement.  Nous d√©crivons une certaine fonction, l'enveloppons dans useCallback et indiquons de quelles variables elle d√©pend. <br><br>  Beaucoup de gens ont une question, mais en avons-nous besoin?  Avons-nous besoin de crochets?  D√©m√©nageons-nous ou restons-nous comme avant?  Il n'y a pas de r√©ponse unique, tout d√©pend des pr√©f√©rences.  Tout d'abord, si vous √™tes directement li√© de mani√®re rigide √† la programmation orient√©e objet, si vos composants, vous y √™tes habitu√© en tant que classe, ils ont des m√©thodes qui peuvent √™tre extraites, alors, probablement, cette chose peut vous sembler superflue.  En principe, il m'a sembl√©, lorsque j'ai entendu parler des crochets pour la premi√®re fois, que c'√©tait trop compliqu√©, une sorte de magie √©tait ajout√©e, et on ne savait pas pourquoi. <br><br>  Pour les amateurs de fonctionnalit√©s, c'est, disons, un incontournable, car les hooks sont des fonctions, et des techniques de programmation fonctionnelle leur sont applicables.  Par exemple, vous pouvez les combiner ou faire n'importe quoi, en utilisant, par exemple, des biblioth√®ques telles que Ramda, etc. <br><br><img src="https://habrastorage.org/webt/du/k4/n7/duk4n7l_1_are_xjgrkf4vvbccy.jpeg"><br><br>  Depuis que nous nous sommes d√©barrass√©s des classes, nous n'avons plus besoin de lier ce contexte aux m√©thodes.  Si vous utilisez ces m√©thodes comme rappels.  Habituellement, c'√©tait un probl√®me, car vous deviez vous rappeler de les lier dans le constructeur, ou d'utiliser une extension non officielle de la syntaxe du langage, comme des fonctions fl√©ch√©es comme propri√©t√©.  Pratique assez courante.  J'ai utilis√© mon d√©corateur, qui est aussi, en principe, exp√©rimental, sur les m√©thodes. <br><br><img src="https://habrastorage.org/webt/pn/ew/fi/pnewfifb1wwktxkbddh1zqqk-os.jpeg"><br><br>  Il y a une diff√©rence dans la fa√ßon dont le cycle de vie fonctionne, comment le g√©rer.  Les crochets associent presque toutes les actions du cycle de vie au crochet useEffect, qui vous permet de vous abonner √† la naissance et √† la mise √† jour d'un composant et √† sa mort.  Dans les classes, pour cela, nous avons d√ª red√©finir plusieurs m√©thodes, telles que componentDidMount, componentDidUpdate et componentWillUnmount.  De plus, la m√©thode shouldComponentUpdate peut d√©sormais √™tre remplac√©e par React.memo. <br><br><img src="https://habrastorage.org/webt/7d/ae/qy/7daeqyxv0yh0on4i1wcdsraoaws.jpeg"><br><br>  Il y a une assez petite diff√©rence dans la fa√ßon dont l'√âtat est g√©r√©.  Tout d'abord, les classes ont un objet d'√©tat.  Nous avons d√ª entasser n'importe quoi l√†-bas.  Dans les crochets, nous pouvons diviser l'√©tat logique en quelques morceaux, qu'il serait pratique pour nous d'op√©rer s√©par√©ment. <br><br>  setState () des composants sur les classes autoris√©s √† sp√©cifier un patch d'√©tat, modifiant ainsi un ou plusieurs champs de l'√©tat.  Dans les crochets, nous devons changer l'√©tat entier dans son ensemble, et c'est m√™me bien, car il est √† la mode d'utiliser toutes sortes de choses immuables et de ne jamais s'attendre √† ce que nos objets mutent.  Ils sont toujours nouveaux avec nous. <br><br>  La principale caract√©ristique des classes que les hooks n'ont pas: on pourrait s'abonner aux changements d'√©tat.  Autrement dit, nous changeons l'√©tat et souscrivons imm√©diatement √† ses modifications, en traitant imp√©rativement quelque chose imm√©diatement apr√®s l'application des modifications.  Dans les crochets, cela ne fonctionne tout simplement pas.  Cela doit √™tre fait d'une mani√®re tr√®s int√©ressante, je vous le dirai plus loin. <br><br>  Et un peu sur la fa√ßon fonctionnelle de mettre √† jour.  Cela fonctionne √† la fois l√† et l√†, lorsque les fonctions de changement d'√©tat acceptent une autre fonction, que cet √©tat ne doit pas changer, mais plut√¥t cr√©er.  Et si dans le cas du composant class, il peut nous renvoyer une sorte de patch, alors dans les hooks, nous devons renvoyer la toute nouvelle valeur. <br><br>  En g√©n√©ral, il est peu probable que vous obteniez une r√©ponse, que vous d√©m√©nagiez ou non.  Mais je conseille au moins d'essayer, au moins pour le nouveau code, de le ressentir.  Lorsque je viens de commencer √† travailler avec des crochets, j'ai imm√©diatement identifi√© plusieurs crochets personnalis√©s qui me conviennent pour mon projet.  Fondamentalement, j'ai essay√© de remplacer certaines des fonctionnalit√©s que j'avais mises en ≈ìuvre via des composants d'ordre sup√©rieur. <br><br><img src="https://habrastorage.org/webt/d6/cs/1-/d6cs1-ebiop8wbrdgnrr93wskqm.jpeg"><br><br>  useDismounted - pour ceux qui connaissent RxJS, il est possible de se d√©sabonner massivement de tous les observables dans un seul composant ou dans une seule fonction, en abonnant chaque observable √† un objet sp√©cial, sujet, et lorsqu'il est ferm√©, tous les abonnements sont annul√©s.  C'est tr√®s pratique si le composant est complexe, s'il y a beaucoup d'op√©rations asynchrones √† l'int√©rieur de l'Observable, il est pratique de se d√©sinscrire de tout √† la fois, et non de chacun s√©par√©ment. <br><br>  useObservable renvoie une valeur d'Observable quand une nouvelle appara√Æt l√†.  Un hook useBehaviourSubject similaire revient de BehaviourSubject.  Sa diff√©rence avec Observable est qu'elle a initialement une signification. <br><br>  Le crochet personnalis√© pratique useDebounceValue nous permet d'organiser, par exemple, une requ√™te pour la cha√Æne de recherche, de sorte que chaque fois que vous n'appuyez pas sur une touche, n'envoyez pas quelque chose au serveur, mais attendez que l'utilisateur ait fini de taper. <br><br>  Deux crochets similaires.  useWindowResize renvoie les valeurs r√©elles actuelles des tailles de fen√™tre.  Le crochet suivant pour la position de d√©filement est useWindowScroll.  Je les utilise pour raconter certaines fen√™tres contextuelles ou fen√™tres modales, s'il y a des choses compliqu√©es qui ne peuvent tout simplement pas √™tre faites avec CSS. <br><br>  Et un si petit crochet pour impl√©menter des touches de raccourci, dont le composant, lorsqu'il est pr√©sent sur la page, il est abonn√© √† une touche de raccourci.  √Ä sa mort, une d√©sinscription automatique se produit. <br><br>  √Ä quoi servent ces crochets personnalis√©s?  Que nous pouvons entasser un d√©sabonnement √† l'int√©rieur du crochet, et nous n'avons pas √† penser √† d√©sinscrire manuellement quelque part dans le composant o√π ce crochet est utilis√©. <br><br>  Il n'y a pas si longtemps, ils m'ont jet√© un lien vers la biblioth√®que React-Use, et il s'est av√©r√© que la plupart de ces crochets personnalis√©s y √©taient d√©j√† impl√©ment√©s.  Et j'ai √©crit un v√©lo.  C'est parfois utile, mais √† l'avenir, tr√®s probablement, je vais probablement les jeter et utiliser React-Use.  Et je vous conseille √©galement de voir si vous comptez utiliser des crochets. <br><br><img src="https://habrastorage.org/webt/03/ls/_r/03ls_rryjcv9gax_wky56kv0hye.jpeg"><br><br>  En fait, l'objectif principal du rapport est de montrer comment √©crire de mani√®re incorrecte, quels probl√®mes peuvent √™tre et comment les √©viter.  La toute premi√®re chose, probablement ce que quiconque √©tudie ces crochets et essaie d'√©crire quelque chose, est d'utiliser incorrectement useEffect.  Voici le code similaire √† celui que 100% tout le monde a √©crit s'il essayait des hooks.  Cela est d√ª au fait que useEffect est initialement per√ßu mentalement, comme une alternative √† componentDidMount.  Mais, contrairement √† componentDidMount, qui n'est appel√© qu'une seule fois, useEffect est appel√© sur chaque rendu.  Et l'erreur ici est qu'elle change, disons, la variable de donn√©es, et en m√™me temps la changer conduit √† un rendu de composant, par cons√©quent, l'effet sera redemand√©.  Ainsi, nous obtenons une s√©rie sans fin de demandes AJAX au serveur, et le composant lui-m√™me se met constamment √† jour, met √† jour, met √† jour. <br><br><img src="https://habrastorage.org/webt/ds/jw/cl/dsjwclnhk6kvmnmkxjw04vdrqd8.jpeg"><br><br>  Le r√©parer est tr√®s simple.  Vous devez ajouter ici un tableau vide de ces d√©pendances dont il d√©pend, et les modifications qui red√©marreront l'effet.  Si nous avons une liste vide de d√©pendances sp√©cifi√©e ici, l'effet, en cons√©quence, ne sera pas red√©marr√©.  Ce n'est pas une sorte de hack, c'est une fonctionnalit√© de base de l'utilisation de useEffect. <br><br><img src="https://habrastorage.org/webt/tx/bw/it/txbwitnnldk_y5r-bf0f4pss7eg.jpeg"><br><br>  Disons que nous l'avons corrig√©.  Maintenant un peu compliqu√©.  Nous avons un composant qui rend quelque chose qui doit √™tre retir√© du serveur pour une sorte d'ID.  Dans ce cas, en principe, tout fonctionne bien jusqu'√† ce que nous modifiions entityId dans le parent, ce n'est peut-√™tre pas pertinent pour votre composant. <br><br><img src="https://habrastorage.org/webt/2e/pl/tx/2epltxjdup5yia7c6gsepl-o7xo.jpeg"><br><br>  Mais tr√®s probablement, s'il change ou s'il est n√©cessaire de le changer, et que vous avez un ancien composant sur votre page et qu'il s'av√®re qu'il ne se met pas √† jour, il est pr√©f√©rable d'ajouter ici entityId, en tant que d√©pendance, provoquant la mise √† jour, mettant √† jour les donn√©es. <br><br><img src="https://habrastorage.org/webt/rd/lc/ep/rdlcepf4e8lzq8ersyffn8ydqgs.jpeg"><br><br>  Un exemple plus complexe avec useCallback.  Ici, √† premi√®re vue, tout va bien.  Nous avons une certaine page qui a une sorte de compte √† rebours, ou, inversement, une minuterie qui ne fait que cocher.  Et, par exemple, une liste d'h√¥tes, et en haut sont des filtres qui vous permettent de filtrer cette liste d'h√¥tes.  Eh bien, la maintenance a √©t√© ajout√©e ici juste pour illustrer une valeur changeant fr√©quemment qui se traduit par un moteur de rendu. <br><br>    ,   ,    maintenance    ,   ,   ,      onChange.     onChange,        .  ,  HostFilters - , ,      dropdown,     .       ,    .  ,       . <br><br><img src="https://habrastorage.org/webt/bb/08/q1/bb08q1gwb5jzadcu0-bl1w0xsy0.jpeg"><br><br>     onChange    useCallback.         ,      . <br><br>    ,   . , ,  .      Facebook,   React.  , , ,  ,  '.     ,  ,  confusing . <br><br><img src="https://habrastorage.org/webt/xw/lv/et/xwlvetymaukrlaxd7t5cctegg-8.jpeg"><br><br>     ?        ‚Äî     ,   -  , ,     ,      ,  ,         .         . <br><br> ,    ,          ,     ,      ,     , .  , Garbage Collector      ,    .  , ,     ,    ,    .   , , ,       reducer,     ,          . ,      . <br><br>    ,     ,   .     - , ,   setValue  - ,            ,   setState     .   -       useEffect. <br><br>   useEffect   -  ,   -  , ,   ,    useEffect.     useEffect     ,   .        ,    ,  Backbone,  : ,     ,  ,        -  .      ,    ,  -   ,  .    -   . ,  ,      ,    ,    -  . ,  ,  ,   , ,    ,  .     . <br><br>   ,   ,  . ,        ,     .           ,      .        ,     .  ,    , , dropdown  .   ,     .    dropdown  pop-up,     useWindowScroll, useWindowResize         ,  .         ,      , ‚Äî  ,   . <br><br>        ,   ,  . ,       , ,   ,     ,       . , ,   ,      ,   ,         . <br><br><img src="https://habrastorage.org/webt/-r/tu/f_/-rtuf_bbscg5l9i4-oaeh-xpu80.jpeg"><br><br>   ,     ¬´¬ª,   . ,     ,   TypeScript    .      .    ,  reducer  Redux ,    action.  ,   action    ,     action.   ,   ,     ,  . <br><br>    .  ,        action.     ,     , IncrementA  0,  1, 2,   .         . ,    , ,  ,       .     action     action,   -     .   UnionType ‚ÄúAction‚Äù,         ,   ,    action.   . <br><br>   ‚Äî     . ,   initialState,  .   ,       -  .       TypeScript.     . ,    typeState   ,   initialState. <br><br><img src="https://habrastorage.org/webt/_i/fg/79/_ifg793-qpfaiwittpdhffve_zw.jpeg"><br><br>       reducer.   State, Action,    :   switch  action.type.  TypeScript      UnionType:       case,      - ,    type.           action   . <br><br> ,  :  ,    ,     .  . <br><br><img src="https://habrastorage.org/webt/6r/8v/or/6r8vordbm6xpl9og288kzvrgewk.jpeg"><br><br>   ?  ,     .      .      ,   reducer. ,   action creator  ,   ,       dispatch. <br><br><img src="https://habrastorage.org/webt/vg/tg/aw/vgtgawewmkwgpr5su4c24n7hgo8.jpeg"><br><br>     extension   Dev Tools.            .    . <br><br>  ,  ,    .   ,     ,     .      useDebugValue ,        -    Dev Tool.        useConstants,       - , loaded,  ,     ,  . <br><br><img src="https://habrastorage.org/webt/rt/cc/sg/rtccsggw9kekwpt75gmvnwd_w2u.jpeg"><br><br>   ‚Äî  .  ,     .     ,        .    ,   ,  ,    .     ,   ,          ‚Äî   -       ,   ‚Äî   . <br><br>   .  Facebook     ESLint,       .      ,  , .    ,   dependencies  .     ,    ,    ,     . <br><br>       ,  ,     ,  -   ,     .     ,   ,   ,       . .       ,    -   - . <br><br>    ‚Äî       , ,  - .   ,    ,    .      ,   ,  -      . ,             .      .  : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´React hooks ‚Äî   ?¬ª</a> C     .       ,    ,    ,      ,    . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   useEffect</a> .  ,   ,      ,   ,   ,     . . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´useReducer vs useState in React¬ª</a> ,    useReducer,      useState. :     ,  ,    ,    useReducer.    - ,   useState   . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React Hooks CheatSheets</a> c      . </li><li>   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Usehooks.com</a> ‚Äî   , .     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">react-use</a> ‚Äî ,       ,     . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464071/">https://habr.com/ru/post/fr464071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464045/index.html">Comment je traine presque en temps r√©el en 1997</a></li>
<li><a href="../fr464053/index.html">Nota: Algorithme de s√©lection et de rotation des pistes</a></li>
<li><a href="../fr464055/index.html">Nous √©tudions les donn√©es collect√©es par Xiaomi Mi Band pour l'ann√©e</a></li>
<li><a href="../fr464057/index.html">Hilbert, Lebesgue ... et le vide</a></li>
<li><a href="../fr464063/index.html">Couper le c√¢ble en 2019</a></li>
<li><a href="../fr464075/index.html">Introduction √† C. Message du si√®cle dernier</a></li>
<li><a href="../fr464077/index.html">Non, vous n'avez pas besoin de delta ve √† 50 km / s. Vous avez besoin de technologies additives (partie 1)</a></li>
<li><a href="../fr464079/index.html">Comment faire un vaisseau spatial de d√©collage et d'atterrissage horizontal sans technologie miracle</a></li>
<li><a href="../fr464083/index.html">Comment ITSM va aider et qui applique cette m√©thodologie</a></li>
<li><a href="../fr464089/index.html">Automatiser les requ√™tes HTTP dans le contexte de Spring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>