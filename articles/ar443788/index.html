<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐พ ๐ฉโ๐ซ โ๏ธ ุฃุณุงุณูุงุช ุงูุชูุฌูู ุงูุซุงุจุช ูู Mikrotik RouterOS ๐ ๐ช ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูุชูุฌูู ูู ุนูููุฉ ุงูุนุซูุฑ ุนูู ุงููุณุงุฑ ุงูุฃูุซู ูุฅุฑุณุงู ุงูุญุฒูุฉ ุนูู ุดุจูุงุช TCP / IP. ูุญุชูู ุฃู ุฌูุงุฒ ูุชุตู ุจุดุจูุฉ IPv4 ุนูู ุนูููุฉ ูุฌุฏุงูู ุชูุฌูู. 


 ูุฐู ุงูููุงูุฉ ููุณุช...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃุณุงุณูุงุช ุงูุชูุฌูู ุงูุซุงุจุช ูู Mikrotik RouterOS</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443788/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงูุชูุฌูู ูู ุนูููุฉ ุงูุนุซูุฑ ุนูู ุงููุณุงุฑ ุงูุฃูุซู ูุฅุฑุณุงู ุงูุญุฒูุฉ ุนูู ุดุจูุงุช TCP / IP.  ูุญุชูู ุฃู ุฌูุงุฒ ูุชุตู ุจุดุจูุฉ IPv4 ุนูู ุนูููุฉ ูุฌุฏุงูู ุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  ูุฐู ุงูููุงูุฉ ููุณุช HOWTO ุ ููู ุชุตู ุงูุชูุฌูู ุงูุซุงุจุช ูู RouterOS ููุซุงู ุ ููุฏ ุญุฐูุช ุนูุฏุง ุจููุฉ ุงูุฅุนุฏุงุฏุงุช (ุนูู ุณุจูู ุงููุซุงู ุ srcnat ูููุตูู ุฅูู ุงูุฅูุชุฑูุช) ุ ูุฐูู ููู ูุฐู ุงูููุงุฏ ูุชุทูุจ ูุณุชูู ูุนูู ูู ุงููุนุฑูุฉ ุจุงูุดุจูุงุช ู RouterOS. </p><a name="habracut"></a><br><h3 id="kommutaciya-i-marshrutizaciya" style=";text-align:right;direction:rtl">  ุงูุชุจุฏูู ูุงูุชูุฌูู </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/5v/h7/a2/5vh7a2relrje9g9e5kbonuogsqw.png"></p><br><p style=";text-align:right;direction:rtl">  ุงูุชุจุฏูู ูู ุนูููุฉ ุชุจุงุฏู ุงูุญุฒู ุถูู ูุทุนุฉ Layer2 ูุงุญุฏุฉ (Ethernet ุ ppp ุ ...).  ุฅุฐุง ุฑุฃู ุงูุฌูุงุฒ ุฃู ูุณุชูู ุงูุญุฒูุฉ ููุฌูุฏ ุนูู ููุณ ุดุจูุฉ Ethernet ุงููุฑุนูุฉ ููุง ูู ุ ูุฅูู ูุชุนุฑู ุนูู ุนููุงู mac ุจุงุณุชุฎุฏุงู ุจุฑูุชูููู arp ููุฑุณู ุงูุญุฒูุฉ ูุจุงุดุฑุฉ ุ ูุชุฌุงูุฒูุง ุฌูุงุฒ ุงูุชูุฌูู.  ูููู ุฃู ูุญุชูู ุงุชุตุงู ppp (ูู ููุทุฉ ุฅูู ููุทุฉ) ุนูู ูุดุงุฑููู ููุท ููุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ุฏุงุฆููุง ุฅูู ููุณ ุนููุงู 0xff. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชูุฌูู ูู ุนูููุฉ ููู ุงูุญุฒู ุจูู ููุงุทุน Layer2.  ุฅุฐุง ุฃุฑุงุฏ ุงูุฌูุงุฒ ุฅุฑุณุงู ุญุฒูุฉ ุ ูููู ูุณุชูููุง ุฎุงุฑุฌ ุดุฑูุญุฉ Ethernet ุ ูุฅูู ููุธุฑ ุฅูู ุฌุฏูู ุงูุชูุฌูู ุงูุฎุงุต ุจู ูููุฑุฑ ุงูุญุฒูุฉ ุฅูู ุจูุงุจุฉ ุชุนุฑู ููุงู ุฅุฑุณุงู ุงูุญุฒูุฉ ุจุดูู ุฅุถุงูู (ุฃู ุฑุจูุง ูุง ูุนุฑู ุ ูุง ูุนุฑู ูุฑุณู ุงูุญุฒูุฉ ุงูุฃุตูู ุจุฐูู). </p><br><p style=";text-align:right;direction:rtl">  ุฃุณูู ุทุฑููุฉ ูููุธุฑ ูู ุฌูุงุฒ ุงูุชูุฌูู ูู ูุฌูุงุฒ ูุชุตู ุจุดุฑูุญุชูู ุฃู ุฃูุซุฑ ูู Layer2 ููุงุฏุฑ ุนูู ููู ุงูุญุฒู ุจููููุง ุ ูุชุญุฏูุฏ ุงููุณุงุฑ ุงูุฃูุซู ูู ุฌุฏูู ุงูุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูู ุดูุก ูุงุถุญูุง ูู ุฃู ููุช ุชุนุฑูู ุจุงููุนู ุ ูุงูุฑุฃ.  ุฃูุตู ุจุดุฏุฉ ุฃู ููุฑุฃ ุงูุขุฎุฑูู ููุงูุฉ ุตุบูุฑุฉ ูููููุง ุดุงููุฉ ููุบุงูุฉ. </p><br><h3 id="marshrutizaciya-v-routeros-i-packetflow" style=";text-align:right;direction:rtl">  ุงูุชูุฌูู ูู RouterOS ู PacketFlow </h3><br><p style=";text-align:right;direction:rtl">  ุฌููุน ุงููุธุงุฆู ุงููุชุนููุฉ ุจุงูุชูุฌูู ุงูุซุงุจุช ุชูุฑูุจูุง ููุฌูุฏุฉ ูู ุญุฒูุฉ <em>ุงููุธุงู</em> .  ุชุถูู ุญุฒูุฉ <em>ุงูุชูุฌูู</em> ุฏุนููุง ูุฎูุงุฑุฒููุงุช ุงูุชูุฌูู ุงูุฏููุงููููุฉ (RIP ู OSPF ู BGP ู MME) ููุฑุดุญุงุช ุงูุชูุฌูู ู BFD. </p><br><p style=";text-align:right;direction:rtl"> ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ ูุชูููู ุงูุชูุฌูู: <code>[IP]-&gt;[Route]</code> .  ูุฏ ุชุชุทูุจ ุงููุฎุทุทุงุช ุงููุนูุฏุฉ ูุถุน ุงูุนูุงูุงุช ุงูุฃูููุฉ ููุญุฒู ูุน ููุตู ุชูุฌูู ูู: <code>[IP]-&gt;[Firewall]-&gt;[Mangle]</code> (ุณูุงุณู <code>PREROUTING</code> ู <code>OUTPUT</code> ). </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุซูุงุซุฉ ุฃูุงูู ุนูู PacketFlow ุญูุซ ูุชู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช ุจุดุฃู ุชูุฌูู ุญุฒู IP: <br><img src="https://habrastorage.org/webt/pk/ie/mp/pkiempktzjkwz6tcwrnwyl1c1dc.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุญุฒู ุงูุชูุฌูู ุงูุชู ุชููุงูุง ุฌูุงุฒ ุงูุชูุฌูู.  ูู ูุฐู ุงููุฑุญูุฉ ุ ุชูุฑุฑ ุฃู ุงูุญุฒูุฉ ุณูู ุชุฐูุจ ุฅูู ุงูุนูููุฉ ุงููุญููุฉ ุฃู ุณูุชู ุฅุฑุณุงููุง ุฅูู ุงูุดุจูุฉ.  ุชููู ุญุฒู ุงูุนุจูุฑ <em>ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ</em> </li><li style=";text-align:right;direction:rtl">  ุชูุฌูู ุงูุญุฒู ุงูุตุงุฏุฑุฉ ุงููุญููุฉ.  ุชููู ุงูุญุฒู ุงูุตุงุฏุฑุฉ <em>ูุงุฌูุฉ ุงูุฅุฎุฑุงุฌ</em> </li><li style=";text-align:right;direction:rtl">  ุชุชูุญ ูู ุฎุทูุฉ ุชูุฌูู ุฅุถุงููุฉ ููุญุฒู ุงูุตุงุฏุฑุฉ ุชุบููุฑ ูุฑุงุฑ ุงูุชูุฌูู ูู <code>[Output|Mangle]</code> </li></ol><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุนุชูุฏ ูุณุงุฑ ุงูุญุฒูุฉ ูู ุงููุชู 1 ุ 2 ุนูู ุงูููุงุนุฏ ูู <code>[IP]-&gt;[Route]</code> </li><li style=";text-align:right;direction:rtl">  ูุนุชูุฏ ูุณุงุฑ ุงูุญุฒูุฉ ูู ุงูุฎุทูุงุช 1 ู 2 ู 3 ุนูู ุงูููุงุนุฏ ุงูููุฌูุฏุฉ ูู <code>[IP]-&gt;[Route]-&gt;[Rules]</code> </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ูุชุฃุซุฑ ูุณุงุฑ ุงูุญุฒูุฉ ูู ุงููุชู 1 ู 3 ุจุงุณุชุฎุฏุงู <code>[IP]-&gt;[Firewall]-&gt;[Mangle]</code> </li></ul><br><h3 id="rib-fib-routing-cache" style=";text-align:right;direction:rtl">  RIB ุ FIB ุ ุชูุฌูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fw/jc/ku/fwjckuzqzyxo4udazveb8uhotuq.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ูุงุนุฏุฉ ูุนูููุงุช ุงูุชูุฌูู</strong> <br>  ุงูุฃุณุงุณ ุงูุฐู ูุชู ููู ุชุฌููุน ุงููุณุงุฑุงุช ูู ุจุฑูุชููููุงุช ุงูุชูุฌูู ุงูุฏููุงููููุฉ ุ ูุงูุทุฑู ูู ppp ู dhcp ุ ูุงููุณุงุฑุงุช ุงูุซุงุจุชุฉ ูุงููุชุตูุฉ.  ุชุญุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฐู ุนูู ุฌููุน ุงููุณุงุฑุงุช ุจุงุณุชุซูุงุก ุชูู ุงูุชู ุชูุช ุชุตููุชูุง ูู ูุจู ุงููุณุคูู. </p><br><p style=";text-align:right;direction:rtl">  <em>ููููุง ููุงุชูุงููุฉ</em> ุ ูููููุง ุฃู ููุชุฑุถ ุฃู <code>[IP]-&gt;[Route]</code> ูุนุฑุถ RIB. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุฅุนุงุฏุฉ ุชูุฌูู ูุงุนุฏุฉ ุงููุนูููุงุช</strong> <br><img src="https://habrastorage.org/webt/kt/jn/q1/ktjnq1ebrd0--d9afkseuixtap8.png"></p><br><p style=";text-align:right;direction:rtl">  ุงููุงุนุฏุฉ ุงูุชู ุชุณูุฑ ูููุง ุฃูุถู ุงูุทุฑู ูู RIB.  ุฌููุน ุงููุณุงุฑุงุช ูู FIB ูุดุทุฉ ูุชุณุชุฎุฏู ูุฅุนุงุฏุฉ ุชูุฌูู ุงูุญุฒู.  ุฅุฐุง ุฃุตุจุญ ุงููุณุงุฑ ุบูุฑ ูุดุท (ุชู ุชุนุทููู ูู ูุจู ุงููุณุคูู (ุงููุธุงู) ุ ุฃู ูุงูุช ุงููุงุฌูุฉ ุงูุชู ูุฌุจ ุฅุฑุณุงู ุงูุญุฒูุฉ ุบูุฑ ูุดุทุฉ) ุ ูุณูุชู ุญุฐู ุงููุณุงุฑ ูู FIB. </p><br><p style=";text-align:right;direction:rtl">  ูุงุชุฎุงุฐ ูุฑุงุฑ ุญูู ุงูุชูุฌูู ุ ูุชู ุงุณุชุฎุฏุงู ุจูุงูุงุช ุญุฒูุฉ IP ุงูุชุงููุฉ ูู ุฌุฏูู FIB: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนููุงู ุงููุตุฏุฑ </li><li style=";text-align:right;direction:rtl">  ุนููุงู ุงููุฌูุฉ </li><li style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ุงููุตุฏุฑ </li><li style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุงูุชูุฌูู </li><li style=";text-align:right;direction:rtl">  ToS (DSCP) </li></ul><br><p style=";text-align:right;direction:rtl">  ููุชุฏ ุงููุตูู ุฅูู ุญุฒูุฉ FIB ุนุจุฑ ุงููุฑุงุญู ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุชู ุชุตููู ุงูุญุฒูุฉ ูุนูููุฉ ุงูุชูุฌูู ุงููุญููุฉุ </li><li style=";text-align:right;direction:rtl">  ูู ุชูุฏุฑุฌ ุงูุญุฒูุฉ ุชุญุช ูุธุงู PBR ุฃู ููุงุนุฏ ุงููุณุชุฎุฏูุ <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ุงูุฃูุฑ ูุฐูู ุ ูุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ุฅูู ุฌุฏูู ุงูุชูุฌูู ุงููุญุฏุฏ. </li></ul></li><li style=";text-align:right;direction:rtl">  ูุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ุฅูู ุงูุฌุฏูู ุงูุฑุฆูุณู </li></ul><br><p style=";text-align:right;direction:rtl">  <em>ููููุง ููุงุชูุงููุฉ</em> ุ ูููููุง ุงูุชุฑุงุถ ุฃู <code>[IP]-&gt;[Route Active=yes]</code> ูุนุฑุถ FIB. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุฎุจุฃ ุงูุชูุฌูู</strong> <br>  ุขููุฉ ููุชุฎุฒูู ุงููุคูุช ุงูุทุฑู.  ูุชุฐูุฑ ุงูููุฌู ุงูููุงู ุงูุฐู ุชู ุฅุฑุณุงู ุงูุญุฒู ุฅููู ุ ูุฅุฐุง ูุงูุช ููุงู ุญุฒู ููุงุซูุฉ (ูููุชุฑุถ ุฃููุง ูู ููุณ ุงูุงุชุตุงู) ุ ูุฅูู ูุจุฏุฃ ุชุดุบูููุง ุนูู ููุณ ุงููุณุงุฑ ุ ุฏูู ุฅูุฏุงุน FIB.  ูุชู ูุณุญ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูููุณุงุฑ ุจุดูู ุฏูุฑู. </p><br><p style=";text-align:right;direction:rtl">  ูููุณุคูููู ุ ูู ููู ูุฏู RouterOS ูุณุงุฆู ุนุฑุถ ูุฅุฏุงุฑุฉ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุชูุฌูู ุ ูููู ูุน ุฐูู ููููู ุชุนุทููู ูู <code>[IP]-&gt;[Settings]</code> . </p><br><p style=";text-align:right;direction:rtl">  <em>ุชูุช ุฅุฒุงูุฉ ูุฐู ุงูุขููุฉ ูู linux 3.6 kernel ุ ููู kernel 3.3.5 ูุง ูุฒุงู ูุณุชุฎุฏู ูู RouterOS ุ ูุฑุจูุง ูููู ุงูุชุฎุฒูู ุงููุคูุช ููุชูุฌูู ุฃุญุฏ ุงูุฃุณุจุงุจ.</em> </p><br><h3 id="dialog-dobavleniya-marshruta" style=";text-align:right;direction:rtl">  ุงูุทุฑูู ุฅุถุงูุฉ ุงูุญูุงุฑ </h3><br><p style=";text-align:right;direction:rtl"> <code>[IP]-&gt;[Route]-&gt;[+]</code> <br> <img src="https://habrastorage.org/webt/th/lb/el/thlbel_kvf2gk-s2125imh_z7cg.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงูุชู ุชุฑูุฏ ุฅูุดุงุก ูุณุงุฑ ููุง (ุงูุงูุชุฑุงุถู: 0.0.0.0/0) </li><li style=";text-align:right;direction:rtl">  ุนููุงู IP ุฃู ุงููุงุฌูุฉ ุงูุชู ุณูุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ุฅูููุง (ูุฏ ูููู ููุงู ุนุฏุฉ ุ ุฑุงุฌุน ECMP ุฃุฏูุงู) </li><li style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุชูุงูุฑ ุงูุจูุงุจุฉ </li><li style=";text-align:right;direction:rtl">  ููุน ุงูุณุฌู </li><li style=";text-align:right;direction:rtl">  ุงููุณุงูุฉ (ูุชุฑู) ููุทุฑูู </li><li style=";text-align:right;direction:rtl">  ุฌุฏูู ุงูุชูุฌูู </li><li style=";text-align:right;direction:rtl">  IP ููุญุฒู ุงูุตุงุฏุฑุฉ ุงููุญููุฉ ูู ุฎูุงู ูุฐุง ุงูุทุฑูู </li><li style=";text-align:right;direction:rtl">  ุงูุบุฑุถ ูู ุงููุทุงู ูุงููุทุงู ุงููุณุชูุฏู ููุชูุจ ูู ููุงูุฉ ุงูููุงู. </li></ol><br><p style=";text-align:right;direction:rtl">  <strong>ุฃุนูุงู ุงูุทุฑูู</strong> <br><img src="https://habrastorage.org/webt/ai/ro/iv/airoivo1bmk3lgbqj_hivpbjdyc.png"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  X - ุชู ุชุนุทูู ุงููุณุงุฑ ูู ูุจู ุงููุณุคูู ( <code>disabled=yes</code> ) </li><li style=";text-align:right;direction:rtl">  ุฃ - ูุชู ุงุณุชุฎุฏุงู ุงูุทุฑูู ูููู ุงูุญุฒู. </li><li style=";text-align:right;direction:rtl">  D - ุชู ุฅุถุงูุฉ ุงููุณุงุฑ ุจุดูู ุญููู (BGP ุ OSPF ุ RIP ุ MME ุ PPP ุ DHCP ุ ูุชุตู) </li><li style=";text-align:right;direction:rtl">  ุฌ - ุงูุดุจูุฉ ุงููุฑุนูุฉ ูุชุตูุฉ ูุจุงุดุฑุฉ ุจุงูููุฌู </li><li style=";text-align:right;direction:rtl">  S - ุทุฑูู ุซุงุจุช </li><li style=";text-align:right;direction:rtl">  r ุ b ุ o ุ m - ุชูุช ุฅุถุงูุฉ ุงููุณุงุฑ ุจูุงุณุทุฉ ุฃุญุฏ ุจุฑูุชููููุงุช ุงูุชูุฌูู ุงูุฏููุงููููุฉ </li><li style=";text-align:right;direction:rtl">  B ุ U ุ P - ุทุฑูู ุงูุชุฑุดูุญ (ูุชุฌุงูู ุงูุญุฒู ุจุฏูุงู ูู ุงูุฅุฑุณุงู) </li></ul><br><h3 id="chto-ukazyvat-v-gateway-ip-adres-ili-interfeys" style=";text-align:right;direction:rtl">  ูุง ูุชุญุฏูุฏ ูู ุงูุนุจุงุฑุฉ: ุนููุงู IP ุฃู ูุงุฌูุฉุ </h3><br><p style=";text-align:right;direction:rtl">  ูุณูุญ ูู ุงููุธุงู ุจุชุญุฏูุฏ ููุงููุง ุ ูู ุญูู ุฃูู ูุง ููุณู ููุง ูุนุทู ุชูููุญุงุช ุฅุฐุง ููุช ูุฏ ุงุฑุชูุจุช ุฎุทุฃ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุนููุงู IP</strong> <br>  ูุฌุจ ุงููุตูู ุฅูู ุนููุงู ุงูุจูุงุจุฉ ุนุจุฑ Layer2.  ุจุงููุณุจุฉ ุฅูู Ethernet ุ ูุนูู ูุฐุง ุฃู ุฌูุงุฒ ุงูุชูุฌูู ูุฌุจ ุฃู ูููู ูุฏูู ุนููุงู IP ูู ููุณ ุงูุดุจูุฉ ุงููุฑุนูุฉ ุนูู ุฅุญุฏู ุงููุงุฌูุงุช ุงููุดุทุฉ ุ ุจุงููุณุจุฉ ุฅูู ppp - ุฃู ุนููุงู ุงูุจูุงุจุฉ ูุฏุฑุฌ ุนูู ุฅุญุฏู ุงููุงุฌูุงุช ุงููุดุทุฉ ูุนููุงู ุงูุดุจูุฉ ุงููุฑุนูุฉ. <br>  ุฅุฐุง ูู ูุชู ุงุณุชููุงุก ุดุฑุท ุชููุฑ Layer2 ุ ูุนุชุจุฑ ุงููุณุงุฑ ุบูุฑ ูุดุท ููุง ููุน ูู FIB. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุงุฌูุฉ</strong> <br>  ูู ุดูุก ุฃูุซุฑ ุชุนููุฏูุง ูุณููู ุฌูุงุฒ ุงูุชูุฌูู ูุนุชูุฏ ุนูู ููุน ุงููุงุฌูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  PPP (Async ุ PPTP ุ L2TP ุ SSTP ุ PPPoE ุ OpenVPN *) ููุชุฑุถ ุงูุงุชุตุงู ุฃู ููุงู ูุดุงุฑููู ููุท ูุณูุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ุฏุงุฆููุง ุฅูู ุงูุจูุงุจุฉ ูุฅุฑุณุงููุง ุ ุฅุฐุง ุงูุชุดูุช ุงูุนุจูุงุฑุฉ ุฃููุง ุงููุณุชูู ููุณู ุ ูุณูู ุชููู ุงูุญุฒูุฉ ุฅูู ุนูููุชูุง ุงููุญููุฉ. <br><img src="https://habrastorage.org/webt/90/-g/xk/90-gxkgtlplrv8sstcs4r70bxx4.png"></li><li style=";text-align:right;direction:rtl">  ุชูุชุฑุถ Ethernet ุฃู ููุงู ุงูุนุฏูุฏ ูู ุงููุดุงุฑููู ูุณูู ุชุฑุณู ุทูุจุงุช ุฅูู ูุงุฌูุฉ ARP ุจุนููุงู ูุณุชูุจู ุงูุญุฒูุฉ ุ ููุฐุง ูู ุงูุณููู ุงููุชููุน ูุงูุทุจูุนู ุชูุงููุง ููุทุฑู ุงููุชุตูุฉ. <br>  ูููู ุนูุฏูุง ุชุญุงูู ุงุณุชุฎุฏุงู ุงููุงุฌูุฉ ูุทุฑูู ูุดุจูุฉ ูุฑุนูุฉ ุจุนูุฏุฉ ุ ูุฅูู ุชุญุตู ุนูู ุงููููู ุงูุชุงูู: ุงููุณุงุฑ ูุดุท ุ ููุฑ ุงูุฃูุฑ ping ุฅูู ุงูุจูุงุจุฉ ุ ููู ูุง ูุตู ุฅูู ุงููุณุชูู ูู ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงููุญุฏุฏุฉ.  ุฅุฐุง ูุธุฑุช ุฅูู ุงููุงุฌูุฉ ูู ุฎูุงู ูุชุดูู ุ ุณุชุฑู ุทูุจุงุช ARP ูุน ุนูุงููู ูู ุดุจูุฉ ูุฑุนูุฉ ุจุนูุฏุฉ. <br><img src="https://habrastorage.org/webt/62/si/qp/62siqpa8gbtxi-8x4eymxgv19vi.png"></li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/i6/-n/nb/i6-nnbyrlylq0jk6pqwefb_2qz8.png"></p><br><p style=";text-align:right;direction:rtl">  ุญุงูู ุชุญุฏูุฏ ุนููุงู IP ูุจูุงุจุฉ ูููุง ูุงู ุฐูู ูููููุง.  ุงูุงุณุชุซูุงุกุงุช ูู ุทุฑู ูุชุตูุฉ (ุชู ุฅูุดุงุคูุง ุชููุงุฆููุง) ููุงุฌูุฉ PPP (ูุชุฒุงูู ุ PPTP ุ L2TP ุ SSTP ุ PPPoE ุ OpenVPN *). </p><br><p style=";text-align:right;direction:rtl">  <em>ูุง ูุญุชูู OpenVPN ุนูู ุฑุฃุณ PPP ุ ูููู ููููู ุงุณุชุฎุฏุงู ุงุณู ูุงุฌูุฉ OpenVPN ูุฅูุดุงุก ุงููุณุงุฑ.</em> </p><br><h3 id="more-specific-route" style=";text-align:right;direction:rtl">  ุทุฑูู ุฃูุซุฑ ุชุญุฏูุฏุง </h3><br><p style=";text-align:right;direction:rtl">  ุงููุงุนุฏุฉ ุงูุฃุณุงุณูุฉ ููุชูุฌูู.  ูุญุชูู ุงููุณุงุฑ ุงูุฐู ูุตู ุดุจูุฉ ูุฑุนูุฉ ุฃุตุบุฑ (ูุน ุฃูุจุฑ ููุงุน ุดุจูุฉ ูุฑุนูุฉ) ุนูู ุฃููููุฉ ุฃุนูู ุนูุฏ ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ุชูุฌูู ุงูุญุฒูุฉ.  ูุง ูุฑุชุจุท ููุถุน ุงูุฅุฏุฎุงูุงุช ูู ุฌุฏูู ุงูุชูุฌูู ุจุงูุชุญุฏูุฏ - ุงููุงุนุฏุฉ ุงูุฃุณุงุณูุฉ ูู ุฃูุซุฑ ุชุญุฏูุฏูุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/sm/cy/i9/smcyi9gkebkm8iq-yjcbev8-vs0.png"></p><br><p style=";text-align:right;direction:rtl">  ุฌููุน ุงููุณุงุฑุงุช ูู ุงููุฎุทุท ุงููุญุฏุฏ ูุดุทุฉ (ุชูุน ูู FIB) ุ ูุฃู  ุฃุดุฑ ุฅูู ุดุจูุงุช ูุฑุนูุฉ ูุฎุชููุฉ ููุง ุชุชุนุงุฑุถ ูุน ุจุนุถูุง ุงูุจุนุถ. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุฃุตุจุญุช ุฅุญุฏู ุงูุนุจูุงุฑุงุช ุบูุฑ ูุชููุฑุฉ ุ ูุณูุชู ุงุนุชุจุงุฑ ุงููุณุงุฑ ุงููุฑุชุจุท ุบูุฑ ูุดุท (ุฅุฒุงูุชู ูู FIB) ูุณูุชู ุงูุจุญุซ ุนู ุงูุญุฒู ูู ุงูุทุฑู ุงููุชุจููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุฃุญูุงู ุ ููุนุทู ุงููุณุงุฑ ุฐู ุงูุดุจูุฉ ุงููุฑุนูุฉ 0.0.0.0/0 ุฃูููุฉ ุฎุงุตุฉ ููุณูู "ุงููุณุงุฑ ุงูุงูุชุฑุงุถู" ุฃู "ุจูุงุจุฉ ุงูููุงุฐ ุงูุฃุฎูุฑ".  ูู ุงููุงูุน ุ ูุง ููุฌุฏ ุฃู ุดูุก ุณุญุฑู ููู ููุชุถูู ุจุจุณุงุทุฉ ุฌููุน ุนูุงููู IPv4 ุงูููููุฉ ุ ูููู ูุฐู ุงูุฃุณูุงุก ุชุตู ุงูุบุฑุถ ูููุง ุฌูุฏูุง - ููู ุชุดูุฑ ุฅูู ุจูุงุจุฉ ูููู ุชูุฌูู ุงูุญุฒู ุฅูููุง ูู ุฎูุงููุง ุ ููุง ุชูุฌุฏ ุทุฑู ุฃุฎุฑู ุฃูุซุฑ ุฏูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุญุฏ ุงูุฃูุตู ูููุงุน ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงููููู ูู IPv4 ูู / 32 ุ ูุดูุฑ ูุฐุง ุงููุณุงุฑ ุฅูู ูุถูู ูุญุฏุฏ ููููู ุงุณุชุฎุฏุงูู ูู ุฌุฏูู ุงูุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  <em>ููู ุงูุทุฑูู ุงูุฃูุซุฑ ุชุญุฏูุฏุงู ุฃูุฑ ุฃุณุงุณู ูุฃู ุฌูุงุฒ TCP / IP.</em> </p><br><h3 id="distance" style=";text-align:right;direction:rtl">  ุงููุณุงูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุงููุณุงูุงุช (ุฃู ุงูููุงููุณ) ุถุฑูุฑูุฉ ููุชุตููุฉ ุงูุฅุฏุงุฑูุฉ ููุทุฑู ุงููุคุฏูุฉ ุฅูู ุดุจูุฉ ูุฑุนูุฉ ูุงุญุฏุฉ ูููู ุงููุตูู ุฅูููุง ูู ุฎูุงู ุนุฏุฉ ุจูุงุจุงุช.  ูุนุชุจุฑ ุงูุทุฑูู ุฐู ุงููููุงุณ ุงูุฃุฏูู ุฃููููุฉ ูุณูููู ูู FIB.  ุฅุฐุง ุชููู ุชุดุบูู ูุณุงุฑ ุจู ูููุงุณ ุฃูู ุ ูุณูุชู ุงุณุชุจุฏุงูู ูู ูุณุงุฑ FIB ุจุงุณุชุฎุฏุงู ูุณุงุฑ ุฃุนูู. <br><img src="https://habrastorage.org/webt/dz/yz/mh/dzyzmhb2y_fjqpbkbp2juyhfxsi.png"></p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงูุช ููุงู ุนุฏุฉ ุทุฑู ูุดุจูุฉ ูุฑุนูุฉ ูุงุญุฏุฉ ุจููุณ ุงููููุงุณ ุ ูุฅู ุฌูุงุฒ ุงูุชูุฌูู ุณูุถูู ูุงุญุฏูุง ูููู ููุท ุฅูู ุฌุฏูู FIB ุ ูุณุชุฑุดุฏุงู ุจููุทูู ุงูุฏุงุฎูู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูุณุชุบุฑู ุงููููุงุณ ูููุฉ ูู 0 ุฅูู 255: <br><img src="https://habrastorage.org/webt/rh/fk/j1/rhfkj1shnnjhqmvwhcc7o0itq8i.png"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  0 - ูุชุฑู ููุทุฑู ุงููุชุตูุฉ.  ูุง ูููู ูููุณุงูุฉ ุถุจุท ุงููุณุงูุฉ 0 </li><li style=";text-align:right;direction:rtl">  1-254 - ุงูููุงููุณ ุงููุชุงุญุฉ ูููุณุคูู ุนู ุชุญุฏูุฏ ุงููุณุงุฑุงุช.  ุงูููุงููุณ ุฐุงุช ุงููููุฉ ุงูุฃูู ููุง ุงูุฃุณุจููุฉ. </li><li style=";text-align:right;direction:rtl">  255 - ูุชุฑู ูุชุงุญ ูููุณุคูู ุนู ุชุญุฏูุฏ ุงูุทุฑู.  ุนูู ุนูุณ 1-254 ุ ูุจูู ุงููุณุงุฑ ุงูุฐู ูุญุชูู ุนูู ููุงุณ 255 ุบูุฑ ูุดุท ุฏุงุฆููุง ููุง ููุน ูู FIB </li><li style=";text-align:right;direction:rtl">  ููุงููุณ ุฎุงุตุฉ.  ุชุญุชูู ุงููุณุงุฑุงุช ุงููุณุชููุฉ ูู ุจุฑูุชููููุงุช ุงูุชูุฌูู ุงูุฏููุงููููุฉ ุนูู ููู ููุงุณ ููุงุณูุฉ </li></ul><br><h3 id="check-gateway" style=";text-align:right;direction:rtl">  ุชุญูู ุจูุงุจุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุชุญูู ุจูุงุจุฉ - ุชูุฏูุฏ MikroTik RoutesOS ููุชุญูู ูู ุชูุงูุฑ ุจูุงุจุฉ ุนุจุฑ ICMP ุฃู ARP.  ูุฑุฉ ูุงุญุฏุฉ ูู 10 ุซูุงูู (ูุง ูููู ุชุบููุฑูุง) ุ ูุชู ุฅุฑุณุงู ุทูุจ ุฅูู ุงูุจูุงุจุฉ ุ ุฅุฐุง ูู ุชุชู ุงูุฅุฌุงุจุฉ ูุฑุชูู ุ ูุณูุชู ุงุนุชุจุงุฑ ุงููุณุงุฑ ุบูุฑ ูุชุงุญ ููุชู ุฅุฒุงูุชู ูู FIB.  ุฅุฐุง ูุงูุช ุจูุงุจุฉ ุงููุญุต ูุฏ ุนุทูุช ุทุฑูู ุงูุชุญูู ุ ูุณุชุณุชูุฑ ูุณุชุตุจุญ ุงูุทุฑูู ูุดุทุฉ ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุฅุฌุฑุงุก ูุญุต ูุงุฌุญ ูุงุญุฏ. <br><img src="https://habrastorage.org/webt/a_/km/vd/a_kmvd8xeoeyrnjqz78ciry1ja4.png"></p><br><p style=";text-align:right;direction:rtl">  ุชุญูู ุจูุงุจุฉ ุชุนุทูู ุงูุฅุฏุฎุงู ุงูุฐู ุชู ุชููููู ูุฌููุน ุงูุฅุฏุฎุงูุงุช ุงูุฃุฎุฑู (ูู ุฌููุน ุฌุฏุงูู ุงูุชูุฌูู ููุณุงุฑุงุช ecmp) ูุน ุงูุนุจุงุฑุฉ ุงููุญุฏุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ุชุนูู ุจูุงุจุฉ ุงููุญุต ุจุดูู ุฌูุฏ ุฅุฐุง ูู ุชูู ููุงู ูุดููุฉ ูู ููุฏ ุงูุญุฒูุฉ ุฅูู ุงูุจูุงุจุฉ.  ูุง ุชุนุฑู ุจูุงุจุฉ ุงููุญุต ูุง ูุญุฏุซ ูุน ุงูุงุชุตุงู ุฎุงุฑุฌ ุงูุจูุงุจุฉ ุงูุชู ูุชู ูุญุตูุง ุ ูููุงู ุญุงุฌุฉ ุฅูู ุฃุฏูุงุช ุฅุถุงููุฉ: ุงูุจุฑุงูุฌ ุงููุตูุฉ ุ ุงูุชูุฌูู ุงููุชูุฑุฑ ุ ุจุฑูุชููููุงุช ุงูุชูุฌูู ุงูุฏููุงููููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชุญุชูู ูุนุธู VPNs ูุจุฑูุชููููุงุช ุงูุฃููุงู ุนูู ุฃุฏูุงุช ูุถูููุฉ ููุญุต ูุดุงุท ุงูุงุชุตุงู ุ ูุชูููู ุนุจูุงุฑุงุช ุงููุญุต ุงูุฎุงุตุฉ ุจูู ูู ุญูู ุฅุถุงูู (ููู ุตุบูุฑ ุฌุฏูุง) ุนูู ุฃุฏุงุก ุงูุดุจูุฉ ูุงูุฌูุงุฒ. </p><br><h3 id="ecmp-marshruty" style=";text-align:right;direction:rtl">  ุทุฑู ECMP </h3><br><p style=";text-align:right;direction:rtl">  ูุณุงุฑ ูุชุนุฏุฏ ุงูุชูููุฉ ุนูู ูุฏู ุงููุณุงูุงุฉ - ุฅุฑุณุงู ุญุฒู ุฅูู ุงููุณุชูู ุจุงุณุชุฎุฏุงู ุนุฏุฉ ุจูุงุจุงุช ูู ููุณ ุงูููุช ูุน ุฎูุงุฑุฒููุฉ Round Robin. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุฅูุดุงุก ูุณุงุฑ ECMP ุจูุงุณุทุฉ ุงููุณุคูู ุนู ุทุฑูู ุชุญุฏูุฏ ุจูุงุจุงุช ูุชุนุฏุฏุฉ ูุดุจูุฉ ูุฑุนูุฉ ูุงุญุฏุฉ (ุฃู ุชููุงุฆูุฉ ุ ุฅุฐุง ูุงู ููุงู ุทุฑููุงู ููุงูุฆุงู ูู OSPF). <br><img src="https://habrastorage.org/webt/4v/gz/yh/4vgzyh240kmasdj186yz2c3ovws.png"></p><br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู ECMP ูููุงุฒูุฉ ุงูุญูู ุจูู ููุงุชูู ุ ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ุฅุฐุง ูุงูุช ููุงู ููุงุชุงู ูู ูุณุงุฑ ecmp ุ ููุฌุจ ุฃู ุชููู ุงูููุงุฉ ุงูุตุงุฏุฑุฉ ูุฎุชููุฉ ููู ุญุฒูุฉ.  ููู ุขููุฉ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุชูุฌูู ุชุฑุณู ุญุฒููุง ูู ุงูุงุชุตุงู ุนูู ุทูู ุงููุณุงุฑ ุงูุฐู ุฐูุจุช ุฅููู ุงูุญุฒูุฉ ุงูุฃููู ุ ููุชูุฌุฉ ูุฐูู ุ ุญุตููุง ุนูู ููุน ูู ููุงุฒูุฉ ุงูุชุญููู ููู ุงุชุตุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุจุชุนุทูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุชูุฌูู ุ ูุณูุชู ุชูุณูู ุงูุญุฒู ุงูููุฌูุฏุฉ ูู ูุณุงุฑ ECMP ุจุดูู ุตุญูุญ ุ ูููู ููุงู ูุดููุฉ ูู NAT.  ุชุนุงูุฌ ูุงุนุฏุฉ NAT ุงูุญุฒูุฉ ุงูุฃููู ูู ุงูุงุชุตุงู ููุท (ุชุชู ูุนุงูุฌุฉ ุงูุจุงูู ุชููุงุฆููุง) ูุงููููู ูู ุฃู ุงูุญุฒู ุงูุชู ุชุญูู ุนููุงู ูุตุฏุฑ ูุงุญุฏ ุชูุชูู ูู ูุงุฌูุงุช ูุฎุชููุฉ. <br><img src="https://habrastorage.org/webt/gj/cw/bl/gjcwblj73dmsczyhyqyuchcpdw0.png"></p><br><p style=";text-align:right;direction:rtl">  ูุง ุชุนูู ุจูุงุจุฉ ุงููุญุต (ุนูุฉ RouterOS) ูู ุทุฑู ECMP.  ูููู ููููู ุงูุชุบูุจ ุนูู ูุฐุง ุงูููุฏ ุฅุฐุง ููุช ุจุฅูุดุงุก ุทุฑู ุฅุถุงููุฉ ููุชุญูู ุ ููุง ุณูุนุทู ุงูุฅุฏุฎุงูุงุช ูู ECMP. </p><br><h3 id="filtraciya-sredstvami-routing" style=";text-align:right;direction:rtl">  ุชุตููุฉ ุงูุชูุฌูู </h3><br><p style=";text-align:right;direction:rtl">  ูุญุฏุฏ ุฎูุงุฑ ุงููุชุงุจุฉ ูุง ูุฌุจ ุงูููุงู ุจู ูุน ุงูุญุฒูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃุญุงุฏู ุงูุฅุฑุณุงู - ุงูุฅุฑุณุงู ุฅูู ุงูุจูุงุจุฉ ุงููุญุฏุฏุฉ (ุงููุงุฌูุฉ) </li><li style=";text-align:right;direction:rtl">  ุจูุงูููู - ุฅุณูุงุท ุงูุญุฒูุฉ </li><li style=";text-align:right;direction:rtl">  ุญุธุฑ ุ ูุง ูููู ุงููุตูู ุฅููู - ุฅุณูุงุท ุงูุญุฒูุฉ ูุฅุฑุณุงู ุฑุณุงูุฉ icmp ุฅูู ุงููุฑุณู </li></ul><br><p style=";text-align:right;direction:rtl">  ุนุงุฏุฉู ูุง ุชุณุชุฎุฏู ุงูุชุตููุฉ ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ุชุฃููู ุฅุฑุณุงู ุงูุญุฒู ุจุงูุทุฑููุฉ ุงูุฎุงุทุฆุฉ ุ ุจุงูุทุจุน ููููู ุชุตููุฉ ุฐูู ูู ุฎูุงู ุฌุฏุงุฑ ุงูุญูุงูุฉ. </p><br><h3 id="para-primerov" style=";text-align:right;direction:rtl">  ุจุถุนุฉ ุฃูุซูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุฅุตูุงุญ ุงูุฃุดูุงุก ุงูุฃุณุงุณูุฉ ุญูู ุงูุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุฑุงูุชุฑ ุงูููุฒู ุงููููุฐุฌู</strong> <br><img src="https://habrastorage.org/webt/2a/fk/xx/2afkxxlv7lhluitqufsybt3s5pg.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=10.10.10.1</code> </pre> <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุทุฑูู ุซุงุจุช ุฅูู 0.0.0.0/0 (ุงููุณุงุฑ ุงูุงูุชุฑุงุถู) </li><li style=";text-align:right;direction:rtl">  ุงูุทุฑูู ุงููุชุตู ุนูู ุงููุงุฌูุฉ ูุน ุงููููุฑ </li><li style=";text-align:right;direction:rtl">  ุงูุทุฑูู ุงููุชุตู ุนูู ูุงุฌูุฉ ุงูุดุจูุฉ ุงููุญููุฉ </li></ol><br><p style=";text-align:right;direction:rtl">  <strong>PPPOE ูููุฐุฌู ุฑุงูุชุฑ ุงูุฑุฆูุณูุฉ</strong> <br><img src="https://habrastorage.org/webt/im/wn/8p/imwn8pafrqins6erowkhiek2dqa.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุซุงุจุช ุงูุทุฑูู ุฅูู ุงูุทุฑูู ุงูุงูุชุฑุงุถู ุ ูุถุงู ุชููุงุฆูุง ููุฐ ุฐูู ุงูุญูู  ูุดุงุฑ ุฅูู ุฐูู ูู ุฎุตุงุฆุต ุงูุงุชุตุงู </li><li style=";text-align:right;direction:rtl">  ุงูุทุฑูู ุงููุชุตู ููุงุชุตุงู PPP </li><li style=";text-align:right;direction:rtl">  ุงูุทุฑูู ุงููุชุตู ุนูู ูุงุฌูุฉ ุงูุดุจูุฉ ุงููุญููุฉ </li></ol><br><p style=";text-align:right;direction:rtl">  <strong>ุฌูุงุฒ ุงูุชูุฌูู ุงูููุฒูู ุงููููุฐุฌู ูุน ุงุซููู ูู ููุฏูู ุงูุฎุฏูุงุช ูุงูุชูุฑุงุฑ</strong> <br><img src="https://habrastorage.org/webt/wq/2a/v0/wq2av0eskridghrj9yroknjz76o.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=10.10.10.1 distance=1 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.20.20.1 distance=2</code> </pre> <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุทุฑูู ุซุงุจุช ุฅูู ุงููุณุงุฑ ุงูุงูุชุฑุงุถู ูู ุฎูุงู ุงููููุฑ ุงูุฃูู ูุน ููุงุณ 1 ูุงูุชุญูู ูู ุชูุงูุฑ ุงูุนุจุงุฑุฉ </li><li style=";text-align:right;direction:rtl">  ุทุฑูู ุซุงุจุช ุฅูู ุงููุณุงุฑ ุงูุงูุชุฑุงุถู ูู ุฎูุงู ุงููููุฑ ุงูุซุงูู ูุน ููุงุณ 2 </li><li style=";text-align:right;direction:rtl">  ุทุฑู ูุชุตูุฉ </li></ol><br><p style=";text-align:right;direction:rtl">  ุชูุฑ ุญุฑูุฉ ุงููุฑูุฑ ุฅูู 0.0.0.0/0 ุฎูุงู 10.10.10.1 ุ ูู ุญูู ุฃู ูุฐู ุงูุจูุงุจุฉ ูุชุงุญุฉ ุ ูุฅูุง ูุฅููุง ุชูุชูู ุฅูู 10.20.20.1 </p><br><p style=";text-align:right;direction:rtl">  <em>ูููู ุงุนุชุจุงุฑ ูุซู ูุฐุง ุงููุฎุทุท ุญุฌุฒ ููุงุฉ ุ ูููู ูุง ูุฎูู ูู ุงูุนููุจ.</em>  <em>ุฅุฐุง ุญุฏุซ ุงููุทุงุน ุฎุงุฑุฌ ุจูุงุจุฉ ุงููููุฑ (ุนูู ุณุจูู ุงููุซุงู ุ ุฏุงุฎู ุดุจูุฉ ุงูุฌูุงู) ุ ููู ูุนุฑู ุงูููุฌู ุงูุฎุงุต ุจู ูุณูุณุชูุฑ ูู ุงุนุชุจุงุฑ ุฃู ุงููุณุงุฑ ูุดุท.</em> </p><br><p style=";text-align:right;direction:rtl">  <strong>ุฌูุงุฒ ุงูุชูุฌูู ุงูููุฒูู ุงููููุฐุฌู ูุน ุงุซููู ูู ููุฏูู ุงูุฎุฏูุงุช ุ ุงูุชูุฑุงุฑ ู ECMP</strong> <br><img src="https://habrastorage.org/webt/un/fj/aw/unfjawyzmjdzo6_ekmmg93vlsk8.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=10.10.10.1 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.20.20.1 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.10.10.1,10.20.20.1 distance=1</code> </pre> <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุทุฑู ุซุงุจุชุฉ ููุญุต ุจูุงุจุฉ chack </li><li style=";text-align:right;direction:rtl">  ECMP ุงูุทุฑูู </li><li style=";text-align:right;direction:rtl">  ุทุฑู ูุชุตูุฉ </li></ol><br><p style=";text-align:right;direction:rtl">  ุทุฑู ุงูุชุญูู ูู ุงูููู ุงูุฃุฒุฑู (ููู ุงูุทุฑู ุบูุฑ ุงููุดุทุฉ) ุ ููู ูุฐุง ูุง ูุชุนุงุฑุถ ูุน ุชุดุบูู ุจูุงุจุฉ ุงููุญุต.  ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู (6.44) RoS ุ ูุชู ุฅุนุทุงุก ุงูุฃููููุฉ ุงูุชููุงุฆูุฉ ููุณุงุฑ ECMP ุ ูููู ูู ุงูุฃูุถู ุฅุถุงูุฉ ุทุฑู ุงุฎุชุจุงุฑ ูุฌุฏุงูู ุงูุชูุฌูู ุงูุฃุฎุฑู ( <code>routing-mark</code> ุงูุฎูุงุฑ) </p><br><p style=";text-align:right;direction:rtl">  ูู ุชููู ููุงู ุฒูุงุฏุฉ ูู ุงูุณุฑุนุฉ ุนูู Speedtest ูุงูููุงูุน ุงูููุงุซูุฉ ุงูุฃุฎุฑู (ECMP ุชูุณู ุญุฑูุฉ ุงููุฑูุฑ ุนูู ุงูุงุชุตุงูุงุช ุจุฏูุงู ูู ุงูุญุฒู) ุ ูููู ูุฌุจ ุชุญููู ุชุทุจููุงุช p2p ุจุดูู ุฃุณุฑุน. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุชุตููุฉ ูู ุฎูุงู ุงูุชูุฌูู</strong> <br><img src="https://habrastorage.org/webt/gv/bj/nh/gvbjnhvblrebv9051hd_x8adklo.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=10.10.10.1 add dst-address=192.168.200.0/24 gateway=10.30.30.1 distance=1 add dst-address=192.168.200.0/24 gateway=10.10.10.1 distance=2 type=blackhole</code> </pre> <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุทุฑูู ุซุงุจุช ุฅูู ุงูุทุฑูู ุงูุงูุชุฑุงุถู </li><li style=";text-align:right;direction:rtl">  ุทุฑูู ุซุงุจุช ุฅูู 192.168.200.0/24 ุนุจุฑ ููู ipip </li><li style=";text-align:right;direction:rtl">  ุญุธุฑ ุงูุชูุฌูู ุงูุซุงุจุช ุฅูู 192.168.200.0/24 ูู ุฎูุงู ุฌูุงุฒ ุงูุชูุฌูู ุงูุฎุงุต ุจุงููููุฑ </li></ol><br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑ ุชุตููุฉ ูุง ุชูุชูู ููู ุญุฑูุฉ ุงููุฑูุฑ ุนุจุฑ ุงูุฃููุงู ุฅูู ุฌูุงุฒ ุงูุชูุฌูู ุงูุฎุงุต ุจุงููููุฑ ุนูุฏ ุชุนุทูู ูุงุฌูุฉ ipip.  ูุงุฏุฑุง ูุง ุชููู ูุซู ูุฐู ุงููุฎุทุทุงุช ูุทููุจุฉ ุ ูุฃู  ูู ุงููููู ุชูููุฐ ุงูุญุฌุจ ูู ุฎูุงู ุฌุฏุงุฑ ุงูุญูุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุญููุฉ ุงูุชูุฌูู</strong> <br>  ุญููุฉ ุงูุชูุฌูู ูู ูููู ูุชู ููู ุชุดุบูู ุงูุญุฒูุฉ ุจูู ุฃุฌูุฒุฉ ุงูุชูุฌูู ูุจู ุงูุชูุงุก ุตูุงุญูุฉ ttl.  ุนุงุฏุฉู ูุง ูููู ูุชูุฌุฉ ูุฎุทุฃ ูู ุงูุชูููู ุ ูู ุงูุดุจูุงุช ุงููุจูุฑุฉ ูุชู ุงูุชุนุงูู ูุนู ูู ุฎูุงู ุชูููุฐ ุจุฑูุชููููุงุช ุงูุชูุฌูู ุงูุฏููุงููููุฉ ุ ูู ุงูุดุจูุงุช ุงูุตุบูุฑุฉ - ุนู ุทุฑูู ุงูุฑุนุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุดูุก ูุซู ูุฐุง: <br><img src="https://habrastorage.org/webt/ii/h8/-v/iih8-vpacnim4b6flslcvy-v0eg.png"></p><br><p style=";text-align:right;direction:rtl">  ูุซุงู (ุฃุจุณุท) ููููุฉ ุงูุญุตูู ุนูู ูุชูุฌุฉ ููุงุซูุฉ: <br><img src="https://habrastorage.org/webt/ky/9v/gv/ky9vgvnxvno8x79cbu79be0_buu.png"></p><br><p style=";text-align:right;direction:rtl">  ูุซุงู ุญููุฉ ุงูุชูุฌูู ููุณ ูู ุฃู ูุงุฆุฏุฉ ุนูููุฉ ุ ูููู ููุถุญ ุฃู ุฃุฌูุฒุฉ ุงูุชูุฌูู ููุณุช ูุฏููุง ููุฑุฉ ุนู ุฌุฏูู ุงูุชูุฌูู ูุฌูุฑุงููุง. </p><br><h3 id="policy-base-routing-i-dopolnitelnye-tablicy-marshrutizacii" style=";text-align:right;direction:rtl">  ุชูุฌูู ูุงุนุฏุฉ ุงูุณูุงุณุงุช ูุฌุฏุงูู ุงูุชูุฌูู ุงูุฅุถุงููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงุฎุชูุงุฑ ูุณุงุฑ ุ ูุณุชุฎุฏู ุฌูุงุฒ ุงูุชูุฌูู ุญูููุง ูุงุญุฏูุง ููุท ูู ุฑุฃุณ ุงูุญุฒูุฉ (ุนููุงู Dst.) - ูุฐุง ูู ุงูุชูุฌูู ุงูุฃุณุงุณู.  ูุดูุฑ ุงูุชูุฌูู ุงุณุชูุงุฏูุง ุฅูู ุดุฑูุท ุฃุฎุฑู ุ ูุซู ุนููุงู ุงููุตุฏุฑ ูููุน ุญุฑูุฉ ุงููุฑูุฑ (ToS) ุ ูุงูุชูุงุฒู ุฏูู ECMP ุ ุฅูู ุณูุงุณุฉ ุงูุชูุฌูู ุงูุฃุณุงุณูุฉ (PBR) ููุณุชุฎุฏู ุฌุฏุงูู ุชูุฌูู ุฅุถุงููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cf/31/fj/cf31fjsrsjd2aszbzkl_hmg9wuw.png"></p><br><p style=";text-align:right;direction:rtl">  <em>ุงููุฒูุฏ ูู</em> ุงููุณุงุฑุงุช <em>ุงููุญุฏุฏุฉ</em> ูู ุงููุงุนุฏุฉ ุงูุฃุณุงุณูุฉ ูุงุฎุชูุงุฑ ูุณุงุฑ ุฏุงุฎู ุฌุฏูู ุงูุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุงูุชุฑุงุถู ุ ูุชู ุฅุถุงูุฉ ุฌููุน ููุงุนุฏ ุงูุชูุฌูู ุฅูู ุงูุฌุฏูู ุงูุฑุฆูุณู.  ูููู ูููุณุคูู ุฅูุดุงุก ุนุฏุฏ ุนุดูุงุฆู ูู ุฌุฏุงูู ุงูุชูุฌูู ุงูุฅุถุงููุฉ ูุญุฒู ุงูุชูุฌูู ุฅูููุง.  ุงูููุงุนุฏ ูู ุฌุฏุงูู ูุฎุชููุฉ ูุง ุชุชุนุงุฑุถ ูุน ุจุนุถูุง ุงูุจุนุถ.  ุฅุฐุง ูู ุชุนุซุฑ ุงูุญุฒูุฉ ุนูู ูุงุนุฏุฉ ููุงุณุจุฉ ูู ุงูุฌุฏูู ุงููุญุฏุฏ ุ ูุณุชูุชูู ุฅูู ุงูุฌุฏูู ุงูุฑุฆูุณู. </p><br><p style=";text-align:right;direction:rtl">  ูุซุงู ุงูุชูุฒูุน ูู ุฎูุงู ุฌุฏุงุฑ ุงูุญูุงูุฉ: <br><img src="https://habrastorage.org/webt/uw/nd/jz/uwndjzt8mtfett8l84vg-n65p90.png"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  192.168.100.10 -&gt; 8.8.8.8 <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุณุชูุจู ุญุฑูุฉ ุงููุฑูุฑ ูู 192.168.100.10 <em>ุชุณููุฉ via-isp1</em> ูู <code>[Prerouting|Mangle]</code> </li><li style=";text-align:right;direction:rtl">  ูู ูุฑุญูุฉ ุงูุชูุฌูู ุ ูู ุฌุฏูู <em>via-isp1 ุ</em> ูุชู ุงูุจุญุซ ูู <em>ูุณุงุฑ</em> ูุตู ุฅูู 8.8.8.8 </li><li style=";text-align:right;direction:rtl">  ุชู ุงูุนุซูุฑ ุนูู ุงูุทุฑูู ุ ููุชู ุฅุฑุณุงู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงูุจูุงุจุฉ 10.10.10.1 </li></ol></li><li style=";text-align:right;direction:rtl">  192.168.200.20 -&gt; 8.8.8.8 <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุณุชูุจู ุญุฑูุฉ ุงููุฑูุฑ ูู 192.168.200.20 <em>ุชุณููุฉ via-isp2</em> ูู <code>[Prerouting|Mangle]</code> </li><li style=";text-align:right;direction:rtl">  ูู ูุฑุญูุฉ ุงูุชูุฌูู ุ <em>ูุจุญุซ</em> ุงูุฌุฏูู <em>via-isp2</em> ุนู ุทุฑูู ูุตู ุฅูู 8.8.8.8 </li><li style=";text-align:right;direction:rtl">  ุชู ุงูุนุซูุฑ ุนูู ุงูุทุฑูู ุ ูุชู ุฅุฑุณุงู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงูุจูุงุจุฉ 10.20.20.1 </li></ol></li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุฃุตุจุญุช ุฅุญุฏู ุงูุนุจูุงุฑุงุช (10.10.10.1 ุฃู 10.20.20.1) ุบูุฑ ูุชููุฑุฉ ุ ูุณุชูุชูู ุงูุญุฒูุฉ ุฅูู ุงูุฌุฏูู <em>ุงูุฑุฆูุณู</em> ูุณุชุจุญุซ ุนู ูุณุงุฑ ููุงุณุจ ููุงู </li></ul><br><h3 id="problemy-terminologii" style=";text-align:right;direction:rtl">  ูุถุงูุง ุงููุตุทูุญุงุช </h3><br><p style=";text-align:right;direction:rtl">  RouterOS ูุฏูู ุจุนุถ ุงููุถุงูุง ุงููุตุทูุญุงุช. <br>  ุนูุฏ ุงูุนูู ูุน ุงูููุงุนุฏ ุงูููุฌูุฏุฉ ูู <code>[IP]-&gt;[Routes]</code> ุชุชู ุงูุฅุดุงุฑุฉ ุฅูู ุฌุฏูู ุงูุชูุฌูู ุ ุนูู ุงูุฑุบู ูู ุฃูู ูุดูุฑ ุฅูู ุฃู ุงูุชุณููุฉ: <br><img src="https://habrastorage.org/webt/8i/kh/kh/8ikhkhsxvmlwnh9hd9g-quxnk18.png"></p><br><p style=";text-align:right;direction:rtl">  ูู <code>[IP]-&gt;[Routes]-&gt;[Rule]</code> ูู ุดูุก ุตุญูุญ ุ ูู ุชุณููุฉ ุงูุดุฑุท ูู ุฅุฌุฑุงุก ุงูุฌุฏูู: <br><img src="https://habrastorage.org/webt/0m/hl/5j/0mhl5jj73m7rfm4rvtb5qwpbix4.png"></p><br><h3 id="kak-otpravit-paket-v-opredelennuyu-tablicu-marshrutizacii" style=";text-align:right;direction:rtl">  ููููุฉ ุฅุฑุณุงู ุญุฒูุฉ ุฅูู ุฌุฏูู ุชูุฌูู ูุญุฏุฏ </h3><br><p style=";text-align:right;direction:rtl">  ูููุฑ RouterOS ุนุฏุฉ ุฃุฏูุงุช: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูููุงุนุฏ ูู <code>[IP]-&gt;[Routes]-&gt;[Rules]</code> </li><li style=";text-align:right;direction:rtl">  ุนูุงูุงุช ุงููุณุงุฑ ( <code>action=mark-routing</code> ) ูู <code>[IP]-&gt;[Firewall]-&gt;[Mangle]</code> </li><li style=";text-align:right;direction:rtl">  VRF </li></ul><br><p style=";text-align:right;direction:rtl">  <strong>ุงูููุงุนุฏ <code>[IP]-&gt;[Route]-&gt;[Rules]</code></strong> <br>  ุชุชู ูุนุงูุฌุฉ ุงูููุงุนุฏ ุจุงูุชุณูุณู ุ ุฅุฐุง ูุงูุช ุงูุญุฒูุฉ ูุทุงุจูุฉ ูุดุฑูุท ุงููุงุนุฏุฉ ุ ูุฅููุง ูุง ุชุฐูุจ ุฅูู ุฃุจุนุฏ ูู ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ุชุณูุญ ูู ููุงุนุฏ ุงูุชูุฌูู ุจุชูุณูุน ูุฏุฑุงุช ุงูุชูุฌูู ุ ููุณ ููุท ุนูู ุนููุงู ุงููุณุชูู ุ ูููู ุฃูุถูุง ุนูู ุนููุงู ุงููุตุฏุฑ ูุงููุงุฌูุฉ ุงูุชู ุชู ุงุณุชูุงู ุงูุญุฒูุฉ ุนูููุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hg/ip/py/hgippyt0pgilh0l9zouqqqpbsoe.png"></p><br><p style=";text-align:right;direction:rtl">  ุชุชููู ุงูููุงุนุฏ ูู ุงูุดุฑูุท ูุงูุฅุฌุฑุงุกุงุช: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุดุฑูุท  ููุฑุฑูู ุนูููุงู ูุงุฆูุฉ ุงูุนูุงูุงุช ุงูุชู ูุชู ูู ุฎูุงููุง ุงูุชุญูู ูู ุงูุญุฒูุฉ ูู FIB ุ ููุท ToS ููููุฏ. </li><li style=";text-align:right;direction:rtl">  ุงูุฅุฌุฑุงุกุงุช <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุญุซ - ุฅุฑุณุงู ุญุฒูุฉ ุฅูู ุฌุฏูู </li><li style=";text-align:right;direction:rtl">  ุงูุจุญุซ ููุท ูู ุงูุฌุฏูู - ูู ุจุฅุบูุงู ุงูุญุฒูุฉ ูู ุงูุฌุฏูู ุ ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุณุงุฑ ุ ููู ุชุฐูุจ ุงูุญุฒูุฉ ุฅูู ุงูุฌุฏูู ุงูุฑุฆูุณู </li><li style=";text-align:right;direction:rtl">  ุฅุณูุงุท - ุฅุณูุงุท ุงูุญุฒูุฉ </li><li style=";text-align:right;direction:rtl">  ูุง ูููู ุงููุตูู ุฅููู - ุฅุณูุงุท ุญุฒูุฉ ุฅุนูุงู ุงููุฑุณู </li></ul></li></ul><br><p style=";text-align:right;direction:rtl">  ูู FIB ุ ุชุชู ูุนุงูุฌุฉ ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงูุนูููุงุช ุงููุญููุฉ ูุชุฌุงูุฒ ุงูููุงุนุฏ <code>[IP]-&gt;[Route]-&gt;[Rules]</code> : <br><img src="https://habrastorage.org/webt/yk/f4/gt/ykf4gt4ywwzgbklpyzlyulije8k.png"></p><br><p style=";text-align:right;direction:rtl">  <strong>ุชุนููู <code>[IP]-&gt;[Firewall]-&gt;[Mangle]</code></strong> <br>  ุชุณูุญ ูู ุนูุงูุงุช ุงููุณุงุฑ ุจุชุนููู ุจูุงุจุฉ ุงูุญุฒูุฉ ุจุงุณุชุฎุฏุงู ุฃู ุดุฑูุท ูู ุฌุฏุงุฑ ุงูุญูุงูุฉ ุชูุฑูุจูุง: <br><img src="https://habrastorage.org/webt/la/dh/or/ladhorisauzv81cnmffmkjo6_hi.png"></p><br><p style=";text-align:right;direction:rtl">  <em>ุนูููุง ุ ูุฃููู ููุณูุง ุฌููุนุง ููุทูููู ุ ููุฏ ูุนูู ุจุนุถูู ุจุดูู ุบูุฑ ูุณุชูุฑ.</em> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6b/_m/om/6b_mom-f6nde0zyuy-mr62asho4.png"></p><br><p style=";text-align:right;direction:rtl">  ููุงู ุทุฑููุชุงู ููุถุน ุนูุงูุฉ ุนูู ุงูุญุฒูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุถุจุท <em>ุนูุงูุฉ ุงูุชูุฌูู ุนูู</em> ุงูููุฑ </li><li style=";text-align:right;direction:rtl">  ูู ุฃููุงู ุจุชุนููู <em>ุนูุงูุฉ ุงุชุตุงู</em> ุ ุซู ุงุณุชูุงุฏูุง <em>ุฅูู ุนูุงูุฉ</em> <em>ุชูุฌูู</em> ูุฌููุนุฉ <em>ุนูุงูุงุช ุงูุงุชุตุงู</em> </li></ul><br><p style=";text-align:right;direction:rtl">  ูู ููุงู ุนู ุฌุฏุงุฑ ุงูุญูุงูุฉ ุ ูุชุจุช ุฃู ุงูุฎูุงุฑ ุงูุซุงูู ูู ุงูุฃูุถู ุจุณุจุจ  ูููู ุงูุญูู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุ ูู ุญุงูุฉ ูุถุน ุนูุงูุงุช ุนูู ุงูุทุฑู - ูุฐุง ููุณ ุตุญูุญูุง ุชูุงููุง.  ุทุฑู ุงูุชูููุฒ ูุฐู ููุณุช ูุนุงุฏูุฉ ุฏุงุฆููุง ูุนุงุฏุฉ ูุง ุชุณุชุฎุฏู ูู ุญู ุงููุดููุงุช ุงููุฎุชููุฉ. </p><br><h3 id="primery-ispolzovaniya" style=";text-align:right;direction:rtl">  ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู </h3><br><p style=";text-align:right;direction:rtl">  ููุชูู ุฅูู ุฃูุซูุฉ ูุงุณุชุฎุฏุงู ุณูุงุณุฉ ุงูุชูุฌูู ุงูุชูุฌูู ุ ููู ุงูุฃุณูู ุจูุซูุฑ ุฃู ููุถุญ ููู ููุงุฐุง ูู ูุฐุง ูุทููุจ. </p><br><p style=";text-align:right;direction:rtl">  <strong>MultiWAN ูุงุณุชุฌุงุจุฉ ุญุฑูุฉ ุงููุฑูุฑ (ุงูุฅุฎุฑุงุฌ) ุงูุตุงุฏุฑุฉ</strong> <br>  ูุดููุฉ ุดุงุฆุนุฉ ูู ุชูููู MultiWAN: ูููู ุงููุตูู ุฅูู Mikrotik ูู ุงูุฅูุชุฑูุช ููุท ูู ุฎูุงู ุงููููุฑ "ุงููุดุท". <br><img src="https://habrastorage.org/webt/ob/1p/ph/ob1pph0eph9qvz9nqvt759mptiq.png"></p><br><p style=";text-align:right;direction:rtl">  ูุง ููู ุฌูุงุฒ ุงูุชูุฌูู ุนููุงู IP ุงูุฐู ุฌุงุก ุฅููู ุงูุทูุจ ุ ูุนูุฏ ุฅูุดุงุก ุงุณุชุฌุงุจุฉ ุ ุณูุจุญุซ ุนู ูุณุงุฑ ูู ุฌุฏูู ุงูุชูุฌูู ุ ุญูุซ ูููู ุงูุชูุฌูู ุนุจุฑ isp1 ูุดุทูุง.  ุนูุงูุฉ ุนูู ุฐูู ุ ูู ุงููุฑุฌุญ ุฃู ุชุชู ุชุตููุฉ ูุฐู ุงูุญุฒูุฉ ูู ุงูุทุฑูู ุฅูู ุงููุณุชูู. </p><br><p style=";text-align:right;direction:rtl">  <em>ููุทุฉ ุฃุฎุฑู ูุซูุฑุฉ ููุงูุชูุงู.</em>  <em>ุฅุฐุง ุชู ุชูููู nat ุงููุตุฏุฑ "ุงูุจุณูุท" ุนูู ุงููุงุฌูุฉ ether1: <code>/ip fi nat add out-interface=ether1 action=masquerade</code> ุงูุญุฒูุฉ ุณุชุฐูุจ ุฅูู ุงูุดุจูุฉ ูุน src.</em>  <em>ุนููุงู = 10.10.10.100 ุ ูุงูุชู ุณูู ุชุฒูุฏ ูู ุชูุงูู ุงููุถุน.</em> </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุนุฏุฉ ุทุฑู ูุฅุตูุงุญ ุงููุดููุฉ ุ ููู ุฃููุง ูููุง ูุชุทูุจ ุฌุฏุงูู ุชูุฌูู ุฅุถุงููุฉ: <br><img src="https://habrastorage.org/webt/g9/65/vy/g965vychbnzbsksplywfc3npi90.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=10.10.10.1 check-gateway=ping distance=1 add dst-address=0.0.0.0/0 gateway=10.20.20.1 check-gateway=ping distance=2 add dst-address=0.0.0.0/0 gateway=10.10.10.1 routing-mark=over-isp1 add dst-address=0.0.0.0/0 gateway=10.20.20.1 routing-mark=over-isp2</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>ุจุงุณุชุฎุฏุงู <code>[IP]-&gt;[Route]-&gt;[Rules]</code></strong> <br>  ุญุฏุฏ ุฌุฏูู ุงูุชูุฌูู ุงูุฐู ุณูุชู ุงุณุชุฎุฏุงูู ููุญุฒู ูุน IP ุงููุตุฏุฑ ุงููุญุฏุฏ. <br><img src="https://habrastorage.org/webt/na/lm/b3/nalmb3u0yrde35z0mzdjm1xygr4.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route rule add src-address=10.10.10.100/32 action=lookup-only-in-table table=over-isp1 add src-address=10.20.20.200/32 action=lookup-only-in-table table=over-isp2</code> </pre> <br><p style=";text-align:right;direction:rtl">  <em>ููููู ุงุณุชุฎุฏุงู <code>action=lookup</code> ุ ูููู ูุญุฑูุฉ ุงููุฑูุฑ ุงูุตุงุฏุฑุฉ ุงููุญููุฉ ุ ูุฅู ูุฐุง ุงูุฎูุงุฑ ูุณุชุจุนุฏ ุงูุงุชุตุงูุงุช ูู ุงููุงุฌูุฉ ุงูุฎุงุทุฆุฉ ุชูุงููุง.</em> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ุงููุธุงู ุจุฅูุดุงุก ุญุฒูุฉ ุงุณุชุฌุงุจุฉ ูุน Src.  ุงูุนููุงู: 10.20.20.200 </li><li style=";text-align:right;direction:rtl">  ูู ูุฑุญูุฉ ูุฑุงุฑ ุงูุชูุฌูู (2) ุ ูุชู ูุญุต <code>[IP]-&gt;[Routes]-&gt;[Rules]</code> ููุชู ุฅุฑุณุงู ุงูุญุฒูุฉ ุฅูู ุฌุฏูู ุงูุชูุฌูู <em>over-isp2</em> </li><li style=";text-align:right;direction:rtl">  ููููุง ูุฌุฏูู ุงูุชูุฌูู ุ ูุฌุจ ุฅุฑุณุงู ุงูุญุฒูุฉ ุฅูู ุงูุจูุงุจุฉ 10.20.20.1 ุนุจุฑ ูุงุฌูุฉ ether2 </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/k-/zf/sg/k-zfsgxxdpqbufnwoobbno8d_aq.png"></p><br><p style=";text-align:right;direction:rtl">  ูุง ุชุชุทูุจ ูุฐู ุงูุทุฑููุฉ "ูุชุชุจุน ุงุชุตุงู" ูุนูู ุ ุนูู ุนูุณ ุงุณุชุฎุฏุงู ุฌุฏูู Mangle. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจุงุณุชุฎุฏุงู <code>[IP]-&gt;[Firewall]-&gt;[Mangle]</code></strong> <br>  ูุจุฏุฃ ุงูุงุชุตุงู ุจุงูุญุฒูุฉ ุงููุงุฑุฏุฉ ุ ูุจุงูุชุงูู ูููู ุจูุถุน ุนูุงูุฉ ุนูููุง ( <code>action=mark-connection</code> ) ุ ูุจุงููุณุจุฉ ููุญุฒู ุงูุตุงุฏุฑุฉ ูู ุงูุงุชุตุงู ุงููุญุฏุฏ ุ ูููุง ุจุชุนููู ุชุณููุฉ ุงููุณุงุฑ ( <code>action=mark-routing</code> ). <br><img src="https://habrastorage.org/webt/lg/4v/ni/lg4vni1mt8eteade7mcitz_3s3g.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle #   add chain=input in-interface=ether1 connection-state=new action=mark-connection new-connection-mark=from-isp1 add chain=input in-interface=ether2 connection-state=new action=mark-connection new-connection-mark=from-isp2 #      add chain=output connection-mark=from-isp1 action=mark-routing new-routing-mark=over-isp1 passthrough=no add chain=output connection-mark=from-isp2 action=mark-routing new-routing-mark=over-isp2 passthrough=no</code> </pre> <br><p style=";text-align:right;direction:rtl"> <em>      ip,     <code>dst-address</code>  .</em> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   ether2    .    <code>[INPUT|Mangle]</code>         <em>from-isp2</em> </li><li style=";text-align:right;direction:rtl">      Src. Address: 10.20.20.200 </li><li style=";text-align:right;direction:rtl">   Routing Decision(2)          10.20.20.1   ether1.        <code>[OUTPUT|Filter]</code> </li><li style=";text-align:right;direction:rtl">   <code>[OUTPUT|Mangle]</code>       <em>from-isp2</em>      <em>over-isp2</em> </li><li style=";text-align:right;direction:rtl">   Routing Adjusment(3)             </li><li style=";text-align:right;direction:rtl">            10.20.20.1   ether2 </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rd/mr/qs/rdmrqst9dam9m7r9s4jsnudwdly.png"></p><br><h3 id="multiwan-i-otvetnyy-dst-nat-trafik" style=";text-align:right;direction:rtl"> MultiWAN   dst-nat  </h3><br><p style=";text-align:right;direction:rtl">  ,        ( web)             . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat add chain=dstnat proto=tcp dst-port=80,443 in-interface=ether1 action=dst-nat to-address=192.168.100.100 add chain=dstnat proto=tcp dst-port=80,443 in-interface=ether2 action=dst-nat to-address=192.168.100.100</code> </pre> <br><p style=";text-align:right;direction:rtl">     ,      Firewall Mangle,     : <br><img src="https://habrastorage.org/webt/3w/9i/pq/3w9ipqogda4itpjkpvqbw7ewxrg.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add chain=prerouting connection-state=new in-interface=ether1 protocol=tcp dst-port=80,443 action=mark-connection new-connection-mark=web-input-isp1 add chain=prerouting connection-state=new in-interface=ether2 protocol=tcp dst-port=80,443 action=mark-connection new-connection-mark=web-input-isp2 add chain=prerouting connection-mark=web-input-isp1 in-interface=ether3 action=mark-routing new-routing-mark=over-isp1 passthrough=no add chain=prerouting connection-mark=web-input-isp2 in-interface=ether3 action=mark-routing new-routing-mark=over-isp2 passthrough=no</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fb/qf/np/fbqfnpzfpcshxwzl2ruppyjh5qw.png"><br> <em>    NAT,      .</em> </p><br><h3 id="multiwan-i-ishodyaschie-soedineniya" style=";text-align:right;direction:rtl"> MultiWAN    </h3><br><p style=";text-align:right;direction:rtl">    PBR    vpn (  SSTP)     . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pt/jg/m3/ptjgm36vdijiuvygzwl8csvwg5q.png"></p><br><p style=";text-align:right;direction:rtl">   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=192.168.100.1 routing-mark=over-isp1 add dst-address=0.0.0.0/0 gateway=192.168.200.1 routing-mark=over-isp2 add dst-address=0.0.0.0/0 gateway=192.168.0.1 routing-mark=over-isp3 add dst-address=0.0.0.0/0 gateway=192.168.100.1 distance=1 add dst-address=0.0.0.0/0 gateway=192.168.200.1 distance=2 add dst-address=0.0.0.0/0 gateway=192.168.0.1 distance=3</code> </pre> <br><p style=";text-align:right;direction:rtl">  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add chain=output dst-address=10.10.10.100 proto=tcp dst-port=443 action=mark-routing new-routing-mark=over-isp1 passtrough=no add chain=output dst-address=10.10.10.101 proto=tcp dst-port=443 action=mark-routing new-routing-mark=over-isp2 passtrough=no add chain=output dst-address=10.10.10.102 proto=tcp dst-port=443 action=mark-routing new-routing-mark=over-isp3 passtrough=no</code> </pre> <br><p style=";text-align:right;direction:rtl">   NAT,        Src. Address: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall nat add chain=srcnat out-interface=ether1 action=masquerade add chain=srcnat out-interface=ether2 action=masquerade add chain=srcnat out-interface=ether3 action=masquerade</code> </pre> <br><p style=";text-align:right;direction:rtl"> : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">     SSTP </li><li style=";text-align:right;direction:rtl">   Routing Decision (2)     ,     main.       Src. Address    ether1 </li><li style=";text-align:right;direction:rtl">  <code>[Output|Mangle]</code>        </li><li style=";text-align:right;direction:rtl">         Routing Adjusment        </li><li style=";text-align:right;direction:rtl">       Src. Address  ether1,   <code>[Nat|Srcnat]</code>       </li></ul><br><p style=";text-align:right;direction:rtl"> ,        : <br><img src="https://habrastorage.org/webt/i9/gd/x0/i9gdx0o9s0iqnr4shoxdtfqnh2i.png"></p><br><p style=";text-align:right;direction:rtl"> Connection Tracker   <code>[Mangle]</code>  <code>[Srcnat]</code> ,       ,      <code>Replay Dst. Address</code>    NAT: <br><img src="https://habrastorage.org/webt/ps/op/qa/psopqak9ysxfem9lebg7woyizk4.png"></p><br><p style=";text-align:right;direction:rtl">  VPN  (      )         : <br><img src="https://habrastorage.org/webt/s7/nc/jz/s7ncjzninvkxn_a6-p3wdd5ywnw.png"></p><br><p style=";text-align:right;direction:rtl"> <strong> </strong> <br>   ,         : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=10.10.10.100 gateway=192.168.100.1 add dst-address=10.10.10.101 gateway=192.168.200.1 add dst-address=10.10.10.102 gateway=192.168.0.1</code> </pre> <br><p style=";text-align:right;direction:rtl">              . ,        vpn      ,     6   <code>[IP]-&gt;[Routes]</code>  <code>type=blackhole</code> .    โ 3   <code>[IP]-&gt;[Route]-&gt;[Rules]</code> . </p><br><h3 id="raspredelenie-soedineniy-polzovateley-po-kanalam-svyazi" style=";text-align:right;direction:rtl">       </h3><br><p style=";text-align:right;direction:rtl"> ,  .      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=10.10.10.1 dist=1 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.20.20.1 dist=2 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.10.10.1 dist=1 routing-mark=over-isp1 add dst-address=0.0.0.0/0 gateway=10.20.20.1 dist=1 routing-mark=over-isp2</code> </pre> <br><p style=";text-align:right;direction:rtl"> <strong> <code>[IP]-&gt;[Route]-&gt;[Rules]</code></strong> <br><img src="https://habrastorage.org/webt/-m/4o/jv/-m4ojve7wspajkjoc00afbpsbru.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route rules add src-address=192.168.100.0/25 action=lookup-only-in-table table=over-isp1 add src-address=192.168.100.128/25 action=lookup-only-in-table table=over-isp2</code> </pre> <br><p style=";text-align:right;direction:rtl">   <code>action=lookup</code> ,           main     .     โ   . </p><br><p style=";text-align:right;direction:rtl"> <strong>   <code>[IP]-&gt;[Firewall]-&gt;[Mangle]</code></strong> <br>     ip .       . <em>  layer7,      ,      ,       .</em> <br><img src="https://habrastorage.org/webt/u8/k5/yi/u8k5yito7_iuseo5cki-nhkaz5o.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add chain=prerouting src-address-list=users-over-isp1 dst-address-type=!local action=mark-routing new-routing-mark=over-isp1 add chain=prerouting src-address-list=users-over-isp2 dst-address-type=!local action=mark-routing new-routing-mark=over-isp2</code> </pre> <br><p style=";text-align:right;direction:rtl"> ""        <code>[IP]-&gt;[Route]-&gt;[Rules]</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route rules add routing-mark=over-isp1 action=lookup-only-in-table table=over-isp1 add routing-mark=over-isp2 action=lookup-only-in-table table=over-isp2</code> </pre> <br><p style=";text-align:right;direction:rtl">   <code>[IP]-&gt;[Firewall]-&gt;[Filter]</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall filter add chain=forward routing-mark=over-isp1 out-interface=!ether1 action=reject add chain=forward routing-mark=over-isp2 out-interface=!ether2 action=reject</code> </pre> <br><p style=";text-align:right;direction:rtl"> <strong>  <code>dst-address-type=!local</code></strong> <br>   <code>dst-address-type=!local</code>           (dns, winbox, ssh, ...).       ,          ,   <code>dst-address-table</code> . </p><br><p style=";text-align:right;direction:rtl">     <code>[IP]-&gt;[Route]-&gt;[Rules]</code>   ,      .   ,    FIB    <code>[PREROUTING|Mangle]</code>           main,    .    Routing Rules,            User PBR      . </p><br><p style=";text-align:right;direction:rtl"> <strong> <code>[IP]-&gt;[Firewall]-&gt;[Mangle action=route]</code></strong> <br>      <code>[Prerouting|Mangle]</code>            ,    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add chain=prerouting src-address=192.168.100.0/25 action=route gateway=10.10.10.1 add chain=prerouting src-address=192.168.128.0/25 action=route gateway=10.20.20.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>route</code>        ( <code>[IP]-&gt;[Route]-&gt;[Rules]</code> ).          ,    <code>action=route</code>    <code>action=mark-route</code> ,     (    <code>passtrough</code> ),   . <br> <em> wiki            ,               .</em> </p><br><h3 id="dinamicheskaya-balansirovka-na-osnove-ppc" style=";text-align:right;direction:rtl">     PPC </h3><br><p style=";text-align:right;direction:rtl"> Per Connection Classificator โ     ECMP.    ECMP       (ECMP     ,     Routing Cache   ). </p><br><p style=";text-align:right;direction:rtl"> PCC  <em> </em>  ip ,    32-     <em></em> .       <em></em>    ,    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> .  ,  . <br><img src="https://habrastorage.org/webt/md/xn/kz/mdxnkzst4p7nxatp2bnvjbrlsoe.png"></p><br><p style=";text-align:right;direction:rtl">    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">192.168.100.10: 192+168+100+10 = 470 % 3 = 2 192.168.100.11: 192+168+100+11 = 471 % 3 = 0 192.168.100.12: 192+168+100+12 = 472 % 3 = 1</code> </pre> <br><p style=";text-align:right;direction:rtl">      src.address   : <br><img src="https://habrastorage.org/webt/sq/dn/rt/sqdnrtcsgypqle5ftv2rg23xvmg.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#  /ip route add dst-address=0.0.0.0/0 gateway=10.10.10.1 dist=1 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.20.20.1 dist=2 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.30.30.1 dist=3 check-gateway=ping add dst-address=0.0.0.0/0 gateway=10.10.10.1 dist=1 routing-mark=over-isp1 add dst-address=0.0.0.0/0 gateway=10.20.20.1 dist=1 routing-mark=over-isp2 add dst-address=0.0.0.0/0 gateway=10.30.30.1 dist=1 routing-mark=over-isp3 #    /ip firewall mangle add chain=prerouting in-interface=br-lan dst-address-type=!local connection-state=new per-connection-classifier=src-address:3/0 action=mark-connection new-connection-mark=conn-over-isp1 add chain=prerouting in-interface=br-lan dst-address-type=!local connection-state=new per-connection-classifier=src-address:3/1 action=mark-connection new-connection-mark=conn-over-isp2 add chain=prerouting in-interface=br-lan dst-address-type=!local connection-state=new per-connection-classifier=src-address:3/2 action=mark-connection new-connection-mark=conn-over-isp3 add chain=prerouting in-interface=br-lan connection-mark=conn-over-isp1 action=mark-routing new-routing-mark=over-isp1 add chain=prerouting in-interface=br-lan connection-mark=conn-over-isp2 action=mark-routing new-routing-mark=over-isp2 add chain=prerouting in-interface=br-lan connection-mark=conn-over-isp3 action=mark-routing new-routing-mark=over-isp3</code> </pre> <br><p style=";text-align:right;direction:rtl">      : <code>in-interface=br-lan</code> ,    <code>action=mark-routing</code>               . </p><br><h3 id="pereklyuchenie-kanalov-svyazi" style=";text-align:right;direction:rtl">    </h3><br><p style=";text-align:right;direction:rtl"> Check ping โ  ,        IP ,                 ,            ,   check ping          . <br>           BGP,                 . </p><br><p style=";text-align:right;direction:rtl">   ,        ip    ,      ,  google dns: 8.8.8.8. 8.8.4.4.    Mikrotik      . </p><br><p style=";text-align:right;direction:rtl"> <strong>    </strong> <br>      Multihop BGP               MikroTik,          check gateway       . </p><br><p style=";text-align:right;direction:rtl">         scope/target scope       : <br><img src="https://habrastorage.org/webt/_m/kz/aw/_mkzawioocf0friubndc9q2pofw.png"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">           scope      main      target scope </li><li style=";text-align:right;direction:rtl">     ,        </li><li style=";text-align:right;direction:rtl">   connected        </li></ol><br><p style=";text-align:right;direction:rtl">        ,    : <br><img src="https://habrastorage.org/webt/s4/jo/tv/s4jotv0vsxcofu8pcod2uzugfo4.png"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> 1-3  connected    ,       </li><li style=";text-align:right;direction:rtl"> 4-6   connected   ""  </li></ul><br><p style=";text-align:right;direction:rtl">        RIB,   FIB    : <code>0.0.0.0/0 via 10.10.10.1 on ether1</code> . </p><br><p style=";text-align:right;direction:rtl"> <strong>      </strong> <br><img src="https://habrastorage.org/webt/f1/gd/hj/f1gdhjwli1fqi4yk7i-cfdyf2l0.png"></p><br><p style=";text-align:right;direction:rtl"> : <br><img src="https://habrastorage.org/webt/d8/bb/ae/d8bbaepprp0wswv54ly0ryzphhc.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=0.0.0.0/0 gateway=8.8.8.8 check-gateway=ping distance=1 target-scope=10 add dst-address=8.8.8.8 gateway=10.10.10.1 scope=10 add dst-address=0.0.0.0/0 gateway=10.20.20.1 distance=2</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,      10.10.10.1: <br><img src="https://habrastorage.org/webt/k6/nq/a9/k6nqa98jmecubjxx8e2zndbclcc.png"></p><br><p style=";text-align:right;direction:rtl"> Check gateway          ping'   8.8.8.8,  (   main)    10.10.10.1. </p><br><p style=";text-align:right;direction:rtl">      10.10.10.1  8.8.8.8,    ,   (  ping)  8.8.8.8    10.10.10.1: <br><img src="https://habrastorage.org/webt/hj/v2/tg/hjv2tg5bnkaae2gyr7iunr74kt4.png"></p><br><p style=";text-align:right;direction:rtl">      ether1,    ,    8.8.8.8    : <br><img src="https://habrastorage.org/webt/rt/_d/ad/rt_dadf8--ghn5pmgyg7q1ya258.png"></p><br><p style=";text-align:right;direction:rtl">  ,    NetWatch      8.8.8.8.    NetWatch            .     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add dst-address=8.8.8.8 gateway=10.20.20.1 distance=100 type=blackhole</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ks/6e/k3/ks6ek3swyj9uyiih0bkbef1i6eu.png"></p><br><p style=";text-align:right;direction:rtl">    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ,    NetWatch   . </p><br><p style=";text-align:right;direction:rtl">  ,      8.8.8.8       ,       dns    . </p><br><h3 id="para-slov-pro-virtual-routing-and-forwarding-vrf" style=";text-align:right;direction:rtl">    Virtual Routing and Forwarding (VRF) </h3><br><p style=";text-align:right;direction:rtl">  VRF         ,        (    MPLS)    L3VPN     : <br><img src="https://habrastorage.org/webt/hk/0l/ep/hk0lep0gncmeajzj1pkp2wix6yk.png"></p><br><p style=";text-align:right;direction:rtl">  VRF  Mikrotik         ,   ip      VRF,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> . </p><br><p style=";text-align:right;direction:rtl">   vrf: <br><img src="https://habrastorage.org/webt/gl/g8/k8/glg8k8isgjjsgyjodp7-rnqq5fi.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route vrf add interfaces=ether1 routing-mark=vrf1 add interfaces=ether2 routing-mark=vrf2 /ip address add address=192.168.100.1/24 interface=ether1 network=192.168.100.0 add address=192.168.200.1/24 interface=ether2 network=192.168.200.0</code> </pre> <br><p style=";text-align:right;direction:rtl">     ether2 ,   ping      vrf (  ),   ping    : <br><img src="https://habrastorage.org/webt/pz/a7/h_/pza7h_xts_jyk6czos89h47q45u.png"></p><br><p style=";text-align:right;direction:rtl">            main (  vrf   route leaking): <br><img src="https://habrastorage.org/webt/on/p-/5z/onp-5z4cvah-erroi_flwnjn2ik.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route add distance=1 gateway=172.17.0.1@main routing-mark=vrf1 add distance=1 gateway=172.17.0.1%wlan1 routing-mark=vrf2</code> </pre> <br><p style=";text-align:right;direction:rtl"> <em>    route leaking:   : <code>172.17.0.1@main</code>    : <code>172.17.0.1%wlan1</code> .</em> </p><br><p style=";text-align:right;direction:rtl">        <code>[PREROUTING|Mangle]</code> : <br><img src="https://habrastorage.org/webt/ge/w3/pa/gew3paz7vdzqkzc0-pt0mz5b6yg.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add chain=prerouting in-interface=ether1 action=mark-connection new-connection-mark=from-vrf1 passthrough=no add chain=prerouting connection-mark=from-vrf1 routing-mark=!vrf1 action=mark-routing new-routing-mark=vrf1 passthrough=no add chain=prerouting in-interface=ether2 action=mark-connection new-connection-mark=from-vrf2 passthrough=no add chain=prerouting connection-mark=from-vrf2 routing-mark=!vrf1 action=mark-routing new-routing-mark=vrf2 passthrough=no</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/i8/dd/kx/i8ddkxzzdogtht7gvzyo-rzcr-g.png"></p><br><p style=";text-align:right;direction:rtl"> <strong>   </strong> <br>            VRF  netmap: <br><img src="https://habrastorage.org/webt/yl/vx/kb/ylvxkbg-tyalsczpx9datttwgs0.png"></p><br><p style=";text-align:right;direction:rtl">  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route vrf add interfaces=ether1 routing-mark=vrf1 add interfaces=ether2 routing-mark=vrf2 /ip address add address=192.168.100.1/24 interface=ether1 network=192.168.100.0 add address=192.168.100.1/24 interface=ether2 network=192.168.100.0 add address=192.168.0.1/24 interface=ether3 network=192.168.0.0</code> </pre> <br><p style=";text-align:right;direction:rtl">  firewall: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#        /ip firewall mangle add chain=prerouting dst-address=192.168.101.0/24 in-interface=ether3 action=mark-routing new-routing-mark=vrf1 passthrough=no add chain=prerouting dst-address=192.168.102.0/24 in-interface=ether3 action=mark-routing new-routing-mark=vrf2 passthrough=no # netmap   ""     /ip firewall nat add chain=dstnat dst-address=192.168.101.0/24 in-interface=ether3 action=netmap to-addresses=192.168.100.0/24 add chain=dstnat dst-address=192.168.102.0/24 in-interface=ether3 action=netmap to-addresses=192.168.100.0/24</code> </pre> <br><p style=";text-align:right;direction:rtl">     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#      route leaking,       connected  /ip route add distance=1 dst-address=192.168.0.0/24 gateway=ether3 routing-mark=vrf1 add distance=1 dst-address=192.168.0.0/24 gateway=ether3 routing-mark=vrf2</code> </pre> <br><p style=";text-align:right;direction:rtl"> <strong>    dhcp    </strong> <br> VRF   ,       (  dhcp client)    . </p><br><p style=";text-align:right;direction:rtl">    vrf: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip route vrf add interface=ether1 routing-mark=over-isp1</code> </pre> <br><p style=";text-align:right;direction:rtl">     (  )   <em>over-isp1</em> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/ip firewall mangle add chain=output out-interface=!br-lan action=mark-routing new-routing-mark=over-isp1 passthrough=no add chain=prerouting in-interface=br-lan dst-address-type=!local action=mark-routing new-routing-mark=over-isp1 passthrough=no</code> </pre> <br><p style=";text-align:right;direction:rtl"> ,      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/interface bridge add name=bare /ip route add dst-address=0.0.0.0/0 gateway=bare</code> </pre> <br><p style=";text-align:right;direction:rtl">            Routing decision (2)  <code>[OUTPUT|Mangle]</code>    ,         0.0.0.0/0   main   . <br><img src="https://habrastorage.org/webt/ff/p-/qh/ffp-qhi41y5wxswp6wzrtp69bjk.png"></p><br><h3 id="cepochki-connected-in-i-dynamic-in-v-routing---filters" style=";text-align:right;direction:rtl">  <code>connected-in</code>  <code>dynamic-in</code>  <code>[Routing] -&gt; [Filters]</code> </h3><br><p style=";text-align:right;direction:rtl">   (  ) โ           (      <em>routing</em> ),        : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> connected-in โ  connected  </li><li style=";text-align:right;direction:rtl"> dynamic-in โ     PPP  DCHP </li></ul><br><p style=";text-align:right;direction:rtl">      ,     : distance, routing-mark, comment, scope, target scope, ... </p><br><p style=";text-align:right;direction:rtl">         -  Routing Filters (  ),    Routing Filters,           .     Routing Filters      . </p><br><p style=";text-align:right;direction:rtl"> <strong> Routing Mark   </strong> <br>    .     VPN            .     -      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#  vpn    default route    /interface pptp-client add connect-to=XXXX add-default-route=yes default-route-distance=101 ... add connect-to=YYYY add-default-route=yes default-route-distance=100 ... #             /routing filter add chain=dynamic-in distance=100 prefix=0.0.0.0/0 action=passthrough set-routing-mark=over-vpn1 add chain=dynamic-in distance=101 prefix=0.0.0.0/0 action=passthrough set-routing-mark=over-vpn2</code> </pre> <br><p style=";text-align:right;direction:rtl"> <em>  ,  ,    vrf  ppp ,    0.0.0.0/0     main.      .</em> </p><br><p style=";text-align:right;direction:rtl"> <strong> Connected </strong> <br>    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">/route filter add chain=connected-in prefix=192.168.100.0/24 action=reject</code> </pre> <br><h3 id="instrumenty-otladki" style=";text-align:right;direction:rtl">   </h3><br><p style=";text-align:right;direction:rtl"> RouterOS      : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <code>[Tool]-&gt;[Torch]</code> โ      </li><li style=";text-align:right;direction:rtl"> <code>/ip route check</code> โ        ,      </li><li style=";text-align:right;direction:rtl"> <code>/ping routing-table=&lt;name&gt;</code>  <code>/tool traceroute routing-table=&lt;name&gt;</code> โ ping       </li><li style=";text-align:right;direction:rtl"> <code>action=log</code>  <code>[IP]-&gt;[Firewall]</code> โ  ,       packet flow,         </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar443788/">https://habr.com/ru/post/ar443788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar443774/index.html">ููู ุชุชุฏุฎู ุงูุจููููุฌูุง ุงูุนุตุจูุฉ ูู ุงูุงูุชุฎุงุจุงุช ุงูุฑุฆุงุณูุฉ ุงูุฃูุฑูููุฉ</a></li>
<li><a href="../ar443776/index.html">ุงูุตูู ุชูุฏู ูุธุงู ุชุฌุฑูุจู ููุชุนุฑู ุนูู ุงููุฌูู ุนูุฏ ุงูุฏูุน ููุงุจู ุงููุชุฑู</a></li>
<li><a href="../ar443780/index.html">ูุดุฑูุน MCDM. ุงูุฌุฒุก 1. ููููู</a></li>
<li><a href="../ar443782/index.html">ูููู ูููุทูุฑูู ุงูุขู ุงุณุชุฎุฏุงู API ูุดุจูุฉ Valve ูุฃูุนุงุจ Steam ุงูุฎุงุตุฉ ุจูู</a></li>
<li><a href="../ar443786/index.html">ุชุญููู ูุณุงุจูุฉ ูุณุงุจูุฉ Android ุงูุซุงููุฉ ูู ููุตุฉ HeadHunter ูู Mobius 2018 Moscow</a></li>
<li><a href="../ar443790/index.html">ุฎุทุฃ ุงููุงุฌู</a></li>
<li><a href="../ar443792/index.html">ุฃุฎุทุงุก ูููุฐุฌูุฉ ุนูุฏ ุงูุนูู ูุน PostgreSQL. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar443794/index.html">ุงูุงุชุฌุงูุงุช ุงูุฑุฆูุณูุฉ ูุดุฑูุงุช ุชูููููุฌูุง ุงููุนูููุงุช ุงููุงุดุฆุฉ ูู ูุฌุงู ูุจูุนุงุช ุงูุนูุงุฑุงุช</a></li>
<li><a href="../ar443798/index.html">ุงูุงุฎุชุฑุงูุงุช Zotero: ุชุฎุฒูู ุบูุฑ ูุชุฒุงูู ุบูุฑ ูุญุฏูุฏ ูุงุณุชุฎุฏุงูู ุงูุณูุณ ูุน rmarkdown</a></li>
<li><a href="../ar443804/index.html">C # ูู ูุบุฉ ููุฎูุถุฉ ุงููุณุชููุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>