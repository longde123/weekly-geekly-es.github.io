<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíµ üë©üèª‚Äçüî¨ üßîüèΩ Otimizando o carregamento do JavaScript na Wikipedia ü•ó üé´ üëÇüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O autor do material, cuja tradu√ß√£o publicamos hoje, diz que, em meados de setembro de 2019, finalmente concluiu o projeto em que trabalha h√° um ano. O...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otimizando o carregamento do JavaScript na Wikipedia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470874/">  O autor do material, cuja tradu√ß√£o publicamos hoje, diz que, em meados de setembro de 2019, finalmente concluiu o projeto em que trabalha h√° um ano.  O objetivo deste projeto era reduzir o tamanho do manifesto necess√°rio para inicializar o pipeline JavaScript ass√≠ncrono da Wikipedia.  Ou seja, o tamanho do manifesto era 36 Kb.  Tinha que caber em menos de 28 Kb, o que corresponde a dois fragmentos de 14 kilobytes da sequ√™ncia de pacotes da Internet. <br><br>  O resultado deste projeto foi uma economia di√°ria de 4,3 terabytes de tr√°fego. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6fe/198/a19/6fe198a19b0e143d1bb82788cada2024.png"></div><br>  <i><font color="#999999">No in√≠cio, o tamanho do manifesto excedia 36 Kb e, ap√≥s a otimiza√ß√£o, seu tamanho se tornava menor que 28 Kb</font></i> <br><br>  O gr√°fico mostra uma diminui√ß√£o gradual no tamanho do manifesto.  Estamos falando de dados compactados (ou seja, √© a carga l√≠quida na rede, que cria a transfer√™ncia desses dados do servidor para o navegador). <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Processo de otimiza√ß√£o</font> </h2><br>  O manifesto de inicializa√ß√£o √© representado por dados que n√£o s√£o f√°ceis de otimizar.  A maior parte de seu c√≥digo n√£o √© algo como l√≥gica funcional que pode ser otimizada pelos meios tradicionais.  Em vez disso, quase todo o manifesto √© representado por dados puros.  Esses dados s√£o gerados automaticamente pelo sistema de entrega de conte√∫do do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ResourceLoader</a> .  Eles s√£o um registro de pacotes configur√°veis ‚Äã‚Äãdo m√≥dulo.  A Wikipedia usa o sistema ResourceLoader para trabalhar com JavaScript, CSS e recursos de texto. <br><br>  O registro inclui metadados para todas as funcionalidades de front-end implantadas na Wikipedia.  O manifesto lista os nomes dos pacotes configur√°veis, suas vers√µes atuais e suas depend√™ncias de outros pacotes configur√°veis ‚Äã‚Äãsimilares aqui descritos. <br><br>  Comecei procurando um c√≥digo que nunca foi usado na pr√°tica ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">T202154</a> ).  Isso incluiu a localiza√ß√£o de trechos de c√≥digo incompletos ou esquecidos relacionados aos recursos herdados.  O c√≥digo n√£o utilizado foi removido imediatamente, garantindo a compatibilidade com navegadores que n√£o passaram mais no nosso teste, o que garantiu sua inclus√£o no grupo de navegadores modernos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grade A</a> ).  Tamb√©m preparei um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documento</a> sobre o desempenho de carregamento da p√°gina.  Este documento serviu de refer√™ncia, permitindo que os desenvolvedores entendam o impacto de altera√ß√µes de v√°rios tipos nos v√°rios est√°gios do processo de carregamento da p√°gina. <br><br><h2>  <font color="#3AC1EF">Reduza o n√∫mero de m√≥dulos</font> </h2><br>  O pr√≥ximo passo foi colaborar com as equipes de engenharia da Wikimedia Foundation e da Wikimedia Deutschland.  Precis√°vamos descobrir quais recursos do sistema usam um n√∫mero excessivo de m√≥dulos.  Por exemplo, tendo entendido isso, seria poss√≠vel combinar pacotes anteriormente dispersos a partir dos quais uma certa funcionalidade foi constru√≠da.  Esses pacotes, mesmo em um estado disperso, sempre carregados juntos.  Isso levaria ao fato de que haveria menos pontos de extremidade no sistema cujos metadados deveriam ser armazenados no registro formado pelo ResourceLoader. <br><br>  Aqui est√£o alguns pontos interessantes sobre a aplica√ß√£o dessa abordagem de otimiza√ß√£o: <br><br><ul><li>  A extens√£o WikiEditor agora tem 11 menos m√≥dulos do que antes.  Outros 31 m√≥dulos foram removidos do UploadWizard. </li><li>  Ao otimizar o programa ContentTranslation, 24 m√≥dulos foram combinados. </li><li>  O projeto MobileFrontend combina 25 m√≥dulos. </li><li>  20 m√≥dulos removidos do RevisionSlider e TwoColConflict. </li></ul><br>  Tamb√©m √© muito importante que o cliente Wikidata para Wikipedia tenha sido otimizado.  Essa parte do trabalho em si foi um projeto √©pico ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">T203696</a> ).  Inicialmente, 248 m√≥dulos individuais foram respons√°veis ‚Äã‚Äãpela implementa√ß√£o desse recurso.  Depois que conseguimos nos livrar de mais de 200 m√≥dulos, havia apenas 42 deles. <br><br>  O diagrama acima mostra as pequenas melhorias que foram feitas no projeto ao longo do ano.  Todos eles nos aproximaram do objetivo.  Gostaria especialmente de observar duas grandes quedas no tamanho do manifesto.  Uma dessas quedas ocorreu na primeira semana de agosto.  Foi ent√£o que uma vers√£o aprimorada do Wikidata foi implantada.  A segunda queda no tamanho pode ser observada no final do gr√°fico.  Isso aconteceu em meados de setembro.  Agora eu gostaria de falar sobre ele. <br><br><h2>  <font color="#3AC1EF">Reduzir tamanhos de metadados</font> </h2><br>  A melhoria no manifesto que ocorreu em meados de setembro foi possibilitada por duas mudan√ßas globais destinadas a uma organiza√ß√£o de dados mais inteligente. <br><br>  A primeira melhoria √© que, anteriormente, os metadados do esquema de extens√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">EventLogging</a> faziam parte do manifesto principal.  Esse mecanismo foi refatorado, tornando assim os metadados do esquema agora inclu√≠dos no pacote JS do cliente EventLogging.  Como resultado, a contribui√ß√£o para o tamanho do manifesto feita anteriormente pelo EventLogging foi reduzida em mais de 90%.  Isso significava que o caminho cr√≠tico agora cont√©m 2 KB a menos de dados!  Al√©m disso, isso significava que a expans√£o dos recursos do EventLogging n√£o levava mais a um aumento no tamanho do manifesto.  Ao montar esses pacotes configur√°veis, um novo recurso do ResourceLoader, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arquivos de Pacote, foi usado</a> .  Esse recurso foi introduzido em fevereiro de 2019, um dos motivos de interesse, pois pode ajudar a reduzir o n√∫mero de m√≥dulos no registro.  Os arquivos de pacote simplificam bastante o processo de combina√ß√£o de dados gerados e c√≥digo JavaScript em um √∫nico m√≥dulo. <br><br>  A segunda melhoria ocorreu quando reduzimos o tamanho m√©dio de cada entrada do registro ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">T229245</a> ).  O manifesto cont√©m duas entradas para cada m√≥dulo.  Este √© o nome do m√≥dulo e o identificador (ID) de sua vers√£o.  O identificador de vers√£o anteriormente precisava de 7 bytes de dados.  Depois de pensar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no paradoxo do anivers√°rio</a> no contexto do ResourceLoader, decidimos que o espectro de probabilidade para IDs de vers√£o poderia ser reduzido com seguran√ßa de 78 bilh√µes para "apenas" 60 milh√µes.  Detalhes sobre isso podem ser encontrados nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coment√°rios</a> do c√≥digo.  Mas, para resumir essa melhoria, podemos dizer que isso nos permitiu economizar 2 bytes na descri√ß√£o de cada um dos 1.100 m√≥dulos que ainda est√£o no registro.  Como resultado, o tamanho do manifesto foi reduzido em outros 2-3 Kb. <br><br>  Abaixo est√° um fragmento ampliado do diagrama, mostrando os √∫ltimos dias de opera√ß√£o (esses indicadores s√£o obtidos do sistema de monitoramento sint√©tico, dados n√£o compactados s√£o usados ‚Äã‚Äãaqui). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfb/f35/fad/cfbf35fad375e7141350e3e432039c22.png"></div><br>  <i><font color="#999999">Redimensionamento do manifesto na fase final de um projeto</font></i> <br><br>  A mudan√ßa foi capturada pelo sistema de monitoramento ResourceLoader.  A captura de tela mostra o painel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tamanho do manifesto de inicializa√ß√£o</a> localizado em uma inst√¢ncia p√∫blica do Grafana.  Aqui voc√™ pode ver que o tamanho do fluxo de dados descompactado diminuiu 2,8 Kb. <br><br>  A implanta√ß√£o do sistema, realizada em meados de setembro, levou √† consecu√ß√£o do objetivo original, que era comprimir o manifesto para um tamanho n√£o superior a 28 Kb.  A implementa√ß√£o desse projeto de larga escala levou ao fato de que o manifesto de inicializa√ß√£o foi reduzido em 9 Kb (estamos falando de dados compactados).  H√° um ano, esse tamanho era de 36,2 Kb e, ap√≥s a conclus√£o do projeto, j√° era de 27,2 Kb. <br><br>  Cerca de 363.000 visualiza√ß√µes de p√°gina s√£o geradas a cada minuto na Wikipedia e em projetos relacionados.  Em uma hora - 21 milh√µes e 800 mil.  Diariamente - 523 milh√µes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui est√£o as</a> estat√≠sticas das visualiza√ß√µes de p√°gina).  Essa vers√£o do sistema, implantada em meados de setembro, gerou uma economia de aproximadamente 1,4 terabytes de tr√°fego por dia.  E se voc√™ comparar o que √© hoje com o que era um ano atr√°s, acontece que 4,3 terabytes de tr√°fego agora s√£o salvos diariamente. <br><br><h2>  <font color="#3AC1EF">O que vem a seguir?</font> </h2><br>  Conseguimos ajustar o manifesto de inicializa√ß√£o do Wikipedia de 28 Kb.  Esse √© o tamanho escolhido devido ao tamanho menor e m√∫ltiplo de 14 Kb.  Dados desse tamanho podem ser colocados em fragmentos da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sequ√™ncia de</a> pacotes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">da</a> Internet transmitidos ao navegador. <br><br>  Agora enfrentamos uma nova tarefa: n√£o desistir de posi√ß√µes.  No ano passado, eu tenho observado de perto o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manifesto</a> .  Fiz isso para garantir nosso sucesso e descobrir poss√≠veis problemas que est√£o nos afastando.  No final, automatizei esse processo usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">painel</a> p√∫blico da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grafana</a> . <br><br>  Se voc√™ acredita neste painel, ainda temos muitas oportunidades para melhorar o empacotamento do c√≥digo e resolver problemas ainda mais fortes do que agora, facilitar a cria√ß√£o de pacotes.  Espero que essas pr√≥ximas melhorias sejam √∫teis para n√≥s, mas por enquanto estamos trabalhando em novos recursos do sistema, enquanto nos esfor√ßamos para cumprir os requisitos para o n√≠vel de desempenho do projeto. <br><br>  <b>Caros leitores!</b>  Voc√™ j√° participou da otimiza√ß√£o de grandes projetos da Internet? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470874/">https://habr.com/ru/post/pt470874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470858/index.html">Antiguidades: Refer√™ncia do 386¬∫ processador e dos anos 90</a></li>
<li><a href="../pt470864/index.html">Sobre as del√≠cias de mudar para o painel e n√£o apenas</a></li>
<li><a href="../pt470868/index.html">Hora do primeiro byte: o que √© e por que √© importante</a></li>
<li><a href="../pt470870/index.html">Pr√©-carregando fontes</a></li>
<li><a href="../pt470872/index.html">M√©tricas de desempenho para pesquisar aplicativos da Web incrivelmente r√°pidos</a></li>
<li><a href="../pt470876/index.html">Crie constru√ß√µes de sintaxe JavaScript personalizadas usando Babel. Parte 1</a></li>
<li><a href="../pt470878/index.html">Crie constru√ß√µes de sintaxe JavaScript personalizadas usando Babel. Parte 2</a></li>
<li><a href="../pt470880/index.html">Mec√¢nica de jogo. Aventura, o conceito de zero e terapia da fala convincente</a></li>
<li><a href="../pt470882/index.html">Por que voc√™ pegou meu mouse ou um jogo de tabuleiro como modelo de intera√ß√£o social</a></li>
<li><a href="../pt470884/index.html">Escrevendo e lendo dados no blockchain Bitcoin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>