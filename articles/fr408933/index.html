<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧒🏼 🗺️ 👍🏼 Remplacement d'un pressostat mécanique par un pressostat numérique (aux propriétaires de puits) 🎠 🏊 💪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La première fois que j'ai dû régler un pressostat mécanique à ressorts, j'ai réalisé que j'avais besoin d'un appel à un ami, ou plutôt à mon père, car...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Remplacement d'un pressostat mécanique par un pressostat numérique (aux propriétaires de puits)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/408933/"> La première fois que j'ai dû régler un pressostat mécanique à ressorts, j'ai réalisé que j'avais besoin d'un appel à un ami, ou plutôt à mon père, car le mécanisme, bien que bien pensé et tolérant aux pannes, est à un niveau élevé, mais il y a un inconvénient, même un ajustement unique du visage . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/13e/24d/072/13e24d0724dea32524577289dea261f6.jpg" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/953/7be/772/9537be77296c01b41348a4e722cef8bf.jpg" alt="image"></div><br>  Je demande une coupe, c'est plus intéressant là-bas;) <br><a name="habracut"></a><br>  Je l'ai en quelque sorte compris et j'ai même réussi à l'ajuster, mais j'ai passé du temps et des nerfs à ce sujet.  Ensuite, j'ai réalisé qu'un relais numérique serait génial, il suffit d'appuyer sur les boutons et de régler celui souhaité.  Bien sûr, beaucoup peuvent me condamner à plusieurs égards: <br><br>  "Vous êtes un imbécile que vous ne pouvez pas gérer le pressostat le plus simple et les deux ressorts." <br>  - la mécanique dirige, cela fonctionnera pour toujours. <br>  - pourquoi y a-t-il quelque chose à réglementer: une fois un plombier fixé pour XX * (taux du pays) roubles et tout <br><br>  Sans problème, vous pouvez continuer la liste pendant longtemps, mais par la nature de votre ingénierie, j'aimerais tout développer et améliorer tout autour de moi, sans tordre les ressorts et penser quand les contacts du relais mécanique y brûlent et que le relais de protection de la pompe thermique commence à fonctionner quand vous êtes tous en savon: D, et encore mieux ta femme :) <br><br>  Nous devons rendre hommage, le relais mécanique fonctionne déjà pour moi depuis la 4ème année et rien ne s'est passé avec ça (pah pah pah), j'ai juste eu à reconstruire, nettoyer les contacts, et ces "CLIC!" Ont commencé à briller.  ils se sont un peu tendus dans le garage et ... ont fait peur à ma souris, de sorte qu'il a dû s'enfuir. <br><br><div class="spoiler">  <b class="spoiler_title">Échapper</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/-fVq93IuNN0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Depuis que j'aime l'automatisation et que je suis passé du 1 fil à l'arduino en passant par l'esp, je peux et fais divers métiers à la maison, ou plutôt des appareils, pour vous faciliter la vie.  Le cercle d'amis connaît la liste des projets que j'essaie de terminer et de mettre en œuvre, mais il n'y a absolument pas de temps pour cela.  Cette construction du bain se déroulera pour tout l'été (750 heures), puis la neige s'accumulera :), et voici la nouvelle année au nez! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/d20/61c/46b/d2061c46b4400e77cb2c657f745003d9.jpg" alt="image"></div><br>  Beaucoup de gens m'aiment aussi, en particulier dans le domaine informatique.  Mais ce n'est qu'amusant, la vie est une chose intéressante, et sans elle en aucune façon.  Un grand merci également à tous ceux qui me soutiennent - sans vos aimables paroles, la motivation ne serait pas la même.  Merci à ma femme d'avoir compris l'amour de mes planches) <br><br>  Des paroles, nous sautons dans la réalité.  Je me suis tourné à la recherche d'un relais numérique et j'ai réalisé que c'était très difficile dans cette direction, soit étrangère pour 100 $ et pas du tout comme je le souhaiterais ... soit mécanicien pour 15 $.  Je l'apporte en $, car on sait depuis longtemps que si nous passions à $, même les grands-mères ne se baigneraient pas, comme avec les pièces.  Mais je suis un coquin - la maison est connectée à Internet, mais il n'y a pas de pressostat - fou! <br><br>  Thème pour les trolls: j'ai commencé à travailler avec Arduino d'origine chinoise, pas les originaux, mais les chinois, ils fonctionnent de la même manière, où il y a des erreurs mineures, mais ils ne me blessent pas de manière à cracher de la lave de négatif et à secouer esp8266, qui meurt de l'électricité statique plus rapidement que vous allez le brancher sur votre ordinateur, et même avec une alimentation 3,3, que vous devez aller chercher), à moins que ce ne soit NodeMCU, que j'adore. <br><br>  J'adore esp8266 et Arduino et les gens, mais pour s'asseoir rapidement pour assembler un appareil d'automatisation fonctionnel et stable, arduino est une chose indispensable + Le câblage en langage C aide beaucoup à réaliser rapidement ce qui est requis.  (personne ne reprochera ce que vous avez écrit dans le langage de script Lua de frein).  esp8266 (mon avis) - bon là où vous n'avez pas besoin de mesurer l'ADC et Internet est nécessaire.  Bien que sa "combustion \ humidité" soit très décevante. <br><br>  Nous revenons à nos moutons, c'est-à-dire un relais :) <br><br>  En conséquence, j'ai trouvé un capteur en Chine pour 5 $, avec un ADC 0-5V et j'ai décidé de l'essayer.  Pas même ainsi, j'ai bêtement tiré pour l'appliquer et assembler l'appareil.  Des fantasmes érotiques immédiats ont commencé, comment les LED clignotent) et les boutons de réglage sont pressés, et les chiffres chéris s'allumeront sur l'écran bleu emblématique chinois et tout cela fonctionnera avec une pression réelle dans notre peigne. <br><br>  J'ai réfléchi, je l'ai décrit, dessiné, planifié, commandé et j'ai commencé à écrire le code jusqu'à ce que l'érotisme passe avec des pensées. <br><br>  Quand le capteur est arrivé, j'ai réalisé que le capteur était très bien fait. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/cac/9f7/0e4/cac9f70e428dc26b50ef47c3f69e21a3.jpg" alt="image"></div><br>  De plus, j'ai réalisé qu'il commençait à montrer des données non pas à partir de zéro, mais de 0,5 V à 4,5 V.  de 0 à 12 bar.  J'étais très content, car j'étais content de reconnaître la singularité de cet appareil, vous pouvez suivre quand le capteur meurt et n'affiche pas le convoité 0,5 à la sortie. <br><br>  Insertion du capteur dans le système actuel, laissant la mécanique «au cas où». <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/953/ff1/9a8/953ff19a89efd97c7de0c335a0d841a0.jpg" alt="image"></div><br>  Une chose est triste, il n'y avait pas de données sur le capteur, comment calculer ses lectures, mais comme il y avait une ligne linéaire sur le graphique, j'ai dû (honteux, je l'admets) - ouvrir le manuel ALGEBRA et réapprendre, rappelez-vous comment ils construisent une relation linéaire directe dans équation :) par deux points et à propos d'un miracle, j'ai rapidement obtenu (vous pouvez me faire honte) une formule simple chérie dans laquelle, après avoir converti le signal ADC en VOLTS, j'ai compris combien de pression j'ai en bar.  Étant donné que le capteur lui-même a émis de 0 à 1,2 Mpa - il n'est pas difficile de traduire en Bar - sachant que: <br><br>  1 Pa = 1,0E-5 bar <br>  soit 1200000Pa = 12Bar <br>  La pression de la pompe ne dépassant pas 4Bar, ce capteur suffit pour les yeux! <br><br>  Ensuite, j'ai pris l'Arduino Uno - il traînait trop, je l'utilise généralement pour la conception articulée rapide, les tests, puis j'utilise l'Arduino Nano, car il est dépourvu du kit de carrosserie gauche et sa taille est 3 fois plus petite!  Et oui, les Arduinistes d'origine chinoise me pardonneront, j'étais désolé de la regarder au ralenti, je dois la laisser entrer dans l'appareil!  J'ai pensé et acheté une petite boîte en plastique IP55, j'ai bu un trou sous l'écran, que j'ai acheté il y a 4 ans!  Karl!  Et puis je ne savais pas que cet écran LCD 16 * 2 se lancerait dans une entreprise aussi utile.  J'ai pris 2 boutons automatiques sur le marché automobile, soudé les fils et je n'ai même pas conçu la carte séparément, comme je le fais pour Nano - car Uno est stupidement grand et pas du tout à de telles fins. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/a6e/c78/d35/a6ec78d35d2e73c21da5ab9f53bfbd25.jpg" alt="image"><br><br>  L'algorithme est assez simple et subit toujours des tests sur le terrain, le code du projet pour y regarder de plus près se trouve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Je n'ai pas honte de l'afficher s'il y a des critiques constructives, je suis prêt à apporter des modifications, car il est ouvert à toute discussion. <br><br>  J'ai essayé d'incorporer les principes suivants dans l'algorithme: <br><br>  - Initialisation des données: au démarrage, toutes les variables de fonctionnement sont vérifiées et initiées <br>  - Interrogation initiale du capteur: on vérifie si le capteur n'est pas tombé en panne (en cas de panne, le relais de la pompe est coupé juste au cas où) les données sont calculées et transférées à la pression actuelle dans le peigne (peigne de distribution, auquel les voisins sont connectés + entrée de pompe + accumulateur hydraulique) si tout est dans la pression de consigne inférieure et supérieure, alors nous continuons d'écouter et de calculer les données <br>  - Les données sont affichées visuellement à l'écran sous la forme: <br><br>  basse pression - pression actuelle - haute pression <br>  indice de chute de pression - [bloque, affiche la pression dans le système] <br><br>  Cela vous permet d'évaluer rapidement situevina ce qui se passe. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/a16/a6f/711/a16a6f7117f1602f238acc0115cba914.jpg" alt="image"><br><br>  - Si la pression actuelle est inférieure à LOWER: un relais à semi-conducteurs est coupé de 15A (testé pendant des années) et la pompe se met en marche et délivre de l'eau silencieusement, rapidement, sans étincelles ni clics.  La pression TOP déclenche le relais.  La pompe ne s'allumera jamais et s'éteindra, le cas échéant, avec des lectures de capteur qui sont au-delà de la plage raisonnable.  C'est ça la sécurité. <br><br>  - Je calcule l'indice de chute de pression lorsque la moitié de la pression reste dans le peigne et les précédents et actuels sont vérifiés toutes les 10 secondes, si la différence est inférieure à la valeur par défaut de 0,05 - puis l'indice actuel change et la pompe se met en marche, c'est-à-dire que la logique est une consommation d'eau rapide et que pour prévoir l'inclusion de la pompe, j'utilise cette logique.  La logique ne fonctionne pas jusqu'à présent à 100%, puisque je teste encore ce moment, il y a des failles associées au timing millis () des arduins eux-mêmes, cela me dérange un peu, mais je vais trouver une solution pour un calcul clair.  La logique est déclenchée au début, puis l'index tombe à 0,01 et la logique ne fonctionne plus, mais cela n'affecte pas l'allumage et l'extinction de la pompe.  Ici, vous pouvez holivit sur le sujet «la pompe doit être allumée un certain nombre de fois par heure et pas plus» - vous en avez le droit), je ne contesterai pas - ce sujet est en cours d'analyse. <br><br>  - il y a des boutons latéraux qui vous permettent de régler le seuil BAS et HAUT pour allumer et éteindre la pompe DYNAMIQUEMENT, sans redémarrer, juste bêtement à la volée - regardez l'écran et appuyez sur les boutons latéraux ....  pratique sur!  les données sont immédiatement écrites dans l'EEPPROM et lorsque l'unité est allumée, elle est chargée à partir de là (c'est une mémoire constante pour écrire des nombres de 0 à 255 octets, ce n'est pas suffisant pour les petits caprices).  Il y a un point, cependant, que les nombres à virgule flottante sont si difficiles et hémorragiques qu'il a été simplement décidé de ma part comme ceci: sachant que le nombre x.x0 est une pression de type flottant, il peut facilement être converti en octet si vous multipliez par 10 et écrire dans la mémoire, c'est-à-dire: exemple: 1,80 * 10 = 18 - après multiplication, le nombre flottant supprime automatiquement le dernier zéro et nous obtenons un nombre qui correspond au type d'octet, lors de la lecture, nous le divisons par 10,0 et obtenons la forme opposée pour travailler dans notre système et type flotteur. <br><br>  - Tout le bien sera disponible en «lecture seule» à l'extérieur de la maison, ce qui nous permettra de comprendre la situation avec la pression non seulement en pression artérielle, mais aussi dans les tuyaux! <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e04/3c9/963/e043c99632033b3dc2fe5bf4479c726f.jpg" alt="image"><br><br>  Eh bien, c'est comme tout, pardonnez-moi, qui sont gênés par les détails du code, les stupides TYPES de données et les détails intimes du chargement des données de la mémoire, sautez cela parce que, sachant qu'il y a des gens de la sphère informatique, ils poseront toutes sortes de questions ou, vice versa, riront de mes algorithmes simples qui n'utilisent pas AI \ ML à la mode et d'autres algorithmes méga cool et big data.  Espérons que les ingénieurs comprendront également d'autres parties liées à la partie mécanique. <br><br>  En général, la conclusion est la suivante: vous pouvez tout faire, vous pouvez le faire facilement, le faire dans l'intérêt, et comme l'a dit un jour mon commentateur préféré: vous pouvez être un adulte et «jouer avec des jouets pour enfants». <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/b98/8d9/760/b988d9760525a615924a2c77c37bb68f.jpg" alt="image"></div><br><div class="spoiler">  <b class="spoiler_title">essais sur le terrain</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/cn3C7iSAZ1k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Votre casquette, automatisation, gars compétent et bonne journée à vous! <br><br>  Mauvaises herbes: <br><br>  - Je continue de tester l'indice de chute de pression pour un démarrage prématuré <br>  - Arduino uno (Chine) - des problèmes avec la minuterie millis () sont apparus - je vais vérifier arduino nano (ce n'est jamais arrivé auparavant, je suppose un modèle incurvé) (je ne l'ai pas compris, donc je ne le sais pas) <br>  - L'erreur est déclarée de 1,5% - à partir de 1,2 bar - c'est 0,18 bar - en fait - j'ai quelque part 0,3 par rapport à mon manomètre, mais je ne sais pas combien elle se situe ... donc 2% admettent l'erreur maximale - vous pouvez mettre l'erreur dans l'algorithme (comme je le fais) et ressemblera plus ou moins à la vérité.  Ne lancez pas de satellites - cela fera l'affaire) <br><br>  <b>upd: l'</b> étiquette de prix dans la région de 15-18 $ a été publiée pour le produit. <br><br>  Bonne année!  Que tous vos projets se réalisent, des BAINS seront construits, il y aura de la CHALEUR dans la maison et toute votre famille amicale sera avec vous!  Qu'il n'y ait que de bonnes nouvelles pour la nouvelle année. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr408933/">https://habr.com/ru/post/fr408933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr408923/index.html">"Merci pour l'aide, camarade!" Accélérer les PC de jeu AMD Ryzen</a></li>
<li><a href="../fr408925/index.html">Steampunk Hi-Fi: un passé alternatif pour les équipements sonores</a></li>
<li><a href="../fr408927/index.html">Steam a cessé d'accepter les paiements en Bitcoin en raison de la forte volatilité de la crypto-monnaie</a></li>
<li><a href="../fr408929/index.html">Les développeurs de certains jeux mobiles exploitent la crypto-monnaie sur les smartphones des utilisateurs</a></li>
<li><a href="../fr408931/index.html">Courte critique du PC portable ASUS N580VD</a></li>
<li><a href="../fr408935/index.html">Antenne intelligente pour les réseaux LTE</a></li>
<li><a href="../fr408939/index.html">Rapport final sur le projet de satellite Mayak</a></li>
<li><a href="../fr408941/index.html">Connecteur de diagnostic OBD-II comme interface pour l'IoT</a></li>
<li><a href="../fr408943/index.html">Ce que l'ennui fait à une personne: la science de la conscience errante</a></li>
<li><a href="../fr408945/index.html">Un millionnaire anonyme de Bitcoin donne 86 millions de dollars à une œuvre caritative.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>