<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧚🏼 🧑🏾‍🤝‍🧑🏼 😭 Automatische Steuerung über den Fernzugriff auf die Windows-Registrierung 👨🏽‍🎨 👨🏼‍⚖️ 👩🏾‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Unterstützung für den ordnungsgemäßen Betrieb von Computern und Software normaler Benutzer ist eine Routine der Mitarbeiter und / oder Administrat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatische Steuerung über den Fernzugriff auf die Windows-Registrierung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426873/"><p>  Die Unterstützung für den ordnungsgemäßen Betrieb von Computern und Software normaler Benutzer ist eine Routine der Mitarbeiter und / oder Administratoren des technischen Supports.  Wenn das Unternehmen klein ist und sich jeder in einem oder zwei Räumen befindet, ist es normalerweise einfach, das Problem selbst zu lösen oder zu überprüfen, was Sie benötigen. </p><br><p>  Aber was ist, wenn das Unternehmen groß ist und sich der Benutzer auf einer anderen Site / in einer anderen Stadt / einem anderen Land befindet? </p><br><p><img src="https://habrastorage.org/webt/wt/ie/d-/wtied-3-4doen9ma6k3gbtzee2u.png" alt="Bild"></p><a name="habracut"></a><br><p>  Eines der klassischen Tools für solche Arbeiten ist eine Remoteverbindung (unter Verwendung von RDP, Software wie TeamViewer / Skype mit einer Desktop-Demo usw.).  Es ist jedoch nicht ohne grundlegende Mängel: </p><br><ul><li>  In jedem Fall wird der Endbenutzer von seiner Arbeit abgelenkt (in einigen Fällen, ohne seinen Desktop zu sehen). </li><li>  Diese Tools funktionieren nicht immer, wenn auf dem Remotecomputer Fehler auftreten </li><li>  Die Installation von Software von Drittanbietern (einschließlich proprietärer Software im Fall von TeamViewer) wird von den Unternehmensrichtlinien bei weitem nicht immer begrüßt </li><li>  Die Methode ist praktisch nicht automatisiert </li></ul><br><p>  Schließlich wird dieser Ansatz verwendet, wenn der Vorfall bereits aufgetreten ist (es ist schwer vorstellbar, dass der Administrator von Zeit zu Zeit „präventiv“ eine Verbindung zu jedem Benutzer herstellt).  Aus diesem Grund ist der Mechanismus der Steuerung (Überwachung) von Remotecomputern wichtig. </p><br><p>  Eine mögliche Lösung besteht darin, den Remotezugriff auf die Windows-Registrierung zu verwenden.  Es speichert Daten in Form einer hierarchischen Datenbank, mit der Sie sie schnell empfangen und kompakt speichern können.  Sie verwenden die Registrierung, um ihre eigenen Einstellungen und Parameter sowohl für Betriebssystem- und eingebettete Dienste als auch für die meisten Programme von Drittanbietern zu speichern.  Daher beeinflusst der Inhalt der Registrierung in vielerlei Hinsicht den Betrieb des Systems. </p><br><p>  Auf dieser Grundlage kann die Registrierung durchaus als „Indikator“ für die Überwachung verwendet werden (Sie können einen Fehler erkennen, wenn er mit falschen Parametern in der Registrierung verknüpft ist, oder eine problematische Situation simulieren). </p><br><p>  Eine weitere Möglichkeit, die diese Lösung bietet, ist die Möglichkeit der administrativen Kontrolle der Benutzer (z. B. können Sie durch Remote-Lesen die Fakten zur Installation unerwünschter Programme und zur Änderung der Einstellungen einsehen). Vergessen Sie nicht den Einfluss des "menschlichen Faktors" auf das System.  In der Praxis war dies im Rahmen des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SkypeTime-</a> Projekts hilfreich, in dem die Korrektur von Einstellungen in Skype for Business verfolgt werden musste. </p><br><p><img src="https://habrastorage.org/webt/eb/jt/9l/ebjt9lhsnvxoead9su8n64gzyqq.jpeg" alt="Bild"></p><br><p>  Die Registrierung enthält jedoch Tausende von Einträgen, und es ist äußerst schwierig, alle zu kontrollieren.  Daher ist es zunächst erforderlich, das Kontrollobjekt einzuschränken - zu bestimmen, welche Parameter für uns von Interesse sind, und herauszufinden, in welchen bestimmten Registrierungszweigen sich die entsprechenden Werte befinden.  Letzteres ist in der Regel nicht schwer in der Dokumentation / im Internet zu finden oder anhand der Namen der Schlüssel unabhängig zu bestimmen. </p><br><p>  Nachdem Sie sich für das Thema Steuerung entschieden haben, können Sie mit der direkten Konfiguration des Fernzugriffs fortfahren.  Dazu müssen Sie den Remote Procedure Call-Dienst auf Remotecomputern aktivieren und die Firewall nach Bedarf konfigurieren. Dies erfolgt bequem mithilfe von Gruppenrichtlinien.  Unter Berücksichtigung der Sicherheitsanforderungen erfordert der Zugriff die Rechte eines Domänenadministrators oder eines lokalen Administrators auf jedem Gerät. </p><br><div class="spoiler">  <b class="spoiler_title">Konfigurieren Sie den Remotezugriff</b> <div class="spoiler_text"><p>  Um den Dienst selbst zu aktivieren, legen Sie im Abschnitt Computerkonfiguration&gt; Einstellungen&gt; Systemsteuerungseinstellungen&gt; Dienste die Parameter für den RpcSs-Dienst wie in einem Screenshot fest </p><br><p><img src="https://habrastorage.org/webt/oy/j8/k-/oyj8k-xbkjvb6yurtx-_ejk_0gc.jpeg" alt="Bild"></p><br><p>  Es müssen noch die entsprechenden Firewall-Ausnahmen hinzugefügt werden.  Erstellen Sie in derselben Richtlinie unter Computerkonfiguration&gt; Richtlinien&gt; Windows-Einstellungen&gt; Sicherheitseinstellungen&gt; Windows-Firewall mit erweiterter Sicherheit&gt; Eingehende Regeln eine neue Regel: <br>  Regeltyp - Benutzerdefiniert </p><br><p><img src="https://habrastorage.org/webt/s1/wo/hk/s1wohkk7ldbibzqrim7qrcki-rs.jpeg" alt="Bild"></p><br><p>  Geben Sie den Pfad des Programms an -% SystemRoot% \ system32 \ svchost.exe <br>  Stellen Sie in den zusätzlichen Einstellungen im Abschnitt Dienste die Option Auf Dienst anwenden mit dem folgenden Kurznamen ein - Winmgmt </p><br><p><img src="https://habrastorage.org/webt/ef/fg/wv/effgwvovrv1eqr9btfiy-dv9dzo.jpeg" alt="Bild"></p><br><p>  Auf den folgenden Seiten geben wir TCP ohne Angabe bestimmter Ports und für alle Adressen an </p><br><p><img src="https://habrastorage.org/webt/0z/-5/ef/0z-5ef-xfzxapqdbl8mln_9hu6u.jpeg" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/7k/y6/ks/7ky6kso0xwqyamgqb14i3uvkxxi.jpeg" alt="Bild"></p><br><p>  und erlauben Sie die Verbindung (Verbindung <em>zulassen</em> ) für das Domänenprofil </p><br><p><img src="https://habrastorage.org/webt/ry/hg/e7/ryhge7d26xy8gjkmlneq6cqjg6w.jpeg" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/ui/fq/-a/uifq-aqdmohmt-omff0ctcgm1mq.jpeg" alt="Bild"></p></div></div><br><p>  Die manuelle Steuerung der Registrierung von Dutzenden und Hunderten von Computern „manuell“ (auch mit wenigen Einträgen) ist jedoch eine undankbare und sinnlose Aufgabe.  Glücklicherweise ist dieser Prozess mithilfe von Skripten recht einfach zu automatisieren.  Mit dem folgenden PowerShell-Skript können Sie beispielsweise herausfinden, welcher Benutzer die Parameter AwayThreshold und IdleThreshold (Zeit, um in den Status "Out of Place" und "Inactive" zu wechseln) für Skype for Business geändert hat. </p><br><div class="spoiler">  <b class="spoiler_title">Skriptcode</b> <div class="spoiler_text"><pre><code class="hljs mel">Param ( [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"c"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$FromFileComputers, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"r"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$OutputRPCErrorsFile, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"u"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$FromFileUsers, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"o"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$OutputFile=<span class="hljs-string"><span class="hljs-string">"output.csv"</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"a"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$MinAway, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"i"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$MinIdle ) $RPCErrorsArray = @() $result = @() $HKU = <span class="hljs-number"><span class="hljs-number">2147483651</span></span> $RegistryForCheckArray = <span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\13.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\14.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\15.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\16.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Communicator"</span></span> $CurrentComputerNumber = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileUsers)) { $Users = Get-Content $FromFileUsers; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileComputers)) { $Comps = Get-Content $FromFileComputers; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $date = (get-<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>).AddMonths(<span class="hljs-number"><span class="hljs-number">-1</span></span>) $Comps = Get-ADComputer -<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> { lastlogontimestamp -ge $date } | <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> name | ForEach-Object {$_.name} #$Comps = <span class="hljs-string"><span class="hljs-string">"NB_CY"</span></span> } $ServersCount = ($Comps).Count; Foreach ($Comp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $Comps) { $CurrentComputerNumber++ try { Write-Host <span class="hljs-string"><span class="hljs-string">"Checking: $Comp [$CurrentComputerNumber/$ServersCount]"</span></span>; $profiles = Get-WmiObject Win32_UserProfile -<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> <span class="hljs-string"><span class="hljs-string">"Loaded=$true and special=$false"</span></span> -ComputerName $Comp -ErrorAction Stop $reg = [wmiclass]<span class="hljs-string"><span class="hljs-string">"\\$Comp\root\default:stdregprov"</span></span> Foreach ($profile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $profiles) { $username = Split-Path $profile.LocalPath -Leaf <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileUsers)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$Users.Contains($username)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } Foreach( $registry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $RegistryForCheckArray) { $hkey = <span class="hljs-string"><span class="hljs-string">"$($profile.sid)\$registry"</span></span> #Write-Host <span class="hljs-string"><span class="hljs-string">"KEY: $hkey"</span></span> $away = $reg.GetDWORDValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"AwayThreshold"</span></span>).uValue $idle = $reg.GetDWORDValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"IdleThreshold"</span></span>).uValue $sip = $reg.GetStringValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"ServerSipUri"</span></span>).sValue <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($away) -and [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($idle)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(($MinAway -gt <span class="hljs-number"><span class="hljs-number">0</span></span> -and $away -lt $MinAway) -or ($MinIdle -gt <span class="hljs-number"><span class="hljs-number">0</span></span> -and $idle -lt $MinIdle)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $result += New-Object PsObject -Property @{ <span class="hljs-string"><span class="hljs-string">"PC"</span></span> = $Comp <span class="hljs-string"><span class="hljs-string">"Username"</span></span> = $username <span class="hljs-string"><span class="hljs-string">"SIP"</span></span> = $sip <span class="hljs-string"><span class="hljs-string">"SFB_Away"</span></span> = $away <span class="hljs-string"><span class="hljs-string">"SFB_Idle"</span></span> = $idle } } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_.Exception.GetType().Name -eq <span class="hljs-string"><span class="hljs-string">"COMException"</span></span>) { $RPCErrorsArray += $Comp; } Write-Host <span class="hljs-string"><span class="hljs-string">"Error: ($_.Exception.GetType().Name)"</span></span>; $_.Exception } } $result | Export-csv -Path $OutputFile $result | Format-Table -Property PC,Username,SIP,SFB_Away,SFB_Idle -AutoSize Write-Host <span class="hljs-string"><span class="hljs-string">"Saved to: $OutputFile"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($OutputRPCErrorsFile)) { $RPCErrorsArray | out-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> $OutputRPCErrorsFile Write-Host <span class="hljs-string"><span class="hljs-string">"RPC errors saved to: $OutputRPCErrorsFile"</span></span> }</code> </pre> </div></div><br>  Zur Vereinfachung kann das Skript mit den folgenden Parametern ausgeführt werden: <br><br>  -c Pfad zur Datei mit einer Liste der zu überprüfenden Hostnamen-Computer, falls nicht angegeben - Computer mit einer Aktivität von 30 Tagen von AD abrufen. <br>  -r Pfad zu der Datei, in die der Hostname von Computern mit einem RPC-Fehler geschrieben wird. <br>  -u Pfad zur Datei mit einer Liste von Benutzern (Login), falls nicht angegeben, überprüft alle. <br>  -o Pfad zu der Datei, in der das Ergebnis des Skripts ausgeführt wird. Standardmäßig ist output.csv. <br>  - Ein Mindestwert für den Parameter AwayThreshold. Datensätze mit einem Wert unter dem angegebenen Wert erhalten nicht das Ergebnis der Skriptausführung. <br>  -i der Mindestwert für den Parameter IdleThreshold, Datensätze mit einem Wert, der kleiner als der angegebene Wert ist, erhalten nicht das Ergebnis des Skripts. <br><br>  Darüber hinaus kann das Skript durch Hinzufügen zum Windows-Taskplaner (Taskplaner) oder über die Funktion "Geplante Jobs" in PowerShell automatisiert werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426873/">https://habr.com/ru/post/de426873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426853/index.html">„S in IoT steht für Sicherheit“: Das weltweit erste Gesetz zum Schutz intelligenter Geräte wurde verabschiedet - wir verstehen, worauf es ankommt</a></li>
<li><a href="../de426861/index.html">Unter dem Berg findet eine neue Jagd nach dunkler Materie statt</a></li>
<li><a href="../de426863/index.html">Verfügbar über Quaternionen und ihre Vorteile</a></li>
<li><a href="../de426865/index.html">Ein klares Dashboard-Design für ein ausgeklügeltes Anzeigenverwaltungssystem</a></li>
<li><a href="../de426869/index.html">So führen Sie Videokonferenzen mit ausländischen Kunden effektiv durch</a></li>
<li><a href="../de426875/index.html">Tacticool Mobile Online Shooter Meta Server-Architektur</a></li>
<li><a href="../de426879/index.html">Einrichtung eines elektrischen Begrenzungssystems für Projekte mit Hochgeschwindigkeitsschnittstellen</a></li>
<li><a href="../de426881/index.html">Starten von Online-Entwicklerprogrammen</a></li>
<li><a href="../de426889/index.html">Teilnahme an maschinellen Lernwettbewerben. Vortrag in Yandex</a></li>
<li><a href="../de426891/index.html">SAP Process Mining oder wie Sie Ihre Geschäftsprozesse verstehen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>