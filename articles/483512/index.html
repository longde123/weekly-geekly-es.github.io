<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßíüèΩ ‚úùÔ∏è üßôüèº Desarrollando el paquete pypi perfecto con soporte para diferentes versiones de python ü¶î ü§ò üèáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este es un peque√±o manual / historia sobre c√≥mo crear un paquete pypi "perfecto" para python, que cualquiera puede instalar con el preciado comando: 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollando el paquete pypi perfecto con soporte para diferentes versiones de python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483512/"><p>  Este es un peque√±o manual / historia sobre c√≥mo crear un paquete pypi "perfecto" para python, que cualquiera puede instalar con el preciado comando: </p><br><pre><code class="plaintext hljs">pip install my-perfect-package</code> </pre> <br><p>  Est√° dirigido a principiantes, pero insto a los profesionales a expresar su opini√≥n sobre c√≥mo mejorar el paquete "perfecto".  Por lo tanto, pido gato. </p><a name="habracut"></a><br><h2 id="chto-znachit-idealnyy-paket">  ¬øQu√© significa un paquete "ideal"? </h2><br><p>  Proceder√© de los siguientes requisitos: </p><br><ul><li>  <strong>C√≥digo abierto en github;</strong> <br>  Todos deber√≠an poder contribuir al desarrollo y agradecer al autor. </li><li>  <strong>Soporte para todas las versiones actuales / populares de python (2.7, 3.5, 3.6, 3.7, 3.8);</strong> <br>  Las pitones son diferentes, y en alg√∫n lugar todav√≠a escriben activamente en 2.7. </li><li>  <strong>100% de cobertura con pruebas unitarias;</strong> <br><del>  Las pruebas unitarias mejoran la arquitectura y automatizan las comprobaciones de regresi√≥n. </del><br>  Una insignia con un n√∫mero apreciado genera preguntas frecuentes y <a href="https://cmustrudel.github.io/papers/icse18badges.pdf" rel="nofollow">establece el list√≥n para otros</a> . </li><li>  <strong>Usando CI:</strong> <br>  ¬°Los controles autom√°ticos son muy convenientes! <del>  Y un mont√≥n de insignias geniales </del><br><ul><li>  <strong>Ejecuci√≥n de pruebas unitarias en todas las plataformas y en todas las versiones de python;</strong> <br>  No les creas a quienes afirman que Python y los paquetes instalados son <a href="https://docs.python.org/2/library/os.html" rel="nofollow">multiplataforma</a> , porque siempre puedes encontrar un <a href="https://bugs.python.org/issue22587" rel="nofollow">error</a> . </li><li>  <strong>Verificaci√≥n del c√≥digo de estilo;</strong> <br>  Un estilo uniforme mejora la legibilidad y reduce el n√∫mero de discusiones vac√≠as en una revisi√≥n. </li><li>  <strong>Analizador de c√≥digo est√°tico;</strong> <br>  ¬øB√∫squeda autom√°tica de errores en el c√≥digo?  Dame dos! </li></ul></li><li>  <strong>Documentaci√≥n real;</strong> <br>  Ejemplos de trabajo con el paquete, descripci√≥n de m√©todos / clases y an√°lisis de errores t√≠picos: la experiencia documentada reducir√° el umbral de entrada para principiantes. </li><li>  <strong>Desarrollo multiplataforma;</strong> <br>  Desafortunadamente, es dif√≠cil hacer una contribuci√≥n personal a los proyectos simplemente porque el desarrollador agudiz√≥ las herramientas para Unix.  Por ejemplo, us√© scripts bash para ensamblar. </li><li>  <strong>El paquete es √∫til y hace del mundo un lugar mejor.</strong> <br>  Un requisito dif√≠cil, ya que a juzgar por el n√∫mero de paquetes en <a href="https://pypi.org/" rel="nofollow">pypi</a> <em>(~ 210k), los</em> desarrolladores son altruistas salvajes y ya se ha escrito mucho. </li></ul><br><h2 id="s-chego-nachat">  Por donde empezar </h2><br><p>  No hab√≠a buenas ideas, as√≠ que eleg√≠ un tema trillado y muy popular: trabajar con sistemas num√©ricos.  La primera versi√≥n deber√≠a poder traducir n√∫meros al romano y viceversa.  Para el manual es m√°s complicado y no necesario.  Oh s√≠, lo m√°s importante es el nombre: <del>  numsys: como descifrado de sistemas num√©ricos. </del>  <em>numeral-system-py</em> . </p><br><h2 id="kak-testirovat">  ¬øC√≥mo hacer la prueba? </h2><br><p>  Tom√© <em>python3.7</em> y primero escrib√≠ pruebas con stubs de funci√≥n (todos somos <a href="https://habr.com/ru/post/121162/">TDD</a> ) usando el m√≥dulo de pruebas unitarias est√°ndar. </p><br><p>  Realizo la siguiente estructura de proyecto: </p><br><pre> <code class="plaintext hljs">src/ numeral-system/ __init__.py roman.py tests __init__.py test_roman.py</code> </pre> <br><p>  No pondr√© pruebas en el paquete, as√≠ que me separo <del>  paja </del>  .  Inicialmente, no cre√© la carpeta <code>src/</code> , pero el desarrollo posterior demostr√≥ que es m√°s conveniente para m√≠ operar.  Esto no es necesario, por lo tanto, a voluntad. </p><br><p>  Decid√≠ usar <a href="https://habr.com/ru/post/269759/">pytest</a> para el lanzamiento: sabe c√≥mo funcionar perfectamente con las pruebas del m√≥dulo est√°ndar.  Puede parecer un poco il√≥gico, pero el m√≥dulo est√°ndar para pruebas para m√≠ <del>  parece </del>  Parec√≠a un poco m√°s c√≥modo.  <em>Ahora recomendar√≠a usar el estilo de escritura pytest.</em> </p><br><p>  Pero, dicen que poner <code>pytest</code> (como cualquier otra dependencia) en el sistema python no es una idea muy inteligente ... </p><br><h2 id="kak-upravlyat-zavisimostyami">  ¬øC√≥mo gestionar las dependencias? </h2><br><p>  Solo se pueden usar <a href="https://virtualenv.pypa.io/en/latest/" rel="nofollow">virtualenv</a> y <a href="https://virtualenv.pypa.io/en/latest/" rel="nofollow">required.txt</a> .  Puedes ser progresivo y usar <a href="https://poetry.eustace.io/" rel="nofollow">poes√≠a</a> .  Yo, tal vez, <a href="https://tox.readthedocs.io/en/latest/" rel="nofollow">usar√© tox</a> , una herramienta para simplificar la automatizaci√≥n y las pruebas, que tambi√©n me permitir√° administrar las dependencias. </p><br><p>  Creo una configuraci√≥n simple de tox.ini e instalo <code>pytest</code> : </p><br><pre> <code class="plaintext hljs">[tox] envlist = py37 ;     ,   python3.7 [testenv] ;     deps =  `deps`  ,   . -r requirements.txt ;     -r requirements-test.txt ; commands = pytest ;  </code> </pre> <br><p>  Inicialmente, indiqu√© expl√≠citamente las dependencias, pero la pr√°ctica de integraci√≥n con servicios de terceros demostr√≥ que la mejor manera ser√≠a almacenar las dependencias en el archivo require.txt. </p><br><p>  Surge un momento muy sutil.  ¬øCorregir la versi√≥n actual en el momento del desarrollo o poner siempre la √∫ltima? </p><br><p>  Si se compromete, durante la instalaci√≥n puede haber conflictos entre paquetes debido a las diferentes versiones de las dependencias utilizadas.  Si no se compromete, el paquete puede dejar de funcionar repentinamente.  La √∫ltima situaci√≥n es muy desagradable para los productos finales, cuando todas las compilaciones pueden "volverse rojas" en una noche debido a una actualizaci√≥n menor de la dependencia impl√≠cita.  Y de acuerdo <a href="https://en.wikipedia.org/wiki/Murphy%2527s_law" rel="nofollow">con la ley de Murphy,</a> esto suceder√° el d√≠a del lanzamiento. </p><br><p>  Por lo tanto, desarroll√© una regla para m√≠: </p><br><ol><li>  Siempre corrija la versi√≥n para los productos finales, ya que las versiones a usar son su responsabilidad. </li><li>  No repare la versi√≥n utilizada para los paquetes instalados.  O lim√≠telo a un rango si la funcionalidad del paquete lo requiere. </li></ol><br><h2 id="chto-dalshe">  Que sigue </h2><br><p>  Estoy escribiendo pruebas! </p><br><p>  Completo el cuerpo de las funciones, agrego comentarios y hago que las pruebas se ejecuten correctamente. <br>  En este punto, la mayor√≠a de los desarrolladores generalmente se detienen (todav√≠a creo que todos escriben tests =), publican el paquete y piratean errores.  Pero sigo adelante <del>  y saltar a la madriguera del conejo </del>  . </p><br><h2 id="kak-rabotat-s-razlichnymi-versiyami-python">  ¬øC√≥mo trabajar con diferentes versiones de python? </h2><br><p>  En la configuraci√≥n de <code>tox</code> , especifico el lanzamiento de pruebas en todas las versiones interesantes de python: </p><br><pre> <code class="plaintext hljs">[tox] envlist = py{27,35,36,37,38}</code> </pre> <br><p>  Utilizando <a href="https://khashtamov.com/ru/pyenv-python/" rel="nofollow">pyenv,</a> entrego las versiones necesarias para m√≠ localmente para que <code>tox</code> pueda encontrarlas y crear entornos de prueba. </p><br><h2 id="gde-zavetnye-100">  ¬øD√≥nde est√°n los apreciados al 100%? </h2><br><p>  Agregar√© una medida de la cobertura del c√≥digo; para esto hay un excelente paquete de <a href="https://coverage.readthedocs.io/en/v4.5.x/" rel="nofollow">cobertura</a> y una integraci√≥n no menos excelente con pytest: <a href="https://github.com/pytest-dev/pytest-cov" rel="nofollow">pytest-cov</a> . <br>  <code>requirements-test.txt</code> ahora se ve as√≠: </p><br><pre> <code class="plaintext hljs">six=1.13.0 pytest=4.6.7 pytest-cov=2.8.1 parameterized=0.7.1</code> </pre> <br><p>  De acuerdo con la regla anterior, reparo las versiones de los paquetes que se utilizan para ejecutar pruebas. </p><br><p>  Cambio el comando de ejecuci√≥n de prueba: </p><br><pre> <code class="plaintext hljs">deps = -r requirements.txt -r requirements-test.txt commands = pytest \ --cov=src/ \ --cov-config="{toxinidir}/tox.ini" \ --cov-append</code> </pre> <br><p>  Estoy recopilando estad√≠sticas de cobertura para todo el c√≥digo de la carpeta <code>src/</code> - el paquete en s√≠ ( <em>numeral_system /</em> ) y requerido para el c√≥digo de prueba ( <em>tests /</em> ) - ¬øNo quiero que las pruebas contengan partes no ejecutables? </p><br><p>  <code>--cov-append</code> comando <code>--cov-append</code> todas las estad√≠sticas recopiladas para cada llamada en una versi√≥n diferente de python en una, porque la cobertura para la segunda y tercera python puede ser diferente (¬°hola c√≥digo dependiente de la versi√≥n y m√≥dulo <a href="https://pypi.org/project/six/" rel="nofollow">seis</a> !), Pero en total da 100 %  Un simple ejemplo: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sys.version_info &gt; (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>): <span class="hljs-comment"><span class="hljs-comment"># Python 3 code in this block else: # Python 2 code in this block</span></span></code> </pre> <br><p>  Agregue un nuevo entorno para crear un informe de cobertura. </p><br><pre> <code class="plaintext hljs">[testenv:coverage_report] deps = coverage commands = coverage html ;   ,   coverage report --include="src/*" --fail-under=100 -m ;    100% </code> </pre> <br><p>  Y agrego a la lista de entornos despu√©s de ejecutar las pruebas en todas las versiones de python. </p><br><pre> <code class="plaintext hljs">[tox] envlist = py{27,35,36,37,38} coverage_report</code> </pre> <br><p>  Despu√©s de ejecutar el comando <code>tox</code> , la carpeta <code>tox</code> contiene el archivo <code>index.html</code> con un hermoso informe debe aparecer en la ra√≠z del proyecto. </p><br><p>  Para la codiciada insignia, integro 100% con el servicio <a href="https://codecov.io/" rel="nofollow">codecov</a> , que ya se integrar√° con <code>github</code> y le permitir√° ver el historial de cambios en la cobertura del c√≥digo.  Para hacer esto, por supuesto, tendr√° que crear una cuenta all√≠. </p><br><p>  El entorno de lanzamiento final es el siguiente: </p><br><pre> <code class="plaintext hljs">[testenv:coverage_report] deps = coverage==5.0.2 codecov==2.0.15 commands = coverage html coverage report --include="src/*" --fail-under=100 -m coverage xml codecov -f coverage.xml --token=2455dcfa-f9fc-4b3a-b94d-9765afe87f0f ;     codecov,   </code> </pre> <br><p>  Ahora solo queda agregar un enlace a la insignia en <code>README.rst</code> : </p><br><pre> <code class="plaintext hljs">|Code Coverage| .. |Code Coverage| image:: https://codecov.io/gh/zifter/numeral-system-py/branch/master/graph/badge.svg :target: https://codecov.io/gh/zifter/numeral-system-py</code> </pre> <br><h2 id="kak-formatirovat-i-analizirovat-kod">  ¬øC√≥mo formatear y analizar c√≥digo? </h2><br><p>  Muchos analizadores no existen porque, en su mayor parte, se complementan entre s√≠.  Por lo tanto, integrar√© analizadores est√°ticos populares que verificar√°n el cumplimiento de <a href="https://www.python.org/dev/peps/pep-0008/" rel="nofollow">PEP8</a> , encontrar√°n problemas potenciales y <del>  arreglar todos los errores </del>  formatee uniformemente el c√≥digo. </p><br><p>  Debe considerar inmediatamente d√≥nde especificar los par√°metros para ajustar los analizadores.  Para hacer esto, puede usar el archivo <code>tox.ini</code> , <code>setup.cfg</code> , un √∫nico archivo personalizado o archivos espec√≠ficos para analizadores.  Decid√≠ usar <code>tox.ini</code> directamente, ya que puedes copiar <code>tox.ini</code> para futuros proyectos. </p><br><h2 id="isort">  isort </h2><br><p>  <a href="https://github.com/timothycrosley/isort" rel="nofollow">isort</a> es una utilidad para formatear importaciones. </p><br><p>  Creo el siguiente entorno para ejecutar <code>isort</code> en modo de formato de c√≥digo. </p><br><pre> <code class="plaintext hljs">[testenv:isort] changedir = {toxinidir}/src deps = isort==4.3.21 commands = isort -y -sp={toxinidir}/tox.ini</code> </pre> <br><p>  Desafortunadamente, <code>isort</code> no puede especificar una carpeta para formatear.  Por lo tanto, debe cambiar el directorio de inicio a trav√©s de <code>changedir</code> y especificar la ruta al archivo con la configuraci√≥n <code>-sp={toxinidir}/tox.ini</code> .  El <code>-y</code> es necesario para deshabilitar el modo interactivo. </p><br><p>  Para ejecutar las pruebas, necesita un modo de verificaci√≥n, para esto hay un indicador de <code>--check-only</code> verificaci√≥n: </p><br><pre> <code class="plaintext hljs">[testenv:isort-check] changedir = {toxinidir}/src deps = isort==4.3.21 commands = isort --check-only -sp={toxinidir}/tox.ini</code> </pre> <br><h2 id="black">  negro </h2><br><p>  A continuaci√≥n, me integro con el formateador de c√≥digo <a href="https://black.readthedocs.io/en/stable/" rel="nofollow">negro</a> .  Lo hago por analog√≠a con <code>isort</code> : </p><br><pre> <code class="plaintext hljs">[testenv:black] deps = black==19.10b0 commands = black src/ [testenv:black-check] deps = black==19.10b0 commands = black --check src/</code> </pre> <br><p>  Todo funciona bien, pero hay un conflicto con <code>isort</code> : hay una diferencia en el <a href="https://github.com/psf/black/issues/127" rel="nofollow">formato de las importaciones</a> . </p><br><p>  En <a href="https://github.com/timothycrosley/isort/issues/694" rel="nofollow">uno de los comentarios</a> encontr√© una configuraci√≥n de <code>isort</code> m√≠nimamente compatible, que utilic√©: </p><br><pre> <code class="plaintext hljs">[isort] multi_line_output=3 include_trailing_comma=True force_grid_wrap=0 use_parentheses=True line_length=88</code> </pre> <br><h2 id="flake8">  escama8 </h2><br><p>  A continuaci√≥n, me integro con los analizadores est√°ticos <a href="http://flake8.pycqa.org/en/latest/" rel="nofollow">flake8</a> . </p><br><pre> <code class="plaintext hljs">[testenv:flake8-check] deps = flake8==3.7.9 commands = flake8 --config=tox.ini src/</code> </pre> <br><p>  Hay <a href="https://github.com/psf/black/issues/113" rel="nofollow">problemas con la integraci√≥n</a> con <code>black</code> nuevamente.  Tenemos que agregar un ajuste fino, que, de hecho, es <a href="https://github.com/psf/black" rel="nofollow">recomendado</a> por <code>black</code> propio <code>black</code> : </p><br><pre> <code class="plaintext hljs">[flake8] max-line-length=88 ignore=E203</code> </pre> <br><p>  Lamentablemente, la primera vez no funcion√≥.  Cay√≥ con el error <code>E231 missing whitespace after ','</code> , tuve que agregar este error para ignorar: </p><br><pre> <code class="plaintext hljs">[flake8] max-line-length=88 ignore=E203,E231</code> </pre> <br><h2 id="pylint">  pylint </h2><br><p>  Integrar con <a href="https://www.pylint.org/" rel="nofollow">analizadores de</a> c√≥digo est√°tico <a href="https://www.pylint.org/" rel="nofollow">pylint</a> </p><br><pre> <code class="plaintext hljs">[testenv:pylint-check] deps = {[testenv]deps} # pylint  ,     pylint==2.4.4 commands = pylint --rcfile=tox.ini src/</code> </pre> <br><p>  Inmediatamente me encuentro con restricciones extra√±as: nombres de funciones de 30 caracteres (s√≠, escribo nombres muy largos de m√©todos de prueba) y advertencias sobre la presencia de <code>TODO</code> en el c√≥digo. <br>  Tengo que agregar un par de excepciones: </p><br><pre> <code class="plaintext hljs">[MESSAGES CONTROL] disable=fixme,invalid-name</code> </pre> <br><p>  Adem√°s, el momento desagradable es que los desarrolladores de <code>pylint</code> ya <code>pylint</code> enterrado <code>python2.7</code> y ya no est√°n desarrollando un paquete para ello.  Por lo tanto, las comprobaciones deben ejecutarse en el paquete actual para <code>python3.7</code> . <br>  Agregue la l√≠nea apropiada a la configuraci√≥n: </p><br><pre> <code class="plaintext hljs">[tox] envlist = isort-check black-check flake8-check pylint-check py{27,35,36,37,38} coverage_report basepython = python3.7</code> </pre> <br><p>  Tambi√©n es importante para ejecutar pruebas en diferentes plataformas, ya que la versi√≥n predeterminada de python en los sistemas CI es diferente. </p><br><h2 id="chto-tam-s-ci">  ¬øQu√© pasa con CI? </h2><br><h3 id="appveyor">  Transportador </h3><br><p>  Integrar con <a href="https://www.appveyor.com/" rel="nofollow">appveyor</a> - CI para windows.  La configuraci√≥n inicial es simple: todo se puede hacer en la interfaz, luego descargue el archivo yaml y conf√≠rmelo en el repositorio. </p><br><pre> <code class="plaintext hljs">version: 0.0.{build} install: - cmd: &gt;- C:\\Python37\\python -m pip install --upgrade pip C:\\Python37\\pip install tox build: off test_script: - cmd: C:\\Python37\\tox</code> </pre> <br><p>  Aqu√≠ especifico expl√≠citamente la versi√≥n de <code>python3.7</code> , ya que <code>python2.7</code> se usar√° por defecto (y <code>tox</code> tambi√©n usar√° esta versi√≥n, aunque especifiqu√© expl√≠citamente <code>python3.7</code> ). <br>  El enlace a la insignia, como de costumbre, se agrega a <code>README.rst</code> </p><br><pre> <code class="plaintext hljs">|Build status Appveyor| .. |Build status Appveyor| image:: https://ci.appveyor.com/api/projects/status/github/zifter/numeral-system-py?branch=master&amp;svg=true :target: https://ci.appveyor.com/project/zifter/numeral-system-py</code> </pre> <br><h3 id="travis-ci">  Travis ci </h3><br><p>  Despu√©s de eso, me integro con <a href="https://travis-ci.org/" rel="nofollow">Travis CI</a> - CI en Linux (y en MacOS con Windows, pero las <a href="https://docs.travis-ci.com/user/languages/python/" rel="nofollow"><code>Python builds are not available on the macOS and Windows environments</code></a> . La configuraci√≥n es un poco m√°s complicada, ya que el archivo de configuraci√≥n se usar√° directamente desde el repositorio. Un par de iteraciones de prueba y error) la configuraci√≥n est√° lista, aplasto en una hermosa confirmaci√≥n y la solicitud de fusi√≥n est√° lista. </p><br><pre> <code class="plaintext hljs">language: python python: 3.8 # dist: xenial # required for Python 3.7 (travis-ci/travis-ci#9069) sudo: required # required for Python 3.7 (travis-ci/travis-ci#9069) addons: apt: sources: - deadsnakes packages: - python3.5 - python3.6 - python3.7 - pypy install: - pip install tox script: - tox</code> </pre> <br><p>  ( <em>Pregunta ret√≥rica: ¬øY por qu√© a los proyectos de CI les gusta tanto el formato yaml?</em> ) </p><br><p>  <code>python3.8</code> la versi√≥n de <code>python3.8</code> , ya que no funcion√≥ correctamente a trav√©s del <code>addon</code> , y <code>Travis CI</code> crea con √©xito <code>virtualenv</code> partir de la versi√≥n especificada. </p><br><p>  Las personas familiarizadas con <code>Travis CI</code> pueden preguntar, ¬øpor qu√© no especificar expl√≠citamente las versiones de Python de esta manera?  Despu√©s de todo, <code>Travis CI</code> crea autom√°ticamente <code>virtualenv</code> y ejecuta los comandos necesarios en √©l. </p><br><p>  La raz√≥n es que necesitamos recopilar datos de cobertura de c√≥digo de todas las versiones.  Pero las pruebas se ejecutar√°n en diferentes trabajos en paralelo, por lo que no funcionar√° recopilar un informe de cobertura general. </p><br><p>  Por supuesto, estoy seguro de que un poco m√°s de comprensi√≥n y esto se puede solucionar. </p><br><p>  Por tradici√≥n, tambi√©n se agrega un enlace a una insignia a <code>README.rst</code> </p><br><pre> <code class="plaintext hljs">|Build Status Travis CI| .. |Build Status Travis CI| image:: https://travis-ci.org/zifter/numeral-system-py.svg?branch=master :target: https://travis-ci.org/zifter/numeral-system-py</code> </pre> <br><h2 id="dokumentaciya">  La documentaci√≥n </h2><br><p>  Creo que cada desarrollador de Python ha usado el servicio al menos una vez: <a href="https://readthedocs.org/" rel="nofollow">readthedocs.org</a> .  Me parece que este es el mejor servicio para alojar su documentaci√≥n. <br>  Usar√© la herramienta est√°ndar para generar la documentaci√≥n de <a href="http://www.sphinx-doc.org/en/master/" rel="nofollow">Sphinx</a> .  Sigo los pasos del <a href="https://docs.readthedocs.io/en/stable/intro/getting-started-with-sphinx.html" rel="nofollow">manual de inicio</a> y obtengo la siguiente estructura: </p><br><pre> <code class="plaintext hljs">src/ docs/ build/ #      html  source/ #     _static/ #   , ,  _templates/ #     conf.py #    index.rst #    make.bat Makefile # make     make</code> </pre> <br><p>  A continuaci√≥n, debe realizar los pasos m√≠nimos para configurar: </p><br><ol><li>  <code>github</code> por defecto sugiere crear un archivo <code>README.md</code> en formato <a href="https://en.wikipedia.org/wiki/Markdown" rel="nofollow">Markdown</a> , cuando como <code>sphinx</code> por defecto sugiere usar <a href="https://en.wikipedia.org/wiki/ReStructuredText" rel="nofollow">ReStructuredText</a> . </li></ol><br><p>  Por lo tanto, tuve que reescribirlo en primer formato. <del>  Y si hab√≠a le√≠do el manual de inicio hasta el final al menos una vez, me di cuenta de que <code>sphinx</code> puede hacerlo en Markdown </del>  . <br>  <code>README.rst</code> archivo <code>index.rst</code> en <code>index.rst</code> </p><br><pre> <code class="plaintext hljs">.. include:: ../../README.rst</code> </pre> <br><ol><li>  Para generar autom√°ticamente la documentaci√≥n de los comentarios en la fuente, agrego la extensi√≥n <a href="http://www.sphinx-doc.org/en/master/usage/extensions/autodoc.html" rel="nofollow">sphinx.ext.autodoc</a> . </li><li>  <code>conf.py</code> carpeta <code>conf.py</code> paquete a <code>conf.py</code>  Esto permitir√° que <code>sphinx</code> importe nuestro c√≥digo para su an√°lisis. <br><pre> <code class="plaintext hljs">import os import sys sys.path.insert(0, os.path.abspath('./../../src')) import numeral_system</code> </pre> </li><li>  Agrego la carpeta <code>docs/source/api-docs</code> y suelto el archivo de descripci√≥n para cada m√≥dulo all√≠.  La documentaci√≥n debe generarse autom√°ticamente a partir de los comentarios: <br><pre> <code class="plaintext hljs">Roman numeral system ========================= .. automodule:: numeral_system.roman :members:</code> </pre> </li></ol><br><p>  Despu√©s de eso, el proyecto est√° listo para revelar su descripci√≥n al mundo.  <code>github</code> crear una cuenta (preferiblemente a trav√©s de una cuenta en <code>github</code> ) e importar su proyecto, los pasos detallados se describen en las <a href="" rel="nofollow">instrucciones</a> . <br>  Por tradici√≥n, creo un ambiente en <code>tox</code> : </p><br><pre> <code class="plaintext hljs">[testenv:gen_docs] deps = -r docs/requirements.txt commands = sphinx-build -b html docs/source/ docs/build/</code> </pre> <br><p>  Uso el <code>sphinx-build</code> expl√≠citamente, en lugar de <code>make</code> , ya que no existe en Windows.  Y no quiero violar el principio del desarrollo multiplataforma. </p><br><p>  Tan pronto como se congelen los cambios, <code>readthedocs.org</code> recopilar√° autom√°ticamente la documentaci√≥n y la publicar√°. </p><br><p>  Pero ... La <a href="https://github.com/readthedocs/readthedocs.org/issues/2569" rel="nofollow"><code>Build failed</code></a> .  No compromet√≠ las <code>sphinx_rtd_theme</code> <code>sphinx</code> y <code>sphinx_rtd_theme</code> , y esperaba que <code>readthedocs.org</code> tomara las versiones actuales.  Pero esto no es as√≠.  Yo arreglo: </p><br><pre> <code class="plaintext hljs">sphinx==2.3.1 sphinx_rtd_theme==0.4.3</code> </pre> <br><p>  Y creo un archivo de configuraci√≥n especial <code>.readthedocs.yml</code> para <code>readthedocs.org</code> , en el que describo el entorno para iniciar la compilaci√≥n: </p><br><pre> <code class="plaintext hljs">python: version: 3.7 install: - requirements: docs/requirements.txt - requirements: requirements.txt</code> </pre> <br><p>  Aqu√≠ es donde el hecho fue √∫til de que las dependencias est√°n en los archivos require.txt.  Estoy esperando la compilaci√≥n y la <a href="https://numeral-system-py.readthedocs.io/en/latest/" rel="nofollow">documentaci√≥n estar√° disponible</a> . </p><br><p>  Agregue la insignia nuevamente: </p><br><pre> <code class="plaintext hljs">|Docs| .. |Docs| image:: https://readthedocs.org/projects/numeral-system-py/badge/?version=latest&amp;style=flat :target: https://numeral-system-py.readthedocs.io/en/latest/</code> </pre> <br><h2 id="licenzirovanie">  Licencia </h2><br><p>  Vale la pena considerar elegir una licencia para el paquete. <br>  Este es un tema muy extenso, as√≠ que le√≠ <a href="https://habr.com/ru/post/243091/">este art√≠culo</a> .  B√°sicamente, la elecci√≥n es entre <a href="http://directory.fsf.org/wiki/License:Expat" rel="nofollow">MIT</a> y <a href="" rel="nofollow">Apache 2.0</a> .  Me gust√≥ la frase que se sac√≥ de contexto con √©xito: </p><br><pre> <code class="plaintext hljs">MIT      </code> </pre> <br><p>  Estoy completamente de acuerdo, lo har√©. Si los planes cambian, puede cambiar f√°cilmente la licencia (aunque las versiones anteriores estar√°n bajo la anterior). </p><br><p>  Nuevamente, agregue una insignia <del>  insignia de dios </del>  : </p><br><pre> <code class="plaintext hljs">|License| .. |License| image:: https://img.shields.io/badge/License-MIT-yellow.svg :target: https://opensource.org/licenses/MIT</code> </pre> <br><p>  <a href="https://gist.github.com/lukas-h/2a5d00690736b4c3a7ba" rel="nofollow">Aqu√≠</a> puede encontrar insignias para todas las licencias. </p><br><h2 id="kak-zalit-na-pypi">  ¬øC√≥mo subir a pypi? </h2><br><p>  Primero necesitas crear una cuenta en <a href="https://pypi.org/" rel="nofollow">pypi.org</a> .  Luego proceda con la preparaci√≥n del paquete. </p><br><h3 id="sozdayu-setupcfg">  Creo setup.cfg </h3><br><p>  Es necesario describir correctamente la configuraci√≥n para instalar / construir el paquete.  Segu√≠ las <a href="https://docs.python.org/3/distutils/introduction.html" rel="nofollow">instrucciones</a> .  Es posible establecer datos a trav√©s de <code>setup.py</code> , pero no hay opciones para establecer algunos par√°metros.  Por lo tanto, use el archivo <code>setup.cfg</code> , en el que puede especificar todos los matices.  Encontr√© una <a href="https://gist.github.com/althonos/6914b896789d3f2078d1e6237642c35c" rel="nofollow">peque√±a plantilla</a> sobre c√≥mo llenar este archivo.  Como resultado, utilizo ese y ese archivo, es m√°s conveniente. </p><br><p>  Este archivo tambi√©n se puede usar para configurar <code>pylint</code> , <code>flake8</code> y otras configuraciones, pero no lo hice. </p><br><h3 id="kak-sobrat-paket">  ¬øC√≥mo armar un paquete? </h3><br><p>  Nuevamente, estoy escribiendo un entorno que me ayudar√° a armar el paquete necesario: </p><br><pre> <code class="plaintext hljs">[testenv:build_wheel] skip_install = True deps = ;     wheel docutils pygments commands = python -c 'import shutil; (shutil.rmtree(p, ignore_errors=True) for p in ["build", "dist"]);' python setup.py sdist bdist_wheel</code> </pre> <br><p>  ¬øPor qu√© estoy borrando carpetas usando Python?  Quiero cumplir con el requisito para el desarrollo multiplataforma, no hay una forma conveniente de hacerlo en Windows y Unix. </p><br><p>  Lanzo el entorno de prueba: </p><br><pre> <code class="plaintext hljs">tox -e build_wheel</code> </pre> <br><p>  Como resultado, en la carpeta <code>dist</code> obtengo: </p><br><pre> <code class="plaintext hljs">dist/ numeral-system_py-0.1.0.tar.gz numeral_system-py-0.1.0-py2.py3-none-any.whl</code> </pre> <br><h3 id="zalivayu">  ¬°Lo completo! </h3><br><p>  En realidad no </p><br><p>  Para empezar, vale la pena verificar que el paquete funcione correctamente.  Lo subir√© al repositorio del paquete de prueba.  Por lo tanto, debe crear otra cuenta, pero ya en <a href="https://test.pypi.org/" rel="nofollow">test.pypi.org</a> . </p><br><p>  Utilizo el paquete de <a href="https://pypi.org/project/twine/" rel="nofollow">hilo</a> para esto, una herramienta para llenar artefactos en PyPi. </p><br><pre> <code class="plaintext hljs">[testenv:test_upload] skip_install = True deps = twine ;    commands = python -m twine upload --repository-url https://test.pypi.org/legacy/ dist/*</code> </pre> <br><p>  Inicialmente, el proyecto se llamaba <code>numsys</code> , pero cuando <code>numsys</code> de llenarlo, ¬°me encontr√© con el hecho de que ya existe un paquete con el mismo nombre!  Y lo que es m√°s molesto: tambi√©n sabe c√≥mo convertir a n√∫meros romanos :) No estaba muy molesto y cambi√≥ su nombre a <code>numeral-system-py</code> . </p><br><p>  Ahora necesita instalar el paquete desde el entorno de prueba.  La validaci√≥n tambi√©n debe automatizarse: </p><br><pre> <code class="plaintext hljs">[testenv:test_venv] skip_install = True ;         deps = ;   commands = pip install -i https://test.pypi.org/simple/ numeral-system-py</code> </pre> <br><p>  Ahora solo necesitas ejecutar: </p><br><pre> <code class="plaintext hljs">tox -e test_venv ... test_venv: commands_succeeded congratulations :)</code> </pre> <br><p>  Parece que funciona :) </p><br><h3 id="vot-teper-tochno-zalivayu">  Ahora definitivamente vierta! </h3><br><p>  Si </p><br><p>  Creo un entorno para subir al repositorio de producci√≥n. </p><br><pre> <code class="plaintext hljs">[testenv:pypi_upload] skip_install = True deps = twine commands = python -m twine upload dist/*</code> </pre> <br><p>  Y el entorno para la verificaci√≥n de producci√≥n. </p><br><pre> <code class="plaintext hljs">[testenv:pypi_venv] skip_install = True deps = ;    commands = pip install numeral-system-py</code> </pre> <br><h3 id="a-vse-tochno-rabotaet">  ¬øFunciona todo? </h3><br><p>  Compruebo con comandos simples: </p><br><pre> <code class="plaintext hljs">&gt; virtualenv venv &gt; source venv/bin/activate (venv) &gt; pip install numeral-system-py (venv) &gt; python &gt;&gt;&gt; import numeral_system &gt;&gt;&gt; numeral_system.roman.encode(7) 'VII'</code> </pre> <br><p>  ¬°Todo es genial! </p><br><p>  <a href="https://help.github.com/en/articles/creating-releases" rel="nofollow">Cort√© el lanzamiento en github</a> , <a href="https://help.github.com/en/articles/creating-releases" rel="nofollow">recog√≠</a> el paquete y lo rellen√© en el propi pypi. </p><br><h2 id="zamechaniya">  Observaciones </h2><br><h3 id="obnovleniya-zavisimostey">  Actualizaciones de dependencia </h3><br><p>  Durante la preparaci√≥n de este art√≠culo, se lanz√≥ una nueva versi√≥n de pytest, en la que, de hecho, se elimin√≥ el soporte para python 3.4 (en <a href="https://github.com/tox-dev/tox/issues/1483" rel="nofollow">realidad</a> en el paquete de <a href="https://github.com/tartley/colorama" rel="nofollow">colorama</a> ).  Hab√≠a dos opciones: </p><br><ol><li>  Comprometa la versi√≥n de colorama compatible con 3.4; </li><li>  Soltar el soporte 3.4 :) </li></ol><br><p>  A favor de la segunda opci√≥n, el √∫ltimo argumento fue que <code>pip</code> dej√≥ de admitir 3.4 en la versi√≥n 19.1. </p><br><p>  Tambi√©n hay dependencias fijas en forma de analizadores, formateadores y otros servicios.  Estas dependencias se pueden actualizar al mismo tiempo.  Si tiene suerte, solo obtendr√° la versi√≥n de actualizaci√≥n; de lo contrario, tendr√° que corregir el c√≥digo o incluso agregar la configuraci√≥n. </p><br><h3 id="travisci">  TravisCI </h3><br><p>  No es compatible con python para MacOS y Windows.  Hay dificultades con ejecutar <code>tox</code> para todas las versiones de python dentro del mismo trabajo. </p><br><h3 id="versiya-paketa">  Versi√≥n del paquete </h3><br><p>  Es necesario cumplir con <a href="https://semver.org/" rel="nofollow">las versiones sem√°nticas</a> , es decir, el formato: </p><br><pre> <code class="plaintext hljs">MAJOR.MINOR.PATCH</code> </pre> <br><h3 id="dublirovanie-meta-informacii">  Duplicaci√≥n de metainformaci√≥n </h3><br><p>  Se debe especificar la versi√≥n del paquete y algunos otros par√°metros para instalar el paquete (en <code>setup.cfg</code> o <code>setup.py</code> ) y en la documentaci√≥n.  Para evitar la duplicaci√≥n, hizo una indicaci√≥n solo en el paquete <code>numeral_system/__init__.py</code> : </p><br><pre> <code class="plaintext hljs">__version__ = '0.2.0'</code> </pre> <br><p>  Y luego en <code>setup.py</code> expl√≠citamente esta variable </p><br><pre> <code class="plaintext hljs">setup(version=numeral_system.__version__)</code> </pre> <br><p>  Lo mismo es cierto para en <code>docs/source/conf.py</code> </p><br><pre> <code class="plaintext hljs">release = numeral_system.__version__</code> </pre> <br><p>  Lo anterior es cierto para cualquier metainformaci√≥n: <code>REAMDE.rst</code> , descripciones de proyectos, licencias, nombres de autores y m√°s. </p><br><p>  Es cierto que esto lleva al hecho de que el paquete se est√° importando en el momento del ensamblaje, lo que puede ser indeseable. </p><br><h3 id="dublirovanie-zavisimostey">  Duplicaci√≥n de dependencia </h3><br><p>  Al principio, estaba confundido por el hecho de que necesitaba especificar dependencias para el paquete en <code>setup.cfg</code> y <code>setup.cfg</code> . <br>   <a href="https://caremad.io/posts/2013/07/setup-vs-requirement/" rel="nofollow"> </a> ,   ‚Äî     <code>setup.cfg</code> . <br>      . ,      <code>requirements-dev.txt</code>  . </p><br><h3 id="organizaciya-ishodnikov">   </h3><br><p>    ,       <code>src/</code> .     : </p><br><ul><li>       ; </li><li>    ,             ,   ; </li></ul><br><p>     : </p><br><ul><li>    <code>PyCharm</code> (    ?) ‚Äî   <code>src</code> ,   . </li></ul><br><h3 id="kommity-i-istoriya-izmeneniy">     </h3><br><p>           ‚Äî   . <br>  <a href="https://github.com/zifter/numeral-system-py/commits/master" rel="nofollow"> </a>  ,     : </p><br><pre> <code class="plaintext hljs">Add badge with supported version Support for py38</code> </pre> <br><p>     : </p><br><pre> <code class="plaintext hljs">Try fix py38 env creating Try fix py38 env creating Try fix py38 env creating Fix check</code> </pre> <br><p> , 3       !        Travis CI. </p><br><p>  <a href="https://habr.com/ru/post/416887/"> </a>  ,    .     ‚Äî     ,         . </p><br><p>         ,         .       <code>CHANGELOG</code> . </p><br><h3 id="dokumentaciya-1">  La documentaci√≥n </h3><br><p>     ,   <code>Markdown</code> .     ,      <code>rst</code> . </p><br><h3 id="beydzhi">  Insignias </h3><br><p>      ‚Äî  ,  ,   ,      .    ,     <a href="https://cmustrudel.github.io/papers/icse18badges.pdf" rel="nofollow"> </a> . <br>     <a href="https://pypi.org/project/coverage/" rel="nofollow">coverage</a> . </p><br><h3 id="ogranicheniya-iz-za-ispolzovaniya-raznyh-versiy">  -    </h3><br><p>   ,     ,  , .   <code>six</code>    ,       ,  <code>type hint</code> , <code>asyncio</code>    ‚Äî . <br>      <code>python2.7</code> ,   <a href="https://pythonclock.org/" rel="nofollow"> </a> .   ,    python3.5+,     . ,         ,      CI   .          . </p><br><h2 id="mozhno-li-sdelat-luchshe">    ? </h2><br><p>       ,    : </p><br><ul><li>   MacOS; </li><li>   python x64  x86; </li><li>   ; </li><li> 100%      ,    <a href="https://en.wikipedia.org/wiki/Cyclomatic_complexity" rel="nofollow">  </a> .     <a href="https://pypi.org/project/mccabe/" rel="nofollow">mccabe</a> ,      2017 .    ? </li><li>        <a href="https://pyup.io/" rel="nofollow">PyUp</a>  <a href="https://requires.io/" rel="nofollow">requires.io</a> .  ? </li><li>    .     <a href="https://github.com/PyCQA0" rel="nofollow">Python Code Quality Authority</a> , - ? <br><ul><li> <a href="http://mypy-lang.org/" rel="nofollow">mypy</a> ‚Äî  ; </li><li> <a href="https://github.com/PyCQA/bandit" rel="nofollow">bandit</a> ‚Äî       ; </li><li> <a href="https://github.com/PyCQA/pyflakes" rel="nofollow">Pyflakes</a> ‚Äî      ; </li><li> <a href="https://github.com/PyCQA/prospector" rel="nofollow">prospector</a> ‚Äî ,  <code>pylint</code> , <code>pep8</code> , <code>mccabe</code> . ,    ; </li></ul></li><li>   \   ? </li></ul><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>           open source ,     . <br>           ,    python   <code>github</code> ,       . <br>        <code>stackoverflow.com</code>  issues    <code>github</code>            . <br>           .      .      ?.. </p><br><p> ,  ,     <a href="https://habr.com/ru/company/ruvds/blog/444344/">   </a> . <br>       ,    <a href="https://sourcery.ai/blog/python-best-practices/" rel="nofollow"> </a> . </p><br><p> <a href="https://github.com/zifter/numeral-system-py" rel="nofollow">    github</a> . </p><br><p>  Gracias </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/483512/">https://habr.com/ru/post/483512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../483502/index.html">Sol, viento y agua ver 0.2</a></li>
<li><a href="../483504/index.html">C√≥mo es Sporth - YaP para sesiones de m√∫sica en vivo</a></li>
<li><a href="../483506/index.html">Sue√±os de un vac√≠o profundo (parte 1). Bomba de difusi√≥n de vapor y aceite: reanimaci√≥n y un poco de teor√≠a</a></li>
<li><a href="../483508/index.html">Los 10 mejores documentos de conferencia C ++ CoreHard Oto√±o 2019</a></li>
<li><a href="../483510/index.html">Probador para una peque√±a empresa como esta</a></li>
<li><a href="../483516/index.html">Deja de poner diodo 2</a></li>
<li><a href="../483518/index.html">El desarrollador del juego VVVVVV en honor a su d√©cada hizo que el c√≥digo fuente se abriera</a></li>
<li><a href="../483520/index.html">Usando el observador del patr√≥n de similitud en C</a></li>
<li><a href="../483524/index.html">An√°lisis de Habra: ¬øcu√°ndo es mejor publicar tu publicaci√≥n?</a></li>
<li><a href="../483526/index.html">Administrar el estado de la aplicaci√≥n con RxJS / Immer como una alternativa simple a Redux / MobX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>