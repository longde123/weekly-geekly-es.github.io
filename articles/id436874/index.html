<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‡ğŸ¼ â›¹ï¸ ğŸ¤³ğŸ¿ Tarian Tahun Baru di sekitar adaptor FC atau kisah tentang seberapa jauh penyebab masalah berasal dari gejala ğŸ™ğŸ½ âœ‹ğŸ½ ğŸ–ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jadi, pada tanggal 4 Januari, jam 7:15, setelah menyeka mataku dari tidur, saya menemukan paket pesan di grup Telegram dari server Zabbix sehingga beb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tarian Tahun Baru di sekitar adaptor FC atau kisah tentang seberapa jauh penyebab masalah berasal dari gejala</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436874/"><p>  Jadi, pada tanggal 4 Januari, jam 7:15, setelah menyeka mataku dari tidur, saya menemukan paket pesan di grup Telegram dari server Zabbix sehingga beban CPU pada salah satu server virtualisasi meningkat: </p><br><p><img src="https://habrastorage.org/webt/mb/6o/wz/mb6owzivk1hb0e_mfwe5_ycsobk.png"><a name="habracut"></a><cut></cut><br>  Setelah melihat sejarah di Zabbix, saya naik ke server dan mencari di dmesg, di mana saya menemukan yang berikut: </p><br><pre><code class="plaintext hljs">[  3 20:05:18 2019] qla2xxx [0000:21:00.1]-015b:10: Disabling adapter. [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device [  3 20:05:28 2019] sd 10:0:0:1: rejecting I/O to offline device</code> </pre> <br><p>  Saya naik ke penyimpanan di mana adaptor QLogic FC melihat, saya melihat bahwa pada 1 Januari pukul 19.54 salah satu drive dalam penyimpanan tidak digunakan, drive Spare diambil dan resilver berakhir pada 2 Januari pukul 9:11: </p><br><p><img src="https://habrastorage.org/webt/ub/9-/jg/ub9-jgtho_qzgy6payivxhvmwqs.png"></p><br><p>  Saya berpikir: mungkin sesuatu berasal dari repositori atau sakelar FC, yang menyebabkan pengemudi marah dengan adaptor QLogic. </p><br><p>  Menciptakan tugas di pelacak, me-restart server, semuanya berfungsi kembali sebagaimana mestinya, sekilas. </p><br><p>  Mengenai hal ini ia menunda tindakan lebih lanjut sampai akhir liburan Tahun Baru. </p><br><p>  Dengan dimulainya minggu kerja pada 9 Januari, ia mulai memilah penyebab kegagalan. </p><br><p>  Karena pesan: </p><br><pre> <code class="plaintext hljs">[  3 20:05:18 2019] qla2xxx [0000:21:00.1]-015b:10: Disabling adapter.</code> </pre> <br><p>  tidak terlalu informatif, naik ke sumber driver. </p><br><p>  Dilihat oleh kode driver, sebuah pesan dikeluarkan ketika driver diturunkan karena kesalahan pada PCI (linux / drivers / scsi / qla2xxx / qla_os.c (kernel v4.15)): </p><br><pre> <code class="plaintext hljs">qla2x00_disable_board_on_pci_error(struct work_struct *work) { struct qla_hw_data *ha = container_of(work, struct qla_hw_data, board_disable); struct pci_dev *pdev = ha-&gt;pdev; scsi_qla_host_t *base_vha = pci_get_drvdata(ha-&gt;pdev); /* * if UNLOAD flag is already set, then continue unload, * where it was set first. */ if (test_bit(UNLOADING, &amp;base_vha-&gt;dpc_flags)) return; ql_log(ql_log_warn, base_vha, 0x015b, "Disabling adapter.\n");</code> </pre> <br><p>  Saya mulai menggali lebih jauh, masuk ke BMC, saya melihat di Event Log: </p><br><p><img src="https://habrastorage.org/webt/kd/w_/rm/kdw_rm1wokwi6sblbx-jdvfxj9u.png"></p><br><p>  Ternyata salah satu dari dua simpul CPU dalam platform adalah pemanasan dan pelambatan, dan waktu pesan tentang pembongkaran driver adaptor FC berkorelasi dengan waktu mulai pelambatan. </p><br><p>  Di sini layak untuk membuat pernyataan bahwa platform server yang kami miliki di sini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.supermicro.com/Aplus/system/2U/2123/AS-2123BT-HNC0R.cfm</a> dengan dua EPYC 7601 untuk setiap node: </p><br><p><img src="https://habrastorage.org/webt/4g/qj/_m/4gqj_mauh8b6ogspym5sau493oi.jpeg"></p><br><p>  Saya memindahkannya ke pusat data, menghapus node dari server, mengubah thermal paste, menempelkannya kembali, tetapi masih memanas. </p><br><p>  Kami perhatikan bahwa aliran udara di satu bagian server tidak sekuat di bagian lainnya.  Setelah sedikit memuat semua node dengan stress-ng, menjadi jelas bahwa prosesor node di sisi kanan platform tidak meledak dengan baik dan suhu CPU kedua dalam dua node sangat cepat mencapai kritis. </p><br><p>  Setelah mencoba mengubah parameter hembusan di BMC, ternyata tidak ada efek: </p><br><p><img src="https://habrastorage.org/webt/q5/e-/ng/q5e-ngkv2nevpw9bz2aod-rbgum.png"></p><br><p>  Restart BMC juga tidak berpengaruh. </p><br><p>  Setelah melihat dalam Bacaan Sensor, saya melihat bahwa pada satu node dari 53 sensor, hanya 4 yang terdeteksi, dan pada node lainnya hanya 6: </p><br><p><img src="https://habrastorage.org/webt/dn/47/d3/dn47d3mxpac_i_gktmyjql3rn7u.png"></p><br><p>  Dan kemudian, saya ingat ketika menginstal versi BIOS baru dan BMC baru ke node satu atau dua bulan yang lalu, pada dua node saya tidak mereset konfigurasi BMC ke parameter pabrik (untuk memeriksa satu kasus penyetelan tertentu). </p><br><p>  Setelah mengatur ulang BMC ke parameter pabrik, ke-53 sensor kembali terdeteksi, kontrol kecepatan kipas kembali bekerja, prosesor berhenti menghangat. </p><br><p>  Fakta bahwa penyebab pembongkaran driver QLogic adalah prosesor yang terlalu panas tidak akurat, tetapi saya tidak menemukan korelasi dekat lainnya. </p><br><p>  Kesimpulan: </p><br><ol><li>  setelah firmware BMC, bahkan jika semuanya berfungsi dengan baik pada pandangan pertama, masih layak untuk diatur ulang ke pengaturan pabrik; </li><li>  Tentu saja, pesan kesalahan suhu dan kernel harus dipantau dan ini wajar dalam rencana, tetapi tidak semuanya sekaligus. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id436874/">https://habr.com/ru/post/id436874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id436862/index.html">AMD Ryzen Matisse Generasi ke-3: Octa-Core Zen 2 dengan PCIe 4.0 untuk Desktop</a></li>
<li><a href="../id436864/index.html">Cara menguji distribusi OS Anda sendiri</a></li>
<li><a href="../id436866/index.html">Cara mengenali proyek Agile palsu</a></li>
<li><a href="../id436868/index.html">Sematkan analisis statis ke dalam proses, bukan cari bug dengan itu</a></li>
<li><a href="../id436872/index.html">PGConf.Russia 2019 Segera Hadir</a></li>
<li><a href="../id436876/index.html">[SAP] SAPUI5 untuk boneka bagian 1: Latihan selangkah demi selangkah yang lengkap</a></li>
<li><a href="../id436878/index.html">BERT adalah model bahasa tercanggih untuk 104 bahasa. Tutorial untuk meluncurkan BERT secara lokal dan di Google Colab</a></li>
<li><a href="../id436880/index.html">C ++ Dasar-dasar Templat: Templat Fungsi</a></li>
<li><a href="../id436884/index.html">Kami menguasai async / menunggu contoh nyata</a></li>
<li><a href="../id436886/index.html">Menggunakan Babel dan Webpack untuk mengatur proyek Bereaksi dari awal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>