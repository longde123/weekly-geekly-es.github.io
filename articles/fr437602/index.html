<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”Ÿ ğŸ‘¨ğŸ¿â€âš•ï¸ ğŸ‘©ğŸ»â€âš–ï¸ Profil d'un projet Unity avec Android Studio ğŸ‘‡ğŸ¼ ğŸ“„ ğŸ‘Š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonne journÃ©e Ã  tous! Cet article explique comment profiler les jeux Unity sur Android avec Android Studio. Je vais vous expliquer comment configurer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Profil d'un projet Unity avec Android Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437602/">  Bonne journÃ©e Ã  tous!  Cet article explique comment profiler les jeux Unity sur Android avec Android Studio.  Je vais vous expliquer comment configurer Android Studio et obtenir le maximum de donnÃ©es.  Les questions d'analyse et de conclusions basÃ©es sur le rÃ©sultat sortent du cadre de cet article. <br><a name="habracut"></a><br><h2>  PrÃ©requis </h2><br>  Pour profiler pleinement l'application, vous avez besoin d'un tÃ©lÃ©phone avec Android 8 ou version ultÃ©rieure (API 27).  Dans l'expÃ©rience, le profilage avec les anciennes versions d'Android est plus aventureux que bon.  Pour cette raison, je recommande d'obtenir une gamme complÃ¨te d'appareils Nexus, car ils ont un ancien matÃ©riel et les derniÃ¨res mises Ã  jour Android. <br><br><h2>  Configuration d'un projet Unity </h2><br>  Pour obtenir le rÃ©sultat, vous devez configurer le projet Unity d'une certaine maniÃ¨re. <br><br><h3>  ParamÃ¨tres dans les paramÃ¨tres de build </h3><br><img src="https://habrastorage.org/webt/av/tr/ju/avtrjuzmsq9xk8egl88e_osxbz4.jpeg" alt="image"><br><br><ul><li>  Tout d'abord, vous devez basculer le <b>systÃ¨me de construction</b> sur <b>Â«GradleÂ»</b> et cocher la case Ã  cÃ´tÃ© de <b>Â«Exporter le projetÂ»</b> .  Ainsi, nous aurons un projet Android Studio prÃªt Ã  l'emploi, que nous continuerons Ã  profiler.  Le profilage d'un fichier APK fini est Ã©galement possible, mais plus limitÃ© et nÃ©cessite plus de prÃ©paration. </li><li>  Il est conseillÃ© de dÃ©sactiver le mode <b>Â«Development BuildÂ»</b> , car les timings rÃ©sultants dans le profileur seront aussi proches que possible des vrais. </li></ul><br><h3>  ParamÃ¨tres dans les paramÃ¨tres du lecteur </h3><br><img src="https://habrastorage.org/webt/-7/hz/ho/-7hzhozfm55alhksgs0jozpm488.jpeg" alt="image"><br><br><ul><li>  Installez le <b>backend de script</b> dans <b>IL2CPP</b> .  Si vous quittez Mono, avec le profilage natif, nous verrons de nombreuses fonctions Mono, sans informations sur la faÃ§on dont elles se rapportent au code C #. <br></li><li>  L'option <b>'Configuration du compilateur C ++'</b> pour Android n'a aucun effet (dans Unity 2018.3).  Vous pouvez le mettre dans 'Release', peut-Ãªtre que dans les futures versions de la chaÃ®ne d'outils Unity Android, ce paramÃ¨tre affectera les paramÃ¨tres du compilateur. <br></li><li>  Il est conseillÃ© de limiter l <b>'Â«architecture cibleÂ»</b> Ã  <b>ARMv7</b> .  Ainsi, vous Ã©conomisez du temps de compilation et faites l'expÃ©rience de nombreuses architectures qui mettent parfois Android Studio dans une stupeur. <br></li><li>  Il convient Ã©galement de dÃ©finir un certain nombre de paramÃ¨tres supplÃ©mentaires: <ul><li>  Emplacement d'installation - Â«PrÃ©fÃ©rer externeÂ» </li><li>  AccÃ¨s Internet - Â«RequisÂ» </li><li>  Autorisation d'Ã©criture - Â«Externe (SDCard)Â» </li></ul><br>  Android Studio et d'autres profileurs utilisent simpleperf pour collecter des statistiques, et il aura besoin d'accÃ©der Ã  une carte mÃ©moire pour enregistrer des fichiers temporaires. <br></li></ul><br><h2>  PrÃ©paration du projet Gradle </h2><br>  AprÃ¨s avoir installÃ© tous les paramÃ¨tres, crÃ©ez un projet Unity.  Vous devriez obtenir un dossier avec le projet Gradle. <br><img src="https://habrastorage.org/webt/vt/qq/fi/vtqqfixujd8ntg_ipoycbp9exwc.jpeg" alt="image"><br><br>  Par dÃ©faut, Unity crÃ©e un projet afin que vous envisagiez de crÃ©er le fichier APK final Ã  partir de celui-ci.  Par consÃ©quent, toutes les informations de dÃ©bogage en ont Ã©tÃ© supprimÃ©es, mais heureusement, elles peuvent Ãªtre renvoyÃ©es.  Pour ce faire, vous devez remplacer libil2cpp.so et libunity.so par la version contenant des informations de dÃ©bogage. <br><br><h3>  libil2cpp.so </h3><br>  Il s'agit d'un fichier qui contient tout le code C ++ gÃ©nÃ©rÃ© par IL2CPP Ã  partir de votre code C #.  Unity gÃ©nÃ¨re toutes les informations nÃ©cessaires au profilage, mais pour optimiser la taille de l'APK, il les supprime pendant le processus de gÃ©nÃ©ration.  Pour le retourner: <br><ul><li>  AccÃ©dez Ã  votre dossier de projet </li><li>  Localisez-y le sous-dossier <b>Temp</b> et accÃ©dez au sous-dossier <b>Temp / StagingArea / symboles / armeabi-v7a</b> </li><li>  Recherchez <b>'libil2cpp.so.debug'</b> dedans.  Il s'agit de la version de Â«libil2cpp.soÂ» avec des informations de dÃ©bogage. </li><li>  Maintenant, allez dans le projet Gradle et trouvez le dossier <b>'\ src \ main \ jniLibs \ armeabi-v7a' dedans</b> </li><li>  Remplacez <b>'libil2cpp.so' par le</b> fichier <b>'libil2cpp.so.debug'</b> </li></ul><br><h3>  libunity.so </h3><br>  Il s'agit du fichier qui contient la partie de bas niveau de Unity Player.  Puisque nous effectuons des versions Release, Unity place un fichier dans votre projet sans dÃ©boguer les informations.  Vous devez remplacer libunity.so par un fichier de caractÃ¨res. <br><br><ul><li>  AccÃ©dez au dossier dans lequel vous avez installÃ© Unity </li><li>  AccÃ©dez au dossier <b>"\ Data \ PlaybackEngines \ AndroidPlayer \ Variations \ il2cpp \ Development \ Libs \ armeabi-v7a \"</b> </li><li>  Prenez le fichier <b>libunity.so</b> Ã  partir de lÃ  et remplacez le fichier dans votre projet, qui se trouve dans le dossier <b>'\ src \ main \ jniLibs \ armeabi-v7a'</b> </li></ul><br><h2>  Profilage </h2><br>  Vous pouvez maintenant dÃ©marrer le profilage dans Android Studio, cliquez simplement sur le bouton DÃ©marrer le profileur. <br><br><img src="https://habrastorage.org/webt/le/b3/yi/leb3yimardolvn0inirdf0hh-ak.jpeg" alt="image"><br><br>  Android Studio lance l'application et la session de profilage commence <br><br><img src="https://habrastorage.org/webt/q7/jv/na/q7jvnadenwr-9ixtxu-ac7l0exe.jpeg" alt="image"><br><br>  Par dÃ©faut, Android Studio affiche des graphiques, mais n'Ã©chantillonne pas de donnÃ©es.  Pour dÃ©marrer le processus, vous devez cliquer sur la piste CPU afin que le profileur passe Ã  la vue CPU.  Dans ce cas, une liste dÃ©roulante et le bouton Â«EnregistrerÂ» apparaÃ®tront en haut de la fenÃªtre. <br><br><img src="https://habrastorage.org/webt/_q/1t/qi/_q1tqikjnm-9vqltl3zvwh8t1am.jpeg" alt="image"><br><br>  SÃ©lectionnez Sampled 'Native' (Dans Android Studio 3.3 - C / C ++ Native), puis cliquez sur le bouton 'Enregistrer'. <br>  Ã‰tant donnÃ© que l'enregistrement se fait sur le disque de l'appareil, il est prÃ©fÃ©rable de ne pas enregistrer plus de 5 Ã  8 secondes d'expÃ©rience, de nombreux appareils Ã©choueront Ã©galement sur une plus petite quantitÃ© de donnÃ©es (voir la liste des appareils testÃ©s Ã  la fin de l'article). <br><br>  Pour obtenir le rÃ©sultat, cliquez sur Â«ArrÃªterÂ» puis sur un carrÃ© rouge pour interrompre la session.  Il est difficile de comprendre l'idÃ©e des auteurs, mais si vous n'arrÃªtez pas complÃ¨tement l'enregistrement, le profileur ne commence pas toujours Ã  analyser les donnÃ©es reÃ§ues et votre segment avec les donnÃ©es ira loin. <br><br><img src="https://habrastorage.org/webt/nc/s6/wb/ncs6wbzxzmnl2ekezsbeikdalto.jpeg" alt="image"><br><br>  AprÃ¨s cela, il ne reste plus qu'Ã  attendre un peu, aprÃ¨s 30-50 secondes le profileur vous donnera le rÃ©sultat.  Si tout est correctement configurÃ©, vous obtiendrez la capture avec tous les noms de fonction <br><br><img src="https://habrastorage.org/webt/ft/ws/9a/ftws9av2ird_wbbvppc3af9smey.jpeg" alt="image"><br><br><h2>  CaractÃ©ristiques connues </h2><br><ul><li>  Les rÃ©sultats les plus stables peuvent Ãªtre obtenus sur les appareils racine </li><li>  N'utilisez pas Samsung, et ils ont de nombreuses cloches et sifflets de protection qui interfÃ¨rent avec le dÃ©bogage </li><li>  Dans de nombreux endroits, votre pile collective ira dans des fonctions de la forme Â«kernel.kptr + addressÂ».  Ce sont des appels dans Android Kernel qui sont protÃ©gÃ©s en raison de politiques de sÃ©curitÃ©.  Sur un appareil rootÃ©, la protection peut Ãªtre dÃ©sactivÃ©e: <br><ul><li>  ExÃ©cutez le `adb shell` </li><li>  ExÃ©cutez `su` pour obtenir les privilÃ¨ges root </li><li>  ExÃ©cutez 'sysctl -w kernel.kptr_restrict = 0' - cela supprimera la protection du noyau </li><li>  <b>[!] Une</b> fois le dÃ©bogage terminÃ©, exÃ©cutez 'sysctl -w kernel.kptr_restrict = 1'.  Certains appareils ne pourront pas dÃ©marrer le systÃ¨me d'exploitation sinon au redÃ©marrage.  Dans de nombreux cas, il n'est traitÃ© qu'en faisant clignoter un noyau propre. </li></ul></li><li>  Si Android Studio se bloque frÃ©quemment, vous pouvez essayer d'augmenter le tas de machine virtuelle Java: <ul><li>  2 Go - pour les projets de taille moyenne (Â«-Xmx2gÂ») </li><li>  4Gb - pour les grands projets ('-Xmx4g') </li></ul></li><li>  Sur les pÃ©riphÃ©riques non rootÃ©s, le passage du noyau en Â«mode permissifÂ» amÃ©liore parfois la situation. <br><ul><li>  ExÃ©cutez la commande 'adb shell setenforce 0' </li></ul></li></ul><br><h2>  SpÃ©cificitÃ©s de l'unitÃ© </h2><br><ul><li>  Le thread principal Unity s'appelle UnityMain, mais vous pouvez voir beaucoup d'UnityMain lors du profilage.  Ce sont des threads utilisateur que vous crÃ©ez dans le code C #.  Par dÃ©faut, ils obtiennent le mÃªme nom.  Le thread principal d'Unity est gÃ©nÃ©ralement facile Ã  distinguer, car il sera le plus chargÃ©. </li><li>  Le flux graphique est appelÃ© UnityGfxWorkerW </li><li>  Les threads du systÃ¨me Unity Job sont appelÃ©s Thread Worker. </li><li>  Malheureusement, certaines fonctions d'attente qu'Unity utilise (futex-s), Android Studio affiche et considÃ¨re non pas comme un temps d'attente, mais comme une activitÃ©. </li><li>  Lorsque vous regardez le graphique des appels dans la vue descendante, vous devez passer par plusieurs niveaux avec un appel Java, malheureusement vous ne pouvez pas le filtrer dans Android Studio. </li></ul><br><img src="https://habrastorage.org/webt/f_/it/lp/f_itlpp-dlvolgu5pb-ze7rz4oe.jpeg" alt="image"><br><br><h2>  Appareils recommandÃ©s </h2><br>  Nous avons utilisÃ© les appareils suivants pour les expÃ©riences: <br><ul><li>  Samsung Galaxy S8 </li><li>  Google Pixel 2XL </li><li>  Pixel Google </li><li>  Sony Xperia XA1 </li><li>  Huawei Honor 7 </li><li>  Huawei Nexus 6P </li><li>  Moto G5P </li><li>  Asus Nexus 7 (2013) </li></ul><br>  Tous les appareils ont Ã©tÃ© installÃ©s, pour Huawei Nexus 6P, nous avons assemblÃ© le cÅ“ur et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AOSP</a> .  En consÃ©quence, Google et Sony se sont avÃ©rÃ©s Ãªtre les plus faciles et les plus faciles Ã  travailler.  Sony a un excellent site pour les dÃ©veloppeurs - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Open Devices</a> .  Huawei ne vous permet plus de dÃ©verrouiller facilement des appareils, Samsung cause des difficultÃ©s constantes avec des niveaux de protection supplÃ©mentaires.  Le Moto G5P a souvent bloquÃ© le processus de collecte de donnÃ©es du profileur (simpleperf). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437602/">https://habr.com/ru/post/fr437602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437592/index.html">Architecture de couche d'exÃ©cution de tÃ¢che asynchrone</a></li>
<li><a href="../fr437594/index.html">Comment j'ai Ã©radiquÃ© la cause du bÃ©gaiement et du saut de trame dans tous les jeux, et aussi abaissÃ© accidentellement la tempÃ©rature de 15 degrÃ©s</a></li>
<li><a href="../fr437596/index.html">OTRS: authentification, autorisation et synchronisation LDAP (FreeIPA, AD)</a></li>
<li><a href="../fr437598/index.html">Comment enregistrer le systÃ¨me de jeu Ã  partir d'un PC personnel au moyen de la virtualisation</a></li>
<li><a href="../fr437600/index.html">opencv4arts: Dessine ma ville, Vincent</a></li>
<li><a href="../fr437604/index.html">Effondrement de la fonction d'onde: un algorithme inspirÃ© de la mÃ©canique quantique</a></li>
<li><a href="../fr437606/index.html">Qui mange la mÃ©moire de notre iPhone? Peler les pommes</a></li>
<li><a href="../fr437610/index.html">[longrid] 20 ans de carriÃ¨re en programmation dans une grande petite ville</a></li>
<li><a href="../fr437612/index.html">Le gÃ©ant de l'informatique traitera de la photonique au silicium - comment cela affectera le marchÃ© des Ã©quipements de rÃ©seau</a></li>
<li><a href="../fr437614/index.html">Le modÃ¨le architectural de l'itÃ©rateur dans l'univers Swift</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>