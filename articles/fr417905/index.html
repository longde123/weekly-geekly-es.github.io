<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§πüèæ üåí ü§¥ 11 fa√ßons (de ne pas) devenir victime de piratage √† Kubernetes üßìüèª üñãÔ∏è üì¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque perev. : L'original de cet article a √©t√© publi√© sur le blog officiel de Kubernetes et √©crit par Andrew Martin, l'un des fondateurs de la jeun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>11 fa√ßons (de ne pas) devenir victime de piratage √† Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/417905/">  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: L'original de cet article a √©t√© publi√© sur le blog officiel de Kubernetes et √©crit par Andrew Martin, l'un des fondateurs de la jeune soci√©t√© britannique Control Plane, sp√©cialis√©e dans la s√©curit√© des applications cloud natives fonctionnant sur K8.</i> <br><br><img src="https://habrastorage.org/webt/em/sv/dw/emsvdwgvf4ym5fydg8ob7jxomcq.jpeg"><br><br>  La s√©curit√© √† Kubernetes a parcouru un long chemin depuis l'arriv√©e du projet, mais des √©cueils persistent.  Nous proposons une liste de recommandations utiles sur la fa√ßon de prot√©ger les clusters et d'augmenter leur stabilit√© en cas de piratage: nous allons commencer par le plan de contr√¥le, continuer avec les charges de travail et la s√©curit√© du r√©seau, et terminer par une √©valuation de la s√©curit√© future. <a name="habracut"></a><br><br><h2>  Partie 1: Plan de contr√¥le </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le plan de contr√¥le</a> est le cerveau de Kubernetes.  Il a une id√©e g√©n√©rale de chaque conteneur et pod s'ex√©cutant dans le cluster, peut planifier de nouveaux pods (qui peuvent contenir des conteneurs avec un acc√®s root √† leurs n≈ìuds parents) et peut lire tous les secrets stock√©s dans le cluster.  Il s'agit d'un composant tr√®s important qui n√©cessite une protection constante contre les fuites accidentelles de donn√©es et les actions malveillantes: √† la fois lors de son acc√®s, lorsque rien ne se produit et lorsque les donn√©es sont transmises sur le r√©seau. <br><br><h3>  1. TLS ubiquitaire </h3><br>  <b>Pour chaque composant qui prend en charge TLS, il doit √™tre activ√© - pour emp√™cher le reniflement du trafic, la v√©rification de l'identit√© du serveur et (dans le cas de Mutual TLS) la v√©rification de l'identit√© du client.</b> <br><br><blockquote>  "Veuillez noter que certains composants et m√©thodes d'installation peuvent activer les ports locaux pour HTTP, les administrateurs doivent donc se familiariser avec les param√®tres de chaque composant pour identifier les chemins possibles pour le trafic non s√©curis√©." <br><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Depuis la documentation de Kubernetes</a></i> </blockquote><br>  Le sch√©ma de r√©seau ci-dessous de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lucas K√§ldstr√∂m</a> montre o√π TLS est id√©alement n√©cessaire: entre chaque composant de l'assistant, et entre Kubelet et le serveur API.  Le classique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kelsey Hightower</a> <a href="">Kubernetes The Hard Way</a> et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de s√©curit√© sur etcd</a> offrent des instructions d√©taill√©es pour atteindre ces objectifs. <br><br><img src="https://habrastorage.org/webt/tl/z6/9p/tlz69p-_qgydpvdbkb8i0wkwjlm.png"><br><br>  Historiquement, la mise √† l'√©chelle automatique des n≈ìuds Kubernetes n'√©tait pas facile, car chaque n≈ìud n√©cessitait une cl√© TLS pour se connecter au ma√Ætre, et garder les secrets dans les images de base est une mauvaise pratique.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'amor√ßage Kubelet TLS</a> permet au nouveau Kubelet de cr√©er une demande de signature de certificat afin que les certificats soient g√©n√©r√©s au d√©marrage: <br><br><img src="https://habrastorage.org/webt/js/7x/bw/js7xbwddp6cgld-bgcp20r657qy.png"><br><br><h3>  2. Privil√®ges minimum dans RBAC, d√©sactivation d'ABAC, surveillance des journaux </h3><br>  <b>Le contr√¥le d'acc√®s bas√© sur les r√¥les (RBAC) fournit une gestion de strat√©gie pr√©cise par laquelle les utilisateurs acc√®dent aux ressources telles que les espaces de noms.</b> <br><br><img src="https://habrastorage.org/webt/if/so/hz/ifsohz4fgeo5alqvpe4pbvimujq.png"><br><br>  Le contr√¥le d'acc√®s bas√© sur les attributs (ABAC) dans Kubernetes a √©t√© remplac√© par RBAC depuis K8s 1.6 et ne doit pas √™tre activ√© du c√¥t√© serveur de l'API.  Utilisez plut√¥t RBAC: <code>--authorization-mode=RBAC</code> (ou cet indicateur pour GKE: --no <code>--no-enable-legacy-authorization</code> ). <br><br>  Il existe de nombreux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bons exemples de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">strat√©gies RBAC</a> pour divers services dans un cluster, ainsi que de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  Mais ne vous arr√™tez pas l√†: les param√®tres comp√©tents pour les strat√©gies RBAC peuvent √™tre obtenus en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">audit2rbac √†</a> partir des journaux d' <code>audit</code> . <br><br>  Des politiques RBAC incorrectes ou trop permissives constituent un risque pour la s√©curit√© si le foyer est compromis.  Le maintien des r√®gles du RBAC avec des privil√®ges minimaux, leur audit permanent et leur am√©lioration devraient faire partie de ¬´l'hygi√®ne technique de la dette¬ª que les √©quipes appliquent dans le cycle de vie du d√©veloppement. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La journalisation d'audit</a> (b√™ta dans Kubernetes 1.10) offre une API de journalisation personnalis√©e pour les charges de travail (telles que les demandes et les r√©ponses) et au niveau des m√©tadonn√©es.  Le niveau de journalisation peut √™tre configur√© conform√©ment √† la politique de s√©curit√© de l'organisation - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GKE</a> applique des valeurs par d√©faut raisonnables pour ceux qui commencent tout juste √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utiliser</a> . <br><br>  Pour les demandes de lecture telles que <i>get</i> , <i>list</i> et <i>watch</i> , seul l'objet demand√© est stock√© dans les journaux d'audit, sans objet de r√©ponse.  Pour les requ√™tes impliquant des donn√©es sensibles comme <i>Secret</i> ou <i>ConfigMap</i> , seules les m√©tadonn√©es sont export√©es.  Pour toutes les autres demandes, les deux objets sont enregistr√©s dans les journaux d'audit: √† la fois la demande et la r√©ponse. <br><br>  N'oubliez pas: le stockage de ces journaux √† l'int√©rieur du cluster est un risque de s√©curit√© en cas de compromis.  Ces journaux, comme tous les autres sensibles √† la s√©curit√©, doivent √™tre plac√©s en dehors du cluster afin d'√©viter des cons√©quences n√©gatives en cas de vuln√©rabilit√©. <br><br><h3>  3. Utilisez l'authentification tierce pour le serveur API </h3><br>  <b>La centralisation de l'authentification et de l'autorisation pour l'ensemble de l'organisation (c'est-√†-dire, l'authentification unique) facilite les processus d'acceptation et de d√©part de nouveaux employ√©s, garantissant des droits d'acc√®s coh√©rents.</b> <br><br>  L'int√©gration de Kubernetes avec des fournisseurs d'authentification tiers (comme Google ou GitHub) offre des garanties d'identit√© √† partir d'une plate-forme distante (avec une protection comme l'authentification √† deux facteurs) et √©limine la n√©cessit√© pour les administrateurs de reconfigurer le serveur API dans Kubernetes pour ajouter / supprimer des utilisateurs. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dex</a> est un fournisseur OpenID Connect Identity (OIDC) et OAuth 2.0 avec des plug-ins.  Pusher est all√© encore plus loin en fournissant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des outils personnalisables</a> , auxquels s'ajoutent d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autres</a> aides ax√©es sur d'autres applications. <br><br><h3>  4. S√©parez et placez votre cluster, etc. derri√®re le pare-feu </h3><br>  <b>etcd stocke des informations sur l'√©tat et les secrets de Kubernetes, est un composant essentiel des K8 - il doit √™tre prot√©g√© s√©par√©ment du reste du cluster.</b> <br><br>  L'acc√®s en √©criture √† etcd sur le serveur API √©quivaut √† attribuer des droits root √† l'ensemble du cluster, et m√™me l'acc√®s en lecture peut √™tre facilement utilis√© pour augmenter les privil√®ges. <br><br>  Le planificateur Kubernetes dans etcd recherche les d√©finitions de pod qui n'ont pas de n≈ìud.  Il envoie ensuite tous les pods trouv√©s au Kubelet disponible pour la planification.  La validation de ces pods est effectu√©e par le serveur API avant de les √©crire dans etcd, de sorte que les attaquants √©crivant directement dans etcd peuvent contourner de nombreux m√©canismes de s√©curit√© - par exemple, <code>PodSecurityPolicies</code> . <br><br>  etcd doit √™tre configur√© avec les <a href="">deux certificats TLS</a> ( <i>client</i> et <i>homologue</i> ) et d√©ploy√© sur des n≈ìuds d√©di√©s.  Pour r√©duire le risque de vol et d'utilisation de cl√©s priv√©es des n≈ìuds de travail, vous pouvez √©galement limiter le pare-feu du cluster API Server. <br><br><h3>  5. Rotation des cl√©s de cryptage </h3><br>  <b>La rotation r√©guli√®re des cl√©s de s√©curit√© et des certificats est la meilleure pratique de s√©curit√© qui vous permet de limiter le "rayon de destruction" lorsque la cl√© est compromise.</b> <br><br>  Kubernetes effectuera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">automatiquement la rotation de</a> certains certificats (en particulier, les certificats client et serveur Kubelet) en cr√©ant de nouveaux CSR apr√®s l'expiration des certificats actuels. <br><br>  Cependant, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cl√©s sym√©triques</a> utilis√©es par le serveur API pour crypter les valeurs etcd ne sont pas tourn√©es automatiquement - cela doit √™tre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fait manuellement</a> .  Cette op√©ration n√©cessite un acc√®s ma√Ætre, donc les services g√©r√©s (comme GKE et AKS) cachent le probl√®me √† l'utilisateur. <br><br><h2>  Partie 2: charges de travail </h2><br>  Avec une s√©curit√© minimale au niveau du plan de contr√¥le, le cluster peut d√©j√† fonctionner en toute s√©curit√©.  Cependant, comme pour un navire avec une cargaison potentiellement dangereuse, les conteneurs d'un tel navire doivent prot√©ger la cargaison en cas d'accident ou de fuite impr√©vus.  Il en va de m√™me pour les charges de travail Kubernetes (pods, <i>d√©ploiements</i> , <i>travaux</i> , <i>ensembles</i> , etc.) - elles peuvent √™tre fiables au moment du d√©ploiement, mais si elles sont accessibles de l'ext√©rieur, il y a toujours un risque qu'elles soient exploit√©es ult√©rieurement par [les attaquants].  Ce risque peut √™tre att√©nu√© en ex√©cutant des charges de travail avec des privil√®ges minimaux et leur configuration s√©curis√©e. <br><br><h3>  6. Utilisez les fonctionnalit√©s de s√©curit√© Linux et PodSecurityPolicies </h3><br>  <b>Le noyau Linux poss√®de de nombreuses extensions de s√©curit√© se chevauchant partiellement (capacit√©s, SELinux, AppArmor, seccomp-bpf) qui peuvent √™tre configur√©es pour accorder aux applications des privil√®ges minimaux.</b> <br><br>  Des utilitaires comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bane</a> vous aideront √† g√©n√©rer des profils pour AppArmor, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">docker-slim</a> vous aidera √† g√©n√©rer des profils seccomp, mais soyez prudent: pour identifier tous les effets secondaires de l'application de ces politiques, vous avez besoin d'une suite de tests compl√®te qui v√©rifie l'int√©gralit√© du code de l'application. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PodSecurityPolicies</a> r√©git l'utilisation de ces extensions de s√©curit√©, ainsi que d'autres directives de s√©curit√© Kubernetes.  Ils sont responsables des exigences minimales qui doivent √™tre remplies pour acc√©der au serveur API, y compris les profils de s√©curit√©, l'indicateur de privil√®ge, le r√©seau h√¥te partag√©, les processus ou les espaces de noms pour IPC. <br><br>  Ces directives sont importantes car elles aident √† emp√™cher les processus conteneuris√©s d'√©chapper √† leurs limites isol√©es.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'exemple PodSecurityPolicy de Tim Allclair est</a> tr√®s polyvalent - vous pouvez le prendre comme base et le personnaliser pour votre cas. <br><br><h3>  7. Effectuer une analyse statique de YAML </h3><br>  <b>Si PodSecurityPolicies restreint l'acc√®s au serveur API, une analyse statique peut √©galement √™tre utilis√©e dans le processus de d√©veloppement pour mod√©liser les exigences r√©glementaires de l'organisation et l'app√©tit pour le risque.</b> <br><br>  Les informations sensibles ne doivent pas √™tre stock√©es dans des ressources YAML comme les foyers ( <i>pods</i> , <i>d√©ploiements</i> , <i>ensembles</i> , etc.), et les <i>ConfigMaps</i> et <i>Secrets</i> sensibles doivent √™tre crypt√©s avec des utilitaires comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vault</a> (avec un op√©rateur de CoreOS), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">git-crypt</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">secrets scell√©s</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud KMS fournisseur</a> . <br><br>  L'analyse statique de la configuration YAML peut √™tre utilis√©e comme base de s√©curit√© lors du d√©marrage.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kubesec</a> g√©n√®re des √©valuations des risques pour les ressources: <br><br><pre> <code class="plaintext hljs">{ "score": -30, "scoring": { "critical": [{ "selector": "containers[] .securityContext .privileged == true", "reason": "Privileged containers can allow almost completely unrestricted host access" }], "advise": [{ "selector": "containers[] .securityContext .runAsNonRoot == true", "reason": "Force the running image to run as a non-root user to ensure least privilege" }, { "selector": "containers[] .securityContext .capabilities .drop", "reason": "Reducing kernel capabilities available to a container limits its attack surface", "href": "https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" }] } }</code> </pre> <br>  Et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kubetest</a> est un cadre pour les tests unitaires des configurations Kubernetes: <br><br><pre> <code class="go hljs">#<span class="hljs-comment"><span class="hljs-comment">// vim: set ft=python: def test_for_team_label(): if spec["kind"] == "Deployment": labels = spec["spec"]["template"]["metadata"]["labels"] assert_contains(labels, "team", "should indicate which team owns the deployment") test_for_team_label()</span></span></code> </pre> <br>  Ces utilitaires impl√©mentent l'approche de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©calage √† gauche</a> (c'est-√†-dire qu'ils d√©placent la validation et la v√©rification aux premiers stades du cycle de d√©veloppement).  Les tests de s√©curit√© au stade du d√©veloppement donnent aux utilisateurs un retour rapide sur le code et la configuration, qui peuvent ensuite √™tre rejet√©s par v√©rification manuelle ou automatis√©e, et peuvent √©galement faciliter l'introduction de pratiques de s√©curit√© suppl√©mentaires. <br><br><h3>  8. Ex√©cutez les conteneurs non root </h3><br>  <b>Les conteneurs qui s'ex√©cutent en tant que root ont souvent beaucoup plus de droits que ne l'exigent leurs charges de travail, et s'ils sont compromis, ils aident les attaquants √† atteindre de grandes capacit√©s.</b> <br><br>  Les conteneurs reposent toujours sur le mod√®le de s√©curit√© UNIX traditionnel (appel√© DAC, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contr√¥le d'acc√®s discr√©tionnaire</a> ) - tout est un fichier et des droits sont accord√©s aux utilisateurs et aux groupes. <br><br>  Les espaces de noms utilisateur ne fonctionnent pas dans Kubernetes.  Cela signifie que la table d'ID utilisateur dans le conteneur est mapp√©e √† la table utilisateur h√¥te et que le d√©marrage du processus avec des privil√®ges root √† l'int√©rieur du conteneur le fait s'ex√©cuter avec des privil√®ges root sur l'h√¥te.  Bien que des m√©canismes soient ajout√©s √† tout cela pour emp√™cher la sortie du conteneur, l'ex√©cution en tant que root √† l'int√©rieur du conteneur n'est pas recommand√©e. <br><br>  De nombreuses images de conteneurs utilisent l'utilisateur root pour ex√©cuter le PID 1: si ce processus est compromis, l'attaquant obtient root dans le conteneur et, avec toute erreur de configuration, l'op√©ration du probl√®me devient beaucoup plus facile. <br><br>  Bitnami a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fait un excellent travail</a> de traduction de leurs images de conteneur aux utilisateurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©guliers (non root)</a> (ce qui est √©galement l'exigence d'OpenShift par d√©faut), ce qui peut √©galement simplifier votre migration vers des images non root. <br><br>  Ce fragment PodSecurityPolicy emp√™che les processus racine de s'ex√©cuter dans le conteneur et de remonter √† la racine: <br><br><pre> <code class="plaintext hljs"># Required to prevent escalations to root. allowPrivilegeEscalation: false runAsUser: # Require the container to run without root privileges. rule: 'MustRunAsNonRoot'</code> </pre> <br>  Les conteneurs qui n'utilisent pas root ne peuvent pas occuper des ports privil√©gi√©s, c'est-√†-dire  jusqu'√† 1024 (la capacit√© correspondante dans le noyau Linux - <code>CAP_NET_BIND_SERVICE</code> est responsable), cependant, l'utilisation des <i>services</i> permet de contourner cette limitation.  Voici un exemple pour l'application MyApp, qui occupe le port 8443 dans le conteneur, mais <i>Service le</i> rend disponible sur le port 443, en mandatant les demandes de <code>targetPort</code> : <br><br><pre> <code class="plaintext hljs">kind: Service apiVersion: v1 metadata: name: my-service spec: selector: app: MyApp ports: - protocol: TCP port: 443 targetPort: 8443</code> </pre> <br>  La n√©cessit√© d'ex√©cuter des charges de travail sans utiliser root restera jusqu'√† ce que l'espace de nom de l'utilisateur ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le temps de fonctionnement</a> pour le lancement de conteneurs sans root soient inclus dans l'ex√©cution du conteneur. <br><br><h3>  9. Utilisez des politiques de r√©seau </h3><br>  <b>Par d√©faut, le r√©seau Kubernetes autorise tout le trafic entre les pods.</b>  <b>Ce param√®tre peut √™tre limit√© par la strat√©gie r√©seau - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><i>NetworkPolicy</i></a> .</b> <br><br><img src="https://habrastorage.org/webt/kd/cv/xu/kdcvxufrkq2dm0jw13vk8hvowae.png"><br><br>  Les services traditionnels sont limit√©s aux pare-feu utilisant des adresses IP statiques et des plages de ports pour chaque service.  Parce que ces adresses IP changent tr√®s rarement, elles ont historiquement √©t√© utilis√©es comme une forme d'authentification.  Les conteneurs ont rarement des adresses IP statiques - leur nature implique la possibilit√© d'une suppression et d'une recr√©ation rapides, pour eux, la d√©couverte de services est utilis√©e √† la place des adresses IP statiques.  Ces fonctionnalit√©s compliquent consid√©rablement la configuration et la v√©rification des pare-feu. <br><br>  √âtant donn√© que Kubernetes stocke toutes les donn√©es sur l'√©tat du syst√®me dans etcd, il est possible de configurer un pare-feu dynamique - s'il existe le support n√©cessaire dans le plugin r√©seau CNI.  Calico, Cilium, kube-router, Romana et Weave Net - tous ces plugins prennent en charge les politiques r√©seau. <br><br>  Il est important de noter que les politiques fonctionnent sur le principe de la fermeture en cas de d√©faillance, c'est-√†-dire que l'absence d'un <code>podSelector</code> ici par d√©faut est √©gale √† toutes les valeurs possibles (caract√®re g√©n√©rique): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: default-deny spec: podSelector:</code> </pre> <br>  Ce qui suit est un exemple de <i>NetworkPolicy</i> , qui interdit tout de la sortie sauf UDP 53 (DNS), qui emp√™che √©galement les connexions entrantes √† l'application.  <i>NetworkPolicies</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sont des</a> strat√©gies avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tat</a> , de sorte que l'application recevra toujours des r√©ponses aux connexions sortantes. <br><br><pre> <code class="plaintext hljs">apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: myapp-deny-external-egress spec: podSelector: matchLabels: app: myapp policyTypes: - Egress egress: - ports: - port: 53 protocol: UDP - to: - namespaceSelector: {}</code> </pre> <br>  Les strat√©gies de r√©seau Kubernetes ne peuvent pas √™tre appliqu√©es aux noms DNS.  La raison en est que DNS prend en charge la r√©p√©tition altern√©e vers plusieurs adresses IP et les r√©ponses dynamiques en fonction de l'adresse IP acc√©dant, de sorte que les strat√©gies r√©seau s'appliquent uniquement aux adresses IP fixes ou <code>podSelector</code> (pour les adresses IP dynamiques Kubernetes). <br><br>  La meilleure pratique consiste √† commencer par interdire tout le trafic pour l'espace de noms et √† ajouter pas √† pas les itin√©raires requis par l'application pour r√©ussir les tests d'acceptation.  Le processus peut √™tre difficile, donc ControlPlane a d√©velopp√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">netassert</a> , un utilitaire pour tester la s√©curit√© du r√©seau dans les scripts DevSecOps avec nmap hautement parall√®le: <br><br><pre> <code class="plaintext hljs">k8s: # used for Kubernetes pods deployment: # only deployments currently supported test-frontend: # pod name, defaults to `default` namespace test-microservice: 80 # `test-microservice` is the DNS name of the target service test-database: -80 # `test-frontend` should not be able to access test-database's port 80 169.254.169.254: -80, -443 # AWS metadata API metadata.google.internal: -80, -443 # GCP metadata API new-namespace:test-microservice: # `new-namespace` is the namespace name test-database.new-namespace: 80 # longer DNS names can be used for other namespaces test-frontend.default: 80 169.254.169.254: -80, -443 # AWS metadata API metadata.google.internal: -80, -443 # GCP metadata API</code> </pre> <br>  Une API avec des m√©tadonn√©es d'un fournisseur de cloud est une source constante d'escalade potentielle (d√©montr√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par la</a> r√©cente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prime de bogue de Shopify</a> ), donc des tests sp√©ciaux confirmant que l'API est bloqu√©e sur le r√©seau de conteneurs aideront √† se prot√©ger contre les erreurs de configuration. <br><br><h3>  10. Num√©risez des images et ex√©cutez IDS </h3><br>  <b>Les serveurs Web sont un tremplin pour attaquer les r√©seaux auxquels ils sont connect√©s.</b>  <b>L'analyse des fichiers install√©s dans les images vous permet de v√©rifier qu'il n'existe aucune vuln√©rabilit√© connue qu'un attaquant pourrait utiliser pour acc√©der √† distance au conteneur.</b>  <b>Les syst√®mes de d√©tection d'intrusion (IDS) enregistrent ces √©v√©nements s'ils se produisent.</b> <br><br>  Kubernetes permet des soumissions au cluster via un ensemble de v√©rifications de contr√¥le (dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">contr√¥leur d'admission</a> ), qui s'appliquent non seulement aux pods, mais √©galement √† d'autres ressources comme les <i>d√©ploiements</i> .  Dans ceux-ci, chaque sous-marin peut √™tre valid√© pour l'admission ou son contenu peut √™tre modifi√©, en plus des webhooks du c√¥t√© backend sont d√©sormais √©galement pris en charge. <br><br><img src="https://habrastorage.org/webt/0s/-h/fw/0s-hfwbv4xf-izil5ljtxjxdyjm.png"><br><br>  Ces webhooks peuvent √™tre utilis√©s par des outils d'analyse d'images de conteneur pour v√©rifier les images avant leur d√©ploiement sur le cluster.  Les images qui √©chouent √† la validation ne recevront pas l'approbation du contr√¥leur. <br><br>  L'analyse des images de conteneurs √† la recherche de vuln√©rabilit√©s connues permet de r√©duire le temps pendant lequel un attaquant peut tirer parti d'un CVE ouvert.  Pour emp√™cher le d√©ploiement d'images pr√©sentant des vuln√©rabilit√©s critiques dans le pipeline de d√©ploiement, vous pouvez utiliser des utilitaires gratuits tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Clair</a> de CoreOS et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Micro Scanner</a> d'Aqua. <br><br>  Des outils tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grafeas</a> vous permettent de stocker des m√©tadonn√©es d'image pour des v√©rifications continues de conformit√© et de vuln√©rabilit√© √† l'aide d'une signature de conteneur unique (ou d'un hachage sp√©cial d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">adressage de contenu</a> ).  La num√©risation d'une image de conteneur √† l'aide de ce hachage √©quivaut √† num√©riser des images d√©ploy√©es en production et peut √™tre effectu√©e en continu sans avoir besoin d'acc√©der aux environnements de production. <br><br>  Des vuln√©rabilit√©s 0day inconnues existeront toujours, donc Kubernetes devrait d√©ployer un syst√®me de d√©tection d'intrusion comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Twistlock</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Aqua</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sysdig Secure</a> .  IDS d√©tecte un comportement inhabituel dans le conteneur et l'arr√™te ou le tue.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Falco de Sysdig</a> est un moteur de r√®gles Open Source et le point de d√©part de cet √©cosyst√®me. <br><br><h2>  Partie 3: L'avenir </h2><br>  La prochaine √©tape de la s√©curit√© dans ¬´l'√©volution du cloud natif¬ª semble √™tre le maillage de service, bien que son adoption ne se produise pas imm√©diatement: cette migration n√©cessite de d√©placer la complexit√© des applications vers l'infrastructure de maillage, et les organisations doivent mettre en ≈ìuvre cette meilleure pratique. <br><br><img src="https://habrastorage.org/webt/rm/qu/_m/rmqu_mfve6uvnnlaidl_bkjutqm.png"><br><br><h3>  11. Lancez le maillage de service </h3><br>  <b>Le maillage de service est un r√©seau de connexions chiffr√©es persistantes √©tablies entre des ¬´proxy connect√©s¬ª <i>(similaires √† ¬´side-car¬ª)</i> , des proxys hautes performances comme Envoy et Linkerd.</b>  <b>Il apporte la gestion, la surveillance et les politiques du trafic, le tout sans modification des microservices.</b> <br><br>  Le transfert de la s√©curit√© et du code r√©seau des microservices vers un ensemble de biblioth√®ques partag√©es et test√©es au combat √©tait d√©j√† possible avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Linkerd</a> , et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Istio</a> de Google, IBM et Lyft a apport√© une alternative √† cet espace.  Avec l'ajout de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SPIFFE</a> pour l'identit√© cryptographique de chaque module et de nombreuses autres fonctionnalit√©s, Istio peut simplifier le d√©ploiement de la s√©curit√© r√©seau de nouvelle g√©n√©ration. <br><br>  Dans les r√©seaux de ¬´confiance z√©ro¬ª, il peut ne pas √™tre n√©cessaire d'avoir un pare-feu traditionnel ou des politiques de r√©seau Kubernetes, car chaque interaction se produit √† l'aide de mTLS (Mutual TLS), qui non seulement garantit la s√©curit√© de l'interaction, mais confirme √©galement l'identit√© des deux services. . <br><br>  Ce passage des approches r√©seau traditionnelles aux principes de s√©curit√© du monde de Cloud Native ne sera pas facile pour ceux qui ont une mentalit√© de s√©curit√© traditionnelle.  Comme introduction √† ce nouveau monde, nous recommandons fortement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le livre Zero Trust Networking</a> par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Evan Gilman</a> de SPIFFE. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Istio 0.8 LTS</a> est actuellement disponible et le projet approche rapidement de sa version 1.0.  Le versioning du projet en termes de stabilit√© est r√©alis√© de mani√®re similaire au mod√®le Kubernetes: un noyau stable avec des API distinctes pour lesquelles leur statut alpha ou beta est indiqu√© √† l'aide d'espaces de noms.  Attendez-vous √† voir Istio se d√©velopper dans les prochains mois. <br><br><h2>  Conclusion </h2><br>  Les applications cloud natives disposent d'un ensemble plus d√©taill√© de primitives de s√©curit√© l√©g√®res qui aident √† prot√©ger les charges de travail et l'infrastructure.  La puissance et la flexibilit√© de ces outils sont √† la fois une b√©n√©diction et une mal√©diction: sans une automatisation suffisante [pour leur utilisation], exposer des applications dangereuses pour aller au-del√† du conteneur ou leur mod√®le d'isolement est devenu encore plus facile. <br><br>  Les utilitaires de protection sont plus accessibles que jamais, cependant, pour r√©duire le potentiel d'attaque et le risque de configurations incorrectes, vous devez les utiliser avec prudence. <br><br>  Si la s√©curit√© ralentit la vitesse de l‚Äôorganisation √† apporter des changements, ce ne sera jamais une priorit√©.  L'utilisation des principes de la livraison continue en relation avec la cha√Æne d'approvisionnement des logiciels permet √† l'organisation d'atteindre la conformit√© r√©glementaire, un audit continu et une gestion am√©lior√©e sans affecter les performances de l'entreprise. <br><br>  L'am√©lioration rapide et incr√©mentielle de la s√©curit√© est le moyen le plus simple avec une suite de tests compl√®te.    Continuous Security ‚Äî          pipeline', ,    ,     . <br><br><h2>  PS du traducteur </h2><br>  Lisez aussi dans notre blog: <br><br><ul><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OPA  SPIFFE ‚Äî     CNCF    </a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vulnerable Docker VM ‚Äî -  Docker  pentesting</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  service mesh      [    ]?</a>  "; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conduit ‚Äî  service mesh  Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">      Kubernetes</a> ¬ª; </li><li>  ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Infrastructure avec Kubernetes en tant que service abordable</a> .¬ª </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417905/">https://habr.com/ru/post/fr417905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417895/index.html">R√©paration d'imprimantes 3D et de machines-outils: comment fonctionne le service Top 3D Shop √† Moscou et Saint-P√©tersbourg</a></li>
<li><a href="../fr417897/index.html">PHP Digest n ¬∞ 135 (9-23 juillet 2018)</a></li>
<li><a href="../fr417899/index.html">Rechercher des n≈ìuds de variance de contr√¥le (comment arr√™ter de faire un travail stupide et le transf√©rer √† un autre)</a></li>
<li><a href="../fr417901/index.html">Comment nous avons commenc√© √† faire de longues r√©unions impressionnantes, et pourquoi ce n'est plus un mal universel</a></li>
<li><a href="../fr417903/index.html">Cas de r√©vision de code 1</a></li>
<li><a href="../fr417909/index.html">Pourquoi avez-vous besoin de Splunk? Analyse d'application</a></li>
<li><a href="../fr417911/index.html">Conception continue en d√©veloppement: m√©thodologie et principe</a></li>
<li><a href="../fr417913/index.html">Optimisation du rendu d'une sc√®ne du dessin anim√© Disney "Moana". 3e partie</a></li>
<li><a href="../fr417915/index.html">Comment jouer √† un colocataire</a></li>
<li><a href="../fr417917/index.html">ASC'18: Pers√©v√©rance et entra√Ænement r√©gulier comme moyen d'atteindre l'objectif</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>