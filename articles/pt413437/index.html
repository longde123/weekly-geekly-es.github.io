<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßë üë®üèº‚Äçüíª üë®üèª‚Äçüî¨ O mensageiro de tudo üë®üèø‚Äçüé® üë®üèø‚Äçüè≠ ü§ôüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todos os mensageiros existentes t√™m seus pr√≥s e contras, mas cada um deles puxa o cobertor para o lado devido √† incompatibilidade com os outros - e os...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O mensageiro de tudo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413437/"><p>  Todos os mensageiros existentes t√™m seus pr√≥s e contras, mas cada um deles puxa o cobertor para o lado devido √† incompatibilidade com os outros - e os usu√°rios sofrem com isso. </p><br><p>  O XMPP poderia se tornar um padr√£o √∫nico, mas, diferentemente do E-Mail, parecia relativamente tarde e n√£o conseguiu ganhar audi√™ncia suficiente para que as empresas j√° n√£o pudessem recusar.  Afinal, eles rapidamente perceberam que, sem reter o p√∫blico dentro de seu pr√≥prio ecossistema, n√£o h√° muito a ganhar.  Al√©m disso, devo admitir, o XMPP apresentava insufici√™ncias suficientes devido √† abund√¢ncia de extens√µes, muitas das quais, apesar de sua import√¢ncia, permaneceram em status experimental e algumas se duplicaram completamente. </p><br><p>  Tendo vivido no ‚Äúnovo mundo maravilhoso‚Äù de uma d√∫zia de mensageiros instant√¢neos no smartphone e tendo sentido todas as defici√™ncias desse estado de coisas, finalmente estamos prontos para algo novo. </p><br><p>  E sim, precisamos de um novo padr√£o! <a name="habracut"></a></p><br><p>  Um excelente Future Messenger atende aos seguintes requisitos: garantia de confiabilidade, seguran√ßa, por meio de desenvolvimento e descentraliza√ß√£o abertos, portabilidade (multiplataforma), multiprotocolo (capacidade de conex√£o com outras redes de comunica√ß√£o) e facilidade de uso. </p><br><h2 id="pochemu-vsyo-tak-ploho">  Por que tudo √© t√£o ruim? </h2><br><p>  Mas primeiro, vamos descobrir por que todo mundo simplesmente n√£o muda para algu√©m j√° popular == mensageiro centralizado, seja um WhatsApp condicional ou, digamos, Telegram, que possui uma audi√™ncia consider√°vel na R√∫ssia. </p><br><p>  Obviamente, a constru√ß√£o centralizada permite que os propriet√°rios obtenham mais dinheiro e, portanto, n√£o apenas paguem pelo desenvolvimento, mas tamb√©m invistam dinheiro significativo em publicidade e at√© glorifica√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√µes praticamente ausentes</a> , como seguran√ßa de servi√ßo, por exemplo.  No entanto, junto com isso, o propriet√°rio pode decidir repentinamente fechar o servi√ßo, o trator para mover o fio do data center ou apenas um mensageiro pode ser banido no territ√≥rio de um determinado pa√≠s.  N√£o necessariamente por raz√µes pol√≠ticas, talvez, e a pedido de detentores de direitos autorais condicionais, pode haver muitos motivos.  √â bom que, apesar do tamanho insignificante do mercado, o Telegram continue a trabalhar na R√∫ssia com sucesso vari√°vel, mas isso se deva √†s contas pessoais do propriet√°rio e, no caso de bloquear o mesmo WhatsApp, √© improv√°vel que o Facebook invista pesadamente para contornar os bloqueios. </p><br><p>  √â dif√≠cil falar imediatamente para todos os mensageiros centralizados, coletando sob um pente.  Existe um mal absoluto com um cliente, servidor e protocolo propriet√°rios que at√© funcionam em apenas algumas das plataformas mais populares e n√£o possuem criptografia.  Tamb√©m h√° uma bondade relativa, por exemplo, o Signal messenger, que est√° totalmente aberto, mas os servidores n√£o suportam o modo federado, e √© por isso que todos dependem do servidor central com todas as conseq√º√™ncias resultantes.  Aqui, a classifica√ß√£o deve ser realizada de acordo com um princ√≠pio diferente, mas isso est√° al√©m do escopo deste artigo. </p><br><p>  Bem, por que n√£o mudar para algo federal.  Por exemplo, a mesma matriz.  N√£o falarei sobre HTTP Long Polling, baixa resili√™ncia do servidor e a nerdice expl√≠cita da interface do cliente - todas essas s√£o tarefas solucion√°veis, embora n√£o triviais (no n√≠vel global, isso n√£o muda nada).  Eu gosto que os desenvolvedores levem em conta a experi√™ncia do XMPP e desenvolvam especifica√ß√µes comuns em vez de v√°rios XEPs independentes, mas essa √© apenas uma das desvantagens do XMPP.  Outro problema √© o dispositivo cl√°ssico da rede federal, quando somos for√ßados a escolher algum servidor e confiar no propriet√°rio que ele garantir√° que o servidor esteja funcionando e n√£o o fechar√°.  E, no caso de outra falha do datacenter, seremos afastados do mundo, n√£o sendo capazes de nos comunicar com a conta anterior em outro servidor.  Mesmo que voc√™ crie uma nova conta e, de alguma forma, transfira a lista de seus contatos para ela do servidor antigo, ao se comunicar, precisar√° confirmar de alguma forma que √© realmente voc√™ e n√£o algu√©m que o apresenta. </p><br><p>  Nesse caso, talvez abandone completamente o servidor?  H√° v√°rios mensageiros instant√¢neos baseados na tecnologia sem servidor.  Um caso especial aqui √© o popular em c√≠rculos estreitos, o Firechat, que usa uma rede de malha de dispositivos Wi-Fi e Bluetooth para se comunicar com os usu√°rios.  Esse messenger realmente funciona bem quando todos os usu√°rios est√£o concentrados, por exemplo, na √°rea.  Mas essa √© uma situa√ß√£o bastante espec√≠fica e, mesmo que imaginemos uma situa√ß√£o em que todo habitante do planeta instale um aplicativo, isso cria muitos outros problemas, desde quebras na rede de malha por sinais geogr√°ficos e a velocidade de troca de mensagens com usu√°rios distantes, at√© a quantidade de dados armazenados necess√°rios nos dispositivos.  Mas, provavelmente, esse mensageiro √© eliminado da massa total e, em nossa compara√ß√£o, √© sup√©rfluo.  √â mais experimental do que centrado no usu√°rio. </p><br><p>  Tamb√©m existem projetos como o Tox tentando implementar um messenger p2p.  Essa abordagem permite que voc√™ n√£o se preocupe com a seguran√ßa do servidor e √© quase imposs√≠vel bloquear esse messenger.  O Tox tem muitos problemas, mas este √© um projeto muito interessante que tem seu pr√≥prio nicho.  N√£o faz sentido listar as desvantagens espec√≠ficas do Tox, porque o projeto est√° em desenvolvimento e, apesar de os servi√ßos p2p serem muito mais dif√≠ceis de desenvolver, se voc√™ definir essa tarefa, poder√° criar v√°rias arquiteturas interessantes para a constru√ß√£o de uma rede: com vantagens e desvantagens pr√≥prias, requisitos diferentes para a largura do canal da Internet e a quantidade de espa√ßo no dispositivo, com supern√≥s, login simult√¢neo de diferentes dispositivos e at√© entrega de mensagens offline.  Por√©m, comum sempre haver√° redund√¢ncia significativa de tr√°fego em compara√ß√£o com a arquitetura cliente-servidor e aumento do consumo de bateria em dispositivos m√≥veis devido √† necessidade de manter constantemente um grande n√∫mero de conex√µes e v√°rios c√°lculos. </p><br><p>  Portanto, embora o p2p seja uma tecnologia interessante, ele ser√° ineficaz se, por exemplo, enviar suas coordenadas para equipes de resgate, estiver em algum lugar de uma √°rvore na taiga com quase nenhuma conex√£o com a Internet e 1% de carga da bateria. </p><br><h2 id="kak-eto-ispravit">  Como consertar isso? </h2><br><p>  Portanto, quero introduzir uma arquitetura h√≠brida cliente-servidor que aproveite ao m√°ximo as abordagens existentes e evite suas desvantagens. </p><br><p>  Portanto, para que nosso messenger com os recursos m√≠nimos necess√°rios funcione em dispositivos m√≥veis, usaremos o modelo cliente-servidor, onde o m√°ximo de opera√ß√µes de computa√ß√£o e recursos exigentes de tr√°fego est√£o concentrados nos servidores e, no lado do cliente, os dados s√£o descriptografados e exibidos ao usu√°rio. </p><br><h3 id="adresaciya">  Endere√ßamento </h3><br><p>  Cada usu√°rio recebe seu endere√ßo no formato de email ou XMPP, ou seja, apelido @ dom√≠nio.  Mas, diferentemente dos servi√ßos mencionados acima, a especifica√ß√£o de um dom√≠nio n√£o possui a mesma fun√ß√£o de endere√ßo importante nessa arquitetura. </p><br><p>  √â mais prov√°vel que os dom√≠nios sejam usados ‚Äã‚Äãcomo registradores de apelidos para descartar a possibilidade de que todos os apelidos existentes possam ser ocupados intencionalmente ou n√£o. </p><br><p>  Os dom√≠nios custam dinheiro na Internet, o que n√£o impede o registro em massa, mas reduz significativamente seu escopo.  Nos servi√ßos centralizados, o acesso geralmente ocorre por meio de um link para um telefone celular, o que tamb√©m n√£o √© um fator exclusivo, mas os cart√µes SIM tamb√©m n√£o s√£o retirados do ar!  E a esse respeito, a prop√≥sito, eu me pergunto como eles v√£o combater isso em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://toxme.io/</a> - um servi√ßo para o Tox que permite associar chaves longas a um apelido curto.  N√£o vejo raz√£o para que eles n√£o possam receber spam com bilh√µes de apelidos indesejados. <br>  Al√©m disso, o dom√≠nio pode fazer sentido para v√°rias contas de casa e trabalho.  Ou para organizar uma rede corporativa interna. </p><br><p>  Do ponto de vista do usu√°rio, para escrever para algu√©m, voc√™ precisa conhecer o seu login completo ou chave p√∫blica. </p><br><p>  Do ponto de vista do software do servidor, se um usu√°rio solicitar sua impress√£o digital, o servidor pesquisar√° em sua tabela o logon associado a ele, se for solicitado imediatamente o logon, respectivamente, esta etapa ser√° ignorada.  Em seguida, s√£o feitos o login e o endere√ßo do servidor ao qual a conta est√° atualmente delegada.  Se n√£o houver essas entradas, considera-se que a conta indicada ap√≥s @ no login √© respons√°vel pela conta. </p><br><h3 id="profil-polzovatelya">  Perfil do usu√°rio </h3><br><p>  O aplicativo cliente armazena um perfil de usu√°rio representando: </p><br><ul><li>  Login completo do usu√°rio </li><li>  Lista de servidores de backup </li><li>  Chave de usu√°rio p√∫blica e privada </li><li>  Informa√ß√µes de perfil, como lista de contatos, configura√ß√µes de bate-papo e perfil de usu√°rio </li></ul><br><p>  As chaves p√∫blicas de cada usu√°rio s√£o distribu√≠das entre cada um dos servidores na rede federada.  O usu√°rio pode efetuar login em qualquer um dos servidores, pois a autentica√ß√£o n√£o usa um hash de senha armazenado no banco de dados do servidor, mas a chave privada do usu√°rio. </p><br><p>  O procedimento de autoriza√ß√£o √© o seguinte: o servidor envia um conjunto aleat√≥rio de dados criptografados com a chave p√∫blica do cliente para o cliente, o cliente descriptografa com sua chave privada e envia um hash dos dados descriptografados para o servidor.  Se os hashes de dados corresponderem, o servidor autorizar√° o usu√°rio.  Ao mesmo tempo, se o usu√°rio alterou pela √∫ltima vez o servidor para o qual a conex√£o √© estabelecida, todos os servidores da rede federada ser√£o notificados do novo local do usu√°rio. </p><br><p>  A aus√™ncia da necessidade de lembrar a senha (no entanto, o cliente permite criptografar a chave privada) simplifica a intera√ß√£o com o messenger e cria o risco de perder as chaves.  Para evitar isso, √© recomend√°vel duplic√°-los para outros dispositivos do usu√°rio.  Nada impede o bate-papo na mesma conta de v√°rios dispositivos ao mesmo tempo, a √∫nica limita√ß√£o √© que todos devem estar conectados ao mesmo servidor, caso contr√°rio, a arquitetura se tornar√° muito confusa.  Mas isso n√£o √© um grande sinal de menos. </p><br><h3 id="dopolnenie-dlya-brauzerov">  Complemento para navegadores </h3><br><p>  Para muitos produtos, o ponto fraco √© um aplicativo da web.  E essa solu√ß√£o, √© claro, tem muitas desvantagens.  Esse bate-papo n√£o ser√° baixado enquanto voc√™ estiver off-line; ser√° necess√°rio aguardar o download completo e o endere√ßo poder√° estar bloqueado ou o servidor poder√° falhar.  Classifica√ß√£o manual de endere√ßos - eu particularmente n√£o gostaria. </p><br><p>  E ainda n√£o est√° exclu√≠da a op√ß√£o de um invasor invadir um aplicativo Web e incorporar c√≥digo que mesclar√° todos os seus dados - mesmo depois que a outra parte do aplicativo descriptograf√°-lo para voc√™, e voc√™ nem o conhece. </p><br><p>  Nesse sentido, proponho abandonar o aplicativo Web como tal e proponho a instala√ß√£o de um complemento para o navegador, no qual todas essas defici√™ncias est√£o ausentes por defini√ß√£o. </p><br><p>  Al√©m disso, a aus√™ncia da necessidade de os propriet√°rios dos servidores de configura√ß√£o do cliente da web reduzirem o limite de entrada para a cria√ß√£o de seu servidor.  Cada fam√≠lia tem seu pr√≥prio servidor! </p><br><h3 id="transporty">  Transportes </h3><br><p>  Quem precisa de um mensageiro no qual n√£o haja ningu√©m com quem se comunicar?  Existem projetos interessantes de mensageiros incomuns, mas o problema da falta de audi√™ncia n√£o lhes permite ganhar pelo menos alguma popularidade.  Como resultado, na maioria das vezes os mensageiros com um grande p√∫blico ganham ainda mais e os mensageiros instant√¢neos com um pequeno p√∫blico o perdem.  E, na maioria das vezes, essa situa√ß√£o s√≥ pode alterar investimentos significativos em publicidade. <br>  Al√©m disso, esse estado de coisas exige a instala√ß√£o de outro messenger, quando voc√™ precisa entrar em contato com algu√©m que n√£o est√° em outras redes. </p><br><p>  Portanto, o servidor deve suportar a opera√ß√£o de transportes para redes de terceiros. <br>  Se o usu√°rio especificar os dados para conectar-se √†s suas contas em outros mensageiros instant√¢neos, ele ver√° pessoas das redes que ele conectou em seus contatos. <br>  A conex√£o com redes de terceiros √© feita no lado do servidor e, no cliente, os contatos s√£o exibidos como os mais comuns, com diferen√ßas m√≠nimas - por exemplo, o √≠cone da rede de onde o usu√°rio √© √© exibido. </p><br><p>  Como desvantagem, torna-se necess√°rio confiar no servidor com seus dados para conectar-se a redes de terceiros.  Nem todo mundo est√° pronto para delegar sua autoridade a um servidor de terceiros, portanto, √© necess√°rio incentivar a cria√ß√£o de seus pr√≥prios servidores de todas as maneiras. </p><br><h3 id="kriptografiya">  Criptografia </h3><br><p>  Obviamente, um dispositivo de rede descentralizado n√£o consegue ficar sem a criptografia de todos os dados transmitidos, porque n√£o podemos ter certeza de que, mesmo no servidor que nos foi confiado, n√£o exista algum tipo de guia que mescla todos os dados. <br>  Anteriormente, j√° foi indicado que o par de chaves do usu√°rio √© usado para autoriza√ß√£o, todas as mensagens enviadas para outros usu√°rios tamb√©m s√£o assinadas com a chave privada do remetente e s√£o criptografadas com a chave p√∫blica do destinat√°rio. </p><br><p>  N√£o h√° nada de novo aqui, as ferramentas de criptografia GPG padr√£o s√£o usadas. <br>  O problema de criptografia em grupos ainda n√£o foi resolvido, mas voc√™ provavelmente pode usar o mecanismo usado no Signal. </p><br><h2 id="chto-uzhe-sdelano">  O que j√° foi feito </h2><br><p>  No momento, j√° criamos um servidor em Python usando o Tornado, que implementa as fun√ß√µes b√°sicas do messenger, existe uma vers√£o da Web ligeiramente congelada que deve ser convertida em uma adi√ß√£o para o navegador, existe uma biblioteca no Rust, com base na qual o cliente opera com uma interface QML. </p><br><p>  A conex√£o com o servidor √© realizada usando WebSockets, em que os dados s√£o serializados por padr√£o no formato bin√°rio de representa√ß√£o de dados CBOR, mas ao estabelecer uma conex√£o WebSockets, √© poss√≠vel solicitar um formato diferente, por exemplo, protobuf. </p><br><p>  Tamb√©m considero importante observar que o cliente usa uma divis√£o em uma lista de bate-papos, classificados pela data das √∫ltimas mensagens, amplamente usada em mensageiros instant√¢neos modernos e em uma lista tradicional, com a classifica√ß√£o de contatos em categorias.  Com o uso ativo do messenger, voc√™ precisa interagir com um grande n√∫mero de bate-papos, e fica dif√≠cil procur√°-los em uma ordem de lista em constante mudan√ßa.  No mesmo telegrama resolve parcialmente o problema de fixar os chats selecionados no topo da lista, mas essa √© apenas uma solu√ß√£o tempor√°ria para o problema. </p><br><p>  ‚Üí Aqui est√£o os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rios</a> que cont√™m nossos insights </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413437/">https://habr.com/ru/post/pt413437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413427/index.html">Programa√ß√£o para engenheiros de rede: trabalhando com a configura√ß√£o</a></li>
<li><a href="../pt413429/index.html">Estamos escrevendo um plug-in para receber certificados curinga Let's Encrypt</a></li>
<li><a href="../pt413431/index.html">Workshops sobre desenvolvimento de contratos inteligentes sobre Solidity</a></li>
<li><a href="../pt413433/index.html">65% dos profissionais de TI russos querem trabalhar no exterior</a></li>
<li><a href="../pt413435/index.html">Heran√ßa al√©m da gen√©tica</a></li>
<li><a href="../pt413439/index.html">A mem√≥ria da √°gua, ‚Äúcomo cobrar √°gua na TV‚Äù e outros mitos sobre √°gua viva e morta</a></li>
<li><a href="../pt413441/index.html">Como implantar o Minishift no seu laptop e come√ßar a viver</a></li>
<li><a href="../pt413443/index.html">Concurso HackBattle 2.0 no Positive Hack Days: como a cafeteria da escola foi atacada</a></li>
<li><a href="../pt413445/index.html">Microsoft inundou data center no Mar do Norte por 5 anos</a></li>
<li><a href="../pt413447/index.html">BMW ConnectedDrive ou "Voc√™ pode falar sobre isso por muito tempo"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>