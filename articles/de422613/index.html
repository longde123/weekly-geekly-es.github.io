<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë¶‚Äçüë¶ üçÆ üêπ PowerPool Cybergroup hat die Zero-Day-Sicherheitsanf√§lligkeit in Advanced Local Procedure Call gemeistert üîõ üçë ‚úäüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Am 27. August 2018 ver√∂ffentlichte ein Informationssicherheitsspezialist mit dem Spitznamen SandboxEscaper Informationen √ºber Zero-Day-Sicherheitsl√ºck...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PowerPool Cybergroup hat die Zero-Day-Sicherheitsanf√§lligkeit in Advanced Local Procedure Call gemeistert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/422613/"> Am 27. August 2018 ver√∂ffentlichte ein Informationssicherheitsspezialist mit dem Spitznamen SandboxEscaper Informationen √ºber Zero-Day-Sicherheitsl√ºcken auf Twitter.  Die Sicherheitsanf√§lligkeit betrifft Versionen von Microsoft Windows von 7 bis 10, genauer gesagt die ALPC-Oberfl√§che (Advanced Local Procedure Call) im Windows Task Scheduler.  Es bietet eine Eskalation lokaler Berechtigungen, mit der ein Angreifer die Rechte von Schadcode von der Benutzerebene auf SYSTEM erh√∂hen kann.  Wir sprechen nicht √ºber eine koordinierte Offenlegung der Sicherheitsanf√§lligkeit - das SandboxEscaper-Konto wurde bald gel√∂scht, es gab keine schlie√üenden Patches. <br><br>  Der Link vom Tweet f√ºhrte zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub-Repository</a> mit dem Proof-of-Concept-Exploit-Code - nicht nur der kompilierten Version, sondern auch dem Quellcode.  Daher kann jeder den Exploit √§ndern und neu kompilieren, um ihn zu verbessern, eine Erkennung zu vermeiden oder ihn in seinen eigenen Code aufzunehmen. <br><br>  Im Allgemeinen ist es nicht verwunderlich, dass der Exploit nur zwei Tage sp√§ter in der Kampagne der PowerPool-Cybergruppe in freier Wildbahn erschien.  Laut ESET-Telemetrie sind die Ziell√§nder der Angreifer Russland, die Ukraine, Polen, Deutschland, das Vereinigte K√∂nigreich, die USA, Indien, die Philippinen und Chile.  Es gibt relativ wenige Opfer, was auf eine sehr gezielte Kampagne hinweisen kann. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/j9/jp/mvj9jpgpgqtisu48y3jazkb72ms.jpeg"></div><br><a name="habracut"></a><br><h3>  PowerPool Toolkit </h3><br>  ESET hat vor relativ kurzer Zeit eine neue Gruppe aufgenommen, die PowerPool-Hackern jedoch eine ziemlich breite Palette von Tools zur Verf√ºgung stellt.  Als n√§chstes betrachten wir einige davon kurz. <br><br><h4>  Exploit zur Eskalation lokaler Berechtigungen in ALPC </h4> <br>  PowerPool-Entwickler haben die von SandboxEscaper ver√∂ffentlichte Bin√§rdatei nicht verwendet - sie haben den Quellcode geringf√ºgig ge√§ndert und neu kompiliert.  Der Exploit wurde auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von Sicherheitsforschern</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CERT-</a> Teams festgestellt. <br><br><img src="https://habrastorage.org/webt/0q/a5/8a/0qa58aieslsijwatki-cc9wbvae.png"><br>  <i>Abbildung 1. Beschreibung des Copyright-Exploits</i> <br><br>  Die Verletzung liegt in der <code>SchRpcSetSecurity</code> API- <code>SchRpcSetSecurity</code> , die Benutzerrechte nicht korrekt <code>SchRpcSetSecurity</code> .  Somit kann der Benutzer unabh√§ngig von den tats√§chlichen Berechtigungen jede Datei in <code>C:\Windows\Task</code> schreiben. Wenn eine Leseberechtigung vorliegt, kann der Inhalt einer schreibgesch√ºtzten Datei ersetzt werden. <br><br>  Jeder Benutzer kann Dateien in <code>C:\Windows\Task</code> schreiben, sodass Sie in diesem Ordner eine Datei erstellen k√∂nnen, die eine feste Verkn√ºpfung zu einer beliebigen <i>Zieldatei darstellt</i> .  Durch Aufrufen der <code>SchRpcSetSecurity</code> Funktion k√∂nnen Sie dann auf den Schreibzugriff auf diese Zieldatei zugreifen.  Um eine lokale Eskalation von Berechtigungen bereitzustellen, muss der Angreifer die Zieldatei ausw√§hlen, die √ºberschrieben werden soll. Es ist wichtig, dass diese Datei automatisch mit Administratorrechten ausgef√ºhrt wird.  Alternativ kann es sich um eine Systemdatei oder ein Dienstprogramm zum Aktualisieren zuvor installierter Software handeln, das regelm√§√üig ausgef√ºhrt wird.  Der letzte Schritt besteht darin, den Inhalt der Zieldatei durch b√∂sartigen Code zu ersetzen.  Daher hat die Malware bei der n√§chsten automatischen Ausf√ºhrung unabh√§ngig von den urspr√ºnglichen Rechten Administratorrechte. <br><br>  PowerPool-Entwickler haben beschlossen, den Inhalt der Datei <code>C:\Program Files (x86)\Google\Update\GoogleUpdate.exe</code> .  Dies ist ein legitimer Updater f√ºr Google-Anwendungen. Er wird regelm√§√üig mit Administratorrechten √ºber die Microsoft Windows-Task ausgef√ºhrt. <br><br><img src="https://habrastorage.org/webt/qe/ef/as/qeefastmi_y_som113u2cmyutwa.png"><br>  <i>Abbildung 2. Erstellen eines festen Links zu Google Updater</i> <br><br><img src="https://habrastorage.org/webt/7d/th/ua/7dthua4tv-1sglb8uq6udcwb6na.png"><br>  <i>Abbildung 3. Verwenden von SchRpcCreateFolder zum √Ñndern der Berechtigungen f√ºr die ausf√ºhrbare Datei von Google Updater</i> <br><br>  Die in der obigen Abbildung gezeigte Abfolge von Vorg√§ngen erm√∂glicht es PowerPool-Operatoren, Schreibberechtigungen f√ºr die ausf√ºhrbare Datei <code>GoogleUpdate.exe</code> .  Dann √ºberschreiben sie es und ersetzen sie durch eine Kopie ihrer Malware der zweiten Stufe (wir werden unten beschreiben), um beim n√§chsten Aufruf des Updaters Administratorrechte zu erhalten. <br><br><h3>  Erster Kompromiss </h3><br>  Das PowerPool-Team verwendet verschiedene Methoden, um das Opfer zuerst zu gef√§hrden.  Eine davon ist das Versenden von Spam mit Malware aus der ersten Phase des Anhangs.  Es ist fr√ºh, Schlussfolgerungen zu ziehen, aber bisher haben wir nur sehr wenige Proben in Telemetriedaten beobachtet. Daher gehen wir davon aus, dass die Empf√§nger sorgf√§ltig ausgew√§hlt wurden und wir nicht √ºber Massenmailing sprechen. <br><br>  Andererseits wissen wir, dass PowerPool in der Vergangenheit bereits Spam-Mailings praktiziert hat.  Laut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einem</a> im Mai 2018 ver√∂ffentlichten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SANS-Blogbeitrag</a> verwendeten sie ein Schema mit Symbolic Link-Dateien (.slk), um Malware zu verbreiten.  Microsoft Excel kann diese Dateien laden, die die Zelle aktualisieren und Excel veranlassen, PowerShell-Code auszuf√ºhren.  Es scheint, dass diese SLK-Dateien auch in Spam-Nachrichten verteilt sind.  Basierend auf der ersten im SANS-Beitrag erw√§hnten Datei (SHA-1: b2dc703d3af1d015f4d53b6dbbeb624f5ade5553) finden Sie das entsprechende Spam-Beispiel auf VirusTotal (SHA-1: e0882e234cba94b5cf3df2c05949e2e228bedd) <br><br><img src="https://habrastorage.org/webt/vb/go/yc/vbgoycqhjfhtfptqv-24ob43i-8.png"><br>  <i>Abbildung 4. PowerPool-Spam</i> <br><br><h3>  Windows-Hintert√ºren </h3><br>  Die PowerPool-Gruppe arbeitet normalerweise mit zwei Hintert√ºren: Die Hintert√ºr der ersten Stufe wird nach dem ersten Kompromiss verwendet, die Hintert√ºr der zweiten Stufe wird nur auf den interessierenden Maschinen implementiert. <br><br><h4>  Hintert√ºr der ersten Stufe </h4><br>  Dies ist die grundlegende Malware, die f√ºr die Intelligenz verwendet wird.  Besteht aus zwei ausf√ºhrbaren Windows-Dateien. <br><br>  Die erste davon ist die Haupt-Hintert√ºr, die durch Service f√ºr Best√§ndigkeit sorgt.  Au√üerdem wird ein Mutex namens <code>MyDemonMutex%d</code> , wobei <code>%d</code> im Bereich von 0 bis 10 liegt. Die Hintert√ºr sammelt Proxy-Informationen, die C &amp; C-Serveradresse ist in einer Bin√§rdatei fest codiert.  Malware kann Befehle ausf√ºhren und grundlegende Informationen im System ausf√ºhren und Daten an den C &amp; C-Server √ºbertragen. <br><br><img src="https://habrastorage.org/webt/ps/km/ca/pskmcackoqhfcx_19gge_ryfvoa.png"><br>  <i>Abbildung 5. Sammeln von Proxy-Informationen</i> <br><br>  Die zweite der ausf√ºhrbaren Dateien hat einen Zweck.  Er macht einen Screenshot und schreibt ihn in die Datei <code>MyScreen.jpg</code> , die dann von der <code>MyScreen.jpg</code> herausgefiltert werden kann. <br><br><h4>  Hintert√ºr der zweiten Stufe </h4><br>  Malvar wird in der ersten Phase geladen, vermutlich wenn die Maschine f√ºr den Bediener interessant erscheint.  Das Programm ist jedoch nicht wie eine moderne ART-Hintert√ºr. <br><br>  Die C &amp; C-Serveradresse ist im Bin√§rformat fest codiert. Es gibt keinen Mechanismus zum Aktualisieren dieses wichtigen Konfigurationselements.  Die Hintert√ºr sucht nach Befehlen von <code>http://[C&amp;C domain]/cmdpool</code> und l√§dt zus√§tzliche Dateien von <code>http://[C&amp;C domain]/upload</code> <code>http://[C&amp;C domain]/cmdpool</code> .  Zus√§tzliche Dateien sind in erster Linie Werkzeuge f√ºr horizontale Bewegungen, die unten erw√§hnt werden. <br><br>  Unterst√ºtzte Befehle: <br>  - Befehl ausf√ºhren <br>  - Schlie√üen Sie den Vorgang ab <br>  - Datei senden <br>  - Datei herunterladen <br>  - Ordnerinhalte anzeigen <br><br>  Befehle werden im JSON-Format gesendet.  Beispiele unten sind Anforderungen zum Ausf√ºhren von Befehlen und zum Auflisten von Ordnern: <br><br><img src="https://habrastorage.org/webt/au/r1/nc/aur1ncfuer-g6aqayj0n7cjmkhy.png"><br>  <i>Abbildung 6. Beispiele f√ºr Backdoor-Befehle</i> <br><br><h3>  Werkzeuge f√ºr horizontale Bewegung </h3><br>  Durch die Bereitstellung eines st√§ndigen Zugriffs auf das System √ºber die Backdoor der zweiten Stufe verwenden PowerPool-Bediener mehrere Open-Source-Tools, die haupts√§chlich in PowerShell geschrieben wurden, f√ºr horizontale Bewegungen im Netzwerk. <br><br>  - <a href="">PowerDump</a> : Metasploit-Modul, mit dem Benutzernamen und Hashes aus dem Security Account Manager abgerufen werden k√∂nnen. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PowerSploit</a> : Eine Sammlung von PowerShell-Modulen, a la Metasploit. <br>  - <a href="">SMBExec</a> : Ein PowerShell-Tool zum Ausf√ºhren von Pass-the-Hash-Angriffen mithilfe des SMB-Protokolls. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quarks PwDump</a> : Eine ausf√ºhrbare Windows-Datei, die Anmeldeinformationen extrahieren kann. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FireMaster</a> : Ausf√ºhrbare Windows-Datei, die gespeicherte Kennw√∂rter aus Outlook, Webbrowsern usw. extrahieren kann. <br><br><h3>  Fazit </h3><br>  Die Offenlegung von Sicherheitsl√ºcken vor der Ver√∂ffentlichung von Updates gef√§hrdet Benutzer.  In diesem Fall ist m√∂glicherweise sogar die neueste Windows-Version gef√§hrdet.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CERT-CC bietet eine</a> Problemumgehung f√ºr das Problem, die jedoch von Microsoft nicht offiziell vereinbart wurde. <br><br>  Der PowerPool-Angriff zielt auf eine begrenzte Anzahl von Benutzern ab.  Der Vorfall zeigt jedoch, dass Angreifer immer auf dem neuesten Stand sind und schnell neue Exploits implementieren. <br><br>  ESET-Spezialisten √ºberwachen weiterhin die Ausnutzung der neuen Sicherheitsanf√§lligkeit.  Kompromissindikatoren sind auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf GitHub</a> verf√ºgbar. <br><br><h3>  Kompromissindikatoren </h3><br><h4>  Hashes </h4><br>  Stage One Backdoor (Win32 / Agent.SZS) 038f75dcf1e5277565c68d57fa1f4f7b3005f3f3 <br>  Stage One Backdoor (Win32 / Agent.TCH) 247b542af23ad9c63697428c7b77348681aadc9a <br>  Backdoor der zweiten Stufe (Win32 / Agent.TIA) 0423672fe9201c325e33f296595fb70dcd81bcd9 <br>  Hintert√ºr der zweiten Stufe (Win32 / Agent.TIA) b4ec4837d07ff64e34947296e73732171d1c1586 <br>  LPPC-Exploit ALPC (Win64 / Exploit.Agent.H) 9dc173d4d4f74765b5fc1e1c9a2d188d5387beea <br><br><h4>  ESET-Erkennung </h4><br>  - Win32 / Agent.SZS <br>  - Win32 / Agent.TCH <br>  - Win32 / Agent.TEL <br>  - Win32 / Agent.THT <br>  - Win32 / Agent.TDK <br>  - Win32 / Agent.TIA <br>  - Win32 / Agent.TID <br><br><h4>  C &amp; C-Server </h4><br>  - newsrental [.] Net <br>  - rosbusiness [.] Eu <br>  - afishaonline [.] Eu <br>  - Sport-Sammler [.] Com <br>  - 27.102.106 [.] 149 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de422613/">https://habr.com/ru/post/de422613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422601/index.html">Chrome 69 verf√ºgt √ºber einen Zufallskennwortgenerator</a></li>
<li><a href="../de422603/index.html">Ein bisschen n√§her an der Perfektion</a></li>
<li><a href="../de422605/index.html">Schon in jungen Jahren einen Safe aufbauen - Bildungsprogramm von Rostelecom und MIPT</a></li>
<li><a href="../de422609/index.html">Sprachbarriere und NLP. Warum verstehen uns Chatbots nicht?</a></li>
<li><a href="../de422611/index.html">Standard Error Handler in RxJava2 oder warum RxJava Anwendungsabst√ºrze verursacht, selbst wenn onError implementiert ist</a></li>
<li><a href="../de422615/index.html">Die ganze Wahrheit √ºber RTOS. Artikel 9. Scheduler: Implementierung</a></li>
<li><a href="../de422617/index.html">Die ganze Wahrheit √ºber RTOS. Artikel 8. Nucleus SE: Internes Design und Bereitstellung</a></li>
<li><a href="../de422623/index.html">So sichern Sie C.</a></li>
<li><a href="../de422625/index.html">Wir haben mit Troy Miles gesprochen - dem Programmierer von "Neuromancer"</a></li>
<li><a href="../de422627/index.html">MongoDB und IT-Arbeitsmarktforschung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>