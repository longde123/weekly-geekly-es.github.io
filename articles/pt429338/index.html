<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äç‚öïÔ∏è #‚É£ ‚ò™Ô∏è Armazenamento Android: Interno, Externo, Remov√≠vel. Parte 1/3 üÖøÔ∏è üéñÔ∏è üï∫üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para todos que, apesar de tudo, conseguiram fazer a escolha certa. 

 Esta √© uma tradu√ß√£o de uma s√©rie de artigos de Mark Murphy, do CommonsWare, ampl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Armazenamento Android: Interno, Externo, Remov√≠vel. Parte 1/3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429338/"><blockquote>  Para todos que, apesar de tudo, conseguiram fazer a escolha certa. </blockquote><p>  Esta √© uma tradu√ß√£o de uma s√©rie de artigos de Mark Murphy, do CommonsWare, amplamente conhecido no stackoverflow, al√©m do autor dos livros ‚ÄúO Guia do Codificador Ocupado para o Desenvolvimento Android‚Äù, ‚ÄúComponentes da Arquitetura do Android‚Äù.  Alguns termos n√£o s√£o traduzidos especificamente. </p><br><h1 id="internal-storage">  Armazenamento interno </h1><br><p>  H√° muita confus√£o em rela√ß√£o ao modelo de armazenamento Android.  A confus√£o aumentou significativamente com as altera√ß√µes no Android 4.4 no modelo de armazenamento e, desde ent√£o, a situa√ß√£o n√£o melhorou.  Existem in√∫meras perguntas sobre o Stack Overflow e recursos semelhantes, onde as pessoas claramente n√£o s√£o completamente versadas nos v√°rios modelos de armazenamento Android. </p><a name="habracut"></a><br><h1 id="to-chto-polzovateli-schitayut-internal-storage">  O que os usu√°rios consideram Armazenamento interno </h1><br><p>  Dependendo do modelo do seu dispositivo, os usu√°rios acabar√£o acessando Configura√ß√µes -&gt; Armazenamento no dispositivo ou em um local equivalente e poder√£o ver uma tela que descreve "Armazenamento interno" . </p><br><p>  O usu√°rio acha que toda a unidade flash embutida √© "Armazenamento Interno".  Felizmente, o Google come√ßou a mudar esse termo com o Android 8.0, passando para "armazenamento geral" em vez de "armazenamento interno". </p><br><p> No entanto, os usu√°rios ainda podem ver o ‚Äúarmazenamento interno‚Äù em locais como a janela do Windows Explorer quando o dispositivo est√° conectado via USB. </p><br><h1 id="chto-google-schitaet-internal-storage">  O que o Google considera armazenamento interno </h1><br><p>  Infelizmente, o que os usu√°rios veem n√£o √© o mesmo que o SDK do Android considera "armazenamento interno", o que leva a alguma confus√£o.  Se voc√™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ler a documenta√ß√£o do Android no reposit√≥rio interno</a> , esta descri√ß√£o ser√° pelo menos vaga (o texto do coment√°rio mudou desde que este artigo foi escrito): </p><br><blockquote>  Voc√™ pode salvar arquivos diretamente na mem√≥ria interna do dispositivo.  Por padr√£o, os arquivos armazenados no armazenamento interno s√£o privados para seu aplicativo e outros aplicativos n√£o podem acess√°-los (assim como o usu√°rio).  Quando o usu√°rio desinstala o aplicativo, esses arquivos s√£o exclu√≠dos. </blockquote><p>  Na verdade, o SDK do Android define "armazenamento interno" como um diret√≥rio especial exclusivo para seu aplicativo, onde ele pode hospedar arquivos.  Conforme sugerido na documenta√ß√£o, esses arquivos destinam-se √† leitura e grava√ß√£o por padr√£o para o seu aplicativo e s√£o proibidos para qualquer outro aplicativo (exce√ß√£o: os usu√°rios que trabalham com gerenciadores de arquivos com privil√©gios de superusu√°rio em dispositivos raiz podem acessar tudo). </p><br><p>  O contexto possui alguns m√©todos b√°sicos que permitem acessar o armazenamento interno, incluindo: </p><br><ul><li><code>getCacheDir()</code> </li> <li> <code>getDir()</code> </li> <li> <code>getDatabasePath()</code> </li> <li> <code>getFilesDir()</code> </li> <li> <code>openFileInput()</code> </li> <li> <code>openFileOutput()</code> </li> </ul><br><p>  Outros m√©todos contar√£o com eles, como <code>openOrCreateDatabase()</code> .  Outras classes tamb√©m contar√£o com elas, como <code>SQLiteOpenHelper</code> e <code>SQLiteOpenHelper</code> . </p><br><h1 id="gde-hranitsya-internal-storage--inogda">  Onde o armazenamento interno √© armazenado ... √Äs vezes </h1><br><p>  Se voc√™ observar v√°rias postagens de blog, respostas do StackOverflow e livros lan√ßados em 2012 ou em vers√µes anteriores, voc√™ ser√° informado de que o ‚Äúarmazenamento interno‚Äù do seu aplicativo est√° localizado em <code>/data/data/your.application.package.name</code> . </p><br><p>  Dentro, haver√° alguns diret√≥rios criados automaticamente pelo Android, √† medida que voc√™ usa alguns dos m√©todos Context.  Por exemplo, <code>getFilesDir()</code> retorna um objeto <code>File</code> apontando para o diret√≥rio <code>files/</code> no armazenamento interno do seu aplicativo. </p><br><h1 id="gde-hranitsya-internal-storage--ostalnoe-vremya">  Onde est√° armazenado o armazenamento interno ... O resto do tempo </h1><br><p>  No entanto, o armazenamento interno do seu aplicativo nem sempre est√° no local especificado.  Para os desenvolvedores, h√° uma regra que voc√™ deve aprender com esta s√©rie de postagens no blog: </p><br><p>  <strong>NUNCA CAMINHOS DE C√ìDIGO</strong> . </p><br><p>  De tempos em tempos, vejo desenvolvedores fazendo algo parecido com isto: </p><br><p> <code>File f=new File("/data/data/their.app.package.name/files/foo.txt");</code> </p> <br><p>  Isso n√£o √© crime, √© pior, isso √© um erro. </p><br><p>  O movimento certo e escreva menos: </p><br><p> <code>File f=new File(getFilesDir(), "foo.txt");</code> </p> <br><p>  Mais importante, <em>o armazenamento interno nem sempre est√° no mesmo lugar</em> .  Vale ressaltar que temos o conceito de perfis de usu√°rio separados (perfis de usu√°rio separados), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">come√ßando com o Android 4.2</a> para tablets e o Android 5.0 para telefones.  Cada usu√°rio obt√©m seu pr√≥prio "armazenamento interno".  Embora o diret√≥rio acima ainda seja usado para o usu√°rio principal, n√£o h√° garantia de que ser√° usado para contas secund√°rias. </p><br><h1 id="issleduem-internal-storage">  Explorando o armazenamento interno </h1><br><p>  A ferramenta Device File Explorer no Android Studio 3.0+ pode exibir todo o armazenamento interno no emulador, bem como o armazenamento interno de aplicativos depurados nos dispositivos de produ√ß√£o. </p><br><p>  Na linha de comando, voc√™ pode usar <code>adb</code> com a op√ß√£o <code>run-as</code> . </p><br><p>  Por exemplo, para fazer upload de um banco de dados do armazenamento interno do usu√°rio prim√°rio para sua m√°quina de desenvolvimento, voc√™ pode usar: </p><br><p> <code>adb shell 'run-as your.application.package.name cp /data/data/your.application.package.name/databases/dbname.db /sdcard'</code> </p> <br><p>  Observe que: </p><br><ul><li>  Voc√™ precisar√° alterar o destino para onde o armazenamento externo est√° montado no seu dispositivo (mostrado aqui como <code>/sdcard/</code> , que n√£o ser√° o mesmo em todos os dispositivos) </li><li>  Pode ser necess√°rio usar <code>cat</code> vez de <code>cp</code> em dispositivos mais antigos </li><li>  Depois que o arquivo estiver localizado no armazenamento externo, voc√™ poder√° usar o <code>adb pull</code> para fazer o download para o seu computador ou acess√°-lo de outras formas usuais (por exemplo, montando o dispositivo como um disco). </li></ul><br><h1 id="ogranicheniya-vnutrennego-hranilischa">  Limita√ß√µes de armazenamento interno </h1><br><p>  Em dispositivos Android 1.xe 2.x mais antigos, o armazenamento interno era geralmente localizado em uma se√ß√£o dedicada do sistema de arquivos, e essa se√ß√£o era geralmente bastante pequena.  O HTC Dream (tamb√©m conhecido como T-Mobile G1), o dispositivo Android original, tinha uma enorme mem√≥ria interna de 70 MB para uso de todos os aplicativos (isso n√£o √© um erro de digita√ß√£o, na √©poca medimos a mem√≥ria em megabytes). </p><br><p>  Quando 2.3 dispositivos foram lan√ßados, o armazenamento interno poderia ter 1 GB de tamanho. </p><br><p>  O Android 3.0 mudou o modelo de armazenamento, √† medida que o armazenamento interno se tornou mais volume.  Para dispositivos que anunciam com 4 GB, 8 GB, 16 GB, etc.  espa√ßo de armazenamento, geralmente havia tudo isso (menos o conte√∫do existente) dispon√≠vel para armazenamento interno.  Veremos o que mudou no Android 3.0 e seu impacto no modelo de armazenamento nas pr√≥ximas postagens sobre armazenamento externo. </p><br><p>  Para o Android 1.xe 2.x, o armazenamento interno era v√°lido apenas para arquivos pequenos, e voc√™ precisava usar o armazenamento externo para todo o resto.  O Android 3.0 ou superior significa que, para a maioria dos dispositivos e usu√°rios, o armazenamento interno √© excelente para arquivos que n√£o s√£o destinados ao uso normal por outros aplicativos ou que s√£o acess√≠veis ao usu√°rio, independentemente do seu aplicativo.  No entanto, alguns usu√°rios experientes acham que mesmo um flash on-board n√£o √© suficiente para o que eles querem armazenar, ent√£o eles mudam para o armazenamento remov√≠vel ... que √© uma <em>lata de worms (observe ŒªŒºŒπŒΩœÇ)</em> - uma fonte de muitos problemas imprevis√≠veis e complexos. </p><br><h1 id="faq-po-internal-storage">  Perguntas frequentes sobre armazenamento interno </h1><br><h2 id="dolzhen-li-ya-delat-fayly-vo-vnutrennem-hranilische-world-readable-ili-world-writeable">  Devo criar arquivos no armazenamento interno Leg√≠vel pelo Mundo ou Grav√°vel pelo Mundo? </h2><br><p>  Oh, Deuses, n√£o.  Use o <code>FileProvider</code> e sirva esse conte√∫do com a implementa√ß√£o do <code>ContentProvider</code> .  Depois disso, voc√™ ter√° pelo menos a oportunidade de usar o sistema de permiss√£o do Android para controlar o acesso a esses arquivos, diferentemente da sua vers√£o, quando qualquer aplicativo no sistema puder estragar esses arquivos. </p><br><h2 id="nu-a-kak-naschet-androidshareduserid-">  Bem, e o <code>android:sharedUserId</code> ? </h2><br><p>  Eu n√£o aconselho. </p><br><p>  <code>android: sharedUserId</code> √© um atributo que voc√™ pode colocar em um manifesto que indica o identificador l√≥gico do usu√°rio que ser√° usado para seu aplicativo.  Qualquer outro aplicativo instalado que assine com a mesma chave de assinatura e solicite o mesmo <code>android:sharedUserId</code> utilizar√° o mesmo usu√°rio do Linux do ponto de vista da seguran√ßa.  O efeito √© que esses dois aplicativos podem funcionar impunemente com os arquivos um do outro, pois esses arquivos pertencem ao mesmo usu√°rio do Linux. </p><br><p>  Este atributo √© realmente destinado a aplicativos pr√©-instalados, como su√≠te de software pr√©-carregado pelo fabricante do dispositivo, operadora de celular ou desenvolvedor de um firmware ROM modificado.  Em particular, assim que voc√™ instala o aplicativo uma vez, n√£o √© poss√≠vel alterar o valor do seu <code>android:sharedUserId</code> sem <code>android:sharedUserId</code> sem bloquear o acesso do usu√°rio a arquivos existentes ... j√° que o Android n√£o altera os direitos do propriet√°rio dos arquivos existentes ao alterar a conta de usu√°rio do Linux, que executa o aplicativo. </p><br><p>  Existem v√°rios riscos quando v√°rios processos acessam arquivos.  Alguns subsistemas, como o SQLite, possuem l√≥gica interna para resolver esse problema.  Mas se voc√™ mesmo organizar seu pr√≥prio acesso ao arquivo (por exemplo, atrav√©s de E / S de <code>File</code> e Java), precisar√° fazer algo com acesso simult√¢neo, e isso √© dif√≠cil. </p><br><p>  Voc√™ tamb√©m precisa lidar com uma situa√ß√£o em que um aplicativo est√° sendo desinstalado, excluindo arquivos que outro aplicativo usou.  Em um modelo de hub e spoke, por exemplo, com um aplicativo e um conjunto de plugins, talvez isso n√£o seja t√£o arriscado.  Em outros modelos, onde os aplicativos s√£o mais justos, voc√™ n√£o pode perder os dados do seu aplicativo apenas porque o usu√°rio decidiu excluir algum aplicativo separado. </p><br><p>  Finalmente, voc√™ n√£o sabe o que o futuro pode trazer.  No momento, voc√™ pode visualizar seu conjunto de aplicativos como um conjunto fortemente acoplado.  Algu√©m que compra esses aplicativos ou adquire sua empresa pode querer seguir o outro caminho.  O uso de recursos de compartilhamento de dados que s√£o <code>ContentProvider</code> , como o <code>ContentProvider</code> , oferece mais flexibilidade.  Em um mundo ideal, seu aplicativo deve tratar outros aplicativos como um recurso razoavelmente confi√°vel, mas nem sempre acess√≠vel, assim como seu pr√≥prio servi√ßo da web. </p><br><h2 id="kak-zapretit-polzovatelyam-rooted-ustroystv-dostup-k-moim-faylam-vo-vnutrennem-hranilische">  Como impedir que usu√°rios de dispositivos raiz acessem meus arquivos no armazenamento interno? </h2><br><p>  S√≥ n√£o coloque arquivos no armazenamento interno.  Os usu√°rios de dispositivos raiz podem acessar o que precisam no dispositivo, portanto, a √∫nica maneira de impedir que eles acessem seus dados √© n√£o t√™-los no dispositivo. </p><br><p>  Alguns desenvolvedores tentar√£o criptografar seus arquivos com uma senha codificada para que os usu√°rios de dispositivos raiz n√£o possam usar esses arquivos.  Isso criar√° o efeito de um aumento de velocidade por um curto per√≠odo de tempo.  Tudo o que √© necess√°rio √© uma pessoa interessada em fazer a engenharia reversa do seu aplicativo, que determinou como descriptografar esses arquivos e, em seguida, escreveu uma mensagem em um blog ou f√≥rum sobre como fazer isso. </p><br><p>  Em geral, relativamente poucas pessoas com dispositivos enraizadas - eu as classifico em menos de 1%.  IMHO, voc√™ ter√° mais sucesso concentrando seu trabalho de engenharia na cria√ß√£o de um aplicativo melhor, em vez de gastar tempo protegendo contra dispositivos raiz. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429338/">https://habr.com/ru/post/pt429338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429324/index.html">Lan√ßamento do Unreal Engine 4.21</a></li>
<li><a href="../pt429326/index.html">A App Store n√£o liga. Ou como eu fiz meu aplicativo, mas ele n√£o alcan√ßar√° os usu√°rios</a></li>
<li><a href="../pt429328/index.html">M√≥dulo de software para digitaliza√ß√£o de documentos danificados</a></li>
<li><a href="../pt429330/index.html">Mitos e lendas do Agile - dos fara√≥s at√© os dias atuais</a></li>
<li><a href="../pt429336/index.html">Comunica√ß√£o entre driver e dispositivo pelo m√©todo _HID ACPI usando o GPIO do controlador Lynxpoint como exemplo</a></li>
<li><a href="../pt429340/index.html">Pense duas vezes antes de usar o Helm.</a></li>
<li><a href="../pt429342/index.html">Angular 6+ √© um guia completo de inje√ß√£o de depend√™ncia. fornecida em vs provedores: []</a></li>
<li><a href="../pt429344/index.html">Leitura de fim de semana: Recursos de ajuste de √°udio e design de alto-falante</a></li>
<li><a href="../pt429346/index.html">Para o programa de mestrado sem exames: uma nova dire√ß√£o "Big Data" nas Olimp√≠adas "Eu sou um Profissional"</a></li>
<li><a href="../pt429348/index.html">Por que no futuro o Agile n√£o ser√° necess√°rio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>