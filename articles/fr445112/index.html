<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßí ‚è© üì∫ D√©m√™ler un enchev√™trement de vuln√©rabilit√©s sur les sites ü§æ ü¶é üë®‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apr√®s mon premier article publi√© sur codeby, qui est entr√© dans le top 3 des publications de la semaine, j'√©tais tr√®s motiv√© pour √©crire le suivant. M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©m√™ler un enchev√™trement de vuln√©rabilit√©s sur les sites</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445112/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/op/nt/zy/opntzyfa45ep4f6dphmuztga1am.jpeg"></div><br>  Apr√®s mon premier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> publi√© sur codeby, qui est entr√© dans le top 3 des publications de la semaine, j'√©tais tr√®s motiv√© pour √©crire le suivant.  Mais la 11e ann√©e impose des restrictions sur le temps libre pour pr√©parer l'examen et les olympiades.  Par cons√©quent, j'√©cris la seconde seulement apr√®s quelques mois apr√®s avoir <s>quitt√© toutes les Olympiades</s> . <br><br>  Cette publication parlera d'un cas int√©ressant o√π une vuln√©rabilit√© trouv√©e sur une ressource impliquait une cha√Æne de recherche sur plusieurs autres sites. <br><a name="habracut"></a><br><h3>  D√©but </h3><br>  Tout a commenc√© par la v√©rification du site d'un grand fabricant de produits forg√©s.  Le compte personnel de l'utilisateur n'√©tait pas l√† et la zone de recherche de vuln√©rabilit√© n'√©tait pas trop √©tendue. <br><br>  Lors du test du formulaire de soumission de commande, un certain nombre de vuln√©rabilit√©s y ont √©t√© d√©couvertes. <br>  Tout d'abord, il s'agit d'un XSS stock√© assez standard dans les donn√©es de l'acheteur, avec lequel cet enchev√™trement s'est √©tir√©.  XSS est standard, et l'absence d'un indicateur ¬´httponly¬ª sur un cookie n'√©tait clairement pas standard.  Plusieurs fois, j'ai re√ßu des cookies de divers sites, mais je n'ai jamais re√ßu d'autorisation, et j'ai commenc√© √† douter que dans la nature, il y avait des sites qui n'utilisaient pas le drapeau ¬´httponly¬ª, car son utilisation r√©duit consid√©rablement le risque d'attaques XSS.  C'√©tait d'autant plus surprenant de rencontrer un tel √©v√©nement sur le site d'une grande entreprise.  Mais, il s'est av√©r√© que le service qui a permis cette surveillance √©tait beaucoup plus important que ce √† quoi je m'attendais.  Mais plus sur cela apr√®s. <br><br>  J'ai substitu√© les cookies re√ßus et me suis connect√© au compte crm du syst√®me du site (je n'ai pas pu r√©sister, pour la premi√®re fois, j'ai eu de la chance).  Les droits n'√©taient pas administr√©s, mais ils √©taient suffisants pour acc√©der √† toutes les statistiques sur les commandes, y compris  et les donn√©es clients. <br><br><img src="https://habrastorage.org/webt/sq/wx/wx/sqwxwxuqyvlrpkdnoscc0pbv4ds.png"><br><br>  J'ai fait des captures d'√©cran pour prouver l'existence d'une vuln√©rabilit√© et envoy√© un rapport.  Plus d'une semaine s'est √©coul√©e et je n'attendais plus de r√©ponse.  Selon les statistiques, si vous ne recevez pas de r√©ponse dans les trois jours, vous pouvez les oublier.  Mais apr√®s 8 jours, une r√©ponse inattendue est venue.  Et plus encore, ils ont √©t√© les premiers √† me payer pour la vuln√©rabilit√© trouv√©e. <br><br><img src="https://habrastorage.org/webt/ob/rh/xh/obrhxhj_o-hjay2gz1unykm8-im.png"><br><br>  Pour revenir au test du formulaire de soumission de commande, j'ai √©galement trouv√© une vuln√©rabilit√© iDOR qui vous permet de modifier le prix de la commande en modifiant les param√®tres ¬´json_order [0] [price]¬ª et ¬´json_order [0] [total]¬ª dans la requ√™te POST domain.ru/shop.php .  La substitution du lien de commande dans la m√™me requ√™te dans le champ json_order [0] [href] a conduit √† une RFI. <br><br>  Aucune r√©ponse n'a √©t√© re√ßue au message concernant les nouvelles trouvailles ... <br><br><h3>  Continuation </h3><br>  Sur ce site de GRC, le syst√®me n'√©tait pas auto-√©crit, mais √©tait fourni pour le paiement par un service bien connu.  Apr√®s leur erreur avec le cookie, il √©tait logique de supposer qu'il y aurait d'autres vuln√©rabilit√©s. <br><br>  Si le script que j'ai envoy√© via le bon de commande a fonctionn√©, il n'y a pas eu de validation de champ √† la fois sur le site souhait√© et dans le syst√®me crm.  x2.  Par cons√©quent, apr√®s avoir re√ßu un compte d'essai, j'ai commenc√© par rechercher les champs vuln√©rables √† xss. <br><br>  Apr√®s de longs voyages √† travers le vaste syst√®me de GRC, plus d'une douzaine de champs avec une validation insuffisante ont √©t√© identifi√©s.  Quelque part, vous pouviez ins√©rer directement la balise de script, quelque part vous deviez utiliser des scripts en ligne du type "onmouseover = alert ()".  De plus, √† certains endroits, il √©tait possible d'incorporer un script, mais √† certains endroits, je me demande quelle logique ils ont √©t√© guid√©s par l'ajout de filtrage √† certains endroits et pas √† d'autres?  Du point de vue de l'objectif logique des champs, je n'ai pas vu de mod√®le.  Dans certains endroits, o√π presque tout le monde ne va pas, tout a bien fonctionn√©, mais, par exemple, ils n'ont pas pris la peine d'ajouter un filtrage au nom de la contrepartie. <br><br>  La plupart des domaines vuln√©rables n'ont pas pu √™tre influenc√©s de l'ext√©rieur.  Ils ne peuvent √™tre utilis√©s que par les employ√©s pour renforcer leurs droits dans le syst√®me, ce qui est √©galement important. <br><br>  Sur xss c'√©tait fini, il √©tait possible de passer √† des choses plus int√©ressantes. <br><br>  Je n'ai jamais recherch√© de vuln√©rabilit√©s CSRF auparavant, les sites que j'ai test√©s n'√©taient pas dans la classe contre laquelle ils utiliseraient le phishing.  Par cons√©quent, je ne voulais pas d√©ranger ni les propri√©taires de sites pr√©sentant des vuln√©rabilit√©s qui ne seraient jamais utilis√©s contre eux.  C'√©tait un cas radicalement diff√©rent.  Ce syst√®me de GRC √©tait populaire, il √©tait √©galement utilis√© par les grands magasins en ligne, et il y avait la possibilit√© de connecter les caisses des points de vente au d√©tail hors ligne, ce qui rendait le probl√®me de s√©curit√© encore plus important. <br><br>  √âtonnamment, il n'y avait aucune protection contre la CSRF.  Il a √©t√© possible d'envoyer des demandes, les contr√¥les n'ont √©t√© effectu√©s nulle part. <br>  - Changer les informations de compte?  - s'il te plait <br>  - Changer le nom et le prix des marchandises?  - Pas question <br><br>  Dans le m√™me temps, les cookies contenaient quelque chose appel√© "csrftoken". <br><br>  Ensuite, j'ai toujours pens√©, quel est l'int√©r√™t de mettre le jeton csrf dans les cookies?  Sur Google, j'ai d√©couvert qu'il existe un moyen plut√¥t pratique de se prot√©ger contre csrf avec un jeton dans les cookies et de le dupliquer dans une demande de publication, dans laquelle vous n'avez pas besoin de stocker le jeton sur le serveur.  Plus de d√©tails <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Mais dans notre cas, seulement la moiti√© du travail a √©t√© effectu√©, le jeton a √©t√© plac√© dans des cookies et il √©tait absent dans les demandes au serveur.  Et plus encore, sa suppression compl√®te des cookies n'a rien chang√©.  Pourquoi a-t-il √©t√© ajout√©? <br><br>  En conjonction avec le csrf d√©couvert, notre xss, non accessible auparavant de l'ext√©rieur, obtient une seconde vie.  Apr√®s tout, nous n'avons pas besoin d'acc√©der √† notre compte pour modifier les champs vuln√©rables. <br><br>  De plus, gr√¢ce √† la substitution du type mime du fichier, il √©tait possible de t√©l√©charger des fichiers arbitraires sur le serveur.  Mais le serveur a √©t√© configur√© correctement et les scripts php n'y ont pas √©t√© ex√©cut√©s. <br><br>  Plus int√©ressant encore.  Toutes les donn√©es sur les marchandises que la boutique en ligne a extraites de crm.  C'est-√†-dire  nom, description, photo.  Le lien vers l'image du produit √©tait ¬´yyyy.domain.ru/file/get/id=xxx¬ª.  Pour que la boutique en ligne puisse prendre des images, ils doivent avoir des droits de lecture pour tout le monde.  122. <br><br>  Apr√®s avoir v√©rifi√© les chemins le long desquels d'autres fichiers plus priv√©s sont stock√©s, j'ai vu la m√™me URL.  Cela ne semble pas surprenant, ils ont probablement d'autres droits d'acc√®s.  Pas plus bas que 022.  Mais, la r√©alit√© s'est av√©r√©e √™tre l√©g√®rement diff√©rente, ils ont √©galement eu un acc√®s gratuit pour les utilisateurs non autoris√©s. <br><br>  - Avez-vous fait une demande d'importation de donn√©es de commande dans un fichier exel?  - G√©nial, maintenant tout le monde peut le t√©l√©charger. <br><br>  Peut-√™tre que cet identifiant ressemblait √† "yt5bjFb54hb # HJ% $ p" et n'a pas c√©d√© √† la force brute?  Non non plus.  Tous les fichiers d'identification avaient un format num√©rique et √©taient de l'ordre de plusieurs milliers.  Protection contre les brutus, je ne l'ai pas non plus remarqu√©.  Apr√®s avoir scann√© tous les identifiants de 1 √† 10000 obstacles ne se sont pas rencontr√©s.  R√©p√©t√© plusieurs fois, personne n'√©tait int√©ress√© par une telle activit√©. <br><br>  Ils ont r√©pondu √† mon rapport en 3 jours. <br><br>  Concernant l'absence de drapeau, httponly a d√©clar√© qu'il manquait "Apparemment il y a longtemps, depuis la mise √† jour de la version php".  Allum√© le m√™me jour. <br><br>  Selon xss, ils ont dit que tout le monde sait que le filtre a √©t√© d√©sactiv√© au d√©but de l'√©t√© (√† l'√©poque, c'√©tait d√©j√† en ao√ªt), cela n'explique bien s√ªr pas pourquoi il y avait un filtrage quelque part, mais pas quelque part, mais supposons que nous ne l'avons pas remarqu√© incoh√©rence.  Ils ont √©galement assur√© que le filtre serait lanc√© dans quelques jours.  En fait, il s'est av√©r√© que dans quelques mois.  Mais ici, je les comprends parfaitement: j'ai √©galement pr√©vu de commencer √† pr√©parer les examens dans quelques jours ... <br><br>  Le t√©l√©chargement de fichiers arbitraires sur le serveur ne les pr√©occupait gu√®re, car ils ne sont pas ex√©cut√©s sur le serveur, ce qui signifie qu'il n'y a rien √† craindre.  Ce n'est qu'au moment de la r√©daction de l'article, j'ai eu une id√©e si un site qui est d√©j√† sur un h√©bergement autre que crm essaie de prendre une image du produit pour la vitrine, mais re√ßoit un script php, l'ex√©cutera-t-il?  Ou du fait qu'il est destin√© √† la balise img, sera-t-il trait√© uniquement comme une image?  Ou cela d√©pend-il des param√®tres du serveur?  Veuillez r√©pondre aux personnes comp√©tentes. <br><br>  La r√©ponse au rapport csrf s'est av√©r√©e assez int√©ressante.  Ils ont r√©pondu par une question: "Que consid√©rez-vous comme un jeton de protection contre les attaques csrf?"  Vraiment, de quoi je parle? <br><br><img src="https://habrastorage.org/webt/yb/i9/kd/ybi9kdjzr9bkmx7hxozvmsup5ta.png"><br><br>  Ils ont dit √† propos de l'acc√®s gratuit √† tous les fichiers qu'ils n'avaient pas pris en compte ce moment.  Ferm√© imm√©diatement. <br><br>  Je dois dire que c'√©tait la seule fois o√π je m'attendais vraiment √† recevoir une r√©compense en esp√®ces.  Le site est grand, sauf crm il n'y a toujours pas un projet payant.  Magazine en ligne populaire.  Mais il n'a re√ßu qu'une reconnaissance verbale. <br>  Je dois les remercier, je suis devenu encore plus calme sur la question du paiement.  Travailler dans un but de gratitude sous quelque forme que ce soit ne m√®nera finalement √† rien.  Vous vous habituerez √† tous les √©loges et autres honneurs, et ils cesseront de vous satisfaire.  Et si vous avez tout fait pour eux, le sens de faire quelque chose sera perdu.  Et vous ne pouvez pas perdre le plaisir du processus de votre activit√©, r√©soudre de nouveaux probl√®mes, cr√©er quelque chose de nouveau.  Travaillez pour le plaisir, m√™me si cela peut sembler banal.  Le travail au cours duquel vous ne remarquez pas comment les heures passent, comment le soleil a r√©ussi non seulement √† d√©passer l'horizon, mais √† se lever √† nouveau √† cause de cela. <br><br>  '' ' <br>  Nous sommes satisfaits des petits, le bonheur n'est pas en gros argent <br>  "Faites ce que vous aimez" - appr√©ci√© dans nos cercles <br>  '' '¬© Kolya Manyu - Chaque jour <br><br><h3>  Fin </h3><br>  Dans le cadre du support technique du site pr√©c√©dent, le syst√®me de r√©ception de tickets tiers UserEcho a √©t√© utilis√©.  Je n'ai pas manqu√© de le v√©rifier.  Dans les r√™ves, bien s√ªr, il √©tait possible d'avoir la possibilit√© de lire n'importe quel billet priv√©.  Naturellement, je n'ai pas r√©ussi.  Je devais me contenter de peu. <br><br><img src="https://habrastorage.org/webt/hv/p3/ws/hvp3wsbj374dcubvzwlma57tyas.png"><br><br>  Lors du test de l'API fonctionnant avec des tickets, aucune anomalie n'a d'abord √©t√© remarqu√©e, le droit de ne pas regarder chez quelqu'un d'autre, de ne pas y souscrire n'√©tait pas possible.  Mais, apr√®s une √©tude plus approfondie du site, il s'est av√©r√© que les d√©veloppeurs ont fait une petite faille. <br>  Dans le profil, vous pouvez trouver une section sur la gestion de vos billets, elle indique ceux auxquels vous √™tes abonn√© ou auxquels vous √©tiez d√©j√† abonn√©. <br><br><img src="https://habrastorage.org/webt/sb/qb/fo/sbqbfojkn8xdxdjc-pgm76w68g8.png"><br><br>  Si nous envoyons une demande de d√©sinscription du ticket de quelqu'un d'autre, nous sommes, comme pr√©vu, inform√©s que nous n'avons pas de droits sur cette action.  Mais en m√™me temps, il est inclus dans notre liste de billets, comme l'un de ceux pour lesquels nous √©tions abonn√©s plus t√¥t.  Ainsi, nous avons la possibilit√© de conna√Ætre son nom et son URL au format "ticket_name_name_in_translate".  Ce mal, bien s√ªr, n'en a pas port√©.  Dans de tr√®s rares cas, il sera possible d'apprendre quelque chose d'important et de pr√©cieux du nom.  Mais c'√©tait mieux que de ne rien avoir du tout. <br><br>  Apr√®s quelques semaines, le bug a √©t√© corrig√©. <br><br>  Je remercie tous ceux qui ont lu jusqu'au bout! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445112/">https://habr.com/ru/post/fr445112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445102/index.html">Animation Flash dans Unity3D √† partir de z√©ro. Premi√®re partie, lyrique</a></li>
<li><a href="../fr445104/index.html">Une br√®ve histoire de la marque audio Klipsch</a></li>
<li><a href="../fr445106/index.html">Table ronde: la technologie additive comme alternative √† la fabrication traditionnelle</a></li>
<li><a href="../fr445108/index.html">Pas un seul Falcon - des projets ESA et ULA r√©utilisables fondamentalement diff√©rents</a></li>
<li><a href="../fr445110/index.html">Un ordinateur avec un lecteur de terminal de style Fallout</a></li>
<li><a href="../fr445114/index.html">Sandbox am√©lior√© pour les scripts groovy</a></li>
<li><a href="../fr445116/index.html">L'US Air Force travaille sur un drone IA appel√© Skyborg</a></li>
<li><a href="../fr445118/index.html">Dans un chat priv√© Telegram, vous pouvez supprimer tous les messages - m√™me les √©trangers (un r√©sultat de vote a √©t√© ajout√©)</a></li>
<li><a href="../fr445120/index.html">Frontend Weekly Digest (18-24 mars 2019)</a></li>
<li><a href="../fr445122/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 357 (18-24 mars 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>