<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî≤ üî≤ üÜë Romper un simple "crack" con Ghidra - Parte 1 üí© ü•å üßü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probablemente, muchas personas ya saben de primera mano qu√© tipo de bestia es esta: Ghidra ("Hydra") y de qu√© se alimenta el programa de primera mano,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Romper un simple "crack" con Ghidra - Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447450/">  Probablemente, muchas personas ya saben de primera mano qu√© tipo de bestia es esta: <b>Ghidra</b> ("Hydra") y de qu√© se alimenta el programa de primera mano, aunque esta herramienta se puso a disposici√≥n del p√∫blico solo recientemente, en marzo de este a√±o.  No molestar√© a los lectores con una descripci√≥n de Hydra, su funcionalidad, etc.  Los que est√°n en el tema, estoy seguro, ya han estudiado todo esto, y los que a√∫n no est√°n en el tema, pueden hacerlo en cualquier momento, ya que ahora es f√°cil encontrar informaci√≥n detallada en Internet.  Por cierto, uno de los aspectos de Hydra (el desarrollo de complementos para √©l) ya se ha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cubierto</a> en Habr√© (¬°excelente art√≠culo!) Dar√© solo los enlaces principales: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">P√°gina oficial en el sitio web de la NSA</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proyecto Github</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Primera rese√±a en la revista Hacker</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gran canal de YouTube con programas de an√°lisis en Ghidra</a> </li></ul><br>  Entonces, Hydra es un <em>desensamblador y descompilador interactivo multiplataforma gratuito con una estructura modular, con soporte para casi todas las arquitecturas principales de CPU y una interfaz gr√°fica flexible para trabajar con c√≥digo desmontado, memoria, c√≥digo recuperado (descompilado), s√≠mbolos de depuraci√≥n y mucho, mucho m√°s</em> . <br><br>  ¬°Intentemos romper algo con esta Hidra! <br><a name="habracut"></a><br><h2>  Paso 1. Encuentra y estudia la grieta </h2><br>  Como "v√≠ctima" encontramos un programa simple "crackme".  Simplemente fui a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">crackmes.one</a> , indiqu√© en la b√∫squeda el nivel de dificultad = 2-3 ("simple" y "medio"), el idioma de origen del programa = "C / C ++" y la plataforma = "Multiplataforma", como en la captura de pantalla siguiente: <br><br><img src="https://habrastorage.org/webt/oz/hh/4w/ozhh4w-nraygltspefvjnyrvpjk.png"><br><br>  La b√∫squeda arroj√≥ 2 resultados (en verde a continuaci√≥n).  El primer crack result√≥ ser de 16 bits y no comenz√≥ en mi Win10 de 64 bits, pero <b>apareci√≥</b> el segundo ( <b>nivel_2 por seveb</b> ).  Puedes descargarlo desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este enlace</a> . <br><br>  Descarga y desempaqueta el crack;  La contrase√±a para el archivo, como se indica en el sitio, es <b>crackmes.de</b> .  En el archivo encontramos dos directorios correspondientes a Linux y Windows.  En mi m√°quina, voy al directorio de Windows y me encuentro con el √∫nico "ejecutable": <b>level_2.exe</b> .  Corramos y veamos qu√© quiere ella: <br><br><img src="https://habrastorage.org/webt/qx/mu/yj/qxmuyjfvnatrgoggnmet17egii8.png"><br><br>  Parece un fastidio!  Al inicio, el programa no muestra nada.  Intentamos ejecutarlo nuevamente, pas√°ndole una cadena arbitraria como par√°metro (de repente, ¬øest√° esperando una clave?), Y nuevamente nada ... Pero no se desespere.  ¬°Asumamos que tambi√©n tenemos que encontrar los par√°metros de lanzamiento como una tarea!  Es hora de descubrir nuestro "cuchillo suizo" - Hydra. <br><br><h2>  Paso 2. Crear un proyecto en Hydra y an√°lisis preliminar </h2><br>  Supongamos que ya tiene Hydra instalada.  Si a√∫n no, entonces todo es simple. <br><br><div class="spoiler">  <b class="spoiler_title">Instalar Ghidra</b> <div class="spoiler_text">  1) instale <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JDK</a> versi√≥n 11 o superior (tengo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">12</a> ) <br><br>  2) descargue Hydra (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> ) e inst√°lelo (al momento de escribir, la √∫ltima versi√≥n de Hydra es 9.0.2, tengo 9.0.1) <br></div></div><br>  Lanzamos Hydra y en el Project Manager abierto creamos inmediatamente un nuevo proyecto;  Le di el nombre de <b>crackme3</b> (es decir, los proyectos crackme y crackme2 ya se han creado para m√≠).  Un proyecto es, de hecho, un directorio de archivos, puede agregar cualquier archivo para estudiar (exe, dll, etc.).  Inmediatamente agregaremos nuestro level_2.exe ( <b>Archivo | Importar</b> o solo la tecla <b>I</b> ): <br><br><img src="https://habrastorage.org/webt/sb/gl/_e/sbgl_e0acdolgbxtvjnuohiscua.png"><br><br>  Vemos que, antes de importar, Hydra identific√≥ nuestro graznido experimental como un PE (ejecutable port√°til) de 32 bits para el sistema operativo Win32 y la plataforma x86.  Despu√©s de la importaci√≥n, esperamos a√∫n m√°s informaci√≥n: <br><br><img src="https://habrastorage.org/webt/zb/v0/ga/zbv0gatojwqtmbdejhe6zclenac.png"><br><br>  Aqu√≠, adem√°s de la profundidad de bits mencionada anteriormente, todav√≠a podemos estar interesados ‚Äã‚Äãen el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">orden de endianness</a> , que en nuestro caso es <b>Little</b> (de bajo a alto byte), que era de esperar para la plataforma Intel 86th. <br><br>  Con un an√°lisis preliminar, hemos terminado. <br><br><h2>  Paso 3. Realizar an√°lisis autom√°tico </h2><br>  Es hora de comenzar un an√°lisis autom√°tico completo del programa en Hydra.  Esto se hace haciendo doble clic en el archivo correspondiente (level_2.exe).  Con una estructura modular, Hydra proporciona todas sus funciones b√°sicas con un sistema de complemento que se puede agregar / deshabilitar o desarrollar de forma independiente.  Lo mismo ocurre con el an√°lisis: cada complemento es responsable de su tipo de an√°lisis.  Por lo tanto, primero, nos enfrentamos a esta ventana donde puede seleccionar los tipos de an√°lisis de inter√©s: <br><br><div class="spoiler">  <b class="spoiler_title">Ventana de configuraci√≥n de an√°lisis</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/p2/aw/sa/p2awsa9slwl8tkbjo0mtcbkgnh8.png"></div></div><br>  Para nuestros prop√≥sitos, tiene sentido dejar la configuraci√≥n predeterminada y ejecutar el an√°lisis.  El an√°lisis en s√≠ mismo se realiza con bastante rapidez (me tom√≥ alrededor de 7 segundos), aunque los usuarios en los foros se quejan de que para proyectos grandes, Hydra pierde velocidad con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IDA Pro</a> .  Esto puede ser cierto, pero para archivos peque√±os esta diferencia no es significativa. <br><br>  Entonces, el an√°lisis est√° completo.  Sus resultados se muestran en la ventana del Explorador de c√≥digos: <br><br><img src="https://habrastorage.org/webt/lh/dy/e5/lhdye5faqmse8w2evahggln5bge.png"><br><br>  Esta ventana es la principal para trabajar en Hydra, por lo que debe estudiarla con m√°s cuidado. <br><br><div class="spoiler">  <b class="spoiler_title">Descripci√≥n de la interfaz del navegador de c√≥digos</b> <div class="spoiler_text">  La configuraci√≥n de interfaz predeterminada divide la ventana en tres partes. <br><br>  En la <b>parte central</b> , se encuentra la ventana principal, que enumera el desensamblador, que es m√°s o menos similar a sus "hermanos" en IDA, OllyDbg, etc.  Por defecto, las columnas en este listado son (de izquierda a derecha): direcci√≥n de memoria, c√≥digo de operaci√≥n del comando, comando ASM, par√°metros del comando ASM, referencias cruzadas (si corresponde).  Naturalmente, la visualizaci√≥n se puede cambiar haciendo clic en el bot√≥n en forma de muro de ladrillo en la barra de herramientas de esta ventana.  Para ser sincero, nunca he visto una configuraci√≥n tan flexible de la salida del desensamblador, es extremadamente conveniente. <br><br>  En la <b>parte izquierda del</b> panel 3: <br><br><ol><li>  Secciones del programa (haga clic con el mouse para moverse por las secciones) </li><li>  √Årbol de caracteres (importaciones, exportaciones, funciones, encabezados, etc.) </li><li>  √Årbol de tipos de variables utilizadas </li></ol><br>  Para nosotros, la ventana m√°s √∫til aqu√≠ es un √°rbol de s√≠mbolos, que le permite encontrar r√°pidamente, por ejemplo, una funci√≥n por su nombre e ir a la direcci√≥n correspondiente. <br><br>  En el <b>lado derecho</b> hay una lista del c√≥digo descompilado (en nuestro caso, en C). <br><br>  Adem√°s de las ventanas predeterminadas, en el men√∫ <b>Ventana</b> puede seleccionar y colocar docenas de otras ventanas y pantallas en cualquier parte del navegador.  Para mayor comodidad, agregu√© una ventana de Bytes y una ventana con un Gr√°fico de funciones en el centro, y a la derecha, variables de cadena (Cadenas) y una tabla de funciones (Funciones).  Estas ventanas ahora est√°n disponibles en pesta√±as separadas.  Adem√°s, cualquier ventana se puede separar y hacer "flotante", coloc√°ndola y redimension√°ndola a su discreci√≥n; esta es tambi√©n una soluci√≥n muy reflexiva, en mi opini√≥n. <br></div></div><br><h2>  Paso 4. Aprender el algoritmo del programa - funci√≥n main () </h2><br>  Bueno, procedamos a un an√°lisis directo de nuestros programas crack.  En la mayor√≠a de los casos, debe comenzar buscando el punto de entrada del programa, es decir,  La funci√≥n principal que se llama cuando se inicia.  Sabiendo que nuestro crack fue escrito en C / C ++, suponemos que el nombre de la funci√≥n principal ser√° <b>main ()</b> o algo as√≠ :) Se dice y se hace.  Ingrese "main" en el filtro del √Årbol de S√≠mbolos (en el panel izquierdo) y vea la funci√≥n <b>_main ()</b> en la secci√≥n <b>Funciones</b> .  Ve a √©l con un clic del mouse. <br><br><h3>  Descripci√≥n general de la funci√≥n main () y cambio de nombre de funciones oscuras </h3><br>  En la lista del desensamblador, la secci√≥n de c√≥digo correspondiente se muestra inmediatamente, y a la derecha vemos el c√≥digo C descompilado de esta funci√≥n.  Vale la pena se√±alar una caracter√≠stica m√°s conveniente de Hydra: la sincronizaci√≥n de selecci√≥n: cuando un mouse selecciona un rango de comandos ASM, la secci√≥n de c√≥digo correspondiente en el descompilador se resalta y viceversa.  Adem√°s, si la ventana de visualizaci√≥n de la memoria est√° abierta, la asignaci√≥n se sincroniza con la memoria.  Como dicen, ¬°todo ingenioso es simple! <br><br>  Inmediatamente, noto una caracter√≠stica importante de trabajar en Hydra (en lugar de, por ejemplo, trabajar en IDA).  <em>El trabajo en Hydra se centra principalmente en analizar el c√≥digo descompilado</em> .  Por esta raz√≥n, los creadores de Hydra (recordamos, estamos hablando de esp√≠as de la NSA :)) prestaron gran atenci√≥n a la calidad de la descompilaci√≥n y la conveniencia de trabajar con c√≥digo.  En particular, uno puede simplemente definir funciones, variables y secciones de memoria simplemente haciendo doble clic en el c√≥digo.  Adem√°s, cualquier variable y funci√≥n se puede renombrar de inmediato, lo cual es muy conveniente, ya que los nombres predeterminados no tienen significado y pueden ser confusos.  Como ver√° m√°s adelante, a menudo usaremos este mecanismo. <br><br>  Entonces, aqu√≠ est√° la funci√≥n <b>main ()</b> , que Hydra "diseccion√≥" de la siguiente manera: <br><br><div class="spoiler">  <b class="spoiler_title">Listado main ()</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __cdecl _main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _Argc,<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **_Argv,<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **_Env) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bVar1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iVar2; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *_Dest; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> sVar3; FILE *_File; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **ppcVar4; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> local_18; ___main(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_Argc == <span class="hljs-number"><span class="hljs-number">3</span></span>) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)_text(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); local_18 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (local_18 &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bVar1) { _text(_Dest,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x100</span></span>); _text(_Dest,_Argv[local_18],<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } sVar3 = _text(_Argv[local_18]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((sVar3 == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*_Argv[local_18] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x2d</span></span>)) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)_Argv[local_18][<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x66</span></span>)) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } local_18 = local_18 + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bVar1) &amp;&amp; (*_Dest != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { _File = _text(_Dest,<span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_File == (FILE *)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { _text(<span class="hljs-string"><span class="hljs-string">"Failed to open file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } ppcVar4 = _construct_key(_File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ppcVar4 == (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { _text(<span class="hljs-string"><span class="hljs-string">"Nope."</span></span>); _free_key((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _text(<span class="hljs-string"><span class="hljs-string">"%s%s%s%s\n"</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x10d</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x219</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x325</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x431</span></span>); _free_key(ppcVar4); } _text(_File); } _text(_Dest); iVar2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { iVar2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> iVar2; }</code> </pre> <br></div></div><br>  Parece que todo parece normal: definiciones de variables, tipos C est√°ndar, condiciones, bucles, llamadas a funciones.  Pero observando m√°s de cerca el c√≥digo, notamos que por alguna raz√≥n los nombres de algunas funciones no fueron definidos y reemplazados por la <b>pseudofunci√≥n _text ()</b> (en la ventana del descompilador - <b>.text ()</b> ).  Comencemos definiendo cu√°les son estas funciones. <br><br>  Hacer doble clic en el cuerpo de la primera llamada. <br><br><pre> <code class="cpp hljs"> _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)_text(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  vemos que esto es solo una funci√≥n envolvente alrededor de la funci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">calloc ()</a> est√°ndar, que se usa para asignar memoria para datos.  As√≠ que <b>cambiemos el</b> nombre de esta funci√≥n a <b>calloc2 ()</b> .  Ajuste el cursor en el encabezado de la funci√≥n, llame al men√∫ contextual y seleccione <b>Cambiar nombre de funci√≥n</b> (tecla de acceso r√°pido - <b>L</b> ) e ingrese un nuevo nombre en el campo que se abre: <br><br><img src="https://habrastorage.org/webt/nz/q1/3z/nzq13zx8ddn0vsbvni8mkpencyc.png"><br><br>  Vemos que la funci√≥n cambi√≥ de nombre inmediatamente.  Volvemos al cuerpo <b>principal ()</b> (el bot√≥n <b>Atr√°s</b> en la barra de herramientas o <b>Alt + &lt;-</b> ) y vemos que aqu√≠ en lugar del misterioso <b>_text () calloc2 ()</b> ya se encuentra.  Genial <br><br>  Hacemos lo mismo con todas las dem√°s funciones de contenedor: vamos a sus definiciones una por una, miramos lo que hacen, cambiamos el nombre (agregu√© el √≠ndice 2 a los nombres est√°ndar de las funciones C) y volvemos a la funci√≥n principal. <br><br><h3>  Comprendemos el c√≥digo de funci√≥n main () </h3><br>  Bien, descubrimos algunas funciones extra√±as.  Comenzamos a estudiar el c√≥digo de la funci√≥n principal.  Saltando las declaraciones de variables, vemos que la funci√≥n devuelve el valor de la variable iVar2, que es cero (un signo de √©xito de la funci√≥n) solo si se cumple la condici√≥n especificada por la cadena <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_Argc == <span class="hljs-number"><span class="hljs-number">3</span></span>) { ... }</code> </pre><br>  <b>_Argc</b> es el n√∫mero de par√°metros de l√≠nea de comando (argumentos) pasados ‚Äã‚Äãa <b>main ()</b> .  Es decir, nuestro programa "come" 2 argumentos (el primer argumento, recordamos, es siempre la ruta al archivo ejecutable). <br><br>  OK, sigamos adelante.  Aqu√≠ creamos una cadena C (matriz de caracteres) de 256 caracteres: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *_Dest; _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)calloc2(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  new char[256]  C++</span></span></code> </pre><br>  A continuaci√≥n tenemos un ciclo de 3 iteraciones.  En √©l, primero verificamos si el indicador <b>bVar1</b> est√° <b>configurado,</b> y si es as√≠, copiamos el siguiente argumento de l√≠nea de comando (cadena) en <b>_Dest</b> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*    .  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bVar1) { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> memset2(_Dest,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    _Dest    */</span></span> strncpy2(_Dest,_Argv[i],<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ... }</code> </pre><br>  Este indicador se establece al analizar el siguiente argumento: <br><br><pre> <code class="cpp hljs">n_strlen = strlen2(_Argv[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((n_strlen == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*_Argv[i] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x2d</span></span>)) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)_Argv[i][<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x66</span></span>)) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>  La primera l√≠nea calcula la longitud de este argumento.  Adem√°s, la condici√≥n verifica que la longitud del argumento debe ser 2, el pen√∫ltimo car√°cter == "-" y el √∫ltimo car√°cter == "f".  Observe c√≥mo el descompilador "tradujo" la extracci√≥n de caracteres de la cadena utilizando una m√°scara de bytes. <br><blockquote>  Los valores decimales de los n√∫meros, y al mismo tiempo los caracteres ASCII correspondientes, se pueden espiar manteniendo el cursor sobre el literal hexadecimal correspondiente.  El mapeo ASCII no siempre funciona (?), Por lo que recomiendo mirar la tabla ASCII en Internet.  Tambi√©n puede convertir directamente en Hydra escalares de cualquier sistema de n√∫meros a cualquier otro (a trav√©s del men√∫ contextual -&gt; <b>Convertir</b> ), en este caso este n√∫mero se mostrar√° en todas partes en el sistema de n√∫meros seleccionado (en el desensamblador y en el descompilador);  pero personalmente, prefiero dejar hexes en el c√≥digo para la armon√≠a del trabajo, porque  direcciones de memoria, compensaciones, etc.  los hexes se establecen en todas partes. <br></blockquote>  Despu√©s del bucle viene este c√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bVar1) &amp;&amp; (*_Dest != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">/*    1) "-f"  2)  -         */</span></span> _File = fopen2(_Dest,<span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_File == (FILE *)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*  1    */</span></span> perror2(<span class="hljs-string"><span class="hljs-string">"Failed to open file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } ... }</code> </pre><br>  Aqu√≠ inmediatamente agregu√© comentarios.  Verificamos la exactitud de los argumentos ("-f path_to_file") y abrimos el archivo correspondiente (se pas√≥ el segundo argumento, que copiamos a _Dest).  El archivo se leer√° en formato binario, como lo indica el par√°metro "rb" de la funci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fopen ()</a> .  Si la lectura falla (por ejemplo, el archivo no est√° disponible), se muestra un mensaje de error en la secuencia de stderror y el programa sale con el c√≥digo 1. <br><br>  El siguiente es el m√°s interesante: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">/* !!!     !!! */</span></span> ppcVar3 = _construct_key(_File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ppcVar3 == (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*    ,  "Nope" */</span></span> puts2(<span class="hljs-string"><span class="hljs-string">"Nope."</span></span>); _free_key((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*    -      */</span></span> printf2(<span class="hljs-string"><span class="hljs-string">"%s%s%s%s\n"</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x10d</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x219</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x325</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x431</span></span>); _free_key(ppcVar3); } fclose2(_File);</code> </pre><br>  El descriptor de archivo abierto ( <b>_File</b> ) se pasa a la funci√≥n <b>_construct_key ()</b> , que, obviamente, realiza la verificaci√≥n de la clave buscada.  Esta funci√≥n devuelve una matriz de bytes bidimensional ( <b>char **</b> ), que se almacena en la variable <b>ppcVar3</b> .  Si la matriz est√° vac√≠a, se muestra el conciso "No" en la consola (es decir, en nuestra opini√≥n, "¬°No!") Y se libera la memoria.  De lo contrario (si la matriz no est√° vac√≠a), se muestra la clave aparentemente correcta y tambi√©n se libera la memoria.  Al final de la funci√≥n, el descriptor de archivo se cierra, se libera memoria y <b>se devuelve</b> el valor de <b>iVar2</b> . <br><br>  Entonces, ahora nos damos cuenta de que necesitamos: <br><br>  <i>1) crear un archivo binario con la clave correcta;</i> <i><br></i>  <i>2) pase su camino en la grieta despu√©s del argumento "-f"</i> <br><br>  En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">segunda parte del art√≠culo,</a> analizaremos la funci√≥n <b>_construct_key ()</b> , que, como descubrimos, es responsable de verificar la clave deseada en el archivo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447450/">https://habr.com/ru/post/447450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447438/index.html">Prueba unitaria y pruebas abstractas</a></li>
<li><a href="../447440/index.html">RBKmoney Payments under the hood - la l√≥gica de la plataforma de pago</a></li>
<li><a href="../447442/index.html">Presentamos el operador de shell: hacer que los operadores de Kubernetes sean a√∫n m√°s f√°ciles</a></li>
<li><a href="../447446/index.html">Talleres de IBM: primavera-verano 2019: inteligencia artificial, desarrollo en la nube, chat bots, blockchain y otras tecnolog√≠as</a></li>
<li><a href="../447448/index.html">Evoluci√≥n de la inteligencia: el comienzo</a></li>
<li><a href="../447452/index.html">Seguridad de la cadena de suministro: "Si yo fuera un estado naci√≥n ..."</a></li>
<li><a href="../447454/index.html">Control de pantalla FPGA de siete segmentos</a></li>
<li><a href="../447456/index.html">¬øCon qu√© precisi√≥n Yandex predice la precipitaci√≥n en invierno? Analizamos la precisi√≥n de los servicios predictivos.</a></li>
<li><a href="../447458/index.html">C√≥mo se crean nuevas palabras en ingl√©s moderno</a></li>
<li><a href="../447460/index.html">Hackea tu aspiradora XiaoMi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>