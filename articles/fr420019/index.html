<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüíª üå∂Ô∏è ü§πüèº Interaction client-serveur dans un nouveau jeu de tir PvP mobile et un serveur de jeu: probl√®mes et solutions üë®üèæ üëçüèº üìï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans les articles pr√©c√©dents de la s√©rie (tous les liens √† la fin de l'article) sur le d√©veloppement d'un nouveau jeu de tir rapide, nous avons examin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interaction client-serveur dans un nouveau jeu de tir PvP mobile et un serveur de jeu: probl√®mes et solutions</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/420019/">  Dans les articles pr√©c√©dents de la s√©rie (tous les liens √† la fin de l'article) sur le d√©veloppement d'un nouveau jeu de tir rapide, nous avons examin√© les m√©canismes de l'architecture de base de la logique de jeu bas√©e sur ECS, et les caract√©ristiques de travailler avec un tireur sur le client, en particulier, la mise en ≈ìuvre d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syst√®me de pr√©diction des actions des joueurs locaux</a> pour augmenter la r√©activit√© du jeu .  Cette fois, nous nous attarderons plus en d√©tail sur les probl√®mes d'interaction client-serveur dans des conditions de mauvaise connexion des r√©seaux mobiles et sur les moyens d'am√©liorer la qualit√© du jeu pour l'utilisateur final.  Je d√©crirai √©galement bri√®vement l'architecture du serveur de jeu. <br><br><img src="https://habrastorage.org/webt/py/lp/8q/pylp8q_ki2el3odmsmd_h5ppqh0.jpeg"><br><a name="habracut"></a><br><br>  Lors du d√©veloppement du nouveau PvP synchrone pour les appareils mobiles, nous avons rencontr√© des probl√®mes typiques du genre: <br><br><ol><li>  La qualit√© de connexion des clients mobiles est m√©diocre.  Il s'agit d'un ping moyen relativement √©lev√© dans la r√©gion de 200-250 ms et d'une distribution temporelle instable du ping tenant compte du changement de points d'acc√®s (bien que, contrairement √† la croyance populaire, le pourcentage de perte de paquets dans les r√©seaux mobiles 3G + soit assez faible - environ 1%). </li><li>  Les solutions techniques existantes sont des cadres monstrueux qui poussent les d√©veloppeurs dans des cadres √©troits. </li></ol><br>  Nous avons r√©alis√© le premier prototype chez UNet, m√™me s'il imposait des restrictions d'√©volutivit√©, un contr√¥le sur le composant r√©seau et une d√©pendance accrue √† la connexion capricieuse des clients ma√Ætres.  Ensuite, nous sommes pass√©s √† un netcode auto-√©crit au-dessus de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Photon Server</a> , mais plus √† ce sujet plus tard. <br><br>  Consid√©rez les m√©canismes d'organisation des interactions entre les clients dans les jeux PvP synchrones.  Le plus populaire d'entre eux: <br><br><ul><li>  <b>P2P ou peer-to-peer</b> .  Toute la logique du match est h√©berg√©e sur l'un des clients et ne n√©cessite presque aucun frais de trafic de notre part.  Mais la port√©e des tricheurs et les exigences √©lev√©es pour le client h√©bergeant le match, ainsi que les limites du NAT ne nous ont pas permis de prendre cette solution pour un jeu mobile. </li><li>  <b>Client-serveur</b> .  Un serveur d√©di√©, au contraire, vous permet de contr√¥ler enti√®rement tout ce qui se passe dans le match (au revoir, tricheurs), et ses performances vous permettent de calculer certaines choses sp√©cifiques √† notre projet.  En outre, de nombreux grands h√©bergeurs ont leur propre structure de sous-r√©seau, ce qui offre un d√©lai minimal pour l'utilisateur final. </li></ul><br>  Il a √©t√© d√©cid√© d'√©crire un serveur autoritaire. <br><br><img src="https://habrastorage.org/webt/x4/a4/ku/x4a4kunfi3lnbjqeghpddh-hsz8.jpeg"><br>  <i>Mise en r√©seau avec peer-to-peer (√† gauche) et client-serveur (√† droite)</i> <br><br><h3>  Transfert de donn√©es entre le client et le serveur </h3><br>  Nous utilisons <b>Photon Server</b> - cela nous a permis de d√©ployer rapidement l'infrastructure n√©cessaire au projet sur la base d'un sch√©ma d√©j√† √©labor√© au fil des ans (dans War Robots, nous l'utilisons). <br><br>  Photon Server est exclusivement une solution de transport pour nous, sans conceptions de haut niveau qui sont fortement li√©es √† un moteur de jeu sp√©cifique.  Ce qui donne un certain avantage, car la biblioth√®que de transfert de donn√©es peut √™tre remplac√©e √† tout moment. <br><br>  Le serveur de jeu est une application multi-thread dans le conteneur Photon.  Un flux distinct est cr√©√© pour chaque correspondance, qui encapsule toute la logique du travail et emp√™che l'influence d'une correspondance sur une autre.  Toutes les connexions au serveur sont contr√¥l√©es par Photon et les donn√©es qui lui sont parvenues des clients sont ajout√©es √† la file d'attente, qui est ensuite analys√©e dans ECS. <br><br><img src="https://habrastorage.org/webt/j-/ws/wm/j-wswmt08qutnwc1jha0dgazkfo.jpeg"><br>  <i>Sch√©ma g√©n√©ral des flux de correspondance dans le conteneur Photon Server</i> <br><br>  Chaque match se compose de plusieurs √©tapes: <br><br><ol><li>  Le client du jeu fait la queue dans le soi-disant service de mise en correspondance.  D√®s que le nombre requis de joueurs remplissant certaines conditions est r√©uni, il le signale au serveur de jeu √† l'aide de gRPC.  Dans le m√™me temps, toutes les donn√©es n√©cessaires √† la cr√©ation du jeu sont transmises. <br><br><img src="https://habrastorage.org/webt/e_/rq/qp/e_rqqp5kiwrz-mxwbtkeuqptfpy.jpeg"><br>  <i>Sch√©ma g√©n√©ral de cr√©ation d'une correspondance</i> </li><li>  Sur le serveur de jeu, l'initialisation du match commence.  Tous les param√®tres de correspondance sont trait√©s et pr√©par√©s, y compris les donn√©es cartographiques, ainsi que toutes les donn√©es client re√ßues du service de cr√©ation de correspondance.  Le traitement et la pr√©paration des donn√©es impliquent que nous analysions toutes les donn√©es n√©cessaires et les √©crivions dans un sous-ensemble sp√©cial d'entit√©s que nous appelons RuleBook.  Il stocke les statistiques de correspondance (qui ne changent pas au cours de son d√©roulement) et sera transmis √† tous les clients pendant le processus de connexion et d'autorisation sur le serveur de jeu une fois ou lors de la reconnexion apr√®s avoir perdu la connexion.  Les donn√©es de correspondance statiques incluent la configuration de la carte (pr√©sentation de la carte par les composants ECS qui les connectent au moteur physique), les donn√©es client (surnoms, un ensemble d'armes qu'ils ont et ne changent pas pendant la bataille, etc.). </li><li>  Ex√©cution d'un match.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les syst√®mes ECS</a> qui composent le jeu sur le serveur commencent √† fonctionner.  Tous les syst√®mes tournent √† 30 images par seconde. </li><li>  Chaque image lit et d√©compresse les entr√©es ou les copies du lecteur si les joueurs n‚Äôont pas envoy√© leur entr√©e dans un certain intervalle. </li><li>  Ensuite, dans la m√™me trame, l'entr√©e est trait√©e dans le syst√®me ECS, √† savoir: changement d'√©tat du joueur;  le monde qu'il influence avec sa contribution;  et le statut des autres joueurs. </li><li>  √Ä la fin de la trame, l'√©tat mondial r√©sultant est empaquet√© pour le lecteur et envoy√© sur le r√©seau. </li><li>  √Ä la fin du match, les r√©sultats sont envoy√©s aux clients et au microservice, qui traite les r√©compenses pour la bataille √† l'aide de gRPC, ainsi qu'√† l'analyste du match. </li><li>  Apr√®s cela, le flux de match se coince et le flux se ferme. </li></ol><br><img src="https://habrastorage.org/webt/02/8i/jl/028ijlnhor-evm6llkmfbiguf3s.jpeg"><br>  <i>La s√©quence d'actions sur le serveur dans une trame</i> <br><br>  C√¥t√© client, le processus de connexion √† une correspondance est le suivant: <br><br><ol><li>  Tout d'abord, une demande est faite pour la mise en file d'attente dans le service pour la cr√©ation de correspondances via websocket avec la s√©rialisation via protobuf. </li><li>  Lors de la cr√©ation d'une correspondance, ce service informe le client de l'adresse du serveur de jeu et transf√®re la charge utile suppl√©mentaire requise par le client avant la correspondance.  Le client est maintenant pr√™t √† d√©marrer le processus d'autorisation sur le serveur de jeu. </li><li>  Le client cr√©e un socket UDP et commence √† envoyer une demande au serveur de jeu pour se connecter √† la correspondance avec certaines informations d'identification.  Le serveur attend d√©j√† ce client.  Une fois connect√©, il lui donne toutes les donn√©es n√©cessaires pour d√©marrer le jeu et afficher le monde pour la premi√®re fois.  Ceux-ci incluent: RuleBook (une liste de donn√©es statiques pour le match), ainsi que StringIntMap, que nous appelons des donn√©es sur les lignes utilis√©es dans le gameplay qui seront identifi√©es par des entiers pendant le match).  Cela est n√©cessaire pour √©conomiser du trafic, car  les lignes passant chaque trame cr√©e une charge importante sur le r√©seau.  Par exemple, tous les noms de joueurs, noms de classe, identifiants d'armes, comptes et similaires, toutes les informations sont √©crites dans StringIntMap, o√π elles sont encod√©es √† l'aide de donn√©es enti√®res simples. </li></ol><br>  Lorsqu'un joueur affecte directement d'autres utilisateurs (cause des dommages, impose des effets, etc.), un historique d'√©tat est recherch√© sur le serveur pour comparer le monde du jeu que le client voit r√©ellement dans une simulation sp√©cifique avec ce qui se passait sur le serveur avec d'autres √† ce moment entit√©s de jeu. <br><br>  Par exemple, vous tirez sur votre client.  Pour vous, cela se produit instantan√©ment, mais le client s'est d√©j√† ¬´enfui¬ª depuis un certain temps par rapport au monde environnant, qu'il affiche.  Par cons√©quent, en raison de la pr√©diction locale du comportement du joueur, le serveur doit comprendre o√π et dans quel √©tat se trouvaient les adversaires au moment du tir (peut-√™tre qu'ils √©taient d√©j√† morts ou, inversement, invuln√©rables).  Le serveur v√©rifie tous les facteurs et rend son verdict sur les dommages caus√©s. <br><br><img src="https://habrastorage.org/webt/os/fb/hh/osfbhh4iwrw6gk2hvtpqp8co2sw.jpeg"><br>  <i>Demande de cr√©ation d'une correspondance, connexion √† un serveur de jeu et autorisation</i> <br><br><h3>  S√©rialisation et d√©s√©rialisation, empaquetage et d√©ballage des premiers octets du match </h3><br>  Nous avons une s√©rialisation de donn√©es binaires propri√©taire, et pour le transfert de donn√©es, nous utilisons UDP. <br><br>  UDP est l'option la plus √©vidente pour envoyer rapidement des messages entre le client et le serveur, o√π il est g√©n√©ralement beaucoup plus important d'afficher les donn√©es d√®s que possible que de les afficher en principe.  Les paquets perdus font des ajustements, mais les probl√®mes sont r√©solus pour chaque cas individuellement, comme  √âtant donn√© que les donn√©es proviennent constamment du client vers le serveur et vice-versa, vous pouvez saisir le concept d'une connexion entre le client et le serveur. <br><br>  Pour cr√©er un code optimal et pratique bas√© sur la description d√©clarative de la structure de notre ECS, nous utilisons la g√©n√©ration de code.  Lors de la cr√©ation de composants, des r√®gles de s√©rialisation et de d√©s√©rialisation sont √©galement g√©n√©r√©es pour eux.  La s√©rialisation est bas√©e sur un packer binaire personnalis√© qui vous permet de compresser les donn√©es de la mani√®re la plus √©conomique.  L'ensemble d'octets obtenu pendant son fonctionnement n'est pas le plus optimal, mais il vous permet de cr√©er un flux √† partir duquel vous pouvez lire certaines donn√©es de paquet sans avoir besoin de sa d√©s√©rialisation compl√®te. <br><br>  La limite de transfert de donn√©es de 1500 octets (alias MTU) est, en fait, la taille de paquet maximale qui peut √™tre transf√©r√©e via Ethernet.  Cette propri√©t√© peut √™tre configur√©e sur chaque tron√ßon du r√©seau et souvent m√™me en dessous de 1500 octets.  Que se passe-t-il si j'envoie un paquet de plus de 1 500 octets?  La fragmentation des paquets commence.  C'est-√†-dire  chaque paquet sera divis√© de force en plusieurs fragments, qui seront envoy√©s s√©par√©ment d'une interface √† l'autre.  Ils peuvent √™tre envoy√©s par des itin√©raires compl√®tement diff√©rents, et le temps de r√©ception de tels paquets peut augmenter consid√©rablement avant que la couche r√©seau n'√©mette un paquet coll√© √† votre application. <br><br>  Dans le cas de Photon, la biblioth√®que commence √† envoyer de tels paquets de force en mode UDP fiable.  C'est-√†-dire  Photon attendra chaque fragment du paquet et transmettra les fragments manquants s'ils sont perdus lors de la transmission.  Mais un tel travail de la partie r√©seau est inacceptable dans les jeux o√π un d√©lai r√©seau minimum est requis.  Par cons√©quent, il est recommand√© de r√©duire la taille des paquets transf√©r√©s au minimum et de ne pas d√©passer les 1500 octets recommand√©s (dans notre jeu, la taille d'un √©tat complet du monde ne d√©passe pas 1000 octets; la taille du paquet avec compression delta est de 200 octets). <br><br>  Chaque paquet du serveur a un en-t√™te court qui contient plusieurs octets d√©crivant le type de paquet.  Le client d√©balle d'abord cet ensemble d'octets et d√©termine le paquet avec lequel nous avons affaire.  Nous comptons beaucoup sur cette propri√©t√© de notre m√©canisme de d√©s√©rialisation lors de l'autorisation: afin de ne pas d√©passer la taille de paquet recommand√©e de 1500 octets, nous divisons les packages RuleBook et StringIntMap en plusieurs √©tapes;  et afin de comprendre exactement ce que nous avons obtenu du serveur - les r√®gles du jeu ou l'√©tat lui-m√™me - nous utilisons l'en-t√™te du package. <br><br>  Lors du d√©veloppement de nouvelles fonctionnalit√©s du projet, la taille du package augmente r√©guli√®rement.  Lorsque nous avons rencontr√© ce probl√®me, il a √©t√© d√©cid√© d'√©crire notre propre syst√®me de compression delta, ainsi qu'un d√©coupage contextuel des donn√©es dont le client n'avait pas besoin. <br><br><h3>  Optimisation du trafic r√©seau contextuelle.  Compression delta </h3><br>  L'√©cr√™tage des donn√©es contextuelles est √©crit manuellement en fonction des donn√©es dont le client a besoin pour afficher correctement le monde et la pr√©diction locale de ses propres donn√©es pour fonctionner correctement.  Ensuite, la compression delta est appliqu√©e aux donn√©es restantes. <br><br>  Notre jeu chaque tick produit un nouvel √©tat du monde, qui doit √™tre emball√© et transmis aux clients.  En r√®gle g√©n√©rale, la compression delta consiste √† envoyer d'abord un √©tat complet avec toutes les donn√©es n√©cessaires au client, puis √† n'envoyer que les modifications apport√©es √† ces donn√©es.  Cela peut √™tre repr√©sent√© comme suit: <br><br>  <i>deltaGameState = newGameState - prevGameState</i> <br><br>  Mais pour chaque client, des donn√©es diff√©rentes sont envoy√©es et la perte d'un seul paquet peut entra√Æner le fait que vous devez transmettre l'√©tat complet du monde. <br><br>  La transmission de l'√©tat complet du monde est une t√¢che assez co√ªteuse pour le r√©seau.  Par cons√©quent, nous avons modifi√© l'approche et envoy√© la diff√©rence entre l'√©tat de traitement actuel du monde et celui qui est exactement re√ßu par le client.  Pour ce faire, le client dans son paquet avec l'entr√©e envoie √©galement un num√©ro de tick, qui est un identifiant unique de l'√©tat du jeu qu'il a d√©j√† re√ßu exactement.  Le serveur sait maintenant sur la base de quel √©tat il est n√©cessaire de construire la compression delta.  Le client n'a g√©n√©ralement pas le temps d'envoyer au serveur le num√©ro de tick qu'il a avant que le serveur ne pr√©pare la trame suivante avec les donn√©es.  Par cons√©quent, sur le client, il existe un historique des √©tats du serveur dans le monde, auquel le correctif deltaGameState g√©n√©r√© par le serveur est appliqu√©. <br><br><img src="https://habrastorage.org/webt/ji/uo/ka/jiuokasgdo-wgmgmzbmchlb1gvm.jpeg"><br>  <i>Illustration de la fr√©quence des interactions client-serveur dans le projet</i> <br><br>  Arr√™tons-nous plus en d√©tail sur ce que le client envoie.  Dans les tireurs classiques, un tel package est appel√© ClientCmd et contient des informations sur les touches enfonc√©es du joueur et l'heure de cr√©ation de l'√©quipe.  √Ä l'int√©rieur du paquet d'entr√©e, nous envoyons beaucoup plus de donn√©es: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputSample</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  ,        public uint WorldTick; // ,      ,     public uint PlayerSimulationTick; //   .  (idle, , ) public MovementMagnitude MovementMagnitude; //  ,   public float MovementAngle; //    public AimMagnitude AimMagnitude; //    public float AimAngle; //   ,       public uint ShotTarget; //    ,        public float AimMagnitudeCompressed; }</span></span></code> </pre> <br><br>  Il y a quelques points int√©ressants.  Tout d'abord, le client indique au serveur dans quelle case il voit tous les objets du monde du jeu qui l'entourent qu'il n'est pas en mesure de pr√©dire (WorldTick).  Il peut sembler que le client est capable ¬´d'arr√™ter¬ª le temps pour le monde, et de courir et de tirer sur tout le monde lui-m√™me en raison des pr√©visions locales.  Ce n'est pas le cas.  Nous ne faisons confiance qu'√† un ensemble limit√© de valeurs du client et ne le laissons pas plonger dans le pass√© pendant plus d'une seconde.  Le champ WorldTick est √©galement utilis√© comme package d'accus√© de r√©ception, sur la base duquel la compression delta est cr√©√©e. <br><br>  Vous pouvez trouver des nombres √† virgule flottante dans un paquet.  En r√®gle g√©n√©rale, ces valeurs sont souvent utilis√©es pour prendre des mesures √† partir du joystick du lecteur, mais elles ne sont pas tr√®s bien transmises sur le r√©seau, car elles ont un ¬´rebond¬ª important et sont g√©n√©ralement trop pr√©cises.  Nous quantifions ces nombres et les emballons √† l'aide d'un packer binaire afin qu'ils ne d√©passent pas une valeur enti√®re pouvant tenir sur plusieurs bits, en fonction de sa taille.  Ainsi, l'emballage de l'entr√©e du joystick de vis√©e est rompu: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Math.Abs(s.AimMagnitudeCompressed) &lt; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>.Epsilon) { packer.PackByte(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { packer.PackByte(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> min = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> max = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> step = <span class="hljs-number"><span class="hljs-number">0.001f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     1000    , //          //     packer.PackUInt32((uint)((s.AimMagnitudeCompressed - min)/step), CalcFloatRangeBits(min, max, step)); }</span></span></code> </pre> <br><br>  Une autre caract√©ristique int√©ressante lors de l'envoi d'une entr√©e est que certaines commandes peuvent √™tre envoy√©es plusieurs fois.  Tr√®s souvent, on nous demande quoi faire si une personne a appuy√© sur la capacit√© ultime et que le paquet avec son entr√©e a √©t√© perdu?  Nous envoyons simplement cette entr√©e plusieurs fois.  Cela ressemble √† une livraison garantie, mais plus flexible et plus rapide.  Parce que  la taille du paquet d'entr√©e est tr√®s petite, nous pouvons emballer plusieurs entr√©es de joueur adjacentes dans le paquet r√©sultant.  Pour le moment, la taille de la fen√™tre qui d√©termine leur nombre est de cinq. <br><br><img src="https://habrastorage.org/webt/gi/08/0g/gi080gxlym3kf7n801ah19gjeq8.jpeg"><br>  <i>Paquets d'entr√©e g√©n√©r√©s sur le client √† chaque tick et envoy√©s au serveur</i> <br><br>  La transmission de ce type de donn√©es est la plus rapide et la plus fiable pour r√©soudre nos probl√®mes sans utiliser d'UDP fiable.  Nous partons du fait que la probabilit√© de perdre un tel nombre de paquets d'affil√©e est tr√®s faible et est un indicateur d'une grave d√©gradation de la qualit√© du r√©seau dans son ensemble.  Si cela se produit, le serveur copie simplement la derni√®re entr√©e re√ßue du lecteur et l'applique, en esp√©rant qu'elle reste inchang√©e. <br><br>  Si le client se rend compte qu'il n'a pas re√ßu de paquets sur le r√©seau pendant tr√®s longtemps, le processus de reconnexion au serveur d√©marre.  Le serveur, quant √† lui, v√©rifie que la file d'attente d'entr√©e du lecteur est termin√©e. <br><br><h3>  Au lieu de conclusion et de r√©f√©rence </h3><br>  Il existe de nombreux autres syst√®mes sur le serveur de jeu qui sont responsables de la d√©tection, du d√©bogage et de l'√©dition des correspondances ¬´par le gain¬ª, les concepteurs de jeux mettant √† jour la configuration sans red√©marrer, consigner et surveiller l'√©tat des serveurs.  Nous voulons √©galement √©crire √† ce sujet plus en d√©tail, mais s√©par√©ment. <br><br>  Tout d'abord, lors du d√©veloppement d'un jeu en r√©seau sur des plates-formes mobiles, vous devez faire attention au bon fonctionnement de votre client avec des pings √©lev√©s (environ 200 ms), une perte de donn√©es l√©g√®rement plus fr√©quente, ainsi que la taille des donn√©es envoy√©es.  Et vous devez vous adapter clairement √† la limite de paquets de 1500 octets pour √©viter la fragmentation et les retards de trafic. <br><br>  Liens utiles: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://gafferongames.com/post/udp_vs_tcp/</a> est un excellent article sur le choix entre TCP et UDP pour les jeux en r√©seau. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://api.unrealengine.com/udk/Three/NetworkingOverview.html</a> - une description du mod√®le de serveur dans Unreal Engine. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://ieeexplore.ieee.org/document/5360721</a> - √©tude de la qualit√© du r√©seau des connexions mobiles. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://ithare.com/mmog-rtt-input-lag-and-how-to-mitigate-them/</a> - interaction r√©seau dans les jeux au rythme rapide. </li></ul><br>  Articles pr√©c√©dents sur le projet: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Comment nous avons √©volu√© sur un jeu de tir mobile rapide: technologie et approches</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Comment et pourquoi nous avons √©crit notre ECS</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Comme nous l'avons √©crit le code r√©seau du tireur PvP mobile: synchronisation du joueur sur le client</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420019/">https://habr.com/ru/post/fr420019/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420009/index.html">Les subtilit√©s de la conception des produits</a></li>
<li><a href="../fr420011/index.html">Comment choisir une imprimante 3D: Guide du d√©butant</a></li>
<li><a href="../fr420013/index.html">Recherche d'adresse MAC sur les commutateurs Juniper</a></li>
<li><a href="../fr420015/index.html">Comment mesurer correctement la vitesse du canal Internet et cesser de ressembler √† un fou aux yeux de votre fournisseur</a></li>
<li><a href="../fr420017/index.html">L'art de r√©cup√©rer les mots de passe</a></li>
<li><a href="../fr420021/index.html">Pourquoi avez-vous besoin de Splunk? Internet des objets et donn√©es industrielles</a></li>
<li><a href="../fr420023/index.html">Enregistrement des √©tats dans les applications Android</a></li>
<li><a href="../fr420025/index.html">Ferme intelligente. √Ä quoi ressemblera-t-elle?</a></li>
<li><a href="../fr420029/index.html">Comment nous, chez 1C: Enterprise, r√©solvons des syst√®mes d'√©quations alg√©briques</a></li>
<li><a href="../fr420031/index.html">Dessin avec des cibles de rendu dans Unreal Engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>