<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆓 🎃 👩🏿‍✈️ Testen von PostgreSQL mit HugePages unter Linux 🦔 🀄️ 🚴🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Linux-Kernel bietet eine Vielzahl von Konfigurationsoptionen, die sich auf die Leistung auswirken können. Die Hauptsache ist, die richtige Konfigu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Testen von PostgreSQL mit HugePages unter Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/435558/"><p>  Der Linux-Kernel bietet eine Vielzahl von Konfigurationsoptionen, die sich auf die Leistung auswirken können.  Die Hauptsache ist, die richtige Konfiguration für Ihre Anwendung und Workload auszuwählen.  Wie jede andere Datenbank benötigt PostgreSQL eine optimale Optimierung des Linux-Kernels.  Falsche Einstellungen können zu einer schlechten Leistung führen.  Es ist wichtig, nach jeder Optimierungssitzung eine vergleichende Analyse der Datenbankleistung durchzuführen.  In einem meiner vorherigen Beiträge mit dem Titel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Optimieren der Linux-Kernel-Parameter für die PostgreSQL-Optimierung“ habe</a> ich einige der nützlichsten Linux-Kernel-Parameter beschrieben und erläutert, wie sie zur Verbesserung der Datenbankleistung beitragen.  Jetzt werde ich die Ergebnisse von Vergleichstests nach der Konfiguration von HugePages unter Linux unter verschiedenen PostgreSQL-Lasten teilen.  Ich habe eine vollständige Testsuite unter vielen verschiedenen PostgreSQL-Workloads mit einer unterschiedlichen Anzahl gleichzeitiger Clients durchgeführt. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cc3/be2/1f8/cc3be21f802843526a6739be7b84af6e.jpg" alt="Bild"></p><a name="habracut"></a><br><h3 id="pk-na-kotorom-vypolnyalos-testirovanie">  PC, auf dem die Tests durchgeführt wurden </h3><br><ul><li>  Supermicro Server: <br><ol><li>  Intel® Xeon® CPU E5-2683 v3 bei 2,00 GHz </li><li>  2 Sockel / 28 Kerne / 56 Gewinde </li><li>  Speicher: 256 GB RAM </li><li>  Speicher: SAMSUNG SM863 1.9 TB Enterprise SSD </li><li>  Dateisystem: ext4 / xfs </li></ol></li><li>  Betriebssystem: Ubuntu 16.04.4, Kernel 4.13.0-36-generic </li><li>  PostgreSQL: Version 11 </li></ul><br><h3 id="nastroyki-yadra-linux">  Linux-Kernel-Einstellungen </h3><br><p>  Ich habe die Standard-Kernel-Parameter ohne Optimierung / Optimierung verwendet, nur Transparent HugePages deaktiviert.  Diese Technologie ist standardmäßig aktiviert und weist Seiten mit einer Größe zu, die für die Verwendung mit Datenbanken nicht empfohlen wird.  Im Allgemeinen benötigen Datenbanken HugePages mit fester Größe, Transparente HugePages können diese jedoch nicht bereitstellen.  Daher wird immer empfohlen, diese Funktion zu deaktivieren und standardmäßig klassische HugePages zu installieren. </p><br><h3 id="nastroyki-postgresql">  PostgreSQL-Einstellungen </h3><br><p>  Ich habe für alle Tests dieselben PostgreSQL-Einstellungen verwendet, um verschiedene PostgreSQL-Workloads mit unterschiedlichen Linux HugePages-Einstellungen aufzuzeichnen.  Für alle Tests wurden die folgenden PostgreSQL-Einstellungen angewendet: </p><br><pre><code class="plaintext hljs">shared_buffers = '64GB' work_mem = '1GB' random_page_cost = '1' maintenance_work_mem = '2GB' synchronous_commit = 'on' seq_page_cost = '1' max_wal_size = '100GB' checkpoint_timeout = '10min' synchronous_commit = 'on' checkpoint_completion_target = '0.9' autovacuum_vacuum_scale_factor = '0.4' effective_cache_size = '200GB' min_wal_size = '1GB' wal_compression = 'ON'</code> </pre> <br><h3 id="shema-testirovaniya">  Testschema </h3><br><p>  Das Testschema spielt eine wichtige Rolle.  Alle Tests werden dreimal durchgeführt, die Dauer jedes Laufs beträgt 30 Minuten.  Basierend auf den Ergebnissen dieser 3 Tests habe ich den Durchschnittswert abgeleitet.  Die Tests wurden mit dem PostgreSQL-Tool <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pgbench durchgeführt</a> . Es arbeitet mit einem Skalierungsfaktor in Schritten von ca. 16 MB Last. </p><br><h3 id="hugepages">  Riesenseiten </h3><br><p>  Standardmäßig verwendet Linux 4K-Speicherseiten sowie die HugePages-Technologie.  BSD verwendet die Super Pages-Technologie und Windows verwendet Large Pages.  PostgreSQL unterstützt nur die HugePages (Linux) -Technologie.  In Fällen, in denen viel Speicher verwendet wird, verringern kleinere Seiten die Leistung.  Mit HugePages erhöhen Sie den zugewiesenen Speicher für die Anwendung und reduzieren daher den "Overhead", der während des Zuweisungs- / Auslagerungsprozesses auftritt.  Somit steigern HugePages die Produktivität. </p><br><p>  Hier sind die Einstellungen für HugePages mit einer Größe von 1 GB.  Diese Informationen sind jederzeit über / proc verfügbar. </p><br><pre> <code class="plaintext hljs">AnonHugePages:     0 kB ShmemHugePages:    0 kB HugePages_Total:   100 HugePages_Free:    97 HugePages_Rsvd:    63 HugePages_Surp:    0 Hugepagesize:  1048576 kB</code> </pre> <br><p>  Ich habe in einem früheren Beitrag mehr über HugePages geschrieben. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://www.percona.com/blog/2018/08/29/tune-linux-kernel-parameters-for-postgresql-optimization/</a> </p><br><p>  Im Allgemeinen sind HugePages 2 MB und 1 GB groß, daher ist es sinnvoll, 1 GB zu verwenden. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/performance_tuning_guide/s-memory-transhuge</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://kerneltalks.com/services/what-is-huge-pages-in-linux/</a> </p><br><h3 id="rezultaty-testirovaniya">  Testergebnisse </h3><br><p>  Dieser Test zeigt den Gesamteffekt der Verwendung von HugePages verschiedener Größen.  Die erste Testsuite wurde mit einer Seitengröße von 4 KB erstellt - standardmäßig unter Linux verwendet - und ohne Aktivierung von HugePages.  Ich möchte Sie daran erinnern, dass ich die Option Transparente HugePages für die gesamte Dauer der Tests deaktiviert habe. </p><br><p>  Dann wurde eine zweite Reihe von Tests für HugePages mit einer Größe von 2 MB durchgeführt.  Schließlich wurde ein dritter Satz von Tests für 1 GB HugePages durchgeführt. </p><br><p>  Für alle Vergleichstests wurde PostgreSQL DBMS 11 verwendet. Die Kits enthalten Kombinationen verschiedener Datenbankgrößen und verschiedener Clients.  Die folgende Grafik zeigt die Ergebnisse eines Leistungsvergleichs unter Verwendung dieser Tests: TPS (Anzahl der Transaktionen pro Sekunde) - entlang der Y-Achse und die Datenbankgröße und die Anzahl der Clients für eine Datenbank einer bestimmten Größe - entlang der X-Achse. </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d72/a5e/0fa/d72a5e0fa05b8774fe82874c8832d048.png" alt="Bild"></a> </p><br><p>  Aus dem obigen Diagramm ist ersichtlich, dass durch die Verwendung von HugePages der Gewinn mit zunehmender Anzahl von Kunden und der Größe der Datenbank zunimmt, solange diese Größe innerhalb des vorab zugewiesenen gemeinsam genutzten Puffers bleibt. </p><br><p>  Dieser Test verglich TPS und die Anzahl der Kunden.  In diesem Fall beträgt die Datenbankgröße 48 GB.  Die Y-Achse zeigt TPS und die X-Achse zeigt die Anzahl der verbundenen Clients.  Die Datenbankgröße ist klein genug, um in einen gemeinsam genutzten Puffer mit einer festen Größe von 64 GB zu passen. </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5d9/dd6/a4b/5d9dd6a4b647b25ef7edde3928276e7d.png" alt="Bild"></a> </p><br><p>  Wenn HugePages 1 GB groß ist, steigt der vergleichbare Leistungsgewinn mit der Anzahl der Kunden. </p><br><p>  Das nächste Diagramm ist das gleiche wie das vorherige, die Datenbankgröße beträgt jedoch 96 GB.  Dies ist größer als die feste Gesamtpuffergröße von 64 GB. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/z8/6r/je/z86rjeljjqfr_nyaylzzpv7xf9q.png"></a> </p><br><p>  Das Wichtigste dabei: Die Leistung mit HugePages von 1 GB steigt mit zunehmender Anzahl von Kunden und bietet letztendlich eine bessere Leistung als die Verwendung von HugePages mit 2 MB oder Standard-4-KB-Seiten. </p><br><p>  Dieser Test zeigt das Verhältnis von TPS zur Datenbankgröße.  In diesem Fall beträgt die Anzahl der verbundenen Clients 32. Auf der Y-Achse wird TPS und auf der X-Achse die Datenbankgröße angezeigt. </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c93/228/0c2/c932280c2a1becc89eacd56de3fefaff.png" alt="Bild"></a> </p><br><p>  Wenn die Größe der Datenbank die Größe der vorab zugewiesenen HugePages überschreitet, wird die Leistung erwartungsgemäß erheblich reduziert. </p><br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Eine meiner Hauptempfehlungen ist das Deaktivieren von Transparent HugePages.  Sie erhalten die größte Leistungssteigerung, wenn die Datenbank in einem gemeinsam genutzten Puffer mit aktivierten HugePages abgelegt wird.  Die optimale Größe von HugePages wird durch Versuch und Irrtum bestimmt. Dieser Ansatz kann jedoch möglicherweise zu einem erheblichen Gewinn an TPS führen, wenn die Datenbankgröße groß genug ist, gleichzeitig aber in einen gemeinsamen Puffer passt. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435558/">https://habr.com/ru/post/de435558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435546/index.html">Praktische Tipps, Beispiele und SSH-Tunnel</a></li>
<li><a href="../de435548/index.html">Öffentliche Dienste hacken - möglich, wenn es wirklich nötig ist</a></li>
<li><a href="../de435550/index.html">GitLab 11.6 mit serverlosen Funktionen und Kubernetes-Clustern für Gruppen</a></li>
<li><a href="../de435552/index.html">Importsubstitution - Epitaph aus der Digitalisierung</a></li>
<li><a href="../de435556/index.html">Umzug ins Rechenzentrum: wie es war</a></li>
<li><a href="../de435560/index.html">Erster kommerzieller Quantencomputer - IBM</a></li>
<li><a href="../de435562/index.html">Der Weg eines Rauchers: Wie man als Humanist in den Beruf eines Programmierers einsteigt</a></li>
<li><a href="../de435564/index.html">Verwenden von GtkApplication. Librsvg-Rendering-Funktionen</a></li>
<li><a href="../de435568/index.html">VyOS OpenSource Router</a></li>
<li><a href="../de435572/index.html">Anycubic i3 Mega: Qualitäts-Remake von Prusa i3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>