<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽 ☀️ 🏇🏽 识别Linux磁盘活动 🤾 👩🏽‍🚒 🤮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR ：本文讨论了一种方便，快速和可靠的方法，用于识别将数据写入磁盘的基于Linux的程序，这有助于识别磁盘子系统上的大量负载或异常频繁的负载，还可以使您估计文件系统的开销。 对于PC，EMMC和单板计算机上的闪存的SSD尤其如此。 
 在撰写本文期间，发现将数KB的数据写入BTRFS文件系...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>识别Linux磁盘活动</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476414/">  <b>TL; DR</b> ：本文讨论了一种方便，快速和可靠的方法，用于识别将数据写入磁盘的基于Linux的程序，这有助于识别磁盘子系统上的大量负载或异常频繁的负载，还可以使您估计文件系统的开销。 对于PC，EMMC和单板计算机上的闪存的SSD尤其如此。 <br> 在撰写本文期间，发现将数KB的数据写入BTRFS文件系统会导致将3 MB的实际数据写入磁盘。 <br><br><h3> 引言 </h3>  “哦，废话，现代固态硬盘上的存储单元将在正常使用数十年后就无法使用，不用担心，更不用说将交换，虚拟机和浏览器配置文件文件夹转移到硬盘上了” –这是关于固态硬盘可靠性问题的典型答案保证≈150TBW。 如果您估计有多少典型软件可以写入数据，那么似乎每天10-20 GB已经是一个很大的数字，那么最多可以有40 GB，甚至更多。 有了这样的数字，答案是非常合理的-每天要获得40 GB的记录数据，才能达到10年的覆盖单元数<i>保证</i>值。 <br> 但是，六年来，我一直在使用第三个SSD：第一个SSD的控制器故障，第二个SSD每天开始在单元之间移动数据几次，导致记录维护延迟30秒。 <br><br> 使用新的SSD七个月后，我决定检查记录的数据量，因为磁盘本身是通过SMART报告的。 <br>  <b>19.7 TB。</b> <br> 在短短7个月内，我使用了保证的记录数据量的13％，尽管事实上它是根据对齐分区和设置FS的建议配置的，但我几乎不使用交换功能，虚拟机磁盘位于HDD上！ <a name="habracut"></a><br> 这是一个异常高的数字；按照这种速度，在达到5年驱动器保修期之前，将超过TBW保修。 而且我的计算机每天无法写入93 GB！ 您需要检查10分钟内将多少数据写入磁盘... <blockquote><code>Total: <br> Writes Queued: 24,712, 2,237MiB <br> <b>Writes Completed: 25,507, 2,237MiB</b> <br> Write Merges: 58, 5,472KiB</code> </blockquote>  2.2 GiB，哇！ <br><br><h3> 确定写入磁盘设备的数据量 </h3> 如果您的设备支持<abbr title="来自英语自我监测，分析和报告技术">SMART</abbr> （SSD，EMMC，某些工业MicroSD），则要做的第一件事是<code>smartctl</code> ， <code>skdump</code>或<code>mmc</code> （来自mmc-utils）从驱动器请求数据。 <br><br><div class="spoiler">  <b class="spoiler_title">Smartctl样本输出</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ sudo smartctl -a /dev/sdb smartctl 7.0 2019-03-31 r4903 [x86_64-linux-5.3.11-200.fc30.x86_64] (local build) Copyright (C) 2002-18, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Model Family: Samsung based SSDs Device Model: Samsung SSD 860 EVO mSATA 250GB Serial Number: S41MNC0KA13477K LU WWN Device Id: 5 002538 e700fa64b Firmware Version: RVT41B6Q User Capacity: 250 059 350 016 bytes [250 GB] Sector Size: 512 bytes logical/physical Rotation Rate: Solid State Device Form Factor: mSATA Device is: In smartctl database [for details use: -P show] ATA Version is: ACS-4 T13/BSR INCITS 529 revision 5 SATA Version is: SATA 3.1, 6.0 Gb/s (current: 3.0 Gb/s) Local Time is: Tue Nov 19 01:48:50 2019 MSK SMART support is: Available - device has SMART capability. SMART support is: Enabled === START OF READ SMART DATA SECTION === SMART overall-health self-assessment test result: PASSED General SMART Values: Offline data collection status: (0x00) Offline data collection activity was never started. Auto Offline Data Collection: Disabled. Self-test execution status: ( 0) The previous self-test routine completed without error or no self-test has ever been run. Total time to complete Offline data collection: ( 0) seconds. Offline data collection capabilities: (0x53) SMART execute Offline immediate. Auto Offline data collection on/off support. Suspend Offline collection upon new command. No Offline surface scan supported. Self-test supported. No Conveyance Self-test supported. Selective Self-test supported. SMART capabilities: (0x0003) Saves SMART data before entering power-saving mode. Supports SMART auto save timer. Error logging capability: (0x01) Error logging supported. General Purpose Logging supported. Short self-test routine recommended polling time: ( 2) minutes. Extended self-test routine recommended polling time: ( 85) minutes. SCT capabilities: (0x003d) SCT Status supported. SCT Error Recovery Control supported. SCT Feature Control supported. SCT Data Table supported. SMART Attributes Data Structure revision number: 1 Vendor Specific SMART Attributes with Thresholds: ID# ATTRIBUTE_NAME FLAG VALUE WORST THRESH TYPE UPDATED WHEN_FAILED RAW_VALUE 5 Reallocated_Sector_Ct 0x0033 100 100 010 Pre-fail Always - 0 9 Power_On_Hours 0x0032 098 098 000 Old_age Always - 5171 12 Power_Cycle_Count 0x0032 099 099 000 Old_age Always - 459 177 Wear_Leveling_Count 0x0013 096 096 000 Pre-fail Always - 62 179 Used_Rsvd_Blk_Cnt_Tot 0x0013 100 100 010 Pre-fail Always - 0 181 Program_Fail_Cnt_Total 0x0032 100 100 010 Old_age Always - 0 182 Erase_Fail_Count_Total 0x0032 100 100 010 Old_age Always - 0 183 Runtime_Bad_Block 0x0013 100 100 010 Pre-fail Always - 0 187 Uncorrectable_Error_Cnt 0x0032 100 100 000 Old_age Always - 0 190 Airflow_Temperature_Cel 0x0032 058 039 000 Old_age Always - 42 195 ECC_Error_Rate 0x001a 200 200 000 Old_age Always - 0 199 CRC_Error_Count 0x003e 100 100 000 Old_age Always - 0 235 POR_Recovery_Count 0x0012 099 099 000 Old_age Always - 29 241 Total_LBAs_Written 0x0032 099 099 000 Old_age Always - 38615215765 SMART Error Log Version: 1 No Errors Logged SMART Self-test log structure revision number 1 No self-tests have been logged. [To run self-tests, use: smartctl -t] SMART Selective self-test log data structure revision number 1 SPAN MIN_LBA MAX_LBA CURRENT_TEST_STATUS 1 0 0 Not_testing 2 0 0 Not_testing 3 0 0 Not_testing 4 0 0 Not_testing 5 0 0 Not_testing Selective self-test flags (0x0): After scanning selected spans, do NOT read-scan remainder of disk. If Selective self-test is pending on power-up, resume after 0 minute delay.</code> </pre> </div></div><br> 我的SSD将以逻辑单位（LBA）而不是以字节为单位存储写入参数241 Total_LBAs_Written中的数据量。 在我的情况下，逻辑块的大小为512字节（可以在smartctl的输出中的“扇区大小”中看到）。 要获取字节，您需要将参数值乘以512。 <br><pre> <code class="plaintext hljs">38615215765 × 512 ÷ 1000 ÷ 1000 ÷ 1000 ÷ 1000 = 19,770  38615215765 × 512 ÷ 1024 ÷ 1024 ÷ 1024 ÷ 1024 = 17,981 </code> </pre> <br><br>  SSD上的<code>skdump</code>程序试图以自己的方式解释Total_LBAs_Writ的值，因此它输出<code>1296217.695 TB</code> ，这显然是错误的。 <br><br> 为了找出设备级别的已记录信息量，我们将使用<code>blktrace</code>软件包中的<code>btrace</code>程序。 它既显示了整个程序持续时间的一般统计信息，也显示了执行记录的各个进程和线程（包括内核）。 <br><br> 运行以下命令以在10分钟内收集信息，其中/ dev / sdb是您的磁盘： <br><pre> <code class="plaintext hljs"># btrace -w 600 -a write /dev/sdb</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">典型命令输出</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">… 8,16 0 3253 50.085433192 0 C WS 125424240 + 64 [0] 8,16 0 3254 50.085550024 0 C WS 193577744 + 64 [0] 8,16 0 3255 50.085685165 0 C WS 197246976 + 64 [0] 8,16 0 3256 50.085936852 0 C WS 125736264 + 128 [0] 8,16 0 3257 50.086060780 0 C WS 96261752 + 64 [0] 8,16 0 3258 50.086195031 0 C WS 94948640 + 64 [0] 8,16 0 3259 50.086327355 0 C WS 124656144 + 64 [0] 8,16 0 3260 50.086843733 15368 C WSM 310218496 + 32 [0] 8,16 0 3261 50.086975238 753 A WSM 310218368 + 32 &lt;- (8,20) 291339904 8,16 0 3262 50.086975560 753 Q WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3263 50.086977345 753 G WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3264 50.086978072 753 I WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3265 50.086979159 753 D WSM 310218368 + 32 [dmcrypt_write/2] 8,16 0 3266 50.087055685 0 C WSM 310218368 + 32 [0] 8,16 0 3267 50.087060168 753 A WSM 310218592 + 160 &lt;- (8,20) 291340128 8,16 0 3268 50.087060367 753 Q WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3269 50.087061242 753 G WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3270 50.087061698 753 I WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3271 50.087062361 753 D WSM 310218592 + 160 [dmcrypt_write/2] 8,16 0 3272 50.087386179 0 C WSM 310218592 + 160 [0] 8,16 0 3273 50.087436417 15368 A FWS 0 + 0 &lt;- (253,1) 0 8,16 0 3274 50.087437471 15368 Q FWS [LS Thread] 8,16 0 3275 50.087440862 15368 G FWS [LS Thread] 8,16 0 3276 50.088300047 0 C WS 0 [0] 8,16 0 3277 50.088470917 753 A WFSM 18882688 + 8 &lt;- (8,20) 4224 8,16 0 3278 50.088471091 753 Q WFSM 18882688 + 8 [dmcrypt_write/2] 8,16 0 3279 50.088471688 753 G WFSM 18882688 + 8 [dmcrypt_write/2] 8,16 0 3280 50.088474334 32254 D WSM 18882688 + 8 [kworker/0:2H] 8,16 0 3281 50.088515572 0 C WSM 18882688 + 8 [0] 8,16 0 3282 50.089229069 0 C WSM 18882688 [0] CPU0 (8,16): Reads Queued: 0, 0KiB Writes Queued: 345, 25,932KiB Read Dispatches: 0, 0KiB Write Dispatches: 331, 25,788KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 1,597, 117,112KiB Read Merges: 0, 0KiB Write Merges: 1, 16KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 CPU1 (8,16): Reads Queued: 0, 0KiB Writes Queued: 502, 39,948KiB Read Dispatches: 0, 0KiB Write Dispatches: 495, 40,076KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 0, 0KiB Read Merges: 0, 0KiB Write Merges: 0, 0KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 CPU2 (8,16): Reads Queued: 0, 0KiB Writes Queued: 297, 26,800KiB Read Dispatches: 0, 0KiB Write Dispatches: 287, 26,800KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 0, 0KiB Read Merges: 0, 0KiB Write Merges: 0, 0KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 CPU3 (8,16): Reads Queued: 0, 0KiB Writes Queued: 418, 24,432KiB Read Dispatches: 0, 0KiB Write Dispatches: 408, 24,448KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 0, 0KiB Read Merges: 0, 0KiB Write Merges: 2, 272KiB Read depth: 0 Write depth: 177 IO unplugs: 0 Timer unplugs: 0 Total (8,16): Reads Queued: 0, 0KiB Writes Queued: 1,562, 117,112KiB Read Dispatches: 0, 0KiB Write Dispatches: 1,521, 117,112KiB Reads Requeued: 0 Writes Requeued: 0 Reads Completed: 0, 0KiB Writes Completed: 1,597, 117,112KiB Read Merges: 0, 0KiB Write Merges: 3, 288KiB IO unplugs: 0 Timer unplugs: 0 Throughput (R/W): 0KiB/s / 2,338KiB/s Events (8,16): 9,287 entries Skips: 0 forward (0 - 0.0%)</code> </pre> </div></div><br>  <code>btrace</code>使<code>btrace</code>可以直观地看到实际记录的数据量，但是很难理解正在记录的程序。 <br><br><h3> 定义记录到驱动器的程序 </h3>  <code>iotop</code>将显示写入磁盘的过程以及所记录数据的大小。 <br> 以下参数提供了最方便的输出： <br><pre> <code class="plaintext hljs"># iotop -obPat</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">程序输出示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">02:55:47 Total DISK READ : 0.00 B/s | Total DISK WRITE : 30.65 K/s 02:55:47 Actual DISK READ: 0.00 B/s | Actual DISK WRITE: 0.00 B/s TIME PID PRIO USER DISK READ DISK WRITE SWAPIN IO COMMAND b'02:55:47 753 be/4 root 0.00 B 0.00 B 0.00 % 0.04 % [dmcrypt_write/2]' b'02:55:47 788 be/4 root 72.00 K 18.27 M 0.00 % 0.02 % [btrfs-transacti]' b'02:55:47 15057 be/4 valdikss 216.00 K 283.05 M 0.00 % 0.01 % firefox' b'02:55:47 1588 ?dif root 0.00 B 0.00 B 0.00 % 0.00 % Xorg -nolisten tcp -auth /var/run/sddm/{398f030f-9667-4dff-b371-81eaae48dfdf} -background none -noreset -displayfd 18 -seat seat0 vt1' b'02:55:47 15692 be/4 valdikss 988.00 K 9.41 M 0.00 % 0.00 % python3 /usr/bin/gajim' b'02:55:47 15730 ?dif valdikss 9.07 M 0.00 B 0.00 % 0.00 % telegram-desktop --' b'02:55:47 2174 ?dif valdikss 1840.00 K 2.47 M 0.00 % 0.00 % yakuake' b'02:55:47 19827 be/4 root 16.00 K 896.00 K 0.00 % 0.00 % [kworker/u16:7-events_unbound]' b'02:55:47 19074 be/4 root 16.00 K 480.00 K 0.00 % 0.00 % [kworker/u16:4-btrfs-endio-write]' b'02:55:47 19006 be/4 root 16.00 K 1872.00 K 0.00 % 0.00 % [kworker/u16:1-events_unbound]' b'02:55:47 1429 be/4 root 484.00 K 0.00 B 0.00 % 0.00 % accounts-daemon' b'02:55:47 15820 be/4 valdikss 312.00 K 0.00 B 0.00 % 0.00 % firefox -contentproc -childID 6 -isForBrowser -prefsLen 7894 -prefMapSize 223880 -parentBuildID 20191022164834 -greomni /usr/lib64/firefox/omni.ja -appomni /usr/lib64/firefox/browser/omni.ja -appdir /usr/lib64/firefox/browser 15057 tab' b'02:55:47 2125 ?dif valdikss 0.00 B 92.00 K 0.00 % 0.00 % plasmashell' b'02:55:47 1268 be/3 root 0.00 B 4.00 K 0.00 % 0.00 % auditd' b'02:55:47 1414 be/4 root 0.00 B 4.00 K 0.00 % 0.00 % sssd_nss --uid 0 --gid 0 --logger=files' b'02:55:47 15238 be/4 valdikss 0.00 B 4.00 K 0.00 % 0.00 % thunderbird' b'02:55:47 18605 be/4 root 0.00 B 3.19 M 0.00 % 0.00 % [kworker/u16:0-btrfs-endio-write]' b'02:55:47 18867 be/4 root 0.00 B 96.00 K 0.00 % 0.00 % [kworker/u16:5-btrfs-endio-meta]' b'02:55:47 19070 be/4 root 0.00 B 160.00 K 0.00 % 0.00 % [kworker/u16:2-btrfs-freespace-write]' b'02:55:47 19645 be/4 root 0.00 B 2.17 M 0.00 % 0.00 % [kworker/u16:3-events_unbound]' b'02:55:47 19982 be/4 root 0.00 B 496.00 K 0.00 % 0.00 % [kworker/u16:6-btrfs-endio-write]'</code> </pre> </div></div><br><br>  Firefox引起了您的注意，它在iotop的几分钟内就记录了283 MB。 <br><br><h3> 定义要记录的文件 </h3> 关于强奸光盘的过程的信息很好，并且记录方式甚至更好。 <br><br> 我们使用<code>fatrace</code>程序，该程序跟踪对文件系统的更改。 <br><pre> <code class="plaintext hljs"># fatrace -f W</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">程序输出示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/usage firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite-wal firefox(15057): CW /home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/https+++habr.com/ls/data.sqlite-journal firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite firefox(15057): W /home/valdikss/.mozilla/firefox/xyf4vqh2.default/webappsstore.sqlite</code> </pre> </div></div><br><br> 由于使用了一个非常简单的跟踪通过inotify访问文件的事实，因此Fatrace无法显示记录的数据量。 <br><br> 从输出中可以看出，Habr在撰写文章时是如何将我的文章保存在浏览器的本地存储中，以及使用Speedrace发现的Group Speed Dial扩展名则每30秒读取一次其数据。 它读取而不是写入：文件前面的<b>CW</b>表示已打开文件进行读写，如果缺少则在创建文件时打开（使用O_RDWR | O_CREAT标志调用openat），但未说明实际写入的文件任何信息。 <br><br> 以防万一，为确保这一点，我们将使用strace，并为文件系统调用提供过滤器： <br><pre> <code class="plaintext hljs">strace -yy -e trace=open,openat,close,write -f -p 15057 2&gt;&amp;1 | grep extension</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">团队产出</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[pid 20352] openat(AT_FDCWD, "/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite", O_RDWR|O_CREAT|O_CLOEXEC, 0644) = 153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt; [pid 20352] read(153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "SQLite format 3\0\20\0\2\2\0@ \0\0\0d\0\0\0\23"..., 100) = 100 [pid 20352] read(153&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "SQLite format 3\0\20\0\2\2\0@ \0\0\0d\0\0\0\23"..., 4096) = 4096 [pid 20352] openat(AT_FDCWD, "/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal", O_RDWR|O_CREAT|O_CLOEXEC, 0644) = 166&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal&gt; … [pid 20352] read(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "\0\0\0\r\4\30\4\36\4\35\4\35\4\36\4-\0 \4\20\4!\4'\4\1\4\"\0250 &amp;"..., 4096) = 4096 [pid 20352] read(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;, "\0\0\0\0\1\36P\t\226\250\4\0O\245\320\16:\"\16.\27\0r\245\306&gt;\246\1\t\1q\370"..., 4096) = 4096 [pid 20352] close(77&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite-wal&gt;) = 0 [pid 20352] close(54&lt;/home/valdikss/.mozilla/firefox/xyf4vqh2.default/storage/default/moz-extension+++e5c304fb-af40-498a-9ba8-47eb0416e933^userContextId=4294967295/idb/3647222921wleabcEoxlt-eengsairo.sqlite&gt;) = 0</code> </pre> </div></div><br> 没有对<code>write()</code>调用，这表明没有写入文件。 <br><br><h3> 确定文件系统开销 </h3>  <code>iotop</code>和<code>btrace</code>的巨大差异促使该想法通过手动将数据写入文件并跟踪btrace读数来测试文件系统。 <br><br> 如果通过加载到systemd紧急模式并手动将<b>几个字节的</b>数据写入现有文件来完全排除写入磁盘，则具有<b>btrfs</b>的SSD上的btrace报告已写入<b>3兆字节的</b>实际数据。 新创建的8 GB闪存驱动器的文件系统在记录一个字节时至少写入264 KiB。 <br> 为了进行比较，向ext4上的文件写入一对字节以向磁盘写入24 KB数据结束。 <br><br>  2017年，Jayashree Mohan，Rohan Kadekodi和Vijay Chidambaram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对不同文件系统的写入放大进行了研究，</a>当写入4 KB时btrfs和ext4的结果与我的相似。 <br><br><img src="https://habrastorage.org/webt/s2/o1/pa/s2o1parvcsurvjl5rkpiijc1fgo.png"><br><br><h3> 结论与结论 </h3> 通过描述的操作，发现了： <br><ol><li>  CUPS打印守护程序每分钟经常在/ var / <u>cache</u> / cups中记录打印机的作业状态 通过清洁/ var / <u>spool</u> / cups解决了该问题（尽管没有打印作业）； </li><li>  Firefox的扩展组快速拨号每30秒读取一次数据库的事实； </li><li>  Fedora中各种性能跟踪服务的定期日志记录，导致在btrfs上记录了几兆字节的数据：pmcd.service，pmie.service，pmlogger.service； </li><li> 使用btrfs记录少量数据时会产生巨大的放大。 </li></ol><br> 结论：如果程序经常写入少量数据（几千字节），则不应使用btrfs，否则它将变成兆字节的记录数据。 对于带有MicroSD操作系统的单板计算机尤其如此。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN476414/">https://habr.com/ru/post/zh-CN476414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN476398/index.html">Redux就像SwiftUI中的状态容器。 基础知识</a></li>
<li><a href="../zh-CN476404/index.html">安全周刊47：非同寻常的漏洞</a></li>
<li><a href="../zh-CN476406/index.html">约会中的神经网络</a></li>
<li><a href="../zh-CN476408/index.html">提款</a></li>
<li><a href="../zh-CN476412/index.html">Hannes Lindemann诉Alain Bombard：揭穿神话？</a></li>
<li><a href="../zh-CN476416/index.html">从Windows管理中心管理Windows Server</a></li>
<li><a href="../zh-CN476418/index.html">初创企业：斯坦福大学20堂课中的10堂课</a></li>
<li><a href="../zh-CN476420/index.html">从一开始就在dart和Flutter中开始使用ReactiveX</a></li>
<li><a href="../zh-CN476424/index.html">框架-弊大于利</a></li>
<li><a href="../zh-CN476430/index.html">如何创建完美的技术组合</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>