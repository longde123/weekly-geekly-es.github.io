<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïç ü¶É ü§ß Windows-Systemsicherheitsprotokollierungsprobleme üëàüèª üì¨ üë©‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Windows-Betriebssysteme verf√ºgen √ºber ein ziemlich gutes Sicherheitsereignisprotokollierungssystem. In verschiedenen Publikationen und Rezensionen wur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Windows-Systemsicherheitsprotokollierungsprobleme</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476464/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/r3/ka/al/r3kaaljcd70px_fvggsc4jmu4es.jpeg"></a> <br><br>  Windows-Betriebssysteme verf√ºgen √ºber ein ziemlich gutes Sicherheitsereignisprotokollierungssystem.  In verschiedenen Publikationen und Rezensionen wurde viel Gutes √ºber sie geschrieben, aber dieser Artikel handelt von etwas anderem.  Hier sprechen wir √ºber Probleme und M√§ngel in diesem System.  Einige der in Betracht gezogenen Probleme sind nicht kritisch und erschweren lediglich die Analyse von Ereignissen, w√§hrend andere schwerwiegende Sicherheitsbedrohungen darstellen. <br><br>  Die identifizierten Probleme wurden unter Windows 7 Maximum (russische Version), Windows 7 Professional (englische Version), Windows 10 Pro (russische Version) und Windows Server 2019 Datacenter (russische Version) getestet.  Alle Betriebssysteme wurden vollst√§ndig aktualisiert. <br><a name="habracut"></a><br><h2>  Problem Nr. 1. Fehlerhaftes Pr√ºfparameter-Verwaltungssystem </h2><br>  <i>Das Problem wurde unter Windows 7/10 / Server 2019 best√§tigt.</i> <br><br><h3>  Problembeschreibung </h3><br>  Nehmen Sie Windows 7 und installieren Sie es mit den Standardeinstellungen.  Wir werden die Domain nicht betreten.  Sehen wir uns die Einstellungen f√ºr die Sicherheitsereignis√ºberwachung an.  √ñffnen Sie dazu das Snap-In "Lokale Sicherheitsrichtlinien" (secpol.msc oder "Systemsteuerung -&gt; Verwaltung -&gt; Lokale Sicherheitsrichtlinien") und sehen Sie sich die grundlegenden √úberwachungseinstellungen an ("Sicherheitseinstellungen -&gt; Lokale Richtlinien -&gt; √úberwachungsrichtlinien"). ) <br><br><img src="https://habrastorage.org/webt/bd/sm/cw/bdsmcwohkqtxgp9dzcac8p63daw.jpeg"><br><br>  Wie Sie sehen, ist das Audit nicht konfiguriert.  Sehen wir uns nun die erweiterten √úberwachungsrichtlinien an ("Sicherheitseinstellungen -&gt; Erweiterte Konfiguration von √úberwachungsrichtlinien -&gt; System√ºberwachungsrichtlinien - Lokales Gruppenrichtlinienobjekt"). <br><br><img src="https://habrastorage.org/webt/om/oy/po/omoypoc15q9ynn0osefv-gawd4i.jpeg"><br><br>  Auch hier ist das Audit nicht konfiguriert.  Wenn ja, sollten theoretisch keine Sicherheitsereignisse in den Protokollen vorhanden sein.  Wir pr√ºfen.  √ñffnen Sie das Sicherheitsprotokoll (eventvwr.exe oder "Systemsteuerung -&gt; Verwaltung -&gt; Ereignisse anzeigen"). <br><br><img src="https://habrastorage.org/webt/j0/s4/ot/j0s4otidlwtntmyx-s02-kom3uk.jpeg"><br><br>  <b>Frage: "Woher kommt das Ereignis im Sicherheitsprotokoll, wenn das Audit √ºberhaupt nicht konfiguriert ist?!"</b> <br><br><h3>  Erkl√§rung </h3><br>  Um den Grund f√ºr dieses Verhalten zu verstehen, m√ºssen Sie sich "unter die Haube" des Betriebssystems begeben.  Zun√§chst besch√§ftigen wir uns mit grundlegenden und erweiterten Pr√ºfungsrichtlinien. <br><br>  Vor Windows Vista gab es nur eine √úberwachungsrichtlinie, die jetzt als einfach bezeichnet wird.  Das Problem war, dass die Granularit√§t des Pr√ºfungsmanagements zu diesem Zeitpunkt sehr gering war.  Wenn es also erforderlich war, den Zugriff auf Dateien zu verfolgen, enthielten diese die Kategorie der Grundrichtlinie "Zugriff auf Objekte √ºberwachen".  Zus√§tzlich zu den Dateioperationen wurden daher eine Reihe anderer "Rausch" -Ereignisse in das Sicherheitsprotokoll geschrieben.  Dies erschwerte die Verarbeitung von Protokollen und irritierten Benutzern erheblich. <br><br>  Microsoft h√∂rte diesen "Schmerz" und entschied sich zu helfen.  Das Problem ist, dass Windows auf dem Konzept der Abw√§rtskompatibilit√§t basiert und √Ñnderungen am vorhandenen √úberwachungsverwaltungsmechanismus diese Kompatibilit√§t zunichte gemacht h√§tten.  Daher ging der Verk√§ufer den umgekehrten Weg.  Er hat ein neues Tool erstellt und es Advanced Audit Policies genannt. <br><br>  Das Tool basiert im Wesentlichen auf der Tatsache, dass erweiterte Richtlinienkategorien aus den Kategorien der grundlegenden √úberwachungsrichtlinien erstellt wurden und diese wiederum in Unterkategorien unterteilt wurden, die einzeln aktiviert und deaktiviert werden k√∂nnen.  Wenn Sie nun den Zugriff auf Dateien in erweiterten √úberwachungsrichtlinien verfolgen m√ºssen, m√ºssen Sie nur die Unterkategorie "Dateisystem" aktivieren, die in der Kategorie "Objektzugriff" enthalten ist.  Gleichzeitig werden "St√∂rungsereignisse", die sich auf den Zugriff auf die Registrierung oder das Filtern des Netzwerkverkehrs beziehen, nicht in das Sicherheitsprotokoll aufgenommen. <br><br>  Die enorme Verwirrung in diesem gesamten Schema wird durch die Tatsache verursacht, dass die Namen der Kategorien der grundlegenden Pr√ºfungsrichtlinien und der fortgeschrittenen Pr√ºfungsrichtlinien nicht √ºbereinstimmen, und es mag zun√§chst den Anschein haben, dass dies v√∂llig unterschiedliche Dinge sind, aber dem ist nicht so. <br><br>  Hier finden Sie eine Konformit√§tstabelle mit den Namen der grundlegenden und erweiterten Kategorien des Auditmanagements <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Name der grundlegenden √úberwachungsrichtlinien</b> </td><td>  <b>Name der erweiterten √úberwachungsrichtlinie</b> </td></tr><tr><td>  Verzeichnisdienst-Zugriffs√ºberwachung </td><td>  Verzeichnisdienstzugriff (Directory Service Access, DS) </td></tr><tr><td>  Objektzugriffspr√ºfung </td><td>  Zugang zu Einrichtungen </td></tr><tr><td>  Berechtigungspr√ºfung </td><td>  Nutzung von Rechten </td></tr><tr><td>  Login Audit </td><td>  Eingang Ausgang </td></tr><tr><td>  Anmeldeereignisse √ºberwachen </td><td>  Konto anmelden </td></tr><tr><td>  √Ñnderungen der √úberwachungsrichtlinien </td><td>  Richtlinien√§nderung </td></tr><tr><td>  Systemereignisse √ºberwachen </td><td>  Das System </td></tr><tr><td>  Account Management Audit </td><td>  Kontoverwaltung </td></tr><tr><td>  Prozessverfolgungs-Audit </td><td>  Detailliertes Tracking </td></tr></tbody></table></div><br>  Es ist wichtig zu verstehen, dass sowohl grundlegende als auch erweiterte Kategorien im Wesentlichen dasselbe steuern.  Die Einbeziehung einer grundlegenden Pr√ºfungsrichtlinienkategorie f√ºhrt zur Einbeziehung der entsprechenden erweiterten Pr√ºfungsrichtlinienkategorie und folglich aller ihrer Unterkategorien.  Um unvorhergesehene Konsequenzen zu vermeiden, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">empfiehlt Microsoft nicht,</a> grundlegende und erweiterte √úberwachungsrichtlinien gleichzeitig zu verwenden. <br><br>  Jetzt m√ºssen Sie herausfinden, wo die √úberwachungseinstellungen gespeichert sind.  Zun√§chst f√ºhren wir eine Reihe von Konzepten ein: <br><br><ol><li>  <i>Effektive √úberwachungsrichtlinien</i> - Informationen, die im RAM gespeichert sind und die aktuellen Betriebsparameter von Betriebssystemmodulen bestimmen, die √úberwachungsfunktionen implementieren. </li><li>  <i>Gespeicherte</i> √úberwachungsrichtlinien - Informationen, die in der Registrierung unter HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv gespeichert sind und zum Ermitteln der effektiven √úberwachungsrichtlinien nach einem Systemneustart verwendet werden. </li></ol><br>  Wir werden verschiedene Verwaltungstools betrachten und angeben, welche Pr√ºfparameter angezeigt und welche festgelegt werden.  Die Angaben in der Tabelle beruhen auf Versuchen. <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Name des Fonds</b> </td><td>  <b>Angezeigte √úberwachungsrichtlinien</b> </td><td>  <b>Persistente √úberwachungsrichtlinien</b> </td></tr><tr><td>  Grundlegende √úberwachungsrichtlinien des Snap-Ins Lokale Sicherheitsrichtlinien </td><td>  Effektive Pr√ºfungsrichtlinien </td><td>  Effektive √úberwachungsrichtlinien, gespeicherte √úberwachungsrichtlinien </td></tr><tr><td>  Erweiterte √úberwachungsrichtlinien des Snap-Ins Lokale Sicherheitsrichtlinien </td><td colspan="2"> Datei <code>%SystemRoot%\System32\GroupPolicy\Machine\Microsoft\Windows NT\Audit\audit.csv</code> </td></tr><tr><td>  Dienstprogramm Auditpol </td><td>  Gespeicherte Audit-Einstellungen </td><td>  Effektive √úberwachungseinstellungen, gespeicherte √úberwachungseinstellungen </td></tr></tbody></table></div><br>  Erkl√§ren wir die Tabelle anhand von Beispielen. <br><br>  <b>Beispiel 1</b> <br><br>  Wenn Sie auditpol ausf√ºhren, um die √úberwachungseinstellungen anzuzeigen: <br>  <code>auditpol /get /category:*</code> , dann werden die gespeicherten Audit-Einstellungen angezeigt, dh diejenigen, die in der Registrierung unter HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv gespeichert sind. <br><br>  <b>Beispiel 2</b> <br><br>  Wenn Sie dasselbe Dienstprogramm ausf√ºhren, die Parameter jedoch bereits festgelegt haben: <br>  <code>auditpol /set /category:*</code> werden die effektiven Audit-Einstellungen und die gespeicherten Audit-Einstellungen ge√§ndert. <br><br>  F√ºr einen separaten Kommentar ist die Reihenfolge erforderlich, in der die √úberwachungseinstellungen in den "Grundlegenden √úberwachungsrichtlinien" des Snap-Ins "Lokale Sicherheitsrichtlinien" angezeigt werden.  Die Kategorie der grundlegenden √úberwachungsrichtlinie wird als festgelegt angezeigt, wenn alle Unterkategorien der entsprechenden erweiterten √úberwachungsrichtlinie installiert sind.  Wenn mindestens einer von ihnen nicht installiert ist, wird die Richtlinie als nicht installiert angezeigt. <br><br>  <b>Beispiel 3</b> <br><br>  Mit dem <code>auditpol /set /category:*</code> stellte der <code>auditpol /set /category:*</code> alle <code>auditpol /set /category:*</code> den <code>auditpol /set /category:*</code> .  Wenn Sie au√üerdem zum Snap-In "Grundlegende √úberwachungsrichtlinien" des Snap-Ins "Lokale Sicherheitsrichtlinien" wechseln, wird gegen√ºber jeder Kategorie eine Erfolgspr√ºfung installiert. <br><br>  <b>Beispiel 4</b> <br><br>  Jetzt hat der Administrator <code>auditpol /clear</code> Befehl <code>auditpol /clear</code> ausgef√ºhrt und alle <code>auditpol /clear</code> zur√ºckgesetzt.  Anschlie√üend richtete er die Dateisystem√ºberwachung ein, indem er <code>auditpol /set /subcategory:" "</code> .  Wenn Sie nun zum Snap-In "Grundlegende √úberwachungsrichtlinien" des Snap-Ins "Lokale Sicherheitsrichtlinien" wechseln, werden alle Kategorien im Status "Keine √úberwachung" definiert, da keine einzige Kategorie der erweiterten √úberwachungsrichtlinie vollst√§ndig definiert ist. <br><br>  Jetzt k√∂nnen wir endlich die Frage beantworten, woher die Protokolle im frisch installierten Betriebssystem stammen.  Die Sache ist, dass nach der Installation die √úberwachung in Windows in den gespeicherten √úberwachungseinstellungen konfiguriert und definiert wird.  Sie k√∂nnen dies √ºberpr√ºfen, indem Sie den <code>auditpol /get /category:*</code> . <br><br><img src="https://habrastorage.org/webt/dx/ot/1s/dxot1swbotmghm7jxzo0zuafvcy.jpeg"><br><br>  In den grundlegenden √úberwachungsrichtlinien des Snap-Ins Lokale Sicherheitsrichtlinien werden diese √úberwachungsinformationen nicht angezeigt, da eine oder mehrere Unterkategorien nicht in allen Kategorien definiert sind.  In den erweiterten √úberwachungsrichtlinien des Snap-Ins Lokale Sicherheitsrichtlinien werden diese Informationen nicht angezeigt, da das Snap-In nur mit den √úberwachungseinstellungen funktioniert, die in der Datei% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv gespeichert sind. <br><br><h3>  Worin besteht das Problem? </h3><br>  Auf den ersten Blick scheint das alles kein Problem zu sein, ist es aber nicht.  Die Tatsache, dass alle Tools die √úberwachungsparameter auf unterschiedliche Weise anzeigen, bietet die M√∂glichkeit, Richtlinien und damit die √úberwachungsergebnisse in b√∂swilliger Weise zu manipulieren. <br><br>  <b>Betrachten Sie das wahrscheinliche Szenario</b> <br><br>  Lassen Sie eine auf Windows 7 basierende technologische Workstation im Unternehmensnetzwerk arbeiten. <br><br>  Die Maschine ist nicht in der Dom√§ne enthalten und f√ºhrt die Funktionen eines Roboters aus, der t√§glich Berichte an die Regulierungsbeh√∂rden sendet.  Angreifer auf die eine oder andere Weise erhielten mit Administratorrechten Fernzugriff darauf.  Gleichzeitig ist das Hauptziel der Angreifer Spionage und die Aufgabe, im System unentdeckt zu bleiben.  Die Angreifer haben heimlich entschieden, dass im Sicherheitsprotokoll keine Ereignisse mit dem Code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4719 "√Ñnderungen</a> der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√úberwachungsrichtlinie" aufgetreten</a> sind. Deaktivieren Sie die √úberwachung des Zugriffs auf Dateien, w√§hrend alle Verwaltungstools angeben, dass die √úberwachung aktiviert ist.  Um die Aufgabe zu erf√ºllen, haben sie die folgenden Aktionen ausgef√ºhrt: <br><br><ol><li>  Auf der angegriffenen Arbeitsstation erteilten sie sich selbst Schreibberechtigungen f√ºr den Registrierungsschl√ºssel HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv und exportierten diesen Schl√ºssel in eine Datei mit dem Namen "+ fs.reg". </li><li>  Wir haben diese Datei auf einen anderen Computer importiert, neu gestartet und dann die Pr√ºfung des Dateisystems mit auditpol deaktiviert. Anschlie√üend haben wir den obigen Registrierungsschl√ºssel in die Datei "-fs.reg" exportiert. </li><li>  Auf dem angegriffenen Computer wurde die Datei "-fs.reg" in die Registrierung importiert. </li><li>  Wir haben eine Sicherungskopie der Datei% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv erstellt, die sich auf dem angegriffenen Computer befindet, und dann die Unterkategorie "Dateisystem" daraus gel√∂scht. </li><li>  Sie haben die angegriffene Arbeitsstation neu gestartet und anschlie√üend die Datei% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv durch eine zuvor gespeicherte Sicherungskopie ersetzt und auch die Datei "+ fs.reg" importiert. </li></ol><br>  Aufgrund all dieser Manipulationen befinden sich keine Richtlinien√§nderungseintr√§ge im Sicherheitsprotokoll. Alle Tools zeigen, dass die √úberwachung aktiviert ist, aber tats√§chlich funktioniert sie nicht. <br><br><h2>  Problem Nr. 2. Fehlgeschlagene Protokollierung von Vorg√§ngen zum L√∂schen von Dateien, Verzeichnissen und Registrierungsschl√ºsseln </h2><br>  <i>Das Problem wurde unter Windows 7/10 / Server 2019 best√§tigt.</i> <br><br><h3>  Problembeschreibung </h3><br>  F√ºr einen Vorgang zum L√∂schen einer Datei, eines Verzeichnisses oder eines Registrierungsschl√ºssels generiert das Betriebssystem eine Ereignissequenz mit den Codes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4663</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4660</a> .  Das Problem ist, dass es aus dem ganzen Strom von Ereignissen nicht so einfach ist, sich miteinander zu verbinden.  Zu diesem Zweck m√ºssen die analysierten Ereignisse die folgenden Parameter aufweisen: <br><br>  <i>Ereignis 1. Code 4663 "Es wurde versucht, auf das Objekt zuzugreifen."</i>  Ereignisparameter: <br>  "ObjectType" = Datei. <br>  "ObjectName" = Name der zu l√∂schenden Datei oder des zu l√∂schenden Verzeichnisses. <br>  "HandleId" = Handle zu der zu l√∂schenden Datei. <br>  ‚ÄúAcessMask‚Äù = 0x10000 (Dieser Code entspricht der DELETE-Operation. Die Entschl√ºsselung aller Operationscodes finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf der Microsoft-Website.</a> ) <br><br><img src="https://habrastorage.org/webt/ez/it/6z/ezit6zapdorhyh5blpomzppv1dc.jpeg"><br><br>  <i>Ereignis 2. Code 4660 "Objekt gel√∂scht."</i> <br>  Ereignisparameter: <br><br>  "HandleId" = "HandleId-Ereignisse 1" <br>  "System \ EventRecordID" = "System \ EventRecordID von Ereignis 1" + 1. <br><br><img src="https://habrastorage.org/webt/qy/bj/6a/qybj6a3724rrph9wsqki1bpcntm.jpeg"><br><br>  Mit dem Entfernen des Registrierungsschl√ºssels (key) ist alles gleich, nur im ersten Ereignis mit Code 4663 der Parameter "ObjectType" = Key. <br><br>  Beachten Sie, dass das Entfernen von Werten in der Registrierung durch ein anderes Ereignis (Code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4657</a> ) beschrieben wird und keine derartigen Probleme verursacht. <br><br><h3>  Funktionen zum L√∂schen von Dateien in Windows 10 und Server 2019 </h3><br>  In Windows 10 / Server 2019 gibt es zwei M√∂glichkeiten, eine Datei zu l√∂schen. <br><br><ol><li>  Wenn die Datei in den Papierkorb gel√∂scht wird, wird die Abfolge der Ereignisse 4663 und 4660 wie zuvor fortgesetzt. </li><li>  Wenn die Datei dauerhaft gel√∂scht wird (nach dem Papierkorb), dann mit einem einzelnen Ereignis mit dem Code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4659</a> . </li></ol><br>  Eine seltsame Sache ist passiert.  Wenn fr√ºher zum Ermitteln gel√∂schter Dateien die Gesamtheit der Ereignisse 4663 und 4660 √ºberwacht werden musste, hat Microsoft jetzt "Benutzer getroffen", und anstelle von zwei Ereignissen m√ºssen jetzt drei Ereignisse √ºberwacht werden.  Es ist auch anzumerken, dass sich die Prozedur zum L√∂schen von Verzeichnissen nicht ge√§ndert hat und wie zuvor aus zwei Ereignissen 4663 und 4660 besteht. <br><br><h3>  Worin besteht das Problem? </h3><br>  Das Problem ist, dass es keine einfache Aufgabe ist, herauszufinden, wer die Datei oder das Verzeichnis gel√∂scht hat.  Anstatt banal nach dem entsprechenden Ereignis im Sicherheitsprotokoll zu suchen, ist es notwendig, die Abfolge der Ereignisse zu analysieren, was manuell ziemlich schwierig ist.  Auf habr sogar dar√ºber gab es einen Artikel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"√úberpr√ºfen der Entfernung und des Zugriffs auf Dateien und Aufzeichnen von Ereignissen in einer Protokolldatei mit Powershell</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"</a> <br><br><h2>  Problem Nummer 3 (kritisch).  Fehlerhafte Protokollierung des Umbenennungsvorgangs f√ºr Dateien, Verzeichnisse und Registrierungsschl√ºssel </h2><br>  <i>Das Problem wurde unter Windows 7/10 / Server 2019 best√§tigt.</i> <br><br><h3>  Problembeschreibung </h3><br>  Dieses Problem hat zwei Unterprobleme: <br><br><ol><li>  In Ereignissen, die vom System beim Umbenennen generiert werden, ist der neue Objektname nirgendwo festgelegt. </li><li>  Das Umbenennen ist dem L√∂schen sehr √§hnlich.  Es kann nur dadurch unterschieden werden, dass das erste Ereignis mit dem Code 4663 mit dem Parameter "AcessMask" = 0x10000 (DELETE) <b>kein</b> Ereignis 4660 hat. </li></ol><br>  Es ist erw√§hnenswert, dass dieses Problem in Bezug auf die Registrierung nur f√ºr Schl√ºssel gilt.  Das Umbenennen von Werten in der Registrierung wird durch eine Abfolge von Ereignissen 4657 beschrieben und verursacht keine derartigen Beschwerden, obwohl es nat√ºrlich viel praktischer w√§re, wenn es nur ein einziges Ereignis g√§be. <br><br><h3>  Worin besteht das Problem? </h3><br>  Zus√§tzlich zu den Schwierigkeiten bei der Suche nach Operationen zum Umbenennen von Dateien erm√∂glicht diese Journalfunktion nicht die Verfolgung des gesamten Lebenszyklus von Dateisystemobjekten oder Registrierungsschl√ºsseln.  Infolgedessen ist es √§u√üerst schwierig, den Verlauf einer Datei zu ermitteln, die auf einem aktiv genutzten Dateiserver h√§ufig umbenannt wurde. <br><br><h2>  Problem Nummer 4 (kritisch).  Verzeichnis- und Registrierungsschl√ºsselerstellung k√∂nnen nicht verfolgt werden </h2><br>  <i>Das Problem wurde unter Windows 7/10 / Server 2019 best√§tigt.</i> <br><br><h3>  Problembeschreibung </h3><br>  Windows verfolgt die Erstellung eines Dateisystemverzeichnisses und eines Registrierungsschl√ºssels nicht.  Dies besteht darin, dass das Betriebssystem kein Ereignis generiert, das den Namen des erstellten Verzeichnisses oder Registrierungsschl√ºssels enth√§lt und dessen Parameter darauf hinweisen, dass dies der Erstellungsvorgang ist. <br><br>  Theoretisch ist durch indirekte Zeichen die Erstellung eines Katalogs m√∂glich.  Wenn es beispielsweise √ºber den "Explorer" erstellt wurde, werden w√§hrend des Erstellungsprozesses Abfrageereignisse f√ºr die Attribute des neuen Verzeichnisses generiert.  Das Problem ist, dass, wenn Sie ein Verzeichnis mit dem Befehl <code>mkdir</code> erstellen, √ºberhaupt keine Ereignisse generiert werden.  Gleichwohl gilt dies f√ºr das Erstellen von Schl√ºsseln in der Registrierung. <br><br><h3>  Worin besteht das Problem? </h3><br>  Dieses Problem erschwert die Untersuchung von Sicherheitsvorf√§llen.  Es gibt keine vern√ºnftige Erkl√§rung daf√ºr, dass diese Informationen nicht in den Journalen erfasst sind. <br><br><h2>  Problem Nummer 5 (kritisch).  Schlechte √úberwachungseinstellungen in russischen Windows-Versionen </h2><br>  <i>Das Vorhandensein des Problems wird in den russischen Editionen von Windows 7/10 / Server 2019 best√§tigt.</i> <br><br><h3>  Problembeschreibung </h3><br>  In russischen Windows-Versionen ist ein Fehler aufgetreten, der das Sicherheits√ºberpr√ºfungsverwaltungssystem funktionsunf√§hig macht. <br><br><h3>  Symptome </h3><br>  Das √Ñndern erweiterter Sicherheitsrichtlinien wirkt sich nicht auf die effektiven √úberwachungseinstellungen aus. Mit anderen Worten, die Richtlinien werden nicht angewendet.  Der Administrator hat beispielsweise die Unterkategorie "Anmelden" aktiviert, das System neu gestartet, den <code>auditpol /get /category:*</code> ausgef√ºhrt und diese Unterkategorie bleibt <code>auditpol /get /category:*</code> .  Das Problem ist sowohl f√ºr Dom√§nencomputer relevant, die √ºber Gruppenrichtlinien verwaltet werden, als auch f√ºr Nicht-Dom√§nencomputer, die √ºber ein lokales Gruppenrichtlinienobjekt verwaltet werden, das √ºber das Snap-In Lokale Sicherheitsrichtlinien konfiguriert wird. <br><br><h3>  Gr√ºnde </h3><br>  Das Problem tritt auf, wenn der Administrator mindestens eine der ‚Äûfehlgeschlagenen‚Äú Unterkategorien der erweiterten √úberwachungsrichtlinien aktiviert hat.  Zu diesen fehlgeschlagenen Kategorien geh√∂ren insbesondere: <br><br><ol><li>  Nutzung von Rechten -&gt; Pr√ºfen Sie die Nutzung von Rechten, die sich auf vertrauliche Daten auswirken.  GUID: {0cce9228-69ae-11d9-bed3-505054503030}. </li><li>  Nutzung von Rechten -&gt; Pr√ºfen Sie die Nutzung von Rechten, die keine Auswirkungen auf vertrauliche Daten haben.  GUID: {0cce9229-69ae-11d9-bed3-505054503030}. </li><li>  Zugriff auf Objekte -&gt; Audit-Ereignisse, die von Anwendungen erstellt wurden.  GUID: {0cce9222-69ae-11d9-bed3-505054503030}. </li></ol><br><h3>  Empfehlungen zur L√∂sung des Problems </h3><br>  Wenn das Problem noch nicht aufgetreten ist, aktivieren Sie die angegebenen "fehlgeschlagenen" Unterkategorien nicht.  Wenn die Ereignisse dieser Unterkategorien sehr wichtig sind, k√∂nnen Sie sie mit dem Dienstprogramm auditpol aktivieren oder das Audit mithilfe grundlegender Richtlinien verwalten. <br><br>  Wenn ein Problem auftritt, m√ºssen Sie: <br><br><ol><li>  L√∂schen Sie im Richtlinienverzeichnis f√ºr Dom√§nengruppen die Datei \ Machine \ microsoft \ windows nt \ Audit \ audit.csv </li><li>  L√∂schen Sie auf allen Computern, auf denen Probleme mit der √úberwachung auftreten, die folgenden Dateien:% SystemRoot% \ security \ audit \ audit.csv,% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv </li></ol><br><h3>  Worin besteht das Problem? </h3><br>  Das Vorhandensein dieses Problems verringert die Anzahl der Sicherheitsereignisse, die regelm√§√üig √ºber erweiterte √úberwachungsrichtlinien √ºberwacht werden k√∂nnen, und f√ºhrt au√üerdem zu Bedrohungen beim Trennen, Blockieren und Destabilisieren der Verwaltung des Pr√ºfsystems im Unternehmensnetzwerk. <br><br><h2>  Problem Nummer 6 (kritisch).  Verdammt "Neuer Text document.txt ... sowie Neue bitmap.bmp" </h2><br>  <i>Das Problem wurde unter Windows 7 best√§tigt. In Windows 10 / Server 2019 fehlt das Problem.</i> <br><br><h3>  Problembeschreibung </h3><br>  Dies ist ein sehr seltsames Problem, das zuf√§llig entdeckt wurde.  Das Problem besteht im Wesentlichen darin, dass das Betriebssystem eine L√ºcke aufweist, mit der Sie die Pr√ºfung der Erstellung von Dateien umgehen k√∂nnen. <br><br>  <b>Vorbereitungsteil:</b> <br><br><ol><li>  Nimm ein frisch installiertes Windows 7. </li><li>  Setzen Sie alle <code>auditpol /clear</code> mit dem Befehl <code>auditpol /clear</code> .  Dieser Punkt ist optional und dient nur zur bequemen Analyse von Magazinen. </li><li>  Wir richten die Dateisystempr√ºfung ein, indem <code>auditpol /set /subcategory:" "</code> . </li><li>  Lassen Sie uns das Verzeichnis C: \ TEST erstellen und √úberwachungsparameter f√ºr das Konto "Everything" zuweisen: "Dateien erstellen / Daten schreiben", "Ordner erstellen / Daten schreiben", "Attribute schreiben", "Zus√§tzliche Attribute schreiben", "Unterordner l√∂schen" und files ‚Äú,‚Äû Delete ‚Äú,‚Äû Change of permissions ‚Äú,‚Äû Change of Ownership ‚Äú, also alles, was mit dem Schreiben von Daten in das Dateisystem zu tun hat. </li></ol><br>  Aus Gr√ºnden der √úbersichtlichkeit l√∂schen wir vor jedem Test das Sicherheitsprotokoll des Betriebssystems. <br><br>  <b>Versuch 1.</b> <br>  <b>Wir machen:</b> <br><br>  F√ºhren Sie in der Befehlszeile den folgenden Befehl aus: <code>echo &gt; "c:\test\  .txt"</code> <br>  <b>Wir beobachten:</b> <br><br>  Beim Erstellen der Datei wurde im Sicherheitsprotokoll ein Ereignis mit dem Code 4663 angezeigt, das den Namen der zu erstellenden Datei im Feld "ObjectName" und 0x2 im Feld "AccessMask" ("Schreiben von Daten oder Hinzuf√ºgen einer Datei") enthielt. <br><br><img src="https://habrastorage.org/webt/k3/cn/6l/k3cn6ltuqg-gclek4pgtn7u_tea.jpeg"><br><br>  Um die folgenden Experimente durchzuf√ºhren, l√∂schen wir den Ordner und das Ereignisprotokoll. <br><br>  <b>Versuch 2.</b> <br>  <b>Wir machen:</b> <br><br>  √ñffnen Sie den Ordner C: \ TEST √ºber den "Explorer" und erstellen Sie √ºber das Kontextmen√º "Erstellen -&gt; Textdokument", das Sie mit der rechten Maustaste aufrufen, die Datei "New Text Document.txt". <br><br><img src="https://habrastorage.org/webt/cc/nh/gj/ccnhgj_6_2xrciyj4m6ubv9hmpk.jpeg"><br><br>  <b>Wir beobachten:</b> <br><br>  Diese Aktion spiegelte sich nicht im Ereignisprotokoll wider !!!  Es gibt auch keine Eintr√§ge, wenn Sie dasselbe Kontextmen√º verwenden, um eine ‚ÄûBitmap‚Äú zu erstellen. <br><br><img src="https://habrastorage.org/webt/-y/52/4b/-y524b96wuzs9eszx5cybyrwsdk.jpeg"><br><br>  <b>Versuch 3.</b> <br>  <b>Wir machen:</b> <br><br>  √ñffnen Sie im Explorer den Ordner C: \ TEST und erstellen Sie √ºber das Kontextmen√º "Erstellen -&gt; Dokument im RTF-Format", das Sie mit der rechten Maustaste aufrufen, die Datei "Neues Dokument im RTF.rtf-Format". <br><br>  <b>Wir beobachten:</b> <br><br>  Wie beim Erstellen der Datei √ºber die Befehlszeile wurde im Protokoll ein Ereignis mit dem Code 4663 und dem entsprechenden Inhalt angezeigt. <br><br><img src="https://habrastorage.org/webt/de/pf/wq/depfwqhwv1umoii77gpofddmoro.jpeg"><br><br><h3>  Worin besteht das Problem? </h3><br>  Nat√ºrlich ist das Erstellen von Textdokumenten oder Bildern nicht besonders sch√§dlich.  Wenn der "Explorer" jedoch in der Lage ist, die Protokollierung von Dateivorg√§ngen zu umgehen, kann Malware dies tun. <br><br>  Dieses Problem ist m√∂glicherweise das bedeutendste, das in Betracht gezogen wird, da es die Glaubw√ºrdigkeit der Ergebnisse der Pr√ºfung von Dateioperationen ernsthaft untergr√§bt. <br><br><h2>  Fazit </h2><br>  Die obige Liste der Probleme erhebt keinen Anspruch auf Vollst√§ndigkeit.  Dabei ist es uns gelungen, auf eine immer noch recht gro√üe Anzahl kleinerer Fehler zu sto√üen, darunter die Verwendung lokalisierter Konstanten als Parameterwerte f√ºr eine Reihe von Ereignissen, wodurch wir gezwungen sind, unsere Analyseskripten f√ºr jede Lokalisierung des Betriebssystems zu schreiben. Das L√∂schen eines Registrierungsschl√ºssels ist beispielsweise eine Folge von Ereignissen 4663 und 4660, und das L√∂schen eines Werts in der Registrierung ist 4657, und sogar die kleinen Dinge ... <br><br>  Aus Gr√ºnden der Fairness stellen wir fest, dass das Sicherheitsereignisprotokollierungssystem in Windows trotz aller M√§ngel eine Vielzahl von positiven Aspekten aufweist.  Durch die Behebung der hier aufgef√ºhrten kritischen Probleme k√∂nnte die Krone wieder zu einer besseren L√∂sung f√ºr die sofortige Protokollierung von Sicherheitsereignissen werden. <br><br>  MACHEN SIE WINDOWS SECURITY EVENT LOGGING WIEDER GROSS! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de476464/">https://habr.com/ru/post/de476464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de476450/index.html">√úberblick √ºber cPanel - eine webbasierte Konsole zum Verwalten von Websites und zum Hosten</a></li>
<li><a href="../de476452/index.html">Speichern von Schl√ºsselwerten oder wie unsere Anwendungen komfortabler geworden sind</a></li>
<li><a href="../de476454/index.html">5G kommt: Welche Unternehmen werden die Einf√ºhrung neuer Technologien im Jahr 2020 sicherstellen?</a></li>
<li><a href="../de476456/index.html">Das chinesische Sozialkredit-System ist in erster Linie kein B√ºrgerbewertungssystem, sondern ein massives API</a></li>
<li><a href="../de476460/index.html">Das erste Hit-Dateiformat im Internet war nicht MP3, sondern MIDI</a></li>
<li><a href="../de476466/index.html">Das Buch "Architekten der Intelligenz"</a></li>
<li><a href="../de476468/index.html">Samsungs neuer kostenloser Online-Kurs zur Textanalyse f√ºr neuronale Netze</a></li>
<li><a href="../de476474/index.html">Wir senden Keenetic an die KN-1310-Unterst√ºtzung des USB-Modems zur√ºck</a></li>
<li><a href="../de476476/index.html">Google Mail nur in HTML anzeigen</a></li>
<li><a href="../de476478/index.html">Etappen der Einf√ºhrung von Modellen f√ºr maschinelles Lernen in gro√üen Unternehmen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>