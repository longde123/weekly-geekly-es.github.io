<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™¾ ğŸ¤šğŸ¾ ğŸ’« åœ¨æ‚¨ä¹‹å‰-React Modern Web App ğŸŒ„ ğŸ•ºğŸ¼ ğŸ¤¸ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä»å¤´å¼€å§‹æ„å»ºModern Web Appä¹‹å‰ï¼Œæ‚¨éœ€è¦å¼„æ¸…æ¥šä»€ä¹ˆæ˜¯Modern Web Applicationï¼Ÿ 


ç°ä»£Webåº”ç”¨ç¨‹åºï¼ˆMWAï¼‰æ˜¯éµå¾ªæ‰€æœ‰ç°ä»£Webæ ‡å‡†çš„åº”ç”¨ç¨‹åºã€‚ å…¶ä¸­åŒ…æ‹¬Progressive Web App-èƒ½å¤Ÿå°†ç§»åŠ¨æµè§ˆå™¨ç‰ˆæœ¬ä¸‹è½½åˆ°æ‰‹æœºå¹¶ç”¨ä½œå®Œæ•´çš„åº”ç”¨ç¨‹åºã€‚ è¿™ä¹Ÿæ˜¯ä»ç§»åŠ¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨æ‚¨ä¹‹å‰-React Modern Web App</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432368/"><p> åœ¨ä»å¤´å¼€å§‹æ„å»º<strong>Modern Web Appä¹‹å‰ï¼Œ</strong>æ‚¨éœ€è¦å¼„æ¸…æ¥šä»€ä¹ˆæ˜¯Modern Web Applicationï¼Ÿ </p><br><p>ç°ä»£Webåº”ç”¨ç¨‹åºï¼ˆMWAï¼‰æ˜¯éµå¾ªæ‰€æœ‰ç°ä»£Webæ ‡å‡†çš„åº”ç”¨ç¨‹åºã€‚ å…¶ä¸­åŒ…æ‹¬Progressive Web App-èƒ½å¤Ÿå°†ç§»åŠ¨æµè§ˆå™¨ç‰ˆæœ¬ä¸‹è½½åˆ°æ‰‹æœºå¹¶ç”¨ä½œå®Œæ•´çš„åº”ç”¨ç¨‹åºã€‚ è¿™ä¹Ÿæ˜¯ä»ç§»åŠ¨è®¾å¤‡å’Œè®¡ç®—æœºè„±æœºæ»šåŠ¨ç½‘ç«™çš„æœºä¼šã€‚ ç°ä»£ææ–™è®¾è®¡ï¼› å®Œå–„çš„æœç´¢å¼•æ“ä¼˜åŒ–ï¼› è‡ªç„¶-é«˜ä¸‹è½½é€Ÿåº¦ã€‚ </p><br><p><img src="https://habrastorage.org/webt/cp/p4/sr/cpp4srk-it2nhotgkfg5q6kczqi.png"></p><br><p> è¿™æ˜¯æˆ‘ä»¬çš„MWAä¸­å°†å‘ç”Ÿçš„äº‹æƒ…ï¼ˆæˆ‘å»ºè®®æ‚¨åœ¨æ–‡ç« ä¸­ä½¿ç”¨æ­¤å¯¼èˆªï¼‰ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šç”¨ç½‘ç»œåº”ç”¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Material-ui</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»£ç æ‹†åˆ†</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Reduxç¤ºä¾‹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰‹æœºç‰ˆ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¸è¿›å¼Webåº”ç”¨</a> </li><li>  Babel 7ï¼ŒWebpackç­‰ </li></ul><br><p>  HabrÃ©ä¸Šçš„äººéƒ½æ˜¯å•†åŠ¡äººå£«ï¼Œå› æ­¤è¯·ç«‹å³è·å–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubå­˜å‚¨åº“</a>çš„é“¾æ¥ï¼Œæ¯ä¸ªå¼€å‘é˜¶æ®µçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜æ¡£</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¼”ç¤º</a> ã€‚ æœ¬æ–‡é€‚ç”¨äºç†Ÿæ‚‰node.jså¹¶åšå‡ºååº”çš„å¼€å‘äººå‘˜ã€‚ æ‰€æœ‰å¿…è¦çš„ç†è®ºéƒ½åœ¨å¿…è¦çš„å·ä¸­åˆ—å‡ºã€‚ é€šè¿‡å•å‡»é“¾æ¥æ‹“å®½æ‚¨çš„è§†é‡ã€‚ </p><br><p> è®©æˆ‘ä»¬å¼€å§‹å§ï¼ </p><a name="habracut"></a><br><a name="ssr"></a><br><h3 id="1-universal">  1.é€šç”¨ </h3><br><p>æ ‡å‡†æ“ä½œï¼šåˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•å¹¶æ‰§è¡Œ<code>git init</code> ã€‚ æ‰“å¼€<em>package.json</em>å¹¶æ·»åŠ å‡ è¡Œï¼š </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"@babel/cli"</span></span>: <span class="hljs-string"><span class="hljs-string">"^7.1.5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@babel/core"</span></span>: <span class="hljs-string"><span class="hljs-string">"^7.1.6"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@babel/preset-env"</span></span>: <span class="hljs-string"><span class="hljs-string">"^7.1.6"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@babel/preset-react"</span></span>: <span class="hljs-string"><span class="hljs-string">"^7.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@babel/register"</span></span>: <span class="hljs-string"><span class="hljs-string">"^7.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"babel-loader"</span></span>: <span class="hljs-string"><span class="hljs-string">"^8.0.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"babel-plugin-root-import"</span></span>: <span class="hljs-string"><span class="hljs-string">"^6.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"express"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.16.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"react"</span></span>: <span class="hljs-string"><span class="hljs-string">"^16.6.3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"react-dom"</span></span>: <span class="hljs-string"><span class="hljs-string">"^16.6.3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"react-helmet"</span></span>: <span class="hljs-string"><span class="hljs-string">"^5.2.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"react-router"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.3.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"react-router-dom"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.3.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"webpack"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.26.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"webpack-cli"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.1.2"</span></span> }</code> </pre> <br><p> æˆ‘ä»¬æ‰§è¡Œ<code>npm install</code> ï¼Œå¹¶ä¸”åœ¨å®‰è£…æ—¶äº†è§£ã€‚ </p><br><p> ç”±äºæˆ‘ä»¬å¤„äº2018å¹´å’Œ2019å¹´ä¹‹äº¤ï¼Œå› æ­¤æˆ‘ä»¬çš„Webåº”ç”¨ç¨‹åºå°†æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šç”¨çš„ï¼ˆæˆ–åŒæ„çš„ï¼‰</a> ï¼Œæ— è®ºåœ¨èƒŒé¢è¿˜æ˜¯åœ¨æ­£é¢ï¼Œéƒ½æœ‰ä¸ä½äºES2017çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ECMAScript</a>ç‰ˆæœ¬ã€‚ ä¸ºæ­¤ï¼Œ <em>index.js</em> ï¼ˆåº”ç”¨ç¨‹åºè¾“å…¥æ–‡ä»¶ï¼‰è¿æ¥babel / registerï¼Œç„¶å<strong>babel</strong>ä½¿ç”¨babel / preset-envå’Œbabel / preset-reactå³æ—¶å°†å…¶åçš„æ‰€æœ‰ESä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å‹å¥½çš„JavaScriptã€‚ ä¸ºäº†æ–¹ä¾¿å¼€å‘ï¼Œæˆ‘é€šå¸¸ä½¿ç”¨babel-plugin-root-importæ’ä»¶ï¼Œé€šè¿‡è¯¥æ’ä»¶ï¼Œä»æ ¹ç›®å½•å¯¼å…¥çš„æ‰€æœ‰å†…å®¹éƒ½å°†ç±»ä¼¼äº'ã€œ/'ï¼Œè€Œä»src /-'ï¼†/'çš„å†…å®¹åˆ™ç±»ä¼¼äºã€‚ å¦å¤–ï¼Œæ‚¨å¯ä»¥ç¼–å†™é•¿è·¯å¾„æˆ–ä½¿ç”¨webpackä¸­çš„åˆ«åã€‚ </p><br><p>  <em>index.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"@babel/register"</span></span>)(); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"./app"</span></span>);</code> </pre> <br><p>  <em>.babelrc</em> </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"presets"</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"@babel/preset-env"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">"targets"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"current"</span></span> } } ], <span class="hljs-string"><span class="hljs-string">"@babel/preset-react"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ [<span class="hljs-string"><span class="hljs-string">"babel-plugin-root-import"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">"paths"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"rootPathPrefix"</span></span>: <span class="hljs-string"><span class="hljs-string">"~"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rootPathSuffix"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"rootPathPrefix"</span></span>: <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rootPathSuffix"</span></span>: <span class="hljs-string"><span class="hljs-string">"src/"</span></span> }] }] ] }</code> </pre> <br><p> æ˜¯æ—¶å€™è®¾ç½®<strong>Webpackäº†</strong> ã€‚ æˆ‘ä»¬åˆ›å»º<em>webpack.config.js</em>å¹¶ä½¿ç”¨ä»£ç ï¼ˆä¸‹æ–‡ä¸­ï¼Œè¯·æ³¨æ„ä»£ç ä¸­çš„æ³¨é‡Šï¼‰ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-comment"><span class="hljs-comment">// ,      Universal web app entry: { client: './src/client.js' }, // ,      webpack' output: { path: path.resolve(__dirname, 'public'), publicPath: '/' }, module: { //  babel-loader     ECMAScript    // JavaScript.       /public rules: [ { test: /\.js$/, exclude: /node_modules/, loader: "babel-loader" } ] } }</span></span></code> </pre> <br><p> ä»è¿™ä¸€åˆ»å¼€å§‹ï¼Œä¹è¶£å°±å¼€å§‹äº†ã€‚ ç°åœ¨è¯¥å¼€å‘åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ç«¯äº†ã€‚  <strong>æœåŠ¡å™¨ç«¯æ¸²æŸ“</strong> ï¼ˆSSRï¼‰æ˜¯ä¸€é¡¹æ—¨åœ¨åŠ å¿«Webåº”ç”¨ç¨‹åºåŠ è½½é€Ÿåº¦å¹¶è§£å†³æœ‰å…³å•é¡µåº”ç”¨ç¨‹åºï¼ˆSPAä¸­çš„SEOï¼‰çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ°¸æ’äº‰è®ºçš„</a>æŠ€æœ¯ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨HTMLæ¨¡æ¿ï¼Œå°†å†…å®¹æ”¾å…¥å…¶ä¸­å¹¶å°†å…¶å‘é€ç»™ç”¨æˆ·ã€‚ æœåŠ¡å™¨å¯ä»¥éå¸¸å¿«é€Ÿåœ°å®Œæˆæ­¤æ“ä½œ-é¡µé¢ç»˜åˆ¶åªéœ€å‡ æ¯«ç§’ã€‚ ä½†æ˜¯ï¼Œç”±äºæ— æ³•åœ¨æœåŠ¡å™¨ä¸Šæ“ä½œDOMï¼Œå› æ­¤åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯éƒ¨åˆ†å°†åˆ·æ–°é¡µé¢ï¼Œå¹¶æœ€ç»ˆå˜ä¸ºäº¤äº’å¼ã€‚ å¥½å— æˆ‘ä»¬æ­£åœ¨å‘å±•ï¼ </p><br><p>  <em>app.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> express <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'express'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> path <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'path'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> stateRoutes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./server/stateRoutes'</span></span> <span class="hljs-comment"><span class="hljs-comment">//   Express     Node.js const app = express() //    app.use(express.static('public')) app.use('/assets', express.static(path.resolve(__dirname, 'assets'))) //    3000 ,      const PORT = process.env.PORT || 3000 app.listen(PORT, '0.0.0.0', () =&gt; { console.log(`The app is running in PORT ${PORT}`) }) //   -  GET-   state  -  //    ,     . stateRoutes(app)</span></span></code> </pre> <br><p>  <em>æœåŠ¡å™¨/ stateRoutes.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ssr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./server'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        // ssr - ,   HTML app.get('*', (req, res) =&gt; { const response = ssr(req.url) res.send(response) }) }</span></span></code> </pre> <br><p>  <em>server / server.jsæ–‡ä»¶</em>æ”¶é›†reactç”Ÿæˆçš„å†…å®¹ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™HTMLæ¨¡æ¿<em>/server/template.js</em> ã€‚ å€¼å¾—æ¾„æ¸…çš„æ˜¯ï¼ŒæœåŠ¡å™¨ä½¿ç”¨é™æ€è·¯ç”±å™¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³åœ¨åŠ è½½æœŸé—´æ›´æ”¹é¡µé¢çš„urlã€‚  <strong>react-helmet</strong>æ˜¯ä¸€ä¸ªå¯ä»¥å¤§å¤§ç®€åŒ–å…ƒæ•°æ®ï¼ˆå®é™…ä¸Šæ˜¯headæ ‡ç­¾ï¼‰å·¥ä½œçš„åº“ã€‚ </p><br><p>  <em>æœåŠ¡å™¨/ server.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderToString } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom/server'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { StaticRouter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-dom'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Helmet } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'&amp;/app/App'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> template <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./template'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      const reactRouterContext = {} //     HTML let content = renderToString( &lt;StaticRouter location={url} context={reactRouterContext}&gt; &lt;App/&gt; &lt;/StaticRouter&gt; ) //  &lt;head&gt;  HTML- const helmet = Helmet.renderStatic() //   HTML-     return template(helmet, content) }</span></span></code> </pre> <br><p> åœ¨<em>server / template.js</em>çš„å¤´éƒ¨ï¼Œæˆ‘ä»¬ä»å¤´ç›”æ‰“å°æ•°æ®ï¼Œè¿æ¥å›¾æ ‡ï¼Œå¹¶ä»é™æ€ç›®å½•/èµ„äº§ä¸­æ‰“å°æ ·å¼ã€‚ æ­£æ–‡ä¸­æ˜¯ä½äº/ publicæ–‡ä»¶å¤¹ä¸­çš„contentå’Œwebpack client.jsæ†ç»‘åŒ…ï¼Œä½†æ˜¯ç”±äºå®ƒæ˜¯é™æ€çš„ï¼Œå› æ­¤æˆ‘ä»¬è½¬åˆ°æ ¹ç›®å½•çš„åœ°å€-/client.jsã€‚ </p><br><p>  <em>æœåŠ¡å™¨/ template.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// HTML- export default function template(helmet, content = '') { const scripts = `&lt;script src="/client.js"&gt;&lt;/script&gt;` const page = `&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; ${helmet.title.toString()} ${helmet.meta.toString()} ${helmet.link.toString()} &lt;meta charset="utf-8"&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt; &lt;meta name="theme-color" content="#810051"&gt; &lt;link rel="shortcut icon" href="/assets/logos/favicon.ico" type="image/x-icon"&gt; &lt;link rel="icon" href="/assets/logos/favicon.ico" type="image/x-icon"&gt; &lt;link rel="stylesheet" href="/assets/global.css"&gt; &lt;/head&gt; &lt;body&gt; &lt;div class="content"&gt; &lt;div id="app" class="wrap-inner"&gt; &lt;!--- magic happens here --&gt; ${content} &lt;/div&gt; &lt;/div&gt; ${scripts} &lt;/body&gt; ` return page }</span></span></code> </pre> <br><p> æˆ‘ä»¬è½¬å‘ç®€å•çš„-å®¢æˆ·ç«¯ã€‚  <em>src / client.jsæ–‡ä»¶å¯</em>è¿˜åŸæœåŠ¡å™¨ç”Ÿæˆçš„HTMLï¼Œè€Œæ— éœ€æ›´æ–°DOMï¼Œå¹¶ä½¿å…¶å…·æœ‰äº¤äº’æ€§ã€‚  ï¼ˆæœ‰å…³æ­¤æ›´å¤š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿¡æ¯</a> ï¼‰ã€‚  <strong>æ°´åˆç‰©</strong>ååº”åŠŸèƒ½å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬ä¸é™æ€è·¯ç”±å™¨æ— å…³ã€‚ æˆ‘ä»¬ä½¿ç”¨é€šå¸¸çš„ä¸€ç§-BrowserRouterã€‚ </p><br><p>  <em>src / client.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { hydrate } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { BrowserRouter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-dom'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./app/App'</span></span> hydrate( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">BrowserRouter</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">BrowserRouter</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'#app'</span></span>) )</code> </pre> <br><p> åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œåº”ç”¨ç¨‹åºçš„reactç»„ä»¶å·²æˆåŠŸç‚¹äº®ã€‚ è¿™æ˜¯æ‰§è¡Œè·¯ç”±çš„æ¡Œé¢åº”ç”¨ç¨‹åºçš„ä¸»è¦ç»„ä»¶ã€‚ å®ƒçš„ä»£ç å¾ˆæ™®é€šï¼š </p><br><p>  <em>src / app / App.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Switch, Route } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Home <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Home'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">App</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Switch</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">exact</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{Home}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Switch</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ) }</span></span></code> </pre> <br><p> å¥½å§ï¼Œ <em>src / app /Home.jsã€‚</em> æ³¨æ„å¤´ç›”çš„å·¥ä½œåŸç†-å¸¸ç”¨çš„å¤´éƒ¨æ ‡ç­¾åŒ…è£…å™¨ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Helmet } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Home</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Universal Page</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"description"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Modern Web App - Home Page"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Welcome to the page of Universal Web App </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ) }</span></span></code> </pre> <br><p> æ­å–œä½ ï¼ æˆ‘ä»¬åˆ†è§£äº†MWAå¼€å‘çš„ç¬¬ä¸€éƒ¨åˆ†ï¼ ä¸ºäº†æµ‹è¯•æ•´ä¸ªè¿‡ç¨‹ï¼Œä»…éœ€è§¦æ‘¸å‡ ä¸‹å³å¯ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æ ¹æ®æ¨¡æ¿-server / template.jsç”¨å…¨å±€æ ·å¼æ–‡ä»¶å’Œå›¾æ ‡å›¾æ ‡å¡«å……<em>/ assets</em>æ–‡ä»¶å¤¹ã€‚ æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åº”ç”¨ç¨‹åºå¯åŠ¨å‘½ä»¤ã€‚ è¿”å›<em>package.json</em> ï¼š </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run pack &amp;&amp; npm run startProd"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startProd"</span></span>: <span class="hljs-string"><span class="hljs-string">"NODE_ENV=production node index.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pack"</span></span>: <span class="hljs-string"><span class="hljs-string">"webpack --mode production --config webpack.config.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startDev"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run packDev &amp;&amp; node index.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packDev"</span></span>: <span class="hljs-string"><span class="hljs-string">"webpack --mode development --config webpack.config.js"</span></span> }</code> </pre> <br><p> æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸¤ç±»å‘½ä»¤-Prodå’ŒDevã€‚ å®ƒä»¬åœ¨webpack v4é…ç½®ä¸­æœ‰æ‰€ä¸åŒã€‚ å…³äº<code>--mode</code>å€¼å¾—<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>é˜…è¯»ã€‚ <br> ç¡®ä¿åœ¨<strong>æœ¬åœ°ä¸»æœº</strong>ä¸Šå°è¯•ç”Ÿæˆçš„é€šç”¨åº”ç”¨ç¨‹åº<strong>ï¼š3000</strong> </p><br><a name="material"></a><br><h3 id="2-material-ui">  2. Material-ui </h3><br><p> æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†å°†é‡ç‚¹ä»‹ç»ä½¿ç”¨material-uiåº“çš„SSRè¿æ¥åˆ°Webåº”ç”¨ç¨‹åºã€‚ ä¸ºä»€ä¹ˆæ˜¯å¥¹ï¼Ÿ ä¸€åˆ‡éƒ½å¾ˆç®€å•-è¯¥åº“æ­£åœ¨ç§¯æåœ°å¼€å‘ï¼Œç»´æŠ¤å’Œæä¾›å¤§é‡æ–‡æ¡£ã€‚ æœ‰äº†å®ƒï¼Œæ‚¨å¯ä»¥æ„å»ºä¸€ä¸ªæ¼‚äº®çš„ç”¨æˆ·ç•Œé¢æ¥åç—°ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>æè¿°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†</a>é€‚åˆæˆ‘ä»¬åº”ç”¨çš„è¿æ¥æ–¹æ¡ˆæœ¬èº«ã€‚ å¥½å§ï¼Œè®©æˆ‘ä»¬åšå§ã€‚ </p><br><p> å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹ï¼š </p><br><pre> <code class="bash hljs">npm i @material-ui/core jss react-jss</code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹ç°æœ‰æ–‡ä»¶è¿›è¡Œæ›´æ”¹ã€‚ åœ¨<em>server / server.jsä¸­ï¼Œ</em>æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºåŒ…è£…åœ¨JssProviderå’ŒMuiThemeProviderä¸­ï¼Œå®ƒä»¬å°†æä¾›Material-uiç»„ä»¶ï¼Œå¹¶ä¸”éå¸¸é‡è¦çš„æ˜¯ï¼Œå¿…é¡»å°†sheetRegistryå¯¹è±¡-cssæ”¾ç½®åœ¨HTMLæ¨¡æ¿ä¸­ã€‚ åœ¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨MuiThemeProviderï¼Œå¹¶ä¸ºå…¶æä¾›ä¸»é¢˜å¯¹è±¡ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æœåŠ¡å™¨ï¼Œæ¨¡æ¿å’Œå®¢æˆ·ç«¯</b> <div class="spoiler_text"><p>  <em>æœåŠ¡å™¨/ server.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderToString } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom/server'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { StaticRouter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-dom'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Helmet } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet'</span></span> <span class="hljs-comment"><span class="hljs-comment">//     material-ui import { SheetsRegistry } from 'react-jss/lib/jss' import JssProvider from 'react-jss/lib/JssProvider' import { MuiThemeProvider, createMuiTheme, createGenerateClassName, } from '@material-ui/core/styles' import purple from '@material-ui/core/colors/purple' import App from '&amp;/app/App' import template from './template' export default function render(url) { const reactRouterContext = {} //  sheetsRegistry -    const sheetsRegistry = new SheetsRegistry() const sheetsManager = new Map() //   -        const theme = createMuiTheme({ palette: { primary: purple, secondary: { main: '#f44336', }, }, //      3.*.*.   v4 -  typography: { useNextVariants: true, }, }) const generateClassName = createGenerateClassName() //     let content = renderToString( &lt;StaticRouter location={url} context={reactRouterContext}&gt; &lt;JssProvider registry={sheetsRegistry} generateClassName={generateClassName}&gt; &lt;MuiThemeProvider theme={theme} sheetsManager={sheetsManager}&gt; &lt;App/&gt; &lt;/MuiThemeProvider&gt; &lt;/JssProvider&gt; &lt;/StaticRouter&gt; ) const helmet = Helmet.renderStatic() //  sheetsRegistry        html return template(helmet, content, sheetsRegistry) }</span></span></code> </pre> <br><p>  <em>æœåŠ¡å™¨/ template.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet, content = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, sheetsRegistry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> css = sheetsRegistry.toString() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scripts = <span class="hljs-string"><span class="hljs-string">`&lt;script src="/client.js"&gt;&lt;/script&gt;`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> page = <span class="hljs-string"><span class="hljs-string">`&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; ... &lt;/head&gt; &lt;body&gt; &lt;div class="content"&gt;...&lt;/div&gt; &lt;style id="jss-server-side"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${css}</span></span></span><span class="hljs-string">&lt;/style&gt; </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${scripts}</span></span></span><span class="hljs-string"> &lt;/body&gt; `</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> page }</code> </pre> <br><p>  <em>src / client.js</em> </p><br><pre> <code class="javascript hljs">... import MuiThemeProvider <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/styles/MuiThemeProvider'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> createMuiTheme <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/styles/createMuiTheme'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> purple <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/colors/purple'</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,     //         const theme = createMuiTheme({ palette: { primary: purple, secondary: { main: '#f44336', }, }, typography: { useNextVariants: true, }, }) //     hydrate( &lt;MuiThemeProvider theme={theme}&gt; &lt;BrowserRouter&gt; &lt;App/&gt; &lt;/BrowserRouter&gt; &lt;/MuiThemeProvider&gt;, document.querySelector('#app') )</span></span></code> </pre> </div></div><br><p> ç°åœ¨ï¼Œæˆ‘å»ºè®®ä¸ºHomeç»„ä»¶æ·»åŠ ä¸€äº›æ—¶å°šçš„è®¾è®¡ã€‚ æ‚¨å¯ä»¥åœ¨å…¶å®˜æ–¹ç½‘ç«™ä¸ŠæŸ¥çœ‹æ‰€æœ‰material-uiç»„ä»¶ï¼Œåœ¨è¿™é‡ŒPaperï¼ŒButtonï¼ŒAppBarï¼ŒToolbarå’ŒTypographyå°±è¶³å¤Ÿäº†ã€‚ </p><br><p>  <em>src /åº”ç”¨ç¨‹åº/ Home.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Helmet } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Paper <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Paper'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Typography <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Typography'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Button'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Header <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Header'</span></span> <span class="hljs-comment"><span class="hljs-comment">// Inline styles -       css  react const styles = { paper: { margin: "auto", marginTop: 200, width: "40%", padding: 15 }, btn: { marginRight: 20 } } export default function Home() { return( &lt;div&gt; &lt;Helmet&gt; &lt;title&gt;Universal Material Page&lt;/title&gt; &lt;/Helmet&gt; &lt;Header/&gt; &lt;Paper elevation={4} style={styles.paper} align="center"&gt; &lt;Typography variant="h5"&gt;Universal Web App with Material-ui&lt;/Typography&gt; &lt;br/&gt; &lt;Button variant="contained" color="primary" style={styles.btn}&gt;I like it!&lt;/Button&gt; &lt;/Paper&gt; &lt;/div&gt; ) }</span></span></code> </pre> <br><p>  <em>src /åº”ç”¨ç¨‹åº/ Header.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AppBar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/AppBar'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Toolbar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Toolbar'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Typography <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Typography'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Header</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AppBar</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">position</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"static"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Toolbar</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Typography</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">variant</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"h5"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"inherit"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Modern Web App </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Typography</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Toolbar</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AppBar</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) }</code> </pre> <br><p> ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š </p><br><p><img src="https://habrastorage.org/webt/hw/sz/tz/hwsztzwymykxqtpq09zvrriozvy.png"></p><br><a name="splitting"></a><br><h3 id="3-code-splitting">  3.ä»£ç æ‹†åˆ† </h3><br><p> å¦‚æœæ‚¨æ‰“ç®—ç¼–å†™çš„å†…å®¹ä¸ä»…ä»…æ˜¯TODOåˆ—è¡¨ï¼Œé‚£ä¹ˆæ‚¨çš„åº”ç”¨ç¨‹åºå°†ä¸client.jsåŒ…æˆæ¯”ä¾‹å¢åŠ ã€‚ ä¸ºäº†é¿å…ç”¨æˆ·é•¿æ—¶é—´åŠ è½½é¡µé¢ï¼Œå·²ç»å‘æ˜äº†å¾ˆé•¿æ—¶é—´çš„ä»£ç æ‹†åˆ†æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œæ›¾ç»æ˜¯React-routerçš„åˆ›å»ºè€…ä¹‹ä¸€çš„Ryan Florenceç”¨ä»–çš„è¯å“åˆ°äº†æ½œåœ¨çš„å¼€å‘äººå‘˜ï¼š </p><br><blockquote> é‚£äº›å°è¯•ä½¿ç”¨æœåŠ¡å™¨æ¸²æŸ“çš„ï¼Œä»£ç åˆ†å‰²çš„åº”ç”¨ç¨‹åºçš„äººã€‚ </blockquote><p>  <em>ç¥æ‰€æœ‰å†³å®šé€šè¿‡ä»£ç æ‹†åˆ†åˆ›å»ºssråº”ç”¨ç¨‹åºçš„äººéƒ½å¥½è¿</em> </p><br><p> æˆ‘ä»¬è¢«æ’æ–¥äº†-æˆ‘ä»¬ä¼šåšåˆ°çš„ï¼ å®‰è£…å¿…è¦çš„ï¼š <cut></cut></p><br><pre> <code class="bash hljs">npm i @babel/plugin-syntax-dynamic-import babel-plugin-dynamic-import-node react-loadable</code> </pre> <br><p> é—®é¢˜åªæ˜¯ä¸€ä¸ªåŠŸèƒ½-å¯¼å…¥ã€‚  Webpackæ”¯æŒæ­¤å¼‚æ­¥åŠ¨æ€å¯¼å…¥åŠŸèƒ½ï¼Œä½†æ˜¯babelç¼–è¯‘å°†æ˜¯ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ã€‚ å¹¸è¿çš„æ˜¯ï¼Œåˆ°2018å¹´ï¼Œå›¾ä¹¦é¦†å·²ç»æ¥å¸®åŠ©è§£å†³è¿™ä¸€é—®é¢˜ã€‚  babel / plugin-syntax-dynamic-importå’Œbabel-plugin-dynamic-import-nodeå°†ä½¿æˆ‘ä»¬å…äº<code>"Unexpected token when using import()"</code>é”™è¯¯ã€‚ ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªåº“æ¥å®Œæˆä¸€é¡¹ä»»åŠ¡ï¼Ÿ  dynamic-import-nodeæ˜¯æœåŠ¡å™¨æ¸²æŸ“ä¸“ç”¨çš„ï¼Œå®ƒå°†åŠ¨æ€åœ°åœ¨æœåŠ¡å™¨ä¸Šæå–å¯¼å…¥ï¼š </p><br><p>  <em>index.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"@babel/register"</span></span>)({ <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [<span class="hljs-string"><span class="hljs-string">"@babel/plugin-syntax-dynamic-import"</span></span>, <span class="hljs-string"><span class="hljs-string">"dynamic-import-node"</span></span>] }); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"./app"</span></span>);</code> </pre> <br><p> åŒæ—¶ï¼Œæˆ‘ä»¬ä¿®æ”¹å…¨å±€babelé…ç½®<em>æ–‡ä»¶.babelrc</em> </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@babel/plugin-syntax-dynamic-import"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-loadable/babel"</span></span>, ... ]</code> </pre> <br><p> è¿™é‡Œå‡ºç°äº†<strong>å¯åŠ è½½çš„ååº”</strong> ã€‚ è¿™ä¸ªå…·æœ‰å‡ºè‰²æ–‡æ¡£çš„åº“å°†æ”¶é›†æœåŠ¡å™¨ä¸Šwebpackå¯¼å…¥æ‰€ç ´åçš„æ‰€æœ‰æ¨¡å—ï¼Œå®¢æˆ·ç«¯å°†åŒæ ·è½»æ¾åœ°è¿›è¡Œæ‹¾å–ã€‚ ä¸ºæ­¤ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸‹è½½æ‰€æœ‰æ¨¡å—ï¼š </p><br><p>  <em>app.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span> ... Loadable.preloadAll().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> app.listen(PORT, <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`The app is running in PORT </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${PORT}</span></span></span><span class="hljs-string">`</span></span>) })) ...</code> </pre> <br><p> æ¨¡å—æœ¬èº«éå¸¸å®¹æ˜“è¿æ¥ã€‚ çœ‹ä¸€ä¸‹ä»£ç ï¼š </p><br><p>  <em>src / app / App.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Switch, Route } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'&amp;/Loading'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AsyncHome = Loadable({ <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-comment"><span class="hljs-comment">/* webpackChunkName: "Home" */</span></span> <span class="hljs-string"><span class="hljs-string">'./Home'</span></span>), <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: Loading, <span class="hljs-attr"><span class="hljs-attr">delay</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>, }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">App</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Switch</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">exact</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{AsyncHome}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Switch</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ) }</span></span></code> </pre> <br><p>  React-loadableå¼‚æ­¥åŠ è½½Homeç»„ä»¶ï¼Œä½¿Webpackæ¸…æ¥šåº”å°†å…¶ç§°ä¸ºHomeï¼ˆæ˜¯çš„ï¼Œå½“æ³¨é‡Šæœ‰æ„ä¹‰æ—¶ï¼Œè¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼‰ã€‚  <code>delay: 300</code>è¡¨ç¤ºå¦‚æœ300æ¯«ç§’åä»æ— æ³•åŠ è½½è¯¥ç»„ä»¶ï¼Œåˆ™éœ€è¦æ˜¾ç¤ºä¸‹è½½ä»åœ¨ç»§ç»­ã€‚ å®ƒå¤„ç†åŠ è½½ï¼š </p><br><p>  <em>src / Loading.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CircularProgress <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/CircularProgress'</span></span> <span class="hljs-comment"><span class="hljs-comment">//        .   const styles = { div: { width: '20%', margin: 'auto', transition: 'margin 1s', backgroundColor: 'lightgreen', color: 'white', cursor: 'pointer', borderRadius: '3px' } } export default function Loading(props) { if (props.error) { //      (  PWA  ),  //  ,      return &lt;div style={styles.div} onClick={ () =&gt; window.location.reload(true) } align="center"&gt; &lt;h3&gt; Please, click here or reload the page. New content is ready. &lt;/h3&gt; &lt;/div&gt; } else if (props.pastDelay) { //     300,    return &lt;CircularProgress color="primary"/&gt; } else { //    Loading  return null } }</span></span></code> </pre> <br><p> ä¸ºäº†ä½¿æœåŠ¡å™¨æ¸…æ¥šæˆ‘ä»¬è¦å¯¼å…¥çš„æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œï¼š </p><br><pre> <code class="javascript hljs">Loadable({ <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./Bar'</span></span>), <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: [<span class="hljs-string"><span class="hljs-string">'./Bar'</span></span>], <span class="hljs-attr"><span class="hljs-attr">webpack</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolveWeak(<span class="hljs-string"><span class="hljs-string">'./Bar'</span></span>)], });</code> </pre> <br><p> ä½†æ˜¯ä¸ºäº†ä¸é‡å¤ç›¸åŒçš„ä»£ç ï¼Œæœ‰ä¸€ä¸ªæˆ‘ä»¬å·²ç»æˆåŠŸè¿æ¥åˆ°<em>.babelrc</em>çš„react-loadable / babelæ’ä»¶ã€‚ ç°åœ¨æœåŠ¡å™¨çŸ¥é“è¦å¯¼å…¥çš„å†…å®¹ï¼Œæ‚¨éœ€è¦æ‰¾å‡ºè¦æ¸²æŸ“çš„å†…å®¹ã€‚ å·¥ä½œæµç¨‹æœ‰ç‚¹åƒå¤´ç›”ï¼š </p><br><p>  <em>æœåŠ¡å™¨/ server.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getBundles } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable/webpack'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> stats <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'~/public/react-loadable.json'</span></span> ... let modules = [] <span class="hljs-comment"><span class="hljs-comment">//      modules let content = renderToString( &lt;StaticRouter location={url} context={reactRouterContext}&gt; &lt;JssProvider registry={sheetsRegistry} generateClassName={generateClassName}&gt; &lt;MuiThemeProvider theme={theme} sheetsManager={sheetsManager}&gt; &lt;Loadable.Capture report={moduleName =&gt; modules.push(moduleName)}&gt; &lt;App/&gt; &lt;/Loadable.Capture&gt; &lt;/MuiThemeProvider&gt; &lt;/JssProvider&gt; &lt;/StaticRouter&gt; ) ... //     ( ) let bundles = getBundles(stats, modules) //    HTML- return template(helmet, content, sheetsRegistry, bundles)</span></span></code> </pre> <br><p> ä¸ºäº†ç¡®ä¿å®¢æˆ·ç«¯åŠ è½½æœåŠ¡å™¨ä¸Šå‘ˆç°çš„æ‰€æœ‰æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ä¸webpackåˆ›å»ºçš„åŒ…å…³è”èµ·æ¥ã€‚ ä¸ºæ­¤ï¼Œè¯·æ›´æ”¹æ”¶é›†å™¨çš„é…ç½®ã€‚  react-loadable / webpackæ’ä»¶å°†æ‰€æœ‰æ¨¡å—å†™å…¥ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚ æˆ‘ä»¬è¿˜åº”è¯¥å‘Šè¯‰webpackåŠ¨æ€å¯¼å…¥åæ­£ç¡®ä¿å­˜æ¨¡å—-åœ¨è¾“å‡ºå¯¹è±¡ä¸­ã€‚ </p><br><p>  <em>webpack.config.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ReactLoadablePlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'react-loadable/webpack'</span></span>).ReactLoadablePlugin; ... output: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'public'</span></span>), <span class="hljs-attr"><span class="hljs-attr">publicPath</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunkFilename</span></span>: <span class="hljs-string"><span class="hljs-string">'[name].bundle.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">"[name].js"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReactLoadablePlugin({ <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'./public/react-loadable.json'</span></span>, }) ]</code> </pre> <br><p> æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­ç¼–å†™æ¨¡å—ï¼Œä¾æ¬¡åŠ è½½å®ƒä»¬ï¼š </p><br><p>  <em>æœåŠ¡å™¨/ template.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet, content = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, sheetsRegistry, bundles</span></span></span><span class="hljs-function">) </span></span>{ ... const page = <span class="hljs-string"><span class="hljs-string">`&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt; &lt;div class="content"&gt; &lt;div id="app" class="wrap-inner"&gt; &lt;!--- magic happens here --&gt; </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${content}</span></span></span><span class="hljs-string"> &lt;/div&gt; </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${bundles.map(bundle =&gt; </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">`&lt;script src='/</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${bundle.file}</span></span></span></span></span><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'&gt;&lt;/script&gt;`</span></span></span></span><span class="hljs-string"><span class="hljs-subst">).join(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'\n'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string"> &lt;/div&gt; &lt;style id="jss-server-side"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${css}</span></span></span><span class="hljs-string">&lt;/style&gt; </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${scripts}</span></span></span><span class="hljs-string"> &lt;/body&gt; `</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> page }</code> </pre> <br><p> å®ƒä»…ç”¨äºå¤„ç†å®¢æˆ·ç«¯éƒ¨åˆ†ã€‚  <code>Loadable.preloadReady()</code>æ–¹æ³•åŠ è½½æœåŠ¡å™¨é¢„å…ˆæä¾›ç»™ç”¨æˆ·çš„æ‰€æœ‰æ¨¡å—ã€‚ </p><br><p>  <em>src / client.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span> Loadable.preloadReady().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { hydrate( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MuiThemeProvider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">theme</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{theme}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">BrowserRouter</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">BrowserRouter</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">MuiThemeProvider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'#app'</span></span>) ) })</code> </pre> <br><p> åšå®Œäº†ï¼ æˆ‘ä»¬å¼€å§‹çœ‹ä¸€ä¸‹ç»“æœ-åœ¨æœ€åä¸€éƒ¨åˆ†ä¸­ï¼Œæ†ç»‘åŒ…åªæœ‰ä¸€ä¸ªæ–‡ä»¶-client.jsé‡265kbï¼Œç°åœ¨-3ä¸ªæ–‡ä»¶ï¼Œæœ€å¤§çš„æ–‡ä»¶é‡215kbã€‚ ä¸ç”¨è¯´ï¼Œåœ¨æ‰©å±•é¡¹ç›®æ—¶é¡µé¢åŠ è½½é€Ÿåº¦ä¼šå¤§å¤§æé«˜å—ï¼Ÿ </p><br><p><img src="https://habrastorage.org/webt/a-/-t/k_/a--tk_6dxr4zzvg-7z8zys_cas4.png"></p><br><a name="redux"></a><br><h3 id="4-redux-schetchik">  4. Reduxè®¡æ•°å™¨ </h3><br><p> ç°åœ¨æˆ‘ä»¬å°†å¼€å§‹è§£å†³å®é™…é—®é¢˜ã€‚ å½“æœåŠ¡å™¨å…·æœ‰æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œæ¥è‡ªæ•°æ®åº“ï¼‰æ—¶ï¼Œå¦‚ä½•è§£å†³éš¾é¢˜ï¼Œæ‚¨éœ€è¦æ˜¾ç¤ºå®ƒï¼Œä»¥ä¾¿æœç´¢æœºå™¨äººå¯ä»¥æ‰¾åˆ°å†…å®¹ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨æ­¤æ•°æ®ã€‚ </p><br><p> æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚ å‡ ä¹æ‰€æœ‰SSRæ–‡ç« éƒ½ä½¿ç”¨äº†å®ƒï¼Œä½†æ˜¯åœ¨é‚£é‡Œå®ç°å®ƒçš„æ–¹å¼è¿œéæ€»æ˜¯å¯å–åˆ°è‰¯å¥½çš„å¯ä¼¸ç¼©æ€§ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒæŒ‰ç…§å¤§å¤šæ•°æ•™ç¨‹è¿›è¡Œæ“ä½œï¼Œæ‚¨å°†æ— æ³•ä½¿ç”¨â€œä¸€ï¼ŒäºŒå’Œç”Ÿäº§â€çš„åŸç†ä½¿ç”¨SSRåˆ›å»ºçœŸå®çš„ç½‘ç«™ã€‚ ç°åœ¨ï¼Œæˆ‘å°†å°è¯•åŠ ç‚¹iã€‚ </p><br><p> æˆ‘ä»¬åªéœ€è¦<strong>redux</strong> ã€‚ äº‹å®æ˜¯ï¼Œreduxæœ‰ä¸€ä¸ªå…¨å±€å­˜å‚¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å•å‡»å°†å…¶ä»æœåŠ¡å™¨è½¬ç§»åˆ°å®¢æˆ·ç«¯ã€‚ <br> ç°åœ¨å¾ˆé‡è¦ï¼ˆï¼ï¼‰ï¼šæˆ‘ä»¬æœ‰ç†ç”±æ‹¥æœ‰ä¸€ä¸ª<em>server / stateRoutesæ–‡ä»¶</em> ã€‚ å®ƒç®¡ç†åœ¨é‚£é‡Œç”Ÿæˆçš„<strong>initialState</strong>å¯¹è±¡ï¼Œä»ä¸­åˆ›å»ºä¸€ä¸ªå­˜å‚¨ï¼Œç„¶åä¼ é€’ç»™HTMLæ¨¡æ¿ã€‚ å®¢æˆ·ä»<code>window.__STATE__</code>æ£€ç´¢è¯¥å¯¹è±¡ï¼Œé‡æ–°<code>window.__STATE__</code>å•†åº—ï¼Œä»…æ­¤è€Œå·²ã€‚ çœ‹èµ·æ¥å¾ˆå®¹æ˜“ã€‚ </p><cut></cut><br><p> å®‰è£…ï¼š </p><br><pre> <code class="bash hljs">npm i redux react-redux</code> </pre> <br><p> è¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤ã€‚ åœ¨è¿™é‡Œï¼Œå¤§éƒ¨åˆ†æ˜¯é‡å¤ä½¿ç”¨ä»¥å‰çš„ä»£ç ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¤„ç†è®¡æ•°å™¨</b> <div class="spoiler_text"><p>  <em>æœåŠ¡å™¨/ stateRoutes.js</em> ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ssr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./server'</span></span> <span class="hljs-comment"><span class="hljs-comment">//   -  = 5 const initialState = { count: 5 } export default function (app) { app.get('*', (req, res) =&gt; { //  initialState  const response = ssr(req.url, initialState) res.send(response) }) }</span></span></code> </pre><br><p>  <em>æœåŠ¡å™¨/ server.js</em> ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Provider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'&amp;/redux/configureStore'</span></span> ... export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, initialState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   const store = configureStore(initialState) ... // Redux Provider    . let content = renderToString( &lt;StaticRouter location={url} context={reactRouterContext}&gt; &lt;Provider store={store} &gt; &lt;JssProvider registry={sheetsRegistry} generateClassName={generateClassName}&gt; &lt;MuiThemeProvider theme={theme} sheetsManager={sheetsManager}&gt; &lt;Loadable.Capture report={moduleName =&gt; modules.push(moduleName)}&gt; &lt;App/&gt; &lt;/Loadable.Capture&gt; &lt;/MuiThemeProvider&gt; &lt;/JssProvider&gt; &lt;/Provider&gt; &lt;/StaticRouter&gt; ) ... //  initialState  HTML- return template(helmet, content, sheetsRegistry, bundles, initialState) }</span></span></code> </pre> <br><p>  <em>æœåŠ¡å™¨/ template.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet, content = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, sheetsRegistry, bundles, initialState = {}</span></span></span><span class="hljs-function">) </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">//   initialState       const scripts = `&lt;script&gt; window.__STATE__ = ${JSON.stringify(initialState)} &lt;/script&gt; &lt;script src="/client.js"&gt;&lt;/script&gt;` const page = `&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt;...&lt;/head&gt; &lt;body&gt; ... ${scripts} &lt;/body&gt; ` return page }</span></span></code> </pre> <br><p> æˆ‘ä»¬åœ¨å®¢æˆ·é‚£é‡Œå¾—åˆ°å­˜å‚¨ã€‚  <em>src / client.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Loadable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-loadable'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Provider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./redux/configureStore'</span></span> ... <span class="hljs-comment"><span class="hljs-comment">//   initialState  ""     const state = window.__STATE__ const store = configureStore(state) Loadable.preloadReady().then(() =&gt; { hydrate( &lt;Provider store={store} &gt; &lt;MuiThemeProvider theme={theme}&gt; &lt;BrowserRouter&gt; &lt;App/&gt; &lt;/BrowserRouter&gt; &lt;/MuiThemeProvider&gt; &lt;/Provider&gt;, document.querySelector('#app') ) })</span></span></code> </pre> </div></div><br><p>  SSRä¸­çš„reduxé€»è¾‘å·²ç»“æŸã€‚ ç°åœ¨ï¼Œreduxçš„é€šå¸¸å·¥ä½œæ˜¯åˆ›å»ºå•†åº—ï¼ŒåŠ¨ä½œï¼ŒåŒ–ç®€å™¨ï¼Œè¿æ¥ç­‰ã€‚ æˆ‘å¸Œæœ›åœ¨æ²¡æœ‰å¤ªå¤šè§£é‡Šçš„æƒ…å†µä¸‹å°†æ¸…æ¥šè¿™ä¸€ç‚¹ã€‚ å¦‚æœä¸æ˜¯ï¼Œè¯·é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ•´ä¸ªreduxåœ¨è¿™é‡Œ</b> <div class="spoiler_text"><p>  <em>src / redux / configureStore.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> rootReducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducers'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureStore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">preloadedState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> createStore( rootReducer, preloadedState ) }</code> </pre> <br><p>  <em>src / redux / actions.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// actions export const INCREASE = 'INCREASE' export const DECREASE = 'DECREASE' //  action creators export function increase() { return { type: INCREASE } } export function decrease() { return { type: DECREASE } }</span></span></code> </pre> <br><p>  <em>src / redux / reducers.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { INCREASE, DECREASE } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./actions'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">count</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> INCREASE: <span class="hljs-comment"><span class="hljs-comment">//   action = INCREASE -  state.count  1 return Object.assign({}, state, { count: state.count + 1 }) case DECREASE: //  DECREASE -   1.    return Object.assign({}, state, { count: state.count - 1 }) default: //      return state } }</span></span></code> </pre> <br><p>  <em>src /åº”ç”¨ç¨‹åº/ Home.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Helmet } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { bindActionCreators } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Actions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'&amp;/redux/actions'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Header <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Header'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Paper <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Paper'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Typography <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Typography'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@material-ui/core/Button'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> styles = { <span class="hljs-attr"><span class="hljs-attr">paper</span></span>: { <span class="hljs-attr"><span class="hljs-attr">margin</span></span>: <span class="hljs-string"><span class="hljs-string">'auto'</span></span>, <span class="hljs-attr"><span class="hljs-attr">marginTop</span></span>: <span class="hljs-string"><span class="hljs-string">'10%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-string"><span class="hljs-string">'40%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">padding</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span> }, <span class="hljs-attr"><span class="hljs-attr">btn</span></span>: { <span class="hljs-attr"><span class="hljs-attr">marginRight</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Home</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increase = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increase.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.decrease = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.decrease.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-comment"><span class="hljs-comment">//   dispatch   increase  decrease increase(){ this.props.actions.increase() } decrease(){ this.props.actions.decrease() } render(){ return ( &lt;div&gt; &lt;Helmet&gt; &lt;title&gt;MWA - Home&lt;/title&gt; &lt;meta name="description" content="Modern Web App - Home Page" /&gt; &lt;/Helmet&gt; &lt;Header/&gt; &lt;Paper elevation={4} style={styles.paper} align="center"&gt; &lt;Typography variant="h5"&gt;Redux-Counter&lt;/Typography&gt; &lt;Typography variant="subtitle1"&gt;Counter: {this.props.count}&lt;/Typography&gt; &lt;br/&gt; &lt;Button variant="contained" color="primary" onClick={this.increase} style={styles.btn}&gt;Increase&lt;/Button&gt; &lt;Button variant="contained" color="primary" onClick={this.decrease}&gt;Decrease&lt;/Button&gt; &lt;/Paper&gt; &lt;/div&gt; ) } } //   props  const mapStateToProps = (state) =&gt; ({ count: state.count }) //  actions  this.props const mapDispatchToProps = (dispatch) =&gt; ({ actions: bindActionCreators(Actions, dispatch) }) //  react-redux connect     export default connect( mapStateToProps, mapDispatchToProps )(Home)</span></span></code> </pre> </div></div><br><p>    : </p><br><p><img src="https://habrastorage.org/webt/jx/hl/yn/jxhlynjixnl5i0r-g7zygxuax4y.gif"></p><br><a name="mobile"></a><br><h3 id="5-mobilnaya-versiya"> 5.   </h3><br><p><img src="https://habrastorage.org/webt/ek/3a/on/ek3aonmzc8w0atrngq6zjngea_g.gif" align="left">     ,         â€”  .       .        ,    ,        <strong>initialState</strong> ,      . </p><br><p>     : </p><br><pre> <code class="bash hljs">npm i mobile-detect</code> </pre> <br><p> <strong>mobile detect</strong>      user-agent,  null             . <br><br clear="left"></p><br><p>   : </p><br><p> <em>server/stateRoutes.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ssr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./server'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MobileDetect <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobile-detect'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">mobile</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">) </span></span>{ app.get(<span class="hljs-string"><span class="hljs-string">'*'</span></span>, (req, res) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// md == null,  ,    const md = new MobileDetect(req.headers['user-agent']) const response = ssr(req.url, initialState, md.mobile()) res.send(response) }) }</span></span></code> </pre> <br><p>           â€”  : </p><br><div class="spoiler"> <b class="spoiler_title">     </b> <div class="spoiler_text"><p> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœåŠ¡å™¨/ server.js</font></font></em> </p><br><pre> <code class="javascript hljs">... import App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'&amp;/app/App'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MobileApp <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'&amp;/mobileApp/App'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, initialState, mobile</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    -    let content = renderToString( &lt;StaticRouter location={url} context={reactRouterContext}&gt; &lt;Provider store={store} &gt; &lt;JssProvider registry={sheetsRegistry} generateClassName={generateClassName}&gt; &lt;MuiThemeProvider theme={theme} sheetsManager={sheetsManager}&gt; &lt;Loadable.Capture report={moduleName =&gt; modules.push(moduleName)}&gt; {mobile === null ? &lt;App/&gt; : &lt;MobileApp/&gt; } &lt;/Loadable.Capture&gt; &lt;/MuiThemeProvider&gt; &lt;/JssProvider&gt; &lt;/Provider&gt; &lt;/StaticRouter&gt; ) //       initialState.mobile = mobile return template(helmet, content, sheetsRegistry, bundles, initialState) }</span></span></code> </pre> <br><p> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src / client.js</font></font></em> </p><br><pre> <code class="javascript hljs">... const state = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.__STATE__ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = configureStore(state) <span class="hljs-comment"><span class="hljs-comment">//       state Loadable.preloadReady().then(() =&gt; { hydrate( &lt;Provider store={store} &gt; &lt;MuiThemeProvider theme={theme}&gt; &lt;BrowserRouter&gt; {state.mobile === null ? &lt;App/&gt; : &lt;MobileApp/&gt; } &lt;/BrowserRouter&gt; &lt;/MuiThemeProvider&gt; &lt;/Provider&gt;, document.querySelector('#app') ) })</span></span></code> </pre> </div></div><br><p>         react-,     .    ,     .       <em>src/mobileApp</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . </p><br><a name="pwa"></a><br><h3 id="6-progressivnoe-prilozhenie"> 6.   </h3><br><p> <em>Progressive Web App</em> (PWA), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  Google</a> â€”  ,    ,    ,   . </p><br><p><img src="https://habrastorage.org/webt/6g/iw/x_/6giwx_0fwzwfcppxqp1kfvsle_a.gif" align="left">      .         :  Chrome, Opera  Samsung Internet     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> .  iOS             Safari,       .  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> .      PWA:  Windows  Chrome v70, Linux  v70, ChromeOS  v67.  PWA  macOS â€”         2019    Chrome v72. </p><br><p>       : PWA        .  ,       ,   ,  . <br><br clear="left"></p><br><p> 2  â€” manifest.json  service-worker.js â€”  . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> â€”  json , ,     ,  . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Service-worker</a>   :    push-,        . </p><br><p>   .      ,     : </p><br><p> <em>public/manifest.json</em> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"short_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"MWA"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Modern Web App"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Modern app built with React SSR, PWA, material-ui, code splitting and much more"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"icons"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>: <span class="hljs-string"><span class="hljs-string">"/assets/logos/yellow 192.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"192x192"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>: <span class="hljs-string"><span class="hljs-string">"/assets/logos/yellow 512.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"512x512"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"start_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"display"</span></span>: <span class="hljs-string"><span class="hljs-string">"standalone"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"theme_color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#810051"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"background_color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#FFFFFF"</span></span> }</code> </pre> <br><p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>   service-worker',        .    ,  ,   : </p><br><p> <em>public/service-worker.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   -       var CACHE = 'cache' //     self.addEventListener('install', function(evt) { evt.waitUntil(precache()) }) //   fetch  ,       self.addEventListener('fetch', function(evt) { console.log('The service worker is serving the asset.') evt.respondWith(fromCache(evt.request)) evt.waitUntil(update(evt.request)) }) // ,      function precache() { return caches.open(CACHE).then(function (cache) { return cache.addAll([ './', '/assets/MWA.png', '/assets/global.css', '/assets/logos/favicon.ico', '/assets/logos/yellow 192.png', '/assets/logos/yellow 512.png', '/robots.txt' ]) }) } //   ,      .  ,   function fromCache(request) { return caches.open(CACHE).then(function (cache) { return cache.match(request).then(function (matching) { return matching || null }) }) } //     ,    //     function update(request) { return caches.open(CACHE).then(function (cache) { return fetch(request).then(function (response) { return cache.put(request, response) }) }) }</span></span></code> </pre> <br><p>    PWA ,      -  html-: </p><br><p> <em>server/template.js</em> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet, content = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, sheetsRegistry, bundles, initialState = {}</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scripts = <span class="hljs-string"><span class="hljs-string">`... &lt;script&gt; //    service-worker -  if ('serviceWorker' in navigator) { window.addEventListener('load', () =&gt; { navigator.serviceWorker.register('/service-worker.js') .then(registration =&gt; { console.log('Service Worker is registered! '); }) .catch(err =&gt; { console.log('Registration failed ', err); }); }); } &lt;/script&gt;`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> page = <span class="hljs-string"><span class="hljs-string">`&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; ... &lt;link rel="manifest" href="/manifest.json"&gt; &lt;/head&gt; &lt;body&gt; ... </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${scripts}</span></span></span><span class="hljs-string"> &lt;/body&gt; `</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> page }</code> </pre> <br><p> åšå®Œäº†ï¼     https,     ,     gif     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">demo</a> . </p><br><h3 id="7-konec"> 7.  </h3><br><p>        MWA.      ,     ,    .      ,     SSR  Code Splitting,      PWA           . </p><br><p> ,     MWA    - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">web.dev</a> : </p><br><p><img src="https://habrastorage.org/webt/wh/xx/tr/whxxtrgl_djujcsj8rvhzatf8sg.png"></p><br><p>      ,  â€” .  ,    ,     â€”     . </p><br><p> , MWA â€” opensource . , , ! </p><br><p> ç¥ä½ å¥½è¿ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432368/">https://habr.com/ru/post/zh-CN432368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432356/index.html">å¦‚ä½•åœ¨20å°æ—¶å†…æ’°å†™å‡ºè‰²çš„VKontakteæ–°é—»æè¦</a></li>
<li><a href="../zh-CN432360/index.html">â€œåä»£â€ AlphaGoç‹¬ç«‹å­¦ä¹ ä¸‹æ£‹ï¼Œå°†æ£‹å’Œå›´æ£‹</a></li>
<li><a href="../zh-CN432362/index.html">å¨¥å››å·-ç™»é™†æœˆçƒå¦ä¸€ç«¯çš„ä»»åŠ¡ä»Šå¤©å¼€å§‹</a></li>
<li><a href="../zh-CN432364/index.html">è¯­éŸ³å­—æ¯ï¼šèˆªç©ºè§£å†³æ–¹æ¡ˆå°†å¦‚ä½•å¸®åŠ©é€šè¿‡ç”µè¯è½¬ç§»ç™»å½•ä¿¡æ¯</a></li>
<li><a href="../zh-CN432366/index.html">åœ¨QSAN XCubeSANå­˜å‚¨ä¸­å®æ–½SSDç¼“å­˜</a></li>
<li><a href="../zh-CN432370/index.html">AlphaZeroåœ¨ä¸€åœº1,000åœºæ¯”èµ›ä¸­å‡»è´¥äº†Stockfish</a></li>
<li><a href="../zh-CN432372/index.html">å¾®è½¯å·²ç»æ­£å¼ç¡®è®¤Edgeä¼šåˆ‡æ¢åˆ°Chromiumå¼•æ“</a></li>
<li><a href="../zh-CN432374/index.html">Kubernetesä¸­é«˜åº¦å¯è®¿é—®ä¸”å¯æ‰©å±•çš„Elasticsearch</a></li>
<li><a href="../zh-CN432378/index.html">è¥¿ä¼¯åˆ©äºšçš„ä¸€å10å¹´çº§ç”Ÿå¸Œæœ›æˆä¸ºä¸€åå¤„ç†å™¨è®¾è®¡å¸ˆã€‚ ä¸ºä»€ä¹ˆä¸åˆ¶ä½œFPGAç¥ç»åŠ é€Ÿå™¨ï¼Ÿ</a></li>
<li><a href="../zh-CN432380/index.html">ä¸€éƒ¨iPhoneä½¿ç”¨å¯¿å‘½é•¿è¾¾å…­å¹´ï¼Œä¸ä¼šè®©æˆ‘åˆ†å¿ƒ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>