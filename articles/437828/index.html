<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåª ü•ß üë®üèø‚Äçüé® Abra el seminario web "SELECCIONE el orden de ejecuci√≥n de consultas y el plan de consultas en MS SQL Server" üà∂ üë®üèª‚Äçüç≥ üç∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola de nuevo 

 Colegas, el √∫ltimo d√≠a de enero, estamos lanzando el curso "MS SQL Server Developer" , en relaci√≥n con el cual hemos tenido una lecci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Abra el seminario web "SELECCIONE el orden de ejecuci√≥n de consultas y el plan de consultas en MS SQL Server"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/437828/">  Hola de nuevo <br><br>  Colegas, el √∫ltimo d√≠a de enero, estamos lanzando el curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"MS SQL Server Developer"</a> , en relaci√≥n con el cual hemos tenido una lecci√≥n tem√°tica abierta.  En √©l hablamos sobre c√≥mo MS SQL Server ejecuta una consulta SELECT, discutimos en qu√© orden y qu√© se analiza, y tambi√©n nos sumergimos un poco en la lectura del plan de consulta. <br><br>  Profesora: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kristina Kucherova</a> , arquitecta del modelo de datos en Sberbank de Rusia. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/H9oS-eLSX_8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Objetivos y ruta del seminario web.</b> <br><br>  Los siguientes objetivos se establecieron al comienzo del seminario web: <br><br><ol><li>  Vea c√≥mo el servidor ejecuta la solicitud y por qu√© sucede esto de esta manera. </li><li>  Aprendiendo a leer un plan de consulta. </li></ol><br>  Para lograrlos, el maestro prepar√≥ una ruta simple pero efectiva: <br><br><img src="https://habrastorage.org/webt/fq/kj/nr/fqkjnrypzokv5wpzw1phclft3xa.jpeg"><br><br>  <b>¬øPor qu√© necesito un plan de consulta?</b> <br><br>  El plan de consulta es una herramienta muy √∫til que, desafortunadamente, muchos desarrolladores no usan.  A primera vista, puede parecer que no es necesario conocer la mec√°nica de la solicitud.  Sin embargo, si comprende lo que sucede dentro de SQL Server, puede escribir una consulta m√°s eficiente.  Y ayudar√° mucho, por ejemplo, durante la optimizaci√≥n. <br><br>  <b>¬øC√≥mo vemos una consulta SELECT?</b> <br><br>  Veamos c√≥mo se ve la consulta SELECT: <br><br><table><tbody><tr><td>  SELECCIONAR [campo1], [campo2] ... <br></td><td>  ¬øQu√© campos elegimos? <br></td></tr><tr><td>  DE [tabla] <br></td><td>  De donde <br></td></tr><tr><td>  DONDE [condiciones] <br></td><td>  Donde estan las condiciones <br></td></tr><tr><td>  GRUPO POR [campo1] <br></td><td>  Agrupar por campos <br></td></tr><tr><td>  Teniendo [condiciones] <br></td><td>  Tener tales y tales condiciones <br></td></tr><tr><td>  ORDENAR POR [campo1] <br></td><td>  Ordenar (ordenar) <br></td></tr></tbody></table><br>  <b>¬øC√≥mo entender a d√≥nde ir para obtener datos?</b> <br><br>  Lo primero que el servidor intenta entender cuando llega una solicitud es a d√≥nde ir para obtener los datos.  El comando FROM responde a esta pregunta, porque es aqu√≠ donde tendremos una lista de tablas (o el nombre de una tabla). <br><br>  Para mayor claridad, imaginemos que nuestro servidor es una especie de mayordomo, a quien ordenamos que nos recoja de vacaciones.  En consecuencia, el mayordomo comienza a pensar, pero ¬øen qu√© armario est√°n las cosas necesarias (en qu√© tabla necesita tomar los datos)?  Y para que nuestro mayordomo pueda completar f√°cilmente su tarea, usamos FROM. <br><br><img src="https://habrastorage.org/webt/ig/wo/uy/igwouy4la8vroshisd8pk5sqcx8.jpeg"><br><br>  <b>¬øC√≥mo entender qu√© datos tomar?</b> <br><br>  Digamos que el mayordomo encontr√≥ el armario correcto y lo abri√≥.  ¬øPero qu√© cosas llevar?  Tal vez vamos a una estaci√≥n de esqu√≠?  ¬øO tal vez en una playa c√°lida y soleada?  Para que nuestras cosas coincidan con el clima, el comando WHERE es √∫til para nosotros, que define las condiciones, es decir, nos permite filtrar los datos.  Si hace calor, llevamos pizarras, camisas y trajes de ba√±o, si hace fr√≠o: guantes, calcetines de punto, su√©teres). <br><br>  El siguiente paso es adjuntar estos datos a los grupos, lo que sucede con GROUP BY (camisetas por separado, calcetines por separado).  De acuerdo con los resultados de la agrupaci√≥n, se puede imponer una condici√≥n m√°s usando HAVING (por ejemplo, eliminar cosas no emparejadas).  Al final, agregamos todo usando ORDER BY, obteniendo la maleta terminada de cosas en la salida, o m√°s bien, un bloque de datos ordenado. <br><br><img src="https://habrastorage.org/webt/vd/lt/4b/vdlt4bg1o5ebpaxz1di_vhl__tm.jpeg"><br><br>  Por cierto, hay un matiz, pero consiste en el hecho de que hay una diferencia sobre qu√© condiciones deben escribirse en DONDE y en TENER.  Pero esto es mejor ver en el video. <br><br>  Continuamos  La ruta de ejecuci√≥n de la solicitud se guarda <b>como un plan de solicitud</b> en la memoria cach√©, es decir, nuestro mayordomo escribe todo, porque es un buen mayordomo, ¬øqu√© pasa si desea repetir su orden el pr√≥ximo a√±o?  Y tales planes, en principio, pueden ser muchos. <br><br>  <b>Tipos de conexiones en el plan de consulta</b> <br><br>  Hay tres conexiones que puede encontrar en t√©rminos de consulta: <br><br><ol><li>  Bucle anidado. </li><li>  Fusionar unirse. </li><li>  Hash √∫nete. </li></ol><br>  Antes de analizar cada uno de ellos con m√°s detalle, resumamos por qu√© deber√≠amos incluso leer el plan de consulta.  Esto es realmente muy √∫til ya que aprender√°s: <br><br><ul><li>  qu√© √≠ndice se utiliza; </li><li>  en qu√© orden se unen; </li><li>  lo que se selecciona del b√∫fer; </li><li>  cu√°nto gasta el servidor recursos en la operaci√≥n; </li><li>  ¬øCu√°l es la diferencia entre un plan hipot√©tico y un plan real? </li></ul><br>  <b>Bucle anidado</b> <br><br>  Digamos que necesitamos unir datos de diferentes tablas.  Presentemos estas tablas como ... una peque√±a cantidad de bombones Skittles y el empaque completo de M&amp;M. <br><br><img src="https://habrastorage.org/webt/4k/-s/uh/4k-suhjbpvptu8kjhe77rx8posm.jpeg"><br><br>  Cuando conectamos un tipo de Nested Loop, tomamos los dulces Skittles y luego obtenemos los dulces ciegos del paquete de M&amp;M.  Si no nos encontramos con un dulce del mismo color (esta es nuestra condici√≥n), obtenemos el siguiente, es decir, ocurre un busto normal.  Como resultado, podemos decir que la conexi√≥n Nested Loop es m√°s adecuada para peque√±as cantidades de datos.  Obviamente, si hay muchos datos, el arresto no es la mejor opci√≥n. <br><br><img src="https://habrastorage.org/webt/fu/0d/mv/fu0dmvprjve1i1mgbn5v3nou3ow.jpeg"><br><br>  Veamos c√≥mo se ve en el panel SQL: <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') create clustered index IX_mms_color ON mms(color); create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) create index IX_skittles_id ON skittles(id); create clustered index IX_skittles_color ON skittles(color); insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select mms.* from mms join skittles on mms.color = skittles.color select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/gx/vj/ed/gxvjedgxwzjcdv2kbzreqmmofwi.jpeg"><br><br>  <b>Fusionar unirse</b> <br><br>  Se utiliza una conexi√≥n para grandes cantidades de datos.  Cuando tiene una combinaci√≥n Merge, ambas tablas tienen un √≠ndice por el cual se pueden unir.  En el caso de los dulces, es como si los hubi√©ramos organizado de antemano por color. <br><br>  Se ve as√≠: <br><br><img src="https://habrastorage.org/webt/j2/cy/ld/j2cyldmem4_ytym2ssj3wpyco1q.jpeg"><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--2 tables 50000 rows, only clustered index by color, color is not unique select COUNT(*) from mms_big join skittles_big on mms_big.color = skittles_big.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/xv/vm/mf/xvvmmf1ozq_lt7f2rrcnqsvz1cs.jpeg"><br><br>  La combinaci√≥n de combinaci√≥n es buena en los siguientes casos: <br><br><ul><li>  grandes conjuntos de datos; </li><li>  los mismos campos de conexi√≥n del mismo tipo; </li><li>  Los campos de conexi√≥n tienen √≠ndices. </li></ul><br>  <b>Hash unirse</b> <br><br>  Hash join se usa para grandes cantidades de datos sin clasificar.  Para unir las tablas en este caso, debe crear algo que imite el √≠ndice. <br><br>  Ejemplo de combinaci√≥n de hash: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') insert into mms (color, taste) values ('blue', 'strange') insert into mms (color, taste) values ('green', 'chocolate') insert into mms (color, taste) values ('orange', 'chocolate') create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/0g/vr/xd/0gvrxdfdoc55bwpdkv5ghkwnq-w.jpeg"><br><br>  Para mayor claridad, recordamos nuestros dulces: <br><br><img src="https://habrastorage.org/webt/xg/2l/cn/xg2lcndw5mzxm5msx6l_0kq_4wc.jpeg"><br><br>  El uso de Hash join implica 2 fases de acci√≥n: <br><br><ol><li>  Build: se crea una tabla hash en la tabla m√°s peque√±a.  Para cada valor en la tabla No. 1, se considera un hash.  El valor se almacena en una tabla hash y el hash calculado se usa como clave. </li><li>  Sonda  Para cada fila de la tabla No. 2, el valor hash se calcula para los campos especificados en join (operator =).  Se busca un hash en la tabla de hash, se verifican los valores de campo. </li></ol><br><img src="https://habrastorage.org/webt/nr/nn/q2/nrnnq2ahbh57a28x3szylahyjue.jpeg"><br><br><img src="https://habrastorage.org/webt/fu/e3/bg/fue3bgxwsesvzgwjgzzva6isnpu.jpeg"><br><br><img src="https://habrastorage.org/webt/dd/fx/mn/ddfxmnjwgneqpqmzxeseavjpkhy.jpeg"><br><br>  Cuando hash join es bueno: <br><br><ul><li>  gran conjunto de datos; </li><li>  sin √≠ndices marginales. </li></ul><br>  Un punto importante: si no hay suficiente memoria, la grabaci√≥n ir√° a tempdb - al disco. <br><br>  Amigos, adem√°s de lo anterior, la lecci√≥n abierta tambi√©n incluy√≥ otros puntos interesantes, que se ven mejor viendo el video.  Sugerimos visitar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jornada de Puertas Abiertas del curso</a> "MS SQL Server Developer", donde puede hacerle al profesor todas sus preguntas. <br><br>  La maestra de PS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kristina Kucherova</a> agradece a Jes Schultz Borland por su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">presentaci√≥n</a> con los Planes de ejecuci√≥n de PASS Summitt: El secreto para el √©xito del ajuste de consultas, que se utiliz√≥ en la preparaci√≥n de la lecci√≥n abierta. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437828/">https://habr.com/ru/post/437828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437816/index.html">MPLS est√° en todas partes. ¬øC√≥mo es la infraestructura de red Yandex.Cloud</a></li>
<li><a href="../437818/index.html">Le ense√±amos a la computadora a distinguir los sonidos: conocer el concurso DCASE y armar su clasificador de audio en 30 minutos</a></li>
<li><a href="../437820/index.html">50 sombras de seguridad Drupal</a></li>
<li><a href="../437824/index.html">Extensi√≥n universal 1C para Hojas de c√°lculo y Documentos de Google: tomar y usar</a></li>
<li><a href="../437826/index.html">C√≥mo migramos la base de datos de Redis y Riak KV a PostgreSQL. Parte 1: el proceso</a></li>
<li><a href="../437830/index.html">Programaci√≥n confiable por idioma: revisi√≥n novata. Parte 1</a></li>
<li><a href="../437832/index.html">C√≥digo abierto: c√≥digo de humor, trucos de c√≥digo, NO c√≥digo</a></li>
<li><a href="../437834/index.html">Dos historias sobre c√≥mo tuvieron lugar los eventos de programaci√≥n en Ekaterimburgo</a></li>
<li><a href="../437836/index.html">Under the hood Screeps: virtualizaci√≥n en el sandbox MMO para programadores</a></li>
<li><a href="../437838/index.html">Las tecnolog√≠as de aprendizaje autom√°tico aceleran el proceso de adaptaci√≥n de los pacientes a las pr√≥tesis bi√≥nicas a veces</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>