<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßíüèø üñïüèø ü¶ó Introduction √† Bash Shell üõåüèº üë©‚ÄçüöÄ üòª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous. Ceci est une traduction du livre de pr√©paration √† l'examen RedHat RHCE. √Ä mon avis, il est tr√®s accessible sur les bases de bash. 

 L...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introduction √† Bash Shell</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471242/">  Bonjour √† tous.  Ceci est une traduction du livre de pr√©paration √† l'examen RedHat RHCE.  √Ä mon avis, il est tr√®s accessible sur les bases de bash. <br><br>  Les scripts shell sont une science en soi.  Sans entrer dans les d√©tails de tout ce qui se passe ¬´sous le capot¬ª, vous apprendrez √† utiliser les √©l√©ments de base pour √©crire vos propres scripts et √† analyser ce qui se passe dans les scripts shell tiers. <br><br><img src="https://habrastorage.org/webt/8w/vx/z3/8wvxz3nzeh5uaiubay0ezgvrbwm.jpeg"><br><a name="habracut"></a><br><h2>  Comprendre les √©l√©ments de base des scripts shell </h2><br>  En fait, un script shell est une liste de commandes qui sont ex√©cut√©es s√©quentiellement, ainsi qu'une certaine logique qui permet au code d'√™tre ex√©cut√© uniquement dans certaines conditions. <br><br>  Pour comprendre les scripts shell complexes, il est recommand√© de commencer par les scripts de base. <br><br>  Ce qui suit est un script tr√®s simple: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # # #This is a script that greets the world # Usage: ./hello clear echo hello world exit 0</span></span></code> </pre> <br>  Il contient plusieurs √©l√©ments qui devraient √™tre utilis√©s dans tous les scripts.  Pour commencer, il y a shebang - c'est la ligne #! / Bin / bash.  Lorsque le script est lanc√© √† partir du shell parent, il ouvre un sous-shell dans lequel les commandes sp√©cifi√©es dans le script sont ex√©cut√©es. <br><br>  Ces commandes peuvent √™tre interpr√©t√©es de diff√©rentes mani√®res.  Afin de comprendre exactement comment ils doivent √™tre interpr√©t√©s, le shebang est utilis√©.  Dans l'exemple ci-dessus, shebang indique clairement que le script doit √™tre ex√©cut√© par le shell bash. <br><br>  D'autres coquilles peuvent √©galement √™tre indiqu√©es.  Par exemple, si votre script contient du code Perl, shebang devrait √™tre #! / Usr / bin / perl.  Commencer un script avec shebang est une bonne pratique;  s'il est omis, le code du script sera ex√©cut√© par le m√™me shell que celui utilis√© pour ex√©cuter le script. <br><br>  Imm√©diatement apr√®s le shebang, il y a une partie expliquant de quoi parle le script.  Quelques lignes de commentaires au d√©but de chaque sc√©nario sont une bonne id√©e.  Dans un court script, il est souvent √©vident de savoir ce qu'il fait, mais √† mesure que le script s'allonge et que plus de gens s'impliquent dans l'√©criture et le soutiennent, il devient moins clair ce que les auteurs ont l'intention de faire. <br><br>  Pour √©viter cette situation, assurez-vous d'ajouter des lignes de commentaires commen√ßant par chaque caract√®re #.  Les commentaires peuvent √™tre non seulement dans les premi√®res lignes, mais aussi au d√©but de chaque sous-section du script.  Cela vous sera certainement utile si vous lisez votre script dans quelques mois! <br><br>  Vous pouvez √©galement commenter non seulement les sous-sections, mais √©galement les lignes individuelles. <br><br>  Quelle que soit la position dans laquelle il est utilis√©, tout, du caract√®re # √† la fin de la ligne, est un commentaire. <br><br>  Apr√®s le bloc de commentaires, le corps du script est localis√©.  Dans l'exemple ci-dessus, ce sont plusieurs commandes qui sont ex√©cut√©es s√©quentiellement.  Le corps du script shell peut augmenter √† mesure qu'il se d√©veloppe. <br><br>  √Ä la fin du script, j'ai inclus l'instruction <b>exit 0</b> .  L'instruction exit indique au shell parent si le script a r√©ussi.  L'√©tat de sortie de la derni√®re commande du script est l'√©tat de sortie du script lui-m√™me, sauf si l' <b>exit 0</b> est utilis√© √† la fin du script. <br><br>  Il est utile de savoir que vous pouvez travailler avec <b>exit</b> pour indiquer au shell parent comment les choses se sont pass√©es. <br><blockquote>  Introduit dans le shell parent, l'√©cho $?  vous permet d'interroger l'√©tat de sortie du dernier script en cours d'ex√©cution. <br></blockquote>  Apr√®s avoir cr√©√© le script, assurez-vous qu'il peut √™tre ex√©cut√©.  La fa√ßon la plus courante de proc√©der consiste √† lui appliquer un bit d'ex√©cution.  Donc, si le nom du fichier de script est bonjour, utilisez la commande <b>chmod + x ./hello</b> pour le rendre ex√©cutable. <br><br>  Le script peut √©galement √™tre ex√©cut√© comme argument de la commande bash.  Dans ce cas, entrez <b>bash ./hello</b> pour ex√©cuter le script hello.  Si le script est ex√©cut√© comme argument de la commande bash, le fichier de script n'a pas besoin d'√™tre ex√©cutable. <br><br>  En fait, vous pouvez stocker le script n'importe o√π, mais si vous allez le stocker dans un r√©pertoire qui n'est pas inclus dans la variable $ PATH, vous devez l'ex√©cuter avec ./ devant le nom du script. <br><br>  Tapez <b>./hello</b> pour ex√©cuter le script ou placez-le dans le r√©pertoire standard inclus dans la variable $ PATH, par exemple, / usr / local / bin. <br><br>  Vous pouvez √©galement placer le script dans le r√©pertoire / bin, apr√®s quoi il suffit d'entrer le nom du fichier n'importe o√π dans le syst√®me de fichiers et le script s'ex√©cutera. <br><br>  <b>Exemple</b> <br><br>  √Ä l'aide de <b>vi / bin / datetime,</b> cr√©ez un fichier nomm√© datetime dans le r√©pertoire / bin.  Collez ce contenu dans le fichier cr√©√©: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #    .     ,      date who</span></span></code> </pre><br>  Apr√®s avoir enregistr√© le fichier, entrez <b>chmod + x / bin / datetime</b> pour donner au fichier l'autorisation de s'ex√©cuter.  Par exemple, acc√©dez √† votre r√©pertoire personnel √† l'aide de la <b>commande cd ~</b> et entrez simplement <b>datetime</b> . <br><br>  Allez, par exemple, dans le r√©pertoire cd ~ home et entrez simplement datetime. <br><br><pre> <code class="bash hljs">[root@localhost ~]<span class="hljs-comment"><span class="hljs-comment"># datetime Sat Sep 28 00:33:41 EDT 2019 root tty1 2019-09-25 20:28 root pts/0 2019-09-27 20:07 (comp.corp.domain.ru)</span></span></code> </pre><br><h2>  Utilisation de variables et d'entr√©es </h2><br>  Les scripts bash sont bien plus qu'une simple liste de commandes ex√©cut√©es s√©quentiellement.  L'une des bonnes choses √† propos des scripts est qu'ils peuvent travailler avec des variables et des entr√©es pour rendre le script flexible.  Dans cette section, vous apprendrez √† travailler avec eux. <br><br><h3>  Utilisation de param√®tres positionnels </h3><br>  Lors de l'ex√©cution du script, vous pouvez utiliser les arguments.  Un argument est tout ce que vous mettez derri√®re une commande de script.  Les arguments peuvent √™tre utilis√©s pour rendre le script plus flexible.  <b>Ex√©cutez la</b> commande <b>useradd lisa</b> .  Dans cet exemple, la commande est <b>useradd</b> et son argument, <b>lisa</b> , indique ce qui doit √™tre fait. <br><br>  √Ä la suite d'une telle commande, un utilisateur nomm√© lisa doit √™tre cr√©√©. <br><br>  Dans le script, le premier argument est <b>$ 1</b> , le deuxi√®me argument est <b>$ 2,</b> etc. Le listing 1 montre comment les arguments peuvent √™tre utilis√©s.  Essayez d'ex√©cuter ce code en sp√©cifiant tout nom d'utilisateur comme param√®tre. <br><br>  <b>Listing 1</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # run this script with a few arguments echo The first argument is $1 echo The second argument is $2 echo The third argument is $3</span></span></code> </pre><br>  Les param√®tres signifient l'entr√©e de donn√©es avant d'ex√©cuter le script.  Dans ce cas, j'ai sp√©cifi√© <b>lisa</b> , <b>lori</b> et <b>bob</b> comme param√®tres apr√®s le nom du script d'argument: <br><br><pre> <code class="bash hljs">[root@server1 ~]<span class="hljs-comment"><span class="hljs-comment"># ./argument lisa lori bob The first argument is lisa The second argument is lori The third argument is bob [root@server1 ~]#</span></span></code> </pre><br>  Si vous avez essay√© d'ex√©cuter l'exemple de code, vous remarquerez peut-√™tre que son contenu n'est pas parfait.  Si vous utilisez trois arguments lors de l'ex√©cution du script √† partir du Listing 1, cela fonctionnera tr√®s bien.  Si vous n'utilisez que deux arguments, le troisi√®me est g√©n√©r√© sans la valeur $ 3. <br><br>  Si vous utilisez quatre arguments, la quatri√®me valeur (qui sera stock√©e dans $ 4) ne sera jamais affich√©e.  Donc, si vous souhaitez utiliser des arguments, vous feriez mieux d'utiliser une approche plus flexible. <br><br>  <b>Listing 2</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # run this script with a few arguments echo you have entered $# arguments for i in $@ do echo $i done exit 0</span></span></code> </pre><br>  <b>Le listing 2 montre deux nouveaux √©l√©ments li√©s aux arguments:</b> <br><br><ul><li>  $ # Est un compteur qui indique le nombre d'arguments utilis√©s lors de l'ex√©cution du script. </li><li>  $ @ Est une liste de tous les arguments qui ont √©t√© utilis√©s lors de l'ex√©cution du script. </li></ul><br>  Pour r√©pertorier les arguments qui ont √©t√© utilis√©s lors de l'ex√©cution de ce script, la boucle <b>for</b> est utilis√©e.  Dans les boucles <b>for</b> , les instructions sont ex√©cut√©es tant que la condition est vraie.  Dans ce sc√©nario, la condition <b>pour i dans $ @</b> signifie ¬´pour chaque argument¬ª.  Chaque fois que le script parcourt la boucle, la valeur de la variable <b>$ @ est</b> affect√©e √† la variable <b>$ i</b> . <br><br>  Donc, tant qu'il y a des arguments, le corps du script est ex√©cut√©. <br><br>  Le corps de la boucle for commence toujours par <b>do</b> et se ferme <b>done</b> , et les commandes √† ex√©cuter sont r√©pertori√©es entre ces deux mots cl√©s.  Ainsi, l'exemple de script utilise <b>echo</b> pour afficher la valeur de chaque argument et s'arr√™te lorsqu'il n'y a plus d'arguments disponibles. <br><br>  <b>Essayons le script du Listing 2 dans cet exemple:</b> <br><br><ol><li>  Tapez l' <b>argument vi</b> pour cr√©er le fichier d'arguments et copiez le contenu du script du Listing 2 dans ce fichier. </li><li>  Enregistrez le fichier et rendez-le ex√©cutable. </li><li>  Ex√©cutez la commande <b>./argument abc</b> .  Vous verrez que trois lignes sont affich√©es. </li><li>  Ex√©cutez la commande <b>./argument abcdef</b> .  Vous verrez qu'en plus de abc, de f sera √©galement affich√©. </li></ol><br><h2>  Variables </h2><br>  Une variable est une √©tiquette utilis√©e pour indiquer un emplacement sp√©cifique dans la m√©moire qui contient une valeur sp√©cifique.  Les variables peuvent √™tre d√©finies statiquement en utilisant NAME = value ou dynamiquement.  Il existe deux solutions pour d√©finir dynamiquement une variable: <br><br><ul><li>  Utilisez le mot cl√© <b>read</b> dans un script pour demander des donn√©es √† l'utilisateur ex√©cutant le script. </li><li>  Utilisez la substitution de commandes pour utiliser le r√©sultat de la commande et l'affecter √† une variable.  Par exemple, la commande <b>date +% d-% m-% y</b> affiche la date actuelle au format jour-mois-ann√©e.  Pour ce faire dans un script, vous pouvez utiliser <b>AUJOURD'HUI = $ (date +% d-% m-% y)</b> .  Pour substituer des commandes, il vous suffit de mettre la commande dont vous souhaitez utiliser le r√©sultat entre les crochets. </li></ul><br>  Dans la section pr√©c√©dente sur les param√®tres de position, vous avez appris comment affecter des arguments aux variables lors de l'ex√©cution d'un script.  Dans certains cas, il peut √™tre plus efficace de demander des informations lorsque vous constatez qu'il manque quelque chose de substantiel.  Le script ci-dessous montre comment proc√©der. <br><br>  <b>Listing 3.</b> Exemple de script utilisant la commande <b>read</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash if [ -z $1 ]; then echo enter a text read TEXT else TEXT=$1 fi echo you have entered the text $TEXT exit 0</span></span></code> </pre><br>  Dans le script du Listing 3, l'op√©rateur <b>if ... then ... else ... fi</b> est utilis√© pour tester l'existence de l'argument <b>$ 1</b> .  Cela se fait √† l'aide de <b>test</b> (test est une commande distincte).  La commande test peut √™tre √©crite de deux mani√®res *: <b>test</b> ou <b>[...]</b> .  Dans l'exemple, la ligne <b>if [-z $ 1] ...</b> est ex√©cut√©e pour voir le test (check) <b>-z $ 1</b> . <br><br>  * <i>- en fait trois <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sources</a> (environ. Traducteur)</i> <br><br>  <b>-z test</b> v√©rifie si <b>$ 1</b> existe ou non.  En d'autres termes, la ligne <b>if [-z $ 1]</b> v√©rifie si <b>$ 1 est</b> vide, ce qui signifie qu'aucun argument n'a √©t√© fourni lors de l'ex√©cution de ce script.  Si c'est le cas, les commandes apr√®s l'instruction <b>then</b> sont ex√©cut√©es. <br><br>  Veuillez noter que lors de l'√©criture de la commande de <b>test</b> avec des crochets, il est important d'utiliser des espaces apr√®s le crochet d'ouverture et avant le crochet de fermeture, la commande ne fonctionnera pas sans espaces. <br><br>  Notez que l'instruction <b>then</b> suit imm√©diatement le <b>test</b> .  Cela est possible car un point-virgule (;) est utilis√©.  Le point-virgule est un s√©parateur de commandes et peut remplacer une nouvelle ligne dans un script. <br><br>  L'instruction <b>then</b> ex√©cute deux commandes: la commande <b>echo</b> , qui affiche le message √† l'√©cran, et la commande <b>read</b> . <br><br>  La commande de <b>lecture</b> arr√™te le script afin que l'entr√©e utilisateur puisse √™tre trait√©e et stock√©e dans la variable TEXT.  Par cons√©quent, <b>read TEXT</b> place toutes les entr√©es utilisateur dans la variable TEXT, qui sera utilis√©e plus tard dans le script. <br><br>  La partie suivante est repr√©sent√©e par l' <b>instruction else</b> .  Les commandes apr√®s l' <b>instruction else</b> sont ex√©cut√©es dans tous les autres cas, ce qui signifie dans ce cas "sinon, si l'argument a √©t√© fourni".  Si tel est le cas, la variable TEXT est d√©termin√©e et la valeur actuelle de <b>$ 1 lui est</b> affect√©e. <br><br>  Remarquez comment la variable est d√©finie: imm√©diatement apr√®s le nom de la variable, il y a un signe = suivi de $ 1.  Notez que vous ne devez jamais utiliser d'espaces lors de la d√©finition de variables. <br><br>  Ensuite, les conditions if sont ferm√©es √† l'aide de l'op√©rateur <b>fi</b> .  Une fois la condition if termin√©e, vous savez avec certitude que la variable TEXT est d√©finie et a une valeur.  L'avant-derni√®re ligne du script lit la valeur de la variable TEXT et mappe cette valeur √† STDOUT √† l'aide de la commande <b>echo</b> .  Notez que pour demander la valeur actuelle d'une variable, elle fait r√©f√©rence au nom de la variable, en commen√ßant par le signe $ devant elle. <br><br>  <b>Vous pouvez vous entra√Æner √† utiliser cet exemple lorsque vous travaillez avec une entr√©e.</b> <br><br><ol><li>  Ouvrez l'√©diteur et cr√©ez un fichier appel√© texte.  Entrez le contenu du code du Listing 3 dans ce fichier. </li><li>  √âcrivez le fichier sur le disque et ex√©cutez <b>chmod + x text</b> pour le rendre ex√©cutable. </li><li>  Ex√©cutez le script en ex√©cutant <b>./text</b> et sans arguments suppl√©mentaires.  Vous verrez qu'il demande une entr√©e. </li><li>  Ex√©cutez le script en utilisant " <b>hello</b> " comme argument (./text hello).  Le r√©sultat affichera "vous avez entr√© le texte bonjour" dans STDOUT. </li></ol><br><h2>  Utilisation de conditions et de boucles </h2><br>  Comme vous l'avez d√©j√† vu, les instructions conditionnelles peuvent √™tre utilis√©es dans un script.  Ces instructions conditionnelles ne sont ex√©cut√©es que si une certaine condition est remplie. <br><br>  Il existe plusieurs instructions conditionnelles et boucles dans bash qui sont souvent utilis√©es. <br><br><ul><li>  <b>if ... then ... else</b> - utilis√© pour ex√©cuter du code si une certaine condition est remplie </li><li>  <b>for</b> - utilis√© pour ex√©cuter des commandes pour une plage de valeurs </li><li>  <b>while</b> - utilis√© pour ex√©cuter du code si une certaine condition est remplie </li><li>  <b>avant</b> - utilis√© pour ex√©cuter du code jusqu'√† ce qu'une certaine condition soit remplie </li><li>  <b>cas</b> - utilis√© pour √©valuer un nombre limit√© de valeurs sp√©cifiques </li></ul><br><h3>  si alors autrement </h3><br>  La <b>construction if then else</b> est courante pour √©valuer des conditions sp√©cifiques.  Vous en avez d√©j√† vu un exemple.  Cette instruction conditionnelle est souvent utilis√©e avec la commande <b>test</b> .  Cette commande vous permet de v√©rifier de nombreuses choses: par exemple, non seulement si un fichier existe, mais aussi comparer des fichiers, comparer des entiers et bien plus encore. <br><blockquote>  Vous pouvez en savoir plus sur test dans la r√©f√©rence avec la commande man test. </blockquote><br>  La construction de base de <b>if</b> est <b>if ... then ... fi</b> . <br><br>  Il compare une condition, comme le montre l'exemple suivant: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-variable"><span class="hljs-variable">$1</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> no value provided <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>  Dans l'extrait 3, vous avez vu comment √©valuer deux conditions, y compris <b>sinon</b> dans une expression.  Le listing 4 montre comment √©valuer plusieurs conditions de <b>if</b> √† <b>else</b> .  Ceci est utile si vous devez v√©rifier de nombreuses valeurs diff√©rentes. <br><br>  Notez que cet exemple utilise √©galement plusieurs commandes de <b>test</b> . <br><br>  <b>Listing 4</b> .  Exemple avec <b>if then else</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # run this script with one argument # the goal is to find out if the argument is a file or a directory if [ -f $1 ] then echo "$1 is a file" elif [ -d $1 ] then echo "$1 is a directory" else echo "I do not know what \$1 is" fi exit 0</span></span></code> </pre> <br><h3>  ||  et &amp;&amp; </h3><br>  Au lieu d'√©crire des <b>instructions if ...</b> compl√®tes <b>,</b> vous pouvez utiliser les op√©rateurs logiques <b>||</b>  ainsi que <b>&amp;&amp;</b> .  <b>||</b>  est un "OU" logique et ex√©cutera la deuxi√®me partie de l'instruction uniquement si la premi√®re partie n'est pas vraie;  <b>&amp;&amp;</b> est un ¬´ET¬ª logique et ex√©cutera la deuxi√®me partie de l'instruction uniquement si la premi√®re partie est vraie. <br><br>  <b>Consid√©rez ces deux lignes:</b> <br><br><pre> <code class="bash hljs">[ -z <span class="hljs-variable"><span class="hljs-variable">$1</span></span> ] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> no argument provided</code> </pre> <br><pre> <code class="bash hljs">ping -c 1 8.8.8.8 2&gt;/dev/null || <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> node is not available</code> </pre><br>  Le premier exemple v√©rifie si <b>$ 1 est</b> vide.  Si cette v√©rification est correcte (ce qui signifie essentiellement que la commande se termine par le code de sortie 0), la deuxi√®me commande est ex√©cut√©e. <br><br>  Dans le deuxi√®me exemple, la commande <b>ping est</b> utilis√©e pour v√©rifier la disponibilit√© de l'h√¥te. <br>  Cet exemple utilise un "OU" logique pour afficher le texte "le n≈ìud n'est pas disponible" en cas d'√©chec de la commande <b>ping</b> . <br><br>  Vous le trouverez souvent, au lieu de l' <b>instruction</b> conditionnelle <b>if</b> , <b>&amp;&amp;</b> et <b>||</b>  .  Dans l'exercice ci-dessous, vous pouvez vous entra√Æner √† utiliser des instructions conditionnelles en utilisant <b>si ... alors ... else</b> , ou <b>&amp;&amp;</b> et <b>||</b>  . <br><br>  <b>Faites de l'exercice</b> .  Utiliser <b>si ... alors ... sinon</b> <br><br>  Dans cet exercice, vous allez travailler sur un script qui v√©rifie ce qu'est un fichier et ce qu'est un r√©pertoire. <br><br><ol><li>  Lancez l'√©diteur et cr√©ez un script appel√© filechk. </li><li>  Copiez le contenu du Listing 4 dans ce script. </li><li>  Ex√©cutez quelques tests avec lui, tels que <b>./filechk / etc / hosts</b> , <b>./filechck / usr</b> , <b>./filechk fichier-non-existant</b> . </li></ol><br><h2>  Pour boucle </h2><br>  La boucle <b>for</b> est une excellente solution pour le traitement des plages de donn√©es.  Dans le listing 5, vous pouvez voir le premier exemple avec <b>for</b> , o√π la plage est d√©termin√©e et trait√©e alors qu'il y a des valeurs brutes dans cette plage. <br><br>  <b>Listing 5</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # for (( COUNTER=100; COUNTER&gt;1; COUNTER-- )); do echo $COUNTER done exit 0</span></span></code> </pre> <br>  Une boucle <b>for</b> commence toujours par le mot cl√© for, suivie d'une condition qui doit √™tre v√©rifi√©e.  Ceci est suivi du mot cl√© <b>do</b> , suivi des commandes qui doivent √™tre ex√©cut√©es.Si la condition est vraie, la boucle se termine en utilisant le mot cl√© <b>done</b> . <br><br>  Dans l'exemple du Listing 5, vous pouvez voir que la condition est une plage de nombres entre parenth√®ses affect√©e √† la variable COUNTER. <br><br>  <b>Une petite explication</b> <br><br>  √Ä l'int√©rieur <b>((...))</b> les expressions arithm√©tiques sont calcul√©es et leur r√©sultat est renvoy√©.  Par exemple, dans le cas le plus simple, la construction a = $ ((5 + 3)) affectera √† la variable ¬´a¬ª la valeur de l'expression ¬´5 + 3¬ª, ou 8. De plus, les doubles parenth√®ses permettent de travailler avec des variables dans le style du langage C. <br><br>  Tout d'abord, la variable est initialis√©e √† 100 et tant que la valeur est sup√©rieure √† 1, elle est soustraite 1 √† chaque it√©ration. Tant que la condition est vraie, la valeur de la variable $ COUNTER est affich√©e √† l'aide de la commande <b>echo</b> . <br><br>  Dans le Listing 6, vous pouvez voir l'un de mes one-liners pr√©f√©r√©s avec <b>for</b> .  La plage est d√©finie cette fois comme une s√©quence de nombres, commen√ßant √† 100 et atteignant 104. <br><br>  <b>Listing 6</b> <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {100..104}; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ping ‚Äìc 1 192.168.4.<span class="hljs-variable"><span class="hljs-variable">$i</span></span> &gt;/dev/null &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> 192.168.4.<span class="hljs-variable"><span class="hljs-variable">$i</span></span> is up; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>  Remarquez comment la plage est d√©termin√©e: vous sp√©cifiez d'abord le premier nombre, puis deux points et indiquez le dernier nombre de la plage.  De plus, avec <b>pour i dans,</b> pour chacun de ces nombres, la variable <b>i est</b> affect√©e.  Chacun de ces num√©ros est affect√© √† la variable <b>i</b> , puis la commande <b>ping</b> est ex√©cut√©e, o√π l'option <b>-c 1</b> garantit qu'une seule demande est envoy√©e. <br><br>  Le r√©sultat de la commande <b>ping n'est</b> pas pris en compte, donc sa sortie est redirig√©e vers / dev / null.  En fonction de l'√©tat de sortie de la commande <b>ping</b> , une partie de l'expression <b>&amp;&amp;</b> est ex√©cut√©e.  Ainsi, si l'h√¥te est disponible, une ligne s'affiche indiquant qu'il est en cours d'ex√©cution. <br><br><h2>  Comprendre pendant et jusqu'√† </h2><br>  Si l'instruction for que vous venez de lire est utile pour travailler avec des plages d'√©l√©ments, l'instruction while est utile lorsque vous souhaitez suivre quelque chose comme l'accessibilit√© des processus.  Il existe √©galement une instruction <b>until</b> , qui est ex√©cut√©e tant que la condition v√©rifi√©e est fausse.  Dans le Listing 7, vous pouvez lire comment <b>while est</b> utilis√© pour surveiller l'activit√© du processus. <br><blockquote>  Remarque  Je n'ai pas compris ce que fait ce script.  Dans mon cas, CentOS 7 est utilis√© et par d√©faut il n'y a pas de moniteur, bien que le script indique explicitement: <pre>  utilisation: surveiller &lt;nom du processus&gt; </pre>  Quelque part pendant une demi-heure, j'ai googl√© le programme de moniteur pour CetOS, mais je ne l'ai pas trouv√©.  Et g√©n√©ralement, on ne sait pas quel moniteur lat√©ral est ici si ps aux est utilis√©.  En tout cas, je n'ai pas compris ce que fait ce script.  Une grande demande pour aider √† r√©soudre ce probl√®me est d'ajuster le texte et / ou le script. </blockquote>  <b>Listing 7</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # # usage: monitor &lt;processname&gt; while ps aux | grep $1 | grep -v grep &gt; /dev/tty11 do sleep 5 done clear echo your process has stopped logger $1 is no longer present mail -s "process $1 has stopped" root &lt; .</span></span></code> </pre> <br>  Le script du Listing 7 se compose de deux parties.  Tout d'abord, il y a une <b>boucle while</b> .  Deuxi√®mement, il y a tout ce qui doit √™tre fait lorsque la <b>boucle while</b> n'est plus √©valu√©e comme vraie. <br><br>  Le c≈ìur de la <b>boucle while</b> est la commande <b>ps</b> , qui a une valeur de <b>$ 1</b> . <br><br>  Notez l'utilisation de <b>grep -v grep</b> , qui exclut les lignes contenant la <b>commande grep</b> du r√©sultat.  N'oubliez pas que la commande <b>ps</b> inclura tous les processus en cours d'ex√©cution, y compris la <b>commande grep</b> , √† laquelle la sortie de la <b>commande</b> <b>ps</b> est transmise.  Cela peut conduire √† une fausse correspondance positive. <br><br>  La sortie de la commande <b>ps aux</b> est redirig√©e vers / dev / tty11.  Cela vous permet de lire les r√©sultats de tty11 plus tard, si n√©cessaire, mais ils ne sont pas affich√©s par d√©faut. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les instructions </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont suivies des commandes qui doivent √™tre ex√©cut√©es si la condition v√©rifi√©e est vraie. Dans ce cas, c'est la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sleep 5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui suspend l'ex√©cution du script pendant 5 secondes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tant que la condition de l'instruction </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">vraie, la boucle continue de s'ex√©cuter. Si la condition est fausse (ce qui signifie dans ce cas que le processus n'est plus disponible), le cycle s'arr√™te et les commandes qui le suivent peuvent √™tre ex√©cut√©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez √™tre familiaris√© avec toutes ces commandes, sauf la derni√®re. Dans la ligne </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mail -s "le processus $ 1 s'est arr√™t√©" root &lt;.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le message est envoy√© √† l'utilisateur root √† l'aide du syst√®me de messagerie interne, qui s'ex√©cute sur Linux * par d√©faut. Commande de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">messagerie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend comme premier argument le sujet du message sp√©cifi√© avec l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">option -s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* - au moins sur CentOS cela fonctionne par d√©faut. (at. traducteur)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Faites attention √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† la fin de l'√©quipe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habituellement, lorsque vous utilisez la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mail</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en mode interactif, un √©diteur s'ouvre dans lequel vous pouvez √©crire le corps du message. Cet √©diteur est ferm√©, fournissant une ligne qui n'a qu'une p√©riode. Dans cette commande, un point est fourni en redirigeant STDIN. Cela permet au message d'√™tre trait√© sans aucune exigence suppl√©mentaire pour l'activit√© de l'utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">boucle while</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est l'oppos√© de la boucle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">until</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dont un exemple est illustr√© dans le Listing 8.</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jusqu'√† ce que</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©marre une it√©ration qui dure jusqu'√† ce que la condition devienne vraie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le Listing 8, il est utilis√© pour filtrer la sortie de la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par l'occurrence de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui sera le nom d'utilisateur. </font><font style="vertical-align: inherit;">Tant que cette commande n'est pas correcte, l'it√©ration continue. </font><font style="vertical-align: inherit;">Lorsque le nom d'utilisateur est trouv√© dans la sortie utilisateur, l'it√©ration se ferme et apr√®s la boucle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jusqu'√†</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les </font><font style="vertical-align: inherit;">autres commandes sont ex√©cut√©es. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 8</font></font></b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # until users | grep $1 &gt; /dev/null do echo $1 is not logged in yet sleep 5 done echo $1 has just logged in mail -s "$1 has just logged in" root &lt; .</span></span></code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comprendre le cas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La derni√®re boucle d'it√©ration importante est le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> *. L' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction case est</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilis√©e pour √©valuer un certain nombre de valeurs attendues. En particulier, les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©clarations de cas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont importantes dans les scripts de d√©marrage Linux, qui dans les versions pr√©c√©dentes √©taient utilis√©s pour d√©marrer les services. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* - est-ce un cycle?</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction case,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous d√©finissez chaque argument concret que vous attendez, suivi de la commande √† ex√©cuter si cet argument a √©t√© utilis√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'extrait 9, vous pouvez voir l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction case</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui √©tait utilis√©e dans une version ant√©rieure pour ex√©cuter presque tous les services. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 9</font></font></b> <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> start) start;; stop) rm -f <span class="hljs-variable"><span class="hljs-variable">$lockfile</span></span> stop;; restart) restart;; reload) reload;; status) status ;; *) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Usage: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$0</span></span></span><span class="hljs-string"> (start|stop|restart|reload|status)"</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le bo√Ætier</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a plusieurs caract√©ristiques. Vient d'abord la ligne - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cas en s√©quence</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ceci est suivi d'une liste de toutes les valeurs possibles qui doivent √™tre √©valu√©es. Chaque √©l√©ment est ferm√© par un support </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est suivi d'une liste de commandes √† ex√©cuter si un argument sp√©cifique a √©t√© utilis√©. La liste des commandes est ferm√©e par un double point-virgule ;; peut √™tre utilis√© imm√©diatement apr√®s la derni√®re commande et peut √™tre utilis√© sur une ligne distincte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notez √©galement que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s'applique √† tous les autres param√®tres non sp√©cifi√©s pr√©c√©demment. Il s'agit d'un op√©rateur global. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La boucle d'it√©ration de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se termine par l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction esac</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notez que les s√©quences en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont ex√©cut√©es dans l'ordre. </font><font style="vertical-align: inherit;">Lorsque la premi√®re correspondance est √©tablie, l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction case</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'√©value rien. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le cadre de l'√©valuation, des mod√®les similaires au mod√®le peuvent √™tre utilis√©s. </font><font style="vertical-align: inherit;">Ceci est montr√© dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*) une</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√©quence qui correspond √† tout. </font><font style="vertical-align: inherit;">Mais vous pouvez √©galement utiliser des s√©quences telles que start | Start | START) pour correspondre en utilisant un autre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©bogage de scripts dans Bash </font></font></h2><br>     ,   ,    .  ,       <b>bash -x</b> .    ,    ,    ,      . <br><br>   10    <b>bash -x</b> ,    ,   <b>grep</b>  ,    ,       . <br><br><pre> <code class="bash hljs">[root@server1 ~]<span class="hljs-comment"><span class="hljs-comment"># bash -x 319.sh + grep Usage: grep [OPTION]... PATTERN [FILE]... Try 'grep --help' for more information. + users + echo is not logged in yet is not logged in yet + sleep 5</span></span></code> </pre> <br><h2>   </h2><br>     ,    .           ,     . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471242/">https://habr.com/ru/post/fr471242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471226/index.html">Linux a plusieurs visages: comment travailler sur n'importe quelle distribution</a></li>
<li><a href="../fr471228/index.html">Grokay PyTorch</a></li>
<li><a href="../fr471232/index.html">Mon exp√©rience de connexion du LPS331AP √† Omega Onion2</a></li>
<li><a href="../fr471236/index.html">Dosim√®tre pour Seryozha. Partie III. Radiom√®tre national</a></li>
<li><a href="../fr471240/index.html">¬´Bitchy Betty¬ª et interfaces audio modernes: pourquoi parlent-elles d'une voix f√©minine?</a></li>
<li><a href="../fr471244/index.html">Code Rosetta: mesurez la longueur du code dans un grand nombre de langages de programmation, √©tudiez la proximit√© des langages entre eux</a></li>
<li><a href="../fr471248/index.html">Les r√©gulateurs am√©ricains interdisent la distribution du jeton Telegram Open Network</a></li>
<li><a href="../fr471254/index.html">ITMO University Accelerator Startups - D√©but des projets de vision industrielle</a></li>
<li><a href="../fr471256/index.html">Vue.js est bon, mais est-il meilleur qu'angulaire ou r√©actif?</a></li>
<li><a href="../fr471258/index.html">Syst√®me de stockage / chargement de donn√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>