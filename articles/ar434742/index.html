<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ธ ๐ด๏ธ ๐ฒ ุงูุฌุฒุก 2: ุงุณุชุฎุฏุงู ูุญุฏุงุช ุชุญูู Cypress UDB PSoC ูุชูููู ุนุฏุฏ ุงูููุงุทุนุงุช ูู ุทุงุจุนุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ โ๏ธ ๐ ๐ค</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุงููุฑุฉ ุงูุฃุฎูุฑุฉ ุ ุฏุฑุณูุง ุฎูุงุฑ ุชูููุฏ ูุจุถุงุช ููุญุฑูุงุช ุงูุณุงุฆุฑ ุ ุชูุช ุฅุฒุงูุชู ุฌุฒุฆููุง ูู ุงูุจุฑูุงูุฌ ุฅูู ูุณุชูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ. ูู ุญุงูุฉ ุงููุฌุงุญ ุงููุงูู ุ ูุนุฏ ูุฐุง ุจุน...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุฌุฒุก 2: ุงุณุชุฎุฏุงู ูุญุฏุงุช ุชุญูู Cypress UDB PSoC ูุชูููู ุนุฏุฏ ุงูููุงุทุนุงุช ูู ุทุงุจุนุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434742/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vx/mr/gy/vxmrgyrhaaffninezudmxyiex9c.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ุงููุฑุฉ ุงูุฃุฎูุฑุฉ ุ</a> ุฏุฑุณูุง ุฎูุงุฑ ุชูููุฏ ูุจุถุงุช ููุญุฑูุงุช ุงูุณุงุฆุฑ ุ ุชูุช ุฅุฒุงูุชู ุฌุฒุฆููุง ูู ุงูุจุฑูุงูุฌ ุฅูู ูุณุชูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ.  ูู ุญุงูุฉ ุงููุฌุงุญ ุงููุงูู ุ ูุนุฏ ูุฐุง ุจุนุฏู ุงูุญุงุฌุฉ ุฅูู ูุนุงูุฌุฉ ุงูููุงุทุนุงุช ุงูุชู ุชุตู ุฅูู ุชุฑุฏุฏ ูุตู ุฅูู 40 ูููู ูุฑุชุฒ.  ููู ูุฐุง ุงูุฎูุงุฑ ูุฏูู ุนุฏุฏ ูู ุงูุนููุจ ุงููุงุถุญุฉ.  ุฃููุงู ุ ุงูุชุณุงุฑุน ุบูุฑ ูุนุชูุฏ ููุงู.  ุซุงููุงู ุ ุฅู ุฏูุฉ ุชุฑุฏุฏุงุช ุงูุฎุทูุฉ ุงููุณููุญ ุจูุง ูู ูุฐุง ุงูุญู ูู ูุฆุงุช ูุฑุชุฒ (ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงููููู ุชูููุฏ ุชุฑุฏุฏุงุช ุชุจูุบ 40.000 ูุฑุชุฒ ู 39966 ูุฑุชุฒ ุ ููู ูู ุงููุณุชุญูู ุชูููุฏ ุชุฑุฏุฏุงุช ุฐุงุช ุญุฌู ุจูู ูุงุชูู ุงููููุชูู). <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ุชุณุฑูุน ุงูุชูููุฐ </h2><br>  ูู ูู ุงููููู ุงููุถุงุก ุนูู ุงูุนููุจ ุงููุดุงุฑ ุฅูููุง ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช UDB ููุณูุง ุฏูู ุชุนููุฏ ุงููุธุงูุ  ููุง ุจูุง  ููุจุฏุฃ ุจุงูุฃุตุนุจ - ูุน ุงูุชุณุงุฑุน.  ุชุชู ุฅุถุงูุฉ ุงูุชุณุงุฑุน ูู ุจุฏุงูุฉ ูููุงูุฉ ุงููุณุงุฑ.  ุฃููุงู ุ ุฅุฐุง ุชู ุชุทุจูู ูุจุถุงุช ุนุงููุฉ ุงูุชุฑุฏุฏ ุนูู ุงูููุฑ ุนูู ูุญุฑู ุงูุณุงุฆุฑ ุ ูุณูุชุทูุจ ุฐูู ุชูุงุฑูุง ุฃูุจุฑ ูุจุฏุก ุงูุชุดุบูู.  ุงุฑุชูุงุน ุงููุณููุญ ุจู ุงูุญุงูู ูู ุงูุชุฏูุฆุฉ ูุงูุถูุถุงุก ุ ูุฐูู ููู ุงูุฃูุถู ููุญุฏ ููู.  ูููู ุจุนุฏ ุฐูู ูููู ูููุญุฑู ุชุฎุทู ุงูุฎุทูุงุช ูู ุงูุจุฏุงูุฉ.  ูุฐูู ูู ุงูุฃูุถู ุชุณุฑูุน ุงููุญุฑู ุจุณูุงุณุฉ.  ุซุงููุงู ุ ุฅุฐุง ุชููู ุงูุฑุฃุณ ุงูุซููู ูุฌุฃุฉ ุ ูุฅูู ูุฎุชุจุฑ ุนุงุจุฑูู ูุฑุชุจุทูู ุจุงููุตูุฑ ุงูุฐุงุชู.  ููุฌุงุช ูุฑุฆูุฉ ุนูู ุงูุจูุงุณุชูู.  ูุฐูู ุ ููู ุงูุถุฑูุฑู ุจุณูุงุณุฉ ููุณ ููุท ูุชูุฑูู ุ ูููู ุฃูุถุง ูุฅููุงู ุงูุฑุฃุณ.  ุจุดูู ุชูููุฏู ุ ูุชู ุชูุซูู ุฑุณู ุจูุงูู ูุณุฑุนุฉ ุงููุญุฑู ุนูู ุดูู ุดุจู ููุญุฑู.  ูููุง ููู ุฌุฒุก ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตุฏุฑ ูุจุฑูุงูุฌ Marlin ุงูุซุงุจุช: <br><br><img src="https://habrastorage.org/webt/wm/gg/ce/wmggcetcc0vy5tfgs3xsr2ewwoc.png"><br><br>  ูู ุฃุญุงูู ุญุชู ูุนุฑูุฉ ูุง ุฅุฐุง ูุงู ูู ุงููููู ุชูููุฐ ุฐูู ุจุงุณุชุฎุฏุงู UDB.  ูุฐุง ูุฑุฌุน ุฅูู ุญูููุฉ ุฃู ููุงู ููุนูุง ุขุฎุฑ ูู ุงูุชุณุงุฑุน ูู ุงูููุถุฉ ุงูุขู: ููุณ ุดุจู ููุญุฑู ุ ูููู ููุญูู S-Curve.  ุฌุฏูููู ูุดุจู ูุฐุง: <br><br><img src="https://habrastorage.org/webt/rs/hy/q9/rshyq94_sz6et-lgsbrpprdmyks.png"><br><br>  ูุฐุง ุจุงูุชุฃููุฏ ููุณ ูู ุฃุฌู UDB.  ุงุณุชุณููุ  ูุง ุนูู ุงูุงุทูุงู!  ููุฏ ูุงุญุธุช ุจุงููุนู ุฃู UDB ูุง ูููู ุจุชุทุจูู ูุงุฌูุฉ ุฃุฌูุฒุฉ ุ ููู ูุณูุญ ูู ุจุจุณุงุทุฉ ุจููู ุฌุฒุก ูู ุงูููุฏ ูู ุงูุจุฑูุงูุฌ ุฅูู ูุณุชูู ุงูุจุฑูุงูุฌ ุงูุซุงุจุช.  ุฏุน ููู ุงูุชุนุฑูู ูุญุณุจ ุงููุนุงูุฌ ุงููุฑูุฒู ุ ููุง ูุฒุงู ุชุดููู ูุจุถุงุช ุงูุฎุทูุฉ ูุคุฏู UDB.  ุงููุนุงูุฌ ุงููุฑูุฒู ูุฏูู ุงููุซูุฑ ูู ุงูููุช ูุฅุฌุฑุงุก ุงูุนูููุงุช ุงูุญุณุงุจูุฉ.  ุณุชุณุชูุฑ ูููุฉ ุฅุฒุงูุฉ ุงูุงููุทุงุนุงุช ุงููุชูุฑุฑุฉ ุจุฃูุงูุฉ ูุงุฆูุฉ ุ ููู ูุฎุทุท ุฃุญุฏ ูููู ุงูุนูููุฉ ุชูุงููุง ุฅูู ูุณุชูู ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ. <br><br>  ุจุทุจูุนุฉ ุงูุญุงู ุ ุณูู ุชุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ ููู ุงูุชุนุฑูู ูู ุงูุฐุงูุฑุฉ ุ ูุณูููู UDB ุจุงูุชูุงุท ุงูุจูุงูุงุช ูู ููุงู ุจุงุณุชุฎุฏุงู DMA.  ูููู ูุง ููุฏุงุฑ ุงูุฐุงูุฑุฉ ุงููุทููุจุฉุ  ูุญุชุงุฌ ูููููุชุฑ ูุงุญุฏ ุฅูู 200 ุฎุทูุฉ.  ุงูุขู ูุน ุชุฑููุฒ 24 ุจุช ุ ูุฐุง 600 ุจุงูุช ููู 1 ููู ูู ุญุฑูุฉ ุงูุฑุฃุณ!  ูุฑุฉ ุฃุฎุฑู ุ ุชุฐูุฑ ุนุฏู ุงููุทุงุน ูุชูุฑุฑ ููุบุงูุฉ ุ ูููู ูุง ูุฒุงู ุงููุทุงุน ูุณุชูุฑ ูููู ูู ุดูุก ูู ุดุธุงูุงุ  ููุณ ุญูุง!  ุงูุญูููุฉ ูู ุฃู ุขููุฉ DMA ุงูุฎุงุตุฉ ุจู PSoC ุชุนุชูุฏ ุนูู ุงููุงุตูุงุช.  ุจุนุฏ ุชูููุฐ ุงููููุฉ ูู ูุงุตู ูุงุญุฏ ุ ุชูุชูู ูุญุฏุฉ ุงูุชุญูู DMA ุฅูู ุงูุชุงูู.  ูููุฐุง ุ ุนูู ุทูู ุงูุณูุณูุฉ ุ ููููู ุงุณุชุฎุฏุงู ุงููุซูุฑ ูู ุงููุงุตูุงุช.  ููุถุญ ูุฐุง ูุน ุจุนุถ ุงูุณุญุจ ูู ุงููุซุงุฆู ุงูุฑุณููุฉ: <br><br><img src="https://habrastorage.org/webt/ju/hv/6b/juhv6bqptp3uagog5bfgxlmxw0q.png"><br><br>  ูู ุงููุงูุน ุ ูููู ุฃูุถูุง ุงุณุชุฎุฏุงู ูุฐู ุงูุขููุฉ ุนู ุทุฑูู ุฅูุดุงุก ุณูุณูุฉ ูู ุซูุงุซุฉ ูุงุตูุงุช: <br><br><table style=";text-align:right;direction:rtl"><tbody><tr><th>  ุฑูู </th><th>  ุงูุชูุณูุฑ </th></tr><tr><td>  1 </td><td>  ูู ุงูุฐุงูุฑุฉ ุฅูู FIFO ูุน ุฒูุงุฏุฉ ุงูุนููุงู.  ูุดูุฑ ุฅูู ูุณู ุจููู ุชุนุฑูู ุงูุชุณุงุฑุน. </td></tr><tr><td>  2 </td><td>  ูู ุงูุฐุงูุฑุฉ ุฅูู FIFO ุฏูู ุฒูุงุฏุฉ ุงูุนููุงู.  ูุฑุณู ูู ูู ููุช ูููุณ ุงููููุฉ ูู ุงูุฐุงูุฑุฉ ูุณุฑุนุฉ ุซุงุจุชุฉ. </td></tr><tr><td>  3 </td><td>  ูู ุงูุฐุงูุฑุฉ ุฅูู FIFO ูุน ุฒูุงุฏุฉ ุงูุนููุงู.  ูุดูุฑ ุฅูู ูุณู ุจููู ุชุนุฑูู ุงููุจุญ. <br></td></tr></tbody></table><br>  ุงุชุถุญ ุฃู ุงููุณุงุฑ ุงูุฑุฆูุณู ููุตูู ูู ุงูุฎุทูุฉ 2 ุ ูููุงู ููุณ ุงููููุฉ ุชุณุชุฎุฏู ูุนูููุง ุ ูุงูุชู ุชุญุฏุฏ ุงูุณุฑุนุฉ ุงูุซุงุจุชุฉ.  ุงุณุชููุงู ุงูุฐุงูุฑุฉ ููุณุช ูุจูุฑุฉ.  ูู ุงููุงูุน ุ ูููู ุชูุซูู ุงููุงุตู ุงูุซุงูู ูุนูููุง ุจูุงุณุทุฉ ุงุซููู ุฃู ุซูุงุซุฉ ูู ุงููุงุตูุงุช.  ูุฐุง ูุฑุฌุน ุฅูู ุญูููุฉ ุฃู ุงูุญุฏ ุงูุฃูุตู ูุทูู ุงูุถุฎ ุ ููููุง ูู TRM ุ ูููู ุฃู ูููู 64 ูููู ุจุงูุช (ุณูููู ุงูุชุนุฏูู ุฃูู).  ูุฐุง ูู ุ 32767 ูููุฉ.  ูุฐุง ูู 200 ุฎุทูุฉ ููู ูููููุชุฑ ุณูู ุชุชูุงูู ูุน ูุณุงุฑ 163 ูููููุชุฑ.  ูุฏ ุชุถุทุฑ ุฅูู ุฅูุดุงุก ุฌุฒุก ูู ุฌุฒุฃูู ุฃู ุซูุงุซุฉ ุฃุฌุฒุงุก ุ ุงุนุชูุงุฏูุง ุนูู ุงููุณุงูุฉ ุงููุตูู ุงูุชู ูููู ุฃู ููุทุนูุง ุงููุญุฑู ูู ููุช ูุงุญุฏ. <br><br>  ููุน ุฐูู ุ ูุญูุธ ุงูุฐุงูุฑุฉ (ูุญุณุงุจ ูุชู UDB) ุ ุฃูุชุฑุญ ุงูุชุฎูู ุนู ูุชู DatapPath ุฐุงุช 24 ุจุช ุ ูุงูุชุญูู ุฅูู ุฃูุซุฑ ุงูุชุตุงุฏุง ูู 16 ุจุช. <br><br>  <b>ููุฐุง</b>  <b>ุงูุงูุชุฑุงุญ ุงูุฃูู ูููุฑุงุฌุนุฉ.</b> <b><br><br></b>  <b>ูุชู ุฅุนุฏุงุฏ ุงููุตูููุงุช ูู ุงูุฐุงูุฑุฉ ุงูุชู ุชุดูุฑ ูุฏุฉ ุงูุฎุทูุงุช.</b>  <b>ุนูุงูุฉ ุนูู ุฐูู ุ ุชูุชูู ูุฐู ุงููุนูููุงุช ุฅูู UDB ุจุงุณุชุฎุฏุงู DMA.</b>  <b>ูุชู ุชุดููุฑ ุงูููุทุน ุงููุณุชููู ุจูุงุณุทุฉ ูุฌููุนุฉ ูู ุนูุตุฑ ูุงุญุฏ ุ ูุชูุฉ DMA ูุง ุชุฒูุฏ ุงูุนููุงู ุ ูุงุฎุชูุงุฑ ุงูุนูุตุฑ ููุณู ูู ูู ููุช.</b>  <b>ูุชู ุชูุตูู ุฃูุณุงู ุงูุชุณุงุฑุน ูุงููุณุชูููุฉ ูุงููุฑุงูู ุจุงููุณุงุฆู ุงููุชุงุญุฉ ูู ุฌูุงุฒ ุงูุชุญูู DMA.</b> <br><br><h2 style=";text-align:right;direction:rtl">  ุบุฑุงูุฉ ูุญู ุงููุฏู ุงููุชูุณุท </h2><br>  ุงูุขู ุณูู ููุธุฑ ูู ููููุฉ ุงูุชุบูุจ ุนูู ูุดููุฉ ุญุจูุจุงุช ุงูุชุฑุฏุฏ.  ุจุงูุทุจุน ุ ูู ูููู ูู ุงููููู ุถุจุทู ุจุงูุถุจุท.  ูููู ุ ูู ุงููุงูุน ุ ูุฅู "ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ" ุงูุฃุตูู ุฃูุถุง ูุง ูููู ุฃู ุชูุนู ูุฐุง.  ุจุฏูุงู ูู ุฐูู ุ ูุณุชุฎุฏููู ุฎูุงุฑุฒููุฉ Bresenham.  ูุชู ุฅุถุงูุฉ ุชุฃุฎูุฑ ููุงุณ ูุงุญุฏ ุฅูู ุจุนุถ ุงูุฎุทูุงุช.  ูุชูุฌุฉ ูุฐูู ุ ูุตุจุญ ูุชูุณุท โโุงูุชุฑุฏุฏ ูุชูุณุท โโุ ุจูู ูููุฉ ุฃุตุบุฑ ูุฃูุจุฑ.  ุนู ุทุฑูู ุถุจุท ูุณุจุฉ ุงููุชุฑุงุช ุงูุนุงุฏูุฉ ูุงูููุชุฏุฉ ุ ููููู ุชุบููุฑ ูุชูุณุท โโุงูุชุฑุฏุฏ ุจุณูุงุณุฉ.  ุฅุฐุง ูู ูุชู ุถุจุท ุณุฑุนุชูุง ุงูุขู ูู ุฎูุงู ุณุฌู ุงูุจูุงูุงุช ุ ูููู ูุชู ููููุง ุนุจุฑ FIFO ุ ููุชู ุชุนููู ุนุฏุฏ ุงููุจุถุงุช ุนููููุง ูู ุฎูุงู ุนุฏุฏ ุงููููุงุช ุงููุฑุณูุฉ ุนุจุฑ DMA ุ ูุชู ุชุญุฑูุฑ ููุง ุณุฌูุงุช ุงูุจูุงูุงุช ูู UDB.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุชู ุฃูุถูุง ุฅุตุฏุงุฑ ุฅุญุฏู ุงูุจุทุงุฑูุงุช ุ ุงูุชู ุชุนุฏ ุนุฏุฏ ุงููุจุถุงุช.  ููุง ุณูู ูุจูู ุจุนุถ PWM ุนูููุง. <br><br>  ุนุงุฏุฉ ุ ALUs ููุงุฑูุฉ ูุชุนููู ุงูุณุฌูุงุช ูุน ููุณ ุงูููุฑุณ.  ุนูุฏูุง ูุญุชูู ุฃุญุฏ ุงูุณุฌูุงุช ุนูู ููุฑุณ 0 ูุงูุขุฎุฑ ูุญุชูู ุนูู 1 ุ ูุง ูููู ุชูููุฐ ูู ุฅุตุฏุงุฑ ูู ุงูุนูููุฉ.  ููููู ุชูููุช ูู ุชุฌููุน ูุขุณ ูู ุงูุณุฌูุงุช ุงูุชู ูููู ูู ุฎูุงููุง ุงูููุงู PWM.  ุงุชุถุญ ููุง ูู ููุถุญ ูู ุงูุดูู. <br><br><img src="https://habrastorage.org/webt/nc/yv/vq/ncyvvqcqptj3lm4an82idlrrl-c.png"><br><br>  ุนูุฏ ุงุณุชููุงุก ุงูุดุฑุท A0 &lt;D1 ุ ุณูุถูู ุฅููุงุนูุง ุฅุถุงูููุง ูุทูู ุงููุจุถ ุงููุญุฏุฏ.  ุนูุฏูุง ูุง ูุชู ุงูููุงุก ุงูุดุฑุท ุ ููุญู ูู. <br><br><h2 style=";text-align:right;direction:rtl">  ุญุตุงู ูุฑูู ูู ุธู ุธุฑูู ุทุจูุนูุฉ </h2><br>  ูุฐูู ุ ูุจุฏุฃ ูู ุชุนุฏูู ุงููุชูุฉ ุงููุทูุฑุฉ ูู UDB ุ ูุน ูุฑุงุนุงุฉ ุงููููู ุงูุฌุฏูุฏ.  ุงุณุชุจุฏุงู ุนูู ุจุช Datapath: <br><br><img src="https://habrastorage.org/webt/cj/-m/ae/cj-mae3coaxgzro0er5mkraun4q.png"><br><br>  ุณูุญุชุงุฌ ุฅูู ุงููุซูุฑ ูู ุนูููุงุช ุงูุฎุฑูุฌ ูู Datapath ุฃูุซุฑ ูู ุงููุฑุฉ ุงูุฃุฎูุฑุฉ. <br><br><img src="https://habrastorage.org/webt/ua/td/hn/uatdhnswe_uzmqinll0wyhsyifg.png"><br><br>  ุงูููุฑ ุงููุฒุฏูุฌ ุนูููุง ุ ููุญู ูุฑู ุงูุชูุงุตูู: <br><br><img src="https://habrastorage.org/webt/vq/3p/24/vq3p24frqv0uiumytbvn-ewhi1w.png"><br><br>  ููุงู ุงููุฒูุฏ ูู ุงูุฃุฑูุงู ูููุชุบูุฑ <b>ุงูุฏููุฉ</b> ุ ูุง ุชูุณู ุฃู ุชุชุตู ุงููุฏูู!  ูู ุงูุฅุตุฏุงุฑ ุงููุฏูู ุ ูุงู ููุงู 0 ุซุงุจุช. <br><br><img src="https://habrastorage.org/webt/0l/dm/fy/0ldmfyci2byicjdsksvkdkg8k04.png"><br><br>  ุงูุฑุณู ุงูุจูุงูู ุงูุชูุงู ุงูุฃูุชููุงุชูู ุญุตูุช ุนูู ูุฐุง ุงููุญู: <br><br><img src="https://habrastorage.org/webt/hb/5u/nq/hb5unqu_fmfc6sd9k7m3_x0wr7s.png"><br><br>  ูุญู ูู ุญุงูุฉ <b>ุงูุฎููู</b> ุจูููุง FIFO1 ูุงุฑุบ.  ุจุงูููุงุณุจุฉ ุ ุงูุนูู ูุน FIFO1 ูููุณ FIFO0 ูู ูุชูุฌุฉ ูุชุดููู ุณูููุชูุฑ.  ูุณุชุฎุฏู ุงูุณุฌู A0 ูุชูููุฐ PWM ุ ูุฐูู ูุชู ุชุญุฏูุฏ ุนุฑุถ ุงููุจุถุฉ ุจูุงุณุทุฉ ุงูุณุฌู A1.  ููุง ูููููู ุชูุฒููู ุฅูุง ูู FIFO1 (ุฑุจูุง ููุงู ุทุฑู ุณุฑูุฉ ุฃุฎุฑู ุ ูููููุง ุบูุฑ ูุนุฑููุฉ ูู).  ูุฐูู ุ ุชููู DMA ุจุชุญููู ุงูุจูุงูุงุช ุฅูู FIFO1 ุชูุงููุง ุ ููู ุจุงูุชุญุฏูุฏ ุงูุญุงูุฉ <b>"ุบูุฑ ุงููุงุฑุบุฉ"</b> ูู FIFO1 ุงูุชู ุชุฎุฑุฌ ูู ุญุงูุฉ <b>ุงูุฎููู</b> . <br><br>  ALU ูู ุญุงูุฉ <b>IDLE</b> ูุจุทู ุงูุชุณุฌูู A0: <br><br><img src="https://habrastorage.org/webt/1r/i5/-i/1ri5-iydlu00cfobufepmiaqucg.png"><br><br>  ูุนุฏ ุฐูู ุถุฑูุฑููุง ุญุชู ูุจุฏุฃ ุชุดุบูู ุงูุนูู ุฏุงุฆููุง ูู ุงูุจุฏุงูุฉ ุนูุฏ ุจุฏุก ุชุดุบูู PWM. <br>  ููู ุงูุจูุงูุงุช ุฏุฎูุช ูู FIFO.  ููุชูู ุงูุฌูุงุฒ ุฅูู ุญุงูุฉ <b>LoadData</b> : <br><br><img src="https://habrastorage.org/webt/3v/rf/dx/3vrfdxwme_jw6m69bwrpybhiots.png"><br><br>  ูู ูุฐู ุงูุญุงูุฉ ุ ุชููู ALU ุจุชุญููู ุงููููุฉ ุงูุชุงููุฉ ูู FIFO ูู ุชุณุฌูู A1.  ุนูู ุทูู ุงูุทุฑูู ุ ูู ุฃุฌู ุนุฏู ุฅูุดุงุก ุญุงูุงุช ุบูุฑ ุถุฑูุฑูุฉ ุ ูุชู ุฒูุงุฏุฉ ูููุฉ ุงูุนุฏุงุฏ A0 ุ ูุงูุชู ุชุณุชุฎุฏู ููุนูู ูุน PWM ุ: <br><br><img src="https://habrastorage.org/webt/t4/ki/je/t4kijee95z-kbmn1n3ikcgtc9qk.png"><br><br>  ุฅุฐุง ูู ุชุตู ุงูุนุฏุงุฏ A0 ุจุนุฏ ุฅูู ุงููููุฉ D0 (ุฃู ุ ูุชู ุชุดุบูู ุงูุดุฑุท A0 &lt;D0 ุ ููุง ูุคุฏู ุฅูู ุธููุฑ ุนูุงูุฉ NoNeedReloadA0) ุ ูุฅููุง ููุชูู ุฅูู ุงูุญุงูุฉ <b>ุงููุงุญุฏุฉ</b> .  ุฎูุงู ุฐูู ุ ูุฅู ุงูุฏููุฉ ูู <b>ClearA0</b> . <br><br>  ูู ุญุงูุฉ <b>ClearA0 ุ ุชููู</b> ALU ุจุจุณุงุทุฉ <b>ุจุชุญุฏูุฏ</b> ูููุฉ A0 ุ ูุจุฏุก ุฏูุฑุฉ PWM ุฌุฏูุฏุฉ: <br><br><img src="https://habrastorage.org/webt/0_/pj/ah/0_pjahunjhl34izkpv5k9lplxem.png"><br><br>  ุจุนุฏูุง ูุฐูุจ ุงูุฌูุงุฒ ุฃูุถูุง ุฅูู ุญุงูุฉ <b>ูุงุญุฏุฉ</b> ุ ููุงุฒ ูุงุญุฏ ููุท ูุงุญููุง. <br><br>  <b>ูุงุญุฏ</b> ูุฃููู ุจุงููุณุจุฉ ููุง ูู ุงูุฅุตุฏุงุฑ ุงููุฏูู ูู ุงูุฌูุงุฒ.  ALU ููู ูุง ูุคุฏู ุฃู ูุธุงุฆู. <br><br>  ูููุฐุง - ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ุฅูุดุงุก ูุญุฏุฉ ุนูุฏ ุฅุฎุฑุงุฌ <b>Out_Step</b> (ููุง ูุงู ุงููุญุณู ูุนูู ุจุดูู ุฃูุถู ุนูุฏูุง ูุชู ุฅูุชุงุฌ ุงููุญุฏุฉ ุญุณุจ ุงูุญุงูุฉ ุ ููุฏ ุชู ุงูุชุดุงู ุฐูู ุจุดูู ุชุฌุฑูุจู). <br><br><img src="https://habrastorage.org/webt/aq/mj/ml/aqmjmluzxutxzq_caddtls15hfc.png"><br><br>  ูุญู ูู ูุฐู ุงูุญุงูุฉ ุญุชู ุชุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุนุฏุงุฏ ุฐู ุงูุณุจุนุฉ ุจุชุงุช ุงููุนุฑูู ุจุงููุนู ููุง ุฅูู ุงูุตูุฑ.  ููู ุฅุฐุง ุฎุฑุฌูุง ูู ูุฐู ุงูุญุงูุฉ ูู ููุช ูุจูุฑ ุนูู ุทุฑูู ูุงุญุฏ ุ ุงูุขู ูููู ุฃู ูููู ููุงู ุทุฑููุงู: ุชูุฌูู ูุชุฃุฎูุฑ ุงูููุฒ. <br><br><img src="https://habrastorage.org/webt/53/fk/qc/53fkqcxnlvsf52sxzb8e1ijnpkk.png"><br><br>  ุณูู ูุฏุฎู ูู ุญุงูุฉ ExtraTick ุฅุฐุง ุชู <b>ุชุนููู</b> ุนูุงูุฉ <b>AddCycle</b> ุ ูุงูุชู ุชู ุชุนููููุง ููููุงุก ุจุงูุดุฑุท A0 &lt;D1.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุง ุชููู ALU ุจุฃู ุฅุฌุฑุงุกุงุช ูููุฏุฉ.  ุฅููุง ููุท ุชุณุชุบุฑู ุฏูุฑุฉ ูุงุญุฏุฉ ููููุฒ ููุชุฑุฉ ุฃุทูู.  ุนูุงูุฉ ุนูู ุฐูู ุ ุชุชูุงูู ุฌููุน ุงููุณุงุฑุงุช ูู ุญุงูุฉ <b>ุงูุชุฃุฎูุฑ</b> . <br><br>  ูุฐุง ุงูุดุฑุท ูููุณ ูุฏุฉ ุงููุจุถ.  ูุชู ุชูููู ุณุฌู A1 (ูุชู ุชุญูููู ุฃุซูุงุก ุชุญูููู ูู ุญุงูุฉ <b>ุงูุชุญููู</b> ) ุญุชู ูุตู ุฅูู ุงูุตูุฑ. <br><br><img src="https://habrastorage.org/webt/bi/ct/jt/bictjtwgqikkvuz4pqmp7owacii.png"><br><br>  ุนูุงูุฉ ุนูู ุฐูู ุ ุงุนุชูุงุฏูุง ุนูู ูุง ุฅุฐุง ูุงูุช ููุงู ุจูุงูุงุช ุฅุถุงููุฉ ูู FIFO ุฃู ูุง ุ ุณููุชูู ุงูุฌูุงุฒ ุฅูู ุงูุฏููุนุฉ ุงูุชุงููุฉ <b>ูุชุญููููุง</b> ุฃู <b>ุงูุฎููู</b> .  ุฏุนููุง ููุธุฑ ุฅูู ูุฐุง ููุณ ูู ุงูุดูู (ููุงู ุณูุงู ุทูููุฉ ุ ูู ุดูุก ุณูููู ุตุบูุฑูุง) ุ ูููู ูู ุดูู ุฌุฏูู ุ ุงููุฑ ููุฑูุง ูุฒุฏูุฌูุง ุนูู ุญุงูุฉ <b>ุงูุชุฃุฎูุฑ</b> : <br><br><img src="https://habrastorage.org/webt/bb/cr/dq/bbcrdq1jfhxret5vbaoexfsr-iq.png"><br><br>  ูุฎุฑุฌ ุงูุขู ูู UDB.  ููุฏ ููุช ุจุชุญููู ุนูุงูุฉ ุงููุฌูุฏ ูู ุญุงูุฉ <b>ุงูุฎููู</b> ุฅูู ููุงุฑูุฉ ุบูุฑ ูุชุฒุงููุฉ (ูู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู ูุงู ููุงู ูุดุบู ุชู ุถุจุทู ูุฅุนุงุฏุฉ ุชุนูููู ูู ุญุงูุงุช ูุฎุชููุฉ) ุ ูุธุฑูุง ูุฃู ุงููุญุณู ุฃุธูุฑ ุฃูุถู ูุชูุฌุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชูุช ุฅุถุงูุฉ ุนูู <b>Hungry</b> ุ ููุง ูุดูุฑ ุฅูู ูุญุฏุฉ DMA ุจุฃููุง ูุณุชุนุฏุฉ ูุงุณุชูุจุงู ุงูุจูุงูุงุช.  ุงูุชูู ุงูุฃูุฑ ุนูู ุงูุนูู <b>"FIFO1 ููุณุช ูุฒุฏุญูุฉ"</b> .  ูุธุฑูุง ูุฃูู ุบูุฑ ูุฒุฏุญู ุ ูููู ูู DMA ุชุญููู ูููุฉ ุจูุงูุงุช ุฃุฎุฑู ููุงู. <br><br><img src="https://habrastorage.org/webt/w8/ea/b-/w8eab-2dwdxvtvyr3hfukjrev9w.png"><br><br>  ุนูู ุงูุฌุฒุก ุงูุชููุงุฆู - ูุฐุง ูู ุดูุก. <br><br>  ุฅุถุงูุฉ ูุชู DMA ุฅูู ูุฎุทุท ุงููุดุฑูุน ุงูุฑุฆูุณู.  ูู ุงูููุช ุงูุญุงูู ุ ุจุฏุฃุช ูู ููุงุทุนุฉ ุฅุดุงุฑุงุช ุฅููุงุก DMA ุ ูููู ููุณ ุญูููุฉ ุฃู ูุฐุง ุตุญูุญ.  ุนูุฏ ุงูุชูุงู ุนูููุฉ ุงููุตูู ุงููุจุงุดุฑ ุฅูู ุงูุฐุงูุฑุฉ ุ ููููู ุจุฏุก ุนูููุฉ ุฌุฏูุฏุฉ ุชุชุนูู ุจุงูุฌุฒุก ููุณู ุ ูููู ูุง ููููู ุงูุจุฏุก ูู ููุก ูุนูููุงุช ุญูู ุงููุทุงุน ุงูุฌุฏูุฏ.  FIFO ูุง ูุฒุงู ูุฏูู ุซูุงุซุฉ ุฅูู ุฃุฑุจุนุฉ ุนูุงุตุฑ.  ูู ูุฐุง ุงูููุช ุ ูุง ูุฒุงู ูู ุงููุณุชุญูู ุฅุนุงุฏุฉ ุจุฑูุฌุฉ ุงูุณุฌูุงุช D0 ู D1 ูููุชูุฉ ุงููุงุฆูุฉ ุนูู UDB ุ ูุง ุชุฒุงู ููุงู ุญุงุฌุฉ ููุชุดุบูู.  ูุฐูู ุ ูู ุงููููู ุฃู ุชุชู ุฅุถุงูุฉ ุงูููุงุทุนุงุช ุจูุงุกู ุนูู ูุฎุฑุฌุงุช <b>Out_Idle ูุงุญููุง</b> .  ููู ูุฐุง ุงููุทุจุฎ ูู ูุนุฏ ูุชุนูููุง ุจุจุฑูุฌุฉ UDB block ุ ูุฐูู ุณูุฐูุฑู ููุท. <br><br><img src="https://habrastorage.org/webt/4o/g7/y2/4og7y21diqgqr6qn7_iehukiqho.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุชุฌุงุฑุจ ุงูุจุฑูุฌูุงุช </h2><br>  ููุฐ ุงูุขู ูู ุดูุก ุบูุฑ ูุนุฑูู ุ ูู ููุชุจ ุฃู ูุธุงุฆู ุฎุงุตุฉ.  ุฌููุน ุงูุดููุงุช ุณูุชู ุชูููุฐูุง "ุนูู ุงูุฌุจูุฉ".  ุซู ุ ุจูุงุกู ุนูู ุงูุชุฌุงุฑุจ ุงููุงุฌุญุฉ ุ ูููู ูุชุงุจุฉ ูุธุงุฆู API.  ููุฐุง  ูุฌุนู <b>ุงูุฑุฆูุณูุฉ ()</b> ูุธููุฉ ุงูุญุฏ ุงูุฃุฏูู.  ุฅูู ุจุจุณุงุทุฉ ูููู ุจุฅุนุฏุงุฏ ุงููุธุงู ููุณุชุฏุนู ุงูุงุฎุชุจุงุฑ ุงููุญุฏุฏ. <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ CyGlobalIntEnable; <span class="hljs-comment"><span class="hljs-comment">/* Enable global interrupts. */</span></span> <span class="hljs-comment"><span class="hljs-comment">// isr_1_StartEx(StepperFinished); StepperController_X_Start(); StepperController_Y_Start(); StepperController_Z_Start(); StepperController_E0_Start(); StepperController_E1_Start(); // TestShortSteps(); TestWithPacking (); for(;;) { }</span></span></code> </pre> <br>  ุฏุนููุง ูุญุงูู ุฅุฑุณุงู ุญุฒูุฉ ูู ุงููุจุถุงุช ุนู ุทุฑูู ุงุณุชุฏุนุงุก ูุธููุฉ ุ ูุงูุชุญูู ูู ุญูููุฉ ุฅุฏุฎุงู ูุจุถ ุฅุถุงูู.  ุงุณุชุฏุนุงุก ุงููุธููุฉ ุจุณูุท: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">TestShortSteps();</code> </pre><br>  ููู ุงูุฌุณู ูุญุชุงุฌ ุงูู ุชูุณูุฑ. <div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุณุฃูุฏู ุงููุธููุฉ ุจุฃููููุง ุฃููุงู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">void TestShortSteps() { //   ,   //      //   ,  DMA    !!! //    ,   !!! StepperController_X_SingleVibrator_WritePeriod (6); //     //    โ   CY_SET_REG16(StepperController_X_Datapath_1_D0_PTR, 4); CY_SET_REG16(StepperController_X_Datapath_1_D1_PTR, 2); //         . //         static const uint16 steps[] = { 0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001, 0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001,0x0001 }; //  DMA  ,      uint8 channel = DMA_X_DmaInitialize (sizeof(steps[0]),1,HI16(steps),HI16(StepperController_X_Datapath_1_F1_PTR)); CyDmaChRoundRobin (channel,true); //       ,       uint8 td = CyDmaTdAllocate(); //       .  ,    . CyDmaTdSetConfiguration(td, sizeof(steps), CY_DMA_DISABLE_TD, TD_INC_SRC_ADR | TD_AUTO_EXEC_NEXT); //       CyDmaTdSetAddress(td, LO16((uint32)steps), LO16((uint32)StepperController_X_Datapath_1_F1_PTR)); //      CyDmaChSetInitialTd(channel, td); //         CyDmaChEnable(channel, 1); }</code> </pre><br></div></div><br>  ุงูุขู ุงููุธุฑ ูู ุงูุฃุฌุฒุงุก ุงููููุฉ. <br><br>  ุฅุฐุง ูุงู ุทูู ุงูุฌุฒุก ุงูููุฌุจ ูู ุงููุจุถุฉ ูุณุงูู 92 ุฏูุฑุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ุ ููู ูุชููู ุฐุจุฐุจุงุช ุงูุฐูู ูู ุชูููุฒ ูุง ุฅุฐุง ูุงู ููุงู ุฏูุฑุฉ ููุฑุฏุฉ ูู ุงูุฌุฒุก ุงูุณูุจู ุฃู ูุง.  ุงููููุงุณ ูู ูููู ูู ููุณู.  ูู ุงูุถุฑูุฑู ุฌุนู ุงูุฌุฒุก ุงูุฅูุฌุงุจู ุฃูุตุฑ ูุง ูููู ุญุชู ุชููู ุงููุจุถุฉ ุงููููุฉ ูุงุจูุฉ ููููุงุฑูุฉ ูู ุงูุญุฌู ูุน ุงููุบูุฉ ุงููุฏุฑุฌุฉ.  ูุฐูู ุ ุฃููู ุจุชุบููุฑ ูุชุฑุฉ ุงูุนุฏุงุฏ ุงูุชู ุชุญุฏุฏ ูุฏุฉ ุงูุฌุฒุก ุงูุฅูุฌุงุจู ูููุจุถ ุจุงูููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> //   ,   //      //   ,  DMA    !!! //    ,   !!! StepperController_X_SingleVibrator_WritePeriod (6);</code> </pre><br>  ูููู ููุงุฐุง ุณุชุฉ ุชุฏุงุจูุฑ ูุงููุฉุ  ููุงุฐุง ูุง ุซูุงุซุฉุ  ููุงุฐุง ูุง ุงุซูููุ  ููุงุฐุง ุ ุจุนุฏ ูู ุดูุก ุ ูุง ูุงุญุฏุ  ูุฐู ูุตุฉ ุญุฒููุฉ.  ุฅุฐุง ูุงูุช ุงููุจุถ ุงูููุฌุจ ุฃูุตุฑ ูู 6 ุฏูุฑุงุช ุ ูุฅู ุงููุธุงู ูุง ูุนูู.  ุฃุธูุฑ ุงูุชุตุญูุญ ุงูุทููู ุนูู ุงูุฐุจุฐุจุงุช ูุน ุฅุฎุฑุงุฌ ุฎุทูุท ุงูุงุฎุชุจุงุฑ ุฅูู ุงูุฎุงุฑุฌ ุฃู DMA ููุณ ุจุงูุฃูุฑ ุงูุณุฑูุน.  ุฅุฐุง ูุงูุช ุงููุงูููุฉ ุชุนูู ููุฏุฉ ุชูู ุนู ูุฏุฉ ูุนููุฉ ุ <b>ูุญูููุง ุชุบุงุฏุฑ</b> ุญุงูุฉ <b>ุงูุชุฃุฎูุฑ</b> ุ ูุง ูุฒุงู FIFO ูุงุฑุบูุง.  ูุฏ ูุง ูุชู ูุถุน ูููุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ ุจุนุฏ!  ูููุท ุนูุฏูุง ูููู ููุฌุฒุก ุงูุฅูุฌุงุจู ูู ุงููุจุถุฉ ูุฏุฉ 6 ุฏูุฑุงุช ุ ูุถูู FIFO ุฃู ูููู ูุฏูู ููุช ููุชุญููู ... <br><br><h2 style=";text-align:right;direction:rtl">  ุงุณุชูุดุงู ุงููููู </h2><br>  ููุฑุฉ ุงูุฅุตูุงุญ ุงูุฃุฎุฑู ุงูุชู ุชููู ูู ุฑุฃุณู ูู ุชุณุฑูุน ุงูุฃุฌูุฒุฉ ููุธุงุฆู ูุนููุฉ ูู ููุงุฉ RTOS MAX.  ูููู ููุฃุณู ุ ูู ูุง ุนูุฏู ูู ุงูุฃููุงุฑ ููููุฉ ุนู ุชูู ุงูุงุฎุชูุงูุงุช ููุณูุง. <br><br>  ูุงูุช ููุงู ุญุงูุฉ ุ ุฏุฑุณุช ุชุทููุฑ ุชุทุจููุงุช Bare Metal ูู Cyclone V SoC.  ููู ุงุชุถุญ ุฃู ุงูุนูู ูุน ุณุฌูุงุช FPGA ูุงุญุฏุฉ (ุนูุฏ ุงููุชุงุจุฉ ุจุงูุชูุงูุจ ุนูููุง ุ ุซู ุงููุฑุงุกุฉ ูููุง) ูููู ูู ุงูุนูููุฉ ุงูุฃุณุงุณูุฉ ูุฆุงุช (!!!) ูุฑุงุช.  ุณูุนุช ุตุญูุญ.  ุฅูู ุจุงููุฆุงุช.  ุนูุงูุฉ ุนูู ุฐูู ุ ูู ูุฐุง ุบูุฑ ููุซู ุจุดูู ุณูุฆ ุ ููู ูู ุงูุจุฏุงูุฉ ุดุนุฑุช ุจุงูุฏุงุฎู ุ ูุจุนุฏ ุฐูู ุฃุซุจุชุช ูู ูุตุงุตุงุช ูู ุงูุนุจุงุฑุงุช ูู ุงููุซุงุฆู ุฃู ุงููููู ูุงูุช ูุฐูุจุฉ ุนูุฏ ุชูุฑูุฑ ุงูุทูุจุงุช ุนุจุฑ ูุฌููุนุฉ ูู ุงูุฌุณูุฑ.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ูุทุฑุฏ ูุฌููุนุฉ ูุจูุฑุฉ ุ ูุณูููู ููุงู ุฃูุถูุง ุฒูู ุงุณุชุชุงุฑ ุ ููู ูููุง ูุชุนูู ุจูููุฉ ูุงุญุฏุฉ ุชู ุถุฎูุง ุ ููู ุชููู ูููุฉ.  ุนูุฏูุง ุชููู ุงูุทูุจุงุช ููุฑุฏุฉ (ููุชุถูู ุชุณุฑูุน ุงูุฃุฌูุฒุฉ ุงูุฎุงุต ุจู kernel OS ููุท ูุฐู ุงูุทูุจุงุช) ุ ูุฅู ุงูุชุจุงุทุค ููุฑ ููุฆุงุช ุงููุฑุงุช ุจุงูุถุจุท.  ุณูููู ูู ุงูุฃุณุฑุน ุจูุซูุฑ ุงูููุงู ุจูู ุดูุก ุจุทุฑููุฉ ุจุฑูุงูุฌูุฉ ุจุญุชุฉ ุ ุนูุฏูุง ูุนูู ุงูุจุฑูุงูุฌ ูุน ุงูุฐุงูุฑุฉ ุงูุฑุฆูุณูุฉ ูู ุฎูุงู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุจุณุฑุนุฉ ูุญูููุฉ. <br><br>  ูู PSoC ุ ูุงู ูุฏู ุฃูุถูุง ุฎุทุท ูุนููุฉ.  ูู ุงููุธูุฑ ุ ููููู ุงูุจุญุซ ุนู ุจูุงูุงุช ุฑุงุฆุนุฉ ูู ุตููู ุจุงุณุชุฎุฏุงู DMA ู UDB.  ูุง ูู ุญูุง ููุงู!  ุจุณุจุจ ุจููุฉ ูุงุตู DMA ุ ูููู ููุญุฏุงุช ุงูุชุญูู ูุฐู ุฅุฌุฑุงุก ุจุญุซ ูุงูู ุนู ุงูุฃุฌูุฒุฉ ูู ุงูููุงุฆู ุงููุฑุชุจุทุฉ!  ูููู ุจุนุฏ ุชููู ุงููุงุจุณ ุงูููุตูู ุฃุนูุงู ุ ุฃุฏุฑูุช ุฃูู ูุฑุชุจุท ุฃูุถูุง ุจุงูุงุฎุชูุงุก.  ููุง ุ ูุชู ูุตู ูุฐุง ุงููููู ุจุดูู ุฌููู ูู ุงููุซุงุฆู.  ุณูุงุก ูู ุงูุนุงุฆูุฉ TRM ุฃู ูู ูุซููุฉ ูููุตูุฉ <b>AN84810 - PSoC 3 ู PSoC 5LP Advanced DMA Topics</b> .  ููุงู ูุณู 3.2 ููุฑุณ ููุฐุง ุงูุบุฑุถ.  ูุฐูู ูุชู ุฅูุบุงุก ุชุณุฑูุน ุงูุฌูุงุฒ ุงูุชุงูู.  ูู ุงููุคุณู.  ูููู ุ ููุง ูุงู ุณููููู ุณููููููููุชุด ุบูุฑุจููููู: "ุณูุจุญุซ". <br><br><h2 style=";text-align:right;direction:rtl">  ุชุฌุงุฑุจ ุงูุจุฑุงูุฌ ุงููุณุชูุฑุฉ </h2><br>  ุจุนุฏ ุฐูู ุ ููุช ุจุชุนููู ูุนููุงุช ุฎูุงุฑุฒููุฉ Bresenham: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> //     //    โ   CY_SET_REG16(StepperController_X_Datapath_1_D0_PTR, 4); CY_SET_REG16(StepperController_X_Datapath_1_D1_PTR, 2);</code> </pre><br>  ุญุณููุง ุ ูุฃุชู ุจุนุฏ ุฐูู ุงูููุฏ ุงูุนุงุฏู ุงูุฐู ูููู ูุฌููุนุฉ ูู ุงููููุงุช ูู ุฎูุงู DMA ุฅูู FIFO1 ูู ูุญุฏุฉ ุงูุชุญูู ูู ุงููุญุฑู X. <br><br>  ุงููุชูุฌุฉ ุชุชุทูุจ ุจุนุถ ุงูุชูุณูุฑ.  ููู ููุง: <br><br><img src="https://habrastorage.org/webt/bi/hg/ie/bihgiepg_iskg-wor_g4iqnv1ti.png"><br><br>  ุชุธูุฑ ูููุฉ ุงูุนุฏุงุฏ A0 ุจุงูููู ุงูุฃุญูุฑ ุนูุฏูุง ูููู ุงูุฌูุงุฒ ูู ุญุงูุฉ <b>ูุงุญุฏุฉ</b> .  ุชูุธูุฑ ุงูุนูุงูุฉ ุงููุฌููุฉ ุงูุฎุถุฑุงุก ุญุงูุงุช ุนูุฏ ุฅุฏุฑุงุฌ ุงูุชุฃุฎูุฑ ูุธุฑูุง ููุฌูุฏ ุงูุฌูุงุฒ ูู ุญุงูุฉ <b>ExtraTick</b> .  ููุงู ุฃูุถูุง ุฃุดุฑุทุฉ ุญูุซ ูููู ุงูุชุฃุฎูุฑ ุจุณุจุจ ุญุงูุฉ <b>ClearA0</b> ุ ููุชู ุชูููุฒูุง ุจุดุจูุฉ ุฒุฑูุงุก. <br><br>  ููุง ุชุฑูู ุ ุนูุฏ ุฅุฏุฎุงู ูุฃูู ูุฑุฉ ูุชู ููุฏ ุงูุชุฃุฎูุฑ ุงูุฃูู.  ูุฐุง ูุฑุฌุน ุฅูู ุญูููุฉ ุฃู A0 ุชุชู ุฅุนุงุฏุฉ ุถุจุทู ุนูุฏูุง ูููู ูู ูุถุน <b>ุงูุฎููู</b> ุ ููููู ูุฒูุฏ ุนูุฏูุง ูุฏุฎู <b>LoadData</b> .  ูุฐูู ุ ุฅูู ุญุฏ ุงูุชุญููู (ุงูุฎุฑูุฌ ูู ุญุงูุฉ <b>ูุงุญุฏ</b> ) ุ ูู ุจุงููุนู ูุณุงูู ูููุญุฏุฉ.  ุงูุญุณุงุจ ูุจุฏุฃ ูุนูุง.  ูููู ุจุดูู ุนุงู ุ ูุฐุง ูู ูุคุซุฑ ุนูู ุงูุชุฑุฏุฏ ุงููุชูุณุท.  ุงููุง ุชุญุชุงุฌ ููุท ุฃู ุชุจูู ูู ุงูุงุนุชุจุงุฑ.  ููุง ูุฌุจ ุฃู ูุคุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุฃูู ุนูุฏ ุฅุนุงุฏุฉ ุชุนููู A0 ุ ุณูุชู ุฃูุถูุง ุฅุฏุฑุงุฌ ุงูุณุงุนุฉ.  ูุฌุจ ุฃู ูุคุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุญุณุงุจ ูุชูุณุท โโุงูุชุฑุฏุฏ. <br><br>  ูููู ุจุดูู ุนุงู ุ ูุฅู ุนุฏุฏ ุงููุจุถุงุช ูู ุงูุตุญูุญ.  ูุฏุชูุง ูู ุฃูุถุง ูุนูููุฉ. <br>  ุฏุนูุง ูุญุงูู ุจุฑูุฌุฉ ุณูุณูุฉ ุฃูุซุฑ ูุงูุนูุฉ ูู ุงููุงุตูุงุช ุ <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุชููู ูู ูุฑุญูุฉ ุงูุชุณุงุฑุน ุ ุงูุญุฑูุฉ ุงูุฎุทูุฉ ูุงููุจุญ.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">void TestWithPacking(int countOnLinearStage) { //   ,   //     . //   ,  DMA    !!! //    ,   !!! StepperController_X_SingleVibrator_WritePeriod (6); //     //    โ   CY_SET_REG16(StepperController_X_Datapath_1_D0_PTR, 4); CY_SET_REG16(StepperController_X_Datapath_1_D1_PTR, 2); //    static const uint16 accelerate[] = {0x0010,0x0008,0x0004}; //    static const uint16 deccelerate[] = {0x004,0x0008,0x0010}; //  .    . static const uint16 steps[] = {0x0001}; //  DMA  ,      uint8 channel = DMA_X_DmaInitialize (sizeof(steps[0]),1,HI16(steps),HI16(StepperController_X_Datapath_1_F1_PTR)); CyDmaChRoundRobin (channel,true); //   uint8 tdDeccelerate = CyDmaTdAllocate(); CyDmaTdSetConfiguration(tdDeccelerate, sizeof(deccelerate), CY_DMA_DISABLE_TD, TD_INC_SRC_ADR | TD_AUTO_EXEC_NEXT); CyDmaTdSetAddress(tdDeccelerate, LO16((uint32)deccelerate), LO16((uint32)StepperController_X_Datapath_1_F1_PTR)); //       uint8 tdSteps = CyDmaTdAllocate(); //   !!! //     !!! CyDmaTdSetConfiguration(tdSteps, countOnLinearStage, tdDeccelerate, /*TD_INC_SRC_ADR |*/ TD_AUTO_EXEC_NEXT); CyDmaTdSetAddress(tdSteps, LO16((uint32)steps), LO16((uint32)StepperController_X_Datapath_1_F1_PTR)); //   //     !!! uint8 tdAccelerate = CyDmaTdAllocate(); CyDmaTdSetConfiguration(tdAccelerate, sizeof(accelerate), tdSteps, TD_INC_SRC_ADR | TD_AUTO_EXEC_NEXT); CyDmaTdSetAddress(tdAccelerate, LO16((uint32)accelerate), LO16((uint32)StepperController_X_Datapath_1_F1_PTR)); //      CyDmaChSetInitialTd(channel, tdAccelerate); //         CyDmaChEnable(channel, 1); }</code> </pre><br></div></div><br>  ุฃููุงู ุ ุงุทูุจ ุงูุฎุทูุงุช ุงูุนุดุฑ ููุณูุง (ูู DMA ุ ุงูุชูู 20 ุจุงูุช ุจุงููุนู): <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">TestWithPacking (20);</code> </pre><br>  ูุงููุชูุฌุฉ ููุง ูู ูุชููุน.  ูู ุงูุจุฏุงูุฉ ุ ุชุณุงุฑุน ูุฑุฆู.  ููุญุฏุซ ุงููุฎุฑุฌ ุฅูู <b>IDLE</b> (ุจูู ุฑุงู) ุจุชุฃุฎูุฑ ูุจูุฑ ูู ุงููุจุถุฉ ุงูุฃุฎูุฑุฉ ุ ุซู ุชู ุงูุงูุชูุงุก ูู ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ุชูุงููุง ุ ููููุชูุง ุชุณุงูู ุชูุฑูุจูุง ูููุฉ ุงูุฃููู. <br><br><img src="https://habrastorage.org/webt/5y/tb/na/5ytbna9ixcuxv5-i35tinzixy0e.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุงูุญุตุงู ุงูุญูููู ูู ุธู ุงูุธุฑูู ุงูุนุงุฏูุฉ </h2><br>  ุนูุฏ ุฅุนุงุฏุฉ ุนุฑุถ ุงูุฌูุงุฒ ุ ููุฒุช ุจุดูู ูุดููุฑ ูู ุนุฑุถ ุงููุจุถ 24 ุจุช ุฅูู ูุธููุฉ 16 ุจุช.  ููููุง ุงูุชุดููุง ุฃูู ูุง ูููู ุงูููุงู ุจุฐูู: ุณูููู ุงูุญุฏ ุงูุฃุฏูู ูุชุฑุฏุฏ ุงููุจุถ ูุฑุชูุนูุง ููุบุงูุฉ.  ููุฏ ูุนูุช ุฐูู ุนู ูุตุฏ.  ุงูุญูููุฉ ูู ุฃู ุชูููุฉ ุฒูุงุฏุฉ ุณุนุฉ ุงูุจุช ูู ุนุฏุงุฏ 16 ุจุช ุชุจูู ุฃููุง ูุนูุฏุฉ ููุบุงูุฉ ุ ุญุชู ูู ููุช ูุฏ ุจุฏุฃุช ูู ูุตููุง ูุน ุงูุฌูุงุฒ ุงูุฑุฆูุณู ุ ูุฅู ุฐูู ูุงู ุณูุญูู ูู ุงูุงูุชุจุงู.  ูุฐูู ุ ูุญู ูุนุชุจุฑูุง ูููุตูุฉ. <br><br>  ูุฏููุง ุจุทุงุฑูุฉ 16 ุจุช.  ูุฑุฑุช ุฅุถุงูุฉ ุงูููุงู ุงูููุงุณู ุงููููู ูู ุณุจุน ุจุช ุฅูู ูุญุฏุงุช ุงูุจุช ุงูุนุงููุฉ.  ูุง ูู ูุฐุง ุนุฏุงุฏ ุณุจุนุฉ ุจุชุ  ูุฐุง ูู ุงูุชุตููู ุงููุชููุฑ ูู ูู ูุฏุฑุฉ UDB (ุชุญุชูู ูุฏุฑุฉ UDB ุงูุฃุณุงุณูุฉ ุนูู ุนุฑุถ ุจุช ูุฌููุน ุณุฌูุงุช 8 ุจุช ุ ููุชู ุชุญุฏูุฏ ุงูุฒูุงุฏุฉ ูู ุนูู ุงูุจุชุฉ ูู ุฎูุงู ูุฌููุนุฉ ุงููุชู ูู ุงููุฌููุนุงุช).  ูู ููุณ ุงูููุงุฑุฏ ุ ูููู ุชูููุฐ ุณุฌูุงุช <b>ุงูุชุญูู / ุงูุญุงูุฉ</b> .  ุงูุขู ูุฏููุง ุนุฏุงุฏ ูุงุญุฏ ูููุณ ุฒูุฌ <b>ุชุญูู / ุญุงูุฉ</b> ูุงุญุฏ ูู 16 ุจุช ูู ุงูุจูุงูุงุช.  ูุฐูู ุ ุจุฅุถุงูุฉ ุนุฏุงุฏ ุขุฎุฑ ูููุธุงู ุ ูู ูููู ุจุชุฃุฎูุฑ ุงูููุงุฑุฏ ุงูุฅุถุงููุฉ.  ูุญู ููุท ูุฃุฎุฐ ูุง ุชู ุชุฎุตูุตู ุจุงููุนู ููุง.  ูุฐุง ูุทูู!  ูุตูุน ุงูุจุงูุช ุงูุนุงูู ูุนุฏุงุฏ ุนุฑุถ ุงููุจุถุฉ ูู ุฎูุงู ูุฐู ุงูุขููุฉ ููุญุตู ุนูู ุงูุนุฑุถ ุงูููู ูุนุฏุงุฏ ุนุฑุถ ุงููุจุถุฉ ูุณุงูู 23 ุจุช. <br><br><img src="https://habrastorage.org/webt/_k/nc/-h/_knc-hzlxwos6a8jdzopy3pj2ww.png"><br><br>  ุฃููุงู ุณุฃููู ูุง ููุช ุฃููุฑ ููู.  ุงุนุชูุฏุช ุฃูู ุจุนุฏ ุงูุฎุฑูุฌ ูู ุญุงูุฉ <b>ุงูุชุฃุฎูุฑ</b> ุ ุณูู ุฃุชุญูู ูู ุฅุชูุงู ุนูููุฉ ุนุฏ ูุฐู ุงูุนุฏุงุฏ ุงูุฅุถุงูู.  ุฅุฐุง ูู ููุชู ุงูุญุณุงุจ ุ ูุณูู ุฃููู ุจุชูููู ูููุชู ูุงูุชุญูู ูุฑุฉ ุฃุฎุฑู ุฅูู ุญุงูุฉ <b>ุงูุชุฃุฎูุฑ</b> .  ุฅุฐุง ุนุฏุช ุ ุณูุจูู ุงูููุทู ููุง ูู ุฏูู ุฅุถุงูุฉ ุฏูุฑุงุช ุฅุถุงููุฉ. <br><br>  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅู ุงููุซุงุฆู ุงูุฎุงุตุฉ ุจูุฐุง ุงูุนุฏุงุฏ ุชููู ุฅููู ุนูู ุญู.  ุญุฑููุง ุชููู: <br><blockquote style=";text-align:right;direction:rtl">  ุงููุชุฑุฉ <br>  ูุญุฏุฏ ูููุฉ ุชุณุฌูู ุงููุชุฑุฉ ุงูุฃูููุฉ.  ููุชุฑุฉ ูู ุงูุณุงุนุงุช N ุ ูุฌุจ ุถุจุท ูููุฉ ุงููุชุฑุฉ ุนูู ูููุฉ N-1.  ุณูุชู ุนุฏ ุงูุนุฏุงุฏ ูู N-1 ุฅูู 0 ูุงูุฐู ููุชุฌ ุนูู ูุชุฑุฉ ุฏูุฑุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ N.  <b><i>ูุง ูุชู ุฏุนู ูููุฉ ุณุฌู ุงููุชุฑุฉ ุงูุจุงูุบุฉ 0 ูุณุชุคุฏู ุฅูู ุฅุฎุฑุงุฌ ุนุฏุฏ ุงููุญุทุงุช ุงูุทุฑููุฉ ูู ุญุงูุฉ ุนุงููุฉ ุซุงุจุชุฉ.</i></b> </blockquote>  ููุฏ ุฃุธูุฑุช ุงูุญูุงุฉ ุฃู ูู ุดูุก ูุฎุชูู.  ุงุณุชูุชุฌุช ุญุงูุฉ ุฎุท <b>ุงูุนุฏ ุงูุทุฑูู</b> ุนูู ุฑุงุณู ุงูุฐุจุฐุจุงุช ูุดุงูุฏุช ูููุชู ุนูุฏ ุตูุฑ ุชู ุชุญูููู ูุณุจููุง ูู <b>ุงููุชุฑุฉ</b> ูุฃุซูุงุก ุชุญููู ุงูุจุฑูุงูุฌ.  ููุฃุณู ูุขู.  ูู ููู ููุงู <b>ุญุงูุฉ ุนุงููุฉ ุซุงุจุชุฉ</b> ! <br><br>  ูู ุฎูุงู ุงูุชุฌุฑุจุฉ ูุงูุฎุทุฃ ุ ุชูููุช ูู ุฌุนู ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ ุ ูููู ููู ูุญุฏุซ ูุฐุง ุ ูุฌุจ ุฃู ูุญุฏุซ ุนูููุฉ ุทุฑุญ ูุงุญุฏุฉ ุนูู ุงูุฃูู ูู ุงูุนุฏุงุฏ!  ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ ูู <b>"ุงูุทุฑุญ"</b> ููุณุช ุนูู ุฌุงูุจ.  ูุงู ูุง ุจุฏ ูู ุฑุจุทูุง ูู ุงููุณุงุฑ ุงููุทููุจ.  ููุน ุฃูุงู ููุงูุฉ <b>ุงูุชุฃุฎูุฑ</b> ููุณูู <b>Next65536</b> . <br><br><img src="https://habrastorage.org/webt/cp/6f/oz/cp6fozy_kflvs6eu6w-ho9ebmcu.png"><br><br>  ูุง ุชููู ALU ูู ูุฐู ุงูุญุงูุฉ ุจุฃู ุฅุฌุฑุงุกุงุช ูููุฏุฉ.  ูู ุงููุงูุน ุ ูุง ูุชูุงุนู ุณูู ุนุฏุงุฏ ุฌุฏูุฏ ูุน ุญูููุฉ ูููู ูู ูุฐู ุงูุญุงูุฉ.  ููู ููุง ูู ุงูุฑุณู ุงูุจูุงูู: <br><br><img src="https://habrastorage.org/webt/mh/tb/br/mhtbbr8strxue23n6jmg_giocjc.png"><br><br>  ูููุง ููู ุฎุตุงุฆุตู ุจูุฒูุฏ ูู ุงูุชูุงุตูู: <br><br><img src="https://habrastorage.org/webt/oo/t5/rs/oot5rs3_cdplwr94gno3poavzkq.png"><br><br>  ุจุดูู ุนุงู ุ ูุน ูุฑุงุนุงุฉ ุงูููุงูุงุช ุงูุณุงุจูุฉ ุ ูุฅู ุฌููุฑ ูุฐุง ุงูุนุฏุงุฏ ูุงุถุญ.  ููุท ุฎุท <b>ุงูุชูููู</b> ูู ุงููุนุงูุงุฉ.  ูุฑุฉ ุฃุฎุฑู ุ ูุง ุฃููู ุชูุงููุง ุณุจุจ ุชุดุบููู ุนูุฏูุง ูููู ุงูุฌูุงุฒ ูู ุญุงูุฉ <b>LoadData</b> (ุซู โโูุนูุฏ ุงูุนุฏุงุฏ ุฅุนุงุฏุฉ ุชุญููู ูููุฉ ุงููุชุฑุฉ).  ููุฏ ุงุณุชุนุฑุช ูุฐู ุงูุฎุฏุนุฉ ูู ุฎุตุงุฆุต ุงูุนุฏุงุฏ ุงูุชู ุชุชุญูู ูู ุงููุตุงุจูุญ ุ ูุฃุฎูุฐุฉ ูู ุงููุคูู ุงูุฅูุฌููุฒู ููุญุฏุฉ ุงูุชุญูู ูุชูู ุงููุตุงุจูุญ.  ุจุฏูููุง ุ ูุง ุชุนูู ูููุฉ ุงููุชุฑุฉ ุตูุฑ.  ูู ุชุนูู ูุนูุง. <br><br>  ูู ุฑูุฒ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุ ูุถูู ุชููุฆุฉ ุนุฏุงุฏ ุฌุฏูุฏ.  ุชุจุฏู ูุธููุฉ ุงูุจุฏุก ุงูุขู ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">void `$INSTANCE_NAME`_Start() { `$INSTANCE_NAME`_SingleVibrator_Start(); //"One" Generator start `$INSTANCE_NAME`_Plus65536_Start(); }</code> </pre><br>  ุฏุนูุง ุชุญูู ูู ุงููุธุงู ุงูุฌุฏูุฏ.  ููุง ูู ุฑูุฒ ุงููุธููุฉ ููุงุฎุชุจุงุฑ <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">(ููู ุ ุงูุณุทุฑ ุงูุฃูู ููุท ูุฎุชูู ุนู ุงูุฎุท ุงููุนุฑูู ุจุงููุนู):</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">void JustTest(int extra65536s) { //      65536  StepperController_X_Plus65536_WritePeriod((uint8) extra65536s); //     //    โ   CY_SET_REG16(StepperController_X_Datapath_1_D0_PTR, 4); CY_SET_REG16(StepperController_X_Datapath_1_D1_PTR, 2); //         . //         static const uint16 steps[] = { 0x1000,0x1000,0x1000,0x1000 }; //  DMA  ,      uint8 channel = DMA_X_DmaInitialize (sizeof(steps[0]),1,HI16(steps),HI16(StepperController_X_Datapath_1_F1_PTR)); CyDmaChRoundRobin (channel,true); //       ,       uint8 td = CyDmaTdAllocate(); //       .  ,    . CyDmaTdSetConfiguration(td, sizeof(steps), CY_DMA_DISABLE_TD, TD_INC_SRC_ADR | TD_AUTO_EXEC_NEXT); //       CyDmaTdSetAddress(td, LO16((uint32)steps), LO16((uint32)StepperController_X_Datapath_1_F1_PTR)); //      CyDmaChSetInitialTd(channel, td); //         CyDmaChEnable(channel, 1); }</code> </pre><br></div></div><br>  ูุญู ูุณูููุง ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> JustTest(0);</code> </pre><br>  ุนูู ุงูุฐุจุฐุจุงุช ูุฑู ูุง ููู (ุดุนุงุน ุฃุตูุฑ - ุฎุฑุฌ ุงูุฎุทูุฉ ุ ุฃุฒุฑู - ูููุฉ ุฎุฑุฌ ุงูุนุฏุงุฏ TC ููุชุญูู ูู ุงูุนูููุฉ).  ูุชู ุชุนููู ูุฏุฉ ุงููุจุถ <b>ุจุฎุทูุงุช</b> ุงูุตููู.  ูู ูู ุฎุทูุฉ ุ ุชููู ุงููุฏุฉ ูู ููุงููุณ 0x1000. <br><br><img src="https://habrastorage.org/webt/ap/q7/df/apq7dfk6t5kns3qtzjmkuzzw-44.png"><br><br>  ูู ุจุงูุชุจุฏูู ุฅูู ูุญุต ุขุฎุฑ ุจุญูุซ ูููู ููุงู ุชูุงูู ุจูู ุงููุชุงุฆุฌ ุงููุฎุชููุฉ: <br><br><img src="https://habrastorage.org/webt/zl/6s/2o/zl6s2oop2bft0ndatbawfdrtacw.png"><br><br>  ูู ุจุชุบููุฑ ุงุณุชุฏุนุงุก ุงููุธููุฉ ุฅูู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> JustTest(1);</code> </pre><br>  ูุงููุชูุฌุฉ ููุง ูู ูุชููุน.  ุฃููุงู ุ ูููู ุฎุฑุฌ TC ุตูุฑูุง ุจุงููุณุจุฉ ุฅูู ุฏูุฑุงุช 0x1000 ุ ุซู - ูุญุฏุฉ ููุฏูุฑุงุช 0x10000 (65536d).  ุงูุชุฑุฏุฏ ูุณุงูู 700 ููุฑุชุฒ ุชูุฑูุจูุง ุ ุงูุชุดููุง ูู ุงูุฌุฒุก ุงูุฃุฎูุฑ ูู ุงูููุงูุฉ ุ ูุฐูู ูู ุดูุก ุนูู ูุง ูุฑุงู. <br><br><img src="https://habrastorage.org/webt/nm/5q/6s/nm5q6s73zb7yqxtvuxzrxis4f5i.png"><br><br>  ุญุณููุง ุ ุฏุนูุง ูุฌุฑุจ ุงูุดูุทุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> JustTest(2);</code> </pre><br>  ูุญุตู ุนูู: <br><br><img src="https://habrastorage.org/webt/ah/sp/7y/ahsp7ymdefdyl04acuefc3ufct8.png"><br><br>  ูุฐุง ุตุญูุญ.  ูุชู ููุจ ุงูุฅุฎุฑุงุฌ TC ุฅูู ูุงุญุฏ ุนูู ุฏูุฑุงุช ุงูุณุงุนุฉ 65536 ูุดุงุฑูุฉ.  ูุจู ุฐูู ุ ูุงู ุนูุฏ ูุณุชูู ุงูุตูุฑ ูุฏูุฑุงุช 0x1000 + 0x10000. <br><br>  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุน ูุฐุง ุงูููุฌ ุ ููุจุบู ุฃู ุชุฐูุจ ุฌููุน ุงููุจุถุงุช ุจููุณ ูููุฉ ุงูุนุฏุงุฏ ุงูุฌุฏูุฏ.  ูู ุงููุณุชุญูู ุนูู ูุจุถุฉ ูุงุญุฏุฉ ุฐุงุช ุฃุนูู ุจุงูุช ุฃุซูุงุก ุงูุชุณุงุฑุน ุ ุนูู ุณุจูู ุงููุซุงู 3 ุ ุซู 1 ุ ุซู 0. ูููู ูู ุงููุงูุน ุ ูู ูุซู ูุฐู ุงูุชุฑุฏุฏุงุช ุงูููุฎูุถุฉ (ุฃูู ูู ุณุจุนูุงุฆุฉ ููุฑุชุฒ) ุ ูุง ูููู ููุชุณุงุฑุน ูุนูู ูุงุฏู ุ ูุจุงูุชุงูู ูููู ุฅููุงู ูุฐู ุงููุดููุฉ.  ูู ูุฐุง ุงูุชุฑุฏุฏ ุ ููููู ุงูุนูู ูุน ุงููุญุฑู ุฎุทููุง. <br><br><h2 style=";text-align:right;direction:rtl">  ูุทูุฑ ูู ูุฑูู </h2><br>  ุชูุต ูุซููุฉ TRM ูุนุงุฆูุฉ PSoC5LP ุนูู ูุง ููู: <br><blockquote style=";text-align:right;direction:rtl">  ูููู ุฃู ุชููู ูู ูุนุงููุฉ ูู 1 ุฅูู 64 ูููู ุจุงูุช </blockquote>  ูููู ูู AN84810 ุงูุชู ุณุจู ุฐูุฑูุง ุ ููุงู ูุซู ูุฐู ุงูุนุจุงุฑุฉ: <br><blockquote style=";text-align:right;direction:rtl">  1. ููู ููููู ุชุฎุฒูู ุฃูุซุฑ ูู 4095 ุจุงูุช ุจุงุณุชุฎุฏุงู DMAุ <br>  ุงูุญุฏ ุงูุฃูุตู ูุนุฏุฏ ููู TD ููุชุตุฑ ุนูู 4095 ุจุงูุช.  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ููู ุฃูุซุฑ ูู 4095 ุจุงูุช ุจุงุณุชุฎุฏุงู ููุงุฉ DMA ูุงุญุฏุฉ ุ ูุงุณุชุฎุฏู ุนุฏุฉ TDs ูุณูุณููุง ููุง ูู ููุถุญ ูู ุงููุซุงู 5. </blockquote>  ูู ูู ุงูุตุญูุญุ  ุฅุฐุง ุฃุฌุฑูุช ุชุฌุงุฑุจ ุ ูุณุชุชููู ุงููุชุงุฆุฌ ูุตุงูุญ ุฃุณูุฃ ุงูุนุจุงุฑุงุช ุ ููู ุงูุณููู ุณูููู ุบูุฑ ููููู ุชูุงููุง.  ุงูุฎุทุฃ ููู ูู ูุฐุง ุงูุงุฎุชูุงุฑ ูู API: <br><br><img src="https://habrastorage.org/webt/ib/5s/i2/ib5si2yxxn4e_idcohactjo2j-u.png"><br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุณ ุงููุต.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">cystatus CyDmaTdSetConfiguration(uint8 tdHandle, uint16 transferCount, uint8 nextTd, uint8 configuration) \ { cystatus status = CYRET_BAD_PARAM; if((tdHandle &lt; CY_DMA_NUMBEROF_TDS) &amp;&amp; (0u == (0xF000u &amp; transferCount))) { /* Set 12 bits transfer count. */ reg16 *convert = (reg16 *) &amp;CY_DMA_TDMEM_STRUCT_PTR[tdHandle].TD0[0u]; CY_SET_REG16(convert, transferCount); /* Set Next TD pointer. */ CY_DMA_TDMEM_STRUCT_PTR[tdHandle].TD0[2u] = nextTd; /* Configure the TD */ CY_DMA_TDMEM_STRUCT_PTR[tdHandle].TD0[3u] = configuration; status = CYRET_SUCCESS; } return(status); }</code> </pre><br></div></div><br>  ุฅุฐุง ุชู ุชุญุฏูุฏ ูุนุงููุฉ ุฃุทูู ูู 4095 ุจุงูุช ุ ูุณูุชู ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏ ุงูุณุงุจู.  ูุนู ุ ูู ุฃููุฑ ูู ุงูุชุญูู ูู ุฑููุฒ ุงูุฎุทุฃ ... <br><br>  ุฃุธูุฑุช ุงูุชุฌุงุฑุจ ุฃูู ุฅุฐุง ููุช ุจุฅุฒุงูุฉ ูุฐุง ุงููุญุต ุ ูุณูุชู ูุทุน ุงูุทูู ุงููุนูู ุจุงุณุชุฎุฏุงู ุงูููุงุน 0xfff (4096 40 = 0x1000).  ููุฃุณู ูุขู.  ุงููุงุฑุช ุฌููุน ุงูุขูุงู ููุญุตูู ุนูู ูุธููุฉ ููุชุนุฉ.  ููููู ุ ุจุงูุทุจุน ุ ุนูู ุณูุงุณู ูู ุงููุงุตูุงุช ุฐุงุช ุงูุตูุฉ ูู 4K.  ูููู ุ ูู ุ 64 ูููู ุจุงูุช 16 ุณูุงุณู.  ุซูุงุซุฉ ูุญุฑูุงุช ูุดุทุฉ (ุงูุจุซู ุณูููู ูู ุฎุทูุงุช ุฃูู) - 48 ุณูุณูุฉ.  ุจุงูุถุจุท ูุฌุจ ููุก ุงููุซูุฑ ูู ุฃุณูุฃ ุงูุญุงูุงุช ุ ูุจู ูู ูุทุนุฉ.  ุฑุจูุง ูู ููุจูู ูู ุงูููุช ุงูููุงุณุจ.  ูุชููุฑ 127 ูุงุตูุง ูุญุฏ ุฃุฏูู ุ ูุฐูู ุณูููู ููุงู ุจุงูุชุฃููุฏ ุฐุงูุฑุฉ ูุงููุฉ. <br><br>  ููููู ุฅุฑุณุงู ุงูุจูุงูุงุช ุงูููููุฏุฉ ุญุณุจ ุงูุญุงุฌุฉ.  ุญุฏุซ ุงููุทุงุน ูู ุฃู ููุงุฉ DMA ูุฏ ุฃูููุช ุงูุนูู ุ ููุญู ูููู ุดุฑูุญุฉ ุฃุฎุฑู ุฅูููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุง ููุฒู ุฅุฌุฑุงุก ุนูููุงุช ุญุณุงุจูุฉ ุ ูุชู ุชูููู ุงููุทุงุน ุจุงููุนู ุ ูุณูููู ูู ุดูุก ุณุฑูุนูุง.  ููุง ุชูุฌุฏ ูุชุทูุจุงุช ููุฃุฏุงุก: ุนูุฏ ุฅุตุฏุงุฑ ุทูุจ ููุงุทุนุฉ ุ ุณูููู ููุงู 4 ุนูุงุตุฑ ุฅุถุงููุฉ ูู FIFO ุณูุชู ุชูุฏูู ุงูุฎุฏูุงุช ููู ูููุง ูุนุฏุฉ ูุฆุงุช ุฃู ุญุชู ุขูุงู ุฏูุฑุงุช ุงูุณุงุนุฉ.  ููุฐุง ูู ุ ูู ุดูุก ุญูููู.  ุณุชููู ุงูุฅุณุชุฑุงุชูุฌูุฉ ุงููุญุฏุฏุฉ ุฃุณูู ูู ุงูุงุฎุชูุงุฑ ุฃุซูุงุก ุงูุนูู ุงูุญูููู.  ููู ุฎุทุฃ ูู ุงููุซุงุฆู (TRM) ุฃูุณุฏ ุงููุฒุงุฌ ููู.  ุฅุฐุง ูุงู ูุฐุง ูุนุฑูููุง ูุณุจููุง ุ ูุฑุจูุง ูู ุฃูู ูุฃุชุญูู ูู ุงููููุฌูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฎุงุชูุฉ </h2><br>  ูู ุงููุธูุฑ ุ ุฃุตุจุญุช ุฃุฏุงุฉ ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ุงููุณุงุนุฏุฉ ููุจููุฉ ุญุชู ูุชุณูู ุนูู ุฃุณุงุณูุง ุนูู ูุณุฎุฉ ูู "ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ" ุ ุนูู ุณุจูู ุงููุซุงู ุ Marlin ุ ูุงูุชู ููุณุช ุจุงุณุชูุฑุงุฑ ูู ูุนุงูุฌ ุงูููุงุทุนุฉ ููุญุฑูุงุช ุงูุณุงุฆุฑ.  ุญุณุจ ุนููู ุ ูุฐุง ููุทุจู ุจุดูู ุฎุงุต ุนูู ุทุงุจุนุงุช ุฏูุชุง ุ ุญูุซ ุงูุทูุจ ุนูู ููุงุฑุฏ ุงูุญูุณุจุฉ ูุฑุชูุน ููุบุงูุฉ.  ุฑุจูุง ุณูุคุฏู ุฐูู ุฅูู ุงููุถุงุก ุนูู ุงูุชุฏูู ุงูุฐู ูุญุฏุซ ูู ุฏูุชุง ูู ุงูุฃูุงูู ุงูุชู ูุชููู ูููุง ุงูุฑุฃุณ.  ุนูู MZ3D ูู ูุฐู ุงูุฃูุงูู ููุณูุง ูุง ููุงุญุธ ุฃู ุชุฏูู.  ุณูุงุก ุฃูุงู ูุฐุง ุตุญูุญูุง ุฃู ูุง ุ ูุณูู ูุญุฏุฏ ุงูููุช ุ ูุณูุชู ูุดุฑ ุงูุชูุฑูุฑ ุงูุฎุงุต ุจู ูู ูุฑุน ูุฎุชูู ุชูุงููุง. <br><br>  ูู ูุฐู ุงูุฃุซูุงุก ุ ุฑุฃููุง ุฃูู ุนูู ูุชูุฉ UDB ุ ุนูู ุงูุฑุบู ูู ุจุณุงุทุชู ุ ูู ุงููููู ุชูุงููุง ุชูููุฐ ูุนุงูุฌ ูุณุงุนุฏ ูุนูู ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุงููุนุงูุฌ ุงูุฑุฆูุณู ููุณูุญ ุจุฅูุบุงุก ุชุญูููู.  ูุนูุฏูุง ูููู ููุงู ุงููุซูุฑ ูู ูุฐู ุงููุญุฏุงุช ุ ูููู ุฃู ุชุนูู ุงููุนุงูุฌุงุช ุงููุดุชุฑูุฉ ุจุดูู ูุชูุงุฒู. <br><br>  ุญุฏุซ ุฎุทุฃ ูู ูุซุงุฆู ูุญุฏุฉ ุงูุชุญูู DMA ูู ุนุฏู ูุถูุญ ุงููุชูุฌุฉ.  ููุน ุฐูู ุ ูุฅู ุงูุงููุทุงุนุงุช ูุทููุจุฉ ุ ูููู ููุณ ุจููุณ ุงูุชุฑุฏุฏ ูููุณ ูุน ุงูุฃูููุฉ ุงูุฒูููุฉ ุงูุชู ูุงูุช ูู ุงูุฅุตุฏุงุฑ ุงูุฃุตูู.  ูุฐุง ูุฅู ุงูุญุงูุฉ ุงููุฒุงุฌูุฉ ุชูุณุฏ ุ ููู ุงุณุชุฎุฏุงู "ุงููุนุงูุฌ ุงูุซุงููู" ุนูู ุฃุณุงุณ UDB ูุง ูุฒุงู ูููุฑ ููุณุจูุง ูุจูุฑูุง ููุงุฑูุฉู ุจุนูู ุงูุจุฑุงูุฌ ุงููุญุถ. <br><br>  ุนูู ุทูู ุงูุทุฑูู ุ ุชู ุงููุดู ุนู ุฃู DMA ุชุนูู ุจุณุฑุนุฉ ููุฎูุถุฉ ุฅูู ุญุฏ ูุง.  ูุชูุฌุฉ ูุฐูู ุ ุฃุฌุฑูุช ุจุนุถ ุงูููุงุณุงุช ุนูู ูู ูู PSoC5LP ูุนูู STM32.  ุงููุชุงุฆุฌ ุณุญุจ ููุงู ุขุฎุฑ.  ุฑุจูุง ุณุฃูุนู ุฐูู ููููุง ูุง ุฅุฐุง ูุงู ุงูููุถูุน ูุซูุฑูุง ููุงูุชูุงู. <br><br>  ูุชูุฌุฉ ููุชุฌุงุฑุจ ุ ุชู ุงูุญุตูู ุนูู ูุดุฑูุนูู ููุงุฎุชุจุงุฑ ูู ููุช ูุงุญุฏ.  ุงูุฃูู ุฃุณูู ููููู.  ููููู ุฃู ุชุฃุฎุฐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุงูููุฑูุซุฉ ุงูุซุงููุฉ ูู ุงูุฃููู ุ ููู ูู ุญูุฑุฉ ูู ุฃูุฑูุง ุนูุฏ ุฅุถุงูุฉ ุนุฏุงุฏ ูู 7 ุจุช ูุงูููุทู ุงููุฑุชุจุท.  ููููู ุฃู ุชุฃุฎุฐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุจุงูุทุจุน ุ ูุฐู ุงูุฃูุซูุฉ ููุณุช ุณูู ุฃูุซูุฉ ุงุฎุชุจุงุฑ.  ูุง ููุฌุฏ ููุช ูุฑุงุบ ุญุชู ุงูุขู ูุชุถููู "ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ" ุงูุญููููุฉ.  ูููู ูู ุฅุทุงุฑ ูุฐู ุงูููุงูุงุช ุ ูู ุงูููู ุฃูุซุฑ ููุงุฑุณุฉ ุงูุนูู ูุน UDB. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar434742/">https://habr.com/ru/post/ar434742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar434732/index.html">ุงูุญูุงุฉ ูู 6200 DPI. HyperX Pulsefire ุงูุฃุณุงุณูุฉ ูุฑุงุฌุนุฉ</a></li>
<li><a href="../ar434734/index.html">ุชุญููู ููุฑููู. ุงูุตูุงู ูุงูุบุงุถุจ</a></li>
<li><a href="../ar434736/index.html">ุจุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุจูุงูุงุช ุณุฌู Mikrotik ูููุน ุงูููุฉ ุงูุบุงุดูุฉ</a></li>
<li><a href="../ar434738/index.html">ุชุนุฒูุฒ ุงูุชุนูู ูู ุจูุซูู</a></li>
<li><a href="../ar434740/index.html">ุชู ุชุฏุฑูุณ ุงูุดุจูุฉ ุงูุนุตุจูุฉ ููุดู ุงูุฃููุงุญ ุงูุดูุณูุฉ ูู ุตูุฑ ุงูุฃููุงุฑ ุงูุตูุงุนูุฉ ูุงูุชูุจุค ุจูุณุชูู ุชูุฒูุนูุง</a></li>
<li><a href="../ar434744/index.html">Samsung SSD 860 QVO 1 TB ู 4 TB: ุงููุณุชููู ุงูุฃูู SATA QLC (ุฌุฒุกุงู)</a></li>
<li><a href="../ar434746/index.html">ุจููู ุชุญุช ุงููุฌูุฑ 4</a></li>
<li><a href="../ar434750/index.html">ููููุฉ ุงูุณูุทุฑุฉ ุนูู ุงูุจููุฉ ุงูุชุญุชูุฉ ููุดุจูุฉ ุงูุฎุงุตุฉ ุจู. ุงููุตู ุงูุซุงูู ุงูุชูุธูู ูุงูุชูุซูู</a></li>
<li><a href="../ar434752/index.html">Robomoroz: ูุณุชูุจู ุงูุดุฎุตูุฉ ุงูุฑุฆูุณูุฉ ููุนุงู ุงูุฌุฏูุฏ</a></li>
<li><a href="../ar434756/index.html">ูุณุชูุจู Kubernetes ูู ูุน ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>