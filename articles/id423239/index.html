<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐫 💟 🙍🏽 Buat paket untuk Kubernetes dengan Helm: struktur bagan dan templating 🍪 🙇 👍🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami berbicara tentang Helm dan bekerja dengannya "secara umum" di artikel sebelumnya . Sekarang mari kita mendekati latihan dari sisi lain - dari sud...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Buat paket untuk Kubernetes dengan Helm: struktur bagan dan templating</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/423239/"><img src="https://habrastorage.org/webt/ff/1x/js/ff1xjsnvdlnfinirlwb-0p42tlo.png"><br><br>  Kami berbicara tentang Helm dan bekerja dengannya "secara umum" di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya</a> .  Sekarang mari kita mendekati latihan dari sisi lain - dari sudut pandang pencipta grafik (mis. Paket untuk Helm).  Dan meskipun artikel ini berasal dari dunia eksploitasi, ternyata lebih mirip dengan materi tentang bahasa pemrograman - seperti nasib penulis grafik.  Jadi, bagan adalah kumpulan file ... <a name="habracut"></a><br><br>  File grafik dapat dibagi menjadi dua grup: <br><br><ol><li>  File diperlukan untuk menghasilkan manifes sumber daya Kubernetes.  Ini termasuk template dari direktori <code>templates</code> dan file dengan nilai (nilai default disimpan dalam <code>values.yaml</code> ).  Juga di grup ini adalah file <code>requirements.yaml</code> dan direktori <code>charts</code> - semua ini digunakan untuk mengatur grafik bersarang. </li><li>  File yang menyertai berisi informasi yang mungkin berguna dalam menemukan grafik, mengenal mereka dan menggunakannya.  Sebagian besar file dalam grup ini adalah opsional. </li></ol><br>  Informasi lebih lanjut tentang file dari kedua grup: <br><br><ul><li>  <code>Chart.yaml</code> - file dengan informasi tentang bagan; </li><li>  <code>LICENSE</code> - file teks opsional dengan lisensi grafik; </li><li>  <code>README.md</code> - file opsional dengan dokumentasi; </li><li>  <code>requirements.yaml</code> - file opsional dengan daftar diagram dependensi; </li><li>  <code>values.yaml</code> - file dengan nilai default untuk template; </li><li>  <code>charts/</code> - direktori opsional dengan grafik bersarang; </li><li>  direktori <code>templates/</code> - dengan templat manifest sumber daya Kubernetes; </li><li>  <code>templates/NOTES.txt</code> - file teks opsional dengan catatan yang ditampilkan kepada pengguna selama instalasi dan pembaruan. </li></ul><br>  Untuk lebih memahami konten file-file ini, Anda bisa merujuk ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">panduan pengembang bagan resmi</a> atau mencari contoh yang relevan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori resmi</a> . <br><br>  Membuat grafik pada umumnya datang untuk mengatur set file yang dirancang dengan baik.  Dan kesulitan utama dalam "desain" ini adalah penggunaan sistem template yang cukup canggih untuk mencapai hasil yang diinginkan.  Untuk rendering manifest sumber daya Kubernetes, <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mesin templat Go</a> standar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">digunakan</a> , diperpanjang oleh fungsi Helm</b> . <br><br>  <i><b>Pengingat</b> : Pengembang Helm mengumumkan bahwa dalam versi utama proyek selanjutnya - Helm 3 - akan ada dukungan untuk skrip Lua, yang dapat digunakan <b>secara bersamaan</b> dengan templat Go.</i>  <i>Saya tidak akan membahas hal ini secara lebih rinci - ini (dan perubahan lain dalam Helm 3) dapat dibaca di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .</i> <br><br>  Sebagai contoh, inilah cara Helm 2 terlihat seperti template manifes Kubernet <i>Deployment</i> untuk blog WordPress dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya</a> : <br><br><div class="spoiler">  <b class="spoiler_title">deployment.yaml</b> <div class="spoiler_text"><pre> <code class="hljs django"><span class="xml"><span class="xml">apiVersion: extensions/v1beta1 kind: Deployment metadata: name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "fullname" . }}</span></span><span class="xml"><span class="xml"> labels: app: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "fullname" . }}</span></span><span class="xml"><span class="xml"> chart: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Chart.Name }}</span></span><span class="xml"><span class="xml">-</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Chart.Version }}</span></span><span class="xml"><span class="xml">" release: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Release.Name }}</span></span><span class="xml"><span class="xml">" heritage: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Release.Service }}</span></span><span class="xml"><span class="xml">" spec: replicas: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.replicaCount }}</span></span><span class="xml"><span class="xml"> template: metadata: labels: app: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "fullname" . }}</span></span><span class="xml"><span class="xml"> chart: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Chart.Name }}</span></span><span class="xml"><span class="xml">-</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Chart.Version }}</span></span><span class="xml"><span class="xml">" release: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Release.Name }}</span></span><span class="xml"><span class="xml">" spec: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.image.pullSecrets }}</span></span><span class="xml"><span class="xml"> imagePullSecrets: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- range .Values.image.pullSecrets }}</span></span><span class="xml"><span class="xml"> - name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end}}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> containers: - name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "fullname" . }}</span></span><span class="xml"><span class="xml"> image: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.image.registry }}</span></span><span class="xml"><span class="xml">/</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.image.repository }}</span></span><span class="xml"><span class="xml">:</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.image.tag }}</span></span><span class="xml"><span class="xml">" imagePullPolicy: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.image.pullPolicy | quote }}</span></span><span class="xml"><span class="xml"> env: - name: ALLOW_EMPTY_PASSWORD </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.allowEmptyPassword }}</span></span><span class="xml"><span class="xml"> value: "yes" </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> value: "no" </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> - name: MARIADB_HOST </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.mariadb.enabled }}</span></span><span class="xml"><span class="xml"> value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "mariadb.fullname" . }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.externalDatabase.host | quote }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> - name: MARIADB_PORT_NUMBER </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.mariadb.enabled }}</span></span><span class="xml"><span class="xml"> value: "3306" </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.externalDatabase.port | quote }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_DATABASE_NAME </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.mariadb.enabled }}</span></span><span class="xml"><span class="xml"> value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.mariadb.db.name | quote }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.externalDatabase.database | quote }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_DATABASE_USER </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.mariadb.enabled }}</span></span><span class="xml"><span class="xml"> value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.mariadb.db.user | quote }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.externalDatabase.user | quote }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_DATABASE_PASSWORD valueFrom: secretKeyRef: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.mariadb.enabled }}</span></span><span class="xml"><span class="xml"> name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "mariadb.fullname" . }}</span></span><span class="xml"><span class="xml"> key: mariadb-password </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ printf "%s-%s" .Release.Name "externaldb" }}</span></span><span class="xml"><span class="xml"> key: db-password </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_USERNAME value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.wordpressUsername | quote }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_PASSWORD valueFrom: secretKeyRef: name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "fullname" . }}</span></span><span class="xml"><span class="xml"> key: wordpress-password - name: WORDPRESS_EMAIL value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.wordpressEmail | quote }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_FIRST_NAME value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.wordpressFirstName | quote }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_LAST_NAME value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.wordpressLastName | quote }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_BLOG_NAME value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.wordpressBlogName | quote }}</span></span><span class="xml"><span class="xml"> - name: WORDPRESS_TABLE_PREFIX value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.wordpressTablePrefix | quote }}</span></span><span class="xml"><span class="xml"> - name: SMTP_HOST value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.smtpHost | quote }}</span></span><span class="xml"><span class="xml"> - name: SMTP_PORT value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.smtpPort | quote }}</span></span><span class="xml"><span class="xml"> - name: SMTP_USER value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.smtpUser | quote }}</span></span><span class="xml"><span class="xml"> - name: SMTP_PASSWORD valueFrom: secretKeyRef: name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ template "fullname" . }}</span></span><span class="xml"><span class="xml"> key: smtp-password - name: SMTP_USERNAME value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.smtpUsername | quote }}</span></span><span class="xml"><span class="xml"> - name: SMTP_PROTOCOL value: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.smtpProtocol | quote }}</span></span><span class="xml"><span class="xml"> ports: - name: http containerPort: 80 - name: https containerPort: 443 livenessProbe: httpGet: path: /wp-login.php </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if not .Values.healthcheckHttps }}</span></span><span class="xml"><span class="xml"> port: http </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> port: https scheme: HTTPS </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ toYaml .Values.livenessProbe | indent 10 }}</span></span><span class="xml"><span class="xml"> readinessProbe: httpGet: path: /wp-login.php </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if not .Values.healthcheckHttps }}</span></span><span class="xml"><span class="xml"> port: http </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> port: https scheme: HTTPS </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ toYaml .Values.readinessProbe | indent 10 }}</span></span><span class="xml"><span class="xml"> volumeMounts: - mountPath: /bitnami/apache name: wordpress-data subPath: apache - mountPath: /bitnami/wordpress name: wordpress-data subPath: wordpress - mountPath: /bitnami/php name: wordpress-data subPath: php resources: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ toYaml .Values.resources | indent 10 }}</span></span><span class="xml"><span class="xml"> volumes: - name: wordpress-data </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.persistence.enabled }}</span></span><span class="xml"><span class="xml"> persistentVolumeClaim: claimName: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.persistence.existingClaim | default (include "fullname" .) }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> emptyDir: {} </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- if .Values.nodeSelector }}</span></span><span class="xml"><span class="xml"> nodeSelector: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ toYaml .Values.nodeSelector | indent 8 }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end -}}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .Values.affinity }}</span></span><span class="xml"><span class="xml"> affinity: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ toYaml . | indent 8 }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .Values.tolerations }}</span></span><span class="xml"><span class="xml"> tolerations: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ toYaml . | indent 8 }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre></div></div><br>  Sekarang - tentang prinsip dasar dan fitur standardisasi di Helm.  Sebagian besar contoh di bawah ini diambil dari grafik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori resmi</a> . <br><br><h2>  Templating </h2><br><h3>  Templat: <code>{{ }}</code> </h3><br>  Segala sesuatu yang terkait dengan templating dibungkus dengan kurung kurawal ganda.  Teks di luar kurung keriting tetap tidak berubah selama rendering. <br><br><h3>  Nilai Konteks :. </h3><br>  Saat merender file atau sebagian <i>(untuk informasi lebih lanjut tentang penggunaan kembali templat, lihat bagian artikel berikutnya)</i> , nilai yang dapat diakses secara internal melalui variabel konteks - titik dilemparkan.  Ketika diteruskan sebagai argumen ke struktur, titik tersebut digunakan untuk mengakses bidang dan metode struktur ini. <br><br>  Nilai variabel berubah selama proses rendering <b>tergantung pada konteks</b> di mana ia digunakan.  Sebagian besar pernyataan blok mengabaikan variabel konteks di dalam blok utama.  <i>Operator utama dan fitur-fiturnya akan dibahas di bawah ini, setelah berkenalan dengan struktur Helm dasar.</i> <br><br><h3>  Struktur dasar Helm </h3><br>  Saat merender manifes, struktur dengan bidang berikut dilemparkan ke templat: <br><br><ul><li>  Bidang. <b><code>.Values</code></b> - untuk akses ke parameter yang ditentukan selama instalasi dan pembaruan rilis.  Ini termasuk nilai opsi <code>--set</code> , <code>--set-string</code> dan <code>--set-file</code> , serta parameter file dengan nilai, file <code>values.yaml</code> dan file yang sesuai dengan nilai opsi - <code>--values</code> : <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">containers: - name: main image: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.image }}</span></span><span class="xml"><span class="xml">:</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.imageTag }}</span></span><span class="xml"><span class="xml">" imagePullPolicy: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.imagePullPolicy }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre></li><li>  <b><code>.Release</code></b> - untuk menggunakan <a href="">data rilis</a> tentang peluncuran, pemasangan atau pembaruan, rilis nama, namespace, dan nilai beberapa bidang lainnya yang mungkin berguna saat membuat manifes: <br><br><pre> <code class="hljs cs">metadata: labels: heritage: <span class="hljs-string"><span class="hljs-string">"{{ .Release.Service }}"</span></span> release: <span class="hljs-string"><span class="hljs-string">"{{ .Release.Name }}"</span></span> subjects: - <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span>: {{ .Release.Namespace }}</code> </pre></li><li>  <b><code>.Chart</code></b> - untuk mengakses <a href="">informasi grafik</a> .  Kolom sesuai dengan isi file <code>Chart.yaml</code> : <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">labels: chart: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Chart.Name }}</span></span><span class="xml"><span class="xml">-</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Chart.Version }}</span></span><span class="xml"><span class="xml">"</span></span></code> </pre></li><li>  Struktur. <b><code>.Files</code></b> - untuk bekerja dengan file yang disimpan dalam <b>direktori grafik</b> ;  struktur dan metode yang tersedia dapat ditemukan di <a href="">sini</a> .  Contoh: <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">: openssl.conf: | {{ .</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Files</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Get</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">openssl</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conf</span></span></span><span class="hljs-class">" | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">indent</span></span></span><span class="hljs-class"> 4 }}</span></span></code> </pre><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">: {{ (.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Files</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Glob</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">files</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">docker</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entrypoint</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initdb</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">d</span></span></span><span class="hljs-class">/*").</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AsConfig</span></span></span><span class="hljs-class"> | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">indent</span></span></span><span class="hljs-class"> 2 }}</span></span></code> </pre></li><li>  <b><code>.Capabilities</code></b> - untuk mengakses <a href="">informasi tentang cluster</a> di mana <b><code>.Capabilities</code></b> dilakukan: <br><br><pre> <code class="hljs matlab">{{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .Capabilities.APIVersions.Has <span class="hljs-string"><span class="hljs-string">"apps/v1beta2"</span></span> }} apiVersion: apps/v1beta2 {{- <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> }} apiVersion: extensions/v1beta1 {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }}</code> </pre><br><pre> <code class="hljs objectivec">{{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> semverCompare <span class="hljs-string"><span class="hljs-string">"^1.9-0"</span></span> .Capabilities.KubeVersion.GitVersion }} apiVersion: apps/v1 {{- <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> }}</code> </pre></li></ul><br><h3>  Operator </h3><br>  Kita mulai, tentu saja, dengan pernyataan <code>if</code> , <code>else if</code> dan <code>else</code> : <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{- if .Values.agent.image.tag }}</span></span><span class="xml"><span class="xml"> image: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.agent.image.repository }}</span></span><span class="xml"><span class="xml">:</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.agent.image.tag }}</span></span><span class="xml"><span class="xml">" </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> image: "</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Values.agent.image.repository }}</span></span><span class="xml"><span class="xml">:v</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Chart.AppVersion }}</span></span><span class="xml"><span class="xml">" </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Operator <code>range</code> dirancang untuk bekerja dengan array dan peta.  Jika array dilewatkan sebagai argumen dan berisi elemen, maka untuk setiap elemen blok dieksekusi secara berurutan (dalam hal ini, nilai di dalam blok menjadi tersedia melalui variabel konteks): <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{- range .Values.ports }}</span></span><span class="xml"><span class="xml"> - name: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .name }}</span></span><span class="xml"><span class="xml"> port: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .containerPort }}</span></span><span class="xml"><span class="xml"> targetPort: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .containerPort}}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- else }}</span></span><span class="xml"><span class="xml"> ... </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end}}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{ range .Values.tolerations -}}</span></span><span class="xml"><span class="xml"> - </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ toYaml . | indent 8 | trim }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ end }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Untuk bekerja dengan peta, sintaks dengan variabel disediakan: <br><br><pre> <code class="hljs ruby">{{- range $key, $value <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= .Values.credentials.secretContents }} {{ $key }}: {{ $value <span class="hljs-params"><span class="hljs-params">| b64enc |</span></span> quote }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }}</code> </pre><br>  Perilaku serupa adalah <code>with</code> : operator: jika argumen yang dilewati ada, blok dieksekusi, dan variabel konteks di blok sesuai dengan nilai argumen.  Sebagai contoh: <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{- with .config }}</span></span><span class="xml"><span class="xml"> config: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .region }}</span></span><span class="xml"><span class="xml"> region: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .s3ForcePathStyle }}</span></span><span class="xml"><span class="xml"> s3ForcePathStyle: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .s3Url }}</span></span><span class="xml"><span class="xml"> s3Url: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .kmsKeyId }}</span></span><span class="xml"><span class="xml"> kmsKeyId: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Untuk menggunakan kembali templat, bundel dari <code>define [name]</code> dan <code>template [name] [variable]</code> dapat digunakan, di mana nilai yang dikirimkan tersedia melalui variabel konteks di blok <code>define</code> : <br><br><pre> <code class="hljs vbscript">apiVersion: v1 kind: ServiceAccount metadata: name: {{ template <span class="hljs-string"><span class="hljs-string">"kiam.serviceAccountName.agent"</span></span> . }} ... {{- define <span class="hljs-string"><span class="hljs-string">"kiam.serviceAccountName.agent"</span></span> -}} {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .Values.serviceAccounts.agent.create -}} {{ <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> (include <span class="hljs-string"><span class="hljs-string">"kiam.agent.fullname"</span></span> .) .Values.serviceAccounts.agent.name }} {{- <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -}} {{ <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">"default"</span></span> .Values.serviceAccounts.agent.name }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> -}} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> -}}</code> </pre><br>  Beberapa fitur yang perlu dipertimbangkan saat menggunakan <code>define</code> , atau, lebih sederhana, partial'ov: <br><br><ul><li>  Deklarasi parsial bersifat global dan dapat digunakan di semua file direktori <code>templates</code> . </li><li>  Grafik utama dikompilasi bersama dengan grafik dependen, jadi jika ada dua nama parsial parsial dari jenis yang sama, yang dimuat terakhir akan digunakan.  Saat menamai sebagian, biasanya menambahkan nama bagan untuk menghindari konflik seperti itu: <code>define "chart_name.partial_name"</code> . </li></ul><br><h3>  Variabel: <code>$</code> </h3><br>  Selain bekerja dengan konteksnya, Anda dapat menyimpan, mengubah, dan menggunakan kembali data menggunakan variabel: <br><br><pre> <code class="hljs ruby">{{ $provider <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= .Values.configuration.backupStorageProvider.name }} ... {{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> eq $provider <span class="hljs-string"><span class="hljs-string">"azure"</span></span> }} <span class="hljs-symbol"><span class="hljs-symbol">envFrom:</span></span> - <span class="hljs-symbol"><span class="hljs-symbol">secretRef:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> {{ template <span class="hljs-string"><span class="hljs-string">"ark.secretName"</span></span> . }} {{ <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }}</code> </pre><br>  Saat merender file atau sebagian, <code>$</code> memiliki arti yang sama dengan titik.  Tetapi tidak seperti variabel konteks (titik), nilai <code>$</code> <b>tidak berubah dalam konteks pernyataan blok</b> , yang memungkinkan Anda untuk secara bersamaan bekerja dengan nilai konteks pernyataan blok dan struktur Helm dasar (atau nilai yang diteruskan ke parsial, jika kita berbicara tentang menggunakan <code>$</code> inside partial'a) .  Ilustrasi Perbedaan: <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">context: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> dollar: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ $ }}</span></span><span class="xml"><span class="xml"> with: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .Chart }}</span></span><span class="xml"><span class="xml"> context: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> dollar: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ $ }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> template: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- template "flant" .Chart -}}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ define "flant" }}</span></span><span class="xml"><span class="xml"> context: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> dollar: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ $ }}</span></span><span class="xml"><span class="xml"> with: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .Name }}</span></span><span class="xml"><span class="xml"> context: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ . }}</span></span><span class="xml"><span class="xml"> dollar: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ $ }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end -}}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Sebagai hasil dari pemrosesan templat ini, yang berikut akan berubah (untuk kejelasan, dalam output struktur diganti dengan nama-semu yang sesuai): <br><br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">context</span></span>: #  helm dollar: #  helm <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">context</span></span>: #.Chart dollar: #  helm template: <span class="hljs-keyword"><span class="hljs-keyword">context</span></span>: #.Chart dollar: #.Chart <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">context</span></span>: habr dollar: #.Chart</code> </pre><br>  Dan di sini adalah contoh nyata menggunakan fitur ini: <br><br><pre> <code class="hljs powershell">{{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .Values.ingress.enabled -}} {{- range .Values.ingress.hosts }} apiVersion: extensions/v1beta1 kind: Ingress metadata: name: {{ template <span class="hljs-string"><span class="hljs-string">"nats.fullname"</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span> }}<span class="hljs-literal"><span class="hljs-literal">-monitoring</span></span> labels: app: <span class="hljs-string"><span class="hljs-string">"{{ template "</span></span>nats.name<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string"> }}"</span></span> chart: <span class="hljs-string"><span class="hljs-string">"{{ template "</span></span>nats.chart<span class="hljs-string"><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string"> }}"</span></span> release: {{ <span class="hljs-variable"><span class="hljs-variable">$</span></span>.Release.Name | quote }} heritage: {{ <span class="hljs-variable"><span class="hljs-variable">$</span></span>.Release.Service | quote }} annotations: {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .tls }} ingress.kubernetes.io/secure<span class="hljs-literal"><span class="hljs-literal">-backends</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span> {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} {{- range <span class="hljs-variable"><span class="hljs-variable">$key</span></span>, <span class="hljs-variable"><span class="hljs-variable">$value</span></span> := .annotations }} {{ <span class="hljs-variable"><span class="hljs-variable">$key</span></span> }}: {{ <span class="hljs-variable"><span class="hljs-variable">$value</span></span> | quote }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} spec: rules: - host: {{ .name }} http: paths: - path: {{ default <span class="hljs-string"><span class="hljs-string">"/"</span></span> .path }} backend: serviceName: {{ template <span class="hljs-string"><span class="hljs-string">"nats.fullname"</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span> }}<span class="hljs-literal"><span class="hljs-literal">-monitoring</span></span> servicePort: monitoring {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .tls }} tls: - hosts: - {{ .name }} secretName: {{ .tlsSecret }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} --- {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }}</code> </pre><br><h3>  Lekukan </h3><br>  Saat mengembangkan templat, margin tambahan mungkin tersisa: spasi, tab, umpan baris.  Dengan mereka, file hanya terlihat lebih mudah dibaca.  Anda dapat mengabaikannya, atau menggunakan sintaks khusus untuk menghapus lekukan di sekitar pola yang digunakan: <br><br><ul><li>  <code>{{- variable }}</code> memotong spasi sebelumnya; </li><li>  <code>{{ variable -}}</code> memotong spasi berikutnya; </li><li>  <code>{{- variable -}}</code> keduanya opsi. </li></ul><br>  Contoh file, yang pengolahannya akan menjadi garis <code>habr flant helm</code> : <br><br><pre> <code class="hljs objectivec">habr {{- <span class="hljs-string"><span class="hljs-string">" flant "</span></span> -}} helm</code> </pre><br><h3>  Fungsi bawaan </h3><br>  Semua fungsi yang dibangun dalam templat dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan berikut</a> .  Di sini saya hanya akan bercerita tentang beberapa di antaranya. <br><br>  Fungsi <b><code>index</code></b> dirancang untuk mengakses elemen array atau peta: <br><br><pre> <code class="hljs powershell">definitions.json: | { <span class="hljs-string"><span class="hljs-string">"users"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"{{ index .Values "</span></span><span class="hljs-type"><span class="hljs-type">rabbitmq</span></span>-<span class="hljs-type"><span class="hljs-type">ha</span></span><span class="hljs-string"><span class="hljs-string">" "</span></span><span class="hljs-type"><span class="hljs-type">rabbitmqUsername</span></span><span class="hljs-string"><span class="hljs-string">" }}"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"{{ index .Values "</span></span><span class="hljs-type"><span class="hljs-type">rabbitmq</span></span>-<span class="hljs-type"><span class="hljs-type">ha</span></span><span class="hljs-string"><span class="hljs-string">" "</span></span><span class="hljs-type"><span class="hljs-type">rabbitmqPassword</span></span><span class="hljs-string"><span class="hljs-string">" }}"</span></span>, <span class="hljs-string"><span class="hljs-string">"tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"administrator"</span></span> } ] }</code> </pre><br>  Fungsi ini mengambil sejumlah argumen sembarang, yang memungkinkan Anda untuk bekerja dengan elemen bersarang: <br><br> <code>$map["key1"]["key2"]["key3"] =&gt; index $map "key1" "key2" "key3"</code> <br> <br>  Sebagai contoh: <br><br><pre> <code class="hljs axapta">httpGet: {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> .Values <span class="hljs-string"><span class="hljs-string">"pushgateway"</span></span> <span class="hljs-string"><span class="hljs-string">"extraArgs"</span></span> <span class="hljs-string"><span class="hljs-string">"web.route-prefix"</span></span>) }} path: /{{ <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> .Values <span class="hljs-string"><span class="hljs-string">"pushgateway"</span></span> <span class="hljs-string"><span class="hljs-string">"extraArgs"</span></span> <span class="hljs-string"><span class="hljs-string">"web.route-prefix"</span></span> }}/<span class="hljs-meta"><span class="hljs-meta">#/status {{- end }}</span></span></code> </pre><br>  <b>Operasi Boolean</b> diimplementasikan dalam mesin template sebagai fungsi (dan <b>bukan</b> sebagai operator).  Semua argumen untuk mereka dievaluasi ketika melewati: <br><br><pre> <code class="hljs perl">{{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> .Values field) (e<span class="hljs-string"><span class="hljs-string">q (len .Values.field)</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>) }} ... {{ end }}</code> </pre><br>  Jika tidak ada bidang <code>field</code> rendering templat akan gagal ( <code>error calling len: len of untyped nil</code> ): kondisi kedua dicentang, meskipun faktanya yang pertama belum terpenuhi.  Sebaiknya buat catatan, dan pecahkan pertanyaan seperti itu dengan membagi menjadi beberapa cek: <br><br><pre> <code class="hljs perl">{{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> . field }} {{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e<span class="hljs-string"><span class="hljs-string">q (len .field)</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> }} ... {{ end }} {{ end }}</code> </pre><br>  <b>Pipeline</b> adalah fitur unik templat Go yang memungkinkan Anda mendeklarasikan ekspresi yang dieksekusi seperti pipeline di shell.  Secara formal, pipeline adalah rantai perintah yang dipisahkan oleh simbol <code>|</code>  .  Perintah dapat berupa <b>nilai</b> sederhana <b>atau panggilan fungsi</b> .  Hasil dari setiap perintah dilewatkan sebagai <b>argumen terakhir ke perintah berikutnya</b> , dan hasil dari perintah terakhir dalam pipa adalah nilai dari keseluruhan pipa.  Contoh: <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">: openssl.conf: | {{ .</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Files</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Get</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">config</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">openssl</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conf</span></span></span><span class="hljs-class">" | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">indent</span></span></span><span class="hljs-class"> 4 }}</span></span></code> </pre><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">: db-password: {{ .</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Values</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">externalDatabase</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">password</span></span></span><span class="hljs-class"> | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b64enc</span></span></span><span class="hljs-class"> | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quote</span></span></span><span class="hljs-class"> }}</span></span></code> </pre><br><h3>  Fungsi tambahan </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>Sprig</b></a> adalah pustaka <b>70 fitur yang berguna</b> untuk menyelesaikan berbagai tugas.  Untuk alasan keamanan, Helm mengecualikan fungsi <code>env</code> dan <code>expandenv</code> yang menyediakan akses ke variabel lingkungan Tiller. <br><br>  Fungsi <code>include</code> , seperti fungsi <code>template</code> standar, digunakan untuk menggunakan kembali templat.  Tidak seperti <code>template</code> , fungsi tersebut dapat digunakan dalam pipa, mis.  meneruskan hasilnya ke fungsi lain: <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">metadata: labels: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ include "labels.standard" . | indent 4 }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- define "labels.standard" -}}</span></span><span class="xml"><span class="xml"> app: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ include "hlf-couchdb.name" . }}</span></span><span class="xml"><span class="xml"> heritage: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Release.Service | quote }}</span></span><span class="xml"><span class="xml"> release: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ .Release.Name | quote }}</span></span><span class="xml"><span class="xml"> chart: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ include "hlf-couchdb.chart" . }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end -}}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Fungsi yang <b><code>required</code></b> memungkinkan pengembang untuk mendeklarasikan nilai wajib yang diperlukan untuk merender templat: jika ada suatu nilai, itu digunakan saat merender templat, jika tidak, rendering berakhir dengan pesan kesalahan yang ditunjukkan oleh pengembang: <br><br><pre> <code class="hljs ruby">sftp-<span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> {{ required <span class="hljs-string"><span class="hljs-string">"Please specify the SFTP user name at .Values.sftp.user"</span></span> .Values.sftp.user <span class="hljs-params"><span class="hljs-params">| b64enc |</span></span> quote }} sftp-<span class="hljs-symbol"><span class="hljs-symbol">password:</span></span> {{ required <span class="hljs-string"><span class="hljs-string">"Please specify the SFTP user password at .Values.sftp.password"</span></span> .Values.sftp.password <span class="hljs-params"><span class="hljs-params">| b64enc |</span></span> quote }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .Values.svn.enabled }} svn-<span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> {{ required <span class="hljs-string"><span class="hljs-string">"Please specify the SVN user name at .Values.svn.user"</span></span> .Values.svn.user <span class="hljs-params"><span class="hljs-params">| b64enc |</span></span> quote }} svn-<span class="hljs-symbol"><span class="hljs-symbol">password:</span></span> {{ required <span class="hljs-string"><span class="hljs-string">"Please specify the SVN user password at .Values.svn.password"</span></span> .Values.svn.password <span class="hljs-params"><span class="hljs-params">| b64enc |</span></span> quote }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .Values.webdav.enabled }} webdav-<span class="hljs-symbol"><span class="hljs-symbol">user:</span></span> {{ required <span class="hljs-string"><span class="hljs-string">"Please specify the WebDAV user name at .Values.webdav.user"</span></span> .Values.webdav.user <span class="hljs-params"><span class="hljs-params">| b64enc |</span></span> quote }} webdav-<span class="hljs-symbol"><span class="hljs-symbol">password:</span></span> {{ required <span class="hljs-string"><span class="hljs-string">"Please specify the WebDAV user password at .Values.webdav.password"</span></span> .Values.webdav.password <span class="hljs-params"><span class="hljs-params">| b64enc |</span></span> quote }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }}</code> </pre><br>  Fungsi <b><code>tpl</code></b> memungkinkan Anda untuk membuat string sebagai templat.  Tidak seperti <code>template</code> dan <code>include</code> , fungsi ini memungkinkan Anda untuk mengeksekusi templat yang dikirimkan dalam variabel, serta membuat templat yang disimpan tidak hanya di direktori <code>templates</code> .  Seperti apa bentuknya? <br><br>  Menjalankan templat dari variabel: <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">containers: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- with .Values.keycloak.extraContainers }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ tpl . $ | indent 2 }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{- end }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  ... dan dalam <code>values.yaml</code> kita memiliki nilai berikut: <br><br><pre> <code class="hljs powershell">keycloak: extraContainers: | - name: cloudsql<span class="hljs-literal"><span class="hljs-literal">-proxy</span></span> image: gcr.io/cloudsql<span class="hljs-literal"><span class="hljs-literal">-docker</span></span>/gce<span class="hljs-literal"><span class="hljs-literal">-proxy</span></span>:<span class="hljs-number"><span class="hljs-number">1.11</span></span> command: - /cloud_sql_proxy args: - <span class="hljs-literal"><span class="hljs-literal">-instances</span></span>={{ .Values.cloudsql.project }}:{{ .Values.cloudsql.region }}:{{ .Values.cloudsql.instance }}=tcp:<span class="hljs-number"><span class="hljs-number">5432</span></span> - <span class="hljs-literal"><span class="hljs-literal">-credential_file</span></span>=/secrets/cloudsql/credentials.json volumeMounts: - name: cloudsql<span class="hljs-literal"><span class="hljs-literal">-creds</span></span> mountPath: /secrets/cloudsql readOnly: true</code> </pre><br>  Render file yang disimpan di luar direktori <code>templates</code> : <br><br><pre> <code class="hljs cpp">apiVersion: batch/v1 kind: Job metadata: name: {{ <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-string"><span class="hljs-string">"mysqldump.fullname"</span></span> . }} labels: app: {{ <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-string"><span class="hljs-string">"mysqldump.name"</span></span> . }} chart: {{ <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-string"><span class="hljs-string">"mysqldump.chart"</span></span> . }} release: <span class="hljs-string"><span class="hljs-string">"{{ .Release.Name }}"</span></span> heritage: <span class="hljs-string"><span class="hljs-string">"{{ .Release.Service }}"</span></span> spec: backoffLimit: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>: {{ $file := .Files.Get <span class="hljs-string"><span class="hljs-string">"files/job.tpl"</span></span> }} {{ tpl $file . | indent <span class="hljs-number"><span class="hljs-number">4</span></span> }}</code> </pre><br>  ... pada bagan, di sepanjang <code>files/job.tpl</code> path <code>files/job.tpl</code> , ada templat berikut: <br><br><pre> <code class="hljs powershell">spec: containers: - name: xtrabackup image: <span class="hljs-string"><span class="hljs-string">"{{ .Values.image.repository }}:{{ .Values.image.tag }}"</span></span> imagePullPolicy: {{ .Values.image.pullPolicy | quote }} command: [<span class="hljs-string"><span class="hljs-string">"/bin/bash"</span></span>, <span class="hljs-string"><span class="hljs-string">"/scripts/backup.sh"</span></span>] envFrom: - configMapRef: name: <span class="hljs-string"><span class="hljs-string">"{{ template "</span></span>mysqldump.fullname<span class="hljs-string"><span class="hljs-string">" . }}"</span></span> - secretRef: name: <span class="hljs-string"><span class="hljs-string">"{{ template "</span></span>mysqldump.fullname<span class="hljs-string"><span class="hljs-string">" . }}"</span></span> volumeMounts: - name: backups mountPath: /backup - name: xtra<span class="hljs-built_in"><span class="hljs-built_in">backup-script</span></span> mountPath: /scripts restartPolicy: Never volumes: - name: backups {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .Values.persistentVolumeClaim }} persistentVolumeClaim: claimName: {{ .Values.persistentVolumeClaim }} {{- <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -}} {{- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .Values.persistence.enabled }} persistentVolumeClaim: claimName: {{ template <span class="hljs-string"><span class="hljs-string">"mysqldump.fullname"</span></span> . }} {{- <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> }} emptyDir: {} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} {{- <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }} - name: xtra<span class="hljs-built_in"><span class="hljs-built_in">backup-script</span></span> configMap: name: {{ template <span class="hljs-string"><span class="hljs-string">"mysqldump.fullname"</span></span> . }}<span class="hljs-literal"><span class="hljs-literal">-script</span></span></code> </pre><br>  Di sinilah pengantar dasar-dasar standardisasi di Helm berakhir ... <br><br><h2>  Kesimpulan </h2><br>  Artikel ini menjelaskan struktur grafik Helm dan memeriksa secara rinci kesulitan utama dalam pembuatannya - template: prinsip dasar, sintaksis, fungsi dan operator Templat-gulir, fungsi tambahan. <br><br>  Bagaimana cara mulai bekerja dengan semua ini?  Karena Helm sudah merupakan keseluruhan ekosistem, Anda selalu dapat melihat contoh grafik untuk paket serupa.  Misalnya, jika Anda ingin mengemas antrian pesan baru, lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">grafik publik RabbitMQ</a> .  Tentu saja, tidak ada yang menjanjikan Anda implementasi ideal dalam paket yang ada, tetapi mereka sempurna sebagai titik awal.  Selebihnya dilengkapi dengan latihan, di mana <code>helm template</code> dan <b>perintah debug</b> <code>helm lint</code> akan membantu Anda, serta memulai instalasi dengan opsi <code>--dry-run</code> . <br><br>  Untuk pemahaman yang lebih luas tentang perkembangan grafik Helm, praktik terbaik dan teknologi yang digunakan, saya sarankan Anda membiasakan diri dengan materi di tautan berikut (semua dalam bahasa Inggris): <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Panduan Pengembang Bagan</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Praktik terbaik</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi Go-template</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi setangkai perpustakaan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Repositori bagan resmi</a> (sebagai basis pengetahuan dan penerapan praktik terbaik). </li></ul><br>  Dan di akhir materi Helm berikutnya, saya melampirkan survei yang akan membantu untuk lebih memahami apa artikel lain tentang Helm yang menunggu pembaca Habr (atau tidak menunggu?).  Terima kasih atas perhatian anda! <br><br><h2>  PS </h2><br>  Baca juga di blog kami: <br><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengantar praktis untuk manajer paket untuk Kubernetes - Helm</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Package Manager untuk Kubernetes - Helm: Past, Present, Future</a> "; </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Berlatihlah dengan dapp.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian 2. Penempatan gambar Docker di Kubernetes menggunakan Helm</a> "; </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bangun dan instal aplikasi di Kubernet menggunakan dapp dan GitLab CI</a> ”; </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Praktik CI / CD Terbaik dengan Kubernetes dan GitLab</a> ” <i>(ulasan dan laporan video)</i> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id423239/">https://habr.com/ru/post/id423239/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id423229/index.html">Pencocokan pola dalam C # 7</a></li>
<li><a href="../id423231/index.html">Frango Anomaly, Climax</a></li>
<li><a href="../id423233/index.html">Kecerdasan Buatan di Dunia Nyata</a></li>
<li><a href="../id423235/index.html">Dari Dribbble ke Android Motion</a></li>
<li><a href="../id423237/index.html">Lengan robot yang sederhana namun canggih</a></li>
<li><a href="../id423241/index.html">Gambaran Umum Ponsel SIP Digip A20 dan A25</a></li>
<li><a href="../id423243/index.html">Metode rata-rata vektor untuk mengukur arah angin</a></li>
<li><a href="../id423247/index.html">Apa itu kecerdasan?</a></li>
<li><a href="../id423249/index.html">Rust 1.29 Rilis</a></li>
<li><a href="../id423251/index.html">Akun saya dari Megafail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>