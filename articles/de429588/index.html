<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈴 🍆 👨🏾‍🤝‍👨🏽 Die ganze Wahrheit über RTOS. Artikel Nr. 20. Semaphoren: Nebendienstleistungen und Datenstrukturen 👨🏽‍🚒 👨‍👩‍👧‍👦 🚇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel setzt die Überprüfung der Semaphoren fort. 

 Hilfssemaphor-Dienste 
 Nucleus RTOS verfügt über vier API-Aufrufe, die semaphorbezogene ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die ganze Wahrheit über RTOS. Artikel Nr. 20. Semaphoren: Nebendienstleistungen und Datenstrukturen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429588/"><img src="https://habrastorage.org/webt/jd/m4/f3/jdm4f3ytpbghajx290do1pujcpa.jpeg"><br><br>  Dieser Artikel setzt die Überprüfung der Semaphoren fort. <br><br><h2>  Hilfssemaphor-Dienste </h2><br>  Nucleus RTOS verfügt über vier API-Aufrufe, die semaphorbezogene Funktionen bereitstellen: Zurücksetzen eines Semaphors, Abrufen von Semaphorinformationen, Abrufen der Anzahl von Semaphoren in einer Anwendung und Abrufen von Zeigern auf alle Semaphore in einer Anwendung.  Die ersten drei sind in Nucleus SE implementiert. <br><a name="habracut"></a><br>  Frühere Artikel in der Reihe: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Semaphoren: Einführung und Grundversorgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ereignisflag-Gruppen: Hilfsdienste und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ereignisflag-Gruppen: Einführung und Basisdienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Signale</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherpartitionen: Dienste und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherbereiche: Einführung und Grundversorgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgabendatenstrukturen und nicht unterstützte API-Aufrufe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienstleistungen für die Arbeit mit Aufgaben</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben: Konfiguration und Einführung in die API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scheduler: Erweiterte Funktionen und Kontexterhaltung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scheduler: Implementierung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nucleus SE: Internes Design und Bereitstellung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nucleus SE: Einführung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Andere RTOS-Dienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgabeninteraktion und Synchronisation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben, Kontextwechsel und Interrupts</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben und Planung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTOS: Struktur und Echtzeitmodus</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTOS: Einführung.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a> <br><h3>  Semaphor zurücksetzen </h3><br>  Dieser API-Aufruf setzt das Semaphor auf seinen ursprünglichen, nicht verwendeten Zustand zurück.  Diese API-Funktion ist im Vergleich zu den Funktionen anderer Kernelobjekte ungewöhnlich, da trotz der Tatsache, dass ein Reset durchgeführt wird, nicht nur der Zähler auf den Anfangswert gesetzt wird, sondern im Aufruf ein neuer Anfangszählerwert übergeben wird.  Jede Aufgabe, die auf dem Semaphor angehalten wurde, wird <b>fortgesetzt</b> und gibt den <b>NUSE_SEMAPHORE_WAS_RESET-</b> Code in Nucleus SE und in Nucleus RTOS, <b>NU_SEMAPHORE_RESET, zurück</b> . <br><br>  <b><i>Aufruf zum Zurücksetzen des Semaphors in Nucleus RTOS</i></b> <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NU_Reset_Semaphore (NU_SEMAPHORE * -Semaphor, UNSIGNED initial_count);</b> <br><br>  Parameter: <br><br>  <b>Semaphor</b> - Zeiger auf den vom Benutzer bereitgestellten Semaphor-Steuerblock; <br>  <b>initial_count</b> - Der Wert, auf den das Semaphor gesetzt wird. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_SEMAPHORE</b> - <b>Ungültiger</b> Semaphorzeiger. <br><br>  <b><i>Aufruf zum Zurücksetzen eines Semaphors in Nucleus SE</i></b> <br>  Dieser API-Aufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NUSE_Semaphore_Reset (NUSE_SEMAPHORE-Semaphor, U8 initial_count);</b> <br><br>  Parameter: <br><br>  <b>Semaphor</b> - Index (ID) des gedumpten Semaphors; <br>  <b>initial_count</b> - Der Wert, auf den das Semaphor gesetzt wird. <br><br>  Rückgabewert: <br><br>  <b>NUSE_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NUSE_INVALID_SEMAPHORE</b> - ungültiger Semaphorindex. <br><br>  <b><i>Implementieren eines Semaphor-Resets in Nucleus SE</i></b> <br><br>  Die Hauptaufgabe der API-Funktion <b>NUSE_Semaphore_Reset ()</b> besteht darin, das entsprechende Element <b>NUSE_Semaphore_Counter []</b> auf den angegebenen Wert zu setzen (nach Überprüfung der Parameter). <br><br>  Wenn die Task-Sperre aktiviert ist, ist der folgende Code erforderlich, um Aufgaben zu entsperren: <br><br><pre><code class="plaintext hljs">while (NUSE_Semaphore_Blocking_Count[semaphore] != 0) { U8 index; /* check whether any tasks are blocked */ /* on this semaphore */ for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_SEMAPHORE_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == semaphore)) { NUSE_Task_Blocking_Return[index] = NUSE_SEMAPHORE_WAS_RESET; NUSE_Task_Status[index] = NUSE_READY; break; } } NUSE_Semaphore_Blocking_Count[semaphore]--; } #if NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER NUSE_Reschedule(NUSE_NO_TASK); #endif</code> </pre> <br>  Jede auf dem Semaphor angehaltene Aufgabe wird als " <b>erledigt</b> " markiert, und der Aufgabenunterbrechungscode gibt <b>NUSE_SEMAPHORE_WAS_RESET zurück</b> .  Wenn dieser Vorgang abgeschlossen ist und der Prioritätsplaner verwendet wird, initialisiert der Aufruf <b>NUSE_Reschedule ()</b> , da eine oder mehrere Aufgaben mit einer höheren Priorität in einen Bereitschaftszustand versetzt werden können und auf die Wiederaufnahme warten. <br><br><h3>  Semaphorinformationen </h3><br>  Dieser Dienstprogrammaufruf gibt Semaphorinformationen zurück.  Die Implementierung dieses Aufrufs in Nucleus SE unterscheidet sich von Nucleus RTOS darin, dass weniger Informationen zurückgegeben werden, da die Benennung von Objekten und die Reihenfolge der Suspendierung nicht unterstützt werden und die Suspendierung von Aufgaben selbst deaktiviert werden kann. <br><br>  <b><i>Fordern Sie Semaphorinformationen in Nucleus RTOS an</i></b> <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NU_Semaphore_Information (NU_SEMAPHORE * Semaphor, CHAR * Name, UNSIGNED * current_count, OPTION * suspend_type, UNSIGNED * task_waiting, NU_TASK ** first_task);</b> <br><br>  Parameter: <br><br>  <b>Semaphor</b> - ein Zeiger auf den Semaphor-Steuerblock, über den Informationen benötigt werden; <br>  <b>name</b> - Zeiger auf den 8-stelligen Namen des Semaphors, wobei in diesem Bereich ein Null-Abschlussbyte enthalten ist; <br>  <b>current_count</b> - ein Zeiger auf eine Variable, die den aktuellen Wert des Semaphorzählers annimmt; <br>  <b>suspend_type</b> - Ein Zeiger auf eine Variable, die den Typ der Suspend-Task <b>akzeptiert</b> und die Werte <b>NU_FIFO</b> und <b>NU_PRIORITY annehmen kann</b> . <br>  <b>task_waiting</b> - ein Zeiger auf eine Variable, die die Anzahl der angehaltenen Aufgaben im Semaphor übernimmt; <br>  <b>first_task</b> - Ein Zeiger auf eine Variable vom Typ <b>NU_TASK</b> , der einen Zeiger auf die Steuereinheit der ersten angehaltenen Task nimmt. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_SEMAPHORE</b> - <b>Ungültiger</b> Semaphorzeiger. <br><br>  <b><i>Fordern Sie Semaphorinformationen in Nucleus SE an</i></b> <br>  Dieser API-Aufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NUSE_Semaphore_Information (NUSE_SEMAPHORE-Semaphor, U8 * current_count, U8 *asks_waiting, NUSE_TASK * first_task);</b> <br><br>  Parameter: <br><br>  <b>Semaphor</b> - ein Index eines Semaphors, über den Informationen bereitgestellt werden müssen; <br>  <b>current_count</b> - ein Zeiger auf eine Variable, die den aktuellen Wert des Semaphorzählers annimmt; <br>  <b>task_waiting</b> - ein Zeiger auf eine Variable, die die Anzahl der auf diesem Semaphor angehaltenen Aufgaben übernimmt (nichts wird zurückgegeben, wenn die Unterstützung für das Anhalten von Aufgaben deaktiviert ist); <br>  <b>first_task</b> - Ein Zeiger auf eine Variable vom Typ <b>NUSE_TASK</b> , die den Index der ersten angehaltenen Aufgabe übernimmt (nichts wird zurückgegeben, wenn die Unterstützung für angehaltene Aufgaben deaktiviert ist). <br><br>  Rückgabewert: <br><br>  <b>NUSE_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NUSE_INVALID_SEMAPHORE</b> - ungültiger Semaphorindex; <br>  <b>NUSE_INVALID_POINTER</b> - Ein oder mehrere <b>Zeigerparameter</b> sind falsch. <br><br>  <b><i>Implementieren von Semaphorinformationen in Nucleus SE</i></b> <br><br>  Die Implementierung dieses API-Aufrufs ist ziemlich einfach: <br><br><pre> <code class="plaintext hljs">NUSE_CS_Enter(); *current_count = NUSE_Semaphore_Counter[semaphore]; #if NUSE_BLOCKING_ENABLE *tasks_waiting = NUSE_Semaphore_Blocking_Count[semaphore]; if (NUSE_Semaphore_Blocking_Count[semaphore] != 0) { U8 index; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_SEMAPHORE_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == semaphore)) { *first_task = index; break; } } } else { *first_task = 0; } #else *tasks_waiting = 0; *first_task = 0; #endif NUSE_CS_Exit(); return NUSE_SUCCESS;</code> </pre><br>  Die Funktion gibt den Status des Semaphors zurück.  Wenn dann die API-Aufrufblockierungsfunktion aktiviert ist, werden die Anzahl der ausstehenden Aufgaben und der Index der ersten zurückgegeben (andernfalls werden diese Parameter auf 0 gesetzt). <br><br><h3>  Ermitteln der Anzahl der Semaphoren </h3><br>  Dieser Dienstprogrammaufruf gibt die Anzahl der Semaphoren in der Anwendung zurück.  In Nucleus RTOS ändert sich dieser Wert im Laufe der Zeit und der Rückgabewert entspricht der aktuellen Anzahl von Semaphoren. In Nucleus SE wird der Rückgabewert in der Montagephase festgelegt und ändert sich nicht mehr. <br><br>  <b><i>Aufrufen eines Semaphorzählers in Nucleus RTOS</i></b> <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>UNSIGNED NU_Established_Semaphores (VOID);</b> <br><br>  Parameter: <br>  Sind abwesend. <br><br>  Rückgabewert: <br>  Die Anzahl der in der Anwendung erstellten Semaphoren. <br><br>  <b><i>Aufrufen eines Semaphorzählers in Nucleus SE</i></b> <br>  Dieser API-Aufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>U8 NUSE_Semaphore_Count (void);</b> <br><br>  Parameter: <br>  Sind abwesend. <br><br>  Rückgabewert: <br>  Die Anzahl der in der Anwendung konfigurierten Semaphoren. <br><br>  <b><i>Implementierung von Semaphorzählern in Nucleus SE</i></b> <br>  Die Implementierung dieses API-Aufrufs ist recht einfach: Der Wert des Symbols <b>#define</b> <b>NUSE_SEMAPHORE_NUMBER</b> wird <b>zurückgegeben</b> . <br><br><h2>  Datenstrukturen </h2><br>  Semaphoren verwenden zwei oder drei Arrays von Datenstrukturen (in RAM und ROM), die wie alle anderen Nucleus SE-Objekte eine Reihe von Tabellen sind, deren Größe von der Anzahl der Semaphoren in der Anwendung und den ausgewählten Parametern abhängt. <br><br>  Ich empfehle dringend, dass der Anwendungscode keinen direkten Zugriff auf diese Datenstrukturen verwendet, sondern über die bereitgestellten API-Funktionen auf sie verweist.  Dies vermeidet Inkompatibilität mit zukünftigen Versionen von Nucleus SE und unerwünschte Nebenwirkungen und vereinfacht die Portierung der Anwendung auf Nucleus RTOS.  Zum besseren Verständnis der Funktionsweise des Serviceabrufcodes und zum Debuggen wird im Folgenden eine detaillierte Übersicht über die Datenstrukturen gegeben. <br><br><h3>  RAM-Daten </h3><br>  Diese Daten haben folgende Struktur: <br>  <b>NUSE_Semaphore_Counter []</b> - Ein Array vom Typ <b>U8</b> , das für jedes konfigurierte Semaphor einen Eintrag enthält und den Wert des Zählers speichert. <br>  <b>NUSE_Semaphore_Blocking_Count []</b> - Ein Array vom Typ <b>U8</b> enthält Zähler für Aufgaben, die auf jedem Semaphor blockiert sind.  Dieses Array ist nur vorhanden, wenn die API-Aufrufblockierungsfunktion aktiviert ist. <br>  <b>NUSE_Semaphore_Counter [] wird</b> auf den Anfangswert initialisiert (siehe "Daten im ROM" unten), und <b>NUSE_Semaphore_Blocking_Count [] wird</b> beim Start von Nucleus SE mit <b>NUSE_Init_Semaphore () zurückgesetzt</b> .  Einer der folgenden Artikel enthält eine vollständige Beschreibung der Startvorgänge von Nucleus SE. <br><br>  Im Folgenden sind die Definitionen dieser Datenstrukturen in der Datei <b>nuse_init.c aufgeführt</b> . <br><br><pre> <code class="plaintext hljs">RAM U8 NUSE_Semaphore_Counter[NUSE_SEMAPHORE_NUMBER]; #if NUSE_BLOCKING_ENABLE RAM U8 NUSE_Semaphore_Blocking_Count[NUSE_SEMAPHORE_NUMBER]; #endif</code> </pre><br><h3>  ROM-Daten </h3><br>  Datenstruktur: <br>  <b>NUSE_Semaphore_Initial_Value []</b> - Ein Array vom Typ <b>U8</b> mit einem Datensatz für jedes Semaphor. Dies sind die Anfangswerte der Semaphoren. <br><br>  Diese Datenstruktur wird in <b>nuse_config.c</b> deklariert und (statisch) <b>initialisiert</b> : <br><br><pre> <code class="plaintext hljs">ROM U8 NUSE_Semaphore_Initial_Value[NUSE_SEMAPHORE_NUMBER] = { /* semaphore initial count values */ };</code> </pre><br><h3>  Die Speichermenge für Semaphoren </h3><br>  Wie bei allen Nucleus SE-Kernelobjekten ist die für Semaphoren benötigte Datenmenge vorhersehbar. <br><br>  Die Speichermenge im ROM (in Byte) für alle Semaphoren in der Anwendung beträgt <b>NUSE_SEMAPHORE_NUMBER</b> . <br><br>  Die Speichermenge im RAM (in Byte) für alle Semaphore in der Anwendung mit aktivierten Aufrufen der Sperr-API kann wie folgt berechnet werden: <br> <code>NUSE_SEMAPHORE_NUMBER * 2</code> <br> <br>  Andernfalls ist es <b>NUSE_SEMAPHORE_NUMBER</b> . <br><br><h2>  Nicht realisierte API-Aufrufe </h2><br>  Drei API-Aufrufe für Semaphoren, die in Nucleus RTOS vorhanden sind, sind in Nucleus SE nicht implementiert. <br><br><h3>  Semaphore erstellen </h3><br>  Dieser API-Aufruf erstellt ein Semaphor.  Nucleus SE ist nicht erforderlich, da Semaphoren statisch erstellt werden. <br><br>  Prototyp eines Serviceabrufs: <br>  <b>STATUS NU_Create_Semaphore (NU_SEMAPHORE * -Semaphor, CHAR * -Name, UNSIGNED initial_count, OPTION suspend_type);</b> <br><br>  Parameter: <br><br>  <b>Semaphor</b> - ein Zeiger auf einen vom Benutzer bereitgestellten Semaphor-Steuerblock, der zum Steuern von Semaphoren in anderen API-Aufrufen verwendet wird; <br>  <b>name</b> - ein Zeiger auf den 8-stelligen Semaphornamen mit dem abschließenden Nullbyte; <br>  <b>initial_count</b> - der Anfangswert des Semaphors; <br>  <b>suspend_type</b> - Gibt das Prinzip an, eine Aufgabe auf einem Semaphor <b>anzuhalten</b> .  Es kann die Werte <b>NU_FIFO</b> und <b>NU_PRIORITY annehmen</b> , die dem FIFO-Prinzip (First-in-First-Out) und der Prioritätsreihenfolge der Aussetzung von Aufgaben entsprechen. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_SEMAPHORE</b> - <b>Gibt an,</b> dass der Zeiger auf den Semaphor-Steuerblock <b>NULL ist</b> oder bereits verwendet wird. <br>  <b>NU_INVALID_SUSPEND</b> - ungültiger <b>suspend_type-</b> Parameter. <br><br><h3>  Semaphorentfernung </h3><br>  Dieser API-Aufruf entfernt das zuvor erstellte Semaphor.  Nucleus SE wird nicht benötigt, da Semaphoren statisch erstellt werden und nicht gelöscht werden können. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NU_Delete_Semaphore (NU_SEMAPHORE * -Semaphor);</b> <br><br>  Parameter: <br><br>  <b>Semaphor</b> - Zeiger auf den Semaphor-Steuerblock. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_SEMAPHORE</b> - <b>Ungültiger</b> Semaphorzeiger. <br><br><h3>  Zeiger auf Semaphoren </h3><br>  Dieser API-Aufruf bildet eine sequentielle Liste von Zeigern auf alle Semaphoren im System.  Nucleus SE wird nicht benötigt, da Semaphoren durch einen einfachen Index und nicht durch einen Zeiger identifiziert werden. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>UNSIGNED NU_Semaphore_Pointers (NU_SEMAPHORE ** Zeigerliste, UNSIGNED Maximum_Pointers);</b> <br><br>  Parameter: <br><br>  <b>pointer_list</b> - ein Zeiger auf ein Array von Zeigern <b>NU_SEMAPHORE</b> , dieses Array ist mit Zeigern auf Semaphoren gefüllt; <br>  <b>Maximum_Pointers</b> - Die maximale Anzahl von Zeigern im Array. <br><br>  Rückgabewert: <br>  Die Anzahl der <b>NU_SEMAPHORE-</b> Zeiger im Array. <br><br><h2>  Nucleus RTOS-kompatibel </h2><br>  Wie bei allen anderen Nucleus SE-Objekten bestand das Ziel darin, die Kompatibilität des Anwendungscodes mit Nucleus RTOS zu maximieren.  Semaphoren sind keine Ausnahme und werden aus Anwendersicht auf die gleiche Weise wie in Nucleus RTOS implementiert.  Es gibt auch eine gewisse Inkompatibilität, die ich als akzeptabel angesehen habe, da der endgültige Code in Bezug auf die erforderliche Speichermenge verständlicher und effizienter wird.  Andernfalls können Nucleus RTOS-API-Aufrufe fast direkt als Nucleus SE-Aufrufe verwendet werden. <br><br><h3>  Objektkennungen </h3><br>  In Nucleus RTOS werden alle Objekte durch Datenstrukturen (Steuereinheiten) eines bestimmten Typs beschrieben.  Ein Zeiger auf diese Steuereinheit dient als Kennung für das Semaphor.  Ich entschied, dass in Nucleus SE ein anderer Ansatz für die effiziente Nutzung des Speichers erforderlich ist: Alle Kernelobjekte werden durch eine Reihe von Tabellen im RAM und / oder ROM beschrieben.  Die Größe dieser Tabellen wird durch die Anzahl der konfigurierten Objekte jedes Typs bestimmt.  Die Kennung eines bestimmten Objekts ist der Index in dieser Tabelle.  Also habe ich <b>NUSE_SEMAPHORE</b> als das Äquivalent von <b>U8 definiert</b> . Eine Variable (kein Zeiger) dieses Typs dient als Kennung für das Semaphor.  Diese leichte Inkompatibilität ist leicht zu handhaben, wenn der Code von Nucleus SE nach Nucleus RTOS und umgekehrt portiert wird.  In der Regel werden keine anderen Operationen an Objektkennungen als Verschieben und Speichern ausgeführt. <br><br>  Nucleus RTOS unterstützt auch die Benennung von Semaphoren.  Diese Namen werden nur zum Debuggen verwendet.  Ich habe sie von Nucleus SE ausgeschlossen, um Speicherplatz zu sparen. <br><br><h3>  Zählergröße </h3><br>  Unter Nucleus RTOS ist der Semaphorzähler vom Typ <b>ohne Vorzeichen</b> , bei dem es sich normalerweise um eine 32-Bit-Variable handelt.  Nucleus SE verfügt über einen 8-Bit-Zähler, der jedoch leicht geändert werden kann.  Normalerweise prüft Nucleus RTOS nicht, ob ein Semaphor überläuft.  Durch Aufrufen der Nucleus SE-API können dem Zähler keine Werte über 255 zugewiesen werden. <br><br><h3>  Nicht realisierte API-Aufrufe </h3><br>  Nucleus RTOS unterstützt acht Dienstprogrammaufrufe für die Arbeit mit Semaphoren.  Von diesen sind drei in Nucleus SE nicht implementiert.  Die Details dieser Herausforderungen sowie die Entscheidung, sie von Nucleus SE auszuschließen, wurden oben beschrieben. <br><br>  Der folgende Artikel untersucht Postfächer. <br><br>  <b>Über den Autor:</b> Colin Walls ist seit über dreißig Jahren in der Elektronikindustrie tätig und widmet sich die meiste Zeit der Firmware.  Heute ist er Firmware-Ingenieur bei Mentor Embedded (einer Abteilung von Mentor Graphics).  Colin Walls spricht häufig auf Konferenzen und Seminaren, Autor zahlreicher technischer Artikel und zweier Bücher über Firmware.  Lebt in Großbritannien.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Colins</a> professioneller <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blog</a> , E-Mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429588/">https://habr.com/ru/post/de429588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429574/index.html">Kostenloser Check Point für Anfängerkurs bei CheckMates</a></li>
<li><a href="../de429578/index.html">Welche Fehler sind im Infer.NET-Code versteckt?</a></li>
<li><a href="../de429580/index.html">Mikrointeraktionen in iOS. Yandex Vortrag</a></li>
<li><a href="../de429582/index.html">Analoge Anzeige der Computerlast</a></li>
<li><a href="../de429586/index.html">So bestimmen Sie den besten Zeitpunkt für den Handel an der Börse</a></li>
<li><a href="../de429590/index.html">Sprachanalyse für SOLR-basierte Call Center</a></li>
<li><a href="../de429592/index.html">Wie Bankkarten die Wirtschaft beeinflussen und warum der Spielball nicht abhebt</a></li>
<li><a href="../de429594/index.html">Molekulare mikromotorische Geschwindigkeitsanalyse für die HIV-Diagnose</a></li>
<li><a href="../de429596/index.html">Was Sie in Java tun müssen, um maschinelles Lernen vollständig zu unterstützen</a></li>
<li><a href="../de429598/index.html">RFID UHF Inventar. Wie finde ich alle Tags?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>