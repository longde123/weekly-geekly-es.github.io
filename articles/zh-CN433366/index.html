<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â„¹ï¸ ğŸ¦– ğŸ¥ åœ¨Unity3Dä¸­ä½¿ç”¨å¤–éƒ¨èµ„æº ğŸ¤²ğŸ¼ âŒ¨ï¸ ğŸ˜»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 å°Šæ•¬çš„è¯»è€…æ‚¨å¥½ï¼Œä»Šå¤©æˆ‘ä»¬å°†è®¨è®ºåœ¨Unity 3dç¯å¢ƒä¸­ä½¿ç”¨å¤–éƒ¨èµ„æºçš„é—®é¢˜ã€‚ 

 é¦–å…ˆï¼Œæ ¹æ®ä¼ ç»Ÿï¼Œæˆ‘ä»¬å°†ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒã€‚ é‚£ä¹ˆï¼Œè¿™äº›å¤–éƒ¨èµ„æºåˆ°åº•æ˜¯ä»€ä¹ˆã€‚ ä½œä¸ºæ¸¸æˆå¼€å‘çš„ä¸€éƒ¨åˆ†ï¼Œæ­¤ç±»èµ„æºå¯ä»¥æ˜¯åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œä¸åº”å­˜å‚¨åœ¨é¡¹ç›®çš„æœ€ç»ˆç‰ˆæœ¬ä¸­ã€‚ å¤–éƒ¨èµ„æºæ—¢å¯ä»¥ä½äºç”¨æˆ·è®¡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Unity3Dä¸­ä½¿ç”¨å¤–éƒ¨èµ„æº</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433366/"><h2> å¼•è¨€ </h2><br> å°Šæ•¬çš„è¯»è€…æ‚¨å¥½ï¼Œä»Šå¤©æˆ‘ä»¬å°†è®¨è®ºåœ¨Unity 3dç¯å¢ƒä¸­ä½¿ç”¨å¤–éƒ¨èµ„æºçš„é—®é¢˜ã€‚ <br><br> é¦–å…ˆï¼Œæ ¹æ®ä¼ ç»Ÿï¼Œæˆ‘ä»¬å°†ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒã€‚ é‚£ä¹ˆï¼Œè¿™äº›å¤–éƒ¨èµ„æºåˆ°åº•æ˜¯ä»€ä¹ˆã€‚ ä½œä¸ºæ¸¸æˆå¼€å‘çš„ä¸€éƒ¨åˆ†ï¼Œæ­¤ç±»èµ„æºå¯ä»¥æ˜¯åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œä¸åº”å­˜å‚¨åœ¨é¡¹ç›®çš„æœ€ç»ˆç‰ˆæœ¬ä¸­ã€‚ å¤–éƒ¨èµ„æºæ—¢å¯ä»¥ä½äºç”¨æˆ·è®¡ç®—æœºçš„ç¡¬ç›˜ä¸Šï¼Œä¹Ÿå¯ä»¥ä½äºå¤–éƒ¨WebæœåŠ¡å™¨ä¸Šã€‚ é€šå¸¸ï¼Œæ­¤ç±»èµ„æºæ˜¯æˆ‘ä»¬åŠ è½½åˆ°å·²ç»è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•æ–‡ä»¶æˆ–æ•°æ®é›†ã€‚ åœ¨Unity 3dæ¡†æ¶ä¸­ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ï¼š <br><br><ul><li> æ–‡å­—æ¡£ </li><li> çº¹ç†æ–‡ä»¶ </li><li> éŸ³é¢‘æ–‡ä»¶ </li><li> å­—èŠ‚æ•°ç»„ </li><li>  AssetBundleï¼ˆä¸Unity 3dé¡¹ç›®çš„èµ„äº§ä¸€èµ·å½’æ¡£ï¼‰ </li></ul><br> ä¸‹é¢ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°ç ”ç©¶Unity 3dä¸­å­˜åœ¨çš„ç”¨äºå¤„ç†è¿™äº›èµ„æºçš„å†…ç½®æœºåˆ¶ï¼Œä»¥åŠç¼–å†™ç”¨äºä¸WebæœåŠ¡å™¨äº¤äº’å¹¶å°†èµ„æºåŠ è½½åˆ°åº”ç”¨ç¨‹åºä¸­çš„ç®€å•ç®¡ç†å™¨ã€‚ <br><br>  <b>æ³¨æ„</b> ï¼š <i>æœ¬æ–‡</i>çš„<i>å…¶ä½™éƒ¨åˆ†ä½¿ç”¨ä½¿ç”¨Cï¼ƒ7+çš„ä»£ç ï¼Œå¹¶ä¸”æ˜¯ä¸º2018.3+ç‰ˆæœ¬ä¸­Unity3dä¸­ä½¿ç”¨çš„Roslynç¼–è¯‘å™¨è®¾è®¡çš„ã€‚</i> <br><a name="habracut"></a><br><h2>  Unity 3dçš„åŠŸèƒ½ </h2><br> åœ¨Unity 2017ä¹‹å‰ï¼Œå¼•æ“ä¸­åŒ…å«äº†ä¸€ç§æœºåˆ¶ï¼ˆä¸åŒ…æ‹¬è‡ªæˆ‘æè¿°çš„æœºåˆ¶ï¼‰æ¥å¤„ç†æœåŠ¡å™¨æ•°æ®å’Œå¤–éƒ¨èµ„æº-è¿™æ˜¯WWWç±»ã€‚ æ­¤ç±»å…è®¸ä»¥åŒæ­¥æˆ–å¼‚æ­¥å½¢å¼ï¼ˆé€šè¿‡Coroutineï¼‰ä½¿ç”¨å„ç§httpå‘½ä»¤ï¼ˆgetï¼Œpostï¼Œputç­‰ï¼‰ã€‚ ä½¿ç”¨æ­¤ç±»çš„å·¥ä½œéå¸¸ç®€å•æ˜äº†ã€‚ <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> www = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WWW(url); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> www; Debug.Log(www.text); }</code> </pre> <br> åŒæ ·ï¼Œæ‚¨ä¸ä»…å¯ä»¥è·å–æ–‡æœ¬æ•°æ®ï¼Œè¿˜å¯ä»¥è·å–å…¶ä»–æ•°æ®ï¼š <br><br><ul><li> å­—èŠ‚æ•°ç»„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-www.bytes</a> </li><li> çº¹ç†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-www.texture</a> </li><li> éŸ³é¢‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-www.GetAudioClip</a> ï¼ˆï¼‰ </li><li> èµ„äº§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-www.assetBundle</a> </li></ul><br> ä½†æ˜¯ï¼Œä»2017ç‰ˆå¼€å§‹ï¼ŒUnityå…·æœ‰<b>UnityWebRequest</b>ç±»å¼•å…¥çš„æ–°æœåŠ¡å™¨ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä½äºNetworkingåç§°ç©ºé—´ä¸­ã€‚ åœ¨Unity 2018ä¹‹å‰ï¼Œå®ƒä¸<b>WWW</b>ä¸€èµ·å­˜åœ¨ï¼Œä½†æ˜¯åœ¨<b>WWW</b>å¼•æ“çš„æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œä¸æ¨èä½¿ç”¨å®ƒï¼Œå¹¶ä¸”åœ¨å°†æ¥å®ƒå°†è¢«å®Œå…¨åˆ é™¤ã€‚ å› æ­¤ï¼Œè¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†ä»…å…³æ³¨<b>UnityWebRequest</b> ï¼ˆä»¥ä¸‹ç®€ç§°UWRï¼‰ã€‚ <br><br> ä»æ•´ä½“ä¸Šæ¥è¯´ï¼Œä½¿ç”¨UWRä¸WWWçš„æ ¸å¿ƒç›¸ä¼¼ï¼Œä½†æ˜¯å­˜åœ¨å·®å¼‚ï¼Œè¿™å°†åœ¨åé¢è®¨è®ºã€‚ ä¸‹é¢æ˜¯åŠ è½½æ–‡æœ¬çš„ç±»ä¼¼ç¤ºä¾‹ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityWebRequest(url); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.SendWebRequest(); Debug.Log(request.downloadHandler.text); request.Dispose(); }</code> </pre><br> æ–°çš„UWRç³»ç»Ÿå¼•å…¥çš„ä¸»è¦æ›´æ”¹ï¼ˆé™¤äº†æ›´æ”¹å†…éƒ¨å·¥ä½œåŸç†ä¹‹å¤–ï¼‰æ˜¯åˆ†é…å¤„ç†ç¨‹åºä»¥ä»æœåŠ¡å™¨æœ¬èº«ä¸Šè½½å’Œä¸‹è½½æ•°æ®çš„èƒ½åŠ›ï¼Œæ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>é˜…è¯»ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ˜¯ç±»<b>UploadHandler</b>å’Œ<b>DownloadHandler</b> ã€‚  Unityæœ¬èº«æä¾›äº†è¿™äº›ç±»çš„æ‰©å±•é›†ï¼Œç”¨äºå¤„ç†å„ç§æ•°æ®ï¼Œä¾‹å¦‚éŸ³é¢‘ï¼Œçº¹ç†ï¼Œèµ„äº§ç­‰ã€‚ è®©æˆ‘ä»¬è€ƒè™‘æ›´è¯¦ç»†åœ°ä¸ä»–ä»¬åˆä½œã€‚ <br><br><h2> å¤„ç†èµ„æº </h2><br><h3> æ–‡å­—å†…å®¹ </h3><br> ä½¿ç”¨æ–‡æœ¬æ˜¯æœ€ç®€å•çš„é€‰æ‹©ä¹‹ä¸€ã€‚ ä¸Šé¢å·²ç»æè¿°äº†ç”¨äºä¸‹è½½å®ƒçš„æ–¹æ³•ã€‚ æˆ‘ä»¬ä½¿ç”¨åˆ›å»ºç›´æ¥çš„http Getè¯·æ±‚æ¥é‡å†™å®ƒã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadTextFromServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequest.Get(url); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.SendWebRequest(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!request.isHttpError &amp;&amp; !request.isNetworkError) { response(uwr.downloadHandler.text); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogErrorFormat(<span class="hljs-string"><span class="hljs-string">"error request [{0}, {1}]"</span></span>, url, request.error); response(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } request.Dispose(); }</code> </pre><br> ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ­¤å¤„ä½¿ç”¨é»˜è®¤çš„<b>DownloadHandler</b> ã€‚  textå±æ€§æ˜¯ä¸€ä¸ªå°†å­—ç¬¦ä¸²æ•°ç»„è½¬æ¢ä¸ºUTF8ç¼–ç æ–‡æœ¬çš„getterã€‚ ä»æœåŠ¡å™¨åŠ è½½æ–‡æœ¬çš„ä¸»è¦ç”¨é€”æ˜¯æ¥æ”¶jsonæ–‡ä»¶ï¼ˆæ–‡æœ¬å½¢å¼çš„æ•°æ®åºåˆ—åŒ–è¡¨ç¤ºï¼‰ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨Unity <b>JsonUtility</b>ç±»è·å–æ­¤æ•°æ®ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = JsonUtility.FromJson&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-comment"><span class="hljs-comment">// T  ,    .</span></span></code> </pre><br><h3> éŸ³è®¯ </h3><br> è¦ä½¿ç”¨éŸ³é¢‘ï¼Œå¿…é¡»ä½¿ç”¨åˆ›å»º<b>UnityWebRequestMultimedia.GetAudioClip</b>è¯·æ±‚çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¹¶ä¸”è¦ä»¥åœ¨Unityä¸­ä½¿ç”¨æ‰€éœ€çš„å½¢å¼è·å–æ•°æ®è¡¨ç¤ºï¼Œå¿…é¡»ä½¿ç”¨<b>DownloadHandlerAudioClip</b> ã€‚ å¦å¤–ï¼Œåœ¨åˆ›å»ºè¯·æ±‚æ—¶ï¼Œæ‚¨å¿…é¡»æŒ‡å®šç”±<b>AudioType</b>æšä¸¾è¡¨ç¤ºçš„éŸ³é¢‘æ•°æ®çš„ç±»å‹ï¼Œè¯¥ç±»å‹è®¾ç½®æ ¼å¼ï¼ˆwavï¼Œaiffï¼Œoggvorbisç­‰ï¼‰ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadAudioFromServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, AudioType audioType, Action&lt;AudioClip&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequestMultimedia.GetAudioClip(url, audioType); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.SendWebRequest(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!request.isHttpError &amp;&amp; !request.isNetworkError) { response(DownloadHandlerAudioClip.GetContent(request)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogErrorFormat(<span class="hljs-string"><span class="hljs-string">"error request [{0}, {1}]"</span></span>, url, request.error); response(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } request.Dispose(); }</code> </pre><br><h3> è´¨æ„Ÿ </h3><br> ä¸‹è½½çº¹ç†ç±»ä¼¼äºéŸ³é¢‘æ–‡ä»¶ã€‚ è¯¥è¯·æ±‚æ˜¯ä½¿ç”¨<b>UnityWebRequestTexture.GetTexture</b>åˆ›å»ºçš„ã€‚ ä¸ºäº†è·å¾—Unityæ‰€éœ€æ ¼å¼çš„æ•°æ®ï¼Œä½¿ç”¨<b>DownloadHandlerTexture</b> ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadTextureFromServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;Texture2D&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequestTexture.GetTexture(url); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.SendWebRequest(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!request.isHttpError &amp;&amp; !request.isNetworkError) { response(DownloadHandlerTexture.GetContent(request)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogErrorFormat(<span class="hljs-string"><span class="hljs-string">"error request [{0}, {1}]"</span></span>, url, request.error); response(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } request.Dispose(); }</code> </pre><br><h3> èµ„äº§æ†ç»‘ </h3><br> å¦‚å‰æ‰€è¿°ï¼Œè¯¥æ†ç»‘åŒ…å®é™…ä¸Šæ˜¯å…·æœ‰Unityèµ„æºçš„å­˜æ¡£ï¼Œå¯ä»¥åœ¨å·²ç»è¿è¡Œçš„æ¸¸æˆä¸­ä½¿ç”¨ã€‚ è¿™äº›èµ„æºå¯ä»¥æ˜¯ä»»ä½•é¡¹ç›®èµ„äº§ï¼ŒåŒ…æ‹¬åœºæ™¯ã€‚  Cï¼ƒè„šæœ¬æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼›å®ƒä»¬æ— æ³•ä¼ é€’ã€‚ è¦åŠ è½½<b>AssetBundle</b> ï¼Œå°†ä½¿ç”¨ä½¿ç”¨<b>UnityWebRequestAssetBundle.GetAssetBundle</b>åˆ›å»ºçš„æŸ¥è¯¢<b>ã€‚</b>  <b>DownloadHandlerAssetBundle</b>ç”¨äºè·å–Unityæ‰€éœ€æ ¼å¼çš„æ•°æ®ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadBundleFromServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;AssetBundle&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequestAssetBundle.GetAssetBundle(url); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.SendWebRequest(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!request.isHttpError &amp;&amp; !request.isNetworkError) { response(DownloadHandlerAssetBundle.GetContent(request)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogErrorFormat(<span class="hljs-string"><span class="hljs-string">"error request [{0}, {1}]"</span></span>, url, request.error); response(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } request.Dispose(); }</code> </pre><br><h2> ä½¿ç”¨WebæœåŠ¡å™¨å’Œå¤–éƒ¨æ•°æ®æ—¶çš„ä¸»è¦é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ </h2><br> ä¸Šé¢å·²ç»æè¿°äº†åœ¨åŠ è½½å„ç§èµ„æºæ–¹é¢åœ¨åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œäº¤äº’çš„ç®€å•æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œäº‹æƒ…è¦å¤æ‚å¾—å¤šã€‚ è€ƒè™‘å¼€å‘äººå‘˜ä¼´éšçš„ä¸»è¦é—®é¢˜ï¼Œå¹¶è¯¦ç»†è¯´æ˜è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚ <br><br><h3> å¯ç”¨ç©ºé—´ä¸è¶³ </h3><br> ä»æœåŠ¡å™¨ä¸‹è½½æ•°æ®æ—¶çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯è®¾å¤‡ä¸Šå¯èƒ½ç¼ºå°‘å¯ç”¨ç©ºé—´ã€‚ ç”¨æˆ·ç»å¸¸ä½¿ç”¨æ—§è®¾å¤‡è¿›è¡Œæ¸¸æˆï¼ˆå°¤å…¶æ˜¯åœ¨Androidä¸Šï¼‰ï¼Œå¹¶ä¸”ä¸‹è½½æ–‡ä»¶æœ¬èº«çš„å¤§å°å¯èƒ½éå¸¸å¤§ï¼ˆHello PCï¼‰ã€‚ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œéƒ½å¿…é¡»æ­£ç¡®å¤„ç†æ­¤æƒ…å†µï¼Œå¹¶ä¸”å¿…é¡»æå‰å‘ŠçŸ¥æ’­æ”¾å™¨æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ä»¥åŠå¤šå°‘ç©ºé—´ã€‚ æ€ä¹ˆåšï¼Ÿ æ‚¨éœ€è¦çŸ¥é“çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸‹è½½æ–‡ä»¶çš„å¤§å°ï¼Œè¿™æ˜¯é€šè¿‡<b>UnityWebRequest.Headï¼ˆï¼‰</b>è¯·æ±‚å®Œæˆçš„ã€‚ ä¸‹é¢æ˜¯è·å–å¤§å°çš„ä»£ç ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConntentLength</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequest.Head(url); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.SendWebRequest(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!request.isHttpError &amp;&amp; !request.isNetworkError) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contentLength = request.GetResponseHeader(<span class="hljs-string"><span class="hljs-string">"Content-Length"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(contentLength, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> returnValue)) { response(returnValue); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { response(<span class="hljs-number"><span class="hljs-number">-1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogErrorFormat(<span class="hljs-string"><span class="hljs-string">"error request [{0}, {1}]"</span></span>, url, request.error); response(<span class="hljs-number"><span class="hljs-number">-1</span></span>); } }</code> </pre><br> åœ¨æ­¤å¤„æ³¨æ„ä¸€ä»¶äº‹å¾ˆé‡è¦ï¼Œä¸ºäº†ä½¿è¯·æ±‚æ­£å¸¸å·¥ä½œï¼ŒæœåŠ¡å™¨å¿…é¡»èƒ½å¤Ÿè¿”å›å†…å®¹çš„å¤§å°ï¼Œå¦åˆ™ï¼ˆå®é™…ä¸Šï¼Œä¸ºäº†æ˜¾ç¤ºè¿›åº¦ï¼‰å°†è¿”å›é”™è¯¯çš„å€¼ã€‚ <br><br> è·å¾—ä¸‹è½½æ•°æ®çš„å¤§å°åï¼Œå¯ä»¥å°†å…¶ä¸å¯ç”¨ç£ç›˜ç©ºé—´çš„å¤§å°è¿›è¡Œæ¯”è¾ƒã€‚ ä¸ºäº†è·å¾—åè€…ï¼Œæˆ‘ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†Asset Storeä¸­</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…è´¹æ’ä»¶</a> ã€‚ <br><br>  <b>æ³¨æ„</b> ï¼š <i>æ‚¨å¯ä»¥åœ¨Unity3dä¸­ä½¿ç”¨<b>Cache</b>ç±»ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå¯ç”¨å’Œå·²ç”¨çš„ç¼“å­˜ç©ºé—´ã€‚</i>  <i>ä½†æ˜¯ï¼Œå€¼å¾—è€ƒè™‘è¿™äº›æ•°æ®æ˜¯ç›¸å¯¹çš„ã€‚</i>  <i>å®ƒä»¬æ˜¯æ ¹æ®ç¼“å­˜æœ¬èº«çš„å¤§å°è®¡ç®—çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º4GBã€‚</i>  <i>å¦‚æœç”¨æˆ·çš„å¯ç”¨ç©ºé—´å¤§äºç¼“å­˜çš„å¤§å°ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œåˆ™è¿™äº›å€¼å¯èƒ½é‡‡ç”¨ç›¸å¯¹äºå®é™…äº‹åŠ¡çŠ¶æ€è€Œè¨€ä¸æ­£ç¡®çš„å€¼ã€‚</i> <br><br><h3> ä¸Šç½‘æ£€æŸ¥ </h3><br> é€šå¸¸ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸‹è½½ä»»ä½•å†…å®¹ä¹‹å‰ï¼Œæœ‰å¿…è¦å¤„ç†æ— æ³•è®¿é—®Internetçš„æƒ…å†µã€‚ æœ‰å‡ ç§æ–¹æ³•å¯ä»¥æ‰§è¡Œæ­¤æ“ä½œï¼šä»pingåœ°å€åˆ°google.ruçš„GETè¯·æ±‚ã€‚ ä½†æ˜¯ï¼Œæˆ‘è®¤ä¸ºï¼Œæœ€æ­£ç¡®ï¼Œæœ€å¿«é€Ÿï¼Œæœ€ç¨³å®šçš„ç»“æœæ˜¯ä»æ‚¨è‡ªå·±çš„æœåŠ¡å™¨ï¼ˆæ–‡ä»¶ä¸‹è½½ä½ç½®ç›¸åŒï¼‰ä¸‹è½½ä¸€ä¸ªå°æ–‡ä»¶ã€‚ ä¸Šé¢æœ‰å…³æ–‡æœ¬çš„éƒ¨åˆ†ä¸­ä»‹ç»äº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚ <br> é™¤äº†æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®Internetä¹‹å¤–ï¼Œè¿˜å¿…é¡»ç¡®å®šå…¶ç±»å‹ï¼ˆç§»åŠ¨è®¾å¤‡æˆ–WiFiï¼‰ï¼Œå› ä¸ºæ’­æ”¾å™¨ä¸å¤ªå¯èƒ½å¸Œæœ›ä¸‹è½½æ•°ç™¾å…†çš„ç§»åŠ¨æµé‡ã€‚ è¿™å¯ä»¥é€šè¿‡<b>Application.internetReachability</b>å±æ€§å®Œæˆã€‚ <br><br><h3> å¿«å– </h3><br> ä¸‹ä¸€ä¸ªä¹Ÿæ˜¯æœ€é‡è¦çš„é—®é¢˜ä¹‹ä¸€æ˜¯ç¼“å­˜ä¸‹è½½çš„æ–‡ä»¶ã€‚ æ­¤ç¼“å­˜ç”¨äºä»€ä¹ˆï¼Ÿ <br><br><ol><li> èŠ‚çœæµé‡ï¼ˆä¸è¦ä¸‹è½½å·²ç»ä¸‹è½½çš„æ•°æ®ï¼‰ </li><li> ç¡®ä¿åœ¨æ²¡æœ‰Internetçš„æƒ…å†µä¸‹å·¥ä½œï¼ˆæ‚¨å¯ä»¥æ˜¾ç¤ºç¼“å­˜ä¸­çš„æ•°æ®ï¼‰ã€‚ </li></ol><br> éœ€è¦ç¼“å­˜ä»€ä¹ˆï¼Ÿ è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±æ˜¯ä¸€åˆ‡ï¼Œæ‚¨ä¸‹è½½çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¿…é¡»ç¼“å­˜ã€‚ å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·åœ¨ä¸‹é¢è€ƒè™‘ï¼Œå¹¶ä»ç®€å•çš„æ–‡æœ¬æ–‡ä»¶å¼€å§‹ã€‚ <br> ä¸å¹¸çš„æ˜¯ï¼ŒUnityæ²¡æœ‰å†…ç½®çš„æœºåˆ¶æ¥ç¼“å­˜æ–‡æœ¬ï¼Œçº¹ç†å’ŒéŸ³é¢‘æ–‡ä»¶ã€‚ å› æ­¤ï¼Œå¯¹äºè¿™äº›èµ„æºï¼Œæœ‰å¿…è¦æ ¹æ®é¡¹ç›®çš„éœ€è¦ç¼–å†™ç³»ç»Ÿæˆ–ä¸ç¼–å†™ç³»ç»Ÿã€‚ åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯å°†æ–‡ä»¶å†™å…¥é«˜é€Ÿç¼“å­˜ï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰Internetçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»æ–‡ä»¶ä¸­è·å–æ–‡ä»¶ã€‚ åœ¨ç¨å¾®å¤æ‚ä¸€äº›çš„ç‰ˆæœ¬ä¸­ï¼ˆæˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº†å®ƒï¼‰ï¼Œæˆ‘ä»¬å‘æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼Œè¯¥è¯·æ±‚è¿”å›jsonï¼ŒæŒ‡ç¤ºå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶çš„ç‰ˆæœ¬ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<b>File</b>ç±»çš„Cï¼ƒç±»æˆ–æ‚¨çš„å›¢é˜Ÿæ–¹ä¾¿æ¥å—çš„ä»»ä½•å…¶ä»–æ–¹å¼ä»ç¼“å­˜ä¸­å†™å…¥å’Œè¯»å–æ–‡ä»¶ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CacheText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cacheFilePath = Path.Combine(<span class="hljs-string"><span class="hljs-string">"CachePath"</span></span>, <span class="hljs-string"><span class="hljs-string">"{0}.text"</span></span>.Fmt(fileName)); File.WriteAllText(cacheFilePath, data); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CacheTexture</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cacheFilePath = Path.Combine(<span class="hljs-string"><span class="hljs-string">"CachePath"</span></span>, <span class="hljs-string"><span class="hljs-string">"{0}.texture"</span></span>.Fmt(fileName)); File.WriteAllBytes(cacheFilePath, data); }</code> </pre><br> åŒæ ·ï¼Œä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTextFromCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cacheFilePath = Path.Combine(Utils.Path.Cache, <span class="hljs-string"><span class="hljs-string">"{0}.text"</span></span>.Fmt(fileName)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (File.Exists(cacheFilePath)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> File.ReadAllText(cacheFilePath); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Texture2D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTextureFromCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cacheFilePath = Path.Combine(Utils.Path.Cache, <span class="hljs-string"><span class="hljs-string">"{0}.texture"</span></span>.Fmt(fileName)); Texture2D texture = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (File.Exists(cacheFilePath)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = File.ReadAllBytes(cacheFilePath); texture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); texture.LoadImage(data, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> texture; }</code> </pre><br>  <b>æ³¨æ„</b> ï¼š <i>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¸¦æœ‰è¡¨å•æ–‡ä»¶urlçš„åŒä¸€UWR // //ä¸åŠ è½½çº¹ç†ã€‚</i>  <i>ç›®å‰ï¼Œå­˜åœ¨é—®é¢˜ï¼Œè¯¥æ–‡ä»¶æ ¹æœ¬æ— æ³•åŠ è½½ï¼Œå› æ­¤æˆ‘ä¸å¾—ä¸æ‰¾åˆ°ä¸€ç§è§£å†³æ–¹æ³•ã€‚</i> <br><br>  <b>æ³¨æ„</b> ï¼š <i>æˆ‘æ²¡æœ‰åœ¨é¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨AudioClipï¼Œè€Œæ˜¯å°†æ‰€æœ‰æ­¤ç±»æ•°æ®å­˜å‚¨åœ¨AssetBundleä¸­ã€‚</i>  <i>ä½†æ˜¯ï¼Œå¦‚æœ‰å¿…è¦ï¼Œå¯ä»¥ä½¿ç”¨AudioClipç±»GetDataå’ŒSetDataçš„åŠŸèƒ½è½»æ¾å®Œæˆæ­¤æ“ä½œã€‚</i> <i><br></i> <br>  Unityçš„<b>AssetBundle</b>çš„ç®€å•èµ„æºï¼ŒUnityå…·æœ‰å†…ç½®çš„ç¼“å­˜æœºåˆ¶ã€‚ è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è€ƒè™‘å®ƒã€‚ <br><br> åŸºæœ¬ä¸Šï¼Œæ­¤æœºåˆ¶å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•ï¼š <br><br><ol><li> ä½¿ç”¨CRCå’Œç‰ˆæœ¬å· </li><li> ä½¿ç”¨å“ˆå¸Œå€¼ </li></ol><br> åŸåˆ™ä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œä½†æˆ‘è‡ªå·±å†³å®šå“ˆå¸Œæ˜¯æœ€å¯æ¥å—çš„ï¼Œå› ä¸ºæˆ‘æœ‰è‡ªå·±çš„ç‰ˆæœ¬ç³»ç»Ÿï¼Œå¹¶ä¸”å®ƒä¸ä»…è€ƒè™‘äº†<b>AssetBundle</b>ç‰ˆæœ¬ï¼Œè¿˜è€ƒè™‘äº†åº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬ï¼Œå› ä¸ºæ†ç»‘é€šå¸¸å¯èƒ½ä¸è¯¥ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œåœ¨å•†åº—ä¸­å±•ç¤ºã€‚ <br><br> å› æ­¤ï¼Œå¦‚ä½•å®Œæˆç¼“å­˜ï¼š <br><br><ol><li> æˆ‘ä»¬ä»æ¸…å•æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªæ†ç»‘æ–‡ä»¶ï¼ˆæ­¤æ–‡ä»¶åœ¨åˆ›å»ºæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå¹¶åŒ…å«å¯¹å…¶åŒ…å«çš„èµ„äº§çš„æè¿°ä»¥åŠå“ˆå¸Œï¼ŒCRCï¼Œå¤§å°ç­‰ï¼‰ã€‚ è¯¥æ–‡ä»¶ä¸æ†ç»‘åŒ…åŠ ä¸Š.manifestæ‰©å±•åç›¸åŒã€‚ </li><li> ä»æ¸…å•ä¸­è·å–hash128å€¼ </li><li> æˆ‘ä»¬å‘æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªè¯·æ±‚ä»¥è·å–AssetBundleï¼Œå…¶ä¸­é™¤äº†urlå¤–ï¼Œè¿˜æŒ‡å®šæ¥æ”¶åˆ°çš„hash128å€¼ </li></ol><br><div class="spoiler">  <b class="spoiler_title">ä¸Šè¿°ç®—æ³•çš„ä»£ç ï¼š</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadAssetBundleFromServerWithCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;AssetBundle&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ,    while (!Caching.ready) { yield return null; } //     var request = UnityWebRequest.Get(url + ".manifest"); yield return request.SendWebRequest(); if (!request.isHttpError &amp;&amp; !request.isNetworkError) { Hash128 hash = default; // hash var hashRow = request.downloadHandler.text.ToString().Split("\n".ToCharArray())[5]; hash = Hash128.Parse(hashRow.Split(':')[1].Trim()); if (hash.isValid == true) { request.Dispose(); request = UnityWebRequestAssetBundle.GetAssetBundle(url, hash, 0); yield return request.SendWebRequest(); if (!request.isHttpError &amp;&amp; !request.isNetworkError) { response(DownloadHandlerAssetBundle.GetContent(request)); } else { response(null); } } else { response(null); } } else { response(null); } request.Dispose(); }</span></span></code> </pre><br></div></div><br> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒUnityåœ¨æŸ¥è¯¢æœåŠ¡å™¨æ—¶ï¼Œé¦–å…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å…·æœ‰æŒ‡å®šçš„hash128å€¼çš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†å…¶è¿”å›ï¼›å¦åˆ™ï¼Œå°†ä¸‹è½½æ›´æ–°çš„æ–‡ä»¶ã€‚ è¦åœ¨Unityä¸­ç®¡ç†æ‰€æœ‰ç¼“å­˜æ–‡ä»¶ï¼Œæœ‰ä¸€ä¸ª<b>ç¼“å­˜</b>ç±»ï¼Œé€šè¿‡è¯¥ç±»æˆ‘ä»¬å¯ä»¥æ‰¾å‡º<b>ç¼“å­˜ä¸­</b>æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œè·å–æ‰€æœ‰ç¼“å­˜çš„ç‰ˆæœ¬ä»¥åŠåˆ é™¤ä¸å¿…è¦çš„ç‰ˆæœ¬æˆ–å®Œå…¨æ¸…é™¤å®ƒã€‚ <br><br>  <b>æ³¨æ„</b> ï¼š <i>ä¸ºä»€ä¹ˆä½¿ç”¨è¿™ç§å¥‡æ€ªçš„æ–¹å¼è·å–å“ˆå¸Œå€¼ï¼Ÿ</i>  <i>è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šä»¥æ–‡æ¡£ä¸­æè¿°çš„æ–¹å¼è·å–hash128è¦æ±‚åŠ è½½æ•´ä¸ªbundleï¼Œç„¶åå†ä»ä¸­ä»¥åŠä»é‚£é‡Œå·²ç»å“ˆå¸Œå€¼ä¸­æ¥æ”¶<b>AssetBundleManifest</b>èµ„äº§ã€‚</i>  <i>è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯æ•´ä¸ªAssetBundleéƒ½åœ¨æ‘‡æ‘†ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦é¿å…è¿™ç§æƒ…å†µã€‚</i>  <i>å› æ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆä»…ä»æœåŠ¡å™¨ä¸‹è½½æ¸…å•æ–‡ä»¶ï¼Œå¹¶ä»ä¸­è·å–hash128ï¼Œç„¶åæ‰åœ¨å¿…è¦æ—¶ä¸‹è½½æ†ç»‘æ–‡ä»¶ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡å¯¹è¡Œçš„è§£é‡Šæ¥æå–hash128çš„å€¼ã€‚</i> <br><br><h3> åœ¨ç¼–è¾‘å™¨æ¨¡å¼ä¸‹ä½¿ç”¨èµ„æº </h3><br> æœ€åä¸€ä¸ªé—®é¢˜ï¼Œæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´æ˜¯è°ƒè¯•å’Œå¼€å‘ä¾¿åˆ©æ€§çš„é—®é¢˜ï¼Œæ˜¯åœ¨ç¼–è¾‘å™¨æ¨¡å¼ä¸‹ä½¿ç”¨å¯ä¸‹è½½çš„èµ„æºï¼Œå¦‚æœå¸¸è§„æ–‡ä»¶æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆä½¿ç”¨æ†ç»‘åŒ…å°±æ²¡æœ‰é‚£ä¹ˆç®€å•äº†ã€‚ å½“ç„¶ï¼Œæ‚¨å¯ä»¥æ¯æ¬¡æ„å»ºå®ƒä»¬çš„æ„å»ºï¼Œå°†å…¶ä¸Šè½½åˆ°æœåŠ¡å™¨ï¼Œç„¶ååœ¨Unityç¼–è¾‘å™¨ä¸­å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œå¹¶è§‚å¯Ÿä¸€åˆ‡å·¥ä½œåŸç†ï¼Œä½†æ˜¯å³ä½¿æ­¤æè¿°å¬èµ·æ¥ä¹Ÿåƒâ€œæ‹æ–â€ã€‚ éœ€è¦åšä¸€äº›äº‹æƒ…ï¼Œ <b>AssetDatabase</b>ç±»å°†ä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚ <br><br> ä¸ºäº†ç»Ÿä¸€ä½¿ç”¨åŒ…ï¼Œæˆ‘åšäº†ä¸€ä¸ªç‰¹æ®Šçš„åŒ…è£…ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AssetBundleWrapper</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> AssetBundle _assetBundle; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssetBundleWrapper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AssetBundle assetBundle</span></span></span><span class="hljs-function">)</span></span> { _assetBundle = assetBundle; } }</code> </pre><br> ç°åœ¨ï¼Œæ ¹æ®æˆ‘ä»¬æ˜¯åœ¨ç¼–è¾‘å™¨ä¸­è¿˜æ˜¯åœ¨æ„å»ºä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤ç§ä½¿ç”¨èµ„äº§çš„æ¨¡å¼ã€‚ å¯¹äºæ„å»ºï¼Œæˆ‘ä»¬å¯¹<b>AssetBundle</b>ç±»çš„åŠŸèƒ½ä½¿ç”¨åŒ…è£…å™¨ï¼Œå¯¹äºç¼–è¾‘å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°çš„<b>AssetDatabase</b>ç±»ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å› æ­¤ï¼Œæˆ‘ä»¬è·å¾—ä»¥ä¸‹ä»£ç ï¼š</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AssetBundleWrapper</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR private readonly List&lt;string&gt; _assets; public AssetBundleWrapper(string url) { var uri = new Uri(url); var bundleName = Path.GetFileNameWithoutExtension(uri.LocalPath); _assets = new List&lt;string&gt;(AssetDatabase.GetAssetPathsFromAssetBundle(bundleName)); } public T LoadAsset&lt;T&gt;(string name) where T : UnityEngine.Object { var assetPath = _assets.Find(item =&gt; { var assetName = Path.GetFileNameWithoutExtension(item); return string.CompareOrdinal(name, assetName) == 0; }); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!string.IsNullOrEmpty(assetPath)) { return AssetDatabase.LoadAssetAtPath&lt;T&gt;(assetPath); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { return default; } } public T[] LoadAssets&lt;T&gt;() where T : UnityEngine.Object { var returnedValues = new List&lt;T&gt;(); foreach(var assetPath in _assets) { returnedValues.Add(AssetDatabase.LoadAssetAtPath&lt;T&gt;(assetPath)); } return returnedValues.ToArray(); } public void LoadAssetAsync&lt;T&gt;(string name, Action&lt;T&gt; result) where T : UnityEngine.Object { result(LoadAsset&lt;T&gt;(name)); } public void LoadAssetsAsync&lt;T&gt;(Action&lt;T[]&gt; result) where T : UnityEngine.Object { result(LoadAssets&lt;T&gt;()); } public string[] GetAllScenePaths() { return _assets.ToArray(); } public void Unload(bool includeAllLoadedAssets = false) { _assets.Clear(); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> private readonly AssetBundle _assetBundle; public AssetBundleWrapper(AssetBundle assetBundle) { _assetBundle = assetBundle; } public T LoadAsset&lt;T&gt;(string name) where T : UnityEngine.Object { return _assetBundle.LoadAsset&lt;T&gt;(name); } public T[] LoadAssets&lt;T&gt;() where T : UnityEngine.Object { return _assetBundle.LoadAllAssets&lt;T&gt;(); } public void LoadAssetAsync&lt;T&gt;(string name, Action&lt;T&gt; result) where T : UnityEngine.Object { var request = _assetBundle.LoadAssetAsync&lt;T&gt;(name); TaskManager.Task.Create(request) .Subscribe(() =&gt; { result(request.asset as T); Unload(false); }) .Start(); } public void LoadAssetsAsync&lt;T&gt;(Action&lt;T[]&gt; result) where T : UnityEngine.Object { var request = _assetBundle.LoadAllAssetsAsync&lt;T&gt;(); TaskManager.Task.Create(request) .Subscribe(() =&gt; { var assets = new T[request.allAssets.Length]; for (var i = 0; i &lt; request.allAssets.Length; i++) { assets[i] = request.allAssets[i] as T; } result(assets); Unload(false); }) .Start(); } public string[] GetAllScenePaths() { return _assetBundle.GetAllScenePaths(); } public void Unload(bool includeAllLoadedAssets = false) { _assetBundle.Unload(includeAllLoadedAssets); } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br></div></div><br>  <b>æ³¨æ„</b> ï¼šè¯¥ä»£ç ä½¿ç”¨<b>TaskManager</b>ç±»ï¼Œä¸‹é¢å°†å¯¹å…¶è¿›è¡Œè®¨è®ºï¼Œç®€è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯ä½¿ç”¨<b>Coroutine</b>çš„åŒ…è£…å™¨ã€‚ <br><br> é™¤ä¸Šè¿°å†…å®¹å¤–ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­æŸ¥çœ‹æˆ‘ä»¬ä¸‹è½½çš„å†…å®¹å’Œå½“å‰åœ¨ç¼“å­˜ä¸­çš„å†…å®¹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è®¾ç½®è‡ªå·±çš„æ–‡ä»¶å¤¹çš„åŠŸèƒ½ï¼Œè¯¥æ–‡ä»¶å¤¹å°†ç”¨äºç¼“å­˜ï¼ˆæ‚¨ä¹Ÿå¯ä»¥å°†ä¸‹è½½çš„æ–‡æœ¬å’Œå…¶ä»–æ–‡ä»¶å†™å…¥åŒä¸€æ–‡ä»¶å¤¹ï¼‰ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR var path = Path.Combine(Directory.GetParent(Application.dataPath).FullName, "_EditorCache"); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> var path = Path.Combine(Application.persistentDataPath, "_AppCache"); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> Caching.currentCacheForWriting = Caching.AddCache(path);</span></span></code> </pre><br><h2> æˆ‘ä»¬ç¼–å†™ç½‘ç»œè¯·æ±‚ç®¡ç†å™¨æˆ–ä½¿ç”¨WebæœåŠ¡å™¨ </h2><br> ä¸Šé¢æˆ‘ä»¬æ£€æŸ¥äº†åœ¨Unityä¸­ä½¿ç”¨å¤–éƒ¨èµ„æºçš„ä¸»è¦æ–¹é¢ï¼Œç°åœ¨æˆ‘æƒ³è¯¦ç»†ä»‹ç»APIçš„å®ç°ï¼Œè¯¥APIæ¦‚æ‹¬å¹¶ç»Ÿä¸€äº†ä»¥ä¸Šæ‰€æœ‰å†…å®¹ã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆç½‘ç»œæŸ¥è¯¢ç®¡ç†å™¨ã€‚ <br><br>  <b>æ³¨æ„</b> ï¼š <i>æ­¤åï¼Œæˆ‘ä»¬ä»¥<b>TaskManager</b>ç±»çš„å½¢å¼åœ¨<b>Coroutineä¸Š</b>ä½¿ç”¨åŒ…è£…å™¨ã€‚</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­è°ˆåˆ°äº†è¿™ä¸ªåŒ…è£…å™¨</a> ã€‚</i> <br><br> è®©æˆ‘ä»¬è·å¾—ç›¸åº”çš„ç±»ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Network</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> NetworkTypeEnum { None, Mobile, WiFi } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> NetworkTypeEnum NetworkType; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> TaskManager _taskManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TaskManager(); }</code> </pre><br> åº”ç”¨ç¨‹åºéœ€è¦<b>NetworkType</b>é™æ€å­—æ®µæ‰èƒ½æ¥æ”¶æœ‰å…³Internetè¿æ¥ç±»å‹çš„ä¿¡æ¯ã€‚ åŸåˆ™ä¸Šï¼Œè¯¥å€¼å¯ä»¥å­˜å‚¨åœ¨ä»»ä½•åœ°æ–¹ï¼Œæˆ‘å†³å®šå°†å…¶æ”¾ç½®åœ¨<b>Network</b>ç±»ä¸­ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ·»åŠ å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„åŸºæœ¬åŠŸèƒ½ï¼š</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WebRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UnityWebRequest request, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; progress, Action&lt;UnityWebRequest&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Caching.ready) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (progress != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { request.SendWebRequest(); _currentRequests.Add(request); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!request.isDone) { progress(request.downloadProgress); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } progress(<span class="hljs-number"><span class="hljs-number">1f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.SendWebRequest(); } response(request); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_currentRequests.Contains(request)) { _currentRequests.Remove(request); } request.Dispose(); }</code> </pre><br></div></div><br> ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸ä¸Šä¸€èŠ‚ä¸­çš„ä»£ç ç›¸æ¯”ï¼Œå¤„ç†è¯·æ±‚å®Œæˆçš„æ–¹æ³•å·²æ›´æ”¹ã€‚ è¿™æ˜¯ä¸ºäº†æ˜¾ç¤ºæ•°æ®åŠ è½½çš„è¿›åº¦ã€‚ åŒæ ·ï¼Œæ‰€æœ‰å‘é€çš„è¯·æ±‚éƒ½å­˜å‚¨åœ¨åˆ—è¡¨ä¸­ï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶å¯ä»¥å°†å…¶å–æ¶ˆã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä¸ºAssetBundleæ·»åŠ åŸºäºé“¾æ¥çš„æŸ¥è¯¢åˆ›å»ºåŠŸèƒ½ï¼š</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WebRequestBundle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Hash128 hash, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; progress, Action&lt;UnityWebRequest&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequestAssetBundle.GetAssetBundle(url, hash, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> WebRequest(request, progress, response); }</code> </pre><br></div></div><br> åŒæ ·ï¼Œä¸ºçº¹ç†ï¼ŒéŸ³é¢‘ï¼Œæ–‡æœ¬ï¼Œå­—èŠ‚æ•°ç»„åˆ›å»ºå‡½æ•°ã€‚ <br><br> ç°åœ¨ï¼Œæ‚¨éœ€è¦ç¡®ä¿æœåŠ¡å™¨é€šè¿‡Postå‘½ä»¤å‘é€æ•°æ®ã€‚ é€šå¸¸ï¼Œæ‚¨éœ€è¦å°†æŸäº›å†…å®¹ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œç„¶åæ ¹æ®ç¡®åˆ‡çš„å†…å®¹è·å¾—ç­”æ¡ˆã€‚ æ·»åŠ é€‚å½“çš„åŠŸèƒ½ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä»¥é”®å€¼é›†çš„å½¢å¼å‘é€æ•°æ®ï¼š</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WebRequestPost</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; formFields, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; progress, Action&lt;UnityWebRequest&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequest.Post(url, formFields); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> WebRequest(request, progress, response); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">å°†æ•°æ®ä½œä¸ºjsonå‘é€ï¼š</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WebRequestPost</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; progress, Action&lt;UnityWebRequest&gt; response</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityWebRequest(url, UnityWebRequest.kHttpVerbPOST) { uploadHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UploadHandlerRaw(Encoding.UTF8.GetBytes(data)), downloadHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DownloadHandlerBuffer() }; request.uploadHandler.contentType = <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> WebRequest(request, progress, response); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·»åŠ ç”¨äºåŠ è½½æ•°æ®çš„å…¬å…±æ–¹æ³•ï¼Œå°¤å…¶æ˜¯AssetBundle</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Request</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Hash128 hash, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; progress, Action&lt;AssetBundle&gt; response, TaskManager.TaskPriorityEnum priority = TaskManager.TaskPriorityEnum.Default</span></span></span><span class="hljs-function">)</span></span> { _taskManager.AddTask(WebRequestBundle(url, hash, progress, (uwr) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!uwr.isHttpError &amp;&amp; !uwr.isNetworkError) { response(DownloadHandlerAssetBundle.GetContent(uwr)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogWarningFormat(<span class="hljs-string"><span class="hljs-string">"[Netowrk]: error request [{0}]"</span></span>, uwr.error); response(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } }), priority); }</code> </pre><br></div></div><br> åŒæ ·ï¼Œæ·»åŠ äº†çº¹ç†ï¼ŒéŸ³é¢‘æ–‡ä»¶ï¼Œæ–‡æœ¬ç­‰æ–¹æ³•ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æœ€åï¼Œæˆ‘ä»¬æ·»åŠ äº†è·å–ä¸‹è½½æ–‡ä»¶å¤§å°çš„åŠŸèƒ½å’Œæ¸…é™¤åŠŸèƒ½ï¼Œä»¥åœæ­¢æ‰€æœ‰åˆ›å»ºçš„è¯·æ±‚ã€‚</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Request</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; response, TaskManager.TaskPriorityEnum priority = TaskManager.TaskPriorityEnum.Default</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = UnityWebRequest.Head(url); _taskManager.AddTask(WebRequest(request, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, uwr =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contentLength = uwr.GetResponseHeader(<span class="hljs-string"><span class="hljs-string">"Content-Length"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(contentLength, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> returnValue)) { response(returnValue); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { response(<span class="hljs-number"><span class="hljs-number">-1</span></span>); } }), priority); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _taskManager.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _currentRequests) { request.Abort(); request.Dispose(); } _currentRequests.Clear(); }</code> </pre><br></div></div><br> è‡³æ­¤ï¼Œæˆ‘ä»¬ç”¨äºç½‘ç»œè¯·æ±‚çš„ç»ç†å®Œæˆäº†ã€‚ å¦‚æœ‰å¿…è¦ï¼Œéœ€è¦ä¸æœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨çš„æ¸¸æˆçš„æ¯ä¸ªå­ç³»ç»Ÿéƒ½å¯ä»¥åˆ›å»ºè‡ªå·±çš„ç±»å®ä¾‹ã€‚ <br><br><h2> æˆ‘ä»¬å†™åŠ è½½å¤–éƒ¨èµ„æºçš„ç»ç† </h2><br> é™¤äº†ä¸Šè¿°ç±»ä¹‹å¤–ï¼Œä¸ºäº†å®Œå…¨ä½¿ç”¨å¤–éƒ¨æ•°æ®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå•ç‹¬çš„ç®¡ç†å™¨ï¼Œè¯¥ç®¡ç†å™¨ä¸ä»…ä¸‹è½½æ•°æ®ï¼Œè€Œä¸”è¿˜é€šçŸ¥åº”ç”¨ç¨‹åºä¸‹è½½å¼€å§‹ï¼Œå®Œæˆï¼Œè¿›åº¦ï¼Œå¯ç”¨ç©ºé—´ä¸è¶³ä»¥åŠç¼“å­˜é—®é¢˜ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æˆ‘ä»¬å¼€å§‹ç›¸åº”çš„ç±»ï¼Œåœ¨æˆ‘çš„æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªå•ä¾‹</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExternalResourceManager</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ResourceEnumType { Text, Texture, AssetBundle } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Network _network = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Network(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExternalResourceManager</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR var path = Path.Combine(Directory.GetParent(Application.dataPath).FullName, "_EditorCache"); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> var path = Path.Combine(Application.persistentDataPath, "_AppCache"); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!System.IO.Directory.Exists(path)) { System.IO.Directory.CreateDirectory(path); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_IOS UnityEngine.iOS.Device.SetNoBackupFlag(path); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> } Caching.currentCacheForWriting = Caching.AddCache(path); } }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œè®¾è®¡å™¨å°†æ–‡ä»¶å¤¹è®¾ç½®ä¸ºç¼“å­˜ï¼Œå…·ä½“å–å†³äºæˆ‘ä»¬æ˜¯å¦åœ¨ç¼–è¾‘å™¨ä¸­ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œæˆ‘ä»¬ä¸ºNetworkç±»çš„å®ä¾‹è®¾ç½®äº†ä¸€ä¸ªç§æœ‰å­—æ®µï¼Œæˆ‘ä»¬åœ¨å‰é¢å·²ç»ä»‹ç»è¿‡ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·»åŠ è¾…åŠ©åŠŸèƒ½ä»¥ä½¿ç”¨ç¼“å­˜ï¼Œä»¥åŠç¡®å®šä¸‹è½½æ–‡ä»¶çš„å¤§å°å¹¶æ£€æŸ¥å…¶å¯ç”¨ç©ºé—´ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸‹é¢çš„å†…å®¹ä¸­ï¼Œå°†åœ¨ä½¿ç”¨AssetBundleçš„ç¤ºä¾‹ä¸Šç»™å‡ºä»£ç ï¼Œå¯¹äºå…¶ä½™èµ„æºï¼Œæ‰€æœ‰æ“ä½œå‡ä»¥æ­¤ç±»æ¨ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¾…åŠ©åŠŸèƒ½ä»£ç </font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClearAssetBundleCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileName = GetFileNameFromUrl(url); Caching.ClearAllCachedVersions(fileName); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClearAllRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _network.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssetBundleIsCached</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; result</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> manifestFileUrl = <span class="hljs-string"><span class="hljs-string">"{0}.manifest"</span></span>.Fmt(url); _network.Request(manifestFileUrl, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> manifest) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hash = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(manifest) ? <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> : GetHashFromManifest(manifest); result(Caching.IsVersionCached(url, hash)); } , TaskManager.TaskPriorityEnum.RunOutQueue); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckFreeSpace</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; result</span></span></span><span class="hljs-function">)</span></span> { GetSize(url, lengthInMb =&gt; { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR_WIN var logicalDrive = Path.GetPathRoot(Utils.Path.Cache); var availableSpace = SimpleDiskUtils.DiskUtils.CheckAvailableSpace(logicalDrive); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> UNITY_EDITOR_OSX var availableSpace = SimpleDiskUtils.DiskUtils.CheckAvailableSpace(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> UNITY_IOS var availableSpace = SimpleDiskUtils.DiskUtils.CheckAvailableSpace(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">elif</span></span></span><span class="hljs-meta"> UNITY_ANDROID var availableSpace = SimpleDiskUtils.DiskUtils.CheckAvailableSpace(true); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> result(availableSpace &gt; lengthInMb, lengthInMb); }); } public void GetSize(string url, Action&lt;float&gt; result) { _network.Request(url, length =&gt; result(length / 1048576f)); } private string GetFileNameFromUrl(string url) { var uri = new Uri(url); var fileName = Path.GetFileNameWithoutExtension(uri.LocalPath); return fileName; } private Hash128 GetHashFromManifest(string manifest) { var hashRow = manifest.Split("\n".ToCharArray())[5]; var hash = Hash128.Parse(hashRow.Split(':')[1].Trim()); return hash; }</span></span></code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œä½¿ç”¨AssetBundleç¤ºä¾‹æ·»åŠ æ•°æ®åŠ è½½åŠŸèƒ½ã€‚</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAssetBundle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url, Action start, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; progress, Action stop, Action&lt;AssetBundleWrapper&gt; result, TaskManager.TaskPriorityEnum taskPriority = TaskManager.TaskPriorityEnum.Default</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> DONT_USE_SERVER_IN_EDITOR start?.Invoke(); result(new AssetBundleWrapper(url)); stop?.Invoke(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> void loadAssetBundle(Hash128 bundleHash) { start?.Invoke(); _network.Request(url, bundleHash, progress, (AssetBundle value) =&gt; { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(value != null) { _externalResourcesStorage.SetCachedHash(url, bundleHash); } result(new AssetBundleWrapper(value)); stop?.Invoke(); }, taskPriority); }; var manifestFileUrl = "{0}.manifest".Fmt(url); _network.Request(manifestFileUrl, null, (string manifest) =&gt; { var hash = string.IsNullOrEmpty(manifest) ? default : GetHashFromManifest(manifest); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!hash.isValid || hash == default) { hash = _externalResourcesStorage.GetCachedHash(url); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!hash.isValid || hash == default) { result(new AssetBundleWrapper(null)); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { loadAssetBundle(hash); } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (Caching.IsVersionCached(url, hash)) { loadAssetBundle(hash); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { CheckFreeSpace(url, (spaceAvailable, length) =&gt; { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (spaceAvailable) { loadAssetBundle(hash); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { result(new AssetBundleWrapper(null)); NotEnoughDiskSpace.Call(); } }); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é‚£ä¹ˆæ­¤å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼š </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é¢„ç¼–è¯‘æŒ‡ä»¤DONT_USE_SERVER_IN_EDITORç”¨äºç¦ç”¨ä»æœåŠ¡å™¨å®é™…åŠ è½½æ†ç»‘è½¯ä»¶ã€‚ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¬¬ä¸€æ­¥æ˜¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œä»¥è·å–æ†ç»‘è½¯ä»¶çš„æ¸…å•æ–‡ä»¶ </font></font></li><li>    -    ,    ,   -   ( <b>_externalResourcesStorage</b> )  ,  ,               (  ,     ),  ,   null  </li><li>     ,     Caching      ,       ,         (   ) </li><li>  ,     ,      ,   ,             -       (   ).   ,              (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> ) </li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡è¦çš„æ˜¯è¦ç†è§£ä¸ºä»€ä¹ˆå“ˆå¸Œå€¼æ˜¯åˆ†å¼€å­˜å‚¨çš„ã€‚</font><font style="vertical-align: inherit;">å¯¹äºæ²¡æœ‰äº’è”ç½‘ï¼Œè¿æ¥ä¸ç¨³å®šæˆ–å‡ºç°æŸç§ç½‘ç»œé”™è¯¯å¹¶ä¸”æ— æ³•ä»æœåŠ¡å™¨ä¸‹è½½æ†ç»‘è½¯ä»¶çš„æƒ…å†µï¼Œè¿™æ˜¯å¿…è¦çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¿è¯ä»é‚£é‡Œä»ç¼“å­˜ä¸­ä¸‹è½½æ†ç»‘è½¯ä»¶</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ä¸Šè¿°æ–¹æ³•ç±»ä¼¼ï¼Œåœ¨ç®¡ç†å™¨ä¸­ï¼Œæ‚¨å¯ä»¥/éœ€è¦è·å–å…¶ä»–ç”¨äºå¤„ç†æ•°æ®çš„åŠŸèƒ½ï¼šGetJsonï¼ŒGetTextureï¼ŒGetTextï¼ŒGetAudioç­‰ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæ‚¨éœ€è¦è·å¾—ä¸€ç§å…è®¸æ‚¨ä¸‹è½½èµ„æºé›†çš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ä¸‹è½½æˆ–æ›´æ–°æŸäº›å†…å®¹ï¼Œåˆ™æ­¤æ–¹æ³•å°†éå¸¸æœ‰ç”¨ã€‚</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPack</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, ResourceEnumType&gt; urls, Action start, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; progress, Action stop, Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; result</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> commonProgress = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)urls.Count; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentProgress = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completeCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">progressHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { currentProgress += <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; progress?.Invoke(currentProgress / commonProgress); }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">completeHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { completeCounter++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completeCounter == urls.Count) { stop?.Invoke(); } }; start?.Invoke(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> urls.Keys) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resourceType = urls[url]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (resourceType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ResourceEnumType.Text: { GetText(url, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, progressHandler, completeHandler, (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, isCached) =&gt; { result(url, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, isCached); }); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ResourceEnumType.Texture: { GetTexture(url, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, progressHandler, completeHandler, (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, isCached) =&gt; { result(url, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, isCached); }); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ResourceEnumType.AssetBundle: { GetAssetBundle(url, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, progressHandler, completeHandler, (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; { result(url, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™é‡Œå€¼å¾—äº†è§£</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TaskManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ç‰¹æ®Šæ€§</font><font style="vertical-align: inherit;">ï¼Œå®ƒåœ¨ç½‘ç»œè¯·æ±‚ç®¡ç†å™¨ä¸­ä½¿ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒå¯ä»¥å·¥ä½œï¼Œä¾æ¬¡æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ã€‚å› æ­¤ï¼Œå°†ç›¸åº”åœ°è¿›è¡Œæ–‡ä»¶ä¸‹è½½ã€‚</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šå¯¹äºé‚£äº›ä¸å–œæ¬¢</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coroutineçš„äºº</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¯ä»¥å°†æ‰€æœ‰å†…å®¹è½»æ¾è½¬æ¢ä¸º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">async / await</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å†³å®šä¸ºåˆå­¦è€…ä½¿ç”¨ä¸€ä¸ªæ›´æ˜“ç†è§£çš„é€‰é¡¹ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰ã€‚</font></font><br><br><h2> ç»“è®º </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘è¯•å›¾å°½å¯èƒ½ç´§å‡‘åœ°æè¿°ä½¿ç”¨æ¸¸æˆåº”ç”¨ç¨‹åºçš„å¤–éƒ¨èµ„æºã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘çš„å‚ä¸ä¸‹ï¼Œè¿™äº›æ–¹æ³•å’Œä»£ç ç”¨äºå·²å‘å¸ƒå’Œæ­£åœ¨å¼€å‘çš„é¡¹ç›®ä¸­ã€‚</font><font style="vertical-align: inherit;">å®ƒéå¸¸ç®€å•å¹¶ä¸”é€‚ç”¨äºä¸æœåŠ¡å™¨ä¹‹é—´ä¸å­˜åœ¨æŒç»­é€šä¿¡çš„ç®€å•æ¸¸æˆï¼ˆMMOå’Œå…¶ä»–å¤æ‚çš„f2pæ¸¸æˆï¼‰ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ä¸‹è½½å…¶ä»–ææ–™ï¼Œè¯­è¨€ï¼Œå¯¹è´­ä¹°çš„æœåŠ¡å™¨ç«¯éªŒè¯ä»¥åŠå…¶ä»–æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œåˆ™å¯ä»¥æå¤§åœ°ç®€åŒ–å·¥ä½œã€‚ä¸€æ¬¡æˆ–ä¸å¤ªç»å¸¸åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼•ç”¨çš„å‚è€ƒæ–‡çŒ®çš„æ–‡ç« </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assetstore.unity.com/packages/tools/simple-disk-utils-59382 </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/post/352296 </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/post/282524</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433366/">https://habr.com/ru/post/zh-CN433366/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433356/index.html">æ”»å‡»è€…å­¦ä¼šäº†ç»•è¿‡ä¸¤å› ç´ èº«ä»½éªŒè¯Yahoo Mailå’ŒGmail</a></li>
<li><a href="../zh-CN433358/index.html">ç†Ÿæ‚‰Pythonæµ‹è¯•ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN433360/index.html">ç§‘å­¦å®¶è¯•å›¾é¢„æµ‹ä½•æ—¶ç”µåŠ¨é£æœºå°†æˆä¸ºç°å®</a></li>
<li><a href="../zh-CN433362/index.html">UXä¸­ç¾è§‚ï¼Œç®€å•å’ŒæŠ¤ç†çš„9æ¡åŸåˆ™</a></li>
<li><a href="../zh-CN433364/index.html">LDraw + Unityã€‚ æˆ‘å¦‚ä½•äº§ç”Ÿä¹é«˜</a></li>
<li><a href="../zh-CN433368/index.html">å¦‚ä½•å°†æ‚è´§åº—æ€ç»´åº”ç”¨äºä¸–ç•Œï¼šè¿åŠ¨è¡«çš„ä¸€ä¸ªä¾‹å­</a></li>
<li><a href="../zh-CN433370/index.html">åˆ†ç‰‡ç†è®º</a></li>
<li><a href="../zh-CN433372/index.html">æ±½è½¦è‡ªè¡Œè½¦</a></li>
<li><a href="../zh-CN433374/index.html">å…³äºRTOSçš„å…¨éƒ¨çœŸç›¸ã€‚ ç¬¬26æ¡ã€‚ æ¸ é“ï¼šè¾…åŠ©æœåŠ¡å’Œæ•°æ®ç»“æ„</a></li>
<li><a href="../zh-CN433376/index.html">éº»çœç†å·¥å­¦é™¢çš„è¯¾ç¨‹â€œè®¡ç®—æœºç³»ç»Ÿå®‰å…¨â€ã€‚ ç¬¬21è¯¾ï¼šæ•°æ®è·Ÿè¸ªï¼Œç¬¬1éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>