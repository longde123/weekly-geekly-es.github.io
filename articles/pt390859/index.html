<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßïüèæ üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üßïüèº Sistema de ventila√ß√£o da sala baseado em ‚Äúframboesa‚Äù e ‚Äúdetector de CO2‚Äù üöê üê† üêû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A moda das casas inteligentes varreu toda a Internet; todo mundo agora quer fazer uma l√¢mpada que possa desligar pela Internet ou abrir um ventilador ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistema de ventila√ß√£o da sala baseado em ‚Äúframboesa‚Äù e ‚Äúdetector de CO2‚Äù</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dadget/blog/390859/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A moda das casas inteligentes varreu toda a Internet; todo mundo agora quer fazer uma l√¢mpada que possa desligar pela Internet ou abrir um ventilador no vaso sanit√°rio. </font><font style="vertical-align: inherit;">Minha experi√™ncia foi bastante simples: eu queria criar um sistema que pudesse ventilar automaticamente uma sala, nem mais nem menos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de considerar o princ√≠pio do sistema, cheguei a algumas conclus√µes que decidi implementar. </font><font style="vertical-align: inherit;">Conforme planejado, toda a funcionalidade do sistema √© dividida em tr√™s componentes: os "c√©rebros" que controlam tudo, o sistema de ventila√ß√£o para abrir a janela / ou ligar o ventilador e o pr√≥prio sensor, que monitora a qualidade do ar na sala. </font><font style="vertical-align: inherit;">Vou falar mais sobre o sensor de qualidade do ar, al√©m de um pequeno toque no t√≥pico de integr√°-lo aos "c√©rebros" de uma casa inteligente.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vis√£o geral do dispositivo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidi controlar a qualidade do "frescor" do ar pela concentra√ß√£o de di√≥xido de carbono. Os planos futuros incluem o lan√ßamento de sensores de am√¥nia, propano / butano (vazamentos de g√°s), concentra√ß√£o de poeira no ar, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidiu-se colocar o sistema de ventila√ß√£o em alguma sala de estar onde uma pessoa passa o maior tempo poss√≠vel. Provavelmente, esse c√¥modo √© um quarto e √© l√° que um sistema de ventila√ß√£o autom√°tica ser√° muito √∫til durante uma noite de sono. </font></font><br>
<br>
<img src="https://habrastorage.org/files/a25/543/468/a25543468c9b46439f7f570577cddd2b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o √© segredo que a concentra√ß√£o de di√≥xido de carbono no ar afeta fortemente n√£o apenas a produtividade do c√©rebro humano, o desempenho humano, mas tamb√©m a capacidade de descansar. Quanto maior a concentra√ß√£o de CO2, pior.</font></font><br>
 <br>
 <img src="https://habrastorage.org/files/609/2dc/c2f/6092dcc2ff3340eea4c0727347a8f234.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O detector de di√≥xido de carbono da empresa Dadget foi usado como um dispositivo para medir a concentra√ß√£o de di√≥xido de carbono. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este dispositivo pode receber energia da porta USB de um computador ou laptop. </font><font style="vertical-align: inherit;">No painel frontal - indicador LCD, que exibe informa√ß√µes sobre a concentra√ß√£o de di√≥xido de carbono e temperatura ambiente. </font><font style="vertical-align: inherit;">Existem tamb√©m 3 LEDs que fornecem ao usu√°rio uma representa√ß√£o visual do conte√∫do. </font><font style="vertical-align: inherit;">Tudo √© bem simples - ligue o dispositivo. </font><font style="vertical-align: inherit;">E tudo funciona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fiquei atra√≠do pelo fato de existir um software que funciona com este dispositivo. </font><font style="vertical-align: inherit;">H√° software para Windows e Linux. </font><font style="vertical-align: inherit;">O c√≥digo fonte do programa para Linux est√° no github e parece ter sido escrito por nosso compatriota. </font><font style="vertical-align: inherit;">E se voc√™ possui o c√≥digo fonte, pode pensar em algo, modific√°-lo, "aprimorar" o programa por si mesmo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vis√£o geral do fluxo de trabalho</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a pr√°tica e o google mostraram, o dispositivo √© visto pelo computador como um dispositivo HID. Portanto, no programa para Windows, h√° uma dll chamada HIDApi. Para trabalhar com o Linux, voc√™ precisa da biblioteca HIDApi com o mesmo nome. Finalizei o c√≥digo fonte do software linux e escrevi um guincho simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â claro que usar um computador Linux para ler dados do sensor e transferi-los para um controlador dom√©stico inteligente em algum lugar √© uma blasf√™mia. Portanto, foi decidido usar o Raspbery pi com o Debian puro instalado. No futuro, est√° planejado fazer tudo no Arduino e transmitir via canais sem fio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O esquema do meu complexo de hardware e software √© o seguinte:</font></font><br>
<br>
<img src="https://habrastorage.org/files/c83/600/997/c836009971eb43578523742643ed8002.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um leitor experiente e um nerd √°vido podem pensar que n√£o √© muito esportivo usar o HUB nesse esquema. √â isso mesmo, voc√™ pode conectar diretamente um monitor de CO2 e aproveitar a vida. Usando esse esquema, resolvo v√°rios problemas ao mesmo tempo: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚óè na maioria das vezes, o c√©rebro de uma casa inteligente n√£o est√° onde est√° o sensor; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚óè o uso do raspberry pi permite conectar sensores adicionais; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚óè colocando o sensor separadamente, temos dois m√©todos de indica√ß√£o, o primeiro na tela do sensor, o segundo no telefone ou atrav√©s de uma p√°gina da web, uma vez que os dados s√£o transmitidos ao controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dispositivo MicasaVerde √© usado como um controlador dom√©stico inteligente, o dispositivo pode coletar dados dos sensores e tomar decis√µes de acordo com um determinado programa, chamado de "cenas" em sua terminologia.</font></font><br>
<br>
<img src="https://habrastorage.org/files/963/588/075/963588075d534090bab5100c83c1dfa7.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No dispositivo, voc√™ pode criar sensores virtuais e atualizar suas informa√ß√µes usando solicita√ß√µes http, o que fiz com o raspberry pi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo de solicita√ß√£o: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip_address</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3480 / data_request? Id = variableset &amp; DeviceNum = 6 &amp; serviceId = urn: micasaverde-com: serviceId: DoorLock1 &amp; Variable = Status &amp; Value = 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, Malinka l√™ os dados do detector de di√≥xido de carbono e transmite a solicita√ß√£o de http de dados para Vera. </font><font style="vertical-align: inherit;">O esquema √© simples, mas est√° funcionando.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revis√£o de software</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, existe uma ‚Äúframboesa‚Äù, n√£o importa qual vers√£o, o principal √© que ela possui uma interface de rede. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, voc√™ precisa instalar o suporte para dispositivos ocultos. Esta biblioteca √© retirada do git, portanto, o git deve ser instalado no "malink": </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apt-get install libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, fa√ßa o download e </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instale a</font></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href=""><font style="vertical-align: inherit;"></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pr√≥pria biblioteca </font><i><font style="vertical-align: inherit;">mkdir hidapi </font></i><i><font style="vertical-align: inherit;">
cd hidapi cd hidapi / </font></i><i><font style="vertical-align: inherit;">
git init </font></i><i><font style="vertical-align: inherit;">
git clone </font></i><i><a href=""><font style="vertical-align: inherit;">github.com/signal11/hidapi.git</font></a></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bibliotecas adicionais </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo apt-get install libudev-dev libusb-1.0-0-dev libfox-1.6-dev autotools-dev autoconfs-dev autoconf automake </font><i><font style="vertical-align: inherit;">automato</font></i><font style="vertical-align: inherit;"> libtool </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale o </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd hidapi / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./bootstrap </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./configure </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo make instalar</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, baixe o c√≥digo-fonte do programa de monitoramento de CO2 </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkdir co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git init </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git clone </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/dmage/co2mon.git</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seguida, alterei um pouco o c√≥digo do programa, na vers√£o inicial ele l√™ dois par√¢metros (temperatura e co2) e o envia ao console em um loop sem fim . Essa op√ß√£o n√£o me agradou, o objetivo era execut√°-la uma vez e obter o valor uma vez, ent√£o mudei duas linhas no main.c. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos procurando por linhas </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ("CntR \ t% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E mude para </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ("% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
exit (1);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira linha √© respons√°vel por exibir o valor; ap√≥s a altera√ß√£o, apenas o d√≠gito ser√° exibido e, ap√≥s a sa√≠da, o programa ser√° fechado, a linha de sa√≠da (1) responder√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compilar </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Em seguida, escrevemos um script simples que inicia o programa, atribui os valores de sa√≠da do programa compilado acima a uma vari√°vel e depois passa esse valor usando curl para o MicasaVerde. Depois disso, adicione a regra udev para que o sistema tenha acesso ao sensor sem raiz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SUBSISTEMA == "usb", ATTR {idVendor} == "04d9", ATTR {idProduct} == "a052", MODE = "0666" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E adicionaremos um script de pesquisa e transmiss√£o ao cron a cada minuto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
crontab -e </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E adicione a linha </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* * * * * /home/pi/co2sender.sh </font></font><br>
<br>
<img src="https://habrastorage.org/files/2cb/23c/1b2/2cb23c1b202f4aa5aad89c8c70c69148.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O resultado do script</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â claro que voc√™ ainda precisa configurar os arquivos do MicasaVerde para que haja registros adequados em todos os lugares. </font><font style="vertical-align: inherit;">Mas funciona, r√°pido e f√°cil.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, temos um sistema baseado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detector de CO2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que opera como de costume, analisa e relata mudan√ßas na concentra√ß√£o de di√≥xido de carbono. </font><font style="vertical-align: inherit;">Ao mesmo tempo, Malinka l√™ os dados do sensor uma vez por minuto e os transfere para o controlador dom√©stico inteligente, que pode ligar o sistema de ventila√ß√£o, se necess√°rio.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt390859/">https://habr.com/ru/post/pt390859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt390845/index.html">An√°lise do tablet termonuclear de 8 polegadas bb-mobile Topol 'LTE</a></li>
<li><a href="../pt390849/index.html">Funcion√°rios da alf√¢ndega dos EUA come√ßam a levar a biometria de pessoas que atravessam a fronteira dos EUA a p√©</a></li>
<li><a href="../pt390851/index.html">Uso pr√°tico de ROS no Raspberry Pi - Parte 3</a></li>
<li><a href="../pt390853/index.html">Na maioria das vezes, os gerentes tentaram roubar informa√ß√µes confidenciais de sua pr√≥pria empresa em 2015</a></li>
<li><a href="../pt390855/index.html">A Via L√°ctea foi estudada na faixa do submil√≠metro. Projeto ATLASGAL conclu√≠do</a></li>
<li><a href="../pt390863/index.html">V√≠deo: transmiss√£o da atualiza√ß√£o da programa√ß√£o do Samsung Galaxy</a></li>
<li><a href="../pt390865/index.html">A SpaceX adia o lan√ßamento do SES-9 pela segunda vez (atualiza√ß√£o: lan√ßada a partir da 5¬™ vez, o pouso falhou)</a></li>
<li><a href="../pt390867/index.html">–ì–æ–º–µ–æ–ø–∞—Ç–∏—è: –∏–Ω–¥—É—Å—Ç—Ä–∏—è –ø–ª–∞—Ü–µ–±–æ —Å –º–∏–ª–ª–∏–∞—Ä–¥–Ω—ã–º–∏ –¥–æ—Ö–æ–¥–∞–º–∏</a></li>
<li><a href="../pt390869/index.html">ASU Cast One - Projetor de rel√≥gio inteligente deve estar √† venda no ver√£o</a></li>
<li><a href="../pt390871/index.html">An√°lise do v√≠deo do notebook Asus Zenbook Pro UX501VW</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>