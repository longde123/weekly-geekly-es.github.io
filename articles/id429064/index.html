<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏿 🥛 🧛🏿 Berjuang untuk sumber daya, bagian 5: Mulai dari awal 🚴🏿 🅰️ ⛳️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami terus belajar cgroup. Di Red Hat Enterprise Linux 7, mereka diaktifkan secara default, karena menggunakan systemd, dan dia, pada gilirannya, suda...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Berjuang untuk sumber daya, bagian 5: Mulai dari awal</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/429064/"> Kami terus belajar cgroup.  Di Red Hat Enterprise Linux 7, mereka diaktifkan secara default, karena menggunakan systemd, dan dia, pada gilirannya, sudah memiliki cgroup bawaan.  Dengan Red Hat, Red Hat Enterprise Linux 6 sedikit berbeda.  Sebenarnya, pengendali cgroup awalnya ada di sana, tetapi versi ini dirilis, ingat pada Januari 2010, yaitu, beberapa abad yang lalu dalam hal tahun-tahun komputer. <br><br><img src="https://habrastorage.org/webt/7y/lx/mw/7ylxmwyn3vgxxrj7b6utthzftwk.png" width="100%"><br><br>  Namun, cgroup di Red Hat Enterprise Linux 6 mampu melakukan banyak hal bahkan hingga hari ini, yang akan kami ilustrasikan hari ini. <br><a name="habracut"></a><br>  Mari kita menganalisis kemampuan cgroup di Red Hat Enterprise Linux 6 menggunakan satu contoh murni hipotetis, berdasarkan sepenuhnya pada peristiwa nyata.  Tapi sebagai permulaan, berdasarkan tradisi, penyimpangan kecil. <br><br>  Tidak pernah ada banyak masalah dengan keamanan TI seperti sekarang.  Tidak mengherankan, karena saat ini tidak hanya semua komputer dan telepon yang terhubung ke jaringan, tetapi juga lemari es, penyedot debu dan banyak hal lainnya - ruang lingkup ancaman jaringan sangat besar.  Dan perang melawan ancaman ini, sebagai suatu peraturan, dimulai segera di semua lini.  Instalasi cepat patch keamanan?  Ya tentu saja!  Memperkuat keamanan sistem - firewall, SELinux, otentikasi yang kompeten, apakah itu saja?  Tentu saja!  Pemindai antivirus di mesin Linux?  Bagaimana mengatakannya ... <br><br>  Pada mesin Linux, pemindai antivirus terkadang lebih berbahaya daripada baik.  Namun, penjaga keamanan memiliki alasan sendiri, dan mereka sering meminta Anda untuk menjalankan pemindaian antivirus secara teratur, tanpa benar-benar memikirkan kesehatan mereka dari sudut pandang teknis.  Dan ini adalah kenyataan yang harus diterima seseorang, dan dengan itu, cepat atau lambat, hampir semua spesialis IT menghadapi. <br><br>  Poin kedua adalah bahwa Red Hat Enterprise Linux 7 tentu saja modis, canggih dan keren, tetapi banyak yang masih menggunakan Red Hat Enterprise Linux 6 dan tidak berpikir untuk menolaknya.  Bahkan, itu sebabnya orang memilih Red Hat - Anda dapat duduk di versi yang sama selama bertahun-tahun dan masih memiliki semua tambalan, pembaruan, dan dukungan terbaru. <br><br>  Mari kita kembali ke contoh kita ... Bayangkan ada seorang pria bernama Jerry.  Jerry bekerja di kantor besar dan bertanggung jawab untuk server Red Hat Enterprise Linux 6. Dia benar-benar puas dengan cara kerjanya, dan dia tidak membutuhkan masalah dan bunts baru. <br><br>  Tetapi kemudian orang-orang dari departemen keamanan memutuskan bahwa pada semua servernya Anda perlu meletakkan satu hal yang disebut ScanIT.  Dan karena hal ini secara berkala akan memeriksa disk dan memori untuk virus dan malware lainnya, perlu akses root penuh. <br><br>  Jerry menghela nafas, meletakkan gitarnya dan pergi untuk menempatkan ScanIT pada mesin uji.  Cukup cepat ternyata ini: <br><br><ul><li>  Saat melakukan pemindaian anti-virus, scanit (ini adalah skrip untuk memulai proses) memakan semua waktu prosesor yang dapat dijangkau.  Dan ini sangat mempengaruhi kerja mesin uji - begitu Jerry bahkan tidak bisa mencapainya di ssh. </li><li>  Selain itu, proses scanit memakan memori dari waktu ke waktu seolah-olah menjadi dirinya sendiri.  Akibatnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OOM Killer</a> bangun dan mulai membunuh proses apa pun selain scanit itu sendiri. </li></ul><br>  Secara umum, sesuatu harus dilakukan dengan ini. <br><br>  Jerry mengambil gitar dan, bermain Grateful Dead, mulai berpikir.  Cukup cepat, terlintas dalam benaknya bahwa kelompok-kelompok yang sama dari Red Hat Enterprise Linux 7 mungkin bisa membantu di sini, yang tentang seorang teman bernama Alex berdengung di telinganya.  Jerry kembali meletakkan gitarnya dan mulai membaca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dok</a> Alex <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di Red Hat Enterprise Linux 6</a> .  Ternyata hal pertama yang dia butuhkan adalah libcgroup. <br><br>  Tidak ada libcgroup pada mesin uji, jadi Jerry mulai memasangnya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-7/wt/dk/-7wtdk4uuvnhwypqp9oblrgtx60.png"></div><br><br>  Selain itu, Jerry menyertakan dua layanan yang diperlukan untuk pekerjaan kelompok tetap (persisten): <br><br><ul><li>  cgconfig - menyediakan antarmuka yang lebih atau kurang sederhana untuk bekerja dengan pohon cgroup.  Jerry tentu bisa memasang dan mengkonfigurasi cgroup secara manual, tetapi mengapa, jika Anda dapat menghemat waktu? </li><li>  cgred - hal ini adalah mesin aturan cgroup: ketika suatu proses dimulai, layanan ini menempatkannya dalam satu atau beberapa cgroup sesuai dengan aturan yang ditentukan. </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ga/i-/4c/gai-4cqblbowiy66etcfkm9wxlc.png"></div><br><br>  Setelah menginstal dan mengkonfigurasi semua ini, Jerry akhirnya dapat melanjutkan langsung ke masalah itu sendiri.  Setelah dengan cermat memikirkannya, ia membuat keputusan berikut: <br><br><ul><li>  proses scanit dan anaknya harus mengkonsumsi tidak lebih dari 20% dari sumber daya CPU.  Bahkan, bahkan kurang - tidak lebih dari 20% sumber daya dari satu inti prosesor, bahkan pada mesin multi-inti.  Dalam cgroup, ini dilakukan dengan menggunakan kuota CPU. </li><li>  Sedangkan untuk memori, proses scanit dan anaknya harus mengkonsumsi tidak lebih dari 512 MB memori sistem.  Jika mereka melewati garis ini, sistem harus membunuh mereka, dan bukan proses lainnya. </li></ul><br><h3>  Tidak perlu memberitahuku apa yang harus dilakukan! </h3><br>  Jerry harus berurusan dengan dua set file konfigurasi: <br><ul><li>  /etc/cgconfig.conf - Dibuat secara otomatis saat menginstal libcgroup. </li><li>  /etc/cgrules.conf - berisi sekumpulan aturan ruleset, yang menurutnya cgred mengurutkan proses yang dijalankan oleh grup cgroups. </li></ul><br>  Seperti inilah tampilan file cgconfig.conf default: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jk/7-/ie/jk7-ie0pclu29d7uourgo6mjq6c.png"></div><br><br>  Jerry bisa saja membuat perubahan yang diperlukan secara langsung kepadanya, tetapi lebih baik menggunakan file conf drop-in untuk ini.  Bagaimana cara kerjanya?  Jika Anda meletakkan (eng. Drop-in - drop) di folder /etc/cgconfig.d file apa pun dengan ekstensi .conf, sistem akan memprosesnya dan membuat perubahan yang sesuai dengan konfigurasi.  Ini nyaman karena Anda dapat membuat drop-in untuk berbagai tugas dan menambah atau menghapusnya dari konfigurasi menggunakan alat yang paling Anda sukai (katakanlah, Ansible, yah, ini masih blog Red Hat). <br><br>  Jerry pertama kali membuat file drop-in untuk CPU: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/li/w6/8u/liw68uvhsmfnz2dwet4g_9rfmhs.png"></div><br><br>  Kami melihat apa yang kami miliki di sini dan bagaimana cara kerjanya. <br><br>  Kata kunci grup hanya menetapkan nama cgroup baru, dalam kasus kami, scanit.  Di dalam kurung kurawal, kami menentukan kontrol cgroup yang ingin kami gunakan.  Di sini, cpu.cfs_ Period_us dan cpu.cfs_quota_us, mereka memungkinkan Anda untuk menetapkan batas yang sesuai di Penjadwal Sepenuhnya Adil, penjadwal kernel yang digunakan secara default di Red Hat Enterprise Linux 6. Mari kita lihat apa yang tertulis tentang mereka di dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Red Hat Enterprise Linux Resource Management Guide 6</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wr/jp/zx/wrjpzxiksqg-3eos3ammagjg_di.png"></div><br><br>  Dengan kata lain, Jerry menulis ini di drop-innya: “Untuk setiap proses yang terkait dengan cgroup bernama scanit, satu detik sekali periksa jumlah sumber daya CPU yang dialokasikan untuk itu.  Jika total waktu prosesor untuk semua proses dalam grup ini lebih dari 200.000 milidetik, maka sepenuhnya berhenti memberi waktu prosesor untuk proses ini. "  Yaitu, untuk mengalokasikan ke semua proses dalam grup-grup scanit, serta proses anak mereka, secara total tidak lebih dari 20% dari waktu prosesor. <br><br>  Setelah memulai ulang cgconfig, server akan memperbarui konfigurasi, dan jika Anda masuk ke sistem file, kita akan melihat bahwa scanit sekarang terletak di direktori pengontrol CPU: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2u/is/z9/2uisz9gmmcpjaaqi7zjgauw-pwa.png"></div><br><br>  Ini, tentu saja, bagus, tetapi kita masih perlu mendorong scanit sendiri ke cgroup ini.  Crged sangat berguna di sini, secara default akan terlihat seperti ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sm/-d/t5/sm-dt5oeb5xqypbyfgdytjagrci.png"></div><br><br>  Menggunakan file ini lebih atau kurang mudah.  Namun, untuk ini kita harus langsung mengedit file cgrules.conf, karena mekanisme drop-in tidak didukung di sini.  Kami menunjukkan pengguna atau grup yang memiliki proses, serta nama spesifik - jika Anda mau - proses, serta pengontrol khusus dan grup tujuan cgroup. <br><br>  Dalam contoh kami, alih-alih pemindai anti-virus pemindai yang sebenarnya, kami menggunakan skrip yang juga disebut scanit, tetapi sebenarnya hanya meniru beban.  Tanpa cgroup, semuanya akan terlihat seperti ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rz/9e/jr/rz9ejrq2hvosc8tx6qygwtlprju.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zg/_q/5w/zg_q5wnmcxzrirruk73ium-l4xg.png"></div><br><br>  CPU terisi penuh, terutama oleh ruang pengguna dan sedikit sistem. <br><br>  Jerry menggaruk jenggotnya.  Itu mulai vi dan, menggunakan tepat satu jari telunjuk, membuat beberapa perubahan dan me-restart daemon cgred: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dn/sq/br/dnsqbrojxhtx0holtc3i-5f6uco.png"></div><br><br>  Kemudian secara manual meluncurkan scanit ...: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qa/o2/um/qao2umbcrsuefcn1n9m1jtrojtq.png"></div><br><br>  Dan - bersorak!  Kemenangan <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ik/vi/mr/ikvimrn0d_pkujdyjdaefnxzgsa.png"></div><br><br>  Seperti yang Anda lihat, proses meniru beban kami (proses scanit anak) sekarang mengkonsumsi total 20% sumber daya CPU, terutama di ruang pengguna dan sedikit di sistem.  Jadi, antivirus sialan ini tidak akan lagi memuat mobil ke kegilaan penuh. <br><br><h3>  Ingat apa selanjutnya? </h3><br>  Bersukacita atas keberhasilan itu, Jerry hampir melupakan ingatannya.  Tapi kemudian dia masih ingat dan mulai vi lagi untuk memperbaiki file konfigurasinya. <br><br>  Sekarang dia menambahkan dua pengaturan berkenaan dengan memori di sana: <br><ul><li>  Memory.limit_in_bytes - maks.  Jumlah RAM yang dapat digunakan oleh semua proses dalam kelompok scanit.  Dan tidak termasuk ruang swap.  Jerry membatasi hingga 256 MB </li><li>  Memory.memsw.limit_in_bytes - maks.  Volume RAM, ditambah ruang dalam file swap, yang dapat dialokasikan untuk semua proses dalam grup-grup scanit, secara total.  Jika ambang ini terlampaui, proses akan dibunuh oleh pembunuh OOM.  Jerry mengaturnya menjadi 512 MB. </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/ey/p7/d9eyp7j01qhdzrc_xughbzsatny.png"></div><br><br>  Oh tidak!  Apa yang salah <br><br>  Jerry melihat ke atas dan melihat bahwa proses anak scanit masih berjalan.  Karena cgroup ini sedang digunakan, Jerry tidak dapat memulai layanan.  Oleh karena itu, ia membunuh proses anak secara manual dan memulai kembali layanan tersebut. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8t/er/fb/8terfbxnn3mp4bb-nrdmeasb1s4.png"></div><br><br>  Sekarang edit kecil di cgred.conf: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/ma/zs/srmazsl7k259dze13dcnjtij_ae.png"></div><br><br>  Untuk memeriksanya, Jerry menjalankan beberapa tugas pemindaian sekaligus, sehingga pembunuh OOM akan bekerja dengan pasti. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/cf/m7/mvcfm7gxz5b_l2ylpptrp5skseo.png"></div><br><br>  Kemudian Jerry melihat log sistem dan mengangguk puas - scanit tidak bisa lagi meninggalkan memori dalam jumlah berapa pun tanpa impunitas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rf/n-/gc/rfn-gcg6nk2lwjz5aelxw6lt9ue.png"></div><br><br>  Kami berharap serangkaian artikel cgroup kami membantu Anda memahami apa itu, bagaimana menggunakannya di Red Hat Enterprise Linux 7, cara membuatnya di Red Hat Enterprise Linux 6, dan bagaimana menggunakannya di lingkungan Anda. <br><br><ul><li>  Bagian 1 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/company/redhatrussia/blog/423051</a> </li><li>  Bagian 2 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/company/redhatrussia/blog/424367</a> </li><li>  Bagian 3 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/company/redhatrussia/blog/425803</a> </li><li>  Bagian 4 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/company/redhatrussia/blog/427413</a> </li><li>  Bagian 6 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/company/redhatrussia/blog/430748</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id429064/">https://habr.com/ru/post/id429064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id429054/index.html">Temukan N Perbedaan. Pengalaman pengujian tata letak Tinkoff.ru</a></li>
<li><a href="../id429056/index.html">Fisika, bukan biologi, membuat penuaan tak terhindarkan</a></li>
<li><a href="../id429058/index.html">Menggunakan Retrofit 2 di aplikasi Android</a></li>
<li><a href="../id429060/index.html">Konsep pikiran yang ideal. AI Universal</a></li>
<li><a href="../id429062/index.html">Menjinakkan multicast</a></li>
<li><a href="../id429066/index.html">Bagaimana kru pesawat mempersiapkan keberangkatan</a></li>
<li><a href="../id429068/index.html">Pos yang sangat korporat: dibuka di Moskow atau mengapa 10 dan 11 November adalah hari yang baik untuk membeli elektronik</a></li>
<li><a href="../id429070/index.html">Linux tidak dapat dimuat di MacBook baru karena chip T2</a></li>
<li><a href="../id429072/index.html">Mengapa Kodak meninggal dan Fujifilm berkembang: kisah dua pembuat film</a></li>
<li><a href="../id429074/index.html">Perbuatan Baik untuk Uang Google: Tantangan Dampak AI Baru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>