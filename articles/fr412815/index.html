<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✋ 🧔🏾 🤷🏾 Clés client OpenVPN Web Manager VPNFace Lite 💃 😧 🚮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 


 La demande accrue pour les lettres magiques VPN et leurs raisons, loin des technologies de réseau, n'est même pas intéressante à plaisanter....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Clés client OpenVPN Web Manager VPNFace Lite</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412815/"><h1 id="intro">  Intro </h1><br><p>  La demande accrue pour les lettres magiques VPN et leurs raisons, loin des technologies de réseau, n'est même pas intéressante à plaisanter. </p><br><blockquote>  Salut, tu es bon en informatique?  m'aider sur vpn? </blockquote><a name="habracut"></a><br><p>  En fait, je suis même heureux que les gens commencent à apprendre les bases des réseaux informatiques (qu'est-ce que vpn, que se passe-t-il, et pourquoi différents sites commencent-ils à s'ouvrir avec lui?), Et, si possible, aide.  J'essaie de pousser pour les processus d'auto-configuration de mes propres serveurs VPN, mais je comprends que <em>tout le monde ne devrait pas être un administrateur système</em> , donc certains amis suggèrent simplement d'acheter un serveur et de me le donner pour la configuration. </p><br><p>  Mais tout programmeur doit être paresseux pour ne pas répéter la même chose à plusieurs reprises.  Exécuter les mêmes actions encore et encore affine les compétences, mais tue tout l'intérêt du développement et de la créativité (et du temps). </p><br><p>  Et donc, en installant le troisième serveur VPN, j'ai réalisé qu'il était nécessaire d'automatiser tout cela et de rendre l' <em>utilisateur convivial</em> , afin qu'après une courte instruction, même l'utilisateur le plus ordinaire puisse partager la clé ovpn avec un ami ou un parent.  Et encore mieux - pour installer le système, l'utilisateur pourrait indépendamment avec un minimum de compétences et de connaissances. </p><br><p>  Le projet VPNFace est donc né - un ensemble de scripts de serveur pour gérer les clés utilisateur des serveurs OpenVPN, et un panneau de contrôle Web pour eux.  Et après quelques jours de développement, je me suis surpris à penser que quelque part environ 25% des fonctionnalités à définir ne seront jamais revendiquées par ce même "utilisateur ordinaire", et le préfixe Lite a été ajouté au nom, et le concept principal du projet est passé d' <em>un concepteur général</em> à un concept <em>étroit. qui</em> , en même temps, a également considérablement réduit le temps de développement avant la sortie. </p><br><p>  Bien sûr - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Google Outline VPN">eh bien, ça ne s'est jamais passé</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" title="Pritunl">comme</a> ça - pourquoi un autre gestionnaire OpenVPN?  Pour être honnête - la pensée d'autres projets de gestionnaires de VPN est venue à l'esprit lorsque le noyau principal fonctionnait déjà, et j'ai vu toutes sortes de petites choses.  Au début, j'étais bouleversé d'être si stupide et je n'ai même pas fait d'étude minimale (parce que je n'aime pas produire de vélos), mais après avoir étudié les projets ci-dessus, j'ai réalisé que le mien avait aussi sa propre niche. </p><br><p>  Caractéristiques clés: </p><br><ol><li>  Minimalisme fonctionnel: un utilisateur ordinaire, lorsqu'il interagit avec vpn en tant qu'administrateur, n'a besoin que de quelques fonctions - créer une clé, verrouiller et déverrouiller.  Il est peu probable qu'il pense à créer un autre serveur VPN s'il en a un ou à grimper pour modifier les données du centre de certification.  Peu de gens auront besoin de beaux graphiques de trafic et des fonctionnalités du serveur d'entreprise pour <em>utiliser calmement un télégramme</em> . </li><li>  Minimalisme logiciel: le seul programme dont l'utilisateur a besoin est le client officiel OpenVPN, disponible sur tous les systèmes et appareils.  Le panneau de contrôle des touches est une application Web exécutée dans un navigateur.  L'autorisation administrative est effectuée par la clé vpn. </li><li>  Configuration semi-fixe: 80% des utilisateurs ont besoin de la même chose, et ils ne se soucient pas des adresses IP à l'intérieur des réseaux (ils ne savent même pas qu'ils sont là), 15% supplémentaires nécessitent un peu plus, mais, de même, une seule et même chose De plus, les 5% restants écrivent eux-mêmes des choses similaires, mettant en œuvre tout ce dont ils ont besoin, vous ne pouvez donc pas vous en soucier.  Néanmoins, le panneau peut être connecté manuellement aux serveurs déjà openvpn, ou corriger les données du certificat avant l'installation standard. </li><li>  Détachement absolu aux sociétés d'hébergement ou à d'autres services tiers - il y a pas mal de copies cassées dans les litiges concernant l'hébergement le plus magique, cela reste entièrement au choix de l'utilisateur.  Le système d'exploitation du serveur est plus important pour le script - il est écrit sous les systèmes Ubuntu / Debian, mais tous les hébergeurs en ont.  Le système se tiendra calmement à la fois dans le réseau domestique interne et dans le réseau d'entreprise. </li><li>  le processus d'installation le plus simplifié sur un serveur propre fraîchement acheté: si quelque chose peut être fait sans la participation de l'utilisateur, cela se fait en utilisant un code dur.  Parce que Lite.  Oui, il n'a pas été possible de réaliser l'installateur comme Google Outline, il nécessite une connexion utilisateur via ssh pour démarrer l'installation, et un achat indépendant du serveur, mais il a été possible d'acquérir cette connaissance de «comment se connecter via ssh» était l'une des plus difficiles.  Avec le "réglage par défaut", l'utilisateur est configuré avec une configuration "standard" sans aucune question. </li></ol><br><h1 id="panel-upravleniya-klyuchami">  Panneau de contrôle des touches </h1><br><p>  Lors d'une installation par défaut, trois serveurs VPN sont créés: administrateur, Internet et sombre - il n'est pas difficile de deviner à partir des noms, le premier sert à l'accès administrateur au serveur et au panneau de contrôle des clés (et ssh, si nécessaire), le second - libère immédiatement les utilisateurs sur Internet, et le troisième achemine de manière transparente tout le trafic possible vers le réseau tor (le trafic udp sauf DNS ne va nulle part et DNS va vers tor) </p><br><p><img src="https://habrastorage.org/webt/3g/wh/lv/3gwhlv6hr0jbzvhfd6jfrjeldsm.png"></p><br><p>  Le panneau de contrôle a été décidé pour être fait sur un sixième AngularJS frais ( <em>pendant l'installation, une version compilée du panneau est téléchargée, donc les bibliothèques angulaires ne sont pas nécessaires pour le travail</em> ).  J'aime le concept des applications web, et j'essaie d'évoluer dans ce sens, si possible.  Je voulais également étudier les matériaux angulaires depuis longtemps pour créer des panneaux d'administration Google dans divers projets. </p><br><p>  La gestion des clés, comme déjà indiqué, est simplifiée au minimum: </p><br><p>  Nouvelle clé: </p><br><p><img src="https://habrastorage.org/webt/tr/ld/k_/trldk_mwy4vblg-n-pcdvh3gurk.png"></p><br><p>  Verrouillage des touches: </p><br><p><img src="https://habrastorage.org/webt/b_/pa/i9/b_pai9e-us8hdshodi5irijqrm4.png"></p><br><p>  Déverrouillage par clé: </p><br><p><img src="https://habrastorage.org/webt/4x/sd/hi/4xsdhithv5rglkaazhu9j1o1ptw.png"></p><br><p>  Le bouton de téléchargement donne le fichier ovpn terminé pour la connexion. </p><br><p>  L'aide utilisateur minimale est intégrée dans le panneau: </p><br><p><img src="https://habrastorage.org/webt/di/eb/ck/diebckjumhsfakj7hzkjmbaq4u4.png"></p><br><p>  Et la documentation compilée est incluse dans le projet, qui augmente par défaut pour le sous-réseau administratif au port 81: </p><br><p><img src="https://habrastorage.org/webt/ty/2n/2i/ty2n2i9ntmsqykn74qffv7nrz5s.png"></p><br><p>  Le sens de la version Lite a également limité la prise en charge des langues - pour le moment, le projet entier n'existe qu'en russe, et le multilinguisme n'est même pas défini dans le noyau. </p><br><h1 id="servernaya-chast">  Côté serveur </h1><br><p>  Le côté serveur s'exécute sur nodejs et les scripts bash.  Pourquoi un nœud?  Je l'aime bien et j'ai beaucoup de projets sur elle.  Avoir une collection vpn-manager me semblait une bonne idée.  Le script d'installation extrait le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gestionnaire de version</a> du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nœud</a> , installe le nœud v10 à travers lui et crée un lien vers le dossier à l'échelle du système pour que les services écrits sous nodejs fonctionnent. </p><br><p>  Les packages installés dans le nœud sont également minimes - forever, forever-service pour démarrer un projet en tant que service système, express - pour web api, shelljs - pour exécuter les commandes de la console, ip - calculatrice d'adresse et de sous-réseau, craie - sortie couleur vers la console.  Bien sûr, cette liste peut être raccourcie avec le perfectionnisme du minimalisme, mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la deuxième loi d'Akin</a> est clairement née de nulle part (la même loi peut être appliquée à la question "pourquoi nodejs?" Et quelques autres) et malgré le désir de minimalisme dans d'autres questions, ici J'ai décidé de ne pas aller en profondeur. </p><br><p>  Le script serveur gère les serveurs openvpn via un ensemble de scripts bash et nécessite une structure de fichier de répertoire racine et une configuration de fichier openvpn spécifiques.  Deux fichiers json sont utilisés comme base de données, ce qui permet: </p><br><ol><li>  se débarrasser de l'interaction avec les bases de données comme mongo / sql et les dépendances et complications connexes </li><li>  sans problèmes particuliers, préparez les "bases" (et la structure des répertoires et des fichiers) manuellement ou par script, lors de l'installation sur un serveur de travail configuré, lorsque l'installateur inclus dans le kit peut même être nuisible et que le processus d'installation par défaut doit être évité (le besoin d'installation est vérifié précisément pour la présence et le contenu de json fichiers de base de données) </li></ol><br><p>  Un avantage distinct du panneau de contrôle en tant qu'application Web indépendante était la séparation de la fonctionnalité du serveur dans un ensemble distinct de points de terminaison api http, ce qui ouvre la possibilité pour des programmes tiers de gérer les clés utilisateur via des requêtes http régulières. </p><br><h1 id="prostaya-ustanovka-po-umolchaniyu">  Installation facile (par défaut) </h1><br><p>  Il est supposé qu'une telle installation s'exécutera sur de nouveaux serveurs propres.  Si le serveur est déjà configuré pour certaines tâches - il est préférable de se référer à l'installation manuelle (afin de ne pas endommager les fonctionnalités existantes). </p><br><p>  J'aime l'installation de nvm (gestionnaire de version de nœud) dans lequel l'utilisateur n'a besoin d'exécuter qu'une seule commande dans le terminal, qu'il copie à partir du site du projet, de sorte que le programme d'installation par défaut fonctionne de la même manière.  Pendant que le script bash d'installation de démarrage est en cours d'exécution, le paquet persistant iptables demandera à l'utilisateur de sauvegarder les règles iptables actuelles. </p><br><p><img src="https://habrastorage.org/webt/f_/vc/ke/f_vckeeni_hi396mjlwhkjmuuko.png"></p><br><p>  Le choix de l'utilisateur ne fait aucune différence, car à la fin de l'installation, la dernière action reconfigurera le pare-feu et le nouvel ensemble de règles écrasera la sélection actuelle.  À la fin du travail, le script vous demandera de terminer l'installation via l'interface Web. </p><br><p><img src="https://habrastorage.org/webt/ih/d2/-e/ihd2-en90hmiyiynxpqjexvxljc.png"></p><br><p>  L'installation Web commence par la confirmation de l'adresse IP publique du serveur.  Par défaut, le script Web prend les données de l'url de chaîne du navigateur.  En se concentrant sur cette adresse IP, le code du serveur recherche l'interface d'adresse réseau pour la future configuration du pare-feu et des serveurs openvpn. </p><br><p><img src="https://habrastorage.org/webt/cs/mh/hg/csmhhgijn6e6epp86hfwemjtyc8.png"></p><br><p>  Après avoir reçu les données du réseau, le programme d'installation crée un serveur VPN administrateur.  La génération de clés cryptographiques lors de la configuration du répertoire racine prend un certain temps, et pendant le développement, sur la même machine, ce temps varie de 1 à 15 minutes. </p><br><p>  Lorsque le serveur est créé et démarré, le programme d'installation passe à la deuxième étape, où il invite l'utilisateur à créer une clé d'administrateur. </p><br><p><img src="https://habrastorage.org/webt/ct/ib/r9/ctibr9x0ju5opuhykwxyhz4w0gc.png"></p><br><p>  Ensuite, il passe en mode veille pour connecter l'administrateur VPN.  Il est prévu que vpn soit connecté sur le même périphérique à partir duquel l'installation est effectuée. </p><br><p><img src="https://habrastorage.org/webt/ib/s-/am/ibs-am0zswrpurcj2izew-bwlws.png"></p><br><p>  Lorsqu'un utilisateur se connecte au serveur VPN administrateur, il devient disponible à l'adresse 10.1.0.1 et une demande jsonp de la page d'installation y passe avec succès, ce qui devient un signal pour rediriger la page vers l'adresse interne et terminer l'installation. </p><br><p><img src="https://habrastorage.org/webt/ug/uv/si/uguvsiqhx4tege1hc6opgol94dk.png"></p><br><p>  Au stade final de l'installation, les deux serveurs vpn restants sont créés et configurés (temps pour générer la cryptographie * 2), tor, nginx et iptalbles.  À la réception d'un signal pour terminer l'installation du côté serveur, le script redirige la page vers le panneau de contrôle principal. </p><br><h1 id="ruchnaya-ustanovka">  Installation manuelle </h1><br><p>  L'installation manuelle du panneau de contrôle sur la structure de travail des serveurs OpenVPN nécessite plusieurs étapes et est techniquement réalisable par l'administrateur linux (et je ne pense pas que quelqu'un d'autre qu'eux puisse avoir besoin d'une installation manuelle): </p><br><ol><li>  préparation de l'environnement nodejs selon les exigences de la sécurité actuelle du serveur et organisation du script sous la forme requise (service, manuel, etc.) </li><li>  préparation de la structure de fichiers des répertoires de données et de serveurs, création de "bases de données" json </li><li>  configuration du proxy nginx sur le panneau de commande et documentation, si nécessaire </li></ol><br><p>  Les détails et les détails techniques se trouvent dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation en ligne</a> . </p><br><h1 id="v-kachestve-zaklyucheniya">  En conclusion </h1><br><p>  J'espère que le projet sera utile pour quelqu'un. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dépôt de projets</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dépôt de code source du panneau Web angulaire</a> <br>  Le projet est distribué sous licence MIT et publié en soutien au mouvement DIGITAL RESITANCE. </p><br><p>  Des idées de développement PS au-dessus du toit - et fixez le multilinguisme, et débarrassez-vous des moments codés en dur dans le code, et ajoutez des fonctionnalités pour créer des serveurs, gérer le routage et un pare-feu, transformer le système en <em>concepteur universel</em> , etc.  etc., mais comment et quand tout cela sera-t-il mis en œuvre?  Sans indice, l'avenir se montrera. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412815/">https://habr.com/ru/post/fr412815/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412805/index.html">Mes étapes, mes succès et mes erreurs dans le monde du développement de jeu par l'exemple d'un bot de jeu dans Telegram</a></li>
<li><a href="../fr412807/index.html">Notes du fournisseur IoT. Propriété</a></li>
<li><a href="../fr412809/index.html">Authentification à deux facteurs sur le site à l'aide d'un jeton USB. Comment sécuriser l'accès au portail de services?</a></li>
<li><a href="../fr412811/index.html">C DevTools sur Elbrus: rapports vifs de HolyJS 2018 Piter</a></li>
<li><a href="../fr412813/index.html">En-têtes HTTP inutiles</a></li>
<li><a href="../fr412819/index.html">Vendredi, échauffement pour l'esprit: Karma parfait pour Habrahabr</a></li>
<li><a href="../fr412821/index.html">Voir, regarder, regarder: quelle est la différence?</a></li>
<li><a href="../fr412823/index.html">Interview en anglais: comment ne pas faire pire que l'ami du fils de la mère</a></li>
<li><a href="../fr412825/index.html">Périphériques bloc QEMU</a></li>
<li><a href="../fr412827/index.html">Pavel Durov: après l'appel de l'ILV, Apple a bloqué les mises à jour de Telegram dans le monde</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>