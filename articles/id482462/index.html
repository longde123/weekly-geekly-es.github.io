<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧘 🖊️ 👩 Pelajari Metaflow dalam 10 Menit 🌬️ 🎖️ 🐁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Metaflow adalah kerangka kerja Python yang dibuat di Netflix dan berfokus pada bidang Ilmu Data. Yaitu, ia dirancang untuk membuat proyek yang bertuju...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pelajari Metaflow dalam 10 Menit</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/482462/">  Metaflow adalah kerangka kerja Python yang dibuat di Netflix dan berfokus pada bidang Ilmu Data.  Yaitu, ia dirancang untuk membuat proyek yang bertujuan untuk bekerja dengan data, dan untuk mengelola proyek tersebut.  Baru-baru ini, perusahaan memindahkannya ke kategori open-source.  Kerangka kerja Metaflow telah banyak digunakan di dalam Netflix dalam 2 tahun terakhir.  Secara khusus, ia memungkinkan untuk secara signifikan mengurangi waktu yang dibutuhkan untuk menyelesaikan proyek dalam produksi. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/482462/"><img src="https://habrastorage.org/webt/yd/2j/7p/yd2j7p_dpzkyrjeef9us6a7pgs4.png"></a> <br><br>  Bahan yang kami terjemahkan hari ini adalah panduan cepat untuk Metaflow. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Apa itu Metaflow?</font> </h2><br>  Di bawah ini adalah grafik yang menggambarkan implementasi kerangka kerja Metaflow di Netflix. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6bd/bb8/297/6bdbb82972a098b8fd241f42d7f55b51.png"></div><br>  <i><font color="#999999">Implementasi Metaflow di Netflix</font></i> <br><br>  Pada November 2018, kerangka kerja ini digunakan di 134 proyek perusahaan. <br><br>  Metaflow adalah kerangka kerja untuk membuat dan mengeksekusi alur kerja ilmu data.  Ini fitur fitur berikut: <br><br><ul><li>  Komputasi manajemen sumber daya. </li><li>  Peluncuran tugas kemas. </li><li>  Mengelola dependensi eksternal. </li><li>  Versi, melaksanakan kembali tugas, melanjutkan eksekusi tugas yang ditangguhkan. </li><li>  API Klien untuk memeriksa hasil tugas yang dapat digunakan di lingkungan Notebook Jupyter. </li><li>  Dukungan untuk pelaksanaan tugas lokal (misalnya pada laptop) dan jarak jauh (di cloud).  Kemampuan untuk beralih di antara mode-mode ini. </li></ul><br>  Pengguna vtuulos <a href="https://news.ycombinator.com/item%3Fid%3D21698711">menulis</a> di Ycombinator bahwa Metaflow dapat secara otomatis membuat snapshot (snapshot) kode, data, dan dependensi.  Semua ini ditempatkan di repositori dengan pengalamatan berdasarkan konten, yang biasanya didasarkan pada S3, meskipun sistem file lokal juga didukung.  Ini memungkinkan Anda untuk terus melakukan tugas yang dihentikan, mereproduksi hasil yang diperoleh sebelumnya, dan mengeksplorasi segala sesuatu yang berkaitan dengan tugas, misalnya, di Jupyter Notebook. <br><br>  Secara umum, kita dapat mengatakan bahwa Metaflow bertujuan untuk meningkatkan produktivitas para ilmuwan data.  Hal ini dilakukan karena fakta bahwa kerangka kerja memungkinkan mereka untuk terlibat secara eksklusif dalam bekerja dengan data, tanpa terganggu oleh penyelesaian tugas terkait.  Selain itu, Metaflow mempercepat penarikan proyek berdasarkan itu dalam produksi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d16/311/176/d1631117682028c779664c90bef2a885.png"></div><br>  <i><font color="#999999">Kebutuhan seorang ilmuwan data terkait dengan tanggung jawab langsungnya dan solusi dari tugas-tugas tambahan terkait dengan infrastruktur di mana perhitungan dilakukan</font></i> <br><br><h2>  <font color="#3AC1EF">Skenario Alur Kerja dengan Metaflow</font> </h2><br>  Berikut ini beberapa skenario alur kerja yang bisa Anda atur menggunakan Metaflow: <br><br><ul><li>  <b>Kolaborasi</b>  Satu ilmuwan data ingin membantu orang lain menemukan sumber kesalahan.  Pada saat yang sama, asisten ingin mengunduh ke komputernya seluruh lingkungan di mana tugas yang macet bekerja. </li><li>  <b>Kelanjutan dari tugas yang dihentikan dari tempat mereka berhenti.</b>  Beberapa tugas berhenti karena kesalahan (atau dihentikan dengan sengaja).  Kesalahan diperbaiki (atau kode diedit).  Penting untuk memulai kembali tugas sehingga pekerjaannya berlanjut dari tempat gagal (atau dihentikan). </li><li>  <b>Eksekusi tugas hibrid.</b>  Diperlukan untuk melakukan langkah tertentu dari alur kerja secara lokal (mungkin ini adalah langkah mengunduh data dari file yang disimpan dalam folder di komputer), dan langkah lain yang membutuhkan sumber daya komputasi yang besar (mungkin ini adalah pelatihan model) harus dilakukan di cloud. </li><li>  <b>Pemeriksaan metadata diperoleh setelah menyelesaikan tugas.</b>  Tiga data Para ilmuwan terlibat dalam pemilihan hiperparameter dari model yang sama, berusaha meningkatkan akurasi model ini.  Setelah itu, Anda perlu menganalisis hasil tugas untuk melatih model dan memilih set hiperparameter yang telah menunjukkan diri sebagai yang terbaik. </li><li>  <b>Menggunakan beberapa versi dari paket yang sama.</b>  Dalam proyek ini Anda perlu menggunakan versi yang berbeda, misalnya, pustaka sklearn.  Selama preprocessing, versi 0.20 diperlukan, dan selama pemodelan, versi 0.22 diperlukan. </li></ul><br><h2>  <font color="#3AC1EF">Alur Kerja Metaflow Khas</font> </h2><br>  Pertimbangkan alur kerja Metaflow khas dari perspektif konseptual dan pemrograman. <br><br><h3>  <font color="#3AC1EF">▍Konseptual melihat alur kerja Metaflow</font> </h3><br>  Dari sudut pandang konseptual, alur kerja Metaflow (rantai tugas) diwakili oleh <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584">grafik asiklik terarah</a> (DAG).  Ilustrasi di bawah ini akan membantu Anda lebih memahami ide ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/584/53d/52e/58453d52e9dfbd50dcc5b974ffae11e1.png"></div><br>  <i><font color="#999999">Grafik asiklik linier</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d7/a8d/810/3d7a8d81017d4112913a5c081c70b9a8.png"></div><br>  <i><font color="#999999">Grafik asiklik dengan jalur "paralel"</font></i> <br><br>  Setiap node grafik mewakili langkah pemrosesan data dalam alur kerja. <br><br>  Di setiap langkah rantai tugas, Metaflow mengeksekusi kode Python biasa tanpa perubahan khusus.  Kode dieksekusi dalam wadah terpisah di mana kode dikemas bersama dengan dependensinya. <br><br>  Aspek kunci dari arsitektur Metaflow diwakili oleh fakta bahwa itu memungkinkan Anda untuk mengimplementasikan hampir semua perpustakaan eksternal dari ekosistem conda ke dalam proyek yang didasarkan padanya tanpa menggunakan plugin.  Ini membedakan Metaflow dari solusi tujuan umum serupa lainnya.  Misalnya - dari Airflow. <br><br><h3>  <font color="#3AC1EF">▍ Alur kerja Metaflow dalam hal pemrograman</font> </h3><br>  Setiap rantai tugas (aliran) dapat direpresentasikan sebagai kelas Python standar (nama-nama kelas tersebut biasanya memiliki kata <code>Flow</code> ) jika memenuhi persyaratan minimum berikut: <br><br><ul><li>  Kelas ini adalah turunan dari kelas Metaflow <code>FlowSpec</code> . </li><li>  Setiap fungsi yang mewakili langkah dalam rantai tugas telah <code>@step</code> dekorator <code>@step</code> . </li><li>  Di akhir setiap fungsi <code>@step</code> , harus ada indikasi fungsi serupa yang mengikutinya.  Ini dapat dilakukan dengan menggunakan konstruk seperti ini: <code>self.next(self.function_name_here)</code> . </li><li>  Kelas mengimplementasikan fungsi <code>start</code> dan <code>end</code> . </li></ul><br>  Pertimbangkan contoh rantai tugas minimal yang terdiri dari tiga node. <br><br>  Skemanya terlihat seperti ini: <br><br><pre> <code class="python hljs">start → process_message → end</code> </pre> <br>  Ini kodenya: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlowSpec, step <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinearFlow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FlowSpec)</span></span></span><span class="hljs-class">:</span></span>         <span class="hljs-string"><span class="hljs-string">"""     ,      Metaflow.    """</span></span>       <span class="hljs-comment"><span class="hljs-comment">#         @step    def start(self):        self.message = 'Thanks for reading.'        self.next(self.process_message)    @step    def process_message(self):        print('the message is: %s' % self.message)        self.next(self.end)    @step    def end(self):        print('the message is still: %s' % self.message) if __name__ == '__main__':    LinearFlow()</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Instruksi Instalasi Metaflow</font> </h2><br><h3>  <font color="#3AC1EF">▍ Instalasi dan uji coba</font> </h3><br>  Berikut adalah urutan langkah-langkah yang perlu Anda lakukan untuk menginstal dan meluncurkan Metaflow pertama kali: <br><br><ul><li>  Instal Metaflow (disarankan Python 3): <code>pip3 install metaflow</code> . </li><li>  Masukkan fragmen kode di atas (ini dia di GitHub) dalam file <code>linear_flow.py</code> . </li><li>  Untuk melihat arsitektur rantai tugas yang diterapkan oleh kode ini, gunakan perintah <code>python3 linear_flow.py show</code> . </li><li>  Untuk memulai streaming, <code>python3 linear_flow.py run</code> . </li></ul><br>  Anda harus mendapatkan sesuatu yang mirip dengan yang ditunjukkan di bawah ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/281/5af/ec5/2815afec51573d8a01db3cd8b4ae19e0.png"></div><br>  <i><font color="#999999">Pemeriksaan Kesehatan Metaflow yang Berhasil</font></i> <br><br>  Ini ada baiknya memperhatikan beberapa hal.  Kerangka kerja Metaflow membuat <code>.metaflow</code> data <code>.metaflow</code> lokal.  Di sana, ia menyimpan semua metadata yang terkait dengan eksekusi tugas dan snapshot yang terkait dengan sesi eksekusi tugas.  Jika Anda telah mengonfigurasi pengaturan Metaflow terkait dengan penyimpanan cloud, snapshots akan disimpan dalam AWS S3 Bucket, dan metadata yang terkait dengan peluncuran tugas akan menuju ke layanan Metadata, berdasarkan RDS (Relational Data Store, relational data store).  Nanti kita akan berbicara tentang cara menjelajahi metadata ini menggunakan API klien.  Hal sepele lainnya, meskipun penting, yang perlu diperhatikan, adalah pengidentifikasi proses (pid, ID proses) yang dilampirkan pada langkah-langkah berbeda berbeda.  Ingat - kami katakan di atas bahwa Metaflow secara mandiri mengemas setiap langkah dari rantai tugas dan melakukan setiap langkah di lingkungannya sendiri (hanya mengirimkan data di antara langkah-langkah tersebut). <br><br><h3>  <font color="#3AC1EF">▍Penginstalan dan konfigurasi conda (jika Anda berencana untuk menerapkan dependensi)</font> </h3><br>  Ikuti langkah-langkah ini untuk menginstal conda: <br><br><ul><li>  <a href="https://docs.conda.io/en/latest/miniconda.html">Unduh</a> dan pasang Miniconda. </li><li>  Tambahkan <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">saluran conda dengan</a> perintah <code>conda config --add channels conda-forge</code> . </li></ul><br>  Anda sekarang siap untuk menanamkan dependensi conda di rantai tugas Anda.  Detail dari proses ini akan dibahas di bawah ini. <br><br><h2>  <font color="#3AC1EF">Contoh Aliran Kerja Realistis</font> </h2><br>  Di atas, kami berbicara tentang cara menginstal Metaflow, dan bagaimana memastikan bahwa sistemnya operasional.  Selain itu, kami membahas dasar-dasar arsitektur alur kerja dan melihat contoh sederhana.  Di sini kita melihat contoh yang lebih kompleks, sambil mengungkapkan beberapa konsep Metaflow. <br><br><h3>  <font color="#3AC1EF">▍ pekerjaan</font> </h3><br>  Buat alur kerja menggunakan Metaflow yang mengimplementasikan fungsi-fungsi berikut: <br><br><ul><li>  Memuat data film CSV ke dalam kerangka data Pandas. </li><li>  Perhitungan paralel kuartil untuk genre. </li><li>  Menyimpan kamus dengan hasil perhitungan. </li></ul><br><h3>  <font color="#3AC1EF">▍ Rantai tugas</font> </h3><br>  Kerangka kelas <code>GenreStatsFlow</code> ditunjukkan di <code>GenreStatsFlow</code> .  Setelah menganalisanya, Anda akan memahami inti dari pendekatan yang diterapkan di sini untuk menyelesaikan masalah kami. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FlowSpec, step, catch, retry, IncludeFile, Parameter <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenreStatsFlow</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FlowSpec)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-string"><span class="hljs-string">"""    ,  ,   .         :    1)  CSV-   Pandas.    2)     .    3)     .  """</span></span>   @step  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>    <span class="hljs-string"><span class="hljs-string">"""         :        1)      Pandas.        2)    .        3)        .    """</span></span>       <span class="hljs-comment"><span class="hljs-comment"># </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">  CSV         self.genres = []    self.next(self.compute_statistics, foreach='genres') #  1     @catch(var='compute_failed') #  2  @retry(times=1) #  3  @step  def compute_statistics(self):    """    .   ."""    self.genre = self.input #  4    # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">        self.next(self.join)     @step  def join(self, inputs):    """       ."""    # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment">      self.next(self.end)     @step  def end(self):      """End the flow."""      pass   if __name__ == '__main__':  GenreStatsFlow()</span></span></code> </pre> <br>  Pertimbangkan beberapa bagian penting dari contoh ini.  Kode tersebut berisi komentar dari bentuk <code>#  n</code> , yang akan kita rujuk di bawah ini. <br><br><ul><li>  Dalam <code> 1</code> , pada langkah <code>start</code> , perhatikan parameter <code>foreach</code> .  Berkat itu, salinan langkah-langkah <code>compute_statistics</code> secara <code>compute_statistics</code> dalam <code>for each</code> loop <code>for each</code> entri dalam daftar <code>genres</code> . </li><li>  Dalam <code> 2</code> dekorator <code>@catch(var='compute_failed')</code> menangkap setiap pengecualian yang terjadi pada langkah <code>compute_statistics</code> dan menulisnya ke variabel <code>compute_failed</code> (dapat dibaca pada langkah berikutnya). </li><li>  Dalam <code> 3</code> dekorator <code>@retry(times=1)</code> melakukan persis seperti yang diisyaratkan namanya.  Yakni, ketika kesalahan terjadi, ia mengulangi langkahnya. </li><li>  Di mana dalam <code> 4</code> , dalam <code>compute_statistics</code> , <code>self.input</code> ?  Masalahnya, <code>input</code> adalah variabel kelas yang disediakan oleh Metaflow.  Ini berisi data yang berlaku untuk instance tertentu dari <code>compute_statistics</code> (ketika ada banyak salinan fungsi yang dieksekusi secara paralel).  Variabel ini ditambahkan oleh Metaflow hanya ketika node diwakili oleh beberapa proses paralel, atau ketika beberapa node digabungkan. </li><li>  Berikut ini adalah contoh menjalankan fungsi yang sama secara paralel - <code>compute_statistics</code> .  Tetapi, jika perlu, Anda dapat secara bersamaan menjalankan fungsi yang sama sekali berbeda yang tidak saling terkait.  Untuk melakukan ini, ubah apa yang ditunjukkan pada <code> 1</code> menjadi sesuatu seperti <code>self.next(self.func1, self.function2, self.function3)</code> .  Tentu saja, dengan pendekatan ini, akan perlu untuk menulis ulang langkah <code>join</code> juga, sehingga memungkinkan untuk memproses hasil dari berbagai fungsi di dalamnya. </li></ul><br>  Inilah cara membayangkan kelas kerangka di atas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7af/b4b/d00/7afb4bd00f2cea2df0ebf9fff780b8d2.png"></div><br>  <i><font color="#999999">Representasi visual dari kelas GenreStatsFlow</font></i> <br><br><h3>  <font color="#3AC1EF">EadBaca file data dan parameter transfer</font> </h3><br><ul><li>  Unduh file CSV film <a href="https://www.mediafire.com/file/g9vfu4xxqbs4h2o/movies.csv/file">ini</a> . </li><li>  Sekarang Anda perlu melengkapi program dengan dukungan untuk kemungkinan mentransfer path secara dinamis ke file <code>movie_data</code> dan nilai <code>max_genres</code> ke <code>max_genres</code> .  Mekanisme argumen eksternal akan membantu kita dalam hal ini.  Metaflow memungkinkan Anda untuk menyampaikan argumen ke program dengan menggunakan flag tambahan di perintah mulai alur kerja.  Sebagai contoh, ini mungkin terlihat seperti ini: <code>python3 tutorial_flow.py run --movie_data=path/to/movies.csv --max_genres=5</code> . </li><li>  Metaflow memberi pengembang objek <code>IncludeFile</code> dan <code>Parameter</code> yang memungkinkan Anda membaca input dalam kode alur kerja.  Kami merujuk ke argumen yang diteruskan dengan menetapkan objek <code>IncludeFile</code> dan <code>Parameter</code> ke variabel kelas.  Tergantung pada apa yang ingin kita baca - file, atau nilai yang biasanya. </li></ul><br>  Begini cara kode terlihat seperti membaca parameter yang diteruskan ke program saat diluncurkan dari baris perintah: <br><br><pre> <code class="python hljs">    movie_data = IncludeFile(<span class="hljs-string"><span class="hljs-string">"movie_data"</span></span>,                             help=<span class="hljs-string"><span class="hljs-string">"The path to a movie metadata file."</span></span>,                             default = <span class="hljs-string"><span class="hljs-string">'movies.csv'</span></span>)                               max_genres = Parameter(<span class="hljs-string"><span class="hljs-string">'max_genres'</span></span>,                help=<span class="hljs-string"><span class="hljs-string">"The max number of genres to return statistics for"</span></span>,                default=<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br><h3>  <font color="#3AC1EF">▍Masukkan conda dalam rantai tugas</font> </h3><br><ul><li>  Jika Anda belum menginstal konda, lihat bagian tentang menginstal dan mengkonfigurasi conda di artikel ini. </li><li>  Tambahkan dekorator <code>GenreStatsFlow</code> disediakan oleh Metaflow ke kelas GenreStatsFlow.  Penghias ini mengharapkan untuk diberikan versi python.  Itu dapat diatur dalam kode, atau diperoleh dengan menggunakan fungsi bantu.  Di bawah ini adalah kode yang menunjukkan penggunaan dekorator dan menunjukkan fungsi pembantu. <br><br><pre> <code class="plaintext hljs">def get_python_version():    """     ,    python,       .         conda        python.    """    import platform    versions = {'2' : '2.7.15',                '3' : '3.7.4'}    return versions[platform.python_version_tuple()[0]] #       python. @conda_base(python=get_python_version()) class GenreStatsFlow(FlowSpec):</code> </pre> </li><li>  Sekarang Anda dapat menambahkan dekorator <code>@conda</code> ke setiap langkah dalam rantai tugas.  Itu mengharapkan objek dengan dependensi, yang diteruskan ke sana melalui parameter <code>libraries</code> .  Metaflow, sebelum memulai langkah, akan mengambil tugas mempersiapkan wadah dengan dependensi yang ditentukan.  Jika perlu, Anda dapat dengan aman menggunakan versi paket yang berbeda pada langkah yang berbeda, karena Metaflow meluncurkan setiap langkah dalam wadah yang terpisah. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">    @conda(libraries={'pandas' : '0.24.2'})    @step    def start(self):</span></span></code> </pre> </li><li>  Sekarang jalankan perintah berikut: <code>python3 tutorial_flow.py --environment=conda run</code> . </li></ul><br><h3>  <font color="#3AC1EF">▍Langkah mulai implementasi</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@conda(libraries={'pandas' : '0.24.2'})    @step    def start(self):    """         :        1)      Pandas.        2)    .        3)        .    """        import pandas        from io import StringIO        #      Pandas.        self.dataframe = pandas.read_csv(StringIO(self.movie_data))        #   'genres'      .         #   .        self.genres = {genre for genres \                       in self.dataframe['genres'] \                       for genre in genres.split('|')}        self.genres = list(self.genres)        #        .        #  'foreach'             #          self.next(self.compute_statistics, foreach='genres')</span></span></code> </pre> <br>  Pertimbangkan beberapa fitur kode ini: <br><br><ul><li>  Perhatikan bahwa ekspresi impor panda ada di dalam fungsi yang menjelaskan langkah tersebut.  Faktanya adalah bahwa ketergantungan ini diperkenalkan oleh conda hanya dalam lingkup langkah ini. </li><li>  Tetapi variabel yang dideklarasikan di sini ( <code>dataframe</code> dan <code>genres</code> ) tersedia bahkan dalam kode langkah-langkah yang dilakukan setelah langkah ini.  Intinya adalah bahwa Metaflow bekerja berdasarkan prinsip-prinsip pemisahan lingkungan eksekusi kode, tetapi memungkinkan data untuk bergerak secara alami di antara langkah-langkah rantai tugas. </li></ul><br><h3>  <font color="#3AC1EF">▍ Implementasi langkah compute_statistics</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@catch(var='compute_failed')    @retry    @conda(libraries={'pandas' : '0.25.3'})    @step    def compute_statistics(self):        """            .        """        #             # 'input'.        self.genre = self.input        print("Computing statistics for %s" % self.genre)        #         ,         #        .        selector = self.dataframe['genres'].\                   apply(lambda row: self.genre in row)        self.dataframe = self.dataframe[selector]        self.dataframe = self.dataframe[['movie_title', 'genres', 'gross']]        #     gross   .        points = [.25, .5, .75]        self.quartiles = self.dataframe['gross'].quantile(points).values        #  ,    .        self.next(self.join)</span></span></code> </pre> <br>  Harap perhatikan bahwa pada langkah ini kami merujuk ke variabel <code>dataframe</code> yang dideklarasikan pada langkah <code>start</code> sebelumnya.  Kami memodifikasi variabel ini.  Saat beralih ke langkah berikutnya, pendekatan ini, yang menyiratkan penggunaan objek <code>dataframe</code> baru yang dimodifikasi, memungkinkan Anda untuk mengatur kerja yang efisien dengan data. <br><br><h3>  <font color="#3AC1EF">▍ Terapkan langkah bergabung</font> </h3><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@conda(libraries={'pandas' : '0.25.3'})    @step    def join(self, inputs):        """               .        """        inputs = inputs[0:self.max_genres]        #   ,    .        self.genre_stats = {inp.genre.lower(): \                            {'quartiles': inp.quartiles,                             'dataframe': inp.dataframe} \                            for inp in inputs}        self.next(self.end)</span></span></code> </pre> <br>  Di sini perlu menyoroti beberapa poin: <br><br><ul><li>  Pada langkah ini, kami menggunakan versi panda perpustakaan yang sama sekali berbeda. </li><li>  Setiap elemen dalam array <code>inputs</code> adalah salinan dari <code>compute_statistics</code> dieksekusi sebelumnya.  Ini berisi keadaan menjalankan fungsi yang sesuai, yaitu, nilai-nilai berbagai variabel.  Jadi, <code>input[0].quartiles</code> dapat berisi kuartil untuk genre <code>comedy</code> , dan <code>input[1].quartiles</code> <code>input[0].quartiles</code> dapat berisi kuartil untuk genre <code>sci-fi</code> . </li></ul><br><h3>  <font color="#3AC1EF">DraftSiap draft</font> </h3><br>  Kode proyek lengkap yang baru saja kami ulas dapat ditemukan di <a href="https://github.com/Viveckh/metaflow_crash_course_prep/blob/master/tutorial_flow.py">sini</a> . <br><br>  Untuk melihat bagaimana alur kerja yang dijelaskan dalam file <code>tutorial_flow.py</code> , Anda perlu menjalankan perintah berikut: <br><br><pre> <code class="python hljs">python3 tutorial_flow.py --environment=conda show</code> </pre> <br>  Gunakan perintah berikut untuk memulai alur kerja: <br><br><pre> <code class="python hljs">python3 tutorial_flow.py --environment=conda run --movie_data=path/to/movies.csv --max_genres=<span class="hljs-number"><span class="hljs-number">7</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Meneliti hasil dari menjalankan alur kerja menggunakan API klien</font> </h2><br>  Untuk memeriksa snapshot data dan status peluncuran alur kerja sebelumnya, Anda dapat menggunakan <a href="https://docs.metaflow.org/metaflow/client">API</a> klien yang disediakan oleh Metaflow.  API ini sangat ideal untuk mengeksplorasi rincian percobaan yang dilakukan di lingkungan Notebook Jupyter. <br><br>  Berikut adalah contoh sederhana dari output dari <code>genre_stats</code> , yang diambil dari data peluncuran <code>GenreStatsFlow</code> sukses terakhir. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> metaflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flow, get_metadata <span class="hljs-comment"><span class="hljs-comment">#      print("Using metadata provider: %s" % get_metadata()) #     MovieStatsFlow. run = Flow('GenreStatsFlow').latest_successful_run print("Using analysis from '%s'" % str(run)) genre_stats = run.data.genre_stats print(genre_stats)</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Menjalankan alur kerja di cloud</font> </h2><br>  Setelah Anda membuat dan menguji alur kerja di komputer biasa, sangat mungkin bahwa Anda ingin menjalankan kode di cloud untuk mempercepat pekerjaan. <br><br>  Saat ini, Metaflow hanya mendukung integrasi dengan AWS.  Pada gambar berikut, Anda dapat melihat pemetaan sumber daya lokal dan cloud yang digunakan oleh Metaflow. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/acc/458/08aacc458fc3202ec08624422bef0cb4.png"></div><br>  <i><font color="#999999">Metaflow dan Integrasi AWS</font></i> <br><br>  Untuk menghubungkan Metaflow ke AWS, Anda harus menyelesaikan langkah-langkah berikut: <br><br><ul><li>  Pertama, Anda perlu melakukan pengaturan AWS satu kali dengan membuat sumber daya yang dapat bekerja dengan Metaflow.  Sumber daya yang sama dapat digunakan, misalnya, oleh anggota tim kerja yang saling menunjukkan hasil alur kerja.  <a href="https://docs.metaflow.org/metaflow-on-aws/deploy-to-aws">Anda</a> dapat menemukan instruksi yang relevan di sini.  Pengaturan cukup cepat, karena Metaflow memiliki templat pengaturan CloudFormation. </li><li>  Selanjutnya, di komputer lokal, Anda perlu menjalankan perintah <code>metaflow configure aws</code> dan memasukkan jawaban untuk pertanyaan sistem.  Dengan data ini, Metaflow akan dapat menggunakan gudang data berbasis cloud. </li><li>  Sekarang, untuk memulai alur kerja lokal di cloud, cukup tambahkan <code>--with batch</code> kunci <code>--with batch</code> ke <code>--with batch</code> mulai alur kerja.  Misalnya, ini mungkin terlihat seperti ini: <code>python3 sample_flow.py run --with batch</code> . </li><li>  Untuk melakukan peluncuran alur kerja hibrid, yaitu, untuk melakukan beberapa langkah secara lokal, dan beberapa di cloud, Anda perlu menambahkan dekorator <code>@batch</code> ke langkah-langkah yang perlu dilakukan di cloud.  Misalnya, seperti ini: <code>@batch(cpu=1, memory=500)</code> . </li></ul><br><h2>  <font color="#3AC1EF">Ringkasan</font> </h2><br>  Di sini, saya ingin mencatat beberapa fitur Metaflow yang dapat dianggap sebagai kelebihan dan kekurangan dari kerangka kerja ini: <br><br><ul><li>  Metaflow terintegrasi erat dengan AWS.  Tetapi dalam rencana pengembangan kerangka kerja ada dukungan untuk sejumlah besar penyedia cloud. </li><li>  Metaflow adalah alat yang hanya mendukung antarmuka baris perintah.  Itu tidak memiliki antarmuka grafis (tidak seperti kerangka kerja universal lainnya untuk mengatur proses kerja, seperti Airflow). </li></ul><br>  <b>Pembaca yang budiman!</b>  Apakah Anda berencana menggunakan Metaflow? <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id482462/">https://habr.com/ru/post/id482462/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id482450/index.html">MVP telah berkembang menjadi produk atau pengalaman saya dengan MVP pada tahun 2019</a></li>
<li><a href="../id482452/index.html">Sistem Brasil bukan mitos. Bagaimana cara menggunakannya di TI?</a></li>
<li><a href="../id482456/index.html">FunCode kami, atau Bagaimana kami mengadakan kontes untuk pengembang iOS</a></li>
<li><a href="../id482458/index.html">5 fitur Python yang tidak saya ketahui - tetapi sia-sia</a></li>
<li><a href="../id482460/index.html">SQL HowTo: menggambar pola beku di SQL</a></li>
<li><a href="../id482464/index.html">Apa itu * args dan ** kwargs dengan Python?</a></li>
<li><a href="../id482466/index.html">5 hal yang dapat Anda lakukan untuk mempersiapkan Vue 3.0</a></li>
<li><a href="../id482468/index.html">5 ekstensi dan tema untuk Kode VS yang dapat mengubah kehidupan pengembang front-end</a></li>
<li><a href="../id482470/index.html">Pemuatan halaman cepat pada ponsel murah yang paling sederhana</a></li>
<li><a href="../id482472/index.html">Terbuat dari apakah JavaScript?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>