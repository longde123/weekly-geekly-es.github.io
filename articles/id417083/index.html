<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ğŸ½ ğŸ¤›ğŸ¾ ğŸ“¹ Banyak sekali Piala Dunia 2018 ğŸ• ğŸ‘¨ğŸ¼â€ğŸ”§ ğŸŒ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Piala Dunia FIFA 2018 yang lalu di Rusia membawa banyak beban tidak hanya ke pusat transportasi negara itu, tetapi juga ke infrastruktur TI penyiar Ru...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Banyak sekali Piala Dunia 2018</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/417083/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/f6/ai/wy/f6aiwyf_p22fasac5t1n7plgxts.jpeg"></div><br>  Piala Dunia FIFA 2018 yang lalu di Rusia membawa banyak beban tidak hanya ke pusat transportasi negara itu, tetapi juga ke infrastruktur TI penyiar Rusia terbesar, yang membuat pertandingan tersedia dalam format siaran online.  Kami menerima dengan penuh minat tantangan baru yang datang ke server yang dilayani bersamaan dengan demam sepak bola. <a name="habracut"></a><br><br><h2>  Kata Pengantar: beban tinggi? </h2><br>  Percakapan tentang beban tinggi sering dimulai dengan refleksi pada topik, muatan apa yang bisa dianggap â€œtinggiâ€: ribuan permintaan per detik untuk dinamika?  Atau bahkan sejumlah kecil permintaan sehubungan dengan sumber daya yang tersedia?  Jutaan pengunjung per hari?  Ratusan node beban kerja dalam sebuah cluster? .. <br><br>  Untuk mendapatkan gambaran tentang "skala bencana", fakta bahwa kita berbicara tentang pengguna yang <b>secara bersamaan</b> melihat siaran, yang jumlahnya mencapai angka <b>2 juta</b> , sudah cukup.  Apa yang terjadi jika Anda melihat siaran pertandingan "dari dalam", dan bagaimana Anda bisa mengatur lalu lintas yang belum pernah terjadi sebelumnya? <br><br><h2>  Tiga paus </h2><br><h3>  1. Arsitektur situs dan sistem terjemahan </h3><br>  Skema umum interaksi antara pengguna akhir dan sistem terjemahan dikurangi menjadi skema berikut: <br><br><ul><li>  Pengguna datang ke situs tempat pemain diluncurkan untuk menonton video.  Pemain itu sendiri ditulis dalam JavaScript dan memuatnya mengarah ke banyak permintaan statika, serta berbagai API yang terkait dengan terjemahan. </li><li>  Antara lain, ada banding ke balancer untuk daftar putar untuk pemutaran. </li><li>  Daftar putar adalah sekumpulan fragmen video pendek yang terus diperbarui yang di-cache di server CDN. </li><li>  Saat menonton video pengguna secara waktu nyata, berbagai statistik dikumpulkan, yang, khususnya, diperhitungkan untuk penyeimbangan beban oleh CDN (bersama dengan bandwidth aktual yang tersedia). </li></ul><br>  Arsitektur untuk distribusi langsung video dirancang dan diimplementasikan oleh kekuatan internal insinyur pelanggan bahkan sebelum dimulainya kerjasama kami.  Kemudian, selain layanan itu sendiri, kami terlibat dalam desain dan commissioning infrastruktur untuk beberapa komponennya, serta situs itu sendiri, yang memainkan peran penting dalam skema keseluruhan. <br><br>  Situs, yang diluncurkan dalam produksi beberapa tahun lalu, difokuskan pada skalabilitas horizontal - termasuk banyak pusat data: <br><br><img src="https://habrastorage.org/webt/bc/gn/yj/bcgnyjjy1ypstqp2vp3pnltpidk.png"><br><br>  Skema yang disajikan di sini disederhanakan dan dimaksudkan untuk menunjukkan sifat skalabilitas situs, yang komponennya didistribusikan di berbagai pusat data. <br><br><h3>  2. CDN </h3><br>  Kembali benar-benar menonton video, jelas bahwa beban utama jatuh pada server CDN.  Dalam angka untuk Piala Dunia masa lalu, kita berbicara tentang lalu lintas konstan, yang diukur dalam <b>terabit per detik</b> .  Dan dalam banyak hal, keberhasilan karya terjemahan dengan beban puncak adalah karena caching pada CDN dari segala sesuatu yang dapat ditransfer ke mereka, dan meminimalkan biaya sumber daya (jaringan, CPU, RAM, ...) dari operasi lain. <br><br>  Selain itu, poin penting dalam bekerja dengan CDN adalah interaksi dengan API mereka untuk mendapatkan informasi yang relevan tentang total dan bandwidth yang tersedia.  Dalam sistem siaran, data ini digunakan untuk mendistribusikan pemirsa baru dan mendistribusikan kembali yang sekarang. <br><br>  Jadi, jika server CDN dapat menyediakan bandwidth yang cukup untuk jutaan pemirsa Internet, lalu kapan masalah bisa terjadi?  Selama kejuaraan, kami mengamati dua skenario utama: <br><br><ol><li>  Untuk beberapa alasan, ada jeda dalam siaran. <br><br>  <i>Sebagai contoh, pengaturan sistem yang "dimainkan" di salah satu pertandingan kejuaraan sehingga layanan perlindungan DDoS, yang tidak mengharapkan muatan yang tiba-tiba, mulai menganggap apa yang terjadi sebagai serangan, memblokir ketersediaan server CDN satu demi satu ... sampai diberitahukan bahwa situasinya adalah dalam arti ekstrim, tetapi masih penuh waktu (kesimpulan yang diperlukan dibuat - dalam siaran berikutnya situasinya tidak terulang).</i> <br><br>  Pada saat-saat seperti itu, semua pengguna yang dikalahkan oleh masalah besar mulai menyegarkan halaman dengan pemain. </li><li>  Suatu gol yang dicetak (terutama yang pertama), sebagai suatu peraturan, memprovokasi gelombang besar penonton dalam periode waktu yang terbatas. <br><br>  <i>Jika kita berbicara tentang angka yang lebih spesifik, maka arus masuk sebesar ratusan ribu pengguna dalam 1-1,5 menit.</i> </li></ol><br>  Kedua kasus ini menghasilkan lonjakan tajam dalam permintaan untuk konten situs dinamis yang perlu ditangani oleh sumber daya yang tersedia.  Bagaimana masalah tersebut dilacak dan diselesaikan? <br><br><h3>  3. Pemantauan dan statistik waktu nyata </h3><br>  Dimungkinkan untuk bercanda dengan tingkat kebenaran yang signifikan bahwa selama seluruh kejuaraan, kami memiliki jabatan khusus, yang tugasnya termasuk menonton sepak bola dengan penuh perhatian di tempat kerja.  Tentu saja, itu bukan tentang sepakbola seperti itu, tetapi tentang reaksi cepat terhadap insiden yang dipicu oleh pertandingan atau keadaan lainnya ... <br><br>  Apa "keadaan lain"?  Pada acara-acara publik seperti itu, bahkan pengaruh cuaca pun terlihat.  Berikut adalah dua contoh dari kejuaraan yang kami temui: <br><br><ol><li>  Ketika badai mulai selama salah satu pertandingan, penyedia TV satelit memiliki masalah peralatan (mereka tidak bisa mengirim sinyal).  Hal ini menyebabkan lonjakan lalu lintas yang nyata (sekitar 10%) dalam waktu singkat, karena dalam mencari solusi alternatif yang mendesak, pemirsa mulai online secara besar-besaran dan melanjutkan penelusuran di sana. </li><li>  Ketika hujan mulai turun pada pertandingan terakhir, sedikit (sekitar 3%) lompatan pemutusan dan koneksi ulang pengguna (setelah sekitar 5 menit) terlihat.  Dalam hal ini, tidak ada masalah yang diamati dalam siaran itu sendiri, yaitu alasan untuk lompatan tidak memiliki dasar teknis.  Asumsinya adalah bahwa penonton yang menonton sepak bola di jalan (seperti saya sendiri) pindah ke kamar karena hujan, dan untuk waktu yang singkat ini mereka terputus dari siaran. </li></ol><br>  Kembali ke topik pemantauan itu sendiri - selama berlangsungnya seluruh kejuaraan, <b>praktik</b> pertemuan <b>reguler (setelah setiap siaran puncak)</b> dianggap normal oleh para pengembang, yang menganalisis semua situasi kritis (atau yang dekat dengan itu) dan konsekuensinya - untuk meminimalkan potensi masalah di lain kali  Server / layanan apa yang ada pada batasnya?  Pertanyaan apa yang sangat menuntut?  Permintaan apa yang dapat dihapus (ditransfer ke CDN ke cache selama beberapa detik)?  Permintaan apa yang bisa di-cache lebih lama (setiap 3 menit, bukan per menit)?  Apa yang akan terjadi dengan proyeksi peningkatan jumlah penonton, karena Rusia akan bermain? .. <br><br>  <i><b>Berbicara</b> tentang Rusia.</i>  <i>Seperti yang Anda tebak, rata-rata beberapa kali lebih banyak orang datang ke pertandingan dengan tim nasional Rusia daripada yang lain.</i>  <i>Dan semakin jauh tim kami naik braket turnamen, semakin sulit untuk menggabungkan kegembiraan kami dalam hal ini dengan kinerja tugas langsung - karena semuanya rumit oleh pertumbuhan penonton yang tak kenal lelah.</i>  <i>Terlepas dari kenyataan bahwa sistem ini dirancang untuk menahan beban yang sangat besar, dalam jadwal kerja normal hal itu tidak sering terjadi (kurang dari 10 kali setahun) ... dan dalam kasus Piala Dunia, kami mengamati puncak beban hampir setiap hari selama sebulan.</i>  <i>Keuntungan dari mode ini, bagaimanapun, adalah kemungkinan luas untuk mendeteksi kemacetan aktual yang terdeteksi hanya pada saat-saat beban seperti itu.</i> <br><br>  Jadi, jika bagian dari masalah teknis murni dihilangkan oleh grafik standar dari sistem pemantauan, maka dalam solusi masalah yang lebih kompleks dan / atau berorientasi logika bisnis, pencapaian proyek dengan nama internal yang berbicara "Statistik waktu nyata" memainkan peran besar. <br><br><h4>  Statistik waktu nyata </h4><br>  Komponen penting dari infrastruktur penyiaran Internet ini dirancang dan diimplementasikan oleh upaya kami untuk menyediakan alat intelijen bisnis untuk data teknis yang dikumpulkan dari pemain tempat pengguna menonton video.  Pada intinya, ini adalah sistem logging yang: <br><br><ul><li>  mengumpulkan semua jenis data yang tersedia tentang pengguna (browser, IP, dll. - untuk kesederhanaan, kita dapat mengatakan bahwa ini adalah karakteristik yang biasa kita lihat dalam statistik di audiens situs); </li><li>  melengkapi mereka dengan data teknis tentang penyiaran (bitrate, dll.) dan peristiwa / masalah yang telah terjadi (pengalihan CDN, kegagalan melihat ...); </li><li>  menyediakan penyeimbang dengan data untuk penyeimbangan beban optimal pada server CDN (sesuai dengan karakteristik masing-masing pengguna); </li><li>  mengirimkan peringatan yang diperlukan kepada teknisi yang bertugas dan membuat bagan bisnis yang bermanfaat. </li></ul><br>  Poin terakhir adalah yang paling menarik, karena: <br><br><ol><li>  <b>Peringatan</b> sistem statistik ini adalah komponen kunci dari pemantauan yang memungkinkan Anda untuk "mengikuti perkembangan" indikator praktis selama siaran.  Menganalisa mereka (di tempat di mana otomatisasi tidak cukup), petugas membuat keputusan yang tepat untuk meningkatkan kualitas layanan secara real time.  <i>Sebagai contoh:</i> <br><ul><li>  <i>Apakah banyak pengguna beralih dari server CDN yang sama?</i>  <i>Itu harus sementara dinonaktifkan dari rotasi (atau hubungi penyedia untuk respon cepat).</i> </li><li>  <i>Sudahkah pengguna mulai mengalami masalah besar menonton video?</i>  <i>Saatnya untuk analisis mendesak penyebabnya.</i> </li></ul></li><li>  <b>Bagan</b> adalah statistik bisnis real-time yang memungkinkan Anda untuk menjawab pertanyaan-pertanyaan utama, seperti: <br><ul><li>  <i>Berapa banyak pengguna yang menonton siaran terakhir?</i> </li><li>  <i>Berapa persentase pengguna yang memiliki masalah pada menit terakhir, dan apa sifat mereka?</i> </li></ul><br>  Karena peristiwa serupa memiliki profil grafik yang sama, grafik itu sendiri memungkinkan Anda untuk memprediksi pertumbuhan jumlah pengguna selama beberapa menit berikutnya dan mengambil <b>tindakan proaktif</b> jika perlu. </li></ol><br>  Karena statistik ini bekerja secara real time dan sangat penting untuk kualitas seluruh layanan, bahkan menonton video sederhana secara alami oleh jutaan pengguna tidak akan mudah untuk mendistribusikan konten melalui CDN kepada mereka.  ClickHouse DBMS membantu mencapai perekaman cepat data baru dari banyak pemain (kita berbicara tentang puluhan ribu permintaan per detik untuk merekam ke setiap server), dan Grafana biasa digunakan untuk grafik. <br><br><img src="https://habrastorage.org/webt/uc/y0/j8/ucy0j8ygu0rs2qj50-8my9aucfg.jpeg"><br>  <i>Ilustrasi rasio pemirsa video online sebelum, selama dan setelah pertandingan</i> <br><br>  <i><b>Omong-omong</b> : Solusi yang menarik selama beban puncak adalah menonaktifkan HTTPS (mendukung HTTP) untuk permintaan dari sistem statistik, yang menyebabkan pengurangan dua kali lipat pada beban CPU pada beberapa server.</i> <br><br><h2>  Ringkasan </h2><br>  Keberhasilan siaran online dari acara berskala besar <i>(bahkan YouTube TV <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak selalu dapat mengatasi</a> beban!)</i> Disediakan oleh tiga faktor utama: <br><br><ol><li>  arsitektur yang kompeten (untuk sistem dan situs siaran), yang bahkan tanpa menggunakan sistem modern seperti Kubernetes pada awalnya berorientasi pada muatan tinggi, skalabilitas, dan kesiapan untuk semburan signifikan; </li><li>  Server CDN dengan bandwidth yang cukup; </li><li>  pemantauan khusus, yang memungkinkan: a) untuk melacak masalah secara real time, b) untuk memberikan informasi yang diperlukan untuk menghindarinya di masa depan. </li></ol><br>  Meskipun sebenarnya ada lebih banyak faktor ... dan salah satunya, mungkin, dapat melampaui semua faktor teknis - manusia.  Peran paling penting dimainkan oleh para spesialis yang tidak hanya mampu melakukan dan mengikat semua yang diperlukan secara teknis, tetapi juga tanpa lelah mencapai hasil, yang secara khusus ingin saya perhatikan manfaat dari manajemen pelanggan. <br><br>  <i><b>NB</b> tentang Kubernet yang disebutkan ... sebuah kisah yang mungkin diharapkan banyak pembaca dari blog kita.</i>  <i>Proses migrasi sistem penyiaran ke sana sudah dimulai, tetapi selama Piala Dunia, perkembangan ini belum terlibat.</i> <br><br><h2>  PPS </h2><br>  Baca juga di blog kami: <br><br><ul><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">10 langkah yang jelas untuk mempersiapkan infrastruktur toko online Anda untuk Black Friday</a> .â€ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id417083/">https://habr.com/ru/post/id417083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id417071/index.html">Jumat PHP: Webinar Skillbox Gratis</a></li>
<li><a href="../id417073/index.html">Hari Pengembang Seluler Uber</a></li>
<li><a href="../id417075/index.html">API Cat CSS</a></li>
<li><a href="../id417079/index.html">Package Manager untuk Kubernetes - Helm: Past, Present, Future</a></li>
<li><a href="../id417081/index.html">Utara, akan, berharap, negara tanpa batas, atau Bagaimana proyek dibuat dalam kondisi Siberia yang parah</a></li>
<li><a href="../id417085/index.html">Browser membisukan suara dalam aplikasi WebRTC Anda. Hentikan apa?</a></li>
<li><a href="../id417087/index.html">HPE Digitize 2018: acara dan siaran langsung</a></li>
<li><a href="../id417089/index.html">Komputer kuantum: satu foton untuk memerintah semua</a></li>
<li><a href="../id417091/index.html">Buat shader air kartun untuk web. Bagian 3</a></li>
<li><a href="../id417093/index.html">Sakelar sentuh dengan Modbus: mengapa diperlukan dan bagaimana menerapkannya di apartemen pintar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>