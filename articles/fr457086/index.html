<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐶 🍩 🤱🏻 Motif architectural "Builder" dans l'univers de "Swift" et "iOS" / "macOS" ⏺️ 🕢 🧙🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette fois, je voudrais parler un peu d'un autre modèle de conception générative de l'arsenal Gang of Four - «Builder» . Il s'est avéré qu'au cours de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Motif architectural "Builder" dans l'univers de "Swift" et "iOS" / "macOS"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457086/"><p>  Cette fois, je voudrais parler un peu d'un autre modèle de conception générative de l'arsenal Gang of Four - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Builder»</a> .  Il s'est avéré qu'au cours de mon expérience (bien que pas trop étendue), j'ai souvent vu que le modèle était utilisé dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le</a> code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java</a> en général et dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les</a> applications <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Android</a> en particulier.  Dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les</a> projets <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"iOS"</a> , qu'ils soient écrits en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Swift"</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Objective-C"</a> , le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pattern</a> était assez rare pour moi.  Néanmoins, avec toute sa simplicité, dans des cas appropriés, il peut s'avérer assez pratique et, comme c'est à la mode pour le dire, puissant. <a name="habracut"></a></p><br><p><img src="https://habrastorage.org/webt/yb/mn/d3/ybmnd3bovtbxkuii2d4iot2lxsu.jpeg" alt="image"></p><br><p>  Le modèle est utilisé pour remplacer le processus d'initialisation complexe en construisant l'objet souhaité étape par étape, avec la méthode de finalisation appelée à la fin.  Les étapes peuvent être facultatives et ne doivent pas avoir une séquence d'appel stricte. </p><br><p><img src="https://habrastorage.org/webt/m8/4m/ho/m84mhoyuodwqs34x4d2wqolx7dc.gif" alt="image"></p><br><h2 id="primer-iz-foundation">  Exemple de fondation </h2><br><p> Dans les cas où l ' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«URL»</a> souhaitée <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">n'est</a> pas fixe, mais est construite à partir de composants (par exemple, l'adresse d'hôte et le chemin relatif vers la ressource), vous avez probablement utilisé le mécanisme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>URLComponents</code></a> pratique de la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Foundation</a> . </p><br><p>  <code>URLComponents</code> est, pour la plupart, juste une classe qui combine de nombreuses variables qui stockent les valeurs de divers composants URL, ainsi que la propriété <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>url</code></a> , qui renvoie l'URL appropriée pour l'ensemble actuel de composants.  Par exemple: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> urlComponents = <span class="hljs-type"><span class="hljs-type">URLComponents</span></span>() urlComponents.scheme = <span class="hljs-string"><span class="hljs-string">"https"</span></span> urlComponents.user = <span class="hljs-string"><span class="hljs-string">"admin"</span></span> urlComponents.password = <span class="hljs-string"><span class="hljs-string">"qwerty"</span></span> urlComponents.host = <span class="hljs-string"><span class="hljs-string">"somehost.com"</span></span> urlComponents.port = <span class="hljs-number"><span class="hljs-number">80</span></span> urlComponents.path = <span class="hljs-string"><span class="hljs-string">"/some/path"</span></span> urlComponents.queryItems = [<span class="hljs-type"><span class="hljs-type">URLQueryItem</span></span>(name: <span class="hljs-string"><span class="hljs-string">"page"</span></span>, value: <span class="hljs-string"><span class="hljs-string">"0"</span></span>)] <span class="hljs-number"><span class="hljs-number">_</span></span> = urlComponents.url <span class="hljs-comment"><span class="hljs-comment">// https://admin:qwerty@somehost.com:80/some/path?page=0</span></span></code> </pre> <br><p>  En fait, le cas d'utilisation ci-dessus est l'implémentation du modèle Builder.  Dans ce cas, <code>URLComponents</code> agit comme le constructeur lui-même, attribuer des valeurs à ses différentes propriétés ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>scheme</code></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>host</code></a> , etc.) est l'initialisation du futur objet par étapes, et appeler la propriété <code>url</code> est comme une méthode de finalisation. </p><br><p>  <em>Dans les commentaires, des batailles houleuses se sont déroulées au sujet des documents <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«RFC»</a> décrivant «l'URL» et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«l'URI»</a> , donc, pour être plus précis, je propose par exemple de supposer que nous ne parlons que de «l'URL» des ressources distantes, et ne tenons pas compte de tels Les schémas "URL", comme, par exemple, "fichier".</em> </p><br><p>  Tout semble bien se passer si vous utilisez rarement ce code et connaissez toutes ses subtilités.  Et si vous oubliez quelque chose?  Par exemple, quelque chose d'important comme une adresse d'hôte?  Selon vous, quel sera le résultat de l'exécution du code suivant? </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> urlComponents = <span class="hljs-type"><span class="hljs-type">URLComponents</span></span>() urlComponents.scheme = <span class="hljs-string"><span class="hljs-string">"https"</span></span> urlComponents.path = <span class="hljs-string"><span class="hljs-string">"/some/path"</span></span> <span class="hljs-number"><span class="hljs-number">_</span></span> = urlComponents.url</code> </pre> <br><p>  Nous travaillons avec des propriétés, pas avec des méthodes, et aucune erreur ne sera "rejetée" à coup sûr.  La propriété <code>url</code> "finalizing" renvoie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une</a> valeur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">facultative</a> , alors peut-être que nous obtenons <code>nil</code> ?  Non, nous obtenons un objet à part entière de type <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>URL</code></a> avec une valeur vide de sens - "https: / some / path".  Par conséquent, il m'est venu à l'esprit de m'exercer à écrire mon propre «constructeur» basé sur l ' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«API»</a> décrite ci-dessus. </p><br><h2 id="zdes-dolzhen-byl-byt-emodzi-velosiped-no-habr-ego-ne-otobrazhaet">  (Il aurait dû y avoir un "emoji" "vélo", mais "Habr" ne l'affiche pas) </h2><br><p>  Malgré ce qui précède, je considère <code>URLComponents</code> comme <code>URLComponents</code> «API» bonne et pratique pour assembler des «URL» à partir de composants et, au contraire, «analyser» les composants des «URL» bien connues.  Par conséquent, sur la base de cela, nous écrivons maintenant notre propre type qui recueille l '"URL" des parties et possède (supposons) l' "API" dont nous avons actuellement besoin. </p><br><p>  Tout d'abord, je veux me débarrasser de l'initialisation disparate en attribuant de nouvelles valeurs à toutes les propriétés nécessaires.  Au lieu de cela, nous implémentons la possibilité de créer une instance du générateur et d'attribuer des valeurs à toutes les propriétés à l'aide de méthodes appelées par la chaîne.  La chaîne se termine par une méthode de finalisation, dont le résultat de l'appel sera l'instance correspondante de l' <code>URL</code> .  Peut-être avez-vous rencontré quelque chose comme « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>StringBuilder</code></a> en Java» au cours de votre parcours de vie - nous allons nous efforcer pour une telle «API» maintenant. </p><br><p>  Pour pouvoir appeler des méthodes-étapes le long de la chaîne, chacune d'elles doit renvoyer une instance du générateur courant, à l'intérieur de laquelle la modification correspondante sera stockée.  Pour cette raison, et aussi pour se débarrasser de la copie multiple d'objets et de la danse autour des méthodes de <code>mutating</code> , surtout sans réfléchir, nous allons déclarer notre constructeur une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe</a> : </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLBuilder</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br><p>  Nous déclarerons des méthodes qui spécifient les paramètres de la future "URL", en tenant compte des exigences ci-dessus: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scheme = <span class="hljs-string"><span class="hljs-string">"https"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> port: <span class="hljs-type"><span class="hljs-type">Int?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> queryItems: [<span class="hljs-type"><span class="hljs-type">String</span></span> : <span class="hljs-type"><span class="hljs-type">String</span></span>]? <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(scheme: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.scheme = scheme <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.user = user <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(password: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.password = password <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.host = host <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(port: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.port = port <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.path = path <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(queryItems: [String : String])</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.queryItems = queryItems <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } }</code> </pre> <br><p>  Nous enregistrons les paramètres spécifiés dans les propriétés privées de la classe pour une utilisation future par la méthode de finalisation. </p><br><p>  Un autre hommage à l '«API» sur laquelle nous basons notre classe est la propriété <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>path</code></a> , qui, contrairement à toutes les propriétés voisines, n'est pas facultative, et s'il n'y a pas de chemin relatif, elle stocke une chaîne vide comme valeur. </p><br><p>  Pour écrire cela, en fait, la méthode de finalisation, vous devez penser à quelques autres choses.  Premièrement, l'URL comporte certaines parties sans lesquelles, comme cela a été indiqué au début, elle n'a plus de sens - c'est le <code>scheme</code> et l' <code>host</code> .  Nous avons «attribué» le premier avec la valeur par défaut, donc, l'ayant oublié, nous recevrons toujours, très probablement, le résultat attendu. </p><br><p>  Avec le second, les choses sont un peu plus compliquées: on ne peut pas lui attribuer de valeur par défaut.  Dans ce cas, nous avons deux façons: en l'absence de valeur pour cette propriété, renvoyer <code>nil</code> ou renvoyer une erreur et laisser le code client décider lui-même quoi faire avec.  La deuxième option est plus compliquée, mais elle vous permettra d'indiquer explicitement une erreur de programmation spécifique.  Peut-être, par exemple, nous emprunterons cette voie. </p><br><p>  Un autre point intéressant concerne les propriétés de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>user</code></a> et du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>password</code></a> : elles n'ont de sens que si elles sont utilisées simultanément.  Mais que se passe-t-il si un programmeur oublie d'affecter l'une de ces deux valeurs? </p><br><p>  Et, probablement, la dernière chose à considérer est qu'à la suite de la méthode de finalisation, nous voulons avoir la valeur de la propriété <code>url</code> de <code>URLComponents</code> , et cela, dans ce cas, n'est pas très utile en option.  Bien que, pour toute combinaison de valeurs définies de propriétés <code>nil</code> , nous ne l'obtiendrons pas.  (Seule une instance vide, juste créée, d' <code>URLComponents</code> n'aura pas de valeur.) Pour surmonter cela, vous pouvez utiliser <code>!</code>  - opérateur "déballage forcé".  Mais en général, je ne voudrais pas encourager son utilisation, par conséquent, dans notre exemple, nous résumons brièvement la connaissance des subtilités de «Foundation» et considérons la situation en discussion comme une erreur système, dont l'occurrence ne dépend pas de notre code. </p><br><p>  Donc: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">URL</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> host = host <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">URLBuilderError</span></span>.emptyHost } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> password != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">URLBuilderError</span></span>.inconsistentCredentials } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> password != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> user != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">URLBuilderError</span></span>.inconsistentCredentials } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> urlComponents = <span class="hljs-type"><span class="hljs-type">URLComponents</span></span>() urlComponents.scheme = scheme urlComponents.user = user urlComponents.password = password urlComponents.host = host urlComponents.port = port urlComponents.path = path urlComponents.queryItems = queryItems?.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> { <span class="hljs-type"><span class="hljs-type">URLQueryItem</span></span>(name: $<span class="hljs-number"><span class="hljs-number">0</span></span>, value: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = urlComponents.url <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">URLBuilderError</span></span>.systemError <span class="hljs-comment"><span class="hljs-comment">// Impossible? } return url } enum URLBuilderError: Error { case emptyHost case inconsistentCredentials case systemError } }</span></span></code> </pre> <br><p>  C'est tout, peut-être!  Maintenant, une création éclatée de l '«URL» de l'exemple au début pourrait ressembler à ceci: </p><br><pre> <code class="swift hljs"><span class="hljs-number"><span class="hljs-number">_</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">URLBuilder</span></span>() .with(user: <span class="hljs-string"><span class="hljs-string">"admin"</span></span>) .with(password: <span class="hljs-string"><span class="hljs-string">"Qwerty"</span></span>) .with(host: <span class="hljs-string"><span class="hljs-string">"somehost.com"</span></span>) .with(port: <span class="hljs-number"><span class="hljs-number">80</span></span>) .with(path: <span class="hljs-string"><span class="hljs-string">"/some/path"</span></span>) .with(queryItems: [<span class="hljs-string"><span class="hljs-string">"page"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>]) .build() <span class="hljs-comment"><span class="hljs-comment">// https://admin:Qwerty@somehost.com:80/some/path?page=0</span></span></code> </pre> <br><p>  Bien sûr, utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>try</code></a> dehors d'un <code>catch</code> <code>do</code> - <code>catch</code> ou sans opérateur <code>?</code>  si une erreur se produit, le programme se bloquera.  Mais nous avons donné au «client» l'occasion de traiter les erreurs comme bon lui semble. </p><br><p>  <em>Oui, et une autre fonctionnalité utile de la construction étape par étape à l'aide de ce modèle est la possibilité de placer des étapes dans différentes parties du code.</em>  <em>Pas le cas le plus fréquent, mais néanmoins.</em>  <em>Merci <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">akryukov</a> pour le rappel!</em> </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Le modèle est extrêmement facile à comprendre et tout ce qui est simple est, comme vous le savez, ingénieux.  Ou vice versa?  Eh bien, tant pis.  L'essentiel est que moi, sans un mouvement de l'âme, je peux dire que cela (le modèle), déjà arrivé, m'a aidé à résoudre les problèmes de création de processus d'initialisation grands et complexes.  Par exemple, le processus de préparation d'une session de communication avec le serveur de la bibliothèque, que j'ai écrit pour un service il y a presque deux ans.  Soit dit en passant, le code est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«open source»</a> et, si vous le souhaitez, il est tout à fait possible de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous familiariser</a> avec lui.  (Bien que, depuis lors, beaucoup d'eau ait coulé, et d'autres programmeurs se sont appliqués à ce code.) </p><br><p>  <strong>Mes autres articles sur les modèles de conception:</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Factory Method" et "Abstract Factory" dans l'univers de "Swift" et "iOS"</a> , </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Le modèle architectural d'itérateur dans l'univers Swift</a> , </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Le motif architectural« Visitor »dans l'univers iOS et Swift</a> . </li></ul><br><p>  <em>Et c'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mon «Twitter»</a> pour satisfaire un intérêt hypothétique dans mon activité public-professionnel.</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457086/">https://habr.com/ru/post/fr457086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457070/index.html">Textolite au lieu de carton. Quelques mots sur le badge interactif OFFZONE 2019</a></li>
<li><a href="../fr457072/index.html">Comment résoudre un ancien problème en utilisant ML en Python et .Net</a></li>
<li><a href="../fr457074/index.html">L'évolution des développeurs: à quels jeux faut-il s'attendre à l'avenir</a></li>
<li><a href="../fr457078/index.html">Comment transformer votre avatar Telegram en montre</a></li>
<li><a href="../fr457082/index.html">Octroi imperceptible de droits d'administrateur</a></li>
<li><a href="../fr457090/index.html">Lits de sécurité: JWT</a></li>
<li><a href="../fr457092/index.html">Nous étudions MITRE ATT & CK. Matrices mobiles: accès aux appareils. Partie 5</a></li>
<li><a href="../fr457094/index.html">Complément Excel qui facilite la définition de filtres lorsque vous travaillez avec des cubes (VBA)</a></li>
<li><a href="../fr457096/index.html">Nous libérons nos mains de plusieurs analystes: API Livy pour l'automatisation des tâches bancaires typiques</a></li>
<li><a href="../fr457098/index.html">Gestion élégante des erreurs JavaScript avec la monade Either</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>