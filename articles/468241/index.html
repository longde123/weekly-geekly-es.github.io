<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎴 🦃 🚴🏻 TR-069 en Mikrotik. Prueba de Freeacs como un servidor de autoconfiguración para RouterOS 📒 🤰🏽 😧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este artículo, intentaré describir paso a paso el proceso de instalación del servidor de prueba de un excelente proyecto de Freeacs en un estado co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TR-069 en Mikrotik. Prueba de Freeacs como un servidor de autoconfiguración para RouterOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468241/">  En este artículo, intentaré describir paso a paso el proceso de instalación del servidor de prueba de un excelente proyecto de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Freeacs</a> en un estado completamente funcional, y mostrar técnicas prácticas para trabajar con mikrotik: configuración a través de parámetros, ejecución de script, actualización, instalación de módulos adicionales, etc. <br><br>  El propósito del artículo es alentar a sus colegas a abandonar la administración de dispositivos de red que utilizan terribles rastrillos y muletas, en forma de guiones autoescritos, Dude, Ansible, etc. Y, en este sentido, causan fuegos artificiales y alegría masiva en las plazas. <br><a name="habracut"></a><br><h4>  0. Elección </h4><br>  ¿Por qué los freeacs, no los genie-ac, mencionados en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mikrotik-wiki</a> , son más animados? <br>  Porque según los genios con mikrotik hay publicaciones de los españoles.  Aquí están su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pdf</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">video</a> de MUM del año pasado.  Las caravanas automáticas en diapositivas son geniales, pero me gustaría alejarme del concepto de escribir guiones, ejecutar guiones, ejecutar guiones ... <br><br><h4>  1. Instalar freeacs </h4><br>  Lo instalaremos en Centos7, y dado que los dispositivos transmiten muchos datos, y ACS está trabajando activamente con la base de datos, no seremos codiciosos con los recursos.  Para un trabajo cómodo, asignamos 2 núcleos de CPU, 4 GB de RAM y 16 GB de almacenamiento rápido ssd raid10.  Instalaré freeacs en el contenedor Proxmox VE lxc, y puedes trabajar en cualquier herramienta que sea conveniente para ti. <br>  Recuerde configurar la hora correcta en la máquina con ACS. <br><br>  El sistema será de prueba, por lo que no seremos inteligentes y solo usaremos el script de instalación amablemente proporcionado, tal como es. <br><br><pre><code class="bash hljs">wget https://raw.githubusercontent.com/freeacs/freeacs/master/scripts/install_centos.sh chmod +x install_centos.sh ./ install_centos.sh</code> </pre> <br>  Tan pronto como se complete el script, puede acceder inmediatamente a la interfaz web en la máquina ip, con las credenciales admin / freeacs <br><br><img src="https://habrastorage.org/webt/uf/w0/xn/ufw0xnstxoxejymip04wkk17sca.png"><br>  <i>Aquí hay una interfaz minimalista tan agradable, y lo genial y rápido que resultó todo</i> <br><br><h4>  2. Configuración inicial de freeacs </h4><br>  La unidad de control básica para ACS es una unidad o CPE (Equipo de instalaciones del cliente).  Y lo más importante, lo que necesitamos para administrar unidades es su Tipo de unidad, es decir,  modelo de equipo que define un conjunto de parámetros de unidad personalizables y su software.  Pero si bien no sabemos cómo obtener el nuevo Tipo de unidad, es mejor preguntarle a la unidad activando el Modo de descubrimiento. <br><br>  En producción, este modo es absolutamente imposible de usar, pero necesitamos arrancar el motor pronto y ver las capacidades del sistema.  Todos los ajustes básicos se almacenan en / opt / freeacs- *.  Por lo tanto, abrir <br><br><pre> <code class="bash hljs"> vi /opt/freeacs-tr069/config/application-config.conf</code> </pre> <br>  encontramos <br><br><pre> <code class="bash hljs">discovery.mode = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  y cambiar a <br><br><pre> <code class="bash hljs">discovery.mode = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  Además, nos gustaría aumentar los tamaños máximos de archivos con los que trabajarán nginx y mysql.  Para mysql, agregue la línea a /etc/my.cnf <br><br><pre> <code class="bash hljs">max_allowed_packet=32M</code> </pre> <br>  , y para nginx, en /etc/nginx/nginx.conf add <br><br><pre> <code class="bash hljs">client_max_body_size 32m;</code> </pre> <br>  a la sección http.  De lo contrario, podemos trabajar con firmware no más de 1M. <br><br>  Reiniciamos y estamos listos para trabajar con dispositivos. <br><br>  Y en el papel del dispositivo (CPE) tendremos el <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hAP</a></b> kid <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ACAP lite</a></b> . <br><br>  Antes de la conexión de prueba, es aconsejable configurar manualmente el CPE a la configuración mínima de trabajo para que los parámetros que desee configurar en el futuro no estén vacíos.  Para el enrutador, puede habilitar mínimamente el cliente dhcp en ether1, instalar el paquete tr-069client y establecer contraseñas. <br><br><h4>  3. Conectamos Mikrotik </h4><br>  Se recomienda conectar todas las unidades utilizando un número de serie válido como inicio de sesión.  Entonces todo estará claro para ti en los registros.  Alguien aconseja usar WAN MAC, no lo crea.  Alguien usa un par de inicio de sesión / pase común para todos: omítalos. <br><br>  Abrimos el registro tr-069 para monitorear "negociaciones" <br><br><pre> <code class="bash hljs">tail -f /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/freeacs-tr069/tr069-conversation.log</code> </pre> <br>  Abra winbox, elemento de menú TR-069. <br>  URL de ACS: <code>http://10.110.0.109/tr069/prov</code> (reemplace con su IP) <br>  Nombre de usuario: 9249094C26CB (copie la serie del sistema&gt; enrutador) <br>  Contraseña: 123456 (no necesaria para el descubrimiento, pero para ser) <br>  Intervalo de información periódica que no cambiamos.  Emitiremos esta configuración a través de nuestro ACS <br><br>  A continuación se encuentran las configuraciones para la inicialización de la conexión remota, pero no pude trabajar con mikrotik para que esto suceda.  Aunque la solicitud remota funciona con teléfonos listos para usar.  Será necesario entenderlo. <br><br><img src="https://habrastorage.org/webt/xo/xp/sx/xoxpsxqyjlnpjcuph3xhjjanrpc.png"><br><br>  Después de hacer clic en el botón Aplicar, los datos se intercambiarán en el terminal, y en la interfaz web de Freeacs puede ver nuestro enrutador con el tipo de unidad creado automáticamente "hAPaclite". <br><br><img src="https://habrastorage.org/webt/ov/sc/nu/ovscnujrn-t5deekdeqgbpl-y6e.png"><br><br>  El enrutador está conectado.  Puede ver el tipo de unidad creado automáticamente.  Abra <code>Easy Provisioning &gt; Unit Type &gt; Unit Type Overview &gt; hAPaclite</code> .  ¡Qué hay no solo!  Hasta 928 parámetros (espiaba en el shell).  Ya sea mucho o poco, lo resolveremos más tarde, pero por ahora solo un vistazo rápido.  Esto es lo que significa Tipo de unidad.  Esta es una lista de parámetros admitidos con claves pero sin valores.  Los valores se establecen en los niveles siguientes: Perfiles y unidades. <br><br><h4>  4. Configurar Mikrotik </h4><br>  Es hora de descargar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la</a> guía de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">interfaz web</a> . Esta guía de 2011 es como una botella de buen vino añejado.  Abramos y dejemos respirar. <br><br>  Y nosotros mismos, en la interfaz web, haga clic en el lápiz al lado de nuestra unidad y entre en el modo de configuración de la unidad.  Se ve así: <br><br><img src="https://habrastorage.org/webt/it/3l/tf/it3ltfcesvywjovfuqgurxoj_co.png"><br><br>  Examine brevemente lo que es interesante en esta página: <br><br>  <i>Bloque de configuración de la unidad</i> <br><br><ul><li>  Perfil: este es el perfil dentro del tipo de unidad.  La jerarquía es esta: <code>UnitType &gt; Profile &gt; Unit</code> .  Es decir, podemos obtener, por ejemplo, perfiles <code>hAPaclite &gt; hotspot</code> y <code>hAPaclite &gt; branch</code> , pero dentro del modelo de dispositivo </li></ul><br>  <i>Aprovisionamiento de botones</i> <br>  Las sugerencias sugieren que todos los botones en el bloque de Aprovisionamiento pueden aplicar instantáneamente la configuración a través de ConnectionRequestURL.  Pero, como dije anteriormente, esto no funciona, así que después de hacer clic en los botones, deberá reiniciar el cliente tr-069 en mikrotik para iniciar el aprovisionamiento manualmente. <br><br><ul><li>  Freq / Spread: cuántas veces a la semana para entregar ±% de configuración para reducir la carga en el servidor y los canales de comunicación.  Por defecto cuesta 7/20, es decir  todos los días ± 20% y una pista como esta en segundos.  Si bien no tiene sentido cambiar la frecuencia de entrega, tk.  habrá un exceso de ruido en los registros y no siempre la aplicación esperada de la configuración </li></ul><br>  <i>Historial de aprovisionamiento de bloques</i> (últimas 48 horas) <br><br><ul><li>  Parece una historia, como una historia, pero al hacer clic en el título, ingresa a una conveniente herramienta de búsqueda de base de datos, con expresiones regulares y bollos </li></ul><br>  <i>Bloque de parámetros</i> <br><br>  El bloque más grande e importante, donde, de hecho, los parámetros para esta unidad se configuran y leen.  Ahora solo vemos los parámetros del sistema más importantes, sin los cuales ACS no puede funcionar con la unidad.  Pero recordamos que tenemos <i>928</i> en Tipo de unidad.  Miremos todos los valores y decidamos qué come todo con Mikrotik. <br><br><h4>  4.1 Leer los parámetros </h4><br>  En el bloque Aprovisionamiento, haga clic en el botón Leer todo.  En el bloque: una inscripción roja.  La columna de <i>valor CPE (actual)</i> aparece a la derecha.  En la configuración del sistema, ProvisioningMode cambió a READALL. <br><br><img src="https://habrastorage.org/webt/eu/tg/no/eutgnogavgnitu8wwhvtb7w4qcw.png"><br><br>  Y ... nada sucederá excepto el mensaje en System.X_FREEACS-COM.IM.Message <code>Kick failed at...</code> <br><br>  Reinicie el cliente TR-069 o reinicie el enrutador y continúe actualizando la página del navegador hasta que obtenga los parámetros en los alegres rectángulos grises a la derecha <br>  Si alguien quiere tomar un sorbo del viejo sazonado, este modo en el manual se describe como 10.2 Modo de inspección.  Se enciende y funciona un poco mal, pero la esencia se describe bastante <br><br><img src="https://habrastorage.org/webt/em/ut/g1/emutg1mnfctnq7vh5uoqr48wwiu.png"><br><br>  El modo READALL se apagará después de 15 minutos, e intentaremos averiguar qué es útil y qué se puede corregir "sobre la marcha" mientras estamos en este modo. <br><br>  Puede cambiar las direcciones IP, habilitar / deshabilitar interfaces, reglas de firewall, que tienen comentarios (de lo contrario, un desastre completo), Wi-Fi, etc. <br><br>  Es decir, todavía no es posible configurar mikrotik cuerdo solo con TR-069.  Pero puedes monitorear muy bien.  Estadísticas disponibles sobre interfaces y su estado, memoria libre, etc. <br><br><h4>  4.2 Parámetros de entrega </h4><br>  Ahora tratemos de entregar los parámetros al enrutador, a través de tr-069, de forma "natural".  La primera víctima será Device.DeviceInfo.X_MIKROTIK_SystemIdentity.  Lo encontramos en los parámetros de la unidad Todos.  Aparentemente, no está configurado.  Esto significa que cualquier unidad puede tener cualquier identidad.  Basta! <br>  Presiona un poco en la columna de creación, establece el nombre Mr.White y presiona el botón Actualizar parámetros.  Lo que sucederá después ya lo has adivinado.  En la próxima sesión de comunicación con la sede, el enrutador debe cambiar su identidad. <br><br><img src="https://habrastorage.org/webt/yn/an/e8/ynane8pm3vt76wuvhwtfoqtxvis.png"><br><br>  Pero esto no es suficiente para nosotros.  Es bueno tener siempre a mano un parámetro como Identidad al buscar la unidad deseada.  Introducimos el nombre del parámetro y colocamos los indicadores Display (D) y Searchable (S).  La clave del parámetro cambia a RWSD (recuerde, los nombres y las claves se configuran en el nivel más alto de Tipo de unidad) <br><br><img src="https://habrastorage.org/webt/40/yf/zg/40yfzgpolinlrvj6aqq0zxlw0js.png"><br><br>  El valor ahora no solo se muestra en la lista de búsqueda general, sino que también está disponible para buscar en <code>Support &gt; Search &gt; Advanced form</code> <br><br><img src="https://habrastorage.org/webt/sd/p_/1g/sdp_1gntzb5ly1wnzrd0uvwbrza.png"><br><br>  Iniciamos la provisión y miramos Identidad.  Hola señor blanco!  Ahora no podrá cambiar su identidad mientras se ejecuta tr-069client <br><br><img src="https://habrastorage.org/webt/by/oc/j4/byocj4kosk_jiekvn8jgkuzi-y0.png"><br><br><h4>  4.3 Ejecutamos scripts </h4><br>  Como descubrimos que no hay manera sin ellos, ejecutémoslos. <br><br>  Pero antes de comenzar a trabajar con archivos, debemos corregir la directiva <code>public.url</code> en el archivo <code>/opt/freeacs-tr069/config/application-config.conf</code> <br>  Después de todo, todavía tenemos una configuración de prueba instalada por un script.  No te olvides <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># --- Public url (used for download f. ex.) --- public.url = "http://10.110.0.109" public.url: ${?PUBLIC_URL}</span></span></code> </pre> <br><br>  Reinicie ACS y diríjase directamente a <code>Files &amp; Scripts</code> . <br><br><img src="https://habrastorage.org/webt/cb/ah/wk/cbahwkm8ckqb0r0gg3q2xsaiumi.png"><br><br>  Pero lo que estamos abriendo ahora pertenece al tipo de unidad, es decir  globalmente a todos los enrutadores hAP ac lite, ya sea un enrutador de sucursal, punto de acceso o capsman.  Todavía no necesitamos un nivel tan alto, por lo tanto, antes de trabajar con scripts y archivos, debe crear un perfil.  Puede llamarlo usted mismo, como la "posición" del dispositivo. <br><br>  Hagamos de nuestro bebé un servidor horario.  Publicación decente con un paquete de software separado y una pequeña cantidad de parámetros.  Vaya a <code>Easy Provisioning &gt; Profile &gt; Create Profile</code> y cree un perfil de servidor de tiempo en Tipo de unidad: <i>hAPaclite</i> .  No teníamos parámetros en el perfil predeterminado, por lo tanto, no hay nada para <i>copiar Copiar parámetros de: "no copiar ..."</i> <br><br><img src="https://habrastorage.org/webt/vf/9y/nc/vf9yncecit2scfc9pezngwg9sz0.png"><br><br>  Todavía no hay parámetros en absoluto, pero será posible establecer aquellos que luego queremos ver en nuestros servidores de tiempo, improvisados ​​desde hAPaclite.  Por ejemplo, las direcciones comunes de los servidores NTP. <br>  Pasemos a la configuración de la unidad, y muévala al perfil del servidor de tiempo <br><br>  Finalmente, vamos a <code>Files &amp; Scripts</code> , hacemos scripts, y aquí estamos esperando bollos increíblemente convenientes. <br><br>  Para ejecutar el script en la unidad, debemos seleccionar <i>Tipo: TR069_SCRIPT</i> y <i>Name</i> y <i>Target Name</i> deben tener la extensión .alter <br>  Al mismo tiempo, para los scripts, a diferencia del software, puede cargar el archivo terminado o simplemente escribirlo / editarlo en el campo <i>Contenido.</i>  Intentemos escribir allí mismo. <br><br>  Y para ver el resultado inmediatamente, agregue un enrutador vlan a ether1 <br><br><pre> <code class="bash hljs">/interface vlan add interface=ether1 name=vlan1 vlan-id=1</code> </pre> <br><img src="https://habrastorage.org/webt/jr/lh/7s/jrlh7sk9y_benjwmujnnv1ypk_u.png"><br><br>  Conduzca, haga clic en <i>Cargar</i> y listo.  Nuestro script <code>vlan1.alter</code> esperando en las alas. <br><br>  Bueno, lo condujo?  No  También debemos agregar un grupo a nuestro perfil.  Los grupos no están incluidos en la jerarquía de equipos, pero son necesarios para buscar unidades en UnitType o Profile y están obligados a ejecutar scripts a través de Advanced Provisioning.  Por lo general, los grupos están asociados con ubicaciones y tienen una estructura anidada.  Hagamos un grupo de Rusia. <br><br><img src="https://habrastorage.org/webt/mz/73/bj/mz73bjayacypyy98f3thi1oe8ng.png"><br><br>  Imagínense que pudimos reducir la búsqueda de "Todos los servidores del mundo en hAPaclite" a "Todos los servidores de Rusia en hAPaclite".  Todavía hay una gran capa de todo lo interesante con los grupos, pero no tenemos tiempo.  Ya condujo a los guiones. <br><br><pre> <code class="plaintext hljs">Advanced Provisioning &gt; Job &gt; Create Job</code> </pre> <br><img src="https://habrastorage.org/webt/si/yh/b4/siyhb4rjztp3yyqi__zgetxhigi.png"><br><br>  Como estamos en modo avanzado, después de todo, aquí puede especificar un montón de condiciones diferentes para comenzar el trabajo, comportamiento de error, reintentos y tiempos de espera.  Recomiendo leerlo todo en manuales o discutirlo más tarde cuando lo implemente en producción.  Por ahora, simplemente ponga n1 en las reglas de detención para que la tarea se detenga tan pronto como se complete en nuestra unidad 1. <br><br>  ¡Completamos lo necesario y solo queda correr! <br><br><img src="https://habrastorage.org/webt/xn/mw/3m/xnmw3mthgxsoyrj1jv7widfjfai.png"><br><br>  Presione START y espere.  ¡Ahora el contador de dispositivos eliminados por un script subdesarrollado se ejecutará rápidamente!  No por supuesto.  Dichas tareas se dan durante mucho tiempo, y esta es su diferencia con los scripts, Ansible, etc.  Las unidades mismas solicitan tareas en un horario o tal como aparecen en la red, ACS realiza un seguimiento de qué unidades ya han recibido tareas y cómo terminaron, y escribe esto en los parámetros de la unidad.  Hay 1 unidad en nuestro grupo, y si hubiera 1001 de ellos, el administrador ejecutaría esta tarea e iría a pescar <br><br>  Vamos  Reinicie el enrutador o reinicie el cliente TR-069.  Todo debería ir sin problemas y Mr.White obtendrá un nuevo vlan.  Y nuestra asignación de la regla de detención entrará en estado PAUSADO.  Es decir, aún se puede reiniciar o cambiar.  Si hace clic en FINALIZAR, la tarea se escribirá en el archivo <br><br><h4>  4.4 Actualización de software </h4><br>  Este es un punto muy importante, ya que el firmware de Mikrotik es modular, pero agregar módulos no cambia la versión general del firmware del dispositivo.  Nuestro ACS es normal y no estoy acostumbrado. <br>  Ahora lo haremos de manera rápida y sucia, e insertaremos el módulo NTP en el firmware general de inmediato, pero tan pronto como la versión se actualice en el dispositivo, no podremos agregar otro módulo de la misma manera. <br>  En producción, es mejor no aplicar este truco, e instalar módulos opcionales para Tipo de unidad solo con scripts. <br><br>  Entonces, lo primero que debemos hacer es preparar los paquetes de software de las versiones y la arquitectura requeridas, y ponerlo en algún servidor web accesible.  Para la prueba, cualquiera irá a lo que nuestro Sr. White puede alcanzar, y para la producción es mejor armar un espejo de actualización automática del software necesario, que no da miedo poner en la web <br>  Importante!  ¡Recuerde incluir siempre un paquete con tr-069client en las actualizaciones! <br><br>  Al final resultó que, la longitud de la ruta a los paquetes es muy importante!  Cuando traté de usar algo como <code>http://192.168.0.237/routeros/stable/mipsbe/routeros-mipsbe-6.45.6.npk</code> , mikrotik cayó en una conexión cíclica al recurso, dando la repetición TRANSFERCOMPLETE al registro tr-069.  Y pasé una cierta cantidad de células nerviosas tratando de descubrir qué estaba mal.  Por lo tanto, mientras ponemos en la raíz, hasta aclaración <br><br>  Entonces, deberíamos tener tres archivos npk disponibles a través de http.  Resultó que para mí <br><br><pre> <code class="bash hljs">http://192.168.0.241/routeros-mipsbe-6.45.6.npk http://192.168.0.241/routeros/stable/mipsbe/ntp-6.45.6-mipsbe.npk http://192.168.0.241/routeros/stable/mipsbe/tr069-client-6.45.6-mipsbe.npk</code> </pre> <br>  Ahora debe emitirse en el archivo xml con FileType = "1 Firmware Upgrade Image", que alimentamos a los microtics.  Deje que el nombre sea ros.xml <br><br>  Seguimos las instrucciones del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mikrotik-wiki</a> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">upgrade</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"links"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">links</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/routeros-mipsbe-6.45.6.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/ntp-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/tr069-client-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">links</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">upgrade</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  La falta de nombre de <code>Username/Password</code> para acceder al servidor de descarga es sorprendente.  Puede intentar ingresar esto como en la cláusula A.3.2.8 del protocolo tr-069: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.237/routeros/stable/mipsbe/ntp-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Username</span></span></span><span class="hljs-tag">&gt;</span></span>user<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span>pass<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  O pregunte directamente al Mikrotik oficial, así como la longitud máxima de ruta a * .npk <br><br>  Vamos a los <code>Files &amp; Scripts</code> que conocemos, y creamos un archivo como SOFTWARE con <b>Nombre:</b> ros.xml, <b>Nombre de destino:</b> ros.xml y <b>Versión:</b> 6.45.6 <br>  Atencion  La versión aquí debe especificarse en el formato en que se muestra en el dispositivo y pasar en el <code>System.X_FREEACS-COM.Device.SoftwareVersion</code> . <br><br>  Seleccionamos nuestro archivo xm para descargar y ya está. <br><br><img src="https://habrastorage.org/webt/th/w7/0-/thw70-pm9bruivrrcogyx1v2vig.png"><br><br>  Ahora tenemos muchas formas de actualizar su dispositivo.  A través del Asistente en el menú principal, a través de Aprovisionamiento avanzado y tareas con el tipo de SOFTWARE, o simplemente vaya a la configuración de la unidad y haga clic en Actualizar.  Elegimos la forma más fácil, e incluso entonces el artículo está hinchado. <br><br><img src="https://habrastorage.org/webt/le/jk/fg/lejkfgwuolymtutzfswkpcnwel0.png"><br><br>  Haga clic en el botón, inicie la provisión y listo.  El programa de prueba se ha completado.  Ahora podemos hacer más con mikrotik. <br><br><h4>  5. Conclusión </h4><br>  Cuando comencé a escribir, quería describir primero la conexión del teléfono IP, y usar su ejemplo para explicar lo genial que puede ser cuando tr-069 funciona fácilmente y sin esfuerzo.  Pero luego, a medida que avanzaba y buscaba los materiales, pensé que para quien conectaba a Mikrotik, ningún teléfono daría miedo para un estudio independiente. <br><br>  En principio, los Freeacs que probamos ya se pueden usar en producción, pero para esto necesita configurar la seguridad, SSL, debe configurar Mikrotik para la configuración automática después del reinicio, debe depurar la adición correcta de Tipo de unidad, desmontar el trabajo de los servicios web y el shell de fusión, y mucho más.  ¡Prueba, inventa y escribe una secuela! <br><br>  ¡Gracias a todos por su atención!  Estaré encantado de enmiendas y comentarios! <br><br>  Lista de materiales utilizados y enlaces útiles: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El hilo del foro que encontré al comienzo de las búsquedas sobre el tema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TR-069 CPE WAN Protocolo de gestión Enmienda-6</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wiki de Freeacs</a> <br>  <a href="">Parámetros tr-069 en Mikrotik, y su conformidad con los comandos del terminal</a> <br><br>  Actualización 10.13.2019: <br><br>  Al revisar la información sobre el proyecto FreeACS, me encontré con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parche</a> muy interesante propuesto por muchachos polacos que tienen FreeACS sirviendo dispositivos de 20K. <br><br>  El parche está hecho para diferentes versiones de hardware, pero en el caso de microtics, le permitirá crear varios tipos de unidades para los mismos enrutadores con un conjunto diferente de módulos de software. <br>  Por ejemplo, hAPaclite-ntp, hAPaclite-ups, etc.  Y, en consecuencia, para eludir la restricción "un modelo == un firmware" </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468241/">https://habr.com/ru/post/468241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468231/index.html">¿Es la seguridad en AEM un problema de plataforma o implementación?</a></li>
<li><a href="../468233/index.html">La forma de escribir comprobando 4 millones de líneas de código Python. Parte 1</a></li>
<li><a href="../468235/index.html">La forma de escribir comprobando 4 millones de líneas de código Python. Parte 2</a></li>
<li><a href="../468237/index.html">La forma de escribir comprobando 4 millones de líneas de código Python. Parte 3</a></li>
<li><a href="../468239/index.html">Elegir la estructura de datos correcta en Swift</a></li>
<li><a href="../468245/index.html">No necesitamos correcciones de traducción: nuestro traductor sabe mejor cómo se debe traducir</a></li>
<li><a href="../468251/index.html">No hay futuro</a></li>
<li><a href="../468253/index.html">Control deslizante de imagen simple en CSS y Javascript</a></li>
<li><a href="../468259/index.html">Cinco aspectos destacados de la Helm Summit 2019 en Amsterdam</a></li>
<li><a href="../468261/index.html">Un nuevo juego con un ambiente antiguo en Three.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>