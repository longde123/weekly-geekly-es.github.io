<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌔 👨‍👦 🛀🏾 Menggunakan modul ketat dalam proyek Python skala besar: pengalaman Instagram. Bagian 1 🕝 📉 ✖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami menerbitkan bagian pertama dari terjemahan artikel berikutnya dalam seri tentang cara kerja Instagram dengan Python. Artikel pertama dalam seri i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menggunakan modul ketat dalam proyek Python skala besar: pengalaman Instagram. Bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/475240/">  Kami menerbitkan bagian pertama dari terjemahan artikel berikutnya dalam seri tentang cara kerja Instagram dengan Python.  Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pertama</a> dalam seri ini berbicara tentang fitur kode server Instagram, bahwa itu adalah monolit yang sering berubah, dan bagaimana alat pengecekan tipe statis membantu mengelola monolit ini.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Materi kedua</a> adalah tentang mengetik API HTTP.  Di sini kita akan berbicara tentang pendekatan untuk memecahkan beberapa masalah yang dihadapi Instagram menggunakan Python dalam proyeknya.  Penulis materi berharap bahwa pengalaman Instagram akan bermanfaat bagi mereka yang mungkin mengalami masalah serupa. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/0h/_k/s9/0h_ks9h22wcs8uc2ohwld0f6uau.png"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Tinjauan situasi</font> </h2><br>  Mari kita lihat modul berikut, yang, pada pandangan pertama, terlihat benar-benar tidak bersalah: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mywebframework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> db, route VALID_NAME_RE = re.compile(<span class="hljs-string"><span class="hljs-string">"^[a-zA-Z0-9]+$"</span></span>) @route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">home</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(db.Model)</span></span></span><span class="hljs-class">:</span></span>     name: str</code> </pre> <br>  Kode apa yang akan dieksekusi jika seseorang mengimpor modul ini? <br><br><ul><li>  Pertama, kode yang terkait dengan ekspresi reguler yang mengkompilasi string ke objek templat akan dieksekusi. </li><li>  Kemudian dekorator <code>@route</code> akan dieksekusi.  Jika kita mengandalkan apa yang kita lihat, maka kita dapat mengasumsikan bahwa di sini, mungkin, representasi yang sesuai terdaftar dalam sistem pemetaan URL.  Ini berarti bahwa impor biasa dari modul ini mengarah pada fakta bahwa di tempat lain keadaan global aplikasi berubah. </li><li>  Sekarang kita akan menjalankan semua kode tubuh dari kelas <code>Person</code> .  Itu bisa mengandung apa saja.  <code>Model</code> kelas dasar mungkin memiliki metaclass atau metode <code>__init_subclass__</code> , yang, pada gilirannya, dapat berisi beberapa kode lain yang dieksekusi ketika mengimpor modul kami. </li></ul><br><h2>  <font color="#3AC1EF">Masalah # 1: startup server lambat dan restart</font> </h2><br>  Satu-satunya baris kode untuk modul ini yang (mungkin) tidak dieksekusi ketika diimpor adalah <code>return "Hello World!"</code>  .  Benar, dengan pasti kita tidak bisa mengatakan ini!  Akibatnya, ternyata dengan mengimpor modul sederhana ini yang terdiri dari delapan baris (dan masih belum menggunakannya dalam program kami), kami dapat menyebabkan ratusan atau bahkan ribuan baris kode Python diluncurkan.  Dan ini belum lagi bahwa impor modul ini menyebabkan modifikasi pemetaan URL global yang terletak di beberapa tempat lain dalam program ini. <br><br>  Apa yang harus dilakukan  Sebelum kita adalah bagian dari konsekuensi dari kenyataan bahwa Python adalah bahasa yang ditafsirkan dinamis.  Ini memungkinkan kita untuk berhasil menyelesaikan berbagai masalah menggunakan metode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">metaprogramming</a> .  Namun, apa yang salah dengan kode ini? <br><br>  Sebenarnya, kode ini dalam urutan sempurna.  Ini berlaku selama seseorang menggunakannya dalam basis kode yang relatif kecil, di mana tim kecil programmer bekerja.  Kode ini tidak menimbulkan masalah selama orang yang menggunakannya dijamin untuk mempertahankan tingkat kedisiplinan tertentu tentang bagaimana tepatnya fitur Python digunakan.  Tetapi beberapa aspek dari dinamisme ini dapat menjadi masalah jika ada jutaan baris kode dalam sebuah proyek yang sedang dikerjakan oleh ratusan programmer, banyak di antaranya tidak memiliki pengetahuan Python yang mendalam. <br><br>  Misalnya, salah satu fitur hebat Python adalah kecepatan langkah-langkah yang terlibat dalam pengembangan bertahap.  Yaitu, hasil dari perubahan kode dapat dilihat secara harfiah segera setelah melakukan perubahan tersebut, tanpa perlu mengkompilasi kode.  Tetapi jika kita berbicara tentang proyek beberapa juta baris (dan diagram dependensi yang agak membingungkan dari proyek ini), maka plus dari Python ini mulai berubah menjadi minus. <br><br>  Diperlukan lebih dari 20 detik untuk memulai server kami.  Dan terkadang, ketika kita tidak memperhatikan optimasi, waktu ini meningkat menjadi sekitar satu menit.  Ini berarti bahwa pengembang perlu 20-60 detik untuk melihat hasil perubahan yang dilakukan pada kode.  Ini berlaku untuk apa yang dapat Anda lihat di browser, dan bahkan pada kecepatan menjalankan tes unit.  Sayangnya, kali ini cukup bagi seseorang untuk terganggu oleh sesuatu dan melupakan apa yang telah ia lakukan sebelumnya.  Sebagian besar waktu ini, secara harfiah, dihabiskan untuk mengimpor modul dan membuat fungsi dan kelas. <br><br>  Di satu sisi, ini sama dengan menunggu hasil kompilasi program yang ditulis dalam bahasa lain.  Tetapi biasanya kompilasi dapat dilakukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">secara bertahap</a> .  Intinya adalah Anda hanya dapat mengkompilasi ulang apa yang telah berubah, dan apa yang secara langsung tergantung pada kode yang diubah.  Akibatnya, biasanya kompilasi proyek, dilakukan setelah melakukan perubahan kecil pada mereka, cepat.  Tetapi ketika bekerja dengan Python, karena perintah impor dapat memiliki segala jenis efek samping, tidak ada cara yang dapat diandalkan dan aman untuk me-restart server secara bertahap.  Pada saat yang sama, skala perubahan tidak penting dan setiap kali kita harus me-restart server sepenuhnya, mengimpor semua modul, menciptakan kembali semua kelas dan fungsi, mengkompilasi ulang semua ekspresi reguler, dan sebagainya.  Biasanya, sejak saat restart server terakhir, 99% kode belum berubah, tetapi kita masih harus melakukan hal yang sama berulang-ulang untuk memasukkan perubahan. <br><br>  Selain memperlambat pengembang, ini mengarah pada pemborosan sumber daya sistem dalam jumlah besar yang tidak produktif.  Faktanya adalah bahwa kami bekerja dalam mode penyebaran perubahan yang berkelanjutan, yang berarti pemuatan ulang kode server produksi secara konstan. <br><br>  Sebenarnya, inilah masalah pertama kami: mulai lambat dan mulai ulang server.  Masalah ini muncul karena fakta bahwa sistem harus terus-menerus melakukan sejumlah besar tindakan berulang selama impor kode. <br><br><h2>  <font color="#3AC1EF">Masalah # 2: Efek Samping dari Perintah Impor Tidak Aman</font> </h2><br>  Ini adalah tugas lain yang, ternyata, pengembang sering menyelesaikan ketika mengimpor modul.  Ini memuat pengaturan dari penyimpanan konfigurasi jaringan: <br><br><pre> <code class="python hljs">MY_CONFIG = get_config_from_network_service()</code> </pre> <br>  Selain memperlambat startup server, itu juga tidak aman.  Jika layanan jaringan tidak tersedia, maka ini tidak hanya akan mengarah pada kenyataan bahwa kami akan menerima pesan kesalahan tentang ketidakmampuan untuk memenuhi beberapa permintaan.  Ini akan menyebabkan server gagal memulai. <br><br>  Mari kita kentalkan catnya dan bayangkan seseorang ditambahkan ke modul yang bertanggung jawab untuk menginisialisasi layanan jaringan penting, beberapa kode yang dieksekusi selama impor.  Pengembang sama sekali tidak tahu di mana menambahkan kode ini kepadanya, jadi dia meletakkannya dalam modul yang diimpor pada tahap awal memulai server.  Ternyata skema ini berhasil, sehingga solusinya dianggap berhasil dan pekerjaan terus berlanjut. <br><br>  Tetapi kemudian orang lain menambahkan di tempat lain tim impor, yang pada pandangan pertama tidak berbahaya.  Akibatnya, melalui rantai impor dengan kedalaman dua belas modul, ini mengarah pada fakta bahwa modul yang mengunduh pengaturan dari jaringan sekarang diimpor ke modul yang menginisialisasi layanan jaringan yang sesuai. <br><br>  Sekarang ternyata kami mencoba menggunakan layanan sebelum diinisialisasi.  Sistem mengalami crash secara alami.  Dalam kasus terbaik, jika kita berbicara tentang sistem di mana interaksi sepenuhnya deterministik, ini dapat mengarah pada fakta bahwa pengembang akan menghabiskan satu atau dua jam mencari tahu bagaimana perubahan kecil menyebabkan kegagalan dalam sesuatu, dengan dia, tampaknya tidak terhubung.  Tetapi dalam situasi yang lebih kompleks, ini dapat menyebabkan "jatuhnya" proyek dalam produksi.  Namun, tidak ada cara universal untuk menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">linter</a> untuk memerangi masalah seperti itu atau untuk mencegahnya. <br><br>  Akar masalahnya terletak pada dua faktor, interaksi yang mengarah pada konsekuensi yang menghancurkan: <br><br><ol><li>  Python memungkinkan modul untuk memiliki efek samping yang sewenang-wenang dan tidak aman yang terjadi selama impor. </li><li>  Urutan impor kode tidak diatur secara eksplisit dan tidak dikontrol.  Pada skala proyek, semacam "impor komprehensif" adalah apa yang terdiri dari perintah impor yang terdapat di semua modul.  Dalam hal ini, urutan impor modul dapat bervariasi tergantung pada titik input sistem yang digunakan. </li></ol><br>  <i><font color="#999999">Dilanjutkan ...</font></i> <br><br>  <b>Pembaca yang budiman!</b>  Apakah Anda mengalami masalah terkait dengan lambatnya memulai proyek Python? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id475240/">https://habr.com/ru/post/id475240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id475214/index.html">Ketika sebuah perusahaan meninggal: bagaimana cara bertahan hidup dari kebangkrutan</a></li>
<li><a href="../id475218/index.html">Protokol kriptografi: definisi, catatan, properti, klasifikasi, serangan</a></li>
<li><a href="../id475228/index.html">Garpu penggajian. Anda adalah seorang programmer untuk ibu</a></li>
<li><a href="../id475236/index.html">Jangan pernah mengabaikan pelatihan penguatan lagi.</a></li>
<li><a href="../id475238/index.html">Timeline Blade Runner - November 2019. Apakah ramalan itu menjadi kenyataan?</a></li>
<li><a href="../id475242/index.html">Menggunakan modul ketat dalam proyek Python skala besar: pengalaman Instagram. Bagian 2</a></li>
<li><a href="../id475244/index.html">Fitur JavaScript Baru yang Diharapkan Harus Anda Ketahui</a></li>
<li><a href="../id475246/index.html">Pemrograman Asinkron Python: Tinjauan Singkat</a></li>
<li><a href="../id475248/index.html">Penggunaan polyfill saat menulis aplikasi lintas-browser</a></li>
<li><a href="../id475250/index.html">Sebagai Redash memperhatikan dan memperbaiki masalah yang menyebabkan penurunan kinerja kode Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>