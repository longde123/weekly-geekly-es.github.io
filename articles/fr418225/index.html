<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ğŸ›ƒ ğŸ Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Native Client Sandbox Part 2 ğŸ‘¨â€ğŸŒ¾ ğŸ‘¨ğŸ»â€ğŸ¤ ğŸ‘©ğŸ¼â€ğŸ¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Institut de technologie du Massachusetts. Cours magistral # 6.858. "SÃ©curitÃ© des systÃ¨mes informatiques." Nikolai Zeldovich, James Mickens. 2014 annÃ©e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Native Client Sandbox Part 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418225/"><h3>  Institut de technologie du Massachusetts.  Cours magistral # 6.858.  "SÃ©curitÃ© des systÃ¨mes informatiques."  Nikolai Zeldovich, James Mickens.  2014 annÃ©e </h3><br>  Computer Systems Security est un cours sur le dÃ©veloppement et la mise en Å“uvre de systÃ¨mes informatiques sÃ©curisÃ©s.  Les confÃ©rences couvrent les modÃ¨les de menace, les attaques qui compromettent la sÃ©curitÃ© et les techniques de sÃ©curitÃ© basÃ©es sur des travaux scientifiques rÃ©cents.  Les sujets incluent la sÃ©curitÃ© du systÃ¨me d'exploitation (OS), les fonctionnalitÃ©s, la gestion du flux d'informations, la sÃ©curitÃ© des langues, les protocoles rÃ©seau, la sÃ©curitÃ© matÃ©rielle et la sÃ©curitÃ© des applications Web. <br><br>  Cours 1: Â«Introduction: modÃ¨les de menaceÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 2: Â«ContrÃ´le des attaques de piratesÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 3: Â«DÃ©bordements de tampon: exploits et protectionÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 4: Â«SÃ©paration des privilÃ¨gesÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 5: Â«D'oÃ¹ viennent les systÃ¨mes de sÃ©curitÃ©?Â» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> <br>  ConfÃ©rence 6: Â«OpportunitÃ©sÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 7: Â«Native Client SandboxÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <a name="habracut"></a><br><br>  <b>Public:</b> pourquoi la plage de capacitÃ© de mÃ©moire de la plage d'adresses doit-elle recommencer Ã  zÃ©ro? <br><br>  <b>Professeur:</b> parce qu'en termes de performances, il est plus efficace d'utiliser le saut cible si vous savez qu'une adresse valide est un ensemble continu d'adresses commenÃ§ant Ã  zÃ©ro.  Car alors vous pouvez le faire avec un seul masque <b>ET</b> , oÃ¹ tous les bits hauts sont un et seulement une paire de bits bas est zÃ©ro. <br><br>  <b>Public:</b> Je pensais que le masque <b>AND</b> Ã©tait censÃ© assurer l'alignement. <br><br>  <b>Professeur: Ã </b> droite, le masque assure l'alignement, mais pourquoi part-il de zÃ©ro?  Je pense qu'ils dÃ©pendent du <b>matÃ©riel</b> segmentÃ© du matÃ©riel de segmentation.  Donc, fondamentalement, ils pourraient l'utiliser pour dÃ©placer la zone vers le haut, en termes d'espace linÃ©aire.  Ou peut-Ãªtre est-ce simplement liÃ© Ã  la faÃ§on dont l'application Â«voitÂ» cette plage.  En fait, vous pouvez le placer Ã  diffÃ©rents dÃ©calages dans votre espace d'adressage virtuel.  Cela vous permettra d'effectuer certaines astuces avec du matÃ©riel segmentÃ© pour exÃ©cuter plusieurs modules dans le mÃªme espace d'adressage. <br><br><img src="https://habrastorage.org/webt/_r/ef/sc/_refscc89wngsofm0ajoa0eflym.jpeg"><br><br>  <b>Public:</b> Peut-Ãªtre est-ce parce qu'ils veulent Â«attraperÂ» le point de rÃ©ception du pointeur nul? <br><br>  <b>Professeur:</b> oui, car ils veulent attraper tous les points de rÃ©ception.  Mais vous avez un moyen de le faire.  Parce que le pointeur nul fait rÃ©fÃ©rence au segment auquel vous accÃ©dez.  Et si vous dÃ©placez le segment, vous pouvez afficher une page zÃ©ro inutilisÃ©e au dÃ©but de chaque segment.  Cela vous aidera donc Ã  crÃ©er certains modules. <br><br>  Je pense que l'une des raisons de cette dÃ©cision - commencer la gamme Ã  partir de 0 - est due Ã  leur dÃ©sir de porter leur programme sur la plate-forme <b>x64</b> , qui a une conception lÃ©gÃ¨rement diffÃ©rente.  Mais leur article ne le dit pas.  Dans la conception 64 bits, l'Ã©quipement lui-mÃªme s'est dÃ©barrassÃ© de certains matÃ©riels de segmentation, sur lesquels ils s'appuyaient pour des raisons d'efficacitÃ©, ils ont donc dÃ» prÃ©voir une approche logicielle.  Cependant, pour <b>x32,</b> ce n'est toujours pas une bonne raison pour que l'espace recommence Ã  zÃ©ro. <br><br>  Donc, nous continuons la question principale - que voulons-nous assurer d'un point de vue de la sÃ©curitÃ©.  Abordons cette question quelque peu Â«naÃ¯vementÂ» et voyons comment nous pouvons tout gÃ¢cher, puis essayons de le rÃ©parer. <br><br>  Je crois qu'un plan naÃ¯f consiste Ã  rechercher des instructions interdites en scannant simplement l'exÃ©cutable du dÃ©but Ã  la fin.  Alors, comment pouvez-vous repÃ©rer ces instructions?  Vous pouvez simplement prendre le code du programme et le mettre dans une ligne gÃ©ante qui va de zÃ©ro Ã  256 mÃ©gaoctets, selon la taille de votre code, puis lancer la recherche. <br><br><img src="https://habrastorage.org/webt/nl/vt/rv/nlvtrvk-s3z8c_yhuugx0zqaxyc.jpeg"><br><br>  Cette ligne peut d'abord contenir le module d'instruction <b>NOP</b> , puis le module d'instruction <b>ADD</b> , <b>NOT</b> , <b>JUMP,</b> etc.  Vous venez de rechercher, et si vous trouvez une mauvaise instruction, dites alors que c'est un mauvais module et jetez-le.  Et si vous ne voyez aucun appel systÃ¨me Ã  cette instruction, vous pouvez activer le lancement de ce module et faire tout dans la plage de 0 Ã  256.  Pensez-vous que cela fonctionnera ou non?  De quoi s'inquiÃ¨tent-ils?  Pourquoi est-ce si difficile? <br><br>  <b>Public:</b> s'inquiÃ¨tent-ils de la taille des instructions? <br><br>  <b>Professeur:</b> oui, le fait est que la plate-forme <b>x86</b> a des instructions de longueur variable.  Cela signifie que la taille exacte de l'instruction dÃ©pend des premiers octets de cette instruction.  En fait, vous pouvez regarder le premier octet pour dire que l'instruction sera beaucoup plus volumineuse, puis vous devrez peut-Ãªtre regarder quelques octets supplÃ©mentaires, puis dÃ©cider de la taille nÃ©cessaire.  Certaines architectures telles que <b>Spark</b> , <b>ARM</b> , <b>MIPS</b> ont plus d'instructions de longueur fixe.  <b>ARM</b> a deux longueurs d'instructions - 2 ou 4 octets.  Mais sur la plate <b>-</b> forme <b>x86, la</b> longueur des instructions peut Ãªtre de 1, 5 et 10 octets, et si vous essayez, vous pouvez mÃªme obtenir une instruction assez longue de 15 octets.  Cependant, ce sont des instructions complexes. <br><br>  En consÃ©quence, un problÃ¨me peut apparaÃ®tre.  Si vous scannez cette ligne de code de faÃ§on linÃ©aire, tout ira bien.  Mais peut-Ãªtre qu'au moment de l'exÃ©cution, vous irez au milieu d'une sorte d'instruction, par exemple <b>NON</b> . <br><br><img src="https://habrastorage.org/webt/ob/rv/lj/obrvlj58uew5ji8-9mev7cxwb04.jpeg"><br><br>  Il est possible qu'il s'agisse d'une instruction multi-octets, et si vous l'interprÃ©tez Ã  partir du deuxiÃ¨me octet, elle sera complÃ¨tement diffÃ©rente. <br><br>  Un autre exemple dans lequel nous allons "jouer" avec l'assembleur.  Supposons que nous ayons l'instruction <b>25 CD 80 00 00</b> .  AprÃ¨s avoir regardÃ© le 2e octet, vous l'interprÃ©terez comme une instruction de cinq octets, c'est-Ã -dire que vous devrez regarder 5 octets en avant et voir qu'il est suivi par l'instruction <b>AND% EAX, 0x00 00 80 CD</b> , en commenÃ§ant par l'opÃ©rateur <b>AND</b> pour le registre <b>EAX</b> avec certains constantes dÃ©finies, par exemple, <b>00 00 80 CD</b> .  C'est l'une des instructions sÃ»res que le <b>client natif</b> devrait simplement autoriser par la premiÃ¨re rÃ¨gle de vÃ©rification des instructions binaires.  Mais si, pendant l'exÃ©cution du programme, la <b>CPU</b> dÃ©cide qu'elle doit commencer Ã  exÃ©cuter le code Ã  partir du <b>CD</b> , je marquerai cet endroit de l'instruction avec une flÃ¨che, alors l'instruction <b>% EAX, 0x00 00 80 CD</b> , qui est en fait une instruction Ã  4 octets, signifiera l'exÃ©cution de <b>INT $ 0x80</b> , qui est un moyen de faire un appel systÃ¨me sous <b>Linux</b> . <br><br><img src="https://habrastorage.org/webt/ib/3a/zp/ib3azp3oe9zmfedweosbecx9fto.jpeg"><br><br>  Donc, si vous manquez ce fait, laissez le module peu fiable "sauter" dans le noyau et faire des appels systÃ¨me, c'est-Ã -dire faire ce que vous vouliez empÃªcher.  Comment Ã©viter cela? <br><br>  Peut-Ãªtre devrions-nous essayer de regarder le dÃ©calage de chaque octet.  Parce que x86 ne peut commencer Ã  interprÃ©ter une instruction que dans des limites d'octets et non de bits.  Ainsi, vous devez regarder le dÃ©calage de chaque octet pour voir oÃ¹ commence l'instruction.  Pensez-vous que ce plan soit rÃ©alisable? <br><br>  <b>Public:</b> Je pense que si quelqu'un utilise rÃ©ellement <b>AND</b> , le processeur ne sautera pas Ã  cet endroit, mais permettra simplement au programme de s'exÃ©cuter. <br><br>  <b>Professeur:</b> oui, car fondamentalement il n'est pas sujet aux faux positifs.  Maintenant, si vous le voulez vraiment, vous pouvez changer un peu le code pour l'Ã©viter.  Si vous savez exactement ce que recherche l'appareil de test, vous pouvez potentiellement modifier ces instructions.  Peut-Ãªtre en dÃ©finissant <b>ET d'</b> abord pour une instruction, puis en utilisant le masque sur une autre.  Mais il est beaucoup plus facile d'Ã©viter ces arrangements d'octets suspects, bien que cela semble plutÃ´t gÃªnant. <br><br>  Il est possible que l'architecture inclue un changement de compilateur.  Fondamentalement, ils ont une sorte de composant qui doit rÃ©ellement compiler le code correctement.  Vous ne pouvez pas simplement Â«dÃ©collerÂ» <b>GCC</b> et compiler du code pour le <b>client natif</b> .  Donc, fondamentalement, c'est faisable.  Mais probablement, ils pensent simplement que cela cause trop de problÃ¨mes, ne sera pas une solution fiable ou performante, etc.  De plus, plusieurs instructions <b>x86</b> sont interdites ou doivent Ãªtre considÃ©rÃ©es comme dangereuses et doivent donc Ãªtre interdites.  Mais pour la plupart, leur taille est d'un octet, il est donc assez difficile de les trouver ou de les filtrer. <br><br>  Par consÃ©quent, s'ils ne peuvent pas simplement collecter et trier les instructions dangereuses et espÃ©rer le meilleur, ils doivent utiliser un plan diffÃ©rent afin de le dÃ©monter de maniÃ¨re fiable.  Alors, que fait le <b>client natif</b> pour sâ€™assurer quâ€™il ne Â«trÃ©bucheÂ» pas sur cet encodage de longueur variable? <br><br>  Dans un sens, si nous analysons vraiment le fichier exÃ©cutable de gauche Ã  droite et recherchons tous les codes incorrects possibles, et si c'est ainsi que le code s'exÃ©cute, nous sommes en bonne forme.  MÃªme s'il y a des instructions Ã©tranges et des biais, le processeur ne va toujours pas "sauter" lÃ , il exÃ©cutera le programme dans le mÃªme ordre dans lequel les instructions sont scannÃ©es, c'est-Ã -dire de gauche Ã  droite. <br><br><img src="https://habrastorage.org/webt/kh/v0/ea/khv0ea7apzgmwqnx1pbaj8k1fgy.jpeg"><br><br>  Ainsi, le problÃ¨me d'un dÃ©montage fiable se pose du fait que quelque part dans l'application il peut y avoir des "sauts".  Le processeur peut Ã©chouer s'il effectue un Â«sautÂ» vers une instruction de code qu'il n'a pas remarquÃ©e lors de la numÃ©risation de gauche Ã  droite.  Il s'agit donc d'un problÃ¨me de dÃ©montage fiable en cours de dÃ©veloppement.  Et le plan principal est de vÃ©rifier oÃ¹ mÃ¨nent tous les "sauts".  En fait, c'est assez simple Ã  un certain niveau.  Il y a un tas de rÃ¨gles que nous considÃ©rerons dans une seconde, mais le plan approximatif est que si vous voyez une instruction de "saut", vous devez vous assurer que le but du "saut" a Ã©tÃ© remarquÃ© plus tÃ´t.  Pour ce faire, en fait, il suffit de balayer de gauche Ã  droite, c'est-Ã -dire la procÃ©dure que nous avons dÃ©crite dans notre approche naÃ¯ve du problÃ¨me. <br><br>  Dans ce cas, si vous voyez une instruction de "saut" et l'adresse vers laquelle cette instruction pointe, alors vous devez vous assurer que c'est la mÃªme adresse que vous avez dÃ©jÃ  vue lors du dÃ©montage de gauche Ã  droite. <br><br>  Si une instruction de saut pour cet octet CD est trouvÃ©e, alors nous devons marquer ce saut comme invalide car nous n'avons jamais vu l'instruction commenÃ§ant dans l'octet CD, mais nous avons vu une autre instruction commenÃ§ant par le numÃ©ro 25. Mais si toutes les instructions de saut ordonnÃ© d'aller au dÃ©but de l'instruction, dans ce cas Ã  25, alors tout est en ordre chez nous.  Est-ce clair? <br><br>  Le seul problÃ¨me est que vous ne pouvez pas vÃ©rifier les objectifs de chaque saut dans le programme, car il peut y avoir des sauts indirects.  Par exemple, en <b>x86,</b> vous pourriez avoir quelque chose comme un saut Ã  la valeur de ce registre <b>EAX</b> .  C'est idÃ©al pour implÃ©menter des pointeurs de fonction. <br><br><img src="https://habrastorage.org/webt/uf/gh/bl/ufghbl_dd-pofxnrp7fy-ne3ee0.jpeg"><br><br>  Autrement dit, le pointeur de fonction se trouve quelque part dans la mÃ©moire, vous le tenez dans un registre, puis accÃ©dez Ã  n'importe quelle adresse dans le registre de mouvement. <br><br>  Alors, comment ces gars font-ils face aux sauts indirects?  Parce que, en fait, je n'ai aucune idÃ©e si ce sera un Â«sautÂ» Ã  l'octet <b>CD</b> ou Ã  l'octet 25. Que font-ils dans ce cas? <br><br>  <b>Public:</b> utiliser des outils? <br><br>  <b>Professeur:</b> oui, l'instrumentation est leur principal truc.  Par consÃ©quent, chaque fois qu'ils voient que le compilateur est prÃªt Ã  effectuer la gÃ©nÃ©ration, c'est la preuve que ce saut ne causera pas de problÃ¨mes.  Pour ce faire, ils doivent s'assurer que tous les sauts sont effectuÃ©s avec une multiplicitÃ© de 32 octets.  Comment font-ils?  Ils changent toutes les instructions de saut en ce qu'ils ont appelÃ© des Â«pseudo instructionsÂ».  Ce sont les mÃªmes instructions, mais prÃ©fixÃ©es, qui effacent les 5 bits bas du registre <b>EAX</b> .  Le fait que l'instruction efface 5 bits bas signifie qu'elle fait que la valeur donnÃ©e est un multiple de 32, de deux Ã  cinq, puis un saut dans cette valeur est dÃ©jÃ  effectuÃ©. <br><br><img src="https://habrastorage.org/webt/r3/sf/nq/r3sfnqlxz3egqe8q-0ret79kwzu.jpeg"><br><br>  Si vous regardez cela pendant la vÃ©rification, assurez-vous que cette Â«paireÂ» d'instructions ne Â«sauteraÂ» qu'avec une multiplicitÃ© de 32 octets.  Et puis, afin de vous assurer qu'il n'y a aucune possibilitÃ© de Â«sauterÂ» dans des instructions Ã©tranges, vous appliquez une rÃ¨gle supplÃ©mentaire.  Il consiste en ce que lors du dÃ©montage, lorsque vous regardez vos instructions de gauche Ã  droite, vous vous assurez que le dÃ©but de chaque instruction valide sera Ã©galement un multiple de 32 octets. <br><br>  Ainsi, en plus de cette boÃ®te Ã  outils, vous vÃ©rifiez que chaque code qui est un multiple de 32 est l'instruction correcte.  Par une instruction valide et valide, je veux dire une instruction qui est dÃ©montÃ©e de gauche Ã  droite. <br><br>  <b>Public:</b> Pourquoi le numÃ©ro 32 est-il choisi? <br><br>  <b>Professeur:</b> oui, pourquoi ont-ils choisi 32 au lieu de 1000 ou 5?  Pourquoi 5 est mauvais? <br><br>  <b>Public:</b> car le nombre doit Ãªtre une puissance de 2. <br><br>  <b>Professeur:</b> oui, eh bien, c'est pourquoi.  Parce qu'autrement, garantir l'utilisation de quelque chose qui est un multiple de 5 nÃ©cessitera des instructions supplÃ©mentaires entraÃ®nant des frais gÃ©nÃ©raux.  Et huit?  Est-ce que huit est un nombre suffisant? <br><br>  <b>Public:</b> vous pouvez avoir des instructions de plus de huit bits. <br><br>  <b>Professeur:</b> oui, cela peut Ãªtre pour la plus longue instruction autorisÃ©e sur la plate-forme x86.  Si nous avons une instruction de 10 octets et que tout doit Ãªtre un multiple de 8, nous ne pouvons lâ€™insÃ©rer nulle part.  La longueur devrait donc Ãªtre suffisante dans tous les cas, car la plus grosse instruction que j'ai vue faisait 15 octets.  Donc 32 octets suffisent. <br><br>  Si vous souhaitez adapter les instructions pour entrer ou quitter l'environnement de service de processus, vous devrez peut-Ãªtre une quantitÃ© non triviale de code dans un emplacement de 32 octets.  Par exemple, 31 octets, car 1 octet contient une instruction.  Doit-il Ãªtre beaucoup plus gros?  Devrions-nous rendre cela Ã©gal Ã , disons, 1024 octets?  Si vous avez de nombreux pointeurs de fonction ou de nombreux sauts indirects, chaque fois que vous voulez crÃ©er un endroit oÃ¹ vous allez sauter, vous devez le continuer jusqu'Ã  la bordure suivante, quelle que soit sa valeur.  Donc, avec 32 bits, c'est une taille tout Ã  fait normale.  Dans le pire des cas, vous ne perdrez que 31 octets si vous devez vous rendre rapidement Ã  la prochaine frontiÃ¨re.  Mais si vous avez une taille qui est un multiple de 1024 octets, il y a la possibilitÃ© de gaspiller un kilo-octet entier de mÃ©moire en vain pour un saut indirect.  Si vous avez des fonctions courtes ou de nombreux pointeurs de fonction, une taille aussi grande de la multiplicitÃ© de la longueur du "saut" entraÃ®nera un gaspillage de mÃ©moire important. <br><br>  Je ne pense pas que le nombre 32 soit une pierre d'achoppement pour le <b>Native Client</b> .  Certains blocs pourraient fonctionner avec une multiplicitÃ© de 16 bits, certains 64 ou 128 bits, peu importe.  Seulement 32 bits leur semblaient la valeur optimale la plus acceptable. <br><br>  Alors, faisons un plan pour un dÃ©montage fiable.  Par consÃ©quent, le compilateur doit Ãªtre un peu prudent lors de la compilation de <b>code</b> <b>C</b> ou <b>C ++</b> dans un binaire <b>Native Client</b> et observer les rÃ¨gles suivantes. <br><br><img src="https://habrastorage.org/webt/c0/nh/kc/c0nhkc4izpqqyrj_rtr2gg-eytu.jpeg"><br><br>  Par consÃ©quent, chaque fois qu'il fait un saut, comme indiquÃ© dans la ligne du haut, il doit ajouter ces instructions supplÃ©mentaires donnÃ©es dans les 2 lignes du bas.  Et indÃ©pendamment du fait qu'il crÃ©e une fonction vers laquelle il va "sauter", notre instruction sautera comme l'ajout <b>ET $ 0xffffffe0,% eax</b> indique.  Et il ne peut pas simplement le complÃ©ter avec des zÃ©ros, car tout cela doit avoir les bons codes.  Ainsi, l'ajout est nÃ©cessaire afin de s'assurer que toutes les instructions possibles sont valides.  Et, heureusement, sur la plate-forme <b>x86</b> , pas une seule fonction <b>noop</b> n'est dÃ©crite par un seul octet, ou du moins il n'y a pas un seul <b>noop</b> 1 octet de taille.  Ainsi, vous pouvez toujours ajouter des choses Ã  la valeur d'une constante. <br><br>  Alors qu'est-ce que cela nous garantit?  Assurons-nous de toujours voir ce qui se passe dans la terminologie des instructions qui seront suivies.  Voici ce que cette rÃ¨gle nous donne: l'assurance qu'un appel systÃ¨me ne sera pas effectuÃ© par accident.  Cela s'applique aux sauts, mais qu'en est-il des retours?  Comment gÃ¨rent-ils les retours?  Pouvons-nous faire un <b>retour</b> Ã  une fonction dans le <b>Native Client</b> ?  Que se passe-t-il si vous exÃ©cutez le code red-hot? <br><br>  <b>Public:</b> il peut dÃ©border de la pile. <br><br>  <b>Professeur:</b> il est vrai qu'il apparaÃ®t de faÃ§on inattendue sur la pile.  Mais le fait est que la pile utilisÃ©e par les modules <b>Native Client</b> contient en fait des donnÃ©es Ã  l'intÃ©rieur.  Ainsi, lorsque vous traitez avec <b>Native Client,</b> vous ne devez pas vous soucier du dÃ©bordement de pile. <br><br>  <b>Public:</b> attendez, mais vous pouvez tout mettre sur la pile.  Et quand vous faites un saut indirect. <br><br>  <b>Professeur:</b> c'est vrai.  Le retour ressemble presque Ã  un saut indirect de quelque part dans la mÃ©moire, qui est situÃ© en haut de la pile.  Par consÃ©quent, je pense qu'une chose qu'ils pourraient faire pour la fonction de <b>retour</b> est de dÃ©finir le prÃ©fixe de la mÃªme maniÃ¨re que lors de la vÃ©rification prÃ©cÃ©dente.  Et ce prÃ©fixe vÃ©rifie ce qui apparaÃ®t en haut de la pile.  Vous vÃ©rifiez si cela est valide et lorsque vous Ã©crivez ou utilisez l'opÃ©rateur <b>AND</b> , vous vÃ©rifiez ce qui se trouve en haut de la pile.  Cela semble un peu peu fiable en raison du changement constant de donnÃ©es.  Parce que, par exemple, si vous regardez en haut de la pile et assurez-vous que tout va bien, puis Ã©crivez quelque chose, le flux de donnÃ©es dans le mÃªme module peut modifier quelque chose en haut de la pile, aprÃ¨s quoi vous vous rÃ©fÃ©rerez Ã  la mauvaise adresse <br><br>  <b>Public:</b> Cela ne s'applique-t-il pas au saut dans la mÃªme mesure? <br><br>  <b>Professeur:</b> oui, alors que se passe-t-il avec un saut?  Nos conditions de course peuvent-elles en quelque sorte invalider ce test? <br><br>  <b>Public:</b> Mais le code n'est-il pas accessible en Ã©criture? <br><br>  <b>Professeur:</b> oui, le code ne peut pas Ãªtre Ã©crit, c'est vrai.  Par consÃ©quent, vous ne pouvez pas modifier AND.  Mais un autre flux ne pourrait-il pas changer le but du saut entre ces deux instructions? <br><br>  <b>Public:</b> c'est dans le registre, donc ... <br><br>  <b>Professeur:</b> Oui, c'est cool.  Parce que si un flux modifie quelque chose en mÃ©moire ou dans ce qui est chargÃ© depuis <b>EAX</b> (par lui-mÃªme, vous le faites avant de tÃ©lÃ©charger), dans ce cas, cet <b>EAX</b> sera dans un mauvais Ã©tat, mais il effacera les mauvais bits.  Ou bien il peut changer la mÃ©moire aprÃ¨s, lorsque le pointeur est dÃ©jÃ  dans <b>EAX</b> , donc peu importe qu'il change l'emplacement de la mÃ©moire Ã  partir de laquelle le registre <b>EAX a</b> Ã©tÃ© chargÃ©. <br><br>  En fait, les threads ne partagent pas les ensembles de registres.  Par consÃ©quent, si un autre thread modifie le registre <b>EAX</b> , cela n'affectera pas le registre <b>EAX</b> de ce thread.  Par consÃ©quent, d'autres threads ne peuvent pas invalider cette sÃ©quence d'instructions. <br><br>  Il y a une autre question intÃ©ressante.  Pouvons-nous contourner cet <b>ET</b> ?  Je peux sauter oÃ¹ je veux n'importe oÃ¹ dans cet espace d'adressage.      ,       <b>AND</b>  . <br><br><img src="https://habrastorage.org/webt/4p/vf/nk/4pvfnkoa0kmui9vdd5wn2o-jbk0.jpeg"><br><br>       ,      ,   ,    ,  ,        <b>AND</b> .    .     <b>jmp</b> ,      . <br><br><img src="https://habrastorage.org/webt/kg/mf/cu/kgmfcuyc42v0rtkdtzt1ptm1ty4.jpeg"><br><br> ,      ,    -  ,    1237.     ,     32.  <b>Native Client</b>       ,     ,      ,     .          ,   ,      1237      ? <br><br><img src="https://habrastorage.org/webt/dn/_-/_r/dn_-_r-vi7p_qx7nxwwkqmroh-w.jpeg"><br><br>    -  <b>EAX</b> ,   , ,        ,      .  ,    ?     ? <br><br> <b>:</b> <b>NaCl</b>   ,      . <br><br> <b>:</b> ,       .      <b>x86</b>    ,    ,   <b>NaCl</b>   ,  2          .       ,    ,  : Â«,    ,    !Â»,              <b>25 CD 80 00 00</b> .     .         ,     <b>x86</b> . <br><br>   ,   <b>Native Client</b>      . ,       ,   ,    ,          <b>NaCl</b> . ,     . <br><br> <b>:</b> ,        ,     .     ,         .  ,      ,     ,       ,     . <br><br><img src="https://habrastorage.org/webt/sq/hd/pl/sqhdplwnbsfj55r8qmp6trwxk5y.jpeg"><br><br> <b>:</b> ,  .     ,   . ,       ,      ,   <b>EAX</b> .           ,   -  .        <b>EAX</b> ,  <b>EBX</b>   .           ,       .          <b>EAX</b>  <b>EBX</b>  <b>AND</b>   .     ,  ,      <b>EAX</b> ,         .         ,   -   <b>64</b>  .    <b>Jmp *% eax</b>   <b>AND</b>   . <br><br><img src="https://habrastorage.org/webt/qz/nf/zt/qznfzt9lqpfreshgcc76zygs8cq.jpeg"><br><br> ,   , ,   ,   .   <b>Intel</b> ,        ,  ,   ,      .       ,   ,             .       <b>AND</b>    ,   <b>EAX</b>  ,    Â«Â» . <br><br> ,       ,           .     ,       .     ,    ,   ,   .      ,  ,   ,    . <br> ,     ,  <b>C1</b>  <b>C7</b> . <br><br> <b>C1</b>   ,       ,            .     ,     Â«Â»     .   ,       ,      .   ,       ,     - .  ,    . <br> <b>2</b> ,     0   <b>64</b> .     ,     ,        .        ,      ,      . <br><br>  <b>3</b> ,  ,  ,   .        ,  ,         . <br><br> <b>4</b>   ,         <b>hlt</b> .             <b>halt</b> ?     ,  <b>C4</b> .   ,   ,      -  ,      . <br><br>     ,  ,          ? ,          ,      -  . <br>     ,     ,  ,       ,       .    ,       ,     ,  ,           .         . <br><br><img src="https://habrastorage.org/webt/9i/1f/yj/9i1fyjdue4tun6jsa8gnnzkue9c.jpeg"><br><br> 55:20  <br><br> : <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques".</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> 7: Â« Native ClientÂ»,  3</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/I0Psvvky-44" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . <br><br> ,    .  Aimez-vous nos articles?  Vous voulez voir des matÃ©riaux plus intÃ©ressants?  Soutenez-nous en passant une commande ou en le recommandant Ã  vos amis, une <b>rÃ©duction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entrÃ©e de gamme que nous avons inventÃ©s pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la vÃ©ritÃ© sur VPS (KVM) E5-2650 v4 (6 cÅ“urs) 10 Go DDR4 240 Go SSD 1 Gbps Ã  partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'Ã  24 cÅ“urs et jusqu'Ã  40 Go de DDR4). <br><br> <b>3  </b>    Dell R630     â€” <b>2  Intel Deca-Core Xeon E5-2630 v4 / 128GB DDR4 / 41TB HDD  2240GB SSD / 1Gbps 10 TB â€”  $99,33 </b> ,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . <br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV Ã  partir de 249 $</a> aux Pays-Bas et aux Ã‰tats-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crÃ©ation d'un bÃ¢timent d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 coÃ»tant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418225/">https://habr.com/ru/post/fr418225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418215/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 5: Â«D'oÃ¹ viennent les erreurs du systÃ¨me de sÃ©curitÃ©Â», partie 2</a></li>
<li><a href="../fr418217/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 6: Â«OpportunitÃ©sÂ», partie 1</a></li>
<li><a href="../fr418219/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 6: OpportunitÃ©s, partie 2</a></li>
<li><a href="../fr418221/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 6: Â«OpportunitÃ©sÂ», partie 3</a></li>
<li><a href="../fr418223/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Le Sandbox Native Client, Partie 1</a></li>
<li><a href="../fr418227/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 7: Le Sandbox Native Client, Partie 3</a></li>
<li><a href="../fr418229/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 8: ModÃ¨le de sÃ©curitÃ© rÃ©seau, partie 1</a></li>
<li><a href="../fr418233/index.html">Les mnÃ©moniques BMW pour trouver les valeurs limites</a></li>
<li><a href="../fr418235/index.html">Saga orchestrÃ©e ou comment crÃ©er des transactions commerciales dans les services avec la base de donnÃ©es par modÃ¨le de service</a></li>
<li><a href="../fr418237/index.html">DÃ©veloppement d'applications multi-locataires sur la plateforme cloud SAP dans Neo, partie 2: autorisation et authentification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>