<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👧‍👧 🛃 🎎 Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Native Client Sandbox Part 2 👨‍🌾 👨🏻‍🎤 👩🏼‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Institut de technologie du Massachusetts. Cours magistral # 6.858. "Sécurité des systèmes informatiques." Nikolai Zeldovich, James Mickens. 2014 année...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Native Client Sandbox Part 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418225/"><h3>  Institut de technologie du Massachusetts.  Cours magistral # 6.858.  "Sécurité des systèmes informatiques."  Nikolai Zeldovich, James Mickens.  2014 année </h3><br>  Computer Systems Security est un cours sur le développement et la mise en œuvre de systèmes informatiques sécurisés.  Les conférences couvrent les modèles de menace, les attaques qui compromettent la sécurité et les techniques de sécurité basées sur des travaux scientifiques récents.  Les sujets incluent la sécurité du système d'exploitation (OS), les fonctionnalités, la gestion du flux d'informations, la sécurité des langues, les protocoles réseau, la sécurité matérielle et la sécurité des applications Web. <br><br>  Cours 1: «Introduction: modèles de menace» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 2: «Contrôle des attaques de pirates» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 3: «Débordements de tampon: exploits et protection» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 4: «Séparation des privilèges» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 5: «D'où viennent les systèmes de sécurité?» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> <br>  Conférence 6: «Opportunités» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  Conférence 7: «Native Client Sandbox» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <a name="habracut"></a><br><br>  <b>Public:</b> pourquoi la plage de capacité de mémoire de la plage d'adresses doit-elle recommencer à zéro? <br><br>  <b>Professeur:</b> parce qu'en termes de performances, il est plus efficace d'utiliser le saut cible si vous savez qu'une adresse valide est un ensemble continu d'adresses commençant à zéro.  Car alors vous pouvez le faire avec un seul masque <b>ET</b> , où tous les bits hauts sont un et seulement une paire de bits bas est zéro. <br><br>  <b>Public:</b> Je pensais que le masque <b>AND</b> était censé assurer l'alignement. <br><br>  <b>Professeur: à</b> droite, le masque assure l'alignement, mais pourquoi part-il de zéro?  Je pense qu'ils dépendent du <b>matériel</b> segmenté du matériel de segmentation.  Donc, fondamentalement, ils pourraient l'utiliser pour déplacer la zone vers le haut, en termes d'espace linéaire.  Ou peut-être est-ce simplement lié à la façon dont l'application «voit» cette plage.  En fait, vous pouvez le placer à différents décalages dans votre espace d'adressage virtuel.  Cela vous permettra d'effectuer certaines astuces avec du matériel segmenté pour exécuter plusieurs modules dans le même espace d'adressage. <br><br><img src="https://habrastorage.org/webt/_r/ef/sc/_refscc89wngsofm0ajoa0eflym.jpeg"><br><br>  <b>Public:</b> Peut-être est-ce parce qu'ils veulent «attraper» le point de réception du pointeur nul? <br><br>  <b>Professeur:</b> oui, car ils veulent attraper tous les points de réception.  Mais vous avez un moyen de le faire.  Parce que le pointeur nul fait référence au segment auquel vous accédez.  Et si vous déplacez le segment, vous pouvez afficher une page zéro inutilisée au début de chaque segment.  Cela vous aidera donc à créer certains modules. <br><br>  Je pense que l'une des raisons de cette décision - commencer la gamme à partir de 0 - est due à leur désir de porter leur programme sur la plate-forme <b>x64</b> , qui a une conception légèrement différente.  Mais leur article ne le dit pas.  Dans la conception 64 bits, l'équipement lui-même s'est débarrassé de certains matériels de segmentation, sur lesquels ils s'appuyaient pour des raisons d'efficacité, ils ont donc dû prévoir une approche logicielle.  Cependant, pour <b>x32,</b> ce n'est toujours pas une bonne raison pour que l'espace recommence à zéro. <br><br>  Donc, nous continuons la question principale - que voulons-nous assurer d'un point de vue de la sécurité.  Abordons cette question quelque peu «naïvement» et voyons comment nous pouvons tout gâcher, puis essayons de le réparer. <br><br>  Je crois qu'un plan naïf consiste à rechercher des instructions interdites en scannant simplement l'exécutable du début à la fin.  Alors, comment pouvez-vous repérer ces instructions?  Vous pouvez simplement prendre le code du programme et le mettre dans une ligne géante qui va de zéro à 256 mégaoctets, selon la taille de votre code, puis lancer la recherche. <br><br><img src="https://habrastorage.org/webt/nl/vt/rv/nlvtrvk-s3z8c_yhuugx0zqaxyc.jpeg"><br><br>  Cette ligne peut d'abord contenir le module d'instruction <b>NOP</b> , puis le module d'instruction <b>ADD</b> , <b>NOT</b> , <b>JUMP,</b> etc.  Vous venez de rechercher, et si vous trouvez une mauvaise instruction, dites alors que c'est un mauvais module et jetez-le.  Et si vous ne voyez aucun appel système à cette instruction, vous pouvez activer le lancement de ce module et faire tout dans la plage de 0 à 256.  Pensez-vous que cela fonctionnera ou non?  De quoi s'inquiètent-ils?  Pourquoi est-ce si difficile? <br><br>  <b>Public:</b> s'inquiètent-ils de la taille des instructions? <br><br>  <b>Professeur:</b> oui, le fait est que la plate-forme <b>x86</b> a des instructions de longueur variable.  Cela signifie que la taille exacte de l'instruction dépend des premiers octets de cette instruction.  En fait, vous pouvez regarder le premier octet pour dire que l'instruction sera beaucoup plus volumineuse, puis vous devrez peut-être regarder quelques octets supplémentaires, puis décider de la taille nécessaire.  Certaines architectures telles que <b>Spark</b> , <b>ARM</b> , <b>MIPS</b> ont plus d'instructions de longueur fixe.  <b>ARM</b> a deux longueurs d'instructions - 2 ou 4 octets.  Mais sur la plate <b>-</b> forme <b>x86, la</b> longueur des instructions peut être de 1, 5 et 10 octets, et si vous essayez, vous pouvez même obtenir une instruction assez longue de 15 octets.  Cependant, ce sont des instructions complexes. <br><br>  En conséquence, un problème peut apparaître.  Si vous scannez cette ligne de code de façon linéaire, tout ira bien.  Mais peut-être qu'au moment de l'exécution, vous irez au milieu d'une sorte d'instruction, par exemple <b>NON</b> . <br><br><img src="https://habrastorage.org/webt/ob/rv/lj/obrvlj58uew5ji8-9mev7cxwb04.jpeg"><br><br>  Il est possible qu'il s'agisse d'une instruction multi-octets, et si vous l'interprétez à partir du deuxième octet, elle sera complètement différente. <br><br>  Un autre exemple dans lequel nous allons "jouer" avec l'assembleur.  Supposons que nous ayons l'instruction <b>25 CD 80 00 00</b> .  Après avoir regardé le 2e octet, vous l'interpréterez comme une instruction de cinq octets, c'est-à-dire que vous devrez regarder 5 octets en avant et voir qu'il est suivi par l'instruction <b>AND% EAX, 0x00 00 80 CD</b> , en commençant par l'opérateur <b>AND</b> pour le registre <b>EAX</b> avec certains constantes définies, par exemple, <b>00 00 80 CD</b> .  C'est l'une des instructions sûres que le <b>client natif</b> devrait simplement autoriser par la première règle de vérification des instructions binaires.  Mais si, pendant l'exécution du programme, la <b>CPU</b> décide qu'elle doit commencer à exécuter le code à partir du <b>CD</b> , je marquerai cet endroit de l'instruction avec une flèche, alors l'instruction <b>% EAX, 0x00 00 80 CD</b> , qui est en fait une instruction à 4 octets, signifiera l'exécution de <b>INT $ 0x80</b> , qui est un moyen de faire un appel système sous <b>Linux</b> . <br><br><img src="https://habrastorage.org/webt/ib/3a/zp/ib3azp3oe9zmfedweosbecx9fto.jpeg"><br><br>  Donc, si vous manquez ce fait, laissez le module peu fiable "sauter" dans le noyau et faire des appels système, c'est-à-dire faire ce que vous vouliez empêcher.  Comment éviter cela? <br><br>  Peut-être devrions-nous essayer de regarder le décalage de chaque octet.  Parce que x86 ne peut commencer à interpréter une instruction que dans des limites d'octets et non de bits.  Ainsi, vous devez regarder le décalage de chaque octet pour voir où commence l'instruction.  Pensez-vous que ce plan soit réalisable? <br><br>  <b>Public:</b> Je pense que si quelqu'un utilise réellement <b>AND</b> , le processeur ne sautera pas à cet endroit, mais permettra simplement au programme de s'exécuter. <br><br>  <b>Professeur:</b> oui, car fondamentalement il n'est pas sujet aux faux positifs.  Maintenant, si vous le voulez vraiment, vous pouvez changer un peu le code pour l'éviter.  Si vous savez exactement ce que recherche l'appareil de test, vous pouvez potentiellement modifier ces instructions.  Peut-être en définissant <b>ET d'</b> abord pour une instruction, puis en utilisant le masque sur une autre.  Mais il est beaucoup plus facile d'éviter ces arrangements d'octets suspects, bien que cela semble plutôt gênant. <br><br>  Il est possible que l'architecture inclue un changement de compilateur.  Fondamentalement, ils ont une sorte de composant qui doit réellement compiler le code correctement.  Vous ne pouvez pas simplement «décoller» <b>GCC</b> et compiler du code pour le <b>client natif</b> .  Donc, fondamentalement, c'est faisable.  Mais probablement, ils pensent simplement que cela cause trop de problèmes, ne sera pas une solution fiable ou performante, etc.  De plus, plusieurs instructions <b>x86</b> sont interdites ou doivent être considérées comme dangereuses et doivent donc être interdites.  Mais pour la plupart, leur taille est d'un octet, il est donc assez difficile de les trouver ou de les filtrer. <br><br>  Par conséquent, s'ils ne peuvent pas simplement collecter et trier les instructions dangereuses et espérer le meilleur, ils doivent utiliser un plan différent afin de le démonter de manière fiable.  Alors, que fait le <b>client natif</b> pour s’assurer qu’il ne «trébuche» pas sur cet encodage de longueur variable? <br><br>  Dans un sens, si nous analysons vraiment le fichier exécutable de gauche à droite et recherchons tous les codes incorrects possibles, et si c'est ainsi que le code s'exécute, nous sommes en bonne forme.  Même s'il y a des instructions étranges et des biais, le processeur ne va toujours pas "sauter" là, il exécutera le programme dans le même ordre dans lequel les instructions sont scannées, c'est-à-dire de gauche à droite. <br><br><img src="https://habrastorage.org/webt/kh/v0/ea/khv0ea7apzgmwqnx1pbaj8k1fgy.jpeg"><br><br>  Ainsi, le problème d'un démontage fiable se pose du fait que quelque part dans l'application il peut y avoir des "sauts".  Le processeur peut échouer s'il effectue un «saut» vers une instruction de code qu'il n'a pas remarquée lors de la numérisation de gauche à droite.  Il s'agit donc d'un problème de démontage fiable en cours de développement.  Et le plan principal est de vérifier où mènent tous les "sauts".  En fait, c'est assez simple à un certain niveau.  Il y a un tas de règles que nous considérerons dans une seconde, mais le plan approximatif est que si vous voyez une instruction de "saut", vous devez vous assurer que le but du "saut" a été remarqué plus tôt.  Pour ce faire, en fait, il suffit de balayer de gauche à droite, c'est-à-dire la procédure que nous avons décrite dans notre approche naïve du problème. <br><br>  Dans ce cas, si vous voyez une instruction de "saut" et l'adresse vers laquelle cette instruction pointe, alors vous devez vous assurer que c'est la même adresse que vous avez déjà vue lors du démontage de gauche à droite. <br><br>  Si une instruction de saut pour cet octet CD est trouvée, alors nous devons marquer ce saut comme invalide car nous n'avons jamais vu l'instruction commençant dans l'octet CD, mais nous avons vu une autre instruction commençant par le numéro 25. Mais si toutes les instructions de saut ordonné d'aller au début de l'instruction, dans ce cas à 25, alors tout est en ordre chez nous.  Est-ce clair? <br><br>  Le seul problème est que vous ne pouvez pas vérifier les objectifs de chaque saut dans le programme, car il peut y avoir des sauts indirects.  Par exemple, en <b>x86,</b> vous pourriez avoir quelque chose comme un saut à la valeur de ce registre <b>EAX</b> .  C'est idéal pour implémenter des pointeurs de fonction. <br><br><img src="https://habrastorage.org/webt/uf/gh/bl/ufghbl_dd-pofxnrp7fy-ne3ee0.jpeg"><br><br>  Autrement dit, le pointeur de fonction se trouve quelque part dans la mémoire, vous le tenez dans un registre, puis accédez à n'importe quelle adresse dans le registre de mouvement. <br><br>  Alors, comment ces gars font-ils face aux sauts indirects?  Parce que, en fait, je n'ai aucune idée si ce sera un «saut» à l'octet <b>CD</b> ou à l'octet 25. Que font-ils dans ce cas? <br><br>  <b>Public:</b> utiliser des outils? <br><br>  <b>Professeur:</b> oui, l'instrumentation est leur principal truc.  Par conséquent, chaque fois qu'ils voient que le compilateur est prêt à effectuer la génération, c'est la preuve que ce saut ne causera pas de problèmes.  Pour ce faire, ils doivent s'assurer que tous les sauts sont effectués avec une multiplicité de 32 octets.  Comment font-ils?  Ils changent toutes les instructions de saut en ce qu'ils ont appelé des «pseudo instructions».  Ce sont les mêmes instructions, mais préfixées, qui effacent les 5 bits bas du registre <b>EAX</b> .  Le fait que l'instruction efface 5 bits bas signifie qu'elle fait que la valeur donnée est un multiple de 32, de deux à cinq, puis un saut dans cette valeur est déjà effectué. <br><br><img src="https://habrastorage.org/webt/r3/sf/nq/r3sfnqlxz3egqe8q-0ret79kwzu.jpeg"><br><br>  Si vous regardez cela pendant la vérification, assurez-vous que cette «paire» d'instructions ne «sautera» qu'avec une multiplicité de 32 octets.  Et puis, afin de vous assurer qu'il n'y a aucune possibilité de «sauter» dans des instructions étranges, vous appliquez une règle supplémentaire.  Il consiste en ce que lors du démontage, lorsque vous regardez vos instructions de gauche à droite, vous vous assurez que le début de chaque instruction valide sera également un multiple de 32 octets. <br><br>  Ainsi, en plus de cette boîte à outils, vous vérifiez que chaque code qui est un multiple de 32 est l'instruction correcte.  Par une instruction valide et valide, je veux dire une instruction qui est démontée de gauche à droite. <br><br>  <b>Public:</b> Pourquoi le numéro 32 est-il choisi? <br><br>  <b>Professeur:</b> oui, pourquoi ont-ils choisi 32 au lieu de 1000 ou 5?  Pourquoi 5 est mauvais? <br><br>  <b>Public:</b> car le nombre doit être une puissance de 2. <br><br>  <b>Professeur:</b> oui, eh bien, c'est pourquoi.  Parce qu'autrement, garantir l'utilisation de quelque chose qui est un multiple de 5 nécessitera des instructions supplémentaires entraînant des frais généraux.  Et huit?  Est-ce que huit est un nombre suffisant? <br><br>  <b>Public:</b> vous pouvez avoir des instructions de plus de huit bits. <br><br>  <b>Professeur:</b> oui, cela peut être pour la plus longue instruction autorisée sur la plate-forme x86.  Si nous avons une instruction de 10 octets et que tout doit être un multiple de 8, nous ne pouvons l’insérer nulle part.  La longueur devrait donc être suffisante dans tous les cas, car la plus grosse instruction que j'ai vue faisait 15 octets.  Donc 32 octets suffisent. <br><br>  Si vous souhaitez adapter les instructions pour entrer ou quitter l'environnement de service de processus, vous devrez peut-être une quantité non triviale de code dans un emplacement de 32 octets.  Par exemple, 31 octets, car 1 octet contient une instruction.  Doit-il être beaucoup plus gros?  Devrions-nous rendre cela égal à, disons, 1024 octets?  Si vous avez de nombreux pointeurs de fonction ou de nombreux sauts indirects, chaque fois que vous voulez créer un endroit où vous allez sauter, vous devez le continuer jusqu'à la bordure suivante, quelle que soit sa valeur.  Donc, avec 32 bits, c'est une taille tout à fait normale.  Dans le pire des cas, vous ne perdrez que 31 octets si vous devez vous rendre rapidement à la prochaine frontière.  Mais si vous avez une taille qui est un multiple de 1024 octets, il y a la possibilité de gaspiller un kilo-octet entier de mémoire en vain pour un saut indirect.  Si vous avez des fonctions courtes ou de nombreux pointeurs de fonction, une taille aussi grande de la multiplicité de la longueur du "saut" entraînera un gaspillage de mémoire important. <br><br>  Je ne pense pas que le nombre 32 soit une pierre d'achoppement pour le <b>Native Client</b> .  Certains blocs pourraient fonctionner avec une multiplicité de 16 bits, certains 64 ou 128 bits, peu importe.  Seulement 32 bits leur semblaient la valeur optimale la plus acceptable. <br><br>  Alors, faisons un plan pour un démontage fiable.  Par conséquent, le compilateur doit être un peu prudent lors de la compilation de <b>code</b> <b>C</b> ou <b>C ++</b> dans un binaire <b>Native Client</b> et observer les règles suivantes. <br><br><img src="https://habrastorage.org/webt/c0/nh/kc/c0nhkc4izpqqyrj_rtr2gg-eytu.jpeg"><br><br>  Par conséquent, chaque fois qu'il fait un saut, comme indiqué dans la ligne du haut, il doit ajouter ces instructions supplémentaires données dans les 2 lignes du bas.  Et indépendamment du fait qu'il crée une fonction vers laquelle il va "sauter", notre instruction sautera comme l'ajout <b>ET $ 0xffffffe0,% eax</b> indique.  Et il ne peut pas simplement le compléter avec des zéros, car tout cela doit avoir les bons codes.  Ainsi, l'ajout est nécessaire afin de s'assurer que toutes les instructions possibles sont valides.  Et, heureusement, sur la plate-forme <b>x86</b> , pas une seule fonction <b>noop</b> n'est décrite par un seul octet, ou du moins il n'y a pas un seul <b>noop</b> 1 octet de taille.  Ainsi, vous pouvez toujours ajouter des choses à la valeur d'une constante. <br><br>  Alors qu'est-ce que cela nous garantit?  Assurons-nous de toujours voir ce qui se passe dans la terminologie des instructions qui seront suivies.  Voici ce que cette règle nous donne: l'assurance qu'un appel système ne sera pas effectué par accident.  Cela s'applique aux sauts, mais qu'en est-il des retours?  Comment gèrent-ils les retours?  Pouvons-nous faire un <b>retour</b> à une fonction dans le <b>Native Client</b> ?  Que se passe-t-il si vous exécutez le code red-hot? <br><br>  <b>Public:</b> il peut déborder de la pile. <br><br>  <b>Professeur:</b> il est vrai qu'il apparaît de façon inattendue sur la pile.  Mais le fait est que la pile utilisée par les modules <b>Native Client</b> contient en fait des données à l'intérieur.  Ainsi, lorsque vous traitez avec <b>Native Client,</b> vous ne devez pas vous soucier du débordement de pile. <br><br>  <b>Public:</b> attendez, mais vous pouvez tout mettre sur la pile.  Et quand vous faites un saut indirect. <br><br>  <b>Professeur:</b> c'est vrai.  Le retour ressemble presque à un saut indirect de quelque part dans la mémoire, qui est situé en haut de la pile.  Par conséquent, je pense qu'une chose qu'ils pourraient faire pour la fonction de <b>retour</b> est de définir le préfixe de la même manière que lors de la vérification précédente.  Et ce préfixe vérifie ce qui apparaît en haut de la pile.  Vous vérifiez si cela est valide et lorsque vous écrivez ou utilisez l'opérateur <b>AND</b> , vous vérifiez ce qui se trouve en haut de la pile.  Cela semble un peu peu fiable en raison du changement constant de données.  Parce que, par exemple, si vous regardez en haut de la pile et assurez-vous que tout va bien, puis écrivez quelque chose, le flux de données dans le même module peut modifier quelque chose en haut de la pile, après quoi vous vous référerez à la mauvaise adresse <br><br>  <b>Public:</b> Cela ne s'applique-t-il pas au saut dans la même mesure? <br><br>  <b>Professeur:</b> oui, alors que se passe-t-il avec un saut?  Nos conditions de course peuvent-elles en quelque sorte invalider ce test? <br><br>  <b>Public:</b> Mais le code n'est-il pas accessible en écriture? <br><br>  <b>Professeur:</b> oui, le code ne peut pas être écrit, c'est vrai.  Par conséquent, vous ne pouvez pas modifier AND.  Mais un autre flux ne pourrait-il pas changer le but du saut entre ces deux instructions? <br><br>  <b>Public:</b> c'est dans le registre, donc ... <br><br>  <b>Professeur:</b> Oui, c'est cool.  Parce que si un flux modifie quelque chose en mémoire ou dans ce qui est chargé depuis <b>EAX</b> (par lui-même, vous le faites avant de télécharger), dans ce cas, cet <b>EAX</b> sera dans un mauvais état, mais il effacera les mauvais bits.  Ou bien il peut changer la mémoire après, lorsque le pointeur est déjà dans <b>EAX</b> , donc peu importe qu'il change l'emplacement de la mémoire à partir de laquelle le registre <b>EAX a</b> été chargé. <br><br>  En fait, les threads ne partagent pas les ensembles de registres.  Par conséquent, si un autre thread modifie le registre <b>EAX</b> , cela n'affectera pas le registre <b>EAX</b> de ce thread.  Par conséquent, d'autres threads ne peuvent pas invalider cette séquence d'instructions. <br><br>  Il y a une autre question intéressante.  Pouvons-nous contourner cet <b>ET</b> ?  Je peux sauter où je veux n'importe où dans cet espace d'adressage.      ,       <b>AND</b>  . <br><br><img src="https://habrastorage.org/webt/4p/vf/nk/4pvfnkoa0kmui9vdd5wn2o-jbk0.jpeg"><br><br>       ,      ,   ,    ,  ,        <b>AND</b> .    .     <b>jmp</b> ,      . <br><br><img src="https://habrastorage.org/webt/kg/mf/cu/kgmfcuyc42v0rtkdtzt1ptm1ty4.jpeg"><br><br> ,      ,    -  ,    1237.     ,     32.  <b>Native Client</b>       ,     ,      ,     .          ,   ,      1237      ? <br><br><img src="https://habrastorage.org/webt/dn/_-/_r/dn_-_r-vi7p_qx7nxwwkqmroh-w.jpeg"><br><br>    -  <b>EAX</b> ,   , ,        ,      .  ,    ?     ? <br><br> <b>:</b> <b>NaCl</b>   ,      . <br><br> <b>:</b> ,       .      <b>x86</b>    ,    ,   <b>NaCl</b>   ,  2          .       ,    ,  : «,    ,    !»,              <b>25 CD 80 00 00</b> .     .         ,     <b>x86</b> . <br><br>   ,   <b>Native Client</b>      . ,       ,   ,    ,          <b>NaCl</b> . ,     . <br><br> <b>:</b> ,        ,     .     ,         .  ,      ,     ,       ,     . <br><br><img src="https://habrastorage.org/webt/sq/hd/pl/sqhdplwnbsfj55r8qmp6trwxk5y.jpeg"><br><br> <b>:</b> ,  .     ,   . ,       ,      ,   <b>EAX</b> .           ,   -  .        <b>EAX</b> ,  <b>EBX</b>   .           ,       .          <b>EAX</b>  <b>EBX</b>  <b>AND</b>   .     ,  ,      <b>EAX</b> ,         .         ,   -   <b>64</b>  .    <b>Jmp *% eax</b>   <b>AND</b>   . <br><br><img src="https://habrastorage.org/webt/qz/nf/zt/qznfzt9lqpfreshgcc76zygs8cq.jpeg"><br><br> ,   , ,   ,   .   <b>Intel</b> ,        ,  ,   ,      .       ,   ,             .       <b>AND</b>    ,   <b>EAX</b>  ,    «» . <br><br> ,       ,           .     ,       .     ,    ,   ,   .      ,  ,   ,    . <br> ,     ,  <b>C1</b>  <b>C7</b> . <br><br> <b>C1</b>   ,       ,            .     ,     «»     .   ,       ,      .   ,       ,     - .  ,    . <br> <b>2</b> ,     0   <b>64</b> .     ,     ,        .        ,      ,      . <br><br>  <b>3</b> ,  ,  ,   .        ,  ,         . <br><br> <b>4</b>   ,         <b>hlt</b> .             <b>halt</b> ?     ,  <b>C4</b> .   ,   ,      -  ,      . <br><br>     ,  ,          ? ,          ,      -  . <br>     ,     ,  ,       ,       .    ,       ,     ,  ,           .         . <br><br><img src="https://habrastorage.org/webt/9i/1f/yj/9i1fyjdue4tun6jsa8gnnzkue9c.jpeg"><br><br> 55:20  <br><br> : <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cours MIT "Sécurité des systèmes informatiques".</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> 7: « Native Client»,  3</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/I0Psvvky-44" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . <br><br> ,    .  Aimez-vous nos articles?  Vous voulez voir des matériaux plus intéressants?  Soutenez-nous en passant une commande ou en le recommandant à vos amis, une <b>réduction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entrée de gamme que nous avons inventés pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la vérité sur VPS (KVM) E5-2650 v4 (6 cœurs) 10 Go DDR4 240 Go SSD 1 Gbps à partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'à 24 cœurs et jusqu'à 40 Go de DDR4). <br><br> <b>3  </b>    Dell R630     — <b>2  Intel Deca-Core Xeon E5-2630 v4 / 128GB DDR4 / 41TB HDD  2240GB SSD / 1Gbps 10 TB —  $99,33 </b> ,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . <br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV à partir de 249 $</a> aux Pays-Bas et aux États-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">création d'un bâtiment d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 coûtant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418225/">https://habr.com/ru/post/fr418225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418215/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 5: «D'où viennent les erreurs du système de sécurité», partie 2</a></li>
<li><a href="../fr418217/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 6: «Opportunités», partie 1</a></li>
<li><a href="../fr418219/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 6: Opportunités, partie 2</a></li>
<li><a href="../fr418221/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 6: «Opportunités», partie 3</a></li>
<li><a href="../fr418223/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Le Sandbox Native Client, Partie 1</a></li>
<li><a href="../fr418227/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 7: Le Sandbox Native Client, Partie 3</a></li>
<li><a href="../fr418229/index.html">Cours MIT "Sécurité des systèmes informatiques". Conférence 8: Modèle de sécurité réseau, partie 1</a></li>
<li><a href="../fr418233/index.html">Les mnémoniques BMW pour trouver les valeurs limites</a></li>
<li><a href="../fr418235/index.html">Saga orchestrée ou comment créer des transactions commerciales dans les services avec la base de données par modèle de service</a></li>
<li><a href="../fr418237/index.html">Développement d'applications multi-locataires sur la plateforme cloud SAP dans Neo, partie 2: autorisation et authentification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>