<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîù üëêüèø üêä Verwalten von Hunderten von Servern f√ºr Lasttests: automatische Skalierung, benutzerdefinierte √úberwachung, DevOps-Kultur üßïüèª üèΩ üëÇüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In einem fr√ºheren Artikel habe ich √ºber unsere gro√üe Lasttestinfrastruktur gesprochen. Im Durchschnitt erstellen wir ungef√§hr 100 Server f√ºr die Lastv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verwalten von Hunderten von Servern f√ºr Lasttests: automatische Skalierung, benutzerdefinierte √úberwachung, DevOps-Kultur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/miro/blog/463101/">  In einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fr√ºheren Artikel habe</a> ich √ºber unsere gro√üe Lasttestinfrastruktur gesprochen.  Im Durchschnitt erstellen wir ungef√§hr 100 Server f√ºr die Lastversorgung und ungef√§hr 150 Server f√ºr unseren Service.  Alle diese Server m√ºssen erstellt, gel√∂scht, konfiguriert und ausgef√ºhrt werden.  Zu diesem Zweck verwenden wir dieselben Werkzeuge wie auf dem Produkt, um den manuellen Arbeitsaufwand zu reduzieren: <br><br><ul><li>  So erstellen und l√∂schen Sie eine Testumgebung: Terraform-Skripte; </li><li>  So konfigurieren, aktualisieren und ausf√ºhren - Ansible-Skripte; </li><li>  F√ºr dynamische Skalierung je nach Auslastung - selbst geschriebene Python-Skripte. </li></ul><br>  Dank der Skripte Terraform und Ansible werden alle Vorg√§nge vom Erstellen von Instanzen bis zum Starten des Servers mit nur sechs Befehlen ausgef√ºhrt: <br><br><pre><code class="plaintext hljs">#     aws ansible-playbook deploy-config.yml #   ansible-playbook start-application.yml #      ansible-playbook update-test-scenario.yml --ask-vault-pass # Jmeter ,      infrastructure-aws-cluster/jmeter_clients:~# terraform apply # jmeter     ansible-playbook start-jmeter-server-cluster.yml # jmeter  ansible-playbook start-stress-test.yml # </code> </pre> <br><a name="habracut"></a><h2>  Dynamische Serverskalierung </h2><br>  Zur Hauptverkehrszeit in der Produktion haben wir mehr als 20.000 Online-Benutzer gleichzeitig, und zu anderen Zeiten k√∂nnen es 6.000 sein.  Es macht keinen Sinn, st√§ndig das gesamte Servervolumen beizubehalten. Daher richten wir die automatische Skalierung f√ºr die Board-Server ein, auf denen die Boards zum Zeitpunkt der Benutzereingabe ge√∂ffnet sind, sowie f√ºr API-Server, die API-Anforderungen verarbeiten.  Jetzt werden Server erstellt und bei Bedarf gel√∂scht. <br><br>  Dieser Mechanismus ist beim Auslastungstest sehr effektiv: Standardm√§√üig k√∂nnen wir die Mindestanzahl von Servern haben, und zum Zeitpunkt des Tests steigen diese automatisch in der richtigen Menge an.  Zu Beginn k√∂nnen wir 4 Board-Server haben und in der Spitze bis zu 40. Gleichzeitig werden neue Server nicht sofort erstellt, sondern erst, nachdem die aktuellen Server geladen wurden.  Das Kriterium zum Erstellen neuer Instanzen kann beispielsweise 50% der CPU-Auslastung sein.  Auf diese Weise k√∂nnen Sie das Wachstum virtueller Benutzer im Skript nicht verlangsamen und keine unn√∂tigen Server erstellen. <br><br>  Ein Bonus dieses Ansatzes ist, dass wir dank der dynamischen Skalierung lernen, wie viel Kapazit√§t wir f√ºr eine andere Anzahl von Benutzern ben√∂tigen, die wir noch nicht im Verkauf hatten. <br><br><h2>  Sammlung von Metriken wie auf Prod </h2><br>  Es gibt viele Ans√§tze und Werkzeuge zur √úberwachung von Stresstests, aber wir sind unseren eigenen Weg gegangen. <br><br>  Wir √ºberwachen die Produktion mit einem Standardstapel: Logstash, Elasticsearch, Kibana, Prometheus und Grafana.  Unser Testcluster √§hnelt dem Produkt, daher haben wir uns entschieden, dieselbe √úberwachung wie das Produkt mit denselben Metriken durchzuf√ºhren.  Daf√ºr gibt es zwei Gr√ºnde: <br><br><ul><li>  Sie m√ºssen kein √úberwachungssystem von Grund auf neu erstellen, wir haben es bereits vollst√§ndig und sofort. </li><li>  Wir testen zus√§tzlich die √úberwachung des Umsatzes: Wenn wir w√§hrend der √úberwachung des Tests verstehen, dass wir nicht √ºber gen√ºgend Daten verf√ºgen, um das Problem zu analysieren, reichen diese nicht f√ºr die Produktion aus, wenn dort ein solches Problem auftritt. </li></ul><br><img src="https://habrastorage.org/webt/rp/f6/8n/rpf68nydaytyhyw62bd6vegvbmy.png"><br><br><h2>  Was wir in den Berichten zeigen </h2><br><ul><li>  Technische Eigenschaften des Standes; </li><li>  Das Skript selbst, in Worten beschrieben, nicht Code; </li><li>  Ein Ergebnis, das f√ºr alle Teammitglieder, sowohl Entwickler als auch Manager, verst√§ndlich ist. </li><li>  Diagramme des allgemeinen Standzustands; </li><li>  Diagramme, die einen Engpass anzeigen oder von der im Test √ºberpr√ºften Optimierung betroffen sind. </li></ul><br>  Es ist wichtig, dass alle Ergebnisse an einem Ort gespeichert werden.  Daher ist es praktisch, sie von Start zu Start miteinander zu vergleichen. <br><br>  Wir erstellen Berichte in unserem Produkt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">(Beispiel eines Whiteboards mit einem Bericht)</a> : <br><br><img src="https://habrastorage.org/webt/ot/li/tf/otlitfwav4v-cby0ipnrin4xhxk.png"><br><br>  Das Erstellen eines Berichts nimmt viel Zeit in Anspruch.  Daher planen wir, die Erfassung allgemeiner Informationen mithilfe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserer √∂ffentlichen API</a> automatisch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">durchzuf√ºhren</a> . <br><br><h2>  Infrastruktur als Code </h2><br>  Wir sind f√ºr die Qualit√§t des Produkts verantwortlich, nicht f√ºr QS-Ingenieure, sondern f√ºr das gesamte Team.  Stresstests sind eines der Instrumente zur Qualit√§tssicherung.  Cool, wenn das Team versteht, dass es wichtig ist, die vorgenommenen √Ñnderungen unter Last zu √ºberpr√ºfen.  Um dar√ºber nachzudenken, muss sie f√ºr die Produktion verantwortlich werden.  Hier helfen uns die Prinzipien der DevOps-Kultur, die wir in unserer Arbeit umzusetzen begannen. <br><br>  Es ist jedoch nur der erste Schritt, √ºber die Durchf√ºhrung von Stresstests nachzudenken.  Das Team kann keine Tests durchdenken, ohne das Produktionsger√§t zu verstehen.  Wir sind auf ein solches Problem gesto√üen, als wir damit begannen, Lasttests in Teams durchzuf√ºhren.  Zu diesem Zeitpunkt hatten die Teams keine M√∂glichkeit, das Produktionsger√§t herauszufinden, so dass es f√ºr sie schwierig war, an der Gestaltung der Tests zu arbeiten.  Es gab mehrere Gr√ºnde: das Fehlen aktueller Unterlagen oder eine Person, die das ganze Bild des Verkaufs in meinem Kopf behalten h√§tte;  Mehrfachwachstum des Entwicklungsteams. <br><br>  Um den Teams das Verst√§ndnis der Vertriebsarbeit zu erleichtern, kann der Infrastrukturansatz als Code verwendet werden, den wir im Entwicklungsteam verwendet haben. <br><br>  Welche Probleme haben wir bereits mit diesem Ansatz zu l√∂sen begonnen: <br><br><ul><li>  Alles muss in Skripten geschrieben sein und kann jederzeit ausgel√∂st werden.  Dies verk√ºrzt die Wiederherstellungszeit f√ºr Verk√§ufe im Falle eines Rechenzentrumsunfalls erheblich und erm√∂glicht es Ihnen, die richtige Menge relevanter Testumgebungen beizubehalten </li><li>  Angemessene Einsparungen: Wir stellen Umgebungen auf Openstack bereit, wenn diese teure Plattformen wie AWS ersetzen k√∂nnen. </li><li>  Die Teams selbst erstellen Stresstests, weil sie verstehen, dass sich das Ger√§t verkauft. </li><li>  Der Code ersetzt die Dokumentation, sodass sie nicht endlos aktualisiert werden muss. Sie ist immer vollst√§ndig und aktuell. </li><li>  Sie ben√∂tigen keinen separaten Experten auf engstem Raum, um normale Probleme zu l√∂sen.  Jeder Ingenieur kann den Code herausfinden. </li><li>  Mit einer klaren Verkaufsstruktur ist es viel einfacher, Forschungstests wie Chaos-Affentests oder Tests auf lange Speicherlecks zu planen. </li></ul><br>  Ich m√∂chte diesen Ansatz nicht nur auf die Schaffung von Infrastrukturen, sondern auch auf die Unterst√ºtzung verschiedener Tools ausweiten.  Zum Beispiel haben wir beim Datenbanktest, √ºber den ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in einem fr√ºheren Artikel gesprochen habe</a> , vollst√§ndig in Code umgewandelt.  Aus diesem Grund verf√ºgen wir anstelle einer vorbereiteten Site √ºber eine Reihe von Skripten, mit denen wir in 7 Minuten die konfigurierte Umgebung in einem vollst√§ndig leeren AWS-Konto abrufen und den Test starten k√∂nnen.  Aus dem gleichen Grund pr√ºfen wir nun sorgf√§ltig <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gatling</a> , das die Entwickler als Werkzeug f√ºr ‚ÄûLasttest als Code‚Äú positionieren. <br><br>  Die Herangehensweise an die Infrastruktur als Code beinhaltet eine √§hnliche Herangehensweise an das Testen der Infrastruktur und der Skripte, die das Team schreibt, um die Infrastruktur mit neuen Funktionen zu erweitern.  All dies sollte durch Tests abgedeckt werden.  Es gibt auch verschiedene Test-Frameworks wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Molecule</a> .  Es gibt Tools f√ºr das Testen von Chaosaffen, f√ºr AWS gibt es kostenpflichtige Tools, f√ºr Docker gibt es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pumba</a> usw.  Mit ihnen k√∂nnen Sie verschiedene Arten von Aufgaben l√∂sen: <br><br><ul><li>  So √ºberpr√ºfen Sie, ob eine der Instanzen in AWS abst√ºrzt, um zu √ºberpr√ºfen, ob die Last auf den verbleibenden Servern neu verteilt wird und ob der Dienst von einer derart scharfen Umleitung von Anforderungen √ºberlebt; </li><li>  So simulieren Sie den langsamen Betrieb des Netzwerks, seinen Ausfall und andere technische Probleme, nach denen die Logik der Dienstinfrastruktur nicht unterbrochen werden sollte. </li></ul><br>  Die L√∂sung solcher Probleme in unseren unmittelbaren Pl√§nen. <br><br><h2>  Schlussfolgerungen </h2><br><ol><li>  Es lohnt sich nicht, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Testinfrastruktur</a> manuell zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">orchestrieren</a> . Es ist besser, diese Aktionen zu automatisieren, um alle Umgebungen, einschlie√ülich Produkte, zuverl√§ssiger zu verwalten. </li><li>  Die dynamische Skalierung reduziert die Kosten f√ºr die Aufrechterhaltung des Umsatzes und einer gro√üen Testumgebung erheblich und reduziert auch den menschlichen Faktor bei der Skalierung. </li><li>  Sie k√∂nnen kein separates √úberwachungssystem f√ºr Tests verwenden, sondern es vom Markt nehmen. </li><li>  Es ist wichtig, dass Stresstestberichte automatisch an einem einzigen Ort gesammelt werden und eine einheitliche Ansicht haben.  Auf diese Weise k√∂nnen sie √Ñnderungen leicht vergleichen und analysieren. </li><li>  Stresstests werden zu einem Prozess im Unternehmen, wenn sich die Teams f√ºr den Verkauf verantwortlich f√ºhlen. </li><li>  Lasttests - Infrastrukturtests.  Wenn der Auslastungstest erfolgreich war, wurde er m√∂glicherweise nicht korrekt kompiliert.  Die Validierung der Richtigkeit des Tests erfordert ein tiefes Verst√§ndnis des Umsatzes.  Teams sollten die M√∂glichkeit haben, das Verkaufsger√§t unabh√§ngig zu verstehen.  Wir l√∂sen dieses Problem mithilfe der Infrastruktur als Code-Ansatz. </li><li>  Infrastrukturvorbereitungsskripte m√ºssen wie jeder andere Code getestet werden. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463101/">https://habr.com/ru/post/de463101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463085/index.html">Cage Remote File Access System</a></li>
<li><a href="../de463089/index.html">Implementierung eines Unternehmenssuchsystems f√ºr Konstrukteure unter Verwendung der Low-Code-Plattform</a></li>
<li><a href="../de463095/index.html">Warum nicht SQL?</a></li>
<li><a href="../de463097/index.html">Go Produktentwicklung: Eine Projekthistorie</a></li>
<li><a href="../de463099/index.html">1000 und 1 Feedback. Wie man Feedback gibt und anderen beibringt, die Lamoda-Erfahrung</a></li>
<li><a href="../de463105/index.html">Mein vierter Tag mit Haiku: Installations- und Bootprobleme</a></li>
<li><a href="../de463107/index.html">ShIoTiny: kleine Automatisierung, das Internet der Dinge oder ‚Äûsechs Monate vor den Ferien‚Äú</a></li>
<li><a href="../de463113/index.html">Daten und Modelle Versionskontrolle im Computer Vision-Meetup</a></li>
<li><a href="../de463115/index.html">Das T√ºrproblem im Shooter-Design</a></li>
<li><a href="../de463117/index.html">Vorladen in PHP 7.4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>