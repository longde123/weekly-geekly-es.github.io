<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯП╝ ЁЯдЮЁЯП╝ ЁЯТЕЁЯП╝ рд╣рдо рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред рднрд╛рдЧ 1 рдирдВрдЧреЗ рдзрд╛рддреБ (рдбреЗрдмрд┐рдпрди) рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╣рд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ ЁЯПЯя╕П ЁЯСйЁЯП╛тАНЁЯТ╗ ЁЯСйЁЯП┐тАНЁЯПл</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣реЗрдмрд░ рдХреЗ рдкреНрд░рд┐рдп рдкрд╛рдардХреЛрдВ! 


 рдЗрд╕ рдкреНрд░рдХрд╛рд╢рди рдХреЗ рд╕рд╛рде, рдореИрдВ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкреВрд░реНрдг рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд▓реЗрдЦреЛрдВ рдХреА рдПрдХ рд╢реНрд░реГрдВ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╣рдо рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред рднрд╛рдЧ 1 рдирдВрдЧреЗ рдзрд╛рддреБ (рдбреЗрдмрд┐рдпрди) рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╣рд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462473/"><p><img src="https://habrastorage.org/webt/aq/dx/l3/aqdxl3a5akxfl3rh9b7bzc_kqji.jpeg"></p><br><h4>  рд╣реЗрдмрд░ рдХреЗ рдкреНрд░рд┐рдп рдкрд╛рдардХреЛрдВ! </h4><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд╢рди рдХреЗ рд╕рд╛рде, рдореИрдВ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкреВрд░реНрдг рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд▓реЗрдЦреЛрдВ рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рд╢реБрд░реВ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ, рдЬреЛ рдСрдкрд░реЗрд╢рди рдФрд░ рд▓реЙрдиреНрдЪрд┐рдВрдЧ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрдВрдЧреЗред <br>  рдореИрдВ рди рдХреЗрд╡рд▓ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ, рдмрд▓реНрдХрд┐ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреА рдмрддрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ рдХрд┐ рдорд╛рдЗрдХреНрд░реЛрд╕рд░рдХрд╛рд░реА рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЙрдкрдХрд░рдг рдФрд░ рдРрдб-рдСрди рдХреИрд╕реЗ рдЬреЛрдбрд╝реЗрдВред </p><br><h2>  рдЗрд╕ рдЪрдХреНрд░ рдореЗрдВ рдиреНрдпреВрдирддрдо рдЪрд╛рд░ рд▓реЗрдЦ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗ: </h2><br><ol><li>  рдЙрдирдореЗрдВ рд╕реЗ рдкрд╣рд▓реЗ рдореИрдВ рдЖрдкрдХреЛ рдмрддрд╛рдКрдВрдЧрд╛ рдХрд┐ рдирдВрдЧреЗ рд▓реЛрд╣реЗ рдкрд░ рдПрдХ рдЕрд╕рдлрд▓-рд╕реБрд░рдХреНрд╖рд┐рдд рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреИрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рдХреИрд╕реЗ рдПрдХ рдорд╛рдирдХ рдбреИрд╢рдмреЛрд░реНрдб рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рдЙрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдХреИрд╕реЗ рдПрдХ рдкреНрд░рд╡реЗрд╢ рдирд┐рдпрдВрддреНрд░рдХ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПред </li><li>  рдПрдХ рджреВрд╕рд░реЗ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рдЖрдкрдХреЛ рджрд┐рдЦрд╛рдКрдВрдЧрд╛ рдХрд┐ рд╕реАрдлрд╝ рдлреЗрд▓рдУрд╡рд░ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдХреИрд╕реЗ рддреИрдирд╛рдд рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рд╣рдорд╛рд░реЗ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЖрд░рдмреАрдбреА рд╡реЙрд▓реНрдпреВрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рдПред  рдореИрдВ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реНрдЯреЛрд░реЗрдЬ (рдмрд┐рдЯреНрд╕) рдкрд░ рднреА рд╕рдВрдкрд░реНрдХ рдХрд░реВрдВрдЧрд╛ рдФрд░ рд╕реНрдерд╛рдиреАрдп-рднрдВрдбрд╛рд░рдг рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░реВрдВрдЧрд╛ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореИрдВ рдЖрдкрдХреЛ рдмрддрд╛рдКрдВрдЧрд╛ рдХрд┐ рдмрдирд╛рдП рдЧрдП CEPH рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ S3 рдлреЙрд▓реНрдЯ-рдЯреЙрд▓рд░реЗрдВрдЯ рд╕реНрдЯреЛрд░реЗрдЬ рдХреЛ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП </li><li>  рддреАрд╕рд░реЗ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рд╡рд░реНрдгрди рдХрд░реВрдВрдЧрд╛ рдХрд┐ рд╣рдорд╛рд░реЗ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдПрдХ рд╡рд┐рдлрд▓рддрд╛ рдХреНрд▓рд╕реНрдЯрд░ MySql рдХреЛ рдХреИрд╕реЗ рддреИрдирд╛рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рдЕрд░реНрдерд╛рддреН рдХреБрд░реНрдиреЗрдЯреЗрдЯ рдкрд░ рдкрд░реНрдХреЛрдирд╛ рдПрдХреНрд╕реНрдЯреНрд░рд╛рдмрд░реНрдб рдХреНрд▓рд╕реНрдЯрд░ред  рдФрд░ рдЬрдм рдореИрдВрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рддреЛ рдореИрдВ рдЙрди рд╕рднреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░реВрдВрдЧрд╛ред </li><li>  рдЪреМрдереЗ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рд╕рдм рдХреБрдЫ рдПрдХ рд╕рд╛рде рд░рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛ рдФрд░ рдЖрдкрдХреЛ рдмрддрд╛рдКрдВрдЧрд╛ рдХрд┐ рдХреИрд╕реЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рддреИрдирд╛рдд рдХрд░рдирд╛ рдФрд░ рдЪрд▓рд╛рдирд╛ рд╣реИ рдЬреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рд╕реЗрдл рд╡реЙрд▓реНрдпреВрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред  рдореИрдВ рдЖрдкрдХреЛ рдмрддрд╛рддрд╛ рд╣реВрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдмрд╛рд╣рд░реА рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЖрджреЗрд╢ рд╕реЗрд╡рд╛ рд╕реЗ рд▓реЗрдЯ рдПрдирдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдВрдиреНрдЧреНрд░реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЛ рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВред  рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЗрди рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреИрд╕реЗ рдмрдирд╛рдП рд░рдЦрд╛ рдЬрд╛рдПред  рд╣рдо рдирд┐рдпрдВрддреНрд░рдг рдХрдХреНрд╖ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ RBAC рдкрд░ рднреА рд╕реНрдкрд░реНрд╢ рдХрд░реЗрдВрдЧреЗред  рдореИрдВ рдЖрдкрдХреЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд╣реЗрд▓реНрдо рдФрд░ рдЗрд╕рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рдКрдВрдЧрд╛ред <br>  рдпрджрд┐ рдЖрдк рдЗрди рдкреНрд░рдХрд╛рд╢рдиреЛрдВ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ! <a name="habracut"></a></li></ol><br><h2>  рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐: </h2><br><p>  рдпреЗ рд▓реЗрдЦ рдХрд┐рд╕рдХреЗ рд▓рд┐рдП рд╣реИрдВ?  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рдЕрдзреНрдпрдпрди рдореЗрдВ рдЕрдкрдиреА рдпрд╛рддреНрд░рд╛ рд╢реБрд░реВ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рд╕рд╛рде рд╣реА, рдпрд╣ рдЪрдХреНрд░ рдЙрди рдЗрдВрдЬреАрдирд┐рдпрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛, рдЬреЛ рдПрдХ рдореЛрдиреЛрд▓рд┐рде рд╕реЗ рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕ рдХреА рдУрд░ рдмрдврд╝рдиреЗ рдХреА рд╕реЛрдЪ рд░рд╣реЗ рд╣реИрдВред  рд╡рд░реНрдгрд┐рдд рд╕рдм рдХреБрдЫ рдореЗрд░рд╛ рдЕрдиреБрднрд╡ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдореЛрдиреЛрд▓рд┐рде рд╕реЗ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рдХрдИ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░рддреЗ рд╣реБрдП рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдкреНрд░рдХрд╛рд╢рдиреЛрдВ рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЗ рдЕрдиреБрднрд╡реА рдЗрдВрдЬреАрдирд┐рдпрд░реЛрдВ рдХреЗ рд▓рд┐рдП рд░реБрдЪрд┐ рдХреЗ рд╣реЛрдВрдЧреЗред </p><br><h4>  рдореИрдВ рдкреНрд░рдХрд╛рд╢рдиреЛрдВ рдХреА рдЗрд╕ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛: </h4><br><ul><li>  рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрддрд╛рдПрдВ рдХрд┐ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдЖрджрд┐рдо рдХреНрдпрд╛ рд╣реИрдВ, рдЬреИрд╕реЗ: рдлрд▓реА, рддреИрдирд╛рддреА, рд╕реЗрд╡рд╛, рдкреНрд░рд╡реЗрд╢, рдЖрджрд┐ред </li><li>  рдореИрдВ CNI (рдХрдВрдЯреЗрдирд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдЗрдВрдЯрд░рдлрд╝реЗрд╕) рдкрд░ рдмрд╣реБрдд рд╣реА рд╕рддрд╣реА рд░реВрдк рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░реВрдВрдЧрд╛, рд╣рдо рдХреЙрд▓рд┐рдХреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЗрд╕рд▓рд┐рдП рдЕрдиреНрдп рд╕рдорд╛рдзрд╛рди, рдореИрдВ рдХреЗрд╡рд▓ рд╕реВрдЪреА рджреВрдВрдЧрд╛ред </li><li>  рдбреЙрдХрдЯрд░ рдЫрд╡рд┐ рдирд┐рд░реНрдорд╛рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ред </li><li>  CI \ CD рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБред  (рд╢рд╛рдпрдж рдПрдХ рдЕрд▓рдЧ рдкреНрд░рдХрд╛рд╢рди, рд▓реЗрдХрд┐рди рдкреВрд░реЗ рдЪрдХреНрд░ рдХреЗ рдмрд╛рдж) </li><li>  рдкрддрд╡рд╛рд░;  рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд╛рдлреА рдХреБрдЫ рд▓рд┐рдЦрд╛ рдЬрд╛ рдЪреБрдХрд╛ рд╣реИ, рдореИрдВ рдХреЗрд╡рд▓ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЗрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрдкрд░реНрд╢ рдХрд░реВрдВрдЧрд╛ред </li></ul><br><h4>  рдореИрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдХреНрдпрд╛ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ: </h4><br><ul><li>  рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рддреИрдирд╛рддреА рдЪрд░рдг-рджрд░-рдЪрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ред  рдореИрдВ kubeadm рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ред  рд▓реЗрдХрд┐рди рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ, рдореИрдВ рдирдВрдЧреЗ рдзрд╛рддреБ, рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдИрдЯреАрд╕реАрдбреА рд╕реНрдерд╛рдкрдирд╛ рдкрд░ рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдФрд░ рдХреНрдпреВрдм рдкреНрд░рд╢рдВрд╕рд╛ рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рдХрджрдо-рджрд░-рдЪрд░рдг рджреЗрдЦреВрдВрдЧрд╛ред  рдореИрдВ рдЗрдирд░ рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рд▓рд┐рдП рд╕рднреА рд╕рдВрддреБрд▓рди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛ рдФрд░ рд╕рд░реНрд╡рд░ рдПрдкреА рдХреЛ рд╡рд░реНрдХрдПрдиреЛрдбреНрд╕ рдХреА рд╡рд┐рднрд┐рдиреНрди рдПрдХреНрд╕реЗрд╕ рдпреЛрдЬрдирд╛рдУрдВ рдореЗрдВ рдЕрдВрддрд░ред <br>  рдореБрдЭреЗ рдкрддрд╛ рд╣реИ рдХрд┐ рдЖрдЬ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреА рддреИрдирд╛рддреА рдХреЗ рд▓рд┐рдП рдХрдИ рдмреЗрд╣рддрд░реАрди рдЙрдкрдХрд░рдг рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреНрдпреВрдмреНрд╕рдкреНрд░рд╛рдп рдпрд╛ рдПрдХ рд╣реА рд░реИрдВрдЪрд░ред  рд╢рд╛рдпрдж рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди, рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ, рдРрд╕реЗ рдХрдИ рдЗрдВрдЬреАрдирд┐рдпрд░ рд╣реИрдВ рдЬреЛ рдЗрд╕ рдореБрджреНрджреЗ рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </li><li>  CEPH рдХреНрд▓рд╕реНрдЯрд░ рдХреА CEPH рд╢рдмреНрджрд╛рд╡рд▓реА рдФрд░ рдЪрд░рдг-рджрд░-рдЪрд░рдг рд╕реНрдерд╛рдкрдирд╛, рд╕рд╛рде рд╣реА рд╕рд╛рде рдХрджрдо-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ ceph рд╕рдВрдЧреНрд░рд╣рдг рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдПред </li><li>  рд▓реЛрдХрд▓-рд╕реНрдЯреЛрд░реЗрдЬ, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди, рд╕рд╛рде рд╣реА рд╣реЛрд╕реНрдЯрдкрд╛рде рдЬреИрд╕реЗ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рд╕реЗ рдорддрднреЗрдж рдЖрджрд┐ред </li><li>  kubernetes рдСрдкрд░реЗрдЯрд░реЛрдВ рдФрд░ рдСрдкрд░реЗрдЯрд░ рдХреА рдорджрдж рд╕реЗ Percona XtraDB рдХреНрд▓рд╕реНрдЯрд░ рдХреА рддреИрдирд╛рддреА, рд╕рд╛рде рд╣реА рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЫрд╣ рдорд╣реАрдиреЗ рдХреЗ рдЕрдиреБрднрд╡ рдХреЗ рдмрд╛рдж рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕рдорд╛рдзрд╛рди рдХреЗ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдФрд░ рд╡рд┐рдкрдХреНрд╖реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВред  рдФрд░ рдпрд╣ рднреА рдХрд┐ рдореИрдВ рдкрд░рд┐рдЪрд╛рд▓рдХ рд╕реЗ рдСрдкрд░реЗрдЯрд░ рдХреЛ рдЕрдВрддрд┐рдо рд░реВрдк рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝реА рдпреЛрдЬрдирд╛рдПрдБ рд╕рд╛рдЭрд╛ рдХрд░реВрдБрдЧрд╛ред </li></ul><br><h2>  рд╕рд╛рдордЧреНрд░реА рдХреА рддрд╛рд▓рд┐рдХрд╛: </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореЗрдЬрдмрд╛рдиреЛрдВ, рдореЗрдЬрдмрд╛рди рд╕рдВрд╕рд╛рдзрдиреЛрдВ, рдУрдПрд╕ рдФрд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреА рд╕реВрдЪреА</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рд╣рд╛ рдбрд╛рдпрдЧреНрд░рд╛рдо</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдк рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Create-config.sh рдлрд╝рд╛рдЗрд▓ рднрд░реЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">OS рдХрд░реНрдиреЗрд▓ рдЕрдкрдбреЗрдЯ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреБрдмреЗрдХреНрдЯрд▓, рдХреБрдмреЗрджрдо, рдФрд░ рдбреЛрдХрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдбреНрд╕ рддреИрдпрд╛рд░ рдХрд░рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ETCD рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ (рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдк)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╣рд▓рд╛ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╡рд┐рдЬрд╝рд╛рд░реНрдб рд▓реЙрдиреНрдЪ рдХрд░рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CNI Callico рд╕реНрдерд╛рдкрдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджреВрд╕рд░реЗ рдФрд░ рддреАрд╕рд░реЗ kubernetes рдЬрд╛рджреВрдЧрд░ рдХрд╛ рд╢реБрднрд╛рд░рдВрдн</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдПрдХ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЛрдб рдЬреЛрдбрд╝реЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">HA рдХреЗ рд▓рд┐рдП рд╡рд░реНрдХрд░ рдиреЛрдбреНрд╕ рдкрд░ haproxy рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдирд┐рдпрдВрддреНрд░рдХ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реЗрдм UI (рдбреИрд╢рдмреЛрд░реНрдб) рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ</a> </li></ol><br><a name="vm"></a><br><h2>  рдореЗрдЬрдмрд╛рдиреЛрдВ рдХреА рд╕реВрдЪреА рдФрд░ рдЧрдВрддрд╡реНрдп </h2><br><p>  рдореЗрд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рднреА рдиреЛрдбреНрд╕ рдХрд░реНрдиреЗрд▓ 4.19.0-0.bpo.5-amd64 рдХреЗ рд╕рд╛рде рдкреНрд░реАрдЗрдВрд╕реНрдЯреЙрд▓реНрдб рдбреЗрдмрд┐рдпрди 9 рд╕реНрдЯреНрд░реЗрдЪ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдкрд░ рд╕реНрдерд┐рдд рд╣реЛрдВрдЧреЗред  рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬреЗрд╢рди рдХреЗ рд▓рд┐рдП, рдореИрдВ Proxmox VE рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред </p><br><h4>  рддрд╛рд▓рд┐рдХрд╛ VM рдФрд░ рдЙрдирдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ: </h4><br><div class="scrollable-table"><table><tbody><tr><th>  <b>рдирд╛рдо</b> </th><th>  <b>рдЖрдИрдкреА тАЛтАЛрдПрдбреНрд░реЗрд╕</b> </th><th>  <b>рдЯрд┐рдкреНрдкрдгреА</b> </th><th>  <b>рд╕реАрдкреАрдпреВ</b> </th><th>  <b>рд╕рджрд╕реНрдп</b> </th><th>  <b>disk1</b> </th><th>  <b>Disk2</b> </th></tr><tr><td>  master01 </td><td>  10.73.71.25 </td><td>  рдорд╛рд╕реНрдЯрд░ рдиреЛрдб </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  --- </td></tr><tr><td>  master02 </td><td>  10.73.71.26 </td><td>  рдорд╛рд╕реНрдЯрд░ рдиреЛрдб </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  --- </td></tr><tr><td>  master03 </td><td>  10.73.71.27 </td><td>  рдорд╛рд╕реНрдЯрд░ рдиреЛрдб </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  --- </td></tr><tr><td>  worknode01 </td><td>  10.73.75.241 </td><td>  рдХрд╛рдо рдиреЛрдб </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  рдПрд╕рдПрд╕рдбреА </td></tr><tr><td>  worknode02 </td><td>  10.73.75.242 </td><td>  рдХрд╛рдо рдиреЛрдб </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  рдПрд╕рдПрд╕рдбреА </td></tr><tr><td>  worknode03 </td><td>  10.73.75.243 </td><td>  рдХрд╛рдо рдиреЛрдб </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  рдПрд╕рдПрд╕рдбреА </td></tr></tbody></table></div><br><p>  рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдорд╢реАрдиреЛрдВ рдХрд╛ рдРрд╕рд╛ рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдореИрдВ рдЖрдкрдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬ</a> рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВ, рдФрд░ рд╕реНрд╡рд╛рдореА рдХреЗ рд▓рд┐рдП, рд░реИрдо рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдХрдо рд╕реЗ рдХрдо 4 рдЬреАрдмреА рддрдХ рдмрдврд╝рд╛ рд╕рдХрддрд╛ рд╣реВрдВред  рдЖрдЧреЗ рджреЗрдЦрддреЗ рд╣реБрдП, рдореИрдВ рдХрд╣рддрд╛ рд╣реВрдБ рдХрд┐ рдХрдо рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╕рд╛рде, рдореИрдВрдиреЗ CNI Callico рдХреЗ рдХрд╛рдо рдореЗрдВ рдЧрдбрд╝рдмрдбрд╝рд┐рдпрд╛рдБ рдкрдХрдбрд╝реАрдВ <br>  рдореЗрдореЛрд░реА рдФрд░ рдбрд┐рд╕реНрдХ рдкрд░рдлреЙрд░рдореЗрдВрд╕ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рднреА рд╕рд┐рдл рдХрд╛рдлреА рд╡рд┐рдХрд░рд╛рд▓ рд╣реИред <br>  рд╣рдорд╛рд░реЗ рдкреНрд░реЛрдбрдХреНрд╢рди рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдирдВрдЧреЗ-рдзрд╛рддреБ рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬреЗрд╢рди рдХреЗ рдмрд┐рдирд╛ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдореИрдВ рдРрд╕реЗ рдХрдИ рдЙрджрд╛рд╣рд░рдг рдЬрд╛рдирддрд╛ рд╣реВрдВ, рдЬрд╣рд╛рдВ рдХрд╛рдлреА рдорд╛рдореВрд▓реА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рд╡рд╛рд▓реА рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдереАрдВред  рдпрд╣ рд╕рдм рдЖрдкрдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдФрд░ рдХрд╛рд░реНрдпрднрд╛рд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </p><br><h2>  рд╕реВрдЪреА рдФрд░ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рд╕рдВрд╕реНрдХрд░рдг </h2><br><div class="scrollable-table"><table><tbody><tr><th>  <b>рдирд╛рдо</b> </th><th>  <b>рд╕рдВрд╕реНрдХрд░рдг</b> </th></tr><tr><td>  Kubernetes </td><td>  1.15.1 </td></tr><tr><td>  рдбрд╛рдХ рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗрд╡рд╛рд▓рд╛ рдордЬрд╝рджреВрд░ </td><td>  19.3.1 </td></tr></tbody></table></div><br><p>  рд╕рдВрд╕реНрдХрд░рдг 1.14 рд╕реЗ рд╢реБрд░реВ, рдХреБрдмреЗрджрдо рдиреЗ v1alp33 рдПрдкреАрдЖрдИ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рд╕рдорд░реНрдерди рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдФрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ v1beta1 рдПрдкреАрдЖрдИ рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд┐рдпрд╛, рдЬреЛ рдирд┐рдХрдЯ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдЗрд╕рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ рдХреЗрд╡рд▓ v1beta1 рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛ред <br>  рддреЛ, рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдиреЗ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд▓рд┐рдП рдорд╢реАрдиреЗрдВ рддреИрдпрд╛рд░ рдХрд░ рд▓реА рд╣реИрдВред  рд╡реЗ рд╕рднреА рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рд▓рд┐рдП рд╕реБрд▓рдн рд╣реИрдВ, рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЗ рд▓рд┐рдП "рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди" рд╣реИ, рдФрд░ рдЙрди рдкрд░ рдПрдХ "рдХреНрд▓реАрди" рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд╛рдкрд┐рдд рд╣реИред <br>  рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд╛рдкрдирд╛ рдЪрд░рдг рдХреЗ рд▓рд┐рдП, рдореИрдВ рд╕реНрдкрд╖реНрдЯ рдХрд░реВрдВрдЧрд╛ рдХрд┐ рдХреМрди рд╕реА рдорд╢реАрдиреЗрдВ рдХрдорд╛рдВрдб рдпрд╛ рдХрдорд╛рдВрдб рдХреЗ рдмреНрд▓реЙрдХ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреА рд╣реИрдВред  рдЬрдм рддрдХ рдЕрдиреНрдпрдерд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рди рд╣реЛ, рддрдм рддрдХ рд╕рднреА рдХрдорд╛рдВрдб рдХреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВред <br>  рд╕рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ, рд╕рд╛рде рд╣реА рдЙрдирдХреА рддреИрдпрд╛рд░реА рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ, рдореЗрд░реЗ <a href="">рдЧрд┐рддреБрдм</a> рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реИрдВ <br>  рддреЛ рдЪрд▓рд┐рдП рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред </p><br><a name="ha-image"></a><br><h2>  рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рд╣рд╛ рдбрд╛рдпрдЧреНрд░рд╛рдо </h2><br><p><img src="https://habrastorage.org/webt/ch/mx/pg/chmxpgzdyk0bvxwx7-6lawqfmvo.jpeg"><br>  рд╣рд╛ рдХреНрд▓рд╕реНрдЯрд░ рдХрд╛ рдПрдХ рдЕрдиреБрдорд╛рдирд┐рдд рдЖрд░реЗрдЦред  рдореЗрд░реЗ рдХрд▓рд╛рдХрд╛рд░ рдЗрддрдиреЗ рдИрдорд╛рдирджрд╛рд░ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдореИрдВ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗ рдмрд┐рдирд╛, рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдФрд░ рдХрд╛рдлреА рд╕рд░рд▓рддрд╛ рд╕реЗ рд╕рдордЭрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдБрдЧрд╛ред <br>  рддреЛ, рд╣рдорд╛рд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рддреАрди рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдФрд░ рддреАрди рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЛрдб рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗред  рдкреНрд░рддреНрдпреЗрдХ kubernetes рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдкрд░, etcd (рдЖрд░реЗрдЦ рдкрд░ рд╣рд░реЗ рддреАрд░) рдФрд░ kubernetes рд╕реЗрд╡рд╛ рднрд╛рдЧреЛрдВ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░реЗрдВрдЧреЗ;  рдЖрдЗрдП рдЙрдиреНрд╣реЗрдВ рдЙрджрд╛рд░рддрд╛рдкреВрд░реНрд╡рдХ - рдХреБрдмреЗрдкреА рдХрд╣рддреЗ рд╣реИрдВред <br>  рдПрд▓реНрдбрд░реНрдб рдорд╛рд╕реНрдЯрд░ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдиреЛрдбреНрд╕ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреНрд▓рд╕реНрдЯрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред  рдореИрдВ рдмрд╛рд╣рд░реА рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡реЗрд╢ рдирд┐рдпрдВрддреНрд░рдХ рдХреЗ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдХреЗ рд╕рдорд╛рди рдкрддреЗ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реВрдВрдЧрд╛ (рдЖрд░реЗрдЦ рдореЗрдВ рд▓рд╛рд▓ рддреАрд░) <br>  рд╡рд░реНрдХрд░ рдиреЛрдбреНрд╕ рдкрд░, рдХреНрдпреВрдмрд▓реЗрдЯ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрдХрд░ рдиреЛрдб рдкрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдП рдЧрдП рд╣рд╛рдЗрдкреНрд░реЛ рдХреЗ рдЬрд░рд┐рдП рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдПрдкрд┐ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд░ рдПрдкреАрдЖрдИ рдкрддреЗ рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВ рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ 127.0.0.1:6443 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛, рдФрд░ рд░рд╛рдЙрдВрдбреНрд░реЛрдмрд┐рди рдкрд░ рд╣реИрдкреНрд░реЛрдХреНрд╕реА рддреАрди рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдкрд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдмрд┐рдЦреЗрд░ рджреЗрдЧрд╛, рдпрд╣ рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рднреА рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ред  рдпрд╣ рдпреЛрдЬрдирд╛ рд╣рдореЗрдВ рдПрдЪрдП рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреА, рдФрд░ рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдореЗрдВ рд╕реЗ рдПрдХ рдХреА рд╡рд┐рдлрд▓рддрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЛрдб рдЪреБрдкрдЪрд╛рдк рджреЛ рд╢реЗрд╖ рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВрдЧреЗред </p><br><a name="begin"></a><br><h2>  рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ </h2><br><p>  рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдкрд░ рдХрд╛рдо рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЙрди рдкреИрдХреЗрдЬреЛрдВ рдХреА рдЖрдкреВрд░реНрддрд┐ рдХрд░реЗрдВрдЧреЗ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА: </p><br><pre><code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y curl apt-transport-https git</code> </pre> <br><p>  рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдкрд░, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдХреЙрдкреА рдХрд░реЗрдВ </p><br><pre> <code class="plaintext hljs">sudo -i git clone https://github.com/rjeka/kubernetes-ceph-percona.git</code> </pre> <br><p>  рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдХрд┐ рдЬрд╛рджреВрдЧрд░реЛрдВ рдкрд░ рдореЗрдЬрдмрд╛рдиреЛрдВ рдХрд╛ рдЖрдИрдкреА рдкрддрд╛ рдЙрд╕реА рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯ рд╕рд░реНрд╡рд░ рд╕реБрдиреЗрдВрдЧреЗ </p><br><pre> <code class="plaintext hljs">hostname &amp;&amp; hostname -i master01 10.73.71.25</code> </pre> <br><p>  рдФрд░ рдЗрд╕рд▓рд┐рдП рд╕рднреА рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдПред </p><br><p>  SWAP рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ, рдЕрдиреНрдпрдерд╛ kubeadm рдПрдХ рддреНрд░реБрдЯрд┐ рдлреЗрдВрдХ рджреЗрдЧрд╛ </p><br><pre> <code class="plaintext hljs">[ERROR Swap]: running with swap on is not supported. Please disable swap</code> </pre> <br><p>  рдЖрдк рдХрдорд╛рдВрдб рдХреЛ рдбрд┐рд╕реЗрдмрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">swapoff -a</code> </pre> <br><p>  / Etc / fstab рдореЗрдВ рдЯрд┐рдкреНрдкрдгреА рдХрд░рдирд╛ рдпрд╛рдж рд░рдЦреЗрдВ </p><br><a name="create-config"></a><br><h2>  Create-config.sh рдлрд╝рд╛рдЗрд▓ рднрд░реЗрдВ </h2><br><p>  рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдПрдХ рдЫреЛрдЯреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ create-config.sh рдЕрдкрд▓реЛрдб рдХреАред  рдЖрдкрдХреЛ рдЗрд╕рдореЗрдВ рд╕рдЪрдореБрдЪ 8 рд▓рд╛рдЗрдиреЗрдВ рднрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЕрдкрдиреЗ рд╕реНрд╡рд╛рдореА рдХреЗ рдЖрдИрдкреА рдкрддреЗ рдФрд░ рд╣реЛрд╕реНрдЯрдирд╛рдо рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВред  рдФрд░ etcd tocken рднреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ, рдЖрдк рдЗрд╕реЗ рдмрджрд▓ рдирд╣реАрдВ рд╕рдХрддреЗред  рдореИрдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдЙрд╕ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рдиреАрдЪреЗ рджреВрдВрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдЖрдкрдХреЛ рдмрджрд▓рд╛рд╡ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">#!/bin/bash ####################################### # all masters settings below must be same ####################################### # master01 ip address export K8SHA_IP1=10.73.71.25 # master02 ip address export K8SHA_IP2=10.73.71.26 # master03 ip address export K8SHA_IP3=10.73.71.27 # master01 hostname export K8SHA_HOSTNAME1=master01 # master02 hostname export K8SHA_HOSTNAME2=master02 # master03 hostname export K8SHA_HOSTNAME3=master03 #etcd tocken: export ETCD_TOKEN=9489bf67bdfe1b3ae077d6fd9e7efefd #etcd version export ETCD_VERSION="v3.3.10"</code> </pre><br><a name="kernel"></a><br><h2>  OS рдХрд░реНрдиреЗрд▓ рдЕрдкрдбреЗрдЯ </h2><br><p>  рдпрд╣ рдЪрд░рдг рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХрд░реНрдиреЗрд▓ рдХреЛ рдкреАрдЫреЗ рдХреЗ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдФрд░ рдЖрдк рдЗрд╕реЗ рдЕрдкрдиреЗ рдЬреЛрдЦрд┐рдо рдФрд░ рдЬреЛрдЦрд┐рдо рдкрд░ рдХрд░рддреЗ рд╣реИрдВред  рд╢рд╛рдпрдж рдЖрдк рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рдордирд╛ рдХрднреА рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдпрджрд┐ рдЖрдк рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХреБрдмреЗрд░рдиреЗрдЯ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рднреА рдХрд░реНрдиреЗрд▓ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдЖрдк рддрдп рдХрд░рддреЗ рд╣реИрдВред <br>  рдкреБрд░рд╛рдиреЗ рдХрд░реНрддрд╛ рдмрдЧ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рдЕрдкрдбреЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреЛ рдХреЗрд╡рд▓ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдг 4.18 рдореЗрдВ рддрдп рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ</a> рдЗрд╕ рдмрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред  рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдиреЛрдбреНрд╕ рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдЖрд╡рдзрд┐рдХ рд╣реИрдВрдЧ рдореЗрдВ рдПрдХ рдмрдЧ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: </p><br><pre> <code class="plaintext hljs">waiting for eth0 to become free. Usage count = 1</code> </pre> <br><p>  рдУрдПрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореЗрд░реЗ рдкрд╛рд╕ рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдг 4.9 рдерд╛ </p><br><pre> <code class="bash hljs">uname -a Linux master01 4.9.0-7-amd64 <span class="hljs-comment"><span class="hljs-comment">#1 SMP Debian 4.9.110-3+deb9u2 (2018-08-13) x86_64 GNU/Linux</span></span></code> </pre> <br><p>  рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ рдорд╢реАрди рдкрд░ рд╣рдо рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ <br>  рдЪрд░рдг # 1 <br>  рд╕реНрд░реЛрдд рд╕реВрдЪреА рдореЗрдВ рд╡рд╛рдкрд╕ рдкреЛрд░реНрдЯ рдЬреЛрдбрд╝реЗрдВ </p><br><pre> <code class="plaintext hljs">echo deb http://ftp.debian.org/debian stretch-backports main &gt; /etc/apt/sources.list apt-get update apt-cache policy linux-compiler-gcc-6-x86</code> </pre> <br><p>  рдЪрд░рдг рд╕рдВрдЦреНрдпрд╛ 2 <br>  рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрдирд╛ </p><br><pre> <code class="plaintext hljs">apt install -y -t stretch-backports linux-image-amd64 linux-headers-amd64</code> </pre> <br><p>  рдЪрд░рдг рд╕рдВрдЦреНрдпрд╛ 3 <br>  рд░рд┐рдмреВрдЯ </p><br><pre> <code class="plaintext hljs">reboot</code> </pre> <br><p>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реИ </p><br><pre> <code class="plaintext hljs">uname -a Linux master01 4.19.0-0.bpo.5-amd64 #1 SMP Debian 4.19.37-4~bpo9+1 (2019-06-19) x86_64 GNU/Linux</code> </pre><br><a name="kubelet"></a><br><h2>  рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреБрдмреЗрдХреНрдЯрд▓, рдХреБрдмреЗрджрдо, рдФрд░ рдбреЛрдХрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдбреНрд╕ рддреИрдпрд╛рд░ рдХрд░рдирд╛ </h2><br><h4>  Kublet, Kubectl, Kubeadm рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h4><br><p>  рд╣рдо рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рднреА рдиреЛрдбреНрд╕ рдкрд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕</a> рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди рдХреЗ рдЕрдиреБрд╕рд╛рд░</a> </p><br><pre> <code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF apt-get update apt-get install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl</code> </pre> <br><h4>  рдбреЙрдХрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ</a> рдЕрдиреБрд╕рд╛рд░ рдбреЙрдХрдЯрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><br></a> </p><br><pre> <code class="plaintext hljs">apt-get remove docker docker-engine docker.io containerd runc apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</code> </pre> <br><pre> <code class="plaintext hljs">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - apt-key fingerprint 0EBFCD88</code> </pre> <br><pre> <code class="plaintext hljs">add-apt-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable"</code> </pre> <br><pre> <code class="plaintext hljs">apt-get update apt-get install docker-ce docker-ce-cli containerd.io</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдерд╛рдкрдирд╛ рд╕реНрдерд╛рдкрд┐рдд рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреБрдмреЗрдХрд▓, рдХреБрдмреЗрджрдо рдФрд░ рдбреЙрдХрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдРрд╕рд┐рдмрд▓</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p>  рдорд╛рд╕реНрдЯрд░реНрд╕ рдЧреНрд░реБрдк рдореЗрдВ, рдЖрдИрдкреА рдорд╛рд╕реНрдЯрд░реНрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВред <br>  рд╢реНрд░рдорд┐рдХ рд╕рдореВрд╣ рдореЗрдВ, рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдбреНрд╕ рдХрд╛ рдЖрдИрдкреА рд▓рд┐рдЦреЗрдВред </p><br><pre> <code class="plaintext hljs"># sudo c  ansible-playbook -i hosts.ini kubelet.yaml -K ansible-playbook -i hosts.ini docker.yaml -K # sudo  ansible-playbook -i hosts.ini kubelet.yaml ansible-playbook -i hosts.ini docker.yaml</code> </pre> </div></div><br><p>  рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдЖрдк docker рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХрд┐рд╕реА CRI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдк рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> , рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд┐рд╖рдп рдЗрд╕ рд▓реЗрдЦ рдХреЗ рджрд╛рдпрд░реЗ рд╕реЗ рдкрд░реЗ рд╣реИред </p><br><a name="etcd"></a><br><h2>  ETCD рд╕реНрдерд╛рдкрдирд╛ </h2><br><p>  рдореИрдВ рдЧрд╣рд░рд╛рдИ рд╕реЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рдКрдВрдЧрд╛, рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ: etcd рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рд╡рд┐рддрд░рд┐рдд рдХреА-рд╡реИрд▓реНрдпреВ рд╕реНрдЯреЛрд░реЗрдЬ рд╣реИред  etcd рдХреЛ GO рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ kubernetes рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдХреНрд▓рд╕реНрдЯрд░ рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред  рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╕рдореАрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдкреНрд░рд▓реЗрдЦрди</a> рджреЗрдЦреЗрдВред <br>  etcd рдХреЛ рдХрдИ рддрд░рд╣ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рдЗрд╕реЗ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреЗрдореЙрди рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк рдЗрд╕реЗ рдбреЙрдХрдЯрд░ рдХрдВрдЯреЗрдирд░реЛрдВ рдореЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк рдЗрд╕реЗ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рддрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рднреА рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдк рдЗрд╕реЗ рд╣рд╛рде рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЖрдк рдЗрд╕реЗ рдХреБрдмреЗрджрдо (рдореИрдВрдиреЗ рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреА рдХреЛрд╢рд┐рд╢ рдирд╣реАрдВ рдХреА рд╣реИ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдХреНрд▓рд╕реНрдЯрд░ рдорд╢реАрдиреЛрдВ рдпрд╛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕рд░реНрд╡рд░ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br>  рдореИрдВ рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдкрд░ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ etcd рд╕реНрдерд╛рдкрд┐рдд рдХрд░реВрдБрдЧрд╛ рдФрд░ systemd рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдорди рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдКрдВрдЧрд╛, рдФрд░ docker рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдкрд░ рднреА рд╡рд┐рдЪрд╛рд░ рдХрд░реВрдБрдЧрд╛ред  рдореИрдВ TLS рдХреЗ рдмрд┐рдирд╛ etcd рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ, рдпрджрд┐ рдЖрдкрдХреЛ TLS рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддреЛ etcd рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">kubernetes</a> рдХреЗ рдкреНрд░рд▓реЗрдЦрди рдХреЛ рджреЗрдЦреЗрдВ <br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдореЗрд░реЗ github рдореЗрдВ systemd рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдиреНрдЪ рдХреЗ рд╕рд╛рде etcd рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ansible-playbook рд╣реЛрдЧреАред </p><br><h4>  рд╡рд┐рдХрд▓реНрдк рд╕рдВрдЦреНрдпрд╛ 1 <br>  рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рд╕рд┐рд╕реНрдЯрдордб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рд╛рдПрдВ </h4><br><p>  рд╕рднреА рд╕реНрд╡рд╛рдореА рдкрд░: (рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдб рдкрд░, рдпрд╣ рдХрджрдо рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ) <br>  рдЪрд░рдг # 1 <br>  рдкреБрд░рд╛рд▓реЗрдЦ рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рдЕрдирдкреИрдХ рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">mkdir archives cd archives export etcdVersion=v3.3.10 wget https://github.com/coreos/etcd/releases/download/$etcdVersion/etcd-$etcdVersion-linux-amd64.tar.gz tar -xvf etcd-$etcdVersion-linux-amd64.tar.gz -C /usr/local/bin/ --strip-components=1</code> </pre> <br><p>  рдЪрд░рдг рд╕рдВрдЦреНрдпрд╛ 2 <br>  ETCD рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдиреНрдпрд╛рд╕ рдлрд╛рдЗрд▓ рдмрдирд╛рдПрдБ </p><br><pre> <code class="plaintext hljs">cd .. ./create-config.sh etcd</code> </pre> <br><p>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рди etcd рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ etcd рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдХреЙрдиреНрдлрд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдЪрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рддреИрдпрд╛рд░ рдХреА рдЧрдИ рдХреЙрдиреНрдлрд┐рдЧрд░ рдлрд╛рдЗрд▓ рд╡рдЧреИрд░рд╣ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрдЧреАред <br>  рдЕрдиреНрдп рд╕рднреА рд╡рд┐рдиреНрдпрд╛рд╕реЛрдВ рдХреЗ рд▓рд┐рдП, рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХ рд╣реА рд╕рд┐рджреНрдзрд╛рдВрдд рдкрд░ рдХрд╛рдо рдХрд░рддреА рд╣реИред  рдпрд╣ рдХреБрдЫ рдЗрдирдкреБрдЯ рд▓реЗрддрд╛ рд╣реИ рдФрд░ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛рддрд╛ рд╣реИред </p><br><p>  рдЪрд░рдг рд╕рдВрдЦреНрдпрд╛ 3 <br>  рд╣рдо рдХреЙрд░реНрдб рдХреНрд▓рд╕реНрдЯрд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">systemctl start etcd</code> </pre> <br><p>  рдбреЗрдорди рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛ </p><br><pre> <code class="plaintext hljs">systemctl status etcd тЧП etcd.service - etcd Loaded: loaded (/etc/systemd/system/etcd.service; disabled; vendor preset: enabled) Active: active (running) since Sun 2019-07-07 02:34:28 MSK; 4min 46s ago Docs: https://github.com/coreos/etcd Main PID: 7471 (etcd) Tasks: 14 (limit: 4915) CGroup: /system.slice/etcd.service тФФтФА7471 /usr/local/bin/etcd --name master01 --data-dir /var/lib/etcd --listen-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 --advertise-client-urls http://10.73.71.25:2379,http://10.73.71. Jul 07 02:34:28 master01 etcd[7471]: b11e73358a31b109 [logterm: 1, index: 3, vote: 0] cast MsgVote for f67dd9aaa8a44ab9 [logterm: 2, index: 5] at term 554 Jul 07 02:34:28 master01 etcd[7471]: raft.node: b11e73358a31b109 elected leader f67dd9aaa8a44ab9 at term 554 Jul 07 02:34:28 master01 etcd[7471]: published {Name:master01 ClientURLs:[http://10.73.71.25:2379 http://10.73.71.25:4001]} to cluster d0979b2e7159c1e6 Jul 07 02:34:28 master01 etcd[7471]: ready to serve client requests Jul 07 02:34:28 master01 etcd[7471]: serving insecure client requests on [::]:4001, this is strongly discouraged! Jul 07 02:34:28 master01 systemd[1]: Started etcd. Jul 07 02:34:28 master01 etcd[7471]: ready to serve client requests Jul 07 02:34:28 master01 etcd[7471]: serving insecure client requests on [::]:2379, this is strongly discouraged! Jul 07 02:34:28 master01 etcd[7471]: set the initial cluster version to 3.3 Jul 07 02:34:28 master01 etcd[7471]: enabled capabilities for version 3.3 lines 1-19</code> </pre> <br><p>  рдФрд░ рд╕реНрд╡рдпрдВ рдХреНрд▓рд╕реНрдЯрд░ рдХрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп: </p><br><pre> <code class="plaintext hljs">etcdctl cluster-health member 61db137992290fc is healthy: got healthy result from http://10.73.71.27:2379 member b11e73358a31b109 is healthy: got healthy result from http://10.73.71.25:2379 member f67dd9aaa8a44ab9 is healthy: got healthy result from http://10.73.71.26:2379 cluster is healthy etcdctl member list 61db137992290fc: name=master03 peerURLs=http://10.73.71.27:2380 clientURLs=http://10.73.71.27:2379,http://10.73.71.27:4001 isLeader=false b11e73358a31b109: name=master01 peerURLs=http://10.73.71.25:2380 clientURLs=http://10.73.71.25:2379,http://10.73.71.25:4001 isLeader=false f67dd9aaa8a44ab9: name=master02 peerURLs=http://10.73.71.26:2380 clientURLs=http://10.73.71.26:2379,http://10.73.71.26:4001 isLeader=true</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ ansible рдХреЗ рд╕рд╛рде etcd рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, systemd рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рд╛рдПрдБ</b> <div class="spoiler_text"><p>  рдЧрд┐рддреБрдм рдХреЗ рд╕рд╛рде, рд╣рдо рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдЙрд╕ рдХреЛрдб рдХреЗ рд╕рд╛рде рдХреНрд▓реЛрди рдХрд░ рджреЗрдВрдЧреЗ рдЬрд┐рд╕ рдорд╢реАрди рд╕реЗ рдЖрдк рдкреНрд▓реЗрдмреБрдХ рдЪрд▓рд╛рдПрдВрдЧреЗред  рдпрд╣ рдорд╢реАрди рд╣рдорд╛рд░реЗ рднрд╡рд┐рд╖реНрдп рдХреЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдорд╛рд╕реНрдЯрд░ рдХреЗ рд▓рд┐рдП ssh рдПрдХреНрд╕реЗрд╕ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rjeka/kubernetes-ceph-percona.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p>  рдорд╛рд╕реНрдЯрд░реНрд╕ рдЧреНрд░реБрдк рдореЗрдВ, рдЖрдИрдкреА рдорд╛рд╕реНрдЯрд░реНрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВред <br>  etcd_version, etcd рдХрд╛ рд╕рдВрд╕реНрдХрд░рдг рд╣реИред  рдЖрдк рдЗрд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреАрдердм</a> рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрдВрдХрдб рдкреГрд╖реНрда</a> рдкрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдЦрди рдХреЗ рд╕рдордп, рд╕рдВрд╕реНрдХрд░рдг v3.3.13 рдерд╛ рдореИрдВ v3.3.10 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реВрдВред <br>  etcdToken - рдЖрдк рдПрдХ рд╣реА рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br>  рдкреНрд▓реЗрдмреБрдХ рдЯреАрдо рдЪрд▓рд╛рдПрдВ </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sudo c  ansible-playbook -i hosts.ini -l masters etcd.yaml -K BECOME password: &lt;sudo &gt; # sudo  ansible-playbook -i hosts.ini -l masters etcd.yaml</span></span></code> </pre> </div></div><br><p>  рдпрджрд┐ рдЖрдк dod рдореЗрдВ etcd рдЪрд▓рд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╕реНрдкреЙрдЗрд▓рд░ рдХреЗ рдиреАрдЪреЗ рдПрдХ рдирд┐рд░реНрджреЗрд╢ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">Docker- рдХрдореНрдкреЛрдЬрд╝ рдХреЗ рд╕рд╛рде etcd рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, docker рдореЗрдВ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ</b> <div class="spoiler_text"><p>  рдЗрди рдЖрджреЗрд╢реЛрдВ рдХреЛ рд╕рднреА рдХреНрд▓рд╕реНрдЯрд░ рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br>  рдЧрд┐рддреБрдм рдХреЗ рд╕рд╛рде, рд╣рдо рдХреЛрдб рдХреЗ рд╕рд╛рде рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдХреНрд▓реЛрди рдХрд░рддреЗ рд╣реИрдВ </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rjeka/kubernetes-ceph-percona.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ceph-percona</code> </pre> <br><p>  etcd_version, etcd рдХрд╛ рд╕рдВрд╕реНрдХрд░рдг рд╣реИред  рдЖрдк рдЗрд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреАрдердм</a> рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрдВрдХрдб рдкреГрд╖реНрда</a> рдкрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдЦрди рдХреЗ рд╕рдордп, рд╕рдВрд╕реНрдХрд░рдг v3.3.13 рдерд╛ рдореИрдВ v3.3.10 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реВрдВред <br>  etcdToken - рдЖрдк рдПрдХ рд╣реА рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд╣рдордиреЗ рдбреЙрдХрдЯрд░-рдХрдВрдкреЛрдЬ рдХрд┐рдпрд╛ </p><br><pre> <code class="plaintext hljs">apt-get install -y docker-compose</code> </pre> <br><p>  рд╣рдо рдПрдХ рд╡рд┐рдиреНрдпрд╛рд╕ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">./create-config.sh docker</code> </pre> <br><p>  рдбреЙрдХ рдореЗрдВ etcd рдХреНрд▓рд╕реНрдЯрд░ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдЪрд▓рд╛рдПрдБ </p><br><pre> <code class="plaintext hljs">docker-compose --file etcd-docker/docker-compose.yaml up -d</code> </pre> <br><p>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХрдВрдЯреЗрдирд░ рдКрдкрд░ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">docker ps</code> </pre> <br><p>  рдФрд░ рдХреНрд▓рд╕реНрдЯрд░ рд╕реНрдерд┐рддрд┐ etcd </p><br><pre> <code class="plaintext hljs">root@master01:~/kubernetes-ceph-percona# docker exec -ti etcd etcdctl cluster-health member 61db137992290fc is healthy: got healthy result from http://10.73.71.27:2379 member b11e73358a31b109 is healthy: got healthy result from http://10.73.71.25:2379 member f67dd9aaa8a44ab9 is healthy: got healthy result from http://10.73.71.26:2379 cluster is healthy root@master01:~/kubernetes-ceph-percona# docker exec -ti etcd etcdctl member list 61db137992290fc: name=etcd3 peerURLs=http://10.73.71.27:2380 clientURLs=http://10.73.71.27:2379,http://10.73.71.27:4001 isLeader=false b11e73358a31b109: name=etcd1 peerURLs=http://10.73.71.25:2380 clientURLs=http://10.73.71.25:2379,http://10.73.71.25:4001 isLeader=true f67dd9aaa8a44ab9: name=etcd2 peerURLs=http://10.73.71.26:2380 clientURLs=http://10.73.71.26:2379,http://10.73.71.26:4001 isLeader=false</code> </pre> <br><p>  рдЕрдЧрд░ рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖ </p><br><pre> <code class="plaintext hljs">docker logs etcd</code> </pre> </div></div><br><a name="master-one"></a><br><h2>  рдкрд╣рд▓рд╛ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╡рд┐рдЬрд╝рд╛рд░реНрдб рд▓реЙрдиреНрдЪ рдХрд░рдирд╛ </h2><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдХреБрдмреЗрджрдорд┐рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдиреНрдпрд╛рд╕ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </p><br><pre> <code class="plaintext hljs">./create-config.sh kubeadm</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд╣рдо kubeadm рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ рдЕрд▓рдЧ рдХрд░рддреЗ рд╣реИрдВ</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">apiVersion: kubeadm.k8s.io/v1beta1 kind: InitConfiguration localAPIEndpoint: advertiseAddress: 10.73.71.25 #    API- --- apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration kubernetesVersion: stable #      apiServer: #    kubeadm   certSANs: - 127.0.0.1 - 10.73.71.25 - 10.73.71.26 - 10.73.71.27 controlPlaneEndpoint: 10.73.71.25 #     etcd: #  etc external: endpoints: - http://10.73.71.25:2379 - http://10.73.71.26:2379 - http://10.73.71.27:2379 networking: podSubnet: 192.168.0.0/16 #   ,   CNI  .</code> </pre> <br><p>  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯ рдХреЗ рдкреНрд░рд▓реЗрдЦрди</a> рдореЗрдВ рд╕реАрдПрдирдЖрдИ рд╕рдмрдиреЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрдврд╝</a> рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВред</a> <br>  рдпрд╣ рдиреНрдпреВрдирддрдо рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реИред  рддреАрди рд╡рд┐рдЬрд╝рд╛рд░реНрдб рд╡рд╛рд▓реЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЗрд╕реЗ рдЕрдкрдиреЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк 2 рдЬрд╛рджреВрдЧрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдмрд╕ рджреЛ рдкрддреЗ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░реЗрдВред <br>  рд╕рднреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЙрдиреНрдлрд┐рдб</a> рдкреИрд░рд╛рдореАрдЯрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреЛ рдХреБрдмреЗрджрдо рдПрдкреАрдЖрдИ рд╡рд┐рд╡рд░рдг</a> рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p></div></div><br><p>  рд╣рдо рдкрд╣рд▓реЗ рдЧреБрд░реБ рдХреЛ рджреАрдХреНрд╖рд╛ рджреЗрддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">kubeadm init --config=kubeadmin/kubeadm-init.yaml</code> </pre> <br><p>  рдпрджрд┐ рдХреБрдмреЗрджрдо рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рд╣рдореЗрдВ рд▓рдЧрднрдЧ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрдЙрдЯрдкреБрдЯ рдорд┐рд▓рддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">You can now join any number of control-plane nodes by copying certificate authorities and service account keys on each node and then running the following as root: kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3 \ --control-plane Then you can join any number of worker nodes by running the following on each as root: kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3</code> </pre> <br><a name="callica"></a><br><h2>  CNI рдХреИрд▓рд┐рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди </h2><br><p>  рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдЖ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рдорд╛рд░реА рдлрд▓реА рдХрд╛рдо рдХрд░реЗрдЧреАред  рдореИрдВ рдХреИрд▓рд┐рдХреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ, рдФрд░ рд╣рдо рдЗрд╕реЗ рдбрд╛рд▓ рджреЗрдВрдЧреЗред <br>  рдФрд░ рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП, рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдВрдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВред  рд╣рдо рдорд╛рд╕реНрдЯрд░ 01 рдкрд░ рд╕рднреА рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ <br>  рдпрджрд┐ рдЖрдк рдЬрдбрд╝ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">export KUBECONFIG=/etc/kubernetes/admin.conf</code> </pre> <br><p>  рдпрджрд┐ рд╕рд░рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рддрд╣рдд рд╕реЗ </p><br><pre> <code class="plaintext hljs">mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config</code> </pre> <br><p>  рдЖрдк рдЕрдкрдиреЗ рд▓реИрдкрдЯреЙрдк рдпрд╛ рдХрд┐рд╕реА рд╕реНрдерд╛рдиреАрдп рдорд╢реАрди рд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП /etc/kubernetes/admin.conf рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЕрдкрдиреЗ рд▓реИрдкрдЯреЙрдк рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдорд╢реАрди рдореЗрдВ $ HOME / .kube / config рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдВред </p><br><p>  рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдкреНрд░рд▓реЗрдЦрди рдХреЗ рдЕрдиреБрд╕рд╛рд░</a> рд╕реАрдПрдирдЖрдИ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбрд╛рд▓рддреЗ рд╣реИрдВ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><br></a> </p><br><pre> <code class="plaintext hljs">kubectl apply -f https://docs.projectcalico.org/v3.8/manifests/calico.yaml</code> </pre> <br><p>  рд╣рдо рд╕рднреА рдлрд▓реА рдЙрдардиреЗ рддрдХ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">watch -n1 kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-59f54d6bbc-psr2z 1/1 Running 0 96s kube-system calico-node-hm49z 1/1 Running 0 96s kube-system coredns-5c98db65d4-svcx9 1/1 Running 0 77m kube-system coredns-5c98db65d4-zdlb8 1/1 Running 0 77m kube-system kube-apiserver-master01 1/1 Running 0 76m kube-system kube-controller-manager-master01 1/1 Running 0 77m kube-system kube-proxy-nkdqn 1/1 Running 0 77m kube-system kube-scheduler-master01 1/1 Running 0 77m</code> </pre> <br><a name="mastes-other"></a><br><h2>  рджреВрд╕рд░реЗ рдФрд░ рддреАрд╕рд░реЗ kubernetes рдЬрд╛рджреВрдЧрд░ рдХрд╛ рд╢реБрднрд╛рд░рдВрдн </h2><br><p>  Master02 рдФрд░ Master03 рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдорд╛рд╕реНрдЯрд░ 01 рдХреЗ рд╕рд╛рде рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рддреЗ рд╕рдордп рдЙрддреНрдкрдиреНрди рдХреБрдмреЗрджрдоред  рдореИрдВ scp рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЙрдкреА рдХрд░реВрдБрдЧрд╛ <br>  рдорд╛рд╕реНрдЯрд░ 01 рдкрд░ </p><br><pre> <code class="plaintext hljs">export master02=10.73.71.26 export master03=10.73.71.27 scp -r /etc/kubernetes/pki $master02:/etc/kubernetes/ scp -r /etc/kubernetes/pki $master03:/etc/kubernetes/</code> </pre> <br><p>  рдорд╛рд╕реНрдЯрд░ режреи рдФрд░ рдорд╛рд╕реНрдЯрд░ режрей рдкрд░ <br>  рдХреБрдмреЗрджрдо рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдиреНрдпрд╛рд╕ рдмрдирд╛рдПрдБ </p><br><pre> <code class="plaintext hljs">./create-config.sh kubeadm</code> </pre> <br><p>  рдФрд░ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ Master02 рдФрд░ master03 рдЬреЛрдбрд╝реЗрдВ </p><br><pre> <code class="plaintext hljs">kubeadm init --config=kubeadmin/kubeadm-init.yaml</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдХрдИ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдкрд░ рдЧреНрд▓рд┐рдЯреНрд╕ !!!!</b> <div class="spoiler_text"><p>  рдЙрддреНрдкрд╛рджрди рдореЗрдВ, рдореИрдВ kubernetes v1.13.5 рдФрд░ calico v3.3 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред  рдФрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдРрд╕реЗ рдЧреНрд▓рд┐рд╕реЗрд╕ рдирд╣реАрдВ рдереЗред <br>  рд▓реЗрдХрд┐рди рд▓реЗрдЦ рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╕рдордп рдФрд░ рд╕реНрдерд┐рд░ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп (рдпрд╣ рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕рдордп v1.15.1 рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдФрд░ рд╕рдВрд╕реНрдХрд░рдг 3.8 рдХреЙрд▓рд┐рдХреЛ рдерд╛), рдореИрдВ рдПрдХ рд╕рдорд╕реНрдпрд╛ рдореЗрдВ рднрд╛рдЧ рдЧрдпрд╛ рдерд╛ рдЬрд┐рд╕реЗ рд╕реАрдПрдирдЖрдИ рд╢реБрд░реВ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдореЗрдВ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ </p><br><pre> <code class="plaintext hljs">root@master01:~/kubernetes-ceph-percona# kubectl get pods -A -w NAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-658558ddf8-t6gfs 0/1 ContainerCreating 0 11s kube-system calico-node-7td8g 1/1 Running 0 11s kube-system calico-node-dthg5 0/1 CrashLoopBackOff 1 11s kube-system calico-node-tvhkq 0/1 CrashLoopBackOff 1 11s</code> </pre> <br><p>  рдпрд╣ рдПрдХ рдХреИрд▓реАрдХреЛ рдбреЗрдореЙрди рд╕реЗрдЯ рдЧрдбрд╝рдмрдбрд╝ рд╣реИ рдЬрдм рд╕рд░реНрд╡рд░ рдореЗрдВ рдХрдИ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рд╣реЛрддреЗ рд╣реИрдВ <br>  рдЧреАрдердм рдкрд░ рдЗрд╕ рдЧрдбрд╝рдмрдбрд╝ рдкрд░ рдПрдХ рдореБрджреНрджрд╛ рд╣реИ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/projectcalico/calico/issues/2720</a> <br>  рдпрд╣ рдбреЗрдорди рд╕реЗрдЯ рдХреИрд▓рд┐рдХреЛ-рдиреЛрдб рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рдФрд░ en_ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IP_AUTODETECTION_METHOD рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </p><br><pre> <code class="plaintext hljs">kubectl edit -n kube-system ds calico-node</code> </pre> <br><p>  рдЕрдкрдиреЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдирд╛рдо рдХреЗ рд╕рд╛рде IP_AUTODETECTION_METHOD рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВ, рдЬрд┐рд╕ рдкрд░ рд╡рд┐рдЬрд╝рд╛рд░реНрдб рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ;  рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд 19 рд╣реИ </p><br><pre> <code class="plaintext hljs">- name: IP_AUTODETECTION_METHOD value: ens19</code> </pre> <br><p><img src="https://habrastorage.org/webt/xe/pq/7h/xepq7hbpjwhgowfk0hkc6-ryw8a.png"><br>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╕рднреА рдиреЛрдбреНрд╕ рдКрдкрд░ рдФрд░ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs"># kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 28m v1.15.1 master02 Ready master 26m v1.15.1 master03 Ready master 18m v1.15.1</code> </pre> <br><p>  рдФрд░ рдЬрд┐рдВрджрд╛ рдХреИрд▓рд┐рдХрд╛ рдХреНрдпрд╛ рд╣реИ </p><br><pre> <code class="plaintext hljs"># kubectl get pods -A -o wide | grep calico kube-system calico-kube-controllers-59f54d6bbc-5lxgn 1/1 Running 0 27m kube-system calico-node-fngpz 1/1 Running 1 24m kube-system calico-node-gk7rh 1/1 Running 0 8m55s kube-system calico-node-w4xtt 1/1 Running 0 25m</code> </pre> </div></div><br><a name="worknodes"></a><br><h2>  рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╡рд░реНрдХрд░ рдиреЛрдбреНрд╕ рдЬреЛрдбрд╝реЗрдВ </h2><br><p>  рдлрд┐рд▓рд╣рд╛рд▓, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рддреАрди рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдЪрд▓ рд░рд╣реЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдорд╢реАрди рд╣реИрдВ рдЬреЛ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдХреА рдПрдкреАрдЖрдИ, рд╢реЗрдбреНрдпреВрд▓рд░ рдФрд░ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдПрдВ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВред  рддрд╛рдХрд┐ рд╣рдо рдЕрдкрдиреА рдкреЙрдбреНрд╕ рдЪрд▓рд╛ рд╕рдХреЗрдВ, рд╣рдореЗрдВ рддрдерд╛рдХрдерд┐рдд рд╢реНрд░рдорд┐рдХ рдиреЛрдбреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br>  рдпрджрд┐ рдЖрдк рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рд╕реАрдорд┐рдд рд╣реИрдВ, рддреЛ рдЖрдк рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдкрд░ рдкреЙрдб рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЗрдХрд┐рди рдореИрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдРрд╕рд╛ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реВрдВред </p><br><div class="spoiler">  <b class="spoiler_title">рдорд╛рд╕реНрдЯрд░реНрдиреЛрдбреНрд╕ рдкрд░ рдЪреВрд▓реНрд╣рд╛ рдЪрд▓рд╛рдирд╛</b> <div class="spoiler_text"><p>  рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдкрд░ рдЪреВрд▓реНрд╣рд╛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рдХрд┐рд╕реА рднреА рд╕реНрд╡рд╛рдореА рдкрд░ рдирд┐рдореНрди рдЖрджреЗрд╢ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ </p><br><pre> <code class="plaintext hljs">kubectl taint nodes --all node-role.kubernetes.io/master-</code> </pre> </div></div><br><p>  рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдкрд░ рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреБрдмреЗрджрдо, рдХреБрдмреЗрдЯреЗрд▓ рдФрд░ рдбреЙрдХ рдиреЛрдб рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </p><br><div class="spoiler">  <b class="spoiler_title">рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреБрдмреЗрджрдо, рдХреБрдмреЗрдЯреЗрд▓ рдФрд░ рдбреЙрдХрдЯрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF apt-get update apt-get install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl</code> </pre> <br><h4>  рдбреЙрдХрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ</a> рдЕрдиреБрд╕рд╛рд░ рдбреЙрдХрдЯрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><br></a> </p><br><pre> <code class="plaintext hljs">apt-get remove docker docker-engine docker.io containerd runc apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</code> </pre> <br><pre> <code class="plaintext hljs">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - apt-key fingerprint 0EBFCD88</code> </pre> <br><pre> <code class="plaintext hljs">add-apt-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable"</code> </pre> <br><pre> <code class="plaintext hljs">apt-get update apt-get install docker-ce docker-ce-cli containerd.io</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдерд╛рдкрдирд╛ рд╕реНрдерд╛рдкрд┐рдд рдХреНрдпреВрдмрд▓реЗрдЯ, рдХреБрдмреЗрдХрд▓, рдХреБрдмреЗрджрдо рдФрд░ рдбреЙрдХрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдРрд╕рд┐рдмрд▓</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p>  рдорд╛рд╕реНрдЯрд░реНрд╕ рдЧреНрд░реБрдк рдореЗрдВ, рдЖрдИрдкреА рдорд╛рд╕реНрдЯрд░реНрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВред <br>  рд╢реНрд░рдорд┐рдХ рд╕рдореВрд╣ рдореЗрдВ, рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдбреНрд╕ рдХрд╛ рдЖрдИрдкреА рд▓рд┐рдЦреЗрдВред </p><br><pre> <code class="plaintext hljs"># sudo c  ansible-playbook -i hosts.ini kubelet.yaml -K ansible-playbook -i hosts.ini docker.yaml -K # sudo  ansible-playbook -i hosts.ini kubelet.yaml ansible-playbook -i hosts.ini docker.yaml</code> </pre> </div></div></div></div><br><p>  рдЕрдм рдЙрд╕ рд▓рд╛рдЗрди рдкрд░ рд▓реМрдЯрдиреЗ рдХрд╛ рд╕рдордп рдЖ рдЧрдпрд╛ рд╣реИ рдЬрдм рд╣рдордиреЗ рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдерд╛ред <br>  рд╡рд╣ рдореЗрд░реЗ рд▓рд┐рдП рдРрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3</code> </pre> <br><p>  рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЛрдб рдкрд░ рдЗрд╕ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред <br>  рдпрджрд┐ рдЖрдкрдиреЗ рдЯреЛрдХрди рдирд╣реАрдВ рд▓рд┐рдЦрд╛ рд╣реИ, рддреЛ рдЖрдк рдПрдХ рдирдпрд╛ рдЬрдирд░реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">kubeadm token create --print-join-command --ttl=0</code> </pre> <br><p>  рдХреБрдмреЗрджрд╛рдо рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдкрдХрд╛ рдирдпрд╛ рдиреЛрдб рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ </p><br><pre> <code class="plaintext hljs">This node has joined the cluster: * Certificate signing request was sent to apiserver and a response was received. * The Kubelet was informed of the new secure connection details. Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</code> </pre> <br><p>  рдЕрдм рд╣рдо рдкрд░рд┐рдгрд╛рдо рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">root@master01:~# kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 10d v1.15.1 master02 Ready master 10d v1.15.1 master03 Ready master 10d v1.15.1 worknode01 Ready &lt;none&gt; 5m44s v1.15.1 worknode02 Ready &lt;none&gt; 59s v1.15.1 worknode03 Ready &lt;none&gt; 51s v1.15.1</code> </pre> <br><a name="haproxy"></a><br><h2>  рд╡рд░реНрдХрдкреНрд░реЛрдбреНрд╕ рдкрд░ рд╣рд╛рдЗрдкреЛрдХреНрд╕реА рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h2><br><p>  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рддреАрди рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдФрд░ рддреАрди рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдХрд╛рд░реНрдпрд╢реАрд▓ рдХреНрд▓рд╕реНрдЯрд░ рд╣реИред <br>  рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЕрдм рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЛрдбреНрд╕ рдореЗрдВ рд╣рд╛ рдореЛрдб рдирд╣реАрдВ рд╣реИред <br>  рдпрджрд┐ рдЖрдк рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЙрдиреНрдлрд┐рдЧ рдлрд╛рдЗрд▓ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рд╣рдорд╛рд░рд╛ рд╡рд░реНрдХрд░ рдиреЛрдб рдХреЗрд╡рд▓ рддреАрди рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">root@worknode01:~# cat /etc/kubernetes/kubelet.conf | grep server: server: https://10.73.71.27:6443</code> </pre> <br><p>  рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдорд╛рд╕реНрдЯрд░ 03 рд╣реИред  рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╕рд╛рде, рдпрджрд┐ Master03 рдХреНрд░реИрд╢ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡рд░реНрдХрд░ рдиреЛрдб рдХреНрд▓рд╕реНрдЯрд░ API рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдЦреЛ рджреЗрдЧрд╛ред  рд╣рдорд╛рд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╣рд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрдХрд░ рдкрд░ рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ (рд╣рд╛рдкреНрд░реЛрд╕реА) рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЬреЛ рдХрд┐ рд░рд╛рдЙрдВрдб рд░реЙрдмрд┐рди рдХреЗ рдЕрдиреБрд╕рд╛рд░, рддреАрди рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рддрд┐рддрд░ рдмрд┐рддрд░ рдХрд░реЗрдЧрд╛, рдФрд░ рд╡рд░реНрдХрд░ рдиреЛрдбреНрд╕ рдкрд░ рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд╣рдо рд╕рд░реНрд╡рд░ рдПрдбреНрд░реЗрд╕ рдХреЛ 127.0.0.1:6443 рдкрд░ рдмрджрд▓ рджреЗрдВрдЧреЗред <br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкреНрд░рддреНрдпреЗрдХ рд╢реНрд░рдорд┐рдХ рдиреЛрдб рдкрд░ HAProxy рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдЪреНрдЫрд╛ рдзреЛрдЦрд╛ рдкрддреНрд░ рд╣реИ</a> </p><br><pre> <code class="plaintext hljs">curl https://haproxy.debian.net/bernat.debian.org.gpg | \ apt-key add - echo deb http://haproxy.debian.net stretch-backports-2.0 main | \ tee /etc/apt/sources.list.d/haproxy.list apt-get update apt-get install haproxy=2.0.\*</code> </pre> <br><p>  HAproxy рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br>  рдпрджрд┐ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдиреЛрдбреНрд╕ рдкрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдИ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдЗрд╕реЗ рдХреНрд▓реЛрди рдХрд░рддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/</code> </pre> <br><p>  рдФрд░ haproxy рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдПрдБ </p><br><pre> <code class="plaintext hljs">./create-config.sh haproxy</code> </pre> <br><p>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдФрд░ haproxy рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдЧрд╛ред <br>  рдЬрд╛рдБрдЪреЗрдВ рдХрд┐ haproxy рдиреЗ рдкреЛрд░реНрдЯ 6443 рдХреЛ рд╕реБрдирдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ред </p><br><pre> <code class="plaintext hljs">root@worknode01:~/kubernetes-ceph-percona# netstat -alpn | grep 6443 tcp 0 0 127.0.0.1:6443 0.0.0.0:* LISTEN 30675/haproxy tcp 0 0 10.73.75.241:6443 0.0.0.0:* LISTEN 30675/haproxy</code> </pre> <br><p>  рдЕрдм рд╣рдореЗрдВ рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдХреЗ рдмрдЬрд╛рдп рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЛ рдмрддрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рднреА рд╡рд░реНрдХрд░ рдиреЛрдбреНрд╕ рдкрд░ /etc/kubernetes/kubelet.conf рдФрд░ /etc/kubernetes/bootstrap-kubelet.conf рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕рд░реНрд╡рд░ рдорд╛рди рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВред </p><br><pre> <code class="plaintext hljs">vim /etc/kubernetes/kubelet.conf vim nano /etc/kubernetes/bootstrap-kubelet.conf</code> </pre> <br><p>  рд╕рд░реНрд╡рд░ рдХрд╛ рдорд╛рди рдЗрд╕ рд░реВрдк рдореЗрдВ рд▓реЗрдирд╛ рдЪрд╛рд╣рд┐рдП: </p><br><pre> <code class="plaintext hljs">server: https://127.0.0.1:6443</code> </pre> <br><p>  рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдХреНрдпреВрдмрд▓реЗрдЯ рдФрд░ рдбреЙрдХрдЯрд░ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВ </p><br><pre> <code class="plaintext hljs">systemctl restart kubelet &amp;&amp; systemctl restart docker</code> </pre> <br><p>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕рднреА рдиреЛрдб рдареАрдХ рд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред </p><br><pre> <code class="plaintext hljs">kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 29m v1.15.1 master02 Ready master 27m v1.15.1 master03 Ready master 26m v1.15.1 worknode01 Ready &lt;none&gt; 25m v1.15.1 worknode02 Ready &lt;none&gt; 3m15s v1.15.1 worknode03 Ready &lt;none&gt; 3m16s v1.15.1</code> </pre> <br><p>  рдЕрдм рддрдХ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣рд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдХреЛрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдкрд╣рд▓реЗ рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдкрд░ рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░рд╛ рдХреНрд▓рд╕реНрдЯрд░ рдЪрд╛рд▓реВ рд╣реИред </p><br><pre> <code class="plaintext hljs">systemctl stop kubelet &amp;&amp; systemctl stop docker</code> </pre> <br><p>  рджреВрд╕рд░реЗ рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рд╕реЗ рдЬрд╛рдВрдЪреЗрдВ </p><br><pre> <code class="plaintext hljs">root@master02:~# kubectl get nodes NAME STATUS ROLES AGE VERSION master01 NotReady master 15h v1.15.1 master02 Ready master 15h v1.15.1 master03 Ready master 15h v1.15.1 worknode01 Ready &lt;none&gt; 15h v1.15.1 worknode02 Ready &lt;none&gt; 15h v1.15.1 worknode03 Ready &lt;none&gt; 15h v1.15.1</code> </pre> <br><p>  рд╕рднреА рдиреЛрдбреНрд╕ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕ рдкрд░ рд╣рдордиреЗ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рд╣реИред <br>  рдкрд╣рд▓реЗ рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛ </p><br><pre> <code class="plaintext hljs">systemctl start kubelet &amp;&amp; systemctl start docker</code> </pre> <br><a name="ingress"></a><br><h2>  рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдирд┐рдпрдВрддреНрд░рдХ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h2><br><p>  рдЗрдирдЧреНрд░реЗрдб рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдРрдб-рдСрди рд╣реИ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рд╣рдо рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдмрд╛рд╣рд░ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдкреНрд░рд▓реЗрдЦрди рдореЗрдВ рд╣реИ</a> ред  рд╡рд╣рд╛рдБ рдХрд╛рдлреА рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдХреЗ рдкреНрд░рд╡реЗрд╢ рд╣реИрдВ, рдореИрдВ Nginx рд╕реЗ рдПрдХ рдирд┐рдпрдВрддреНрд░рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред  рдореИрдВ рдЗрд╕рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛ред  Nginx рд╕реЗ Ingress рдХрдВрдЯреНрд░реЛрд▓рд░ рдХреЗ рдСрдкрд░реЗрд╢рди, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдкрд░ рдкреНрд░рд▓реЗрдЦрди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ</a> рдкрд░ рдкрдврд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </p><br><p>  рдЪрд▓реЛ рд╕реНрдерд╛рдкрдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рд╕рднреА рдХрдорд╛рдВрдб рдорд╛рд╕реНрдЯрд░ 01 рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред <br>  рдирд┐рдпрдВрддреНрд░рдХ рд╕реНрд╡рдпрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </p><br><pre> <code class="plaintext hljs">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/mandatory.yaml</code> </pre> <br><p>  рдФрд░ рдЕрдм - рдПрдХ рд╕реЗрд╡рд╛ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╡реЗрд╢ рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ <br>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рддреИрдпрд╛рд░ рдХрд░реЗрдВ </p><br><pre> <code class="plaintext hljs">./create-config.sh ingress</code> </pre> <br><p>  рдФрд░ рдЗрд╕реЗ рд╣рдорд╛рд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рднреЗрдЬреЗрдВ </p><br><pre> <code class="plaintext hljs">kubectl apply -f ingress/service-nodeport.yaml</code> </pre> <br><p>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╣рдорд╛рд░рд╛ рдЗрдирдЧреНрд░реЗрдб рд╕рд╣реА рдкрддреЗ рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рд╣реА рдкреЛрд░реНрдЯ рдкрд░ рд╕реБрдирддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs"># kubectl get svc -n ingress-nginx NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE ingress-nginx NodePort 10.99.35.95 10.73.71.25,10.73.71.26,10.73.71.27 80:31669/TCP,443:31604/TCP 10m</code> </pre> <br><pre> <code class="plaintext hljs"> kubectl describe svc -n ingress-nginx ingress-nginx Name: ingress-nginx Namespace: ingress-nginx Labels: app.kubernetes.io/name=ingress-nginx app.kubernetes.io/part-of=ingress-nginx Annotations: kubectl.kubernetes.io/last-applied-configuration: {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"labels":{"app.kubernetes.io/name":"ingress-nginx","app.kubernetes.io/par... Selector: app.kubernetes.io/name=ingress-nginx,app.kubernetes.io/part-of=ingress-nginx Type: NodePort IP: 10.99.35.95 External IPs: 10.73.71.25,10.73.71.26,10.73.71.27 Port: http 80/TCP TargetPort: 80/TCP NodePort: http 31669/TCP Endpoints: 192.168.142.129:80 Port: https 443/TCP TargetPort: 443/TCP NodePort: https 31604/TCP Endpoints: 192.168.142.129:443 Session Affinity: None External Traffic Policy: Cluster Events: &lt;none&gt;</code> </pre> <br><a name="dashboard"></a><br><h2>  рд╡реЗрдм UI (рдбреИрд╢рдмреЛрд░реНрдб) рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h2><br><p>  рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рдкрд╛рд╕ рдПрдХ рдорд╛рдирдХ рд╡реЗрдм рдпреВрдЖрдИ рд╣реИ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрднреА-рдХрднреА рдХреНрд▓рд╕реНрдЯрд░ рдпрд╛ рдЗрд╕рдХреЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рджреЗрдЦрдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрддрд╛ рд╣реИред  рдЕрдкрдиреЗ рдХрд╛рдо рдореЗрдВ, рдореИрдВ рдЕрдХреНрд╕рд░ рддреИрдирд╛рддреА рдХреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдирд┐рджрд╛рди рдпрд╛ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдбреИрд╢рдмреЛрд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред <br>  рдкреНрд░рд▓реЗрдЦрди рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╛рдЗрдЯ kubernetes рдкрд░ рд╣реИ</a> <br>  рд╕реНрдерд╛рдкрдирд╛ред  рдореИрдВ рд╕реНрдерд┐рд░ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реВрдВ, рдореИрдВрдиреЗ рдЕрднреА рддрдХ 2.0 рдХреА рдХреЛрд╢рд┐рд╢ рдирд╣реАрдВ рдХреА рд╣реИред </p><br><pre> <code class="plaintext hljs">#  kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml # 2.0 kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta1/aio/deploy/recommended.yaml</code> </pre> <br><p>  рд╣рдордиреЗ рдЕрдкрдиреЗ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдкреИрдирд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдкреИрдирд▓ рдЙрдкрд▓рдмреНрдз рд╣реЛ рдЧрдпрд╛ </p><br><pre> <code class="plaintext hljs">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/.</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреБрдмреНрд▓реЗрдЯ рдкреНрд░реЙрдХреНрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдерд╛рдиреАрдп рдорд╢реАрди рд╕реЗ рдкреЛрд░реНрдЯ рдХреЛ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдореЗрд░реЗ рд▓рд┐рдП, рдпрд╣ рдпреЛрдЬрдирд╛ рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдирд╣реАрдВ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдореИрдВ рдирд┐рдпрдВрддреНрд░рдг рдХрдХреНрд╖ рдХреА рд╕реЗрд╡рд╛ рдХреЛ рдмрджрд▓ рджреВрдВрдЧрд╛ рддрд╛рдХрд┐ рдбреИрд╢рдмреЛрд░реНрдб 30443 рдкреЛрд░реНрдЯ рдкрд░ рдХрд┐рд╕реА рднреА рдХреНрд▓рд╕реНрдЯрд░ рдиреЛрдб рдХреЗ рдкрддреЗ рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реЛ рдЬрд╛рдПред рдбреИрд╢рдмреЛрд░реНрдб рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ рдЕрднреА рднреА рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреНрд░рд╡реЗрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред  рд╢рд╛рдпрдж рдореИрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рдХрд╛рд╢рдиреЛрдВ рдореЗрдВ рдЗрд╕ рд╡рд┐рдзрд┐ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реВрдВрдЧрд╛ред <br>  рд╕реЗрд╡рд╛ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╕реЗрд╡рд╛ рдХреА рддреИрдирд╛рддреА рдЪрд▓рд╛рдПрдБ </p><br><pre> <code class="plaintext hljs">kubectl apply -f dashboard/service-nodeport.yaml</code> </pre> <br><p>  рдпрд╣ рдбреИрд╢рдмреЛрд░реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдЯреЛрдХрди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╣реБрдЖ рд╣реИ </p><br><pre> <code class="plaintext hljs">kubectl apply -f dashboard/rbac.yaml kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')</code> </pre> <br><p>  рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдХрдВрдЯреНрд░реЛрд▓ рдкреИрдирд▓ рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://10.73.71.25:30443</a> рдкрд░ рд▓реЙрдЧ рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <br><img src="https://habrastorage.org/webt/p7/zu/8q/p7zu8qv47mwdsmdydtvyo7gs_y4.png"><br>  рдбреИрд╢рдмреЛрд░реНрдб рд╣реЛрдо рд╕реНрдХреНрд░реАрди <br><img src="https://habrastorage.org/webt/h2/ks/jq/h2ksjq_7egqatf4ulnl0zkwqvqk.png"></p><br><p>  рдмрдзрд╛рдИ!  рдпрджрд┐ рдЖрдк рдЗрд╕ рдЪрд░рдг рдкрд░ рдкрд╣реБрдВрдЪ рдЧрдП рд╣реИрдВ, рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣рд╛рдмрд░реНрд╕ рдСрдл рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╣реИрдВ, рдЬреЛ рдЖрдкрдХреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреА рддреИрдирд╛рддреА рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИред <br> Kubernetes    ,      .          . <br>       ,  GitHub,    ,    . <br> C ,  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi462473/">https://habr.com/ru/post/hi462473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi462461/index.html">GOES-17 рдХреНрд░реИрд╢ рдЬрд╛рдВрдЪ рдкрд░рд┐рдгрд╛рдо</a></li>
<li><a href="../hi462465/index.html">Apple рдХреЗ рдореВрд▓ рд╕реНрдерд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛</a></li>
<li><a href="../hi462467/index.html">рдлреНрд░рдВрдЯреЗрдВрдб рд╡реАрдХрд▓реА рдбрд╛рдЗрдЬреЗрд╕реНрдЯ (29 рдЬреБрд▓рд╛рдИ - 4 рдЕрдЧрд╕реНрдд, 2019)</a></li>
<li><a href="../hi462469/index.html">"рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ" рдЯрд╛рд╕реНрдХ рдХреЗ рд▓рд┐рдП рдЖрд░ рдореЗрдВ рд╕рдорд╡рд░реНрддреА рдХрдореНрдкреНрдпреВрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╡рд┐рдЪрд╛рд░</a></li>
<li><a href="../hi462471/index.html">Pwnable.kr 16 рдХреЗ рд╕рд╛рде рдПрдХ рдиреМрдХрд░реА рд╣рд▓ рдХрд░рдирд╛ - uafред рдореБрдХреНрдд рднреЗрджреНрдпрддрд╛ рдХреЗ рдмрд╛рдж рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</a></li>
<li><a href="../hi462475/index.html">рдПрд▓реЗрдХреНрд╕реА рд╕рд╡реЗрдЯреЗрд╡: рдЧрдгрд┐рдд рдХреА рдорджрдж рд╕реЗ рднреНрд░рд╖реНрдЯрд╛рдЪрд╛рд░ рд╕реЗ рдХреИрд╕реЗ рд▓рдбрд╝реЗрдВ (2016 рдХреЗ рд▓рд┐рдП рдЕрд░реНрдерд╢рд╛рд╕реНрддреНрд░ рдореЗрдВ рдиреЛрдмреЗрд▓ рдкреБрд░рд╕реНрдХрд╛рд░)</a></li>
<li><a href="../hi462477/index.html">рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рдПрдЖрдИ рдХреЛ рдПрдХ рдирдП рдкреЗрдЯреЗрдВрдЯ рдХреЗ рд▓реЗрдЦрдХ рдХреЗ рд░реВрдк рдореЗрдВ рджрд╛рд╡рд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдкреЗрдЯреЗрдВрдЯ рдХрд╛рдиреВрди рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ</a></li>
<li><a href="../hi462479/index.html">рд╕реНрдЯреАрдо рд╡рд┐рдВрдбреЛрдЬ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ 0day</a></li>
<li><a href="../hi462481/index.html">рд╕рд┐рд╕реНрдЯрдо рдПрдлрдПрдХреНрдпреВ рдЯрд╛рдЗрдк рдХрд░реЗрдВ</a></li>
<li><a href="../hi462483/index.html">рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ: рдПрдХ рдирд┐рд░рд╛рд▓рд╛ рдЦрд┐рд▓реМрдирд╛ рдЬреЛ рд╢реНрд░рдо рдЙрддреНрдкрд╛рджрдХрддрд╛ рдХреЛ рдорд╛рд░рддрд╛ рд╣реИред рднрд╛рдЧ 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>