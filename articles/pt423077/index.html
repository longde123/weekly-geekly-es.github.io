<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜï üëêüèæ üë®üèæ‚Äçü§ù‚Äçüë®üèΩ Guia do montador X86 para iniciantes üéπ üî´ üëÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Atualmente, raramente √© necess√°rio escrever em assembler puro, mas eu definitivamente recomendo isso para qualquer pessoa interessada em programa√ß√£o. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guia do montador X86 para iniciantes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423077/"> Atualmente, raramente √© necess√°rio escrever em assembler puro, mas eu definitivamente recomendo isso para qualquer pessoa interessada em programa√ß√£o.  Voc√™ ver√° as coisas de um √¢ngulo diferente, e as habilidades ser√£o √∫teis ao depurar o c√≥digo em outros idiomas. <br><br>  Neste artigo, escreveremos do zero uma calculadora de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nota√ß√£o polonesa reversa (RPN)</a> no assembler x86 puro.  Quando terminamos, podemos us√°-lo assim: <br><br><pre><code class="bash hljs">$ ./calc <span class="hljs-string"><span class="hljs-string">"32+6*"</span></span> <span class="hljs-comment"><span class="hljs-comment"># "(3+2)*6"    30</span></span></code> </pre> <br>  Todo o c√≥digo do artigo est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  √â bastante comentado e pode servir como material educacional para quem j√° conhece montador. <br><br>  Vamos come√ßar escrevendo o programa b√°sico <i>Hello world!</i>  para verificar as configura√ß√µes do ambiente.  Em seguida, passemos √†s chamadas do sistema, pilha de chamadas, quadros de pilha e a conven√ß√£o de chamadas x86.  Ent√£o, para praticar, escreveremos algumas fun√ß√µes b√°sicas no assembler x86 - e come√ßaremos a escrever uma calculadora RPN. <br><a name="habracut"></a><br>  Sup√µe-se que o leitor tenha alguma experi√™ncia em programa√ß√£o em C e conhecimentos b√°sicos de arquitetura de computadores (por exemplo, o que √© um registro de processador).  Como usaremos o Linux, voc√™ tamb√©m deve poder usar a linha de comando do Linux. <br><br><h1>  Configura√ß√£o do ambiente </h1><br>  Como j√° mencionado, usamos o Linux (64 bits ou 32 bits).  O c√≥digo acima n√£o funciona no Windows ou no Mac OS X. <br><br>  Para instala√ß√£o, voc√™ s√≥ precisa do vinculador GNU <code>ld</code> do <code>binutils</code> , que √© pr√©-instalado na maioria das distribui√ß√µes, e do montador NASM.  No Ubuntu e Debian, voc√™ pode instalar os dois com um comando: <br><br><pre> <code class="bash hljs">$ sudo apt-get install binutils nasm</code> </pre> <br>  Eu tamb√©m recomendaria manter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma tabela ASCII √†</a> m√£o. <br><br><h1>  Ol√° mundo! </h1><br>  Para verificar o ambiente, salve o seguinte c√≥digo no arquivo <code>calc.asm</code> : <br><br><pre> <code class="hljs 1c">;   <span class="hljs-built_in"><span class="hljs-built_in"></span></span> _start     ; . global _start ;   .rodata  <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ( <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ) ;   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  ,       section .rodata ;     hello_world.   NASM ;   ,   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  , ;  . <span class="hljs-number"><span class="hljs-number">0</span></span>xA =  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x0 =    hello_world: db <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xA, <span class="hljs-number"><span class="hljs-number">0</span></span>x0 ;   .text,     section .text _start: mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span>x04 ;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>   eax (<span class="hljs-number"><span class="hljs-number">0</span></span>x04 = write()) mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span>x1 ;   (<span class="hljs-number"><span class="hljs-number">1</span></span> =  , <span class="hljs-number"><span class="hljs-number">2</span></span> =  ) mov ecx, hello_world ;     mov edx, <span class="hljs-number"><span class="hljs-number">14</span></span> ;   int <span class="hljs-number"><span class="hljs-number">0</span></span>x80 ;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <span class="hljs-number"><span class="hljs-number">0</span></span>x80,   ;     mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span>x01 ; <span class="hljs-number"><span class="hljs-number">0</span></span>x01 = exit() mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-number"><span class="hljs-number">0</span></span> =   int <span class="hljs-number"><span class="hljs-number">0</span></span>x80</code> </pre> <br>  Coment√°rios explicam a estrutura geral.  Para obter uma lista de registros e instru√ß√µes gerais, consulte o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia do Montador x86</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Universidade da Virg√≠nia</a> .  Com uma discuss√£o mais aprofundada das chamadas do sistema, isso ser√° ainda mais necess√°rio. <br><br>  Os seguintes comandos coletam o arquivo assembler em um arquivo de objeto e, em seguida, compilam o arquivo execut√°vel: <br><br><pre> <code class="bash hljs">$ nasm -f elf_i386 calc.asm -o calc $ ld -m elf_i386 calc.o -o calc</code> </pre> <br>  Depois de iniciar, voc√™ dever√° ver: <br><br><pre> <code class="bash hljs">$ ./calc Hello world!</code> </pre> <br><h3>  Makefile </h3><br>  Esta √© uma parte opcional, mas voc√™ pode criar um <code>Makefile</code> para simplificar a constru√ß√£o e o layout no futuro.  Salve-o no mesmo diret√≥rio que <code>calc.asm</code> : <br><br><pre> <code class="hljs powershell">CFLAGS= <span class="hljs-operator"><span class="hljs-operator">-f</span></span> elf32 LFLAGS= <span class="hljs-literal"><span class="hljs-literal">-m</span></span> elf_i386 all: calc calc: calc.o ld <span class="hljs-variable"><span class="hljs-variable">$</span></span>(LFLAGS) calc.o <span class="hljs-literal"><span class="hljs-literal">-o</span></span> calc calc.o: calc.asm nasm <span class="hljs-variable"><span class="hljs-variable">$</span></span>(CFLAGS) calc.asm <span class="hljs-literal"><span class="hljs-literal">-o</span></span> calc.o clean: rm <span class="hljs-operator"><span class="hljs-operator">-f</span></span> calc.o calc .INTERMEDIATE: calc.o</code> </pre> <br>  Ent√£o, em vez das instru√ß√µes acima, apenas execute make. <br><br><h1>  Chamadas do sistema </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As chamadas do sistema Linux</a> dizem ao sistema operacional para fazer algo por n√≥s.  Neste artigo, usamos apenas duas chamadas do sistema: <code>write()</code> para escrever uma linha em um arquivo ou fluxo (no nosso caso, este √© um dispositivo de sa√≠da padr√£o e um erro padr√£o) e <code>exit()</code> para sair do programa: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> <span class="hljs-number"><span class="hljs-number">0x01</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> error_code) error_code -  <span class="hljs-number"><span class="hljs-number">0</span></span>         (  <span class="hljs-number"><span class="hljs-number">1</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> <span class="hljs-number"><span class="hljs-number">0x04</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd, char *string, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">length</span></span>) fd ‚Äî  <span class="hljs-number"><span class="hljs-number">1</span></span>   , <span class="hljs-number"><span class="hljs-number">2</span></span>      string ‚Äî      <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> ‚Äî    </code> </pre> <br>  As chamadas do sistema s√£o configuradas armazenando o n√∫mero de chamada do sistema no registro <code>eax</code> e, em seguida, seus argumentos em <code>ebx</code> , <code>ecx</code> , <code>edx</code> nessa ordem.  Voc√™ pode notar que <code>exit()</code> apenas um argumento - nesse caso, ecx e edx n√£o importam. <br><br><table><tbody><tr><th>  eax </th><th>  ebx </th><th>  ecx </th><th>  edx </th></tr><tr><td align="center">  N√∫mero de chamada do sistema </td><td align="center">  arg1 </td><td align="center">  arg2 </td><td align="center">  arg3 </td></tr></tbody></table><br><br><h1>  Pilha de chamadas </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/2b0/574/ea2/2b0574ea20054a1e428d6f0518a80388.png"><br><br>  Uma pilha de chamadas √© uma estrutura de dados que armazena informa√ß√µes sobre cada chamada em uma fun√ß√£o.  Cada chamada tem sua pr√≥pria se√ß√£o na pilha - o "quadro".  Ele armazena algumas informa√ß√µes sobre a chamada atual: as vari√°veis ‚Äã‚Äãlocais desta fun√ß√£o e o endere√ßo de retorno (para onde o programa deve ir ap√≥s a execu√ß√£o da fun√ß√£o). <br><br>  Noto imediatamente uma coisa n√£o √≥bvia: a pilha <i>diminui a</i> mem√≥ria.  Quando voc√™ adiciona algo ao topo da pilha, ele √© inserido em um endere√ßo de mem√≥ria menor que o item anterior.  Em outras palavras, conforme a pilha cresce, o endere√ßo de mem√≥ria na parte superior da pilha diminui.  Para evitar confus√£o, sempre lembrarei deste fato. <br><br>  A instru√ß√£o <code>push</code> algo no topo da pilha e exibe os dados a partir da√≠.  Por exemplo, <code>push </code> aloca um lugar no topo da pilha e coloca o valor do registro <code>eax</code> ali, e o <code>pop </code> transfere todos os dados do topo da pilha para o <code>eax</code> e libera essa √°rea de mem√≥ria. <br><br>  O objetivo do registro <code>esp</code> √© apontar para o topo da pilha.  Qualquer dado acima de <code>esp</code> considerado como n√£o atingindo a pilha, s√£o dados de lixo.  A execu√ß√£o de uma instru√ß√£o <code>push</code> (ou <code>pop</code> ) move <code>esp</code> .  Voc√™ pode manipular <code>esp</code> diretamente, se der um relat√≥rio √†s suas a√ß√µes. <br><br>  O registro <code>ebp</code> √© semelhante ao <code>esp</code> , mas sempre aponta aproximadamente para o meio do quadro de pilha atual, imediatamente antes das vari√°veis ‚Äã‚Äãlocais da fun√ß√£o atual (falaremos sobre isso mais adiante).  No entanto, chamar outra fun√ß√£o n√£o move o <code>ebp</code> automaticamente; isso deve ser feito manualmente a cada vez. <br><br><h1>  Conven√ß√£o de Chamada de Arquitetura X86 </h1><br>  No x86, n√£o existe um conceito interno de fun√ß√£o como nas linguagens de alto n√≠vel.  A <code>goto</code> <code>call</code> <code>goto</code> basicamente apenas <code>jmp</code> ( <code>goto</code> ) para outro endere√ßo de mem√≥ria.  Para usar rotinas como fun√ß√µes em outros idiomas (que podem receber argumentos e retornar dados), voc√™ precisa seguir a conven√ß√£o de chamada (existem muitas conven√ß√µes, mas usamos o CDECL, a conven√ß√£o mais popular para x86 entre compiladores C e programadores de assembler).  Ele tamb√©m garante que os registros de rotina n√£o sejam confundidos ao chamar outra fun√ß√£o. <br><br><h3>  Regras do chamador </h3><br>  Antes de chamar a fun√ß√£o, o chamador deve: <br><br><ol><li>  Salve os registros que o chamador precisa salvar na pilha.  A fun√ß√£o chamada pode alterar alguns registros: para n√£o perder dados, o chamador deve salv√°-lo na mem√≥ria at√© ser empurrado para a pilha.  Estes s√£o os <code>edx</code> <code>eax</code> , <code>ecx</code> e <code>edx</code> .  Se voc√™ n√£o usar nenhum deles, n√£o poder√° salv√°-los. </li><li>  Escreva argumentos de fun√ß√£o na pilha na ordem inversa (primeiro √∫ltimo argumento, primeiro primeiro argumento no final).  Essa ordem garante que a fun√ß√£o chamada receba seus argumentos da pilha na ordem correta. </li><li>  Ligue para a sub-rotina. </li></ol><br>  Se poss√≠vel, a fun√ß√£o salvar√° o resultado em <code>eax</code> .  Imediatamente ap√≥s a <code>call</code> chamador deve: <br><br><ol><li>  Remova os argumentos da fun√ß√£o da pilha.  Isso geralmente √© feito simplesmente adicionando o n√∫mero de bytes ao <code>esp</code> .  N√£o esque√ßa que a pilha cresce, portanto, para remover da pilha, voc√™ deve adicionar bytes. </li><li>  Restaure os registros salvos, colocando-os na pilha na ordem inversa.  A fun√ß√£o chamada n√£o mudar√° nenhum outro registrador. </li></ol><br>  O exemplo a seguir demonstra como essas regras se aplicam.  Suponha que a fun√ß√£o <code>_subtract</code> dois argumentos inteiros (4 bytes) e retorne o primeiro argumento menos o segundo.  Na sub-rotina <code>_mysubroutine</code> chame <code>_subtract</code> com os argumentos <code>10</code> e <code>2</code> : <br><br><pre> <code class="hljs perl">_mysubroutine: ; ... ;  -  ; ... <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx ;   (    eax) <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ;  ,      <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> call _subtract ; eax   <span class="hljs-number"><span class="hljs-number">10</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span>=<span class="hljs-number"><span class="hljs-number">8</span></span> add esp, <span class="hljs-number"><span class="hljs-number">8</span></span> ;  <span class="hljs-number"><span class="hljs-number">8</span></span>    (   <span class="hljs-number"><span class="hljs-number">4</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> edx ;    <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ecx ; ... ;  - ,        eax ; ...</code> </pre> <br><h3>  Regras da rotina chamada </h3><br>  Antes de ligar, a sub-rotina deve: <br><br><ol><li>  Salve o ponteiro do registro base <code>ebp</code> do quadro anterior, escrevendo-o na pilha. </li><li>  Ajuste o <code>ebp</code> do quadro anterior para o atual (valor atual do <code>esp</code> ). </li><li>  Aloque mais espa√ßo na pilha para vari√°veis ‚Äã‚Äãlocais, se necess√°rio, mova o ponteiro <code>esp</code> .  √Ä medida que a pilha cresce, voc√™ precisa subtrair a mem√≥ria ausente de <code>esp</code> . </li><li>  Salve os registros da rotina chamada na pilha.  Estes s√£o <code>ebx</code> , <code>edi</code> e <code>esi</code> .  N√£o √© necess√°rio salvar registros que n√£o est√£o planejados para serem alterados. </li></ol><br>  Pilha de chamadas ap√≥s a etapa 1: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d15/55e/4c4/d1555e4c4d0851f1f8ddec2b527e4877.png"><br><br>  A pilha de chamadas ap√≥s a etapa 2: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ba/e1a/9bc/2bae1a9bc4aff273c6badbd5ec94d2c8.png"><br><br>  Pilha de chamadas ap√≥s a etapa 4: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c4/4bf/a7b/8c44bfa7bfb67546110925a9606e27cd.png"><br><br>  Nesses diagramas, um endere√ßo de retorno √© indicado em cada quadro de pilha.  Ele √© automaticamente colocado na pilha por uma declara√ß√£o de <code>call</code> .  A <code>ret</code> recupera o endere√ßo da parte superior da pilha e pula para ele.  N√£o precisamos dessa instru√ß√£o, apenas mostrei por que as vari√°veis ‚Äã‚Äãlocais da fun√ß√£o est√£o 4 bytes acima do <code>ebp</code> , mas os argumentos da fun√ß√£o est√£o 8 bytes abaixo do <code>ebp</code> . <br><br>  No √∫ltimo diagrama, voc√™ tamb√©m pode observar que as vari√°veis ‚Äã‚Äãlocais da fun√ß√£o sempre iniciam 4 bytes acima de <code>ebp</code> do endere√ßo <code>ebp-4</code> (subtra√ß√£o aqui, porque estamos subindo a pilha), e os argumentos da fun√ß√£o sempre come√ßam 8 bytes abaixo de <code>ebp</code> do endere√ßo <code>ebp+8</code> (al√©m disso, porque estamos movendo a pilha para baixo).  Se voc√™ seguir as regras desta conven√ß√£o, ser√° assim com as vari√°veis ‚Äã‚Äãe argumentos de qualquer fun√ß√£o. <br><br>  Quando a fun√ß√£o estiver conclu√≠da e voc√™ desejar retornar, primeiro defina <code>eax</code> como o valor de retorno da fun√ß√£o, se necess√°rio.  Al√©m disso, voc√™ precisa de: <br><br><ol><li>  Restaure os registros salvos, colocando-os na pilha na ordem inversa. </li><li>  Libere espa√ßo na pilha alocada pela vari√°vel local na etapa 3, se necess√°rio: simplesmente instalando <code>esp</code> no ebp </li><li>  Restaure o ponteiro base <code>ebp</code> do quadro anterior, retirando-o da pilha. </li><li>  Retornar com <code>ret</code> </li></ol><br>  Agora implementamos a fun√ß√£o <code>_subtract</code> do nosso exemplo: <br><br><pre> <code class="hljs perl">_subtract: <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebp ;      mov ebp, esp ;  ebp ;          ,      ;       ,     ;   ;    mov eax, [ebp+<span class="hljs-number"><span class="hljs-number">8</span></span>] ;      eax.  ;       ebp+<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function">, [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ebp</span></span></span><span class="hljs-function">+12] </span></span>;      ebp+<span class="hljs-number"><span class="hljs-number">12</span></span>   ;  ;   , eax     ;     ,     ;       ,       <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ebp ;      ret</code> </pre> <br><h3>  Entrada e sa√≠da </h3><br>  No exemplo acima, voc√™ pode notar que a fun√ß√£o sempre executa da mesma maneira: <code>push ebp</code> , <code>mov ebp</code> , <code>esp</code> e aloca√ß√£o de mem√≥ria para vari√°veis ‚Äã‚Äãlocais.  O conjunto x86 possui uma instru√ß√£o conveniente que faz tudo isso: <code>enter ab</code> , onde <code>a</code> √© o n√∫mero de bytes que voc√™ deseja alocar para vari√°veis ‚Äã‚Äãlocais, <code>b</code> √© o "n√≠vel de aninhamento", que sempre definiremos como <code>0</code> .  Al√©m disso, a fun√ß√£o sempre termina com as instru√ß√µes <code>pop ebp</code> e <code>mov esp</code> , <code>ebp</code> (embora sejam necess√°rias apenas ao alocar mem√≥ria para vari√°veis ‚Äã‚Äãlocais, mas, de qualquer forma, n√£o causem danos).  Isso tamb√©m pode ser substitu√≠do por uma √∫nica instru√ß√£o: <code>leave</code> .  Fazemos altera√ß√µes: <br><br><pre> <code class="hljs perl">_subtract: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ;        ebp ;       ,     ;   ;    mov eax, [ebp+<span class="hljs-number"><span class="hljs-number">8</span></span>] ;      eax.  ;       ebp+<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function">, [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ebp</span></span></span><span class="hljs-function">+12] </span></span>;      ebp+<span class="hljs-number"><span class="hljs-number">12</span></span>  ;   ;   , eax     ;     ,     leave ;      ret</code> </pre> <br><h1>  Escrevendo algumas fun√ß√µes b√°sicas </h1><br>  Depois de dominar a conven√ß√£o de chamada, voc√™ pode come√ßar a escrever algumas rotinas.  Por que n√£o generalizar o c√≥digo que exibe "Ol√°, mundo!" Para <code>_print_msg</code> qualquer linha: a fun√ß√£o <code>_print_msg</code> . <br><br>  Aqui precisamos de outra fun√ß√£o <code>_strlen</code> para contar o comprimento da string.  Em C, pode ficar assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *s) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> length = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*s != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   length++; s++; } //   return length; }</span></span></code> </pre> <br>  Em outras palavras, desde o in√≠cio da linha, adicionamos 1 ao valor de retorno para cada caractere, exceto zero.  Assim que o caractere nulo √© percebido, retornamos o valor acumulado no loop.  No assembler, isso tamb√©m √© bastante simples: voc√™ pode usar a fun√ß√£o <code>_subtract</code> escrita anteriormente como base: <br><br><pre> <code class="hljs 1c">_strlen: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ;        ebp ;       ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ;   ;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function">, 0 ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-function"> = 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ecx</span></span></span><span class="hljs-function">, [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ebp</span></span></span><span class="hljs-function">+8] ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   ;  </span></span></span></span>)   ecx (   ; ,      ) _strlen_loop_start: ;  ,   <span class="hljs-keyword"><span class="hljs-keyword"></span></span> cmp byte [ecx], <span class="hljs-number"><span class="hljs-number">0</span></span> ;       . <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ;    <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-number"><span class="hljs-number">32</span></span>  (<span class="hljs-number"><span class="hljs-number">4</span></span> ). ;    .    ;     ( <span class="hljs-built_in"><span class="hljs-built_in"></span></span>) je _strlen_loop_end ;  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     inc eax ;    ,  <span class="hljs-number"><span class="hljs-number">1</span></span>    add ecx, <span class="hljs-number"><span class="hljs-number">1</span></span> ;       jmp _strlen_loop_start ;      _strlen_loop_end: ;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">leave</span></span></span><span class="hljs-function"> ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ret</span></span></span></span></code> </pre> <br>  J√° n√£o √© ruim, n√©?  Escrever o c√≥digo C primeiro pode ajudar, porque a maioria √© convertida diretamente em assembler.  Agora voc√™ pode usar esta fun√ß√£o em <code>_print_msg</code> , onde aplicamos todo o conhecimento adquirido: <br><br><pre> <code class="hljs perl">_print_msg: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ;    mov eax, <span class="hljs-number"><span class="hljs-number">0x04</span></span> ; <span class="hljs-number"><span class="hljs-number">0x04</span></span> =   <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>() mov ebx, <span class="hljs-number"><span class="hljs-number">0x1</span></span> ; <span class="hljs-number"><span class="hljs-number">0x1</span></span> =   mov ecx, [ebp+<span class="hljs-number"><span class="hljs-number">8</span></span>] ;       , ;   edx   .    _strlen <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax ;     (    edx) <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> dword [ebp+<span class="hljs-number"><span class="hljs-number">8</span></span>] ;   _strlen  _print_msg.  NASM ; ,    ,  , . ;      dword (<span class="hljs-number"><span class="hljs-number">4</span></span> , <span class="hljs-number"><span class="hljs-number">32</span></span> ) call _strlen ; eax     mov edx, eax ;     edx,     add esp, <span class="hljs-number"><span class="hljs-number">4</span></span> ;  <span class="hljs-number"><span class="hljs-number">4</span></span>    ( <span class="hljs-number"><span class="hljs-number">4</span></span>-  char*) <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ecx ;     <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> eax ;      _strlen,     <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> leave ret</code> </pre> <br>  E veja os frutos do nosso trabalho duro, usando esta fun√ß√£o no programa completo "Ol√°, mundo!". <br><br><pre> <code class="hljs pgsql">_start: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ;     (    ) push hello_world ;    _print_msg <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> _print_msg mov eax, <span class="hljs-number"><span class="hljs-number">0x01</span></span> ; <span class="hljs-number"><span class="hljs-number">0x01</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>() mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-number"><span class="hljs-number">0</span></span> =   <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span></code> </pre> <br>  Acredite ou n√£o, abordamos todos os principais t√≥picos necess√°rios para escrever programas b√°sicos do assembler x86!  Agora, temos todo o material e teoria introdut√≥rios; portanto, vamos nos concentrar completamente no c√≥digo e aplicar o conhecimento adquirido para escrever nossa calculadora RPN.  As fun√ß√µes ser√£o muito mais longas e at√© usar√£o algumas vari√°veis ‚Äã‚Äãlocais.  Se voc√™ deseja ver imediatamente o programa finalizado, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui est√° ele</a> . <br><br>  Para aqueles que n√£o est√£o familiarizados com a nota√ß√£o polonesa reversa (√†s vezes chamada de nota√ß√£o polonesa reversa ou nota√ß√£o postfix), aqui as express√µes s√£o avaliadas usando a pilha.  Portanto, voc√™ precisa criar uma pilha, bem como as <code>_push</code> e <code>_push</code> para manipular essa pilha.  Voc√™ tamb√©m <code>_print_answer</code> fun√ß√£o <code>_print_answer</code> , que exibir√° uma representa√ß√£o em sequ√™ncia do resultado num√©rico no final do c√°lculo. <br><br><h1>  Cria√ß√£o de pilha </h1><br>  Primeiro, definimos o espa√ßo na mem√≥ria da nossa pilha, bem como a vari√°vel global <code>stack_size</code> .  √â aconselh√°vel alterar essas vari√°veis ‚Äã‚Äãpara que n√£o caiam na se√ß√£o <code>.rodata</code> , mas em <code>.data</code> . <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">section</span></span> .<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> stack_size: dd 0 ;   dword (4 )   0 stack: times 256 dd 0 ;   </span></span></code> </pre> <br>  Agora voc√™ pode implementar as <code>_pop</code> e <code>_pop</code> : <br><br><pre> <code class="hljs powershell">_push: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ;    ,    push eax push edx mov eax, [<span class="hljs-type"><span class="hljs-type">stack_size</span></span>] mov edx, [<span class="hljs-type"><span class="hljs-type">ebp</span></span>+<span class="hljs-number"><span class="hljs-number">8</span></span>] mov [<span class="hljs-type"><span class="hljs-type">stack</span></span> + <span class="hljs-number"><span class="hljs-number">4</span></span>*<span class="hljs-type"><span class="hljs-type">eax</span></span>], edx ;    .   ;       dword inc dword [<span class="hljs-type"><span class="hljs-type">stack_size</span></span>] ;  <span class="hljs-number"><span class="hljs-number">1</span></span>  stack_size ;     pop edx pop eax leave ret _pop: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ;     dec dword [<span class="hljs-type"><span class="hljs-type">stack_size</span></span>] ;   <span class="hljs-number"><span class="hljs-number">1</span></span>  stack_size mov eax, [<span class="hljs-type"><span class="hljs-type">stack_size</span></span>] mov eax, [<span class="hljs-type"><span class="hljs-type">stack</span></span> + <span class="hljs-number"><span class="hljs-number">4</span></span>*<span class="hljs-type"><span class="hljs-type">eax</span></span>] ;       eax ;     ,     leave ret</code> </pre> <br><h1>  Sa√≠da de n√∫mero </h1><br>  <code>_print_answer</code> muito mais complicado: voc√™ precisa converter n√∫meros em strings e usar v√°rias outras fun√ß√µes.  Voc√™ <code>_putc</code> fun√ß√£o <code>_putc</code> , que gera um caractere, a fun√ß√£o <code>mod</code> para calcular o restante da divis√£o (m√≥dulo) dos dois argumentos e <code>_pow_10</code> para aumentar a pot√™ncia de 10. Mais tarde, voc√™ entender√° por que eles s√£o necess√°rios.  Isso √© bem simples, aqui est√° o c√≥digo: <br><br><pre> <code class="hljs powershell">_pow_10: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> mov ecx, [<span class="hljs-type"><span class="hljs-type">ebp</span></span>+<span class="hljs-number"><span class="hljs-number">8</span></span>] ;  ecx (  )  ;  mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> ;   <span class="hljs-number"><span class="hljs-number">10</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>**<span class="hljs-number"><span class="hljs-number">0</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>) _pow_10_loop_start: ;  eax  <span class="hljs-number"><span class="hljs-number">10</span></span>,  ecx   <span class="hljs-number"><span class="hljs-number">0</span></span> cmp ecx, <span class="hljs-number"><span class="hljs-number">0</span></span> je _pow_10_loop_end imul eax, <span class="hljs-number"><span class="hljs-number">10</span></span> sub ecx, <span class="hljs-number"><span class="hljs-number">1</span></span> jmp _pow_10_loop_start _pow_10_loop_end: leave ret _mod: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> push ebx mov edx, <span class="hljs-number"><span class="hljs-number">0</span></span> ;   mov eax, [<span class="hljs-type"><span class="hljs-type">ebp</span></span>+<span class="hljs-number"><span class="hljs-number">8</span></span>] mov ebx, [<span class="hljs-type"><span class="hljs-type">ebp</span></span>+<span class="hljs-number"><span class="hljs-number">12</span></span>] idiv ebx ;  <span class="hljs-number"><span class="hljs-number">64</span></span>-  [<span class="hljs-type"><span class="hljs-type">edx</span></span>:<span class="hljs-type"><span class="hljs-type">eax</span></span>]  ebx.    ;  <span class="hljs-number"><span class="hljs-number">32</span></span>-  eax,    edx  ; . ;    eax,   edx.  ,  ;       , ;    . mov eax, edx ;     () pop ebx leave ret _putc: enter <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span>x04 ; write() mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> ;   lea ecx, [<span class="hljs-type"><span class="hljs-type">ebp</span></span>+<span class="hljs-number"><span class="hljs-number">8</span></span>] ;   mov edx, <span class="hljs-number"><span class="hljs-number">1</span></span> ;   <span class="hljs-number"><span class="hljs-number">1</span></span>  int <span class="hljs-number"><span class="hljs-number">0</span></span>x80 leave ret</code> </pre> <br>  Ent√£o, como derivamos n√∫meros individuais em um n√∫mero?  Primeiro, observe que o √∫ltimo d√≠gito do n√∫mero √© o restante da divis√£o por 10 (por exemplo, <code>123 % 10 = 3</code> ) e o pr√≥ximo d√≠gito √© o restante da divis√£o por 100, dividido por 10 (por exemplo, <code>(123 % 100)/10 = 2</code> ).  Em geral, voc√™ pode encontrar um d√≠gito espec√≠fico de um n√∫mero (da direita para a esquerda) localizando <code>( % 10**n) / 10**(n-1)</code> , onde o n√∫mero de unidades ser√° <code>n = 1</code> , o n√∫mero de dezenas √© <code>n = 2</code> e assim por diante. <br><br>  Usando esse conhecimento, voc√™ pode encontrar todos os d√≠gitos de um n√∫mero de <code>n = 1</code> a <code>n = 10</code> (esse √© o n√∫mero m√°ximo de bits em um n√∫mero inteiro de 4 bytes assinado).  Mas √© muito mais f√°cil ir da esquerda para a direita - para que possamos imprimir cada caractere assim que o encontrarmos e nos livrarmos dos zeros no lado esquerdo.  Portanto, classificamos os n√∫meros de <code>n = 10</code> <code>n = 1</code> . <br><br>  Em C, o programa ser√° mais ou menos assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_DIGITS 10 void print_answer(int a) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (a </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 0) { //    putc('-'); //   ¬´¬ª a = -a; //     } int started = 0; for (int i = MAX_DIGITS; i &gt; 0; i--) { int digit = (a % pow_10(i)) / pow_10(i-1); if (digit == 0 &amp;&amp; started == 0) continue; //     started = 1; putc(digit + '0'); } }</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora voc√™ entende por que precisamos dessas tr√™s fun√ß√µes. </font><font style="vertical-align: inherit;">Vamos implementar isso no assembler:</font></font><br><br><pre> <code class="hljs perl">%define MAX_DIGITS <span class="hljs-number"><span class="hljs-number">10</span></span> _print_answer: enter <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ;  <span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-string"><span class="hljs-string">"started"</span></span>   C <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edi <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> esi mov eax, [ebp+<span class="hljs-number"><span class="hljs-number">8</span></span>] ;   <span class="hljs-string"><span class="hljs-string">"a"</span></span> cmp eax, <span class="hljs-number"><span class="hljs-number">0</span></span> ;    ,    ;  jge _print_answer_negate_end ; call putc <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'-'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0x2d</span></span> ;  <span class="hljs-string"><span class="hljs-string">'-'</span></span> call _putc add esp, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> eax neg eax ;     _print_answer_negate_end: mov byte [ebp-<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span> ; started = <span class="hljs-number"><span class="hljs-number">0</span></span> mov ecx, MAX_DIGITS ;  i _print_answer_loop_start: cmp ecx, <span class="hljs-number"><span class="hljs-number">0</span></span> je _print_answer_loop_end ;  pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>  ecx.   ebx   <span class="hljs-string"><span class="hljs-string">"digit"</span></span>   C. ;    edx = pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i-<span class="hljs-number"><span class="hljs-number">1</span></span>),  ebx = pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i) <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx dec ecx ; i-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx ;    _pow_1<span class="hljs-number"><span class="hljs-number">0</span></span> call _pow_1<span class="hljs-number"><span class="hljs-number">0</span></span> mov edx, eax ; edx = pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i-<span class="hljs-number"><span class="hljs-number">1</span></span>) add esp, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ecx ;   i  ecx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> eax ; end pow_1<span class="hljs-number"><span class="hljs-number">0</span></span> call mov ebx, edx ; digit = ebx = pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i-<span class="hljs-number"><span class="hljs-number">1</span></span>) imul ebx, <span class="hljs-number"><span class="hljs-number">10</span></span> ; digit = ebx = pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i) ;  _mod  (a % pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i)),   (eax mod ebx) <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx ; arg2, ebx = digit = pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i) <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax ; arg1, eax = a call _mod mov ebx, eax ; digit = ebx = a % pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i+<span class="hljs-number"><span class="hljs-number">1</span></span>), almost there add esp, <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> edx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> eax ;   mod ;  ebx ( <span class="hljs-string"><span class="hljs-string">"digit"</span></span> )  pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i) (edx).    ; ,   idiv     edx, eax.  ; edx   ,    - ;   <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> esi mov esi, edx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax mov eax, ebx mov edx, <span class="hljs-number"><span class="hljs-number">0</span></span> idiv esi ; eax   () mov ebx, eax ; ebx = (a % pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i)) / pow_1<span class="hljs-number"><span class="hljs-number">0</span></span>(i-<span class="hljs-number"><span class="hljs-number">1</span></span>),  <span class="hljs-string"><span class="hljs-string">"digit"</span></span>   C <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> eax <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> esi ; end division cmp ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> ;  digit == <span class="hljs-number"><span class="hljs-number">0</span></span> jne _print_answer_trailing_zeroes_check_end cmp byte [ebp-<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span> ;  started == <span class="hljs-number"><span class="hljs-number">0</span></span> jne _print_answer_trailing_zeroes_check_end jmp _print_answer_loop_continue ; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> _print_answer_trailing_zeroes_check_end: mov byte [ebp-<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">1</span></span> ; started = <span class="hljs-number"><span class="hljs-number">1</span></span> add ebx, <span class="hljs-number"><span class="hljs-number">0x30</span></span> ; digit + <span class="hljs-string"><span class="hljs-string">'0'</span></span> ;  putc <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx call _putc add esp, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> edx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> eax ;   putc _print_answer_loop_continue: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ecx</span></span></span><span class="hljs-function">, 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jmp</span></span></span><span class="hljs-function"> _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_answer_loop_start</span></span></span><span class="hljs-function"> _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_answer_loop_end</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">esi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ebx</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">leave</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ret</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foi um teste dif√≠cil! </font><font style="vertical-align: inherit;">Espero que os coment√°rios ajudem a resolver o problema. </font><font style="vertical-align: inherit;">Se voc√™ pensa agora: "Por que voc√™ n√£o pode escrever </font></font><code>printf("%d")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?", Ent√£o voc√™ vai gostar do final do artigo, onde substitu√≠mos a fun√ß√£o por isso! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora temos todas as fun√ß√µes necess√°rias, resta implementar a l√≥gica b√°sica </font></font><code>_start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- e √© tudo!</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√°lculo de nota√ß√£o reversa em polon√™s </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como j√° dissemos, a nota√ß√£o polonesa reversa √© calculada usando a pilha. </font><font style="vertical-align: inherit;">Ao ler, o n√∫mero √© empurrado para a pilha e, ao ler, o operador √© aplicado a dois objetos na parte superior da pilha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, se quisermos calcular </font></font><code>84/3+6*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(esta express√£o tamb√©m pode ser escrita no formul√°rio </font></font><code>6384/+*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), o processo √© o seguinte:</font></font><br><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Etapa </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> S√≠mbolo </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Empilhar antes </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Empilhar depois </font></font></th></tr><tr><td align="center">  1 </td><td align="center"> <code>8</code> </td> <td align="center"> <code>[]</code> </td> <td align="center"> <code>[8]</code> </td> </tr><tr><td align="center">  2 </td><td align="center"> <code>4</code> </td> <td align="center"> <code>[8]</code> </td> <td align="center"> <code>[8, 4]</code> </td> </tr><tr><td align="center">  3 </td><td align="center"> <code>/</code> </td> <td align="center"> <code>[8, 4]</code> </td> <td align="center"> <code>[2]</code> </td> </tr><tr><td align="center">  4 </td><td align="center"> <code>3</code> </td> <td align="center"> <code>[2]</code> </td> <td align="center"> <code>[2, 3]</code> </td> </tr><tr><td align="center">  5 </td><td align="center"> <code>+</code> </td> <td align="center"> <code>[2, 3]</code> </td> <td align="center"> <code>[5]</code> </td> </tr><tr><td align="center">  6 </td><td align="center"> <code>6</code> </td> <td align="center"> <code>[5]</code> </td> <td align="center"> <code>[5, 6]</code> </td> </tr><tr><td align="center">  7 </td><td align="center"> <code>*</code> </td> <td align="center"> <code>[5, 6]</code> </td> <td align="center"> <code>[30]</code> </td> </tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a entrada for uma express√£o postfix v√°lida, no final dos c√°lculos restar√° apenas um elemento na pilha - esta √© a resposta, o resultado dos c√°lculos. </font><font style="vertical-align: inherit;">No nosso caso, o n√∫mero √© 30. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No assembler, voc√™ precisa implementar algo como este c√≥digo em C:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>[<span class="hljs-number"><span class="hljs-number">256</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// , 256      int stack_size = 0; int main(int argc, char *argv[]) { char *input = argv[0]; size_t input_length = strlen(input); for (int i = 0; i &lt; input_length; i++) { char c = input[i]; if (c &gt;= '0' &amp;&amp; c &lt;= '9') { //   ‚Äî   push(c - '0'); //          } else { int b = pop(); int a = pop(); if (c == '+') { push(a+b); } else if (c == '-') { push(ab); } else if (c == '*') { push(a*b); } else if (c == '/') { push(a/b); } else { error("Invalid input\n"); exit(1); } } } if (stack_size != 1) { error("Invalid input\n"); exit(1); } print_answer(stack[0]); exit(0); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora temos todas as fun√ß√µes necess√°rias para implementar isso, vamos come√ßar. </font></font><br><br><pre> <code class="hljs perl">_start: ;  _start   ,    . ;   esp    argc ( ),  ; esp+<span class="hljs-number"><span class="hljs-number">4</span></span>   argv. , esp+<span class="hljs-number"><span class="hljs-number">4</span></span>    ; , esp+<span class="hljs-number"><span class="hljs-number">8</span></span> -       mov esi, [esp+<span class="hljs-number"><span class="hljs-number">8</span></span>] ; esi = <span class="hljs-string"><span class="hljs-string">"input"</span></span> = argv[<span class="hljs-number"><span class="hljs-number">0</span></span>] ;  _strlen      <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> esi call _strlen mov ebx, eax ; ebx = input_length add esp, <span class="hljs-number"><span class="hljs-number">4</span></span> ; end _strlen call mov ecx, <span class="hljs-number"><span class="hljs-number">0</span></span> ; ecx = <span class="hljs-string"><span class="hljs-string">"i"</span></span> _main_loop_start: cmp ecx, ebx ;  (i &gt;= input_length) jge _main_loop_end mov edx, <span class="hljs-number"><span class="hljs-number">0</span></span> mov dl, [esi + ecx] ;          ; edx.   edx . ; edx =  c = input[i] cmp edx, <span class="hljs-string"><span class="hljs-string">'0'</span></span> jl _check_operator cmp edx, <span class="hljs-string"><span class="hljs-string">'9'</span></span> jg _print_error <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edx</span></span></span><span class="hljs-function">, '0' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edx</span></span></span><span class="hljs-function"> </span></span>; eax =  c - <span class="hljs-string"><span class="hljs-string">'0'</span></span> (,  ) jmp _push_eax_and_continue _check_operator: ;   _pop    b  edi, a  b -  eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ebx call _pop mov edi, eax ; edi = b call _pop ; eax = a <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ebx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ecx ; end call _pop cmp edx, <span class="hljs-string"><span class="hljs-string">'+'</span></span> jne _subtract add eax, edi ; eax = a+b jmp _push_eax_and_continue _subtract: cmp edx, <span class="hljs-string"><span class="hljs-string">'-'</span></span> jne _multiply <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eax</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edi</span></span></span><span class="hljs-function"> </span></span>; eax = ab jmp _push_eax_and_continue _multiply: cmp edx, <span class="hljs-string"><span class="hljs-string">'*'</span></span> jne _divide imul eax, edi ; eax = a*b jmp _push_eax_and_continue _divide: cmp edx, <span class="hljs-string"><span class="hljs-string">'/'</span></span> jne _print_error <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edx ;  edx,      idiv mov edx, <span class="hljs-number"><span class="hljs-number">0</span></span> idiv edi ; eax = a/b <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> edx ;   eax     _push_eax_and_continue: ;  _push <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> edx <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax ;   call _push add esp, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> edx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ecx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> eax ;  call _push inc ecx jmp _main_loop_start _main_loop_end: cmp byte [stack_size], <span class="hljs-number"><span class="hljs-number">1</span></span> ;  (stack_size != <span class="hljs-number"><span class="hljs-number">1</span></span>),   jne _print_error mov eax, [stack] <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> eax call _print_answer ; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> a final newline <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> <span class="hljs-number"><span class="hljs-number">0xA</span></span> call _putc ; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> successfully mov eax, <span class="hljs-number"><span class="hljs-number">0x01</span></span> ; <span class="hljs-number"><span class="hljs-number">0x01</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>() mov ebx, <span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-number"><span class="hljs-number">0</span></span> =   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> ;    _print_error: <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> error_msg call _print_msg mov eax, <span class="hljs-number"><span class="hljs-number">0x01</span></span> mov ebx, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ tamb√©m precisar√° adicionar uma linha </font></font><code>error_msg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† se√ß√£o </font></font><code>.rodata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="hljs 1c">section .rodata ;     error_msg.  db  NASM ;    ,   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  ; . <span class="hljs-number"><span class="hljs-number">0</span></span>xA =  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x0 =    error_msg: db <span class="hljs-string"><span class="hljs-string">"Invalid input"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xA, <span class="hljs-number"><span class="hljs-number">0</span></span>x0</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E n√≥s terminamos! </font><font style="vertical-align: inherit;">Surpreenda todos os seus amigos se voc√™ os tiver. </font><font style="vertical-align: inherit;">Espero que agora voc√™ reaja mais calorosamente √†s linguagens de alto n√≠vel, especialmente se voc√™ se lembrar de que muitos programas antigos foram escritos completa ou quase completamente em assembler, por exemplo, o RollerCoaster Tycoon original! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todo o c√≥digo est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Obrigado pela leitura! </font><font style="vertical-align: inherit;">Eu posso continuar se voc√™ estiver interessado.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A√ß√µes adicionais </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voc√™ pode praticar implementando v√°rias fun√ß√µes adicionais: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Retorne uma mensagem de erro em vez de segfault se o programa n√£o receber um argumento. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adicione suporte para espa√ßos extras entre operandos e operadores na entrada. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adicione suporte para operandos de v√°rios bits. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permitir n√∫meros negativos. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Substitua </font></font><code>_strlen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">por uma fun√ß√£o da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca C padr√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><code>_print_answer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">substitua por uma chamada </font></font><code>printf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ol><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Materiais adicionais </font></font></h1><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Guia do Montador x86 da Universidade da Virg√≠nia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um relato mais detalhado de muitos dos t√≥picos abordados, incluindo informa√ß√µes adicionais sobre todas as instru√ß√µes x86 populares.</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´   Intel¬ª</a> .    x86 ‚Äî   ,      .        ,    ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NASM: Intel x86 Instruction Reference</a> ‚Äî       x86. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423077/">https://habr.com/ru/post/pt423077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423067/index.html">Ferramentas de desenvolvedor Python da Microsoft. Introdu√ß√£o</a></li>
<li><a href="../pt423069/index.html">Evento especial da Apple, setembro de 2018 [arquivo de tradu√ß√£o de texto]</a></li>
<li><a href="../pt423071/index.html">Eu n√£o tenho medo do seu NDA</a></li>
<li><a href="../pt423073/index.html">Sistema de arquivos interplanet√°rio - hash (identidade) trivial, bloco DAG e buffers de protocolo</a></li>
<li><a href="../pt423075/index.html">Por que os CFOs est√£o t√£o ansiosos para converter os gastos de capital em TI em opera√ß√µes</a></li>
<li><a href="../pt423079/index.html">Pontos-chave de uma entrevista com Elon Musk em Joe Rogan</a></li>
<li><a href="../pt423083/index.html">Como me tornei desenvolvedor na ABBYY</a></li>
<li><a href="../pt423085/index.html">Ajustar o balanceamento de carga</a></li>
<li><a href="../pt423087/index.html">N√£o me empurre nos olhos</a></li>
<li><a href="../pt423089/index.html">Programadores na MBLT DEV 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>