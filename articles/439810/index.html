<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßú üò• üôå Conozca el marco de microservicios de Moleculer üë®üèª‚Äçüç≥ üßë ü§∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola% habrauser%! 

 Hoy quiero contarles sobre un excelente, en mi opini√≥n, el marco de microservicios de Moleculer . 



 Inicialmente, este marco s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conozca el marco de microservicios de Moleculer</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439810/"> Hola% habrauser%! <br><br>  Hoy quiero contarles sobre un excelente, en mi opini√≥n, el marco de microservicios de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Moleculer</a> . <br><br><img src="https://habrastorage.org/webt/n1/8a/ew/n18aewfs_oj6ndbonuakkyjfwte.png"><br><br>  Inicialmente, este marco se escribi√≥ en Node.js, pero luego apareci√≥ en puertos en otros lenguajes como Java, Go, Python y .NET y, muy probablemente, otras implementaciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aparecer√°n</a> en un futuro cercano.  Lo hemos estado usando en producci√≥n en varios productos durante aproximadamente un a√±o y es dif√≠cil describir con palabras lo bendecido que nos pareci√≥ despu√©s de usar Seneca y nuestras bicicletas.  Tenemos todo lo que necesitamos fuera de la caja: recopilar m√©tricas, almacenamiento en cach√©, equilibrio, tolerancia a fallas, seleccionar transportes, validaci√≥n de par√°metros, registro, declaraciones de m√©todos concisos, varias formas de interacci√≥n entre servicios, mixins y mucho m√°s.  Y ahora en orden. <br><a name="habracut"></a><br><h2>  Introduccion </h2><br>  El marco, de hecho, consta de tres componentes (de hecho, no, pero aprender√° m√°s sobre esto a continuaci√≥n). <br><br><h4>  Transportador </h4><br>  Responsable de descubrir servicios y comunicaci√≥n entre ellos.  Esta es una interfaz que puede implementar usted mismo si lo desea, o puede usar implementaciones listas para usar que son parte del marco en s√≠.  Hay 7 transportes disponibles de la caja: TCP, Redis, AMQP, MQTT, NATS, NATS Streaming, Kafka.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> puedes ver m√°s.  Usamos el transporte Redis, pero planeamos cambiar a TCP con su salida del estado experimental. <br><br>  En la pr√°ctica, al escribir c√≥digo, no interactuamos con este componente.  Solo necesitas saber qu√© es √©l.  El transporte utilizado se especifica en la configuraci√≥n.  Por lo tanto, para cambiar de un transporte a otro, simplemente cambie la configuraci√≥n.  Eso es todo.  Algo como esto: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ./moleculer.config.js module.exports = { transporter: 'redis://:pa$$w0rd@127.0.0.1:6379', // ...   }</span></span></code> </pre> <br>  Los datos, por defecto, vienen en formato JSON.  Pero puede usar cualquier cosa: Avro, MsgPack, Notepack, ProtoBuf, Thrift, etc. <br><br><h4>  Servicio </h4><br>  La clase de la que heredamos al escribir nuestros microservicios. <br><br>  Aqu√≠ est√° el servicio m√°s simple sin m√©todos, que, sin embargo, ser√° detectado por otros servicios: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ./services/telemetry/telemetry.service.js const { Service } = require('moleculer'); module.exports = class TelemetryService extends Service { constructor(broker) { super(broker); this.parseServiceSchema({ name: 'telemetry', }); } };</span></span></code> </pre><br><br><h4>  Corredor de servicios </h4><br>  El n√∫cleo del marco. <br><br><img src="https://habrastorage.org/webt/t7/wp/qo/t7wpqorpz4zhmczcvir_fs9cems.png"><br><br>  Exagerando, podemos decir que esta es una capa entre el transporte y el servicio.  Cuando un servicio quiere interactuar con otro servicio de alguna manera, lo hace a trav√©s de un intermediario (se dar√°n ejemplos a continuaci√≥n).  El corredor se dedica al equilibrio de carga (admite varias estrategias, incluidas las personalizadas, por defecto, round-robin), teniendo en cuenta los servicios en vivo, los m√©todos disponibles en estos servicios, etc.  Para esto, ServiceBroker usa otro componente bajo el cap√≥: el Registro, pero no me detendr√© en √©l, no lo necesitaremos para conocerlo. <br><br>  Tener un corredor nos da una cosa extremadamente conveniente.  Ahora intentar√© explicarlo, pero tendr√© que apartarme un poco.  En el contexto del marco existe un nodo.  En t√©rminos simples, un nodo es un proceso en el sistema operativo (es decir, lo que sucede cuando ingresamos "node index.js" en la consola, por ejemplo).  Cada nodo es un ServiceBroker con un conjunto de uno o m√°s microservicios.  S√≠, escuchaste bien.  Podemos construir nuestra pila de servicios como lo desee nuestro coraz√≥n.  ¬øPor qu√© es esto conveniente?  Para el desarrollo, comenzamos un nodo en el que todos los microservicios se lanzan a la vez (1 cada uno), solo un proceso en el sistema con la capacidad de conectar muy f√°cilmente la recarga en caliente, por ejemplo.  En producci√≥n: un nodo separado para cada instancia del servicio.  Bueno, o una combinaci√≥n, cuando parte de los servicios en un nodo, parte en otro, etc. (aunque no s√© por qu√© hacer esto, solo para entender que t√∫ tambi√©n puedes hacerlo). <br><br><div class="spoiler">  <b class="spoiler_title">As√≠ es como se ve nuestro index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { resolve } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { ServiceBroker } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'moleculer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./moleculer.config.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { SERVICES, NODE_ENV, } = process.env; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> broker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceBroker(config); broker.loadServices( resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'services'</span></span>), SERVICES ? <span class="hljs-string"><span class="hljs-string">`*/@(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${SERVICES.split(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">','</span></span></span></span><span class="hljs-string"><span class="hljs-subst">).map(i =&gt; i.trim()).join(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'|'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">).service.js`</span></span> : <span class="hljs-string"><span class="hljs-string">'*/*.service.js'</span></span>, ); broker.start().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>) { broker.repl(); } });</code> </pre><br></div></div><br>  En ausencia de una variable de entorno, todos los servicios del directorio se cargan, de lo contrario, por m√°scara.  Por cierto, broker.repl () es otra caracter√≠stica conveniente del marco.  Al comenzar en modo de desarrollo, all√≠ mismo, en la consola, tenemos una interfaz para llamar a los m√©todos (lo que har√≠a, por ejemplo, a trav√©s del cartero en su microservicio que se comunica a trav√©s de http), solo que aqu√≠ es mucho m√°s conveniente: la interfaz est√° en la misma consola donde empezaron npm. <br><br><h2>  Interacci√≥n entre servicios </h2><br>  Se lleva a cabo de tres maneras: <br><br><h4>  llamar </h4><br>  M√°s com√∫nmente utilizado.  Hizo una solicitud, recibi√≥ una respuesta (o error). <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   "report",     "csv". async getCsvReport({ jobId }) { const rows = []; // ... return this.broker.call('csv.stringify', { rows }); }</span></span></code> </pre><br>  Como se mencion√≥ anteriormente, las llamadas se equilibran autom√°ticamente.  Simplemente aumentamos el n√∫mero requerido de instancias de servicio, y el marco en s√≠ har√° el equilibrio. <br><br><img src="https://habrastorage.org/webt/jl/nj/r4/jlnjr4zxz943pfzpc9epoxpbgw8.gif"><br><br><h4>  emitir </h4><br>  Se usa cuando solo queremos notificar a otros servicios sobre un evento, pero no necesitamos el resultado. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   "user"    . async registerUser({ email, password }) { // ... this.broker.emit('user_registered', { email }); return true; }</span></span></code> </pre><br>  Otros servicios pueden suscribirse a este evento y responder en consecuencia.  Opcionalmente, el tercer argumento, puede establecer expl√≠citamente los servicios que est√°n disponibles para recibir este evento. <br><br>  El punto importante es que el evento recibir√° solo una instancia de cada tipo de servicio, es decir,  Si tenemos 10 servicios de "correo" y 5 de "suscripci√≥n" que est√°n suscritos a este evento, de hecho solo lo recibir√°n 2 copias, un "correo" y una "suscripci√≥n".  Esquem√°ticamente se ve as√≠: <br><br><img src="https://habrastorage.org/webt/yf/fg/oj/yffgoj5ce8pzhcfdl_rdian6hpg.gif"><br><br><h4>  transmitir </h4><br>  Lo mismo que emitir, pero sin restricciones.  Los 10 servicios de correo y 5 de suscripci√≥n captar√°n este evento. <br><br><h2>  Validaci√≥n de par√°metros </h2><br>  Por defecto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el validador m√°s r√°pido se</a> utiliza para validar los par√°metros, parece ser muy r√°pido.  Pero nada impide usar otro, por ejemplo, el mismo joi, si necesita una validaci√≥n m√°s avanzada. <br><br>  Cuando escribimos un servicio, heredamos de la clase base del Servicio, declaramos m√©todos con l√≥gica de negocios, pero estos m√©todos son "privados", no se pueden llamar desde el exterior (desde otro servicio) hasta que queramos expl√≠citamente, declar√°ndolos en secci√≥n de acciones especiales durante la inicializaci√≥n del servicio (los m√©todos p√∫blicos de servicios en el contexto del marco se denominan acciones). <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de una declaraci√≥n de m√©todo con validaci√≥n.</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(broker) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(broker); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parseServiceSchema({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'job'</span></span>, <span class="hljs-attr"><span class="hljs-attr">actions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">update</span></span>: { <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'number'</span></span>, <span class="hljs-attr"><span class="hljs-attr">convert</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-attr"><span class="hljs-attr">empty</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">optional</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'object'</span></span>, <span class="hljs-attr"><span class="hljs-attr">optional</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> handler(ctx) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update(ctx.params); }, }, }, }); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> update({ id, name, data }) { <span class="hljs-comment"><span class="hljs-comment">// ... } }</span></span></code> </pre><br></div></div><br><h2>  Mixins </h2><br>  Se usa, por ejemplo, para inicializar una conexi√≥n de base de datos.  Evite la duplicaci√≥n de c√≥digo de un servicio a otro. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de mezcla para inicializar una conexi√≥n a Redis</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Redis = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ioredis'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ key = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'redis'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, options } = {}</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">settings</span></span>: { [key]: options, }, created() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Redis(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings[key]); }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> started() { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key].connect(); }, stopped() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[key].disconnect(); }, });</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Usando mixin en el servicio</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Service, Errors } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'moleculer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> redis = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../mixins/redis'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../mixins/server'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { REDIS_HOST, REDIS_PORT, REDIS_PASSWORD, } = process.env; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> redisOpts = { <span class="hljs-attr"><span class="hljs-attr">host</span></span>: REDIS_HOST, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: REDIS_PORT, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: REDIS_PASSWORD, <span class="hljs-attr"><span class="hljs-attr">lazyConnect</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(broker) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(broker); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parseServiceSchema({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'auth'</span></span>, <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [redis({ <span class="hljs-attr"><span class="hljs-attr">options</span></span>: redisOpts }), server({ router })], }); } }</code> </pre> <br></div></div><br><h2>  Almacenamiento en cach√© </h2><br>  Las llamadas de m√©todo (acciones) se pueden almacenar en cach√© de varias maneras: LRU, Memoria, Redis.  Opcionalmente, puede especificar qu√© llamadas clave se almacenar√°n en cach√© (de forma predeterminada, el hash de objeto se usa como clave de almacenamiento en cach√©) y con qu√© TTL. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de declaraci√≥n de m√©todo en cach√©</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InventoryService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(broker) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(broker); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parseServiceSchema({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'inventory'</span></span>, <span class="hljs-attr"><span class="hljs-attr">actions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">getInventory</span></span>: { <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">steamId</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-attr"><span class="hljs-attr">pattern</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/^76\d{15}$/</span></span> }, <span class="hljs-attr"><span class="hljs-attr">appId</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'number'</span></span>, <span class="hljs-attr"><span class="hljs-attr">integer</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">contextId</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'number'</span></span>, <span class="hljs-attr"><span class="hljs-attr">integer</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, }, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: { <span class="hljs-attr"><span class="hljs-attr">keys</span></span>: [<span class="hljs-string"><span class="hljs-string">'steamId'</span></span>, <span class="hljs-string"><span class="hljs-string">'appId'</span></span>, <span class="hljs-string"><span class="hljs-string">'contextId'</span></span>], <span class="hljs-attr"><span class="hljs-attr">ttl</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span>, }, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> handler(ctx) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }, }, }, }); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br></div></div><br>  El m√©todo de almacenamiento en cach√© se establece a trav√©s de la configuraci√≥n de ServiceBroker. <br><br><h2>  Registro </h2><br>  Aqu√≠, sin embargo, todo tambi√©n es bastante simple.  Hay un registrador incorporado bastante bueno que escribe en la consola, es posible especificar un formato personalizado.  Nada impide robar ning√∫n otro registrador popular, ya sea winston o bunyan.  Un manual detallado est√° en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> .  Personalmente, utilizamos el registrador incorporado, el formateador personalizado para un par de l√≠neas de c√≥digo que el correo no deseado en la consola JSON simplemente se corta en el producto, despu√©s de lo cual ingresan a Graylog utilizando el controlador de registro de Docker. <br><br><h2>  M√©tricas </h2><br>  Si lo desea, puede recopilar m√©tricas para cada m√©todo y rastrearlo todo en alg√∫n zipkin.  Aqu√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√° la</a> lista completa de exportadores disponibles.  Actualmente hay cinco de ellos: Zipkin, Jaeger, Prometheus, Elastic, Console.  Se configura, como el almacenamiento en cach√©, al declarar un m√©todo (acci√≥n). <br><br>  Los ejemplos de visualizaci√≥n para el paquete elasticsearch + kibana usando el m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">elastic-apm-node</a> se pueden ver en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este enlace</a> en Github. <br><br>  La forma m√°s f√°cil, por supuesto, es usar la opci√≥n de consola.  Se ve as√≠: <br><br><img src="https://habrastorage.org/webt/eu/dq/20/eudq20mgo7wtbqmstlp_aiidicy.png"><br><br><h2>  Tolerancia a fallos </h2><br>  El marco tiene un interruptor autom√°tico incorporado, que se controla a trav√©s de la configuraci√≥n de ServiceBroker.  Si alg√∫n servicio falla y el n√∫mero de estas fallas excede un cierto umbral, se marcar√° como no saludable, las solicitudes se limitar√°n severamente hasta que deje de cometer errores. <br><br>  Como beneficio adicional, tambi√©n hay un respaldo individualmente ajustable para cada m√©todo (acci√≥n), en caso de que supongamos que el m√©todo puede fallar y, por ejemplo, enviar datos almacenados en cach√© o un c√≥digo auxiliar. <br><br><h2>  Conclusi√≥n </h2><br>  La introducci√≥n de este marco para m√≠ se convirti√≥ en un soplo de aire fresco, lo que ahorr√≥ una gran cantidad de golpes (excepto por el hecho de que la arquitectura de microservicios es un gran toque) y el ciclismo, hizo que escribir el siguiente microservicio fuera simple y transparente.  No hay nada superfluo, es simple y muy flexible, y puede escribir el primer servicio dentro de una o dos horas despu√©s de leer la documentaci√≥n.  Me alegrar√° si este material es √∫til para usted y en su pr√≥ximo proyecto querr√° probar este milagro, como lo hicimos nosotros (y a√∫n no me he arrepentido).  Bueno para todos! <br><br>  Adem√°s, si est√° interesado en este marco, √∫nase al chat en Telegram - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@moleculerchat</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439810/">https://habr.com/ru/post/439810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439794/index.html">Dolor de espalda: comprensi√≥n desde la perspectiva de la medicina moderna</a></li>
<li><a href="../439796/index.html">Spring Boot 2: lo que no escriben en las notas de la versi√≥n</a></li>
<li><a href="../439804/index.html">Zen de pruebas unitarias</a></li>
<li><a href="../439806/index.html">Nombres de dominio SSL v√°lidos para contenedores Docker locales</a></li>
<li><a href="../439808/index.html">Los telescopios m√°s grandes. Desde notebook y ojos hasta c√°maras de 340 megap√≠xeles y centros de datos. Parte 1</a></li>
<li><a href="../439812/index.html">Enfoques de Kaggle para CV en prod: no puede implementar para cortar</a></li>
<li><a href="../439818/index.html">Caracter√≠sticas de los enfoques de dise√±o en el sector de fabricaci√≥n real.</a></li>
<li><a href="../439822/index.html">Creaci√≥n de una pantalla alternativa para el sintetizador / muestreador Ensoniq EPS16 + y ASR10</a></li>
<li><a href="../439824/index.html">¬øCu√°ndo desaparecer√°n los marcos de JavaScript?</a></li>
<li><a href="../439826/index.html">Desactivar el an√°logo. ¬øQu√© pasar√° con la televisi√≥n?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>