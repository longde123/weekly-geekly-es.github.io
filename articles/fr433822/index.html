<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôãÔ∏è üöã üë®üèΩ‚Äçüé® Guide CMake complet. Troisi√®me partie: essais et emballage üßùüèæ üßùüèº üê™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 


 Cet article d√©crit les programmes de test et de mise en package utilisant CMake, un ensemble d'utilitaires flexible et polyvalent pou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide CMake complet. Troisi√®me partie: essais et emballage</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433822/"><p><img src="https://habrastorage.org/webt/lf/se/70/lfse70sjifxiyddiuym73hdvcho.png"></p><br><h1 id="vvedenie">  Pr√©sentation </h1><br><p>  Cet article d√©crit les programmes de test et de mise en package utilisant CMake, un ensemble d'utilitaires flexible et polyvalent pour d√©velopper divers produits logiciels.  Il est fortement recommand√© de lire les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxi√®me</a> parties du manuel pour √©viter de mal comprendre la syntaxe et le fonctionnement de CMake. </p><a name="habracut"></a><br><h1 id="zapusk-cmake">  Lancement de CMake </h1><br><p>  Voici des exemples d'utilisation du langage CMake que vous devez pratiquer.  Essayez le code source en modifiant les commandes existantes et en en ajoutant de nouvelles.  Pour ex√©cuter ces exemples, installez CMake √† partir du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site Web officiel</a> . </p><br><h1 id="primer-testirovaniya">  Exemple de test </h1><br><p> Comme mentionn√© pr√©c√©demment, CMake prend en charge le test automatique des programmes.  Cette fonctionnalit√© est tr√®s facile √† utiliser - il suffit d'√©crire quelques commandes dans le <code>CMakeLists.txt</code> habituel, puis d'ex√©cuter les tests en utilisant <code>ctest</code> ou <code>make test</code> .  √Ä votre disposition, il y a un contr√¥le de la sortie des programmes, une analyse dynamique de la m√©moire et bien plus encore. </p><br><p>  Nous consid√©rerons le processus de test du programme avec un exemple sp√©cifique.  Le fichier source <code>Multiply.c</code> contient le code suivant: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #define ARG_COUNT 3 int main(const int argc, const char *argv[]) { if (argc != ARG_COUNT) { fprintf(stderr, "Error!\n"); return EXIT_FAILURE; } const int first = atoi(argv[1]); const int second = atoi(argv[2]); printf("The result is: %d\n", first * second); return EXIT_SUCCESS; }</span></span></span></span></code> </pre> <br><p>  Ce code affiche le r√©sultat de la multiplication de deux arguments sur la console.  Veuillez noter qu'une situation d'occurrence d'une erreur est √©galement possible si le nombre r√©el d'arguments ne satisfait pas la valeur attendue: dans ce cas, l'erreur sera sortie dans l' <code>Error!</code>  . </p><br><p>  Dans le m√™me r√©pertoire se trouve le fichier <code>CMakeLists.txt</code> avec une description du processus de construction, contenant le code ci-dessous: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">3.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">project</span></span>(MyProgram) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(Multiply Multiply.c) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(MULTIPLY_TIMEOUT <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   : enable_testing() #  : add_test(FirstTest Multiply 15 207) add_test(SecondTest Multiply -54 -785) add_test(ThirdTest Multiply 85234) #   : set_tests_properties(FirstTest SecondTest ThirdTest PROPERTIES TIMEOUT ${MULTIPLY_TIMEOUT}) set_tests_properties(FirstTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 3105" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(SecondTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 42390" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(ThirdTest PROPERTIES PASS_REGULAR_EXPRESSION "Error!")</span></span></code> </pre> <br><p>  Consid√©rons tout dans l'ordre.  Les quatre premi√®res commandes doivent vous √™tre famili√®res dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> , et la prochaine commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>enable_testing</code></a> soul√®ve un certain nombre de questions.  En substance, cette commande ne fait que notifier CMake de votre intention de tester le programme, en g√©n√©rant simultan√©ment certains fichiers de configuration, dont vous n'avez pas besoin de conna√Ætre l'existence. </p><br><p>  Les trois <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>add_test</code></a> suivantes ajoutent des tests au projet en cours.  La forme courte de cette commande prend le nom du test comme premier argument, et les arguments suivants forment une commande shell pour ex√©cuter le test. </p><br><p>  Une s√©rie de commandes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>set_tests_properties</code></a> d√©finit le comportement des tests individuels.  Apr√®s la liste des √©l√©ments de test, le mot-cl√© <code>PROPERTIES</code> suit, signalant le d√©but d'une liste de propri√©t√©s qui ont la forme <code>&lt; &gt; &lt; &gt;</code> et sont d√©finies pour les tests s√©lectionn√©s.  Une liste compl√®te des propri√©t√©s disponibles est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Pour tous les tests, le temps d'ex√©cution maximal est d√©fini sur une seconde avec la propri√©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>TIMEOUT</code></a> , puis pour les tests suivants, la sortie attendue est d√©finie avec les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>FAIL_REGULAR_EXPRESSION</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>PASS_REGULAR_EXPRESSION</code></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>FAIL_REGULAR_EXPRESSION</code></a> (par exemple, si l'expression r√©guli√®re <code>The result is: 3105</code> correspond, puis le test <code>FirstTest</code> continue et s'il correspond) avec l'expression <code>Error!</code> test s'arr√™te et est consid√©r√© comme ayant √©chou√©). </p><br><h1 id="sposoby-vklyucheniya-testirovaniya">  Fa√ßons d'activer les tests </h1><br><p>  Il existe un analogue de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>enable_testing</code></a> - il s'agit de l'inclusion du module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>CTest</code></a> via la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>include</code></a> .  En g√©n√©ral, l'inclusion d'un module est plus universelle, mais il y a toujours une diff√©rence entre eux. </p><br><p>  La commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>enable_testing</code></a> permet de tester le r√©pertoire actuel, ainsi que tous les suivants.  Il doit se trouver dans la racine <code>CMakeLists.txt</code> , car CTest attend un fichier de test √† la racine de l'assembly. </p><br><p>  L'activation du module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>CTest</code></a> configure le projet pour les tests √† l'aide de CTest / CDash et d√©termine √©galement automatiquement l'option <code>BUILD_TESTING</code> , qui accepte vrai lorsque le test est possible (la valeur par d√©faut est <code>ON</code> ).  Ainsi, lorsque vous utilisez cette commande, il est raisonnable de d√©crire le processus de test de cette mani√®re: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(BUILD_TESTING) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(FirstTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(SecondTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(ThirdTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  ... endif()</span></span></code> </pre> <br><h1 id="ispolnenie-testirovaniya">  Ex√©cution des tests </h1><br><p>  Une s√©rie de commandes <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code>  les trois tests sont ex√©cut√©s.  La commande <code>ctest -R &lt;RegularExpression&gt;</code> ex√©cute un ensemble de tests qui satisfont une expression r√©guli√®re donn√©e.  Par exemple, la <code>ctest -R ThirdTest</code> ex√©cute uniquement le troisi√®me test. </p><br><h1 id="primer-paketirovaniya">  Exemple d'emballage </h1><br><p>  Pour cr√©er un package de fichiers source, biblioth√®ques et fichiers ex√©cutables, il vous suffit de d√©crire l'installation des fichiers n√©cessaires √† l'aide de la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>install</code></a> , puis d'activer le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>CPack</code></a> la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>include</code></a> : </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "Multiply"   "bin": install(TARGETS Multiply DESTINATION bin) #    : set(CPACK_PACKAGE_NAME "Multiply") set(CPACK_PACKAGE_VENDOR "MyCompany") set(CPACK_PACKAGE_CONTACT "https://myprojectsite.org") set(CPACK_DEBIAN_PACKAGE_MAINTAINER "mycontacts@gmail.com") set(CPACK_PACKAGE_DESCRIPTION "The most stupid program ever written") #    : set(CPACK_GENERATOR "DEB") #    "CPack": include(CPack)</span></span></code> </pre> <br><p>  Dans ce cas, la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>install</code></a> notifie le g√©n√©rateur de packages du r√©pertoire d'installation cible <code>Multiply</code> .  Sans √©criture des commandes d'installation, la g√©n√©ration de packages n'est pas possible. </p><br><p>  Ce qui suit r√©pertorie les caract√©ristiques du package en d√©finissant plusieurs variables.  En fait, il existe de nombreuses variables de ce type qui conditionnent correctement les packages.  La plupart d'entre eux sont facultatifs, mais certains g√©n√©rateurs de packages n√©cessitent leur d√©finition.  Une liste des variables communes √† tous les g√©n√©rateurs de packages est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  La d√©finition de la variable <code>CPACK_GENERATOR</code> est <code>CPACK_GENERATOR</code> - il s'agit d'une liste de g√©n√©rateurs de packages appel√©s par l'utilitaire <code>cpack</code> .  Dans ce cas, il prend la valeur <code>DEB</code> , donc un paquet Debian est g√©n√©r√© dans le r√©pertoire racine de l'application de vue d'ensemble. </p><br><p>  Enfin, le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>CPack</code></a> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>CPack</code></a> , configurant le futur package de projet √† l'aide des variables d√©finies pr√©c√©demment et de la commande d'installation pour le fichier ex√©cutable, ainsi que l'ajout de deux cibles d'assembly - <code>package</code> et <code>package_source</code> (assemblage binaire et assemblage source, respectivement). </p><br><h1 id="ispolnenie-paketirovaniya">  Ex√©cution de l'emballage </h1><br><p>  Une s√©rie de commandes <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> lanc√© pour ex√©cuter le g√©n√©rateur s√©lectionn√© pour cr√©er un package binaire et les commandes <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> g√©n√©rer un package source directement dans le r√©pertoire racine. </p><br><h1 id="zavershenie">  Ach√®vement </h1><br><p>  √Ä ce stade, la s√©rie de didacticiels complets CMake a pris fin.  J'esp√®re que vous avez appris beaucoup de mat√©riel utile et am√©lior√© vos comp√©tences en programmation.  Bonne chance <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433822/">https://habr.com/ru/post/fr433822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433810/index.html">Une approche orient√©e probl√®me des projets de marketing Internet</a></li>
<li><a href="../fr433814/index.html">Comment faire √©voluer des bases de donn√©es dans Yandex. Cloud sans temps d'arr√™t. Exemple de trois h√¥tes</a></li>
<li><a href="../fr433816/index.html">O√π publier l'application mobile</a></li>
<li><a href="../fr433818/index.html">Compiler et ex√©cuter C # et Blazor dans un navigateur</a></li>
<li><a href="../fr433820/index.html">Proposition ECMAScript: Array.prototype. {Flat, flatMap}</a></li>
<li><a href="../fr433824/index.html">Habro suicide. Pourquoi les programmeurs 1C sauveront le monde</a></li>
<li><a href="../fr433826/index.html">Persimmon 2.0 Instructions d'utilisation</a></li>
<li><a href="../fr433828/index.html">Utilisation de la carte QML pour cr√©er des voies a√©riennes - Partie 1</a></li>
<li><a href="../fr433830/index.html">Nouvelles lampes LED Diall</a></li>
<li><a href="../fr433832/index.html">Formatage du code source de ClangFormat sous Linux: probl√®mes et solutions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>