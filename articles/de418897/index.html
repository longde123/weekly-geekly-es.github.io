<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📪 👨‍👩‍👧‍👧 ↪️ CRDT: Konfliktfreie replizierte Datentypen 🚵🏽 🖊️ ⛓️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie zähle ich google.com-Seitentreffer? Und wie speichert man den Zähler von Likes sehr beliebter Benutzer? In diesem Artikel wird vorgeschlagen, die ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CRDT: Konfliktfreie replizierte Datentypen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418897/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/r1/we/lm/r1welma_rgaxinwrbp7ekni1tdo.png"></div><br>  Wie zähle ich google.com-Seitentreffer?  Und wie speichert man den Zähler von Likes sehr beliebter Benutzer?  In diesem Artikel wird vorgeschlagen, die Lösung dieser Probleme mithilfe von CRDT (Conflict-Free Replicated Data Types, was auf Russisch ungefähr als Conflict-Free Replicated Data Types übersetzt wird) und im allgemeineren Fall von Replikatsynchronisierungsaufgaben in einem verteilten System mit mehreren führenden Knoten in Betracht zu ziehen. <br><a name="habracut"></a><br><h1>  1. Einleitung </h1><br>  Wir sind seit langem daran gewöhnt, Anwendungen wie einen Kalender oder einen Notendienst wie Evernote zu verwenden.  Sie zeichnen sich dadurch aus, dass Sie offline (von mehreren Geräten bis zu mehreren Personen gleichzeitig (mit denselben Daten) arbeiten können.  Die Herausforderung für die Entwickler jeder solchen Anwendung besteht darin, die „reibungsloseste“ Synchronisierung von Daten sicherzustellen, die gleichzeitig auf mehreren Geräten geändert werden.  Im Idealfall sollte keine Benutzerbeteiligung erforderlich sein, um Zusammenführungskonflikte zu lösen. <br><br>  In einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">früheren Artikel haben wir</a> bereits einen Ansatz zur Lösung solcher Probleme in Betracht gezogen - Operational Transformation. Außerdem wird eine sehr ähnliche Methode beschrieben, die sowohl Vor- als auch Nachteile hat (zum Beispiel wurde CRDT für JSON noch nicht erfunden. Aktualisierung: Dank an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">msvn</a> für den Link hier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier ist ein</a> Projekt der Autoren eines Forschungsartikels zur Implementierung von JSON in CRDT. <br><br><h1>  2. Starke eventuelle Konsistenz </h1><br>  In letzter Zeit wurde viel Arbeit geschrieben und viel Forschung auf dem Gebiet der eventuellen Konsistenz betrieben.  Meiner Meinung nach gibt es jetzt einen starken Trend hin zu einer Verlagerung von starker Konsistenz zu verschiedenen Optionen für Konsistenz, um zu untersuchen, welche Konsistenz in welchen Situationen / Systemen rentabler anzuwenden ist, und um bestehende Definitionen zu überdenken.  Dies führt zu Verwirrung, wenn beispielsweise die Autoren einiger Werke, die über Konsistenz sprechen, eine eventuelle Konsistenz mit einigen zusätzlichen Eigenschaften bedeuten und andere Autoren hierfür eine bestimmte Terminologie verwenden. <br><br>  Die von den Autoren eines der Artikel aufgeworfene Frage kritisiert die derzeitige Definition der eventuellen Konsistenz: Wenn Ihr System auf alle Anfragen immer mit „42“ antwortet, ist alles in Ordnung, und es ist schließlich konsistent. <br><br>  Ohne die Richtigkeit dieses Artikels zu verletzen, verwende ich gemäß den Autoren der Originalartikel die folgende Terminologie (bitte beachten Sie, dass dies keine strengen Definitionen sind, sondern Unterschiede): <br><br><ul><li>  Starke Konsistenz (SC): Alle Schreibvorgänge sind streng geordnet. Eine Leseanforderung auf einem Replikat gibt das gleiche, zuletzt aufgezeichnete Ergebnis zurück.  <b>Echtzeitkonsens</b> ist erforderlich, um Konflikte zu lösen (mit den daraus resultierenden Konsequenzen), kann einem Rückgang auf n / 2 - 1 Knoten standhalten. </li><li>  Eventuelle Konsistenz (EC): Aktualisieren Sie die Daten lokal und senden Sie das Update weiter.  Das Lesen auf verschiedenen Replikaten kann veraltete Daten zurückgeben.  Im Falle von Konflikten rollen wir entweder zurück oder entscheiden irgendwie, was zu tun ist.  T.O.  Konsens ist weiterhin erforderlich, jedoch nicht <b>mehr in Echtzeit</b> . </li><li>  Starke eventuelle Konsistenz (SEC): EC + zur Lösung von Konflikten haben Replikate einen vordefinierten Algorithmus.  T.O.  <b>Konsens ist nicht erforderlich</b> , er kann einem Abfall auf n - 1 Knoten standhalten. </li></ul><br>  Beachten Sie, dass SEC (sozusagen) das Problem des CAP-Theorems löst: Alle drei Eigenschaften sind erfüllt. <br><br>  Wir sind also bereit, SC zu spenden, und möchten einen bestimmten Satz grundlegender Datentypen für unser möglicherweise instabiles verteiltes System haben, die Schreibkonflikte für uns automatisch lösen (keine Benutzerinteraktion oder Anforderung an einen Schiedsrichter erforderlich). <br><br><h1>  3. Aufgaben zu Likes und Hits </h1><br>  Zweifellos gibt es mehrere Algorithmen zur Lösung solcher Probleme.  CRDT bietet einen ziemlich eleganten und einfachen Weg. <br><br><h3>  Google.com Trefferanzahl: </h3><br>  google.com verarbeitet ungefähr 150.000 Anfragen pro Sekunde aus der ganzen Welt.  Offensichtlich muss der Zähler asynchron aktualisiert werden.  Warteschlangen lösen das Problem teilweise. Wenn wir beispielsweise eine externe API bereitstellen, um diesen Wert abzurufen, müssen wir eine Replikation durchführen, um das Repository nicht mit Leseanforderungen zu versehen.  Und wenn es bereits eine Replikation gibt, vielleicht ohne globale Warteschlangen? <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/wv/4y/tn/wv4ytnmej1xm2tbhen3ddztgv6w.png" alt="Bild"></div><br><br><h3>  Benutzerlikes zählen: </h3><br>  Die Aufgabe ist der vorherigen sehr ähnlich, nur dass Sie jetzt eindeutige Treffer zählen müssen. <br><br><h1>  4. Terminologie </h1><br>  Für ein umfassenderes Verständnis des Artikels müssen Sie die folgenden Begriffe kennen: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Idempotenz</a> <br>  Sagt, dass das mehrmalige Anwenden der Operation das Ergebnis nicht ändert. <br>  Beispiele - GET-Operation oder Addition mit Null: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>0</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.849ex" height="2.66ex" viewBox="0 -832 5532 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-29" x="1512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-3D" x="2179" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-78" x="3236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-2B" x="4030" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-30" x="5031" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> f (x) = x + 0 </script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kommutativität</a> <br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.312ex" height="2.66ex" viewBox="0 -832 7023.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-2C" x="1512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-79" x="1957" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-29" x="2455" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-3D" x="3122" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-66" x="4178" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-28" x="4729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-79" x="5118" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-2C" x="5616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-78" x="6061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-29" x="6633" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>y</mi><mo>,</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2"> f (x, y) = f (y, x) </script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teilbestellung</a> <br>  Reflexivität + Transitivität + Antisymmetrie <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Halbgitter</a> <br>  Teilweise bestelltes Set mit exakter Oberseite (Unterseite) <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Versionsvektor</a> <br>  Ein Dimensionsvektor ist gleich der Anzahl der Knoten, und jeder Knoten erhöht bei Auftreten eines bestimmten Ereignisses seinen Wert im Vektor.  Während der Synchronisation werden Daten mit diesem Vektor übertragen, und dies führt eine Ordnungsbeziehung ein, mit der Sie bestimmen können, welches Replikat alte / neue Daten enthält. </li></ol><br><h1>  5. Modelle synchronisieren </h1><br><h3>  Staatsbasiert: </h3><br>  Es wird auch als passive Synchronisation bezeichnet und bildet den konvergenten replizierten Datentyp - CvRDT. <br>  Es wird in Dateisystemen wie NFS, AFS, Coda und in KV-Speichern Riak, Dynamo verwendet <br>  In diesem Fall tauschen die Replikate den Status direkt aus, das empfangende Replikat führt den empfangenen Status mit seinem aktuellen Status zusammen. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/ac/r_/7b/acr_7blhm_vkl7rwgfenmjpvdus.png" alt="Bild"></div><br>  Um die Konvergenz von Replikaten mithilfe dieser Synchronisierung durchzuführen, ist Folgendes erforderlich: <br><br><ul><li>  Die Daten bildeten ein Halbgitter </li><li>  Die Zusammenführungsfunktion ergab eine genaue Obergrenze </li><li>  Die Repliken bildeten einen zusammenhängenden Graphen. </li></ul><br>  Ein Beispiel: <br><br><ul><li>  Datensatz: natürliche Zahlen <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.088ex" height="2.057ex" viewBox="0 -780.1 4343.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-62" x="3025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-4E" x="3455" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb {N} </script></li><li>  Mindestartikel: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>f</mi><mi>t</mi><mi>y</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.86ex" height="2.419ex" viewBox="0 -780.1 3384 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-2212" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-69" x="1028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-6E" x="1374" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-66" x="1974" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-74" x="2525" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-79" x="2886" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>f</mi><mi>t</mi><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> - \ infty </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.727ex" height="2.66ex" viewBox="0 -832 10646.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-6D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-65" x="878" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-72" x="1345" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-67" x="1796" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-65" x="2277" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-28" x="2743" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-78" x="3133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-2C" x="3705" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-79" x="4150" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-29" x="4648" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-3D" x="5315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-6D" x="6371" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-61" x="7250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-78" x="7779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-28" x="8352" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-78" x="8741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-2C" x="9314" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMATHI-79" x="9759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/418897/&amp;usg=ALkJrhiPJE48tA0wxV889RP11H2It9yNJg#MJMAIN-29" x="10256" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mi>e</mi><mi>r</mi><mi>g</mi><mi>e</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5"> merge (x, y) = max (x, y) </script></li></ul><br>  Solche Anforderungen geben uns eine <b>kommutative</b> und <b>idempotente</b> Zusammenführungsfunktion, die auf einem bestimmten Datensatz <b>monoton wächst</b> : <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/jn/nw/vl/jnnwvlfp_tjkank2zknwdcbj-oc.png" alt="Bild"></div><br>  Dies stellt sicher, dass die Replikate früher oder später konvergieren und Sie sich keine Gedanken über das Datenübertragungsprotokoll machen müssen. <b>Wir können Nachrichten mit einem neuen Status verlieren, sie mehrmals senden und sie sogar in beliebiger Reihenfolge senden</b> . <br><br><h3>  Betriebsbasiert: </h3><br>  Es wird auch als aktive Synchronisation bezeichnet und bildet den kommutativen replizierten Datentyp - CmRDT. <br>  Wird in kooperativen Systemen wie Bayou, Rover, IceCube, Telex verwendet. <br><br>  In diesem Fall tauschen die Replikate Statusaktualisierungsvorgänge aus.  Beim Aktualisieren von Daten wird das ursprüngliche Replikat: <br><br><ul><li>  Ruft die generate () -Methode auf, die die effector () -Methode zurückgibt, die auf anderen Replikaten ausgeführt werden soll.  Mit anderen Worten, effector () ist der Abschluss zum Ändern des Status der verbleibenden Replikate. </li><li>  Anwenden eines Effektors auf einen lokalen Staat </li><li>  Sendet den Effektor an alle anderen Repliken </li></ul><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/bd/i3/ps/bdi3pshr57wi0udnldnurhcdpfs.png" alt="Bild"></div><br>  Um eine Konvergenz von Replikaten durchzuführen, müssen die folgenden Bedingungen erfüllt sein: <br><br><ul><li>  Zuverlässiges Lieferprotokoll </li><li>  Wenn der Effektor gemäß der eingegebenen Reihenfolge (für einen bestimmten Typ) an alle Replikate geliefert wird, sind simultane Effektoren kommutativ <b>oder</b> </li><li>  Wenn der Effektor an alle Replikate geliefert wird, ohne die Bestellung zu berücksichtigen, sind alle Effektoren kommutativ. </li><li>  Wenn der Effektor mehrmals geliefert werden kann, muss er idempotent sein </li><li>  Einige Implementierungen verwenden Warteschlangen (Kafka) als Teil des Übermittlungsprotokolls. </li></ul><br><h3>  Delta-basiert: </h3><br>  In Anbetracht des Status / op-basiert ist leicht zu erkennen, dass es keinen Sinn macht, den gesamten Status zu senden, wenn ein Update nur einen Teil des Status ändert. Wenn eine große Anzahl von Änderungen einen Status (z. B. einen Zähler) betrifft, können Sie eine aggregierte Änderung und nicht alle Vorgänge senden Änderungen. <br><br>  Die Delta-Synchronisation kombiniert beide Ansätze und sendet Delta-Mutatoren aus, die den Status gemäß dem letzten Synchronisationsdatum aktualisieren.  Bei der anfänglichen Synchronisation muss der Status vollständig gesendet werden, und einige Implementierungen berücksichtigen in solchen Fällen bereits den Status der verbleibenden Replikate, wenn Delta-Mutatoren erstellt werden. <br><br>  Die nächste Optimierungsmethode besteht darin, das op-basierte Protokoll zu komprimieren, wenn Verzögerungen zulässig sind. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rd/vi/a5/rdvia5kv708z55ndt_t5j_leaum.png" alt="Bild"></div><br><h3>  Rein betriebsbasiert: </h3><br>  Es gibt eine Verzögerung beim Erstellen eines Opektors bei der op-basierten Synchronisation.  In einigen Systemen ist dies möglicherweise nicht akzeptabel. Dann müssen Sie die ursprüngliche Änderung auf Kosten der Komplikation des Protokolls und der zusätzlichen Menge an Metadaten senden. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/3l/p2/r2/3lp2r2ruizjddxllrwgbgwh5ykw.png" alt="Bild"></div><br><h3>  Standardanwendungsansätze: </h3><br><ul><li>  Wenn Updates <b>sofort</b> im System <b>gesendet werden</b> sollen, ist zustandsbasiert eine schlechte Wahl, da das Versenden des gesamten Status teurer ist als nur ein Update-Vorgang.  Delta-basiert funktioniert besser, aber in diesem speziellen Fall ist der Unterschied zu zustandsbasiert gering. </li><li>  Wenn Sie <b>das Replikat nach einem Fehler synchronisieren</b> müssen, sind zustandsbasiert und deltabasiert die perfekte Wahl.  Wenn Sie op-based verwenden müssen, stehen folgende Optionen zur Verfügung: <br><br>  1) Wirf alle verpassten Operationen ab dem Moment des Ausfalls <br>  2) Eine vollständige Kopie einer der Replikate und ein Rollback verpasster Vorgänge </li><li>  Wie oben erwähnt, erfordert op-based, dass Updates genau einmal an jedes Replikat gesendet werden.  Die Lieferanforderung kann nur einmal weggelassen werden, wenn der Effektor idempotent ist.  In der Praxis ist es viel einfacher, die erste als die zweite zu implementieren. </li></ul><br><h3>  Die Beziehung zwischen Op-basiert und State-basiert: </h3><br>  Zwei Ansätze können durcheinander emuliert werden, daher werden wir in Zukunft CRDT ohne Bezugnahme auf ein bestimmtes Synchronisationsmodell betrachten. <br><br><h1>  6. CRDT </h1><br><h2>  6.1 Zähler </h2><br>  Eine Ganzzahl, die zwei Operationen unterstützt: inc und dec.  Betrachten Sie als Beispiel mögliche Implementierungen für op- und zustandsbasierte Synchronisationen: <br><br><h3>  Op-basierter Zähler: </h3><br>  Natürlich nur Updates senden.  Beispiel für inc: <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> function (counter) { counter += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre> <br><h3>  Staatszähler: </h3><br>  Die Implementierung ist nicht mehr so ​​offensichtlich, da unklar ist, wie die Zusammenführungsfunktion aussehen soll. <br><br>  Betrachten Sie die folgenden Optionen: <br><br>  <u>Monoton ansteigender Zähler (nur Inkrementzähler, G-Zähler):</u> <br><br>  Die Daten werden als Vektor mit einer Dimension gespeichert, die der Anzahl der Knoten (Versionsvektor) entspricht, und jedes Replikat erhöht den Positionswert mit seiner ID. <br><br>  Die Zusammenführungsfunktion nimmt an den entsprechenden Positionen ein Maximum ein, und der Endwert ist die Summe aller Elemente des Vektors <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;begin&amp;#xA0;{align}&amp;#xA0;inc&amp;#xA0;()&amp;#xA0;&amp;amp;:&amp;#xA0;V&amp;#xA0;[id&amp;#xA0;()]&amp;#xA0;=&amp;#xA0;V&amp;#xA0;[id&amp;#xA0;()]&amp;#xA0;+&amp;#xA0;1&amp;#xA0;\\&amp;#xA0;value&amp;#xA0;()&amp;#xA0;&amp;amp;:&amp;#xA0;\&amp;#xA0;sum_&amp;#xA0;{i&amp;#xA0;=&amp;#xA0;0}&amp;#xA0;^&amp;#xA0;{n}&amp;#xA0;V&amp;#xA0;[i]&amp;#xA0;\\&amp;#xA0;Merge&amp;#xA0;(C_1,&amp;#xA0;C_2)&amp;#xA0;&amp;amp;:&amp;#xA0;i&amp;#xA0;\&amp;#xA0;in&amp;#xA0;[1..n]&amp;#xA0;\&amp;#xA0;Ergebnis&amp;#xA0;[i]&amp;#xA0;=&amp;#xA0;max&amp;#xA0;(C_1.V&amp;#xA0;[i],&amp;#xA0;C_2.V&amp;#xA0;[i])&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{align}</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;begin&nbsp;{align}&nbsp;inc&nbsp;()&nbsp;&amp;:&nbsp;V&nbsp;[id&nbsp;()]&nbsp;=&nbsp;V&nbsp;[id&nbsp;()]&nbsp;+&nbsp;1&nbsp;\\&nbsp;value&nbsp;()&nbsp;&amp;:&nbsp;\&nbsp;sum_&nbsp;{i&nbsp;=&nbsp;0}&nbsp;^&nbsp;{n}&nbsp;V&nbsp;[i]&nbsp;\\&nbsp;Merge&nbsp;(C_1,&nbsp;C_2)&nbsp;&amp;:&nbsp;i&nbsp;\&nbsp;in&nbsp;[1..n]&nbsp;\&nbsp;Ergebnis&nbsp;[i]&nbsp;=&nbsp;max&nbsp;(C_1.V&nbsp;[i],&nbsp;C_2.V&nbsp;[i])&nbsp;\&nbsp;end&nbsp;{align}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\&nbsp;begin&nbsp;{align}&nbsp;inc&nbsp;()&nbsp;&amp;:&nbsp;V&nbsp;[id&nbsp;()]&nbsp;=&nbsp;V&nbsp;[id&nbsp;()]&nbsp;+&nbsp;1&nbsp;\\&nbsp;value&nbsp;()&nbsp;&amp;:&nbsp;\&nbsp;sum_&nbsp;{i&nbsp;=&nbsp;0}&nbsp;^&nbsp;{n}&nbsp;V&nbsp;[i]&nbsp;\\&nbsp;Merge&nbsp;(C_1,&nbsp;C_2)&nbsp;&amp;:&nbsp;i&nbsp;\&nbsp;in&nbsp;[1..n]&nbsp;\&nbsp;Ergebnis&nbsp;[i]&nbsp;=&nbsp;max&nbsp;(C_1.V&nbsp;[i],&nbsp;C_2.V&nbsp;[i])&nbsp;\&nbsp;end&nbsp;{align}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \ begin {align} inc () &: V [id ()] = V [id ()] + 1 \\ value () &: \ sum_ {i = 0} ^ {n} V [i] \\ Merge (C_1, C_2) &: i \ in [1..n] \ Ergebnis [i] = max (C_1.V [i], C_2.V [i]) \ end {align} </script></p><br>  Sie können auch das G-Set verwenden (siehe unten) <br><br>  Anwendung: <br><br><ul><li>  Klicks / Treffer zählen (sic!) </li></ul><br>  <u>Zähler mit Dekrementunterstützung (PN-Zähler)</u> <br><br>  Wir starten zwei G-Zähler - einen für Inkrementierungsoperationen, den zweiten - für Dekrementierung <br><br>  Anwendung: <br><br><ul><li>  Die Anzahl der angemeldeten Benutzer in einem P2P-Netzwerk, z. B. Skype </li></ul><br>  <u>Nicht negativer Zähler</u> <br><br>  Eine einfache Implementierung existiert noch nicht.  Schlagen Sie Ihre Ideen in den Kommentaren vor, diskutieren Sie. <br><br><h2>  6.2 Registrieren </h2><br>  Eine Speicherzelle mit zwei Operationen - Zuweisen (Schreiben) und Wert (Lesen). <br>  Das Problem ist, dass die Zuweisung nicht kommutativ ist.  Es gibt zwei Ansätze, um dieses Problem zu lösen: <br><br><h3>  Last-Write-Wins-Register (LWW-Register): </h3><br>  Wir geben die vollständige Reihenfolge durch die Generierung einer eindeutigen ID für jede Operation ein (z. B. Zeitstempel). <br><br>  Ein Beispiel für die Synchronisation ist der Austausch von Paaren (Wert, ID): <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rw/8m/1k/rw8m1k8wgby7v0gczcthhdmdvns.png"></div><br>  Anwendung: <br><br><ul><li>  Spalten in Cassandra </li><li>  NFS - Datei ganz oder teilweise </li></ul><br><h3>  Register mit mehreren Werten (Multi-Value Register, MV-Register): </h3><br>  Der Ansatz ähnelt einem G-Zähler - wir speichern die Menge (Wert, Versionsvektor).  Wert registrieren - alle Werte beim Zusammenführen - LWW separat für jeden Wert im Vektor. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/o3/kr/vc/o3krvcuowzsa-vi_avn27jcscxk.png"></div><br>  Anwendung: <br><br><ul><li>  Korb in Amazon.  Damit ist ein bekannter Fehler verbunden, der nach dem Entfernen eines Artikels aus dem Warenkorb dort erneut angezeigt wird.  Der Grund ist, dass das Register trotz der Tatsache, dass es eine Reihe von Werten speichert, keine Menge ist (siehe Abbildung unten).  Amazon betrachtet dies übrigens nicht einmal als Fehler - es steigert sogar den Umsatz. </li><li>  Riak.  In einem allgemeineren Fall verschieben wir das Problem der Auswahl des tatsächlichen Werts (Hinweis - es gibt keinen Konflikt!) Auf die Anwendung. </li></ul><br>  Erklärung des Fehlers in Amazon: <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/k0/au/le/k0auleq-jjcrfdtkdswe8tfdxnq.png"></div><br><br><h2>  6.3 Lose </h2><br>  Die Menge ist der Grundtyp für die Erstellung von Containern, Karten und Diagrammen und unterstützt Operationen - add und rmv, die nicht kommutativ sind. <br><br>  Betrachten Sie die naive Implementierung der op-basierten Menge, in der add und rmv ausgeführt werden, sobald sie eintreffen (add kommt gleichzeitig zu 1 und 2 Replikaten, dann geht rmv zu 1). <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/yk/uu/3b/ykuu3b4-brgkjj2p4y32gmytafs.png"></div><br>  Wie Sie sehen können, haben sich die Repliken schließlich aufgelöst.  Betrachten Sie die verschiedenen Optionen zum Erstellen konfliktfreier Mengen: <br><br><h3>  Wachsendes Set (G-Set): </h3><br>  Die einfachste Lösung besteht darin, zu verhindern, dass Elemente gelöscht werden.  Alles, was bleibt, ist die Kommutierungsoperation, die kommutativ ist.  Die Zusammenführungsfunktion ist die Vereinigung von Mengen. <br><br><h3>  Zweiphasenset (2P-Set): </h3><br>  Wir erlauben Ihnen das Löschen, aber Sie können es nach dem Entfernen nicht wieder hinzufügen.  Zur Implementierung richten wir einen separaten Satz entfernter G-Set-Elemente ein (ein solcher Satz wird als Tombstone-Satz bezeichnet). <br>  Beispiel für zustandsbasiert: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;begin&amp;#xA0;{align}&amp;#xA0;lookup&amp;#xA0;(e)&amp;#xA0;&amp;amp;:&amp;#xA0;e&amp;#xA0;\&amp;#xA0;in&amp;#xA0;A&amp;#xA0;\&amp;#xA0;land&amp;#xA0;e&amp;#xA0;\&amp;#xA0;notin&amp;#xA0;R&amp;#xA0;\\&amp;#xA0;add&amp;#xA0;(e)&amp;#xA0;&amp;amp;:&amp;#xA0;A&amp;#xA0;=&amp;#xA0;A&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;\&amp;#xA0;{e&amp;#xA0;\}&amp;#xA0;\\&amp;#xA0;rmv&amp;#xA0;(e)&amp;#xA0;&amp;amp;:&amp;#xA0;R&amp;#xA0;=&amp;#xA0;R&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;\&amp;#xA0;{e&amp;#xA0;\}&amp;#xA0;\\&amp;#xA0;zusammenf&amp;#xFC;hren&amp;#xA0;(S_1,&amp;#xA0;S_2)&amp;#xA0;&amp;amp;:&amp;#xA0;\\&amp;#xA0;Res&amp;#xA0;&amp;amp;&amp;#xA0;ult.A&amp;#xA0;=&amp;#xA0;S_1.A&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;S_2.A&amp;#xA0;\\&amp;#xA0;Res&amp;#xA0;&amp;amp;&amp;#xA0;ult.R&amp;#xA0;=&amp;#xA0;S_1.R&amp;#xA0;\&amp;#xA0;cup&amp;#xA0;S_2.R&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{align}</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;begin&nbsp;{align}&nbsp;lookup&nbsp;(e)&nbsp;&amp;:&nbsp;e&nbsp;\&nbsp;in&nbsp;A&nbsp;\&nbsp;land&nbsp;e&nbsp;\&nbsp;notin&nbsp;R&nbsp;\\&nbsp;add&nbsp;(e)&nbsp;&amp;:&nbsp;A&nbsp;=&nbsp;A&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;rmv&nbsp;(e)&nbsp;&amp;:&nbsp;R&nbsp;=&nbsp;R&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;zusammenführen&nbsp;(S_1,&nbsp;S_2)&nbsp;&amp;:&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.A&nbsp;=&nbsp;S_1.A&nbsp;\&nbsp;cup&nbsp;S_2.A&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.R&nbsp;=&nbsp;S_1.R&nbsp;\&nbsp;cup&nbsp;S_2.R&nbsp;\&nbsp;end&nbsp;{align}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\&nbsp;begin&nbsp;{align}&nbsp;lookup&nbsp;(e)&nbsp;&amp;:&nbsp;e&nbsp;\&nbsp;in&nbsp;A&nbsp;\&nbsp;land&nbsp;e&nbsp;\&nbsp;notin&nbsp;R&nbsp;\\&nbsp;add&nbsp;(e)&nbsp;&amp;:&nbsp;A&nbsp;=&nbsp;A&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;rmv&nbsp;(e)&nbsp;&amp;:&nbsp;R&nbsp;=&nbsp;R&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;zusammenführen&nbsp;(S_1,&nbsp;S_2)&nbsp;&amp;:&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.A&nbsp;=&nbsp;S_1.A&nbsp;\&nbsp;cup&nbsp;S_2.A&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.R&nbsp;=&nbsp;S_1.R&nbsp;\&nbsp;cup&nbsp;S_2.R&nbsp;\&nbsp;end&nbsp;{align}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \ begin {align} lookup (e) &: e \ in A \ land e \ notin R \\ add (e) &: A = A \ cup \ {e \} \\ rmv (e) &: R = R \ cup \ {e \} \\ zusammenführen (S_1, S_2) &: \\ Res & ult.A = S_1.A \ cup S_2.A \\ Res & ult.R = S_1.R \ cup S_2.R \ end {align} </script></p><br><h3>  LWW-Element Set: </h3><br>  Die nächste Möglichkeit, eine konfliktfreie Menge zu implementieren, besteht darin, eine vollständige Reihenfolge einzuführen. Eine der Optionen besteht darin, für jedes Element eindeutige Zeitstempel zu generieren. <br><br>  Wir erhalten zwei Mengen - add-set und remove-set, wenn add () aufgerufen wird, add (element, unique_id ()), wenn überprüft wird, ob sich ein Element in der Menge befindet - schauen Sie, wo der Zeitstempel größer ist - in remove-set oder in add-set <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/iw/gt/95/iwgt95jsuu9xps80j0w-sjgweq4.png"></div><br><h3>  PN-Set: </h3><br>  Variation mit der Reihenfolge der Menge - wir starten einen Zähler für jedes Element, wenn wir es hinzufügen, erhöhen wir es, wenn wir es löschen, verringern wir es.  Ein Element befindet sich in der Menge, wenn sein Zähler positiv ist. <br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/nf/qz/dw/nfqzdwf7risphmn8qyuq0tsjc3s.png"></div><br>  Beachten Sie den interessanten Effekt: In der dritten Replik führt das Hinzufügen eines Elements nicht zu dessen Erscheinungsbild. <br><br><h3>  Beobachten-Entfernen-Set, ODER-Set, Add-Win-Set: </h3><br>  Bei diesem Typ hat Hinzufügen Vorrang vor Entfernen.  Implementierungsbeispiel: Jedem neu hinzugefügten Element wird ein eindeutiges Tag zugewiesen (relativ zum Element und nicht zum gesamten Satz).  Rmv entfernt ein Element aus der Menge und sendet alle gesehenen Paare (Element, Tag) zur Entfernung an die Replikate. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/5n/ac/1l/5nac1lanif5y_kh_w9rvaz-jqoe.png"></div><br><br><h3>  Remove-Win-Set: </h3><br>  Ähnlich wie beim vorherigen, aber gleichzeitig gewinnt / rmv rmv. <br><br><h2>  6.4 Grafik </h2><br>  Dieser Typ basiert auf vielen.  Das Problem ist folgendes: Wenn gleichzeitig Operationen addEdge (u, v) und removeVertex (u) ausgeführt werden - was soll ich tun?  Folgende Optionen sind möglich: <br><br><ul><li>  RemoveVertex-Priorität, alle Kanten, die auf diesen Scheitelpunkt fallen, werden gelöscht </li><li>  AddEdge-Priorität, gelöschte Scheitelpunkte wiederhergestellt </li><li>  Wir verzögern die Ausführung von removeVertex, bis alle gleichzeitigen addEdge ausgeführt werden. </li></ul><br>  Die einfachste Option ist die erste, für die Implementierung (2P2P-Graph) reicht es aus, zwei 2P-Sets zu erhalten, eines für die Eckpunkte und das zweite für die Kanten <br><br><h2>  6.5 Karte </h2><br><h3>  Karte der Literale: </h3><br>  Zwei zu lösende Probleme: <br><br><ul><li>  Was tun bei gleichzeitigen Put-Operationen?  In Analogie zu Zählern können Sie entweder LWW- oder MV-Semantik wählen </li><li>  Was tun mit simultan put / rmv?  In Analogie zu Sets können Sie entweder Put-Wins- oder RMV-Wins- oder Last-Put-Wins-Semantik verwenden. </li></ul><br><h3>  CRDT-Zuordnung (Karte der CRDTs): </h3><br>  Ein interessanter Fall, weil  Ermöglicht das Erstellen verschachtelter Zuordnungen.  Fälle, in denen verschachtelte Typen geändert werden, werden nicht berücksichtigt. Dies sollte vom verschachtelten CRDT selbst entschieden werden. <br><br>  <u>Karte als rekursiv zurücksetzen entfernen</u> <br><br>  Die Entfernungsoperation "setzt" den Typwert auf einen bestimmten Startzustand zurück.  Für einen Zähler ist dies beispielsweise ein Nullwert. <br><br>  Betrachten Sie ein Beispiel - eine allgemeine Einkaufsliste.  Einer der Benutzer fügt Mehl hinzu und der zweite führt eine Kaufabwicklung durch (dies führt zu einem Aufruf des Löschvorgangs für alle Elemente).  Infolgedessen bleibt eine Einheit Mehl auf der Liste, was logisch erscheint. <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/9g/sn/4j/9gsn4jdmbdg_ba1hdrmftl5mcgy.png"></div><br>  <u>Karte entfernen-gewinnt</u> <br><br>  Die Operation rmv hat Vorrang. <br><br>  Beispiel: In einem Online-Spiel hat ein Alice-Spieler 10 Münzen und einen Hammer.  Dann treten gleichzeitig zwei Ereignisse auf: Auf Replik A hat sie einen Nagel hergestellt, und auf Replik B wird ihr Charakter durch Entfernen aller Objekte gelöscht: <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/tb/xd/6s/tbxd6s7eun3rpn57mnwt9d4hbxa.png"></div><br><br>  Beachten Sie, dass bei Verwendung von "Entfernen als rekursiv" möglicherweise ein Nagel verbleibt. Dies ist nicht der richtige Zustand, wenn das Zeichen entfernt wird. <br><br>  <u>Update gewinnt Karte</u> <br><br>  Aktualisierungen haben Vorrang oder brechen frühere Vorgänge ab, um gleichzeitig rmv zu löschen. <br><br>  Beispiel: In einem Online-Spiel wird der Alice-Charakter auf Replik B aufgrund von Inaktivität gelöscht, aber gleichzeitig wird Aktivität auf Replik A ausgeführt.  Offensichtlich muss der Löschvorgang abgebrochen werden. <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/63/oz/5y/63oz5yzch4ioguyram3erawkzl0.png"></div><br>  Bei der Arbeit mit einer solchen Implementierung gibt es einen interessanten Effekt: Angenommen, wir haben zwei Replikate, A und B, und sie speichern die Menge mit einem Schlüssel k.  Wenn dann A den Wert des Schlüssels k löscht und B alle Elemente der Menge löscht, hinterlassen die Replikate am Ende eine leere Menge mit dem Schlüssel k. <br><br>  Beachten Sie, dass eine naive Implementierung nicht ordnungsgemäß funktioniert. Sie können nicht einfach alle vorherigen Löschvorgänge rückgängig machen.  Im folgenden Beispiel wäre bei diesem Ansatz der Endzustand der Anfangszustand, was falsch ist: <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/mp/un/hm/mpunhmkzj125hqob4net7iq7kc4.png"></div><br><h2>  Liste </h2><br>  Das Problem bei diesem Typ besteht darin, dass Elementindizes auf verschiedenen Replikaten nach lokalen Einfüge- / Löschvorgängen unterschiedlich sind.  Um dieses Problem zu lösen, wird der Operational Transformation-Ansatz angewendet. Bei der Anwendung der erhaltenen Änderung sollte der Index des Elements im ursprünglichen Replikat berücksichtigt werden. <br><br><h1>  7. Riak </h1><br>  Betrachten Sie als Beispiel CRDT in Riak: <br><br><ul><li>  Zähler: PN-Zähler </li><li>  Set: OR-Set </li><li>  Karte: Update gewinnt Karte der CRDTs </li><li>  (Boolesches) Flag: OR-Set wo maximal 1 Element </li><li>  Register: Paare (Wert, Zeitstempel) </li></ul><br><h1>  8. Wer verwendet CRDT? </h1><br>  Der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki-</a> Bereich enthält gute Beispiele. <br><br><h1>  9. Referenzen </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Key-CRDT-Speicher</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein konfliktfrei replizierter JSON-Datentyp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eine umfassende Studie zu konvergenten und kommutativ replizierten Datentypen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konvergenter und kommutativer replizierter Datentyp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfliktfreier replizierter Datentyp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein Bluffers Guide für CRDTs in Riak</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CRDTs: Ein UPDATE (oder nur ein PUT)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfliktfreie replizierte Datentypen: Ein Überblick</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Starke Konsistenz und konfliktfreie replizierte Datentypen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eventuell konsistente Datenstrukturen</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418897/">https://habr.com/ru/post/de418897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418885/index.html">Crispr kann natürliche Prozesse beschleunigen und den Anbau von Lebensmitteln verändern</a></li>
<li><a href="../de418887/index.html">Wie schnell expandiert das Universum?</a></li>
<li><a href="../de418889/index.html">Handbuch für manuelle Anwendungstests: Vorteile, Schritte und Methoden</a></li>
<li><a href="../de418891/index.html">Wir haben die Android-Quellcodes mit PVS-Studio überprüft, oder niemand ist perfekt</a></li>
<li><a href="../de418895/index.html">Lerne künstliche Intelligenz, um ein Spiel zu spielen</a></li>
<li><a href="../de418899/index.html">Erste Eindrücke und Aktionen nach dem Upgrade von MySQL von Version 5.7 auf 8.0.11</a></li>
<li><a href="../de418901/index.html">Die Russen gewannen die Mehrheit der Goldmedaillen bei der Europäischen Informatikolympiade eJOI 2018</a></li>
<li><a href="../de418903/index.html">Wissenschaftler: Es gibt nicht genug CO₂ auf dem Mars, um die Atmosphäre zu erwärmen. Polexplosion wird nicht helfen</a></li>
<li><a href="../de418907/index.html">So bringen Sie Zabbix bei, Problembenachrichtigungen direkt an den Desktop zu senden</a></li>
<li><a href="../de418909/index.html">Python führt: Wer und warum verwendet es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>