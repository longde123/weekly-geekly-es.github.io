<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜî üí£ üî© Compatibilit√© binaire: maintenant ou jamais üíÖüèΩ üöµüèæ ‚ûø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Traduction de la publication de Titus Winters dans le groupe de travail 21 (WG21) - Comit√© de normalisation du langage C ++. L'auteur discute d'une qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Compatibilit√© binaire: maintenant ou jamais</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474294/"><p>  <i>Traduction de la publication de Titus Winters dans le groupe de travail 21 (WG21) - Comit√© de normalisation du langage C ++.</i>  <i>L'auteur discute d'une question importante: la prise en charge de la compatibilit√© binaire en amont ou ABI (interface binaire d'application).</i> <br><br></p><p>  Au cours des derni√®res ann√©es au WG21, j'ai activement promu que le progr√®s est plus important que la compatibilit√© descendante.  Mais je n'y crois plus moi-m√™me, notamment en ce qui concerne le maintien de la compatibilit√© binaire (ABI). <a name="habracut"></a>  Dans les trois derni√®res versions (C ++ 14, C ++ 17 et C ++ 20), ABI √©tait aussi stable que possible.  M√™me si WG21 d√©cide de rompre la compatibilit√© descendante ABI en C ++ 23, nous fournissons la compatibilit√© binaire sur de nombreuses plateformes depuis plus de 10 ans.  √Ä mon avis, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">loi d'Hyrum</a> domine dans les modifications √† grande √©chelle des syst√®mes logiciels.  Maintenant, vous ne pouvez pas dire combien d'utilisateurs ont l'hypoth√®se de la stabilit√© de la biblioth√®que standard ABI (quelle que soit sa sagesse ou son explicite ou implicite) est fermement ¬´cousue dans le sous-cortex¬ª, peut-√™tre la moiti√© des d√©veloppeurs C ++ dans le monde. </p><br><p> Je garde une liste de ce que WG21 pourrait corriger dans la langue si nous d√©cidons de ¬´casser¬ª l'ABI.  Et je ne peux pas affirmer avec certitude que le co√ªt total des retouches, qui impliquera la mise en ≈ìuvre de cette liste uniquement, est comparable au co√ªt de la violation de l'ABI dans tout l'√©cosyst√®me.  Nous avons vu de nombreuses petites am√©liorations dans la coh√©rence de l'API, la qualit√© du code de biblioth√®que standard, etc., mais sans aucun doute il n'y a pas un seul changement ¬´r√©volutionnaire¬ª qui justifierait ce co√ªt pour le d√©veloppeur moyen.  Nous pourrions peut-√™tre obtenir de meilleures impl√©mentations de la norme, donner une chance de r√©soudre les probl√®mes d'impl√©mentations qui ne sont pas conformes aux sp√©cifications de la norme aujourd'hui.  Mais aucune am√©lioration de ma liste ne vaut clairement le co√ªt. </p><br><p>  Plus important encore, en raison des limitations ABI, nous ne pouvons pas √©liminer les pertes de performances significatives.  Nous ne pouvons pas nous d√©barrasser du co√ªt important du passage de unique_ptr par valeur [le discours de Chandler sur CppCon 2019 sera publi√© plus tard], nous ne pouvons pas changer std :: hash ou le placement de la classe en m√©moire pour unordered_map sans forcer tout le monde √† tout recompiler partout.  Les performances des hachages ont √©t√© largement √©tudi√©es au fil des ans et, compte tenu de l'optimisation des recherches dans le tableau et du hachage proprement dit, nous sommes convaincus que nous pouvons fournir une impl√©mentation unordered_map / std :: hash compatible avec l'API et offrant une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">am√©lioration des performances de</a> 200 √† 300%.  Mais les restrictions ABI ne le permettent pas.  Des √©tudes suppl√©mentaires sur l'optimisation et le r√©glage de l'authentification unique pour std :: string sugg√®rent une augmentation non n√©gligeable des performances (1% dans les rep√®res microbiens et la mise √† l'√©chelle) - l'API n'est pas affect√©e, mais les restrictions ABI ne le permettent pas. <br><br>  La perte totale de productivit√© bloqu√©e exclusivement par ABI atteint plusieurs points de pourcentage - peut-√™tre jusqu'√† 5-10%.  Ce n'est pas quelque chose dont l'√©cosyst√®me dans son ensemble ne peut se passer, mais il peut ne pas √™tre acceptable pour certaines organisations (Google parmi elles).  Bien s√ªr, cela repr√©sente une perte de performances importante par rapport √† ce qui est acceptable pour C ++: rappelez-vous qu'il s'agit d'un langage qui pr√©tend qu'il ne laisse aucune place √† un concurrent plus productif.  La plupart des utilisateurs ne semblent pas pr√©occup√©s par cette d√©gradation des performances: il existe d'autres impl√©mentations de table de hachage pour ceux qui sont pr√©occup√©s par les performances absolues.  L'inefficacit√© g√©n√©rale associ√©e √† la transmission de valeur unique_ptr et √† d'autres probl√®mes du langage ABI appara√Æt au premier plan dans un tr√®s petit nombre de t√¢ches.  Les organisations qui ont besoin d'une productivit√© maximale peuvent suivre leur propre chemin (et le faire), en utilisant des biblioth√®ques non standard et des outils de configuration non standard.  Ceci est naturel et doit √™tre clairement compris. </p><br><br>  Un changement dans ABI affectera un nombre relativement plus grand d'utilisateurs.  Je soup√ßonne qu'une proportion importante de ces utilisateurs ne soup√ßonnent pas √† quel point leur d√©pendance √† l'ABI est forte.  Dans l'√©cosyst√®me des serveurs de Google, presque tout est collect√© √† la source, il y a peu de d√©pendances externes et il y a une opportunit√© meilleure que la moyenne d'entreprendre un refactoring √† grande √©chelle.  Mais m√™me pour nous, les r√©cents changements r√©volutionnaires de la biblioth√®que ABI ont co√ªt√© 5 √† 10 ann√©es d'ing√©nierie. <br><p>  Le co√ªt total de la rupture de la compatibilit√© descendante ABI pour l'ensemble de l'√©cosyst√®me C ++ peut √™tre estim√© de mani√®re prudente dans ¬´ <b>Millennium Engineer</b> ¬ª: coordonner la reconstruction pour chaque fournisseur de plug-ins, .so ou dll dans le monde n√©cessitera d'√©normes ressources humaines.  Avec la s√©paration de l'√©cosyst√®me due aux modules C ++ 20, la modification de l'ABI dans le calendrier de d√©veloppement et de mise en ≈ìuvre de C ++ 23 peut conduire √† une s√©paration difficile de l'√©cosyst√®me. </p><br><br><p>  Il y a beaucoup de questions auxquelles cette discussion ne peut r√©pondre.  Combien de temps pouvons-nous continuer au point o√π le changement de l'ABI de juste utile deviendra une n√©cessit√© critique?  Si nous choisissons explicitement le support de stabilit√© ABI, combien co√ªtera le changement quand et quand un tel besoin critique se pr√©sentera?  Si des probl√®mes de s√©curit√© tels que Spectre et Meltdown n√©cessitent une modification de la convention d'appel, combien co√ªtera C ++ pour surmonter cette √©tape?  Quelle proportion de d√©veloppeurs utilise C ++ parce que nous pr√©tendons mettre la performance au-dessus de tout le reste?  Pire: combien de temps le C ++ peut-il pr√©tendre √™tre le langage le plus rapide et ne pas avoir √† faire de telles optimisations? </p><br><p>  Si nous ne pouvons pas consciemment permettre ou ne voulons pas changer l'ABI, alors cette d√©cision doit √™tre exprim√©e haut et fort.  Nous devons clairement dire qu'il s'agit d'un langage qui place la stabilit√© ABI au-dessus des derniers pour cent de productivit√©.  Je suis pr√™t √† affirmer que, dans la pratique, cela a √©t√© le cas ces derni√®res ann√©es.  Nous devons faire savoir aux utilisateurs √† quoi s'attendre de nous, et leur faire savoir que des biblioth√®ques comme Boost, Folly ou Absail sont cens√©es faire le bon choix si des performances sont n√©cessaires.  Mais cela n'aide en rien les restrictions li√©es √† ABI dans le langage lui-m√™me, comme le co√ªt de transmission de unique_ptr.  La biblioth√®que standard conserve son importance dans ce mod√®le de d√©veloppement: la biblioth√®que standard est ce que nous utilisons pour la compatibilit√© et la stabilit√©.  Cela peut n√©cessiter un changement d'orientation et de direction du d√©veloppement: nous pouvons vouloir concevoir pour plus de flexibilit√© dans des conditions changeantes, et non pour des performances ¬´propres¬ª. </p><br><p>  Si nous soutenons que les performances sont plus importantes que la stabilit√© ABI, nous devons imm√©diatement d√©cider quand exactement nous allons "casser" la compatibilit√© descendante et faire tout notre possible pour que l'√©cosyst√®me accepte de tels changements.  Et d√©clarer clairement et haut et fort que nous allons dans cette direction.  Vous devez comprendre que plus le temps s'√©coule entre de tels changements, plus ils deviendront co√ªteux - car au fil du temps, il y aura une d√©pendance de plus en plus non prise en charge sur ABI.  Nos ¬´impl√©menteurs¬ª ont indiqu√© tr√®s clairement que les modifications de la compatibilit√© C ++ 11 √©taient douloureuses et co√ªteuses.  La volont√© d'√©viter la r√©p√©tition de tels co√ªts est naturelle, mais vous devez choisir: soit nous ne les r√©p√©tons pas, car nous ne modifions pas l'ABI, soit nous diminuons les co√ªts. </p><br><p>  En substance, il existe trois possibilit√©s pour WG21: <br><br></p><ol><li>  D√©cider dans quelle version l'ABI sera modifi√©e n'a pas d'importance en C ++ 23 ou C ++ 26.  Avertissez les gens et d√©veloppez imm√©diatement des outils et des diagnostics pour aider √† identifier les endroits qui se briseront.  Se concentre sur des pratiques et des outils plus coh√©rents pour prendre en charge les futurs changements ABI.  Il n'est pas dans l'int√©r√™t d'un impl√©menteur particulier d'exposer ses utilisateurs aux cons√©quences de la modification de l'ABI, si d'autres impl√©mentations ne le font pas, la modification de l'ABI devrait √™tre une activit√© coordonn√©e au profit des futurs utilisateurs.  Id√©alement, vous devez tout casser - pour indiquer clairement que le code compil√© en mode C ++ 23 est incompatible avec le code compil√© dans les modes pr√©c√©dents.  Si quelqu'un peut se passer de la reconstruction et que d'autres auront des erreurs dans la mise en page ou au moment de l'ex√©cution, cela ne fera qu'augmenter les malentendus et les d√©ceptions. </li><li>  D√©cidez que nous visons la stabilit√© de l'ABI en formalisant la pratique d'aujourd'hui.  Cela a √©t√© le cas pendant de nombreuses ann√©es lorsque les impl√©menteurs standard avaient le droit de veto sur les modifications ABI - nous avons d√©j√† plac√© la compatibilit√© descendante ABI au-dessus de la puret√© et des performances de conception.  Si nous reconnaissons cela et disons clairement aux utilisateurs, l'√©cosyst√®me sera meilleur.  La valeur des biblioth√®ques suppl√©mentaires augmentera pour ceux qui ont besoin de presser les derni√®res baisses de performances, mais ne n√©cessitent pas la stabilit√© fournie par la norme.  D'autres langues ax√©es sur les performances pourraient remettre en question notre position √† l'avenir. </li><li>  Ne pas pouvoir choisir une direction et sauver le statu quo.  C'est le pire des cas pour moi: nous continuons implicitement d'accorder plus d'attention √† la compatibilit√© descendante ABI.  Nous disons ¬´performance¬ª et votons ¬´compatibilit√© binaire¬ª.  Une telle dissonance nuit √† l'√©cosyst√®me et implique un manque d'accord sur les priorit√©s linguistiques.  J'esp√®re sinc√®rement que gr√¢ce aux efforts des ex√©cutants et de la DG, nous parviendrons au consensus n√©cessaire. </li></ol><br><p>  Je pense que l'option n ¬∞ 1 convient mieux aux utilisateurs qui ont besoin de performances maximales, mais elle a un co√ªt incroyable pour l'√©cosyst√®me et peut conduire √† une fragmentation de la langue √† l'avenir.  L'option num√©ro 2 est un choix ennuyeux, responsable et digne: il est triste d'admettre que nous nous sommes peints dans le coin de la pi√®ce et essayons de minimiser les pertes qui y sont associ√©es.  Choisir l'option n ¬∞ 3 signifie ne pas g√©rer, et je prie pour que cela soit √©vit√©: tout choix explicite vaut mieux que la dissonance et l'incapacit√© actuelles de parvenir √† un accord sur le choix des objectifs √† long terme. <br><br>  Je comprends que nous avons atteint notre position actuelle gr√¢ce √† de nombreux petits actes d'inaction apparemment raisonnable.  Au cours des 10 derni√®res ann√©es, aucun changement n'a √©t√© apport√© qui pourrait justifier une violation de la compatibilit√© binaire, mais la politique implicite de maintien de la compatibilit√© descendante est devenue destructrice pour l'√©cosyst√®me.  Cependant, en adoptant explicitement une telle politique, nous ouvrirons une autre possibilit√© pour C ++ de quitter progressivement la sc√®ne: vous ne pouvez pas √™tre un langage orient√© syst√®me et ax√© sur les performances, laissant autant de place √† un langage plus productif.  En th√©orie, chaque fournisseur peut d√©cider de ¬´casser¬ª ABI dans toute version future, mais l'orientation g√©n√©rale de la pens√©e semble diff√©rente.  Je suis s√ªr que la discussion et le consensus entre les responsables de la mise en ≈ìuvre de la norme et le WG21 sont n√©cessaires: quelles priorit√©s dois-je choisir? </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr474294/">https://habr.com/ru/post/fr474294/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr474280/index.html">Vous voulez un SGBD de premi√®re main? Une r√©union ouverte √† Nijni Novgorod - √† venir</a></li>
<li><a href="../fr474282/index.html">Explication du Datacenter TCP</a></li>
<li><a href="../fr474284/index.html">Non seulement les futures et les options: quels autres instruments financiers secondaires existent sur les bourses et pas seulement</a></li>
<li><a href="../fr474286/index.html">Analyse d√©taill√©e de la m√©thode simplex</a></li>
<li><a href="../fr474292/index.html">Tutoriel JavaFX: Prise en main</a></li>
<li><a href="../fr474298/index.html">Mise en ≈ìuvre d'une op√©ration de transfert de carte √† carte de passerelle P2P</a></li>
<li><a href="../fr474300/index.html">Sauvegarde fiable, s√©curis√©e et polyvalente pour U2F</a></li>
<li><a href="../fr474302/index.html">Comment √©crire un script de test d'utilisabilit√© d'application efficace</a></li>
<li><a href="../fr474306/index.html">Rendre les styles de pointage, de mise au point et d'√©tat actif diff√©rents</a></li>
<li><a href="../fr474308/index.html">Types pour les API HTTP √©crites en Python: exp√©rience Instagram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>