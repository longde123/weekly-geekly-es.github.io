<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖍️ ✝️ 🔊 Praktische Anwendung der AST-Baumtransformation am Beispiel von Putout 👨‍💻 🍑 👨🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung 


 Jeden Tag, wenn an dem Code gearbeitet wird, werden auf dem Weg zur Implementierung einer für den Benutzer nützlichen Funktion erzwunge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Praktische Anwendung der AST-Baumtransformation am Beispiel von Putout</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439564/"><h2 id="vvedenie">  Einführung </h2><br><p>  Jeden Tag, wenn an dem Code gearbeitet wird, werden auf dem Weg zur Implementierung einer für den Benutzer nützlichen Funktion erzwungene (unvermeidliche oder einfach wünschenswerte) Änderungen am Code.  Dies kann das Refactoring, das Aktualisieren einer Bibliothek oder eines Frameworks auf eine neue Hauptversion und das Aktualisieren der JavaScript-Syntax sein (was in letzter Zeit nicht ungewöhnlich ist).  Selbst wenn die Bibliothek Teil eines Arbeitsprojekts ist, sind Änderungen unvermeidlich.  Die meisten dieser Änderungen sind Routine.  Es gibt nichts Interessantes für den Entwickler in ihnen, einerseits bringt es nichts für das Geschäft, und andererseits müssen Sie während des Aktualisierungsprozesses sehr vorsichtig sein, um Brennholz und Funktionalität nicht zu beschädigen.  Wir kommen daher zu dem Schluss, dass es besser ist, eine solche Routine auf die Schultern von Programmen zu verlagern, damit diese alles selbst tun und die Person wiederum kontrolliert, ob alles richtig gemacht wurde.  Dies wird im heutigen Artikel diskutiert. </p><a name="habracut"></a><br><h2 id="ast">  AST </h2><br><p> Für die Verarbeitung von Programmcode ist es erforderlich, ihn in eine spezielle Darstellung zu übersetzen, mit der Programme bequem arbeiten können.  Eine solche Darstellung existiert, sie heißt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Abstract Syntax Tree</a> (AST). <br>  Verwenden Sie Parser, um es zu erhalten.  Der resultierende AST kann beliebig transformiert werden. Um das Ergebnis zu speichern, benötigen Sie einen Codegenerator.  Lassen Sie uns jeden der Schritte genauer betrachten.  Beginnen wir mit dem Parser. </p><br><h3 id="parser">  Parser </h3><br><p>  Und so haben wir den Code: </p><br><pre><code class="javascript hljs">a + b</code> </pre> <br><p>  Parser sind normalerweise in zwei Teile unterteilt: </p><br><ul><li>  Lexikalische Analyse </li></ul><br><p>  Bricht den Code in Token auf, von denen jeder einen Teil des Codes beschreibt: </p><br><pre> <code class="json hljs">[{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Punctuator"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }]</code> </pre> <br><ul><li>  Parsen </li></ul><br><p>  Erstellt einen Syntaxbaum aus Token: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"BinaryExpression"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"left"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"right"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } }</code> </pre> <br><p>  Und jetzt haben wir bereits genau diese Idee, mit der Sie programmgesteuert arbeiten können.  Es sollte klargestellt werden, dass es eine große Anzahl von <code>JavaScript</code> Parsern gibt. Hier einige davon: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">babel-parser</a> - ein Parser, der <code>babel</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">espree</a> - ein Parser, der <code>eslint</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eichel</a> - der Parser, auf dem die beiden vorherigen basieren; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">esprima</a> - ein beliebter Parser, der JavaScript bis EcmaScript 2017 unterstützt; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">cherow</a> ist ein neuer Player unter den JavaScript-Parsern, der behauptet, der schnellste zu sein. </li></ul><br><p>  Es gibt einen Standard-JavaScript-Parser, der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ESTree</a> heißt und definiert, welche Knoten analysiert werden sollen. <br>  Für eine detailliertere Analyse des Implementierungsprozesses des Parsers (sowie des Transformators und des Generators) können Sie den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Super-Winzling-Compiler</a> lesen. </p><br><h3 id="transformator">  Transformator </h3><br><p>  Um den AST-Baum zu transformieren, können Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Besuchermuster verwenden</a> , z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die</a> Bibliothek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ babel / traverse</a> .  Der folgende Code gibt die Namen aller JavaScript-Code-IDs aus der Codevariablen aus. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parser <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/parser"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> traverse <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/traverse"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">`function square(n) { return n * n; }`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parser.parse(code); traverse(ast, { Identifier(path) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(path.node.name); } });</code> </pre> <br><h3 id="generator">  Generator </h3><br><p>  Sie können Code beispielsweise mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ babel / generator auf folgende</a> Weise generieren: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {parse} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/parser'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generate <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/generator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">'class Example {}'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parse(code); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> output = generate(ast, code);</code> </pre> <br><p>  Zu diesem Zeitpunkt sollte der Leser eine grundlegende Vorstellung davon haben, was zum Transformieren von JavaScript-Code erforderlich ist und mit welchen Tools er implementiert wird. </p><br><p>  Es lohnt sich auch, ein Online-Tool wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">astexplorer hinzuzufügen</a> , das eine große Anzahl von Parsern, Transformatoren und Generatoren kombiniert. </p><br><h2 id="putout">  Putout </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Putout</a> ist ein Plugin-fähiger <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Codetransformator</a> .  Tatsächlich ist es eine Kreuzung zwischen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eslint</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Babel</a> , die die Vorteile beider Werkzeuge kombiniert. </p><br><p>  Wie <code>eslint</code> <code>putout</code> Problembereiche im Code <code>eslint</code> , aber im Gegensatz zu <code>eslint</code> <code>putout</code> ändert es das Verhalten des Codes, <code>putout</code> es kann alle gefundenen Fehler beheben. </p><br><p>  Wie <code>babel</code> <code>putout</code> konvertiert es den Code, versucht ihn jedoch nur minimal zu ändern, sodass er für die Arbeit mit Code verwendet werden kann, der im Repository gespeichert ist. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hübscher ist</a> auch erwähnenswert, es ist ein Formatierungswerkzeug und es unterscheidet sich radikal. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jscodeshift</a> befindet sich nicht weit von <code>putout</code> , unterstützt jedoch keine Plugins, zeigt keine Fehlermeldungen an und verwendet anstelle von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ babel / types</a> auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ast-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Typen</a> . </p><br><h3 id="istoriya-poyavleniya">  Erscheinungsgeschichte </h3><br><p>  Dabei hilft mir <code>eslint</code> sehr mit meinen Tipps.  Aber manchmal will ich mehr von ihm.  Um beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Debugger</a> zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">entfernen</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">korrigieren Sie test.only</a> und löschen Sie auch nicht verwendete Variablen.  Der letzte Punkt bildete die Grundlage für das <code>putout</code> . Während des Entwicklungsprozesses wurde klar, dass dies nicht einfach ist und viele andere Transformationen viel einfacher zu implementieren sind.  Somit wuchs <code>putout</code> reibungslos von einer Funktion zum Plugin-System.  Das Entfernen nicht verwendeter Variablen ist jetzt der schwierigste Prozess, aber dies hindert uns nicht daran, viele andere gleichermaßen nützliche Transformationen zu entwickeln und zu unterstützen. </p><br><h3 id="kak-putout-ustroen-iznutri">  Wie Putout im Inneren funktioniert </h3><br><p>  <code>putout</code> Arbeit kann in zwei Teile unterteilt werden: Motor und Plugins.  Diese Architektur ermöglicht es Ihnen, sich bei der Arbeit mit der Engine nicht von Transformationen ablenken zu lassen, und bei der Arbeit an Plug-Ins konzentrieren Sie sich so weit wie möglich auf deren Zweck. </p><br><h4 id="vstroennye-plaginy">  Eingebaute Plugins </h4><br><p>  <code>putout</code> basiert auf einem Plugin-System.  Jedes Plugin repräsentiert eine Regel.  Mit den integrierten Regeln können Sie Folgendes tun: </p><br><ul><li><p>  Suchen und löschen: </p><br><ul><li>  nicht verwendete Variablen </li><li> <code>debugger</code> </li> <li>  Rufen Sie nur <code>test.only</code> </li><li>  Rufen Sie <code>test.skip</code> </li><li>  Rufen Sie <code>console.log</code> </li><li>  Rufen Sie <code>process.exit</code> </li><li>  leere Blöcke </li><li>  leere Muster </li></ul><br></li><li><p>  Variablendeklaration suchen und teilen: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var one, two; //  var one; var two;</span></span></code> </pre> <br></li><li><p>  Konvertieren Sie <code>esm</code> in <code>commonjs</code> : </p><br></li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//  import one from 'one'; //  const one = require('one');</span></span></code> </pre> <br><ul><li>  Destrukturierung anwenden: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const name = user.name; //  const {name} = user;</span></span></code> </pre> <br><ol><li>  Destruktionseigenschaften kombinieren: </li></ol><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const {name} = user; const {password} = user; //  const { name, password } = user;</span></span></code> </pre> <br><p>  Jedes Plugin basiert auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Unix-Philosophie</a> , das heißt, sie sind so einfach wie möglich, jedes führt eine Aktion aus und lässt sich leicht kombinieren, da es sich im Wesentlichen um Filter handelt. </p><br><p>  Zum Beispiel mit folgendem Code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password;</code> </pre> <br><p>  Es wird zuerst mithilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apply-Destructuring</a> konvertiert in: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {name} = user; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {password} = user;</code> </pre> <br><p>  Anschließend wird mithilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Merge-Destructuring-Eigenschaften Folgendes</a> konvertiert: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { name, password } = user;</code> </pre> <br><p>  Somit können Plugins sowohl einzeln als auch zusammen arbeiten.  Wenn Sie Ihre eigenen Plug-Ins erstellen, wird empfohlen, diese Regel einzuhalten und ein Plug-In mit minimaler Funktionalität zu implementieren, das nur das tut, was Sie benötigen. Den Rest erledigen integrierte und benutzerdefinierte Plug-Ins. </p><br><h4 id="primer-ispolzovaniya">  Anwendungsbeispiel </h4><br><p>  Nachdem wir uns mit den integrierten Regeln vertraut gemacht haben, können wir ein Beispiel mit <code>putout</code> . <br>  Erstellen Sie eine <code>example.js</code> Datei mit folgendem Inhalt: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>, y = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(name, password);</code> </pre> <br><p>  Führen <code>putout</code> nun <code>putout</code> aus, indem Sie <code>example.js</code> als Argument übergeben: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js /home/coderaiser/example/example.js 1:6 error "x" is defined but never used remove-unused-variables 1:13 error "y" is defined but never used remove-unused-variables 6:0 error Unexpected "console" call remove-console 1:0 error variables should be declared separately split-variable-declarations 3:6 error Object destructuring should be used apply-destructuring 4:6 error Object destructuring should be used apply-destructuring 6 errors in 1 files fixable with the `--fix` option</code> </pre> <br><p>  Wir erhalten Informationen mit 6 Fehlern, die oben genauer betrachtet wurden. Jetzt werden wir sie korrigieren und sehen, was passiert ist: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js --fix coderaiser@cloudcmd:~/example$ cat example.js const { name, password } = user;</code> </pre> <br><p>  Infolge der Korrektur wurden nicht verwendete Variablen und Aufrufe von <code>console.log</code> gelöscht und auch eine Destrukturierung angewendet. </p><br><h4 id="nastroyki">  Einstellungen </h4><br><p>  Die Standardeinstellungen sind möglicherweise nicht immer und nicht für alle <code>putout</code> <code>.putout.json</code> <code>putout</code> unterstützt <code>.putout.json</code> Konfigurationsdatei <code>.putout.json</code> . Sie besteht aus den folgenden Abschnitten: </p><br><ul><li>  Regeln </li><li>  Ignorieren </li><li>  Match </li><li>  Plugins </li></ul><br><h5 id="rules">  Regeln </h5><br><p>  Der Abschnitt <code>rules</code> enthält ein Regelsystem.  Die Regeln sind standardmäßig wie folgt festgelegt: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-unused-variables"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-debugger"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-only"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-skip"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-console"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"split-variable-declarations"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty-pattern"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"convert-esm-to-commonjs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"apply-destructuring"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"merge-destructuring-properties"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Um <code>remove-process-exit</code> zu aktivieren <code>remove-process-exit</code> setzen Sie es einfach in der Datei <code>.putout.json</code> auf <code>true</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Dies reicht aus, um alle im Code gefundenen Aufrufe von <code>--fix</code> zu melden und zu löschen, wenn die Option <code>--fix</code> . </p><br><h5 id="ignore">  Ignorieren </h5><br><p>  Wenn Sie der Liste der Ausnahmen einige Ordner hinzufügen müssen, fügen Sie einfach den Abschnitt zum <code>ignore</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"ignore"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"test/fixture"</span></span> ] }</code> </pre> <br><h5 id="match">  Match </h5><br><p>  Wenn Sie beispielsweise ein verzweigtes Regelsystem benötigen, aktivieren Sie <code>process.exit</code> für das <code>bin</code> Verzeichnis. Verwenden Sie dazu einfach den Abschnitt <code>match</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"match"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"bin"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } } }</code> </pre> <br><h5 id="plugins">  Plugins </h5><br><p>  Wenn Sie Plugins verwenden, die nicht integriert sind und das Präfix <code>putout-plugin-</code> , müssen Sie diese in den Abschnitt " <code>plugins</code> " aufnehmen, bevor Sie sie im Abschnitt " <code>rules</code> aktivieren.  Um beispielsweise das <code>putout-plugin-add-hello-world</code> zu verbinden und die <code>putout-plugin-add-hello-world</code> aktivieren, geben Sie einfach Folgendes an: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"add-hello-world"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"add-hello-world"</span></span> ] }</code> </pre> <br><h4 id="dvizhok-putout">  Motor ausschalten </h4><br><p>  Die <code>putout</code> Engine ist ein Befehlszeilentool, das Einstellungen liest, Dateien analysiert, Plugins lädt und <code>putout</code> und dann das Ergebnis der Plugins schreibt. </p><br><p>  Er verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neu zusammengestellte</a> Bibliothek, mit deren Hilfe eine sehr wichtige Aufgabe ausgeführt werden kann: Sammeln Sie nach dem Parsen und der Transformation den Code in einem Zustand, der dem vorherigen so ähnlich wie möglich ist. </p><br><p>  Zum Parsen wird ein <code>ESTree</code> kompatibler Parser verwendet ( <code>babel</code> ist derzeit mit dem <code>estree</code> Plugin verbunden, Änderungen sind jedoch in Zukunft möglich), und <code>babel</code> Tools werden für die Transformation verwendet.  Warum genau <code>babel</code> ?  Alles ist einfach.  Tatsache ist, dass dies ein sehr beliebtes Produkt ist, das viel beliebter als andere ähnliche Tools ist und sich viel schneller entwickelt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jeder neue Vorschlag im EcmaScript-Standard ist ohne ein Babel-Plugin nicht vollständig</a> .  <a href="">Babel</a> hat auch ein Buch, <a href="">Babel Handbook</a> , das alle Funktionen und Werkzeuge zum Durchlaufen und Transformieren eines AST-Baums sehr gut beschreibt. </p><br><h4 id="svoy-plagin-dlya-putout">  Benutzerdefiniertes Plugin für Putout </h4><br><p>  Das <code>putout</code> Plugin-System ist recht einfach und den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eslint-Plugins</a> sowie den <a href="">Babel-Plugins</a> sehr ähnlich.  <code>putout</code> , anstelle einer Funktion sollte das <code>putout</code> Plugin 3 exportieren. Dies geschieht, um die Wiederverwendung von Code zu erhöhen, da das Duplizieren von Funktionen in 3 Funktionen nicht sehr praktisch ist. Es ist viel einfacher, sie in separate Funktionen zu integrieren und sie einfach an den richtigen Stellen aufzurufen. </p><br><h5 id="struktura-plagina">  Plugin Struktur </h5><br><p>  Das <code>Putout</code> Plugin besteht also aus 3 Funktionen: </p><br><ul><li>  <code>report</code> - gibt eine Nachricht zurück; </li><li>  <code>find</code> - sucht nach fehlerhaften Orten und gibt sie zurück; </li><li>  <code>fix</code> - behebt diese Stellen; </li></ul><br><p>  Der wichtigste Punkt, den Sie beim Erstellen eines Plugins für <code>putout</code> ist der Name. Es sollte mit <code>putout-plugin-</code> .  Als nächstes kann der Name der Operation angegeben werden, die das Plugin ausführt. Beispielsweise sollte das Plugin zum <code>remove-wrong</code> <code>putout-plugin-remove-wrong</code> wie <code>putout-plugin-remove-wrong</code> aufgerufen werden: <code>putout-plugin-remove-wrong</code> . </p><br><p>  Sie sollten auch die Wörter <code>putout</code> und <code>putout-plugin</code> zum Abschnitt <code>package.json</code> im <code>keywords</code> <code>"putout": "&gt;=3.10"</code> und <code>"putout": "&gt;=3.10"</code> in <code>peerDependencies</code> <code>"putout": "&gt;=3.10"</code> oder die Version, die zum Zeitpunkt des Schreibens des Plugins die letzte sein wird. </p><br><h5 id="primer-plagina-dlya-putout">  Beispiel-Plugin für Putout </h5><br><p>  Lassen Sie uns ein Beispiel-Plugin schreiben, das das Wort <code>debugger</code> aus dem Code entfernt.  Ein solches Plugin existiert bereits, es ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ putout / plugin-remove-debugger</a> und es ist einfach genug, es jetzt in Betracht zu ziehen. </p><br><p>  Es sieht so aus: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        module.exports.report = () =&gt; 'Unexpected "debugger" statement'; //     ,  debugger    Visitor module.exports.find = (ast, {traverse}) =&gt; { const places = []; traverse(ast, { DebuggerStatement(path) { places.push(path); } }); return places; }; //  ,     module.exports.fix = (path) =&gt; { path.remove(); };</span></span></code> </pre> <br><p>  Wenn die <code>.putout.json</code> <code>remove-debugger</code> Regel in <code>.putout.json</code> , wird das <code>@putout/plugin-remove-debugger</code> geladen.  Zunächst wird die <code>find</code> aufgerufen, die mit der <code>traverse</code> Funktion die Knoten des AST-Baums umgeht und alle erforderlichen Stellen speichert. </p><br><p>  Im nächsten Schritt wird die <code>report</code> <code>putout</code> , um die gewünschte Nachricht zu erhalten. </p><br><p>  Wenn das Flag <code>--fix</code> verwendet wird, wird die Plugin- <code>fix</code> Funktion aufgerufen und die Transformation durchgeführt. In diesem Fall wird der Knoten gelöscht. </p><br><h5 id="primer-testa-plagina">  Plugin Test Beispiel </h5><br><p>  Um das Testen von Plugins zu vereinfachen, wurde das Tool <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ putout / test</a> geschrieben.  Im Kern ist es nichts weiter als ein Wrapper-over- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tape</a> mit verschiedenen Methoden zur Bequemlichkeit und Vereinfachung des Testens. </p><br><p>  Der Test für das <code>remove-debugger</code> Plugin könnte folgendermaßen aussehen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> removeDebugger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'..'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'remove-debugger'</span></span>: removeDebugger, }); <span class="hljs-comment"><span class="hljs-comment">//        test('remove debugger: report', (t) =&gt; { t.reportCode('debugger', 'Unexpected "debugger" statement'); t.end(); }); //    test('remove debugger: transformCode', (t) =&gt; { t.transformCode('debugger', ''); t.end(); });</span></span></code> </pre> <br><h5 id="codemods">  Codemods </h5><br><p>  Nicht jede Transformation muss jeden Tag verwendet werden. Für einmalige Transformationen reicht es aus, dasselbe zu tun. Statt sie in <code>npm</code> legen Sie sie im <code>~/.putout</code> .  Beim Start <code>putout</code> in diesem Ordner, nimmt die Transformation auf und startet sie. </p><br><p>  Hier ist eine Beispieltransformation, die die <code>tape</code> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Try-to-Tape-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verbindung durch einen Supertape-</a> Aufruf ersetzt: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konvertieren von Band zu Supertape</a> . </p><br><h3 id="eslint-plugin-putout">  eslint-plugin-putout </h3><br><p>  Am Ende lohnt es sich, einen Punkt hinzuzufügen: <code>putout</code> versucht, den Code minimal zu ändern, aber wenn einem Freund passiert, dass einige Formatierungsregeln nicht eingehalten werden, ist eslint --fix immer bereit zu <code>eslint --fix</code> , und zu diesem Zweck gibt es ein spezielles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eslint-plugin-putout-Plugin</a> .  Es kann viele Formatierungsfehler aufhellen und natürlich an die Vorlieben der Entwickler für ein bestimmtes Projekt angepasst werden.  Das Anschließen ist einfach: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:putout/recommended"</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"putout"</span></span> ] }</code> </pre> <br><p>  Bisher gibt es nur eine Regel: <code>one-line-destructuring</code> , die folgende: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const { one } = hello; //  const {one} = hello;</span></span></code> </pre> <br><p>  Es gibt viele weitere <code>eslint</code> Regeln, mit denen Sie sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">genauer</a> vertraut machen können. </p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Ich möchte dem Leser für die Aufmerksamkeit danken, die diesem Text geschenkt wurde.  Ich hoffe aufrichtig, dass das Thema AST-Transformationen populärer wird und Artikel über diesen faszinierenden Prozess häufiger erscheinen.  Ich wäre sehr dankbar für Kommentare und Vorschläge im Zusammenhang mit der Weiterentwicklung von <code>putout</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellen Sie ein Problem</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">senden Sie einen Pool von Anforderungen</a> , testen Sie, schreiben Sie, welche Regeln Sie sehen möchten und wie Sie Ihren Code programmgesteuert programmieren. Wir werden zusammenarbeiten, um das AST-Transformationstool zu verbessern. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439564/">https://habr.com/ru/post/de439564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439552/index.html">Schädliche Chrome-Erweiterungen</a></li>
<li><a href="../de439556/index.html">TDMS Fairway. PMBOK-Methoden und russische Designorganisationen</a></li>
<li><a href="../de439558/index.html">Neues altes Telefon. Das PSTN-Telefon neu erfinden</a></li>
<li><a href="../de439560/index.html">Ethereum-Blockchain-Adapter für die IRIS-Datenplattform von InterSystems</a></li>
<li><a href="../de439562/index.html">Konfigurieren Sie den Kubernetes HA-Cluster auf Bare Metal mit kubeadm. Teil 1/3</a></li>
<li><a href="../de439566/index.html">Warum SRE-Dokumentation wichtig ist. Teil 3</a></li>
<li><a href="../de439568/index.html">QLC-basierte SSDs - ein Festplattenkiller? Nicht wirklich</a></li>
<li><a href="../de439570/index.html">IPython-Magie zum Bearbeiten von Jupyter-Zellen-Tags</a></li>
<li><a href="../de439572/index.html">Computergestütztes Design elektronischer Geräte</a></li>
<li><a href="../de439574/index.html">SmartCard I2C-Protokoll. Tauschen Sie APDU-Befehle über die I2C-Schnittstelle aus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>