<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå®Ô∏è üë≥üèø üçì Un peu plus sur le multit√¢che dans les microcontr√¥leurs üê± üö¢ üê∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article pr√©c√©dent , nous avons expliqu√© comment, selon l'auteur, il est possible de programmer les actions habituelles d'un microcontr√¥leur en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un peu plus sur le multit√¢che dans les microcontr√¥leurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456242/"><p>  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> pr√©c√©dent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">,</a> nous avons expliqu√© comment, selon l'auteur, il est possible de programmer les actions habituelles d'un microcontr√¥leur en temps r√©el, en les divisant en plusieurs t√¢ches ind√©pendantes (ou presque ind√©pendantes) les unes des autres. </p><br><p>  Un microcontr√¥leur a √©t√© choisi, avec un noyau issu d'une famille tr√®s r√©pandue d'ARM Cortex M. Des options famili√®res √† beaucoup, et pas seulement √† l'auteur, avec les nombres 0,3,4 et 7, M4 a √©t√© choisie, car elle √©tait √† port√©e de main. </p><br><p>  Les deux consid√©rations qui nous ont pouss√©s √† nous engager sur la voie glissante et fragile de ¬´l'invention du v√©lo¬ª, comme certains lecteurs l'ont remarqu√© avec humour, √©taient en fait simples.  La premi√®re √©tait que nous devons encore vivre et vivre avec ces ¬´cortex¬ª.  Et la seconde est d'essayer de ne pas faire quelque chose d'universel (gagner la gloire et la fortune), mais de faire quelque chose de plus √©troitement cibl√©, dans l'espoir d'atteindre l'efficacit√© et la simplicit√©.  Ceux qui font parfois quelque chose avec leurs mains se souviendront facilement que, en r√®gle g√©n√©rale, un tournevis sp√©cialement s√©lectionn√© est meilleur que celui pris dans un ensemble universel brillant. </p><a name="habracut"></a><br><p>  Un exemple d'assembleur a √©t√© donn√© afin de montrer que pas plus de 80 cycles d'horloge sont consacr√©s √† la commutation.  Et √† une vitesse d'horloge de 72 m√©gahertz, il s'av√®re un peu plus de 1 microseconde.  Une tique de 50 microsecondes ne sera donc pas si ch√®re.  Seulement 2% des frais g√©n√©raux.  Par cons√©quent, comme l‚Äôa dit l‚Äôun des personnages pr√©f√©r√©s de l‚Äôauteur, ¬´il est conseill√© de souffrir¬ª. </p><br><p>  Donc, nous avons N t√¢ches, dont chacune est garantie d'ex√©cuter un morceau (tick T) de temps et est garantie de r√©p√©ter ce segment au plus tard apr√®s (N-1) <em>T ticks, plus un retard ne d√©passant pas D. Ce retard ennuyeux, heureusement , est limit√© par la taille maximale possible dans le temps, qui est √©gale √† la somme de la dur√©e de fonctionnement de toutes les interruptions autoris√©es.</em>  <em>En d'autres termes, la t√¢che qui a le plus d'interruptions potentielles pour une p√©riode donn√©e avant le prochain tick est la plus malchanceuse.</em>  <em>Pendant une p√©riode plus longue, la t√¢che ne peut pas √™tre retard√©e.</em>  <em>Elle recevra in√©vitablement son cr√©neau horaire au plus tard en (N-1)</em> microsecondes T + D.  √Ä mon avis, cela s'appelle dur en temps r√©el. </p><br><p>  Les t√¢ches doivent terminer leurs t√¢ches et rendre compte de la mise en ≈ìuvre.  √Ä qui dois-je faire rapport?  Apparemment, quelqu'un est en charge, et il arrive, en r√®gle g√©n√©rale, qu'ils soient beaucoup plus petits que leurs subordonn√©s (en v√©rit√©, l'auteur a √©galement rencontr√© des exceptions lorsqu'il y avait quatre patrons pour trois travailleurs avec les deux mains gauches, dont un seul connaissait et respectait le mot " ad√©quation ¬ª). </p><br><p>  Et si ¬´vous √™tes nombreux, mais j'en suis un¬ª, cela signifie une file d'attente.  Beaucoup commenceront √† pousser et essaieront de se faufiler.  Et quelqu'un devra attendre, puis √™tre en retard et expliquer.  Malgr√© le fait que tout cela a l'air terrible, cela s'appelle beau: la lutte pour la ressource.  Les files d'attente sont une solution bien connue de tous.  J'en connaissais beaucoup qui ne nourrissent pas de pain - laissez-moi faire la queue. </p><br><p>  Mais la n√¥tre ne peut pas attendre!  En ce sens, les t√¢ches.  Ils sont en temps r√©el difficile.  Supposons que deux t√¢ches lisent les lectures une fois par seconde, et que la troisi√®me devrait mesurer quelque chose toutes les 10 millisecondes, la mettre dans une pile et faire rapport au sommet.  Et ils lui disent: "Dis-moi, on n'a pas fini avec les chefs." </p><br><p>  Apparemment, vous devez vous tourner, pour le moins, vers un temps pas tout √† fait r√©el (temps r√©el doux). </p><br><p>  Ayons une t√¢che sp√©ciale qui sait attendre et aime le faire.  La ressource qu'il servira sera le canal de communication.  Comme vous le savez, vous n‚Äôy mettrez pas tout √† la fois. <br>  Mais, vous pouvez imm√©diatement d√©terminer la vitesse du canal afin que rien ne soit perdu.  Pour ce faire, vous devez conna√Ætre les performances avec lesquelles tous nos graphomanes, pah, t√¢ches fonctionnent.  √âvidemment, vous devez √©galement calculer la taille du ou des tampons √† partir desquels tous les packages seront envoy√©s (ou vers la droite). </p><br><p>  Si le canal n'en est pas un, alors l'essence ne change pas.  Pour chaque canal, une t√¢che distincte est simplement ajout√©e, con√ßue pour attendre (et, bien s√ªr, esp√©rer et croire). </p><br><p>  Quelques mots sur le canal de communication avec l'op√©rateur, ou plus simplement avec la personne.  Ici, le canal est bidirectionnel, mais la direction ext√©rieure est la plus int√©ressante.  Faites imm√©diatement une r√©serve, il y a une circonstance que, m√™me avec un fort d√©sir, il est impossible d'exclure.  Il s'agit d'une surcharge de canal.  Pendant les tests, nous devons l'atteindre et devons avoir un m√©canisme pour voir son apparition.  Je ne dis pas, ce n'est pas bon de tromper, mais un peu peut √™tre laiss√© de c√¥t√©.  Vaughn, Gerasim, en a abus√© compl√®tement. </p><br><p>  Par cons√©quent, nous supposons imm√©diatement que le message √† l'op√©rateur de la t√¢che peut √™tre perdu.  Et pour qu'une personne sache cela, nous allons les num√©roter.  Cela permettra de d√©terminer o√π et combien de fois notre op√©rateur s'est retrouv√© sans rien.  En fin de compte, vous pouvez toujours faire quelque chose dans le code, ou ajouter des calculs, ou m√™me le connecter au circuit √©lectrique pour corriger la situation.  Il semble que pour le moment, ce sera plus facile.  Mais, bien s√ªr, cela n'est pas n√©cessaire pour les applications militaires.  Pour √™tre honn√™te, perdre un message ne ressemble pas √† une honte uniquement lors du d√©bogage. </p><br><p>  Par exemple, ayons une interface s√©rie duplex sans acquittement √† 115200 bauds.  Par exemple, RS422 dans la configuration "√©conomie" deux fils - l√†, deux - en arri√®re.  Sa capacit√© est d'environ 10 000 octets par seconde.  Prenons la taille moyenne d'un message pour une personne √©gale √† 50 octets.  Nous obtenons 200 messages par seconde ou un message en 5 millisecondes.  Si nous avons trois t√¢ches qui veulent communiquer quelque chose, laissez-les le faire toutes les 15 millisecondes chacune.  En moyenne, bien s√ªr.  Et si ce n'est pas en moyenne, des calculs statistiques s√©rieux ou une exp√©rience √† grande √©chelle seront n√©cessaires.  Choisissez le dernier.  Apr√®s tout, nous avons appris √† d√©tecter les messages manquants et nous verrons tout sur l'√©cran de l'√©mulateur de terminal. <br>  Alors, laissez les trois t√¢ches cr√©er des messages individuels.  Laissez les messages diff√©rer en importance ou en urgence du contenu et nos t√¢ches les mettent dans le tampon appropri√©.  Allouez ces trois tampons en anneau pour trois niveaux d'urgence, comme le montre la figure 1. </p><br><p><img src="https://habrastorage.org/webt/my/7m/uu/my7muue1i6hn5gjv3ugckhxsxzy.jpeg"></p><br><p>  La quatri√®me t√¢che s√©lectionne parmi ces tampons un message selon notre plan approuv√© et essaie de le d√©livrer.  Si l'envoi n'est pas encore possible, la quatri√®me t√¢che estime combien il peut dormir et le fait.  Apr√®s avoir dormi, elle dispose d√©j√† de l'espace n√©cessaire dans la m√©moire tampon pour envoyer. </p><br><p>  Les tampons de diverses urgences, bien s√ªr, ne stockent pas les messages eux-m√™mes, mais leurs adresses (liens).  Dans le m√™me temps, les t√¢ches elles-m√™mes n'ont pas besoin d'attendre du tout.  Ok?  Non, pas vraiment.  Cela ne fonctionne pas, et voici pourquoi.  Chacun de ces trois tampons en anneau est une ressource partag√©e.  Imaginez que la t√¢che 1 √©tait sur le point de mettre une adresse dans un tampon central.  Elle lit le mot, v√©rifie que l'endroit est vide, c'est-√†-dire que la valeur est z√©ro et (√† ce moment elle est remplac√©e par une autre t√¢che 2, qui veut faire exactement la m√™me chose et elle r√©ussit), la premi√®re t√¢che, en revenant, met le mot l√†, √©crasant tout ce qui r√©ussi deuxi√®me.  Voici un coll√®gue qui demande des mots.  Il me semble savoir ce qu'il va dire. <br>  -Oui, tout est tr√®s simple, vous pouvez interdire les interruptions pendant la dur√©e du test et rien de grave ne se passera, ce n'est pas pour longtemps. <br>  - C'est vrai, pas pour longtemps, mais combien de fois?  Combien de temps allons-nous retirer de la t√¢che?  Et lequel?  J'ai oubli√© d'avertir, nous n'interdisons jamais les interruptions, notre dure secte du temps r√©el nous interdit de le faire. <br>  -Et si vous n'interdisez pas les interruptions, vous pouvez demander √† notre commutateur de t√¢ches d'y mettre l'adresse du message.  Il peut le faire atomiquement. <br>  - Oui, peut-√™tre, mais je veux lui demander autre chose, puis une autre.  Et pourquoi alors avons-nous atteint 72 degr√©s, puis tout diluer avec de l'eau?  D√©sol√©, je voulais dire 72 cycles pour changer de contexte. <br>  Essayons de le faire plus facilement, comme dans la figure 2. </p><br><p><img src="https://habrastorage.org/webt/oq/u0/mk/oqu0mkfpi0g7l5ralfun_qk2vaw.jpeg"></p><br><p>  Dans ce cas, chaque t√¢che a son propre tampon ou son propre ensemble de tampons, si vous voulez une urgence, une pompe et une importance diff√©rentes.  Personnellement, en tant que simple op√©rateur, j'ai toujours la m√™me importance pour tout le monde. </p><br><p>  Un tel sch√©ma ne vous oblige pas √† vous battre pour la ressource.  Maintenant, nous avons une option tr√®s fonctionnelle.  Je n'aime pas √ßa.  Mais que faire si les t√¢ches √† gauche de l'image n'ont rien √† envoyer?  Il serait alors plus sage de demander √† la t√¢che de droite de se r√©veiller lorsque la raison appara√Æt, et de ne pas se r√©veiller juste pour r√©gler √† nouveau l'alarme.  Les t√¢ches √† gauche sont plus faciles √† faire.  De plus, une fonction qui aide √† r√©veiller un ami a √©t√© mentionn√©e dans un pr√©c√©dent post. </p><br><p>  Je pr√©vois une proposition de rationalisation: "Que l'interruption du port s√©rie (UART) lui-m√™me soit engag√©e dans la t√¢che 4 en cours, il y aura des √©conomies."  Vous pouvez le faire, mais je ne pense pas que ce soit bon.  Je vais essayer de clarifier.  Les t√¢ches de gauche, en effet, peuvent elles-m√™mes activer la proc√©dure d'interruption UART, et elle commencera √† fonctionner et ne s'arr√™tera pas tant qu'elle n'aura pas tout fait.  La proc√©dure d'interruption devrait maintenant faire tout ce que la t√¢che 4 faisait auparavant. Le temps n√©cessaire pour traiter l'interruption va gonfler, pas une seule t√¢che ne pourra √™tre activ√©e jusqu'√† ce que le prochain ¬´spool¬ª soit termin√©.  Et que disons-nous √† nos camarades du cercle persistant en temps r√©el?  Mais on nous a dit que la r√©ponse √† toute interruption externe devait √™tre aussi courte que possible.  C'est juste un bon ton.  Ou, en d'autres termes: il faut faire le bien, le mal et sans vous √ßa marchera. </p><br><p>  La figure 3 explique en quoi consiste le processus et quels sont les d√©fis rencontr√©s. </p><br><p><img src="https://habrastorage.org/webt/hs/jj/_h/hsjj_h0riitsgnqvcutjqrfb9ow.jpeg"></p><br><p>  Passons maintenant √† la situation, pourrait-on dire, un miroir.  C'est quand l'information vient de l'ext√©rieur.  Que ce soit une cha√Æne SPI avec plusieurs gondoliers avec gondoles et un petit orchestre √† cordes amateur.  Non, il est trop t√¥t pour penser au repos.  Ne laissez que l'interface SPI et quelques puces.  Par exemple, capteur de pression atmosph√©rique, acc√©l√©rom√®tre et m√©moire stock√©e. </p><br><p>  Je dois dire tout de suite - un exemple stupide.  Pas √† cause du gondoliero avec leur √©ternel "je devrais ajouter, monsieur."  Non, il est stupide, en fait, de m√©langer dans une m√™me interface des donn√©es d‚Äôentr√©e d‚Äôimportance diff√©rente.  En effet, si vous avez besoin de conna√Ætre l'acc√©l√©ration, alors, c'est s√ªr, afin de savoir rapidement quand retirer la p√©dale d'acc√©l√©rateur, ou tourner les volets, ou fermer les yeux, enfin.  Ces informations sont souvent n√©cessaires.  Mais la pression, elle, change lentement et devra descendre d'environ trois m√®tres, de sorte que dans les rangs inf√©rieurs, la vie deviendra plus chaude. </p><br><p>  Quant √† la m√©moire stock√©e, et qui l'a g√©n√©ralement mis sur ce SPI?  Y a-t-il un deuxi√®me SPI?  Et n'est pas pr√©vu?  Nulle part o√π aller, quelque chose doit √™tre fait.  Redirigez les fl√®ches dans la direction oppos√©e de la figure 2 et commencez √† r√©fl√©chir. </p><br><p>  La t√¢che 4 dessert d√©sormais le SPI et ne se r√©veille que par ses signaux.  Sa connexion avec la t√¢che 1, qui veut mettre quelque chose dans la m√©moire stock√©e, est dirig√©e vers l'ext√©rieur et s'effectue √† travers la file d'attente.  Il est √©galement n√©cessaire de pr√©voir un m√©canisme pour surveiller le d√©bordement du tampon en anneau.  La production des valeurs d'acc√©l√©ration et de pression de la t√¢che 4 devrait fournir sans la participation de deux t√¢ches consommatrices.  Vous avez juste besoin de tourner et de suivre.  Nous pouvons maintenant esquisser une image explicative et r√©diger une note explicative.  Dans la figure 4, ces <br>  les actions sont repr√©sent√©es sch√©matiquement (ou diagramme). </p><br><p><img src="https://habrastorage.org/webt/qs/1p/n0/qs1pn0mxzu5642c1kwrttvpvhtw.jpeg"></p><br><p>  V√©rification de sous-d√©passement - ces actions vous aident √† savoir si la valeur d'acc√©l√©ration a le temps de changer avant d'√™tre relue par la t√¢che consommatrice.  Cette v√©rification est repr√©sent√©e par une action distincte sur la figure 4 uniquement pour attirer l'attention sur elle.  En fait, cette √©tape se produit avec la lecture de la valeur de l'acc√©l√©rom√®tre selon le sch√©ma, comme le montre la figure 5. </p><br><p><img src="https://habrastorage.org/webt/2z/6l/tx/2z6ltxiu6jeuvtizhjjurmodhq8.jpeg"></p><br><p>  Il est √† noter qu'il existe une ressource partag√©e, puisque le lieu de stockage du r√©sultat est √©galement un indicateur d'actions (s√©maphore).  Les courses sont possibles ici, parlant le langage des circuits, mais pour nous, ce n'est pas une omission.  Apr√®s tout, se glisser dans la porte de fermeture d'un v√©hicule uniquement dans la vie peut √™tre consid√©r√© comme une fortune.  Ici, nous consid√©rerons cela avec confiance comme un retard. </p><br><p>  L'acc√®s √† la m√©moire se fait par portions afin de limiter le temps de chacune de ces √©tapes.  Ainsi, nous assurerons une lecture uniforme des valeurs d'acc√©l√©ration changeant rapidement, et entre les deux, nous nous occuperons dans le temps du reste. </p><br><p>  Eh bien, il reste maintenant √† trouver quelque chose de convenable √† partir de fer et √† exp√©rimenter comme il se doit.  Ce sera, je pense, la prochaine histoire. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456242/">https://habr.com/ru/post/fr456242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456232/index.html">Guide: mise √† jour des interfaces avec les membres par d√©faut dans C # 8.0</a></li>
<li><a href="../fr456234/index.html">Pourquoi Cisco n'ach√®te-t-il pas Splunk ou une discussion sur le fonctionnement de la plate-forme Cisco pour la chasse aux menaces</a></li>
<li><a href="../fr456236/index.html">Peter - Insider Dev Tour: Conf√©rence Insider pour les d√©veloppeurs de Microsoft</a></li>
<li><a href="../fr456238/index.html">Tutoriel: Mettre √† jour les interfaces avec les membres d'interface par d√©faut dans C # 8.0</a></li>
<li><a href="../fr456240/index.html">D√©veloppement de chatbot (laravel + botman)</a></li>
<li><a href="../fr456246/index.html">√âl√©ment z√©ro</a></li>
<li><a href="../fr456248/index.html">Comment j'ai attrap√©: avant les styles pour un √©l√©ment de focus</a></li>
<li><a href="../fr456250/index.html">Localisation d'applications et prise en charge RTL. Signaler Yandex.Taxi</a></li>
<li><a href="../fr456256/index.html">Guide d'architecture d'application Android</a></li>
<li><a href="../fr456258/index.html">Free as a wind et free as a beer traduction de ¬´Free as in Freedom¬ª en russe sous la licence GNU FDL 1.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>