<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ©Ô∏è üïã ‚ôêÔ∏è Como usar o PHP para implementar microsservi√ßos? üó£Ô∏è üî§ üë¶üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por que falar sobre governan√ßa de servi√ßos? 


 Com a crescente popularidade da Internet, a arquitetura MVC tradicional tornou-se cada vez mais inchad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como usar o PHP para implementar microsservi√ßos?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460855/"><p><img src="https://habrastorage.org/getpro/habr/post_images/287/fa2/ee0/287fa2ee0642f5411410b78c86702e82.jpg" alt="Swoft"></p><br><h3 id="why-should-talk-service-governance">  Por que falar sobre governan√ßa de servi√ßos? </h3><br><p>  Com a crescente popularidade da Internet, a arquitetura MVC tradicional tornou-se cada vez mais inchada e muito dif√≠cil de manter, √† medida que a escala de aplicativos continua a se expandir. </p><br><p>  Precisamos tomar a√ß√µes para dividir um sistema grande em v√°rios aplicativos de acordo com as caracter√≠sticas do neg√≥cio.  Por exemplo, um grande sistema de com√©rcio eletr√¥nico pode incluir sistema de usu√°rio, sistema de produtos, sistema de pedidos, sistema de avalia√ß√£o etc., e podemos separ√°-los em v√°rios aplicativos individuais.  As caracter√≠sticas da arquitetura de aplicativos m√∫ltiplos s√£o aplicativos executados de forma independente e n√£o podem se chamar. </p><a name="habracut"></a><br><p>  Embora v√°rios aplicativos resolvam o problema do aplicativo inchado, os aplicativos s√£o independentes um do outro e servi√ßos ou c√≥digos comuns n√£o podem ser reutilizados. </p><br><h3 id="official-link">  Link oficial </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/swoft-cloud/swoft</a> <br><br><h2 id="single-application-solution">  Solu√ß√£o de aplica√ß√£o √∫nica </h2></li></ul><br><p>  Para um sistema de Internet grande, geralmente cont√©m v√°rios aplicativos com servi√ßos comuns, e cada aplicativo tem rela√ß√£o de chamada entre si.  Al√©m disso, existem outros desafios para o sistema de Internet em larga escala, como lidar com usu√°rios em r√°pido crescimento, como gerenciar equipes de P&amp;D para iterar rapidamente o desenvolvimento do sistema, como manter a atualiza√ß√£o do sistema de maneira est√°vel e assim por diante. </p><br><p>  Portanto, para reutilizar bem os servi√ßos e manter os m√≥dulos para expandir facilmente.  Queremos que os servi√ßos sejam separados do aplicativo.  Um servi√ßo n√£o est√° mais em um aplicativo, mas √© mantido como um servi√ßo separado.  O aplicativo em si n√£o √© mais uma pilha de m√≥dulos inchada, mas um componente de servi√ßo modular. </p><br><h2 id="servitization">  Servitiza√ß√£o </h2><br><h3 id="features">  Funcionalidades </h3><br><p>  Ent√£o, qual √© o recurso do "Servitization"? </p><br><ul><li>  Um aplicativo se divide em servi√ßos por empresas </li><li>  Servi√ßo individual pode ser implantado independentemente </li><li>  O servi√ßo pode ser compartilhado por v√°rios aplicativos </li><li>  Os servi√ßos podem ter comunica√ß√£o entre si </li><li>  A arquitetura do sistema √© mais clara </li><li>  Os m√≥dulos principais s√£o est√°veis ‚Äã‚Äãe a atualiza√ß√£o dos componentes de servi√ßo nas unidades pode evitar o risco de novos lan√ßamentos frequentes </li><li>  F√°cil para desenvolvimento e gerenciamento </li><li>  A manuten√ß√£o pode ser feita por equipe individual com fluxo de trabalho e responsabilidades claros </li><li>  Reutiliza√ß√£o de servi√ßos, reutiliza√ß√£o de c√≥digos </li><li>  Muito f√°cil de expandir <cut></cut></li></ul><br><h3 id="the-challenge-of-servitization">  O desafio da servitiza√ß√£o </h3><cut></cut><br><p> Ap√≥s a manuten√ß√£o do sistema, a depend√™ncia do sistema √© complicada e o n√∫mero de intera√ß√µes entre servi√ßos √© aumentado.  No modo de desenvolvimento do <code>fpm</code> , como a mem√≥ria residente n√£o pode ser fornecida, toda solicita√ß√£o deve come√ßar do zero, iniciando o carregamento de um processo para sair do processo, adicionando uma sobrecarga in√∫til.  Al√©m disso, a conex√£o com o banco de dados n√£o pode ser reutilizada e n√£o pode ser protegida porque o <code>fpm</code> √© baseado no processo e o n√∫mero de processos do <code>fpm</code> tamb√©m determina o n√∫mero de concorrentes.  Estes s√£o os problemas que nos s√£o dados pelo simples desenvolvimento do <code>fpm</code> .  Portanto, essas s√£o as raz√µes pelas quais o <code>Java</code> √© mais popular agora na plataforma da Internet, comparado ao <code>.NET</code> e <code>PHP</code> .  Al√©m do <code>PHP non-memory resident</code> , h√° muitos outros problemas que precisam ser resolvidos. </p><br><ul><li>  Mais servi√ßos, mais complexidade de gerenciamento de configura√ß√£o </li><li>  Depend√™ncias de servi√ßo complexas </li><li>  Balanceamento de carga entre servi√ßos </li><li>  Expans√£o de servi√ßo </li><li>  Monitoramento de servi√ßo </li><li>  Downgrade de servi√ßo </li><li>  Autentica√ß√£o de servi√ßo </li><li>  Servi√ßo online e offline </li><li>  Documenta√ß√£o de servi√ßo <br>  ...... </li></ul><cut></cut><br><p>  Voc√™ pode imaginar os benef√≠cios que a mem√≥ria residente nos traz. </p><br><ul><li><p>  <strong>Somente inicie a inicializa√ß√£o da estrutura uma vez</strong> que possamos nos concentrar no processamento de solicita√ß√µes, pois a estrutura s√≥ poder√° ser inicializada na mem√≥ria na inicializa√ß√£o uma vez para a mem√≥ria residente </p><br></li><li><p>  <strong>Multiplexa√ß√£o de conex√£o</strong> , alguns engenheiros n√£o conseguem entender se n√£o estiver usando o conjunto de conex√µes, qual √© a conseq√º√™ncia de fazer conex√µes para cada solicita√ß√£o?  Causa muito recurso de back-end nas conex√µes.  Para alguns servi√ßos b√°sicos, como Redis, bancos de dados, as conex√µes s√£o um dreno caro. </p><br></li></ul><br><p>  Ent√£o, existe uma boa solu√ß√£o?  A resposta √© sim, e muitas pessoas est√£o usando a estrutura chamada <code>Swoft</code> .  <code>Swoft</code> √© uma estrutura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RPC</a> com o recurso de <code>Service Governance</code> .  <code>Swoft</code> √© a primeira estrutura de pilha completa de corotina de mem√≥ria residente em PHP, com base no conceito principal do <code>Spring Boot</code> , a conven√ß√£o √© maior que a configura√ß√£o. </p><br><p>  <code>Swoft</code> oferece uma maneira mais elegante de usar servi√ßos <code>RPC</code> , como o <code>Dubbo</code> e o <code>Swoft</code> possui um desempenho semelhante ao do <code>Golang</code> .  Aqui est√° o resultado do teste de estresse do desempenho do <code>Swoft</code> no meu <code>PC</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a4/aa7/97e/3a4aa797eb0e94c2e5adfa3207308076.png" alt="Swoft"></p><br><p>  A velocidade de processamento √© muito surpreendente no teste de estresse <code>ab</code> .  Com a CPU da <code>i7 generation 8</code> e mem√≥ria de <code>16GB</code> , <code>100000</code> solicita√ß√µes usam apenas <code>5s</code> .  O tempo √© basicamente imposs√≠vel de ser alcan√ßado no modo de desenvolvimento de <code>fpm</code> .  O teste tamb√©m √© suficiente para demonstrar o alto desempenho e a estabilidade do <code>Swoft</code> . </p><br><h2 id="elegant-service-governance">  Governan√ßa de servi√ßo elegante </h2><cut></cut><br><h3 id="service-registration-and-discoveryhttpsenswoftorgdocs2xenmsgovernregister-discoveryhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Registro e descoberta de servi√ßos</a> </h3><br><p>  No processo de governan√ßa de microsservi√ßos, o registro de servi√ßos iniciados em clusters de terceiros, como consul / etcd, geralmente est√° envolvido.  Este cap√≠tulo usa o componente swoft-consul na estrutura Swoft para implementar o registro e a descoberta de servi√ßos. <br><img src="https://habrastorage.org/getpro/habr/post_images/16a/482/683/16a482683d8376d8f179f6158135384a.png" alt="Swoft"><br>  L√≥gica de implementa√ß√£o </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">ReflectionException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ContainerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Agent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ClientException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ServerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Contract</span></span>\<span class="hljs-title"><span class="hljs-title">ProviderInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class RpcProvider * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RpcProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProviderInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Agent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $agent; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Client $client * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ReflectionException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ContainerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ClientException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ServerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@example</span></span></span><span class="hljs-comment"> * [ * 'host:port', * 'host:port', * 'host:port', * ] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Client $client)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Get health service from consul $services = $this-&gt;agent-&gt;services(); $services = [ ]; return $services; } }</span></span></code> </pre> <br><h3 id="service-circuit-breakerhttpsenswoftorgdocs2xenmsgovernbreakerhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Disjuntor de servi√ßo</a> </h3><cut></cut><br><p>  Em um ambiente distribu√≠do, especialmente em um sistema distribu√≠do de arquitetura de microsservi√ßo, √© muito comum que um sistema de software chame outro sistema remoto.  O chamado de uma chamada remota pode ser outro processo ou outro host na rede.  A maior diferen√ßa entre essa chamada remota e a chamada interna do processo √© que a chamada remota pode falhar ou travar.  Nenhuma resposta at√© o tempo limite.  Pior, se houver v√°rios chamadores chamando o mesmo servi√ßo suspenso, √© muito prov√°vel que o tempo limite do servi√ßo espere rapidamente se espalhe por todo o sistema distribu√≠do, causando uma rea√ß√£o em cadeia que consome toda uma grande quantidade de recursos em sistemas distribu√≠dos.  Eventualmente, pode levar √† paralisia do sistema. </p><cut></cut><br><p>  O modo Disjuntor foi projetado para evitar desastres causados ‚Äã‚Äãpor rea√ß√µes em cadeia semelhantes a cascatas em sistemas distribu√≠dos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0f7/357/6f0/0f73576f06e519937755982867922c34.png"></p><br><p>  No modo b√°sico do disjuntor, para garantir que o fornecedor n√£o seja chamado quando o disjuntor estiver no estado aberto, tamb√©m precisamos de um m√©todo adicional para redefinir o disjuntor depois que o fornecedor retomar o servi√ßo.  Uma solu√ß√£o poss√≠vel √© que o disjuntor detecte periodicamente se o servi√ßo do fornecedor √© retomado.  Depois de retomado, o status √© definido para fechar.  O estado √© um estado semi-aberto quando o disjuntor tenta novamente. </p><cut></cut><br><p>  O uso do fus√≠vel √© simples e poderoso.  Pode ser anotado com um <code>@Breaker</code> .  O fus√≠vel do <code>Swoft</code> pode ser usado em qualquer cen√°rio, como √© chamado um servi√ßo.  Ele pode ser rebaixado ou n√£o chamado ao solicitar um servi√ßo de terceiros. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class BreakerLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BreakerLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Breaker</span></span></span><span class="hljs-comment">(fallback="loopFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> Exception */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do something throw new Exception('Breaker exception'); } /** * @return string * @throws Exception */ public function loopFallback(): string { // Do something } }</span></span></code> </pre> <cut></cut><br><h3 id="service-restrictionhttpsenswoftorgdocs2xenmsgovernlimiterhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Restri√ß√£o de servi√ßo</a> </h3><br><p>  <strong>Restri√ß√£o de fluxo, disjuntor, downgrade de servi√ßo</strong> Estes podem ser enfatizados repetidamente porque s√£o realmente importantes.  Quando o servi√ßo n√£o est√° funcionando, ele deve estar quebrado.  A restri√ß√£o de fluxo √© uma ferramenta para se proteger.  Se n√£o houver um mecanismo de autoprote√ß√£o e as conex√µes forem recebidas, n√£o importando quantas sejam, o front-end ficar√° paralisado quando o tr√°fego for muito grande, enquanto o back-end n√£o conseguir√° lidar com todas as conex√µes. </p><br><p>  A restri√ß√£o de fluxo √© limitar o n√∫mero de solicita√ß√µes simult√¢neas e o n√∫mero de solicita√ß√µes ao acessar recursos escassos, como produtos de venda instant√¢nea, para reduzir efetivamente o pico e suavizar a curva de fluxo.  O objetivo da restri√ß√£o de fluxo √© limitar a taxa de acesso simult√¢neo e solicita√ß√µes simult√¢neas ou limitar a velocidade da solicita√ß√£o dentro de uma janela de tempo para proteger o sistema.  Depois que o limite da taxa √© atingido ou excedido, as solicita√ß√µes podem ser negadas ou colocadas em fila. </p><br><p>  A camada inferior da restri√ß√£o de fluxo do <code>Swoft</code> usa o algoritmo de token bucket, e a camada subjacente depende do <code>Redis</code> para implementar a restri√ß√£o de fluxo distribu√≠do. </p><br><p>  A restri√ß√£o de fluxo Swoft n√£o apenas limita os controladores, mas tamb√©m limita os m√©todos em qualquer bean e controla a taxa de acesso dos m√©todos.  O exemplo a seguir √© a explica√ß√£o em detalhes. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Limiter</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">RateLimiter</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class LimiterLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LimiterLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RequestMapping</span></span></span><span class="hljs-comment">() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RateLimiter</span></span></span><span class="hljs-comment">(rate=20, fallback="limiterFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestLimiter2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'requestLimiter2'</span></span>, $uri]; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limiterFallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'limiterFallback'</span></span>, $uri]; } }</code> </pre> <br><p>  Isso suporta a <code>symfony/expression-language</code> .  Se a velocidade for limitada, o m√©todo <code>limiterFallback</code> definido em <code>fallback</code> ser√° chamado. </p><cut></cut><br><h3 id="configuration-centerhttpsenswoftorgdocs2xenmsgovernconfightml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Centro de configura√ß√£o</a> </h3><br><p>  Antes de falarmos sobre o centro de configura√ß√£o, vamos falar sobre o arquivo de configura√ß√£o.  N√£o somos estranhos a isso.  Ele nos fornece a capacidade de modificar dinamicamente o programa.  Uma cita√ß√£o de algu√©m √©: </p><br><blockquote>  Ajuste din√¢mico da atitude de v√¥o do tempo de execu√ß√£o do sistema! </blockquote><p>  Posso chamar nosso trabalho para consertar pe√ßas em avi√µes que voam r√°pido.  N√≥s humanos sempre somos incapazes de controlar e prever tudo.  Para nosso sistema, sempre precisamos reservar algumas linhas de controle para fazer ajustes quando necess√°rio, para controlar a dire√ß√£o do sistema (como controle de cinza, ajuste de restri√ß√£o de fluxo), o que √© especialmente importante para a ind√∫stria da Internet que adota mudan√ßas. </p><br><p>  Para a vers√£o aut√¥noma, chamamos de configura√ß√£o (arquivo);  para o sistema de cluster distribu√≠do, chamamos de centro de configura√ß√£o (sistema); </p><br><h4 id="what-exactly-is-a-distributed-configuration-center">  O que exatamente √© um centro de configura√ß√£o distribu√≠do? </h4><cut></cut><br><p>  Com o desenvolvimento dos neg√≥cios e a atualiza√ß√£o da arquitetura de microsservi√ßos, o n√∫mero de servi√ßos e a configura√ß√£o de programas est√£o aumentando (v√°rios microsservi√ßos, v√°rios endere√ßos de servidores, v√°rios par√¢metros) e o m√©todo tradicional de arquivo de configura√ß√£o e o m√©todo de banco de dados n√£o pode atender √†s necessidades dos desenvolvedores no gerenciamento de configura√ß√µes: </p><br><ul><li>  Seguran√ßa: A configura√ß√£o segue o c√≥digo fonte armazenado na base de c√≥digos, o que √© f√°cil de causar vazamentos na configura√ß√£o; </li><li>  Oportunidade: Modifique a configura√ß√£o e reinicie o servi√ßo para entrar em vigor. </li><li>  Limita√ß√µes: Ajustes din√¢micos n√£o podem ser suportados: por exemplo, comutadores de log, comutadores de fun√ß√£o; </li></ul><br><p>  Portanto, precisamos configurar o centro para gerenciar a configura√ß√£o!  Liberando os desenvolvedores de neg√≥cios de configura√ß√µes complexas e complicadas, eles precisam apenas se concentrar no pr√≥prio c√≥digo de neg√≥cios, o que pode melhorar significativamente o desenvolvimento e a efici√™ncia operacional.  Ao mesmo tempo, a configura√ß√£o e o lan√ßamento do pacote aumentar√£o ainda mais a taxa de sucesso do lan√ßamento e fornecer√£o forte suporte para o controle de ajuste fino e o manuseio de emerg√™ncia da opera√ß√£o e manuten√ß√£o. </p><br><p>  Sobre os centros de configura√ß√£o distribu√≠dos, existem muitas solu√ß√µes de c√≥digo aberto na web, como: </p><br><p>  Apollo √© um centro de configura√ß√£o distribu√≠do desenvolvido pelo departamento de estrutura da Ctrip.  Ele pode gerenciar centralmente a configura√ß√£o de diferentes ambientes e diferentes clusters de aplicativos.  Ele pode ser enviado ao final do aplicativo em tempo real ap√≥s a modifica√ß√£o da configura√ß√£o.  Possui os recursos de autoridade padronizada e gerenciamento de processos e √© adequado para os cen√°rios de configura√ß√£o e gerenciamento de microsservi√ßos. </p><cut></cut><br><p>  Este cap√≠tulo usa o <code>Apollo</code> como um exemplo para obter configura√ß√£o e proteger servi√ßos de reinicializa√ß√£o do centro de configura√ß√£o remota.  Se voc√™ n√£o est√° familiarizado com o <code>Apollo</code> , pode primeiro examinar o componente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>Apollo</code></a> extens√£o <code>Swoft</code> e ler a documenta√ß√£o oficial do <code>Apollo</code> . </p><br><p>  Este cap√≠tulo usa o <code>Apollo</code> no <code>Swoft</code> como exemplo.  Quando a configura√ß√£o do <code>Apollo</code> mudar, reinicie o servi√ßo (http-server / rpc-server / ws-server).  A seguir, √© apresentado um exemplo de um agente: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ApolloException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class ApolloLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApolloLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Config */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ApolloException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;pull(<span class="hljs-string"><span class="hljs-string">'application'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Print data var_dump($data); } }</span></span></code> </pre> <br><p>  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>Swoft-Apollo</code></a> acima √© um simples pux√£o de configura√ß√£o da Apollo. Al√©m desse m√©todo, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>Swoft-Apollo</code></a> fornece mais maneiras de usar. </p><cut></cut><br><h2 id="official-link-1">  Link oficial </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/swoft-cloud/swoft</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460855/">https://habr.com/ru/post/pt460855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460843/index.html">Apresentando o novo 3CX Call Flow Designer e o 3CX CRM Template Generator</a></li>
<li><a href="../pt460845/index.html">Fernando Corbato, pai do seu computador (e senha), morreu aos 93 anos</a></li>
<li><a href="../pt460847/index.html">12,3 milh√µes de WebSockets simult√¢neos</a></li>
<li><a href="../pt460849/index.html">Parte 4. Um modelo de gr√°fico para calcular fun√ß√µes l√≥gicas para processos paralelos ass√≠ncronos</a></li>
<li><a href="../pt460851/index.html">SamsPcbGuide, Parte 10: Tecnologia - Componentes sem solda de chumbo</a></li>
<li><a href="../pt460857/index.html">Como a pesquisa da Namecoin Blockchain previu ataques cibern√©ticos RTM</a></li>
<li><a href="../pt460859/index.html">Confer√™ncia IThink # 3 em Kharkov - com base na WWDC 2019</a></li>
<li><a href="../pt460861/index.html">Escopo e fechamento lexical do JavaScript</a></li>
<li><a href="../pt460863/index.html">Cloudflare crash details 2 de julho de 2019</a></li>
<li><a href="../pt460865/index.html">Pessoas na lua. Fontes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>