<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§öüèø üëçüèº üõ∑ Iteraptor: biblioth√®que pour redus de carte transparent profond üòÑ üè¢ üîú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les structures de donn√©es Elixir sont immuables. C'est g√©nial du point de vue de la confiance que nos donn√©es ne seront pas corrompues au-del√† de la r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Iteraptor: biblioth√®que pour redus de carte transparent profond</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482478/"><p>  Les structures de donn√©es <em>Elixir</em> sont immuables.  C'est g√©nial du point de vue de la confiance que nos donn√©es ne seront pas corrompues au-del√† de la reconnaissance dans un autre morceau de code non pertinent, mais c'est un peu ennuyeux lorsque nous devons changer une structure profond√©ment imbriqu√©e. </p><br><p> Nous avons une brillante abstraction <a href="https://hexdocs.pm/elixir/Access.html" rel="nofollow"><code>Access</code></a> , qui simplifie consid√©rablement quatre op√©rations de base sur des objets profond√©ment imbriqu√©s en utilisant les fonctions export√©es par d√©faut du <code>Kernel</code> : </p><br><ul><li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.get_in/2</code></a> </li> <li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.put_in/{2,3}</code></a> </li> <li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.update_in/{2,3}</code></a> </li> <li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.pop_in/{1,2}</code></a> </li> </ul><a name="habracut"></a><br><p>  Ces quatre mousquetaires (et d'Artagnan <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.get_and_update_in/{2,3}</code></a> sont g√©n√©ralement utilis√©s quelque chose comme ceci: </p><br><pre> <code class="ruby hljs">iex&gt; users = <span class="hljs-string"><span class="hljs-string">%{"john" =&gt; %{age: 27, mood: ""}</span></span>, <span class="hljs-string"><span class="hljs-string">"meg"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">%{age: 23}</span></span>} <span class="hljs-comment"><span class="hljs-comment">#   iex&gt; get_in(users, ["john", :age]) #‚áí 27 #   iex&gt; put_in(users, ["john", :age], 28) #‚áí %{"john" =&gt; %{age: 28, mood: ""}, "meg" =&gt; %{age: 23}} #   iex&gt; update_in(users, ["john", :mood], &amp; &amp;1 + 1) #‚áí %{"john" =&gt; %{age: 28, mood: ""}, "meg" =&gt; %{age: 23}} #   iex&gt; pop_in(users, ["john", :mood]) #‚áí {"", %{"john" =&gt; %{age: 27}, "meg" =&gt; %{age: 23}}}</span></span></code> </pre> <br><p>  Il est pratique et fonctionne dans de nombreux cas ... sauf pour ceux o√π cela ne fonctionne pas.  Pour utiliser <code>Access</code> , vous devez conna√Ætre le chemin d'acc√®s √† l'√©l√©ment cible, et tout cela n√©cessite une quantit√© importante de code passe-partout afin de mettre √† jour plusieurs valeurs imbriqu√©es √† la fois (par exemple, supprimez toutes les feuilles avec la valeur <code>nil</code> ou mettez en √©toile le contenu de tous les champs qui n'ont pas besoin d'√™tre affich√©s dans les journaux). </p><br><p>  Pour offrir des remises en gros sur l'utilisation de structures imbriqu√©es, la biblioth√®que <code>Iteraptor</code> a √©t√© cr√©√©e. </p><br><p>  <strong>TL; DR:</strong> </p><br><ul><li>  <a href="https://github.com/am-kantox/elixir-iteraptor" rel="nofollow">codes sources</a> ; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow">la documentation</a> . </li></ul><br><hr><br><p>  It√©rer tout ce que vous pouvez r√©p√©ter comme par magie √† <em>Elixir</em> .  Pour le rendre it√©rable, impl√©mentez simplement le protocole <a href="https://hexdocs.pm/elixir/Enumerable.html" rel="nofollow"><code>Enumerable</code></a> pour ce type particulier.  Vous pouvez regrouper les passages en pipelines, cartographier, r√©duire, filtrer, √©claircir ... Pardonnez mon fran√ßais, oui.  Tous ceux qui ont pass√© au moins huit heures avec <em>Elixir ont</em> certainement vu (et peut-√™tre m√™me √©crit) quelque chose comme ceci: </p><br><pre> <code class="ruby hljs">~w<span class="hljs-params"><span class="hljs-params">|   |</span></span> <span class="hljs-params"><span class="hljs-params">|&gt; Enum.map(&amp;String.capitalize/1) |</span></span>&gt; Enum.each(fn capitalized_name -&gt; IO.puts <span class="hljs-string"><span class="hljs-string">"Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{capitalized_name}</span></span></span><span class="hljs-string">!"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Hello, ! # Hello, ! # Hello, ! # Hello, !</span></span></code> </pre> <br><p>  C'est vraiment tr√®s pratique.  Cependant, le code devient rapidement lourd lorsqu'il s'agit de structures profond√©ment imbriqu√©es, telles qu'une <em>carte</em> avec des <em>mots</em> - <em>cl√©s</em> imbriqu√©s, des listes, etc. Un bon exemple de ceci est tout fichier de configuration contenant des sous-sections imbriqu√©es. </p><br><p>  Le nombre de questions sur <em>Stack Overflow</em> avec la question ¬´comment puis-je changer la structure imbriqu√©e?¬ª M'a forc√© √† enfin cr√©er cette biblioth√®que.  La mise en ≈ìuvre chez <em>Elixir</em> semble un peu d√©routante, car tout autour est immuable, et vous ne pouvez pas simplement descendre les branches de la structure jusqu'aux feuilles, en changeant tout ce dont vous avez besoin en place.  Vous aurez besoin d'une batterie, comme, cependant, sous n'importe quel capot d'un code fonctionnel.  Changer les structures imbriqu√©es est probablement le seul exemple que j'ai vu dans ma vie o√π la mutabilit√© facilite les choses. </p><br><p>  En plus des pr√©curseurs de carte habituels, j'ai ajout√© une impl√©mentation pour stocker la valeur au plus profond de la structure, ce qui cr√©e des cl√©s interm√©diaires selon les besoins.  Il se comporte comme propos√©, mais rejet√© dans le noyau rubis <code>Hash#bury</code> .  Cette biblioth√®que sait √©galement comment "jasoniser" des structures imbriqu√©es contenant des <em>mots cl√©s</em> qui ne peuvent pas √™tre simplement s√©rialis√©s en <em>json</em> , car √† l'int√©rieur, ils sont pr√©sent√©s comme des listes de tuples √† deux √©l√©ments ( <code>[foo: :bar] == [{:foo, :bar}]</code> ), et les tuples ne sont pas s√©rialisables hors de la bo√Æte. </p><br><hr><br><p>  Alors, saluons la biblioth√®que, qui it√®re sur n'importe quelle <em>carte</em> / <em>mot</em> - <em>cl√©</em> / <em>liste</em> dans la queue et la crini√®re est presque aussi simple que les <code>Enum.each/2</code> et <code>Enum.map/2</code> . </p><br><h3 id="vozmozhnosti">  Les possibilit√©s </h3><br><ul><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.each/3</code></a> simple it√©ration, retourne la structure elle-m√™me; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.map/3</code></a> mappage <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.map/3</code></a> , renvoie une structure mapp√©e; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.reduce/4</code></a> reduus, renvoie la batterie; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.map_reduce/4</code></a> map <em>et</em> redus, renvoie un tuple avec le r√©sultat de la cartographie <em>et de la</em> batterie; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.filter/3</code></a> filtre la structure en utilisant la fonction obtenue par le dernier param√®tre; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.jsonify/2</code></a> pr√©pare la structure pour la s√©rialisation en <em>json</em> : tous les <em>mots cl√©s</em> sont remplac√©s par des <em>cartes</em> , les cl√©s sont converties en cha√Ænes; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.Extras.html" rel="nofollow"><code>Iteraptor.Extras.bury/4</code></a> √©crit la valeur profond√©ment dans la structure, cr√©ant des cl√©s interm√©diaires selon les besoins; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.to_flatmap/2</code></a> transforme la structure en une structure plate, cr√©ant soigneusement des index pour les listes;  la structure d'origine peut √™tre r√©cup√©r√©e en utilisant </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.from_flatmap/3</code></a> transforme une structure platunk avec des cl√©s concat√©n√©es en une structure profond√©ment imbriqu√©e; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.Iteraptable.html" rel="nofollow"><code>use Iteraptor.Iteraptable</code></a> impl√©mentation automatique des protocoles <code>Enumerable</code> et <code>Collectable</code> , ainsi que le comportement <code>Access</code> pour la structure.  Il y a une <a href="https://rocket-science.ru/hacking/2018/11/16/iteraptable-extending-elixir-structs" rel="nofollow">description plus d√©taill√©e</a> de ce qui est sous le capot. </li></ul><br><h3 id="slova-nichego-ne-stoyat-pokazhi-kod">  Les mots ne co√ªtent rien, montrez le code! </h3><br><h4 id="iterirovanie-mapping-redyusing">  It√©ration, cartographie, r√©duction </h4><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># each iex&gt; %{a: %{b: %{c: 42}}} |&gt; Iteraptor.each(&amp;IO.inspect(&amp;1, label: "each"), yield: :all) # each: {[:a], %{b: %{c: 42}}} # each: {[:a, :b], %{c: 42}} # each: {[:a, :b, :c], 42} %{a: %{b: %{c: 42}}} # map iex&gt; %{a: %{b: %{c: 42}}} |&gt; Iteraptor.map(fn {k, _} -&gt; Enum.join(k) end) %{a: %{b: %{c: "abc"}}} iex&gt; %{a: %{b: %{c: 42}, d: "some"}} ...&gt; |&gt; Iteraptor.map(fn ...&gt; {[_], _} = self -&gt; self ...&gt; {[_, _], _} -&gt; "********" ...&gt; end, yield: :all) %{a: %{b: "********", d: "some"}} # reduce iex&gt; %{a: %{b: %{c: 42}}} ...&gt; |&gt; Iteraptor.reduce([], fn {k, _}, acc -&gt; ...&gt; [Enum.join(k, "_") | acc] ...&gt; end, yield: :all) ...&gt; |&gt; :lists.reverse() ["a", "a_b", "a_b_c"] # map-reduce iex&gt; %{a: %{b: %{c: 42}}} ...&gt; |&gt; Iteraptor.map_reduce([], fn ...&gt; {k, %{} = v}, acc -&gt; {‚Äã{k, v}, [Enum.join(k, ".") | acc]} ...&gt; {k, v}, acc -&gt; {‚Äã{k, v * 2}, [Enum.join(k, ".") &lt;&gt; "=" | acc]} ...&gt; end, yield: :all) {‚Äã%{a: %{b: %{c: 42}}}, ["abc=", "ab", "a"]} # filter iex&gt; %{a: %{b: 42, e: %{f: 3.14, c: 42}, d: %{c: 42}}, c: 42, d: 3.14} ...&gt; |&gt; Iteraptor.filter(fn {key, _} -&gt; :c in key end, yield: :none) %{a: %{e: %{c: 42}, d: %{c: 42}}, c: 42}</span></span></code> </pre> <br><h4 id="glubokaya-vlozhennost--ploskaya-struktura-i-obratno">  Imbrication profonde ‚Üí structure plate et vice versa </h4><br><pre> <code class="ruby hljs">iex&gt; <span class="hljs-string"><span class="hljs-string">%{a: %{b: %{c: 42, d: [nil, 42]}</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">e:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">:f</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>]}} ...&gt; <span class="hljs-params"><span class="hljs-params">|&gt; Iteraptor.to_flatmap(delimiter: "_") #‚áí %{"a_b_c" =&gt; 42, "a_b_d_0" =&gt; </span><span class="hljs-literal"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span><span class="hljs-params">, "a_b_d_1" =&gt; 42, "a_e_0" =&gt; :f, "a_e_1" =&gt; 42} iex&gt; %{"abc": 42, "abd0": </span><span class="hljs-literal"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span><span class="hljs-params">, "abd1": 42, "ae0": :f, "ae1": 42} ...&gt; |</span></span>&gt; Iteraptor.from_flatmap <span class="hljs-comment"><span class="hljs-comment">#‚áí %{a: %{b: %{c: 42, d: [nil, 42]}, e: [:f, 42]}}</span></span></code> </pre> <br><h4 id="plyushki">  Brioches </h4><br><pre> <code class="ruby hljs">iex&gt; Iteraptor.jsonify([<span class="hljs-symbol"><span class="hljs-symbol">foo:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">bar:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">baz:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:zoo</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">boo:</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>]], <span class="hljs-symbol"><span class="hljs-symbol">values:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-string"><span class="hljs-string">%{"foo" =&gt; %{"bar" =&gt; %{"baz" =&gt; "zoo"}</span></span>, <span class="hljs-string"><span class="hljs-string">"boo"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">42</span></span>}} iex&gt; Iteraptor.Extras.bury([<span class="hljs-symbol"><span class="hljs-symbol">foo:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:bar</span></span>], ~w<span class="hljs-params"><span class="hljs-params">|abcd|</span></span>a, <span class="hljs-number"><span class="hljs-number">42</span></span>) [<span class="hljs-symbol"><span class="hljs-symbol">a:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">b:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">c:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">d:</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>]]], <span class="hljs-symbol"><span class="hljs-symbol">foo:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:bar</span></span>]</code> </pre> <br><hr><br><p>  Les sources <a href="https://github.com/am-kantox/elixir-iteraptor" rel="nofollow">sont ouvertes</a> , la documentation est <a href="https://hex.pm/packages/iteraptor" rel="nofollow">assez d√©taill√©e</a> , nous sommes en production depuis pr√®s de deux ans maintenant. </p><br><p>  Bonne it√©ration! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482478/">https://habr.com/ru/post/fr482478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482462/index.html">Apprenez Metaflow en 10 minutes</a></li>
<li><a href="../fr482464/index.html">Que sont * args et ** kwargs en Python?</a></li>
<li><a href="../fr482468/index.html">5 extensions et th√®mes pour VS Code qui peuvent changer la vie d'un d√©veloppeur front-end</a></li>
<li><a href="../fr482470/index.html">Chargement de page rapide sur les t√©l√©phones bon march√© les plus simples</a></li>
<li><a href="../fr482472/index.html">De quoi JavaScript est-il fait?</a></li>
<li><a href="../fr482480/index.html">Touches cosmiques de l'ann√©e sortante</a></li>
<li><a href="../fr482482/index.html">Jeux de r√¥le</a></li>
<li><a href="../fr482484/index.html">Comment augmenter l'efficacit√© du d√©veloppement en utilisant la th√©orie des contraintes</a></li>
<li><a href="../fr482486/index.html">Qu'est-ce que Misra et comment le faire cuire</a></li>
<li><a href="../fr482490/index.html">Qu'est-ce que MISRA et comment le faire cuire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>