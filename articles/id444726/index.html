<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ¹ ğŸ‘¦ğŸ¼ ğŸ•¯ï¸ OBD2 reader - diagnostik mobil ğŸ…±ï¸ ğŸ‘œ âš–ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat membuat aplikasi, kami dihadapkan dengan banyak pilihan, masalah, dan sebagainya, yang akan kami coba kenalkan kepada Anda di artikel ini. Ternya...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OBD2 reader - diagnostik mobil</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444726/">  Saat membuat aplikasi, kami dihadapkan dengan banyak pilihan, masalah, dan sebagainya, yang akan kami coba kenalkan kepada Anda di artikel ini.  Ternyata, Anda bisa berdialog dengan mobil, dan cukup produktif.  Secara alami, untuk mengatur komunikasi dengan mobil, Anda perlu "menjalin kontak", "mengajukan pertanyaan yang tepat" dan memahami dengan benar "jawaban" yang diterima dari mobil.  Oleh karena itu, artikel ini akan bertujuan menjelaskan organisasi dialog dalam bahasa yang dapat diakses, serta memberi tahu Anda kesalahan apa yang mungkin Anda temui di sepanjang jalan dan cara menghadapinya. <br><a name="habracut"></a><br><h3>  Pilihan Koneksi </h3><br>  Awalnya, perlu diklarifikasi bahwa adaptor ELM327 akan digunakan untuk terhubung ke mobil.  ELM327 adalah rangkaian mikro yang memungkinkan Anda untuk mengubah protokol yang digunakan dalam ban diagnostik mobil menjadi protokol RS232, di mana kami akan mentransfer data.  Karena fakta bahwa pengiriman data melalui protokol RS232 terjadi secara berurutan, masalah pertama muncul - kecepatan transfer data, yang akan kami coba selesaikan dalam salah satu paragraf berikut. <br><br>  Ada beberapa variasi adaptor ELM327, yang diklasifikasikan berdasarkan metode transfer data - Bluetooth, WIFI, USB.  Berdasarkan kenyataan bahwa tujuan pengembangan adalah perangkat seluler yang menjalankan Android, Anda dapat memilih dua versi ELM327 yang paling cocok, seperti Bluetooth dan WIFI.  Karena hanya ada satu cara untuk menerima dan memproses data, dan mereka hanya berbeda dalam opsi koneksi ke adaptor, Anda hanya dapat memilih satu, mengatur dialog dengannya, dan kemudian menambahkan opsi koneksi yang tersisa. <br><br><h3>  ELM327 1.5 vs ELM327 2.1 </h3><br><img src="https://habrastorage.org/webt/07/xv/ur/07xvurk7pfyn9k3ckfmuy_yc_dc.jpeg"><br><br>  Salah satu masalah pertama yang dapat Anda temui adalah masalah memilih adaptor secara langsung, dalam kasus kami Bluetooth.  Ternyata jika Anda perlu mendukung semua (setidaknya sebagian besar) mobil, Anda harus memilih versi v1.5 daripada v2.1, yang sebenarnya perlu diklarifikasi beberapa kali ketika membeli adaptor, karena penjual mencoba untuk memberikan versi adaptor bukan untuk yang ada. sebenarnya, karena  mereka tidak terlalu berbeda.  Bahkan, dalam versi v2.1 tidak ada dukungan untuk protokol J1850 PWM dan J1850 VPW, yang berarti Anda tidak akan dapat terhubung ke mobil yang menggunakan protokol ini. <br><br><h3>  Koneksi </h3><br>  Menghubungkan ke adaptor berlangsung dalam beberapa tahap: <br><br><ul><li>  Terhubung ke adaptor (Bluetooth, WIFI) </li><li>  Mengirim perintah inisialisasi (string inisialisasi) </li></ul><br>  Jika semuanya jelas dengan organisasi koneksi.  Prinsip operasi sama dengan semua obrolan Bluetooth / WIFI.  Untuk memahami cara mengirim string inisialisasi, perlu untuk mempelajari perintah apa yang ada, serta fungsi apa yang mereka lakukan. <br><br>  <b>AT Z</b> [reset semua] <br>  Setel ulang pengaturan adaptor ke status pabrik. <br>  <b>AT L1-0</b> <br>  Aktifkan / Nonaktifkan umpan baris. <br>  <b>AT E1-0</b> <br>  Gema on-off <br>  <b>AT H1-0</b> <br>  Header hidup-mati <br>  <b>AT AT0-1-2</b> <br>  Adaptive Timing Off - Adaptif Timing Auto1 - Adaptif Timing Auto2 <br>  <b>AT ST FF</b> <br>  Tetapkan batas waktu maksimum. <br>  <b>ATD</b> [atur semua ke Default] <br>  Setel ulang pengaturan ke kondisi awal yang dikonfigurasi pengguna. <br>  <b>AT DP</b> [Jelaskan Protokol saat ini] <br>  Pemindai dapat menentukan secara mandiri protokol kendaraan yang terhubung. <br>  <b>AT IB10</b> [atur tingkat Baud ISO ke 10400] <br>  Perintah ini mengatur baud rate untuk ISO 9141-2 dan <br>  ISO 14230-4 10400 <br>  <b>AT IB96</b> [atur laju Baud ISO ke 9600] <br>  Perintah ini mengatur baud rate untuk ISO 9141-2 dan <br>  ISO 14230-4 9600 untuk protokol 3,4,5. <br>  <b>AT SP h</b> [Tetapkan Protokol h] <br>  Perintah pemilihan protokol h, di mana h: <br><br>  0 - Otomatis; <br>  1 - SAE J1850 PWM (41,6 Kbaud); <br>  2 - SAE J1850 VPW (10.4 Kbaud); <br>  3 - ISO 9141-2 (5 baud init, 10,4 Kbaud); <br>  4 - ISO 14230-4 KWP (5 baud init, 10,4 Kbaud); <br>  5 - ISO 14230-4 KWP (init cepat, 10,4 Kbaud); <br>  6 - ISO 15765-4 CAN (ID 11 bit, 500 Kbaud); <br>  7 - ISO 15765-4 CAN (29 bit ID, 500 Kbaud); <br>  8 - ISO 15765-4 CAN (ID 11 bit, 250 Kbaud); <br>  9 - ISO 15765-4 CAN (29 bit ID, 250 Kbaud); <br>  <b>AT SP Ah</b> [Tetapkan Protokol h dengan Otomatis] <br><br>  Perintah menetapkan protokol default h, jika koneksi menggunakan protokol h gagal, maka adaptor memulai pemilihan protokol secara otomatis. <br><br>  Berdasarkan perintah yang dijelaskan di atas, kami membentuk string inisialisasi. <br><br><pre><code class="java hljs">initializeCommands = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"ATZ"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATL0"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATE1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATH1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATAT1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATSTFF"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATDP"</span></span>, <span class="hljs-string"><span class="hljs-string">"ATSP0"</span></span>);</code> </pre> <br>  Dianjurkan untuk memungkinkan pengguna untuk mengubah perintah inisialisasi, karena untuk memilih "kunci" untuk beberapa mobil, perlu untuk memilih pengaturan adaptor yang lebih cocok.  Dalam kasus kami, pengaturan digunakan yang sesuai untuk sebagian besar protokol standar. <br><br>  Dianjurkan untuk memperhatikan perintah APSP0, jadi kami mengatur pemilihan protokol otomatis default, ini mungkin memerlukan waktu. <br><br>  Dengan demikian, jika pengguna tahu apa protokol otomatisnya, kemudian menggunakan kemampuan untuk mengubah protokol koneksi, ia dapat mengubah 0 ke nomor protokolnya. <br><br><h3>  Baca data diagnostik </h3><br>  Perintah khusus PID digunakan untuk membaca data diagnostik. <br>  PID (Parameter id's - On-board Diagnostic Parameter Identifiers) - kode yang digunakan untuk menanyakan kinerja sensor kendaraan tertentu. <br><br>  Id utama dapat ditemukan di Wikipedia, ada satu set lengkap perintah dasar yang harus didukung oleh semua mobil.  Ada juga set perintah untuk merek dan jenis mobil tertentu, set ini disediakan untuk biaya.  Dalam kasus kami, aplikasi difokuskan pada diagnostik dasar mobil, masing-masing, kami menggunakan serangkaian perintah dasar. <br><br>  Dimungkinkan juga untuk menerima data saat ini dari mobil, sementara perintah untuk menerima data dari mobil akan memiliki <b>01</b> di awal, menunjukkan bahwa kami ingin mendapatkan data nyata.  Jika kami ingin mendapatkan data mobil yang disimpan, maka pada awal perintah Anda harus menentukan <b>02</b> .  Misalnya, perintah untuk mendapatkan kecepatan mobil saat ini adalah <b>010D</b> , dan untuk mendapatkan kecepatan yang disimpan - <b>020D</b> . <br><br>  Jika Anda hati-hati melihat jumlah perintah yang disediakan oleh sumber terbuka, Anda bisa melihat masalah yang saya tulis di awal, yaitu masalah kecepatan respons adaptor.  Karena mengirim dan menerima perintah berurutan, untuk menerima pembacaan sensor pada saat ini, perlu menunggu jawaban untuk semua perintah sebelumnya.  Dengan demikian, jika Anda meminta untuk menerima semua perintah, maka ada kemungkinan besar bahwa pembaruan data nyata akan terjadi sangat lambat.  Tetapi masalah ini dapat diselesaikan jika Anda menggunakan perintah yang hanya menampilkan tim-tim yang ada di dalam mobil.  Sebagai contoh: <br><br>  0100 - PID didukung [01 - 20] <br>  0120 - PID didukung [21 - 40] <br>  0140 - PID didukung [41 - 60] <br>  0160 - PID didukung [61 - 80] <br>  0180 - PID didukung [81 - A0] <br>  01A0 - PID didukung [A1 - C0] <br><br>  Saya akan menunjukkan cara menentukan sensor yang ada di dalam mobil menggunakan salah satu dari pids.  Sebagai contoh: <br><br><ul><li>  0100 \\ permintaan </li><li>  BB1E3211 \\ jawaban dari mobil <br></li></ul><br>  Kami menerjemahkan jawaban dari mobil ke sistem angka biner <br><br><pre> <code class="plaintext hljs">BB1E3211(16) &gt; 10111011000111100011001000010001(2)</code> </pre> <br>  Dengan menggunakan pelat berikut ini, kita dapat menentukan mana yang didukung oleh mobil kami, mulai dari 01 hingga 20: <br><br><img src="https://habrastorage.org/webt/-3/ip/o8/-3ipo8j8p5-7hxm45mttq6yizgu.jpeg"><br><br>  Berdasarkan data yang diperoleh, kami dapat menentukan bahwa mobil kami mendukung nomor-nomor berikut: <br><br><pre> <code class="plaintext hljs"> 01, 03, 04, 05, 07, 08, 0C, 0D, 0E, 0F, 13, 14, 17, 1C, 20</code> </pre> <br>  Sekarang, alih-alih mengirim semua 32 tim dan menunggu jawaban untuk mereka, terlepas dari kenyataan bahwa beberapa mungkin tidak ada, kami hanya akan menggunakan 15 tim.  Tapi ini bukan batas yang disebut optimasi.  Agar data diperbarui lebih cepat, saya menyarankan Anda untuk hanya meminta data tentang sensor yang ditampilkan di layar.  Meskipun ini membatasi beberapa fungsionalitas aplikasi.  Misalnya, catatan sejarah. <br><br><h3>  Membaca dan mendekode kesalahan mobil </h3><br>  Kesalahan mobil juga bisa berbeda dan perintah terpisah juga ada untuk mereka.  Sebagai contoh: <br><br><ul><li>  03 - Untuk menampilkan kode kesalahan yang disimpan </li><li>  0A - Untuk menampilkan kode kesalahan persisten. </li></ul><br>  Seperti dengan perintah lain, kesalahan mobil datang dalam bentuk yang disandikan, masing-masing, seperti dalam perintah lain, mereka perlu diterjemahkan untuk mendapatkan informasi yang diperlukan.  Saya akan memberikan contoh operasi decoding kesalahan.  Kode: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] dtcLetters = {<span class="hljs-string"><span class="hljs-string">'P'</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-string"><span class="hljs-string">'U'</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] hexArray = <span class="hljs-string"><span class="hljs-string">"0123456789ABCDEF"</span></span>.toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performCalculations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String fault)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String result = fault; String workingData = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> startIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; troubleCodesArray.clear(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.contains(<span class="hljs-string"><span class="hljs-string">"43"</span></span>)) { workingData = result.replaceAll(<span class="hljs-string"><span class="hljs-string">"^43|[\r\n]43|[\r\n]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.contains(<span class="hljs-string"><span class="hljs-string">"47"</span></span>)) { workingData = result.replaceAll(<span class="hljs-string"><span class="hljs-string">"^47|[\r\n]47|[\r\n]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> begin=startIndex; begin &lt; workingData.length(); begin += <span class="hljs-number"><span class="hljs-number">4</span></span>) { String dtc = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b1 = Utility.hexStringToByteArray(workingData.charAt(begin)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ch1 = ((b1 &amp; <span class="hljs-number"><span class="hljs-number">0xC0</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ch2 = ((b1 &amp; <span class="hljs-number"><span class="hljs-number">0x30</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>); dtc += dtcLetters[ch1]; dtc += hexArray[ch2]; dtc += workingData.substring(begin + <span class="hljs-number"><span class="hljs-number">1</span></span>, begin + <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dtc.equals(<span class="hljs-string"><span class="hljs-string">"P0000"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } troubleCodesArray.add(dtc); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Log.e(TAG, <span class="hljs-string"><span class="hljs-string">"Error: "</span></span> + e.getMessage()); } }</code> </pre><br>  Dan sekarang untuk penjelasannya. <br><br>  Berdasarkan respons yang diterima, kita bisa mendapatkan kode kesalahan, untuk ini kita mendekode pesan yang diterima menggunakan pelat berikut. <br><br>  Karakter pertama: <br><br><img src="https://habrastorage.org/webt/9m/cf/vy/9mcfvylfn4rve9gnwyud3lgncqi.jpeg"><br><br>  Karakter kedua: <br><br><img src="https://habrastorage.org/webt/wz/pc/56/wzpc56s9mpsdh5cxt8jncaebteq.jpeg"><br><br>  3, 4, 5 karakter dibentuk sesuai dengan tabel ini: <br><br><img src="https://habrastorage.org/webt/tr/rb/pi/trrbpitjmnle7ep9pyn_xyohpis.jpeg"><br><br>  Berdasarkan ini, kita dapat mencoba menguraikan jawaban berikut 0001000000111110 <br><br><img src="https://habrastorage.org/webt/3_/w8/d9/3_w8d99ffh2uotdv9kaujlbcnee.jpeg"><br><br>  Kode Kesalahan: P103E <br><br><h3>  Epilog </h3><br>  Pada tahap ini, kami menemukan cara mengatur dialog dengan adaptor, mengirim perintah kepadanya, menerima dan mendekripsi jawabannya.  Ini adalah bagian besar dari pekerjaan, jika Anda mempertimbangkan berapa banyak waktu yang diperlukan untuk mempelajari materi, tetapi pada saat yang sama cukup menarik.  Di luar artikel ini, ada banyak masalah yang terkait dengan antarmuka visual, serta banyak fungsi tambahan, seperti menambahkan id baru dari file, cara standar dan lanjutan untuk terhubung ke adaptor dan membuat grafik. <br><br>  Matvienko Alexander, Hossein Fakhr. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id444726/">https://habr.com/ru/post/id444726/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id444714/index.html">Bagaimana kami melakukan overclock CAD COMPASS-3D â†’ Bagian 1</a></li>
<li><a href="../id444716/index.html">Ponsel Samsung dengan layar lipat sebesar $ 2000 menampilkan lipatan</a></li>
<li><a href="../id444718/index.html">Amatir holografi - awal dari perjalanan</a></li>
<li><a href="../id444720/index.html">Apa yang penulis merokok: tambahkan sekolah lama ke dunia permainan yang gila ini</a></li>
<li><a href="../id444724/index.html">Arsitektur runet</a></li>
<li><a href="../id444728/index.html">Ketika saya menulis dan menerbitkan buku tentang Universitas Negeri Moskow, atau 12 kesalahan kritis</a></li>
<li><a href="../id444730/index.html">Mengapa teknologi tanpa server adalah revolusi dalam manajemen produk</a></li>
<li><a href="../id444732/index.html">Apache optimasi kinerja2</a></li>
<li><a href="../id444734/index.html">Habraseminar: kisah nyata tentang pemasaran konten</a></li>
<li><a href="../id444738/index.html">Pixel art: dari draft ke aset game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>