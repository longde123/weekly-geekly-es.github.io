<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â° ğŸ‰ ğŸšµğŸ¾ Meretas Gelang Kebugaran Murah ğŸ‘¨ğŸ¿â€ğŸ« ğŸ° âš ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah terjemahan. Artikel diterbitkan 27 Mei 2018 


 Pelacak kebugaran sebelum dan sesudah pembongkaran 

 Ketika saya datang ke perusahaan saat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meretas Gelang Kebugaran Murah</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413895/">  <font color="gray">Ini adalah terjemahan.</font>  <font color="gray"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel</a> diterbitkan 27 Mei 2018</font> <br><br><img src="https://habrastorage.org/webt/4n/-9/ah/4n-9ah3fvyxx23aobpo2tvx0jg4.jpeg"><br>  <i><font color="gray">Pelacak kebugaran sebelum dan sesudah pembongkaran</font></i> <br><br>  Ketika saya datang ke perusahaan saat ini, pada hari pertama saya dengan ramah diberikan satu set hadiah.  Di antara mereka ada gelang dengan pelacak kebugaran.  Terlepas dari kesukaan Anda berolahraga, ini adalah gadget yang sangat keren dari sudut pandang teknis: <br><br><ul><li>  faktor bentuk sangat kecil (sekitar 15 Ã— 40 mm); </li><li>  Bluetooth low energy (BLE); </li><li>  Tampilan OLED (96 Ã— 32 piksel); </li><li>  baterai </li><li>  Biaya USB </li><li>  akselerometer; </li><li>  motor getaran; </li><li>  harganya sekitar $ 10 (!). </li></ul><a name="habracut"></a><br>  Di luar, satu-satunya pengidentifikasi di panel belakang adalah stiker "FCC ID: 2AHFTID115".  Jika Anda google itu, tampaknya sesuai dengan perangkat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ID115</a> dan Anda bahkan dapat menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">beberapa foto</a> bagian dalamnya.  Melihat kembali <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">salah satu dari foto-foto ini</a> , jika Anda berusaha keras, Anda dapat melihat nama sirkuit terpadu terbesar (IC): N51822.  Ini menunjukkan bahwa mungkin ada mikrokontroler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nordic</a> (MCU) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nRF51822</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">prosesor</a> 32-bit ARM M0 dengan dukungan BLE bawaan, yang secara teoritis mudah diprogram untuk hal-hal lain yang harus dilakukan gelang. <br><br>  Sebelum membongkar gadget, saya sedikit Google dan menemukan bahwa di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">beberapa gelang</a> serupa chip yang sama diinstal, dan orang-orang berhasil memprogramnya. <br><br>  Membuka kasing itu tidak mudah.  Penutup plastik hitam terpaku pada latar belakang abu-abu.  Saya mencoba pengering rambut untuk melembutkan lem, dan dengan sabar memotongnya dengan pisau kecil, berusaha untuk tidak merusak plastik terlalu banyak.  Setelah dibuka, saya memastikan benar-benar ada nRF51822.  Kemudian saya membeli gelang MCU yang hampir identik dari Texas Instrument.  Perlu diingat bahwa ada opsi. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/2e6/0af/a75/2e60afa757e9f5859408e49d7f76e54f.jpg"></a> <br>  <i><font color="gray">nRF51822 dan pulpen untuk skala</font></i> <br><br><h1>  Menemukan cara untuk berkomunikasi </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi</a> mengatakan bahwa chip dapat diprogram / didebug menggunakan antarmuka dua pin ARM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Serial Wire Debug</a> (SWD).  Jika kita ingin membuat saluran komunikasi dengan sebuah chip, ini berarti dua hal: <br><br><ul><li>  Kami memerlukan programmer SWD (misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Segger J-Link</a> ). </li><li>  Kita akan membutuhkan akses ke dua pin SWD pada mikrokontroler, yaitu SWDIO (data) dan SWDCLK (pulsa clock). </li></ul><br>  Untungnya, ada beberapa bantalan yang tersedia di papan tulis.  Meskipun keberadaan mereka jelas dijelaskan oleh kebutuhan untuk debugging, pengujian dan verifikasi, saya lebih suka berpikir bahwa beberapa insinyur keren meninggalkan mereka di sana sebagai hadiah kecil untuk orang-orang seperti kita.  Tidak semuanya diberi label dengan benar, jadi saya sarankan kode berikut: <br><br><img src="https://habrastorage.org/webt/fc/gd/y9/fcgdy9fj-73b3cdtcsbgdqdjovw.jpeg"><br><br><img src="https://habrastorage.org/webt/et/-t/_4/et-t_46am8apprgxc3mtkyyg0gq.jpeg"><br>  <i><font color="gray">Sisi depan dan belakang papan sirkuit.</font></i>  <i><font color="gray">Ballpoint pen untuk skala dan nama semi-arbitrer untuk bantalan terbuka</font></i> <br><br>  Dengan menggunakan <a href="">mikroskop USB</a> murah yang sama <a href="">,</a> saya mengambil beberapa gambar dari sisi depan dan belakang papan dan mencoba melacak jejak dari mikrokontroler ke bantalan. <br><br><img src="https://habrastorage.org/webt/pc/oe/-h/pcoe-ha9fus65p5oenznunhxx30.jpeg"><br><br><img src="https://habrastorage.org/webt/nk/hy/ed/nkhyedqu2al7dvuxmbqs8ns9g9u.jpeg"><br>  <i><font color="gray">Melacak ke pin SWDIO dan SWDCLK di bagian depan dan belakang papan</font></i> <br><br>  Harap dicatat bahwa ini adalah papan sirkuit cetak multi-layer dengan lubang berlubang, jadi Anda harus memeriksa trek di kedua sisi papan.  Dari foto-foto ini, Anda dapat melacak trek dari kontak SWDIO dan SWDCLK pada chip ke bantalan IO dan CLK.  Jadi kami akan memastikan bahwa tanda CLK di papan sesuai dengan SWDCLK pada MCU, dan kontak yang tidak berlabel adalah pin SWDIO.  Sekarang Anda dapat menyiapkan tabel pemetaan pertama kami: <br><br><table><tbody><tr><th>  Pin NRF51822 </th><th>  Taman bermain </th><th>  Deskripsi </th></tr><tr><td>  SWDIO </td><td>  IO </td><td>  Output data untuk pemrograman SWD </td></tr><tr><td>  SWDCLK </td><td>  CLK </td><td>  Output clock untuk pemrograman SWD </td></tr></tbody></table><br><h1>  Operasi post-mortem </h1><br>  Setelah mendapatkan akses ke dua bantalan SWD, saya menyolder kabel yang sangat tipis ke mereka dan ke semua kontak lain yang tersedia. <br><br> <a href=""><img src="https://habrastorage.org/webt/hf/cm/6j/hfcm6jaswn6gf08oxc8ypaehmtu.jpeg"></a> <br><br><h1>  Berkedip sedikit </h1><br>  Tugas selanjutnya adalah mencoba memprogram perangkat untuk beberapa tugas.  Untuk menjalankan program yang paling sederhana, kita perlu memastikan hal-hal berikut: <br><br><ul><li>  Kami melacak kontak SWDIO / SWDCLK dengan benar. </li><li>  Pemrogram SWD sedang berjalan dan komputer dapat mengeluarkan perintah. </li><li>  Kita dapat mengkompilasi program Arm dan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SDK Nordic</a> dengan benar. </li><li>  Kita dapat mem-flash program yang dikompilasi ke dalam chip. </li><li>  Chip bekerja dengan benar dan memuat program kami. </li></ul><br>  Dalam hal ini, "halo, dunia" bisa menjadi program yang menyalakan dan mematikan LED.  Dan bahkan ini bukan SD, karena tidak ada LED bawaan di papan, dan jika Anda menambahkan yang eksternal, Anda masih perlu mencari tahu apa yang harus dihubungkan.  Ini menambah dimensi lain pada model spasial masalah.  Menurut kurangnya teorema keju gratis, saya hanya menghubungkan dua LED ke pin <code>P1</code> dan <code>P2</code> dengan harapan bahwa kita bisa sampai ke pembalut ini dengan MCU. <br><br> <a href=""><img src="https://habrastorage.org/webt/vj/t0/ab/vjt0abxchpbfjiyq87acqsyq4n4.jpeg"></a> <br>  <i><font color="gray">Hari yang buruk</font></i> <br><br>  Program driver dan command line untuk programmer J-Link SWD terdapat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs web Segger</a> .  Jika Anda menggunakan MacOS dan menggunakan Homebrew, cari rumus Cask di <code>caskroom/drivers/segger-jlink</code> .  Komunikasi dengan programmer SWD dibentuk dari <code>JLinkExe</code> baris perintah <code>JLinkExe</code> . <br><br>  Kemudian saya mengunduh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nordic nRF5 SDK</a> (saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">versi 12.3.0</a> ).  Dari contoh SDK, jelas bahwa kita memerlukan kompiler yang mampu mengkompilasi program Arm.  Jadi saya menginstal <code>gcc-arm-embedded</code> (juga tersedia di Homebrew). <br><br>  Setelah memeriksa dokumentasi SDK dan forum pengembang Nordik, saya menemukan bahwa SDK mereka paling sering digunakan dengan papan pengembangan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">seperti ini</a> .  SDK telah dikonfigurasikan sebelumnya untuk beberapa varian papan tersebut.  Karena kami berhubungan langsung dengan controller, Anda harus mengkonfigurasi beberapa parameter SDK. <br><br>  Saya menghabiskan <i>banyak</i> waktu untuk memahami ekosistem nRF5, tetapi pada akhirnya saya masih dapat menjalankan program pada sebuah chip!  <a href="">Video</a> menunjukkan dua LED yang berkedip.  Pada titik ini, saya membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori Github</a> dan membuang program dengan <code>Makefile</code> berfungsi di <code>Makefile</code> .  Salah satu rahasia utama adalah bahwa sebenarnya ada beberapa opsi untuk nRF51822, dan di tambang saya hanya ada 16 KB memori.  Jadi saya masih harus <a href="">memperbaiki skrip linker</a> . <br><br><h1>  Input / output digital </h1><br>  Seperti yang sudah saya katakan, tugas mem-flash LED memberikan beberapa harapan dan metode poke, yang mana dari kontak MCU mengarah ke <code>P1</code> dan <code>P2</code> , di mana LED terhubung.  Strategi paling sederhana adalah menghubungkan semua output secara bergantian dan menerapkan tegangan tinggi dan rendah secara bergantian.  Yang mengejutkan saya, kedua LED menyala!  Saya bahkan lebih terkejut ketika vibromotor mulai bekerja! <br><br>  Jadi, metode poke ditambahkan ke tabel: <br><br><table><tbody><tr><th>  Pin NRF51822 </th><th>  Taman bermain </th><th>  Deskripsi </th></tr><tr><td>  P0.30 </td><td>  P1 </td><td>  GPIO digital </td></tr><tr><td>  P0.00 </td><td>  P2 </td><td>  GPIO digital </td></tr><tr><td>  P0.01 </td><td>  - </td><td>  Motor getaran </td></tr></tbody></table><br><h1>  printf </h1><br>  Kemampuan untuk mentransfer data ke komputer sangat diperlukan untuk debugging.  Programmer J-Link mendukung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">transmisi waktu nyata (RTT)</a> untuk mengirim dan menerima data dari chip.  Untuk menggunakan RTT, Anda harus <code>#include "SEGGER_RTT.h"</code> dan memanggil <code>SEGGER_RTT_WriteString()</code> .  Untuk menerima data di komputer, hubungi <code>jlinkrttlogger</code> baris perintah <code>jlinkrttlogger</code> , yang disediakan dengan J-Link. <br><br><h1>  OLED </h1><br>  Tantangan lain adalah membuat OLED bekerja.  OLED yang paling umum di pasaran menjalankan driver / controller <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ssd1306</a> , dan biasanya komunikasi dengan MCU adalah melalui antarmuka serial menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SPI</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">IÂ²C</a> .  Ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh dari Adafruit</a> . <br><br>  Saya tidak menemukan tampilan seperti itu di salah satu toko biasa.  Dan ukuran 96 Ã— 32 adalah non-standar.  Pencarian dengan pengidentifikasi QT1316P01A pada layar memberikan situs China seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Aliexpress</a> , tetapi tidak ada dokumentasi kecuali untuk nama-nama kesimpulan: <br><br><img src="https://habrastorage.org/webt/jh/we/dj/jhwedjuvdabshgmklscu3wk6edi.png"><br>  <i><font color="gray">Penamaan pin OLED dengan Aliexpress</font></i> <br><br>  Jika daftar tidak berbohong, maka kontak <code>SCL</code> , <code>SDA</code> dan <code>RES#</code> memberi tahu kami bahwa ini adalah opsi IÂ²C.  Jika ada trek antara tiga pin nRF51822 dan tiga pin OLED ini, maka kita akan mengambil langkah maju.  Ayo kembali ke mikroskop. <br><br><img src="https://habrastorage.org/webt/vw/dg/9d/vwdg9dxuopykb2umzrjt1zskvv4.jpeg"><br><br><img src="https://habrastorage.org/webt/zq/zl/ym/zqzlymrnmspwkcroh4argcj_udo.jpeg"><br>  <i><font color="gray">Track Kontak Data OLED</font></i> <br><br>  Kami memperbarui tabel korespondensi: <br><br><table><tbody><tr><th>  Pin NRF51822 </th><th>  Taman bermain </th><th>  Deskripsi </th></tr><tr><td>  P0.21 </td><td>  - </td><td>  Output SDA OLED </td></tr><tr><td>  P0.22 </td><td>  - </td><td>  Pin OLED SCL </td></tr><tr><td>  P0.24 </td><td>  - </td><td>  Output OLED RES # </td></tr></tbody></table><br>  Protokol IÂ²C jauh lebih maju daripada protokol serial sederhana seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">UART</a> .  Salah satu kelebihannya adalah mendukung beberapa perangkat master dan slave pada bus yang sama.  Ini sedikit rumit: paling tidak Anda perlu memberi tahu MCU tentang perintah slave yang dikeluarkan.  Jadi pada tingkat tinggi, selain kontak fisik, ada juga alamat "logis" dari layar OLED. <br><br>  Untungnya, salah satu contoh dalam nRF5 SDK adalah pemindai IÂ²C.  Dia menginterogasi dari semua kemungkinan alamat dan laporan logis jika ada sesuatu yang diinstal di sana.  Versi modifikasi saya ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Ini menghasilkan log berikut: <br><br> <code>$ make <br> # ... <br> $ make flash <br> # ... <br> $ make log <br> # ... <br> TWI scanner. <br> TWI device detected at 0x3c.</code> <br> <br>  Berita bagus!  Kami memiliki alasan kuat untuk meyakini bahwa tampilan diidentifikasi dengan benar dan memang merupakan varian IÂ²C.  Pencarian <code>0x3c</code> mengatakan <code>0x3c</code> adalah alamat khas untuk perangkat tersebut. <br><br>  Sekarang kami siap mengirim beberapa piksel ke layar.  Pada tingkat ini, tidak ada abstraksi melalui perpustakaan.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lihat</a> dokumentasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ssd1306</a> untuk cara tingkat rendah untuk mentransfer data.  Proses ini terdiri dari urutan perintah konfigurasi yang mengatur orientasi tampilan, mode perekaman, ukuran, dll.  Kemudian, urutan byte yang ditampilkan di layar dikirim ke memori tampilan grafik (GDDRAM). <br><br>  Untuk konfigurasi yang benar, saya mempelajari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">perpustakaan ssd1306 dari Adafruit</a> dan mencoba meniru perintah yang sama.  Itulah yang menjadi bagian terbesar dari waktu dalam proyek ini.  Menemukan semua detail ternyata menjadi tugas yang sangat memakan waktu, dan masih saya tidak bisa menjelaskan beberapa hal.  Namun, itu berhasil! <br><br> <a href=""><img src="https://habrastorage.org/webt/lr/ix/r7/lrixr7dxh_7j9098jx677drocxm.jpeg"></a> <br>  <i><font color="gray">Menampilkan bitmap hard-coded</font></i> <br><br>  Kode untuk contoh ini ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Dengan pengaturan ini, tampilan dibagi menjadi 4 baris (halaman) dan 96 kolom.  Jadi halaman tingginya 8 piksel.  Byte pertama yang dikirim akan ditempatkan "vertikal" di kolom pertama dari halaman pertama.  Byte kedua akan menempati kolom kedua, lalu yang ketiga dan seterusnya, sampai ke kolom ke-96, ketika <i>kembali</i> dan dimulai dari kolom pertama di halaman kedua. <br><br>  Inilah perilaku yang <i>diharapkan</i> .  Seperti yang <a href="">ditunjukkan dalam video</a> , perilaku yang <i>diamati</i> berbeda: pertama kolom aneh diisi, lalu yang genap, dan baru kemudian kembali ke halaman kedua. <br><br>  Saya menghabiskan banyak waktu untuk memahami alasan perilaku tampilan yang bodoh, dan kemudian lebih banyak waktu untuk mengkonfigurasinya untuk memperbaikinya.  Pada akhirnya, saya menelan harga diri saya dan masih menerapkan logika rendering yang aneh dalam program untuk menyelesaikannya. <br><br><h1>  Perjalanan ke Arduino </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menggali perpustakaan Adafruit ssd1306</a> untuk Arduino, saya selalu berpikir akan menyenangkan untuk memiliki cara untuk "mensimulasikan" bit Arduino tertentu untuk mengujinya di nRF51822.  Ternyata orang yang lebih berpengalaman juga memikirkan topik ini - inilah yang dilakukan oleh proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sandeepmistry / arduino</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nRF5 yang</a> menakjubkan.  Ini mengimplementasikan perpustakaan Arduino utama menggunakan nRF5 SDK. <br><br>  Dengan proyek ini, kita dapat membuka IDE Arduino, memilih papan nRF5, dan menggunakan ekosistem Arduino yang kaya.  Saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">memotong proyek</a> dan menambahkan dukungan untuk papan dari gelang kami.  Anda dapat memilihnya dari menu tarik-turun <code>Tools &gt; Board &gt; ID115 Fitness Bracelet (nRF51822)</code> . <br><br> <a href=""><img src="https://habrastorage.org/webt/jx/ts/2h/jxts2hki_rpefinf1cjd2ms7k1w.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/50/gn/dm/50gndm8tzezp_frgdrile7la5hs.jpeg"></a> <br>  <i><font color="gray">Pustaka Adafruit ssd1306 dalam bentuk aslinya (di atas) dan dengan tambalan (di bawah)</font></i> <br><br>  Ini juga berarti bahwa sekarang kita dapat menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">perpustakaan OLED Adafruit</a> .  Yang mengejutkan dan melegakan saya, perilaku aneh yang sama terjadi dengan mengisi kolom aneh dan bahkan OLED terlebih dahulu!  Saya senang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bercabang</a> perpustakaan dan menerapkan hack yang sama.  Dibandingkan dengan pendekatan tingkat rendah, kami sekarang memiliki akses ke berbagai abstraksi keren, seperti keluaran teks: <br><br> <a href=""><img src="https://habrastorage.org/webt/gd/62/xf/gd62xfqutmoq_szmosnzvpbdu1i.jpeg"></a> <br>  <i><font color="gray">"Halo, dunia!" Yang lebih akrab.</font></i> <br><br><h1>  Input / output analog </h1><br>  Selain sinyal on / off digital, nRF51822 memiliki 10 pin untuk input analog.  Ini berguna, misalnya, untuk membaca pengisian daya baterai saat ini.  Dilihat oleh dokumentasi, membaca kontak analog menghasilkan nilai 10-bit.  Oleh karena itu, jika ada <code>0V</code> pada input, maka kita akan membaca <code>0</code> , dan jika ada <code>VCC</code> , kita akan membaca <code>1023</code> dengan nilai antara. <br><br>  Secara berkala saya membaca nilai input analog dan memplot sinyal yang paling menarik: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/483/446/36c/48344636cddd789c9c1f86c15ffca411.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b3c/3ab/38c/b3c3ab38ce708082b19a67ed9cdb30ae.png"><br>  <i><font color="gray">Efek papan goyang dan pengisian baterai sesuai dengan data dari input analog</font></i> <br><br>  Saya yakin bahwa kontak <code>P0.05</code> mengacu pada pengisian daya baterai, karena nilainya bertambah dan berkurang saat diisi dan dibuang.  Saya menduga pin <code>P0.26</code> terhubung ke salah satu output dari accelerometer, karena itu menjadi gila ketika Anda menggoyang papan.  Kontak <code>P0.03</code> dan <code>P0.04</code> juga dapat dihubungkan ke berbagai output akselerometer, tetapi di sini efek orde kedua tertentu kemungkinan besar ditumpangkan pada sinyal dari input.  Misalnya, pada grafik pertama, perhatikan bagaimana level baterai (pin 5) berubah ketika accelerometer membutuhkan lebih banyak energi.  Ini adalah contoh efek urutan kedua. <br><br>  Kode dapat ditemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dalam sketsa ini</a> .  Sumber data dan skrip grafik ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Sekarang kita dapat menambahkan beberapa baris ke tabel korespondensi kami: <br><br><table><tbody><tr><th>  Pin NRF51822 </th><th>  Taman bermain </th><th>  Deskripsi </th></tr><tr><td>  P0.05 </td><td>  - </td><td>  Input Analog - Terhubung ke Baterai </td></tr><tr><td>  P0.26 </td><td>  - </td><td>  Input Analog - One Axis Accelerometer </td></tr><tr><td>  P0.03 </td><td>  - </td><td>  Input analog - satu sumbu accelerometer (kemungkinan) </td></tr><tr><td>  P0.04 </td><td>  - </td><td>  Input analog - satu sumbu accelerometer (kemungkinan) </td></tr></tbody></table><br><h1>  Tombol </h1><br>  Dalam firmware asli, menyentuh gelang pada titik tertentu akan menyalakan layar.  Memegang titik ini memulai kronometer, jika saya ingat dengan benar.  Ini bukan tombol fisik, tetapi semacam sentuhan kapasitif yang bekerja dengan sangat baik.  Menggunakan pendekatan yang sama seperti untuk mencari keluaran digital, saya <a href="">menemukan tempat untuk terhubung ke MCU (video)</a> . <br><br>  Kodenya ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><table><tbody><tr><th>  Pin NRF51822 </th><th>  Taman bermain </th><th>  Deskripsi </th></tr><tr><td>  P0.10 </td><td>  - </td><td>  Input Digital - Tombol Bawaan </td></tr></tbody></table><br><h1>  Bluetooth low energy (BLE) </h1><br>  Fungsionalitas BLE pada chip nRF5 diimplementasikan melalui sesuatu yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SoftDevice</a> .  Ini adalah biner yang dikompilasi dengan tumpukan BLE.  Itu dijahit terlepas dari aplikasi.  Ada banyak versi SoftDevice, tergantung pada versi SDK dan versi chip. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi</a> menyediakan matriks dependensi tertentu (sayangnya, Anda tidak dapat menempatkan tautan langsung ke sana).  Ini menunjukkan SDK mana versi yang berbeda dari chip datang - dan versi SoftDevice apa itu.  Dalam kasus kami, chip ditandai QFAAH0, chip ini memiliki 256 KB memori flash, 16 KB RAM dan kompatibilitas dengan SoftDevice s130 dinyatakan. <br><br>  SDK versi 12.3 saya sudah berisi beberapa contoh penggunaan SoftDevice s130.  Dibandingkan dengan program sebelumnya yang langsung ditransfer ke microchip dari alamat <code>0x0</code> , sekarang Anda perlu mem-flash SoftDevice dari alamat <code>0x0</code> , dan program itu sendiri dari alamat <code>0x1b000</code> .  Setelah memuat dan inisialisasi, file biner SoftDevice akan pergi ke alamat ini dan mentransfer kontrol ke program kami.  Sebagai ilustrasi, saya mengambil contoh yang sama dengan LED berkedip, tetapi mengubahnya untuk firmware SoftDevice ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kode</a> ).  Perilaku yang diamati tidak berubah, kecuali bahwa Anda harus melakukan pra-flash SoftDevice: <br><br> <code>$ make <br> # ... <br> $ make flash-softdevice <br> # ... <br> $ make flash <br> # ... <br> $ make log <br> # ... <br> Hello, world!</code> <br> <br>  Mungkin aplikasi paling sederhana untuk Bluetooth adalah mengubah perangkat menjadi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">suar</a> .  Perangkat hanya menyiarkan keberadaannya.  Salah satu contohnya adalah di SDK yang disebut <code>ble_app_beacon</code> .  Diasumsikan bahwa SoftDevice <code>s130</code> sudah di-flash. <br><br>  Di sini juga, komunikasi tingkat rendah dengan chip mempersulit segalanya dibandingkan dengan pemrograman melalui SDK.  Selain menyesuaikan ukuran RAM (pengetahuan ini sulit bagi saya dalam contoh dengan LED), masalah sulit lainnya dilacak.  Ternyata, tumpukan BLE menggunakan generator jam untuk melakukan tugas yang sensitif terhadap waktu.  Dalam contoh SDK, osilator kristal eksternal diasumsikan.  Ketika saya menyadari hal ini setelah ribuan upaya untuk <code>printf</code> , saya mengubah flag konfigurasi untuk menggunakan generator jam sintetis, dan masalahnya terpecahkan.  Kode sumber suar ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h1>  BLE + Arduino </h1><br>  Ketika contoh BLE bekerja dengan nRF5 SDK, mengetahui tentang jebakan dengan RAM dan generator, saya melihat kembali pada lingkungan Arduino.  Dan lagi, ada proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sandeepmistry / arduino-BLE yang mulia</a> (dari orang yang sama dengan arduino-nRF5!), Yang memberikan abstraksi yang sangat baik di atas pengaturan BLE internal. <br><br>  Yang mengejutkan saya, saya bahkan tidak perlu membayar perpustakaan.  Penulis proyek arduino-nrf5 menghabiskan waktu dan menambahkan konfigurasi semua papan dan pengaturan, jadi sekarang memilih generator jam yang tepat untuk SoftDevice diturunkan ke pilihan sederhana dari menu drop-down <code>Tools &gt; Low Frequency Clock &gt; Synthesized</code> .  Luar biasa.  Saya dengan cepat menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">contoh</a> dengan LED hijau menyala melalui Bluetooth (dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">aplikasi ini</a> ).  Karyanya <a href="">ditampilkan dalam video</a> . <br><br><h1>  Rencana selanjutnya </h1><br>  Setelah sibuk dengan papan ini selama berjam-jam yang tak terhitung jumlahnya, tangan saya gatal selama beberapa minggu untuk menempelkannya lebih jauh ke dalam mesin cuci dan melupakannya sebentar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id413895/">https://habr.com/ru/post/id413895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id413881/index.html">Gambar buruh pelabuhan 5,94 meter dengan Telegram MTProxy</a></li>
<li><a href="../id413885/index.html">Cavium ThunderX2 Evaluasi: Mimpi Server Arm Menjadi Nyata (Bagian 1, Pendahuluan)</a></li>
<li><a href="../id413889/index.html">Tenggat waktu terlewat, atau mengapa lebih dari setengah perusahaan tidak siap untuk GDPR</a></li>
<li><a href="../id413891/index.html">Bagaimana Daftar Entitas Hukum Negara Bersatu diorganisasikan - sebuah daftar entitas hukum negara yang bersatu</a></li>
<li><a href="../id413893/index.html">Lubang sebagai alat keamanan - 2, atau cara menangkap "umpan hidup" APT</a></li>
<li><a href="../id413897/index.html">Unity3D ECS dan Sistem Pekerjaan</a></li>
<li><a href="../id413899/index.html">Data pribadi biometrik Rusia</a></li>
<li><a href="../id413901/index.html">Mengontrol Robot Self-Balancing EduMip Menggunakan Joystick PS4 Dualshock 4 via ROS</a></li>
<li><a href="../id413903/index.html">Bagaimana Cambridge Analytica Mengubah Klik Menjadi Suara</a></li>
<li><a href="../id413907/index.html">Intisari materi menarik untuk pengembang seluler # 256 (4 Juni - 12 Juni)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>