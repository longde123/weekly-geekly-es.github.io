<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèæ ü§ñ ‚åöÔ∏è Design retro para o primeiro console port√°til do distante 1979 üö£üèæ üëõ üë©üèΩ‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em 1974, a Texas Instruments lan√ßou os primeiros microcontroladores de 4 bits da fam√≠lia TMS1000, e a Intel em 1976 iniciou a produ√ß√£o de microcontrol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Design retro para o primeiro console port√°til do distante 1979</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416865/"><img src="https://habrastorage.org/webt/41/yf/ic/41yfickhp7ywna9ls3tj4tigy24.jpeg"><br><br>  Em 1974, a Texas Instruments lan√ßou os primeiros microcontroladores de 4 bits da fam√≠lia TMS1000, e a Intel em 1976 iniciou a produ√ß√£o de microcontroladores de 8 bits de sua famosa s√©rie MCS-48.  E ent√£o come√ßou. <br><a name="habracut"></a><br>  Devido ao baixo custo e √† auto-sufici√™ncia dos microcontroladores (ent√£o eles eram chamados diretamente - um microcomputador de chip √∫nico), os dispositivos eletr√¥nicos de consumo eram mais s√°bios e seu n√∫mero aumentou mais do que nunca.  Com o advento dos microcontroladores, surgiu uma classe de dispositivos como os jogos eletr√¥nicos port√°teis, a escala do "desastre" pode ser estimada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">neste link</a> .  Entre toda essa variedade de jogos antigos, um que discutirei neste post se destacou - este √© Milton Bradley Microvision, o primeiro jogo eletr√¥nico port√°til com cartuchos substitu√≠veis, que usou os dois microcontroladores acima.  Tamb√©m tentarei me debru√ßar sobre as especificidades do desenvolvimento para este console. <br><br><h3>  Descri√ß√£o geral </h3><br> <a href=""><img src="https://habrastorage.org/webt/9_/vz/pz/9_vzpzmfre7fck4ey-suxwkrgna.jpeg"></a> <br><br>  A microvis√£o foi lan√ßada nos Estados Unidos h√° quase quarenta anos, em 1979.  No total, 12 cartuchos com jogos foram vendidos para ela, entre os quais - vem completo com o console Block Buster (anal√≥gico do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Breakout</a> ), esportes - Bowling e Baseball, uma vers√£o eletr√¥nica do famoso jogo de tabuleiro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Connect Four</a> , Pinball e outros.  A maioria dos jogos pode ser avaliada no emulador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MVEM</a> , que foi feito com base em uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s√©rie</a> interessante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de publica√ß√µes</a> , das quais eu tamb√©m aprendi muitas coisas √∫teis.  Aqui n√£o vou me debru√ßar em detalhes sobre a descri√ß√£o dos jogos originais do console, mas voltarei imediatamente para o seu mundo interior. <br><br> <a href=""><img src="https://habrastorage.org/webt/gr/gu/lb/grgulbct_3jmlu9830qx2upfble.jpeg"></a> <br><br>  Uma caracter√≠stica importante do console √© um LCD de 2 polegadas com uma resolu√ß√£o de 16x16 pixels.  Bastante primitivo para os padr√µes de hoje, mas comparado aos conjuntos de LEDs e indicadores luminescentes a v√°cuo usados ‚Äã‚Äãem jogos port√°teis na √©poca, a tela LCD da matriz era um passo bastante progressivo.  Al√©m da Microvision, no mesmo ano, uma s√©rie de jogos eletr√¥nicos Mego Mini-Vid com tela semelhante apareceu √† venda, embora 13x20.  Aparentemente, naquela √©poca, esses eram os √∫nicos dispositivos √† venda com LCDs matriciais de tal resolu√ß√£o. <br><br><img src="https://habrastorage.org/webt/ga/uh/tv/gauhtvjy3-ltagudiptipvvl6lm.jpeg"><br><br>  O monitor √© controlado pelo chip Hughes SCUS0488 - este √© um driver de LCD de matriz.  O driver √© alimentado por um estabilizador de tens√£o negativa UA79MG com um par de capacitores e resistores, que √© a base do elemento mais simples. <br> <a href=""><img src="https://habrastorage.org/webt/ws/li/pb/wslipbri9usvwd5o8eztgddsnry.jpeg"></a> <br><br>  Na caixa do console tamb√©m est√£o os controles - uma matriz de bot√£o 4x3 e um resistor vari√°vel de 10k 10 como uma raquete.  Para reprodu√ß√£o de som, existe um piezodin√¢mico. <br><br>  O mais importante √© o motivo pelo qual a Microvision fez hist√≥ria, e todos se esqueceram do Mini-Vid mencionado acima, usando cartuchos substitu√≠veis. <br><br> <a href=""><img src="https://habrastorage.org/webt/12/ke/qw/12keqw-kmdbgoo85q50i2yunnjc.jpeg"></a> <br><br>  Externamente, o cartucho era uma parte superior destac√°vel da caixa.  No centro do cartucho, havia uma janela de pl√°stico cobrindo a tela, na qual eram aplicados elementos de jogo coloridos e inscri√ß√µes individuais para cada jogo.  Abaixo estavam os furos para os bot√µes cobertos por um filme fino, no qual as assinaturas eram aplicadas, e para cada jogo, furos eram feitos apenas para os bot√µes usados.  Provavelmente, esse arranjo do cartucho, segundo os autores, possibilitou maximizar a adapta√ß√£o do console a um jogo espec√≠fico. <br><br> <a href=""><img src="https://habrastorage.org/webt/ub/od/ou/ubodouuncl6f7az9o4v8n2slwuq.jpeg"></a> <br>  <i>Tabuleiro de jogo Block Buster, no caso e nas costas</i> <br><br>  A parte eletr√¥nica do cartucho foi constru√≠da em um dos dois microcontroladores - TMS1100 ou Intel 8021 com o chicote necess√°rio.  Colocar o "c√©rebro" de um console em um cartucho pode parecer uma decis√£o bastante estranha, mas s√≥ permite que voc√™ convide com dois chips por jogo.  Al√©m disso, tamb√©m adicionou versatilidade.  Ao mesmo tempo, o pre√ßo do cartucho, aparentemente devido √† presen√ßa do microcontrolador, n√£o aumentou muito (por exemplo, o custo de 8021 em grandes lotes em 1976 foi de cerca de US $ 3). <br><br>  Tudo isso alimentava uma ou duas coroas conectadas em paralelo (8021 era bastante voraz).  Al√©m disso, nas vers√µes posteriores, os contatos da segunda bateria foram removidos e o espa√ßo restante foi recomendado para ser usado como uma bateria sobressalente.  Aparentemente, isso se deve ao fato de os usu√°rios frequentemente confundirem a polaridade, obtendo um curto-circuito bastante perigoso. <br><br><h3>  Gravata </h3><br>  Comprei esse console antigo para escrever algum tipo de jogo e fazer um cartucho e, se poss√≠vel, copiar a base de elementos do original o m√°ximo poss√≠vel. <br>  Mas h√° um problema significativo - que o TMS1100, que o Intel 8021 tinha uma ROM mascarada, ou seja,  programado na f√°brica durante o processo de fabrica√ß√£o.  Existe uma sa√≠da para o microcontrolador da Intel: 8021 √© uma vers√£o simplificada do 8048, que tamb√©m possui uma ROM mascarada, mas a Intel produziu um an√°logo de 8048 com uma ROM program√°vel - 8748, ambos com apagamento ultravioleta e mais barato quando program√°vel. <br><br>  Infelizmente, a situa√ß√£o √© muito pior para o TMS1100 - houve uma vers√£o de depura√ß√£o do chip que funciona com uma ROM externa - TMS1098, mas compr√°-lo agora, se poss√≠vel, √© muito dif√≠cil.  Al√©m disso, o chip foi fabricado no pacote DIP-64, √© enorme por si s√≥ e n√£o cabe no cartucho, mas tamb√©m √© necess√°ria uma ROM bastante grande. <br><br>  Em geral, o 8748 apag√°vel por UV √© o que voc√™ precisa, e a vers√£o final do cartucho pode ser fabricada em uma vers√£o indel√©vel. <br><br> <a href=""><img src="https://habrastorage.org/webt/kg/gs/jp/kggsjpioqodpscq5i9orcdp_0im.jpeg"></a> <br>  <i>Acima est√° um P8748H program√°vel e abaixo est√° um D8748H apag√°vel por UV</i> <br><br><h3>  Intel 8021 </h3><br>  Abaixo est√° uma breve descri√ß√£o de 8021, n√£o 8748, porque  Usarei apenas os recursos truncados do 8021 para ter apenas os recursos originalmente estabelecidos pelos desenvolvedores do console. <br><br>  O subsistema de mem√≥ria, como toda a fam√≠lia MCS-48, √© baseado em uma arquitetura modificada de Harvard.  A mem√≥ria do programa √© uma ROM interna de 1024 bytes, a mem√≥ria de dados √© de 64 bytes de RAM din√¢mica. <br><br>  A organiza√ß√£o da RAM √© mostrada na figura a seguir: <br><br><img src="https://habrastorage.org/webt/ak/9m/2y/ak9m2y_m9qmrnnwbj8a8f55slf4.png"><br><br>  As c√©lulas 0‚Äì7 ocupam os registros de trabalho endere√ßados diretamente R0 - R7, com R0 e R1 sendo usados ‚Äã‚Äãcomo ponteiros para acesso indireto a todas as c√©lulas RAM.  As c√©lulas 8-23 s√£o usadas para a pilha de chamadas de 8 n√≠veis, embora tamb√©m possam ser usadas atrav√©s de R0-R1. <br><br>  O microcontrolador possui um gerador de rel√≥gio interno, a frequ√™ncia de refer√™ncia √© definida por um quartzo externo, corrente RC ou corrente LC.  Um ciclo de m√°quina dura 10 ciclos e cada ciclo leva 3 per√≠odos da frequ√™ncia de refer√™ncia.  A frequ√™ncia m√°xima √© de 3,58 MHz, enquanto o ciclo da m√°quina dura 8,38 Œºs.  A frequ√™ncia m√≠nima √© limitada pelas especifica√ß√µes da DRAM e √© de 600 kHz. <br><br>  O 8021 cont√©m duas portas de 8 bits e uma de 4 bits, que tamb√©m podem ser usadas para conectar um expansor de portas de E / S, chip 8243. Todas as portas s√£o quase bidirecionais. <br><br>  Al√©m disso, o microcontrolador possui um timer / contador de oito d√≠gitos embutido.  No modo timer, o contador T √© incrementado em 1 a cada 32 ciclos da m√°quina.  No estouro T, o sinalizador TF est√° definido.  No modo contador, os pulsos s√£o contados na entrada de teste T1. <br><br>  O sistema de comando cont√©m 64 instru√ß√µes, das quais 36 s√£o executadas em um ciclo e 28 em dois.  A maioria das instru√ß√µes √© de byte √∫nico. <br><br><div class="spoiler">  <b class="spoiler_title">Lista de instru√ß√µes com breves descri√ß√µes</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dy/lw/hd/dylwhdauhna9z62ivd8z2slns-s.png"><br></div></div><br><h3>  Prepara√ß√£o </h3><br>  N√£o houve problemas com a compra do 8748, o principal √© prestar aten√ß√£o que os chips foram produzidos usando diferentes tecnologias.  Os primeiros NMOPs exigiam tens√£o de 25V para o firmware, rotulado como D8748.  No final dos anos 70, esses microcontroladores come√ßaram a ser constru√≠dos usando a tecnologia HMOP-E (uma vers√£o aprimorada do NMOP da Intel), foram rotulados como D8748H e j√° exigiam 21V.  A mesma voltagem foi requerida por um clone posterior da NEC (mPD8748H).  A vers√£o program√°vel √∫nica foi identificada como P8748H. <br><br>  A borracha UV foi comprada no chin√™s mais simples e barato com um cron√¥metro mec√¢nico, que, como a pr√°tica demonstrou, lida perfeitamente com sua tarefa (embora n√£o haja precis√£o no cron√¥metro em intervalos curtos).  Apaga de forma confi√°vel a ROM dos chips em ~ 2,5 minutos.  Mais tarde, comprei uma borracha ZAX Quick-EII por um pre√ßo simb√≥lico das m√£os japonesas, nem sei em que ano √©, pela apar√™ncia do in√≠cio dos anos 90.  Ele usa um flash de xen√¥nio e apaga 8748 em 3 (!) Segundos, literalmente.  Um v√≠deo (n√£o o meu) com uma demonstra√ß√£o do trabalho pode ser visto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  O principal problema foi o programador.  O suporte para essa fam√≠lia obsoleta da Intel em programadores modernos est√° dispon√≠vel apenas a um custo de US $ 300.  Embora exista um Willem amador relativamente barato que possa trabalhar com o MCS-48 atrav√©s de um adaptador, mas ele precisa de LPT, o que n√£o me agradou.  Eu tive que me soldar.  Sou, digamos, um amador de r√°dio novato, ent√£o passei cerca de uma semana com ele, abandonando um dos dois 8748 que haviam chegado at√© l√° (embora eu goste do pensamento de que ela era originalmente assim).  Tomei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o</a> circuito publicado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui como</a> base, apenas o adaptei para o Atmega e para uma pot√™ncia de 24V mais conveniente.  Tudo isso foi soldado em uma t√°bua de p√£o: <br><br><img src="https://habrastorage.org/webt/5c/tt/ut/5cttutbzs817thtcpq37vlakkx0.jpeg"><br><br>  Acabou, √© claro, muito feio, e um dos mosfets trabalha at√© o limite (at√© um pouco para), mas, no final, o programador lidou com sua tarefa e me serviu bem. <br><br>  Ent√£o, est√° tudo pronto, o firmware de teste pisca alegremente com o LED, √© hora de fazer um cartucho. <br><br><h3>  Cartucho </h3><br>  A maior parte dos cartuchos trabalhava no TMS1100, porque  A Signetics, que lan√ßou a licen√ßa Intel 8021 da Intel, n√£o forneceu o suprimento necess√°rio de chips MB.  At√© alguns jogos que j√° foram escritos para o 8021 tiveram que ser portados para o TMS1100.  Isso, ali√°s, nos permitiu abandonar o pacote perigoso de duas baterias, porque o consumo do microcontrolador de TI era de apenas 0,1W versus 1W para a Intel.  Eu tenho apenas um dos 6 cartuchos com 8021, este √© o jogo Connect Four, e foi tomado como base. <br><br>  Tentei tornar o quadro o mais parecido com o original poss√≠vel, mas, √© claro, tive que fazer altera√ß√µes.  Em primeiro lugar, o tamanho do chip (DIP-40 versus DIP-28) e uma pinagem diferente.  Em segundo lugar, tivemos que mudar as denomina√ß√µes no circuito oscilat√≥rio que define a frequ√™ncia do rel√≥gio, porque  o ciclo da m√°quina para as vers√µes HMOS dos microcircuitos √© de 15 ciclos e, para as vers√µes MOS usadas nos cartuchos originais, 30 ciclos.  Portanto, para uma autenticidade completa, meu cartucho funcionar√° a 1,25 MHz contra os 2,5 MHz originais, garantindo o mesmo desempenho. <br><br> <a href=""><img src="https://habrastorage.org/webt/bz/9f/zx/bz9fzxh_7-9-djp9yamoeog5tfe.jpeg"></a> <br><br>  Na foto acima, as placas de circuito impresso acabadas encomendadas na China e, enquanto estavam ligadas, desenhei e gravei a placa de circuito e montei um "complexo de depura√ß√£o": <br> <a href=""><img src="https://habrastorage.org/webt/yh/gx/vn/yhgxvntybge5njn2cw3dppmogrs.jpeg"></a> <br><br>  Finalmente, a parte do hardware est√° pronta e voc√™ pode come√ßar a programar. <br><br><h3>  Exibi√ß√£o </h3><br> <a href=""><img src="https://habrastorage.org/webt/wa/g6/jx/wag6jx-tblcypxvqvgmz-pwau_q.jpeg"></a> <br><br>  Primeiro de tudo, eu tive que lidar com a sa√≠da para o LCD.  Como escrevi acima, ele era controlado pelo driver Hughes 0488 usando multiplexa√ß√£o (recentemente, um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> interessante sobre esse modo de controle de LCD foi publicado na Habr√©).  √â um driver, n√£o um controlador; portanto, voc√™ n√£o pode simplesmente ativar um pixel e realizar seus neg√≥cios; √© necess√°rio atualizar constantemente o conte√∫do da tela com uma frequ√™ncia de 30 a 50 Hz com comandos de baixo n√≠vel. <br><br>  O diagrama de conex√£o √© o seguinte: <br><br> <a href=""><img src="https://habrastorage.org/webt/ul/ym/rg/ulymrgc1oyensrme_-wjhprv2_u.png"></a> <br><br>  Pinagem H0488: <br><br>  <b>Vdd</b> - Pot√™ncia (3-8V) <br>  <b>R1-R16</b> - Sa√≠das de controle de string <br>  <b>C1-C16</b> - Sa√≠das de controle de coluna <br>  <b>DATA0-DATA3</b> - Barramento de Dados <br>  <b>! Data Clk</b> - Entrada do rel√≥gio de grava√ß√£o de dados <br>  <b>Pulso de trava</b> - Sinal de status de pinagem R0-R15, C0-C15 <br><br>  O significado do chip √© o seguinte: <br><br>  Atrav√©s de 4 linhas de informa√ß√£o, o estado necess√°rio de todas as 32 sa√≠das do microcircuito √© definido sequencialmente (16 por linha e coluna).  I.e.  indicamos em partes de 4 bits o estado das sa√≠das para as linhas 1-4, depois 5-8, 9-12 e finalmente para 13-16, e tamb√©m 4 vezes em 4 bits, indicamos o estado das colunas.  Cada novo dado √© cronometrado por um pulso ao longo da linha! DATA CLK.  Depois de enviarmos todos os 8 dados, um pulso na linha Latch Pulse define o estado indicado das sa√≠das R1-R16, C1-C16 que ser√£o mantidas at√© o pr√≥ximo pulso nesta linha. <br><br>  Naturalmente, em um desses ciclos, n√£o podemos indicar o estado de cada pixel individual independentemente dos outros, podemos apenas 16 (pelo n√∫mero de interse√ß√µes de linhas com colunas).  Portanto, para atualizar independentemente o estado de cada pixel, ser√£o necess√°rios 256/16 = 16 ciclos. <br><br>  Al√©m disso, temos a responsabilidade de alterar a polaridade para eliminar a tens√£o constante dos eletrodos do LCD, caso contr√°rio, o display se degradar√° rapidamente.  A troca de polaridade ocorre na extremidade posterior do sinal no Latch Pulse em uma entrada baixa! Data Clock.  √â recomend√°vel mudar a polaridade com a taxa de atualiza√ß√£o da tela. <br><br>  O acima √© ilustrado pelo seguinte gr√°fico de tempo de uma folha de dados: <br><br><img src="https://habrastorage.org/webt/58/ok/zu/58okzuokeat3bg6nf98bppvxpco.png"><br><br>  Tudo isso, implementado no assembler 8021 (que, a prop√≥sito, √© significativamente reduzido em compara√ß√£o com o assembler do resto da fam√≠lia, tudo pela mesma autenticidade que usei apenas instru√ß√µes suportadas pelo 8021), pode ser algo como isto: <br><br><pre><code class="hljs ruby">mov R<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">#32 ;    . mov r1, #10000000b ;    r1-r2 mov r2, #00000000b ;  . mov r4, #00000010b ;    !DATA CLK. mov r3, #11110000b clr c loop: ;   r1-r16   . mov a, r1 ;   r1 loadNibble ;    R1-R4. mov a, r1 ;  4   r1 rrc a ;      , xch a, r1 ;    . swap a loadNibble ;    R5-R8. mov a, r2 ;   r2 loadNibble ;    R9-R12. mov a, r2 ;  4   r2 rrc a ;      ,  xch a, r2 ;  C,     . swap a loadNibble ;    R13-R16 ;   C1-C16     . mov a, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@R</span></span></span><span class="hljs-comment">0 ;       loadNibble ;       C1-C4. mov a, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@R</span></span></span><span class="hljs-comment">0 swap a ;   4 . loadNibble ;     C4-C8. inc R0 ;     mov a, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@R</span></span></span><span class="hljs-comment">0 ;     , loadNibble ;      4 . mov a, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@R</span></span></span><span class="hljs-comment">0 swap a ;   4 . loadNibble ;     C9-C12. inc R0 ;    inc a ;   R0-R15  C0-C15, outl p1, a ;  Latch Pulse  1. jnc loop ;      . clr a ; outl p1, a ; . inc a ; outl p1, a ; loadNibble macro anl a, r3 ;    . outl p1, a ;   . orl a, r4 outl p1, a ; !DATA CLK. endm</span></span></code> </pre> <br>  Esta √© a minha vers√£o mais r√°pida da sub-rotina que exibe a imagem armazenada na RAM.  √â realizado em 1152 ciclos de m√°quina (que no nosso caso √© de ~ 12 Œºs). <br><br>  A taxa m√°xima de atualiza√ß√£o da tela √© de cerca de 70 quadros por segundo (se o microcontrolador n√£o fizer mais nada), o que √©, em princ√≠pio, redundante, portanto, para salvar registros e ROMs, na pr√°tica eu usei outras sub-rotinas - mais lentas e mais adequadas para tarefas espec√≠ficas.  Por√©m, nessa frequ√™ncia, levando em considera√ß√£o a alta in√©rcia dessa tela, √© poss√≠vel exibir fotos com 4 grada√ß√µes de cinza (como um niblonog no KPDV), mudando rapidamente os quadros.  Ou at√© curtas anima√ß√µes de quatro cores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jl/9v/1z/jl9v1zg4fi77u_67qendhuxbtt0.gif"></div><br>  Como voc√™ pode ver, o contraste deixa muito a desejar, √© especialmente impressionante quando todas as linhas e colunas est√£o envolvidas, mas n√£o h√° nada a ser feito - os custos do controle multiplex. <br><br><h3>  Teclado </h3><br> <a href=""><img src="https://habrastorage.org/webt/yh/96/k4/yh96k4mzlmmxlt7bczu5whiozcg.jpeg"></a> <br><br>  Tudo √© muito mais simples aqui.  Os bot√µes s√£o agrupados em uma matriz de 4 linhas e 3 colunas.  As linhas s√£o conectadas aos pinos P0.4-P0.7, as colunas s√£o conectadas aos P0.0-P0.2. <br><br> <a href=""><img src="https://habrastorage.org/webt/zk/2b/cy/zk2bcyshihgdt_h5ygvmxyu4gqw.png"></a> <br><br>  Como observei acima, as portas do 8021 s√£o quase bidirecionais; portanto, para conhecer o status dos terminais, voc√™ deve primeiro enviar unidades para eles.  I.e.  ao inserir dados, ocorre uma conjun√ß√£o entre os sinais de entrada e o conte√∫do do buffer, que corresponde aos dados mais recentes exibidos na porta.  Uma pesquisa de teclado √© mais ou menos assim: <br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">mov</span></span> a, <span class="hljs-comment"><span class="hljs-comment">#01111111b ; 0        1, outl p0, a ; ,      . in a, p0 ; , 0       ;     </span></span></code> </pre><br><h3>  Paddle </h3><br> <a href=""><img src="https://habrastorage.org/webt/4n/ck/j1/4nckj1to9wuxdqnp4qbuzr4zrku.jpeg"></a> <br><br>  Ou, em russo, a roda do manipulador instalada na parte inferior do console √© um resistor vari√°vel de 10kŒ© com uma al√ßa decorativa, que pode ser girada para controlar algo no jogo.  Obviamente, n√£o havia ADC no 8021 ou no TMS1100.  O √¢ngulo de rota√ß√£o foi determinado pela velocidade de carga do capacitor, que foi prudentemente soldado √† placa do console. <br><br> <a href=""><img src="https://habrastorage.org/webt/he/kh/k2/hekhk2fa7hrnv1odcm5lxximh7m.png"></a> <br><br>  Tudo funciona da seguinte maneira: enquanto os pinos P2.2-P2.3 est√£o altos, o capacitor √© descarregado e a unidade l√≥gica est√° na entrada de teste T1.  Depois de definirmos P2.2 a P2.3 para um n√≠vel baixo, o capacitor come√ßar√° a carregar e, ap√≥s algum tempo, exponencialmente dependente da resist√™ncia do resistor vari√°vel, a queda de tens√£o passar√° a ser tal que T1 seja definido como 0. Resta apenas detectar o tempo at√© o aparecimento de zero em T1, que ser√° proporcional ao √¢ngulo de rota√ß√£o da raquete (Mais detalhes e mais interessante sobre esses esquemas podem ser encontrados em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DI HALT'a</a> ).  No c√≥digo, isso pode ser assim: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">outl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">p2</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> ; 0  <span class="hljs-selector-tag"><span class="hljs-selector-tag">P2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-P2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loop</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">inc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span> ; <span class="hljs-selector-tag"><span class="hljs-selector-tag">r1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">jt1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loop</span></span> ;  <span class="hljs-selector-tag"><span class="hljs-selector-tag">T1</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span>, <span class="hljs-selector-id"><span class="hljs-selector-id">#00110000b</span></span> ; 1  <span class="hljs-selector-tag"><span class="hljs-selector-tag">P2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2-P2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">outl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">p2</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> ;    </code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ir/2c/1y/ir2c1yukhpzppj3h9jznphe_s-k.gif"></div><br><br><h3>  Som </h3><br>  Aqui √© bem simples: um piezodin√¢mico √© conectado √†s duas linhas da porta P2.0 e P2.1, tudo o que precisamos fazer √© alternar as pernas com a frequ√™ncia certa. <br><br><h3>  O que aconteceu </h3><br>  Como resultado, escrevi dois jogos - Tetris e uma esp√©cie de Flappy Bird.  Para depura√ß√£o, usei o Intel D8748H e um clone do NEC D8749HD, diferindo apenas no tamanho da ROM.  Usei o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ambiente de desenvolvimento integrado 8048</a> como montador e depurador.  No processo, obtive uma experi√™ncia inesquec√≠vel - o fluxo constante de microcontroladores do console para o apagador, do apagador para o programador e de l√° para o console, e tudo isso √© acompanhado por um cheiro hospitalar de ar ultravioleta ionizado ... <br><br>  Anotei os programas conclu√≠dos no Intel P8748H, que era program√°vel, que soldava nas placas de circuito impresso que haviam chegado at√© ent√£o. <br><br> <a href=""><img src="https://habrastorage.org/webt/_p/f8/oo/_pf8ool9qniaa7--uotj-o-bx6i.jpeg"></a> <br>  <i>Compara√ß√£o com as placas originais, da esquerda para a direita: Block Buster, Minha op√ß√£o, Connect Four</i> <br><br>  Eu tive que usar o original como um caso; apenas um dos dois cartuchos dispon√≠veis para o jogo Block Buster se mostrou inoperante. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9gqDIIBmB2c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  O casco n√£o foi suficiente para o segundo jogo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zir4Owh1Pxc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Conclus√£o </h3><br>  O Microvision MB foi produzido antes de 1981 e, embora as vendas no in√≠cio tenham sido bem-sucedidas, um pequeno n√∫mero de jogos (13 cartuchos foram lan√ßados no total) e problemas de qualidade s√£o geralmente chamados de raz√µes para o decl√≠nio nas vendas.  Eu acrescentaria um tamanho excessivamente grande, especialmente se comparado √† s√©rie Nintendo Game &amp; Watch que apareceu na √©poca e se tornou um sucesso. <br><br>  C√≥digos e esquemas de fonte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">publicados no GitHub</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416865/">https://habr.com/ru/post/pt416865/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416851/index.html">Hibernate - sobre o que os tutoriais est√£o calados</a></li>
<li><a href="../pt416855/index.html">Bacharel pela Universidade Estadual de S√£o Petersburgo</a></li>
<li><a href="../pt416857/index.html">Constru√≠mos templos - no c√≥digo e na vida. Minha experi√™ncia no desenvolvimento do meu segundo aplicativo Android</a></li>
<li><a href="../pt416859/index.html">Conhe√ßa Tudo de Uma Vez Reagir Boilerplate de Maximilian Stoiber v3.6.0</a></li>
<li><a href="../pt416863/index.html">Uma nova maneira de apresentar expositores</a></li>
<li><a href="../pt416867/index.html">Pesquisadores criaram um dispositivo para ataques locais em sistemas SCADA</a></li>
<li><a href="../pt416871/index.html">Estou cansado de aceitar pagamentos atrav√©s do WebView. O que eu fa√ßo?</a></li>
<li><a href="../pt416877/index.html">Gerenciamento de infraestrutura de impress√£o</a></li>
<li><a href="../pt416879/index.html">Escrit√≥rio √Ågil: Onde Hospedar Mil Desenvolvedores?</a></li>
<li><a href="../pt416881/index.html">Introdu√ß√£o aos contratos inteligentes. Suas limita√ß√µes potenciais e reais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>