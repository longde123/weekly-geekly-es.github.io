<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤺 👨🏻‍🔧 👩🏻‍🎓 Sortir du spa Rabbit Hole avec des rails modernes 🤶 🛌🏿 🧕🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR: Le sentier SPA est sombre et plein d'horreurs. Vous pouvez les combattre sans crainte ... ou choisir un autre chemin qui vous mènera au bon en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sortir du spa Rabbit Hole avec des rails modernes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417875/"> TL; DR: Le sentier SPA est sombre et plein d'horreurs.  Vous pouvez les combattre sans crainte ... ou choisir un autre chemin qui vous mènera au bon endroit: les Rails modernes. <br><br><img src="https://habrastorage.org/webt/bm/nz/o6/bmnzo6gdhrpqqdufks3kgylhxjw.jpeg"><br><br>  Je me souviens avoir pensé que Rails se concentrait sur le mauvais objectif lorsque DHH a annoncé Turbolinks en 2012.  J'ai ensuite été convaincu que le temps de réponse instantané pendant l'interaction avec l'utilisateur était la clé d'une expérience utilisateur supérieure.  En raison des retards du réseau, cette interactivité n'est possible que si vous minimisez la dépendance au réseau et, au lieu d'appels réseau, conservez la majeure partie de l'état sur le client. <br><br>  Je pensais que c'était nécessaire pour les applications sur lesquelles je travaillais.  Et avec cette opinion, j'ai essayé de nombreuses approches et cadres pour implémenter le même modèle: les applications monopages (SPA).  Je pensais que SPA est l'avenir.  Quelques années plus tard, je ne suis pas sûr de l'avenir, mais je veux définitivement trouver une alternative. <br><a name="habracut"></a><br><h2>  Trou de lapin SPA </h2><br>  Une application d'une page est une application JavaScript qui, une fois téléchargée, prend le contrôle sans avoir à recharger la page: rendu, réception des données du serveur, traitement de l'interaction utilisateur, mise à jour de l'écran ... <br><br>  Ces applications sont plus natives que les pages Web traditionnelles, où l'application dépend du serveur.  Par exemple, si vous utilisez Trello, vous remarquerez peut-être la rapidité avec laquelle les cartes sont créées. <br><br>  Bien sûr, une grande responsabilité s'accompagne d'une grande force.  Dans les applications Web traditionnelles, votre application serveur comprend un modèle de domaine et des règles métier, une technologie d'accès aux données pour travailler avec une base de données et une couche contrôleur pour contrôler la façon dont les pages HTML sont assemblées en réponse aux requêtes HTTP. <br><br>  C SPA est un peu plus compliqué.  Vous avez toujours besoin d'une application serveur qui inclut votre modèle de domaine et vos règles, un serveur Web, une base de données et une sorte de technologie d'accès aux données ... et un tas de choses supplémentaires en plus: <br><br>  Pour le serveur: <br><br><ul><li>  Une API qui répond aux besoins de vos clients en matière de données </li><li>  Un système de sérialisation JSON pour l'échange de données avec le client et un système de mise en cache qui le prend en charge </li></ul><br>  Pour le nouveau client JavaScript: <br><br><ul><li>  Système de modèles pour convertir des données en HTML </li><li>  Présentation de votre modèle de domaine et de vos règles </li><li>  La couche d'accès aux données dans l'application cliente pour le transfert de données vers le serveur </li><li>  Système de mise à jour des vues lorsque les données changent </li><li>  Un système pour relier les URL et les écrans (j'espère que vous n'utiliserez pas une seule adresse pour tout, cela ne ressemble pas à une application Web) </li><li>  Un système pour coller tous les composants nécessaires à l'affichage des écrans et obtenir des données pour cela </li><li>  Nouveaux modèles et architecture pour tout organiser quand </li><li>  Système de gestion des erreurs, de journalisation, de suivi des exceptions, etc. </li><li>  Système de génération de JSON pour les requêtes serveur </li><li>  Cadre de test automatisé prenant en charge votre SPA </li><li>  Un ensemble supplémentaire de tests pour l'écriture et le support </li><li>  Un ensemble supplémentaire d'outils pour assembler, empaqueter et déployer une nouvelle application </li></ul><br>  En somme, avec SPA vous aurez une autre demande de support.  Et un nouvel ensemble de problèmes à résoudre.  Et notez que vous ne pouvez pas remplacer une application par une autre.  Vous avez toujours besoin de l'application serveur (maintenant elle rendra JSON au lieu de HTML). <br><br>  Si vous n'avez jamais travaillé avec SPA, vous pouvez sous-estimer les difficultés que vous rencontrerez.  Je le sais parce que j'ai fait les mêmes erreurs dans le passé.  Rendre JSON?  Je peux le supporter.  Un modèle d'objet de domaine riche en JavaScript?  Ça a l'air drôle.  Et, vous savez, ce cadre résoudra tous ces problèmes.  Super gâteau! <br><br>  <b>Faux.</b> <br><br><h2>  API et échange de données. </h2><br>  La communication entre votre nouvelle application et le serveur est un problème complexe. <br><br>  Il existe deux forces opposées: <br><br><ul><li>  Vous souhaiterez effectuer le moins de demandes de serveur possible afin d'améliorer les performances. </li><li>  La conversion d'un seul enregistrement en JSON est simple.  Mais mélanger de grands modèles de divers enregistrements pour minimiser le nombre de requêtes n'est pas du tout.  Vous devrez développer soigneusement une logique de sérialisation pour optimiser le nombre de requêtes de base de données et maintenir les performances au niveau. </li></ul><br>  De plus, vous devez penser à ce que vous souhaitez télécharger et quand le faire pour chacun de leurs écrans.  Je veux dire, vous avez besoin d'un équilibre entre le bootstrap, ce dont vous avez besoin immédiatement et ce qui peut être chargé paresseusement, et développer une API qui vous permet de le faire. <br><br>  Certaines normes peuvent aider ici.  API JSON pour standardiser le format JSON;  ou GraphQL, pour sélectionner uniquement les données nécessaires, aussi complexes que nécessaire, dans une seule requête.  Mais aucun d'eux ne vous sauvera de: <br><ul><li>  L'élaboration de chaque échange de données </li><li>  Implémentation de requêtes pour sélectionner efficacement les données sur le serveur </li></ul><br>  Et ces deux aspects représentent une quantité de travail supplémentaire suffisante. <br><br><h2>  Temps de démarrage </h2><br>  Les gens ont l'habitude d'associer les SPA à la vitesse, mais la vérité est que les charger rapidement n'est pas si facile.  Il y a plusieurs raisons à cela: <br><br><ul><li>  Une application a besoin de données avant de rendre quelque chose, et il faut du temps pour analyser une quantité suffisamment importante de JavaScript. </li><li>  Au-delà de la demande HTTP initiale pour télécharger l'application, vous devez généralement effectuer une ou plusieurs demandes pour obtenir les données JSON nécessaires au rendu de l'écran. </li><li>  Le client doit convertir JSON en HTML afin d'afficher au moins quelque chose.  Selon le périphérique et la quantité de JSON à convertir, cela peut entraîner des retards notables. </li></ul><br>  Cela ne signifie pas qu'il est impossible de forcer le SPA à se charger rapidement.  Je dis simplement que c'est difficile et que vous devez vous en occuper, car cela ne viendra pas avec l'architecture SPA. <br><br>  Par exemple, Discourse, un SPA basé sur Ember, a des temps de chargement fantastiques, mais entre autres, ils préchargent une grande quantité de données JSON dans le cadre du HTML initial afin de ne pas faire de demandes supplémentaires.  Et je constate que l'équipe Discourse est folle dans le bon sens de la vitesse et que ses compétences sont bien au dessus de la moyenne.  Pensez-y avant de pouvoir facilement reproduire le même dans votre SPA. <br><br>  Une solution ambitieuse à ce problème est le JavaScript isomorphe: affichez votre page de démarrage sur le serveur et donnez-la rapidement au client, tandis qu'en arrière-plan du SPA, il se charge et prend le contrôle total lorsqu'il est prêt. <br><br>  Cette approche nécessite d'exécuter le runtime JavaScript sur le serveur, et ce n'est pas non plus sans problèmes techniques.  Par exemple, les développeurs doivent prendre en compte les événements de chargement SPA lorsque le processus de chargement change. <br><br>  J'aime la possibilité de réutiliser le code dans cette idée, mais je n'ai pas vu d'implémentation qui me permettrait d'aller dans la direction opposée.  De plus, ce processus de rendu de page me semble très drôle: <br><br>  - Serveur: demande au serveur API <br>  - Serveur: requête de base de données <br>  - Serveur: générer JSON <br>  - Serveur: convertir JSON en HTML <br>  - Client: afficher le HTML initial <br>  - Client: télécharger SPA <br>  - Client: analyser le HTML initial et s'abonner aux événements DOM <br><br>  Pourriez-vous simplement demander les données de la base de données, générer le code HTML et commencer à travailler? <br><br>  Ce n'est pas tout à fait juste, car vous ne serez pas SPA et parce que la majeure partie de cette magie est cachée derrière le cadre, mais cela me semble toujours faux. <br><br><h2>  L'architecture </h2><br>  Développer des applications avec une interface utilisateur riche est difficile.  Tout cela parce que c'est l'un des problèmes qui a inspiré l'émergence d'une approche orientée objet et de nombreux modèles de conception. <br><br>  La gestion du statut du client est difficile.  Les sites Web traditionnels se concentrent généralement sur les écrans à responsabilité unique qui perdent leur état au redémarrage.  Dans SPA, l'application est chargée de s'assurer que toutes les mises à jour d'état et d'écran pendant l'utilisation sont cohérentes et passent sans problème. <br><br>  En pratique, si vous avez commencé à écrire JavaScript en petites portions pour améliorer l'interaction, alors dans SPA, vous devrez écrire des tonnes de code JavaScript supplémentaire.  Ici, vous devez vous assurer que vous faites tout correctement. <br><br>  Il existe autant d'architectures différentes que de frameworks SPA: <br><br><ul><li>  La plupart des frameworks diffèrent du modèle MVC traditionnel.  Ember s'est d'abord inspiré de Cocoa MVC, mais a beaucoup changé son modèle de programmation dans les versions récentes. </li><li>  Il y a une tendance que les développeurs préfèrent les composants plutôt que la séparation traditionnelle du contrôleur et de la présentation (certains frameworks, comme Ember et Angular, ont adopté cette approche dans les versions récentes).  Tous les frameworks implémentent une sorte de liaison de données unidirectionnelle.  La liaison double face est déconseillée en raison des effets secondaires qu'elle peut apporter. </li><li>  La plupart des frameworks incluent un système de routage qui vous permet de mapper des URL et des écrans et détermine comment instancier des composants pour le rendu.  Il s'agit d'une approche Web unique qui n'existe pas sur les interfaces de bureau traditionnelles. </li><li>  La plupart des frameworks séparent les modèles HTML du code JavaScript, mais React mélange la génération HTML et JavaScript et le fait assez bien, compte tenu de son utilisation généralisée.  Il existe également un battage médiatique autour de l'intégration de CSS dans JavaScript.  Facebook, avec son architecture Flux, a à peu près influencé l'industrie, et les conteneurs comme Redux, vuex, etc. en sont fortement influencés. </li></ul><br>  De tous les frameworks que j'ai vus, Ember est mon préféré.  J'adore sa constance et le fait qu'il soit plutôt têtu.  J'aime aussi son modèle de programmation dans les versions récentes, combinant MVC traditionnel, composants et routage. <br><br>  En revanche, je suis fortement contre le camp Flux / Redux.  J'ai vu tellement de gens intelligents les utiliser que j'ai fait tout mon possible pour l'étudier et le comprendre, et pas une seule fois.  Je ne peux pas m'empêcher de secouer la tête de frustration quand je vois le code.  Je ne me vois pas heureux en écrivant un tel code. <br><br>  Enfin, je ne peux pas supporter le mélange de HTML et CSS dans des composants pleins de logique JavaScript.  Je comprends quel problème cela résout, mais les problèmes que cette approche apporte ne valent pas la peine. <br><br>  Laissons de côté les préférences personnelles, l'essentiel est que si vous choisissez le chemin SPA, vous aurez un problème très difficile: créer correctement l'architecture de votre nouvelle application.  Et l'industrie est assez loin de s'entendre sur la façon de procéder.  Chaque année, de nouveaux frameworks, modèles et versions de frameworks apparaissent, ce qui modifie légèrement le modèle de programmation.  Vous devrez écrire et maintenir une tonne de code en fonction de votre choix architectural, alors pensez-y correctement. <br><br><h2>  Duplication de code </h2><br>  Lorsque vous travaillez avec SPA, vous rencontrerez probablement une duplication de code. <br><br>  Pour votre logique SPA, vous souhaiterez créer un modèle riche d'objets représentant votre domaine et votre logique métier.  Et vous avez toujours besoin de la même chose pour la logique du serveur.  Et c'est une question de temps avant de commencer à copier le code. <br><br>  Par exemple, supposons que vous travaillez avec des factures.  Vous avez probablement une classe Invoice en JavaScript qui contient une méthode totale qui résume le prix de tous les éléments afin que vous puissiez rendre la valeur.  Sur le serveur, vous aurez également besoin de la classe Facture avec la méthode totale pour calculer ce coût afin de l'envoyer par e-mail.  Tu vois?  Les classes client et serveur Invoice implémentent la même logique.  Duplication de code. <br><br>  Comme indiqué ci-dessus, JavaScript isomorphe pourrait atténuer ce problème, ce qui faciliterait la réutilisation du code.  Et je dis au niveau, car la correspondance entre le client et le serveur n'est pas toujours 1-à-1.  Vous voudrez être sûr qu'un certain code ne quitte jamais le serveur.  Une grande quantité de code n'a de sens que pour le client.  De plus, certains aspects sont simplement différents (par exemple, l'élément serveur peut enregistrer des données dans la base de données et le client peut utiliser l'API distante).  La réutilisation du code, même si possible, est un problème complexe. <br><br>  Vous pouvez parier que vous n'avez pas besoin d'un modèle riche dans votre SPA et que vous allez plutôt travailler directement avec des objets JSON / JavaScript, répartissant la logique entre les composants de l'interface utilisateur.  Maintenant, vous avez la même duplication de code mélangée à votre code d'interface utilisateur, bonne chance avec cela. <br><br>  Et la même chose se produit si vous voulez des modèles de rendu HTML entre le serveur et le client.  Par exemple, pour le référencement, que diriez-vous de générer des pages sur le serveur pour les moteurs de recherche?  Vous devrez réécrire vos modèles sur le serveur et vous assurer qu'ils sont synchronisés avec le client.  Encore une fois la duplication de code. <br><br>  La nécessité de reproduire la logique des modèles sur le serveur et le client, d'après mon expérience, est à l'origine du malheur croissant des programmeurs.  Faire cela une fois est normal.  Lorsque vous faites cela pour la 20e fois, vous vous agripperez la tête.  Après avoir fait cela pour la 50e fois, vous vous demanderez si toutes ces pièces SPA sont nécessaires. <br><br><h2>  Fragilité </h2><br>  D'après mon expérience, le développement de bons SPA est une tâche beaucoup plus compliquée que l'écriture d'applications Web avec génération de serveur. <br><br>  Tout d'abord, peu importe votre prudence, peu importe le nombre de tests que vous écrivez.  Plus vous écrivez de code, plus vous aurez de bugs.  Et SPA représente (désolé, si je pousse fort) une énorme pile de code pour l'écriture et le support. <br><br>  Deuxièmement, comme mentionné ci-dessus, le développement d'une interface graphique riche est compliqué et se traduit par des systèmes complexes composés de nombreux éléments interagissant les uns avec les autres.  Plus le système que vous créez est complexe, plus vous avez de bogues.  Et par rapport aux applications Web traditionnelles utilisant MVC, la complexité du SPA est tout simplement folle. <br><br>  Par exemple, pour maintenir la cohérence sur le serveur, vous pouvez utiliser des restrictions dans la base de données, la validation du modèle et les transactions.  Si quelque chose ne va pas, vous répondez avec un message d'erreur.  Chez le client, tout est légèrement plus compliqué.  Tant de choses peuvent mal tourner car il se passe trop de choses.  Il se peut que certains enregistrements soient enregistrés avec succès et d'autres non.  Peut-être que vous vous êtes déconnecté au milieu d'une sorte d'opération.  Vous devez vous assurer que l'interface utilisateur reste cohérente et que l'application se remet d'une erreur.  Tout cela est possible, bien sûr, mais beaucoup plus compliqué. <br><br><h2>  Défis organisationnels </h2><br>  Cela peut paraître idiot, mais pour développer un SPA, vous avez besoin de développeurs qui savent quoi en faire.  Dans le même temps, vous ne devez pas sous-estimer la complexité du SPA, vous ne devez pas penser qu'un développeur Web expérimenté avec la bonne motivation et la bonne compréhension peut écrire un grand SPA à partir de zéro.  Vous avez besoin des bonnes compétences et de l'expérience, ou vous attendez à ce que des erreurs importantes soient commises.  Je le sais parce que c'est exactement mon cas. <br><br>  C'est peut-être un défi plus important pour votre entreprise que vous ne le pensez.  L'approche SPA encourage les équipes hautement spécialisées au lieu des équipes de généralistes: <br><br><ul><li>  Les frameworks SPA sont des logiciels complexes qui nécessitent d'innombrables heures d'expérience pour être productifs.  Seules les personnes de votre entreprise qui passent ces heures sur le code pourront prendre en charge ces applications. </li><li>  Les infrastructures SPA nécessitent des API bien pensées et productives.  Répondre à ces exigences nécessite un ensemble de compétences complètement différent de celles qui nécessitent un travail avec SPA. </li></ul><br>  Les chances sont que vous vous retrouverez avec des gens qui ne peuvent pas travailler avec SPA, et qui ne peuvent pas travailler côté serveur, simplement parce qu'ils ne savent pas comment. <br><br>  Cette spécialisation peut être idéale pour Facebook ou Google et leurs équipes composées de plusieurs couches de troupes d'ingénierie.  Mais sera-ce bon pour votre équipe de 6 personnes? <br><br><h2>  Rails modernes </h2><br>  Il y a 3 choses qui vont dans les Rails modernes qui peuvent changer d'avis sur le développement d'applications Web modernes: <br><ul><li>  l'un d'eux est Turbolinks et ceci est une explosion cérébrale </li><li>  l'autre est un vieil ami qui est ignoré aujourd'hui: réponses SJR et simples requêtes AJAX pour le rendu </li><li>  et le dernier a été ajouté récemment: Stimulus </li></ul><br>  Il est difficile de comprendre ce que c'est d'appliquer une approche sans jouer avec.  Par conséquent, je ferai quelques références à Basecamp dans les sections suivantes.  Je n'ai rien à voir avec Basecamp, sauf en tant qu'utilisateur heureux.  Quant à cet article, ce n'est qu'un bon exemple en direct de Rails modernes que vous pouvez essayer gratuitement. <br><br><h2>  Turbolinks </h2><br>  L'idée derrière Turbolinks est simple: accélérer votre application en remplaçant complètement les rechargements de page par des requêtes AJAX qui remplacent l'élément ``.  La sorcellerie intérieure qui fait ce travail est cachée.  En tant que développeur, vous pouvez vous concentrer sur la programmation traditionnelle côté serveur. <br><br>  Turbolinks est inspiré de pjax et a subi plusieurs révisions. <br><br>  J'avais l'habitude de m'inquiéter de ses performances.  J'avais tort.  L'accélération est énorme.  Ce qui m'a convaincu, c'est comment je l'ai utilisé dans le projet, mais vous pouvez simplement essayer la version d'essai dans Basecamp et jouer avec.  Essayez de créer un projet avec certains éléments, puis parcourez-les en cliquant sur les sections.  Cela vous donnera une bonne idée de l'apparence de Turbolinks. <br><br>  Je ne pense pas que Turbolinks soit tout simplement incroyable avec sa nouveauté (pjax - 8 ans).  Ou sa sophistication technique.  Je suis étonné de voir comment une idée simple peut augmenter votre productivité d'un ordre de grandeur par rapport à l'alternative au SPA. <br><br>  Permettez-moi de souligner certains des problèmes qu'il résout: <br><br><ul><li>  Échange de données.  Vous ne l'avez pas.  Pas besoin de sérialiser JSON, de créer des API ou de penser aux demandes de données qui répondent aux besoins des clients en termes de performances. </li><li>  Charge initiale.  Contrairement au SPA, cette approche stimule des temps de chargement rapides (par conception).  Pour rendre l'écran, vous pouvez obtenir les données dont vous avez besoin directement à partir de la base de données.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et interroger efficacement des données à partir de bases de données relationnelles ou mettre en cache du HTML sont des problèmes bien résolus. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Architecture: Vous n'avez pas besoin d'une architecture complexe pour organiser votre code JavaScript. </font><font style="vertical-align: inherit;">Il vous suffit de vous concentrer sur l'architecture correcte de votre application serveur, ce que vous devez toujours faire lorsque vous utilisez SPA.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le MVC sur le serveur, dans la version utilisée par Rails et de nombreux autres frameworks, est beaucoup plus simple que n'importe lequel des modèles utilisés pour la riche architecture GUI: obtenez une demande, travaillez avec la base de données pour la satisfaire et affichez la page HTML comme réponse. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, la limitation qui est toujours remplacée a un effet merveilleux: vous pouvez vous concentrer sur le rendu initial des pages au lieu de mettre à jour certaines sections (ou de mettre à jour certaines conditions dans le monde SPA). </font><font style="vertical-align: inherit;">Dans le cas général, il fait tout.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duplication de code. </font><font style="vertical-align: inherit;">Il n'y a qu'une seule vue de votre application qui réside sur le serveur. </font><font style="vertical-align: inherit;">Votre modèle de domaine, ses règles, les écrans d'application, etc. </font><font style="vertical-align: inherit;">Pas besoin de dupliquer les concepts dans le client.</font></font></li><li> .    SPA, JavaScript            ,    .  ,         ,    ,   . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notez que je ne parle pas de problèmes de nommage, mais de les résoudre. Par exemple, la réhydratation GraphQL ou SPA sont des solutions super intelligentes pour des problèmes très complexes. Mais que se passe-t-il si, au lieu d'essayer de trouver une solution, vous vous mettez dans une situation où ces problèmes n'existent pas? Il s'agit d'un changement d'approche du problème. Et il m'a fallu des années pour apprécier pleinement la capacité de cette approche à résoudre des problèmes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien sûr, Turbolinks n'est pas une solution miracle sans tracas. Le plus gros problème est qu'il peut casser le code JavaScript existant:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turbolinks est livré avec son événement de «chargement de page» personnalisé, et les plugins existants qui reposent sur des chargements de page réguliers ne fonctionneront pas. </font><font style="vertical-align: inherit;">Aujourd'hui, il existe de meilleures façons d'ajouter un comportement au DOM, mais les widgets hérités ne fonctionneront pas s'ils ne sont pas adaptés.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code JavaScript qui modifie le DOM doit être idempotent car il peut être exécuté plusieurs fois. </font><font style="vertical-align: inherit;">Encore une fois, cela invalide beaucoup de JavaScript existant.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La vitesse est excellente, mais ce n'est pas tout à fait comme dans SPA, qui peut gérer certaines interactions sans charger le serveur. </font><font style="vertical-align: inherit;">Je parlerai plus en détail des compromis plus tard.</font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rendu AJAX et réponses SJR </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous vous souvenez quand le rendu HTML via Ajax était en vogue il y a 15 ans? </font><font style="vertical-align: inherit;">Devinez quoi? </font><font style="vertical-align: inherit;">C'est toujours un excellent outil dans votre arsenal:</font></font><br><ul><li>   HTML       DOM,   ( 100 ). </li><li>    HTML  ,              . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez voir comment cette approche est ressentie dans Basecamp en ouvrant votre menu de profil en cliquant sur le bouton en haut à droite: </font></font><br><br><img src="https://habrastorage.org/webt/yc/6b/th/yc6bth2x9on2cvks1r34w937xey.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvre instantanément. Du côté du développement, vous n'avez pas à vous soucier de la sérialisation JSON et du côté client. Vous pouvez simplement afficher ce fragment sur le serveur, en utilisant toutes les fonctionnalités de Rails. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un outil similaire que Rails a inclus au fil des ans est les réponses JavaScript côté serveur (SJR). Ils vous permettent de répondre aux demandes Ajax (généralement des soumissions de formulaire) avec JavaScript qui est exécuté par le client. Il offre les mêmes avantages que le rendu AJAX des extraits de code HTML: il s'exécute très rapidement, vous pouvez réutiliser le code côté serveur et vous pouvez accéder directement à la base de données pour créer une réponse.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez voir comment cela se produit si vous allez dans Basecamp et essayez de créer une nouvelle tâche. </font><font style="vertical-align: inherit;">Après avoir cliqué sur «Ajouter une tâche», le serveur enregistre la tâche et répond avec un fragment JavaScript qui ajoute une nouvelle tâche au DOM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pense que de nombreux développeurs regardent aujourd'hui le rendu AJAX et les réponses SJR avec mépris. </font><font style="vertical-align: inherit;">Je m'en souviens aussi. </font><font style="vertical-align: inherit;">Ils sont un outil et, en tant que tels, peuvent être abusés. </font><font style="vertical-align: inherit;">Mais lorsqu'il est utilisé correctement, c'est une excellente solution. </font><font style="vertical-align: inherit;">Laissez-vous offrir une grande expérience utilisateur et une interactivité à un prix très bas. </font><font style="vertical-align: inherit;">Malheureusement, comme Turbolinks, ils sont difficiles à évaluer si vous n'avez pas encore combattu le SPA.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stimulus </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stimulus est un framework JavaScript publié il y a quelques mois. </font><font style="vertical-align: inherit;">Il ne se soucie pas du rendu ou de la gestion des états basée sur JavaScript. </font><font style="vertical-align: inherit;">Au lieu de cela, c'est juste une façon agréable et moderne d'organiser JavaScript, que vous utilisez pour ajouter du HTML:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il utilise MutationObserver pour lier le comportement au DOM, ce qui signifie qu'il ne se soucie pas de la façon dont le code HTML apparaît sur la page. </font><font style="vertical-align: inherit;">Bien sûr, cela fonctionne très bien avec Turbolinks.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il vous fera économiser une tonne de code passe-partout pour attacher le comportement au DOM, pour attacher des gestionnaires d'événements aux événements et pour placer des éléments dans le conteneur spécifié. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il vise à rendre votre code HTML lisible et compréhensible, ce qui est bien si vous avez déjà rencontré le problème de savoir quelle partie de JavaScript agit sur ce fichu élément. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il encourage la persistance dans les DOM. </font><font style="vertical-align: inherit;">Encore une fois, cela signifie qu'il ne se soucie pas de la façon dont le code HTML est généré, ce qui convient à de nombreux scénarios, y compris Turbolinks.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous acceptez le chemin Rails, votre JavaScript se concentrera sur la modification du code HTML côté serveur et l'amélioration de l'interaction (avec un peu de JavaScript). </font><font style="vertical-align: inherit;">Stimulus est conçu pour organiser un tel code. </font><font style="vertical-align: inherit;">Ce n'est pas un système SPA et ne prétend pas en être un. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai utilisé Stimulus dans plusieurs projets et j'aime vraiment ça. </font><font style="vertical-align: inherit;">Il élimine un tas de code standard, il est construit sur les dernières normes Web et se lit très bien. </font><font style="vertical-align: inherit;">Et quelque chose que j'aime particulièrement: c'est maintenant la façon standard de faire quelque chose qui devait encore être résolu dans chaque application.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jeu de compromis </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Turbolinks est généralement vendu comme «Bénéficiez de tous les avantages du SPA sans aucun inconvénient». </font><font style="vertical-align: inherit;">Je ne pense pas que ce soit complètement vrai:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les applications construites à l'aide de Rails modernes semblent rapides, mais SPA répondra toujours plus rapidement aux interactions indépendantes du serveur. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe des scénarios dans lesquels SPA a plus de sens. </font><font style="vertical-align: inherit;">Si vous devez offrir un haut niveau d'interactivité, vous devez gérer un grand nombre d'états, exécuter une logique complexe côté client, etc. Le framework SPA vous facilitera la vie.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, le développement est un jeu de compromis. </font><font style="vertical-align: inherit;">Et dans ce jeu:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modern Rails vous permet de créer des applications assez rapides et superbes. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pour une grande variété d'applications, Rails vous permet d'implémenter les mêmes fonctions avec moins de code et moins de complexité. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je crois qu'avec Rails, vous pouvez obtenir 90% de ce que SPA offre avec 10% d'effort. </font><font style="vertical-align: inherit;">En termes de performances, Rails tue SPA. </font><font style="vertical-align: inherit;">Quant à UX, je pense que de nombreux développeurs font la même erreur que moi, en supposant que SPA UX est inégalé.</font></font> Ce n'est pas le cas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En fait, comme discuté ci-dessus, vous savez mieux ce que vous faites lors de la création de votre SPA, ou UX sera en fait pire. </font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je regarde les entreprises accepter massivement les cadres SPA et voir d'innombrables articles sur la façon de faire des choses fantaisistes de style SPA. Je pense qu'il existe de nombreuses «utilisations du mauvais outil pour le travail», car je crois fermement que les types d'applications qui justifient l'utilisation du SPA sont limités. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et je dis qu'ils le justifient parce que les SPA sont complexes. En tout cas, j'espère vous en avoir convaincu. Je ne dis pas qu'il est impossible de créer de grandes applications SPA ou que les applications Rails modernes sont grandes par définition, une seule approche est super compliquée et l'autre est beaucoup plus simple. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la préparation de cet article, je suis tombé sur ce tweet:</font></font><br><br><img src="https://habrastorage.org/webt/px/54/rc/px54rc9odiplrsororeiozro--c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela m'a fait rire parce que je choisirais les premières options si l'alternative n'était pas justifiée. Il est également un représentant du genre de pensée des développeurs qui aiment la complexité et y prospèrent, même en pensant que d'autres personnes avec des critères différents sont fous. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Après de nombreuses années, j'ai réalisé que la complexité est souvent un choix. Mais dans le monde de la programmation, il est étonnamment difficile de choisir la simplicité. Nous apprécions tellement la complexité que l'acceptation de la simplicité nous fait souvent penser différemment, ce qui est par définition difficile.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N'oubliez pas que vous pouvez vous débarrasser des ennuis. </font><font style="vertical-align: inherit;">Si vous choisissez le chemin SPA, assurez-vous qu'il est justifié et que vous comprenez les problèmes. </font><font style="vertical-align: inherit;">Si vous n'êtes pas sûr, expérimentez différentes approches et voyez par vous-même. </font><font style="vertical-align: inherit;">Facebook ou Google, à leur échelle, n'ont peut-être pas le luxe de prendre de telles décisions, mais vous le pouvez probablement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et si vous êtes un développeur Rails qui a quitté Rails il y a de nombreuses années, je vous recommande d'y revenir. </font><font style="vertical-align: inherit;">Je pense que vous serez ravis.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417875/">https://habr.com/ru/post/fr417875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417865/index.html">Accessibilité Android - un loup déguisé en mouton? Conférence Yandex</a></li>
<li><a href="../fr417867/index.html">Comment évaluer la durée d'un projet informatique et quand cela ne vaut pas la peine de le faire</a></li>
<li><a href="../fr417869/index.html">Comment déboguer WebRTC</a></li>
<li><a href="../fr417871/index.html">À la ligne d'arrivée du tourisme suborbital</a></li>
<li><a href="../fr417873/index.html">Façons de créer des fenêtres pop-up</a></li>
<li><a href="../fr417877/index.html">Comment Tinder cache (légèrement) votre position</a></li>
<li><a href="../fr417879/index.html">Comment passer des examens de Microsoft gratuitement [par exemple, un récent concours]</a></li>
<li><a href="../fr417881/index.html">Le condensé de matières fraîches du monde du front-end des deux dernières semaines n ° 323 (8-22 juillet 2018)</a></li>
<li><a href="../fr417883/index.html">Création d'un dialogue pour choisir une sonnerie</a></li>
<li><a href="../fr417885/index.html">À propos de M et de V et un peu de C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>