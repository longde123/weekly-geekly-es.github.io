<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ô•Ô∏è üéä üë≤üèæ Migrando para o Zimbra com o imapsync ‚èπÔ∏è üî† üç¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Al√©m dos recursos h√° muito esperados, como o Cat√°logo de Endere√ßos Hier√°rquico e o suporte oficial ao Ubuntu 18.10 LTS, o lan√ßamento do Zimbra 8.8.12 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Migrando para o Zimbra com o imapsync</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/458912/">  Al√©m dos recursos h√° muito esperados, como o Cat√°logo de Endere√ßos Hier√°rquico e o suporte oficial ao Ubuntu 18.10 LTS, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lan√ßamento do Zimbra 8.8.12</a> nos trouxe not√≠cias sobre a futura remo√ß√£o do suporte de v√°rios utilit√°rios necess√°rios para a migra√ß√£o de outros sistemas de correio para o Zimbra Collaboration Suite.  Em particular, o suporte ao Assistente de Migra√ß√£o do ZCS para Domino foi completamente descontinuado, e o Assistente de Migra√ß√£o do ZCS para Exchange agora suporta apenas a importa√ß√£o de arquivos PST do Outlook.  Para implementar uma migra√ß√£o completa, os desenvolvedores do Zimbra Collaboration Suite oferecem o uso de servi√ßos online pagos, mas nem toda empresa est√° pronta para fornecer seus dados da caixa de correio a terceiros por raz√µes de seguran√ßa, e nem toda empresa pode arcar com os custos adicionais associados √† migra√ß√£o para o Zimbra.  Especialmente para esses usu√°rios, existe o programa imapsync, capaz de fornecer migra√ß√£o incremental confi√°vel de qualquer sistema de correio para o Zimbra. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="imagem"><a name="habracut"></a><br><br>  O Imapsync √© um utilit√°rio gratuito e gratuito dispon√≠vel nos reposit√≥rios de qualquer distribui√ß√£o Zimbra Linux oficialmente suportada.  O objetivo deste programa √© transferir email entre diferentes servidores de email e ele lida perfeitamente com ele.  Gra√ßas √† flexibilidade das configura√ß√µes, o correio pode ser transferido de forma incremental e em modo totalmente autom√°tico.  Vamos ver como voc√™ pode usar o imapsync para migrar do Lotus Domino e MS Exchange para o Zimbra Collaboration Suite. <br><br><h3>  Migrando do MS Exchange para Zimbra </h3><br>  Para que a migra√ß√£o de email seja bem-sucedida, voc√™ precisa concluir uma s√©rie de preparativos.  Antes de tudo, precisamos criar os mesmos usu√°rios no servidor Zimbra e no servidor MS Exchange com as mesmas senhas.  Ao executar esta tarefa, √© muito √∫til configurar automaticamente os usu√°rios do Zimbra usando o AD.  O processo desse ajuste autom√°tico √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descrito</a> em um de nossos artigos anteriores. <br><br>  Depois que todas as contas do AD ou Exchange forem migradas, voc√™ precisar√° instalar o pacote imapsync no servidor com Zimbra.  Se voc√™ usa o Ubuntu como sistema operacional para Zimbra, pode instalar o programa usando o comando <b>sudo apt-get install imapsync -y</b> , no CentOS e RHEL, a instala√ß√£o ser√° realizada usando o comando <b>sudo yum install imapsync -y</b> . <br><br>  Quando a instala√ß√£o do pacote e todas as depend√™ncias estiverem conclu√≠das, vamos para a configura√ß√£o do servidor Exchange.  Nele, precisaremos ativar o servi√ßo IMAP4.  Isso √© feito executando o arquivo <b>services.msc</b> , ap√≥s o qual voc√™ precisa ir para Ferramentas&gt; Servi√ßos -&gt; IMAP4 Microsoft Exchange -&gt; Iniciar.  Depois disso, voc√™ precisar√° conceder ao administrador acesso √†s caixas de correio do usu√°rio para evitar o uso de senhas de usu√°rio durante a migra√ß√£o e tamb√©m desabilitar ou configurar pol√≠ticas de limite de velocidade para que elas n√£o se tornem um obst√°culo √† migra√ß√£o.  Agora voc√™ pode come√ßar a transferir e-mails de servidor para servidor. <br><br>  Em nossa infraestrutura, o MS Exchange estar√° localizado no host <b>exchange.company.ru</b> e o Zimbra no host <b>zimbra.company.ru</b> .  Os usu√°rios ser√£o transferidos um a um usando a linha de comando, na qual executaremos o utilit√°rio imapsync com v√°rios par√¢metros necess√°rios para a migra√ß√£o.  Antes de tudo, note-se que no Zimbra, como no MS Exchange, as contas de administrador t√™m acesso ao conte√∫do de todas as caixas de correio dos usu√°rios, o que significa que, para migrar para um novo servidor de email, o administrador do sistema n√£o precisa saber as senhas das contas de usu√°rio comuns.  √â por isso que a migra√ß√£o de cada usu√°rio do MS Exchange para Zimbra ser√° realizada usando um comando do seguinte formato: <br><br><pre><code class="plaintext hljs">imapsync --host1 exchange.company.ru --user1 "xxxxx" --authuser1 "yyyyy" --password1 "zzzzz" --nosslcheck --host2 zimbra.company.ru --user2 "XXXXX" --authuser1 "YYYYY" --password2 "ZZZZZ"</code> </pre> <br>  Nesse comando, especificamos o host de origem ( <b>--host1</b> ) do qual o imapsync coletar√° os dados da conta, bem como o host ( <b>--host2</b> ) no qual esses dados ser√£o gravados.  Tamb√©m especificamos o nome de usu√°rio ( <b>--user1</b> ) no primeiro host e o nome de usu√°rio correspondente ( <b>--user2</b> ) no segundo host.  Para acessar seus dados, especificamos o nome da conta de administrador ( <b>--authuser1</b> ) e a senha de administrador ( <b>--password1</b> ) do primeiro host e, para registrar os dados transmitidos, o nome da conta de administrador ( <b>--authuser2</b> ) e a senha administrador ( <b>--password2</b> ) do segundo host. <br><br>  Em um mundo ideal, esse comando seria suficiente para transferir dados do usu√°rio entre servidores com MS Exchange e Zimbra, mas, como costuma acontecer, as diferen√ßas entre as solu√ß√µes fazem suas pr√≥prias corre√ß√µes e, portanto, uma simples transfer√™ncia de dados do MS Exchange levar√° a um caos terr√≠vel nas caixas de correio do Zimbra .  O obst√°culo nesse caso s√£o os diferentes nomes das pastas nas caixas de correio.  Para evitar confus√£o durante a transfer√™ncia de dados, √© necess√°rio aproximar nossa equipe da seguinte forma: <br><br><pre> <code class="plaintext hljs">imapsync --subscribe_all --maxmessagespersecond 4 --addheader --f1f2 "Inbox=INBOX" \ --f1f2 "Sent Items=Sent" --f1f2 "Sent items=Sent" --exclude "^Journal|^Tasks|^Trash|Contacts|Calendar|RSS Feeds" \ --useheader "Message-ID" --buffersize 8192000 --nosyncacls --allowsizemismatch --usecache --syncinternaldates --skipsize --nofoldersizes \ --tls1 --port1 143 --user1 "xxxxxxxxxx" --authuser1 "besadmin" --password1 "XXXXXXX" \ --host2 'xxxxxxx' --user2 "xxxxxx" --authuser2 "XXXXXX" --password2 "XXXX" --tls2 --port2 7143 \ --regextrans2 "s/Inbox1/INBOX/i" --regextrans2 "s/Sent Items/Sent/i" --regextrans2 "s/sent-mail/Sent/i" --regextrans2 "s/Deleted Items/Trash/i" --regextrans2 "s/Deleted Messages/Trash/" \ --delete2duplicates --timeout 600 --pidfile "impasync.local.pid" --logfile "imapsync.log" --sep1 "/" --errorsmax "100"</code> </pre> <br>  Observe que esse n√£o √© um script universal que funcionar√° perfeitamente em qualquer infraestrutura.  Muitas coisas podem depender de v√°rios recursos da sua infraestrutura.  √â por isso que, antes de iniciar uma migra√ß√£o em grande escala, certifique-se de testar a transfer√™ncia de dados entre sistemas em v√°rias contas comerciais n√£o cr√≠ticas. <br><br>  Deixe a abund√¢ncia de par√¢metros com os quais o imapsync √© iniciado n√£o o assusta.  a maioria deles √© necess√°ria precisamente para que, ao transferir pastas da caixa de correio, n√£o haja confus√£o e todos os elementos do MS Exchange sejam transferidos para o Zimbra.  Por exemplo, o par√¢metro <b>--subscribe_all</b> permite ao imapsync obter todas as pastas da sua conta para que voc√™ possa trabalhar com elas mais tarde.  A <b>op√ß√£o --f1f2</b> permite alterar o nome da pasta durante a sincroniza√ß√£o.  Ou seja, ao sincronizar, por exemplo.  a pasta Itens enviados muda seu nome para Enviado, o que permite ajustar perfeitamente seu conte√∫do na estrutura de pastas do Zimbra Collaboration Suite.  O par√¢metro <b>--regextrans2</b> tamb√©m permite alterar os nomes das pastas e baseia-se no mecanismo de <b>express√£o regular</b> da linguagem de programa√ß√£o Perl, para que aqueles que est√£o familiarizados com essa linguagem aprendam facilmente esse par√¢metro. <br><br>  Para explicar o que as <b>op√ß√µes --addheader</b> e <b>--useheader fazem</b> , ser√° necess√°rio investigar exatamente como ocorre a sincroniza√ß√£o de letras no imapsync.  O fato √© que, para sincronizar o imapsync, √© necess√°rio identificar letras nos dois servidores para decidir se deseja sincroniz√°-las ou n√£o.  Para verific√°-los, este utilit√°rio usa par√¢metros como "ID da mensagem:" e "Recebido:" (n√∫mero de identifica√ß√£o e hora do recebimento), ausentes nos emails, como rascunhos.  Para sincroniz√°-los normalmente, precisamos do comando --addheader.  Permite adicionar um n√∫mero de identifica√ß√£o a eles para identificar e comparar essas letras durante a sincroniza√ß√£o.  O par√¢metro --useheader permite comparar letras usando apenas um dos dois par√¢metros durante a sincroniza√ß√£o. <br><br>  Depois de escrever o script perfeito que nos permitir√° transferir a transfer√™ncia perfeita de contas do MS Exchange para Zimbra, permanece um problema significativo, que est√° relacionado ao fato de ainda termos que transferir usu√°rios entre servidores, um de cada vez.  Isso n√£o √© o ideal, especialmente nas empresas em que h√° muitos funcion√°rios e o n√∫mero de caixas de correio √© medido em milhares.  No entanto, esse processo pode ser otimizado significativamente criando uma lista de contas e, em seguida, escreva um pequeno script que transfira automaticamente os emails com base nos nomes das contas.  Para fazer isso, criaremos o arquivo <b>imap_users</b> e adicionaremos todos os dados necess√°rios no seguinte formato: <br><br><pre> <code class="plaintext hljs">domains=( domain1\ domain2) users=( user1@domain1\ user2@domain1\ user3@domain1\ user1@domain2\ user2@domain2\ user3@domain2)</code> </pre> <br>  Depois disso, escreveremos o pr√≥prio script.  Temos algo parecido com isto: <br><br><pre> <code class="plaintext hljs">. imap_users src_srv = exchange.company.ru dest_srv = zimbra.company.ru for ((i = 0; i &lt; ${#users[@]}; i++ )) do /usr/bin/imapsync --subscribe_all --maxmessagespersecond 4 --addheader --f1f2 "Inbox=INBOX" \ --f1f2 "Sent Items=Sent" --f1f2 "Sent items=Sent" --exclude "^Journal|^Tasks|^Trash|Contacts|Calendar|RSS Feeds" \ --useheader "Message-ID" --buffersize 8192000 --nosyncacls --allowsizemismatch --usecache --syncinternaldates --skipsize --nofoldersizes \ --tls1 --port1 143 --host1 $src_srv --user1 ${users[$i]} --authuser1 "besadmin" --password1 "XXXXXXX" --nosslcheck \ --host2 $dest_srv --user2 ${users[$i]} --authuser2 "XXXXXX" --password2 "XXXX" --tls2 --port2 7143 \ --regextrans2 "s/Inbox1/INBOX/i" --regextrans2 "s/Sent Items/Sent/i" --regextrans2 "s/sent-mail/Sent/i" --regextrans2 "s/Deleted Items/Trash/i" --regextrans2 "s/Deleted Messages/Trash/" \ --delete2duplicates --timeout 600 --pidfile "impasync.local.pid" --logfile "imapsync.log" --sep1 "/" --errorsmax "100" done</code> </pre> <br>  Como a transfer√™ncia de dados √© incremental, voc√™ pode primeiro transferir a maior parte dos dados entre os servidores e, em uma breve interrup√ß√£o t√©cnica, transferir a pequena quantidade de dados acumulada desde a √∫ltima sincroniza√ß√£o, transferir todas as mensagens recebidas para o Zimbra e torn√°-lo o principal sistema de mensagens.  Lembramos que, antes de migrar para o novo sistema de e-mail, voc√™ precisa notificar os funcion√°rios sobre a transi√ß√£o futura, realizar treinamento com eles e tamb√©m preparar memorandos sobre onde est√£o localizadas suas fun√ß√µes habituais em Zimbra.  Gra√ßas a isso, a migra√ß√£o ocorrer√° sem problemas e n√£o criar√° problemas para os neg√≥cios. <br><br><h3>  Migrando do Lotus / Domino para Zimbra </h3><br>  De v√°rias maneiras, o processo de migra√ß√£o do sistema de correio IBM usando o imapsync repete o processo de migra√ß√£o do MS Exchange e de qualquer outro sistema de correio.  No entanto, no processo de migra√ß√£o direta, muitos administradores encontram um erro com a desconex√£o via IMAP e, consequentemente, o t√©rmino da sincroniza√ß√£o.  Ao mesmo tempo, nenhuma mensagem de erro aparece nos logs.  Se durante a migra√ß√£o do Lotus / Domino voc√™ encontrou esse problema, as seguintes a√ß√µes ajudar√£o a resolver esse problema: <br><br><ul><li>  Inicie o Lotus Notes com privil√©gios de administrador e v√° para o Cat√°logo de endere√ßos. </li><li>  Nas configura√ß√µes do Cat√°logo de endere√ßos, altere o formato padr√£o da mensagem para "MIME preferido" </li><li>  No mesmo Lotus Notes em execu√ß√£o com privil√©gios de administrador, altere o formato do banco de dados do usu√°rio para Mail (R6), que √© retirado do servidor e n√£o do cliente de email </li><li>  Desligue o Lotus Domino Router no console de administra√ß√£o do Domino usando o comando tell router quit </li><li>  Empacote o banco de dados do usu√°rio no console de administra√ß√£o do Domino usando o comando ‚Äúload compact userdb.nsf‚Äù </li><li>  Verifique se h√° erros no banco de dados executando o comando fixup userdb.nsf no console do Domino (n√£o no console do administrador) </li><li>  No console de administra√ß√£o do Domino, execute o comando ‚Äúconvert -e userdb.nsf‚Äù para preparar o banco de dados para a transfer√™ncia do imap </li><li>  No console de administra√ß√£o do Domino, execute o comando ‚Äúconvert -h userdb.nsf‚Äù para adicionar cabe√ßalhos imap a todas as mensagens. </li></ul><br>  Ap√≥s concluir todas essas etapas, a transfer√™ncia de mensagens do Lotus / Domino para Zimbra usando o imapsync deve passar sem problemas. <br><br>  Al√©m dos utilit√°rios para migra√ß√£o, os clientes Zimbra para computadores desktop e dispositivos m√≥veis ficaram sem suporte.  Al√©m disso, o cliente da web em HTML foi removido do suporte, que foi usado para garantir a compatibilidade com navegadores mais antigos e dispositivos de baixo consumo de energia.  Todos eles podem ser facilmente substitu√≠dos por clientes de terceiros, devido ao fato de o Zimbra suportar quase todos os padr√µes e protocolos abertos. <br><br>  Lembre-se de que a migra√ß√£o entre servidores Zimbra pode ser feita usando a Ferramenta de Migra√ß√£o Zextras gratuita, que voc√™ pode baixar no site oficial da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zextras</a> . <br><br>  Para todas as perguntas relacionadas ao Zextras Suite, voc√™ pode entrar em contato com o representante da Zextras Katerina Triandafilidi pelo e-mail katerina@zextras.com </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt458912/">https://habr.com/ru/post/pt458912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt458902/index.html">5 erros comuns em Python para iniciantes</a></li>
<li><a href="../pt458904/index.html">Visualiza√ß√£o do n√∫mero de vit√≥rias para equipes da NBA usando gr√°ficos de barras animados em R</a></li>
<li><a href="../pt458906/index.html">[Ecaterimburgo, an√∫ncio] Flutteron - um workshop sobre desenvolvimento em Flutter</a></li>
<li><a href="../pt458908/index.html">Digitalizando documentos pela rede</a></li>
<li><a href="../pt458910/index.html">Compara√ß√£o do PostgreSQL com grandes p√°ginas do Linux</a></li>
<li><a href="../pt458914/index.html">O que (n√£o) voc√™ precisa saber para criar jogos no Unity</a></li>
<li><a href="../pt458916/index.html">Sob o cap√¥ do React. Escrevemos nossa implementa√ß√£o do zero</a></li>
<li><a href="../pt458918/index.html">O que voc√™ pode aprender com o design de jogos hiper-casuais</a></li>
<li><a href="../pt458920/index.html">Confer√™ncia para f√£s do DevOps</a></li>
<li><a href="../pt458922/index.html">Como passar do ESXi para o KVM / LXD e n√£o enlouquecer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>