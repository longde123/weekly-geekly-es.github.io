<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèª üëú üò¨ Configurar un servidor de impresi√≥n CUPS desde cero con y sin autorizaci√≥n de dominio en una red con diferentes sistemas operativos üòí ‚§¥Ô∏è üéø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Configurar un servidor de impresi√≥n CUPS desde cero con y sin autorizaci√≥n de dominio en una red con diferentes sistemas operativos 
 Entrada 


 Ento...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configurar un servidor de impresi√≥n CUPS desde cero con y sin autorizaci√≥n de dominio en una red con diferentes sistemas operativos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443094/"><h2 id="nastroyka-s-nulya-printservera-cups-s-domennoy-avtorizaciey-i-bez-nee-v-seti-s-raznymi-os">  Configurar un servidor de impresi√≥n CUPS desde cero con y sin autorizaci√≥n de dominio en una red con diferentes sistemas operativos </h2><br><h3 id="vstuplenie">  Entrada </h3><br><p>  Entonces  Presumiblemente, el servicio de impresi√≥n CUPS es una soluci√≥n poderosa que le permite organizar la administraci√≥n centralizada de impresoras en la empresa.  As√≠ es, pero durante el proceso de configuraci√≥n necesitar√° pasar alg√∫n tiempo buscando una soluci√≥n a los muchos problemas peque√±os y obvios de Google, especialmente si su necesidad va m√°s all√° de los manuales de configuraci√≥n est√°ndar. </p><br><p>  El art√≠culo describir√° la instalaci√≥n del servidor de impresi√≥n CUPS en Ubuntu Server en una red con un dominio activo de Active Directory, aunque su presencia no es necesaria y puede omitir con seguridad las instrucciones para configurar la interacci√≥n con √©l, configurarlo, as√≠ como configurar m√°quinas cliente Linux y Windows para interactuar con Este servidor de impresi√≥n. </p><a name="habracut"></a><br><p>  En las instrucciones, el dominio se llamar√° <strong>example.com</strong> , el servidor de impresi√≥n en s√≠ ser√° <strong>cupsserver</strong> ( <strong>cupsserver.example.com</strong> ) con una direcci√≥n IP de 10.10.100.50, y las m√°quinas cliente <strong>linux1</strong> , <strong>linux2</strong> , <strong>linux3</strong> , etc. para las m√°quinas cliente Linux y <strong>windows1</strong> , <strong>windows2</strong> , <strong>windows3</strong> y etc.  para m√°quinas cliente de Windows, respectivamente. </p><br><h3 id="nastroyka-printservera">  Configurar un servidor de impresi√≥n </h3><br><p>  En primer lugar, configuraremos el servidor de impresi√≥n, o mejor dicho, configuraremos el acceso administrativo al mismo, luego configuraremos la impresi√≥n en √©l y luego describiremos la configuraci√≥n de las m√°quinas cliente. </p><br><p>  Vamos al servidor de impresi√≥n de cualquier manera conveniente y actualizamos los paquetes en √©l: </p><br><pre><code class="plaintext hljs">root@cupsserver:~# apt update &amp;&amp; apt uprgrade -y</code> </pre> <br><p>  A continuaci√≥n, verifique si CUPS est√° instalado en el servidor: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# which cupsd</code> </pre> <br><p>  Si el resultado se parece a esto: </p><br><pre> <code class="plaintext hljs">/usr/bin/cupsd</code> </pre> <br><p>  entonces se instala CUPS, si no hay salida, instale CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# apt install cups -y</code> </pre> <br><p>  Ahora configure el acceso administrativo a la interfaz web de CUPS.  Todos los archivos de configuraci√≥n se encuentran en la ruta <em>/ etc / cups /</em> .  Para empezar, por si acaso, realizaremos una copia de seguridad de los principales archivos de configuraci√≥n de CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cp /etc/cups/cupsd.conf /etc/cups/cupsd.conf.original root@cupsserver:~# cp /etc/cups/cups-files.conf /etc/cups/cups-files.conf.original root@cupsserver:~# cp /etc/cups/cups-browsed.conf /etc/cups/cups-browsed.conf.original</code> </pre> <br><p>  Sin embargo, si no hizo esto, no importa, de manera predeterminada, los archivos de datos de muestra se encuentran a lo largo de la ruta <em>/ usr / share / cups</em> .  Tambi√©n vale la pena mencionar que puede verificar cualquier opci√≥n agregada en los archivos de configuraci√≥n de CUPS con el comando: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cupsd -t</code> </pre> <br><p>  Si estrope√≥ algo, lo sell√≥ o us√≥ una opci√≥n que ya no es compatible con CUPS, la salida del comando reflejar√° estos errores. </p><br><p>  Pero finalmente, comencemos con la configuraci√≥n.  Despu√©s de cualquier cambio en los archivos en la carpeta <em>/ etc / cups /</em> , debe reiniciar el servicio CUPS para obtener el efecto: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups restart  root@cupsserver:~# systemctl restart cups  root@cupsserver:~# /etc/init.d/cups restart</code> </pre> <br><p>  Y si edit√≥ el archivo <em>/etc/cups/cups-browsed.conf</em> , entonces es responsable de √©l un servicio separado de <strong>tazas</strong> , que tambi√©n debe reiniciarse: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups-browsed restart  root@cupsserver:~# systemctl restart cups-browsed  root@cupsserver:~# /etc/init.d/cups-browsed restart</code> </pre> <br><p>  Ejecuta el comando </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# nano /etc/cups/cupsd.conf</code> </pre> <br><p>  La primera opci√≥n sin comentar es </p><br><pre> <code class="plaintext hljs">LogLevel warn</code> </pre> <br><p>  Determina el contenido m√≠nimo de informaci√≥n de los registros de CUPS.  Los archivos de registro de CUPS se encuentran en <em>/ var / log / cups /</em> .  En el momento de la instalaci√≥n, configuraci√≥n y depuraci√≥n del servidor de impresi√≥n, ser√≠a aconsejable poner el registro en modo de depuraci√≥n.  Para hacer esto, cambie warn a debug2: </p><br><pre> <code class="plaintext hljs">LogLevel debug2</code> </pre> <br><p>  De forma predeterminada, CUPS escucha las conexiones entrantes solo desde <strong>localhost</strong> , es decir, en la interfaz de bucle invertido.  Para asegurarse de esto, puede ejecutar el comando </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# netstat -plutn</code> </pre> <br><p>  Una de las l√≠neas se ver√° as√≠: </p><br><pre> <code class="plaintext hljs">tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN 737/cupsd</code> </pre> <br><p>  Otras acciones dependen del grado de su paranoia.  Puede agregar en el bloque, que comienza condicionalmente con el comentario <strong>#Solo escuche conexiones desde la m√°quina local,</strong> varias l√≠neas con las direcciones IP o subredes, desde donde CUPS podr√° escuchar las conexiones. </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen localhost:631 Listen /run/cups/cups.sock #    IP  Listen 10.10.100.67:631 #     Listen 172.16.0.0:631</code> </pre> <br><p>  O puede permitir que CUPS escuche conexiones desde todas las direcciones </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen /run/cups/cups.sock Port 631</code> </pre> <br><p>  El siguiente punto de configuraci√≥n es el descubrimiento de la red y las impresoras compartidas. </p><br><pre> <code class="plaintext hljs"># Show shared printers on the local network. Browsing Off BrowseLocalProtocols dnssd</code> </pre> <br><p>  En mi opini√≥n, esta opci√≥n debe permanecer desactivada, ya que determina si la informaci√≥n de transmisi√≥n se enviar√° a trav√©s de la red sobre las impresoras conectadas al servidor de impresi√≥n.  Pero todos estar√°n conectados a eso.  Y en consecuencia, todas las m√°quinas cliente mostrar√°n inmediatamente todas las impresoras.  Nuestro servidor de impresi√≥n debe buscar y detectar todas las impresoras en la red, pero no enviarlas sin pensar a trav√©s de la red. </p><br><p>  Las siguientes son las configuraciones de autenticaci√≥n: </p><br><pre> <code class="plaintext hljs"># Default authentication type, when authentication is required... DefaultAuthType Basic</code> </pre> <br><p>  Define los derechos de acceso a la interfaz web de CUPS, as√≠ como a su parte administrativa.  Para que el usuario tenga derecho a administrar CUPS, debe agregarse al grupo de sistemas <strong>lpadmin</strong> : </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# usermod -a -G lpadmin user</code> </pre> <br><p>  En general, los grupos que tienen acceso administrativo a CUPS se definen en el archivo de configuraci√≥n <em>cups-files.conf</em> en el bloque </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  Si desea agregar derechos para administrar un servidor de impresi√≥n, por ejemplo, <strong>printadmins</strong> , a un determinado grupo de usuarios de Linux, simplemente agr√©guelos con un espacio para <strong>lpadmin</strong> .  Si el grupo es dominio, entonces es un poco m√°s complicado y se describir√° m√°s adelante. </p><br><p>  Ahora pasemos al bloque <strong>&lt;Ubicaci√≥n /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny &lt;/Location&gt;</code> </pre> <br><p>  <strong>Orden permitir, denegar</strong> significa que las conexiones desde cualquier lugar est√°n prohibidas a menos que el permiso se indique espec√≠ficamente.  Es decir, debe agregar direcciones IP, subredes, hosts o hosts por m√°scara ( <em><strong>.example.com</strong> ) en el formulario "</em> Permitir desde [direcci√≥n permitida] *": </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from cupsserver #         Allow from cupsserver.example.com #       FQDN Allow from localhost #       loopback  Allow from 10.10.100.* #    Allow from linux4.example.com #     Allow from 172.168.5.125 #  , IP   &lt;/Location&gt;</code> </pre> <br><p>  Para una total confianza y depuraci√≥n, puede dejar, hasta que configure todo lo dem√°s, un dise√±o que permitir√° imprimir desde cualquier lugar: </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from all &lt;/Location&gt;</code> </pre> <br><p>  Configuremos el acceso administrativo a CUPS en el servidor de impresi√≥n.  Decida a qu√© IP y / o subredes se va a conectar desde CUPS, y agr√©guelos por analog√≠a con el bloque <strong>&lt;Ubicaci√≥n /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt;</code> </pre> <br><p>  Opcionalmente, puede agregar el idioma predeterminado de la interfaz.  La lista de idiomas disponibles se puede ver con el comando: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# ls /usr/share/cups/locale</code> </pre> <br><p>  Si la localizaci√≥n que necesita, por ejemplo <strong>ru</strong> , es, agregue una l√≠nea a <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru</code> </pre> <br><p>  Para que su servidor de impresi√≥n <strong>cupsserver.example.com</strong> sea ‚Äã‚Äãaccedido por su host (nombre de host), debe crear un archivo <em>client.conf</em> en la carpeta <em>/ etc / cups /</em> con el siguiente contenido: </p><br><pre> <code class="plaintext hljs">ServerName _</code> </pre> <br><p>  De la manera m√°s simple, esto se puede hacer as√≠: </p><br><pre> <code class="plaintext hljs">root@cupsserver:/etc/cups# echo "ServerName $(cat /etc/hostname)" &gt; /etc/cups/client.conf</code> </pre> <br><p>  Dado que suponemos que hay un servidor DNS en la red, ser√° preferible que pueda acceder al servidor de impresi√≥n por su nombre de dominio ( <strong>cupsserver.example.com</strong> ).  Al servidor tambi√©n se le puede asignar un alias CNAME en el servidor DNS, como <strong>print</strong> o <strong>cups</strong> .  Para que el servidor de impresi√≥n acepte conexiones en tales llamadas, debe agregar la siguiente l√≠nea al archivo <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">ServerAlias cupsserver.example.com print cups</code> </pre> <br><p>  Si desea que el servidor de impresi√≥n acepte cualquier llamada, o no desea molestarse, puede agregar esto: </p><br><pre> <code class="plaintext hljs">ServerAlias *</code> </pre> <br><p>  Tambi√©n debe buscar dentro del archivo <em>/etc/cups/cups-browsed.conf</em> .  Este archivo controla c√≥mo el servidor de impresi√≥n busca impresoras en la red y difunde sus impresoras.  Sugiero deshabilitar completamente la opci√≥n de bolet√≠n informativo.  El servidor de impresi√≥n buscar√° la impresora en la red, pero desde all√≠ las impresoras a las m√°quinas cliente se conectar√°n manualmente.  A continuaci√≥n se describir√° por qu√©.  Mientras tanto, encontramos la l√≠nea <strong>BrowseRemoteProtocols dnssd cups</strong> : </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to discover printers on the network? # Can use DNSSD and/or CUPS and/or LDAP, or 'none' for neither. BrowseRemoteProtocols dnssd cups</code> </pre> <br><p>  Gracias a esta opci√≥n, el servidor de impresi√≥n busca impresoras compartidas en la red.  Lo dejamos encendido, ya que nos interesa que el servidor de impresi√≥n busque la impresora en la red.  Pero no necesitamos absolutamente el servidor de impresi√≥n para enviar todas las impresoras conectadas a √©l, de lo contrario habr√° mucha confusi√≥n.  Para evitar este escenario, encuentre la siguiente opci√≥n <strong>#BrowseLocalProtocols none</strong> y descomente: </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to broadcast shared local printers to the network? # Can use DNSSD and/or CUPS, or 'none' for neither. # Only CUPS is actually supported, as DNSSD is done by CUPS itself (we ignore DNSSD in this directive). BrowseLocalProtocols none</code> </pre> <br><p>  En esto, suspendemos la configuraci√≥n del servidor de impresi√≥n y procedemos a la configuraci√≥n de las m√°quinas cliente Windows y Linux.  Los requisitos para ellos son los siguientes: permitir que los trabajos de impresi√≥n se env√≠en al servidor de impresi√≥n y enviar trabajos de impresi√≥n (y solo) al servidor de impresi√≥n si es necesario imprimir en una impresora de red. </p><br><p>  Como ejemplo, configuraremos la impresi√≥n a trav√©s de un servidor de impresi√≥n entre dos m√°quinas cliente con Linux (nombre de host <strong>linux1</strong> ) y Windows 8, respectivamente (nombre de host <strong>windows1</strong> ).  Comencemos configurando <strong>windows1</strong> como receptor de impresi√≥n desde un servidor de impresi√≥n.  Tengo una impresora Canon i-SENSYS MF4410 conectada y funcionando normalmente.  El nombre de la impresora es Canon-MF4400.  De hecho, la forma m√°s f√°cil de garantizar la impresi√≥n desde un servidor de impresi√≥n en <strong>Windows1</strong> es ir al <em>Panel de control&gt; Programas&gt; Programas y caracter√≠sticas&gt; Activar o desactivar las caracter√≠sticas de Windows</em> .  All√≠ <em>activamos el</em> componente <em>Servicios de impresi√≥n y documentos&gt; Servicio de impresi√≥n LPD</em> .  Esto le permitir√° conectar esta impresora al servidor de impresi√≥n utilizando la direcci√≥n <em>lpd: // windows1 / Canon-MF4400</em> .  Por supuesto, la pregunta est√° madurando, ¬øpor qu√© no conectarse usando SMB?  Nadie lo proh√≠be.  Si ha depurado este m√©todo, puede compartir la impresora de esta manera y conectarla al servidor de impresi√≥n utilizando el protocolo SMB.  Las instrucciones para esta conexi√≥n, en mi opini√≥n, est√°n m√°s all√° del alcance de este art√≠culo, que ya es bastante voluminoso.  Mientras tanto, creemos que el lector se dirigi√≥ con √©xito a la direcci√≥n <code>http://cupsserver:631/admin</code> hizo clic en el bot√≥n "Agregar una nueva impresora", y siguiendo la intuici√≥n, la l√≥gica y los manuales le√≠dos anteriormente, conect√≥ con √©xito la impresora con <strong>windows1 a</strong> trav√©s del protocolo <strong>LPD</strong> al <strong>cupsserver [ejemplo. com]</strong> y la p√°gina de la impresora est√° disponible en <code>http://cupsserver:631/printers/Canon-MF4400</code> . </p><br><p>  Ahora realizamos una operaci√≥n similar en la m√°quina cliente Linux con el nombre de host <strong>linux1</strong> .  En general, esta parte ser√° mucho m√°s grande, ya que la m√°quina cliente tiene su propio servicio CUPS y tambi√©n debe configurarse de la misma manera que un servidor de impresi√≥n, excepto por su papel subordinado en la organizaci√≥n de la impresi√≥n. </p><br><h3 id="ispravlenie-oshibki-obrascheniya-k-cups-cherez-loopback-po-imeni-hosta">  Correcci√≥n del error al acceder a CUPS mediante loopback por nombre de host </h3><br><p>  Hay un momento desagradable.  Si ingresa <strong>linux1</strong> en un dominio, configure CUPS en √©l de acuerdo con estas instrucciones, puede notar una situaci√≥n absurda cuando puede acceder a la <strong>interfaz</strong> web de <strong>linux1</strong> desde el exterior, ¬°pero no puede hacerlo en el propio host!  Y las aplicaciones gr√°ficas para la configuraci√≥n local de impresoras, como la aplicaci√≥n <strong>system-config-printer</strong> en Linux Mint, se niegan a funcionar.  Si intenta conectarse a su propio CUPS en la direcci√≥n <code>http://linux1:631/</code> aparecer√° un mensaje "Prohibido" o "Solicitud incorrecta".  Este es un problema bien conocido y no resuelto en muchos foros de Internet. </p><br><p>  En la mayor√≠a de las instrucciones sobre la introducci√≥n de Linux en un dominio, uno de los puntos es hacer que el <em>archivo / etc / hosts se</em> vea as√≠: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 127.0.1.1 linux1.example.com linux1 # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe02::2 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters</code> </pre> <br><p>  Por alguna raz√≥n, CUPS no puede asociar llamadas a trav√©s de 127.0.1.1, es decir, a trav√©s de la interfaz Loopback, con el nombre del host. </p><br><p>  Este error se soluciona de dos maneras.  Si las direcciones IP de su red son est√°ticas, en el <em>archivo / etc / hosts,</em> corrija 127.0.1.1 para la direcci√≥n IP de la interfaz de red externa de la m√°quina cliente, por ejemplo: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 192.168.1.50 linux1.example.com linux1</code> </pre> <br><p>  O, dado que ingresa Linux en el dominio, se supone que DHCP y el servidor DNS de Active Directory se est√°n ejecutando en su red.  En este caso, solo comente esta l√≠nea: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost # 127.0.1.1 linux1.example.com linux1</code> </pre> <br><p>  A√∫n no se han detectado diferencias en el rendimiento o problemas de esta acci√≥n. </p><br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups-u-klientskih-mashin-linux">  Configuraci√≥n de direcciones de escucha de conexi√≥n CUPS en m√°quinas cliente Linux </h3><br><p>  Vamos a <strong>linux1 de</strong> cualquier manera conveniente.  Edici√≥n del archivo <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cupsd.conf</code> </pre> <br><p>  Encontramos, agregamos o modificamos l√≠neas en √©l: </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru #      /usr/share/cups/locale ServerAlias linux1.example.com linux1 [CNAME    DNS ]  ServerAlias * #      Listen /run/cups/cups.sock Listen localhost:631 #  localhost Listen 10.10.100.50:631 # IP   . Listen cupsserver:631 #   .    IP  ,    Listen linux1:631 #  Port 631 #       Listen /run/cups/cups.sock Browsing off # .       DefaultAuthType Basic #  .     Kerberos,     </code> </pre> <br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups">  Configuraci√≥n de direcciones de escucha de conexi√≥n CUPS </h3><br><p>  En el bloque anterior, configuramos la capacidad de conectarse a CUPS.  Ahora pasemos a configurar permisos para imprimir, as√≠ como a las p√°ginas administrativas del servicio CUPS en el host <strong>linux1</strong> .  <em>Reabrimos</em> , si est√° cerrado, el archivo <em>/etc/cups/cupsd.conf</em> y procedemos a editar los <em>bloques</em> <strong>&lt;Location /&gt;</strong> , <strong>&lt;Location / admin&gt;</strong> , <strong>&lt;Location / admin / conf&gt;</strong> , <strong>&lt;Location / admin / log&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny #    "  ,  " Allow from localhost #    linux1 Allow from linux1 #     .      Allow from cupsserver #  CUPS    DNS,  . ,     Allow from cupsserver.example.com # FQDN  Allow from 10.10.100.50 #     IP  **cupsserver** &lt;/Location&gt; # Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt;</code> </pre> <br><h3 id="nastroyka-razdachi-i-polucheniya-shirokoveschatelnoy-rassylki-setevyh-printerov">  Configuraci√≥n de la distribuci√≥n y difusi√≥n de impresoras de red. </h3><br><p>  Incluso en una m√°quina cliente Linux, en este caso <strong><em>linux1</em></strong> , necesita editar el archivo <em>/etc/cups/cups-browsed.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cups-browsed.conf BrowseRemoteProtocols none #  none      . BrowseLocalProtocols cups #     . DNSSD   ,    cupsd.conf BrowseOrder Allow,Deny #   Order  cupsd.conf -   ,        BrowseAllow 10.10.100.50 # IP  BrowseAllow cupsserver #    BrowseAllow cupsserver.example.com #    </code> </pre> <br><h3 id="nastroyka-administrativnogo-dostupa">  Configurar acceso administrativo </h3><br><p>  Unas palabras m√°s sobre el acceso administrativo, tanto en la interfaz CUPS WEB en un servidor de impresi√≥n como en cualquier m√°quina cliente Linux.  Incluso si tiene 30-50 computadoras, debe unificar la autorizaci√≥n en CUPS y no tener en cuenta ni las contrase√±as de cada m√°quina.  Y esto es importante en todas las m√°quinas Linux, porque para agregar una impresora al servidor, primero debe instalarla localmente.  Veo varias formas </p><br><p>  El primero es crear un usuario de <strong>printeradmin</strong> en cada sistema Linux (por ejemplo) y agregar <strong>lpadmin</strong> al grupo: </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo usermod -a -G lpamin printeradmin</code> </pre> <br><p>  e inicie sesi√≥n en <code>http://_:631/admin</code> usando sus credenciales. </p><br><p>  La segunda opci√≥n es casi id√©ntica y sugiere crear un grupo en el sistema, por ejemplo, <strong>printersadmins</strong> , agregando all√≠ el administrador CUPS requerido ( <strong>printeradmin</strong> , <strong>usuario</strong> ): </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo groupadd printersadmins user@linux1:~$ sudo usermod -a -G printersadmins printeradmin user@linux1:~$ sudo usermod -a -G printersadmins user</code> </pre> <br><p>  Entonces necesita encontrar la l√≠nea en el archivo <em>/etc/cups/cups-files.conf</em> </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  y agregue uno o m√°s grupos de usuarios con el derecho de administrar CUPS a trav√©s de un espacio. </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin printersadmins somegroup</code> </pre> <br><p>  Y finalmente, la tercera opci√≥n.  Haga que los administradores del servidor de impresi√≥n y las CUPS de las m√°quinas cliente sean un grupo de usuarios de dominio.  Para hacer esto, el servidor de impresi√≥n y las m√°quinas cliente de Linux deben unirse al dominio AD.  Existen varios m√©todos para conectar Linux al dominio de Windows, pero que yo sepa, los principales se conectan mediante winbind y SSSD (realmd).  No se incluye una descripci√≥n de estos m√©todos en el art√≠culo, por lo que me centrar√© solo en los puntos que se relacionan espec√≠ficamente con CUPS. </p><br><h3 id="nastroyka-ispolzovaniya-domennyh-grupp-polzovateley-dlya-administrirovaniya-cups">  Configuraci√≥n del uso de grupos de usuarios de dominio para la administraci√≥n de CUPS </h3><br><p>  Cada m√©todo de unirse a un sistema de autorizaci√≥n central en Linux crea un archivo especial "pipe" a trav√©s del cual las aplicaciones pueden ver la lista de usuarios del dominio.  Para que CUPS pueda hacer esto, debe permitir que use pipe en AppArmor para autenticar a los usuarios.  AppArmor es un m√≥dulo de control de acceso de seguridad de Linux.  Limita ciertos programas al conjunto de archivos enumerados en sus pol√≠ticas.  Para agregar CUPS el derecho de usar usuarios y grupos de dominio a trav√©s de winbindd, agregue la siguiente l√≠nea al archivo <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> : </p><br><pre> <code class="plaintext hljs">/var/lib/samba/winbindd_privileged/pipe rw</code> </pre> <br><p>  Si se ingresa Linux en el dominio a trav√©s de SSSD, debe especificar la ubicaci√≥n de su canalizaci√≥n en <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> , agregando la l√≠nea all√≠: </p><br><pre> <code class="plaintext hljs">/var/lib/sss/pipes/private/pam rw</code> </pre> <br><p>  Adem√°s, en el caso de SSSD, esto permite la autenticaci√≥n (para averiguar qui√©n inicia sesi√≥n), pero para autenticar (averiguar si el usuario tiene derecho a administrar CUPS), tambi√©n debe agregar la l√≠nea al archivo de configuraci√≥n <em>SSSD /etc/sssd/sssd.conf</em> : </p><br><pre> <code class="plaintext hljs">ad_gpo_map_interactive = +cups</code> </pre> <br><p>  Esto, condicionalmente hablando, le da a CUPS el derecho de "mirar" en SSSD. </p><br><p>  Adem√°s, debido al hecho de que CUPS ahora depende del servicio SSSD, debe decirle a CUPS que debe comenzar despu√©s de SSSD, de lo contrario, se caer√° cuando se encienda y deber√° encenderse manualmente cada vez. </p><br><p>  Agregue instrucciones de CUPS para iniciar despu√©s de SSSD.  Edite el <em>archivo de</em> servicio <em>cups.service a lo</em> largo de la ruta <em>/ lib / systemd / system /</em> , agregando la instrucci√≥n <strong>After</strong> a la secci√≥n <strong>[Unidad]</strong> : </p><br><pre> <code class="plaintext hljs">[Unit] Description=CUPS Scheduler Documentation=man:cupsd(8) After=sssd.service</code> </pre> <br><p>  Por lo tanto, CUPS se configura para la autorizaci√≥n b√°sica a trav√©s de un dominio, es decir, la autorizaci√≥n al ingresar el inicio de sesi√≥n y la contrase√±a de un usuario de dominio con privilegio de administraci√≥n de CUPS. </p><br><p>  La autorizaci√≥n se puede configurar de manera diferente, pero el principio (archivo de tuber√≠a) es generalmente universal y existe la posibilidad de configurarlo por analog√≠a para LDAP, FreeIPA y otros servicios de directorio. </p><br><h3 id="ustanovka-printera-v-linux">  Instalar una impresora en Linux </h3><br><p>  Instalar una impresora en Linux a menudo es una tarea espec√≠fica, diferente para diferentes marcas e incluso modelos.  Por lo tanto, no veo ninguna raz√≥n para describir la instalaci√≥n de la impresora y asumo que el host <strong>linux1 tiene</strong> una impresora Kyocera-1024FP con el nombre <strong>Kyocera-1024FP instalado</strong> , y la p√°gina de la impresora est√° disponible en <code>http://linux1:631/printers/Kyocera-1024FP</code> . </p><br><p>  Ahora que el servidor Linux y las m√°quinas cliente est√°n configuradas, las impresoras est√°n conectadas a algunas de ellas, y tambi√©n hay m√°quinas Windows con las que imprimir, y todo este sistema debe ser estable, incluso si es necesario reemplazar la impresora en una de las PC , entonces esto no deber√≠a implicar la reconfiguraci√≥n de una buena mitad de todas las PC, si no todas.  Adem√°s, necesita la menor cantidad posible de problemas con los controladores.  Y es bastante posible. </p><br><h3 id="gruppy-printerov-classes">  Grupos de impresoras (clases) </h3><br><p>     <strong>Canon-MF4400</strong> c  <strong>windows1</strong>   LPD.            <code>http://cupsserver:631/printers/Canon-MF4400</code> .          <strong>cupsserver</strong> <code>http://cupsserver:631/admin</code> .      " " [Add Class].   .      "", "", "",       .            .  <strong>Canon-MF4400</strong>    ,    "" ,  <strong>printer-windows1</strong> , ""  ""   ,   " ". </p><br><p>      <strong>printer-windows1</strong>   <strong>Canon-MF4400</strong>  .           <strong>Canon-MF4400</strong>       ‚Äî <code>http://cupsserver:631/classes/printer-windows1</code> . </p><br><p>         <strong>linux1</strong>  Kyocera-1024FP.      HTTP.    "   (http)" [Internet Printing Protocol (http)],      "Generic",  "IPP Everywhere".    ,        <strong>linux1</strong> ‚Äî <strong>Kyocera-1024FP</strong> .        <code>http://cupsserver:631/printers/Kyocera-1024FP</code> .    <strong>printer-windows1</strong>   <strong>printer-linux1</strong> c  <strong>Kyocera-1024FP</strong>  .    <code>http://cupsserver:631/classes/printer-linux1</code> . </p><br><p>    <strong>Kyocera-1024FP</strong>   <strong>linux1</strong>   <strong>cupsserver</strong>   <strong>windows1</strong>   Windows 8      (!)  .        "    ".  <strong></strong>    <code>http://_c:631/classes/_</code> .     ‚Äî <code>http://cupsserver:631/classes/printer-linux1</code> .        "Generic",  ‚Äî "MS Publisher Imagesetter".   ,        <code>printer-linux1  http://cupsserver:631</code> .             ,          Kyocera-1024FP. </p><br><p>    <strong>Canon-MF4400</strong>   <strong>windows1</strong>   <strong>cupsserver</strong>   <strong>linux1</strong>   Linux      (!)  .         ,   <strong>Kyocera-1024FP</strong>   <strong>cupsserver</strong> .       <strong>linux1</strong>    "   (http)",     ( <strong>Canon-MF4400</strong> )       ‚Äî <code>http://cupsserver:631/classes/printer-windows1</code> .        "Generic",  ‚Äî "IPP Everywhere".    ,       ‚Äî <strong>printer-windows1</strong> .     <strong>linux1</strong>   <code>http://linux1:631/printers/printer-windows1</code> ,        . </p><br><p>      ,        ,   ,     ,       ,         .      ‚Äî     ,   ,     ,  ,       .        ,          .  "IPP Everywhere"  "MS Publisher Imagesetter"     ,   ..,          . </p><br><h3 id="zaklyuchenie">  Conclusi√≥n </h3><br><p>   ,   - ,       .  ,   ,    ,      ,           . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443094/">https://habr.com/ru/post/443094/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443082/index.html">¬øPor qu√© no debes mirar a los dem√°s cuando aprendes un idioma?</a></li>
<li><a href="../443084/index.html">Facebook se niega a transferir servidores a pa√≠ses que violen la libertad de expresi√≥n e introduce un cifrado de extremo a extremo</a></li>
<li><a href="../443086/index.html">Food Design Digest, febrero de 2019</a></li>
<li><a href="../443090/index.html">Excursi√≥n a la central nuclear de Rostov</a></li>
<li><a href="../443092/index.html">El nuevo sensor ultras√≥nico le permite "escuchar" las bacterias: c√≥mo funciona</a></li>
<li><a href="../443096/index.html">El dise√±ador no es periodista. C√≥mo realizar una entrevista con un usuario</a></li>
<li><a href="../443098/index.html">Los datos se escriben en el disco utilizando imanes y l√°seres.</a></li>
<li><a href="../443100/index.html">Contando errores en la calculadora de Windows</a></li>
<li><a href="../443102/index.html">Cambio de comportamiento como producto: ¬øpor qu√© Marie Kondo est√° recaudando una ronda de $ 40 millones con Sequoia Capital?</a></li>
<li><a href="../443104/index.html">Calcular expresiones simb√≥licas con n√∫meros triangulares difusos en python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>