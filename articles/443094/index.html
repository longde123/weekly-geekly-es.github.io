<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧖🏻 👜 😬 Configurar un servidor de impresión CUPS desde cero con y sin autorización de dominio en una red con diferentes sistemas operativos 😒 ⤴️ 🎿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Configurar un servidor de impresión CUPS desde cero con y sin autorización de dominio en una red con diferentes sistemas operativos 
 Entrada 


 Ento...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configurar un servidor de impresión CUPS desde cero con y sin autorización de dominio en una red con diferentes sistemas operativos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443094/"><h2 id="nastroyka-s-nulya-printservera-cups-s-domennoy-avtorizaciey-i-bez-nee-v-seti-s-raznymi-os">  Configurar un servidor de impresión CUPS desde cero con y sin autorización de dominio en una red con diferentes sistemas operativos </h2><br><h3 id="vstuplenie">  Entrada </h3><br><p>  Entonces  Presumiblemente, el servicio de impresión CUPS es una solución poderosa que le permite organizar la administración centralizada de impresoras en la empresa.  Así es, pero durante el proceso de configuración necesitará pasar algún tiempo buscando una solución a los muchos problemas pequeños y obvios de Google, especialmente si su necesidad va más allá de los manuales de configuración estándar. </p><br><p>  El artículo describirá la instalación del servidor de impresión CUPS en Ubuntu Server en una red con un dominio activo de Active Directory, aunque su presencia no es necesaria y puede omitir con seguridad las instrucciones para configurar la interacción con él, configurarlo, así como configurar máquinas cliente Linux y Windows para interactuar con Este servidor de impresión. </p><a name="habracut"></a><br><p>  En las instrucciones, el dominio se llamará <strong>example.com</strong> , el servidor de impresión en sí será <strong>cupsserver</strong> ( <strong>cupsserver.example.com</strong> ) con una dirección IP de 10.10.100.50, y las máquinas cliente <strong>linux1</strong> , <strong>linux2</strong> , <strong>linux3</strong> , etc. para las máquinas cliente Linux y <strong>windows1</strong> , <strong>windows2</strong> , <strong>windows3</strong> y etc.  para máquinas cliente de Windows, respectivamente. </p><br><h3 id="nastroyka-printservera">  Configurar un servidor de impresión </h3><br><p>  En primer lugar, configuraremos el servidor de impresión, o mejor dicho, configuraremos el acceso administrativo al mismo, luego configuraremos la impresión en él y luego describiremos la configuración de las máquinas cliente. </p><br><p>  Vamos al servidor de impresión de cualquier manera conveniente y actualizamos los paquetes en él: </p><br><pre><code class="plaintext hljs">root@cupsserver:~# apt update &amp;&amp; apt uprgrade -y</code> </pre> <br><p>  A continuación, verifique si CUPS está instalado en el servidor: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# which cupsd</code> </pre> <br><p>  Si el resultado se parece a esto: </p><br><pre> <code class="plaintext hljs">/usr/bin/cupsd</code> </pre> <br><p>  entonces se instala CUPS, si no hay salida, instale CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# apt install cups -y</code> </pre> <br><p>  Ahora configure el acceso administrativo a la interfaz web de CUPS.  Todos los archivos de configuración se encuentran en la ruta <em>/ etc / cups /</em> .  Para empezar, por si acaso, realizaremos una copia de seguridad de los principales archivos de configuración de CUPS: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cp /etc/cups/cupsd.conf /etc/cups/cupsd.conf.original root@cupsserver:~# cp /etc/cups/cups-files.conf /etc/cups/cups-files.conf.original root@cupsserver:~# cp /etc/cups/cups-browsed.conf /etc/cups/cups-browsed.conf.original</code> </pre> <br><p>  Sin embargo, si no hizo esto, no importa, de manera predeterminada, los archivos de datos de muestra se encuentran a lo largo de la ruta <em>/ usr / share / cups</em> .  También vale la pena mencionar que puede verificar cualquier opción agregada en los archivos de configuración de CUPS con el comando: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# cupsd -t</code> </pre> <br><p>  Si estropeó algo, lo selló o usó una opción que ya no es compatible con CUPS, la salida del comando reflejará estos errores. </p><br><p>  Pero finalmente, comencemos con la configuración.  Después de cualquier cambio en los archivos en la carpeta <em>/ etc / cups /</em> , debe reiniciar el servicio CUPS para obtener el efecto: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups restart  root@cupsserver:~# systemctl restart cups  root@cupsserver:~# /etc/init.d/cups restart</code> </pre> <br><p>  Y si editó el archivo <em>/etc/cups/cups-browsed.conf</em> , entonces es responsable de él un servicio separado de <strong>tazas</strong> , que también debe reiniciarse: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# service cups-browsed restart  root@cupsserver:~# systemctl restart cups-browsed  root@cupsserver:~# /etc/init.d/cups-browsed restart</code> </pre> <br><p>  Ejecuta el comando </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# nano /etc/cups/cupsd.conf</code> </pre> <br><p>  La primera opción sin comentar es </p><br><pre> <code class="plaintext hljs">LogLevel warn</code> </pre> <br><p>  Determina el contenido mínimo de información de los registros de CUPS.  Los archivos de registro de CUPS se encuentran en <em>/ var / log / cups /</em> .  En el momento de la instalación, configuración y depuración del servidor de impresión, sería aconsejable poner el registro en modo de depuración.  Para hacer esto, cambie warn a debug2: </p><br><pre> <code class="plaintext hljs">LogLevel debug2</code> </pre> <br><p>  De forma predeterminada, CUPS escucha las conexiones entrantes solo desde <strong>localhost</strong> , es decir, en la interfaz de bucle invertido.  Para asegurarse de esto, puede ejecutar el comando </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# netstat -plutn</code> </pre> <br><p>  Una de las líneas se verá así: </p><br><pre> <code class="plaintext hljs">tcp 0 0 127.0.0.1:631 0.0.0.0:* LISTEN 737/cupsd</code> </pre> <br><p>  Otras acciones dependen del grado de su paranoia.  Puede agregar en el bloque, que comienza condicionalmente con el comentario <strong>#Solo escuche conexiones desde la máquina local,</strong> varias líneas con las direcciones IP o subredes, desde donde CUPS podrá escuchar las conexiones. </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen localhost:631 Listen /run/cups/cups.sock #    IP  Listen 10.10.100.67:631 #     Listen 172.16.0.0:631</code> </pre> <br><p>  O puede permitir que CUPS escuche conexiones desde todas las direcciones </p><br><pre> <code class="plaintext hljs"># Only listen for connections from the local machine. Listen /run/cups/cups.sock Port 631</code> </pre> <br><p>  El siguiente punto de configuración es el descubrimiento de la red y las impresoras compartidas. </p><br><pre> <code class="plaintext hljs"># Show shared printers on the local network. Browsing Off BrowseLocalProtocols dnssd</code> </pre> <br><p>  En mi opinión, esta opción debe permanecer desactivada, ya que determina si la información de transmisión se enviará a través de la red sobre las impresoras conectadas al servidor de impresión.  Pero todos estarán conectados a eso.  Y en consecuencia, todas las máquinas cliente mostrarán inmediatamente todas las impresoras.  Nuestro servidor de impresión debe buscar y detectar todas las impresoras en la red, pero no enviarlas sin pensar a través de la red. </p><br><p>  Las siguientes son las configuraciones de autenticación: </p><br><pre> <code class="plaintext hljs"># Default authentication type, when authentication is required... DefaultAuthType Basic</code> </pre> <br><p>  Define los derechos de acceso a la interfaz web de CUPS, así como a su parte administrativa.  Para que el usuario tenga derecho a administrar CUPS, debe agregarse al grupo de sistemas <strong>lpadmin</strong> : </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# usermod -a -G lpadmin user</code> </pre> <br><p>  En general, los grupos que tienen acceso administrativo a CUPS se definen en el archivo de configuración <em>cups-files.conf</em> en el bloque </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  Si desea agregar derechos para administrar un servidor de impresión, por ejemplo, <strong>printadmins</strong> , a un determinado grupo de usuarios de Linux, simplemente agréguelos con un espacio para <strong>lpadmin</strong> .  Si el grupo es dominio, entonces es un poco más complicado y se describirá más adelante. </p><br><p>  Ahora pasemos al bloque <strong>&lt;Ubicación /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny &lt;/Location&gt;</code> </pre> <br><p>  <strong>Orden permitir, denegar</strong> significa que las conexiones desde cualquier lugar están prohibidas a menos que el permiso se indique específicamente.  Es decir, debe agregar direcciones IP, subredes, hosts o hosts por máscara ( <em><strong>.example.com</strong> ) en el formulario "</em> Permitir desde [dirección permitida] *": </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from cupsserver #         Allow from cupsserver.example.com #       FQDN Allow from localhost #       loopback  Allow from 10.10.100.* #    Allow from linux4.example.com #     Allow from 172.168.5.125 #  , IP   &lt;/Location&gt;</code> </pre> <br><p>  Para una total confianza y depuración, puede dejar, hasta que configure todo lo demás, un diseño que permitirá imprimir desde cualquier lugar: </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny Allow from all &lt;/Location&gt;</code> </pre> <br><p>  Configuremos el acceso administrativo a CUPS en el servidor de impresión.  Decida a qué IP y / o subredes se va a conectar desde CUPS, y agréguelos por analogía con el bloque <strong>&lt;Ubicación /&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; Order allow,deny Allow from localhost Allow from 10.10.100.* Allow from admin.example.com &lt;/Location&gt;</code> </pre> <br><p>  Opcionalmente, puede agregar el idioma predeterminado de la interfaz.  La lista de idiomas disponibles se puede ver con el comando: </p><br><pre> <code class="plaintext hljs">root@cupsserver:~# ls /usr/share/cups/locale</code> </pre> <br><p>  Si la localización que necesita, por ejemplo <strong>ru</strong> , es, agregue una línea a <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru</code> </pre> <br><p>  Para que su servidor de impresión <strong>cupsserver.example.com</strong> sea ​​accedido por su host (nombre de host), debe crear un archivo <em>client.conf</em> en la carpeta <em>/ etc / cups /</em> con el siguiente contenido: </p><br><pre> <code class="plaintext hljs">ServerName _</code> </pre> <br><p>  De la manera más simple, esto se puede hacer así: </p><br><pre> <code class="plaintext hljs">root@cupsserver:/etc/cups# echo "ServerName $(cat /etc/hostname)" &gt; /etc/cups/client.conf</code> </pre> <br><p>  Dado que suponemos que hay un servidor DNS en la red, será preferible que pueda acceder al servidor de impresión por su nombre de dominio ( <strong>cupsserver.example.com</strong> ).  Al servidor también se le puede asignar un alias CNAME en el servidor DNS, como <strong>print</strong> o <strong>cups</strong> .  Para que el servidor de impresión acepte conexiones en tales llamadas, debe agregar la siguiente línea al archivo <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">ServerAlias cupsserver.example.com print cups</code> </pre> <br><p>  Si desea que el servidor de impresión acepte cualquier llamada, o no desea molestarse, puede agregar esto: </p><br><pre> <code class="plaintext hljs">ServerAlias *</code> </pre> <br><p>  También debe buscar dentro del archivo <em>/etc/cups/cups-browsed.conf</em> .  Este archivo controla cómo el servidor de impresión busca impresoras en la red y difunde sus impresoras.  Sugiero deshabilitar completamente la opción de boletín informativo.  El servidor de impresión buscará la impresora en la red, pero desde allí las impresoras a las máquinas cliente se conectarán manualmente.  A continuación se describirá por qué.  Mientras tanto, encontramos la línea <strong>BrowseRemoteProtocols dnssd cups</strong> : </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to discover printers on the network? # Can use DNSSD and/or CUPS and/or LDAP, or 'none' for neither. BrowseRemoteProtocols dnssd cups</code> </pre> <br><p>  Gracias a esta opción, el servidor de impresión busca impresoras compartidas en la red.  Lo dejamos encendido, ya que nos interesa que el servidor de impresión busque la impresora en la red.  Pero no necesitamos absolutamente el servidor de impresión para enviar todas las impresoras conectadas a él, de lo contrario habrá mucha confusión.  Para evitar este escenario, encuentre la siguiente opción <strong>#BrowseLocalProtocols none</strong> y descomente: </p><br><pre> <code class="plaintext hljs"># Which protocols will we use to broadcast shared local printers to the network? # Can use DNSSD and/or CUPS, or 'none' for neither. # Only CUPS is actually supported, as DNSSD is done by CUPS itself (we ignore DNSSD in this directive). BrowseLocalProtocols none</code> </pre> <br><p>  En esto, suspendemos la configuración del servidor de impresión y procedemos a la configuración de las máquinas cliente Windows y Linux.  Los requisitos para ellos son los siguientes: permitir que los trabajos de impresión se envíen al servidor de impresión y enviar trabajos de impresión (y solo) al servidor de impresión si es necesario imprimir en una impresora de red. </p><br><p>  Como ejemplo, configuraremos la impresión a través de un servidor de impresión entre dos máquinas cliente con Linux (nombre de host <strong>linux1</strong> ) y Windows 8, respectivamente (nombre de host <strong>windows1</strong> ).  Comencemos configurando <strong>windows1</strong> como receptor de impresión desde un servidor de impresión.  Tengo una impresora Canon i-SENSYS MF4410 conectada y funcionando normalmente.  El nombre de la impresora es Canon-MF4400.  De hecho, la forma más fácil de garantizar la impresión desde un servidor de impresión en <strong>Windows1</strong> es ir al <em>Panel de control&gt; Programas&gt; Programas y características&gt; Activar o desactivar las características de Windows</em> .  Allí <em>activamos el</em> componente <em>Servicios de impresión y documentos&gt; Servicio de impresión LPD</em> .  Esto le permitirá conectar esta impresora al servidor de impresión utilizando la dirección <em>lpd: // windows1 / Canon-MF4400</em> .  Por supuesto, la pregunta está madurando, ¿por qué no conectarse usando SMB?  Nadie lo prohíbe.  Si ha depurado este método, puede compartir la impresora de esta manera y conectarla al servidor de impresión utilizando el protocolo SMB.  Las instrucciones para esta conexión, en mi opinión, están más allá del alcance de este artículo, que ya es bastante voluminoso.  Mientras tanto, creemos que el lector se dirigió con éxito a la dirección <code>http://cupsserver:631/admin</code> hizo clic en el botón "Agregar una nueva impresora", y siguiendo la intuición, la lógica y los manuales leídos anteriormente, conectó con éxito la impresora con <strong>windows1 a</strong> través del protocolo <strong>LPD</strong> al <strong>cupsserver [ejemplo. com]</strong> y la página de la impresora está disponible en <code>http://cupsserver:631/printers/Canon-MF4400</code> . </p><br><p>  Ahora realizamos una operación similar en la máquina cliente Linux con el nombre de host <strong>linux1</strong> .  En general, esta parte será mucho más grande, ya que la máquina cliente tiene su propio servicio CUPS y también debe configurarse de la misma manera que un servidor de impresión, excepto por su papel subordinado en la organización de la impresión. </p><br><h3 id="ispravlenie-oshibki-obrascheniya-k-cups-cherez-loopback-po-imeni-hosta">  Corrección del error al acceder a CUPS mediante loopback por nombre de host </h3><br><p>  Hay un momento desagradable.  Si ingresa <strong>linux1</strong> en un dominio, configure CUPS en él de acuerdo con estas instrucciones, puede notar una situación absurda cuando puede acceder a la <strong>interfaz</strong> web de <strong>linux1</strong> desde el exterior, ¡pero no puede hacerlo en el propio host!  Y las aplicaciones gráficas para la configuración local de impresoras, como la aplicación <strong>system-config-printer</strong> en Linux Mint, se niegan a funcionar.  Si intenta conectarse a su propio CUPS en la dirección <code>http://linux1:631/</code> aparecerá un mensaje "Prohibido" o "Solicitud incorrecta".  Este es un problema bien conocido y no resuelto en muchos foros de Internet. </p><br><p>  En la mayoría de las instrucciones sobre la introducción de Linux en un dominio, uno de los puntos es hacer que el <em>archivo / etc / hosts se</em> vea así: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 127.0.1.1 linux1.example.com linux1 # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe02::2 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters</code> </pre> <br><p>  Por alguna razón, CUPS no puede asociar llamadas a través de 127.0.1.1, es decir, a través de la interfaz Loopback, con el nombre del host. </p><br><p>  Este error se soluciona de dos maneras.  Si las direcciones IP de su red son estáticas, en el <em>archivo / etc / hosts,</em> corrija 127.0.1.1 para la dirección IP de la interfaz de red externa de la máquina cliente, por ejemplo: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost 192.168.1.50 linux1.example.com linux1</code> </pre> <br><p>  O, dado que ingresa Linux en el dominio, se supone que DHCP y el servidor DNS de Active Directory se están ejecutando en su red.  En este caso, solo comente esta línea: </p><br><pre> <code class="plaintext hljs">127.0.0.1 localhost # 127.0.1.1 linux1.example.com linux1</code> </pre> <br><p>  Aún no se han detectado diferencias en el rendimiento o problemas de esta acción. </p><br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups-u-klientskih-mashin-linux">  Configuración de direcciones de escucha de conexión CUPS en máquinas cliente Linux </h3><br><p>  Vamos a <strong>linux1 de</strong> cualquier manera conveniente.  Edición del archivo <em>/etc/cups/cupsd.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cupsd.conf</code> </pre> <br><p>  Encontramos, agregamos o modificamos líneas en él: </p><br><pre> <code class="plaintext hljs">DefaultLanguage ru #      /usr/share/cups/locale ServerAlias linux1.example.com linux1 [CNAME    DNS ]  ServerAlias * #      Listen /run/cups/cups.sock Listen localhost:631 #  localhost Listen 10.10.100.50:631 # IP   . Listen cupsserver:631 #   .    IP  ,    Listen linux1:631 #  Port 631 #       Listen /run/cups/cups.sock Browsing off # .       DefaultAuthType Basic #  .     Kerberos,     </code> </pre> <br><h3 id="nastroyka-adresov-proslushivaniya-podklyucheniy-k-cups">  Configuración de direcciones de escucha de conexión CUPS </h3><br><p>  En el bloque anterior, configuramos la capacidad de conectarse a CUPS.  Ahora pasemos a configurar permisos para imprimir, así como a las páginas administrativas del servicio CUPS en el host <strong>linux1</strong> .  <em>Reabrimos</em> , si está cerrado, el archivo <em>/etc/cups/cupsd.conf</em> y procedemos a editar los <em>bloques</em> <strong>&lt;Location /&gt;</strong> , <strong>&lt;Location / admin&gt;</strong> , <strong>&lt;Location / admin / conf&gt;</strong> , <strong>&lt;Location / admin / log&gt;</strong> : </p><br><pre> <code class="plaintext hljs"># Restrict access to the server... &lt;Location /&gt; Order allow,deny #    "  ,  " Allow from localhost #    linux1 Allow from linux1 #     .      Allow from cupsserver #  CUPS    DNS,  . ,     Allow from cupsserver.example.com # FQDN  Allow from 10.10.100.50 #     IP  **cupsserver** &lt;/Location&gt; # Restrict access to the admin pages... &lt;Location /admin&gt; Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to configuration files... &lt;Location /admin/conf&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt; # Restrict access to log files... &lt;Location /admin/log&gt; #   Order allow,deny #   Allow from localhost #      Allow from linux1 #   Allow from 10.10.101.71 # ,  IP  Allow from 10.20.50.* # ,    IT  AuthType Default #   CUPS    .   Require user @SYSTEM #     CUPS &lt;/Location&gt;</code> </pre> <br><h3 id="nastroyka-razdachi-i-polucheniya-shirokoveschatelnoy-rassylki-setevyh-printerov">  Configuración de la distribución y difusión de impresoras de red. </h3><br><p>  Incluso en una máquina cliente Linux, en este caso <strong><em>linux1</em></strong> , necesita editar el archivo <em>/etc/cups/cups-browsed.conf</em> : </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo nano /etc/cups/cups-browsed.conf BrowseRemoteProtocols none #  none      . BrowseLocalProtocols cups #     . DNSSD   ,    cupsd.conf BrowseOrder Allow,Deny #   Order  cupsd.conf -   ,        BrowseAllow 10.10.100.50 # IP  BrowseAllow cupsserver #    BrowseAllow cupsserver.example.com #    </code> </pre> <br><h3 id="nastroyka-administrativnogo-dostupa">  Configurar acceso administrativo </h3><br><p>  Unas palabras más sobre el acceso administrativo, tanto en la interfaz CUPS WEB en un servidor de impresión como en cualquier máquina cliente Linux.  Incluso si tiene 30-50 computadoras, debe unificar la autorización en CUPS y no tener en cuenta ni las contraseñas de cada máquina.  Y esto es importante en todas las máquinas Linux, porque para agregar una impresora al servidor, primero debe instalarla localmente.  Veo varias formas </p><br><p>  El primero es crear un usuario de <strong>printeradmin</strong> en cada sistema Linux (por ejemplo) y agregar <strong>lpadmin</strong> al grupo: </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo usermod -a -G lpamin printeradmin</code> </pre> <br><p>  e inicie sesión en <code>http://_:631/admin</code> usando sus credenciales. </p><br><p>  La segunda opción es casi idéntica y sugiere crear un grupo en el sistema, por ejemplo, <strong>printersadmins</strong> , agregando allí el administrador CUPS requerido ( <strong>printeradmin</strong> , <strong>usuario</strong> ): </p><br><pre> <code class="plaintext hljs">user@linux1:~$ sudo groupadd printersadmins user@linux1:~$ sudo usermod -a -G printersadmins printeradmin user@linux1:~$ sudo usermod -a -G printersadmins user</code> </pre> <br><p>  Entonces necesita encontrar la línea en el archivo <em>/etc/cups/cups-files.conf</em> </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin</code> </pre> <br><p>  y agregue uno o más grupos de usuarios con el derecho de administrar CUPS a través de un espacio. </p><br><pre> <code class="plaintext hljs"># Administrator user group, used to match @SYSTEM in cupsd.conf policy rules... # This cannot contain the Group value for security reasons... SystemGroup lpadmin printersadmins somegroup</code> </pre> <br><p>  Y finalmente, la tercera opción.  Haga que los administradores del servidor de impresión y las CUPS de las máquinas cliente sean un grupo de usuarios de dominio.  Para hacer esto, el servidor de impresión y las máquinas cliente de Linux deben unirse al dominio AD.  Existen varios métodos para conectar Linux al dominio de Windows, pero que yo sepa, los principales se conectan mediante winbind y SSSD (realmd).  No se incluye una descripción de estos métodos en el artículo, por lo que me centraré solo en los puntos que se relacionan específicamente con CUPS. </p><br><h3 id="nastroyka-ispolzovaniya-domennyh-grupp-polzovateley-dlya-administrirovaniya-cups">  Configuración del uso de grupos de usuarios de dominio para la administración de CUPS </h3><br><p>  Cada método de unirse a un sistema de autorización central en Linux crea un archivo especial "pipe" a través del cual las aplicaciones pueden ver la lista de usuarios del dominio.  Para que CUPS pueda hacer esto, debe permitir que use pipe en AppArmor para autenticar a los usuarios.  AppArmor es un módulo de control de acceso de seguridad de Linux.  Limita ciertos programas al conjunto de archivos enumerados en sus políticas.  Para agregar CUPS el derecho de usar usuarios y grupos de dominio a través de winbindd, agregue la siguiente línea al archivo <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> : </p><br><pre> <code class="plaintext hljs">/var/lib/samba/winbindd_privileged/pipe rw</code> </pre> <br><p>  Si se ingresa Linux en el dominio a través de SSSD, debe especificar la ubicación de su canalización en <em>/etc/apparmod.d/local/usr.sbin.cupsd</em> , agregando la línea allí: </p><br><pre> <code class="plaintext hljs">/var/lib/sss/pipes/private/pam rw</code> </pre> <br><p>  Además, en el caso de SSSD, esto permite la autenticación (para averiguar quién inicia sesión), pero para autenticar (averiguar si el usuario tiene derecho a administrar CUPS), también debe agregar la línea al archivo de configuración <em>SSSD /etc/sssd/sssd.conf</em> : </p><br><pre> <code class="plaintext hljs">ad_gpo_map_interactive = +cups</code> </pre> <br><p>  Esto, condicionalmente hablando, le da a CUPS el derecho de "mirar" en SSSD. </p><br><p>  Además, debido al hecho de que CUPS ahora depende del servicio SSSD, debe decirle a CUPS que debe comenzar después de SSSD, de lo contrario, se caerá cuando se encienda y deberá encenderse manualmente cada vez. </p><br><p>  Agregue instrucciones de CUPS para iniciar después de SSSD.  Edite el <em>archivo de</em> servicio <em>cups.service a lo</em> largo de la ruta <em>/ lib / systemd / system /</em> , agregando la instrucción <strong>After</strong> a la sección <strong>[Unidad]</strong> : </p><br><pre> <code class="plaintext hljs">[Unit] Description=CUPS Scheduler Documentation=man:cupsd(8) After=sssd.service</code> </pre> <br><p>  Por lo tanto, CUPS se configura para la autorización básica a través de un dominio, es decir, la autorización al ingresar el inicio de sesión y la contraseña de un usuario de dominio con privilegio de administración de CUPS. </p><br><p>  La autorización se puede configurar de manera diferente, pero el principio (archivo de tubería) es generalmente universal y existe la posibilidad de configurarlo por analogía para LDAP, FreeIPA y otros servicios de directorio. </p><br><h3 id="ustanovka-printera-v-linux">  Instalar una impresora en Linux </h3><br><p>  Instalar una impresora en Linux a menudo es una tarea específica, diferente para diferentes marcas e incluso modelos.  Por lo tanto, no veo ninguna razón para describir la instalación de la impresora y asumo que el host <strong>linux1 tiene</strong> una impresora Kyocera-1024FP con el nombre <strong>Kyocera-1024FP instalado</strong> , y la página de la impresora está disponible en <code>http://linux1:631/printers/Kyocera-1024FP</code> . </p><br><p>  Ahora que el servidor Linux y las máquinas cliente están configuradas, las impresoras están conectadas a algunas de ellas, y también hay máquinas Windows con las que imprimir, y todo este sistema debe ser estable, incluso si es necesario reemplazar la impresora en una de las PC , entonces esto no debería implicar la reconfiguración de una buena mitad de todas las PC, si no todas.  Además, necesita la menor cantidad posible de problemas con los controladores.  Y es bastante posible. </p><br><h3 id="gruppy-printerov-classes">  Grupos de impresoras (clases) </h3><br><p>     <strong>Canon-MF4400</strong> c  <strong>windows1</strong>   LPD.            <code>http://cupsserver:631/printers/Canon-MF4400</code> .          <strong>cupsserver</strong> <code>http://cupsserver:631/admin</code> .      " " [Add Class].   .      "", "", "",       .            .  <strong>Canon-MF4400</strong>    ,    "" ,  <strong>printer-windows1</strong> , ""  ""   ,   " ". </p><br><p>      <strong>printer-windows1</strong>   <strong>Canon-MF4400</strong>  .           <strong>Canon-MF4400</strong>       — <code>http://cupsserver:631/classes/printer-windows1</code> . </p><br><p>         <strong>linux1</strong>  Kyocera-1024FP.      HTTP.    "   (http)" [Internet Printing Protocol (http)],      "Generic",  "IPP Everywhere".    ,        <strong>linux1</strong> — <strong>Kyocera-1024FP</strong> .        <code>http://cupsserver:631/printers/Kyocera-1024FP</code> .    <strong>printer-windows1</strong>   <strong>printer-linux1</strong> c  <strong>Kyocera-1024FP</strong>  .    <code>http://cupsserver:631/classes/printer-linux1</code> . </p><br><p>    <strong>Kyocera-1024FP</strong>   <strong>linux1</strong>   <strong>cupsserver</strong>   <strong>windows1</strong>   Windows 8      (!)  .        "    ".  <strong></strong>    <code>http://_c:631/classes/_</code> .     — <code>http://cupsserver:631/classes/printer-linux1</code> .        "Generic",  — "MS Publisher Imagesetter".   ,        <code>printer-linux1  http://cupsserver:631</code> .             ,          Kyocera-1024FP. </p><br><p>    <strong>Canon-MF4400</strong>   <strong>windows1</strong>   <strong>cupsserver</strong>   <strong>linux1</strong>   Linux      (!)  .         ,   <strong>Kyocera-1024FP</strong>   <strong>cupsserver</strong> .       <strong>linux1</strong>    "   (http)",     ( <strong>Canon-MF4400</strong> )       — <code>http://cupsserver:631/classes/printer-windows1</code> .        "Generic",  — "IPP Everywhere".    ,       — <strong>printer-windows1</strong> .     <strong>linux1</strong>   <code>http://linux1:631/printers/printer-windows1</code> ,        . </p><br><p>      ,        ,   ,     ,       ,         .      —     ,   ,     ,  ,       .        ,          .  "IPP Everywhere"  "MS Publisher Imagesetter"     ,   ..,          . </p><br><h3 id="zaklyuchenie">  Conclusión </h3><br><p>   ,   - ,       .  ,   ,    ,      ,           . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443094/">https://habr.com/ru/post/443094/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443082/index.html">¿Por qué no debes mirar a los demás cuando aprendes un idioma?</a></li>
<li><a href="../443084/index.html">Facebook se niega a transferir servidores a países que violen la libertad de expresión e introduce un cifrado de extremo a extremo</a></li>
<li><a href="../443086/index.html">Food Design Digest, febrero de 2019</a></li>
<li><a href="../443090/index.html">Excursión a la central nuclear de Rostov</a></li>
<li><a href="../443092/index.html">El nuevo sensor ultrasónico le permite "escuchar" las bacterias: cómo funciona</a></li>
<li><a href="../443096/index.html">El diseñador no es periodista. Cómo realizar una entrevista con un usuario</a></li>
<li><a href="../443098/index.html">Los datos se escriben en el disco utilizando imanes y láseres.</a></li>
<li><a href="../443100/index.html">Contando errores en la calculadora de Windows</a></li>
<li><a href="../443102/index.html">Cambio de comportamiento como producto: ¿por qué Marie Kondo está recaudando una ronda de $ 40 millones con Sequoia Capital?</a></li>
<li><a href="../443104/index.html">Calcular expresiones simbólicas con números triangulares difusos en python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>