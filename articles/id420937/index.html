<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•’ ğŸ‘¨ğŸ¾ ğŸŒ¨ï¸ Tentang memakai SSD pada contoh nyata â ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ¤œğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setahun yang lalu, kami menambahkan kumpulan metrik dari atribut disk SMART ke server klien. Pada saat itu, kami tidak menambahkannya ke antarmuka dan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tentang memakai SSD pada contoh nyata</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/okmeter/blog/420937/"><img width="400" align="left" src="https://habrastorage.org/webt/om/2t/zs/om2tzsodob2fsf8r0qrsifs2_da.png"><br><p>  Setahun yang lalu, kami menambahkan kumpulan metrik dari atribut disk SMART ke server klien.  Pada saat itu, kami tidak menambahkannya ke antarmuka dan menunjukkannya kepada pelanggan.  Faktanya adalah, kami tidak mengambil metrik melalui smartctl, tetapi kami menarik ioctl langsung dari kode sehingga fungsi ini berfungsi tanpa menginstal smartmontools di server klien. <br>  Agen tidak menghapus semua atribut yang tersedia, tetapi hanya yang paling signifikan menurut kami dan yang paling tidak spesifik vendor (jika tidak, ia harus mendukung basis disk yang mirip dengan smartmontools). <br>  Sekarang, tangan akhirnya mencapai titik untuk memeriksa apa yang kami syuting di sana.  Dan diputuskan untuk memulai dengan atribut "indikator keausan media", yang menunjukkan persentase sumber daya perekaman SSD yang tersisa.  Di bawah potongan beberapa cerita dalam gambar tentang bagaimana sumber daya ini dihabiskan dalam kehidupan nyata di server. </p><a name="habracut"></a><br><h2 id="suschestvuyut-li-ubitye-ssd">  Apakah ada SSD yang terbunuh? </h2><br><p>  Dipercaya bahwa SSD baru yang lebih produktif dilepaskan lebih sering daripada yang lama berhasil terbunuh.  Oleh karena itu, hal pertama yang menarik adalah melihat yang paling terbunuh dalam hal merekam disk sumber daya.  Nilai minimum untuk semua ssd dari semua klien adalah 1%. </p><br><p>  Kami segera menulis kepada klien tentang ini, ternyata Dedik di hetzner.  Dukungan hosting segera diganti SSD: </p><br><p><img src="https://habrastorage.org/webt/zd/ff/cf/zdffcfwxk-byiavhepxbi2wahh8.png"><br></p><br><p>  Akan sangat menarik untuk melihat bagaimana situasi terlihat dari sudut pandang sistem operasi ketika ssd berhenti melayani catatan (kami sekarang mencari peluang untuk sengaja mengejek ssd untuk melihat metrik skenario ini :) </p><br><h2 id="kak-bystro-ubivayutsya-ssd">  Seberapa cepat SSD terbunuh? </h2><br><p>  Karena kami mulai mengumpulkan metrik setahun yang lalu, dan kami tidak menghapus metrik, dimungkinkan untuk melihat metrik ini tepat waktu.  Sayangnya, server dengan laju aliran tertinggi terhubung ke okmeter hanya 2 bulan yang lalu. </p><br><p><img src="https://habrastorage.org/webt/iy/n7/c9/iyn7c9otfrjy58f_jmwqkyz3ife.png"><br></p><br><p> Dalam grafik ini, kita melihat bagaimana dalam 2 bulan mereka membakar 8% dari sumber rekaman.  Artinya, dengan profil rekaman yang sama, SSD ini akan cukup untuk 100 / (8/2) = 25 bulan.  Saya tidak tahu banyak atau sedikit, tetapi mari kita lihat jenis muatan apa yang ada? </p><br><img src="https://habrastorage.org/webt/b2/hn/6x/b2hn6xjbklijgcoqzpysn4vel54.png"><br><p><br>  Kami melihat bahwa hanya ceph yang bekerja dengan disk, tetapi kami memahami bahwa ceph hanya lapisan.  Dalam hal ini, klien ceph bertindak sebagai repositori untuk kluster kubernet pada beberapa node, mari kita lihat apa di dalam k8 yang menghasilkan disk paling banyak: </p><br><p><img src="https://habrastorage.org/webt/gm/9e/n9/gm9en9hd8i7avo7th8_xvfnulte.png"><br></p><br><p>  Nilai absolut tidak cocok kemungkinan besar karena fakta bahwa ceph bekerja di cluster dan catatan dari redis meningkat karena replikasi data.  Tetapi profil memuat memungkinkan Anda untuk dengan yakin mengatakan bahwa catatan memulai persis redis.  Mari kita lihat apa yang terjadi pada lobak: </p><br><p><img src="https://habrastorage.org/webt/rn/5b/ie/rn5bieuh9ac3lb2kdizdwhu7wdi.png"><br></p><br><p>  di sini Anda dapat melihat bahwa rata-rata kurang dari 100 permintaan per detik dieksekusi, yang dapat mengubah data.  Ingatlah bahwa redis memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">2 cara untuk menulis data ke disk</a> : </p><br><ul><li>  <strong>RDB</strong> - snapshot berkala dari seluruh basis data ke disk, saat memulai redis, kita membaca dump terakhir ke memori, dan kita kehilangan data antara dump </li><li>  <strong>AOF</strong> - kami menulis log dari semua perubahan, saat mulai redis kehilangan log ini dan semua data muncul di memori, kami hanya kehilangan data antara fsync dari log ini </li></ul><br>  Karena semua orang mungkin sudah menebak dalam kasus ini, RDB digunakan dengan frekuensi dump 1 menit: <br><br><p><img src="https://habrastorage.org/webt/fq/ug/hi/fqughixpkwphosqk5xdzmrmcjqo.png"><br></p><br><h2 id="ssd--raid">  SSD + RAID </h2><br><p>  Menurut pengamatan kami, ada tiga konfigurasi utama subsistem disk server dengan kehadiran SSD: </p><br><ul><li>  di server 2 SSD dikumpulkan dalam raid-1 dan semuanya tinggal di sana </li><li>  server memiliki HDD + raid-10 dari ssd, biasanya digunakan untuk RDBMSs klasik (sistem, WAL dan bagian dari data pada HDD, dan pada SSD data terpanas dalam hal membaca) </li><li>  server memiliki SSD yang berdiri sendiri (JBOD), biasanya digunakan untuk cassandra jenis nosql </li></ul><br><p>  Jika ssd dikumpulkan dalam raid-1, rekaman masuk ke kedua disk, jadi keausan berjalan pada kecepatan yang sama: </p><br><p><img src="https://habrastorage.org/webt/u-/s9/ce/u-s9cebna9pesosskabhwzwzgwo.png"><br></p><br><p>  Tetapi server menarik perhatian saya, di mana gambarnya berbeda: </p><br><p><img src="https://habrastorage.org/webt/mk/xn/g_/mkxng_b0bng33epewwav3ue7hew.png"><br></p><br><p>  Dalam kasus ini, hanya partisi mdraid yang dipasang (semua array raid-1): </p><br><img src="https://habrastorage.org/webt/pg/9g/gy/pg9ggyky_kdfdo6jefefzpje1ew.png"><br><p>  Metrik rekaman juga menunjukkan bahwa ada lebih banyak entri di / dev / sda: </p><br><p><img src="https://habrastorage.org/webt/1m/2z/jp/1m2zjpefjue-rsneaasygdblkee.png"><br></p><br><p>  Ternyata salah satu partisi di / dev / sda digunakan sebagai swap, dan swap i / o di server ini cukup terlihat: </p><br><p><img src="https://habrastorage.org/webt/pc/-b/kv/pc-bkvbw5tat57qw9frcvgxyfbq.png"><br></p><br><h2 id="iznos-ssd-i-postgresql">  Depresiasi SSD dan PostgreSQL </h2><br><p>  Sebenarnya, saya ingin melihat tingkat keausan SSD pada berbagai beban tulis di Postgres, tetapi sebagai aturan, mereka digunakan dengan sangat hati-hati pada basis data SSD yang dimuat dan perekaman besar-besaran ke HDD.  Saat mencari case yang cocok, saya menemukan satu server yang sangat menarik: </p><br><p><img src="https://habrastorage.org/webt/pt/ga/qs/ptgaqs7cvz99zi16nt6jktvg8qw.png"><br></p><br><p>  Pemakaian dua ssd dalam serangan-1 selama 3 bulan adalah 4%, tetapi jika dilihat dari kecepatan perekaman WAL, postgres ini menulis kurang dari 100 Kb / s: </p><br><p><img src="https://habrastorage.org/webt/lb/sj/zh/lbsjzhzao54qovnsgan0zqif508.png"><br></p><br><p>  Ternyata postgres aktif menggunakan file-file sementara, bekerja dengan yang menciptakan aliran penulisan ke disk: </p><br><p><img src="https://habrastorage.org/webt/o0/dy/tr/o0dytrgxlb3fq3fhyg-k013nuvw.png"><br></p><br><p>  Karena postgresql dengan diagnostik cukup bagus, kami dapat, hingga permintaan, mencari tahu apa yang sebenarnya perlu kami perbaiki: </p><br><p><img src="https://habrastorage.org/webt/ok/dl/3k/okdl3khufsihxat-l--6mp7wijy.png"><br><br>  Seperti yang Anda lihat di sini, SELECT khusus ini menghasilkan banyak file sementara.  Secara umum, dalam postgres SELECT, kadang-kadang mereka menghasilkan catatan tanpa file sementara - di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini kita sudah membicarakan hal ini.</a> </p><br><h2 id="itogo">  Total </h2><br><ul><li>  Jumlah penulisan ke disk yang dibuat oleh Redis + RDB tidak tergantung pada jumlah modifikasi dalam database, tetapi pada ukuran database + interval pembuangan (dan secara umum, ini adalah tingkat tertinggi dari amplifikasi tulis di penyimpanan data yang saya tahu) </li><li>  Swap yang digunakan secara aktif pada ssd buruk, tetapi jika Anda perlu menambahkan jitter ke ssd wear (untuk reliabilitas raid-1), maka itu mungkin menjadi pilihan :) </li><li>  Selain WAL dan datafile, basis data masih dapat menulis semua jenis data sementara ke disk. </li></ul><br><p>  <em>Kami di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">okmeter.io</a> percaya bahwa untuk sampai ke dasar penyebab masalah, insinyur membutuhkan banyak metrik tentang semua lapisan infrastruktur.</em>  <em>Kami melakukan yang terbaik untuk membantu :)</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420937/">https://habr.com/ru/post/id420937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420923/index.html">Keterampilan Meta Pengembang Perangkat Lunak</a></li>
<li><a href="../id420927/index.html">â€œPencarian host karet di Alibaba Cloudâ€: host Elasticsearch di fasilitas Alibaba Cloud</a></li>
<li><a href="../id420929/index.html">Jalankan, Uji, Jalankan. Berbicara tentang Rapat Pengujian Seluler</a></li>
<li><a href="../id420931/index.html">Cara menguji pembangkit listrik tenaga nuklir</a></li>
<li><a href="../id420935/index.html">Semua yang perlu Anda ketahui tentang perataan di Flexbox</a></li>
<li><a href="../id420939/index.html">Satu cerita tentang pertumbuhan karier atau mengapa saya menganggap diri saya seorang manajer yang baik</a></li>
<li><a href="../id420941/index.html">Sengketa Blockchain P2P</a></li>
<li><a href="../id420943/index.html">Arsitektur kecerdasan buatan perlu diubah</a></li>
<li><a href="../id420945/index.html">Menjelajahi Dunia Baru dengan Proyek Open ATV NASA</a></li>
<li><a href="../id420947/index.html">Untuk pertanyaan tentang riak, orang-orang yang menarik dan induktansi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>