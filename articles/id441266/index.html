<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☝🏻 ☸️ 🏈 Bagaimana kerangka kerja tiOPF untuk delphi / lazarus bekerja. Template Pengunjung 🦊 😆 🤱🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dari penerjemah 
 Ada dua alasan mengapa saya berusaha menerjemahkan beberapa bahan pada kerangka kerja yang dikembangkan dua puluh tahun yang lalu un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kerangka kerja tiOPF untuk delphi / lazarus bekerja. Template Pengunjung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441266/"><h3>  Dari penerjemah </h3><br>  Ada dua alasan mengapa saya berusaha menerjemahkan beberapa bahan pada kerangka kerja yang dikembangkan dua puluh tahun yang lalu untuk lingkungan pemrograman yang tidak terlalu populer: <br><br>  1. Beberapa tahun yang lalu, setelah mempelajari banyak kesenangan bekerja dengan Entity Framework sebagai ORM untuk platform .Net, saya mencari analog untuk lingkungan Lazarus dan, secara umum, untuk freepascal. <br>  Anehnya, ORM yang baik hilang untuknya.  Semua yang ditemukan kemudian adalah proyek open-source yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tiOPF</a> , yang dikembangkan kembali pada akhir 90-an untuk delphi, kemudian diangkut ke freepascal.  Namun, kerangka kerja ini secara fundamental berbeda dari tampilan ORM besar dan tebal yang biasa. <br><br>  Tidak ada metode visual untuk mendesain objek (dalam Entity - model terlebih dahulu) dan memetakan objek ke bidang tabel dalam database relasional (dalam Entity - database terlebih dahulu) di tiOPF.  Pengembang sendiri memposisikan fakta ini sebagai salah satu kekurangan proyek, namun, sebagai kelayakan, ia menawarkan orientasi lengkap khususnya pada model bisnis objek, hanya bernilai hardcode ... <br><a name="habracut"></a><br>  Pada level hardcoding yang diusulkan itulah saya mengalami masalah.  Pada saat itu, saya tidak terlalu berpengalaman dalam paradigma dan metode yang digunakan oleh pengembang kerangka penuh dan disebutkan dalam dokumentasi beberapa kali per paragraf (pola desain pengunjung, penghubung, pengamat, beberapa tingkat abstraksi untuk independensi DBMS, dll. .).  Proyek besar saya yang bekerja dengan database pada waktu itu sepenuhnya berfokus pada komponen visual Lazarus dan cara bekerja dengan database yang ditawarkan oleh lingkungan visual, sebagai akibatnya, banyak kode yang sama: tiga tabel dalam database itu sendiri dengan struktur yang hampir sama dan data yang homogen, tiga bentuk identik untuk dilihat, tiga bentuk identik untuk mengedit, tiga bentuk identik untuk laporan, dan segala sesuatu lainnya dari atas judul "Bagaimana tidak merancang perangkat lunak". <br><br>  Setelah membaca literatur yang cukup tentang prinsip-prinsip desain database dan sistem informasi yang benar, termasuk studi tentang templat, serta mengenal Kerangka Entitas, saya memutuskan untuk melakukan refactoring penuh baik dari database itu sendiri dan aplikasi saya.  Dan jika saya benar-benar mengatasi tugas pertama, maka untuk implementasi yang kedua ada dua jalan menuju arah yang berbeda: baik sepenuhnya untuk mempelajari .net, C # dan Entity Framework, atau menemukan ORM yang cocok untuk sistem Lazarus yang sudah dikenal.  Ada juga jejak sepeda ketiga, pertama, tidak mencolok - untuk menulis ORM agar sesuai dengan kebutuhan Anda sendiri, tetapi ini bukan intinya sekarang. <br><br>  Kode sumber kerangka kerja tidak banyak berkomentar, tetapi para pengembang tetap mempersiapkan (tampaknya pada periode awal pengembangan) sejumlah dokumentasi.  Semuanya, tentu saja, berbahasa Inggris, dan pengalaman menunjukkan bahwa, terlepas dari banyaknya kode, diagram, dan frasa pemrograman templat, banyak programmer yang berbahasa Rusia masih kurang berorientasi dalam dokumentasi berbahasa Inggris.  Tidak selalu dan tidak semua orang memiliki keinginan untuk melatih kemampuan untuk memahami teks teknis bahasa Inggris tanpa perlu pikiran untuk menerjemahkannya ke dalam bahasa Rusia. <br><br>  Selain itu, pengoreksian berulang teks untuk terjemahan memungkinkan Anda untuk melihat apa yang saya lewatkan ketika saya pertama kali bertemu dokumentasi, saya tidak memahaminya sepenuhnya atau salah.  Artinya, ini untuk dirinya sendiri kesempatan untuk mempelajari kerangka kerja yang dipelajari dengan lebih baik. <br><br>  2. Dalam dokumentasi, penulis sengaja atau tidak melewatkan beberapa kode, mungkin jelas menurut pendapatnya.  Karena keterbatasan penulisan, dokumentasi menggunakan mekanisme dan objek yang sudah ketinggalan zaman sebagai contoh, dihapus atau tidak lagi digunakan dalam versi baru kerangka kerja (tapi bukankah saya mengatakan bahwa itu sendiri terus berkembang?).  Juga, ketika saya mengulangi contoh yang dikembangkan sendiri, saya menemukan beberapa kesalahan yang harus diperbaiki.  Oleh karena itu, di tempat-tempat saya membiarkan diri saya tidak hanya menerjemahkan teks, tetapi juga untuk menambah atau merevisinya sehingga tetap relevan, dan contoh-contohnya berfungsi. <br><br>  Saya ingin memulai terjemahan bahan-bahan dari sebuah artikel karya Peter Henrikson tentang "paus" pertama yang menjadi dasar kerangka keseluruhan - templat Pengunjung.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Teks asli diposting di sini</a> . <br><br><h2>  Template pengunjung dan tiOPF </h2><br>  Tujuan artikel ini adalah untuk memperkenalkan templat Pengunjung, yang penggunaannya merupakan salah satu konsep dasar dari kerangka kerja tiOPF (Kerangka Kerja Objek TechInsite).  Kami akan mempertimbangkan masalah secara rinci, setelah menganalisis solusi alternatif sebelum menggunakan Pengunjung.  Dalam proses mengembangkan konsep pengunjung kami sendiri, kami akan menghadapi tantangan lain: kebutuhan untuk beralih melalui semua objek dalam koleksi.  Masalah ini juga akan dipelajari. <br><br>  Tugas utama adalah membuat cara umum untuk melakukan serangkaian metode terkait pada beberapa objek dalam koleksi.  Metode yang dilakukan dapat bervariasi tergantung pada keadaan internal objek.  Kami tidak dapat menjalankan metode sama sekali, tetapi kami dapat menjalankan beberapa metode pada objek yang sama. <br><br><h3>  Level pelatihan yang diperlukan </h3><br>  Pembaca harus terbiasa dengan objek pascal dan menguasai prinsip-prinsip dasar pemrograman berorientasi objek. <br><br><h3>  Contoh tugas bisnis di artikel ini </h3><br>  Sebagai contoh, kami akan mengembangkan buku alamat yang memungkinkan Anda membuat catatan orang dan informasi kontak mereka.  Dengan meningkatnya kemungkinan cara komunikasi antara orang-orang, aplikasi harus secara fleksibel memungkinkan Anda untuk menambahkan metode seperti itu tanpa pemrosesan kode yang signifikan (saya ingat setelah selesai memproses kode untuk menambahkan nomor telepon, saya segera perlu memprosesnya lagi untuk menambahkan email).  Kami perlu memberikan dua kategori alamat: nyata, seperti alamat rumah, pos, kantor, dan elektronik: telepon rumah, faks, ponsel, email, situs web. <br><br>  Pada tingkat presentasi, aplikasi kita akan terlihat seperti Explorer / Outlook, yaitu, seharusnya menggunakan komponen standar seperti TreeView dan ListView.  Aplikasi harus bekerja dengan cepat dan tidak memberi kesan perangkat lunak server klien besar. <br><br>  Aplikasi mungkin terlihat seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/18a/fa8/773/18afa8773d4df14f7c08b3e4ae5ec204.png"><br><br>  Di menu konteks pohon, Anda dapat memilih untuk menambah / menghapus kontak seseorang atau perusahaan, dan klik kanan pada daftar data kontak untuk membuka dialog untuk mengeditnya, menghapus atau menambahkan data. <br><br>  Data dapat disimpan dalam berbagai bentuk, dan di masa mendatang kami akan mempertimbangkan cara menggunakan templat ini untuk mengimplementasikan fitur ini. <br><br><h3>  Sebelum Anda mulai </h3><br>  Kami akan mulai bekerja dengan kumpulan objek sederhana - daftar orang yang pada gilirannya memiliki dua properti - nama (Nama) dan alamat (EmailAdrs).  Untuk mulai dengan, daftar akan diisi dengan data dalam konstruktor, dan kemudian diambil dari file atau database.  Tentu saja, ini adalah contoh yang sangat disederhanakan, tetapi cukup untuk sepenuhnya menerapkan template Pengunjung. <br><br>  Buat aplikasi baru dan tambahkan dua kelas dari bagian antarmuka modul utama: TPersonList (diwarisi dari TObjectList dan membutuhkan plug-in di modul contnrs) dan TPerson (diwarisi dari TObject): <br><br><pre><code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TPersonList</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObjectList)  <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;  <span class="hljs-title"><span class="hljs-title">TPerson</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObject)  <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>    FEMailAdrs: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>;    FName: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>;  <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FName <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FName;    <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> EMailAdrs: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FEMailAdrs <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FEMailAdrs;  <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Di konstruktor TPersonList, kami membuat tiga objek TPerson dan menambahkan ke daftar: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TPersonList</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lData: TPerson; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inherited</span></span>; lData := TPerson.Create; lData.<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> := <span class="hljs-string"><span class="hljs-string">'Malcolm Groves'</span></span>; lData.EMailAdrs := <span class="hljs-string"><span class="hljs-string">'malcolm@dontspamme.com'</span></span>;  <span class="hljs-comment"><span class="hljs-comment">// (ADUG Vice President) Add(lData); lData := TPerson.Create; lData.Name := 'Don MacRae';  // (ADUG President) lData.EMailAdrs := 'don@dontspamme.com'; Add(lData); lData := TPerson.Create; lData.Name := 'Peter Hinrichsen';  // (Yours truly) lData.EMailAdrs := 'peter_hinrichsen@dontspamme.com'; Add(lData); end;</span></span></code> </pre> <br>  Pertama, kita akan menelusuri daftar dan melakukan dua operasi pada setiap elemen daftar.  Operasi mirip, tetapi tidak sama: panggilan ShowMessage sederhana untuk menampilkan konten properti Nama dan EmailAdrs objek TPerson.  Tambahkan dua tombol ke formulir dan beri nama sesuatu seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/201/819/5ce/2018195cee6acbb2348e3ceb78abeaea.png"><br><br>  Dalam lingkup pilihan formulir Anda, Anda juga harus menambahkan properti (atau hanya bidang) dari FPersonList dari tipe TPersonList (jika jenisnya dideklarasikan di bawah formulir, baik mengubah urutan atau membuat deklarasi jenis pendahuluan), dan memanggil konstruktor di pengendali acara onCreate: <br><br><pre> <code class="delphi hljs">FPersonList := TPersonList.Create;</code> </pre> <br>  Untuk mengosongkan memori dengan benar di event event onClose form, objek ini harus dihancurkan: <br><br><pre> <code class="delphi hljs">FPersonList.Free.</code> </pre> <br><h3>  Langkah 1. Iterasi Hardcode </h3><br>  Untuk menampilkan nama dari objek TPerson, tambahkan kode berikut ke pengendali event onClick tombol pertama: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button1Click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FPersonList.Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>   ShowMessage(TPerson(FPersonList.Items[i]).<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Untuk tombol kedua, kode penangannya adalah sebagai berikut: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button2Click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FPersonList.Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>   ShowMessage(TPerson(FPersonList.Items[i]).EMailAdrs); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Berikut adalah beting yang jelas dari kode ini: <br><br><ul><li>  dua metode yang melakukan hal yang hampir sama.  Semua perbedaannya hanya atas nama properti dari objek yang mereka tampilkan; <br></li><li>  iterasi akan membosankan, terutama ketika Anda dipaksa untuk menulis loop serupa di seratus tempat dalam kode; <br></li><li>  seorang pemeran keras bagi TPerson penuh dengan situasi luar biasa.  Bagaimana jika ada instance TAnimal dalam daftar tanpa properti alamat?  Tidak ada mekanisme untuk menghentikan kesalahan dan mempertahankannya dalam kode ini. <br></li></ul><br>  Mari kita cari tahu cara meningkatkan kode dengan memperkenalkan abstraksi: kita meneruskan kode iterator ke kelas induk. <br><br><h3>  Langkah 2. Abstraksi iterator </h3><br>  Jadi, kami ingin memindahkan logika iterator ke kelas dasar.  Daftar iterator itu sendiri sangat sederhana: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FList.Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment">// -    …</span></span></code> </pre> <br>  Sepertinya kami berencana menggunakan template <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Iterator</a> .  Dari buku pada buku <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pola desain Gang-of-Four</a> , diketahui bahwa Iterator bisa eksternal dan internal.  Saat menggunakan iterator eksternal, klien secara eksplisit mengontrol traversal dengan memanggil metode Next (misalnya, enumerasi elemen TCollection dikendalikan oleh metode First, Next, Last).  Kami akan menggunakan iterator internal di sini, karena lebih mudah untuk menerapkan traversal pohon dengan bantuannya, yang merupakan tujuan kami.  Kami akan menambahkan metode Iterate ke kelas daftar kami dan akan meneruskan metode panggilan balik ke sana, yang harus dilakukan pada setiap elemen daftar.  Callback dalam objek pascal dinyatakan sebagai tipe prosedural, kita akan memiliki, misalnya, TDoSomethingToAPerson. <br><br>  Jadi, kami mendeklarasikan tipe prosedural TDoSomethingToAPerson, yang mengambil satu parameter tipe TPerson.  Tipe prosedural memungkinkan Anda untuk menggunakan metode ini sebagai parameter dari metode lain, yaitu menerapkan callback.  Dengan cara ini, kita akan membuat dua metode, salah satunya akan menunjukkan properti Nama objek, dan yang lainnya - properti EmailAdrs, dan mereka sendiri akan diteruskan sebagai parameter ke iterator umum.  Akhirnya, bagian deklarasi jenis akan terlihat seperti ini: <br><br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">{ TPerson }</span></span> <span class="hljs-title"><span class="hljs-title">TPerson</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObject) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>   FEMailAdrs: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>;   FName: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FName <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FName;   <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> EMailAdrs: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FEMailAdrs <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FEMailAdrs; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; TDoSomethingToAPerson = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData: TPerson)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">object</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TPersonList }</span></span> <span class="hljs-title"><span class="hljs-title">TPersonList</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObjectList) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pMethod: TDoSomethingToAPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;   DoSomething: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TPersonList</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pMethod: TDoSomethingToAPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>   pMethod(TPerson(Items[i])); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Sekarang, untuk melakukan tindakan yang diperlukan pada item daftar, kita perlu melakukan dua hal.  Pertama, tentukan operasi yang diperlukan menggunakan metode yang memiliki tanda tangan yang ditentukan oleh TDoSomethingToAPerson, dan kedua, tulis panggilan DoSomething dengan pointer ke metode ini yang dilewatkan sebagai parameter.  Di bagian uraian formulir, tambahkan dua deklarasi: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span>   FPersonList: TPersonList;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoShowName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData: TPerson)</span></span></span><span class="hljs-function">;</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoShowEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData: TPerson)</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br>  Dalam implementasi metode ini, kami menunjukkan: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoShowName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData: TPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ShowMessage(pData.<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoShowEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData: TPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ShowMessage(pData.EMailAdrs); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Kode untuk penangan tombol diubah sebagai berikut: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button1Click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FPersonList.DoSomething(@DoShowName); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button2Click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FPersonList.DoSomething(@DoShowEmail); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Sudah lebih baik.  Kami sekarang memiliki tiga level abstraksi dalam kode kami.  Iterator generik adalah metode kelas yang mengimplementasikan kumpulan objek.  Logika bisnis (sejauh ini hanya keluaran pesan tanpa akhir melalui ShowMessage) ditempatkan secara terpisah.  Pada tingkat presentasi (antarmuka grafis), logika bisnis disebut dalam satu baris. <br><br>  Sangat mudah untuk membayangkan bagaimana panggilan ke ShowMessage dapat diganti dengan kode yang menyimpan data kami dari TPerson dalam database relasional menggunakan kueri SQL dari objek TQuery.  Misalnya, seperti ini: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavePerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData: TPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lQuery: TQuery; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> lQuery := TQuery.Create(<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>   lQuery.SQL.Text := <span class="hljs-string"><span class="hljs-string">'insert into people values (:Name, :EMailAdrs)'</span></span>;   lQuery.ParamByName(<span class="hljs-string"><span class="hljs-string">'Name'</span></span>).AsString := pData.<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>;   lQuery.ParamByName(<span class="hljs-string"><span class="hljs-string">'EMailAdrs'</span></span>).AsString := pData.EMailAdrs;   lQuery.Datababase := gAppDatabase;   lQuery.ExecSQL; <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>   lQuery.Free; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  By the way, ini memperkenalkan masalah baru mempertahankan koneksi ke database.  Dalam permintaan kami, koneksi ke database dilakukan melalui beberapa objek global gAppDatabase.  Tapi di mana itu akan terletak dan bagaimana cara kerjanya?  Selain itu, kita tersiksa pada setiap langkah iterator untuk membuat objek TQuery, mengkonfigurasi koneksi, mengeksekusi kueri dan jangan lupa untuk membebaskan memori.  Akan lebih baik untuk membungkus kode ini dalam kelas yang merangkum logika membuat dan mengeksekusi query SQL, serta mengatur dan memelihara koneksi ke database. <br><br><h3>  Langkah 3. Melewati objek alih-alih meneruskan pointer ke panggilan balik </h3><br>  Melewati objek ke metode iterator kelas dasar akan memecahkan masalah pemeliharaan negara.  Kami akan membuat TPersonVisitor kelas Pengunjung abstrak dengan metode Eksekusi tunggal dan meneruskan objek ke metode ini sebagai parameter.  Antarmuka Pengunjung abstrak disajikan di bawah ini: <br><br><pre> <code class="delphi hljs">  <span class="hljs-title"><span class="hljs-title">TPersonVisitor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObject) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pPerson: TPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Selanjutnya, tambahkan metode Iterate ke kelas TPersonList kami: <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TPersonList</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObjectList) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisitor: TPersonVisitor)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Implementasi metode ini adalah sebagai berikut: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TPersonList</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisitor: TPersonVisitor)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>   pVisitor.Execute(TPerson(Items[i])); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Objek Pengunjung yang diimplementasikan dari kelas TPersonVisitor diteruskan ke metode Iterate, dan ketika iterasi melalui item daftar untuk masing-masing, Pengunjung yang ditentukan (metode pelaksanaannya) dipanggil dengan instance TPerson sebagai parameter. <br><br>  Mari kita buat dua implementasi Pengunjung - TShowNameVisitor dan TShowEmailVistor, yang akan melakukan pekerjaan yang diperlukan.  Berikut cara mengisi kembali bagian antarmuka modul: <br><br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">{ TShowNameVisitor }</span></span> <span class="hljs-title"><span class="hljs-title">TShowNameVisitor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TPersonVisitor) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pPerson: TPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">{ TShowEmailVisitor }</span></span> <span class="hljs-title"><span class="hljs-title">TShowEmailVisitor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TPersonVisitor) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pPerson: TPerson)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Demi kesederhanaan, penerapan metode eksekusi pada mereka masih akan menjadi satu baris - ShowMessage (pPerson.Name) dan ShowMessage (pPerson.EMailAdrs). <br><br>  Dan ubah kode untuk penangan klik tombol: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button1Click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lVis: TPersonVisitor; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> lVis := TShowNameVisitor.Create; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>   FPersonList.Iterate(lVis); <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>   lVis.Free; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button2Click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lVis: TPersonVisitor; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> lVis := TShowEmailVisitor.Create; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>   FPersonList.Iterate(lVis); <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>   lVis.Free; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Sekarang, setelah memecahkan satu masalah, kami menciptakan yang lain untuk diri kami sendiri.  Logika iterator diringkas dalam kelas yang terpisah;  operasi yang dilakukan selama iterasi dibungkus dengan objek, yang memungkinkan kita untuk menyimpan beberapa informasi tentang keadaan, tetapi ukuran kode telah berkembang dari satu baris (FPersonList.DoSomething (@DoShowName); menjadi sembilan baris untuk setiap penangan tombol. Sekarang ini akan membantu kami - ini adalah Manajer Pengunjung, yang akan mengurus pembuatan dan membebaskan salinan mereka. Secara potensial, kami dapat menyediakan beberapa operasi dengan objek yang akan dilakukan selama iterasi, untuk ini Manajer Pengunjung akan menyimpan daftar mereka dan melewatinya di setiap langkah, Anda  . Olnyaya hanya operasi yang dipilih Berikutnya akan jelas menunjukkan manfaat dari pendekatan ini, kita akan menggunakan pengunjung untuk menyimpan data dalam database relasional sebagai menyimpan data operasi sederhana dapat dilakukan oleh tiga operator yang berbeda SQL: CREATE, DELETE dan UPDATE. <br><br><h3>  Langkah 4. Enkapsulasi Pengunjung Lebih Lanjut </h3><br>  Sebelum melanjutkan, kita harus merangkum logika karya Pengunjung, memisahkannya dari logika bisnis aplikasi sehingga tidak kembali ke sana.  Ini akan membawa kita tiga langkah untuk melakukan ini: membuat kelas dasar TVisited dan TVisitor, kemudian kelas dasar untuk objek bisnis dan koleksi objek bisnis, kemudian sedikit menyesuaikan kelas khusus kami TPerson dan TPersonList (atau TPeople) sehingga mereka menjadi pewaris basis dibuat. kelas.  Secara umum, struktur kelas akan sesuai dengan diagram seperti itu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bb/f5e/b62/8bbf5eb6201de628050d085c061fe800.png"><br><br>  Objek TVisitor mengimplementasikan dua metode: fungsi AcceptVisitor dan prosedur Execute, di mana objek tipe TVisited dilewatkan.  Objek TVisited pada gilirannya mengimplementasikan metode Iterate dengan parameter tipe TVisitor.  Yaitu, TVisited .Iterate harus memanggil metode Execute pada objek TVisitor yang ditransfer, mengirimkan tautan ke instance-nya sendiri sebagai parameter, dan jika instance adalah kumpulan, metode Execute dipanggil untuk setiap elemen dalam koleksi.  Fungsi AcceptVisitor diperlukan karena kami sedang mengembangkan sistem umum.  Dimungkinkan untuk meneruskan ke Pengunjung, yang beroperasi hanya dengan tipe TPerson, contoh kelas TDog, misalnya, dan harus ada mekanisme untuk mencegah pengecualian dan mengakses kesalahan karena ketidakcocokan tipe.  Kelas TVisited adalah turunan dari kelas TPersistent, karena sedikit kemudian kita perlu mengimplementasikan fungsi yang terkait dengan penggunaan RTTI. <br><br>  Bagian antarmuka modul sekarang akan seperti ini: <br><br><pre> <code class="delphi hljs">TVisited = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; <span class="hljs-comment"><span class="hljs-comment">{ TVisitor }</span></span> <span class="hljs-title"><span class="hljs-title">TVisitor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObject) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">:</span></span> boolean; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">{ TVisited }</span></span> <span class="hljs-title"><span class="hljs-title">TVisited</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TPersistent) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisitor: TVisitor)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Metode kelas abstrak TVisitor akan dilaksanakan oleh ahli waris, dan implementasi umum metode Iterate untuk TVisited diberikan di bawah ini: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisited</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisitor: TVisitor)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> pVisitor.Execute(self); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Pada saat yang sama, metode ini dinyatakan virtual untuk kemungkinan penggantiannya dalam ahli waris. <br><br><h3>  Langkah 5. Buat objek dan koleksi bisnis bersama </h3><br>  Kerangka kerja kami membutuhkan dua kelas dasar lagi: untuk mendefinisikan objek bisnis dan koleksi objek tersebut.  Sebut mereka TtiObject dan TtiObjectList.  Antarmuka yang pertama dari mereka: <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TtiObject</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TVisited) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Nanti dalam proses pengembangan, kita akan memperumit kelas ini, tetapi untuk tugas saat ini, hanya satu konstruktor virtual dengan kemungkinan mengesampingkannya dalam ahli waris sudah cukup. <br><br>  Kami berencana untuk menghasilkan kelas TtiObjectList dari TVisited untuk menggunakan perilaku dalam metode yang telah diterapkan oleh leluhur (ada juga alasan lain untuk warisan ini yang akan dibahas di tempatnya).  Selain itu, tidak ada yang melarang penggunaan <abbr title="Penulis belum mengimplementasikan bagian dengan antarmuka dalam manual, karena Artikel ini ditulis pada tahun 90-an dan mod untuk digunakan dalam freepascal belum tiba.">antarmuka</abbr> (interface) alih-alih kelas abstrak. <br><br>  Bagian antarmuka dari kelas TtiObjectList adalah sebagai berikut: <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TtiObjectList</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TtiObject) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>   FList: TObjectList; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">destructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destroy</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function">;</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisitor: TVisitor)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pData: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Seperti yang Anda lihat, wadah itu sendiri dengan elemen objek terletak di bagian yang dilindungi dan tidak akan tersedia untuk pelanggan kelas ini.  Bagian terpenting dari kelas adalah implementasi metode Iterate yang ditimpa.  Jika di kelas dasar metode hanya disebut pVisitor.Execute (mandiri), maka di sini implementasinya terhubung dengan enumerasi daftar: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TtiObjectList</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisitor: TVisitor)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inherited</span></span> Iterate(pVisitor); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FList.Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>   (FList.Items[i] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TVisited).Iterate(pVisitor); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Penerapan metode kelas lain mengambil satu baris kode tanpa memperhitungkan ekspresi bawaan yang ditempatkan secara otomatis: <br><br><pre> <code class="delphi hljs">Create: FList := TObjectList.Create; Destroy: FList.Free; Clear: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Assigned(FList) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FList.Clear; Add: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Assigned(FList) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FList.Add(pData);</code> </pre> <br>  Ini adalah bagian penting dari keseluruhan sistem.  Kami memiliki dua kelas dasar logika bisnis: TtiObject dan TtiObjectList.  Keduanya memiliki metode Iterate dimana sebuah instance dari kelas TVisited dilewatkan.  Iterator sendiri memanggil metode Execute dari kelas TVisitor dan meneruskan referensi ke objek itu sendiri.  Panggilan ini sudah ditentukan sebelumnya dalam perilaku kelas di tingkat atas warisan.  Untuk kelas kontainer, setiap objek yang disimpan dalam daftar juga memiliki metode Iterate, yang disebut dengan parameter tipe TVisitor, yaitu, setiap pengunjung tertentu dijamin akan mem-bypass semua objek yang tersimpan dalam daftar, serta daftar itu sendiri sebagai objek kontainer. <br><br><h3>  Langkah 6. Membuat manajer pengunjung </h3><br>  Jadi, kembali ke masalah yang kita gambar sendiri pada langkah ketiga.  Karena kami tidak ingin membuat dan memusnahkan salinan Pengunjung setiap saat, pengembangan Manajer akan menjadi solusinya.  Ini harus melakukan dua tugas utama: mengelola daftar Pengunjung (yang terdaftar seperti itu di bagian inisialisasi modul individu) dan menjalankannya ketika mereka menerima perintah yang sesuai dari klien. <br>  Untuk mengimplementasikan manajer, kami akan melengkapi modul kami dengan tiga kelas tambahan: TVisClassRef, TVisMapping dan TtiVisitorManager. <br><br><pre> <code class="delphi hljs">TVisClassRef = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> TVisitor;</code> </pre> <br>  TVisClassRef adalah tipe referensi dan menunjukkan nama kelas tertentu - keturunan TVisitor.  Arti menggunakan tipe referensi adalah sebagai berikut: ketika metode dasar Execute dengan tanda tangan disebut <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData: TVisited; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pVisClass: TVisClassRef)</span></span></span><span class="hljs-function">,</span></span></code> </pre> <br>  secara internal, metode ini dapat menggunakan ekspresi seperti lVisitor: = pVisClass.Create untuk membuat turunan dari Pengunjung tertentu, tanpa terlebih dahulu mengetahui jenisnya.  Yaitu, kelas apa saja - keturunan TVisitor dapat dibuat secara dinamis di dalam metode Execute yang sama ketika meneruskan nama kelasnya sebagai parameter. <br><br>  Kelas kedua, TVisMapping, adalah struktur data sederhana dengan dua properti: referensi ke tipe TVisClassRef dan Command properti string.  Kelas diperlukan untuk membandingkan operasi yang dilakukan dengan namanya (perintah, misalnya, "save") dan kelas Pengunjung, yang dieksekusi perintah ini.  Tambahkan kodenya ke proyek: <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TVisMapping</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObject) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>   FCommand: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>;   FVisitorClass: TVisClassRef; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> VisitorClass: TVisClassRef <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FVisitorClass <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FVisitorClass;   <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> Command: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FCommand <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FCommand; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Dan kelas terakhir adalah TtiVisitorManager.  Saat kami mendaftarkan Pengunjung menggunakan Manajer, instance kelas TVisMapping dibuat, yang dimasukkan dalam daftar Manajer. <br>  Dengan demikian, dalam Manajer, daftar Pengunjung dibuat dengan pencocokan perintah string, setelah menerima yang akan dieksekusi.  Antarmuka kelas ditambahkan ke modul: <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TtiVisitorManager</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TObject) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>   FList: TObjectList; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">destructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destroy</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterVisitor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pCommand: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; pVisitorClass: TVisClassRef)</span></span></span><span class="hljs-function">;</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pCommand: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; pData: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Metode kuncinya adalah RegisterVisitor dan Execute.  Yang pertama biasanya disebut di bagian inisialisasi modul, yang menggambarkan kelas Pengunjung, dan terlihat seperti ini: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">initialization</span></span>  gTIOPFManager.VisitorManager.RegisterVisitor(<span class="hljs-string"><span class="hljs-string">'show'</span></span>, TShowNameVisitor);  gTIOPFManager.VisitorManager.RegisterVisitor(<span class="hljs-string"><span class="hljs-string">'show'</span></span>, TShowEMailAdrsVisitor);</code> </pre> <br>  Kode metode itu sendiri adalah sebagai berikut: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TtiVisitorManager</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterVisitor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pCommand: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; pVisitorClass: TVisClassRef)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lData: TVisMapping; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> lData := TVisMapping.Create; lData.Command := pCommand; lData.VisitorClass := pVisitorClass; FList.Add(lData); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Tidak sulit untuk memperhatikan bahwa kode ini sangat mirip dengan implementasi Pascal dari templat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pabrik</a> . <br><br>  Metode Jalankan penting lainnya menerima dua parameter: perintah yang digunakan Pengunjung atau grup mereka untuk diidentifikasi, serta objek data yang metode Iterate akan dipanggil dengan tautan ke instance dari Pengunjung yang diinginkan.  Kode lengkap untuk metode Jalankan diberikan di bawah ini: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TtiVisitorManager</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pCommand: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; pData: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; lVisitor: TVisitor; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FList.Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> SameText(pCommand, TVisMapping(FList.Items[i]).Command) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>     lVisitor := TVisMapping(FList.Items[i]).VisitorClass.Create;     <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>       pData.Iterate(lVisitor);     <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>       lVisitor.Free;     <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;   <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Dengan demikian, untuk menjalankan dua Pengunjung yang sebelumnya terdaftar dengan satu tim, kami hanya perlu satu baris kode: <br><br><pre> <code class="delphi hljs">gTIOPFManager.VisitorManager.Execute(<span class="hljs-string"><span class="hljs-string">'show'</span></span>, FPeople);</code> </pre> <br>  Selanjutnya, kami akan melengkapi proyek kami sehingga Anda dapat memanggil perintah serupa: <br><br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">//      gTIOPFManager.VisitorManager.Execute('read', FPeople); //      gTIOPFManager.VisitorManager.Execute('save', FPeople).</span></span></code> </pre> <br><h3>  Langkah 7. Menyesuaikan Kelas Logika Bisnis </h3><br>  Menambahkan leluhur dari kelas TtiObject dan TtiObjectList untuk objek bisnis TPerson dan TPeople kami akan memungkinkan kami untuk merangkum logika iterator di kelas dasar dan tidak menyentuhnya lagi, di samping itu, menjadi mungkin untuk mentransfer objek dengan data ke Manajer Pengunjung. <br><br>  Deklarasi kelas kontainer baru akan terlihat seperti ini: <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TPeople</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TtiObjectList);</code> </pre> <br>  Bahkan, kelas TPeople bahkan tidak harus mengimplementasikan apa pun.  Secara teoritis, kita bisa melakukannya tanpa deklarasi TPeople sama sekali dan menyimpan objek dalam instance dari kelas TtiObjectList, tetapi karena kami berencana untuk menulis Pengunjung yang hanya memproses instance TPeople, kami membutuhkan kelas ini.  Dalam fungsi AcceptVisitor, pemeriksaan berikut akan dilakukan: <br><br><pre> <code class="delphi hljs">Result := pVisited <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TPeople.</code> </pre> <br>  Untuk kelas TPerson, kami menambahkan leluhur TtiObject, dan memindahkan dua properti yang ada ke ruang lingkup yang diterbitkan, karena di masa depan kita perlu bekerja melalui RTTI dengan properti ini.  Hal inilah yang nantinya akan secara signifikan mengurangi kode yang terlibat dalam memetakan objek dan catatan dalam database relasional: <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TPerson</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TtiObject) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>   FEMailAdrs: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>;   FName: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">published</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FName <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FName;   <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> EMailAdrs: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FEMailAdrs <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> FEMailAdrs; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><h3>  Langkah 8. Buat tampilan prototipe </h3><br>  <b><i>Komentar</i></b> .  Dalam artikel asli, GUI didasarkan pada komponen yang dibuat oleh tiOPF untuk kenyamanan bekerja dengan kerangka kerjanya di delphi.  Ini adalah analog komponen DB Sadar, yang merupakan kontrol standar seperti label, bidang input, kotak centang, daftar, dll., Tetapi dikaitkan dengan sifat-sifat tertentu objek tiObject dengan cara yang sama seperti komponen tampilan data dikaitkan dengan bidang dalam tabel database.  Seiring waktu, penulis kerangka kerja menandai paket dengan komponen visual ini sebagai usang dan tidak diinginkan untuk digunakan.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai gantinya, ia menyarankan untuk membuat tautan antara komponen visual dan properti kelas menggunakan pola desain Mediator. </font><font style="vertical-align: inherit;">Template ini adalah yang paling penting kedua di seluruh arsitektur kerangka kerja. </font><font style="vertical-align: inherit;">Deskripsi penulis tentang perantara dicakup oleh artikel yang terpisah, volume yang sebanding dengan manual ini, oleh karena itu saya menawarkan versi saya yang disederhanakan di sini sebagai GUI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ganti nama tombol 1 pada formulir proyek menjadi "show command", dan tombol 2 biarkan tanpa handler untuk saat ini, atau segera beri nama "save command". </font><font style="vertical-align: inherit;">Lemparkan komponen memo pada formulir dan letakkan semua elemen sesuai selera Anda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambahkan kelas Pengunjung yang akan mengimplementasikan perintah show: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interface -</font></font><br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TShowVisitor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TVisitor) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">:</span></span> boolean; <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dan implementasinya adalah - </font></font><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TShowVisitor</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AcceptVisitor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">:</span></span> boolean; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := (pVisited <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TPerson); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TShowVisitor</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> AcceptVisitor(pVisited) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; Form1.Memo1.Lines.Add(TPerson(pVisited).<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> + <span class="hljs-string"><span class="hljs-string">': '</span></span> + TPerson(pVisited).EMailAdrs); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AcceptVisitor memverifikasi bahwa objek yang ditransfer adalah turunan dari TPerson, karena Pengunjung hanya boleh menjalankan perintah dengan objek tersebut. Jika jenisnya cocok, perintah dieksekusi dan garis dengan properti objek ditambahkan ke bidang teks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tindakan pendukung untuk kesehatan kode adalah sebagai berikut. Tambahkan dua properti ke deskripsi formulir itu sendiri di bagian pribadi: FPeople tipe TPeople dan VM tipe TtiVisitorManager. Di pengendali acara pembuatan formulir, kita perlu menginisialisasi properti ini, serta mendaftarkan Pengunjung dengan perintah "show":</font></font><br><br><pre> <code class="delphi hljs">FPeople := TPeople.Create; FillPeople; VM := TtiVisitorManager.Create; VM.RegisterVisitor(<span class="hljs-string"><span class="hljs-string">'show'</span></span>,TShowVisitor);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FilPeople juga merupakan prosedur tambahan yang mengisi daftar dengan tiga objek, kodenya diambil dari konstruktor daftar sebelumnya. </font><font style="vertical-align: inherit;">Jangan lupa untuk menghancurkan semua benda yang dibuat. </font><font style="vertical-align: inherit;">Dalam hal ini, kami menulis FPeople.Free dan VM.Free dalam bentuk handler penutupan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan sekarang - bams! </font><font style="vertical-align: inherit;">- pengendali tombol pertama:</font></font><br><br><pre> <code class="delphi hljs">Memo1.Clear; VM.Execute(<span class="hljs-string"><span class="hljs-string">'show'</span></span>,FPeople);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setuju, jauh lebih menyenangkan. </font><font style="vertical-align: inherit;">Dan jangan bersumpah pada hash semua kelas dalam satu modul. </font><font style="vertical-align: inherit;">Di akhir manual, kami akan menyapu puing-puing ini.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Langkah 9. Kelas dasar Pengunjung bekerja dengan file teks </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada tahap ini, kita akan membuat kelas dasar Pengunjung yang tahu cara bekerja dengan file teks. Ada tiga cara untuk bekerja dengan file dalam objek pascal: prosedur lama dari waktu pascal pertama (seperti AssignFile dan ReadLn), bekerja melalui stream (TStringStream atau TFileStream), dan menggunakan objek TStringList.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika metode pertama sangat ketinggalan jaman, maka yang kedua dan ketiga adalah alternatif yang baik berdasarkan OOP. </font><font style="vertical-align: inherit;">Pada saat yang sama, bekerja dengan stream juga memberikan manfaat seperti kemampuan mengompresi dan mengenkripsi data, tetapi membaca dan menulis baris demi baris ke aliran adalah semacam redundansi dalam contoh kami. </font><font style="vertical-align: inherit;">Untuk mempermudah, kami akan memilih TStringList, yang memiliki dua metode sederhana - LoadFromFile dan SaveToFile. </font><font style="vertical-align: inherit;">Tetapi ingat bahwa dengan file besar, metode ini akan melambat secara signifikan, sehingga streaming akan menjadi pilihan optimal bagi mereka. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antarmuka kelas dasar TVisFile:</font></font><br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TVisFile</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TVisitor) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>   FList: TStringList;   FFileName: TFileName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span>;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">destructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destroy</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dan implementasi konstruktor dan destruktor: </font></font><br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisFile</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inherited</span></span> Create; FList := TStringList.Create; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FileExists(FFileName) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   FList.LoadFromFile(FFileName); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">destructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisFile</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Destroy</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FList.SaveToFile(FFileName); FList.Free; <span class="hljs-keyword"><span class="hljs-keyword">inherited</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nilai properti FFileName akan ditetapkan dalam konstruktor dari keturunan kelas dasar ini (hanya saja jangan menggunakan hardcoding, yang akan kami atur di sini, sebagai gaya pemrograman utama setelah!). </font><font style="vertical-align: inherit;">Diagram kelas Pengunjung yang bekerja dengan file adalah sebagai berikut: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/717/969/104/717969104d4b13d73ba1844fe0c2ddf9.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sesuai dengan diagram di bawah ini, kami membuat dua turunan dari kelas dasar TVisFile: TVisTXTFile dan TVisCSVFile. </font><font style="vertical-align: inherit;">Satu akan bekerja dengan file * .csv di mana bidang data dipisahkan oleh simbol (koma), yang kedua - dengan file teks di mana masing-masing bidang data akan memiliki panjang tetap per baris. </font><font style="vertical-align: inherit;">Untuk kelas-kelas ini, kami hanya mendefinisikan ulang konstruktor sebagai berikut:</font></font><br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisCSVFile</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FFileName := <span class="hljs-string"><span class="hljs-string">'contacts.csv'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">inherited</span></span> Create; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisTXTFile</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FFileName := <span class="hljs-string"><span class="hljs-string">'contacts.txt'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">inherited</span></span> Create; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Langkah 10. Tambahkan Pengunjung-penangan file teks </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di sini kita akan menambahkan dua Pengunjung spesifik, satu akan membaca file teks, yang kedua akan menulis untuk itu. </font><font style="vertical-align: inherit;">Pengunjung yang membaca harus mengganti metode kelas dasar AcceptVisitor dan Execute. </font><font style="vertical-align: inherit;">AcceptVisitor memverifikasi bahwa objek kelas TPeople diteruskan ke Pengunjung:</font></font><br><br><pre> <code class="delphi hljs">Result := pVisited <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TPeople;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eksekusi implementasi adalah sebagai berikut: </font></font><br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisTXtRead</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; lData: TPerson; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> AcceptVisitor(pVisited) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; <span class="hljs-comment"><span class="hljs-comment">//==&gt; TPeople(pVisited).Clear; for i := 0 to FList.Count - 1 do begin   lData := TPerson.Create;   lData.Name := Trim(Copy(FList.Strings[i], 1, 20));   lData.EMailAdrs := Trim(Copy(FList.Strings[i], 21, 80));   TPeople(pVisited).Add(lData); end; end;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengunjung pertama-tama membersihkan daftar objek TPeople yang diteruskan kepadanya dengan parameter, lalu membaca garis-garis dari objek TStringList-nya, ke mana isi file dimuat, membuat objek TPerson di setiap baris dan menambahkannya ke daftar kontainer TPeople. </font><font style="vertical-align: inherit;">Untuk kesederhanaan, properti nama dan emailadrs dalam file teks dipisahkan oleh spasi.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengunjung catatan mengimplementasikan operasi terbalik. Konstruktornya (diganti) membersihkan TStringList internal (mis., Melakukan operasi FList.Clear; wajib setelah diwariskan), AcceptVisitor memeriksa bahwa objek kelas TPerson dilewatkan, yang bukan merupakan kesalahan, tetapi perbedaan penting dari metode membaca Pengunjung yang sama. Tampaknya lebih mudah untuk mengimplementasikan rekaman dengan cara yang sama - memindai semua objek kontainer, menambahkannya ke StringList dan kemudian menyimpannya ke file. Semua ini terjadi jika kita benar-benar berbicara tentang penulisan akhir data ke file, namun kami berencana untuk memetakan data ke database relasional, ini harus diingat. Dan dalam hal ini, kita harus menjalankan kode SQL hanya untuk objek-objek yang telah diubah (dibuat, dihapus atau diedit). Itu sebabnya sebelum Pengunjung melakukan operasi pada objek,ia harus memeriksa korespondensi tipenya:</font></font><br><br><pre> <code class="delphi hljs">Result := pVisited <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Tperson;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Metode eksekusi hanya menambah StringList internal string yang diformat dengan aturan yang ditentukan: pertama, isi properti nama objek yang diteruskan, diisi dengan spasi hingga 20 karakter, kemudian isi properti emaiadrs: </font></font><br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisTXTSave</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> AcceptVisitor(pVisited) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; FList.Add(PadRight(TPerson(pVisited).<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>)+PadRight(TPerson(pVisited).EMailAdrs,<span class="hljs-number"><span class="hljs-number">60</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Langkah 11. Tambahkan Pengunjung-penangan file CSV </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengunjung membaca dan menulis serupa di hampir semua kolega mereka dari kelas TXT, kecuali cara memformat baris terakhir file: dalam standar CSV, nilai properti dipisahkan oleh koma. </font><font style="vertical-align: inherit;">Untuk membaca baris dan mem-parsingnya ke dalam properti, kami menggunakan fungsi ExtractDelimited dari modul strutils, dan penulisan dilakukan dengan hanya menyatukan baris:</font></font><br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisCSVRead</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; lData: TPerson; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> AcceptVisitor(pVisited) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; TPeople(pVisited).Clear; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FList.Count - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>   lData := TPerson.Create;   lData.<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> := ExtractDelimited(<span class="hljs-number"><span class="hljs-number">1</span></span>, FList.Strings[i], [<span class="hljs-string"><span class="hljs-string">','</span></span>]);   lData.EMailAdrs := ExtractDelimited(<span class="hljs-number"><span class="hljs-number">2</span></span>, FList.Strings[i], [<span class="hljs-string"><span class="hljs-string">','</span></span>]);   TPeople(pVisited).Add(lData); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TVisCSVSave</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pVisited: TVisited)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> AcceptVisitor(pVisited) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; FList.Add(TPerson(pVisited).<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> + <span class="hljs-string"><span class="hljs-string">','</span></span> + TPerson(pVisited).EMailAdrs); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang tersisa bagi kami adalah mendaftarkan Pengunjung baru di Manajer dan memeriksa pengoperasian aplikasi. </font><font style="vertical-align: inherit;">Di handler pembuatan formulir, tambahkan kode berikut:</font></font><br><br><pre> <code class="delphi hljs">VM.RegisterVisitor(<span class="hljs-string"><span class="hljs-string">'readTXT'</span></span>, TVisTXTRead); VM.RegisterVisitor(<span class="hljs-string"><span class="hljs-string">'saveTXT'</span></span>,TVisTXTSave); VM.RegisterVisitor(<span class="hljs-string"><span class="hljs-string">'readCSV'</span></span>,TVisCSVRead); VM.RegisterVisitor(<span class="hljs-string"><span class="hljs-string">'saveCSV'</span></span>,TVisCSVSave);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dok tombol yang diperlukan pada formulir dan berikan penangan yang sesuai: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/112/0c2/7c3/1120c27c31300af40162387ac222d33c.png"><br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadCSVbtnClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> VM.Execute(<span class="hljs-string"><span class="hljs-string">'readCSV'</span></span>, FPeople); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadTXTbtnClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> VM.Execute(<span class="hljs-string"><span class="hljs-string">'readTXT'</span></span>, FPeople); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveCSVbtnClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> VM.Execute(<span class="hljs-string"><span class="hljs-string">'saveCSV'</span></span>, FPeople); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TForm1</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveTXTbtnClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> VM.Execute(<span class="hljs-string"><span class="hljs-string">'saveTXT'</span></span>, FPeople); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format file tambahan untuk menyimpan data dilaksanakan dengan hanya menambahkan Pengunjung yang sesuai dan mendaftarkannya di Manajer. </font><font style="vertical-align: inherit;">Dan perhatikan hal-hal berikut: kami sengaja memberi nama perintah berbeda, yaitu saveTXT dan saveCSV. </font><font style="vertical-align: inherit;">Jika kedua Pengunjung cocok dengan satu perintah simpan, maka keduanya akan mulai pada perintah yang sama, periksa sendiri.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Langkah 12. Pembersihan kode akhir </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk keindahan dan kemurnian kode yang lebih besar, serta untuk mempersiapkan proyek untuk pengembangan interaksi lebih lanjut dengan DBMS, kami akan mendistribusikan kelas-kelas kami ke dalam modul yang berbeda sesuai dengan logika dan tujuannya. </font><font style="vertical-align: inherit;">Pada akhirnya, kita harus memiliki struktur modul berikut di folder proyek, yang memungkinkan kita untuk melakukan tanpa hubungan melingkar di antara mereka (ketika merakit sendiri, mengatur modul yang diperlukan dalam bagian penggunaan):</font></font><br><br><table><tbody><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modul </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fungsi </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kelas </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tivisitor.pas </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kelas dasar template Pengunjung dan Manajer </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisited </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisMapping </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TtiVisitorManager</font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiobject.pas </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kelas Logika Bisnis Dasar </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TtiObject </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TtiObjectList</font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> people_BOM.pas </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kelas Logika Bisnis Tertentu </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TPerson </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TPeople</font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> people_SRV.pas </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kelas beton bertanggung jawab atas interaksi </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisFile </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisTXTFile </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisCSVFile </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisCSVSimpan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisCSVBaca </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisTXTSave </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TVisTXBaca</font></font><br></td></tr></tbody></table><br><h3>  Kesimpulan </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada artikel ini, kami memeriksa masalah iterasi pada koleksi atau daftar objek yang dapat memiliki tipe berbeda. </font><font style="vertical-align: inherit;">Kami menggunakan templat Pengunjung yang diusulkan oleh GoF untuk secara optimal mengimplementasikan dua cara berbeda memetakan data dari objek ke file dengan format berbeda. </font><font style="vertical-align: inherit;">Pada saat yang sama, berbagai metode dapat dilakukan oleh satu tim karena pembuatan Manajer Pengunjung. </font><font style="vertical-align: inherit;">Pada akhirnya, contoh-contoh sederhana dan ilustratif yang dibahas dalam artikel akan membantu kita mengembangkan sistem serupa untuk memetakan objek ke basis data relasional. </font></font><br><br> <i><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arsipkan dengan kode sumber contoh - di sini</font></font></a></b></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id441266/">https://habr.com/ru/post/id441266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id441254/index.html">Seminar “Mengapa kami menghubungi Kubernetes dan apa yang kami dapatkan darinya”, 28 Februari, Moskow</a></li>
<li><a href="../id441258/index.html">Penelusuran dinamis berfitur lengkap di Linux menggunakan eBPF dan bpftrace</a></li>
<li><a href="../id441260/index.html">Bagaimana grafik jaringan saraf membantu</a></li>
<li><a href="../id441262/index.html">Tugas yang sederhana dan panjang menyingkirkan kandidat lebih baik daripada yang pendek dan kompleks</a></li>
<li><a href="../id441264/index.html">Panduan Pengguna Kibana. Visualisasi. Bagian 2</a></li>
<li><a href="../id441268/index.html">Ceedling + Eclipse atau unit test untuk mikrokontroler</a></li>
<li><a href="../id441270/index.html">Pertama-tama lihat Apple's FoundationDB</a></li>
<li><a href="../id441274/index.html">Bagaimana menjadi tester - pengetahuan dan keterampilan yang diperlukan</a></li>
<li><a href="../id441278/index.html">Cara membuat palet warna yang indah</a></li>
<li><a href="../id441280/index.html">Penyiapan GAL di Zimbra Collaboration Suite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>