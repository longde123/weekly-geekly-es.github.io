<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õπüèæ üî≠ ü•ò Leben Datenbanken in Kubernetes? üèÇüèΩ üíá üåÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Irgendwie hat sich historisch herausgestellt, dass die IT-Branche aus irgendeinem Grund in zwei bedingte Lager unterteilt ist: welche f√ºr und welche d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Leben Datenbanken in Kubernetes?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/453602/"><img src="https://habrastorage.org/webt/iq/xw/bx/iqxwbxcjzz4tipitwhcc-_mqe5q.jpeg"><br><br>  Irgendwie hat sich historisch herausgestellt, dass die IT-Branche aus irgendeinem Grund in zwei bedingte Lager unterteilt ist: welche f√ºr und welche dagegen sind.  Dar√ºber hinaus kann das Thema der Kontroverse absolut willk√ºrlich sein.  Welches Betriebssystem ist besser: Win oder Linux?  Auf einem Android- oder iOS-Smartphone?  Alles in den Clouds aufbewahren oder in einen kalten RAID-Speicher hochladen und Schrauben in einen Safe stecken?  Haben PHP-Schnicks das Recht, Programmierer genannt zu werden?  Diese Streitigkeiten sind zeitweise ausschlie√ülich existenzieller Natur und haben au√üer dem sportlichen Interesse keine andere Grundlage. <br><br>  Es ist einfach so passiert, dass mit dem Aufkommen von Containern und all dieser geliebten K√ºche mit Docker und bedingten K8s die Streitigkeiten f√ºr und wider neue M√∂glichkeiten in verschiedenen Bereichen des Backends nutzten.  (Wir werden im Voraus reservieren, dass, obwohl Kubernetes in dieser Diskussion meistens als Orchestrator angegeben wird, die Wahl dieses Instruments keine Rolle spielt. Stattdessen k√∂nnen Sie jedes andere Instrument ersetzen, das Ihnen am bequemsten und vertrautesten erscheint.) <br><br>  Und es scheint, es w√§re ein einfaches Argument √ºber die beiden Seiten derselben Medaille.  So sinnlos und gnadenlos wie die ewige Konfrontation Win vs Linux, in der irgendwo dazwischen ad√§quate Menschen f√ºr sich existieren.  Das ist nur im Fall der Containerisierung nicht so einfach.  Normalerweise gibt es bei solchen Streitigkeiten keine rechte Seite, aber im Fall von "Anwenden" - oder "Nicht-Anwenden" -Containern zum Speichern der Datenbank wird alles auf den Kopf gestellt.  Denn in gewissem Sinne haben sowohl Bef√ºrworter als auch Gegner eines solchen Ansatzes Recht. <br><a name="habracut"></a><br><h4>  Helle Seite </h4><br>  Sie k√∂nnen die Argumente der hellen Seite kurz mit einem Satz beschreiben: "Hallo, 2k19 au√üerhalb des Fensters!"  Es klingt nat√ºrlich nach Populismus, aber wenn Sie sich eingehend mit der Situation befassen, hat dies seine Vorteile.  Wir werden sie jetzt analysieren. <br><br>  Angenommen, Sie haben ein gro√ües Webprojekt.  Es k√∂nnte zun√§chst auf der Grundlage eines Microservice-Ansatzes aufgebaut werden oder irgendwann auf evolution√§re Weise dazu kommen - dies ist in der Tat nicht sehr wichtig.  Sie haben unser Projekt auf separate Microservices verteilt, Orchestrierung, Lastausgleich und Skalierung eingerichtet.  Und jetzt trinke mit gutem Gewissen Mojito in einer H√§ngematte w√§hrend eines Habr-Effekts, anstatt die gefallenen Kellner zu heben.  Aber alle Aktionen m√ºssen konsistent sein.  Sehr oft wird nur die Anwendung selbst containerisiert - der Code.  Was haben wir au√üer dem Code noch? <br><br>  Richtig, Daten.  Das Herzst√ºck eines jeden Projekts sind seine Daten: Es kann sich entweder um ein typisches DBMS handeln - MySQL, Postgre, MongoDB oder um einen f√ºr die Suche verwendeten Speicher (ElasticSearch), einen Schl√ºsselwertspeicher f√ºr das Caching - zum Beispiel um Redis usw. Jetzt tun wir dies nicht Wir werden √ºber krumme Backend-Implementierungsoptionen sprechen, wenn die Datenbank aufgrund schlecht geschriebener Abfragen abst√ºrzt, und stattdessen √ºber die Bereitstellung von Fehlertoleranz f√ºr genau diese Datenbank unter Clientlast.  Wenn wir unsere Anwendung containerisieren und sie frei skalieren lassen, um eine beliebige Anzahl eingehender Anforderungen zu verarbeiten, erh√∂ht dies nat√ºrlich die Belastung der Datenbank. <br><br>  Tats√§chlich wird der Kanal f√ºr den Zugriff auf die Datenbank und den Server, auf dem sie rotiert, zum Nadel√∂hr in unserem sch√∂nen Container-Backend.  Gleichzeitig ist das Hauptmotiv f√ºr die Containervirtualisierung die Mobilit√§t und Plastizit√§t der Struktur, die es erm√∂glicht, die Verteilung der Spitzenlast auf die gesamte uns zur Verf√ºgung stehende Infrastruktur so effizient wie m√∂glich zu organisieren.  Das hei√üt, wenn wir nicht alle verf√ºgbaren Elemente des Systems containerisieren und in einem Cluster zusammenfassen, machen wir einen sehr schwerwiegenden Fehler. <br><br>  Es ist viel logischer, nicht nur die Anwendung selbst, sondern auch die f√ºr die Datenspeicherung verantwortlichen Dienste zu gruppieren.  Beim Clustering und Bereitstellen unabh√§ngig arbeitender und verteilter Webserver in k8s l√∂sen wir bereits das Problem der Datensynchronisierung - dieselben Kommentare f√ºr Beitr√§ge, wenn Sie eine Medien- oder Blogplattform als Beispiel nehmen.  In jedem Fall starten wir eine sogar virtuelle Intracluster-Darstellung der Datenbank als ExternalService.  Die Frage ist, dass die Datenbank selbst noch nicht geclustert wurde. Die im Cube bereitgestellten Webserver nehmen Informationen √ºber die √Ñnderungen von unserer statischen Kampfbasis entgegen, die separat rotiert. <br><br>  F√ºhlen Sie den Haken?  Wir verwenden k8s oder Swarm, um die Last zu verteilen und den Ausfall des Hauptwebservers zu vermeiden, aber wir tun dies nicht f√ºr die Datenbank.  Aber wenn die Datenbank abst√ºrzt, macht es in unserer gesamten Cluster-Infrastruktur keinen Sinn - was n√ºtzen leere Webseiten, die einen Datenbankzugriffsfehler zur√ºckgeben? <br><br>  Aus diesem Grund m√ºssen nicht nur Webserver wie gewohnt geclustert werden, sondern auch die Datenbankinfrastruktur.  Nur so k√∂nnen wir sicherstellen, dass Elemente derselben Struktur, die in einem Team voll funktionsf√§hig sind, aber gleichzeitig unabh√§ngig voneinander sind.  Selbst wenn die H√§lfte unseres Backends unter Last "zusammenbricht", bleibt der Rest erhalten, und das Datenbanksynchronisationssystem innerhalb des Clusters und die M√∂glichkeit der unendlichen Skalierung und Bereitstellung neuer Cluster werden dazu beitragen, die erforderlichen Kapazit√§ten schnell zu erreichen - es w√ºrden Racks im Rechenzentrum vorhanden sein . <br><br>  Dar√ºber hinaus k√∂nnen Sie mit dem in Clustern verteilten Datenbankmodell dieselbe Datenbank dorthin bringen, wo sie ben√∂tigt wird.  Wenn es sich um einen globalen Dienst handelt, ist es ziemlich unlogisch, einen Webcluster irgendwo in der Region San Francisco zu verdrehen und gleichzeitig Pakete zu betreiben, wenn auf die Datenbank in der Region Moskau zugegriffen wird, und umgekehrt. <br><br>  Durch die Datenbankcontainerisierung k√∂nnen Sie au√üerdem alle Elemente des Systems auf derselben Abstraktionsebene erstellen.  Dies erm√∂glicht es wiederum, dieses System von Entwicklern direkt aus dem Code heraus zu verwalten, ohne dass Administratoren aktiv beteiligt sind.  Die Entwickler dachten, sie br√§uchten ein separates DBMS f√ºr ein neues Teilprojekt - einfach!  hat eine yaml-Datei geschrieben, in den Cluster hochgeladen und fertig. <br><br>  Nat√ºrlich ist die interne Bedienung stark vereinfacht.  Sagen Sie mir, wie oft haben Sie in den Augenblicken geschielt, in denen ein neues Mitglied des Teams seine H√§nde zur Arbeit in die Kampfdatenbank geschoben hat?  Welches dreht sich gerade?  Nat√ºrlich sind wir alle hier Erwachsene, und irgendwo haben wir ein neues Backup und noch weiter - hinter einem Regal mit Gurken der Gro√ümutter und alten Skiern - ein weiteres Backup, m√∂glicherweise sogar in einem K√ºhlhaus, weil Ihr B√ºro einmal in Flammen stand.  Dennoch ist jede Einf√ºhrung eines neuen Teammitglieds mit Zugriff auf die Kampfinfrastruktur und nat√ºrlich auf die Kampfdatenbank ein Eimer mit Validol f√ºr alle Beteiligten.  Nun, wer, ein Neuling, wei√ü, vielleicht blinzelt er?  Be√§ngstigend, stimme zu. <br><br>  Die Containerisierung und in der Tat die verteilte physische Datenbanktopologie Ihres Projekts tragen dazu bei, solche g√ºltigen Momente zu vermeiden.  Traue dem Neuling nicht?  Okay  Wir werden unseren eigenen Cluster daf√ºr erstellen und ihn vom Rest der Datenbankcluster trennen - Synchronisation nur durch manuelles Dr√ºcken und gleichzeitiges Drehen von zwei Schl√ºsseln (ein Teamleiter, der zweite Administrator).  Und alle sind gl√ºcklich. <br><br>  Und jetzt ist es an der Zeit, die Gegner der Datenbankcontainerisierung zu wechseln. <br><br><h4>  Die dunkle Seite </h4><br>  Wenn wir argumentieren, warum es nicht notwendig ist, die Datenbank zu containerisieren und sie weiterhin auf einem zentralen Server zu drehen, werden wir uns nicht an die Rhetorik der Orthodoxie und Aussagen wie "Gro√üv√§ter haben die Datenbank auf Hardware umgestellt, und wir werden!"  Versuchen wir stattdessen, eine Situation zu finden, in der die Containerisierung wirklich greifbare Dividenden bringen w√ºrde. <br><br>  Sie m√ºssen zugeben, dass Projekte, die wirklich eine Basis im Container ben√∂tigen, an den Fingern einer Hand als nicht der beste Fr√§smaschinenbediener gez√§hlt werden k√∂nnen.  Zum gr√∂√üten Teil ist sogar die Verwendung von k8s oder Docker Swarm √ºberfl√ºssig - h√§ufig greifen sie aufgrund des allgemeinen Hype der Technologie auf diese Tools zur√ºck, und die ‚Äûm√§chtigsten‚Äú in der Person der Geschlechter, um alles in Wolken und Container zu treiben.  Nun, denn jetzt ist es in Mode und jeder tut es. <br><br>  Zumindest in der H√§lfte der F√§lle ist die Verwendung von Kubernetis oder nur eines Dockers in einem Projekt √ºberfl√ºssig.  Die Frage ist, dass nicht alle Teams oder Outsourcing-Unternehmen, die f√ºr die Wartung der Kundeninfrastruktur eingestellt wurden, sich dessen bewusst sind.  Schlimmer noch - wenn Container auferlegt werden, weil sie dem Kunden in einer bestimmten Menge M√ºnzen aufsteigen. <br><br>  Im Allgemeinen gibt es eine Meinung, dass der Docker / Mafia-W√ºrfel Kunden, die diese Infrastrukturprobleme auslagern, dumm vernichtet.  Um mit Clustern arbeiten zu k√∂nnen, ben√∂tigen Sie Ingenieure, die dazu in der Lage sind und die Architektur der implementierten L√∂sung im Allgemeinen verstehen.  Irgendwie haben wir unseren Fall bereits mit der Republic Edition beschrieben - dort haben wir das Kundenteam geschult, um in den Realit√§ten von Kubernetis zu arbeiten, und alle waren zufrieden.  Und es war anst√§ndig.  Oft nehmen die ‚ÄûImplementierer‚Äú von k8 die Infrastruktur des Kunden als Geisel - jetzt verstehen sie nur noch, wie dort alles funktioniert, es gibt keine Spezialisten auf der Client-Seite. <br><br>  Stellen Sie sich nun vor, dass wir auf diese Weise nicht nur den Webserverteil an das Outsourcing √ºbergeben, sondern auch die Datenbankwartung.  Wir sagten, dass eine DB ein Herz ist und Herzverlust f√ºr jeden lebenden Organismus t√∂dlich ist.  Kurz gesagt, die Aussichten sind nicht die besten.  Anstelle von Hype Kubernetis sollten viele Projekte einfach nicht verr√ºckt nach dem normalen AWS-Tarif werden, der alle Probleme mit der Auslastung ihrer Website / ihres Projekts l√∂st.  Aber AWS ist nicht mehr in Mode und Show-Offs sind teurer als Geld - leider auch in der IT-Umgebung. <br><br>  Okay  Vielleicht muss das Projekt wirklich geclustert werden, aber wenn bei zustandslosen Anwendungen alles klar ist, wie k√∂nnen wir dann eine angemessene Bereitstellung der Netzwerkkonnektivit√§t f√ºr die geclusterte Datenbank organisieren? <br><br>  Wenn es sich um eine nahtlose Engineering-L√∂sung handelt, bei der es sich anscheinend um den √úbergang zu k8s handelt, besteht unser Hauptproblem in der Datenreplikation in einer Clusterdatenbank.  Einige DBMS sind anfangs der Verteilung von Daten zwischen ihren einzelnen Instanzen ziemlich treu.  Viele andere sind nicht so einladend.  Und h√§ufig ist das Hauptargument bei der Auswahl eines DBMS f√ºr unser Projekt nicht die F√§higkeit, mit minimalen Ressourcen- und Engineeringkosten zu replizieren.  Vor allem, wenn das Projekt urspr√ºnglich nicht als Microservice geplant war, sondern sich einfach in diese Richtung entwickelt hat. <br><br>  Wir m√ºssen nicht √ºber die Geschwindigkeit von Netzwerklaufwerken sprechen - sie sind langsam.  Das hei√üt,  Wir haben immer noch keine echte M√∂glichkeit. In diesem Fall k√∂nnen wir eine DBMS-Instanz irgendwo aktualisieren, wo beispielsweise mehr Prozessorkapazit√§ten oder freier RAM vorhanden sind.  Wir sto√üen sehr schnell auf die Leistung eines virtualisierten Festplattensubsystems.  Dementsprechend muss das DBMS in unmittelbarer N√§he an seine eigenen Maschinen genagelt werden.  Oder es ist notwendig, die ausreichend schnelle Synchronisation der Datensynchronisation irgendwie von den gesch√§tzten Reserven zu trennen. <br><br>  Fortsetzung des Themas der virtuellen FS: Docker-Volumes sind leider nicht problemlos.  Im Allgemeinen m√∂chte ich in einem Fall wie einer langfristig zuverl√§ssigen Datenspeicherung mit den einfachsten technischen Schemata arbeiten.  Das Hinzuf√ºgen einer neuen Abstraktionsschicht aus dem FS-Container zum √ºbergeordneten Host-FS ist an sich schon ein Risiko.  Wenn es jedoch auch Schwierigkeiten gibt, Daten zwischen diesen Schichten beim Betrieb des Containerisierungs-Support-Systems zu √ºbertragen, ist dies wirklich eine Katastrophe.  Im Moment scheinen die meisten Probleme, die der fortschrittlichen Menschheit bekannt sind, beseitigt zu sein.  Aber Sie selbst verstehen, je komplexer der Mechanismus ist, desto leichter bricht er. <br><br>  Angesichts all dieser "Abenteuer" ist es viel rentabler und einfacher, die Datenbank an einem Ort zu halten. Selbst wenn Sie eine Containerisierung der Anwendung ben√∂tigen, lassen Sie sie sich von selbst drehen und erhalten √ºber das Distributions-Gateway eine gleichzeitige Kommunikation mit der Datenbank, die nur einmal gelesen und geschrieben wird an einem Ort.  Dieser Ansatz reduziert die Wahrscheinlichkeit von Fehlern und Fehlersynchronisation auf minimale Werte. <br><br>  Wohin f√ºhren wir?  Dar√ºber hinaus ist eine Containerisierung der Datenbank angebracht, wenn ein wirklicher Bedarf besteht.  Sie k√∂nnen die Basis der vollst√§ndigen App nicht √ºberf√ºllen und drehen, als h√§tten Sie zwei Dutzend Microservices - dies funktioniert nicht.  Und das muss klar verstanden werden. <br><br><h4>  Anstelle von Ausgabe </h4><br>  Wenn Sie auf die verst√§ndliche Schlussfolgerung ‚ÄûVirtualisieren oder nicht die Datenbank‚Äú warten, sind wir entt√§uscht: Sie wird nicht hier sein.  Denn bei der Erstellung einer Infrastrukturl√∂sung sollte man sich nicht von Mode und Fortschritt leiten lassen, sondern vor allem vom gesunden Menschenverstand. <br><br>  Es gibt Projekte, bei denen die Prinzipien und Werkzeuge von kubernetis perfekt passen, und bei solchen Projekten kommt Frieden zumindest im Backend-Bereich.  Und es gibt Projekte, die keine Containerisierung ben√∂tigen, sondern eine normale Serverinfrastruktur, da sie grunds√§tzlich nicht auf ein Microservice-Cluster-Modell skaliert werden k√∂nnen, da sie fallen werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453602/">https://habr.com/ru/post/de453602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453590/index.html">Ihr pers√∂nliches SaaS</a></li>
<li><a href="../de453592/index.html">Verdienen Sie Ihren Lebensunterhalt und machen Sie Spiele: 11 Levelord-Tipps</a></li>
<li><a href="../de453594/index.html">Spiele f√ºr den Lebensunterhalt machen: 11 Tipps von Levelord</a></li>
<li><a href="../de453596/index.html">Betr√ºger und EDS - alles ist sehr schlecht</a></li>
<li><a href="../de453598/index.html">Japan: ein Land mit so gesundem Menschenverstand, dass es an manchen Orten irrational ist</a></li>
<li><a href="../de453608/index.html">Pythonhosted.org wurde f√§lschlicherweise von Roskomnadzor blockiert</a></li>
<li><a href="../de453610/index.html">So verkaufen Sie SD-WAN-Gesch√§fte</a></li>
<li><a href="../de453612/index.html">Fu√üball in den Wolken - Mode oder Notwendigkeit?</a></li>
<li><a href="../de453614/index.html">Lokales (offline) npm-Repository</a></li>
<li><a href="../de453616/index.html">Was ist falsch an dem Bundesgesetz ‚Äû√úber elektronische Signaturen‚Äú (63-FZ) und wie kann es behoben werden?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>