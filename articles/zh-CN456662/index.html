<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🏫 ☦️ 🎡 如何使用测试驱动的开发为治疗师省钱 👨‍🔬 ☀️ 💃🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="你有过这种情况吗？ 


 我想通过一个特定的例子向您展示TDD如何提高代码质量。 
 因为我在研究该问题时遇到的所有东西都是理论上的。 
 碰巧，我碰巧写了两个几乎相同的应用程序：一个是用古典风格编写的，因为那时我不知道TDD，第二个是只使用TDD。 

 在下面，我将显示最大的差异在哪里。 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何使用测试驱动的开发为治疗师省钱</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/leroy_merlin/blog/456662/"> 你有过这种情况吗？ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/td/so/bltdsone5ewlnnqa_aamnii9rl8.jpeg" alt="图片"></div><br> 我想通过一个特定的例子向您展示TDD如何提高代码质量。 <br> 因为我在研究该问题时遇到的所有东西都是理论上的。 <br> 碰巧，我碰巧写了两个几乎相同的应用程序：一个是用古典风格编写的，因为那时我不知道TDD，第二个是只使用TDD。 <br><br> 在下面，我将显示最大的差异在哪里。 <br><br> 就我个人而言，这对我很重要，因为每次有人在我的代码中发现错误时，我都会为自尊心而感到沮丧。 是的，我知道错误是正常现象，每个人都在编写，但是自卑感并没有消失。 另外，在服务的发展过程中，有时我意识到自己写了这样的书，以至于发痒地将所有内容扔掉并重新编写。 以及如何发生是不可理解的。 刚开始的时候一切都很好，但是经过一些功能之后，过了一会儿，您就不会眼泪汪汪。 尽管看起来变更的每一步都是合乎逻辑的。 我不喜欢自己工作的产品的感觉顺理成章地变成了程序员来自我的感觉，对不起，就像狗屎一样。 <br><br> 事实证明，我并不是唯一的一个，许多同事也有类似的感觉。 然后我决定要么学习正常的写作，要么就该改变职业了。 我尝试了测试驱动的开发，以尝试更改编程方法。 <br><br> 展望未来，基于几个项目的结果，我可以说TDD提供了一种更简洁的体系结构，但是却减慢了开发速度。 而且它并不总是合适，也不适合每个人。 <br><a name="habracut"></a><br><h1> 什么是TDD </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f39/01c/4ed/f3901c4ed2fee96d90b1a40fc30e9270.jpg" alt="图片"></div><br><br>  TDD-通过测试进行开发。  Wiki文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a> 。 <br> 经典方法是首先编写一个应用程序，然后用测试覆盖它。 <br><br>  TDD方法-首先我们为类编写测试，然后执行。 我们沿着抽象的层次前进-从最高层次到应用层次，同时将应用划分为类层，从中我们<b>订购</b>所需的行为，而无需特定的实现。 <br><br> 而且，如果我是第一次阅读本文，我也不会理解。 <br> 太多的抽象词：让我们看一个例子。 <br> 我们将用Java编写一个真正的spring应用程序，用TDD编写它，并且我将尝试在开发过程中展示我的思维过程，最后得出结论，是否有必要在TDD上花费时间。 <br><br><h1> 实际任务 </h1><br> 假设我们很幸运，能够掌握需要开发的东西。 通常，分析人员不会理会它，它看起来像这样： <br><br>  <i>有必要开发一种微服务，以计算出售商品并随后将其交付给客户的可能性。</i>  <i>有关此功能的信息必须发送到第三方DATA系统。</i> <br><br> 业务逻辑如下：符合以下条件的商品可出售并交货： <br><br><ul><li> 产品有现货 </li><li> 承包商（例如，DostavchenKO公司）有机会将其带给客户 </li><li> 产品颜色-不是蓝色（我们不喜欢蓝色） </li></ul><br> 通过http请求，我们的微服务将收到有关货架上商品数量变化的通知。 <br><br> 该通知是用于计算可用性的触发器。 <br><br> 另外，让生活似乎不再是甜蜜的： <br><br><ul><li> 用户应该能够手动禁用某些产品。 </li><li> 为了不向数据垃圾邮件，您只需要发送已更改产品的可用性数据。 </li></ul><br> 我们读了几次传统知识-走吧。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/10/xa/vc/10xavc46--r-thnqp--lbfzw4co.png"></div><br><br><h1> 整合测试 </h1><br> 在TDD中，您必须对编写的所有内容提出最重要的问题之一：“我想从...获得什么？” <br><br> 我们要问的第一个问题只是针对整个应用程序。 <br> 所以问题是： <br><br>  <i>我想从微服务中获得什么？</i> <br><br> 答案是： <br><br> 其实很多事情。 即使是这样简单的逻辑也提供了很多选项，尝试编写这些选项，甚至为所有这些选项创建测试甚至是不可能的任务。 因此，为了在应用程序级别回答问题，我们将仅选择主要的测试用例。 <br><br> 也就是说，我们假设所有输入数据都是有效格式，第三方系统正常响应，并且以前没有有关该产品的信息。 <br><br>  <i>所以，我想：</i> <br><br><ul><li> 一个事件到了，架子上没有产品。 通知无法交付。 </li><li> 发生了黄色产品有现货的事件，DostavchenKO准备接收它。 通知有关商品的可用性。 </li><li> 连续出现两条消息-商店中的商品数量均为正。 仅发送了一封邮件。 </li><li> 收到两个消息：第一个消息在商店中有一种产品，第二个消息-它不再存在。 我们发送两条消息：首先-可用，然后-否。 </li><li> 我可以手动禁用产品，并且不再发送通知。 </li><li>  ... </li></ul><br> 这里的主要目的是及时停止：正如我已经写过的，选择太多了，在这里描述所有这些选择是没有意义的-仅是最基本的选择。 将来，当我们编写业务逻辑测试时，它们的组合很可能涵盖我们在此处提出的所有内容。 这里的主要动机是确保如果这些测试通过，那么该应用程序将按我们的要求工作。 <br><br> 所有这些愿望清单我们现在将进行测试。 而且，由于这是应用程序级别的“愿望清单”，因此我们将通过提高spring上下文进行测试，即相当繁重。 <br> 不幸的是，对于许多TDD端来说，这是因为要编写这样的集成测试，您需要付出很多努力，而人们并不总是愿意花这些钱。 是的，这是最困难的一步，但是，相信我，在您完成之后，代码几乎会自行编写，并且您将确保您的应用程序能够按照您想要的方式运行。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/r2/hg/db/r2hgdbqezd8esoynflanwv-so8e.jpeg"></div><br> 在回答问题的过程中，您已经可以开始在生成的spring initializr类中编写代码了。 测试名称只是我们的愿望清单。 现在，只需创建空方法： <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyNotAvailableIfProductQuantityIsZero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyAvailableYellowProductIfPositiveQuantityAndDostavchenkoApproved</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyOnceOnSeveralEqualProductMessages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyFirstAvailableThenNotIfProductQuantityMovedFromPositiveToZero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">noNotificationOnDisabledProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{}</code> </pre> <br> 关于方法的命名：我强烈建议您使它们具有信息性，而不是test1（），test2（），因为稍后，当您忘记编写了什么类以及它负责什么类时，您将有机会代替尝试直接解析代码，只需打开测试并阅读该类满足的合同方法。 <br><br><h2> 开始填写测试 </h2><br> 主要思想是模拟外部所有内容，以检查内部正在发生的事情。 <br><br> 与我们的服务有关的“外部”不是微服务本身，而是与之直接通信的全部。 <br><br> 在这种情况下，外部是： <br><br><ul><li> 我们的服务将通知有关商品数量变化的系统 </li><li> 手动断开商品的客户 </li><li> 第三方DostavchenKO系统 </li></ul><br> 为了模拟前两个请求，我们使用了弹簧式的MockMvc。 <br> 为了模拟DostavchenKO，我们使用wiremock或MockRestServiceServer。 <br><br> 结果，我们的集成测试如下所示： <br><br><div class="spoiler">  <b class="spoiler_title">整合测试</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureMockMvc</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureWireMock</span></span>(port = <span class="hljs-number"><span class="hljs-number">8090</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TddExampleApplicationTests</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MockMvc mockMvc; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ WireMock.reset(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyNotAvailableIfProductQuantityIsZero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ stubNotification( <span class="hljs-comment"><span class="hljs-comment">// language=JSON "{\n" + " \"productId\": 111,\n" + " \"available\": false\n" + "}"); performQuantityUpdateRequest( // language=JSON "{\n" + " \"productId\": 111,\n" + " \"color\" : \"red\", \n" + " \"productQuantity\": 0\n" + "}"); verify(1, postRequestedFor(urlEqualTo("/notify"))); } @Test public void notifyAvailableYellowProductIfPositiveQuantityAndDostavchenkoApproved() throws Exception { stubDostavchenko("112"); stubNotification( // language=JSON "{\n" + " \"productId\": 112,\n" + " \"available\": true\n" + "}"); performQuantityUpdateRequest( // language=JSON "{\n" + " \"productId\": 112,\n" + " \"color\" : \"Yellow\", \n" + " \"productQuantity\": 10\n" + "}"); verify(1, postRequestedFor(urlEqualTo("/notify"))); } @Test public void notifyOnceOnSeveralEqualProductMessages() throws Exception { stubDostavchenko("113"); stubNotification( // language=JSON "{\n" + " \"productId\": 113,\n" + " \"available\": true\n" + "}"); for (int i = 0; i &lt; 5; i++) { performQuantityUpdateRequest( // language=JSON "{\n" + " \"productId\": 113,\n" + " \"color\" : \"Yellow\", \n" + " \"productQuantity\": 10\n" + "}"); } verify(1, postRequestedFor(urlEqualTo("/notify"))); } @Test public void notifyFirstAvailableThenNotIfProductQuantityMovedFromPositiveToZero() throws Exception { stubDostavchenko("114"); stubNotification( // language=JSON "{\n" + " \"productId\": 114,\n" + " \"available\": true\n" + "}"); performQuantityUpdateRequest( // language=JSON "{\n" + " \"productId\": 114,\n" + " \"color\" : \"Yellow\",\n" + " \"productQuantity\": 10\n" + "}"); stubNotification( // language=JSON "{\n" + " \"productId\": 114,\n" + " \"available\": false\n" + "}"); performQuantityUpdateRequest( // language=JSON "{\n" + " \"productId\": 114,\n" + " \"color\" : \"Yellow\",\n" + " \"productQuantity\": 0\n" + "}"); verify(2, postRequestedFor(urlEqualTo("/notify"))); } @Test public void noNotificationOnDisabledProduct() throws Exception { stubNotification( // language=JSON "{\n" + " \"productId\": 115,\n" + " \"available\": false\n" + "}"); disableProduct(115); for (int i = 0; i &lt; 5; i++) { performQuantityUpdateRequest( // language=JSON "{\n" + " \"productId\": 115,\n" + " \"color\" : \"Yellow\",\n" + " \"productQuantity\": " + i + "\n" + "}"); } verify(1, postRequestedFor(urlEqualTo("/notify"))); } private void disableProduct(int productId) throws Exception { mockMvc.perform( post("/disableProduct?productId=" + productId) ).andDo( print() ).andExpect( status().isOk() ); } private void performQuantityUpdateRequest(String content) throws Exception { mockMvc.perform( post("/product-quantity-update") .contentType(MediaType.APPLICATION_JSON) .content(content) ).andDo( print() ).andExpect( status().isOk() ); } private void stubNotification(String content) { stubFor(WireMock.post(urlEqualTo("/notify")) .withHeader("Content-Type", equalTo(MediaType.APPLICATION_JSON_UTF8_VALUE)) .withRequestBody(equalToJson(content)) .willReturn(aResponse().withStatus(HttpStatus.OK_200))); } private void stubDostavchenko(final String productId) { stubFor(get(urlEqualTo("/isDeliveryAvailable?productId=" + productId)) .willReturn(aResponse().withStatus(HttpStatus.OK_200).withBody("true"))); } }</span></span></code> </pre> </div></div><br><h1> 刚刚发生了什么？ </h1><br> 我们编写了一个集成测试，通过该测试可以根据主要的用户情况保证我们系统的可操作性。 在开始实施服务之前，我们做到了。 <br><br> 这种方法的优点之一是，在编写过程中，我不得不去<b>真正的</b> DostavchenKO，并从那里得到对我们对存根的<b>真实</b>请求的<b>真实</b>答案。 很好的是，我们在开发之初就照顾了这一点，而不是毕竟编写了代码。 事实证明，该格式不是TOR中指定的格式，或者该服务通常不可用，或其他原因。 <br><br> 我还要指出的是，我们不仅没有编写一行代码供以后使用，而且甚至没有对我们的微服务将如何安排在内部进行<b>单一</b>假设：将有多少层，是否存在？我们使用基础（如果使用的话），基础（哪一个）等。在编写测试时，我们从实现中抽象出来，并且，正如我们将在后面看到的，这可以提供许多体系结构上的优势。 <br><br> 与规范的TDD（在测试后立即编写实现）相反，集成测试不会花费很长时间。 实际上，直到开发结束，直到包括文件在内的所有内容都写完，它才会变成绿色。 <br> 我们走得更远。 <br><br><h1> 控制者 </h1><br> 在编写了集成测试之后，现在我们确信在完成任务之后，我们可以在晚上安然入睡，是时候开始对层进行编程了。 我们将实现的第一层是控制器。 为什么是他？ 因为这是程序的入口点。 我们需要从上到下，从与用户进行交互的第一层到最后一层。 <br> 这很重要。 <br><br> 再说一次，所有问题都始于相同的问题： <br><br>  <i>我想从控制器中得到什么？</i> <br><br> 答案是： <br><br> 我们知道控制器参与了与用户的交流，输入数据的验证和转换，并且不包含业务逻辑。 因此，此问题的答案可能是这样的： <br><br>  <i>我要：</i> <br><br><ul><li> 尝试断开具有无效ID的产品时，BAD_REQUEST返回给用户 </li><li>  BAD_REQUEST尝试使用无效ID通知商品更改时 </li><li> 尝试通知负数量时为BAD_REQUEST </li><li> 如果DostavchenKO不可用，则为INTERNAL_SERVER_ERROR </li><li>  INTERNAL_SERVER_ERROR，如果无法发送到DATA </li></ul><br> 由于我们希望对用户友好，因此对于上述所有项目，除了http代码外，您还需要显示一条描述问题的自定义消息，以便用户理解问题所在。 <br><br><ul><li>  200，如果处理成功 </li><li>  INTERNAL_SERVER_ERROR，在所有其他情况下均带有默认消息，以免影响堆栈 </li></ul><br> 在开始撰写TDD之前，我最后要考虑的是在某些特殊的情况（乍一看，不太可能出现的情况）下，系统将为用户带来什么。 我不认为有一个简单的原因-编写实现非常困难，为了考虑到所有极端情况，有时大脑中没有足够的RAM。 在完成书面实施后，仍然可以对一些您可能未事先考虑的内容进行分析，这仍然是一件很愉快的事情：我们都认为我们正在立即编写完美的代码。 虽然没有实现，但是没有必要考虑它，并且如果需要修改它也没有痛苦。 首先编写测试，您不必等到恒星汇聚之后，退出产品后，一定数量的系统将发生故障，并且客户将向您提出要求修复某些问题的要求。 这不仅适用于控制器。 <br><br><h2> 开始编写测试 </h2><br> 在前三个方面，一切都很清楚：我们使用spring验证，如果无效请求到达，则应用程序将引发异常，我们将在异常处理程序中捕获该异常。 就像他们所说的那样，一切都可以独立运行，但是控制器如何知道某些第三方系统不可用？ <br><br> 显然，控制器本身不应该对第三方系统一无所知，因为 询问什么系统以及什么是业务逻辑，即必须存在某种中介。 该中介是服务。 我们将使用此服务的模拟在控制器上编写测试，以模拟其在某些情况下的行为。 因此，该服务必须以某种方式通知控制器系统不可用。 您可以通过不同的方式来执行此操作，但这是引发自定义执行的最简单方法。 我们将为此控制器行为编写一个测试。 <br><br><div class="spoiler">  <b class="spoiler_title">测试与第三方DATA系统的通信错误</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@WebMvcTest</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureMockMvc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@MockBean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UpdateProcessorService updateProcessorService; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnServerErrorOnDataCommunicationError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ doThrow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataCommunicationException()).when(updateProcessorService).processUpdate(any(Update.class)); performUpdate( <span class="hljs-comment"><span class="hljs-comment">//language=JSON "{\n" + " \"productId\": 1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": 10\n" + "}" ).andDo( print() ).andExpect( status().isInternalServerError() ).andExpect( content().json("{\n" + " \"errors\": [\n" + " {\n" + " \"message\": \"Can't communicate with Data system\"\n" + " }\n" + " ]\n" + "}") ); } }</span></span></code> </pre><br></div></div><br> 在此阶段，自己出现了几件事： <br><br><ul><li> 一项服务将被注入到控制器中，并被委派处理新数量商品的传入消息。 </li><li> 此服务的方法及其签名将执行此处理。 </li><li> 当系统不可用时，该方法应引发自定义执行的实现。 </li><li> 此自定义执行本身。 </li></ul><br> 为什么要自己？ 如您所记得，因为我们尚未编写实现。 所有这些实体都出现在我们编写测试程序的过程中。 为了使编译器不会发誓，在实际代码中，我们将必须创建上述所有内容。 幸运的是，几乎所有的IDE都会帮助我们生成必要的实体。 因此，我们编写了一个测试-应用程序充满了类和方法。 <br><br> 总体而言，对控制器的测试如下： <br><br><div class="spoiler">  <b class="spoiler_title">测验</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@WebMvcTest</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureMockMvc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@InjectMocks</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Controller controller; <span class="hljs-meta"><span class="hljs-meta">@MockBean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UpdateProcessorService updateProcessorService; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MockMvc mvc; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnBadRequestOnDisableWithInvalidProductId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ mvc.perform( post(<span class="hljs-string"><span class="hljs-string">"/disableProduct?productId=-443"</span></span>) ).andDo( print() ).andExpect( status().isBadRequest() ).andExpect( content().json(getInvalidProductIdJsonContent()) ); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnBadRequestOnNotifyWithInvalidProductId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ performUpdate( <span class="hljs-comment"><span class="hljs-comment">//language=JSON "{\n" + " \"productId\": -1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": 0\n" + "}" ).andDo( print() ).andExpect( status().isBadRequest() ).andExpect( content().json(getInvalidProductIdJsonContent()) ); } @Test public void returnBadRequestOnNotifyWithNegativeProductQuantity() throws Exception { performUpdate( //language=JSON "{\n" + " \"productId\": 1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": -10\n" + "}" ).andDo( print() ).andExpect( status().isBadRequest() ).andExpect( content().json("{\n" + " \"errors\": [\n" + " {\n" + " \"message\": \"productQuantity is invalid\"\n" + " }\n" + " ]\n" + "}") ); } @Test public void returnServerErrorOnDostavchenkoCommunicationError() throws Exception { doThrow(new DostavchenkoException()).when(updateProcessorService).processUpdate(any(Update.class)); performUpdate( //language=JSON "{\n" + " \"productId\": 1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": 10\n" + "}" ).andDo( print() ).andExpect( status().isInternalServerError() ).andExpect( content().json("{\n" + " \"errors\": [\n" + " {\n" + " \"message\": \"DostavchenKO communication exception\"\n" + " }\n" + " ]\n" + "}") ); } @Test public void returnServerErrorOnDataCommunicationError() throws Exception { doThrow(new DataCommunicationException()).when(updateProcessorService).processUpdate(any(Update.class)); performUpdate( //language=JSON "{\n" + " \"productId\": 1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": 10\n" + "}" ).andDo( print() ).andExpect( status().isInternalServerError() ).andExpect( content().json("{\n" + " \"errors\": [\n" + " {\n" + " \"message\": \"Can't communicate with Data system\"\n" + " }\n" + " ]\n" + "}") ); } @Test public void return200OnSuccess() throws Exception { performUpdate( //language=JSON "{\n" + " \"productId\": 1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": 10\n" + "}" ).andDo( print() ).andExpect( status().isOk() ); } @Test public void returnServerErrorOnUnexpectedException() throws Exception { doThrow(new RuntimeException()).when(updateProcessorService).processUpdate(any(Update.class)); performUpdate( //language=JSON "{\n" + " \"productId\": 1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": 10\n" + "}" ).andDo( print() ).andExpect( status().isInternalServerError() ).andExpect( content().json("{\n" + " \"errors\": [\n" + " {\n" + " \"message\": \"Internal Server Error\"\n" + " }\n" + " ]\n" + "}") ); } @Test public void returnTwoErrorMessagesOnInvalidProductIdAndNegativeQuantity() throws Exception { performUpdate( //language=JSON "{\n" + " \"productId\": -1,\n" + " \"color\": \"red\",\n" + " \"productQuantity\": -10\n" + "}" ).andDo( print() ).andExpect( status().isBadRequest() ).andExpect( content().json("{\n" + " \"errors\": [\n" + " { \"message\": \"productQuantity is invalid\" },\n" + " { \"message\": \"productId is invalid\" }\n" + " ]\n" + "}") ); } private ResultActions performUpdate(String jsonContent) throws Exception { return mvc.perform( post("/product-quantity-update") .contentType(MediaType.APPLICATION_JSON_UTF8_VALUE) .content(jsonContent) ); } private String getInvalidProductIdJsonContent() { return //language=JSON "{\n" + " \"errors\": [\n" + " {\n" + " \"message\": \"productId is invalid\"\n" + " }\n" + " ]\n" + "}"; } }</span></span></code> </pre> </div></div><br> 现在，我们可以编写实现并确保所有测试成功通过： <br><div class="spoiler">  <b class="spoiler_title">实作</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@Validated</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UpdateProcessorService updateProcessorService; <span class="hljs-meta"><span class="hljs-meta">@PostMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/product-quantity-update"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateQuantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody @Valid Update update)</span></span></span><span class="hljs-function"> </span></span>{ updateProcessorService.processUpdate(update); } <span class="hljs-meta"><span class="hljs-meta">@PostMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/disableProduct"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disableProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestParam(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"productId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long productId) </span></span>{ updateProcessorService.disableProduct(Long.valueOf(productId)); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">异常处理程序</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ControllerAdvice</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationExceptionHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span>(ConstraintViolationException.class) <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(HttpStatus.BAD_REQUEST) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConstraintViolationException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConstraintViolationException exception)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"Constraint Violation"</span></span>, exception); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse(exception.getConstraintViolations().stream() .map(constraintViolation -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse.Message( ((PathImpl) constraintViolation.getPropertyPath()).getLeafNode().toString() + <span class="hljs-string"><span class="hljs-string">" is invalid"</span></span>)) .collect(Collectors.toList())); } <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span>(value = MethodArgumentNotValidException.class) <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(value = HttpStatus.BAD_REQUEST) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMethodArgumentNotValidException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodArgumentNotValidException exception)</span></span></span><span class="hljs-function"> </span></span>{ log.info(exception.getMessage()); List&lt;ErrorResponse.Message&gt; fieldErrors = exception.getBindingResult().getFieldErrors().stream() .map(fieldError -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse.Message(fieldError.getField() + <span class="hljs-string"><span class="hljs-string">" is invalid"</span></span>)) .collect(Collectors.toList()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse(fieldErrors); } <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span>(DostavchenkoException.class) <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(HttpStatus.INTERNAL_SERVER_ERROR) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDostavchenkoCommunicationException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DostavchenkoException exception)</span></span></span><span class="hljs-function"> </span></span>{ log.error(<span class="hljs-string"><span class="hljs-string">"DostavchenKO communication exception"</span></span>, exception); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse(Collections.singletonList( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse.Message(<span class="hljs-string"><span class="hljs-string">"DostavchenKO communication exception"</span></span>))); } <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span>(DataCommunicationException.class) <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(HttpStatus.INTERNAL_SERVER_ERROR) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataCommunicationException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataCommunicationException exception)</span></span></span><span class="hljs-function"> </span></span>{ log.error(<span class="hljs-string"><span class="hljs-string">"DostavchenKO communication exception"</span></span>, exception); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse(Collections.singletonList( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse.Message(<span class="hljs-string"><span class="hljs-string">"Can't communicate with Data system"</span></span>))); } <span class="hljs-meta"><span class="hljs-meta">@ExceptionHandler</span></span>(Exception.class) <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseStatus</span></span>(HttpStatus.INTERNAL_SERVER_ERROR) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ErrorResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Exception exception)</span></span></span><span class="hljs-function"> </span></span>{ log.error(<span class="hljs-string"><span class="hljs-string">"Error while processing"</span></span>, exception); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse(Collections.singletonList( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ErrorResponse.Message(HttpStatus.INTERNAL_SERVER_ERROR.getReasonPhrase()))); } }</code> </pre> <br></div></div><br><h1> 刚刚发生了什么？ </h1><br>  <b>在TDD中，您不必把所有代码都牢记在心。</b> <br><br> 再次让我们：不要将整个体系结构保留在RAM中。 只看一层。 他很简单。 <br><br> 在通常的过程中，大脑是不够的，因为有很多实现方法。 如果您是一位超级英雄，可以考虑到脑海中一个大型项目的所有细微差别，那么就不需要TDD。 我不知道 项目越大，我就越会误解。 <br><br> 意识到只需要了解下一层的需求后，便会得到启发。 事实是这种方法允许您不要做不必要的事情。 在这里，您正在和一个女孩聊天。 她谈到工作中的问题。 然后您想出解决方案的方法，绞尽脑汁。 她不需要解决，她只需要告诉。 就是这样。 她只是想分享一些东西。 在listen（）的第一阶段了解这一点是无价的。 对于其他一切……恩，你知道的。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qx/bk/fb/qxbkfb93hkn7folrvbn1pjd8hxm.png"></div><br><h1> 服务专区 </h1><br> 接下来，我们实现服务。 <br><br>  <i>我们要从服务中得到什么？</i> <br><br> 我们希望他处理业务逻辑，即： <br><br><ol><li> 他知道如何断开货物， <u>并且还收到有关</u>以下内容的<u>通知</u> ： </li><li> 如果产品没有断开连接，则有现货供应，产品颜色为黄色，DostavchenKO准备交付。 </li><li> 无法访问，如果没有任何可用的商品。 </li><li> 如果产品为蓝色，则无法访问。 </li><li> 如果DostavchenKO拒绝携带它，则无法进入。 </li><li> 如果手动断开货物，则无法进入。 </li><li> 接下来，如果任何系统都不可用，我们希望该服务引发执行。 </li><li> 另外，为了不对数据发送垃圾邮件，您需要组织惰性发送消息，即： </li><li> 如果我们过去曾经为商品发送可用商品，而现在我们已经计算了可用商品，那么我们什么也不发送。 </li><li> 如果以前不可用，但现在可用，我们将其发送。 </li><li> 你需要把它写下来 </li></ol><br>  <b>停！</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/if/ek/y1/ifeky128w2kgpc2gw2jcxwvzkia.jpeg"></div><br> 您不认为我们的服务开始做得太多了吗？ <br><br> 根据我们的心愿单判断，他知道如何关闭商品，并考虑了可访问性，并确保他不发送以前发送的消息。 这不是很高的凝聚力。 有必要将异构功能移到不同的类别中，因此应该已经有三项服务：一项将处理货物的断开连接，另一项将计算交付的可能性并将其传递给决定是否发送的服务。 顺便说一句，以这种方式，业务逻辑服务将不了解有关DATA系统的任何信息，这也是绝对的优势。 <br><br> 以我的经验，很多时候，全心投入到实现中，很容易忽略架构时刻。 如果我们立即编写服务，而不考虑它应该做什么，更重要的是，比不应该做，那么责任重叠的可能性将会增加。 我想以我自己的名义补充说，这是我在实际实践中遇到的示例，而TDD的结果与顺序编程方法之间的质的差异启发了我写这篇文章。 <br><br><h1> 业务逻辑 </h1><br> 考虑到业务逻辑服务与高内聚性一样的原因，我们知道我们需要在它与真实的DostavchenKO之间进行另一层抽象。 而且，由于我们<b>首先</b>设计服务，所以我们可以向DostavchenKO客户要求我们想要的内部合同。 在编写业务逻辑测试的过程中，我们将了解具有以下签名的客户的要求： <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAvailableForTransportation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long productId)</span></span></span><span class="hljs-function"> </span></span>{...}</code> </pre><br> 在服务级别上，真正的DostavchenKO如何回答与我们无关紧要：将来，客户的任务将以某种方式从他那里获取这些信息。 这可能很简单，但有时需要提出几个请求：此刻我们已经抽象了。 <br><br> 我们希望从处理断货的服务中获得类似的签名： <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isProductEnabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long productId)</span></span></span><span class="hljs-function"> </span></span>{...}</code> </pre><br> 因此，测试中记录的问题“我希望从业务逻辑服务中获得什么？”如下所示： <br><br><div class="spoiler">  <b class="spoiler_title">服务测试</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(MockitoJUnitRunner.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdateProcessorServiceTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@InjectMocks</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UpdateProcessorService updateProcessorService; <span class="hljs-meta"><span class="hljs-meta">@Mock</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ManualExclusionService manualExclusionService; <span class="hljs-meta"><span class="hljs-meta">@Mock</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DostavchenkoClient dostavchenkoClient; <span class="hljs-meta"><span class="hljs-meta">@Mock</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AvailabilityNotifier availabilityNotifier; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyAvailableIfYellowProductIsEnabledAndReadyForTransportation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Update testProduct = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Update(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-number"><span class="hljs-number">10L</span></span>, <span class="hljs-string"><span class="hljs-string">"Yellow"</span></span>); when(dostavchenkoClient.isAvailableForTransportation(testProduct.getProductId())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); updateProcessorService.processUpdate(testProduct); verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>))); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyNotAvailableIfProductIsAbsent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Update testProduct = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Update(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-number"><span class="hljs-number">0L</span></span>, <span class="hljs-string"><span class="hljs-string">"Yellow"</span></span>); updateProcessorService.processUpdate(testProduct); verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>))); verifyNoMoreInteractions(manualExclusionService); verifyNoMoreInteractions(dostavchenkoClient); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyNotAvailableIfProductIsBlue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Update testProduct = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Update(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-number"><span class="hljs-number">10L</span></span>, <span class="hljs-string"><span class="hljs-string">"Blue"</span></span>); updateProcessorService.processUpdate(testProduct); verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>))); verifyNoMoreInteractions(manualExclusionService); verifyNoMoreInteractions(dostavchenkoClient); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyNotAvailableIfProductIsDisabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Update testProduct = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Update(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-number"><span class="hljs-number">10L</span></span>, <span class="hljs-string"><span class="hljs-string">"Yellow"</span></span>); when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); updateProcessorService.processUpdate(testProduct); verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>))); verifyNoMoreInteractions(dostavchenkoClient); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyNotAvailableIfProductIsNotReadyForTransportation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Update testProduct = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Update(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-number"><span class="hljs-number">10L</span></span>, <span class="hljs-string"><span class="hljs-string">"Yellow"</span></span>); when(dostavchenkoClient.isAvailableForTransportation(testProduct.getProductId())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); updateProcessorService.processUpdate(testProduct); verify(availabilityNotifier, only()).notify(eq(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(testProduct.getProductId(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>))); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>(expected = DostavchenkoException.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">throwCustomExceptionIfDostavchenkoCommunicationFailed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Update testProduct = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Update(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-number"><span class="hljs-number">10L</span></span>, <span class="hljs-string"><span class="hljs-string">"Yellow"</span></span>); when(dostavchenkoClient.isAvailableForTransportation(testProduct.getProductId())) .thenThrow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RestClientException(<span class="hljs-string"><span class="hljs-string">"Something's wrong"</span></span>)); when(manualExclusionService.isProductEnabled(testProduct.getProductId())).thenReturn(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); updateProcessorService.processUpdate(testProduct); } }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在这个阶段，他们是自己出生的： </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DostavchenKO服务友好的客户 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 一种服务，在其中必须实现延迟发送的逻辑，所设计的服务将向其发送工作结果 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 断开货物的服务及其签名 </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 实现方式： </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实作</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UpdateProcessorService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AvailabilityNotifier availabilityNotifier; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DostavchenkoClient dostavchenkoClient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ManualExclusionService manualExclusionService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Update update)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (update.getProductQuantity() &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { availabilityNotifier.notify(getNotAvailableProduct(update.getProductId())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"Blue"</span></span>.equals(update.getColor())) { availabilityNotifier.notify(getNotAvailableProduct(update.getProductId())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!manualExclusionService.isProductEnabled(update.getProductId())) { availabilityNotifier.notify(getNotAvailableProduct(update.getProductId())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> availableForTransportation = dostavchenkoClient.isAvailableForTransportation(update.getProductId()); availabilityNotifier.notify(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(update.getProductId(), availableForTransportation)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { log.warn(<span class="hljs-string"><span class="hljs-string">"Problems communicating with DostavchenKO"</span></span>, exception); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DostavchenkoException(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ProductAvailability </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNotAvailableProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long productId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(productId, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } }</code> </pre><br></div></div><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 禁用产品 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在是不可避免的TDD阶段之一-重构的时候了。</font><font style="vertical-align: inherit;">如果您还记得，在执行控制器之后，服务合同将如下所示：</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disableProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> productId)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们决定将断开逻辑转移到单独的服务中。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个阶段，我们需要以下服务：</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 关闭商品的能力。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如果他较早断开连接，我们希望他退回货物已断开连接的信息。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如果以前没有断线，我们希望他退货。 </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 看一下愿望清单，这是业务逻辑服务与预期的服务之间的合同的直接结果，我想指出以下几点： </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，很明显，如果有人想关闭断开连接的产品，则应用程序可能会出现问题，因为目前此服务根本不知道该怎么做。</font><font style="vertical-align: inherit;">这就意味着也许值得与制定开发任务的分析师讨论这个问题。</font><font style="vertical-align: inherit;">我知道在这种情况下，应该在阅读ToR之后就出现了这个问题，但是我们正在设计一个相当简单的系统，在较大的项目中，这个问题可能并不那么明显。</font><font style="vertical-align: inherit;">而且，我们不知道我们会有一个实体仅负责断开商品的功能：我记得我们只是在开发过程中诞生的。</font></font></li><li> -,       .           —   ,         .  ,  , ,       ,      ,      , . . ProductAvailability.    ,      . . .,  ,   god object,    ,        ,      ,     TDD,          ,     .   ,  , «» —     : «    ...»     , ,  TDD,     . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 测试和实现非常简单： </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测验</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ManualExclusionServiceTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ManualExclusionService service; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ManualExclusionRepository manualExclusionRepository; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ manualExclusionRepository.deleteAll(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disableItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Long productId = <span class="hljs-number"><span class="hljs-number">100L</span></span>; service.disableProduct(productId); assertThat(service.isProductEnabled(productId), is(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnEnabledIfProductWasNotDisabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertThat(service.isProductEnabled(<span class="hljs-number"><span class="hljs-number">100L</span></span>), is(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)); assertThat(service.isProductEnabled(<span class="hljs-number"><span class="hljs-number">200L</span></span>), is(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)); } }</code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实作</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ManualExclusionService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ManualExclusionRepository manualExclusionRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isProductEnabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long productId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !manualExclusionRepository.exists(productId); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disableProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> productId)</span></span></span><span class="hljs-function"> </span></span>{ manualExclusionRepository.save(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ManualExclusion(productId)); } }</code> </pre><br></div></div><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 延迟提交服务 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，我们到达了最后一个服务，该服务将确保DATA系统不会被相同的消息发送垃圾邮件。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我提醒您，业务逻辑服务（即ProductAvailability对象）的工作结果已经转移到该对象中，其中只有两个字段：productId和isAvailable。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据良好的传统，我们开始考虑从此服务中获得什么：</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 无论如何都是第一次发送通知。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如果产品的可用性已更改，则发送通知。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如果没有，我们不发送任何东西。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如果发送到第三方系统以异常结束，则导致异常的通知不应包含在已发送通知的数据库中。 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 同样，从DATA端执行时，服务需要引发其DataCommunicationException。 </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里的一切都相对简单，但是我想指出一点：</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要有关我们之前发送的信息，这意味着我们将拥有一个存储库，我们将保存过去关于货物可用性的计算。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProductAvailability对象不适合保存，因为至少没有标识符，这意味着创建另一个标识符是合乎逻辑的。</font><font style="vertical-align: inherit;">这里的主要目的是不要吓跑，也不要将此标识符与@Document（我们将使用MongoDb作为基础）以及ProductAvailability本身的索引一起添加。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您需要了解，具有少数几个字段的ProductAvailability对象是在设计类的阶段创建的，这些类在调用层次结构中比我们现在正在设计的类更高。这些类不需要了解有关数据库特定字段的任何信息，因为在设计时不需要此信息。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但这就是全部。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有趣的是，由于我们已经编写了一系列测试，现在已经将其转移到服务中，并且具有ProductAvailability，因此向其中添加新字段将意味着还需要重构这些测试，这可能需要一些工作。</font><font style="vertical-align: inherit;">这意味着与立即编写实现相比，想要通过ProductAvailability制作上帝对象的人要少得多：相反，向现有对象添加字段比创建另一个类要容易。</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测验</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LazyAvailabilityNotifierTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LazyAvailabilityNotifier lazyAvailabilityNotifier; <span class="hljs-meta"><span class="hljs-meta">@MockBean</span></span> <span class="hljs-meta"><span class="hljs-meta">@Qualifier</span></span>(<span class="hljs-string"><span class="hljs-string">"dataClient"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AvailabilityNotifier availabilityNotifier; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AvailabilityRepository availabilityRepository; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ availabilityRepository.deleteAll(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyIfFirstTime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sendNotificationAndVerifyDataBase(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyIfAvailabilityChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ProductAvailability oldProductAvailability = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); sendNotificationAndVerifyDataBase(oldProductAvailability); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ProductAvailability newProductAvailability = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); sendNotificationAndVerifyDataBase(newProductAvailability); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doNotNotifyIfAvailabilityDoesNotChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ProductAvailability productAvailability = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); sendNotificationAndVerifyDataBase(productAvailability); sendNotificationAndVerifyDataBase(productAvailability); sendNotificationAndVerifyDataBase(productAvailability); sendNotificationAndVerifyDataBase(productAvailability); verify(availabilityNotifier, only()).notify(eq(productAvailability)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doNotSaveIfSentWithException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doThrow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException()).when(availabilityNotifier).notify(anyObject()); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> exceptionThrown = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { availabilityNotifier.notify(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (RuntimeException exception) { exceptionThrown = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } assertTrue(<span class="hljs-string"><span class="hljs-string">"Exception was not thrown"</span></span>, exceptionThrown); assertThat(availabilityRepository.findAll(), hasSize(<span class="hljs-number"><span class="hljs-number">0</span></span>)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>(expected = DataCommunicationException.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapDataException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doThrow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RestClientException(<span class="hljs-string"><span class="hljs-string">"Something wrong"</span></span>)).when(availabilityNotifier).notify(anyObject()); lazyAvailabilityNotifier.notify(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProductAvailability(<span class="hljs-number"><span class="hljs-number">1L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendNotificationAndVerifyDataBase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProductAvailability productAvailability)</span></span></span><span class="hljs-function"> </span></span>{ lazyAvailabilityNotifier.notify(productAvailability); verify(availabilityNotifier).notify(eq(productAvailability)); assertThat(availabilityRepository.findAll(), hasSize(<span class="hljs-number"><span class="hljs-number">1</span></span>)); assertThat(availabilityRepository.findAll().get(<span class="hljs-number"><span class="hljs-number">0</span></span>), hasProperty(<span class="hljs-string"><span class="hljs-string">"productId"</span></span>, is(productAvailability.getProductId()))); assertThat(availabilityRepository.findAll().get(<span class="hljs-number"><span class="hljs-number">0</span></span>), hasProperty(<span class="hljs-string"><span class="hljs-string">"availability"</span></span>, is(productAvailability.isAvailable()))); } }</code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实作</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LazyAvailabilityNotifier</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AvailabilityNotifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AvailabilityRepository availabilityRepository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AvailabilityNotifier availabilityNotifier; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProductAvailability productAvailability)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AvailabilityPersistenceObject persistedProductAvailability = availabilityRepository .findByProductId(productAvailability.getProductId()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (persistedProductAvailability == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { notifyWith(productAvailability); availabilityRepository.save(createObjectFromProductAvailability(productAvailability)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (persistedProductAvailability.isAvailability() != productAvailability.isAvailable()) { notifyWith(productAvailability); persistedProductAvailability.setAvailability(productAvailability.isAvailable()); availabilityRepository.save(persistedProductAvailability); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">notifyWith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProductAvailability productAvailability)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { availabilityNotifier.notify(productAvailability); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (RestClientException exception) { log.error(<span class="hljs-string"><span class="hljs-string">"Couldn't notify"</span></span>, exception); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataCommunicationException(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> AvailabilityPersistenceObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createObjectFromProductAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProductAvailability productAvailability)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AvailabilityPersistenceObject(productAvailability.getProductId(), productAvailability.isAvailable()); } }</code> </pre> <br></div></div><br><h1> 结论 </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eq/cq/u-/eqcqu-xh6fu5mybs440rhhfob-g.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实践中必须编写类似的应用程序。结果发现，起初它是在没有TDD的情况下编写的，然后业务部门表示没有必要，并且六个月后需求发生了变化，因此决定从头开始再次重写它（好处是微服务体系结构，扔掉东西并不那么可怕）。 。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用不同的技术编写相同的应用程序，我可以体会到它们之间的差异。在我的实践中，我看到了TDD如何更正确地构建体系结构。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我可以假设这样做的原因不是在实现之前创建测试，而是在开始编写测试之后，我们首先考虑创建的类将要做什么。同样，虽然没有实现，但是我们可以真正地在被调用的对象中“排序”调用它们的对象所需的确切合同，而不必急于在某处快速添加内容并获得可以同时处理许多任务的实体。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另外，作为我自己的TDD的主要优势之一，我可以强调一点，就是我对自己生产的产品变得更加自信。这可能是由于以下事实：测试中可以更好地覆盖用TDD编写的平均代码，但是在我开始用TDD编写之后，我对代码的编辑次数减少了其测试几乎为零。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总的来说，我觉得作为一名开发人员我会变得更好。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序代码可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到</font><font style="vertical-align: inherit;">。对于那些想逐步了解它的创建方式的人，我建议关注提交的历史，在分析了这些历史之后，我希望创建一个典型的TDD应用程序的过程会更容易理解。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个非常有用的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我强烈建议向想加入TDD世界的人们观看</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">该视频</font></a><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序代码重用了像json这样的格式化字符串。</font><font style="vertical-align: inherit;">这对于检查应用程序如何解析POJO对象上的json是必需的。</font><font style="vertical-align: inherit;">如果您使用IDEA，那么使用JSON语言注入即可快速而轻松地完成必要的格式化。</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 这种方法有什么缺点？ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发展很长一段时间。我的同事使用标准范例进行编程，可以负担起将服务提供给测试人员进行测试的目的，而这些测试根本不需要进行测试，并且一路添加进来。非常快。在TDD上，这将不起作用。如果您的截止日期很紧，那么您的经理将不满意。在这里，要立即做得不错，但时间长了又不是很好，而是很快。我为自己选择第一个，因为第二个会更长。并大胆地。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据我的感觉，TDD不适合您需要进行大量重构的情况：因为与从头创建的应用程序不同，不清楚哪种方法以及首先要做什么。事实证明您正在进行类测试，因此将其删除。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDD不是灵丹妙药。</font><font style="vertical-align: inherit;">这是一个关于清晰可读的代码的故事，该代码可能会导致性能问题。</font><font style="vertical-align: inherit;">例如，您创建了N个类，就像在Fowler中一样，每个类都做自己的事情。</font><font style="vertical-align: inherit;">然后事实证明，为了做好工作，他们需要每个人都去基地。</font><font style="vertical-align: inherit;">您将在数据库中有N个查询。</font><font style="vertical-align: inherit;">而不是制作例如1个神物并走1次。</font><font style="vertical-align: inherit;">如果您争夺毫秒数，那么使用TDD时需要考虑到这一点：可读代码并不总是最快的。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，切换到这种方法非常困难-您需要教自己换个角度思考。</font><font style="vertical-align: inherit;">大部分痛苦是在第一阶段。</font><font style="vertical-align: inherit;">我写了1.5天的第一次集成测试。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好吧，最后。</font><font style="vertical-align: inherit;">如果您使用TDD而您的代码</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然不是很</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么问题可能不在方法论中。</font><font style="vertical-align: inherit;">但这对我有所帮助。</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/je/ix/2n/jeix2nwpo0ui_ehjeisprshkrvk.jpeg"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN456662/">https://habr.com/ru/post/zh-CN456662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN456650/index.html">选择预算袖珍示波器</a></li>
<li><a href="../zh-CN456652/index.html">时间不等了：比Windows 10时间线对犯罪分子有用</a></li>
<li><a href="../zh-CN456654/index.html">没有那么可怕的ERP项目</a></li>
<li><a href="../zh-CN456656/index.html">SDL 2课：第4课-拉伸PNG</a></li>
<li><a href="../zh-CN456658/index.html">成长：我们如何评估团队技能</a></li>
<li><a href="../zh-CN456664/index.html">机器人赔钱时该向谁起诉</a></li>
<li><a href="../zh-CN456666/index.html">Web图腾或我们如何使互联网更安全</a></li>
<li><a href="../zh-CN456668/index.html">Microsoft ML Spark：Spark扩展，使SparkML更人性化，LightGBM作为奖励</a></li>
<li><a href="../zh-CN456670/index.html">关于非常间谍身份验证方法</a></li>
<li><a href="../zh-CN456672/index.html">Nginx配方：从PostgreSQL到websocket的异步通知</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>