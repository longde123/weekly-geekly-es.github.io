<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõåüèø üé≤ üñ§ Experimenta 2 millones de sesiones sin cabeza üíØ üëèüèº üë®üèø‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publicado el 4 de junio de 2018 en el blog corporativo sin navegador. 

 ¬°Nos complace anunciar que recientemente hemos cruzado la l√≠nea de dos millon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experimenta 2 millones de sesiones sin cabeza</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413547/">  <font color="gray">Publicado el 4 de junio de 2018 en el blog corporativo sin navegador.</font> <br><br>  ¬°Nos complace anunciar que recientemente hemos cruzado la l√≠nea de <b>dos millones de sesiones atendidas</b> !  Estos son <i>millones de</i> capturas <i>de</i> pantalla generadas, PDF impresos y sitios probados.  Hemos hecho casi todo lo que se te ocurre hacer con un navegador sin cabeza. <br><br>  Aunque es bueno lograr tal hito, en el camino hubo claramente <i>muchas</i> superposiciones y problemas.  Debido a la gran cantidad de tr√°fico recibido, me gustar√≠a dar un paso atr√°s y establecer recomendaciones generales para lanzar navegadores sin cabeza (y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">titiriteros</a> ) en producci√≥n. <br><br>  Aqu√≠ hay algunos consejos. <br><a name="habracut"></a><br><h1>  1. No utilice un navegador sin cabeza en absoluto </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/cae/85f/438/cae85f438e0037a0f87f1ae6619cfc33.png"><br><br><h3>  Consumo de recursos de Chrome sin cabeza </h3><br>  De ninguna manera, si es posible, <i>no inicie el navegador en modo sin cabeza</i> .  Especialmente en la misma infraestructura que su aplicaci√≥n (ver arriba).  El navegador sin cabeza es impredecible, glot√≥n y se reproduce como el Sr. Misix de Rick y Morty.  Casi todo lo que puede hacer un navegador (excepto interpolar y ejecutar JavaScript) se puede hacer usando herramientas simples de Linux.  Las bibliotecas Cheerio y otras ofrecen una elegante API Node para recuperar datos con solicitudes HTTP y scraping, si ese es su objetivo. <br><br>  Por ejemplo, puede tomar una p√°gina (suponiendo que sea alg√∫n tipo de HTML) y desecharla con comandos simples como estos: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cheerio <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'cheerio'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fetch <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'node-fetch'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(url); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> html = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> res.test(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $ = cheerio.load(html); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $(<span class="hljs-string"><span class="hljs-string">'buy-now.price'</span></span>).text(); } getPrice(<span class="hljs-string"><span class="hljs-string">'https://my-cool-website.com/'</span></span>);</code> </pre> <br>  Obviamente, el script no cubre todos los casos de uso, y si lee este art√≠culo, lo m√°s probable es <i>que</i> tenga <i>que</i> usar un navegador sin cabeza.  Entonces comencemos. <br><br><h1>  2. No inicie un navegador sin cabeza innecesariamente </h1><br>  Hemos encontrado numerosos usuarios que intentan mantener el navegador funcionando incluso si no est√° en uso (con conexiones abiertas).  Aunque esta puede ser una buena estrategia para acelerar una sesi√≥n, se bloquear√° en unas pocas horas.  Principalmente porque a los navegadores les <i>gusta</i> almacenar <i>en</i> cach√© todo en una fila y gradualmente consumen memoria.  Tan pronto como deje de usar el navegador intensivamente, ¬°ci√©rrelo de inmediato! <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> puppeteer.launch(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> page = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> browser.newPage(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://www.example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// More stuff ...page.click() page.type() browser.close(); // &lt;- Always do this! }</span></span></code> </pre> <br>  En sin navegador, generalmente corregimos este error para los usuarios, siempre configuramos alg√∫n tipo de temporizador para la sesi√≥n y cerramos el navegador cuando WebSocket est√° desconectado.  Pero si no utiliza nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">servicio</a> o la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">imagen Docker de respaldo</a> , aseg√∫rese de cerrar <i>autom√°ticamente</i> el navegador, ya que ser√° desagradable cuando todo caiga en medio de la noche. <br><br><h1>  3. Tu p√°gina de amigo. <code>page.evaluate</code> </h1><br><blockquote>  Tenga cuidado con los transpiladores como babel o mecanografiado, porque les gusta crear funciones auxiliares y asumir que son accesibles con cierres.  Es decir, la devoluci√≥n de llamada .evaluate <i>puede no</i> funcionar correctamente. </blockquote><br>  Puppeteer tiene muchos m√©todos interesantes, como almacenar selectores DOM y otras cosas en un entorno Node.  Aunque es muy conveniente, puede dispararse f√°cilmente en el pie si algo en la p√°gina obliga a este nodo DOM a <i>mutar</i> .  Puede que esto no sea tan bueno, pero en realidad es mejor hacer todo el trabajo en el lado <i>del navegador en el contexto del navegador</i> .  Esto generalmente significa cargar <code>page.evaulate</code> para todo el trabajo que debe hacerse. <br><br>  Por ejemplo, en lugar de algo como esto ( <i>tres</i> acciones as√≠ncronas): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.$(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> link = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.getProperty(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.click(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> link;</code> </pre> <br>  Es mejor hacer esto (una acci√≥n asincr√≥nica): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.evaluate(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = $anchor.href; $anchor.click(); });</code> </pre> <br>  Otra ventaja de las acciones de ajuste en una llamada de <code>evaluate</code> es la portabilidad: este c√≥digo se puede ejecutar en un navegador para verificar en lugar de intentar reescribir el c√≥digo de Nodo.  Por supuesto, siempre se recomienda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usar un depurador</a> para reducir el tiempo de desarrollo. <br><br>  Una regla general simple es contar el n√∫mero de <code>await</code> o <code>then</code> en el c√≥digo.  Si hay m√°s de uno, entonces probablemente sea mejor ejecutar el c√≥digo dentro de la <code>page.evaluate</code> . <code>page.evaluate</code> llamada.  La raz√≥n es que todas las acciones as√≠ncronas van y vienen entre el Nount Runtime y el navegador, lo que significa una serializaci√≥n y deserializaci√≥n JSON constante.  Aunque no hay una gran cantidad de an√°lisis (porque todo es compatible con WebSockets), todav√≠a lleva tiempo, que es mejor gastar en otra cosa. <br><br><h1>  4. Paralelo a los navegadores, no a las p√°ginas web </h1><br>  Entonces, nos dimos cuenta de que iniciar un navegador no es bueno y que debemos hacerlo solo en caso de emergencia.  El siguiente consejo es ejecutar solo una sesi√≥n por navegador.  Aunque en realidad es posible ahorrar recursos paralelizando el trabajo a trav√©s de las <code>pages</code> , pero si una p√°gina cae, puede bloquear todo el navegador.  Adem√°s, no se garantiza que cada p√°gina est√© perfectamente limpia (las cookies y el almacenamiento pueden convertirse en un dolor de cabeza, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">como vemos</a> ). <br><br>  En cambio: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Launch one browser and capture the promise const launch = puppeteer.launch(); const runJob = async (url) { // Re-use the browser here const browser = await launch; const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Mejor haz esto: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> runJob = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (url) { <span class="hljs-comment"><span class="hljs-comment">// Launch a clean browser for every "job" const browser = puppeteer.launch(); const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Cada nueva instancia del navegador obtiene un <code>--user-data-dir</code> limpio (a <a href="">menos que se indique lo contrario</a> ).  Es decir, se procesa completamente como una nueva sesi√≥n nueva.  Si Chrome falla por alg√∫n motivo, no arrastrar√° otras sesiones con √©l. <br><br><h1>  5. Limitaci√≥n de colas y concurrencia </h1><br>  Una de las caracter√≠sticas principales de sin navegador es la capacidad de limitar claramente la paralelizaci√≥n y la cola.  Por lo tanto, las aplicaciones cliente solo ejecutan <code>puppeteer.connect</code> , pero no piensan en la implementaci√≥n de la cola.  Esto evita una gran cantidad de problemas, principalmente con instancias concurrentes de Chrome que engullen todos los recursos disponibles de su aplicaci√≥n. <br><br>  La mejor y m√°s f√°cil es tomar nuestra imagen Docker y ejecutarla con los par√°metros necesarios: <br><br><pre> <code class="hljs pgsql"># Pull <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Puppeteer@<span class="hljs-number"><span class="hljs-number">1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> support $ docker pull browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> $ docker run -e "MAX_CONCURRENT_SESSIONS=10" browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  Esto limita el n√∫mero de solicitudes simult√°neas a diez (incluidas las sesiones de depuraci√≥n y m√°s).  La cola est√° configurada por la variable <code>MAX_QUEUE_LENGTH</code> .  Por lo general, puede realizar aproximadamente 10 solicitudes simult√°neas por gigabyte de memoria.  El porcentaje de utilizaci√≥n de la CPU puede variar para diferentes tareas, pero b√°sicamente necesitar√° mucha y mucha RAM. <br><br><h1>  6. No te olvides de <code>page.waitForNavigation</code> </h1><br>  Uno de los problemas m√°s comunes que hemos encontrado son las acciones que comienzan a cargar p√°ginas con la posterior terminaci√≥n repentina de los scripts.  Esto se debe a que las acciones que desencadenan la <code>pageload</code> menudo provocan la degluci√≥n del trabajo posterior.  Para solucionar el problema, generalmente debe llamar a la acci√≥n de carga de la p√°gina e inmediatamente despu√©s de esperar la carga. <br><br>  Por ejemplo, tal <code>console.log</code> no funciona en un solo lugar ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">vea la demostraci√≥n</a> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Pero <i>funciona</i> en otro ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">ver demo</a> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.waitForNavigation(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Puede leer m√°s sobre waitForNavigation <a href="">aqu√≠</a> .  Esta funci√≥n tiene aproximadamente los mismos par√°metros de interfaz que <code>page.goto</code> , pero solo con la parte "esperar". <br><br><h1>  7. Use Docker para todo lo que necesita. </h1><br>  Chrome necesita muchas dependencias para funcionar correctamente.  Realmente mucho  Incluso despu√©s de instalar todo, debe preocuparse por cosas como las fuentes y los procesos fantasmas.  Por lo tanto, es ideal usar alg√∫n tipo de contenedor para poner todo all√≠.  Docker est√° dise√±ado espec√≠ficamente para esta tarea, ya que puede limitar la cantidad de recursos disponibles y aislarla.  Si desea crear su propio <code>Dockerfile</code> , marque a continuaci√≥n todas las dependencias necesarias: <br><br><pre> <code class="hljs tex"># Dependencies needed for packages downstream RUN apt-get update &amp;&amp; apt-get install -y <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>unzip <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fontconfig <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>locales <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>gconf-service <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libasound2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libatk1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libc6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcairo2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcups2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libdbus-1-3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libexpat1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libfontconfig1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgcc1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgconf-2-4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgdk-pixbuf2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libglib2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgtk-3-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnspr4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpango-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpangocairo-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libstdc++6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-xcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcomposite1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcursor1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxdamage1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxext6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxfixes3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxi6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrandr2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrender1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxss1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxtst6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>ca-certificates <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fonts-liberation <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libappindicator1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnss3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>lsb-release <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>xdg-utils <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>wget</code> </pre> <br>  Y para evitar procesos zombies (algo com√∫n en Chrome), es mejor usar algo como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dumb-init</a> para ejecutarse correctamente: <br><br><pre> <code class="hljs powershell">ADD https://github.com/Yelp/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span>/releases/download/v1.<span class="hljs-number"><span class="hljs-number">2.0</span></span>/dumb<span class="hljs-literal"><span class="hljs-literal">-init_1</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span>_amd64 /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span> RUN chmod +x /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span></code> </pre> <br>  Si desea saber m√°s, eche un vistazo a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro Dockerfile</a> . <br><br><h1>  8. Recuerda dos tiempos de ejecuci√≥n diferentes. </h1><br>  Es √∫til recordar que hay <i>dos</i> tiempos de ejecuci√≥n de JavaScript (Nodo y navegador).  Esto es excelente para separar tareas, pero inevitablemente se produce confusi√≥n porque algunos m√©todos requerir√°n pasar enlaces expl√≠citos en lugar de alojamientos. <br><br>  Por ejemplo, tome <code>page.evaluate</code> .  En las profundidades del protocolo hay una <a href="">cadena <i>literal</i> de la funci√≥n y su transferencia a Chrome</a> .  Por lo tanto, cosas como cierres y ascensores <i>no funcionar√°n en absoluto</i> .  Si necesita pasar algunas referencias o valores a la llamada de evaluaci√≥n, simplemente agr√©guelos como argumentos que se procesar√°n correctamente. <br><br>  Por lo tanto, en lugar de hacer referencia al <code>selector</code> trav√©s de cierres: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// `selector` here is `undefined` since we're in the browser context const clicked = await page.evaluate(() =&gt; document.querySelector(anchor).click());</span></span></code> </pre> <br>  Mejor par√°metro de paso: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Here we add a `selector` arg and pass in the reference in `evaluate` const clicked = await page.evaluate((selector) =&gt; document.querySelector(selector).click(), anchor);</span></span></code> </pre> <br>  <code>page.evaluate</code> agregar uno o m√°s argumentos a la funci√≥n <code>page.evaluate</code> , ya que aqu√≠ es variable.  ¬°Aseg√∫rate de aprovechar esto! <br><br><h1>  El futuro </h1><br>  Somos incre√≠blemente optimistas sobre el futuro de los navegadores sin cabeza y toda la automatizaci√≥n que pueden lograr.  Usando herramientas poderosas como titiriteros y sin navegador, esperamos que la depuraci√≥n y ejecuci√≥n de la automatizaci√≥n sin cabeza en la producci√≥n sea m√°s f√°cil y r√°pida.  ¬°Pronto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzaremos la facturaci√≥n de pago por uso para cuentas</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funciones</a> que lo ayudar√°n a enfrentar mejor su trabajo sin cabeza! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413547/">https://habr.com/ru/post/es413547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413529/index.html">¬øPor qu√© los nuevos dispositivos i-SENSYS pueden llamarse revolucionarios?</a></li>
<li><a href="../es413531/index.html">El libro "Unidad para el desarrollador. Juegos m√≥viles multiplataforma ¬ª</a></li>
<li><a href="../es413539/index.html">Un controlador simple basado en l√≥gica difusa. Creaci√≥n y personalizaci√≥n.</a></li>
<li><a href="../es413543/index.html">Angular cli 6: por qu√© lo necesitas y c√≥mo usarlo</a></li>
<li><a href="../es413545/index.html">Humor en la marca: por qu√© no siempre es bueno</a></li>
<li><a href="../es413549/index.html">Curso de conferencia sobre desarrollo web</a></li>
<li><a href="../es413551/index.html">Desplazamiento y atenci√≥n (estudio 2018)</a></li>
<li><a href="../es413553/index.html">El registrador REG.RU priv√≥ al socio del acceso a 70 mil dominios y tom√≥ su servicio para s√≠ mismo</a></li>
<li><a href="../es413555/index.html">Interoperabilidad segura en sistemas distribuidos</a></li>
<li><a href="../es413557/index.html">NewSQL: SQL no va a ninguna parte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>