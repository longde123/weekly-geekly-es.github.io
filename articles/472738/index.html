<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëµ üë©üèª‚Äçüíª üôÜüèø C√≥mo actualizar un proyecto existente de ASP.NET MVC a ASP.NET Core. Gu√≠a pr√°ctica ‚è∏Ô∏è üßõüèΩ üå≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta publicaci√≥n naci√≥ de nuestra experiencia al migrar un proyecto existente de ASP.NET MVC a ASP.NET Core. Intentamos reunir todo el proceso de migr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo actualizar un proyecto existente de ASP.NET MVC a ASP.NET Core. Gu√≠a pr√°ctica</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472738/">  Esta publicaci√≥n naci√≥ de nuestra experiencia al migrar un proyecto existente de ASP.NET MVC a ASP.NET Core.  Intentamos reunir todo el proceso de migraci√≥n en una forma estructurada y describir los diversos cuellos de botella para que los desarrolladores puedan seguir confiando en este material y seguir la hoja de ruta para resolver tales problemas. <br><br>  Algunas palabras sobre nuestro proyecto.  Somos una plataforma de comercio electr√≥nico de c√≥digo abierto en ASP.NET, que en el momento de la transferencia ya hab√≠a existido con √©xito durante 9 a√±os.  Hicimos la migraci√≥n hace 2 a√±os, pero nuestras manos llegaron a escribir sobre eso solo ahora.  En ese momento, fuimos uno de los primeros proyectos importantes que decidieron tal paso. <br><br><h2>  ¬øPor qu√© cambiar a ASP.NET Core? </h2><br>  Antes de continuar con los pasos para migrar de ASP.NET MVC a ASP.NET Core, algunas palabras sobre los beneficios de esta plataforma. <br><br><img src="https://habrastorage.org/webt/wo/xg/ue/woxgueorhrjz_brki1qktunkqhe.png"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Beneficios de ASP.NET Core</b> <div class="spoiler_text"> Entonces, ASP.NET Core ya es un marco bastante conocido y desarrollado, que ya ha sufrido varias actualizaciones importantes, lo que significa que hoy es bastante estable, tecnol√≥gicamente avanzado y resistente a los ataques XSRF / CSRF. <br><br>  <b>La multiplataforma</b> es una de las caracter√≠sticas que le permiten ganar m√°s y m√°s popularidad.  A partir de ahora, su aplicaci√≥n web puede ejecutarse en entornos Windows y Unix. <br><br>  <b>Modularidad</b> : ASP.NET Core viene completamente en forma de paquetes NuGet, esto le permite optimizar la aplicaci√≥n, incluidos los paquetes necesarios seleccionados.  Esto mejora el rendimiento de la soluci√≥n y reduce el tiempo que lleva actualizar las piezas individuales.  Esta es la segunda caracter√≠stica importante que permite a los desarrolladores integrar de manera m√°s flexible nuevas caracter√≠sticas en su soluci√≥n. <br><br>  <b>El rendimiento</b> es otro paso hacia la creaci√≥n de una aplicaci√≥n de alto rendimiento, ASP.NET Core procesa un 2300% m√°s de solicitudes por segundo que ASP.NET 4.6, y un 800% m√°s de solicitudes por segundo que node.js.  Puede examinar pruebas de rendimiento detalladas usted mismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><img src="https://habrastorage.org/webt/wb/vg/oi/wbvgoixwdbcfr0m8l0myjywrlpq.png"><br><br>  <b>Middleware</b> es la nueva tuber√≠a modular ligera de alto rendimiento para solicitudes en la aplicaci√≥n.  Cada pieza de middleware procesa una solicitud HTTP y luego decide devolver el resultado o pasa la siguiente pieza de middleware.  Este enfoque le da al desarrollador un control completo sobre la tuber√≠a HTTP y contribuye al desarrollo de m√≥dulos simples para la aplicaci√≥n, lo cual es importante para un proyecto de c√≥digo abierto en crecimiento. <br><br>  ASP.NET Core MVC proporciona caracter√≠sticas que simplifican el desarrollo web.  NopCommerce ya usaba caracter√≠sticas como la plantilla Modelo-Vista-Controlador, la sintaxis de Razor, el enlace y la validaci√≥n del modelo, pero aparecieron nuevas herramientas: <br><br><ul><li>  Ayudantes de etiqueta.  Este es un c√≥digo del lado del servidor para contribuir a la creaci√≥n y representaci√≥n de elementos HTML en archivos Razor. </li><li>  Ver componentes.  Esta es una herramienta nueva, similar a las vistas parciales, pero mucho m√°s poderosa.  nopCommerce utiliza componentes de vista cuando se requiere reutilizar la l√≥gica de representaci√≥n y cuando la tarea es demasiado compleja para una vista parcial. </li><li>  La opini√≥n de DI.  Aunque la mayor√≠a de los datos que se muestran en las vistas pasan del controlador, nopCommerce tiene vistas en las que la inyecci√≥n de dependencias es m√°s conveniente. </li></ul><br>  Por supuesto, ASP.NET Core tiene muchas m√°s funciones, pero acabamos de examinar las m√°s interesantes. </div></div><br>  Ahora hablemos sobre lo que debe considerar al portar su aplicaci√≥n a una nueva plataforma. <br><br><h2>  La migracion </h2><br>  El texto contendr√° una gran cantidad de enlaces a la documentaci√≥n oficial de ASP.NET Core para ayudar a obtener informaci√≥n m√°s detallada sobre el tema.  Especialmente relevante para los desarrolladores que se enfrentan a una tarea similar por primera vez. <br><br><h3>  Paso 1. Preparaci√≥n de herramientas. </h3><br>  Lo primero que debe hacer es actualizar Visual Studio 2017 a la versi√≥n 15.3 o superior.  E instale la √∫ltima versi√≥n del SDK de .NET Core. <br><br>  Antes de comenzar la migraci√≥n, se recomienda que utilice la herramienta de an√°lisis de portabilidad .NET <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.Net Portability Analyzer</a> .  Este es un buen punto de partida para comprender cu√°n laboriosa ser√° la transici√≥n de una plataforma a otra.  Pero, por supuesto, esta herramienta no resuelve todos los problemas, y en el proceso habr√° muchas trampas.  A continuaci√≥n, se describir√°n las etapas principales que deber√°n superarse y se mostrar√°n las soluciones utilizadas en nuestro proyecto. <br><br>  Lo primero que necesita es actualizar los enlaces a las bibliotecas utilizadas en el proyecto que admitir√≠an .NET Standard. <br><br><h3>  Paso 2. An√°lisis de compatibilidad de paquetes NuGet para soportar .Net Standard </h3><br>  Si usa paquetes NuGet en su proyecto, debe verificar si son compatibles con .NET Core.  Una forma de hacerlo es utilizar la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NuGetPackageExplorer</a> . <br><br><h3>  Paso 3. .NET Core usa el nuevo formato de archivo csproj </h3><br>  Es importante utilizar el nuevo enfoque para agregar enlaces de terceros introducidos en .NET Core: cuando se agrega una nueva biblioteca de clases a la soluci√≥n, debe abrir el archivo principal del proyecto y reemplazar su contenido con lo siguiente: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sdk</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.NET.Sdk"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span>netcoreapp2.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.AspNetCore.App"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.2.6"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Los enlaces de las bibliotecas conectadas se descargar√°n autom√°ticamente.  Puede encontrar m√°s informaci√≥n sobre el mapeo entre las propiedades project.json y CSPROJ en la documentaci√≥n oficial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h3>  Paso 4. Actualizando el espacio de nombres </h3><br>  Debe eliminar todos los usos de System.Web y reemplazarlos con Microsoft.AspNetCore. <br><br><h3>  Paso 5. Debe configurar el archivo Startup.cs.  en lugar de usar global.asax </h3><br>  ASP.NET Core tiene un nuevo mecanismo para cargar la aplicaci√≥n.  El punto de entrada a la aplicaci√≥n se convierte en <code>Startup</code> y la dependencia del archivo <i>Global.asax</i> desaparece.  <code>Startup</code> registra la suite de middleware en la aplicaci√≥n.  <code>Startup</code> debe incluir el m√©todo <code>Configure</code> .  En <code>Configure</code> agregue el middleware requerido a la tuber√≠a. <br><br>  <b>Problemas de Startup.cs</b> <br><br><ol><li>  Configuraci√≥n de middleware para solicitudes MVC y WebAPI </li><li>  Opciones de configuraci√≥n para: </li></ol><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Manejo de excepciones</a> <br><p>  Como en el proceso de transici√≥n, inevitablemente tendr√° que lidiar con varios tipos de colisiones, debe preparar y configurar de inmediato el manejo de excepciones en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">entorno de</a> Desarrollo.  Usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UseDeveloperExceptionPage</a> , se agrega middleware para capturar excepciones. </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enrutamiento MVC</a> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El registro de nuevas rutas</a> tambi√©n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ha</a> sido modificado.  IRouteBuilder ahora se usa en lugar de RouteCollection, una nueva forma de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">registrar restricciones</a> (IActionConstraint) </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Filtros MVC / WebAPI</a> <br><p>  Es necesario reescribir los filtros de acuerdo con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nueva implementaci√≥n de ASP.NET Core</a> . </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Formateadores</a> MVC / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WebAPI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Modelos vinculantes</a> </li></ul><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//add basic MVC feature var mvcBuilder = services.AddMvc(); //add custom model binder provider (to the top of the provider list) mvcBuilder.AddMvcOptions(options =&gt; options.ModelBinderProviders.Insert(0, new NopModelBinderProvider())); /// &lt;summary&gt; /// Represents model binder provider for the creating NopModelBinder /// &lt;/summary&gt; public class NopModelBinderProvider : IModelBinderProvider { /// &lt;summary&gt; /// Creates a nop model binder based on passed context /// &lt;/summary&gt; /// &lt;param name="context"&gt;Model binder provider context&lt;/param&gt; /// &lt;returns&gt;Model binder&lt;/returns&gt; public IModelBinder GetBinder(ModelBinderProviderContext context) { if (context == null) throw new ArgumentNullException(nameof(context)); var modelType = context.Metadata.ModelType; if (!typeof(BaseNopModel).IsAssignableFrom(modelType)) return null; //use NopModelBinder as a ComplexTypeModelBinder for BaseNopModel if (context.Metadata.IsComplexType &amp;&amp; !context.Metadata.IsCollectionType) { //create binders for all model properties var propertyBinders = context.Metadata.Properties .ToDictionary(modelProperty =&gt; modelProperty, modelProperty =&gt; context.CreateBinder(modelProperty)); return new NopModelBinder(propertyBinders, EngineContext.Current.Resolve&lt;ILoggerFactory&gt;()); } //or return null to further search for a suitable binder return null; } }</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Areas</a> </li></ul><br><br><pre> <code class="java hljs">app.UseMvc(routes =&gt; { routes.MapRoute(<span class="hljs-string"><span class="hljs-string">"areaRoute"</span></span>, <span class="hljs-string"><span class="hljs-string">"{area:exists}/{controller=Admin}/{action=Index}/{id?}"</span></span>); routes.MapRoute( name: <span class="hljs-string"><span class="hljs-string">"default"</span></span>, template: <span class="hljs-string"><span class="hljs-string">"{controller=Home}/{action=Index}/{id?}"</span></span>); });</code> </pre> <br>  Al mismo tiempo, la carpeta con el nombre √Årea debe colocarse en la ra√≠z de la aplicaci√≥n, dentro de la cual se encuentra la carpeta Admin.  Ahora, el atributo <code>[Area("Admin")] [Route("admin")]</code> se utilizar√° para conectar el controlador con esta √°rea. <br>  Solo queda crear vistas para todas las acciones descritas en el controlador. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3o/eo/rp/3oeorp_vjlbwlisc1kbavvvaeoe.png"></div><br><pre> <code class="java hljs">[Area(<span class="hljs-string"><span class="hljs-string">"Admin"</span></span>)] [Route(<span class="hljs-string"><span class="hljs-string">"admin"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdminController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); } }</code> </pre> <br>  <b>Validaci√≥n</b> <br><br>  Ahora no necesita pasar IFormCollection a los controladores, ya que en este caso la validaci√≥n del servidor asp.net est√° deshabilitada: MVC est√° suprimiendo la validaci√≥n adicional si se determina que IFormCollection no es nulo.  La soluci√≥n al problema puede ser agregar esta propiedad al modelo, esto evitar√° que pasemos directamente al m√©todo del controlador.  Esta regla es v√°lida solo si hay un modelo presente, pero si no hay modelo, entonces no habr√° validaci√≥n. <br><br>  Las propiedades secundarias ya no se validan autom√°ticamente.  Debe especificarse manualmente. <br><br><h3>  Paso 6. Transferencia de controladores HTTP y m√≥dulos HTTP a Middleware </h3><br>  Los controladores HTTP y los m√≥dulos HTTP son esencialmente muy similares al concepto de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://docs.microsoft.com/ru-ru/aspnet/core/migration/">Middleware en ASP.NET Core</a> , pero a diferencia de los m√≥dulos, el orden del middleware se basa en el orden en que se insertan en la canalizaci√≥n de solicitudes.  El orden de los m√≥dulos, en su mayor parte, se basa en los eventos del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ciclo de vida de la aplicaci√≥n</a> .  El orden del middleware para las respuestas es el opuesto al orden de las solicitudes, y el orden de los m√≥dulos para las solicitudes y las respuestas es el mismo. De acuerdo con esto, puede continuar con la actualizaci√≥n. <br><br>  Entonces, lo que queda por actualizar: <br><br><ul><li>  Migraci√≥n de m√≥dulos para Middleware (AuthenticationMiddleware, CultureMiddleware, etc.) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://docs.microsoft.com/en-us/aspnet/core/migration/">Manejadores</a> de Middleware </li><li>  Usando New Middleware </li></ul><br>  La autenticaci√≥n en nuestro proyecto no utiliza el sistema de credenciales incorporado; para estos fines, se utiliza AuthenticationMiddleware de middleware, desarrollado de acuerdo con la nueva estructura ASP.NET Core. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthenticationMiddleware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly RequestDelegate _next; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthenticationMiddleware</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IAuthenticationSchemeProvider schemes, RequestDelegate next)</span></span></span><span class="hljs-function"> </span></span>{ Schemes = schemes ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(schemes)); _next = next ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(next)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IAuthenticationSchemeProvider Schemes { get; set; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> async Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpContext context)</span></span></span><span class="hljs-function"> </span></span>{ context.Features.Set&lt;IAuthenticationFeature&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthenticationFeature { OriginalPath = context.Request.Path, OriginalPathBase = context.Request.PathBase }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlers = context.RequestServices.GetRequiredService&lt;IAuthenticationHandlerProvider&gt;(); foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scheme in await Schemes.GetRequestHandlerSchemesAsync()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (await handlers.GetHandlerAsync(context, scheme.Name) is IAuthenticationRequestHandler handler &amp;&amp; await handler.HandleRequestAsync()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ignored } } var defaultAuthenticate = await Schemes.GetDefaultAuthenticateSchemeAsync(); if (defaultAuthenticate != null) { var result = await context.AuthenticateAsync(defaultAuthenticate.Name); if (result?.Principal != null) { context.User = result.Principal; } } await _next(context); } }</span></span></code> </pre> <br>  ASP.NET proporciona una gran cantidad de middleware integrado que puede usar en su aplicaci√≥n, pero tenga en cuenta que el desarrollador tiene la capacidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de crear su propio middleware</a> y agregarlo a la canalizaci√≥n de solicitudes HTTP.  Para simplificar este mecanismo, agregamos una interfaz especial, y ahora es suficiente con crear una clase que lo implemente. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INopStartup</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Add and configure any of the middleware /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; /// &lt;param name="configuration"&gt;Configuration of the application&lt;/param&gt; void ConfigureServices(IServiceCollection services, IConfiguration configuration); /// &lt;summary&gt; /// Configure the using of added middleware /// &lt;/summary&gt; /// &lt;param name="application"&gt;Builder for configuring an application's request pipeline&lt;/param&gt; void Configure(IApplicationBuilder application); /// &lt;summary&gt; /// Gets order of this startup configuration implementation /// &lt;/summary&gt; int Order { get; } }</span></span></code> </pre> <br>  Aqu√≠ puede agregar y configurar su middleware: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Represents object for the configuring authentication middleware on application startup /// &lt;/summary&gt; public class AuthenticationStartup : INopStartup { /// &lt;summary&gt; /// Add and configure any of the middleware /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; /// &lt;param name="configuration"&gt;Configuration of the application&lt;/param&gt; public void ConfigureServices(IServiceCollection services, IConfiguration configuration) { //add data protection services.AddNopDataProtection(); //add authentication services.AddNopAuthentication(); } /// &lt;summary&gt; /// Configure the using of added middleware /// &lt;/summary&gt; /// &lt;param name="application"&gt;Builder for configuring an application's request pipeline&lt;/param&gt; public void Configure(IApplicationBuilder application) { //configure authentication application.UseNopAuthentication(); } /// &lt;summary&gt; /// Gets order of this startup configuration implementation /// &lt;/summary&gt; public int Order =&gt; 500; //authentication should be loaded before MVC }</span></span></code> </pre> <br><h3>  Paso 7. Usando DI integrado </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La</a> inyecci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dependencia</a> es una de las caracter√≠sticas clave en el proceso de dise√±o de aplicaciones en ASP.NET Core.  Le permite crear aplicaciones poco acopladas que son m√°s comprobables, modulares y, como resultado, mantenibles.  Esto fue posible siguiendo el principio de inversi√≥n de dependencia.  Para instalar dependencias, se utilizan contenedores IoC (Inversi√≥n de control).  En ASP.NET Core, dicho contenedor est√° representado por la interfaz IServiceProvider.  Los servicios se instalan en la aplicaci√≥n en el m√©todo <code>Startup.ConfigureServices()</code> . <br><br>  Cualquier servicio registrado se puede configurar con tres √°mbitos: <br><br><ul><li>  transitoria </li><li>  alcance </li><li>  singleton </li></ul><br><pre> <code class="java hljs">services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt; options.UseSqlServer(Configuration.GetConnectionString(<span class="hljs-string"><span class="hljs-string">"DefaultConnection"</span></span>))); services.AddSingleton&lt;Isingleton,MySingleton&gt;();</code> </pre> <br><h3>  Paso 8. Uso de shells de compatibilidad de proyectos de WebAPI (Shim) </h3><br>  Para simplificar la migraci√≥n de una implementaci√≥n de API web existente, se recomienda utilizar el paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Microsoft.AspNetCore.Mvc.WebApiCompatShim</a> NuGet.  Se admiten las siguientes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funciones</a> compatibles: <br><br><ul><li>  Agrega el tipo ApiController </li><li>  Habilita el enlace del modelo de estilo de API web </li><li>  Extiende el enlace del modelo para que las acciones del controlador puedan aceptar par√°metros de tipo HttpRequestMessage. </li><li>  Agrega formateadores de mensajes que permiten que las acciones devuelvan resultados de tipo HttpResponseMessage </li></ul><br><pre> <code class="java hljs">services.AddMvc().AddWebApiConventions(); routes.MapWebApiRoute(name: <span class="hljs-string"><span class="hljs-string">"DefaultApi"</span></span>, template: <span class="hljs-string"><span class="hljs-string">"api/{controller}/{id?}"</span></span> );</code> </pre> <br><h3>  Paso 9. Transfiera la configuraci√≥n de la aplicaci√≥n </h3><br>  Anteriormente, algunas configuraciones se guardaban en el archivo web.config.  Ahora estamos adoptando un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuevo enfoque</a> basado en pares clave-valor establecidos <i>por los proveedores de configuraci√≥n</i> .  Este es el mecanismo recomendado en ASP.NET Core, y utilizamos el archivo appsettings.json. <br><br>  Tambi√©n puede usar el paquete NuGet <code>System.Configuration.ConfigurationManager</code> si por alguna raz√≥n desea continuar usando * .config.  En este caso, deber√° abandonar la capacidad de ejecutar la aplicaci√≥n en plataformas Unix y ejecutarla solo bajo IIS. <br><br>  Si desea usar el proveedor de configuraci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Azure Key Vault</a> , debe consultar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">migraci√≥n de</a> contenido al contenido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de Azure Key Valut</a> .  En nuestro proyecto, esta no era la tarea. <br><br><h3>  Paso 10. Transferencia de contenido est√°tico a wwwroot </h3><br>  Para servir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">contenido est√°tico,</a> debe indicarle al host web la ra√≠z del contenido del directorio actual.  El valor predeterminado es wwwroot.  Puede personalizar su directorio para almacenar archivos est√°ticos configurando middleware. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b7/z1/s7/b7z1s7pkzbd2yrkqukxcfholuus.png"></div><br><br><h3>  Paso 11. Portar EntityFramework a EF Core </h3><br>  Si el proyecto usa algunas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">caracter√≠sticas</a> espec√≠ficas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de Entity Framework 6</a> que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no</a> son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">compatibles</a> con <code>EF Core</code> , entonces tiene sentido ejecutar la aplicaci√≥n en <code>NET Framework</code> .  En este caso, sin embargo, debes sacrificar la multiplataforma.  La aplicaci√≥n solo funcionar√° en Windows y bajo IIS. <br><br>  <b>Echemos un vistazo a los principales cambios a tener en cuenta:</b> <br><br><ul><li>  System.Data.Entity namespace reemplazado por Microsoft.EntityFrameworkCore </li><li>  La firma del constructor DbContext ha cambiado.  Ahora necesita inyectar DbContextOptions </li><li>  M√©todo HasDatabaseGeneratedOption (DatabaseGeneratedOption.None) reemplazado por ValueGeneratedNever () </li><li>  M√©todo WillCascadeOnDelete (falso) reemplazado por OnDelete (DeleteBehavior.Restrict) </li><li>  M√©todo OnModelCreating (DbModelBuilder modelBuilder) reemplazado por OnModelCreating (ModelBuilder modelBuilder) </li><li>  El m√©todo HasOptional ya no est√° disponible </li><li>  la configuraci√≥n de los objetos ha cambiado, ahora necesita usar OnModelCreating, porque  EntityTypeConfiguration ya no est√° disponible </li><li>  El atributo ComplexType ya no est√° disponible </li><li>  Reemplazos de la interfaz IDbSet con DbSet </li><li>  ComplexType: la compatibilidad con tipos complejos apareci√≥ en EF Core 2 con el tipo de entidad propia ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://docs.microsoft.com/en-us/ef/core/modeling/owned-entities</a> ) y tablas sin una clave principal con QueryType en EF Core 2.1 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://docs.microsoft.com/en-us/ef/core/modeling/query-types</a> ) </li><li>  Las claves for√°neas en EF Core generan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">propiedades de sombra</a> utilizando el patr√≥n Id de [Entidad], a diferencia de EF6, que usa el patr√≥n Id de [Entidad].  Por lo tanto, primero agregue claves externas como una propiedad regular a la entidad. </li><li>  Para admitir DI para DbContext, configure su DbContex en <code>ConfigureServices</code> </li></ul><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Register base object context /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; public static void AddNopObjectContext(this IServiceCollection services) { services.AddDbContextPool&lt;NopObjectContext&gt;(optionsBuilder =&gt; { optionsBuilder.UseSqlServerWithLazyLoading(services); }); } /// &lt;summary&gt; /// SQL Server specific extension method for Microsoft.EntityFrameworkCore.DbContextOptionsBuilder /// &lt;/summary&gt; /// &lt;param name="optionsBuilder"&gt;Database context options builder&lt;/param&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; public static void UseSqlServerWithLazyLoading(this DbContextOptionsBuilder optionsBuilder, IServiceCollection services) { var nopConfig = services.BuildServiceProvider().GetRequiredService&lt;NopConfig&gt;(); var dataSettings = DataSettingsManager.LoadSettings(); if (!dataSettings?.IsValid ?? true) return; var dbContextOptionsBuilder = optionsBuilder.UseLazyLoadingProxies(); if (nopConfig.UseRowNumberForPaging) dbContextOptionsBuilder.UseSqlServer(dataSettings.DataConnectionString, option =&gt; option.UseRowNumberForPaging()); else dbContextOptionsBuilder.UseSqlServer(dataSettings.DataConnectionString); }</span></span></code> </pre><br>  Use la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SQL Compare</a> para verificar que <code>EF Core</code> genera un esquema de base de datos similar al <code>Entity Framework</code> durante la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">migraci√≥n</a> . <br><br><h3>  Paso 12. Eliminar todas las referencias de HttpContext, reemplazar clases obsoletas y cambiar el espacio de nombres </h3><br>  Durante la migraci√≥n de su proyecto, encontrar√° que se ha cambiado el nombre o se ha movido un n√∫mero suficientemente grande de clases, y ahora debe alinear todo con los nuevos requisitos.  Aqu√≠ hay una lista de las principales transiciones que puede encontrar: <br><br><ul><li>  HttpPostedFileBase -&gt; IFormFile </li><li>  El acceso para acceder a HttpContext ahora es a trav√©s de IHttpContextAccessor </li><li>  HtmlHelper -&gt; IHtmlHelper </li><li>  ActionResult -&gt; IActionResult </li><li>  HttpUtility -&gt; WebUtility </li><li>  En lugar de HttpSessionStateBase - ISession, se puede acceder desde HttpContext.Session.  de Microsoft.AspNetCore.Http </li><li>  Request.Cookies devuelve IRequestCookieCollection: IEnumerable &lt;KeyValuePair &lt;string, string &gt;&gt;, por lo que en lugar de HttpCookie, KeyValuePair &lt;string, string&gt; de Microsoft.AspNetCore.Http </li></ul><br>  Reemplazo del espacio de nombres: <br><br><ul><li>  SelectList -&gt; Microsoft.AspNetCore.Mvc.Rendering </li><li>  UrlHelper -&gt; WebUtitlity </li><li>  MimeMapping -&gt; FileExtensionContentTypeProvider </li><li>  MvcHtmlString -&gt; IHtmlString y HtmlString </li><li>  ModelState, ModelStateDictionary, ModelError -&gt; Microsoft.AspNetCore.Mvc.ModelBinding </li><li>  FormCollection -&gt; IFormCollection </li><li>  Request.Url.Scheme -&gt; this.Url.ActionContext.HttpContext.Request.Scheme </li></ul><br>  Otros: <br><br><ul><li>  MvcHtmlString.IsNullOrEmpty (IHtmlString) -&gt; String.IsNullOrEmpty (variable.ToHtmlString ()) </li><li>  [ValidateInput (false)]: generalmente ya no existe y no es necesario </li><li>  HttpUnauthorizedResult -&gt; UnauthorizedResult </li><li>  [AllowHtml]: no hay m√°s directiva y no es necesaria </li><li>  Se reemplaz√≥ el m√©todo TagBuilder.SetInnerText; ahora es InnerHtml.AppendHtml </li><li>  JsonRequestBehavior.AllowGet cuando devolver Json ya no es necesario </li><li>  HttpUtility.JavaScriptStringEncode.  -&gt; JavaScriptEncoder.Default.Encode </li><li>  Request.RawUrl.  Es necesario conectar por separado Request.Path + Request.QueryString </li><li>  AllowHtmlAttribute: no m√°s clases </li><li>  XmlDownloadResult: ahora puede usar simplemente regresar File (Encoding.UTF8.GetBytes (xml), "application / xml", "filename.xml"); </li><li>  [ValidateInput (false)]: no hay m√°s directiva y no es necesaria </li></ul><br><h3>  Paso 13. Actualizaci√≥n de autenticaci√≥n y autorizaci√≥n </h3><br>  Ya escrib√≠ anteriormente que en nuestro proyecto la autenticaci√≥n no se implementa utilizando el sistema de identidad incorporado, sino que se extrae en una capa separada de middleware.  Sin embargo, ASP.NET Core tiene su propio mecanismo para proporcionar credenciales.  Se pueden encontrar m√°s detalles en la documentaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  En cuanto a la protecci√≥n de datos, ya no usamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MachineKey</a> .  En cambio, utilizamos la funci√≥n de protecci√≥n de datos incorporada.  Por defecto, las claves se generan cuando se inicia la aplicaci√≥n.  El almac√©n de datos puede ser: <br><br><ul><li>  Sistema de archivos: almac√©n de claves basado en el sistema de archivos </li><li>  Azure Storage: claves de protecci√≥n de datos en Azure Blob Storage </li><li>  Redis: claves de protecci√≥n de datos en el cach√© de Redis </li><li>  Registro: debe usarse si la aplicaci√≥n no tiene acceso al sistema de archivos </li><li>  EF Core: las claves se almacenan en la base de datos </li></ul><br>  Si los mecanismos integrados no son adecuados, puede especificar su propio mecanismo de almacenamiento de claves proporcionando un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IXmlRepository</a> personalizado. <br><br><h3>  Paso 14. Actualizaci√≥n de JS / CSS </h3><br>  La forma de trabajar con recursos est√°ticos ha cambiado: ahora todos deben almacenarse en la carpeta ra√≠z del proyecto <i>wwwroot</i> , a menos que, por supuesto, se especifiquen otras configuraciones. <br><br>  Cuando utilice bloques incorporados de JavaScript, se recomienda que los mueva al final de la p√°gina.  Simplemente use el atributo asp-location = "Footer" para sus etiquetas.  La misma regla se aplica a los archivos js. <br><br>  Use la extensi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BundlerMinifier</a> como reemplazo de System.Web.Optimization: esto le permitir√° vincular y minimizar JavaScript y CSS mientras construye el proyecto.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace</a> a la documentaci√≥n. <br><br><h3>  Paso 15. Migrar vistas </h3><br>  Las acciones secundarias ya no se usan.  En cambio, ASP.NET Core ofrece una nueva herramienta poderosa: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ViewComponents</a> , que se llama de forma asincr√≥nica. <br><br>  C√≥mo obtener una cadena de ViewComponent: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Render component to string /// &lt;/summary&gt; /// &lt;param name="componentName"&gt;Component name&lt;/param&gt; /// &lt;param name="arguments"&gt;Arguments&lt;/param&gt; /// &lt;returns&gt;Result&lt;/returns&gt; protected virtual string RenderViewComponentToString(string componentName, object arguments = null) { if (string.IsNullOrEmpty(componentName)) throw new ArgumentNullException(nameof(componentName)); var actionContextAccessor = HttpContext.RequestServices.GetService(typeof(IActionContextAccessor)) as IActionContextAccessor; if (actionContextAccessor == null) throw new Exception("IActionContextAccessor cannot be resolved"); var context = actionContextAccessor.ActionContext; var viewComponentResult = ViewComponent(componentName, arguments); var viewData = ViewData; if (viewData == null) { throw new NotImplementedException(); } var tempData = TempData; if (tempData == null) { throw new NotImplementedException(); } using (var writer = new StringWriter()) { var viewContext = new ViewContext( context, NullView.Instance, viewData, tempData, writer, new HtmlHelperOptions()); // IViewComponentHelper is stateful, we want to make sure to retrieve it every time we need it. var viewComponentHelper = context.HttpContext.RequestServices.GetRequiredService&lt;IViewComponentHelper&gt;(); (viewComponentHelper as IViewContextAware)?.Contextualize(viewContext); var result = viewComponentResult.ViewComponentType == null ? viewComponentHelper.InvokeAsync(viewComponentResult.ViewComponentName, viewComponentResult.Arguments): viewComponentHelper.InvokeAsync(viewComponentResult.ViewComponentType, viewComponentResult.Arguments); result.Result.WriteTo(writer, HtmlEncoder.Default); return writer.ToString(); } }</span></span></code> </pre> <br>  Ya no es necesario usar HtmlHelper: ASP.NET Core tiene una gran cantidad de funciones de etiqueta de ayuda ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tag Helpers</a> ) integradas.  Cuando la aplicaci√≥n se est√° ejecutando, son procesados ‚Äã‚Äãpor el motor Razor en el lado del servidor y finalmente se convierten en elementos html est√°ndar.  Esto simplifica enormemente el desarrollo de aplicaciones.  Y, por supuesto, puede implementar sus propios tag-helpers. <br><br>  Comenzamos a usar la inyecci√≥n de dependencia en vistas en lugar de permitir configuraciones y servicios usando <code>EngineContext</code> . <br><br>  Entonces, los puntos principales sobre la migraci√≥n de puntos de vista: <br><br><ul><li>  Convierta <code>Views/web.config  Views/_ViewImports.cshtml</code> , utilizado para importar espacios de nombres e <code>Views/web.config  Views/_ViewImports.cshtml</code> dependencias.  Este archivo no es compatible con otras funciones de <code>Razor</code> , como las definiciones de funciones y secciones. </li><li>  Convierta <code>namespaces.add</code> a <code>@using</code> </li><li>  Transfiera cualquier configuraci√≥n a la configuraci√≥n de la aplicaci√≥n principal </li><li>  <code>Scripts.Render</code> y <code>Styles.Render</code> no existe.  Reemplace <code>libman</code> o <code>BundlerMinifier</code> enlaces a la salida </li></ul><br><h2>  En conclusi√≥n </h2><br>  Hemos visto por nuestra experiencia que el proceso de migrar una gran aplicaci√≥n web es una tarea que requiere mucho tiempo y que dif√≠cilmente se puede llevar a cabo sin dificultades.  Planeamos cambiar a un nuevo marco tan pronto como se lanz√≥ su primera versi√≥n estable, pero no pudimos terminarlo de inmediato: hab√≠a algunas funciones cr√≠ticas que para ese momento a√∫n no se hab√≠an transferido a .NET Core, en particular, relacionadas con EntityFramework.  Por lo tanto, primero tuvimos que lanzar la pr√≥xima versi√≥n con un enfoque mixto: la arquitectura .NET Core con las dependencias de .NET Framework. <br><br>  Pudimos adaptar completamente el proyecto despu√©s del lanzamiento de .NET Core 2.1, teniendo en ese momento una soluci√≥n estable que ya funcionaba en la nueva arquitectura; todo lo que quedaba era reemplazar algunos paquetes y reescribir el trabajo con EF Core.  Por lo tanto, la migraci√≥n completa al nuevo marco tom√≥ varios meses de trabajo. <br><br>  Puede obtener m√°s informaci√≥n sobre nuestro proyecto en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio en GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472738/">https://habr.com/ru/post/472738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472720/index.html">ERP no funciona ... ¬øCu√°l es la alternativa? o justo a tiempo. Para Rusia?</a></li>
<li><a href="../472724/index.html">Introducci√≥n a skydive.network</a></li>
<li><a href="../472726/index.html">Mejora de la inmunidad al ruido Arduino</a></li>
<li><a href="../472730/index.html">Ivanovo! Mitap en honor del d√©cimo aniversario de Node.js</a></li>
<li><a href="../472736/index.html">Webinar abierto "Introducci√≥n a la automatizaci√≥n de pruebas de aplicaciones m√≥viles en Selenium y Appium"</a></li>
<li><a href="../472744/index.html">MRP no funciona ... ¬øCu√°l es la alternativa?</a></li>
<li><a href="../472746/index.html">Servidor de terminal para administrador; Ni una sola brecha SSH</a></li>
<li><a href="../472748/index.html">Navegador sem√°ntico o vida sin sitios</a></li>
<li><a href="../472750/index.html">OK, ¬ørealmente necesito Kubernetes?</a></li>
<li><a href="../472752/index.html">CSE: Kubernetes para cualquier persona en vCloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>