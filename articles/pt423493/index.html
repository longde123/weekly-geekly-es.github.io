<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§õüèø üöß üëæ O Android Go √© o futuro bilh√£o de dispositivos e um limite de 50 MB. Palestra Yandex üâë üíáüèª üé¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Novas dire√ß√µes para o desenvolvimento de uma plataforma j√° familiar - √© sempre interessante. Por um lado, voc√™ est√° expandindo a base de clientes; por...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O Android Go √© o futuro bilh√£o de dispositivos e um limite de 50 MB. Palestra Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/423493/">  Novas dire√ß√µes para o desenvolvimento de uma plataforma j√° familiar - √© sempre interessante.  Por um lado, voc√™ est√° expandindo a base de clientes; por outro lado, n√£o est√° investindo na cria√ß√£o de software do zero, mas usando desenvolvimentos existentes.  Mas se a dire√ß√£o for realmente nova, com suas pr√≥prias especificidades, n√£o ser√° poss√≠vel gerenciar com muito pouco sangue.  Na pr√≥xima reuni√£o da comunidade Mosdroid em nosso escrit√≥rio, o desenvolvedor Arthur Vasilov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Arturka</a> falou sobre a adapta√ß√£o do aplicativo Yandex ao sistema Android Go. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VYcLRPoA4Bk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><blockquote>  Em m√©dia, se voc√™ n√£o escrever uma calculadora, um despertador, etc., ou ser√° muito legal, bem-sucedido e fez tudo bem, ou seu aplicativo ter√° de 150 a 170 megabytes. </blockquote><br><a name="habracut"></a>  - Meu nome √© Arthur, sou desenvolvedor Android, estou trabalhando no aplicativo Yandex.  Hoje vou compartilhar com voc√™s uma hist√≥ria sobre como nos adaptamos ao Android Go.  Vou lhe dizer que tipo de rake encontramos, o que n√£o deu certo para n√≥s e como tudo funciona, por que √© necess√°rio. <br><br>  Uma pequena digress√£o sobre o que se trata.  O Android Go √© uma vers√£o especial do Android projetada para dispositivos de baixo custo.  Eles custam de 60 a 100 d√≥lares e, portanto, s√£o muito fracos, lentos, mais lentos.  Ent√£o, o Google decidiu criar um sistema pr√≥prio para que, pelo menos de alguma forma, funcionasse normalmente.  Foi anunciado no Google I / O em 2017, ou seja, um ano e v√°rios meses se passaram.  Portanto, quando o mitap foi anunciado, uma quest√£o l√≥gica foi levantada: "Voc√™ ainda est√° vivo, ou o qu√™?"  Eu ent√£o disse que est√° tudo bem, tudo est√° bem, eu direi.  E agora, como um her√≥i t√≠pico da Internet, responderei ex post por que isso aconteceu. <br><br><img src="https://habrastorage.org/webt/h2/qw/6g/h2qw6gttth_hx-niydwklvvcb8u.jpeg"><br>  O que exatamente aconteceu?  O Google disse: "Estamos criando esse sistema".  Ent√£o ele disse: "Ok, precisamos de tempo para finalizar" e tudo mais.  Depois disso, os fornecedores sempre t√™m algum tipo de atraso na adapta√ß√£o dessa vers√£o para si mesmos.  E a nova vers√£o conosco j√° foi lan√ßada n√£o antes de um ano depois, ent√£o n√£o h√° nada de surpreendente aqui.  Al√©m disso, eles precisavam decidir se deveriam ou n√£o fazer isso: est√£o falando de dispositivos baratos e n√£o est√° claro se eles lucram com eles ou n√£o.  Al√©m disso, este dispositivo deve ser novo, deve ser feito, aprender a vender, entender como ele funcionar√°. <br><br>  O primeiro smartphone com Android Go apareceu h√° n√£o muito tempo.  Em algum lugar de abril, as vendas provavelmente come√ßaram, ou talvez em maio.  Este √© o Nokia 1, √© vendido em qualquer lugar.  Eu estou deitado por aqui.  Agora, na minha opini√£o, existem apenas nove desses smartphones no mercado, mas at√© o final do ano eles prometem mais de cem.  E, em princ√≠pio, nenhum dos principais players, como Huawei, Samsung e outros, disse sua palavra, ent√£o eles adicionar√£o outra coisa, n√£o ser√£o capazes de ficar longe de um mercado t√£o grande. <br><br>  Antes do relat√≥rio, fui √† p√°gina do Android Go e vi que eles criaram o Android Pie Go Edition.  Mas eles n√£o fizeram nada l√°, simplesmente reduziram o n√∫mero de aplicativos instalados e seu peso antecipadamente.  Eles disseram: - "Agora voc√™ tem o dobro de espa√ßo livre."  E as desculpas padr√£o: corre√ß√£o de bugs, melhoria de desempenho, tudo.  Mas pelo menos eles ligaram, o que significa que n√£o esqueceram. <br><br>  Quais s√£o as limita√ß√µes desses dispositivos, especificamente?  Em primeiro lugar, eles t√™m 512 megabytes ou 1 gigabyte de RAM, 8 ou 16 gigabytes de armazenamento.  √â claro que nessas condi√ß√µes elas s√£o extremamente inibidas e todas as aplica√ß√µes normais nelas funcionar√£o aproximadamente da mesma maneira.  Para que os aplicativos funcionem com o m√≠nimo de adequa√ß√£o, o Google disse: "Vamos apresentar os seguintes requisitos".  Eles s√£o bastante l√≥gicos, seguem o que estava no slide anterior. <br><br><img src="https://habrastorage.org/webt/ci/xm/ht/cixmhtwrdwbu_gkczbo0vk3-k8e.jpeg"><br><br>  Antes de tudo, √© um bom desempenho abstrato.  Seu aplicativo deve executar bem e rapidamente nesse dispositivo.  N√≥s somos: ‚Äú√ìtimo.  N√≥s estamos trabalhando. <br><br>  Al√©m disso, j√° existem n√∫meros espec√≠ficos aos quais devemos corresponder.  O espa√ßo ocupado ap√≥s descompactar e instalar o APK n√£o passa de 40 megabytes.  √Äs vezes, isso √© um problema, porque algu√©m e o APK pesam todos os 80 megabytes.  Vai doer.  Al√©m disso, isso n√£o pode ser tomado e medido adequadamente.  Ou seja, voc√™ n√£o pode dizer: "Eu sei que meu APK pesa tanto; portanto, ap√≥s a instala√ß√£o, o aplicativo levar√° muito".  Tudo isso depende muito do fornecedor, da vers√£o do dispositivo, do Android, etc. Mas se o seu APK demorar 10 megabytes, ent√£o, em princ√≠pio, est√° tudo bem e voc√™ nunca exceder√° esse n√∫mero. <br><br>  E agora o requisito mais divertido e interessante: a RAM consumida ao trabalhar com o aplicativo n√£o deve exceder 50 megabytes. <br><br>  Quem sabe quanta RAM o aplicativo dele leva em m√©dia durante a opera√ß√£o?  Quem j√° se perguntou sobre esse assunto?  Existe algu√©m com menos de 100 megabytes?  Bonito.  Mas talvez voc√™ esteja mentindo.  Em geral, em m√©dia, se voc√™ n√£o escrever uma calculadora, um despertador e assim por diante, ou ser√° muito legal, bem-sucedido e fez tudo bem, ou seu aplicativo ter√° 150-170 megabytes.  Coloc√°-lo em 50 megabytes √© muito dif√≠cil.  Portanto, o resto do tempo falaremos sobre isso, discutiremos como colocar o globo em uma coruja etc. <br><br><img src="https://habrastorage.org/webt/6k/el/g1/6kelg1qxjmzqgltficsia2dk1p0.jpeg"><br>  O que inclui nossa conversa sobre mem√≥ria?  √â diretamente necess√°rio entender o que exatamente estamos medindo e qual √© a melhor maneira de mensur√°-lo.  Tamb√©m para dispositivos Android Go, h√° uma especificidade que precisa ser levada em considera√ß√£o, e tamb√©m falaremos sobre isso.  E tamb√©m vou lhe contar algumas coisas gerais, dicas gerais sobre as quais voc√™ talvez n√£o tenha adivinhado, mas elas podem realmente comer muita mem√≥ria de voc√™. <br><br>  Em 2018, ap√≥s a E / S do Google, voc√™ precisar√° iniciar a hist√≥ria sobre mem√≥ria com uma refer√™ncia a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este relat√≥rio</a> .  Quem assistiu? <br><br>  √ìtimo.  Todas as 180 pessoas restantes sabem o que fazer no futuro pr√≥ximo.  Na minha opini√£o, este √© um dos melhores relat√≥rios de E / S do Google.  Cara disse coisas incrivelmente legais.  Ele contou tudo nas prateleiras, bem, e com muitos detalhes profundos.  Quem assistiu e se lembrou bem, provavelmente notar√° que eu copiei algumas coisas a partir da√≠, porque, caso contr√°rio, √© imposs√≠vel, ele contou tudo, ent√£o repetirei. <br><br>  O que medimos?  Havia uma coisa chamada PSS (tamanho proporcional do conjunto).  Ou seja, a RAM no Android √© representada por cerca de 40 kilobytes e esses blocos podem pertencer inteiramente ao aplicativo ou remexer entre processos e aplicativos. <br><br>  E a pergunta √©: como exatamente para entender a qual aplicativo relacionar essa mem√≥ria compartilhada?  Existem v√°rias abordagens, elas s√£o bastante l√≥gicas.  O PSS diz que, se a mem√≥ria estiver atrapalhando entre N processos, assumiremos que seu aplicativo possui 1 / N dessa mem√≥ria.  E exatamente da mesma maneira, h√° o Tamanho do conjunto residencial e o Tamanho do conjunto exclusivo, que dizem que "Nenhuma mem√≥ria compartilhada pertence a mim" e "Tudo pertence".  Em princ√≠pio, o PSS √© o mais l√≥gico aqui. <br><br>  Como exatamente voc√™ pode medir a mem√≥ria consumida?  Tudo √© simples aqui.  Ou √© um criador de perfil no Android Studio ou √© dumpsys.  Existem, √© claro, outras ferramentas.  Eles podem fornecer resultados mais detalhados, algo mais complicado, mas o problema √© que, para entender seus resultados, us√°-los, tudo isso √© muito, muito dif√≠cil.  Muitas vezes, voc√™ precisa criar uma raiz ou uma vers√£o personalizada do Android.  E, em geral, voc√™ n√£o precisa delas, as duas primeiras ferramentas s√£o suficientes. <br><br><img src="https://habrastorage.org/webt/0r/--/pr/0r--prgyak0-hltivshg-dxeuqc.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  N√£o vou falar sobre o criador de perfil no Android Studio, acho que muitas pessoas o usaram.  Quem n√£o usou, n√£o deixe de cutucar.  Em particular, forneci o link abaixo - apenas um bom artigo da documenta√ß√£o com v√≠deo, como us√°-lo, com demos.  E, em princ√≠pio, tudo est√° claro.  Mostra para onde vai a sua mem√≥ria, mostra em tempo real.  A √∫nica coisa a lembrar √© que, no entanto, imp√µe certos erros que surgem do fato de medirmos constantemente essa mem√≥ria.  Mas eles est√£o dentro de limites aceit√°veis. <br><br><img src="https://habrastorage.org/webt/gb/fv/wn/gbfvwnjxm6fcggr66eoyzmcvnni.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  Dumpsys √© uma coisa simples de console que n√£o requer nada de voc√™, apenas um telefone conectado e um adb.  E voc√™ pode executar este comando: chame dumpsys meminfo, passe o pacote para ele e ele retornar√° algo assim para voc√™.  E se estivermos interessados ‚Äã‚Äãem quanto nosso aplicativo consome, podemos analisar especificamente o TOTAL, que diz que "seu aplicativo consome cerca de 168 megabytes".  Muito, mas o que fazer? <br><br><img src="https://habrastorage.org/webt/lm/yo/xw/lmyoxwiahsbeey_ru-3zvdtd8y0.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  Tamb√©m mostra uma an√°lise exata da quantidade de mem√≥ria necess√°ria nessa mem√≥ria consumida.  Existem v√°rias se√ß√µes aqui, elas s√£o complexas, falaremos mais sobre elas, mas por enquanto podemos notar o principal - estas s√£o o Java Heap, nossos objetos Java e tudo o mais √© mais complicado. <br><br>  O que mais √© importante?  A mem√≥ria √© uma coisa muito sens√≠vel a todos os tipos de testes e todos os tipos de condi√ß√µes externas.  Ou seja, todos os testes que voc√™ deve executar o m√°ximo poss√≠vel nas mesmas condi√ß√µes.  √â claro que esse ideal deve ser um dispositivo, porque a mem√≥ria depende da vers√£o do Android.  Basta recordar as diferen√ßas entre os quatro e os cinco.  Depende do tamanho ou da resolu√ß√£o da tela, porque quanto maior o tamanho da tela, mais conte√∫do entra, mais mem√≥ria voc√™ precisa para desenhar tudo.  Quanto maior a resolu√ß√£o, mais pixels o seu bitmap ocupa e mais mem√≥ria √© necess√°ria para armazen√°-los. <br><br>  O cen√°rio do aplicativo tamb√©m afeta os testes.  Voc√™ pode ler o texto ou rolar pela galeria com v√°rias fotos.  E est√° claro onde haver√° mais mem√≥ria. <br><br>  Outra coisa importante √© a carga no dispositivo.  Ou seja, voc√™ pode ter tudo a mesma coisa, mas, em um caso, seu aplicativo √© o √∫nico que funciona para voc√™ e, no outro, voc√™ tem v√°rios aplicativos que fazem algo em segundo plano, baixam algo, excluem, trabalham em primeiro plano e, ao mesmo tempo, sua mem√≥ria √© simplesmente comprimida, porque voc√™ precisa entreg√°-la a outros aplicativos.  Portanto, idealmente, √© melhor pegar e matar primeiro todos os outros aplicativos que funcionam, n√£o os seus.  Tudo o que voc√™ pode alcan√ßar e depois matar.  Nesse caso, o PSS definitivamente agradecer√°, porque n√£o haver√° necessidade de atrapalhar a mem√≥ria entre os processos. <br><br><img src="https://habrastorage.org/webt/lm/yo/xw/lmyoxwiahsbeey_ru-3zvdtd8y0.jpeg"><br>  Voc√™ pode, por exemplo, obter e ver as informa√ß√µes atuais na mem√≥ria livre, na mem√≥ria ocupada.  Ele lhe trar√° algo como um sinal que diz: "Aqui eu tenho muita mem√≥ria livre, muita mem√≥ria em cache, muita mem√≥ria ocupada".  E se voc√™ tiver entre 200 e 250 megabytes de mem√≥ria livre para o seu amado, isso √© bom, provavelmente, nada afetar√° seus testes. <br><br>  Talvez algu√©m agora tenha a pergunta "Por que preciso de tudo isso?"  Este √© um disjuntor em que vou dizer adicionalmente a motiva√ß√£o para tudo isso. <br><br>  Em primeiro lugar, mesmo que voc√™ n√£o fa√ßa nada com o Android Go agora e pense que ele est√° morto, ele pode se desenvolver, chegar at√© voc√™ e, em algum momento, voc√™ ter√° que lidar com tudo isso. <br><br>  A segunda coisa que considero muito importante √© que voc√™ pode simplesmente fazer testes de regress√£o a partir da mem√≥ria.  Ou seja, voc√™ pode simplesmente escrever um script que execute o aplicativo, fa√ßa dumpsys, fa√ßa essas medi√ß√µes e observe como esses indicadores mudam entre os lan√ßamentos.  Esse script pode ser escrito em algumas horas, a infraestrutura pode ser configurada por mais tempo, mas parece-me que isso √© uma coisa boa. <br><br>  Se falarmos sobre as especificidades do Android Go - nosso terceiro ponto na luta contra a mem√≥ria -, h√° boas not√≠cias.  Primeiro, ningu√©m realmente exige que voc√™ siga essas restri√ß√µes.  Ou seja, voc√™ pode usar o aplicativo como ele √©, coloc√°-lo no dispositivo com Android Go, e est√° tudo bem.  O problema √© que √© muito prov√°vel que o usu√°rio o remova porque voc√™ est√° ocupando muito espa√ßo.  Al√©m disso, seu aplicativo pode ser executado lentamente e ter bastante mem√≥ria, sim.  Mas at√© agora ningu√©m o proibiu, porque, caso contr√°rio, n√£o haveria outro aplicativo al√©m dos aplicativos do Google no Android Go.  Por√©m, se isso continuar se desenvolvendo, muitos se adaptar√£o a essas condi√ß√µes e, no final, seu aplicativo poder√° simplesmente ser baixado na emiss√£o do Android Go, ou voc√™ poder√° mostrar Alertar como o usu√°rio instala o aplicativo no smartphone Android Go. : "Cara, o aplicativo n√£o funciona bem com o Android Go.  Talvez voc√™ n√£o coloque? <br><br>  H√° outro ponto: voc√™ pode excluir manualmente os dispositivos Android Go do Google Play, ou seja, dizer que o aplicativo n√£o pode ser instalado nos dispositivos Android Go.  Apareceu h√° n√£o muito tempo. <br><br>  E o Google tamb√©m √© inteligente o suficiente, e os 50 megabytes que soavam no t√≠tulo do relat√≥rio n√£o s√£o um n√∫mero fixo, dependem da resolu√ß√£o do dispositivo, do tamanho da tela e, al√©m disso, do tipo de aplicativo.  Por exemplo, os jogos s√£o alocados mais, na minha opini√£o, 115 megabytes.  Em princ√≠pio, isso √© compreens√≠vel. <br><br><img src="https://habrastorage.org/webt/gu/yj/0s/guyj0sbre79wfwrlzgupt009xn0.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Link do slide</a></sup></sub> </h5><br>  E se falarmos diretamente sobre esse teste?  H√° mais um ponto, que em particular nos preocupa muito - trabalhar com predefini√ß√µes.  Quando os fabricantes criam um telefone novo, geralmente colocam algum conjunto de aplicativos pr√©-instalados.  Em particular, estamos muito envolvidos nisso, e o problema √© que eles executam coisas como o Compatibility Test Suite.  Estes s√£o os testes do Google, eles os executam.  E a√≠, se o seu aplicativo n√£o corresponder a esses 50 megabytes, tudo estar√° ruim e o aplicativo n√£o poder√° ser pr√©-instalado em um dispositivo desse tipo. <br><br>  Infelizmente, os testes que o Google faz n√£o s√£o de c√≥digo aberto, n√£o sei dizer, eles est√£o sob o NDA, mas bons desenvolvedores do Google escreveram um artigo sobre o Android Go e, em princ√≠pio, existem recomenda√ß√µes que s√£o boas o suficiente <br><br>  Ou seja, tudo √© banal.  Iniciamos o aplicativo.  Aguardamos 5 segundos para carregar tudo.  Fazemos dumpsys, escrevemos o valor TOTAL, executamos v√°rias vezes, obtemos o resultado.  Tudo √© muito simples e comum. <br><br><img src="https://habrastorage.org/webt/zq/ma/de/zqmadexusg3whja0-dsz0d4w7gk.jpeg"><br>  A √∫nica coisa √© que eles n√£o levaram em considera√ß√£o um recurso t√£o pequeno em seu artigo ou, talvez, n√£o falaram sobre isso - existe algo como trabalhar em outro processo, e geralmente o fazem para combater o consumo de mem√≥ria. <br><br>  Quem acredita que isso √© bom para o Android Go?  E quem acha que isso √© ruim?  Bravamente. <br><br><img src="https://habrastorage.org/webt/_c/4p/h5/_c4ph5f7gcnhakefypwspum8d_y.jpeg"><br>  O problema √© que, sim, isso √© ruim, porque no final, a mem√≥ria consumida do aplicativo √© contada em todos os processos.  Se fizermos um processo vazio sem nada e fizermos dumpsys desse processo em particular, veremos que s√£o necess√°rios 7 megabytes.  5 a 8 megabytes - isso √© uma sobrecarga desde a cria√ß√£o do processo.  Portanto, quando lutamos por cada megabyte para compactar tudo em 50, isso nos √© muito grave.  Em particular, digamos que o Yandex tenha a biblioteca Yandex.Metrica mais popular, ela tamb√©m funciona em um processo diferente, e isso tamb√©m pode nos causar dor. <br><br><img src="https://habrastorage.org/webt/qu/os/fu/quosfu3kccdztjv7cp6ujn4rxhg.jpeg"><br>  Portanto, se algumas bibliotecas externas vierem at√© voc√™, por exemplo, voc√™ pode simplesmente dizer: ‚ÄúCara, por favor, trabalhe no processo principal.  Concordo que isso pode ser mais lento, mas n√£o consome mem√≥ria desnecess√°ria. ‚Äù  Portanto, este tamb√©m √© um ponto sutil. <br><br><img src="https://habrastorage.org/webt/ci/6b/9c/ci6b9cbpebgounzlbc87xids-xi.jpeg"><br><br>  Se falarmos sobre o consumo de mem√≥ria, vamos para esta placa, que est√° l√°.  N√≥s pegamos um projeto vazio, executamos esse dumpsys, iniciamos esse neg√≥cio e vemos que 23 megabytes de 50 j√° est√£o ocupados.  Vazio "Ol√°, mundo!"  sem nada, basta ativar com o texto.  Est√° ficando muito triste.  Fica ainda mais triste com a percep√ß√£o de que podemos influenciar diretamente um par√¢metro como Java Heap, ou seja, esses s√£o diretamente nossos objetos Java que podemos rastrear explicitamente, que podemos excluir, reduzir e, pelo menos, de alguma forma interagir. <br><br>  E √© dif√≠cil interagir normalmente com tudo isso, porque esse √© qualquer c√≥digo de estrutura e, diretamente do Java, voc√™ simplesmente n√£o possui ferramentas normais para entender como tudo isso √© usado.  Mas a boa not√≠cia √© que podemos influenciar essa coisa toda indiretamente, ent√£o vamos falar sobre o que est√° l√°. <br><br><img src="https://habrastorage.org/webt/pa/p_/qp/pap_qprhxuqhr59pnjx8kxrqwos.jpeg"><br>  O que √© o Java Heap √© compreens√≠vel.  O que √© o Native Heap tamb√©m √© bastante l√≥gico de se assumir.  Essas s√£o as mesmas aloca√ß√µes, apenas positivas.  Eles v√™m da estrutura e de suas bibliotecas nativas, arquivos .so e muito mais. <br><br>  O c√≥digo est√° diretamente relacionado ao armazenamento de c√≥digo.  Esse √© o tamanho do seu .dex, esse √© o seu. Ent√£o, esses s√£o os recursos, os arquivos mmap e tudo mais.  Ou seja, quanto menos c√≥digo, melhor.  A verdade mais simples que funciona em geral sobre tudo. <br><br>  Stack √© uma pilha de encadeamentos Java / C ++.  Ou seja, cada thread possui sua pr√≥pria pilha de chamadas, portanto, cada thread cria uma √°rea de mem√≥ria espec√≠fica para armazenar tudo isso. <br><br>  Gr√°ficos √© uma renderiza√ß√£o da interface do usu√°rio.  Existem bitmaps parcialmente armazenados que s√£o desenhados e o que est√° conectado a ele. <br><br>  Outro privado, Sistema - isso √© algo que n√£o podemos influenciar e, de fato, tudo o mais que n√£o √© muito categoriz√°vel. <br><br><img src="https://habrastorage.org/webt/ut/mv/ft/utmvfteatf-vvzdda5_a8f-iyvi.jpeg"><br><br>  Se falamos de bibliotecas nativas, ent√£o, digamos que voc√™ pode pegar um aplicativo vazio ... voc√™ pode pegar o aplicativo habitual que temos e tirar dumpsys dele, veja que s√£o necess√°rios 146 megabytes.  E se voc√™ cortar algo ... em particular, eu peguei e vi as duas maiores bibliotecas nativas, que temos um total de 15 megabytes, e usamos dumpsys depois disso, voc√™ pode ver facilmente que perdemos o consumo do Native Heap e do c√≥digo.  Ou seja, com um gesto t√£o simples, economizamos cerca de 35 megabytes.  N√£o √© ruim o suficiente. <br><br><img src="https://habrastorage.org/webt/zn/9r/9v/zn9r9v35dja5ndfyz4nwinzshys.jpeg"><br><br>  Streams.  Vamos fazer o teste mais f√°cil.  H√° um aplicativo vazio, e existe o mesmo aplicativo vazio, onde pegamos e fazemos um loop que far√° o novo Thread (), durma nele por cinco segundos e inicie esse thread.  Voc√™ pode ver que, nesse caso, a pilha √© muito reabastecida.  Ou seja, podemos influenciar tudo isso, mas indiretamente, reduzindo o n√∫mero de encadeamentos no c√≥digo Java.  Ou seja, por meio de objetos Java, incluindo a influ√™ncia de todos esses locais que est√£o em outros elementos. <br><br><img src="https://habrastorage.org/webt/4i/ed/mo/4iedmo77bys7vs6hv-f65oiuta0.jpeg"><br><br>  Se voc√™ continuar falando sobre threads, poder√° ver facilmente o que possui para threads, o que eles fazem no aplicativo.  Existem ferramentas diferentes.  Voc√™ pode usar o mesmo systrace, basta usar o console para encontrar o ID do seu processo e obter ps de acordo com quais threads est√£o no sistema. <br><br>  Se voc√™ se sair bem e usar todos os tipos de ThreadFactory para nomear seus threads, poder√° entender o que deveria ter, o que n√£o deveria ser e, assim, reduzir tudo, porque ter 100 threads no aplicativo √© especialmente sem sentido. <br><br>  O que mais pode ser feito?  H√° um conjunto bem conhecido de dicas de sanfona: observe vazamentos, use piscinas, n√£o crie objetos quando voc√™ n√£o precisar, e toda essa bobagem, tudo isso se aplica.  √ìtimo. <br><br>  Existe uma boa correla√ß√£o entre quanto seu aplicativo consome mem√≥ria e qual o tamanho.  Ou seja, quanto maior o seu aplicativo, mais mem√≥ria ele consumir√° e, de maneira simples, reduza o peso do APK, reduza o peso de .dex, reduza .so, remova tudo o que puder ser removido. <br><br>       . ,      ,     ,    .      ,     ?   ‚Äî         ‚Äî    ,      .   ,     ,        .       .   ‚Äî   . <br><br><img src="https://habrastorage.org/webt/3s/mv/wk/3smvwkzryvrsm1klctrsmnxtx4i.jpeg"><br>    dumpsys,   ,      ,    . ,   ,   View,  WebView,  Assets,    . <br><br><img src="https://habrastorage.org/webt/yd/m_/92/ydm_92wzagxi-1a9zpwzkeqbe8o.jpeg"><br>  ,      , , ,     ,    SharedPreference  SQLite  - , , ,   . <br><br><img src="https://habrastorage.org/webt/1f/fs/ct/1ffsctcvhhohxpwiysekmopqwzk.jpeg"><br><br> , ,      Assets.  ,  ,    ‚Äì .     1,5 . -,      ,         .    . <br><br><img src="https://habrastorage.org/webt/q5/7g/ki/q57gkiv47412jj1q9_aye3k_4e8.jpeg"><br>    ‚Äî  WebView.    ,  WebView,   ,  dumpsys,  100 ,  .  , , - ,   ,  300  ‚Äî .    ,  WebView ,    . -. <br><br><img src="https://habrastorage.org/webt/o9/pj/z8/o9pjz8exyayhtg1varn-wtsmw8i.jpeg"><br><br> Google   .    .      WebView,     Google,    - .     WebView. . <br><br><img src="https://habrastorage.org/webt/nt/lp/-q/ntlp-qwbjnysaljhmmahewkcdeq.jpeg"><br><br>    Google Go,    Android Go-.       ,     - layout    ,      .  ,      ,      ,   Chrome Tabs,  Chrome    .   . <br><br>       Android Go,    ?    ,      Android Go,      . <br><br><img src="https://habrastorage.org/webt/rm/jz/cf/rmjzcfwjkfponuuzuljvu0r088q.jpeg"><br>  Existem v√°rias maneiras. -,      ,    ,       Android Go   .     ,    , .         ,   , ,  - build ,  - ,    ,  - .        APK,       ,  ‚Äî  uses-feature ¬´low-memory¬ª,      APK. <br><br>       ,     ,      Android Go.   Google. ,  ,  Go-   . <br><br>   ,   ?  ,      ,      -       ,   : ¬´,  -  .   ¬ª.           .   ,     ,    ,      ,   ,    - ,      ,  -    .     , ,  ,    ,    Google,    Google     ,      .        ,      ,  ,   Android Go  ,       ,       . <br><br>   ,       ,       ,  -.   . <br><br><img src="https://habrastorage.org/webt/6r/wd/i-/6rwdi-8mzeuwfvvw00dh0nmdf48.jpeg"><br><h5> <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a></sup></sub> </h5><br>       ,    Google I/O:   ,          -    . ,      ,    ,  ,   ,    - ,        .    ,  ¬´       ,      .  ¬ª.     .        ,  .    ,  . <br><br>    ? ,      .  ‚Äî  ,    ,     98% .  ,         , ,    . .       -    Android Go-.  ,  YouTube Go       .    YouTube   , ,  ,   .  Eu n√£o sei   ,    Android Go    , , ,     ‚Äî    .     ‚Äî Facebook Lite, Twitter Lite,   . Lite,      -   . -,  ,      .    Facebook,    .       ,      ,    . ,    ‚Äî   ,     Android Go. <br><br>    ?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>  Stack Overflow,    1000 .      .  ,    ,    ,     . ,  ,    ‚Äî  dumpsys. <br><br>      ,  Android    ,   512   ,    Android 4.4.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> API</a>     ,     . <br><br>     ,    .    ,        .   ‚Äî   ,    . <br><br>     , : ¬´ ¬ª.  : ¬´¬ª.  .  ‚Äî  ,  .  - 170 .  .  -  .    ?      , ,  ,     ,    - .     -  ‚Äî   .  105 .  . <br><br><img src="https://habrastorage.org/webt/mv/qk/gj/mvqkgjfuippyzhhhcv0tmkosqzw.jpeg"><br>     .   build-   -.  densitySplit,     , resConfig,       .   ,  ,    ‚Äî . ProGuard   .  ,  ProGuard  ,     ,  , ,  ,       stacktraces. <br><br>      .     ,      ,      Android Go-       . <br><br>    - 64 .  : ¬´,   ¬ª.  14 ,  4 ,  60 .     ,   .  .  ,     .         ‚Äî    ,  ,  ,     ,    .     , ,  ,     Android Go,    . 10 , APK     ,  , .   ,    ,      . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a melhor solu√ß√£o √© a segunda aplica√ß√£o. </font><font style="vertical-align: inherit;">No entanto, poucas pessoas gastar√£o recursos nele, enquanto o lucro real n√£o √© claro. </font><font style="vertical-align: inherit;">Talvez sua hist√≥ria n√£o seja t√£o triste, porque eu tinha um pouco de esfor√ßo, teria escalado, mas j√° era insuport√°vel. </font><font style="vertical-align: inherit;">Mas que hist√≥ria. </font><font style="vertical-align: inherit;">Nesta nota relativamente positiva, voc√™ provavelmente pode terminar. </font><font style="vertical-align: inherit;">Obrigado a todos.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423493/">https://habr.com/ru/post/pt423493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423483/index.html">Encontrar o caminho certo para separar o conte√∫do do site usando o Webpack</a></li>
<li><a href="../pt423485/index.html">Carregamento lento de imagens usando o IntersectionObserver</a></li>
<li><a href="../pt423487/index.html">Node.js sem node_modules</a></li>
<li><a href="../pt423489/index.html">Sou m√©dico de emerg√™ncia e quero falar sobre o novo eletrocardiograma do Apple Watch</a></li>
<li><a href="../pt423491/index.html">PHP Digest No. 139 (3 a 17 de setembro de 2018)</a></li>
<li><a href="../pt423495/index.html">O que h√° no XGBoost e o que o Go tem a ver com isso?</a></li>
<li><a href="../pt423497/index.html">Vamos tentar falar sobre m√°quinas de estado hier√°rquico em geral e seu suporte no SObjectizer-5 em particular</a></li>
<li><a href="../pt423499/index.html">DevBoy - como eu criei um projeto de dispositivo de c√≥digo aberto e lancei um projeto no Kickstarter</a></li>
<li><a href="../pt423501/index.html">Pesquisa e cria√ß√£o de estilo visual para um projeto de design</a></li>
<li><a href="../pt423503/index.html">Minha experi√™ncia de me mudar, morar e estudar na Alemanha</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>