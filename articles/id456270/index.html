<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â—ï¸ ğŸ‘§ ğŸ† Redis Stream - Keandalan dan Skalabilitas Sistem Pesan Anda ğŸ–‡ï¸ ğŸ ğŸ¥š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Redis Stream - tipe data abstrak baru yang diperkenalkan di Redis dengan rilis versi 5.0 
 Secara konseptual, Redis Stream adalah Daftar yang dapat An...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redis Stream - Keandalan dan Skalabilitas Sistem Pesan Anda</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456270/"><img src="https://habrastorage.org/webt/4z/my/lg/4zmylgmptsa7q0dqxbekaq4gvai.png" alt="gambar"><br><br>  Redis Stream - tipe data abstrak baru yang diperkenalkan di Redis dengan rilis versi 5.0 <br>  Secara konseptual, Redis Stream adalah Daftar yang dapat Anda tambahkan entri.  Setiap entri memiliki pengidentifikasi unik.  Secara default, pengenal dihasilkan secara otomatis dan menyertakan stempel waktu.  Oleh karena itu, Anda dapat meminta rentang rekaman berdasarkan waktu atau menerima data baru saat tiba di aliran, karena perintah Unix tail -f membaca file log dan membeku untuk mengantisipasi data baru.  Harap dicatat bahwa beberapa klien dapat mendengarkan streaming pada saat yang sama, karena banyak proses "tail -f" dapat membaca file pada saat yang sama, tanpa saling bertentangan. <br><br>  Untuk memahami semua kelebihan dari tipe data baru, mari kita mengingat secara singkat struktur Redis yang sudah lama ada yang sebagian mengulangi fungsi Redis Stream. <br><a name="habracut"></a><br><h1>  Wisata sejarah </h1><br><h4>  Redis pub / sub </h4><br>  Redis Pub / Sub adalah sistem pesan sederhana yang sudah ada dalam penyimpanan nilai kunci Anda.  Namun, untuk kesederhanaan Anda harus membayar: <br><br><ul><li>  Jika penerbit karena alasan apa pun gagal, maka ia kehilangan semua pelanggannya </li><li>  Penerbit perlu mengetahui alamat pasti semua pelanggannya. </li><li>  Penerbit dapat membebani pelanggan berlebih jika data diterbitkan lebih cepat daripada yang diproses </li><li>  Pesan dihapus dari buffer penerbit segera setelah publikasi, terlepas dari berapa banyak pelanggan yang dikirimkan dan seberapa cepat mereka berhasil memproses pesan ini. </li><li>  Semua pelanggan akan menerima pesan secara bersamaan.  Pelanggan sendiri harus entah bagaimana sepakat di antara mereka sendiri tentang cara memproses pesan yang sama. </li><li>  Tidak ada mekanisme bawaan untuk mengonfirmasi keberhasilan pemrosesan pesan oleh pelanggan.  Jika pelanggan menerima pesan dan jatuh selama pemrosesan, penerbit tidak akan mengetahuinya. </li></ul><br><h4>  Daftar redis </h4><br>  Daftar Redis adalah struktur data yang mendukung perintah baca kunci.  Anda dapat menambah dan membaca pesan dari awal atau akhir daftar.  Atas dasar struktur ini, Anda dapat membuat tumpukan atau antrian yang bagus untuk sistem terdistribusi Anda dan ini dalam banyak kasus sudah cukup.  Perbedaan utama dari Redis Pub / Sub: <br><br><ul><li>  Pesan dikirim ke satu klien.  Klien pertama yang diblokir dengan membaca akan menerima data terlebih dahulu. </li><li>  Clint harus memulai operasi baca untuk setiap pesan.  Daftar tidak tahu apa-apa tentang klien. </li><li>  Pesan disimpan sampai seseorang menghitungnya atau menghapusnya secara eksplisit.  Jika Anda mengatur server Redis untuk menyiram data ke disk, maka keandalan sistem meningkat secara dramatis. </li></ul><br><h1>  Pengantar Stream </h1><br><h4>  Menambahkan catatan ke aliran </h4><br>  Perintah <b>XADD</b> menambahkan catatan baru ke aliran.  Catatan bukan hanya string, itu terdiri dari satu atau lebih pasangan nilai kunci.  Dengan demikian, setiap catatan sudah terstruktur dan menyerupai struktur file CSV. <br><br><pre><code class="go hljs">&gt; XADD mystream * sensor-id <span class="hljs-number"><span class="hljs-number">1234</span></span> temperature <span class="hljs-number"><span class="hljs-number">19.8</span></span> <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span></code> </pre> <br>  Dalam contoh di atas, kami menambahkan dua bidang ke aliran dengan nama (kunci) "mystream": "sensor-id" dan "temperature" dengan nilai masing-masing "1234" dan "19,8".  Sebagai argumen kedua, perintah menerima pengidentifikasi yang akan ditugaskan ke catatan - pengidentifikasi ini secara unik mengidentifikasi setiap catatan dalam aliran.  Namun, dalam hal ini, kami melewati * karena kami ingin Redis membuat pengenal baru untuk kami.  Setiap pengenal baru akan meningkat.  Oleh karena itu, setiap catatan baru akan memiliki pengidentifikasi yang lebih besar dalam kaitannya dengan catatan sebelumnya. <br><br><h4>  Format ID </h4><br>  Pengidentifikasi catatan yang dikembalikan oleh perintah <b>XADD</b> terdiri dari dua bagian: <br><br> <code>{millisecondsTime}-{sequenceNumber} <br></code> <br>  <i>millisecondsTime</i> - Waktu unix dalam milidetik (Redis waktu server).  Namun, jika waktu saat ini sama atau kurang dari waktu catatan sebelumnya, maka cap waktu catatan sebelumnya digunakan.  Oleh karena itu, jika waktu server dikembalikan ke masa lalu, pengidentifikasi baru akan tetap mempertahankan properti peningkatan. <br><br>  <i>sequenceNumber</i> digunakan untuk catatan yang dibuat dalam milidetik yang sama.  <i>sequenceNumber</i> akan ditingkatkan 1 relatif terhadap catatan sebelumnya.  Karena <i>sequenceNumber</i> berukuran 64 bit, dalam praktiknya Anda seharusnya tidak mengalami batasan jumlah rekaman yang dapat dihasilkan dalam satu milidetik. <br><br>  Format pengidentifikasi seperti itu pada pandangan pertama mungkin tampak aneh.  Pembaca yang tidak percaya mungkin bertanya-tanya mengapa waktu adalah bagian dari pengidentifikasi.  Alasannya adalah bahwa Redis streaming permintaan rentang dukungan oleh pengidentifikasi.  Karena pengidentifikasi dikaitkan dengan waktu catatan itu dibuat, ini memungkinkan untuk meminta rentang waktu.  Kita akan melihat contoh konkret ketika kita melanjutkan ke mempelajari <b>perintah XRANGE</b> . <br><br>  Jika karena alasan apa pun pengguna perlu menentukan pengenal sendiri, yang, misalnya, dikaitkan dengan beberapa sistem eksternal, maka kita dapat meneruskannya ke <b>perintah XADD</b> alih-alih tanda * seperti yang ditunjukkan di bawah ini: <br><br><pre> <code class="go hljs">&gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> field value <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> &gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span> foo bar <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span></code> </pre><br>  Harap perhatikan bahwa dalam hal ini, Anda harus memantau sendiri peningkatan pengidentifikasi.  Dalam contoh kami, pengidentifikasi minimum adalah "0-1", sehingga tim tidak akan menerima pengidentifikasi lain yang sama dengan atau kurang dari "0-1". <br><br><pre> <code class="go hljs">&gt; XADD somestream <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> foo bar (error) ERR The ID specified in XADD is equal or smaller than the target stream top item</code> </pre><br><h4>  Jumlah catatan dalam aliran </h4><br>  Anda bisa mendapatkan jumlah rekaman dalam aliran hanya dengan menggunakan perintah <b>XLEN</b> .  Sebagai contoh kita, perintah ini akan mengembalikan nilai berikut: <br><br><pre> <code class="go hljs">&gt; XLEN somestream (integer) <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><h4>  Permintaan Rentang - XRANGE dan XREVRANGE </h4><br>  Untuk meminta data rentang, kami perlu menentukan dua pengidentifikasi - awal dan akhir rentang.  Rentang yang dikembalikan akan mencakup semua elemen, termasuk perbatasan.  Ada juga dua pengidentifikasi khusus "-" dan "+", yang berarti pengidentifikasi terkecil (catatan pertama) dan terbesar (catatan terakhir) dalam aliran.  Contoh di bawah ini akan menampilkan semua entri streaming. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1234"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"19.8"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951482479</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"9999"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"18.2"</span></span></code> </pre><br>  Setiap record yang dikembalikan adalah array dari dua elemen: pengidentifikasi dan daftar pasangan nilai kunci.  Kami telah mengatakan bahwa pengidentifikasi rekaman terkait waktu.  Karena itu, kami dapat meminta rentang periode waktu tertentu.  Namun, kami dapat menentukan dalam permintaan bukan pengidentifikasi lengkap, tetapi hanya waktu Unix, menghilangkan bagian yang terkait dengan <i>sequenceNumber</i> .  Bagian yang dihilangkan dari pengidentifikasi secara otomatis sama dengan nol pada awal rentang dan ke nilai maksimum yang mungkin pada akhir rentang.  Berikut ini adalah contoh cara meminta rentang dua milidetik. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1518951480106</span></span> <span class="hljs-number"><span class="hljs-number">1518951480107</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1518951480106</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"sensor-id"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1234"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"temperature"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"19.8"</span></span></code> </pre><br>  Kami hanya memiliki satu catatan dalam kisaran ini, namun dalam set data nyata, hasil yang dikembalikan bisa sangat besar.  Untuk alasan ini, <b>XRANGE</b> mendukung opsi COUNT.  Dengan menentukan kuantitas, kita cukup mendapatkan catatan N pertama.  Jika kita perlu mendapatkan entri N berikutnya (pagination), kita dapat menggunakan pengenal terakhir yang diterima, menambah <i>sequenceNumber-</i> nya dengan satu dan meminta lagi.  Mari kita lihat ini dalam contoh berikut.  Kami mulai menambahkan 10 elemen menggunakan <b>XADD</b> (misalkan aliran mystream telah diisi dengan 10 elemen).  Untuk memulai iterasi, mendapatkan 2 elemen per perintah, kita mulai dengan rentang penuh, tetapi dengan COUNT sama dengan 2. <br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073278252</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_1"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_2"</span></span></code> </pre><br>  Untuk melanjutkan iterasi dengan dua elemen berikut, kita perlu memilih pengenal terakhir yang diterima, yaitu 1519073279157-0, dan menambahkan 1 ke <i>sequenceNumber</i> . <br>  Pengidentifikasi yang dihasilkan, dalam hal ini 1519073279157-1, sekarang dapat digunakan sebagai argumen baru ke awal rentang untuk panggilan <b>XRANGE</b> berikutnya: <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073280281</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_3"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073281432</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_4"</span></span></code> </pre><br>  Dan sebagainya.  Karena kompleksitas <b>XRANGE</b> adalah O (log (N)) untuk mencari, dan kemudian O (M) untuk mengembalikan elemen M, setiap langkah iterasi cepat.  Dengan demikian, menggunakan <b>XRANGE,</b> dimungkinkan untuk <b>beralih</b> aliran secara efisien. <br><br>  Perintah <b>XREVRANGE</b> sama dengan <b>XRANGE</b> , tetapi mengembalikan elemen dalam urutan terbalik: <br><br><pre> <code class="go hljs">&gt; XREVRANGE mystream + - COUNT <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073287312</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_10"</span></span></code> </pre><br>  Perhatikan bahwa perintah <b>XREVRANGE</b> mengambil argumen kisaran mulai dan berhenti dalam urutan terbalik. <br><br><h4>  Membaca catatan baru dengan XREAD </h4><br>  Seringkali ada tugas untuk berlangganan aliran dan hanya menerima pesan baru.  Konsep ini mungkin tampak seperti Redis Pub / Sub atau memblokir Redis List, tetapi ada perbedaan mendasar dalam cara menggunakan Redis Stream: <br><br><ol><li>  Setiap pesan baru dikirim ke setiap pelanggan secara default.  Perilaku ini berbeda dari memblokir Daftar Redis, di mana pesan baru akan dibaca oleh hanya satu pelanggan. </li><li>  Sementara di Redis Pub / Sub semua pesan dilupakan dan tidak pernah disimpan, dalam Stream semua pesan disimpan untuk waktu yang tidak terbatas (kecuali klien secara eksplisit meminta penghapusan). </li><li>  Redis Stream memungkinkan Anda untuk membedakan akses ke pesan dalam satu aliran.  Pelanggan tertentu hanya dapat melihat riwayat pesan pribadinya. </li></ol><br>  Anda dapat berlangganan aliran dan menerima pesan baru menggunakan perintah <b>XREAD</b> .  Ini sedikit lebih rumit daripada <b>XRANGE</b> , jadi kita akan mulai dengan contoh sederhana terlebih dahulu. <br><br><pre> <code class="go hljs">&gt; XREAD COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073278252</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_1"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1519073279157</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"value_2"</span></span></code> </pre><br>  Dalam contoh di atas, formulir <b>XREAD</b> non-pemblokiran <b>ditentukan</b> .  Harap perhatikan bahwa opsi COUNT adalah opsional.  Bahkan, satu-satunya opsi perintah yang diperlukan adalah opsi STREAMS, yang menetapkan daftar aliran bersama dengan pengidentifikasi maksimum yang sesuai.  Kami menulis "STREAMS mystream 0" - kami ingin mendapatkan semua catatan aliran mystream dengan pengenal yang lebih besar dari "0-0".  Seperti yang Anda lihat dari contoh, perintah mengembalikan nama aliran, karena kita dapat berlangganan beberapa aliran pada saat yang sama.  Kita bisa menulis, misalnya, "STREAMS mystream otherstream 0 0".  Harap perhatikan bahwa setelah opsi STREAMS, pertama-tama kita perlu memberikan nama semua aliran yang diperlukan dan hanya kemudian daftar pengidentifikasi. <br><br>  Dalam bentuk sederhana ini, perintah itu tidak melakukan apa-apa dibandingkan dengan <b>XRANGE</b> .  Namun, yang menarik adalah kita dapat dengan mudah mengubah <b>XREAD</b> menjadi perintah pemblokiran dengan menentukan argumen BLOCK: <br><br> <code>&gt; XREAD BLOCK 0 STREAMS mystream $ <br></code> <br>  Pada contoh di atas, opsi BLOCK baru ditentukan dengan batas waktu 0 milidetik (ini berarti menunggu tanpa akhir).  Selain itu, alih-alih melewati pengidentifikasi biasa untuk aliran mystream, $ pengidentifikasi khusus berlalu.  Pengidentifikasi khusus ini berarti bahwa <b>XREAD</b> harus menggunakan pengidentifikasi maksimum dalam aliran mystream sebagai pengidentifikasi.  Jadi kami hanya akan menerima pesan baru, mulai dari saat kami mulai mendengarkan.  Di satu sisi, ini mirip dengan perintah Unix tail -f. <br><br>  Harap dicatat bahwa ketika menggunakan opsi BLOCK, kita tidak perlu menggunakan pengenal khusus $.  Kami dapat menggunakan pengidentifikasi apa pun yang ada di aliran.  Jika tim dapat segera melayani permintaan kami, tanpa memblokir, itu akan melakukannya, jika tidak maka akan diblokir. <br><br>  Memblokir <b>XREAD</b> juga dapat mendengarkan beberapa aliran sekaligus, Anda hanya perlu menentukan nama mereka.  Dalam hal ini, perintah akan mengembalikan catatan aliran pertama ke mana data tersebut tiba.  Pelanggan pertama yang diblokir untuk aliran ini akan menerima data terlebih dahulu. <br><br><h3>  Kelompok konsumen </h3><br>  Dalam tugas-tugas tertentu, kami ingin membedakan akses pelanggan ke pesan dalam utas yang sama.  Contoh di mana ini bisa bermanfaat adalah antrian pesan dengan pekerja yang akan menerima pesan berbeda dari aliran, yang memungkinkan Anda untuk skala pemrosesan pesan. <br><br>  Jika kita membayangkan bahwa kita memiliki tiga pelanggan C1, C2, C3 dan aliran yang berisi pesan 1, 2, 3, 4, 5, 6, 7, maka layanan pesan akan terjadi seperti pada diagram di bawah ini: <br><br> <code>1 -&gt; C1 <br> 2 -&gt; C2 <br> 3 -&gt; C3 <br> 4 -&gt; C1 <br> 5 -&gt; C2 <br> 6 -&gt; C3 <br> 7 -&gt; C1 <br></code> <br>  Untuk mendapatkan efek ini, Redis Stream menggunakan konsep yang disebut Consumer Group.  Konsep ini mirip dengan pseudo-pelanggan yang menerima data dari aliran, tetapi sebenarnya dilayani oleh beberapa pelanggan dalam suatu kelompok, memberikan jaminan tertentu: <br><br><ol><li>  Setiap pesan dikirim ke pelanggan yang berbeda dalam grup. </li><li>  Dalam sebuah grup, pelanggan diidentifikasi dengan nama, yang merupakan string peka huruf besar-kecil.  Jika beberapa pelanggan keluar sementara dari grup, ia dapat dikembalikan ke grup dengan nama uniknya sendiri. </li><li>  Setiap Kelompok Konsumen mengikuti konsep "pesan pertama yang belum dibaca."  Ketika pelanggan meminta pesan baru, ia hanya dapat menerima pesan yang belum pernah dikirimkan ke pelanggan mana pun dalam suatu grup. </li><li>  Ada perintah untuk secara eksplisit mengkonfirmasi bahwa pelanggan telah berhasil memproses pesan.  Sampai perintah ini dipanggil, pesan yang diminta akan tetap dalam status "pending". </li><li>  Dalam Grup Konsumen, setiap pelanggan dapat meminta riwayat pesan yang dikirimkan kepadanya, tetapi belum diproses (dalam status "menunggu") </li></ol><br>  Dalam arti tertentu, keadaan suatu kelompok dapat direpresentasikan sebagai berikut: <br><br><pre> <code class="go hljs">+----------------------------------------+ | consumer_group_name: mygroup | consumer_group_stream: somekey | last_delivered_id: <span class="hljs-number"><span class="hljs-number">1292309234234</span></span><span class="hljs-number"><span class="hljs-number">-92</span></span> | | consumers: | <span class="hljs-string"><span class="hljs-string">"consumer-1"</span></span> with pending messages | <span class="hljs-number"><span class="hljs-number">1292309234234</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span> | <span class="hljs-number"><span class="hljs-number">1292309234232</span></span><span class="hljs-number"><span class="hljs-number">-8</span></span> | <span class="hljs-string"><span class="hljs-string">"consumer-42"</span></span> with pending messages | ... (and so forth) +----------------------------------------+</code> </pre><br>  Sekarang saatnya berkenalan dengan tim utama untuk Grup Konsumen, yaitu: <br><br><ul><li>  <b>XGROUP</b> digunakan untuk membuat, menghancurkan, dan mengelola grup. </li><li>  <b>XREADGROUP</b> digunakan untuk membaca aliran melalui grup. </li><li>  <b>XACK</b> - perintah ini memungkinkan pelanggan untuk menandai pesan sebagai berhasil diproses </li></ul><br><h4>  Pembuatan Grup Konsumen </h4><br>  Misalkan aliran mistik sudah ada.  Maka perintah pembuatan grup akan terlihat seperti: <br><br> <code>&gt; XGROUP CREATE mystream mygroup $ <br> OK <br></code> <br>  Saat membuat grup, kita harus melewati pengenal yang dimulai dengan grup yang akan menerima pesan.  Jika kami hanya ingin menerima semua pesan baru, maka kami dapat menggunakan pengenal khusus $ (seperti dalam contoh kami di atas).  Jika Anda menentukan 0 alih-alih pengidentifikasi khusus, maka semua pesan aliran akan tersedia untuk grup. <br><br>  Sekarang setelah grup dibuat, kita dapat segera mulai membaca pesan menggunakan <b>perintah XREADGROUP</b> .  Perintah ini sangat mirip dengan <b>XREAD</b> dan mendukung opsi BLOCK opsional.  Namun, ada opsi GROUP wajib, yang harus selalu ditentukan dengan dua argumen: nama grup dan nama pelanggan.  Opsi COUNT didukung juga. <br><br>  Sebelum membaca aliran, mari kita taruh beberapa pesan di sana: <br><br><pre> <code class="go hljs">&gt; XADD mystream * message apple <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message orange <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message strawberry <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message apricot <span class="hljs-number"><span class="hljs-number">1526569535168</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream * message banana <span class="hljs-number"><span class="hljs-number">1526569544280</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span></code> </pre><br>  Sekarang mari kita coba membaca aliran ini melalui grup: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Alice COUNT <span class="hljs-number"><span class="hljs-number">1</span></span> STREAMS mystream &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"apple"</span></span></code> </pre><br>  Perintah di atas kata demi kata berbunyi sebagai berikut: <br><br>  "Aku, pelanggan Alice, anggota dari mygroup, ingin membaca satu pesan dari mistik yang belum pernah dikirimkan kepada siapa pun sebelumnya." <br><br>  Setiap kali pelanggan melakukan operasi dengan grup, ia harus menunjukkan namanya, secara unik mengidentifikasi dirinya di dalam grup.  Ada detail lain yang sangat penting dalam perintah di atas - pengidentifikasi khusus "&gt;".  Pengidentifikasi khusus ini memfilter pesan, hanya menyisakan pesan yang sejauh ini belum pernah dikirimkan. <br><br>  Juga, dalam kasus khusus, Anda dapat menentukan pengidentifikasi nyata, seperti 0 atau pengidentifikasi sah lainnya.  Dalam hal ini, perintah <b>XREADGROUP</b> akan mengembalikan kepada Anda riwayat pesan dengan status "pending", yang dikirimkan ke pelanggan yang ditentukan (Alice), tetapi belum dikonfirmasi menggunakan <b>perintah XACK</b> . <br><br>  Kami dapat memverifikasi perilaku ini dengan segera menentukan pengidentifikasi 0, tanpa opsi <b>COUNT</b> .  Kami hanya melihat satu-satunya pesan yang tertunda, yaitu pesan dengan apel: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Alice STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"apple"</span></span></code> </pre><br>  Namun, jika kami mengkonfirmasi pesan tersebut telah berhasil diproses, pesan itu tidak akan ditampilkan lagi: <br><br><pre> <code class="go hljs">&gt; XACK mystream mygroup <span class="hljs-number"><span class="hljs-number">1526569495631</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; XREADGROUP GROUP mygroup Alice STREAMS mystream <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) (empty list or set)</code> </pre><br>  Sekarang giliran Bob untuk membaca sesuatu: <br><br><pre> <code class="go hljs">&gt; XREADGROUP GROUP mygroup Bob COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> STREAMS mystream &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"mystream"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"strawberry"</span></span></code> </pre><br>  Bob, anggota mygroup, meminta tidak lebih dari dua pesan.  Perintah hanya melaporkan pesan yang tidak terkirim karena pengenal khusus "&gt;".  Seperti yang Anda lihat, pesan "apel" tidak ditampilkan, karena sudah dikirim ke Alice, jadi Bob menerima "jeruk" dan "stroberi". <br><br>  Dengan demikian, Alice, Bob dan pelanggan grup lainnya dapat membaca pesan berbeda dari aliran yang sama.  Mereka juga dapat membaca riwayat pesan mentah mereka atau menandai pesan saat diproses. <br><br>  Ada beberapa hal yang perlu diingat: <br><br><ul><li>  Segera setelah pelanggan menganggap pesan sebagai perintah <b>XREADGROUP</b> , pesan ini masuk ke status "tertunda" dan ditugaskan ke pelanggan khusus ini.  Pelanggan grup lain tidak akan dapat membaca pesan ini. </li><li>  Pelanggan secara otomatis dibuat pada penyebutan pertama, tidak perlu untuk penciptaan eksplisit mereka. </li><li>  Dengan <b>XREADGROUP</b> Anda dapat membaca pesan dari beberapa aliran yang berbeda secara bersamaan, namun, agar ini berfungsi, Anda harus terlebih dahulu membuat grup dengan nama yang sama untuk setiap aliran menggunakan <b>XGROUP</b> </li></ul><br><h4>  Pemulihan Kecelakaan </h4><br>  Pelanggan dapat pulih dari kegagalan dan membaca kembali daftar pesannya dengan status "menunggu keputusan".  Namun, di dunia nyata, pelanggan pada akhirnya bisa gagal.  Apa yang terjadi pada pesan menggantung pelanggan jika dia tidak bisa pulih setelah kegagalan? <br>  Consumer Group menawarkan fitur yang digunakan khusus untuk kasus-kasus seperti itu - ketika Anda perlu mengubah pemilik pesan. <br><br>  Pertama-tama, Anda perlu memanggil perintah <b>XPENDING</b> , yang menampilkan semua pesan grup dengan status "pending".  Dalam bentuknya yang paling sederhana, sebuah perintah dipanggil hanya dengan dua argumen: nama aliran dan nama grup: <br><br><pre> <code class="go hljs">&gt; XPENDING mystream mygroup <span class="hljs-number"><span class="hljs-number">1</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span></code> </pre><br>  Tim mencetak jumlah pesan yang belum diproses untuk seluruh grup dan untuk setiap pelanggan.  Kami hanya memiliki Bob dengan dua pesan yang tidak diproses, karena satu-satunya pesan yang diminta oleh Alice telah dikonfirmasi dengan <b>XACK</b> . <br><br>  Kami dapat meminta informasi tambahan menggunakan lebih banyak argumen: <br><br> <code>XPENDING {key} {groupname} [{start-id} {end-id} {count} [{consumer-name}]] <br></code> <br>  {start-id} {end-id} - rentang pengidentifikasi (Anda dapat menggunakan "-" dan "+") <br>  {count} - jumlah upaya pengiriman <br>  {nama-konsumen} - nama grup <br><br><pre> <code class="go hljs">&gt; XPENDING mystream mygroup - + <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">74170458</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569506935</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">74170458</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Sekarang kami memiliki rincian untuk setiap pesan: pengidentifikasi, nama pelanggan, waktu henti dalam milidetik, dan akhirnya, jumlah upaya pengiriman.  Kami memiliki dua pesan dari Bob, dan tidak digunakan selama 74170458 milidetik, sekitar 20 jam. <br><br>  Harap dicatat bahwa tidak ada yang menghentikan kami untuk memeriksa apa isi pesan hanya dengan menggunakan <b>XRANGE</b> . <br><br><pre> <code class="go hljs">&gt; XRANGE mystream <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span></code> </pre><br>  Kami hanya perlu mengulangi pengidentifikasi yang sama dua kali dalam argumen.  Sekarang kami memiliki beberapa ide, Alice dapat memutuskan bahwa Bob mungkin tidak akan pulih setelah 20 jam tidak aktif, dan sekarang saatnya untuk meminta pesan-pesan ini dan melanjutkan memprosesnya alih-alih Bob.  Untuk melakukan ini, kami menggunakan perintah <b>XCLAIM</b> : <br><br> <code>XCLAIM {key} {group} {consumer} {min-idle-time} {ID-1} {ID-2} ... {ID-N} <br></code> <br>  Dengan menggunakan perintah ini, kita bisa mendapatkan pesan "asing" yang belum diproses dengan mengubah pemilik ke {konsumen}.  Namun, kami juga dapat memberikan waktu henti minimum {min-idle-time}.  Ini membantu menghindari situasi di mana dua klien mencoba mengubah pemilik pesan yang sama secara bersamaan: <br><br> <code>Client 1: XCLAIM mystream mygroup Alice 3600000 1526569498055-0 <br> Clinet 2: XCLAIM mystream mygroup Lora 3600000 1526569498055-0 <br></code> <br>  Pelanggan pertama akan mengatur ulang waktu henti dan menambah penghitung jumlah pengiriman.  Jadi klien kedua tidak akan dapat memintanya. <br><br><pre> <code class="go hljs">&gt; XCLAIM mystream mygroup Alice <span class="hljs-number"><span class="hljs-number">3600000</span></span> <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569498055</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"orange"</span></span></code> </pre><br>  Pesan itu berhasil diklaim oleh Alice, yang sekarang dapat memproses pesan dan mengakuinya. <br><br>  Dari contoh di atas, jelas bahwa eksekusi yang berhasil dari permintaan mengembalikan konten pesan itu sendiri.  Namun, ini tidak perlu.  Opsi JUSTID dapat digunakan untuk hanya mengembalikan pengidentifikasi pesan.  Ini berguna jika Anda tidak tertarik dengan detail pesan dan ingin meningkatkan kinerja sistem. <br><br><h3>  Konter pengiriman </h3><br>  Penghitung yang Anda amati dalam output <b>XPENDING</b> adalah jumlah pengiriman setiap pesan.  Penghitung seperti itu ditambahkan dalam dua cara: ketika pesan berhasil diminta melalui <b>XCLAIM</b> atau ketika panggilan <b>XREADGROUP digunakan</b> . <br><br>  Adalah normal bahwa beberapa pesan dikirim beberapa kali.  Yang utama adalah sebagai hasilnya, semua pesan diproses.  Terkadang saat memproses pesan ada masalah karena kerusakan pada pesan itu sendiri atau pemrosesan pesan menyebabkan kesalahan dalam kode handler.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam hal ini, mungkin ternyata tidak ada yang dapat memproses pesan ini. </font><font style="vertical-align: inherit;">Karena kami memiliki penghitung upaya pengiriman, kami dapat menggunakan penghitung ini untuk mendeteksi situasi seperti itu. </font><font style="vertical-align: inherit;">Oleh karena itu, segera setelah penghitung pengiriman mencapai jumlah besar yang ditentukan oleh Anda, mungkin akan lebih masuk akal untuk menempatkan pesan seperti itu di aliran lain dan mengirim pemberitahuan ke administrator sistem.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Status utas </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perintah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XINFO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digunakan untuk meminta berbagai informasi tentang aliran dan grupnya. </font><font style="vertical-align: inherit;">Sebagai contoh, bentuk dasar dari perintah adalah sebagai berikut:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO STREAM mystream <span class="hljs-number"><span class="hljs-number">1</span></span>) length <span class="hljs-number"><span class="hljs-number">2</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) radix-tree-keys <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) radix-tree-nodes <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) groups <span class="hljs-number"><span class="hljs-number">8</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>) first-entry <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1524494395530</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"a"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"1"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"b"</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>) last-entry <span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526569544280</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"message"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"banana"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perintah di atas menampilkan informasi umum pada aliran yang ditentukan. </font><font style="vertical-align: inherit;">Sekarang contoh yang sedikit lebih kompleks:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO GROUPS mystream <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"mygroup"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) consumers <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) pending <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"some-other-group"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) consumers <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) pending <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Perintah di atas menampilkan informasi umum untuk semua grup dari aliran yang ditentukan </font></font><br><br><pre> <code class="go hljs">&gt; XINFO CONSUMERS mystream mygroup <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Alice"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) pending <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) idle <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">9104628</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) name <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"Bob"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) pending <span class="hljs-number"><span class="hljs-number">4</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) idle <span class="hljs-number"><span class="hljs-number">6</span></span>) (integer) <span class="hljs-number"><span class="hljs-number">83841983</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perintah di atas menampilkan informasi tentang semua pelanggan dari aliran dan grup yang ditentukan. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda lupa sintaks perintah, cukup hubungi perintah untuk bantuan:</font></font><br><br><pre> <code class="go hljs">&gt; XINFO HELP <span class="hljs-number"><span class="hljs-number">1</span></span>) XINFO {subcommand} arg arg ... arg. Subcommands are: <span class="hljs-number"><span class="hljs-number">2</span></span>) CONSUMERS {key} {groupname} -- Show consumer groups of group {groupname}. <span class="hljs-number"><span class="hljs-number">3</span></span>) GROUPS {key} -- Show the stream consumer groups. <span class="hljs-number"><span class="hljs-number">4</span></span>) STREAM {key} -- Show information about the stream. <span class="hljs-number"><span class="hljs-number">5</span></span>) HELP -- Print this help.</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Batas Ukuran Stream </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banyak aplikasi yang tidak ingin mengumpulkan data ke dalam aliran selamanya. </font><font style="vertical-align: inherit;">Seringkali berguna untuk memiliki jumlah pesan maksimum dalam aliran. </font><font style="vertical-align: inherit;">Dalam kasus lain, penting untuk mentransfer semua pesan dari aliran ke penyimpanan persisten lain ketika ukuran aliran yang ditentukan tercapai. </font><font style="vertical-align: inherit;">Anda dapat membatasi ukuran aliran menggunakan parameter MAXLEN dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perintah XADD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="go hljs">&gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1526654998691</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XADD mystream MAXLEN <span class="hljs-number"><span class="hljs-number">2</span></span> * value <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> &gt; XLEN mystream (integer) <span class="hljs-number"><span class="hljs-number">2</span></span> &gt; XRANGE mystream - + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat menggunakan MAXLEN, catatan lama secara otomatis dihapus ketika panjang yang ditentukan tercapai, sehingga aliran memiliki ukuran konstan. </font><font style="vertical-align: inherit;">Namun, pemangkasan dalam hal ini tidak terjadi dalam cara yang paling produktif dalam memori Redis. </font><font style="vertical-align: inherit;">Situasi dapat </font><font style="vertical-align: inherit;">ditingkatkan </font><font style="vertical-align: inherit;">sebagai berikut: </font><font style="vertical-align: inherit;">Argumen ~ dalam contoh di atas berarti bahwa kita tidak perlu membatasi panjang aliran ke nilai tertentu. </font><font style="vertical-align: inherit;">Dalam contoh kami, ini bisa berupa angka yang lebih besar dari atau sama dengan 1000 (misalnya, 1000, 1010 atau 1030). </font><font style="vertical-align: inherit;">Kami hanya secara eksplisit menunjukkan bahwa kami ingin aliran kami menyimpan setidaknya 1000 catatan. </font><font style="vertical-align: inherit;">Ini membuat bekerja dengan memori jauh lebih efisien di dalam Redis. </font><font style="vertical-align: inherit;">Ada juga perintah </font><b><font style="vertical-align: inherit;">XTRIM</font></b><font style="vertical-align: inherit;"> terpisah </font><font style="vertical-align: inherit;">yang melakukan hal yang sama:</font></font><br><br> <code>XADD mystream MAXLEN ~ 1000 * ... entry fields here ... <br></code> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br> <code>&gt; XTRIM mystream MAXLEN 10 <br> <br> &gt; XTRIM mystream MAXLEN ~ 10 <br></code> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Penyimpanan dan Replikasi Persisten </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Stream direplikasi secara asinkron ke node slave dan disimpan ke file seperti AOF (snapshot semua data) dan RDB (log semua operasi penulisan). </font><font style="vertical-align: inherit;">Replikasi status Consumer Groups juga didukung. </font><font style="vertical-align: inherit;">Oleh karena itu, jika pesan dalam status "pending" pada master node, maka pada slave node pesan ini akan memiliki status yang sama.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Menghapus item individual dari aliran </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk menghapus pesan ada perintah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XDEL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> khusus </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Perintah mendapatkan nama aliran, diikuti oleh pengidentifikasi pesan yang perlu dihapus:</font></font><br><br><pre> <code class="go hljs">&gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span> &gt; XDEL mystream <span class="hljs-number"><span class="hljs-number">1526654999635</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> (integer) <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; XRANGE mystream - + COUNT <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">1526655000369</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"value"</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"3"</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saat menggunakan perintah ini, Anda perlu mempertimbangkan bahwa sebenarnya memori tidak akan segera dirilis. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Streaming Tanpa Panjang </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbedaan antara stream dan struktur data Redis lainnya adalah ketika struktur data lain tidak lagi memiliki elemen di dalam dirinya, sebagai efek samping, struktur data itu sendiri akan dihapus dari memori. </font><font style="vertical-align: inherit;">Jadi, misalnya, set yang diurutkan akan sepenuhnya dihapus ketika panggilan ZREM menghapus item terakhir. </font><font style="vertical-align: inherit;">Alih-alih, utas dibiarkan tetap dalam memori tanpa memiliki satu elemen pun di dalamnya.</font></font><br><br><h4>  Kesimpulan </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis Stream sangat ideal untuk membuat perantara pesan, antrian pesan, log terpadu, dan sistem obrolan yang menyimpan riwayat. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti yang pernah dikatakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicklaus Wirth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , program adalah algoritma plus struktur data, dan Redis sudah memberi Anda berdua.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id456270/">https://habr.com/ru/post/id456270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id456258/index.html">Gratis seperti angin dan gratis sebagai bir terjemahan "Gratis seperti dalam Kebebasan" ke dalam bahasa Rusia di bawah lisensi GNU FDL 1.3</a></li>
<li><a href="../id456260/index.html">Pembicaraan Ekonomi yang Adil</a></li>
<li><a href="../id456262/index.html">Software Defined Radio - bagaimana cara kerjanya? Bagian 9</a></li>
<li><a href="../id456264/index.html">Buat file biner Android menggunakan sumber dan Android NDK. Kami memompa utilitas screencap</a></li>
<li><a href="../id456266/index.html">Intisari materi menarik untuk pengembang ponsel # 302 (pada 10 - 16 Juni)</a></li>
<li><a href="../id456272/index.html">Apa itu Android Lint dan bagaimana ini membantu Anda menulis kode yang didukung</a></li>
<li><a href="../id456274/index.html">Psikolog: robot seks akan menyebabkan peningkatan jumlah orang tanpa pasangan yang tidak membutuhkan hubungan dengan orang lain</a></li>
<li><a href="../id456276/index.html">Apa itu informasi?</a></li>
<li><a href="../id456280/index.html">Memulai dengan stm32 atau jangan ulangi kesalahan saya</a></li>
<li><a href="../id456282/index.html">Grafik multidimensi dalam Python - dari tiga dimensi hingga enam dimensi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>