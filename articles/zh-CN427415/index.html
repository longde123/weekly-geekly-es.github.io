<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚓 👩‍👧 👩🏾‍🏫 我们使用Node.js处理大型文件和原始数据集。 📐 ☪️ 🕶️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这篇文章是全栈软件工程师Paid Nidrinhouse撰写的原始文章的翻译。 它的主要专业是JavaScript，但是Paige还研究其他语言和框架。 他与读者分享他的经验。 顺便说一下，这篇文章对初学者将很有趣。 

 最近，我面临着一个令我感兴趣的任务-有必要从美国联邦选举委员会的大量非结构化...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们使用Node.js处理大型文件和原始数据集。</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/427415/"><img src="https://cdn.lynda.com/course/612195/612195-636458390742664213-16x9.jpg"><br><br> 这篇文章是全栈软件工程师Paid Nidrinhouse撰写的原始<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章</a>的翻译。 它的主要专业是JavaScript，但是Paige还研究其他语言和框架。 他与读者分享他的经验。 顺便说一下，这篇文章对初学者将很有趣。 <br><br> 最近，我面临着一个令我感兴趣的任务-有必要从美国联邦选举委员会的大量非结构化文件中提取某些数据。 我没有对原始数据进行过多的工作，因此我决定接受挑战并承担这项任务。 作为解决此问题的工具，我选择了Node.js。 <br><a name="habracut"></a><br><blockquote>  <b>Skillbox建议：</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">前端开发人员职业</a>在线课程。 <br><br>  <b>我们提醒您：</b> <i>对于所有“哈勃”读者来说，使用“哈勃”促销代码注册任何Skillbox课程时均可享受10,000卢布的折扣。</i> </blockquote><br> 任务描述了四点： <br><ul><li> 程序应计算文件中的总行数。 </li><li> 每八列包含一个人的名字。 您需要加载此数据并使用文件中包含的所有名称创建一个数组。 必须显示第432和43,243名。 </li><li> 第五列包含志愿者的捐赠日期。 计算每个月有多少总捐款，并打印总结果。 </li><li> 每八列包含一个人的名字。 通过仅选择名字而不选择名字来创建数组。 找出最常发现的名字和次数？ </li></ul><br>  （原始任务可以<a href="">在此链接上查看</a> 。） <br><br> 您需要使用的文件是2.55 GB的常规.txt。 还有一个包含主文件各部分的文件夹（您可以在其上调试程序，而不必分析整个庞大的数组）。 <br><br><h3>  Node.js上的两种可能的解决方案 </h3><br> 原则上，处理大文件不会使JavaScript专家感到恐惧。 另外，这是Node.js的主要功能之一。 有几种读取和写入文件的解决方案。 <br><br> 熟悉的是fs.readFile（）。 它允许您读取整个文件，并将其放入内存，然后使用Node。 <br><br> 另一种选择是fs.createReadStream（），该函数传递的数据类似于使用其他语言（例如，Python或Java）进行组织的方式。 <br><br><h3> 我选择的解决方案 </h3><br> 由于我需要计算总行数并解析数据以解析名称和日期，因此我决定停止第二种选择。 在这里，我可以使用rl.on（'line'，...）函数从行中获取必要的数据。 <br><br>  Node.js CreateReadStream（）和ReadFile（）代码 <br><br> 下面是我使用Node.js和fs.createReadStream（）函数编写的代码。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abf/204/974/abf204974b1bef6c81c2c6eca0422810.png"><br><br> 最初，我需要进行所有设置，意识到导入数据需要Node.js函数，例如fs（文件系统），readline和stream。 接下来，我能够与readLine.createInterface（）一起创建上游和下游。 生成的代码使得可以逐行解析文件，并获取必要的数据。 <br><br> 此外，我添加了一些变量和注释来处理特定数据。 它们是lineCount，dupeNames和名称，donation和firstNames的数组。 <br><br> 在rl.on（'line'，...）函数中，我能够逐行设置文件解析。 因此，我为每行输入lineCount变量。 我使用JavaScript split（）方法通过将名称添加到我的名称数组中来解析名称。 接下来，我仅分隔没有姓氏的名称，同时突出显示例外，例如双名的存在，名称中间的缩写等。 接下来，我将年和日期与数据列分开，将所有这些都转换为YYYY-MM格式，并将dateDonationCount添加到数组中。 <br><br> 在rl.on（'close'，...）函数中，我使用console.log中接收到的信息对添加到数组的数据进行了所有转换。 <br><br> 需要lineCount和名称来确定第432和43,243的名称；此处无需进行任何转换。 但是，确定数组中最常用的名称以及确定捐赠数量是更加复杂的任务。 <br><br> 为了识别最常用的名称，我必须为每个名称（键）和对Object.entries的引用数创建一个值对的对象。  （值），然后使用ES6函数将其全部转换为数组数组。 之后，对名称进行排序并确定重复最多的任务就不再困难了。 <br><br> 通过捐赠，我做了大约相同的技巧：我创建了一个值对对象和logDateElements（）函数，该函数允许我使用ES6插值显示每个月的键和值。 然后，我创建了新的Map（），将dateDonations对象转换为metamarray，并使用logDateElements（）遍历每个数组。  （结果并不像开始时那样简单。） <br><br> 但是它确实有效，我能够读取一个相对较小的400 MB文件，突出显示了必要的信息。 <br><br> 在那之后，我尝试了fs.createReadStream（）-我在fs.readFile（）上实现了任务，以查看区别。 这是代码： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ad/a88/bb4/7ada88bb45dccc0c25dbb1b68c395954.png"><br><br> 您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>查看整个解决方案。 <br><br><h3> 使用Node.js的结果 </h3><br> 事实证明该解决方案正在工作。 我将路径添加到readFileStream.js文件，并...看到节点服务器崩溃，并显示JavaScript堆内存不足错误。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/068/398/a34/068398a34e2711c9741e7cddd12cc360.png"><br><br> 事实证明，尽管一切正常，但是此解决方案尝试将文件的全部内容传输到内存，而2.55 GB的容量是不可能的。  Node可以同时使用1.5 GB内存运行，仅此而已。 <br><br> 因此，我没有做出任何决定。 它花了一个新的文件，甚至可以处理如此大量的文件。 <br><br><h3> 新解决方案 </h3><br> 事实证明，有必要使用流行的NPM模块EventStream。 <br><br> 研究了文档之后，我能够理解需要做什么。 这是程序代码的第三个版本。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4f/66f/007/f4f66f007743c8fcf4d31f3699839419.png"><br><br> 该模块的文档指出，应在txt文件每一行的末尾使用\ n字符将数据流划分为单独的元素。 <br><br> 基本上，我唯一需要更改的是名称响应。 我无法将1.3亿个名称放入数组中-再次出现内存不足错误。 我通过计算第432位和第43,243位名称并将它们添加到我自己的数组中来解决了这个问题。 情况不是问条件，而是谁说你不能创造力？ <br><br><h3> 第二轮。我们在工作中尝试该程序 </h3><br> 是的，所有相同的文件，容量为2.55 GB，我们不由自主地遵循结果。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e80/665/c38/e80665c386ede41e173fd684b731999e.png"><br><br> 成功！ <br><br> 事实证明，仅Node.js不适合解决此类问题，其功能有所限制。 但是使用模块扩展它们，您可以使用如此大的文件。 <br><br><blockquote>  <b>Skillbox建议：</b> <br><br><ul><li> 实践课程<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Web开发人员专业”</a> 。 </li><li> 实用课程<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Mobile Developer PRO”</a> 。 </li><li> 一年一度的实用课程<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ PHP开发人员从零开始到PRO”</a> 。 </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427415/">https://habr.com/ru/post/zh-CN427415/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427403/index.html">ReportingObserver API：以新的角度看待网页代码</a></li>
<li><a href="../zh-CN427405/index.html">ES2018-最终承诺方法</a></li>
<li><a href="../zh-CN427407/index.html">误差最小化的元集群，以及为什么我认为大脑以这种方式工作</a></li>
<li><a href="../zh-CN427409/index.html">该书“辉煌的敏捷。 使用敏捷，Scrum和看板的灵活项目管理»</a></li>
<li><a href="../zh-CN427413/index.html">争夺资源，第4部分：太好了</a></li>
<li><a href="../zh-CN427417/index.html">对8英寸的软盘充满幽默感（在70年代只有这样）</a></li>
<li><a href="../zh-CN427419/index.html">当处理器无关时该怎么办？</a></li>
<li><a href="../zh-CN427421/index.html">家谱网站如何使杀手更容易</a></li>
<li><a href="../zh-CN427423/index.html">City2Share：慕尼黑物流中心的电动和自动驾驶汽车</a></li>
<li><a href="../zh-CN427427/index.html">他们如何进入IT领域：关于实习生和傻瓜（“我的圈子”民意调查的结果）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>