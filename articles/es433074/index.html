<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëßüèæ üë©üèæ‚Äçüíª üå™Ô∏è Cambiar a Kotlin en un proyecto de Android: consejos y trucos üë©üèª‚Äçü§ù‚Äçüë®üèΩ ü§∂üèª üë®üèº‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publicado por Sergey Yeshin, Desarrollador de Android Strong Middle, DataArt 

 Ha pasado m√°s de un a√±o y medio desde que Google anunci√≥ el soporte of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cambiar a Kotlin en un proyecto de Android: consejos y trucos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/433074/"><img src="https://habrastorage.org/webt/ss/no/sd/ssnosdopahysny9zaa0gevj_u54.jpeg"><br>  <i>Publicado por Sergey Yeshin, Desarrollador de Android Strong Middle, DataArt</i> <br><br>  Ha pasado m√°s de un a√±o y medio desde que Google anunci√≥ el soporte oficial para Kotlin en Android, y los desarrolladores m√°s experimentados comenzaron a experimentar con √©l en su combate y no en proyectos de hace m√°s de tres a√±os. <br><br>  El nuevo idioma fue recibido calurosamente en la comunidad de Android, y la gran mayor√≠a de los nuevos proyectos de Android comenzar√°n con Kotlin a bordo.  Tambi√©n es importante que Kotlin compile en un c√≥digo de bytes JVM, por lo tanto, es totalmente compatible con Java.  Entonces, en los proyectos de Android existentes escritos en Java, tambi√©n existe la oportunidad (adem√°s, una necesidad) de usar todas las caracter√≠sticas de Kotlin, gracias a lo cual gan√≥ tantos admiradores. <br><br>  En el art√≠culo, hablar√© sobre la experiencia de migrar una aplicaci√≥n de Android de Java a Kotlin, las dificultades que tuvieron que superarse en el proceso, y explicar√© por qu√© todo esto no fue en vano.  El art√≠culo est√° m√°s dirigido a los desarrolladores de Android que reci√©n comienzan a aprender Kotlin y, adem√°s de la experiencia personal, se basa en los materiales de otros miembros de la comunidad. <a name="habracut"></a><br><br><h2>  ¬øPor qu√© Kotlin? </h2><br>  Describa brevemente las caracter√≠sticas de Kotlin, por lo que cambi√© a √©l en el proyecto, dejando el mundo Java "c√≥modo y dolorosamente familiar": <br><br><ol><li>  Compatibilidad completa con Java </li><li>  Seguridad nula </li><li>  Inferencia de tipos </li><li>  M√©todos de extensi√≥n </li><li>  Funciona como objetos de primera clase y lambda. </li><li>  Gen√©ricos </li><li>  Corutinas </li><li>  Sin excepci√≥n marcada </li></ol><br><h2>  Aplicaci√≥n DISCO </h2><br>  Esta es una aplicaci√≥n de tama√±o peque√±o para el intercambio de tarjetas de descuento, que consta de 10 pantallas.  Usando su ejemplo, consideraremos la migraci√≥n. <br><br><h3>  Brevemente sobre arquitectura </h3><br>  La aplicaci√≥n utiliza la arquitectura MVVM con componentes de arquitectura de Google bajo el cap√≥: ViewModel, LiveData, Room. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oe/n1/e4/oen1e4fepl7q4ff8zdth-jxwjlk.png"></div><br>  Adem√°s, de acuerdo con los principios de Clean Architecture de Uncle Bob, seleccion√© 3 capas en la aplicaci√≥n: datos, dominio y presentaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/em/o4/rz/emo4rzbpvpeadmnhzucuyhhtzpq.png"></div><br>  Por donde empezar  Entonces, imaginamos las caracter√≠sticas principales de Kotlin y tenemos una idea m√≠nima del proyecto que debe migrarse.  La pregunta natural es "¬øpor d√≥nde empezar?". <br><br>  La p√°gina oficial de documentaci√≥n de Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Comenzando con Kotlin</a> dice que si desea portar una aplicaci√≥n existente a Kotlin, solo tiene que comenzar a escribir pruebas unitarias.  Cuando adquiera un poco de experiencia con este lenguaje, escriba un nuevo c√≥digo en Kotlin, solo necesita convertir el c√≥digo Java existente. <br><br>  Pero hay un "pero".  De hecho, una conversi√≥n simple generalmente (aunque no siempre) le permite obtener un c√≥digo de trabajo en Kotlin, sin embargo, su modismo deja mucho que desear.  Adem√°s, le dir√© c√≥mo eliminar esta brecha debido a las caracter√≠sticas mencionadas (y no solo) del lenguaje Kotlin. <br><br><h2>  Migraci√≥n de capa </h2><br>  Como la aplicaci√≥n ya est√° en capas, tiene sentido migrar por capas, comenzando desde la parte superior. <br><br>  La secuencia de capas durante la migraci√≥n se muestra en la siguiente imagen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kp/oq/k_/kpoqk_8rpc0xg9qstzecyrlp_is.png"></div><br>  No es casualidad que comenzamos la migraci√≥n precisamente desde la capa superior.  De este modo nos ahorramos el uso del c√≥digo Kotlin en el c√≥digo Java.  Por el contrario, hacemos que el c√≥digo de Kotlin de la capa superior use las clases Java de la capa inferior.  El hecho es que Kotlin se dise√±√≥ originalmente teniendo en cuenta la necesidad de interactuar con Java.  El c√≥digo Java existente puede llamarse desde Kotlin de forma natural.  Podemos heredar f√°cilmente de las clases Java existentes, acceder a ellas y aplicar anotaciones Java a las clases y m√©todos de Kotlin.  El c√≥digo de Kotlin tambi√©n se puede usar en Java sin demasiados problemas, pero a menudo requiere un esfuerzo adicional, como agregar una anotaci√≥n JVM.  ¬øY por qu√© hacer conversiones innecesarias en el c√≥digo Java, si al final todav√≠a se reescribir√° en Kotlin? <br><br>  Por ejemplo, veamos la generaci√≥n de sobrecarga. <br><br>  Por lo general, si escribe una funci√≥n de Kotlin con valores de par√°metros predeterminados, solo ser√° visible en Java como una firma completa con todos los par√°metros.  Si desea proporcionar m√∫ltiples sobrecargas a las llamadas Java, puede usar la anotaci√≥n @JvmOverloads: <br><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JvmOverloads</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Double</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-number"><span class="hljs-number">0.0</span></span>) { <span class="hljs-meta"><span class="hljs-meta">@JvmOverloads</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: String, b: Int = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, c: String = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"abc"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br>  Para cada par√°metro con un valor predeterminado, esto crear√° una sobrecarga adicional, que tiene este par√°metro y todos los par√°metros a la derecha, en la lista de par√°metros remotos.  En este ejemplo, se crear√° lo siguiente: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Constructors: Foo(int x, double y) Foo(int x) // Methods void f(String a, int b, String c) { } void f(String a, int b) { } void f(String a) { }</span></span></code> </pre> <br>  Hay muchos ejemplos del uso de anotaciones JVM para el correcto funcionamiento de Kotlin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Esta p√°gina de documentaci√≥n</a> detalla la llamada a Kotlin desde Java. <br><br>  Ahora describimos el proceso de migraci√≥n capa por capa. <br><br><h3>  Capa de presentaci√≥n </h3><br>  Esta es una capa de interfaz de usuario que contiene pantallas con vistas y un ViewModel, que a su vez contiene propiedades en forma de LiveData con datos del modelo.  A continuaci√≥n, observamos los trucos y herramientas que resultaron √∫tiles al migrar esta capa de aplicaci√≥n. <br><br><h4>  1. Procesador de anotaciones Kapt </h4><br>  Al igual que con cualquier MVVM, View est√° vinculado a las propiedades de ViewModel a trav√©s del enlace de datos.  En el caso de Android, estamos tratando con la Biblioteca de enlace de datos de Android, que utiliza el procesamiento de anotaciones.  Entonces Kotlin tiene <b>su propio procesador de anotaciones</b> , y si no realiza cambios en el archivo build.gradle correspondiente, el proyecto dejar√° de compilarse.  Por lo tanto, haremos estos cambios: <br><br><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-kapt'</span></span> android { dataBinding { enabled = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } } dependencies { <span class="hljs-function"><span class="hljs-function">api </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'libs'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">///‚Ä¶ kapt "com.android.databinding:compiler:$android_plugin_version" }</span></span></span></span></code> </pre><br>  Es importante recordar que debe reemplazar por completo todas las apariciones de la configuraci√≥n de AnnotationProcessor en su build.gradle con kapt. <br><br>  Por ejemplo, si usa las bibliotecas Dagger o Room en el proyecto, que tambi√©n usan el procesador de anotaciones bajo el cap√≥ para la generaci√≥n de c√≥digo, debe especificar kapt como el procesador de anotaciones. <br><br><h4>  2. Funciones en l√≠nea </h4><br>  Al marcar una funci√≥n como en l√≠nea, le pedimos al compilador que la coloque en el lugar de uso.  El cuerpo de la funci√≥n se incrusta, en otras palabras, se sustituye por el uso habitual de la funci√≥n.  Gracias a esto, podemos eludir la restricci√≥n de borrado de tipo, es decir, borrar un tipo.  Al usar funciones en l√≠nea, podemos obtener el tipo (clase) en tiempo de ejecuci√≥n. <br><br>  Esta caracter√≠stica de Kotlin se us√≥ en mi c√≥digo para "extraer" la clase de la Actividad lanzada. <br><br><pre> <code class="scala hljs">inline fun &lt;reified <span class="hljs-type"><span class="hljs-type">T</span></span> : <span class="hljs-type"><span class="hljs-type">Activity</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Context</span></span>?.startActivity(args: <span class="hljs-type"><span class="hljs-type">Bundle</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>?.let { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> intent = <span class="hljs-type"><span class="hljs-type">Intent</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-type"><span class="hljs-type">T</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">intent</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">putExtras</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">args</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">it</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">startActivity</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">intent</span></span></span><span class="hljs-class">) } }</span></span></code> </pre> <br>  reified: designaci√≥n de un tipo reified. <br><br>  En el ejemplo descrito anteriormente, tambi√©n mencionamos una caracter√≠stica del lenguaje Kotlin como Extensiones. <br><br><h4>  3. Extensiones </h4><br>  Son extensiones.  Los m√©todos de utilidad se eliminaron en extensiones, lo que ayud√≥ a evitar utilidades de clase hinchadas y monstruosas. <br><br>  Dar√© un ejemplo de las extensiones involucradas en la aplicaci√≥n: <br><br><pre> <code class="scala hljs">fun <span class="hljs-type"><span class="hljs-type">Context</span></span>.inflate(res: <span class="hljs-type"><span class="hljs-type">Int</span></span>, parent: <span class="hljs-type"><span class="hljs-type">ViewGroup</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>): <span class="hljs-type"><span class="hljs-type">View</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">LayoutInflater</span></span>.from(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).inflate(res, parent, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } fun &lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Collection</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;?.isNotNullOrEmpty(): <span class="hljs-type"><span class="hljs-type">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; isNotEmpty(); } fun <span class="hljs-type"><span class="hljs-type">Fragment</span></span>.hideKeyboard() { view?.let { hideKeyboard(activity, it.windowToken) } }</code> </pre> <br>  Los desarrolladores de Kotlin pensaron de antemano en √∫tiles extensiones de Android al ofrecer su complemento Kotlin Android Extensions.  Entre las caracter√≠sticas que ofrece se encuentran el enlace de visualizaci√≥n y el soporte parcelable.  Puede encontrar informaci√≥n detallada sobre las caracter√≠sticas de este complemento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h4>  4. Funciones Lambda y funciones de orden superior. </h4><br>  Usando las funciones lambda en el c√≥digo de Android, puede deshacerse del torpe ClickListener y la devoluci√≥n de llamada, que en Java se implementaron a trav√©s de interfaces autoescritas. <br><br>  Un ejemplo de uso de una lambda en lugar de onClickListener: <br><br><pre> <code class="java hljs">button.setOnClickListener({ doSomething() })</code> </pre> <br>  Las lambdas tambi√©n se utilizan en funciones de orden superior, por ejemplo, para funciones de recopilaci√≥n. <br><br>  Tome el <b>mapa como</b> ejemplo: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T, R&gt;</span></span></span><span class="hljs-function"> List</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(transform: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; R): List&lt;R&gt; {...}</code> </pre> <br>  Hay un lugar en mi c√≥digo donde necesito "mapear" la identificaci√≥n de las tarjetas para su posterior eliminaci√≥n. <br><br>  Usando la expresi√≥n lambda pasada al mapa, obtengo la matriz de id deseada: <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ids = cards.map { it.id }.toIntArray() cardDao.deleteCardsByIds(ids)</code> </pre> <br>  Tenga en cuenta que los par√©ntesis se pueden omitir cuando se llama a la funci√≥n, si lambda es el √∫nico argumento, y la palabra clave es el nombre impl√≠cito del √∫nico par√°metro. <br><br><h4>  5. Tipos de plataforma </h4><br>  Inevitablemente, tendr√° que trabajar con los SDK escritos en Java (incluido, de hecho, el SDK de Android).  Esto significa que siempre debe estar en guardia con Kotlin y Java Interop, como los tipos de plataforma. <br><br>  Un tipo de plataforma es un tipo para el que Kotlin no puede encontrar informaci√≥n de validez nula.  El hecho es que, de forma predeterminada, el c√≥digo Java no contiene informaci√≥n sobre la validez de nulo, y las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">anotaciones NotNull</a> y @ Nullable no siempre se usan.  Cuando no hay una anotaci√≥n correspondiente en Java, el tipo se convierte en plataforma.  Puede trabajar con √©l como un tipo que permite nulo y como un tipo que no permite nulo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zw/r_/cu/zwr_cuwc3ajqxcsezq1b0zqcwyw.png"></div><br>  Esto significa que, al igual que en Java, el desarrollador es totalmente responsable de las operaciones con este tipo.  El compilador no agrega un tiempo de ejecuci√≥n de verificaci√≥n nula y le permitir√° hacer todo. <br><br>  En el siguiente ejemplo, anulamos onActivityResult en nuestra actividad: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(requestCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, resultCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Intent</span></span></span></span><span class="hljs-function"><span class="hljs-params">{ </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">super</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">onActivityResult</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">requestCode</span></span></span></span><span class="hljs-function"><span class="hljs-params">, resultCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> randomString = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.getStringExtra(<span class="hljs-string"><span class="hljs-string">"some_string"</span></span>) }</code> </pre> <br>  En este caso, los datos son un tipo de plataforma que puede contener nulo.  Sin embargo, desde el punto de vista del c√≥digo de Kotlin, los datos no pueden ser nulos bajo ninguna circunstancia, e independientemente de si especifica el tipo de Intento como anulable, no recibir√° una advertencia o error del compilador, ya que ambas versiones de la firma son v√°lidas .  Pero dado que recibir datos no vac√≠os no est√° garantizado, porque en casos con el SDK no puede controlar esto, obtener nulo en este caso conducir√° a NPE. <br><br>  Adem√°s, como ejemplo, podemos enumerar los siguientes lugares de la posible aparici√≥n de tipos de plataforma: <br><br><ol><li>  Service.onStartCommand (), donde la intenci√≥n puede ser nula. </li><li>  BroadcastReceiver.onReceive (). </li><li>  Activity.onCreate (), Fragment.onViewCreate () y otros m√©todos similares. </li></ol><br>  Adem√°s, sucede que los par√°metros del m√©todo est√°n anotados, pero por alguna raz√≥n el estudio pierde Nullability al generar una anulaci√≥n. <br><br><h3>  Capa de dominio </h3><br>  Esta capa incluye toda la l√≥gica de negocios; es responsable de la interacci√≥n entre la capa de datos y la capa de presentaci√≥n.  El papel clave aqu√≠ lo desempe√±a el repositorio.  En Repository, llevamos a cabo las manipulaciones de datos necesarias, tanto del lado del servidor como locales.  Arriba, a la capa Presentaci√≥n, solo damos el m√©todo de interfaz de Repositorio, que oculta la complejidad de las operaciones de datos. <br><br>  Como se indic√≥ anteriormente, RxJava se utiliz√≥ para la implementaci√≥n. <br><br><h4>  1. RxJava </h4><br>  Kotlin es totalmente compatible con RxJava y m√°s conciso junto con √©l que Java.  Sin embargo, incluso aqu√≠ tuve que enfrentar un problema desagradable.  Suena as√≠: si pasa una lambda como par√°metro del m√©todo <b>andThen</b> , ¬°esta lambda no funcionar√°! <br><br>  Para verificar esto, simplemente escriba una prueba simple: <br><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">Completable</span></span> .fromCallable { cardRepository.uploadDataToServer() } .andThen { cardRepository.markLocalDataAsSynced() } .subscribe()</code> </pre> <br>  <b>Y luego el</b> contenido fallar√°.  Este es el caso con la mayor√≠a de los operadores (como <b>flatMap</b> , <b>diferir</b> , <b>fromAction</b> y muchos otros), realmente se espera lambda como argumentos.  Y con tal registro con <b>andThen</b> , se <b>espera</b> <b>Completable / Observable / SingleSource</b> .  El problema se resuelve usando par√©ntesis ordinarios () en lugar de rizado {}. <br><br>  Este problema se describe en detalle en el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Kotlin y Rx2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo perd√≠ 5 horas debido a los corchetes incorrectos "</a> . <br><br><h4>  2. Reestructuraci√≥n </h4><br>  Tambi√©n tocamos sintaxis de Kotlin tan interesante como la desestructuraci√≥n o la <i>asignaci√≥n de desestructuraci√≥n</i> .  Le permite asignar un objeto a varias variables a la vez, dividi√©ndolo en partes. <br><br>  Imagine que tenemos un m√©todo en la API que devuelve varias entidades a la vez: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/foo/api/sync"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBrandsAndCards</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Single&lt;BrandAndCardResponse&gt; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BrandAndCardResponse</span></span></span></span>(<span class="hljs-meta"><span class="hljs-meta">@SerializedName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cards"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cards: List&lt;Card&gt;?, <span class="hljs-meta"><span class="hljs-meta">@SerializedName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"brands"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> brands: List&lt;Brand&gt;?)</code> </pre><br>  Una forma compacta de devolver el resultado de este m√©todo es la desestructuraci√≥n, como se muestra en el siguiente ejemplo: <br><br><pre> <code class="scala hljs">syncRepository.getBrandsAndCards() .flatMapCompletable {it-&gt; <span class="hljs-type"><span class="hljs-type">Completable</span></span>.fromAction{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> (cards, brands) = it syncCards(cards) syncBrands(brands) } } }</code> </pre> <br>  Vale la pena mencionar que las declaraciones m√∫ltiples se basan en convenciones: las clases que se supone que deben destruirse deben contener funciones N (), donde N es el n√∫mero de componente correspondiente, un miembro de la clase.  Es decir, el ejemplo anterior se traduce en el siguiente c√≥digo: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cards = it.component1() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> brands = it.component2()</code> </pre> <br>  Nuestro ejemplo utiliza una clase de datos que declara autom√°ticamente las funciones componentesN ().  Por lo tanto, las declaraciones m√∫ltiples funcionan con √©l fuera de la caja. <br><br>  Hablaremos m√°s sobre la clase de datos en la siguiente parte, dedicada a la capa de datos. <br><br><h3>  Capa de datos </h3><br>  Esta capa incluye POJO para datos del servidor y la base, interfaces para trabajar con datos locales y datos recibidos del servidor. <br><br>  Para trabajar con datos locales, se utiliz√≥ Room, que nos proporciona un contenedor conveniente para trabajar con la base de datos SQLite. <br><br>  El primer objetivo para la migraci√≥n, que se sugiere, son los POJO, que en el c√≥digo est√°ndar de Java son clases masivas con muchos campos y sus correspondientes m√©todos get / set.  Puede hacer que POJO sea m√°s conciso con la ayuda de las clases de datos.  Una l√≠nea de c√≥digo ser√° suficiente para describir una entidad con m√∫ltiples campos: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Card</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id:String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cardNumber:String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> brandId:String,<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> barCode:String)</code> </pre><br>  Adem√°s de la concisi√≥n, obtenemos: <br><br><ul><li>  Invalida los m√©todos <b>equals ()</b> , <b>hashCode ()</b> y <b>toString ()</b> debajo del cap√≥.  Generar iguales para todas las propiedades de la clase de datos es extremadamente conveniente cuando se usa DiffUtil en un adaptador que genera vistas para RecyclerView.  El hecho es que DiffUtil compara dos conjuntos de datos, dos listas: la antigua y la nueva, descubre qu√© cambios se han producido y, al utilizar m√©todos de notificaci√≥n, se actualiza de manera √≥ptima el adaptador.  Y t√≠picamente, los elementos de la lista se comparan usando iguales. <br><br>  Por lo tanto, despu√©s de agregar un nuevo campo a la clase, no necesitamos agregarlo a iguales para que DiffUtil tenga en cuenta el nuevo campo. </li><li>  Clase inmutable </li><li>  Compatibilidad con los valores predeterminados, que pueden reemplazarse mediante el uso del patr√≥n Builder. <br><br>  Un ejemplo: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Card</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id : <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span> = <span class="hljs-number"><span class="hljs-number">0L</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cardNumber: String=<span class="hljs-string"><span class="hljs-string">"99"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> barcode: String = <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> brandId: String=<span class="hljs-string"><span class="hljs-string">"1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> newCard = Card(id =<span class="hljs-number"><span class="hljs-number">1L</span></span>,cardNumber = <span class="hljs-string"><span class="hljs-string">"123"</span></span>)</code> </pre> </li></ul><br>  Otra buena noticia: con kapt configurado (como se describi√≥ anteriormente), las clases de datos funcionan bien con las anotaciones de sala, lo que le permite traducir todas las entidades de la base de datos en clases de datos.  Room tambi√©n admite propiedades anulables.  Es cierto que Room todav√≠a no admite los valores predeterminados de Kotlin, pero el error correspondiente ya se ha instituido para esto. <br><br><h2>  Conclusiones </h2><br>  Examinamos solo algunas trampas que pueden surgir durante la migraci√≥n de Java a Kotlin.  Es importante que, aunque surjan problemas, especialmente con la falta de conocimiento te√≥rico o experiencia pr√°ctica, todos puedan resolverse. <br><br>  Sin embargo, el placer de escribir un c√≥digo conciso, expresivo y seguro en Kotlin compensar√° con creces todas las dificultades que surjan en el camino de transici√≥n.  Puedo decir con confianza que el ejemplo del proyecto DISCO ciertamente confirma esto. <br><br><h3>  Libros, enlaces √∫tiles, recursos. </h3><br><ol><li>  La base te√≥rica del conocimiento del idioma permitir√° colocar el libro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kotlin en acci√≥n</a> de los creadores del idioma Svetlana Isakova y Dmitry Zhemerov. <br><br>  El laconismo, la informaci√≥n, la amplia cobertura de temas, el enfoque en los desarrolladores de Java y la disponibilidad de una versi√≥n en ruso lo convierten en el mejor de los manuales posibles al comienzo del aprendizaje de idiomas.  Empec√© con ella. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes de</a> Kotlin con developer.android. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gu√≠a de Kotlin en ruso</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un excelente art√≠culo de</a> Konstantin Mikhailovsky, desarrollador de Android de Genesis, sobre la experiencia de cambiar a Kotlin. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433074/">https://habr.com/ru/post/es433074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433062/index.html">AXIS P1367 versus IDIS DC-B3303X: Comparar c√°maras CCTV</a></li>
<li><a href="../es433064/index.html">Gesti√≥n de incidentes: "no puede darse por vencido" o el arte de colocar comas</a></li>
<li><a href="../es433066/index.html">HighLoad Cup # 2. Campeonato para desarrolladores de back-end de nuevo en servicio</a></li>
<li><a href="../es433070/index.html">C√≥mo distinguir champ√∫ de champi√±ones y brochetas de champ√°n ... Elasticsearch: busque productos en las bases de datos de la tienda</a></li>
<li><a href="../es433072/index.html">C√≥mo hackear la protecci√≥n de copia de la consola Sega Dreamcast</a></li>
<li><a href="../es433076/index.html">C√≥mo creamos nuestra biblioteca de la Galer√≠a de Android para ver contenido multimedia</a></li>
<li><a href="../es433078/index.html">Escribimos robots comerciales utilizando el marco gr√°fico StockSharp. Parte 2</a></li>
<li><a href="../es433082/index.html">Bombear las cuentas de otras personas se ha convertido en un delito penal en Corea del Sur</a></li>
<li><a href="../es433084/index.html">Lecci√≥n abierta "Ingenier√≠a de caracter√≠sticas en el ejemplo del cl√°sico conjunto de datos Titanic"</a></li>
<li><a href="../es433086/index.html">Tinkoff y todo, todo, todo: IoT, an√°lisis y vigilancia para bancos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>