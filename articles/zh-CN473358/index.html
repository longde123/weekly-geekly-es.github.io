<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â¬›ï¸ ğŸ ğŸ§—ğŸ¾ ä½¿ç”¨åŸºç¡€æ¶æ„ä½œä¸ºä»£ç æ–¹æ³•å®‰è£…å’Œé…ç½®Nexus Sonatype ğŸ‘¨ğŸ»â€ğŸŒ¾ ğŸ‘©ğŸ¾â€ğŸ¤ ğŸ”¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sonatype Nexusæ˜¯ä¸€ä¸ªé›†æˆå¹³å°ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å®ƒæ¥ä»£ç†ï¼Œå­˜å‚¨å’Œç®¡ç†Javaï¼ˆMavenï¼‰ä¾èµ–é¡¹ï¼ŒDockerï¼ŒPythonï¼ŒRubyï¼ŒNPMï¼ŒBowerå›¾åƒï¼ŒRPMè½¯ä»¶åŒ…ï¼Œgitlfsï¼ŒAptï¼ŒGoï¼ŒNugetï¼Œä»¥åŠåˆ†å‘å…¶è½¯ä»¶è§„å®šã€‚ 
 ä¸ºä»€ä¹ˆéœ€è¦Sonatype Nexusï¼Ÿ 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨åŸºç¡€æ¶æ„ä½œä¸ºä»£ç æ–¹æ³•å®‰è£…å’Œé…ç½®Nexus Sonatype</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473358/"><p>  Sonatype Nexusæ˜¯ä¸€ä¸ªé›†æˆå¹³å°ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å®ƒæ¥ä»£ç†ï¼Œå­˜å‚¨å’Œç®¡ç†Javaï¼ˆMavenï¼‰ä¾èµ–é¡¹ï¼ŒDockerï¼ŒPythonï¼ŒRubyï¼ŒNPMï¼ŒBowerå›¾åƒï¼ŒRPMè½¯ä»¶åŒ…ï¼Œgitlfsï¼ŒAptï¼ŒGoï¼ŒNugetï¼Œä»¥åŠåˆ†å‘å…¶è½¯ä»¶è§„å®šã€‚ </p><br><h3 id="zachem-nuzhen-sonatype-nexus"> ä¸ºä»€ä¹ˆéœ€è¦Sonatype Nexusï¼Ÿ </h3><br><ul><li> å­˜å‚¨ç§äººç‰©å“ï¼› </li><li> ç”¨äºç¼“å­˜ä»Internetä¸‹è½½çš„å·¥ä»¶ï¼› </li></ul><a name="habracut"></a><br><h3 id="artefakty-podderzhivaemye-v-bazovoy-postavke-sonatype-nexus">  Sonatype NexusåŸºæœ¬å¥—ä»¶ä¸­æ”¯æŒçš„å·¥ä»¶ï¼š </h3><br><ul><li>  Javaï¼ŒMavenï¼ˆç½å­ï¼‰ </li><li> ç å¤´å·¥äºº </li><li>  Pythonï¼ˆç‚¹å­ï¼‰ </li><li> çº¢å®çŸ³ï¼ˆå®çŸ³ï¼‰ </li><li>  NPM </li><li> å‡‰äº­ </li><li> ç™¾èƒœï¼ˆrpmï¼‰ </li><li>  gitlfs </li><li> ç”Ÿçš„ </li><li> å…¬å¯“ï¼ˆDebï¼‰ </li><li> å»å§ </li><li> åŠªå‰ç‰¹ </li></ul><br><h3 id="artefakty-podderzhivaemye-soobschestvom"> ç¤¾åŒºæ”¯æŒçš„å·¥ä»¶ï¼š </h3><br><ul><li> ä½œæ›²å®¶ </li><li> æŸ¯å— </li><li>  CPAN </li><li> åŸƒå°”å¸• </li><li> å¤´ç›” </li><li>  P2 </li><li>  [R </li></ul><br><h2 id="ustanovka-sonatype-nexus-ispolzuya-httpsgithubcomansible-thoteamnexus3-oss"> ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/ansible-ThoTeam/nexus3-oss</a>å®‰è£…Sonatype Nexus </h2><br><h3 id="trebovaniya"> è¦æ±‚æ¡ä»¶ </h3><br><ul><li>äº†è§£æœ‰å…³åœ¨äº’è”ç½‘ä¸Šä½¿ç”¨ansibleçš„ä¿¡æ¯ã€‚ </li><li>åœ¨å‰§æœ¬å¼€å§‹çš„å·¥ä½œç«™ä¸Šå®‰è£…ansible <code>pip install ansible</code> ã€‚ </li><li> åœ¨å‰§æœ¬å¼€å§‹çš„å·¥ä½œç«™ä¸Šå®‰è£…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">geerlingguy.java</a> ã€‚ </li><li> åœ¨å‰§æœ¬å¼€å§‹çš„å·¥ä½œç«™ä¸Šå®‰è£…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">geerlingguy.apache</a> ã€‚ </li><li> æ­¤è§’è‰²å·²åœ¨CentOS 7ï¼ŒUbuntu Xenialï¼ˆ16.04ï¼‰å’ŒBionicï¼ˆ18.04ï¼‰ï¼ŒDebian Jessieå’ŒStretchä¸Šè¿›è¡Œäº†æµ‹è¯• </li><li>  <code>jmespath</code>åº“å¿…é¡»å®‰è£…åœ¨å‰§æœ¬å¼€å§‹çš„å·¥ä½œç«™ä¸Šã€‚ è¦å®‰è£…ï¼Œè¯·è¿è¡Œ<code>sudo pip install -r requirements.txt</code> </li><li> å°†å‰§æœ¬æ–‡ä»¶ï¼ˆä¸‹é¢çš„ç¤ºä¾‹ï¼‰ä¿å­˜åˆ°nexus.ymlæ–‡ä»¶ä¸­ </li><li> è¿è¡Œnexus <code>ansible-playbook -i host nexus.yml</code>çš„å®‰è£…<code>ansible-playbook -i host nexus.yml</code> </li></ul><br><h3 id="primer-ansible-playbook-dlya-ustanovki-nexus-bez-ldap-s-repozitoriyami-maven-java-docker-python-ruby-npm-bower-rpm-i-gitlfs">  Ansible-playbookç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹ä½¿ç”¨Mavenï¼ˆjavaï¼‰ï¼ŒDockerï¼ŒPythonï¼ŒRubyï¼ŒNPMï¼ŒBowerï¼ŒRPMå’Œgitlfsåœ¨æ²¡æœ‰LDAPçš„æƒ…å†µä¸‹å®‰è£…nexusã€‚ </h3><br><pre> <code class="plaintext hljs">--- - name: Nexus hosts: nexus become: yes vars: nexus_timezone: 'Asia/Omsk' nexus_admin_password: "admin123" nexus_public_hostname: 'apatsev-nexus-playbook' httpd_setup_enable: false nexus_privileges: - name: all-repos-read description: 'Read &amp; Browse access to all repos' repository: '*' actions: - read - browse - name: company-project-deploy description: 'Deployments to company-project' repository: company-project actions: - add - edit nexus_roles: - id: Developpers # maps to the LDAP group name: developers description: All developers privileges: - nx-search-read - all-repos-read - company-project-deploy roles: [] nexus_local_users: - username: jenkins # used as key to update first_name: Jenkins last_name: CI email: support@company.com password: "s3cr3t" roles: - Developpers # role ID here nexus_blobstores: - name: company-artifacts path: /var/nexus/blobs/company-artifacts nexus_scheduled_tasks: - name: compact-blobstore cron: '0 0 22 * * ?' typeId: blobstore.compact taskProperties: blobstoreName: 'company-artifacts' nexus_repos_maven_proxy: - name: central remote_url: 'https://repo1.maven.org/maven2/' layout_policy: permissive - name: jboss remote_url: 'https://repository.jboss.org/nexus/content/groups/public-jboss/' - name: vaadin-addons remote_url: 'https://maven.vaadin.com/vaadin-addons/' - name: jaspersoft remote_url: 'https://jaspersoft.artifactoryonline.com/jaspersoft/jaspersoft-repo/' version_policy: mixed nexus_repos_maven_hosted: - name: company-project version_policy: mixed write_policy: allow blob_store: company-artifacts nexus_repos_maven_group: - name: public member_repos: - central - jboss - vaadin-addons - jaspersoft # Yum. Change nexus_config_yum to true for create yum repository nexus_config_yum: true nexus_repos_yum_hosted: - name: private_yum_centos_7 repodata_depth: 1 nexus_repos_yum_proxy: - name: epel_centos_7_x86_64 remote_url: http://download.fedoraproject.org/pub/epel/7/x86_64 maximum_component_age: -1 maximum_metadata_age: -1 negative_cache_ttl: 60 - name: centos-7-os-x86_64 remote_url: http://mirror.centos.org/centos/7/os/x86_64/ maximum_component_age: -1 maximum_metadata_age: -1 negative_cache_ttl: 60 nexus_repos_yum_group: - name: yum_all member_repos: - private_yum_centos_7 - epel_centos_7_x86_64 # NPM. Change nexus_config_npm to true for create npm repository nexus_config_npm: true nexus_repos_npm_hosted: [] nexus_repos_npm_group: - name: npm-public member_repos: - npm-registry nexus_repos_npm_proxy: - name: npm-registry remote_url: https://registry.npmjs.org/ negative_cache_enabled: false # Docker. Change nexus_config_docker to true for create docker repository nexus_config_docker: true nexus_repos_docker_hosted: - name: docker-hosted http_port: "{{ nexus_docker_hosted_port }}" v1_enabled: True nexus_repos_docker_proxy: - name: docker-proxy http_port: "{{ nexus_docker_proxy_port }}" v1_enabled: True index_type: "HUB" remote_url: "https://registry-1.docker.io" use_nexus_certificates_to_access_index: false maximum_component_age: 1440 maximum_metadata_age: 1440 negative_cache_enabled: true negative_cache_ttl: 1440 nexus_repos_docker_group: - name: docker-group http_port: "{{ nexus_docker_group_port }}" v1_enabled: True member_repos: - docker-hosted - docker-proxy # Bower. Change nexus_config_bower to true for create bower repository nexus_config_bower: true nexus_repos_bower_hosted: - name: bower-hosted nexus_repos_bower_proxy: - name: bower-proxy index_type: "proxy" remote_url: "https://registry.bower.io" use_nexus_certificates_to_access_index: false maximum_component_age: 1440 maximum_metadata_age: 1440 negative_cache_enabled: true negative_cache_ttl: 1440 nexus_repos_bower_group: - name: bower-group member_repos: - bower-hosted - bower-proxy # Pypi. Change nexus_config_pypi to true for create pypi repository nexus_config_pypi: true nexus_repos_pypi_hosted: - name: pypi-hosted nexus_repos_pypi_proxy: - name: pypi-proxy index_type: "proxy" remote_url: "https://pypi.org/" use_nexus_certificates_to_access_index: false maximum_component_age: 1440 maximum_metadata_age: 1440 negative_cache_enabled: true negative_cache_ttl: 1440 nexus_repos_pypi_group: - name: pypi-group member_repos: - pypi-hosted - pypi-proxy # rubygems. Change nexus_config_rubygems to true for create rubygems repository nexus_config_rubygems: true nexus_repos_rubygems_hosted: - name: rubygems-hosted nexus_repos_rubygems_proxy: - name: rubygems-proxy index_type: "proxy" remote_url: "https://rubygems.org" use_nexus_certificates_to_access_index: false maximum_component_age: 1440 maximum_metadata_age: 1440 negative_cache_enabled: true negative_cache_ttl: 1440 nexus_repos_rubygems_group: - name: rubygems-group member_repos: - rubygems-hosted - rubygems-proxy # gitlfs. Change nexus_config_gitlfs to true for create gitlfs repository nexus_config_gitlfs: true nexus_repos_gitlfs_hosted: - name: gitlfs-hosted roles: - { role: geerlingguy.java } # Debian/Ubuntu only # - { role: geerlingguy.apache, apache_create_vhosts: no, apache_mods_enabled: ["proxy_http.load", "headers.load"], apache_remove_default_vhost: true, tags: ["geerlingguy.apache"] } # RedHat/CentOS only - { role: geerlingguy.apache, apache_create_vhosts: no, apache_remove_default_vhost: true, tags: ["geerlingguy.apache"] } - { role: ansible-thoteam.nexus3-oss, tags: ['ansible-thoteam.nexus3-oss'] }</code> </pre> <br><h2 id="skrinshoty"> å±å¹•æˆªå›¾ï¼š </h2><br><p><img src="https://habrastorage.org/webt/mb/7a/e7/mb7ae7qibkvkuhq_vfrce9hjzoo.png"></p><br><p><img src="https://habrastorage.org/webt/jp/vw/pq/jpvwpqijp9ccgw5gzkz6ytv0iyy.png"></p><br><h2 id="peremennye-roli"> è§’è‰²å˜é‡ </h2><br><h2 id="role-variables"> è§’è‰²å˜é‡ </h2><br><p> å…·æœ‰é»˜è®¤å€¼çš„å˜é‡ï¼ˆè¯·å‚è§<code>default/main.yml</code> ï¼‰ï¼š </p><br><h3 id="general-variables"> ä¸€èˆ¬å˜é‡ </h3><br><pre> <code class="plaintext hljs"> nexus_version: '' nexus_timezone: 'UTC'</code> </pre> <br><p> é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥è§’è‰²å°†å®‰è£…Nexusçš„æœ€æ–°å¯ç”¨ç‰ˆæœ¬ã€‚ æ‚¨å¯ä»¥é€šè¿‡æ›´æ”¹<code>nexus_version</code>å˜é‡æ¥ä¿®å¤ç‰ˆæœ¬ã€‚ è¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.sonatype.com/download-oss-sonatypeä¸Š</a>çš„å¯ç”¨ç‰ˆæœ¬ã€‚ </p><br><p> å¦‚æœæ‚¨å°†ç‰ˆæœ¬æ›´æ”¹ä¸ºè¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œåˆ™è¯¥è§’è‰²å°†å°è¯•æ›´æ–°å·²å®‰è£…çš„Nexusã€‚ </p><br><p> å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Nexusç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œåˆ™åº”ç¡®ä¿æœªä½¿ç”¨å·²å®‰è£…ç‰ˆæœ¬ä¸­ä¸å¯ç”¨çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œæ‰˜ç®¡yumå­˜å‚¨åº“é€‚ç”¨äº3.8.0ä»¥ä¸Šç‰ˆæœ¬çš„Nexusï¼Œgit lfs repoé€‚ç”¨äº3.3.0ä»¥ä¸Šç‰ˆæœ¬çš„Nexusï¼‰ç­‰ï¼‰ </p><br><p>  <code>nexus timezone</code>æ˜¯ä¸€ä¸ªJava <code>nexus timezone</code>åç§°ï¼Œå¯ä¸ä¸‹é¢çš„cronè¡¨è¾¾å¼ç»“åˆä½¿ç”¨ï¼Œç”¨äºnexus_scheduledä»»åŠ¡ã€‚ </p><br><h3 id="port-nexus-i-kontekstnyy-put"> è¿ç»“ç«¯å£å’Œä¸Šä¸‹æ–‡è·¯å¾„ </h3><br><pre> <code class="plaintext hljs"> nexus_default_port: 8081 nexus_default_context_path: '/'</code> </pre> <br><p>  Javaè¿æ¥è¿‡ç¨‹çš„ç«¯å£å’Œä¸Šä¸‹æ–‡è·¯å¾„ã€‚  <code>nexus_default_context_path</code>è®¾ç½®æ—¶å¿…é¡»åŒ…å«æ–œæ ï¼Œä¾‹å¦‚ã€‚ï¼š <code>nexus_default_context_path: '/nexus/'</code> ã€‚ </p><br><h3 id="polzovatel-i-gruppa-os-nexus">  Nexusç”¨æˆ·å’Œç»„ </h3><br><pre> <code class="plaintext hljs"> nexus_os_group: 'nexus' nexus_os_user: 'nexus'</code> </pre> <br><p> å¦‚æœç¼ºå°‘è¯¥è§’è‰²ï¼Œåˆ™ç”±è§’è‰²åˆ›å»ºç”¨äºæ‹¥æœ‰Nexusæ–‡ä»¶å¹¶å¯åŠ¨æœåŠ¡çš„ç”¨æˆ·å’Œç»„ã€‚ </p><br><pre> <code class="plaintext hljs"> nexus_os_user_home_dir: '/home/nexus'</code> </pre> <br><p> å…è®¸æ›´æ”¹nexusç”¨æˆ·çš„é»˜è®¤ä¸»ç›®å½• </p><br><h3 id="katalogi-ekzemplyarov-nexus">  Nexuså®ä¾‹ç›®å½• </h3><br><pre> <code class="plaintext hljs"> nexus_installation_dir: '/opt' nexus_data_dir: '/var/nexus' nexus_tmp_dir: "{{ (ansible_os_family == 'RedHat') | ternary('/var/nexus-tmp', '/tmp/nexus') }}"</code> </pre> <br><p>  Nexusç›®å½•ã€‚ </p><br><ul><li>  <code>nexus_installation_dir</code>åŒ…å«å·²å®‰è£…çš„å¯æ‰§è¡Œæ–‡ä»¶ </li><li>  <code>nexus_data_dir</code>åŒ…å«æ‰€æœ‰é…ç½®ï¼Œå­˜å‚¨åº“å’Œå·²åŠ è½½çš„å·¥ä»¶ã€‚ å¯ä»¥é…ç½®è‡ªå®šä¹‰Blobstores nexus_data_dir <code>nexus_data_dir</code> ï¼Œè¯·å‚é˜…ä¸‹é¢çš„<code>nexus_blobstores</code> ã€‚ </li><li>  <code>nexus_tmp_dir</code>åŒ…å«æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶ã€‚  redhatçš„é»˜è®¤è·¯å¾„å·²ä»<code>/tmp</code>ç§»å‡ºï¼Œä»¥å…‹æœè‡ªåŠ¨æ¸…é™¤è¿‡ç¨‹ä¸­çš„æ½œåœ¨é—®é¢˜ã€‚ è¯·å‚é˜…ï¼ƒ168ã€‚ </li></ul><br><h3 id="nastroyka-ispolzovanie-pamyati-nexus-jvm"> é…ç½®Nexus JVMå†…å­˜ä½¿ç”¨æƒ…å†µ </h3><br><pre> <code class="plaintext hljs"> nexus_min_heap_size: "1200M" nexus_max_heap_size: "{{ nexus_min_heap_size }}" nexus_max_direct_memory: "2G"</code> </pre> <br><p> è¿™äº›æ˜¯Nexusçš„é»˜è®¤è®¾ç½®ã€‚  <em>å¦‚æœæ‚¨å°šæœªé˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è”ç³»ç³»ç»Ÿè¦æ±‚çš„å†…å­˜éƒ¨åˆ†ï¼Œ</a></em>å¹¶ä¸”ä¸äº†è§£å®ƒä»¬åœ¨åšä»€ä¹ˆï¼Œ <strong>è¯·ä¸è¦æ›´æ”¹è¿™äº›å€¼</strong> ã€‚ </p><br><p> ä½œä¸ºç¬¬äºŒä¸ªè­¦å‘Šï¼Œä»¥ä¸‹æ˜¯ä¸Šè¿°æ–‡æ¡£çš„æ‘˜å½•ï¼š </p><br><blockquote> ä¸å»ºè®®å°†JVMå †å†…å­˜å¢åŠ åˆ°å»ºè®®å€¼ä¹‹å¤–ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ å®é™…ä¸Šï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿç›¸åçš„æ•ˆæœï¼Œå¯¼è‡´æ“ä½œç³»ç»Ÿä¸å¿…è¦çš„æ“ä½œã€‚ </blockquote><br><h3 id="parol-administratora"> ç®¡ç†å‘˜å¯†ç  </h3><br><pre> <code class="plaintext hljs"> nexus_admin_password: 'changeme'</code> </pre> <br><p>  â€œ adminâ€å¸æˆ·çš„å¯†ç æ˜¯è¦é…ç½®çš„ã€‚  <em>è¿™ä»…é€‚ç”¨äºç¬¬ä¸€ä¸ªé»˜è®¤å®‰è£…</em> ã€‚ å¦‚æœè¦ç¨åä½¿ç”¨è§’è‰²è¿›è¡Œæ›´æ”¹ï¼Œè¯·å‚é˜…[é¦–æ¬¡å®‰è£…åæ›´æ”¹ç®¡ç†å‘˜å¯†ç ]ï¼ˆï¼ƒchange-admin-password-é¦–æ¬¡å®‰è£…åï¼‰ã€‚ </p><br><p>  <strong>å¼ºçƒˆå»ºè®®æ‚¨å°†å¯†ç ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨å‰§æœ¬ä¸­ï¼Œä½†è¦ä½¿ç”¨[ansible-vaultåŠ å¯†]ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://docs.ansible.com/ansible/latest/user_guide/vault.html</a> ï¼‰ï¼ˆåµŒå…¥æˆ–å•ç‹¬å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚ç”¨include_varsåŠ è½½ï¼‰</strong> </p><br><h3 id="anonimnyy-dostup-po-umolchaniyu"> é»˜è®¤åŒ¿åè®¿é—® </h3><br><pre> <code class="plaintext hljs"> nexus_anonymous_access: false</code> </pre> <br><p> é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ¿åè®¿é—®æ˜¯å…³é—­çš„ã€‚ é˜…è¯»æœ‰å…³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŒ¿åè®¿é—®çš„</a>æ›´å¤šä¿¡æ¯ã€‚ </p><br><h3 id="publichnoe-imya-hosta"> å…¬å¼€ä¸»æœºå </h3><br><pre> <code class="plaintext hljs"> nexus_public_hostname: 'nexus.vm' nexus_public_scheme: https</code> </pre> <br><p>  Nexuså®ä¾‹å¯ç”¨äºå…¶å®¢æˆ·ç«¯çš„æ ‡å‡†åŸŸåå’Œæ–¹æ¡ˆï¼ˆhttpsæˆ–httpï¼‰ã€‚ </p><br><h3 id="dostup-api-dlya-etoy-roli"> æ­¤è§’è‰²çš„APIè®¿é—®æƒé™ </h3><br><pre> <code class="plaintext hljs"> nexus_api_hostname: localhost nexus_api_scheme: http nexus_api_validate_certs: "{{ nexus_api_scheme == 'https' }}" nexus_api_context_path: "{{ nexus_default_context_path }}" nexus_api_port: "{{ nexus_default_port }}"</code> </pre> <br><p> è¿™äº›å˜é‡æ§åˆ¶è§’è‰²å¦‚ä½•è¿æ¥åˆ°Nexus APIè¿›è¡Œé…ç½®ã€‚ <br>  <strong>ä»…é€‚ç”¨äºé«˜çº§ç”¨æˆ·ã€‚</strong>  <strong>æ‚¨å¾ˆå¯èƒ½ä¸æƒ³æ›´æ”¹è¿™äº›é»˜è®¤è®¾ç½®</strong> </p><br><h3 id="nastroyka-obratnogo-proksi"> åå‘ä»£ç†è®¾ç½® </h3><br><pre> <code class="plaintext hljs"> httpd_setup_enable: false httpd_server_name: "{{ nexus_public_hostname }}" httpd_default_admin_email: "admin@example.com" httpd_ssl_certificate_file: 'files/nexus.vm.crt' httpd_ssl_certificate_key_file: 'files/nexus.vm.key' # httpd_ssl_certificate_chain_file: "{{ httpd_ssl_certificate_file }}" httpd_copy_ssl_files: true</code> </pre> <br><p> å®‰è£…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSLåå‘ä»£ç†</a> ã€‚ <br> ä¸ºæ­¤ï¼Œè¯·å®‰è£…httpdã€‚ æ³¨æ„ï¼šå½“<code>httpd_setup_enable</code>è®¾ç½®ä¸º<code>true</code> ï¼Œnexusè”ç³»127.0.0.1:8081ï¼Œå› æ­¤<em>æ— æ³•</em>ä»å¤–éƒ¨IPåœ°å€é€šè¿‡HTTPç«¯å£8081ç›´æ¥è®¿é—®ã€‚ </p><br><p> ä½¿ç”¨çš„é»˜è®¤ä¸»æœºåæ˜¯<code>nexus_public_hostname</code> ã€‚ å¦‚æœå‡ºäºä»»ä½•åŸå› éœ€è¦å…¶ä»–åç§°ï¼Œåˆ™å¯ä»¥å°†<code>httpd_server_name</code>è®¾ç½®ä¸ºå…¶ä»–å€¼ã€‚ </p><br><p> ä½¿ç”¨<code>httpd_copy_ssl_files: true</code> ï¼ˆé»˜è®¤ï¼‰æ—¶ï¼Œä»¥ä¸Šè¯ä¹¦å¿…é¡»å­˜åœ¨äºæ‚¨çš„å‰§æœ¬ç›®å½•ä¸­ï¼Œå¹¶å°†è¢«å¤åˆ¶åˆ°æœåŠ¡å™¨å¹¶åœ¨apacheä¸­è¿›è¡Œé…ç½®ã€‚ </p><br><p> å¦‚æœè¦ä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„ç°æœ‰è¯ä¹¦ï¼Œè¯·è®¾ç½®<code>httpd_copy_ssl_files: false</code>å¹¶æä¾›ä»¥ä¸‹å˜é‡ï¼š </p><br><pre> <code class="plaintext hljs"> # These specifies to the vhost where to find on the remote server file # system the certificate files. httpd_ssl_cert_file_location: "/etc/pki/tls/certs/wildcard.vm.crt" httpd_ssl_cert_key_location: "/etc/pki/tls/private/wildcard.vm.key" # httpd_ssl_cert_chain_file_location: "{{ httpd_ssl_cert_file_location }}"</code> </pre> <br><p>  <code>httpd_ssl_cert_chain_file_location</code>æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ‚¨ä¸æƒ³é…ç½®é“¾æ–‡ä»¶ï¼Œåˆ™åº”å°†å…¶å¸è½½ </p><br><pre> <code class="plaintext hljs"> httpd_default_admin_email: "admin@example.com"</code> </pre> <br><p> è®¾ç½®é»˜è®¤ç®¡ç†å‘˜ç”µå­é‚®ä»¶ </p><br><h3 id="konfiguraciya-ldap">  LDAPé…ç½® </h3><br><p>  LDAPè¿æ¥å’Œå®‰å…¨èŒƒå›´é»˜è®¤æƒ…å†µä¸‹å¤„äºç¦ç”¨çŠ¶æ€ </p><br><pre> <code class="plaintext hljs"> nexus_ldap_realm: false ldap_connections: []</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LDAPè¿æ¥</a> ï¼Œæ¯ä¸ªé¡¹ç›®å¦‚ä¸‹ï¼š </p><br><pre> <code class="plaintext hljs"> nexus_ldap_realm: true ldap_connections: - ldap_name: 'My Company LDAP' # used as a key to update the ldap config ldap_protocol: 'ldaps' # ldap or ldaps ldap_hostname: 'ldap.mycompany.com' ldap_port: 636 ldap_use_trust_store: false # Wether or not to use certs in the nexus trust store ldap_search_base: 'dc=mycompany,dc=net' ldap_auth: 'none' # or simple ldap_auth_username: 'username' # if auth = simple ldap_auth_password: 'password' # if auth = simple ldap_user_base_dn: 'ou=users' ldap_user_filter: '(cn=*)' # (optional) ldap_user_object_class: 'inetOrgPerson' ldap_user_id_attribute: 'uid' ldap_user_real_name_attribute: 'cn' ldap_user_email_attribute: 'mail' ldap_user_subtree: false ldap_map_groups_as_roles: false ldap_group_base_dn: 'ou=groups' ldap_group_object_class: 'posixGroup' ldap_group_id_attribute: 'cn' ldap_group_member_attribute: 'memberUid' ldap_group_member_format: '${username}' ldap_group_subtree: false</code> </pre> <br><p> ç”¨äºåŒ¿åèº«ä»½éªŒè¯ï¼ˆåŒ¿åç»‘å®šï¼‰çš„ç¤ºä¾‹LDAPé…ç½®ï¼Œå®ƒä¹Ÿæ˜¯â€œæœ€å°â€é…ç½®ï¼š </p><br><pre> <code class="plaintext hljs"> nexus_ldap_realm: true ldap_connection: - ldap_name: 'Simplest LDAP config' ldap_protocol: 'ldaps' ldap_hostname: 'annuaire.mycompany.com' ldap_search_base: 'dc=mycompany,dc=net' ldap_port: 636 ldap_use_trust_store: false ldap_user_id_attribute: 'uid' ldap_user_real_name_attribute: 'cn' ldap_user_email_attribute: 'mail' ldap_user_object_class: 'inetOrgPerson'</code> </pre> <br><p> ç”¨äºç®€å•èº«ä»½éªŒè¯çš„LDAPé…ç½®ç¤ºä¾‹ï¼ˆä½¿ç”¨DSAå¸æˆ·ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs"> nexus_ldap_realm: true ldap_connections: - ldap_name: 'LDAP config with DSA' ldap_protocol: 'ldaps' ldap_hostname: 'annuaire.mycompany.com' ldap_port: 636 ldap_use_trust_store: false ldap_auth: 'simple' ldap_auth_username: 'cn=mynexus,ou=dsa,dc=mycompany,dc=net' ldap_auth_password: "{{ vault_ldap_dsa_password }}" # better keep passwords in an ansible vault ldap_search_base: 'dc=mycompany,dc=net' ldap_user_base_dn: 'ou=users' ldap_user_object_class: 'inetOrgPerson' ldap_user_id_attribute: 'uid' ldap_user_real_name_attribute: 'cn' ldap_user_email_attribute: 'mail' ldap_user_subtree: false</code> </pre> <br><p> ç”¨äºç®€å•èº«ä»½éªŒè¯ï¼ˆä½¿ç”¨DSAå¸æˆ·ï¼‰å’Œæ˜ å°„ä¸ºè§’è‰²çš„ç»„çš„LDAPé…ç½®ç¤ºä¾‹ï¼š </p><br><pre> <code class="plaintext hljs"> nexus_ldap_realm: true ldap_connections - ldap_name: 'LDAP config with DSA' ldap_protocol: 'ldaps' ldap_hostname: 'annuaire.mycompany.com' ldap_port: 636 ldap_use_trust_store: false ldap_auth: 'simple' ldap_auth_username: 'cn=mynexus,ou=dsa,dc=mycompany,dc=net' ldap_auth_password: "{{ vault_ldap_dsa_password }}" # better keep passwords in an ansible vault ldap_search_base: 'dc=mycompany,dc=net' ldap_user_base_dn: 'ou=users' ldap_user_object_class: 'inetOrgPerson' ldap_user_id_attribute: 'uid' ldap_user_real_name_attribute: 'cn' ldap_user_email_attribute: 'mail' ldap_map_groups_as_roles: true ldap_group_base_dn: 'ou=groups' ldap_group_object_class: 'groupOfNames' ldap_group_id_attribute: 'cn' ldap_group_member_attribute: 'member' ldap_group_member_format: 'uid=${username},ou=users,dc=mycompany,dc=net' ldap_group_subtree: false</code> </pre> <br><p> ç”¨äºç®€å•èº«ä»½éªŒè¯çš„LDAPé…ç½®ç¤ºä¾‹ï¼ˆä½¿ç”¨DSAå¸æˆ·ï¼‰+åŠ¨æ€æ˜ å°„ä¸ºè§’è‰²çš„ç»„ï¼š </p><br><pre> <code class="plaintext hljs"> nexus_ldap_realm: true ldap_connections: - ldap_name: 'LDAP config with DSA' ldap_protocol: 'ldaps' ldap_hostname: 'annuaire.mycompany.com' ldap_port: 636 ldap_use_trust_store: false ldap_auth: 'simple' ldap_auth_username: 'cn=mynexus,ou=dsa,dc=mycompany,dc=net' ldap_auth_password: "{{ vault_ldap_dsa_password }}" # better keep passwords in an ansible vault ldap_search_base: 'dc=mycompany,dc=net' ldap_user_base_dn: 'ou=users' ldap_user_object_class: 'inetOrgPerson' ldap_user_id_attribute: 'uid' ldap_user_real_name_attribute: 'cn' ldap_user_email_attribute: 'mail' ldap_map_groups_as_roles: true ldap_map_groups_as_roles_type: 'dynamic' ldap_user_memberof_attribute: 'memberOf'</code> </pre> <br><h3 id="privilegii"> ç¤¼é‡ </h3><br><pre> <code class="plaintext hljs"> nexus_privileges: - name: all-repos-read # used as key to update a privilege # type: &lt;one of application, repository-admin, repository-content-selector, repository-view, script or wildcard&gt; description: 'Read &amp; Browse access to all repos' repository: '*' actions: # can be add, browse, create, delete, edit, read or * (all) - read - browse # pattern: pattern # domain: domain # script_name: name</code> </pre> <br><p> è¦é…ç½®çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç‰¹æƒ</a>åˆ—è¡¨ã€‚ è¯·å‚é˜…æ–‡æ¡£å’ŒGUIï¼Œä»¥æŸ¥çœ‹åº”æ ¹æ®ç‰¹æƒç±»å‹è®¾ç½®å“ªäº›å˜é‡ã€‚ </p><br><p> è¿™äº›å…ƒç´ ä¸ä»¥ä¸‹é»˜è®¤å€¼ç»“åˆä½¿ç”¨ï¼š </p><br><pre> <code class="plaintext hljs"> _nexus_privilege_defaults: type: repository-view format: maven2 actions: - read</code> </pre> <br><h3 id="roli-vnutri-nexus-imeetsya-vidu"> è§’è‰²ï¼ˆå¯åœ¨Nexuså†…éƒ¨ä½¿ç”¨ï¼‰ </h3><br><pre> <code class="plaintext hljs"> nexus_roles: - id: Developpers # can map to a LDAP group id, also used as a key to update a role name: developers description: All developers privileges: - nx-search-read - all-repos-read roles: [] # references to other role names</code> </pre> <br><p> è¦é…ç½®çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§’è‰²</a>åˆ—è¡¨ã€‚ </p><br><h3 id="polzovateli"> ç”¨æˆ·æ•° </h3><br><pre> <code class="plaintext hljs"> nexus_local_users: [] # - username: jenkins # used as key to update # state: present # default value if ommited, use 'absent' to remove user # first_name: Jenkins # last_name: CI # email: support@company.com # password: "s3cr3t" # roles: # - developers # role ID</code> </pre> <br><p> åœ¨æœ¬åœ°åˆ›å»ºçš„æœ¬åœ°ï¼ˆéLDAPï¼‰ç”¨æˆ·/å¸æˆ·åˆ—è¡¨ã€‚ </p><br><p> è¦åœ¨Nexusä¸Šåˆ›å»ºçš„æœ¬åœ°ï¼ˆéLDAPï¼‰ç”¨æˆ·/å¸æˆ·åˆ—è¡¨ã€‚ </p><br><pre> <code class="plaintext hljs"> nexus_ldap_users: [] # - username: j.doe # state: present # roles: # - "nx-admin"</code> </pre> <br><p> æ˜ å°„Ldapç”¨æˆ·/è§’è‰²ã€‚  <code>absent</code>çŠ¶æ€å°†ä»ç°æœ‰ç”¨æˆ·ä¸­åˆ é™¤è§’è‰²ï¼ˆå¦‚æœå·²ç»å­˜åœ¨ï¼‰ã€‚ <br>  Ldapç”¨æˆ·ä¸ä¼šè¢«åˆ é™¤ã€‚ å°è¯•ä¸ºä¸å­˜åœ¨çš„ç”¨æˆ·å®‰è£…è§’è‰²å°†å¯¼è‡´é”™è¯¯ã€‚ </p><br><h3 id="selektory-kontenta"> å†…å®¹é€‰æ‹©å™¨ </h3><br><pre> <code class="plaintext hljs"> nexus_content_selectors: - name: docker-login description: Selector for docker login privilege search_expression: format=="docker" and path=~"/v2/"</code> </pre> <br><p> æœ‰å…³å†…å®¹é€‰æ‹©å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ã€‚ </p><br><p> è¦ä½¿ç”¨å†…å®¹é€‰æ‹©å™¨ï¼Œè¯·æ·»åŠ æ–°çš„ç‰¹æƒï¼Œå…¶<code>type: repository-content-selector</code>å’Œç›¸åº”çš„<code>contentSelector</code> </p><br><pre> <code class="plaintext hljs">- name: docker-login-privilege type: repository-content-selector contentSelector: docker-login description: 'Login to Docker registry' repository: '*' actions: - read - browse</code> </pre> <br><h3 id="blobstores-i-repozitorii">  Blobstoreå’Œå­˜å‚¨åº“ </h3><br><pre> <code class="plaintext hljs"> nexus_delete_default_repos: false</code> </pre> <br><p> ä»nexuså®‰è£…åˆå§‹é»˜è®¤é…ç½®ä¸­åˆ é™¤å­˜å‚¨åº“ã€‚ ä»…åœ¨é¦–æ¬¡å®‰è£…æ—¶ï¼ˆæ£€æµ‹åˆ°<code>nexus_data_dir</code>ä¸ºç©ºæ—¶ï¼‰æ‰§è¡Œæ­¤æ­¥éª¤ã€‚ </p><br><p> ä»Nexusçš„åŸå§‹é»˜è®¤é…ç½®ä¸­åˆ é™¤å­˜å‚¨åº“ã€‚ ä»…åœ¨é¦–æ¬¡å®‰è£…æœŸé—´ï¼ˆ <code>nexus_data_dir</code>ç©ºæ—¶ï¼‰æ‰§è¡Œæ­¤æ­¥éª¤ã€‚ </p><br><pre> <code class="plaintext hljs"> nexus_delete_default_blobstore: false</code> </pre> <br><p> ä»nexuså®‰è£…åˆå§‹é»˜è®¤é…ç½®ä¸­åˆ é™¤é»˜è®¤çš„blobstoreã€‚ ä»…å½“<code>nexus_delete_default_repos: true</code>ä¸”æ‰€æœ‰é…ç½®çš„å­˜å‚¨åº“ï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰å…·æœ‰æ˜¾å¼çš„<code>blob_store: custom</code>æ‰å¯ä»¥è¿™æ ·åšã€‚ ä»…åœ¨é¦–æ¬¡å®‰è£…æ—¶ï¼ˆæ£€æµ‹åˆ°<code>nexus_data_dir</code>ä¸ºç©ºæ—¶ï¼‰æ‰§è¡Œæ­¤æ­¥éª¤ã€‚ </p><br><p> é»˜è®¤æƒ…å†µä¸‹ï¼Œä»åŸå§‹é…ç½®ä¸­ç¦ç”¨åˆ é™¤Blobå­˜å‚¨ï¼ˆäºŒè¿›åˆ¶å·¥ä»¶ï¼‰ã€‚ è¦åˆ é™¤Blobå­˜å‚¨ï¼ˆäºŒè¿›åˆ¶å·¥ä»¶ï¼‰ï¼Œè¯·å…³é—­<code>nexus_delete_default_repos: true</code> ã€‚ ä»…åœ¨é¦–æ¬¡å®‰è£…æœŸé—´ï¼ˆ <code>nexus_data_dir</code>ç©ºæ—¶ï¼‰æ‰§è¡Œæ­¤æ­¥éª¤ã€‚ </p><br><pre> <code class="plaintext hljs"> nexus_blobstores: [] # example blobstore item : # - name: separate-storage # type: file # path: /mnt/custom/path # - name: s3-blobstore # type: S3 # config: # bucket: s3-blobstore # accessKeyId: "{{ VAULT_ENCRYPTED_KEY_ID }}" # secretAccessKey: "{{ VAULT_ENCRYPTED_ACCESS_KEY }}"</code> </pre> <br><p> è¦åˆ›å»ºçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Blobstore</a> ã€‚ åˆå§‹åˆ›å»ºåæ— æ³•æ›´æ–°blobstoreè·¯å¾„å’Œå­˜å‚¨åº“blobstoreï¼ˆæ­¤å¤„çš„ä»»ä½•æ›´æ–°åœ¨é‡æ–°é…ç½®æ—¶éƒ½å°†è¢«å¿½ç•¥ï¼‰ã€‚ </p><br><p> ä¸ºæ–¹ä¾¿èµ·è§ï¼Œåœ¨S3ä¸Šé…ç½®blobstoreå¹¶ä¸æ˜¯æˆ‘ä»¬åœ¨travisä¸Šè¿è¡Œçš„è‡ªåŠ¨åŒ–æµ‹è¯•çš„ä¸€éƒ¨åˆ†ã€‚ è¯·æ³¨æ„ï¼Œä»…å»ºè®®å°†AWSä¸Šéƒ¨ç½²çš„å®ä¾‹å­˜å‚¨åœ¨S3ä¸Šã€‚ </p><br><p> åˆ›å»º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Blobstore</a> åˆå§‹åˆ›å»ºåæ— æ³•æ›´æ–°å­˜å‚¨è·¯å¾„å’Œå­˜å‚¨åº“ï¼ˆé‡æ–°å®‰è£…æ—¶å°†å¿½ç•¥æ­¤å¤„çš„ä»»ä½•æ›´æ–°ï¼‰ã€‚ </p><br><p> ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæä¾›äº†åœ¨S3ä¸Šé…ç½®Blobå­˜å‚¨çš„åŠŸèƒ½ã€‚ è¯·æ³¨æ„ï¼Œå»ºè®®ä»…å¯¹åœ¨AWSä¸Šéƒ¨ç½²çš„å®ä¾‹ä½¿ç”¨S3å­˜å‚¨ã€‚ </p><br><pre> <code class="plaintext hljs"> nexus_repos_maven_proxy: - name: central remote_url: 'https://repo1.maven.org/maven2/' layout_policy: permissive # maximum_component_age: -1 # maximum_metadata_age: 1440 # negative_cache_enabled: true # negative_cache_ttl: 1440 - name: jboss remote_url: 'https://repository.jboss.org/nexus/content/groups/public-jboss/' # maximum_component_age: -1 # maximum_metadata_age: 1440 # negative_cache_enabled: true # negative_cache_ttl: 1440 # example with a login/password : # - name: secret-remote-repo # remote_url: 'https://company.com/repo/secure/private/go/away' # remote_username: 'username' # remote_password: 'secret' # # maximum_component_age: -1 # # maximum_metadata_age: 1440 # # negative_cache_enabled: true # # negative_cache_ttl: 1440</code> </pre> <br><p> ä¸Šé¢æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ä¸ª</a> Maven <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»£ç†</a>é…ç½®ç¤ºä¾‹ã€‚ </p><br><pre> <code class="plaintext hljs"> nexus_repos_maven_hosted: - name: private-release version_policy: release write_policy: allow_once # one of "allow", "allow_once" or "deny"</code> </pre> <br><p>  Maven <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰˜ç®¡å­˜å‚¨åº“</a>é…ç½®ã€‚ è´Ÿç¼“å­˜é…ç½®æ˜¯å¯é€‰çš„ï¼Œå¦‚æœçœç•¥ï¼Œåˆ™é»˜è®¤ä¸ºä¸Šè¿°å€¼ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰˜ç®¡</a> Maven <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“çš„</a>é…ç½®ã€‚ è´Ÿç¼“å­˜é…ç½®ï¼ˆ-1ï¼‰æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ºä¸Šè¿°å€¼ã€‚ </p><br><pre> <code class="plaintext hljs"> nexus_repos_maven_group: - name: public member_repos: - central - jboss</code> </pre> <br><p>  Maven <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»„</a>é…ç½®ã€‚ </p><br><p> æ‰€æœ‰ä¸‰ç§ç±»å‹çš„å­˜å‚¨åº“éƒ½ä¸ä»¥ä¸‹é»˜è®¤å€¼ç»“åˆä½¿ç”¨ï¼š </p><br><pre> <code class="plaintext hljs"> _nexus_repos_maven_defaults: blob_store: default # Note : cannot be updated once the repo has been created strict_content_validation: true version_policy: release # release, snapshot or mixed layout_policy: strict # strict or permissive write_policy: allow_once # one of "allow", "allow_once" or "deny" maximum_component_age: -1 # Nexus gui default. For proxies only maximum_metadata_age: 1440 # Nexus gui default. For proxies only negative_cache_enabled: true # Nexus gui default. For proxies only negative_cache_ttl: 1440 # Nexus gui default. For proxies only</code> </pre> <br><p>  Dockerï¼ŒPypiï¼ŒRawï¼ŒRubygemsï¼ŒBowerï¼ŒNPMï¼ŒGit-LFSå’Œyumå­˜å‚¨åº“ç±»å‹ï¼š <br> æœ‰å…³è¿™äº›é€‰é¡¹ï¼Œè¯·å‚è§<code>defaults/main.yml</code> ï¼š </p><br><p> é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerï¼ŒPypiï¼ŒRawï¼ŒRubygemsï¼ŒBowerï¼ŒNPMï¼ŒGit-LFSå’Œyumå­˜å‚¨åº“å¤„äºå…³é—­çŠ¶æ€ï¼š <br> æœ‰å…³è¿™äº›é€‰é¡¹ï¼Œè¯·å‚è§<code>defaults/main.yml</code> ï¼š </p><br><pre> <code class="plaintext hljs"> nexus_config_pypi: false nexus_config_docker: false nexus_config_raw: false nexus_config_rubygems: false nexus_config_bower: false nexus_config_npm: false nexus_config_gitlfs: false nexus_config_yum: false</code> </pre> <br><p> è¯·æ³¨æ„ï¼Œå¦‚æœè¦ä½¿ç”¨é™¤Mavenä¹‹å¤–çš„å…¶ä»–ç±»å‹çš„å­˜å‚¨åº“ï¼Œå¯èƒ½éœ€è¦å¯ç”¨æŸäº›å®‰å…¨åŒºåŸŸã€‚ é»˜è®¤æƒ…å†µä¸‹ä¸ºfalseã€‚ </p><br><pre> <code class="plaintext hljs">nexus_nuget_api_key_realm: false nexus_npm_bearer_token_realm: false nexus_docker_bearer_token_realm: false # required for docker anonymous access</code> </pre> <br><p> ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¯ç”¨è¿œç¨‹ç”¨æˆ·é¢†åŸŸ </p><br><pre> <code class="plaintext hljs">nexus_rut_auth_realm: true</code> </pre> <br><p> æ ‡é¢˜å¯ä»¥é€šè¿‡å®šä¹‰ </p><br><pre> <code class="plaintext hljs">nexus_rut_auth_header: "CUSTOM_HEADER"</code> </pre> <br><h3 id="zaplanirovannye-zadachi"> è®¡åˆ’ä»»åŠ¡ </h3><br><pre> <code class="plaintext hljs"> nexus_scheduled_tasks: [] # # Example task to compact blobstore : # - name: compact-docker-blobstore # cron: '0 0 22 * * ?' # typeId: blobstore.compact # task_alert_email: alerts@example.org # optional # taskProperties: # blobstoreName: {{ nexus_blob_names.docker.blob }} # all task attributes are stored as strings by nexus internally # # Example task to purge maven snapshots # - name: Purge-maven-snapshots # cron: '0 50 23 * * ?' # typeId: repository.maven.remove-snapshots # task_alert_email: alerts@example.org # optional # taskProperties: # repositoryName: "*" # * for all repos. Change to a repository name if you only want a specific one # minimumRetained: "2" # snapshotRetentionDays: "2" # gracePeriodInDays: "2" # booleanTaskProperties: # removeIfReleased: true # # Example task to purge unused docker manifest and images # - name: Purge unused docker manifests and images # cron: '0 55 23 * * ?' # typeId: "repository.docker.gc" # task_alert_email: alerts@example.org # optional # taskProperties: # repositoryName: "*" # * for all repos. Change to a repository name if you only want a specific one # # Example task to purge incomplete docker uploads # - name: Purge incomplete docker uploads # cron: '0 0 0 * * ?' # typeId: "repository.docker.upload-purge" # task_alert_email: alerts@example.org # optional # taskProperties: # age: "24"</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¡åˆ’ä»»åŠ¡</a>è¿›è¡Œé…ç½®ã€‚ å¯ä»¥çŒœæµ‹<code>typeId</code>å’Œç‰¹å®š<code>taskProperties</code>ä»»åŠ¡çš„<code>taskProperties</code> / <code>booleanTaskProperties</code> ï¼š </p><br><ul><li> ä»Javaç±»å‹å±‚æ¬¡ç»“æ„<code>org.sonatype.nexus.scheduling.TaskDescriptorSupport</code> </li><li> æ£€æŸ¥HTMLè¡¨å•ä»¥åœ¨æµè§ˆå™¨ä¸­åˆ›å»ºä»»åŠ¡ </li><li> ä»æ‰‹åŠ¨è®¾ç½®ä»»åŠ¡æ—¶åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹AJAXè¯·æ±‚ã€‚ </li></ul><br><p>  <strong>å¿…é¡»æ ¹æ®å…¶ç±»å‹åœ¨æ­£ç¡®çš„yamlå—ä¸­å£°æ˜ä»»åŠ¡çš„å±æ€§</strong> ï¼š </p><br><ul><li> æ‰€æœ‰å­—ç¬¦ä¸²å±æ€§ï¼ˆå³å­˜å‚¨åº“åç§°ï¼Œå­˜å‚¨åº“åç§°ï¼Œæ—¶é—´æ®µ...ï¼‰çš„<code>taskProperties</code> ã€‚ </li><li> æ‰€æœ‰é€»è¾‘å±æ€§çš„<code>booleanTaskProperties</code> ï¼ˆå³ï¼ŒåŸºæœ¬å…³ç³»åˆ›å»ºä»»åŠ¡çš„å›¾å½¢ç•Œé¢ä¸­çš„å¤é€‰æ¡†ï¼‰ã€‚ </li></ul><br><h3 id="rezervnye-kopii"> åå¤‡ </h3><br><pre> <code class="plaintext hljs"> nexus_backup_configure: false nexus_backup_cron: '0 0 21 * * ?' # See cron expressions definition in nexus create task gui nexus_backup_dir: '/var/nexus-backup' nexus_restore_log: '{{ nexus_backup_dir }}/nexus-restore.log' nexus_backup_rotate: false nexus_backup_rotate_first: false nexus_backup_keep_rotations: 4 # Keep 4 backup rotation by default (current + last 3)</code> </pre> <br><p> åœ¨å°†<code>nexus_backup_configure</code>åˆ‡æ¢ä¸º<code>true</code>ä¹‹å‰ï¼Œå°†ä¸ä¼šè®¾ç½®å¤‡ä»½ã€‚ <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¡åˆ’çš„è„šæœ¬ä»»åŠ¡å°†é…ç½®ä¸ºåœ¨Nexusä¸Šè¿è¡Œ <br> ä»¥<code>nexus_backup_cron</code>æŒ‡å®šçš„é—´éš”ï¼ˆé»˜è®¤ä¸ºæ¯å¤©21:00ï¼‰ã€‚ <br> æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[æ­¤ä»»åŠ¡çš„groovyæ¨¡æ¿]ï¼ˆæ¨¡æ¿/ backup.groovy.j2ï¼‰ã€‚ <br> æ­¤è®¡åˆ’ä»»åŠ¡ç‹¬ç«‹äºæ‚¨çš„å…¶ä»–<code>nexus_scheduled_tasks</code> <br> åœ¨æ‚¨çš„å‰§æœ¬ä¸­å®£å¸ƒã€‚ </p><br><p> å¦‚æœè¦å¾ªç¯/åˆ é™¤å¤‡ä»½ï¼Œè¯·è®¾ç½®<code>nexus_backup_rotate: true</code>å¹¶ä½¿ç”¨<code>nexus_backup_rotate: true</code>é…ç½®è¦ä¿å­˜çš„å¤‡ä»½æ•°é‡ï¼ˆé»˜è®¤ä¸º4ï¼‰ã€‚ </p><br><p> ä½¿ç”¨è½®æ¢æ—¶ï¼Œå¦‚æœè¦åœ¨å¤‡ä»½è¿‡ç¨‹ä¸­èŠ‚çœæ›´å¤šç£ç›˜ç©ºé—´ï¼Œ <br> æ‚¨å¯ä»¥è®¾ç½®<code>nexus_backup_rotate_first: true</code> ã€‚    /  .        .  ,        <br>   ,     . </p><br><h4 id="procedura-vosstanovleniya">   </h4><br><p>  playbook   <code>-e nexus_restore_point=&lt;YYYY-MM-dd-HH-mm-ss&gt;</code> <br> (, 2017-12-17-21-00-00  17  2017  21:00 </p><br><h4 id="udalenie-nexus">  nexus </h4><br><p> <strong>:     .     ,   </strong> </p><br><p>   <code>nexus_purge</code> ,          nexus    . </p><br><pre> <code class="bash hljs">ansible-playbook -i your/inventory.ini your_nexus_playbook.yml -e nexus_purge=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><h4 id="izmenit-parol-administratora-posle-pervoy-ustanovki">       </h4><br><pre> <code class="plaintext hljs"> nexus_default_admin_password: 'admin123'</code> </pre> <br><p> <strong>       playbook</strong> .       Nexus     ,        <code>nexus_admin_password</code> . </p><br><p>         ,           .   <code>nexus_admin_password</code>       : </p><br><pre> <code class="bash hljs">ansible-playbook -i your/inventory.ini your_playbook.yml -e nexus_default_admin_password=oldPassword</code> </pre> <br><p>    Nexus Sonatype: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://t.me/ru_nexus_sonatype</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN473358/">https://habr.com/ru/post/zh-CN473358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN473346/index.html">ä½¿ç”¨Node.jså’ŒOracleæ•°æ®åº“åˆ›å»ºREST APIã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN473348/index.html">ä»¥åˆ†ç±»é—®é¢˜ä¸ºä¾‹çš„æœºå™¨å­¦ä¹ ä¸­çš„æƒ¯æ€§æ€æƒ³ï¼ˆSGDmï¼‰ï¼Œç¼©æ”¾æ€æƒ³ï¼ˆAdagradï¼‰å’Œæ­£åˆ™åŒ–æ€æƒ³</a></li>
<li><a href="../zh-CN473350/index.html">ä½¿ç”¨Node.jså’ŒOracleæ•°æ®åº“åˆ›å»ºREST APIã€‚ ç¬¬ä¸‰éƒ¨åˆ†</a></li>
<li><a href="../zh-CN473352/index.html">Ğ¡oncurrentcollections in 10 minutes</a></li>
<li><a href="../zh-CN473354/index.html">å…³äºè¡€æ¶²ç»Ÿè®¡å­¦çš„å¥‡å¼‚ä¹‹å¤„</a></li>
<li><a href="../zh-CN473362/index.html">GSoCç»éªŒï¼šä¸¤ï¼ˆä¸‰ï¼‰åå­¦ç”Ÿå¦‚ä½•çœŸæ­£æ”¹å–„CRIUä»£ç </a></li>
<li><a href="../zh-CN473364/index.html">æœ‰ä¸€ä¸ªè™¾è™é±¼åœ¨æ‘‡æ‘†ï¼šé”€å”®å­£èŠ‚ä¸­çš„ç”µå­å•†åŠ¡æ¸…å•</a></li>
<li><a href="../zh-CN473366/index.html">æˆ‘çš„æ™ºèƒ½ç”µè§†ä¸ºæ‚¨å‡†å¤‡äº†ä»€ä¹ˆï¼Ÿ è¿˜æ˜¯ç”µè§†é‡Œå¡æ»¡äº†ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN473368/index.html">MIROæ˜¯ä¸€ä¸ªå¼€æ”¾çš„å®¤å†…æœºå™¨äººå¹³å°ã€‚ ç¬¬3éƒ¨åˆ†-è½¯ä»¶ç»„ä»¶ï¼šESP8266</a></li>
<li><a href="../zh-CN473372/index.html">åˆ›å»ºç®€å•çš„å‘¼å«è·Ÿè¸ªæœåŠ¡ï¼Œç¬¬1éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>