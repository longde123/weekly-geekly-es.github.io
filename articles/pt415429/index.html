<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö± üçÜ üíä Toda a verdade sobre o RTOS de Colin Walls. Artigo 5. Intera√ß√£o e sincroniza√ß√£o de tarefas üö≥ ü§æüèº üë®üèæ‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em artigos anteriores, examinamos o modelo de multitarefa e descobrimos que cada tarefa √© um programa quase independente. Embora as tarefas nos sistem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toda a verdade sobre o RTOS de Colin Walls. Artigo 5. Intera√ß√£o e sincroniza√ß√£o de tarefas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415429/"><img src="https://habrastorage.org/webt/b6/2h/cm/b62hcmzcfpnzqg0tz4pzveimzmw.jpeg"><br><br>  Em artigos anteriores, examinamos o modelo de multitarefa e descobrimos que cada tarefa √© um programa quase independente.  Embora as tarefas nos sistemas embarcados tenham um certo grau de independ√™ncia, isso n√£o significa que elas n√£o "se conhecem".  Algumas tarefas ser√£o realmente isoladas de outras, mas a intera√ß√£o e a sincroniza√ß√£o entre elas s√£o um requisito comum.  Este mecanismo √© uma das principais fun√ß√µes do RTOS.  A gama de fun√ß√µes pode variar dependendo do RTOS, portanto, neste artigo, consideraremos as op√ß√µes dispon√≠veis ao p√∫blico. <br><a name="habracut"></a><br>  Artigos anteriores da s√©rie: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas, altern√¢ncia de contexto e interrup√ß√µes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas e planejamento</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTOS: estrutura e modo em tempo real</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTOS: introdu√ß√£o.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><br></a> <br><h3>  <b>Faixa de fun√ß√µes</b> </h3><br>  Existem tr√™s modelos de intera√ß√£o e sincroniza√ß√£o entre tarefas: <br><br><ul><li>  Os servi√ßos est√£o vinculados a tarefas: o RTOS fornece tarefas com atributos que fornecem intera√ß√£o entre eles.  Considere os sinais como um exemplo. </li><li>  Os objetos do kernel s√£o meios aut√¥nomos de comunica√ß√£o ou sincroniza√ß√£o.  Exemplos: sinalizadores de eventos, caixas de correio, filas / canais, sem√°foros e mutexes. </li><li>  O sistema de mensagens √© um esquema simplificado no qual o RTOS permite criar objetos de mensagens e transferi-los de uma tarefa para outra ou v√°rias.  Isso √© fundamental para a arquitetura do kernel e, portanto, esse sistema √© chamado de "mensagens RTOS". </li></ul><br>  Os mecanismos ideais para diferentes processos variam.  Seus recursos podem se sobrepor, por isso vale a pena considerar a escalabilidade desses modelos.  Por exemplo, se um aplicativo exigir v√°rias filas, mas apenas uma caixa de correio, voc√™ poder√° implementar uma caixa de correio com uma fila para um item.  Esse objeto n√£o ser√° completamente ideal, mas o c√≥digo inteiro da caixa de correio n√£o ser√° inclu√≠do no aplicativo e, portanto, a escalabilidade reduzir√° a quantidade de mem√≥ria usada pelo RTOS. <br><br><h3>  <b>Vari√°veis ‚Äã‚Äãcomuns ou √°reas de mem√≥ria</b> </h3><br>  Uma abordagem simplificada para a intera√ß√£o entre tarefas √© a presen√ßa no sistema de vari√°veis ‚Äã‚Äãou √°reas de mem√≥ria que est√£o dispon√≠veis para todas as tarefas.  Essa abordagem pode ser aplicada a v√°rios processos, apesar de sua simplicidade.  O acesso deve ser controlado.  Se a vari√°vel for apenas um byte, √© prov√°vel que gravar ou ler nela seja uma opera√ß√£o at√¥mica (ou seja, cont√≠nua), mas √© necess√°rio ter cuidado se o processador permitir outras opera√ß√µes nos bytes de mem√≥ria, pois elas podem ser interrompidas e podem ocorrer problema de sincroniza√ß√£o.  Uma maneira de implementar o bloqueio / desbloqueio √© desativar as interrup√ß√µes por um curto per√≠odo de tempo. <br><br>  Se voc√™ usa uma √°rea de mem√≥ria, ainda precisa de uma trava.  Voc√™ pode usar o primeiro byte como um sinalizador de bloqueio, j√° que a arquitetura da mem√≥ria fornece acesso at√¥mico a esse byte.  Uma tarefa carrega dados em uma √°rea de mem√≥ria, define um sinalizador e aguarda a redefini√ß√£o.  Outra tarefa est√° aguardando o sinalizador ser definido, lendo os dados e redefinindo o sinalizador.  Usar a interrup√ß√£o desativada como um bloqueio √© menos sens√≠vel, pois a movimenta√ß√£o de todo o buffer de dados pode levar algum tempo. <br><br>  Esse uso da mem√≥ria compartilhada √© semelhante √† implementa√ß√£o de muitas comunica√ß√µes entre processadores em sistemas com v√°rios n√∫cleos.  Em alguns casos, o bloqueio e / ou interrup√ß√£o do hardware s√£o incorporados na interface interprocessador da mem√≥ria compartilhada. <br><br><h3>  <b>Signals</b> </h3><br>  Os sinais s√£o um dos mecanismos mais simples de intera√ß√£o entre tarefas oferecidas pelo RTOS tradicional.  Eles cont√™m um conjunto de sinalizadores de bit (8, 16 ou 32, dependendo do aplicativo espec√≠fico), que est√° associado a uma tarefa espec√≠fica. <br>  O sinalizador de sinal (ou v√°rios sinalizadores) pode ser definido por qualquer tarefa usando a opera√ß√£o l√≥gica "OR".  Os sinalizadores podem ser lidos apenas por uma tarefa que cont√©m um sinal.  O processo de leitura geralmente √© destrutivo, ou seja, os sinalizadores tamb√©m s√£o redefinidos. <br>  Em alguns sistemas, os sinais s√£o implementados de uma maneira mais complexa, de modo que uma fun√ß√£o especial atribu√≠da pelo propriet√°rio da tarefa do sinal seja executada automaticamente quando qualquer sinalizador for definido.  Isso elimina a necessidade da tarefa de controlar os sinalizadores em si.  Isso √© um pouco semelhante a um manipulador de interrup√ß√£o. <br><br><h3>  <b>Grupos de Sinalizadores de Eventos</b> </h3><br>  Grupos de sinalizadores de eventos s√£o semelhantes aos sinais, pois s√£o uma ferramenta orientada a bits para intera√ß√£o entre tarefas.  Da mesma forma, eles podem conter 8, 16 ou 32 bits.  Ao contr√°rio dos sinais, eles s√£o objetos principais independentes e n√£o "pertencem" a nenhuma tarefa espec√≠fica.  Qualquer tarefa pode definir e redefinir sinalizadores de eventos usando as opera√ß√µes l√≥gicas ‚ÄúOR‚Äù e ‚ÄúAND‚Äù.  Da mesma forma, qualquer tarefa pode verificar sinalizadores de eventos usando as mesmas opera√ß√µes.  Em muitos RTOS, voc√™ pode fazer uma chamada de API de bloqueio para uma combina√ß√£o de sinalizadores de eventos.  Ou seja, a tarefa pode ser suspensa at√© que uma combina√ß√£o espec√≠fica de sinalizadores de eventos seja definida.  A op√ß√£o "consumir" tamb√©m pode estar dispon√≠vel ao verificar os sinalizadores de eventos, que redefinem todos os sinalizadores. <br><br><h3>  <b>Sem√°foros</b> </h3><br>  Sem√°foros s√£o objetos independentes do kernel usados ‚Äã‚Äãpara a contabilidade de recursos.  Existem dois tipos de sem√°foros: bin√°rio (pode ter apenas dois valores) e geral (n√∫mero ilimitado de valores).  Alguns processadores suportam instru√ß√µes (at√¥micas) que facilitam a r√°pida implementa√ß√£o de sem√°foros bin√°rios.  Os sem√°foros bin√°rios podem ser implementados como sem√°foros gerais com o valor 1. <br><br>  Qualquer tarefa pode tentar atribuir um sem√°foro para obter acesso ao recurso.  Se o valor atual do sem√°foro for maior que 0 (o sem√°foro est√° livre), o valor do contador ser√° reduzido em 1; portanto, a atribui√ß√£o ser√° bem-sucedida.  Em muitos sistemas operacionais, um mecanismo de bloqueio pode ser usado para atribuir um sem√°foro.  Isso significa que a tarefa pode estar em um estado de espera at√© que o sem√°foro seja liberado por outra tarefa.  Qualquer tarefa pode liberar o sem√°foro e, em seguida, o valor do sem√°foro aumentar√°. <br><br><h3>  <b>Caixas de correio</b> </h3><br>  Caixas de correio s√£o objetos independentes do kernel que fornecem os meios para enviar mensagens.  O tamanho da mensagem depende da implementa√ß√£o, mas geralmente √© corrigido.  Os tamanhos t√≠picos das mensagens s√£o de um a quatro elementos do tamanho de um ponteiro.  Normalmente, um ponteiro para dados mais complexos √© enviado pela caixa de correio.  Alguns kernels implementam caixas de correio de forma que os dados sejam simplesmente armazenados em uma vari√°vel regular e o kernel controla o acesso a eles.  As caixas de correio tamb√©m podem ser chamadas de "troca", embora esse nome agora seja raramente visto. <br><br>  Qualquer tarefa pode enviar mensagens para uma caixa de correio, que √© preenchida.  Se uma tarefa tentar enviar uma mensagem para uma caixa de correio cheia, ela receber√° uma resposta de erro.  Em muitos RTOS, voc√™ pode usar um mecanismo de bloqueio para enviar para a caixa de correio.  Isso significa que a tarefa ser√° suspensa at√© que a mensagem na caixa de correio seja lida.  Qualquer tarefa pode ler mensagens da caixa de correio, ap√≥s o que est√° vazia.  Se uma tarefa tentar ler de uma caixa de correio vazia, ela receber√° uma resposta de erro.  Em muitos RTOS, voc√™ pode usar uma chamada de bloqueio para ler de uma caixa de correio.  Isso significa que a tarefa ser√° suspensa at√© que uma nova mensagem apare√ßa na caixa de correio. <br><br>  Alguns RTOS suportam a fun√ß√£o "broadcast".  Isso permite que voc√™ envie mensagens para todas as tarefas atualmente pausadas durante a leitura de uma caixa de correio espec√≠fica. <br><br>  Alguns RTOS n√£o oferecem suporte a caixas de correio.  Em vez disso, √© recomend√°vel usar uma fila de elemento √∫nico.  Isso √© funcionalmente equivalente, mas carrega uma sobrecarga adicional para mem√≥ria e tempo de execu√ß√£o. <br><br><h3>  <b>Filas</b> </h3><br>  Filas s√£o objetos independentes do kernel que fornecem um mecanismo para o envio de mensagens.  Eles s√£o um pouco mais flex√≠veis e complexos que as caixas de correio.  O tamanho da mensagem depende da implementa√ß√£o, mas geralmente √© fixo e orientado para a palavra / ponteiro. <br><br>  Qualquer tarefa pode enviar mensagens para a fila, e isso pode ser repetido at√© que a fila esteja cheia, ap√≥s o que qualquer tentativa de envio resultar√° em erro.  O comprimento da fila geralmente √© determinado pelo usu√°rio ao criar ou configurar o sistema.  Em muitos RTOS, voc√™ pode aplicar um mecanismo de bloqueio √† fila.  Ou seja, se a fila estiver cheia, a tarefa poder√° ser suspensa at√© que a mensagem na fila seja lida por outra tarefa.  Qualquer tarefa pode ler mensagens da fila.  As mensagens s√£o lidas na mesma ordem em que foram enviadas (primeiro a entrar - primeiro a sair, FIFO).  Se uma tarefa tentar ler de uma fila vazia, receber√° uma resposta de erro.  Em muitos RTOS, um mecanismo de bloqueio pode ser usado para ler de uma fila vazia.  Ou seja, se a fila estiver vazia, a tarefa poder√° ser suspensa at√© que a mensagem seja enviada para a fila por outra tarefa. <br><br>  Provavelmente, haver√° um mecanismo no RTOS para enviar uma mensagem para a frente da fila, isso √© chamado de interfer√™ncia.  Alguns RTOS tamb√©m suportam a fun√ß√£o de transmiss√£o.  Isso permite que voc√™ envie mensagens para todas as tarefas pausadas durante a leitura da fila. <br><br>  Al√©m disso, o RTOS pode suportar o envio e a leitura de mensagens de tamanho vari√°vel.  Isso proporciona mais flexibilidade, mas implica sobrecarga adicional. <br><br>  Muitos RTOSs suportam outro tipo de objeto de kernel, os "pipes".  Em ess√™ncia, um canal √© semelhante a uma fila, mas processa dados orientados a bytes. <br><br>  A funcionalidade das filas n√£o √© interessante, mas deve-se entender que elas t√™m mais sobrecarga de mem√≥ria e tempo de execu√ß√£o que as caixas de correio, principalmente porque √© necess√°rio salvar dois ponteiros: o in√≠cio e o fim da fila. <br><br><h3>  <b>Mutexes</b> </h3><br>  Os mutexes (sem√°foros mutuamente exclusivos) s√£o objetos independentes do kernel que se comportam muito como sem√°foros bin√°rios regulares.  Eles s√£o um pouco mais complicados que os sem√°foros e incluem o conceito de propriedade tempor√°ria (um recurso para o qual o acesso √© controlado).  Se uma tarefa atribuir um mutex, apenas a mesma tarefa poder√° liber√°-lo novamente: o mutex (e, portanto, o recurso) pertence temporariamente √† tarefa. <br><br>  Os mutexes n√£o s√£o fornecidos por todos os RTOS, mas o sem√°foro bin√°rio comum √© bastante f√°cil de adaptar.  Voc√™ deve escrever uma fun√ß√£o de obten√ß√£o mutex que atribua um sem√°foro e um identificador de tarefa.  Em seguida, a fun√ß√£o adicional ‚Äúrelease mutex‚Äù verifica o identificador da tarefa que est√° chamando e libera o sem√°foro apenas se corresponder ao valor armazenado, caso contr√°rio, retornar√° um erro. <br><br>  <i>Quando trabalhamos em nosso pr√≥prio sistema operacional OSRV MAX em tempo real (artigos publicados anteriormente sobre ele), nossa equipe encontrou o blog de Colin Walls, especialista em microeletr√¥nica e firmware da Mentor Graphics.</i>  <i>Os artigos pareciam interessantes, os traduziam por si mesmos, mas, para n√£o "escrever para a mesa", eles decidiram publicar.</i>  <i>Espero que eles tamb√©m sejam √∫teis para voc√™.</i>  <i>Nesse caso, planejamos publicar todos os artigos traduzidos da s√©rie.</i> <i><br><br></i>  <i>Sobre o autor: Colin Walls trabalha na ind√∫stria eletr√¥nica h√° mais de trinta anos, dedicando a maior parte de seu tempo ao firmware.</i>  <i>Ele agora √© engenheiro de firmware na Mentor Embedded (uma divis√£o da Mentor Graphics).</i>  <i>Colin Walls frequentemente fala em confer√™ncias e semin√°rios, autor de v√°rios artigos t√©cnicos e dois livros sobre firmware.</i>  <i>Vive no Reino Unido.</i>  <i>Blog profissional de Colin: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">blogs.mentor.com/colinwalls</a> , e-mail: colin_walls@mentor.com</i> <br><br>  Leia o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeiro, segundo,</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">terceiro e</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quarto</a> artigos publicados anteriormente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415429/">https://habr.com/ru/post/pt415429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415415/index.html">An√∫ncio de uma confer√™ncia hackathon sobre desenvolvimento de jogos no blockchain GameNode</a></li>
<li><a href="../pt415417/index.html">Avalia√ß√£o do smartphone ASUS ZenFone Max Pro (M1) ZB602KL</a></li>
<li><a href="../pt415421/index.html">Convidamos voc√™ para o espa√ßo de trabalho colaborativo Gravity para o √∫ltimo torneio de contrata√ß√£o da temporada</a></li>
<li><a href="../pt415423/index.html">Infraestrutura de chave p√∫blica: autoridade de certifica√ß√£o baseada no utilit√°rio OpenSSL e SQLite3 (Postcryptum)</a></li>
<li><a href="../pt415427/index.html">Toda a verdade sobre o RTOS de Colin Walls. Artigo 4. Tarefas, altern√¢ncia de contexto e interrup√ß√µes</a></li>
<li><a href="../pt415431/index.html">An√∫ncio Hackathon SmartMail Hack 2: Chamada de Dados</a></li>
<li><a href="../pt415433/index.html">Gerenciamento de lan√ßamentos em servi√ßos de alojamento e servi√ßos comunit√°rios - compartilhamos experi√™ncia e lutamos com a intui√ß√£o</a></li>
<li><a href="../pt415435/index.html">Desenvolvimento de placas de interface no solo Xilinx Zynq 7000 para grava√ß√£o de voz em formato anal√≥gico e digital</a></li>
<li><a href="../pt415437/index.html">Como rolar ML em prod: seis rakes em que pisamos</a></li>
<li><a href="../pt415439/index.html">A comunica√ß√£o corporativa for√ßa voc√™ a sair ou arrast√°-lo para um projeto como um jogo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>