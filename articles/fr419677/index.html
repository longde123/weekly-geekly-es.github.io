<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍⚖️ 🤚🏾 🐵 Comment renifler le trafic HTTPS d'un appareil iOS 🧑🏽‍🤝‍🧑🏽 🦁 🛀🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, je m'appelle Andrey Batutin, je suis développeur iOS senior dans DataArt, et aujourd'hui nous allons flairer le trafic HTTPS de votre iPhone....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment renifler le trafic HTTPS d'un appareil iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/419677/"><img src="https://habrastorage.org/webt/a4/n0/ad/a4n0adtaeosbezsajgrfszbxtrw.jpeg"><br><br>  Bonjour, je m'appelle Andrey Batutin, je suis développeur iOS senior dans DataArt, et aujourd'hui nous allons flairer le trafic HTTPS de votre iPhone. <a name="habracut"></a><br><br><h2>  FoodSniffer et avec quoi il est mangé </h2><br>  Prenez, par exemple, la très simple application iOS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FoodSniffer</a> .  En fonction de l'heure de la journée, il indique à l'utilisateur ce qu'il doit manger. <br><br><img src="https://habrastorage.org/webt/fs/br/u_/fsbru_ly25oqnao_8ifqt42jacy.png"><br><br>  L'application reçoit du serveur JSON du formulaire: <br><br><pre><code class="hljs json">[ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"soup"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"consumePeriod"</span></span> : <span class="hljs-string"><span class="hljs-string">"morning"</span></span> }, … ]</code> </pre> <br>  Dans ce cas, le serveur est Dropbox et JSON peut être consulté <a href="">ici</a> . <br><br><h2>  Problème numéro 1 </h2><br>  Un bug est venu qu'au lieu de deux éléments dans la liste des aliments autorisés le matin, l'application n'en affiche qu'un seul. <br><br>  Une façon de vérifier ce qui n'a pas fonctionné est de voir le JSON que le serveur vous renvoie. <br><br><h3>  Comment flairer le trafic? </h3><br>  Supposons que votre ordinateur MacOS et votre appareil iOS soient sur le même réseau local, qui ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/v5/_l/aw/v5_lawxwesaw6qpr3-snd0c7dfe.png"><br><br>  Le trafic passe d'un appareil iOS via un routeur à un serveur, quel que soit le trafic informatique. <br><br>  Pour lire le trafic d'un appareil iOS, nous devons le faire passer par notre Mac.  Quelque chose comme ça: <br><br><img src="https://habrastorage.org/webt/qq/lz/xf/qqlzxf6q92ygyk73v4bruvsqml0.png"><br><br>  De plus, nous aurons besoin d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">serveur proxy</a> HTTP / S, avec lequel nous surveillerions / modifierions le trafic passant de l'appareil iOS. <br><br>  Une autre tâche très importante est de pouvoir renifler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le</a> trafic <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HTTPS</a> .  Le hic est que le protocole HTTPS a été créé de sorte que, à l'exception du client et du serveur, personne ne puisse lire ce qui est transmis dans les requêtes HTTPS.  Par conséquent, le proxy HTTPS doit également fournir avec lui un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">certificat SSL</a> , qui est nécessaire pour travailler avec le trafic HTTPS. <br><br>  En d'autres termes, nous devons mettre en œuvre l'attaque M <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">an-in-the-Middle</a> sur notre propre réseau. <br><br><img src="https://habrastorage.org/webt/_x/bj/sb/_xbjsbi2ehcuk3fwbbeoaw9lsr8.png"><br><br><h3>  Application proxy de débogage Web Charles </h3><br>  Comme vous pouvez le voir, renifler du trafic HTTPS est une tâche en plusieurs étapes.Par conséquent, pour simplifier au maximum ma vie, j'utilise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Charles Proxy</a> . <br><br>  Commençons par les inconvénients: <br><br><ul><li>  Il est payé, mais la seule limitation qui se trouve dans la version d'essai est que Charles ne fonctionne pas plus de 30 minutes, puis il doit être redémarré.  Il y a encore cinq secondes de retard au démarrage.  C'est ennuyeux, mais vous pouvez vivre. </li><li>  Si vous avez besoin d'un véritable outil de piratage pour travailler sur un serveur distant 24/7, et même avec une CLI normale, Charles n'est pas pour vous. </li><li>  Si vous travaillez sur Windows, vous feriez mieux de prendre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fiddler</a> , qui est également gratuit. </li><li>  Si vous avez besoin d'un serveur proxy pour un grand nombre d'appareils (plus de deux ou trois), Charles n'est pas pour vous. </li><li>  Si vous devez travailler avec des paquets TCP / IP sous forme pure, prenez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wireshark</a> . </li></ul><br>  Maintenant les pros: <br><br><ul><li>  Interface utilisateur conviviale.  Charles n'a pas besoin de connaissances particulières pour installer, configurer ou utiliser.  Application de fenêtre MacOs normale. </li><li>  HTTPS pour iOS - Charles possède un ensemble d'outils qui rendent le HTTPS reniflant à partir de votre appareil iOS aussi simple que possible. </li><li>  Fonctionnalité - Charles peut flairer, modifier le trafic qui le traverse, simuler un Internet lent, collecter des statistiques, importer / exporter du trafic dans différents formats. </li><li>  Disponible pour Windows et Linux. </li></ul><br>  Pour moi, c'est la meilleure solution pour le ratio de fonctionnalités et la facilité d'utilisation lorsque vous travaillez avec des appareils iOS. <br><br><h3>  Configuration des appareils Charles et iOS </h3><br>  Ce qui suit décrira la procédure de configuration initiale pour qu'un appareil iOS fonctionne avec Charles Proxy. <br><br>  1. Lancez Charles sur l'ordinateur: <br><br><img src="https://habrastorage.org/webt/7_/9t/t2/7_9tt282e2ulhrkg6nha0zlidsw.png"><br><br>  2. Installez Charles Root Certificate sur votre appareil iOS: <br><br>  Dans le menu, sélectionnez Aide -&gt; Proxation SSL -&gt; Installer le certificat racine Charles sur un appareil mobile ou un navigateur distant. <br><br><img src="https://habrastorage.org/webt/ee/tl/vl/eetlvlctkstxbxa0uld6b6nbwvk.png"><br><br>  La fenêtre suivante apparaîtra: <br><br><img src="https://habrastorage.org/webt/70/o5/0g/70o50ggj92kd8t_fjxo-a--uh3e.png"><br><br>  3. Dans les paramètres réseau de l'appareil iOS, spécifiez l'IP et le port de Charles Proxy: <br><br><img src="https://habrastorage.org/webt/0e/q3/oz/0eq3ozbi5czwwi7sgpzu_j8nfg8.png"><br><br>  Selon l'architecture de votre réseau, l'adresse IP sur laquelle Charles s'exécute peut varier. <br><br>  4. Ouvrez le navigateur sur l'appareil iOS et suivez le lien - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://chls.pro/ssl</a> . <br><br><img src="https://habrastorage.org/webt/mc/_6/ol/mc_6ol45uh4yrwixs0b0p0ko9xm.png"><br><br>  5. Installez le certificat SSL Charles sur l'appareil: <br><br><img src="https://habrastorage.org/webt/km/0p/9-/km0p9-zasxuckzmyoqd1hgqtw2y.png"><br><br>  6. Nous indiquons dans les paramètres de l'appareil que nous faisons entièrement confiance à ce certificat: <br><br><img src="https://habrastorage.org/webt/co/bd/2c/cobd2cqa3rcoacww-3coe2-nohs.png"><br><br>  La sixième étape est nécessaire pour les appareils avec iOS 10 et supérieur. <br><br>  Aux étapes 5 à 6, nous avons installé un certificat SSL sur l'appareil Charles et indiqué que nous lui faisons confiance.  En d'autres termes, tout le trafic HTTPS signé avec ce certificat ne sera plus bloqué par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ATS</a> . <br><br><h3>  Comment regarder le trafic des appareils iOS </h3><br>  Ouvrez l'application <b>FoodSniffer</b> .  Si la configuration du proxy a été effectuée correctement, vous devriez voir un écran comme celui-ci: <br><br><img src="https://habrastorage.org/webt/fs/br/u_/fsbru_ly25oqnao_8ifqt42jacy.png"><br><br>  Dans Charles Proxy, accédez à Tools -&gt; No Caching. <br><br>  Et désactivez complètement la mise en cache sur le serveur proxy. <br><br><img src="https://habrastorage.org/webt/kp/7k/pf/kp7kpfnjabtpe3rz-c_n-72hmau.png"><br><br>  L'application implémente Pull-to-refresh, après avoir mis à jour la liste des produits, vous devriez voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.dropbox.com</a> dans la liste sur le côté gauche de Charles.  Faites un clic droit dessus et sélectionnez <b>Activer le proxy SSL</b> . <br><br><img src="https://habrastorage.org/webt/o8/wm/0l/o8wm0l9qpirei_uclwreglz4xgq.png"><br><br>  Ensuite, mettez à jour la liste des produits dans l'application.  Maintenant, vous devriez voir quelque chose comme ça: <br><br><img src="https://habrastorage.org/webt/ep/up/dm/epupdm7buiijg5cxr1iaq8bg-dk.png"><br><br>  Nous pouvons maintenant lire librement le trafic HTTPS qui provient de l'application sur Dropbox pour notre JSON. <br><br>  Mais ce n’est pas tout! <br><br>  Dropbox ne donne pas directement JSON de l'hôte dropbox.com.  Au lieu de cela, il renvoie 302 réponses et redirige vers un autre hôte à partir duquel les données sont téléchargées. <br><br>  Vous pouvez le trouver en consultant la <b>réponse brute de la</b> requête suivante: <br><br><img src="https://habrastorage.org/webt/ku/kl/ut/kuklut0rfyvddx9btfcbxfywkpk.png"><br><br>  Dans ce cas, c'est - <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">uc9c29db95802af8490afc3afda9.dl.dropboxusercontent.com</a></b> . <br><br>  Vous aurez très probablement un hôte légèrement différent. <br><br>  <b>Activez</b> ensuite <b>SSL Proxing: activé</b> pour cela. <br><br>  <b>Nous mettons à jour FoodSniffer à</b> nouveau. <br><br>  Et maintenant, nous pouvons enfin voir le vrai JSON, que l'application montre! <br><br><img src="https://habrastorage.org/webt/yc/sc/3t/ycsc3tuo_h-nx6fnsqwxjrcpmxo.png"><br><br>  Nous voyons que nous n'avons qu'un seul type de nourriture le soir - du whisky, écrivez-en à notre chef d'équipe et allez boire un café, le problème n'est pas de notre côté. <br><br>  * Le projet utilise du JSON déjà corrigé, avec deux types d'aliments pour la soirée: la bière et le whisky. <br>  * Si vous ne voyez pas l'hôte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://uc9c29db95802af8490afc3afda9.dl.dropboxusercontent.com</a> ou similaire dans la liste sur le côté gauche de la fenêtre, essayez de mettre à jour la liste des produits dans l'application plusieurs fois. <br><br><h2>  Problème n ° 2, ou comment modifier le trafic HTTPS d'un appareil iOS </h2><br>  L'équipe backend a fixé le menu de la soirée, et maintenant le JSON est correctement formé.  Mais que se passe-t-il si c'est le matin et que je n'ai pas envie d'attendre le soir pour vérifier le correctif? <br><br>  Une option consiste à utiliser Charles pour modifier le JSON qui vous vient de Dropbox. <br><br>  Dans ce cas, nous devons changer <b>consumePeriod</b> du <b>soir</b> au <b>matin</b> . <br><br>  Pour ce faire, sélectionnez <b>Outils -&gt; Réécrire</b> dans le menu. <br><br>  Dans la fenêtre <b>Paramètres de réécriture</b> qui apparaît, ajoutez une nouvelle catégorie pour le remplacement - <b>dropbox</b> . <br><br><img src="https://habrastorage.org/webt/5v/gr/bt/5vgrbt2iaqgsh4hd5hlefm1a_qu.png"><br><br>  Ajoutez l'hôte en spécifiant le port https dans le menu <b>Modifier l'emplacement</b> : <br><br><img src="https://habrastorage.org/webt/5w/qv/9o/5wqv9oag85_grxuguzbyxfjcses.png"><br><br>  Après cela, nous ajoutons les règles de réécriture dans le menu <b>Règle de réécriture</b> comme suit: <br><br><img src="https://habrastorage.org/webt/wu/ta/_q/wuta_qy4lleaclipyxemcj-p39o.png"><br><br>  Autrement dit, maintenant dans chaque corps de la réponse de notre serveur, le mot <b>soir</b> sera remplacé par le mot <b>matin</b> . <br><br>  Si nécessaire, nous pouvons modifier n'importe quelle partie de la demande / réponse HTTP, plus utiliser une expression régulière pour remplacer le texte. <br><br>  Maintenant, après avoir mis à jour la liste, nous devrions voir quatre types de produits: <br><br><img src="https://habrastorage.org/webt/cv/ir/cb/cvircb-tlzrqrodkk3lywwleizc.png"><br><br><h2>  Conclusion </h2><br>  Charles est assez simple, shareware, a une riche fonctionnalité de proxy HTTPS.  De mon point de vue, cela fonctionne mieux lorsque vous travaillez avec des appareils MacOS et iOS. <br><br>  C'est loin d'être le seul moyen de renifler le trafic.  Pour le trafic HTTP / S, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fiddler est</a> également largement utilisé.  Si vous devez approfondir la pile TCP / IP, il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wireshark</a> . <br><br>  De plus, il existe un problème d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">épinglage de certificat</a> .  S'il est implémenté dans votre application, vous devez soit ajouter le certificat SSL Charles à la liste des certificats autorisés, soit utiliser des outils tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Frida</a> pour désactiver l'épinglage de certificat déjà au niveau de l'application.  J'espère en parler davantage dans le prochain article. <br><br>  Je serais heureux si vous partagez votre expérience dans la surveillance du trafic, y compris HTTP / S, des conseils et des lifehacks. <br><br>  <u>Remarque</u>  Utilisez cette technique uniquement pour vos applications, s'il vous plaît.  Soyez des pirates de lapin blanc! <br><br>  <u>Note 2.</u> Récemment, l'histoire à ce sujet a été publiée en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ukrainien</a> , mais en russe, je la publie pour la première fois. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419677/">https://habr.com/ru/post/fr419677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419663/index.html">Les organisations gouvernementales attirent les créateurs de pH ultra-petit avec des contrats, des primes et une simplification de la bureaucratie</a></li>
<li><a href="../fr419665/index.html">L'expérience de l'utilisation de LoRaWAN dans le système ASKUE en conditions réelles de la ville</a></li>
<li><a href="../fr419669/index.html">Dix meilleures souris de jeu pour tout portefeuille</a></li>
<li><a href="../fr419671/index.html">Limitations qui doivent être violées ou comment nous avons accéléré trois fois les tests fonctionnels</a></li>
<li><a href="../fr419673/index.html">L'univers primitif 6. La dynamique d'un univers en expansion homogène, partie 2</a></li>
<li><a href="../fr419679/index.html">Implémentation de l'API Spring Framework à partir de zéro. Procédure pas à pas pour les débutants. Partie 1</a></li>
<li><a href="../fr419683/index.html">Que signifient les métriques pour les équipes agiles?</a></li>
<li><a href="../fr419685/index.html">Les structures de données les plus importantes que vous devez savoir sur votre entretien de programmation</a></li>
<li><a href="../fr419687/index.html">Secret Keyboard Level 3 ou comment imprimer un long tiret</a></li>
<li><a href="../fr419689/index.html">I. Désadaptation. II. TDAH ou crétin paresseux?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>