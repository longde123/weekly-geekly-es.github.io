<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö´Ô∏è üëè üë©üèæ‚Äçüíº Aumente a densidade do cont√™iner em um n√≥ usando a tecnologia PFCACHE ‚úäüèΩ üë£ üë®üèª‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um dos objetivos do provedor de hospedagem √© o descarte m√°ximo poss√≠vel dos equipamentos existentes para fornecer um servi√ßo de qualidade aos usu√°rios...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aumente a densidade do cont√™iner em um n√≥ usando a tecnologia PFCACHE</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rusonyx/blog/444696/"><img src="https://habrastorage.org/webt/a-/fc/i7/a-fci74gdtqxnzgdn7b_q41lr3k.jpeg"><br><br>  Um dos objetivos do provedor de hospedagem √© o descarte m√°ximo poss√≠vel dos equipamentos existentes para fornecer um servi√ßo de qualidade aos usu√°rios finais.  Os recursos dos servidores finais s√£o sempre limitados; no entanto, o n√∫mero de servi√ßos de clientes hospedados e, no nosso caso, estamos falando de VPS, pode variar significativamente.  Leia sobre como subir em uma √°rvore de Natal e comer um hamb√∫rguer embaixo de um gato. <a name="habracut"></a><br><br>  A consolida√ß√£o de um VPS em um n√≥ de forma que os clientes n√£o sintam isso ajuda muito a aumentar o desempenho econ√¥mico de qualquer provedor de hospedagem.  Obviamente, um n√≥ n√£o deve estourar nas costuras se os cont√™ineres estiverem amontoados nos globos oculares, e todos os clientes sentirem imediatamente qualquer aumento na carga. <br><br>  <b>Quantos VPS podem ser colocados em um n√≥ depende de muitos fatores, como √≥bvios:</b> <br><br><ol><li>  Caracter√≠sticas do ferro do pr√≥prio n√≥ </li><li>  Tamanho VPS </li><li>  Padr√£o de carga VPS </li><li>  Tecnologias de software que ajudam a otimizar a densidade </li></ol><br>  Nesse caso, compartilharemos nossa experi√™ncia usando a tecnologia Pfcache para Virtuozzo. <br>  Usamos o 6¬∫ ramo, mas tudo o que foi dito √© verdadeiro para o 7¬∫. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Pfcache</a> √© um mecanismo do Virtuozzo que ajuda a desduplicar IOPS e RAM em cont√™ineres, alocando os mesmos arquivos em cont√™ineres para uma zona comum separada. <br><br>  <b>De fato, consiste em:</b> <br><br><ol><li>  C√≥digo do Kernel </li><li>  Daemon de espa√ßo do usu√°rio </li><li>  Utilit√°rios de espa√ßo do usu√°rio </li></ol><br>  No lado do n√≥, destacamos uma se√ß√£o inteira na qual os arquivos ser√£o criados que todos os VPS no n√≥ usar√£o diretamente.  O dispositivo de bloco de ploop est√° montado nesta se√ß√£o.  Al√©m disso, no in√≠cio do cont√™iner, ele recebe uma refer√™ncia a esta se√ß√£o: <br><br><pre><code class="plaintext hljs">[root@pcs13 ~]# cat /proc/mounts ... /dev/ploop62124p1 /vz/pfcache ext4 rw,relatime,barrier=1,data=ordered,balloon_ino=12 0 0 ... /dev/ploop22927p1 /vz/root/418 ext4 rw,relatime,barrier=1,data=ordered,balloon_ino=12,pfcache_csum,pfcache=/vz/pfcache 0 0 /dev/ploop29642p1 /vz/root/264 ext4 rw,relatime,barrier=1,data=ordered,balloon_ino=12,pfcache_csum,pfcache=/vz/pfcache 0 0 ...</code> </pre> <br>  Aqui est√£o exemplos de estat√≠sticas sobre o n√∫mero de arquivos em um de nossos n√≥s: <br><br><pre> <code class="plaintext hljs">[root@pcs13 ~]# find /vz/pfcache -type f | wc -l 45851 [root@pcs13 ~]# du -sck -h /vz/pfcache 2.4G /vz/pfcache 2.4G total</code> </pre><br>  <b>O princ√≠pio do pfcache √© o seguinte:</b> <br><br><ul><li>  O daemon Pfcached no espa√ßo do usu√°rio grava o hash do arquivo sha-1 no atributo xattr desse arquivo.  Os arquivos n√£o s√£o processados ‚Äã‚Äãtodos, mas apenas nos diret√≥rios / usr, / bin, / usr / sbin, / sbin, / lib, / lib64 </li><li>  √â mais prov√°vel que os arquivos nesses diret√≥rios sejam "compartilhados" e sejam utilizados por v√°rios cont√™ineres; </li><li>  O Pfcached coleta periodicamente estat√≠sticas sobre a leitura de arquivos do kernel, analisa-o e adiciona arquivos ao cache se seu uso for frequente; </li><li>  Esses diret√≥rios podem ser diferentes e est√£o configurados nos arquivos de configura√ß√£o. </li><li>  Ao ler um arquivo, √© verificado se ele cont√©m o hash especificado nos atributos xattr estendidos.  Se ele contiver, o arquivo "comum" ser√° aberto, em vez do arquivo de cont√™iner.  Essa substitui√ß√£o ocorre despercebida pelo c√≥digo do cont√™iner e oculta no kernel; </li><li>  Ao gravar em um arquivo, o hash √© invalidado.  Assim, na pr√≥xima abertura, o arquivo do cont√™iner ser√° aberto diretamente, e n√£o seu cache. </li></ul><br>  Ao manter os arquivos compartilhados no cache da p√°gina em / vz / pfcache, estamos salvando esse cache e tamb√©m o IOPS.Em vez de ler dez arquivos do disco, lemos um que vai diretamente para o cache da p√°gina. <br><br><pre> <code class="plaintext hljs">struct inode { ... struct file *i_peer_file; ... }; struct address_space { ... struct list_head i_peer_list; ... }</code> </pre><br>  A lista VMA para o arquivo permanece a mesma (mem√≥ria com elimina√ß√£o de duplica√ß√£o) e √© lida com menos frequ√™ncia no disco (salve o IOP).  Nosso "fundo comum" est√° hospedado no SSD - um ganho adicional de velocidade. <br><br>  Exemplo para armazenar em cache o arquivo / bin / bash: <br><br><pre> <code class="plaintext hljs">[root@pcs13 ~]# ls -li /vz/root/2388/bin/bash 524650 -rwxr-xr-x 1 root root 1021112 Oct 7 2018 /vz/root/2388/bin/bash [root@pcs13 ~]# pfcache dump /vz/root/2388 | grep 524650 8e3aa19fdc42e87659746f6dc8ea3af74ab30362 i:524650 g:1357611108 f:CP [root@pcs13 ~]# sha1sum /vz/root/2388/bin/bash 8e3aa19fdc42e87659746f6dc8ea3af74ab30362 /vz/root/2388/bin/bash [root@pcs13 /]# getfattr -ntrusted.pfcache /vz/root/2388/bin/bash # file: vz/root/2388/bin/bash trusted.pfcache="8e3aa19fdc42e87659746f6dc8ea3af74ab30362" [root@pcs13 ~]# sha1sum /vz/pfcache/8e/3aa19fdc42e87659746f6dc8ea3af74ab30362 8e3aa19fdc42e87659746f6dc8ea3af74ab30362 /vz/pfcache/8e/3aa19fdc42e87659746f6dc8ea3af74ab30362</code> </pre><br>  Calculamos a efici√™ncia do uso com um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">script pronto</a> . <br><br>  Esse script passa por todos os cont√™ineres no n√≥, calculando os arquivos em cache de cada cont√™iner. <br><br><pre> <code class="plaintext hljs">[root@pcs16 ~]# /pcs/distr/pfcache-examine.pl ... Pfcache cache uses 831 MB of memory Total use of pfcached files in containers is 39837 MB of memory Pfcache effectiveness: 39006 MB</code> </pre><br>  Assim, economizamos cerca de 40 gigabytes de arquivos em cont√™ineres da mem√≥ria, eles ser√£o carregados do cache. <br><br>  Para que esse mecanismo funcione ainda melhor, √© necess√°rio colocar o VPS "id√™ntico" m√°ximo no n√≥.  Por exemplo, aqueles para os quais o usu√°rio n√£o tem acesso root e no qual o ambiente da imagem expandida est√° configurado. <br><br>  Voc√™ pode ajustar a opera√ß√£o do pfcache atrav√©s do arquivo de configura√ß√£o <br>  /etc/vz/pfcache.conf <br><br>  MINSIZE, MAXSIZE - tamanho m√≠nimo / m√°ximo do arquivo para armazenamento em cache <br>  TIMEOUT - tempo limite entre tentativas de cache <br><br>  Uma lista completa de par√¢metros pode ser encontrada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no link</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444696/">https://habr.com/ru/post/pt444696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444686/index.html">Waves Smart Assets: listas em preto e branco, negocia√ß√£o com intervalo</a></li>
<li><a href="../pt444688/index.html">Pare de falar sobre o modelo de reposit√≥rio com Eloquent</a></li>
<li><a href="../pt444690/index.html">Como os pesquisadores da Uber aplicam e escalam o conhecimento do comportamento humano</a></li>
<li><a href="../pt444692/index.html">MOSDROID # 16 Sulphur em Redmadrobot</a></li>
<li><a href="../pt444694/index.html">Como previmos a vaz√£o, abord√°-la como um desastre natural</a></li>
<li><a href="../pt444700/index.html">Bancos de dados aleat√≥rios. Oracle Enterprise Data Quality - Shield e Sword for Enterprise Storage</a></li>
<li><a href="../pt444704/index.html">Oportunidades nanoCAD SPDS Canteiro de obras em projetos de constru√ß√£o e reconstru√ß√£o em condi√ß√µes apertadas</a></li>
<li><a href="../pt444706/index.html">Fotos em 3D do Facebook dentro: Parallax Shaders</a></li>
<li><a href="../pt444708/index.html">Aplicativo PentQL com GraphQL</a></li>
<li><a href="../pt444710/index.html">Compreendendo o Protocolo de Consenso Estelar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>