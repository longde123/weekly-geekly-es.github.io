<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äç‚úàÔ∏è üìì üì† Almacenamiento de una gran cantidad de archivos. ü§ΩüèΩ üßì üë©üèø‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Buena salud, Hawkers! En el proceso de trabajar en un proyecto de sitio de citas, se hizo necesario organizar el almacenamiento de las fotos de los u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Almacenamiento de una gran cantidad de archivos.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423875/"><img src="https://habrastorage.org/webt/ti/up/px/tiuppxliueu75a1ycliw537yw-k.jpeg" alt="imagen"><br><br>  ¬°Buena salud, Hawkers!  En el proceso de trabajar en un proyecto de sitio de citas, se hizo necesario organizar el almacenamiento de las fotos de los usuarios.  Seg√∫n los t√©rminos de referencia, el n√∫mero de fotos por usuario est√° limitado a 10 archivos.  Pero puede haber decenas de miles de usuarios.  Especialmente considerando que el proyecto en su forma actual ya existe desde el comienzo del "cero".  Es decir, ya hay miles de usuarios en la base de datos.  Casi cualquier sistema de archivos, que yo sepa, reacciona muy negativamente a una gran cantidad de nodos secundarios en una carpeta.  Por experiencia, puedo decir que los problemas comienzan despu√©s de 1000-1500 archivos / carpetas en la carpeta principal. <br><a name="habracut"></a><br>  <i>Descargo de responsabilidad.</i>  <i>Busqu√© en Google antes de escribir el art√≠culo y encontr√© varias soluciones al problema en discusi√≥n (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ).</i>  <i>Pero no encontr√© una soluci√≥n √∫nica que coincida exactamente con la m√≠a.</i>  <i>Adem√°s, en este art√≠culo solo comparto mi propia experiencia para resolver el problema.</i> <br><br><h3>  Teor√≠a </h3><br>  Adem√°s de la tarea de almacenamiento como tal, tambi√©n hab√≠a una condici√≥n en la declaraci√≥n de trabajo, seg√∫n la cual era necesario dejar subt√≠tulos y subt√≠tulos para las fotos.  Por supuesto, no puedes prescindir de una base de datos.  Es decir, lo primero que hacemos es crear una tabla en la que prescribimos la asignaci√≥n de metadatos (firmas, t√≠tulos, etc.) con los archivos en el disco.  Cada archivo corresponde a una fila en la base de datos.  En consecuencia, cada archivo tiene un identificador. <br><br>  Una peque√±a digresi√≥n.  Hablemos de auto-incremento.  Un sitio de citas puede tener una docena o dos mil usuarios.  La pregunta es cu√°ntos usuarios generalmente pasan por el proyecto durante todo el tiempo de su existencia.  Por ejemplo, la audiencia activa de citas-ru es varios cientos de miles.  Sin embargo, solo imagine cu√°ntos usuarios quedaron durante la vida √∫til de este proyecto;  cu√°ntos usuarios no est√°n activados hasta ahora.  Y ahora agregue nuestra legislaci√≥n, que nos obliga a almacenar informaci√≥n sobre los usuarios durante al menos seis meses ... Tarde o temprano, 4 con un centavo de <b>INT NO FIRMADO</b> finalizar√°.  Por lo tanto, es mejor tomar <b>BIGINT</b> para la clave primaria. <br><br>  Ahora intentemos imaginar un n√∫mero de tipo <b>BIGINT</b> .  Esto es de 8 bytes.  Cada byte es de 0 a 255. 255 nodos secundarios son bastante normales para cualquier sistema de archivos.  Es decir, tomamos el identificador de archivo en representaci√≥n hexadecimal, lo dividimos en fragmentos de dos caracteres.  Usamos estos fragmentos como nombres de carpeta, este √∫ltimo como el nombre del archivo f√≠sico.  BENEFICIOS! <br><br> <code>0f/65/84/10/67/68/19/ff.file</code> <br> <br>  Elegante y simple  La extensi√≥n del archivo no es importante aqu√≠.  De todos modos, el archivo ser√° proporcionado por un script que le dar√° al navegador un tipo MIME particular, que tambi√©n almacenaremos en la base de datos.  Adem√°s, almacenar informaci√≥n sobre el archivo en la base de datos le permite redefinir la ruta para el navegador.  Digamos que el archivo que tenemos est√° ubicado en relaci√≥n con el directorio del proyecto a lo largo de la ruta <code>/content/files/0f/65/84/10/67/68/19/ff.file</code> .  Y en la base de datos puede escribirle una URL, por ejemplo, <code>/content/users/678/files/somefile</code> .  Los SEO probablemente sonr√≠en bastante en este momento.  Todo esto nos permite no preocuparnos m√°s sobre d√≥nde colocar el archivo f√≠sicamente. <br><br><h3>  Tabla en la base de datos </h3><br>  Adem√°s del identificador, tipo MIME, URL y ubicaci√≥n f√≠sica, almacenaremos archivos md5 y sha1 en la tabla para filtrar los mismos archivos si es necesario.  Por supuesto, tambi√©n necesitamos almacenar las relaciones entre entidades en esta tabla.  Suponga la ID de usuario a la que pertenecen los archivos.  Y si el proyecto no es muy grande, entonces en el mismo sistema podemos almacenar, por ejemplo, fotograf√≠as de productos.  Por lo tanto, tambi√©n almacenaremos el nombre de la clase de entidad a la que pertenece el registro. <br><br>  Hablando de p√°jaros.  Si cierra la carpeta usando .htaccess para acceso externo, el archivo solo se puede obtener a trav√©s del script.  Y en el script ser√° posible determinar el acceso al archivo.  Mirando hacia el futuro un poco, dir√© que en mi CMS (donde el proyecto mencionado se est√° cortando ahora) el acceso est√° determinado por grupos de usuarios b√°sicos, de los cuales tengo 8: invitados, usuarios, gerentes, administradores, inactivos, bloqueados, eliminados y s√∫per administradores.  Super-admin puede hacer absolutamente todo, por lo que no participa en la determinaci√≥n del acceso.  Si el usuario tiene un indicador de superadministrador, entonces es un superadministrador.  Todo es simple  Es decir, determinaremos el acceso a los siete grupos restantes.  El acceso es simple: dar el archivo o no dar.  En total, puede tomar un campo de tipo <b>TINYINT</b> . <br><br>  Y una cosa m√°s.  De acuerdo con nuestra ley, tendremos que almacenar f√≠sicamente im√°genes personalizadas.  Es decir, necesitamos marcar de alguna manera las im√°genes como eliminadas, en lugar de eliminarlas f√≠sicamente.  Es m√°s conveniente utilizar un campo de bits para estos fines.  En tales casos, generalmente uso un campo de tipo <b>INT</b> .  Para reservar, por as√≠ decirlo.  Adem√°s, tengo una tradici√≥n ya establecida de colocar la bandera <b>BORRADO</b> en el quinto bit desde el final.  Pero ya no importa otra vez. <br><br>  ¬øQu√© tenemos como resultado? <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">`files`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> auto_increment, <span class="hljs-comment"><span class="hljs-comment">--   `entity_type` char(32) not null default '', --   `entity` bigint null, -- ID  `mime` char(32) not null default '', -- MIME- `md5` char(32) not null default '', -- MD5 `sha1` char(40) not null default '', -- SHA1 `file` char(64) not null default '', --   `url` varchar(250) not null default '', -- URL `meta` text null, -- -   JSON    `size` bigint not null default '0', --  `created` datetime not null, --   `updated` datetime null, --   `access` tinyint not null default '0', --   `flags` int not null default '0', --  primary key (`id`), index (`entity_type`), index (`entity`), index (`mime`), index (`md5`), index (`sha1`), index (`url`) ) engine = InnoDB;</span></span></code> </pre> <br><h3>  Clase de despachador </h3><br>  Ahora necesitamos crear una clase con la cual cargaremos archivos.  La clase debe proporcionar la capacidad de crear archivos, reemplazar / modificar archivos, eliminar archivos.  Adem√°s, vale la pena considerar dos puntos.  En primer lugar, el proyecto se puede transferir de un servidor a otro.  Entonces, en la clase, debe definir una propiedad que contenga el directorio ra√≠z de los archivos.  En segundo lugar, ser√° muy desagradable si alguien golpea una tabla en la base de datos.  Por lo tanto, debe prever la posibilidad de recuperaci√≥n de datos.  Con el primero, todo est√° generalmente claro.  En cuanto a la copia de seguridad de datos, reservaremos solo lo que no se pueda restaurar. <br><br>  <b>ID</b> : restaurado desde la ubicaci√≥n f√≠sica del archivo <br>  <b>entidad_tipo</b> : no restaurado <br>  <b>entidad</b> - no restaurada <br>  <b>mime</b> - restaurado usando la extensi√≥n finfo <br>  <b>md5</b> : se restaura desde el archivo en s√≠ <br>  <b>sha1</b> : restaurado desde el archivo mismo <br>  <b>archivo</b> : restaurado desde la ubicaci√≥n f√≠sica del archivo <br>  <b>url</b> - no restaurado <br>  <b>meta</b> - no restaurado <br>  <b>tama√±o</b> : restaurado desde el archivo en s√≠ <br>  <b>creado</b> : puede tomar informaci√≥n de un archivo <br>  <b>actualizado</b> : puede tomar informaci√≥n de un archivo <br>  <b>acceso</b> - no restaurado <br>  <b>banderas</b> - no restauradas <br><br>  Puede descartar inmediatamente la metainformaci√≥n.  No es cr√≠tico para el funcionamiento del sistema.  Y para una recuperaci√≥n m√°s r√°pida, a√∫n necesita guardar el tipo MIME.  Total: tipo de entidad, ID de entidad, MIME, URL, acceso e indicadores.  Para aumentar la confiabilidad del sistema, almacenaremos la informaci√≥n de respaldo para cada carpeta de destino por separado en la carpeta misma. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de clase</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigFiles</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FLAG_DELETED = <span class="hljs-number"><span class="hljs-number">0x08000000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    "" /** @var mysqli $_db */ protected $_db = null; protected $_webRoot = ''; protected $_realRoot = ''; function __construct(mysqli $db = null) { $this-&gt;_db = $db; } /** * /   URL- * @param string $v  * @return string */ public function webRoot($v = null) { if (!is_null($v)) { $this-&gt;_webRoot = $v; } return $this-&gt;_webRoot; } /** * /    * @param string $v  * @return string */ public function realRoot($v = null) { if (!is_null($v)) { $this-&gt;_realRoot = $v; } return $this-&gt;_realRoot; } /** *   * @param array $data   * @param string $url URL   * @param string $eType   * @param int $eID ID  * @param mixed $meta - * @param int $access  * @param int $flags  * @param int $fileID ID   * @return bool * @throws Exception */ public function upload(array $data, $url, $eType = '', $eID = null, $meta = null, $access = 127, $flags = 0, $fileID = 0) { $meta = is_array($meta) ? serialize($meta) : $meta; if (empty($data['tmp_name']) || empty($data['name'])) { $fid = intval($fileID); if (empty($fid)) { return false; } $meta = empty($meta) ? 'null' : "'" . $this-&gt;_db-&gt;real_escape_string($meta) . "'"; $q = "`meta`={$meta},`updated`=now()"; $this-&gt;_db-&gt;query("UPDATE `files` SET {$q} WHERE (`id` = {$fid}) AND (`entity_type` = '{$eType}')"); return $fid; } // File data $meta = empty($meta) ? 'null' : "'" . $this-&gt;_db-&gt;real_escape_string($meta) . "'"; $finfo = finfo_open(FILEINFO_MIME_TYPE); $mime = finfo_file($finfo , $data['tmp_name']); finfo_close($finfo); // FID, file name if (empty($fileID)) { $eID = empty($eID) ? 'null' : intval($eID); $q = &lt;&lt;&lt;sql insert into `files` set `mime` = '{$mime}', `entity` = {$eID}, `entityType` = '{$eType}', `created` = now(), `access` = {$access}, `flags` = {$flags} sql; $this-&gt;_db-&gt;query($q); $fid = $this-&gt;_db-&gt;insert_id; list($ffs, $fhn) = self::fid($fid); $url = $this-&gt;_webRoot . $url . '/' . $fid; $fdir = $this-&gt;_realRoot . $ffs; self::validateDir($fdir); $index = self::getIndex($fdir); $index[$fhn] = array($fhn, $mime, $url, ($eID == 'null' ? 0 : $eID), $access, $flags); self::setIndex($fdir, $index); $fname = $ffs . '/' . $fhn . '.file'; } else { $fid = intval($fileID); $fname = $this-&gt;fileName($fid); } // Move file $fdir = $this-&gt;_realRoot . $fname; if (!move_uploaded_file($data['tmp_name'], $fdir)) { throw new Exception('Upload error'); } $q = '`md5`=\'' . md5_file($fdir) . '\',`sha1`=\'' . sha1_file($fdir) . '\',' . '`size`=' . filesize($fdir) . ',`meta`=' . $meta . ',' . (empty($fileID) ? "`url`='{$url}',`file`='{$fname}'" : '`updated`=now()'); $this-&gt;_db-&gt;query("UPDATE `files` SET {$q} WHERE (`id` = {$fid}) AND (`entity_type` = '{$eType}')"); return $fid; } /** *   * @param string $url URL * @param string $basicGroup    * @throws Exception */ public function read($url, $basicGroup = 'anonimous') { if (!ctype_alnum(str_replace(array('/', '.', '-', '_'), '', $url))) { header('HTTP/1.1 400 Bad Request'); exit; } $url = $this-&gt;_db-&gt;real_escape_string($url); $q = "SELECT * FROM `files` WHERE `url` = '{$url}' ORDER BY `created` ASC"; if ($result = $this-&gt;_db-&gt;query($q)) { $vars = array(); $ints = array('id', 'entity', 'size', 'access', 'flags'); while ($row = $result-&gt;fetch_assoc()) { foreach ($ints as $i) { $row[$i] = intval($row[$i]); } $fid = $row['id']; $vars[$fid] = $row; } if (empty($vars)) { header('HTTP/1.1 404 Not Found'); exit; } $deleted = false; $access = true; $found = ''; $mime = ''; foreach ($vars as $fdata) { $flags = intval($fdata['flags']); $deleted = ($flags &amp; self::FLAG_DELETED) != 0; $access = self::granted($basicGroup, $fdata['access']); if (!$access || $deleted) { continue; } $found = $fdata['file']; $mime = $fdata['mime']; } if (empty($found)) { if ($deleted) { header('HTTP/1.1 410 Gone'); exit; } elseif (!$access) { header('HTTP/1.1 403 Forbidden'); exit; } } else { header('Content-type: ' . $mime . '; charset=utf-8'); readfile($this-&gt;_realRoot . $found); exit; } } header('HTTP/1.1 404 Not Found'); exit; } /** *   ()   * @param mixed $fid () * @return bool * @throws Exception */ public function delete($fid) { $fid = is_array($fid) ? implode(',', $fid) : $fid; $q = "delete from `table` where `id` in ({$fid})"; $this-&gt;_db-&gt;query($q); $result = true; foreach ($fid as $fid_i) { list($ffs, $fhn) = self::fid($fid_i); $fdir = $this-&gt;_realRoot . $ffs; $index = self::getIndex($fdir); unset($index[$fhn]); self::setIndex($fdir, $index); $result &amp;= unlink($fdir . '/'. $fhn . '.file'); } return $result; } /** *  ()  "" * @param int $fid () * @param bool $value   * @return bool */ public function setDeleted($fid, $value=true) { $fid = is_array($fid) ? implode(',', $fid) : $fid; $o = $value ? ' | ' . self::FLAG_DELETED : ' &amp; ' . (~self::FLAG_DELETED); $this-&gt;_db-&gt;query("update `files` set `flags` = `flags` {$o} where `id` in ({$fid})"); return true; } /** *   * @param int $fid  * @return string * @throws Exception */ public function fileName($fid) { list($ffs, $fhn) = self::fid($fid); self::validateDir($this-&gt;_realRoot . $ffs); return $ffs . '/' . $fhn . '.file'; } /** *   . *           . * @param int $fid   * @return array */ public static function fid($fid) { $ffs = str_split(str_pad(dechex($fid), 16, '0', STR_PAD_LEFT), 2); $fhn = array_pop($ffs); $ffs = implode('/', $ffs); return array($ffs, $fhn); } /** *    * @param string $f     * @return bool * @throws Exception */ public static function validateDir($f) { if (!is_dir($f)) { if (!mkdir($f, 0700, true)) { throw new Exception('cannot make dir: ' . $f); } } return true; } /** *    * @param string $f       * @return array */ public static function getIndex($f) { $index = array(); if (file_exists($f . '/.index')) { $_ = file($f . '/.index'); foreach ($_ as $_i) { $row = trim($_i); $row = explode('|', $row); array_walk($row, 'trim'); $rid = $row[0]; $index[$rid] = $row; } } return $index; } /** *    * @param string $f       * @param array $index    * @return bool */ public static function setIndex($f, array $index) { $_ = array(); foreach ($index as $row) { $_[] = implode('|', $row); } return file_put_contents($f . '/.index', implode("\r\n", $_)); } /** *   * @param string $group   (. ) * @param int $value   * @return bool */ public static function granted($group, $value=0) { $groups = array('anonimous', 'user', 'manager', 'admin', 'inactive', 'blocked', 'deleted'); if ($group == 'root') { return true; } foreach ($groups as $groupID =&gt; $groupName) { if ($groupName == $group) { return (((1 &lt;&lt; $groupID) &amp; $value) != 0); } } return false; } }</span></span></code> </pre> <br></div></div><br>  Considere algunos puntos: <br><br>  - <b>realRoot</b> : la ruta completa a la carpeta con el sistema de archivos que termina en una barra inclinada. <br>  - <b>webRoot</b> : la ruta desde la ra√≠z del sitio sin una barra inclinada (ver a continuaci√≥n para saber por qu√©). <br>  - Como DBMS, uso la extensi√≥n <b>MySQLi</b> . <br>  - De hecho, la informaci√≥n de la matriz <b>$ _FILES</b> se pasa como el primer argumento para el m√©todo de <b>carga</b> . <br>  - Si llama al m√©todo de <b>actualizaci√≥n</b> para pasar la ID de un archivo existente, se reemplazar√° si la matriz de entrada en <b>tmp_name</b> no est√° vac√≠a. <br>  - Puede eliminar y cambiar las banderas de los archivos varias a la vez.  Para hacer esto, en lugar de pasar el identificador de archivo, debe pasar una matriz con identificadores o una cadena con ellos, separados por comas. <br><br><h3>  Enrutamiento </h3><br>  En realidad, se reduce a unas pocas l√≠neas en htaccess en la ra√≠z del sitio (se supone que mod_rewrite est√° habilitado): <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span></span></span> <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span> ^/content/(.*)$ RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_FILENAME}</span></span> !-f RewriteRule ^(.+)$ content/index.php?file=<span class="hljs-number"><span class="hljs-number">$1</span></span><span class="hljs-meta"><span class="hljs-meta"> [L,QSA]</span></span></code> </pre> <br>  "Contenido" es la carpeta en la ra√≠z del sitio en mi caso.  Por supuesto, puede nombrar la carpeta de manera diferente.  Y, por supuesto, index.php en s√≠, almacenado en mi caso en la carpeta de contenido: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $dbHost = <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>; $dbUser = <span class="hljs-string"><span class="hljs-string">'user'</span></span>; $dbPass = <span class="hljs-string"><span class="hljs-string">'****'</span></span>; $dbName = <span class="hljs-string"><span class="hljs-string">'database'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_REQUEST[<span class="hljs-string"><span class="hljs-string">'file'</span></span>])) { header(<span class="hljs-string"><span class="hljs-string">'HTTP/1.1 400 Bad Request'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } $userG = <span class="hljs-string"><span class="hljs-string">'anonimous'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      ;      $files = new BigFiles(new mysqli($dbHost,$dbUser,$dbPass,$dbName)); $files-&gt;realRoot(dirname(__FILE__).'/files/'); $files-&gt;read($_REQUEST['file'],$userG); } catch (Exception $e) { header('HTTP/1.1 500 Internal Error'); header('Content-Type: text/plain; charset=utf-8'); echo $e-&gt;getMessage(); exit; }</span></span></code> </pre><br>  Bueno, por s√≠ mismo, cerramos el sistema de archivos del acceso externo.  Coloque el archivo <code>.htaccess</code> en la ra√≠z de la carpeta de <code>content/files</code> con solo una l√≠nea: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Deny</span></span></span></span> from <span class="hljs-literal"><span class="hljs-literal">all</span></span></code> </pre> <br><h3>  Resumen </h3><br>  Esta soluci√≥n le permite evitar la p√©rdida del rendimiento del sistema de archivos debido a un aumento en la cantidad de archivos.  Al menos, definitivamente se pueden evitar los problemas en forma de miles de archivos en una carpeta.  Y al mismo tiempo, podemos organizar y controlar el acceso a los archivos en direcciones legibles por humanos.  Adem√°s del cumplimiento de nuestra legislaci√≥n sombr√≠a.  Haga una reserva de inmediato, esta soluci√≥n NO es una forma completa de proteger el contenido.  Recuerde: si algo se reproduce en el navegador, se puede descargar de forma gratuita. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423875/">https://habr.com/ru/post/es423875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423865/index.html">Roskomnadzor inform√≥ p√∫blicamente</a></li>
<li><a href="../es423867/index.html">Fundador del estudio de impresi√≥n 3D: sobre su trabajo</a></li>
<li><a href="../es423869/index.html">El futuro de los trabajos. Lo principal del informe del Foro Econ√≥mico Mundial</a></li>
<li><a href="../es423871/index.html">Resolvemos un problema l√≥gico para estudiantes en SQL</a></li>
<li><a href="../es423873/index.html">Descripci√≥n general de la impresora 3D PICASO 3D Designer X</a></li>
<li><a href="../es423877/index.html">29-31 de octubre: creaci√≥n de un cl√∫ster de Kubernetes listo para la producci√≥n</a></li>
<li><a href="../es423879/index.html">¬øEs f√°cil agregar nuevas funciones al marco anterior? Harina de elecci√≥n sobre el ejemplo del desarrollo de SObjectizer</a></li>
<li><a href="../es423881/index.html">¬øCu√°les fueron los soldadores para la √≥ptica (segunda parte)</a></li>
<li><a href="../es423885/index.html">Una invitaci√≥n a un espect√°culo de luces y un peque√±o conocedor de la futura plataforma Circle of Light en Mosc√∫</a></li>
<li><a href="../es423889/index.html">Mi decepci√≥n en el software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>