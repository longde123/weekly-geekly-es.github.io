<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úâÔ∏è üéã üó∫Ô∏è Novos cart√µes CUBA üë∏üèª üññ üë©üèΩ‚Äçü§ù‚Äçüë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Trabalhar com dados geoespaciais e mapas de mapeamento √© parte integrante de muitos aplicativos de neg√≥cios. Pode ser sistemas de informa√ß√µes regionai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Novos cart√µes CUBA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/464517/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2b4/8ca/a70/2b48caa7053d14a2edd9cfaecc6b6fb8.png" alt="mapas"></p><br><p>  Trabalhar com dados geoespaciais e mapas de mapeamento √© parte integrante de muitos aplicativos de neg√≥cios.  Pode ser sistemas de informa√ß√µes regionais e da cidade, aplicativos para a ind√∫stria de petr√≥leo e g√°s, sistemas de gerenciamento de infraestrutura de transporte, bem como servi√ßos de entrega e muitos outros.  Em nossa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plataforma CUBA,</a> para criar esses aplicativos, al√©m dos recursos b√°sicos fornecidos imediatamente, existe um conjunto bastante extenso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">complementos e componentes</a> .  Um deles √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cartas e Mapas</a> , que, al√©m de exibir gr√°ficos, permite integrar o Google Maps na parte visual do aplicativo.  No ano passado, o Google atualizou os termos de uso de seus servi√ßos de mapas, o que levou a um aumento no custo, e tamb√©m introduziu a condi√ß√£o para a presen√ßa obrigat√≥ria de um perfil de pagamento para o uso da API.  Essas circunst√¢ncias levaram a maioria de nossos clientes a pensar em fornecedores alternativos de cart√µes, e fomos solicitados a desenvolver um novo componente de cart√£o. </p><a name="habracut"></a><br><p>  Agora temos o prazer de apresentar um componente completamente novo - o <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CUBA Maps</a></strong> .  O CUBA Maps complementa a funcionalidade do aplicativo com uma representa√ß√£o visual e ferramentas intuitivas para editar dados geoespaciais.  O componente trabalha com dados rasterizados e vetoriais.  Voc√™ pode usar qualquer provedor de mapas compat√≠vel com o protocolo Web Map Service ou fornecer blocos no formato XYZ como dados rasterizados.  Para trabalhar com dados vetoriais, o componente usa tipos de dados geom√©tricos (ponto, polilinha, pol√≠gono) da biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JTS Topology Suite (JTS)</a> - a biblioteca Java mais popular para trabalhar com dados geoespaciais.  O componente fornece todas as ferramentas necess√°rias para criar um sistema abrangente de informa√ß√µes geogr√°ficas baseado no CUBA. </p><br><p>  Neste artigo, falaremos sobre os novos recursos oferecidos pelo componente Mapas e tamb√©m o compararemos com o nosso componente de mapa anterior. </p><br><h2 id="struktura-osnovannaya-na-sloyah">  Estrutura baseada em camadas </h2><br><p>  O componente suporta a estrutura multicamada tradicional que √© amplamente usada em sistemas de informa√ß√µes geogr√°ficas profissionais.  As camadas s√£o divididas principalmente em raster e vetor.  <em>As camadas rasterizadas</em> consistem em imagens rasterizadas, enquanto as <em>camadas</em> vetoriais cont√™m geometrias vetoriais. </p><br><p>  O componente suporta os seguintes tipos de camadas: </p><br><ul><li>  <em>A camada de</em> bloco exibe os blocos fornecidos pelos servi√ßos de bloco no formato XYZ. </li><li>  <em>A camada Servi√ßo de Mapa da Web (WMS)</em> exibe as imagens fornecidas pelos servi√ßos WMS. </li><li>  <em>A camada vetorial</em> cont√©m objetos geogr√°ficos (entidades com atributos geom√©tricos). </li></ul><br><p>  Essas camadas s√£o elementos estruturais dos mapas.  Por exemplo, a camada inferior pode ser um mapa base constitu√≠do por ladrilhos, a segunda camada pode conter pol√≠gonos que descrevem unidades territoriais, por exemplo, regi√µes e a camada superior pode conter pontos geogr√°ficos (localiza√ß√£o de clientes, lojas, etc.).  Sobrepondo essas camadas umas sobre as outras, obtemos o mapa final: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b16/3b2/5f7/b163b25f702af4f76363340b899139b4.png" alt="camadas"></p><br><p>  Gra√ßas a essa abordagem, voc√™ pode criar mapas claramente estruturados com qualquer conte√∫do. </p><br><p> O CUBA Maps fornece um novo componente visual - <code>GeoMap</code> .  No descritor XML do componente, voc√™ pode definir os par√¢metros b√°sicos do mapa, bem como um conjunto de camadas exibidas.  Um exemplo dessa configura√ß√£o: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tileProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maps_OpenStreetMap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Essa abordagem permite obter mais flexibilidade que faltava em <strong>gr√°ficos e mapas</strong> : </p><br><ul><li>  <em>Camadas.</em>  Essa estrutura permite criar cart√µes com qualquer conte√∫do, por exemplo, combinar blocos fornecidos por v√°rios servi√ßos. </li><li>  <em>As camadas fornecem uma abstra√ß√£o que re√∫ne objetos homog√™neos.</em>  No componente <strong>Gr√°ficos e mapas</strong> , todo o conte√∫do do mapa (por exemplo, pontos, pol√≠gonos etc.) foi despejado em uma pilha comum no componente da interface do usu√°rio.  Para estruturar de alguma forma esses objetos, as equipes do projeto tiveram que escrever uma l√≥gica adicional. </li><li>  <em>Um m√©todo declarativo para descrever camadas.</em>  Como mostrado no exemplo acima, voc√™ pode especificar completamente a estrutura do mapa (conjunto de camadas) no descritor XML.  Em muitos casos, isso √© suficiente para n√£o implementar nenhuma l√≥gica adicional no controlador de tela.  Usando <strong>gr√°ficos e mapas</strong> , era quase imposs√≠vel fazer sem escrever l√≥gica adicional. </li></ul><br><p>  O uso de camadas de bloco ou WMS permite trabalhar com qualquer provedor de mapas preferido.  Voc√™ n√£o est√° vinculado a um provedor espec√≠fico, como era em <strong>gr√°ficos e mapas</strong> . </p><br><p>  As camadas vetoriais simplificam bastante a exibi√ß√£o, a edi√ß√£o interativa e o desenho de objetos geogr√°ficos no mapa. </p><br><p>  Tamb√©m √© importante notar que o componente visual do <code>GeoMap</code> por padr√£o, possui uma camada auxiliar especial - <strong>Canvas</strong> .  O Canvas fornece uma API conveniente para exibir e desenhar geometrias (pontos, polilinhas, pol√≠gonos) em um mapa.  Abordaremos exemplos de uso do Canvas mais adiante neste artigo. </p><br><h2 id="geo-obekty">  Objetos geogr√°ficos </h2><br><p>  Suponha que tenhamos uma entidade que contenha um atributo associado √† geometria (ponto, polilinha, pol√≠gono).  Vamos chamar essa entidade de <em>geo-objeto</em> .  Portanto, o componente simplifica bastante o trabalho com objetos geogr√°ficos. </p><br><p>  Por exemplo, considere o objeto geogr√°fico <strong>Endere√ßo</strong> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LOCATION"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter = CubaPointWKTConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Point location; ... }</code> </pre> <br><p>  Ele possui um atributo de <code>location</code> do tipo <code>org.locationtech.jts.geom.Point</code> da <code>org.locationtech.jts.geom.Point</code> JTS Topology Suite (JTS).  O componente suporta os seguintes tipos geom√©tricos do JTS: </p><br><ul><li>  <code>org.locationtech.jts.geom.Point</code> - per√≠odo. </li><li>  <code>org.locationtech.jts.geom.LineString</code> - polilinha. </li><li>  <code>org.locationtech.jts.geom.Polygon</code> - polygon. </li></ul><br><p>  O atributo <code>location</code> √© marcado com a anota√ß√£o <code>@Geometry</code> .  Esta anota√ß√£o anuncia que o valor desse atributo deve ser usado ao exibir um objeto geogr√°fico no mapa.  O atributo tamb√©m √© marcado com as seguintes anota√ß√µes: </p><br><ul><li>  <code>@MetaProperty</code> - nesse caso, usado para indicar o atributo do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipo de dados</a> .  A interface <code>Datatype</code> usada pela estrutura CUBA para converter valores para e de uma sequ√™ncia. </li><li>  <code>@Convert</code> - Define um conversor JPA para um atributo persistente.  O conversor JPA converte valores de atributo entre suas representa√ß√µes no banco de dados e no c√≥digo Java.  O componente fornece um conjunto de tipos de dados espaciais e conversores JPA.  Mais informa√ß√µes est√£o dispon√≠veis na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> do componente.  Voc√™ tamb√©m pode usar sua pr√≥pria implementa√ß√£o do conversor JPA, o que possibilita trabalhar com v√°rias fontes de dados espaciais (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostGIS</a> ). </li></ul><br><p>  Portanto, para transformar uma entidade em um geo-objeto, voc√™ precisa definir um atributo do tipo de geometria JTS e anot√°-lo com <code>@Geometry</code> .  H√° outra op√ß√£o - crie um atributo n√£o persistente, fornecendo m√©todos getter / setter.  Isso pode ser √∫til se voc√™ n√£o desejar fazer altera√ß√µes no modelo de dados e gerar novamente scripts DDL. </p><br><p>  Por exemplo, considere a entidade <strong>Endere√ßo</strong> com atributos separados para latitude e longitude: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.addon.maps.gis.utils.GeometryUtils; ... <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LATITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double latitude; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LONGITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double longitude; ... <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>, related = {<span class="hljs-string"><span class="hljs-string">"latitude"</span></span>, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getLatitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getLongitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeometryUtils.createPoint(getLongitude(), getLatitude()); } <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Point point)</span></span></span><span class="hljs-function"> </span></span>{ Point prevValue = getLocation(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { setLatitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); setLongitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setLatitude(point.getY()); setLongitude(point.getX()); } propertyChanged(<span class="hljs-string"><span class="hljs-string">"location"</span></span>, prevValue, point); } ... }</code> </pre> <br><p>  Se voc√™ decidir usar essa abordagem, verifique se o m√©todo <code>propertyChanged</code> √© chamado no setter, pois o componente responde a esse evento atualizando a geometria no mapa. </p><br><p>  Agora que preparamos a classe do nosso objeto geogr√°fico, podemos adicionar inst√¢ncias dessa classe √† camada vetorial.  <em>Uma camada vetorial</em> √© essencialmente um elemento de conex√£o entre dados (objetos geogr√°ficos) e um mapa.  Para conectar objetos geogr√°ficos a uma camada, √© necess√°rio transferir o cont√™iner de dados ou, no caso de telas obsoletas (at√© a vers√£o 7 do CUBA), a fonte de dados para a camada vetorial.  Isso pode ser feito em um descritor XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Como resultado, as inst√¢ncias da classe <code>Address</code> contidas no cont√™iner AddressDc ser√£o exibidas no mapa. </p><br><p>  Vamos considerar uma tarefa elementar: criar uma tela para editar um objeto geogr√°fico com um mapa, onde voc√™ pode editar a geometria do objeto.  Para resolver o problema, voc√™ precisa declarar o componente visual do <code>GeoMap</code> no descritor XML da tela de edi√ß√£o e adicionar uma camada vetorial associada ao cont√™iner que cont√©m o objeto geogr√°fico editado: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Se voc√™ marcar a camada vetorial como edit√°vel, a edi√ß√£o interativa do objeto geogr√°fico no mapa ser√° ativada.  Se a geometria do objeto estiver vazia, o mapa mudar√° automaticamente para o modo de desenho.  Como voc√™ pode ver, para resolver o problema, basta declarar uma camada vetorial no mapa e pass√°-la para o cont√™iner de dados / fonte de dados. </p><br><p>  Isso √© tudo.  Se usamos <strong>Gr√°ficos e Mapas</strong> para resolver o mesmo problema, ter√≠amos que escrever bastante c√≥digo no controlador de tela para fornecer funcionalidade semelhante.  Com o novo componente do <strong>Maps,</strong> resolver esses problemas √© muito mais simples. </p><br><h2 id="canvas">  Tela </h2><br><p>  H√° momentos em que voc√™ precisa trabalhar e n√£o com entidades.  Em vez disso, voc√™ deseja que uma API simples adicione e desenhe geometrias em um mapa, como era em <strong>gr√°ficos e mapas</strong> .  Para isso, o componente visual do <code>GeoMap</code> possui uma camada especial - <em>Canvas</em> .  Essa √© uma camada auxiliar, que est√° no mapa por padr√£o e fornece uma API simples para adicionar e desenhar geometrias no mapa.  Voc√™ pode <code>map.getCanvas()</code> mapa de <code>map.getCanvas()</code> chamando o m√©todo <code>map.getCanvas()</code> . </p><br><p>  A seguir, veremos algumas tarefas simples, como elas foram resolvidas em <strong>gr√°ficos e mapas</strong> e como fazer o mesmo usando o Canvas. </p><br><h3 id="otobrazhenie-geometriy-na-karte">  Exibir geometrias em um mapa </h3><br><p>  Em <strong>Cartas e Mapas, os</strong> objetos de geometria foram criados usando o componente visual do mapa, usado como f√°brica e, em seguida, adicionados ao mapa: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); map.addMarker(marker);</code> </pre> <br><p>  O novo componente do Google <strong>Maps</strong> trabalha diretamente com as classes da biblioteca JTS: </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); Point point = address.getLocation(); canvasLayer.addPoint(point);</code> </pre> <br><h3 id="redaktirovanie-geometriy">  Edi√ß√£o de geometria </h3><br><p>  Em <strong>gr√°ficos e mapas,</strong> voc√™ pode designar a geometria como edit√°vel.  Quando essas geometrias foram alteradas atrav√©s da interface do usu√°rio, os eventos correspondentes foram chamados: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); marker.setDraggable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); map.addMarker(marker); map.addMarkerDragListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br><p>  No componente <strong>Mapas</strong> , ao adicionar a geometria JTS ao Canvas, o m√©todo correspondente retorna um objeto especial que √© uma representa√ß√£o dessa geometria no mapa: <code>CanvasLayer.Point</code> , <code>CanvasLayer.Polyline</code> ou <code>CanvasLayer.Polygon</code> .  Este objeto possui uma interface fluente para definir v√°rios par√¢metros de geometria, tamb√©m pode ser usado para assinar eventos relacionados √† geometria ou para excluir a geometria de um Canvas. </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); CanvasLayer.Point location = canvasLayer.addPoint(address.getLocation()); location.setEditable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setPopupContent(address.getName()) .addModifiedListener(modifiedEvent -&gt; address.setLocation(modifiedEvent.getGeometry()));</code> </pre> <br><h3 id="risovanie-geometriy">  Desenho de geometria </h3><br><p>  Nos antigos <strong>gr√°ficos e mapas</strong> complementares, havia um componente auxiliar - <code>DrawingOptions</code> .  Foi usado para ativar a capacidade de desenhar no mapa.  Depois que a geometria foi desenhada, o evento correspondente foi gerado: </p><br><pre> <code class="java hljs">DrawingOptions options = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawingOptions(); PolygonOptions polygonOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PolygonOptions(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"#993366"</span></span>, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); ControlOptions controlOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ControlOptions( Position.TOP_CENTER, Arrays.asList(OverlayType.POLYGON)); options.setEnableDrawingControl(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); options.setPolygonOptions(polygonOptions); options.setDrawingControlOptions(controlOptions); options.setInitialDrawingMode(OverlayType.POLYGON); map.setDrawingOptions(options); map.addPolygonCompleteListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">//do something });</span></span></code> </pre> <br><p>  O componente Mapas torna o mesmo muito mais f√°cil.  O novo <strong>Maps</strong> Canvas cont√©m um conjunto de m√©todos para desenhar geometrias.  Por exemplo, para desenhar um pol√≠gono, use o m√©todo <code>canvas.drawPolygon()</code> .  Depois de chamar esse m√©todo, o mapa mudar√° para o modo de desenho de pol√≠gono.  O m√©todo aceita a fun√ß√£o <code>Consumer&lt;CanvasLayer.Polygon&gt;</code> , na qual voc√™ pode executar a√ß√µes adicionais com o pol√≠gono desenhado. </p><br><pre> <code class="java hljs">canvasLayer.drawPolygon(polygon -&gt; { territory.setPolygon(polygon.getGeometry()); });</code> </pre> <br><h2 id="instrumenty-dlya-geo-analiza">  Ferramentas de an√°lise geogr√°fica </h2><br><h3 id="klasterizaciya">  Agrupamento </h3><br><p>  Outra ferramenta √∫til presente no novo componente Maps √© o agrupamento de pontos.  Se a camada consistir em um grande n√∫mero de pontos, voc√™ poder√° ativar o agrupamento para agrupar pontos pr√≥ximos em clusters, para que o mapa pare√ßa mais limpo e com melhor percep√ß√£o: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6c/166/4d7/e6c1664d7e9092880dfcf13cc4dca58c.jpg" alt="agrupar"></p><br><p>  O cluster √© ativado adicionando a marca de <code>cluster</code> dentro da marca de <code>vector</code> no descritor XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locations"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locationsDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Voc√™ tamb√©m pode habilitar o cluster com base em pesos de pontos.  O peso do ponto √© o valor do atributo especificado no par√¢metro <code>weightProperty</code> . </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orders"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ordersDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weightProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="teplovye-karty">  Heatmaps </h3><br><p>  Os mapas de calor s√£o uma representa√ß√£o visual da densidade de dados em v√°rios locais geogr√°ficos.  O componente visual do GeoMap cont√©m um m√©todo para adicionar um mapa de calor: <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/722/10b/289/72210b289dd04fcf41cc4ebec062c2d5.jpg" alt="mapa de calor"></p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  O processamento, an√°lise e visualiza√ß√£o de dados geoespaciais √© um elemento essencial de muitos aplicativos de neg√≥cios.  O componente <strong>CUBA Maps</strong> fornecer√° ao seu aplicativo CUBA todas as ferramentas necess√°rias para implementar essa funcionalidade. </p><br><p>  Uma estrutura baseada em camadas ajuda na constru√ß√£o de mapas com qualquer conte√∫do.  Com camadas lado a lado / WMS, voc√™ pode usar qualquer provedor necess√°rio como placa base.  As camadas vetoriais permitem trabalhar efetivamente com conjuntos de objetos geogr√°ficos homog√™neos.  O Canvas fornece uma API simples para exibir e desenhar geometrias em um mapa. </p><br><p>  O componente trabalha com tipos espaciais da biblioteca JTS, o que o torna compat√≠vel com muitas outras estruturas (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GeoTools</a> ) para resolver uma ampla variedade de tarefas relacionadas ao processamento e an√°lise de dados geogr√°ficos. </p><br><p>  Esperamos que voc√™ goste do componente.  Aguardando seu feedback! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464517/">https://habr.com/ru/post/pt464517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464503/index.html">Correspond√™ncia de senha Wi-Fi com aircrack-ng</a></li>
<li><a href="../pt464509/index.html">O livro "Grok deep learning"</a></li>
<li><a href="../pt464511/index.html">Como coletar coortes de usu√°rios na forma de gr√°ficos no Grafana [+ imagem do docker com um exemplo]</a></li>
<li><a href="../pt464513/index.html">Duffle: Transformador de XD Design</a></li>
<li><a href="../pt464515/index.html">Como criar e-mails e n√£o bagun√ßar: dicas pr√°ticas</a></li>
<li><a href="../pt464523/index.html">Sistemas de Pagamento (PSP) para empresas de TI: jogamos muito</a></li>
<li><a href="../pt464525/index.html">Seu pr√≥prio conversor JSON ou um pouco mais sobre o ExpressionTrees</a></li>
<li><a href="../pt464529/index.html">Agora, a publicidade contextual com os nomes dos concorrentes pode ser multada em 500.000 rublos</a></li>
<li><a href="../pt464535/index.html">Detalhes sobre o dispositivo e as fun√ß√µes da scooter el√©trica KickScooter T60</a></li>
<li><a href="../pt464537/index.html">Carrossel Demon√≠aco DIY do Arduino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>