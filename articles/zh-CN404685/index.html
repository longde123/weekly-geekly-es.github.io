<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💇🏼 🚶 🕺🏻 ESP32和Arduino 🆔 🍈 😦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="发生的事情是每个人都在等待了这么长时间，以及他们谈论了这么多-新的ESP32模块开始被广泛销售并推向了人们。 今天，我们将从一个不习惯使用Arduino并创建用于家庭自动化或只是为了娱乐和自学的小项目的非专业用户的角度讨论这些模块。 

 真的有用吗？ Arduino IDE中这些模块的支持是什么？...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESP32和Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/404685/"><img src="https://habrastorage.org/web/154/76f/448/15476f44869044d9a4b37e7c8a520ef2.jpg" alt="图片"><br><br> 发生的事情是每个人都在等待了这么长时间，以及他们谈论了这么多-新的ESP32模块开始被广泛销售并推向了人们。 今天，我们将从一个不习惯使用Arduino并创建用于家庭自动化或只是为了娱乐和自学的小项目的非专业用户的角度讨论这些模块。 <br><br> 真的有用吗？  Arduino IDE中这些模块的支持是什么？ 付出更多是值得的，还是让自己局限于已经熟悉的ESP8266更好？ 我们将尝试一起回答所有这些问题，在本文的结尾，我将提供指向ESP32与Arduino的真正体现的链接-用于ESP32平台的免费版<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Arduino Mega Server</a>的发行版。 <br><a name="habracut"></a><br><h2> 技术指标 </h2><br> 我不会在这里详细介绍ESP32的规格，您可以在Internet上轻松找到它们：每个审阅者都认为在ESP32审阅开始时带一份规格表是他的责任。 我只能说它们给人留下了深刻的印象，如果您认真认真地处理此问题，则可以花费一年多的时间研究该模块的所有功能并进行试验。 <br><br> 让我们将这些问题留给专业人员（或认为自己是这样的专业人员），并专注于问题的实际方面，这是凡人都能理解和理解的。 <br><br><h2> 发行价 </h2><br> 让我们从价格开始。 目前，中文在线商店中的ESP32模块的价格为350卢布，带线束和USB接口的电路板版本为500卢布。 对于ESP8266模块，这分别是100卢布和160卢布。 如您所见，尽管绝对值很小，但相差超过三倍，如果需要，每个绝对值都可以在微控制器上花费350-500卢布。 相比之下，在同一中国的Arduino Mega 2560售价为600卢布，而在俄罗斯约为1000卢布（加上以太网屏蔽的成本）。 <br><br> 剩下的只是找出是否值得付出比ESP8266高三倍的价格，以及我们将为此付出多少。  （展望未来，我认为这绝对是值得的。） <br><br><h2>  Arduino IDE中的支持 </h2><br> 为了对模块进行操作，您必须首先在Arduino IDE中获得其支持。 目前，在Arduino IDE中对ESP32的支持尚处于初始阶段，但相当不错且可行。 那些害怕在这里遇到无法克服的困难的人不必担心-主要功能运行良好，与其他控制器上的工作相比，您很可能不会注意到任何区别。 <br><br> 使用设备驱动程序，情况会稍差一些，但这当然是暂时的现象。 该模块是如此流行，以至于不可避免地会在不久的将来出现对任何外围设备的支持。 <br><br><h2> 将ESP32支持添加到Arduino IDE </h2><br> 现在，有关在Arduino IDE中安装ESP32支持的一些实用信息。 互联网上充斥着有关此主题的说明，您也可以在其中找到大量的说明。 我只注意到所有指令都分为“旧”和“新”，其中“旧”提到了Python，“新”提到了GIT。 自然，您需要以新手为指导。 <br><br> 在许多说明中，最好的（可以是足够的）称为模块制造商的官方说明。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/espressif/arduino-esp32</a> <br><br> 我建议使用。 唯一需要注意的是：GIT是可选的，您只需下载分发包并将其解压缩到所需目录即可。 <br><br>  <em><strong>注意事项</strong></em>  <em>以下所有内容都适用于在Windows 7 64位下安装，因为我在上面进行了所有实验，因此在其他操作系统中，路径可能与所示的路径不同。</em> <br><br> 分发文件必须位于文件夹中 <br><br><pre><code class="java hljs">C:\Users\User\Documents\Arduino\hardware\espressif\esp32</code> </pre> <br> 其中C：是Windows驱动器的名称，而User是操作系统中用户的名称（两者可能与指定的名称不同）。 <br><br><h2>  ESP32的明显安装点 </h2><br> 许多用户抱怨对他们没有任何帮助，并且没有显示Arduino IDE中的ESP32支持。 事情是这样的：由于仅开发ESP32驱动程序，因此系统目录位置的顺序已稍有更改。 必须指定Arduino IDE设置中草图位置的文件夹 <br><br><pre> <code class="java hljs">C:\Users\User\Documents\Arduino</code> </pre><br>  （对驱动器和用户名进行相同的修改），并且分发文件应位于制造商建议的此文件夹内。 如果不考虑这一点，那么将不会出现在Arduino IDE中对ESP32的支持，并且没有任何效果。 <br><br><h2>  Arduino IDE版本 </h2><br> 您经常会听到ESP32支持仅在最新版本的Arduino IDE中可用，并非如此-ESP32在较早版本中运行良好，例如，ESP32的Arduino Mega Server发行版是在1.6.5 r2版本中开发的。 <br><br><h2>  ESP32的好处 </h2><br> 现在，我们来讨论一下ESP32较其前身ESP8266的优势。 我不会再谈处理器能力和RAM等显而易见的事情，我只能说，您需要努力将ESP32完全加载到DIY和家庭自动化任务上。 <br><br><h2> 别针 </h2><br> 他的前任ESP8266模块的致命弱点是（过去是）非常少的结论。 在使用诸如Arduino Mega和Arduino Due之类的控制器及其数十个数字和模拟引脚工作之后，ESP8266的使用令人困惑：GPIO的数量实际上是一个，这极大地限制了该模块在实际项目中的使用。 <br><br><img src="https://habrastorage.org/web/664/5a7/84b/6645a784b86a47548bbef479bc5804c4.png" alt="图片"><br><br>  ESP32，即使不是完全没有，也没有这个缺点。 可用引脚的数量已大大增加，并且还出现了许多模拟输入。  13个结论可以称为完全免费并且可以使用。 <br><br><pre> <code class="java hljs">GPIO <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span></code> </pre><br> 如有必要，可以添加功能受限且只能在输入下使用的功能 <br><br><pre> <code class="java hljs">GPIO <span class="hljs-number"><span class="hljs-number">34</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-number"><span class="hljs-number">39</span></span></code> </pre><br> 如果您牺牲了某些功能并且在特定项目中不使用串行，SPI或I2C，则可以在此数字上再添加8个引脚 <br><br><pre> <code class="java hljs">GPIO <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span></code> </pre><br> 好吧，可以使用另外6个用于内部闪存的引脚（例如，如果连接外部SD卡） <br><br><pre> <code class="java hljs">GPIO <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span></code> </pre><br> 如您所见，没有与ESP8266的比较-新模块在可能的连接数量上看起来不错，并且在每个引脚都很昂贵的实际项目中非常有价值。 <br><br><h2> 工作速度 </h2><br> 我已经提到过一个功能强大的处理器，现在需要说几句有关网络运行速度的信息。 我发现很难说这与什么相关，可能与功能强大的处理器，也许与网络堆栈的优化有关，但是在Arduino Mega Server控制下的ESP32模块显示出创纪录的网络性能。 <br><br><img src="https://habrastorage.org/web/c0d/7de/642/c0d7de64247846fc9f47160a02ef0d0f.png" alt="图片"><br><br> 用大量的CSS和JavaScript代码以及大量的图形加载页面仅需一秒钟-比任何其他经过测试的控制器（包括具有W5100和W5500以太网接口的有线控制器）都快。 <br><br> 关于Arduino Mega Server，这消除了图形和任何JavaScript库在大小和数量上的所有使用限制。 <br><br><h2> 其他优点 </h2><br>  ESP32是一款非常高科技的设备，仅列出可用功能的清单可能会占用一页以上的内容，而列出优点和功能并附带注释将占用整本书的全部内容。 因此，我将仅限于此，以免使文章混乱，并提供一些在Arduino环境中使用ESP32代码的示例。 <br><br><h2> 程式码范例 </h2><br><h3> 非易失性存储器 </h3><br> 这就是我们所说的Arduino Mega的EEPROM。  ESP32本身没有这种内存，但是此模块具有其类似物和相应的库供其使用。 该存储器称为“ NVS”（非易失性存储）。 <br><br> 但是对我们来说没有什么区别-您可以以相同的方式保存值，然后在关闭然后再打开控制器后读取它们。 <br><br> 用法示例。 我们连接库： <br><br><pre> <code class="java hljs">#include &lt;Preferences.h&gt;</code> </pre><br> 创建一个prefs对象 <br><br><pre> <code class="java hljs">Preferences prefs;</code> </pre><br> 我们使用标识符（例如“ nvs”）初始化存储库： <br><br><pre> <code class="java hljs">prefs.begin(<span class="hljs-string"><span class="hljs-string">"nvs"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);</code> </pre><br>  false表示选择读/写模式，在这种情况下，是读和写。 我们将字节保存为“ addr”名称： <br><br><pre> <code class="java hljs">prefs.putUChar(<span class="hljs-string"><span class="hljs-string">"addr"</span></span>, <span class="hljs-number"><span class="hljs-number">65</span></span>);</code> </pre><br> 我们读取保存的字节： <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = prefs.getUChar(<span class="hljs-string"><span class="hljs-string">"addr"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br> 以相同的方式，您可以保存和读取任何其他数据类型的值。 现在删除存储。 <br><br><pre> <code class="java hljs">prefs.remove(<span class="hljs-string"><span class="hljs-string">"nvs"</span></span>);</code> </pre><br> 如果您看的话，它甚至比在Arduino控制器上使用标准的非易失性EEPROM存储器还要容易。 <br><br><h3>  AnalogWrite（） </h3><br> 另一个会使新手困惑的创新是ESP32中缺少熟悉的AnalogWrite（）函数。 刚开始时，这是非常不寻常的，但实际上，此功能只是被功能更强大的功能所代替。 <br><br> 考虑一个例子。 让我们从连接相应的库开始，尽管从字面意义上不能将其称为库，而是一个专门的文件，其中描述了必要的功能。 事实是，并非所有功能都直接存在于Arduino IDE中，某些功能在目录中的文件中可用 <br><br><pre> <code class="java hljs">...\Documents\Arduino\hardware\espressif\esp32\cores\esp32</code> </pre><br> 在这种情况下，我们对使用PWM和LED的文件感兴趣，我们将其与以下指令连接： <br><br><pre> <code class="java hljs">#include <span class="hljs-string"><span class="hljs-string">"esp32-hal-ledc.h"</span></span></code> </pre><br> 接下来，我们需要设置通道号（0），PWM频率（例如50 Hz）和分辨率（8位）。 <br><br><pre> <code class="java hljs">ledcSetup(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>);</code> </pre><br> 通道号的设置范围为0到15，分辨率为1到16位。 如果选择8位分辨率，则控制PWM的数据范围将在0到255之间。 <br><br> 接下来，我们需要将通道（0）绑定到某个GPIO引脚，在这种情况下为引脚22： <br><br><pre> <code class="java hljs">ledcAttachPin(<span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br> 而且，您一定不要忘记以通常的方式将22nd引脚配置为输出。 <br><br><pre> <code class="java hljs">pinMode(<span class="hljs-number"><span class="hljs-number">22</span></span>, OUTPUT);</code> </pre><br> 就是这样，现在我们可以控制例如LED的亮度，仅指示通道号和从0到255范围内的PWM（亮度）值。 <br><br><pre> <code class="java hljs">ledcWrite(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>);</code> </pre><br><h3> 其他ESP32代码示例 </h3><br>  Arduino Mega Server发行版是本文末尾的链接，除了功能齐全的系统外，它是广泛的结构化代码集合，这些代码经过测试和验证可在ESP32模块上使用。 您可以将其用作教程来进入ESP32下的编程主题。 <br><br><h2> 工作稳定 </h2><br> 用于ESP8266的Arduino Mega Server已经确认了几个月的正常运行时间，并且演示了绝对稳定的操作，我没有理由认为ESP32模块可能存在任何稳定性问题。 至少在为ESP32创建AMS发行版的整个过程中，我都没有观察到模块的单一故障或未经授权的重启。 一切工作都非常清楚和可预测。 <br><br><h2> 适用于ESP32的Arduino Mega Server </h2><br> 这是AMS生态系统的另一个代表，其中包括控制器和开发板Arduino Mega，Due，101，M0，AMS Home，ESP8266，Sonoff，ESP32，OLIMEX ESP32-EVB等。由于ESP32模块具有强大的处理器和快速的网络操作， Arduino Mega Server界面包含大量图形和脚本，这根本不影响其速度-页面几乎立即加载。 <br><br><img src="https://habrastorage.org/web/d5c/429/e3a/d5c429e3a76b47ddb558b80b130674ef.jpg" alt="图片"><br><br> 一切都稳定且可预测地工作，未检测到系统或模块的故障或行为不足。 以下是AMS下载日志，您可以从中找到有关系统的一些详细信息。 <br><br><img src="https://habrastorage.org/web/4cd/a29/cec/4cda29cecb184f5684493bff8c9f3bc2.png" alt="图片"><br><br> 模块的温度由内置温度传感器测量，范围从启动时的摄氏50度到运行期间的55度。 在运行期间，模块的电流消耗约为130 mA。 <br><br><h2> 前景展望 </h2><br> 您无需成为专门专家即可预测，像雨后的蘑菇一样，各种格式，功能多样的ESP32板上的板将开始出现。 这是OLIMEX <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ESP32-EVB</a>的最初标志之一，这是一个非常有趣的开发板，在不久的将来，它将发布专用的发行套件Arduino Mega Server。 <br><br><img src="https://habrastorage.org/web/878/91b/932/87891b9324f44c0f8973ca0a119ca761.jpg" alt="图片"><br><br><h2> 结论 </h2><br> 实际上，关于新的ESP32模块及其与Arduino的配合，我只能说一下。 他给人留下了非常积极的印象，至少与我一起工作对我来说是非常愉快和有趣的。 缺少支持传感器和外围设备的库会稍微破坏画面，但这只是暂时现象，很快一切都会好起来的。 <br><br> 您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在</a>官方网站的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载</a>页面上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载</a> ESP32的Arduino Mega Server分发套件，相关文档很快就会出现在此处，现在您可以使用分发套件中readme.txt文件中的简要说明。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN404685/">https://habr.com/ru/post/zh-CN404685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN404671/index.html">为什么我们的基因会杀死我们？ 进化解释</a></li>
<li><a href="../zh-CN404673/index.html">基因疗法Liz Parrish-试图解决问题</a></li>
<li><a href="../zh-CN404677/index.html">新型英特尔嵌入式处理器-至强和赛扬</a></li>
<li><a href="../zh-CN404679/index.html">围绕采矿的兴奋使俄罗斯的视频卡短缺。 火车还没走时该怎么办</a></li>
<li><a href="../zh-CN404683/index.html">飞行汽车：虚构还是现实？</a></li>
<li><a href="../zh-CN404687/index.html">一年前特斯拉车主在一次事故中丧生，无视自动驾驶仪的警告</a></li>
<li><a href="../zh-CN404689/index.html">说话者解剖：组合奇迹或有关尖峰矮人的许多个人信息NEAT Acoustics IOTA Alpha</a></li>
<li><a href="../zh-CN404691/index.html">对人类神经系统进行编程。 5分钟内完成书法手写。</a></li>
<li><a href="../zh-CN404693/index.html">我可以违背我的年龄吗</a></li>
<li><a href="../zh-CN404695/index.html">[案例]我们如何在E3上从火星上打印巨型机枪以进行展位</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>