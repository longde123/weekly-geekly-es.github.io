<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯОБ ЁЯОЕЁЯП╜ ЁЯШУ DIY Coroutinesред рднрд╛рдЧ 1. рдЖрд▓рд╕реА рдЬреЗрдирд░реЗрдЯрд░ ЁЯФг ЁЯСиЁЯП╜тАНЁЯПн ЁЯТЕ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЬреЗрд╡реАрдПрдо рджреБрдирд┐рдпрд╛ рдореЗрдВ, рдХреЛрдЖрдЙрдЯрд┐рди рдХреЛрдЯрд▓рд┐рди рднрд╛рд╖рд╛ рдФрд░ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд▓реВрдо рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдореИрдВрдиреЗ рдХреЛрдЯрд▓рд┐рдиреЛрд╡реНрд╕реНрдХреА рдХреЛрд░рд╛рдЙрдЯрд┐рдиреНрд╕ рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DIY Coroutinesред рднрд╛рдЧ 1. рдЖрд▓рд╕реА рдЬреЗрдирд░реЗрдЯрд░</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/480888/"><p>  рдЬреЗрд╡реАрдПрдо рджреБрдирд┐рдпрд╛ рдореЗрдВ, рдХреЛрдЖрдЙрдЯрд┐рди рдХреЛрдЯрд▓рд┐рди рднрд╛рд╖рд╛ рдФрд░ <a href="https://habr.com/ru/company/jugru/blog/422519/">рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд▓реВрдо рдХреЗ</a> рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдореИрдВрдиреЗ рдХреЛрдЯрд▓рд┐рдиреЛрд╡реНрд╕реНрдХреА рдХреЛрд░рд╛рдЙрдЯрд┐рдиреНрд╕ рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рд╡рд░рдг рдирд╣реАрдВ рджреЗрдЦрд╛ рд╣реИ, рдФрд░ рдХреЛрдЯрд▓рд┐рди-рдХреЛрд░рдЯрд╛рдЗрди рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдХреЛрдб рдПрдХ рдЕрдкреНрд░рд╕реНрддреБрдд рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдордЭ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИред  рдореЗрд░реЗ рдЕрдиреБрднрд╡ рдореЗрдВ, рдЬреНрдпрд╛рджрд╛рддрд░ рд▓реЛрдЧ рдХреЗрд╡рд▓ рдХреЛрд░рдЯрд╛рдЗрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпреЗ "рд╣рд▓реНрдХреА рдзрд╛рд░рд╛рдПрдБ" рд╣реИрдВ рдФрд░ рдХреЛрдЯрд▓рд┐рди рдореЗрдВ рд╡реЗ рд╕реНрдорд╛рд░реНрдЯ рдмрд╛рдЗрдЯрдХреЛрдб рдкреАрдврд╝реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП рдореИрдВ рд╣рд╛рд▓ рддрдХ рдерд╛ред  рдФрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдЖрдпрд╛ рдХрд┐ рдЪреВрдВрдХрд┐ рдХреЛрд░рдЯрд╛рдЗрди рдХреЛ рдмрд╛рдИрдЯрдХреЛрдб рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдЬрд╛рд╡рд╛ рдореЗрдВ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ред  рдЗрд╕ рд╡рд┐рдЪрд╛рд░ рд╕реЗ, рдмрд╛рдж рдореЗрдВ, рдПрдХ рдЫреЛрдЯрд╛ рдФрд░ рдХрд╛рдлреА рд╕рд░рд▓ рдкреБрд╕реНрддрдХрд╛рд▓рдп рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдХрд░рдг, рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ, рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдбреЗрд╡рд▓рдкрд░ рджреНрд╡рд╛рд░рд╛ рд╕рдордЭрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдХрдЯ рдХреЗ рддрд╣рдд рд╡рд┐рд╡рд░рдгред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2_/7f/s4/2_7fs4po74_uoaqwmucjmnyjcuw.jpeg"></div><a name="habracut"></a><br><h3 id="ishodnyy-kod">  рд╕реНрд░реЛрдд рдХреЛрдб </h3><br><p>  рдореИрдВрдиреЗ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдорд╛рдЗрдХреНрд░реЛрдЯрдпреВрдЯрд┐рди рдХрд╣рд╛, рдЬреЛ рдХрд┐ рдорд╛рдЗрдХреНрд░реЛ рдФрд░ рдХреЛрд░рдЯрд╛рдЗрдиреНрд╕ рд╢рдмреНрдж рд╕реЗ рдЖрдпрд╛ рд╣реИред </p><br><p>  рд╕рднреА рдХреЛрдб <a href="https://github.com/alexander-shustanov/microutines">github</a> рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред  рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рдореИрдВ рдЕрдкрдиреЗ рдЧрд▓рдд рдирд┐рд░реНрдгрдпреЛрдВ рдФрд░ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ, рдЕрдкреА рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд┐рд╖рдп рдХреА рдЕрдкрдиреА рд╕рдордЭ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрдерд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рд▓реЗрдХрд┐рди рддрдм рд▓реЗрдЦ рдХрд╛ рдХреЛрдб рдХреЛрдб рдХреЗ рд╕рд╛рде рдмрд╣реБрдд рднрд┐рдиреНрди рд╣реЛрдЧрд╛ (рдЬреЛ рдХрд┐рд╕реА рднреА рдорд╛рдорд▓реЗ рдореЗрдВ рдЕрдкрд░рд┐рд╣рд╛рд░реНрдп рд╣реИ, рдореИрдВ рдПрдХ рд▓реЗрдЦ рд▓рд┐рдЦрддрд╛ рд╣реВрдВ рд╕рдордп, рдФрд░ рд╕рдордп-рд╕рдордп рдкрд░ рдЧрд┐рддреВрдм рдХреЛрдореЗрдбрд┐рдХ рдкрд░)ред  рдЗрд╕рд▓рд┐рдП, рдореИрдВ рдЬреНрдпрд╛рджрд╛рддрд░ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдЕрдВрддрд┐рдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рд╡рд░реНрдгрди рдХрд░реВрдВрдЧрд╛, рдФрд░ рдЕрдЧрд░ рдкрд╣рд▓реА рдирдЬрд╝рд░ рдореЗрдВ рдПрдкреА рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЗ рдмрд╣реБрдд рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЙрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓реЗрдЦреЛрдВ рдореЗрдВ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗред </p><br><h3 id="disclaimer">  рддреНрдпрд╛рдЧ </h3><br><p>  рдпрд╣ рдПрдХ рддрд░рд╣ рдХрд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╣реИред  рдореБрдЭреЗ рдЦреБрд╢реА рд╣реЛрдЧреА рдХрд┐ рдЕрдЧрд░ рдХреЛрдИ рдкрд╛рдардХ рдЙрд╕реЗ рдЦреЗрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗ рдпрд╛ рдПрдХ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рднреА рдлреЗрдВрдХреЗред  рд▓реЗрдХрд┐рди рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕рдХреЗ рд▓рд╛рдпрдХ рдирд╣реАрдВ рд╣реИред  рдХрд┐рд╕реА рддрдХрдиреАрдХ рдХреЛ рдЧрд╣рд░рд╛рдИ рд╕реЗ рд╕рдордЭрдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рд▓рд╛рдЧреВ рдХрд░реЗрдВ, рдЬреЛ рдЗрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рд▓рдХреНрд╖реНрдп рд╣реИред </p><br><p>  рдФрд░ рдореИрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЧрдИ рд╢рд░реНрддреЛрдВ рдХреА рд╕рдЯреАрдХрддрд╛ рдХреА рдЧрд╛рд░рдВрдЯреА рдирд╣реАрдВ рджреЗрддрд╛ред  рд╢рд╛рдпрдж рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдореИрдВрдиреЗ рдХрд╣реАрдВ рд╕реБрдирд╛, рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдпрд╛рдж рдХрд┐рдпрд╛, рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рднреА рдЦреБрдж рдХреЗ рд╕рд╛рде рдЖрдП рдФрд░ рднреВрд▓ рдЧрдПред </p><br><h3 id="chto-takoe-korutiny">  рдХреЛрд░рдЯрд╛рдЗрди рдХреНрдпрд╛ рд╣реИрдВ </h3><br><p> рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╣реА рджреЗрдЦрд╛ рд╣реИ, рдпрд╣ рдЕрдХреНрд╕рд░ рдХреЙрд░рдЖрдЙрдЯреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдпреЗ "рд╕реБрдЧрдо рдкреНрд░рд╡рд╛рд╣" рд╣реИрдВред  рдпрд╣ рдПрдХ рд╕рдЪреНрдЪреА рдкрд░рд┐рднрд╛рд╖рд╛ рдирд╣реАрдВ рд╣реИред  рдореИрдВ рдпрд╛ рддреЛ рдПрдХ рд╕рдЪреНрдЪреА рдкрд░рд┐рднрд╛рд╖рд╛ рдирд╣реАрдВ рджреВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рдореИрдВ рдпрд╣ рдмрддрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛ рдХрд┐ рд╡реЗ рдХреНрдпрд╛ рд╣реИрдВ, рдХреЛрд░рдЯрд╛рдЗрдиред  рдХреЛрд░рдЯрд╛рдЗрди рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╣реА рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдХреЛрд░реБрдЯрд┐рди рдПрдХ рд╕реНрдЯреНрд░реАрдо рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдПрдХ рдЫреЛрдЯреА рдпреЛрдЬрдирд╛ рдЗрдХрд╛рдИ рд╣реИ, рдФрд░ рдПрдХ рдзрд╛рд░рд╛, рдмрджрд▓реЗ рдореЗрдВ, рдПрдХ рд╢реЗрдбреНрдпреВрд▓рд┐рдВрдЧ рдЗрдХрд╛рдИ рд╕реЗ рдЫреЛрдЯреА рд╣реИред  рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдФрд░ рдереНрд░реЗрдб рдкреНрд▓рд╛рдирд┐рдВрдЧ рдХреЛ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдХреЙрд░реНрдЯрд┐рди рдкреНрд▓рд╛рдирд┐рдВрдЧ рдореЗрдВ рд▓рдЧреЗ рд╣реИрдВ ... рд╣рдо рдЦреБрдж рдЙрдирдХреА рдкреНрд▓рд╛рдирд┐рдВрдЧ рдореЗрдВ рд▓рдЧреЗ рд░рд╣реЗрдВрдЧреЗред  рдирд┐рдпрдорд┐рдд рдереНрд░реЗрдбреНрд╕ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдХреЛрд░рд╛рдЯрд╛рдЗрдиреНрд╕ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЙрдирдХреА рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм рд╡реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдХрд╛рд░реНрдп рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ рдереНрд░реЗрдб рдХреЛ рдмреНрд▓реЙрдХ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдХреЙрд░рдЖрдЙрдЯ рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВред  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рд╕рд╣рдХрд╛рд░реА рдорд▓реНрдЯреАрдЯрд╛рд╕реНрдХрд┐рдВрдЧ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдХреЛрд░реБрдЯрд┐рди рдкрд╣рд▓реЗ рдПрдХ рдзрд╛рдЧреЗ рдореЗрдВ рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдлрд┐рд░ рджреВрд╕рд░реЗ рдореЗрдВред  рдХреЛрд░рдЯрд╛рдЗрди рдХреЗ рд▓рд┐рдП рдПрдХ рдзрд╛рдЧрд╛ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдПрдХ рд▓рд╛рдЦ рдзрд╛рдЧреЗ рдкрд░ рдПрдХ рд▓рд╛рдЦ рдХреЛрд░рдЯрд╛рдЗрди рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рдЗрд╕ рддрд╕реНрд╡реАрд░ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/41/xu/3j/41xu3j8m3cgly0vdiixkaomex2o.png"></p><br><p>  рдХреЙрдиреНрдЯреНрд░рд┐рдмреНрдпреВрд╢рди 1 рдФрд░ рдХреЙрдиреНрдЯреНрд░рд┐рдмреНрдпреВ 2 рдХреЗ рдХрд╛рд░реНрдп рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрддреНрддрд░ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╕рдордп рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдкрдиреЗ рдХрд╛рдо рдХреЛ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░ рджреЗрддреЗ рд╣реИрдВ рдФрд░ рдЙрддреНрддрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЗрд╕реЗ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВред  рдЖрдк рдХреЙрд▓рдмреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдРрд╕реЗ рдХреЛрдб рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк рдХрд╣рддреЗ рд╣реИрдВред  рдпрд╣ рд╕рдЪ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЛрд░рдЯрд╛рдЗрди рдХрд╛ рд╕рд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдХреЙрд▓рдмреИрдХ рдХреЗ рдмрд┐рдирд╛ рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рд╣рдо рд╕рд╛рдзрд╛рд░рдг рдЕрдиреБрдХреНрд░рдорд┐рдХ рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдЬреЛ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд░реВрдк рд╕реЗ рдЪрд▓рддрд╛ рд╣реИред </p><br><h3 id="generatory">  рдЬрдирд░реЗрдЯрд░ </h3><br><p>  рд╣рдо рд╕рд░рд▓ рд╕реЗ рдЬрдЯрд┐рд▓ рддрдХ рд╡рд┐рдХрд╛рд╕ рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗред  рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рд╣рдо рдХрд░реЗрдВрдЧреЗ, рд╡рд╣ рдЙрдкрдЬ рдХреАрд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдЫ рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рд▓рд╛рдЧреВ рдХреА рдЧрдИ рдЖрд▓рд╕реА рд╕рдВрдЧреНрд░рд╣ рдкреАрдврд╝реА рд╣реЛрдЧреАред  рдЬрдирд░реЗрдЯрд░ рдпрд╣рд╛рдВ рдЖрдХрд╕реНрдорд┐рдХ рдирд╣реАрдВ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдмрд╛рдж рдореЗрдВ рджреЗрдЦреЗрдВрдЧреЗ, рдФрд░ рдЬрдирд░реЗрдЯрд░ рдФрд░ рдХреЛрд░рдЯрд╛рдЗрди рдХреЛ рдПрдХ рд╣реА рддрдВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдЖрдЗрдП рдЕрдЬрдЧрд░ рдореЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ, рдХреЗрд╡рд▓ рдЗрд╕рд▓рд┐рдП рдХрд┐ рдЬрдирд░реЗрдЯрд░ рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИрдВред </p><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> k = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> k k += <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> k k += <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> generator(): print(i)</code> </pre> <br><p>  рдЪрдХреНрд░ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕рд╛рдордиреЗ рдЖрддрд╛ рд╣реИ (рд╢рд╛рдпрдж рдРрд╕рд╛ рдмрд┐рд▓рдХреБрд▓ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рд┐рджреНрдзрд╛рдВрдд рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ): </p><br><pre> <code class="python hljs">gen = generator() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: i = next(gen) print(i) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> StopIteration: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre> <br><p>  <code>generator()</code> рд▓рд┐рдП рдПрдХ рдХреЙрд▓ <code>generator()</code> рдЬрдирд░реЗрдЯрд░ рдирд╛рдордХ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЗрдЯреНрд░реЗрдЯрд░ рдмрдирд╛рдПрдЧрд╛ред  рдкрд╣рд▓реА рдХреЙрд▓ рдЯреВ <code>next(gen)</code> <code>generator</code> рдлрдВрдХреНрд╢рди рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ рдкрд╣рд▓реА <code>yield</code> рддрдХ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ <code>yield</code> , рдФрд░ <code>genertator()</code> рд╕реЗ рд╕реНрдерд╛рдиреАрдп рдЪрд░ <code>k</code> рдХрд╛ рдорд╛рди <code>i</code> рдЪрд░ рдХреЛ рд▓рд┐рдЦрд╛ <code>genertator()</code> рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдЕрдЧрд▓реА рдХреЙрд▓ <code>next</code> рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рдкрд┐рдЫрд▓реЗ <code>yield</code> рдмрд╛рдж рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛ <code>yield</code> рдФрд░ рдЗрд╕реА рддрд░рд╣ред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, <code>next</code> рдХреЙрд▓ рдХреЗ рдмреАрдЪ, <code>generator</code> рдЕрдВрджрд░ рд╕рднреА рд╕реНрдерд╛рдиреАрдп рдЪрд░ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдмрдЪрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рдЙрд╕реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЛрдЯрд▓рд┐рди рднрд╛рд╖рд╛ рдореЗрдВред </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> seq = sequence { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">10</span></span> yield(i) i += <span class="hljs-number"><span class="hljs-number">10</span></span> yield(i) i += <span class="hljs-number"><span class="hljs-number">10</span></span> yield(i) } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> seq) { println(i) }</code> </pre> <br><p>  рдЬрд╛рд╡рд╛ рдореЗрдВ, рд╣рдо рдЖрд▓рд╕реА рдкреАрдврд╝реА рдХреЛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="java hljs">Iterable&lt;Integer&gt; seq = DummySequence.first(() -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DummySequence.next(i, () -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = i + <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DummySequence.next(i1, () -&gt; DummySequence.end(i1 + <span class="hljs-number"><span class="hljs-number">10</span></span>)); }); }); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i: seq) { System.out.println(i); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдбрдореАрд╕рдкреЗрдВрд╕ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.Assert; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.Test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Iterator; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Supplier; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.StreamSupport; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DummySequenceTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dummySequenceTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ DummySequence&lt;Integer&gt; sequence = DummySequence.first(() -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DummySequence.next(<span class="hljs-number"><span class="hljs-number">10</span></span>, () -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = i + <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DummySequence.next(i1, () -&gt; DummySequence.end(i1 + <span class="hljs-number"><span class="hljs-number">10</span></span>)); }); }); List&lt;Integer&gt; list = StreamSupport.stream(sequence.spliterator(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) .collect(Collectors.toList()); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">10</span></span>, ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>))); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">20</span></span>, ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) list.get(<span class="hljs-number"><span class="hljs-number">1</span></span>))); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">30</span></span>, ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) list.get(<span class="hljs-number"><span class="hljs-number">2</span></span>))); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DummySequence</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iterable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iterator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Step&lt;T&gt; step; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DummySequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Step&lt;T&gt; step)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.step = step; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Iterator&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (step <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> EndStep) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; step = step.nextStep(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> step.getValue(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">DummySequence&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Supplier&lt;Step&lt;T&gt;&gt; next)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DummySequence&lt;&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FirstStep&lt;T&gt;(next)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">Step&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T value, Supplier&lt;Step&lt;T&gt;&gt; next)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntermediateStep&lt;&gt;(value, next); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">Step&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EndStep&lt;&gt;(value); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Step</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Step&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FirstStep</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Step</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ Supplier&lt;Step&lt;T&gt;&gt; nextStep; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FirstStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Supplier&lt;Step&lt;T&gt;&gt; next)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nextStep = next; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Step&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nextStep.get(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntermediateStep</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Step</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ T value; Supplier&lt;Step&lt;T&gt;&gt; nextStep; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntermediateStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T value, Supplier&lt;Step&lt;T&gt;&gt; nextStep)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nextStep = nextStep; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Step&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nextStep.get(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EndStep</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Step</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ T value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Step&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(); } } }</code> </pre> </div></div><br><p>  рдкреНрд░рддреНрдпреЗрдХ рдЕрдЧрд▓рд╛ рдиреЗрд╕реНрдЯреЗрдб рд▓реИрдореНрдмреНрдбрд╛ рд╕рднреА рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рд╕рднреА рдкрд┐рдЫрд▓реЗ рд▓реИрдореНрдмрдбрд╛ рд╕реЗ рдХреИрдкреНрдЪрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХреЗрд╡рд▓ рддрднреА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдЕрдЧрд▓рд╛ рддрддреНрд╡ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рд▓реИрдореНрдмреНрдбрд╛ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЙрддреНрдкрдиреНрди рддрддреНрд╡ рдФрд░ рдХреЛрдб рдХрд╛ рдЕрдЧрд▓рд╛ рдмреНрд▓реЙрдХ рд╣реЛрдЧрд╛ред  рдпрд╣ рдмрд╣реБрдд рдЕрдЬреАрдм рд▓рдЧрддрд╛ рд╣реИ, рдФрд░ рдореБрдЭреЗ рд╕рдВрджреЗрд╣ рд╣реИ рдХрд┐ рдХреЛрдИ рднреА рдРрд╕рд╛ рд▓рд┐рдЦреЗрдЧрд╛ред  рд╣рдо рдЙрд╕ рдЖрджрд░реНрд╢ рдХреЛ рдирд┐рд░реВрдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╣рдо рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗ (рдФрд░ рд╣рдо рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ, рд╕рд┐рд╡рд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рд╣рдо рд▓рдВрдмреЛрджрд░ рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдЕрдирд╛рдо рд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ)ред </p><br><pre> <code class="java hljs">Sequence&lt;Integer&gt; sequence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sequence&lt;Integer&gt;(() -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">10</span></span>; yield(i); i += <span class="hljs-number"><span class="hljs-number">10</span></span>; yield(i); i += <span class="hljs-number"><span class="hljs-number">10</span></span>; yield(i); });</code> </pre> <br><p>  рдЕрдиреБрдХреНрд░рдо рдирд┐рд░реНрдорд╛рддрд╛ рдХреЛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ <code>yield</code> рд╕реЗ <code>yield</code> рддрдХ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рд╕реНрдерд╛рдиреАрдп рдЪрд░ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдХреЙрд▓ рдХреЗ рдмреАрдЪ <code>sequence.next()</code> рдЬрдорд╛ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <code>sequence.next()</code> ред  рд╕реНрдЯреИрдХ рдХреА рдЗрд╕ рдмрдЪрдд рдФрд░ рдЕрдВрддрд┐рдо рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдЕрдиреБрджреЗрд╢ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ <em>рдкреНрд░реАрдореАрд╢рди</em> (рдЙрдкрдЬ рдХрд╛ рд░реВрд╕реА рдореЗрдВ рдЕрдиреБрд╡рд╛рдж) рдпрд╛ <em>рдирд┐рд▓рдВрдмрди</em> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><h3 id="kontinuacii">  Kontinuatsii </h3><br><p>  рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдЬрд┐рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдЪреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЙрд╕реЗ рдХреЙрдиреНрдЯреАрдиреНрдпреВрд╢рди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рд░реВрд╕реА рдореЗрдВ 'рдирд┐рд░рдВрддрд░рддрд╛' рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рдЗрд╕реЗ рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╣реВрдВрдЧрд╛ред  рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд▓рд┐рдЦрддрд╛ рд╣реИ: </p><br><blockquote>  рдирд┐рд░рдВрддрд░рддрд╛ (рдЗрдВрдЬреАред рдирд┐рд░рдВрддрд░рддрд╛) рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдордп рдкрд░ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕реЗ рдмрдЪрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рд░рд╛рдЬреНрдп рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдмрд┐рдВрджреБ рд╕реЗ рдХрд┐рд╕реА рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рд╕реВрдЪрдирд╛рдУрдВ рдХреЛ рдЬрд╛рд░реА рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред </blockquote><p>  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХрд┐рд╕реА рддрд░рд╣ рдХрд╛ рдЬрд╛рджреБрдИ рддрд░реАрдХрд╛ рд╣реИ, рдЬреЛ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рддрдВрддреНрд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рджреНрд╡рд╛рд░рд╛ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  <code>run</code> рд╡рд┐рдзрд┐ рдЗрд╕рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд░реЛрдХ рд╕рдХрддреА рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдмрд╛рдж рдХреА рдХреЙрд▓ рдЕрдВрддрд┐рдо <code>yield</code> рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреА <code>yield</code> ред  рд╣рдо рдПрдХ <code>Runnable</code> рд░реВрдк рдореЗрдВ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рднрд╛рдЧреЛрдВ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Continuation</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceScope&lt;T&gt; scope)</span></span></span></span>; }</code> </pre> <br><p>  рд╣рдо рдЗрд╕ рддрд░рд╣ рд╕реЗ рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ: </p><br><pre> <code class="java hljs">Sequence&lt;Integer&gt; sequence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sequence&lt;&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Continuation&lt;&gt;() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceScope&lt;Integer&gt; scope)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation start"</span></span>); scope.yield(i++); System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation resume"</span></span>); scope.yield(i++); System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation resume"</span></span>); scope.yield(i++); System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation end"</span></span>); } }); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Integer i: sequence) { System.out.println(<span class="hljs-string"><span class="hljs-string">"Next element :"</span></span> + i); }</code> </pre> <br><p>  рдФрд░ рд╣рдо рдЗрд╕ рдирд┐рд╖реНрдХрд░реНрд╖ рдХреЛ рдкрд╛рдиреЗ рдХреА рдЙрдореНрдореАрдж рдХрд░рддреЗ рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рдЙрддреНрдкрд╛рджрди</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Continuation start Next element: 1 Continuation resume Next element: 2 Continuation resume Next element: 3 Continuation end</code> </pre> </div></div><br><p>  рдЕрдЧрд▓реЗ рддрддреНрд╡ рдХреЗ рдЕрдиреБрд░реЛрдз рдкрд░ <code>Sequence</code> <code>Continuation.run(scope)</code> рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛, рдЬреЛ рдЕрдЧрд▓реА рдЙрдкрдЬ рддрдХ рдХреЛрдб рдХреЗ рдПрдХ рдмреНрд▓реЙрдХ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ рднреАрдбрд╝ рд╕реЗ рдмрд╛рд╣рд░ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  <code>Continuation.run(scope)</code> рдХреА рдЕрдЧрд▓реА рдХреЙрд▓ рдЕрдВрддрд┐рдо рднреАрдбрд╝ рдХреЗ рд╕реНрдерд╛рди рд╕реЗ рдХрд╛рдо рд╢реБрд░реВ рдХрд░реЗрдЧреА рдФрд░ рдЕрдЧрд▓реА <code>yield</code> рддрдХ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧреАред  <code>Sequence</code> рдХреЛрдб рдЗрд╕ рддрд░рд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iterator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SequenceScope</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iterable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Object STOP = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Object next = STOP; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Continuation&lt;T&gt; nextStep; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Continuation&lt;T&gt; nextStep)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nextStep = nextStep; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (next == STOP) { nextStep.run(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next != STOP; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (next == STOP) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasNext()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchElementException(); } } T result = (T) next; next = STOP; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T t)</span></span></span><span class="hljs-function"> </span></span>{ next = t; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Iterator&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ,       return this; } } interface SequenceScope&lt;T&gt; { void yield(T t); }</span></span></code> </pre> <br><p>  рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реИ, рд╕рд┐рд╡рд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рдЬрд╛рд╡рд╛ рдПрдХ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдЬрдЧрд╣ рдореЗрдВ рд╡рд┐рдзрд┐ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд░реЛрдХрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ, рддрд╛рдХрд┐ рддрдм рд╡рд╣ рдЕрдВрддрд┐рдо рдкрдбрд╝рд╛рд╡ рдХреЗ рд╕реНрдерд╛рди рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрди рдЬрд╛рд░реА рд░рдЦ рд╕рдХреЗред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рд▓реЗрдмрд▓ рдлрд╝реАрд▓реНрдб рджрд░реНрдЬ рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдЕрдВрддрд┐рдо рдХреЙрд▓ рдХреА рдЧрдИ рдЙрдкрдЬ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗред </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntegerSequenceContinuation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Continuation</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> label = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceScope&lt;Integer&gt; scope)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (label) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation start"</span></span>); scope.yield(i++); label = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i = i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation resume"</span></span>); scope.yield(i++); label = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i = i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation resume"</span></span>); scope.yield(i++); label = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i = i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: System.out.println(<span class="hljs-string"><span class="hljs-string">"Continuation end"</span></span>); label = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(); } } }</code> </pre> <br><p>  рд╣рдо рдПрдХ рд░рд╛рдЬреНрдп рдорд╢реАрди (рдкрд░рд┐рдорд┐рдд рд░рд╛рдЬреНрдп рдорд╢реАрди) рдкреНрд░рд╛рдкреНрдд рдХрд░ рдЪреБрдХреЗ рд╣реИрдВ, рдФрд░ рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдпрд╣ рд╡рд╣реА рд╣реИ рдЬреЛ рдХреЛрдЯрд▓рд┐рди рдЕрдкрдиреЗ рдХреЛрд░рдЖрдЙрдЯреНрд╕ рдореЗрдВ рдХрд░рддрд╛ рд╣реИ (рдЖрдк рд╡рд┐рдШрдЯрд┐рдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛, рдЬрд╝рд╛рд╣рд┐рд░ рд╣реИ, рдЖрдк рдХреБрдЫ рд╕рдордЭрддреЗ рд╣реИрдВ)ред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 4 рд░рд╛рдЬреНрдп рд╣реИрдВ, рдкреНрд░рддреНрдпреЗрдХ <code>run</code> рдХреЙрд▓ рдХреЛрдб рдХрд╛ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдЧрд▓реЗ рд░рд╛рдЬреНрдп рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдмрдирд╛рддрд╛ рд╣реИред  рд╣рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рдЪрд░ i рдХреЛ рд╡рд░реНрдЧ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╕рд╣реЗрдЬрдирд╛ рд╣реЛрдЧрд╛ред  рдЕрдиреБрдЪрд┐рдд рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдХреЛрдб рдореЗрдВ рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рд╣реИ: рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рд░рди рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдЧреБрдВрдЬрд╛рдЗрд╢ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдорд╛рдиреЛрдВ рдХреЛ рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдкрд╣рд▓реА рдХреЙрд▓ рдкрд░ рдХреНрд▓рд╛рд╕ рдлрд╝реАрд▓реНрдб рдореЗрдВ рд╕реНрдХреЛрдк рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╕рд╣реЗрдЬрдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛, рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦреЗрдВрдЧреЗред </p><br><p>  рдЬрд╛рд╡рд╛ рдкрд░ рдирд┐рд░рдВрддрд░рддрд╛ рд╣рдо рдореЗрдВ рд▓рд╛рдЧреВ рдХреА рдЬрд╛рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдЕрдЬреАрдм рддрд░реАрдХреЗ рд╕реЗ рдФрд░ рдХреЗрд╡рд▓ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдореЗрдВред  рд╣рд░ рдмрд╛рд░ рдХреЛрдИ рднреА рдХреБрдЫ рд╕рдорд╛рди рдирд╣реАрдВ рд▓рд┐рдЦреЗрдЧрд╛, рдРрд╕реЗ рдХреЛрдб рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ, рдРрд╕реЗ рдХреЛрдб рдХреЛ рдкрдврд╝рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рд╕рдВрдХрд▓рди рдХреЗ рдмрд╛рдж рд░рд╛рдЬреНрдп рдорд╢реАрди рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗред </p><br><h3 id="suspendable--continuation">  рд╕рд╕реНрдкреЗрдВрдбреЗрдмрд▓ рдФрд░ рдХрдВрдЯреАрдиреНрдпреВ </h3><br><p>  рдпрджрд┐ рдирд┐рд░рдВрддрд░рддрд╛ рдиреЗ рдХрд╛рдо рдкреВрд░рд╛ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ рдпрд╛ рдирд┐рд▓рдВрдмрд┐рдд рдХрд░ рджрд┐рдпрд╛ рд╣реИ рддреЛ рд╣рдо рдХреИрд╕реЗ рд╕рдордЭреЗрдВрдЧреЗ?  рдирд┐рд▓рдВрдмрди рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ <code>run</code> рд╡рд┐рдзрд┐ рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ <code>SUSPEND</code> рдСрдмреНрдЬреЗрдХреНрдЯ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рджреЗрдВред </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Continuation</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ Object SUSPEND = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"[SUSPEND]"</span></span>; } }; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдореИрдВрдиреЗ рдЗрдирдкреБрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдирд┐рд░рдВрддрд░рддрд╛ рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рд╣реИред  рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЙрд▓ рд╕реЗ рдХреЙрд▓ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рди рд╣реЛрдВ, рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛рдирд╛ рд╣реИред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, <code>scope</code> рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ (рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╣реБрдд рд╕рд╛рд░реА рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрдм <code>SequenceScope</code> рдХреЛ рдЗрд╕рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рд╕реЗ рд╣рдорд╛рд░реА <code>yield</code> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд┐рд╕реА рднреА <code>SUSPEND</code> рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддрд╛ рд╣реИ рдФрд░ рдХреБрдЫ рднреА рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИред  <code>Suspendable</code> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдкрд░рд┐рдЪрдп <code>Suspendable</code> ред </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Suspendable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scope</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(C scope)</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scope</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдПрдХ рд╕рд╛рд░ рд╡рд░реНрдЧ, рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреНрдпреЛрдВ рдирд╣реАрдВ?</b> <div class="spoiler_text"><p>  рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдмрдЬрд╛рдп рдПрдХ рд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд▓реИрдореНрдмрджрд╛рд╕ рд▓рд┐рдЦрдиреЗ рдФрд░ рдмрд▓реЛрдВ рдХреЛ рдЕрдирд╛рдо рдХрдХреНрд╖рд╛рдПрдВ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ рдХрд┐ рд╣рдо рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рд╕рд╛рде рдмрд╛рдИрдЯреЗрдХреЛрдб рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдерд╛рдиреАрдп рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдЙрдирдХреЗ рдЦреЗрддреЛрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдмрд╛рдЗрдЯрдХреЛрдб рдореЗрдВ рд▓реИрдореНрдмреНрдбрд╛ рдПрдХ рд╡рд░реНрдЧ рдХреА рддрд░рд╣ рдирд╣реАрдВ рджрд┐рдЦрддрд╛ рд╣реИред  рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, <a href="https://habr.com/ru/company/haulmont/blog/432418/">рдпрд╣рд╛рдВ рдЬрд╛рдПрдВ</a> ред </p></div></div><br><p>  рдбрд┐рдЬрд╛рдЗрди рд╕рдордп рдореЗрдВ <code>Suspendable</code> <code>Continuation</code> рд╣реИ, рдЬрдмрдХрд┐ <code>Suspendable</code> рдореЗрдВ <code>Continuation</code> <code>Suspendable</code> ред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ <code>Suspendable</code> рд╕реНрддрд░ рдкрд░ рдХреЛрдб рд▓рд┐рдЦрддрд╛ рд╣реИ, рдФрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдХреЛрдб <code>Continuation</code> рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдмрд╛рдЗрдЯрдХреЛрдб рдХреЗ рд╕рдВрд╢реЛрдзрди рдХреЗ рдмрд╛рдж рдПрдХ рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо <code>yield</code> рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдкреНрд░реАрдореЗрдЪ рдХрд░рдиреЗ рдХреА рдмрд╛рдд рдХрд░реЗрдВ, рд▓реЗрдХрд┐рди рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╣рдореЗрдВ рдХреБрдЫ рдЕрдиреНрдп рддрд░реАрдХреЛрдВ рдХреЗ рдмрд╛рдж рдкреНрд░реАрдореАрдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред  рд╣рдо рдРрд╕реЗ рддрд░реАрдХреЛрдВ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЬреИрд╕реЗ <code>@Suspend</code> рдЯрд┐рдкреНрдкрдгреАред  рдпрд╣ рд╕реНрд╡рдпрдВ <code>yield</code> рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SequenceScope</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scope</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Suspend</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T t)</span></span></span><span class="hljs-function"> </span></span>{...} }</code> </pre> <br><p>  рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рд╣рдорд╛рд░реА рдирд┐рд░рдВрддрд░рддрд╛ рдкрд░рд┐рдорд┐рдд рдСрдЯреЛрдореЗрдЯрд╛ рдкрд░ рдмрдирд╛рдИ рдЬрд╛рдПрдЧреАред  рдЖрдЗрдП рд╣рдо рдпрд╣рд╛рдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрддрд╛рдПрдВред  рдЗрд╕реЗ рдПрдХ рдкрд░рд┐рдорд┐рдд рд░рд╛рдЬреНрдп рдорд╢реАрди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рд░рд╛рдЬреНрдпреЛрдВ рдХреА рд╕реАрдорд┐рдд рд╕рдВрдЦреНрдпрд╛ рд╣реЛрддреА рд╣реИред  рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рд╡рд┐рд╢реЗрд╖ рд▓реЗрдмрд▓ рдлрд╝реАрд▓реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рд▓реЗрдмрд▓ <code></code> 0 рд╣реИ - рдПрдХ рд╢реВрдиреНрдп (рдкреНрд░рд╛рд░рдВрднрд┐рдХ) рд╕реНрдерд┐рддрд┐ред  <code>Continuation.run</code> рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЕрд╡рд╕реНрдерд╛ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрд┐рд╕реА рднреА рд╕реНрдерд┐рддрд┐ (рдХрд┐рд╕реА рдЕрдиреНрдп рдореЗрдВ) рдореЗрдВ рдЬрд╛рдПрдЧрд╛ред  рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рдмрд╛рдж, рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рд╕рднреА рд╕реНрдерд╛рдиреАрдп рдЪрд░, рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдмрдЪрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ <code>return SUSPEND</code> рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЕрдВрддрд┐рдо рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреЛ <code>return null</code> рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реВрдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓реЗрдЦреЛрдВ рдореЗрдВ рд╣рдо рдХреЗрд╡рд▓ <code>null</code> рдирд╣реАрдВ рд▓реМрдЯреЗрдВрдЧреЗ)ред  рдЕрдВрддрд┐рдо рд╕реНрдерд┐рддрд┐ рд╕реЗ <code>Continuation.run</code> рдХреЙрд▓ рдПрдХ <code>ContinuationEndException</code> рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </p><br><p>  рдЗрд╕рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдб рдХреЛ <code>Suspendable</code> рдореЗрдВ <code>Suspendable</code> , рд╕рдВрдХрд▓рди рдХреЗ рдмрд╛рдж рдпрд╣ <code>Suspendable</code> рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рд╣рдорд╛рд░реЗ рдЬрдирд░реЗрдЯрд░ред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдЬрдирд░реЗрдЯрд░ рдмрдирд╛рдирд╛ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="java hljs">Sequence&lt;Integer&gt; seq = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sequence(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Suspendable() {...});</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЬрдирд░реЗрдЯрд░ рдХреЛ рдирд┐рд░рдВрддрд░рддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕реЗ <code>Continuation&lt;T&gt; nextStep;</code> рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ <code>Continuation&lt;T&gt; nextStep;</code>  ред  рдХреЛрдб рдореЗрдВ <code>Suspendable</code> рд╕реЗ <code>Suspendable</code> рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ <code>Magic</code> рдХреНрд▓рд╛рд╕ рд▓рд┐рдЦреАред </p><br><p><img src="https://habrastorage.org/webt/le/hn/sk/lehnsk5dh-wi0l_awsdjm9ykz8m.jpeg"></p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> microutine.core; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> microutine.coroutine.CoroutineScopeImpl; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.reflect.Field; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Magic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SCOPE = <span class="hljs-string"><span class="hljs-string">"scope$S"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;C extends Scope, R&gt; <span class="hljs-function"><span class="hljs-function">Continuation&lt;R&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createContinuation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Suspendable&lt;C&gt; suspendable, C scope)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Field contextField = suspendable.getClass().getDeclaredField(SCOPE); contextField.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contextField.get(suspendable) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Continuation already created"</span></span>); contextField.set(suspendable, scope); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getContinuation(suspendable); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;R, C extends Scope&gt; <span class="hljs-function"><span class="hljs-function">Continuation&lt;R&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContinuation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Suspendable suspendable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getScope(suspendable) == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"No continuation created for provided suspendable"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//noinspection unchecked return ((Continuation&lt;R&gt;) suspendable); } private static Scope getScope(Suspendable suspendable) { try { Field contextField = suspendable.getClass().getDeclaredField(SCOPE); contextField.setAccessible(true); return (Scope) contextField.get(suspendable); } catch (Exception e) { throw new RuntimeException(e); } } }</span></span></code> </pre> <br><p>  рдпрд╣ рдЬрд╛рджреВ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?  <code>scope</code> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде, <code>scope$S</code> рдХреНрд╖реЗрддреНрд░ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдм (рд╕рд┐рдВрдереЗрдЯрд┐рдХ рдХреНрд╖реЗрддреНрд░ рдЬрд┐рд╕реЗ рд╣рдо рдмрд╛рдпрдЯреЗрдХреЛрдб рдореЗрдВ рдмрдирд╛рдПрдВрдЧреЗ) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ <code>createContinuation</code> рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рдЖрд░рдВрднреАрдХреГрдд рдХреА <code>createContinuation</code> , рдФрд░ рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рдПрдХ рджреВрд╕рд░реЗ рдкреНрд░рдпрд╛рд╕ рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛрдЧрд╛ред  рдЗрд╕рдХреЗ рдмрд╛рдж <code>Continuation</code> рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рдЯрд╛рдЗрдк рдХрд╛рд╕реНрдЯ рдЖрддрд╛ рд╣реИред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдореИрдВрдиреЗ рдЖрдкрдХреЛ рдзреЛрдЦрд╛ рджрд┐рдпрд╛, рд╕рднреА рдЬрд╛рджреВ рдпрд╣рд╛рдВ рдирд╣реАрдВ рд╣реИред  рдЪреВрдВрдХрд┐ рдЗрд╕ рддрд░рд╣ рдХрд╛ рд░реВрдкрд╛рдВрддрд░рдг рд╕рдВрднрд╡ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯ <code>Suspendable</code> рдкрд╣рд▓реЗ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдП рдЧрдП <code>Continuation</code> ред  рдФрд░ рд╕рдВрдХрд▓рди рдХреЗ рджреМрд░рд╛рди рдРрд╕рд╛ рд╣реБрдЖред </p><br><h3 id="struktura-proekta">  рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреА рд╕рдВрд░рдЪрдирд╛ </h3><br><p>  рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рддреАрди рднрд╛рдЧ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗ: </p><br><ul><li>  рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛрдб (рдирд┐рдореНрди рд╕реНрддрд░ рдФрд░ рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рдПрдкреАрдЖрдИ) </li><li>  рдкрд░реАрдХреНрд╖рдг (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдХреЗрд╡рд▓ рдЙрди рдореЗрдВ рдЕрдм рдЖрдк рдЗрд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ) </li><li>  рд╕рд╕реНрдкреИрдВрдбреЗрдмрд▓ </li></ul><br><p>  рдЪреВрдВрдХрд┐ рдХрдирд╡рд░реНрдЯрд░ рд╡рд░реНрддрдорд╛рди рдореЗрдВ buildSrc рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рдмрд╛рд╣рд░ рдХрд╣реАрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреЛ рд╡рд┐рдХрд▓реНрдк рд╣реЛрдВрдЧреЗ: рдЗрд╕реЗ рдПрдХ рдЕрд▓рдЧ рдкреНрд▓рдЧрдЗрди рдмрдирд╛рдПрдВ, рдпрд╛ рдЕрдкрдирд╛ рд╕реНрд╡рдпрдВ рдХрд╛ рдЬрд╛рд╡рд╛ рдПрдЬреЗрдВрдЯ рдмрдирд╛рдПрдВ (рдЬреИрд╕рд╛ рдХрд┐ <a href="https://github.com/puniverse/quasar">рдХреНрд╡рд╛рд╕рд░</a> рдХрд░рддрд╛ рд╣реИ) рдФрд░ рд░рдирдЯрд╛рдЗрдо рдореЗрдВ рд░реВрдкрд╛рдВрддрд░рдг рдХрд░рддреЗ рд╣реИрдВред </p><br><div class="spoiler">  <b class="spoiler_title">build.gradle</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">plugins { id "java" } group 'microutines' version '1.0-SNAPSHOT' sourceCompatibility = 1.8 task processYield(type: microutine.ProcessSuspendableTask) { classPath = compileJava.outputs.files + compileJava.classpath inputs.files(compileJava.outputs.files) } task processTestYield(type: microutine.ProcessSuspendableTask) { classPath = compileJava.outputs.files + compileTestJava.classpath inputs.files(compileTestJava.outputs.files) } compileJava.finalizedBy(processYield) //      compileTestJava.finalizedBy(processTestYield) repositories { mavenCentral() } dependencies { testCompile group: 'junit', name: 'junit', version: '4.12' compile group: 'junit', name: 'junit', version: '4.12' }</code> </pre> </div></div><br><p>  <code>Continuation</code> рд▓рд┐рдП рд╕рд╕реНрдкреЗрдВрдбреЗрдмрд▓ рдХреЛ рдЯрд╛рд╕реНрдХрд╕реНрдкреЗрдВрдбреЗрдмрд▓рдЯреЗрд╕реНрдХ рдЯрд╛рд╕реНрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдУрд▓рд╛ рдЯрд╛рд╕реНрдХ рдХреНрд▓рд╛рд╕ рдореЗрдВ рдХреБрдЫ рднреА рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИ, рдпрд╣ рд╕рд┐рд░реНрдл рдЖрд╡рд╢реНрдпрдХ рд╡рд░реНрдЧреЛрдВ рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ <code>SuspendableConverter</code> рд╡рд░реНрдЧ рдореЗрдВ рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рд▓рд┐рдП рднреЗрдЬрддрд╛ рд╣реИред  рдпрд╣ рд╡рд╣ рд╣реИ рдЬреЛ рдЕрдм рд╣рдорд╛рд░реЗ рд╣рд┐рдд рдореЗрдВ рд╣реИред </p><br><h3 id="generaciya-baytkoda">  рдмрд╛рдЗрдЯрдХреЛрдб рдЬреЗрдирд░реЗрд╢рди </h3><br><p>  рдмрд╛рдпрдЯреЗрдХреЛрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо OW2 ASM рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдкреБрд╕реНрддрдХрд╛рд▓рдп SAX рдкрд╛рд░реНрд╕рд░ рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рд╣рдо рдПрдХ рдирдпрд╛ ClassReader рдмрдирд╛рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдПрдХ рд╕рдВрдХрд▓рд┐рдд рд╡рд░реНрдЧ рдХреЛ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдПрдХ рд╕рд░рдгреА рдХреЗ рд░реВрдк рдореЗрдВ рдЦрд┐рд▓рд╛рддреЗ рд╣реИрдВ, рдФрд░ <code>accept(ClassVisitor visitor)</code> рд╡рд┐рдзрд┐ рдХрд╣рддреЗ рд╣реИрдВред  ClassReader bytecode рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░реЗрдЧрд╛ рдФрд░ рдЙрддреНрддреАрд░реНрдг рдЖрдЧрдВрддреБрдХ ( <code>visitMethod</code> , <code>visitClass</code> , <code>visitInsn</code> ) рдкрд░ рдЙрдкрдпреБрдХреНрдд рддрд░реАрдХреЗ рд╕реЗ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред  рдЖрдЧрдВрддреБрдХ рдПрдбреЙрдкреНрдЯрд░ рдореЛрдб рдореЗрдВ рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЕрдЧрд▓реЗ рдЖрдЧрдВрддреБрдХ рдХреЛ рдХреЙрд▓ рд╕реМрдВрдк рд╕рдХрддрд╛ рд╣реИред  рдЖрдорддреМрд░ рдкрд░, рдЕрдВрддрд┐рдо рдЖрдЧрдВрддреБрдХ рдПрдХ <code>ClassWriter</code> , рдЬрд┐рд╕рдореЗрдВ рдЕрдВрддрд┐рдо <code>ClassWriter</code> рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред  рдпрджрд┐ рдХрд╛рд░реНрдп рдЧреИрд░-рд░реИрдЦрд┐рдХ рд╣реИ (рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рд┐рд░реНрдл рдПрдХ рд╣реИ), рддреЛ рдпрд╣ рдХрдХреНрд╖рд╛ рд╕реЗ рдХрдИ рдкрд╛рд╕ рд▓реЗ рд╕рдХрддрд╛ рд╣реИред  рдПрдПрд╕рдПрдо рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдХрдХреНрд╖рд╛ рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ <code>ClassNode</code> рдкрд░ рд▓рд┐рдЦрд╛ рдЬрд╛рдП, рдФрд░ рдЙрд╕ рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ рдЬрд╛рдПред  рдкрд╣рд▓рд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг рддреЗрдЬрд╝ рд╣реИ, рд▓реЗрдХрд┐рди рдЧрд╝реИрд░-рд╕рдорд╕реНрдпрд╛ рдХреЗ рд╕рдорд╛рдзрд╛рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рджреЛрдиреЛрдВ рджреГрд╖реНрдЯрд┐рдХреЛрдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред </p><br><p>  <code>Suspendable</code> рдЯреВ <code>Continuation</code> рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдореЗрдВ 3 рд╡рд░реНрдЧ <code>Suspendable</code> : </p><br><ul><li>  <code>SuspendInfoCollector</code> - <code>Suspendable.run</code> рд╡рд┐рдзрд┐ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ, рд╕рднреА рдХреЙрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ <code>@Suspend</code> рд╡рд┐рдзрд┐рдпреЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╕реНрдерд╛рдиреАрдп рдЪрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░рддрд╛ рд╣реИред </li><li>  <code>SuspendableConverter</code> - рдЖрд╡рд╢реНрдпрдХ рдлрд╝реАрд▓реНрдб рдмрдирд╛рддрд╛ рд╣реИ, <code>Continuation.run</code> рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>Suspendable.run</code> рд╡рд┐рдзрд┐ рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдФрд░ рд╣реИрдВрдбрд▓ рдХреЛ <code>Suspendable.run</code> ред </li><li>  <code>SuspendableMethodConverter</code> - <code>Suspendable.run</code> рд╡рд┐рдзрд┐ рдХрд╛ рдХреЛрдб <code>Suspendable.run</code> рд╣реИред  рд╕реНрдерд╛рдиреАрдп рдЪрд░ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдФрд░ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ, <code>label</code> рдлрд╝реАрд▓реНрдб рдореЗрдВ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдФрд░ рдЗрдЪреНрдЫрд┐рдд рдирд┐рд░реНрджреЗрд╢ рдкрд░ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЛрдб рдЬреЛрдбрд╝рддрд╛ рд╣реИред </li></ul><br><p>  рдЖрдЗрдП рдХреБрдЫ рдмрд┐рдВрджреБрдУрдВ рдХрд╛ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрди рдХрд░реЗрдВред </p><br><p>  <code>run</code> рд╡рд┐рдзрд┐ рдХреА рдЦреЛрдЬ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: </p><br><pre> <code class="java hljs">MethodNode method = classNode.methods.stream() .filter(methodNode -&gt; methodNode.name.equals(<span class="hljs-string"><span class="hljs-string">"run"</span></span>) &amp;&amp; (methodNode.access &amp; Opcodes.ACC_BRIDGE) == <span class="hljs-number"><span class="hljs-number">0</span></span>) .findFirst() .orElseThrow(() -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Unable to find method to convert"</span></span>));</code> </pre> <br><p>  рдпрд╣ рдЙрдореНрдореАрдж рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд╡рд░реНрдЧ рдореЗрдВ рджреЛ <code>run</code> рд╡рд┐рдзрд┐рдпрд╛рдВ рд╣реЛрдВрдЧреА, рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдкреБрд▓ рд╕рдВрд╢реЛрдзрдХ рдХреЗ рд╕рд╛рде рд╣реЛрдЧрд╛ (рдпрд╣ <a href="https://habr.com/ru/company/haulmont/blog/426419/">рдпрд╣рд╛рдВ</a> рдХреНрдпрд╛ рдкрдврд╝рд╛ рдЧрдпрд╛ <a href="https://habr.com/ru/company/haulmont/blog/426419/">рд╣реИ</a> )ред  рд╣рдо рдПрдХ рд╕рдВрд╢реЛрдзрдХ рдХреЗ рдмрд┐рдирд╛ рдПрдХ рд╡рд┐рдзрд┐ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред </p><br><p>  рдЬреЗрд╡реАрдПрдо рдмрд╛рдпрдЯреЗрдХреЛрдб рдореЗрдВ, рдПрдХ рд╕рд╢рд░реНрдд (рдФрд░ рдмрд┐рдирд╛ рд╢рд░реНрдд) рд╕рдВрдХреНрд░рдордг рдХрд╣реАрдВ рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдПрдПрд╕рдПрдо рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖ <code>Label</code> рдПрдмреНрд╕реНрдЯреНрд░реИрдХреНрд╢рди (рд▓реЗрдмрд▓) рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдмрд╛рдЗрдЯрдХреЛрдб рдореЗрдВ рдПрдХ рд╕реНрдерд┐рддрд┐ рд╣реИред  рдХреЛрдб рдХреЗ рджреМрд░рд╛рди, <code>@Suspend</code> рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓ рдХреЗ рдмрд╛рдж, рд╣рдо рдЙрди рд▓реЗрдмрд▓реЛрдВ рдХреЛ рдЬрдЧрд╣ рджреЗрдВрдЧреЗ, рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдо <code>run</code> рд╡рд┐рдзрд┐ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдПрдХ рд╕рд╢рд░реНрдд рдЫрд▓рд╛рдВрдЧ рд▓рдЧрд╛рдПрдВрдЧреЗред </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visitCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    super.visitCode(); Label startLabel = new Label(); super.visitVarInsn(Opcodes.ALOAD, THIS_VAR_INDEX); //    this super.visitFieldInsn(Opcodes.GETFIELD, myClassJvmName, "label$S$S", "I"); //  label$S$S super.visitVarInsn(Opcodes.ISTORE, labelVarIndex); //      super.visitVarInsn(Opcodes.ILOAD, labelVarIndex); //   label   super.visitIntInsn(Opcodes.BIPUSH, 0); //  0   super.visitJumpInsn(Opcodes.IF_ICMPEQ, startLabel); //      startLabel        (label == 0) for (int i = 0; i &lt; numLabels; i++) { //   ,     super.visitVarInsn(Opcodes.ILOAD, labelVarIndex); super.visitIntInsn(Opcodes.BIPUSH, i + 1); super.visitJumpInsn(Opcodes.IF_ICMPEQ, labels[i]); } super.visitTypeInsn(Opcodes.NEW, "microutine/core/ContinuationEndException"); // run      ,   super.visitInsn(Opcodes.DUP); super.visitMethodInsn(Opcodes.INVOKESPECIAL, "microutine/core/ContinuationEndException", "&lt;init&gt;", "()V", false); super.visitInsn(Opcodes.ATHROW); super.visitLabel(startLabel); // ,      }</span></span></code> </pre> <br><p>  рд╣рдо <code>@Suspend</code> рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдХреЙрд▓ рдХреЗ рдмрд╛рдж рд▓реЗрдмрд▓ <code>@Suspend</code> ред </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visitMethodInsn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> opcode, String owner, String name, String descriptor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isInterface)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> suspendPoint = Utils.isSuspendPoint(classLoader, owner, name); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.visitMethodInsn(opcode, owner, name, descriptor, isInterface); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (suspendPoint) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.visitVarInsn(Opcodes.ALOAD, THIS_VAR_INDEX); <span class="hljs-comment"><span class="hljs-comment">//    this super.visitIntInsn(Opcodes.BIPUSH, suspensionNumber); //   ,       super.visitFieldInsn(Opcodes.PUTFIELD, myClassJvmName, "label$S$S", "I"); //     label$S$S saveFrame(); //    suspend(); super.visitLabel(labels[suspensionNumber - 1]); // ,     restoreFrame(); //    suspensionNumber++; } } private void suspend() { super.visitFieldInsn(Opcodes.GETSTATIC, "microutine/core/Continuation", "SUSPEND", "Ljava/lang/Object;"); //    Continuation.SUSPEND super.visitInsn(Opcodes.ARETURN); //   }</span></span></code> </pre> <br><h3 id="testy">  рдкрд░реАрдХреНрд╖рдг </h3><br><p>  рд╣рдо рдПрдХ рдЬрдирд░реЗрдЯрд░ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рддреАрди рдирдВрдмрд░ рджреЗрддрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">testIntSequence</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YieldTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testIntSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Sequence&lt;Integer&gt; sequence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sequence&lt;Integer&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SequenceSuspendable&lt;Integer&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceScope&lt;Integer&gt; scope)</span></span></span><span class="hljs-function"> </span></span>{ scope.yield(<span class="hljs-number"><span class="hljs-number">10</span></span>); scope.yield(<span class="hljs-number"><span class="hljs-number">20</span></span>); scope.yield(<span class="hljs-number"><span class="hljs-number">30</span></span>); } }); List&lt;Integer&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Integer integer : sequence) { list.add(integer); } assertEquals(<span class="hljs-number"><span class="hljs-number">10</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); assertEquals(<span class="hljs-number"><span class="hljs-number">20</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) list.get(<span class="hljs-number"><span class="hljs-number">1</span></span>)); assertEquals(<span class="hljs-number"><span class="hljs-number">30</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) list.get(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } }</code> </pre> </div></div><br><p>  рдкрд░реАрдХреНрд╖рдг рд╕реНрд╡рдпрдВ рдХреБрдЫ рднреА рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд░реНрдЧ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╡рд┐рдШрдЯрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рджрд┐рд▓рдЪрд╕реНрдк рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">testIntSequence рд╡рд┐рдШрдЯрд┐рдд</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YieldTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YieldTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testIntSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NamelessClass_1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SequenceSuspendable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Continuation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SequenceScope scope$S; NamelessClass_1() { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object var1)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> label = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S; SequenceScope var2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContinuationEndException(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.yield(<span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S = var2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Continuation.SUSPEND; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.yield(<span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S = var2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Continuation.SUSPEND; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.yield(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S = var2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Continuation.SUSPEND; } } } Sequence&lt;Integer&gt; sequence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sequence(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NamelessClass_1()); List&lt;Integer&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); Iterator var3 = sequence.iterator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(var3.hasNext()) { Integer integer = (Integer)var3.next(); list.add(integer); } Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">10L</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(Integer)list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">20L</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(Integer)list.get(<span class="hljs-number"><span class="hljs-number">1</span></span>)); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">30L</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(Integer)list.get(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } }</code> </pre> </div></div><br><p>  рдХреЛрдб рдмрд╣реБрдд рдлреВрд▓рд╛ рд╣реБрдЖ рд╣реИ, рдЕрдзрд┐рдХрд╛рдВрд╢ рдирд┐рд░реНрджреЗрд╢ рд╕реНрдЯреИрдХ рдлреНрд░реЗрдо (рд╕реНрдерд╛рдиреАрдп рдЪрд░) рдХреЛ рд╕рд╣реЗрдЬ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдЖрд▓рд╕реА рдкреАрдврд╝реА рдХреЗ рдмрд┐рдирд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред  рдЖрдЗрдП рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкрд░ рдЕрдзрд┐рдХ рдХрдард┐рди рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред </p><br><div class="spoiler">  <b class="spoiler_title">рдлрд┐рдмреЛрдиреИрдХреА</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YieldTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacci</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Sequence&lt;Integer&gt; sequence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sequence&lt;&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Suspendable&lt;Integer&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceScope&lt;Integer&gt; scope)</span></span></span><span class="hljs-function"> </span></span>{ scope.yield(<span class="hljs-number"><span class="hljs-number">1</span></span>); scope.yield(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { b += a; scope.yield(b); a += b; scope.yield(a); } } }); <span class="hljs-comment"><span class="hljs-comment">//noinspection OptionalGetWithoutIsPresent Integer tenthFibonacci = StreamSupport.stream(sequence.spliterator(), false) .skip(9).findFirst().get(); assertEquals(55, ((int) tenthFibonacci)); } }</span></span></code> </pre> </div></div><br><p>  рдЙрдкрд░реЛрдХреНрдд рдХреЛрдб рдПрдХ рдЕрдирдВрдд рдлрд╛рдЗрдмреЛрдиреИрдЪрд┐ рдЕрдиреБрдХреНрд░рдо рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред  рд╣рдо рд╕рдВрдХрд▓рди рдФрд░ рд╡рд┐рдШрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рд░рд┐рдЯреНрд░реЗрд╕рдореЗрдВрдЯ рд╡рд┐рдШрдЯрд┐рдд рд╣реЛ рдЧрдпрд╛</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YieldTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YieldTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fibonacci</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NamelessClass_1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SequenceSuspendable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Continuation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SequenceScope scope$S; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> aa$S; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ba$S; NamelessClass_1() { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object var1)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> label = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S; SequenceScope var2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> var3; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> var4; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label == <span class="hljs-number"><span class="hljs-number">3</span></span>) { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; var3 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aa$S; var4 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ba$S; var3 += var4; var2.yield(var3); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S = var2; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aa$S = var3; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ba$S = var4; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Continuation.SUSPEND; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (label != <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContinuationEndException(); } var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; var3 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aa$S; var4 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ba$S; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; var3 = <span class="hljs-number"><span class="hljs-number">1</span></span>; var4 = <span class="hljs-number"><span class="hljs-number">1</span></span>; } var4 += var3; var2.yield(var4); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S = var2; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aa$S = var3; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ba$S = var4; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Continuation.SUSPEND; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; var2.yield(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S = var2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Continuation.SUSPEND; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S; var2.yield(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label$S$S = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope$S = var2; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Continuation.SUSPEND; } } } Sequence&lt;Integer&gt; sequence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sequence(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NamelessClass_1()); Integer tenthFibonacci = (Integer)StreamSupport.stream(sequence.spliterator(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>).skip(<span class="hljs-number"><span class="hljs-number">9L</span></span>).findFirst().get(); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">55L</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)tenthFibonacci); } }</code> </pre> </div></div><br><p>  рд╕рдордЭ рдХреНрдпрд╛ рдПрдХ рд╡рд┐рдШрдЯрд┐рдд рд╡рд░реНрдЧ рдХреЛ рдХрд╛рдлреА рдореБрд╢реНрдХрд┐рд▓ рдмрдирд╛рддрд╛ рд╣реИред  рдкрд┐рдЫрд▓реА рдмрд╛рд░ рдХреА рддрд░рд╣, рдЕрдзрд┐рдХрд╛рдВрд╢ рдирд┐рд░реНрджреЗрд╢ рд╡рд╣рд╛рдВ рд╕реНрдерд╛рдиреАрдп рдЪрд░ рдЪрд▓рд╛рддреЗ рд╣реИрдВред  рдХреБрдЫ рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдмреЗрдХрд╛рд░ рд╣реИрдВ, рдФрд░ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ рддреБрд░рдВрдд рдЕрдиреНрдп рдорд╛рдиреЛрдВ рд╕реЗ рдЕрд▓рдЧ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред         ,      . </p><br><p>          while,      .     .        .              ,     ''  <code>return SUSPEND</code> . </p><br><h3 id="rezyume">  рд╕рд╛рд░рд╛рдВрд╢ </h3><br><p> ,   ,   ,   .        yield.           ,   ,      тАФ ,   .      ,    (    )   .  ,   JIT     .  <code>yield</code>   <code>yieldAll</code> тАФ ,       ,        ,             ,    .        ,      ,    . </p><br><p>      тАФ  тАФ   ,     .         ,         .  ,          :       ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi480888/">https://habr.com/ru/post/hi480888/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi480874/index.html">рдиреНрдпреВрдЯреНрд░рд┐рдиреЛ рдХреЗ рдЕрдзреНрдпрдпрди рд╕реЗ рдЧрдгрд┐рдд рдореЗрдВ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдЦреЛрдЬ рд╣реБрдИ</a></li>
<li><a href="../hi480876/index.html">рд╣рдо рдбреЙрдХ рдХреЛ рд╕рд╛рдл рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдПрдХреНрд╕рдХреЛрдб рдХреЗ рдмрд┐рдирд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi480878/index.html">рдПрдВрдбреНрд░реЙрдпрдбред рд╕рддрд╣</a></li>
<li><a href="../hi480884/index.html">5 рдорд┐рдирдЯ рдореЗрдВ рдкрд╛рдпрдерди рдЬреАрдпреВрдЖрдИ</a></li>
<li><a href="../hi480886/index.html">рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдФрд░ рд╕реБрдирд╣рд░рд╛ рдЕрдиреБрдкрд╛рдд: рджреВрд╕рд░рд╛ рд░рди</a></li>
<li><a href="../hi480890/index.html">рдПрдХреНрд╕рдкреНрд░реЗрд╕ рдкреИрдирд▓ рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рд╕рд░реНрд╡реЗрдХреНрд╖рдг рдХреЗ рдкрд░рд┐рдгрд╛рдо</a></li>
<li><a href="../hi480892/index.html">рдЧреБрдмреНрдмрд╛рд░рд╛ рдЗрдВрдЯрд░рдиреЗрдЯ</a></li>
<li><a href="../hi480900/index.html">рдореЗрд░реЗ рдмрдЪреНрдЪреЗ рдХреЛ рд╡рд╛рдкрд╕ рд▓рд╛рдУ! (рдПрди.рдПрдл- рдХрд╣рд╛рдиреА)</a></li>
<li><a href="../hi480902/index.html">рдирдИ Postgres_exporter PostgreSQL рдирд┐рдЧрд░рд╛рдиреА рд╕реБрд╡рд┐рдзрд╛рдПрдБ</a></li>
<li><a href="../hi480904/index.html">PHP рдорд┐рдХреНрд░реЛрд╕реЗрд░рд╡рд░реНрдХ рдлреНрд░реЗрдорд╡рд░реНрдХ: рд╕реНрд╡рд┐рдлреНрдЯ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╛рд╕ рдкрд░реНрдпрд╛рд╡рд░рдг</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>