<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§î ‚öñÔ∏è üññüèø Comment j'ai fait un tracker de stationnement pour les gens ‚úçüèº üò™ üí¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, j'ai encore serr√©. J'habite en Europe, et ici, au lieu d'amendes pour mauvais stationnement et de remorqueurs ¬´clamper¬ª, ils encha√Ænent la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai fait un tracker de stationnement pour les gens</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464451/">  R√©cemment, j'ai encore serr√©.  J'habite en Europe, et ici, au lieu d'amendes pour mauvais stationnement et de remorqueurs ¬´clamper¬ª, ils encha√Ænent la roue de votre voiture.  Pour sortir, vous devez t√©l√©phoner, payer une somme ronde et attendre que le gars avec les cl√©s l√®ve la cha√Æne.  Il est long, humiliant et parfois (selon la r√©gion) pr√©dateur cher. <br><br>  Ce jour-l√†, j'√©tais en retard partout.  En attendant que le travailleur sonne avec les cl√©s, je me suis demand√© √† quel point j'√©tais stupide.  J'ai couru, j'ai laiss√© la voiture pendant une demi-heure au lieu du maximum de 20 minutes gratuites - exactement √† la 21e minute et je me suis fait prendre.  Malchanceux, la camionnette ray√©e du parking n'√©tait pas loin et ils ont imm√©diatement r√©agi.  Ils m'attrapaient avant, pour diverses raisons: j'ai oubli√©, le terme pay√© expirait, et parfois je n'arrivais pas √† trouver ma voiture dans le d√©dale des rues. <br><br>  ¬´Il doit y avoir une application pour tout¬ª, ai-je pens√©, et j'ai commenc√© √† me plonger dans l'App Store.  Apr√®s un tas de r√©sultats douteux, ma confiance a diminu√© et j'ai d√©cid√© de clarifier: "il doit y avoir une application Android pour tout."  Puis il a trouv√© son huavei et est mont√© dans les entrailles du magasin de jeux.  √Ä partir de l√†, plus de d√©bris se sont r√©pandus sur moi et, noy√© dans un artisanat maladroit, j'ai crach√©.  Soit je me trompe, soit il n'y a pas de syst√®me de suivi de stationnement pratique et compr√©hensible.  La conclusion est simple: si nous n‚Äôavons pas quelque chose, faisons-le nous-m√™mes. <br><br>  Dans ce contexte, je voyais d√©j√† une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">construction √† long terme</a> , ce qui me prenait presque tout mon temps libre.  J'ai d√©cid√© de faire une pause et dans l'intervalle de collecter une autre projection.  Ayant estim√© la fonctionnalit√© souhait√©e, j‚Äôai imagin√© une p√©riode d‚Äôun mois et demi et, pour l‚Äôavenir, je dirai que, en principe, cela s‚Äôest av√©r√© encore plus rapide.  Le r√©sultat a √©t√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">application</a> compacte et propre sur les deux plates-formes, tr√®s pratique.  Maintenant, je l'utilise moi-m√™me et je vous sugg√®re de l'essayer. <br><br><img src="https://habrastorage.org/webt/2w/wl/zl/2wwlzlz-6vimwsq9dt2xmyv-bqk.png" alt="image" width="800"><br><a name="habracut"></a><br><h3>  Id√©e </h3><br>  Alors qu'est-ce que je voudrais d'un tracker de stationnement?  Qu'est-ce que je manque toujours quand je re√ßois une amende  Apr√®s r√©flexion, j'ai formul√© l'introduction suivante: <br><br><ol><li>  C'est simple.  Id√©alement, un bouton.  Un minimum de fonctions distrayantes: pas de profils, historique de stationnement, prise en charge de plusieurs voitures en m√™me temps, etc. </li><li>  Avec notifications.  Je n'oublierais pas la voiture, si l'application me le rappelait: fr√®re, tu as un parking l√†-bas en passant, et il est sur le point d'expirer. </li><li>  Consid√©rez le temps de marche.  C'est la pens√©e la plus simple que je n'ai jamais vu incarn√©e.  Je n'ai pas besoin de savoir que le parking expirera dans 5 minutes si je suis √† une demi-heure de l√†.  Je dois √™tre rappel√© afin que je puisse <b>arriver</b> √† la voiture quelques minutes avant la fin et partir. </li><li>  Itin√©raire et navigation vers le parking.  Navigation, bien s√ªr, via Google ou Apple Maps, mais l'itin√©raire peut √™tre affich√© dans votre application.  Cela vous aidera si vous avez laiss√© la voiture dans une zone inconnue, que le chronom√®tre sonne et que vous courez en rond dans les m√™mes rues. </li></ol><br>  J'ai choisi Flutter comme base technologique, car je travaille avec lui depuis un certain temps et le consid√®re comme bon.  Pour les itin√©raires, j'ai d√©cid√© d'utiliser l'API HERE, non pas pour la premi√®re fois, mais pour la carte - Mapbox.  J'ai esquiss√© plusieurs options pour l'interface, choisi la plus minimaliste et me suis impliqu√© dans le travail. <br><br><h3>  D√©veloppement </h3><br>  En principe, il n'y a pas grand-chose √† dire sur le processus de d√©veloppement lui-m√™me.  Il n'y a pas de partie serveur ici, le client le plus simple, qui consiste essentiellement en une grande vue dans diff√©rents √©tats.  Sur la premi√®re page, vous s√©lectionnez un pr√©r√©glage - 1, 2, 4, 6 heures - ou utilisez le curseur pour r√©gler votre p√©riode de stationnement.  Apr√®s l'avoir essay√© en direct, j'ai r√©alis√© que le curseur √©tait assez grossier et y ai ajout√© les boutons "+" et "-".  Une nuance amusante et plut√¥t non √©vidente ici √©tait que pendant que vous choisissez, le temps passe.  Vous devez donc mettre √† jour cette vue en temps r√©el.  Apr√®s avoir choisi le terme, cliquez sur le seul bouton ci-dessous et les donn√©es de lieu et d'heure sont enregistr√©es et le stationnement commence.  Il est important de noter que je stocke essentiellement toutes les donn√©es √† bord, rien n'est transf√©r√© sur aucun serveur.  √Ä l'avenir, cela me cr√©era d'ailleurs des difficult√©s, mais j'y reviendrai plus tard. <br><br>  La deuxi√®me page est, en fait, la minuterie de stationnement.  J'ai essay√© un tas d'options ici: j'ai commenc√© avec des prototypes d'informations extr√™mement surcharg√©s, puis je me suis d√©barrass√© it√©rativement et simplifi√© √† la limite.  Je voulais vraiment que l'√©tat du stationnement soit affich√© visuellement, plut√¥t que des chiffres secs, donc l'√©l√©ment principal de cette page avec la carte √©tait un graphique en anneau.  Il montre le temps √©coul√©, le temps de marche et le temps restant.  Si vous n'√™tes pas pr√®s de la voiture et que le temps de marche n'est pas nul, un bouton de d√©marrage de la navigation appara√Æt et la carte indique un itin√©raire approximatif vers le parking.  En fait, c'est tout. <br><br>  Malgr√© la simplicit√© visuelle, cet √©cran m'a presque √©bouriff√© les nerfs.  Il faut comprendre que pendant que le stationnement est actif, un certain nombre de processus se produisent simultan√©ment: <br><br><ul><li>  le temps passe et la minuterie s'√©puise </li><li>  vous vous d√©placez et changez de temps </li></ul><br>  Tout cela se passe en temps r√©el et devrait √™tre affich√© instantan√©ment sur l'interface.  La carte doit √™tre reconstruite en douceur, la carte doit se d√©placer et redessiner l'itin√©raire, s'il y a un risque de retard ou d'expiration du stationnement, l'avertissement correspondant devrait √©galement appara√Ætre.  De plus: lorsque vous fermez et ouvrez l'application, vous devez restaurer tout cela correctement.  Et enfin, l'effrayant: toutes les fonctionnalit√©s devraient pouvoir fonctionner en arri√®re-plan, car l'application passera la majeure partie de sa vie en arri√®re-plan.  De telles choses. <br><br>  Je ne d√©crirai pas la mise en ≈ìuvre en d√©tail, je peux seulement dire que le travail de flottement avec les √©tats est tr√®s digne.  Alors que dans un pur andro√Øde, un design orient√© objet surcharg√© se r√©v√©lerait, il s'est av√©r√© simple et √©l√©gant.  Des √©tats compr√©hensibles normaux, une liaison sensible des vues aux mod√®les - dans des t√¢ches comme celle-ci, le scintillement brille.  Cependant, ce n'√©tait pas sans jambages typiques: par exemple, la biblioth√®que locale de travail avec des cartes n'a pas de transition anim√©e vers de nouvelles coordonn√©es.  J'ai d√ª entrer dans son code, sortir quelques m√©thodes priv√©es et ajouter ma b√©quille.  Il est possible que cette fonctionnalit√© soit ajout√©e bient√¥t, mais c'est tout le flottement - avec toute son attractivit√©, pr√©parez-vous √† de telles d√©couvertes. <br><br>  Tout le reste semblait fonctionner sans probl√®me.  En fait, il n'y avait pas grand-chose d'autre: quelques dialogues et une page d'introduction pour laquelle ma copine (elle √©tait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">artiste</a> ) a dessin√© de belles animations.  Enfin, j'ai traduit l'int√©gralit√© de l'application en russe, y compris la carte.  Mais la douleur a commenc√©: les notifications. <br><br><h3>  Notifications </h3><br>  Pour moi, la possibilit√© d'envoyer des notifications intelligentes √©tait la cl√© de l'application - sans elle, il n'y a rien √† faire.  Cependant, quand j'ai commenc√© √† travailler sur cette fonctionnalit√©, j'ai r√©alis√© que j'avais march√© sur mon propre pied.  Il y avait en fait deux probl√®mes.  Le premier est le flutter, qui ne sait pas comment travailler avec les appareils api de bas niveau: vous devez √©crire un joint sous la forme d'un plug-in qui contient deux codes natifs et une abstraction sur la fl√©chette.  Le deuxi√®me probl√®me est ma position fondamentale selon laquelle tout doit √™tre effectu√© √† bord.  Donc, nous r√©sumons ce qui est n√©cessaire.  Il est n√©cessaire que l'application <b>en arri√®re-plan</b> : <br><br><ol><li>  Surveiller en permanence votre g√©olocalisation, </li><li>  V√©rifi√© combien de minutes √† pied du parking </li><li>  V√©rifi√© avec expiration du minuteur </li><li>  S'il y a un risque de ne pas avoir le temps de revenir, un coup de notification </li></ol><br>  Ressentez-vous l'ampleur de la trag√©die?  Il est clair qu'il n'y a aucune capacit√© technique √† le faire si l'application est compl√®tement supprim√©e.  Mais supposons qu'il soit simplement minimis√© et que l'√©cran soit √©teint.  ICI api me donne l'itin√©raire et l'estimation du temps de marche, cela signifie-t-il que l'application spammera les requ√™tes en arri√®re-plan?  Quelle quantit√© de code sera ex√©cut√©e?  Comment en sommes-nous avec la m√©moire et la consommation d'√©nergie? <br><br>  Je me suis assis pour r√©fl√©chir.  Commenc√© par un petit: techniquement, flutter a r√©cemment eu la possibilit√© d'ex√©cuter du code en arri√®re-plan, il s'appelle isoler.  Si tout est √©crit correctement, vous pouvez cr√©er une logique d'une mani√®re sp√©cifique afin que tout ne s'ex√©cute pas en arri√®re-plan, mais certaines fonctionnalit√©s sp√©cifiques.  En effet, en mode minimis√©, nous n'avons pas besoin de dessiner d'interfaces ou de mettre √† jour des √©tats - nous nous int√©ressons √† la logique du calcul du temps, et cette logique est assez compacte et bon march√©.  En m√™me temps, cela ne devrait pas √™tre d√©clench√© par un changement de g√©olocalisation, comme je l'avais fait dans la version d'origine, mais par un minuteur interne.  Parce que la notification devrait voler, m√™me si vous ne bougez pas, mais restez assis. <br><br>  Eh bien, nous avons √©crit un code l√©ger qui peut s'ex√©cuter en arri√®re-plan et est contr√¥l√© par une minuterie.  Comment le d√©clencher dans le cadre d'applications natives et y transmettre des donn√©es de g√©olocalisation?  Cela s'est av√©r√© diff√©remment. <br><br>  La logique de l'andro√Øde et de l'iPhone en mati√®re d'ex√©cution de code en arri√®re-plan est radicalement diff√©rente.  Pour un iPhone, il est absent en tant que tel: le code d'arri√®re-plan ne peut d√©clencher qu'un √©v√©nement syst√®me d'un certain type, par exemple, la lecture de streaming audio ou, heureusement pour moi, la mise √† jour de l'emplacement.  Pour ce faire, il suffit de demander des autorisations et, dans la partie native du plug-in Flater, de vous abonner √† l'√©v√©nement.  De l√†, via un canal de communication sp√©cifique (MethodChannel), nous appelons le rappel dans une fl√©chette, lui transmettons les g√©odonn√©es et commen√ßons l'arri√®re-plan avec la logique dont nous avons besoin.  La beaut√© <br><br>  Android fonctionne diff√©remment.  Techniquement, il a la possibilit√© d'ex√©cuter du code en arri√®re-plan sans √™tre li√© aux √©v√©nements syst√®me - pour cela, vous devez d√©crire le service.  Il se bloque s√©par√©ment de l'application, soit compl√®tement en arri√®re-plan, soit sur le pardon (l√†, il se fait sentir par un message joint en aveugle).  Il semblerait que le probl√®me soit r√©solu: dans la partie native du plugin, nous d√©crivons un service en arri√®re-plan qui suit l'emplacement et extrait le code Dark.  Cependant, il y a une nuance.  Depuis Android version 8.0, l'attitude envers de tels services a chang√©: maintenant, si l'application est minimis√©e pour le moment, ses services d'arri√®re-plan sont terriblement coup√©s par l'axe afin d'√©conomiser de l'√©nergie.  Et, si votre code effectue, par exemple, la sauvegarde de donn√©es, alors en principe, vous ne vous souciez pas du moment exact o√π l'axe le laissera fonctionner - l'essentiel est qu'il fonctionne.  Mais dans mon cas, nous devons suivre le changement de lieu en temps quasi r√©el, et le timing est essentiel ici.  Par cons√©quent, la seule solution consiste √† d√©marrer le service par erreur.  Nous d√©crivons une petite notification attach√©e dans le rideau, abonnez-vous √† l'emplacement, envoyez-la √† la fl√©chette via le MethodChannel.  Tout semble fonctionner. <br><br>  Soit dit en passant, revenons aux probl√®mes de m√©moire, de consommation d'√©nergie et de nombre de demandes - le code est ex√©cut√© lorsque l'emplacement est d√©cal√© de 50 m√®tres ou par minuterie.  De plus, il est lui-m√™me tr√®s l√©ger, et les demandes ne me traversent pas, mais vont directement √† l'api ICI.  Je ne re√ßois pas moi-m√™me de donn√©es et je ne les enregistre nulle part.  En g√©n√©ral, une telle impl√©mentation est tr√®s bien d√©crite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , c'est le blog de l'un des ing√©nieurs de flutter - le code y est joint.  Son exemple est quelque peu diff√©rent, mais l'approche g√©n√©rale est claire, je recommande donc de le lire. <br><br><h3>  R√©sultat </h3><br>  En fait, c'est tout.  Pendant un mois de temps libre, j'ai obtenu une application qui r√©sout parfaitement un probl√®me sp√©cifique.  J'esp√®re que cet article sera int√©ressant pour quelqu'un, et l'application vous √©vitera des amendes et du stress.  Vous pouvez regarder et gronder ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Android</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">iOS</a> . <br><br>  Merci √† tous pour votre attention. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464451/">https://habr.com/ru/post/fr464451/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464435/index.html">Comment ne pas se noyer dans un oc√©an de technologies et d'approches: l'exp√©rience de 50 experts</a></li>
<li><a href="../fr464437/index.html">Comment l'√©quipe de d√©veloppement peut gagner plus en cr√©ant des sites de trafic [Guide d'impl√©mentation]</a></li>
<li><a href="../fr464443/index.html">Natas Web. Passage de la plateforme CTF visant √† exploiter les vuln√©rabilit√©s du Web. 2e partie</a></li>
<li><a href="../fr464445/index.html">Pourquoi il est vraiment impossible d'√™tre v√©g√©tarien</a></li>
<li><a href="../fr464447/index.html">Count Scoring de la Fer ou une √©tude sur la notation du cr√©dit dans le cadre de l'√©largissement de ses horizons. Partie 1</a></li>
<li><a href="../fr464453/index.html">Huskies: retirer, laisser, remplacer? Quoi?</a></li>
<li><a href="../fr464457/index.html">22 sites pour un programmeur pour vous aider √† parler anglais</a></li>
<li><a href="../fr464459/index.html">Quatre r√®gles d'UX intuitives</a></li>
<li><a href="../fr464463/index.html">Cha√Æne de r√©pondeurs iOS ou ce qu'ils demandent lors de l'entretien</a></li>
<li><a href="../fr464465/index.html">Comment et pourquoi avons-nous migr√© Preply vers Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>