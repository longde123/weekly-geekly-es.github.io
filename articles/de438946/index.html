<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💃🏽 🚀 🤜🏾 DateTimeOffset (streng) 👨🏻‍🌾 📶 🌷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Heute morgen ist mein Freund Kirillkos auf ein Problem gestoßen . 
 Problemcode 


 Hier ist sein Code: 


class Event { public string Message {get;se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DateTimeOffset (streng)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438946/"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Heute</a> morgen ist mein Freund <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Kirillkos</a> auf ein Problem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">gestoßen</a> . </p><br><h2 id="problemnyy-kod">  Problemcode </h2><br><p>  Hier ist sein Code: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} } <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IEventProvider</span></span> { <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><p>  Und dann viele, viele Implementierungen von <code>IEventProvider</code> , die Daten aus verschiedenen Tabellen und Datenbanken <code>IEventProvider</code> . </p><br><p>  <strong>Problem</strong> : In all diesen Basen befindet sich alles in verschiedenen Zeitzonen.  Dementsprechend ist beim Versuch, Ereignisse auf der Benutzeroberfläche auszugeben, alles furchtbar verwirrt. </p><br><p>  Ehre sei Halesberg, wir haben Typen, mögen sie uns retten! </p><a name="habracut"></a><br><h2 id="popytka-1">  Versuch 1 </h2><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTimeOffset EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  <code>DateTimeOffset</code> großartiger Typ, der Offset-Informationen zu UTC speichert.  Es wird perfekt von MS SQL und Entity Framework unterstützt (und in Version 6.3 wird es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">noch besser unterstützt</a> ).  In unserem Codestil ist dies für jeden neuen Code obligatorisch. </p><br><p>  Jetzt können wir Informationen von denselben Anbietern sammeln und unter Verwendung von Typen konsistent alles auf der Benutzeroberfläche anzeigen.  Sieg! </p><br><p>  <strong>Problem</strong> : <code>DateTimeOffset</code> kann <em>implizit</em> von <code>DateTime</code> konvertieren. <br>  Der folgende Code wird gut kompiliert: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTimeOffset EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event() {EventTime = DateTime.Now, Message = <span class="hljs-string"><span class="hljs-string">"Hello from unknown time!"</span></span>}, }; }</code> </pre> <br><p>  Dies liegt daran, dass für <code>DateTimeOffset</code> ein impliziter Casting-Operator definiert ist: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Local and Unspecified are both treated as Local public static implicit operator DateTimeOffset (DateTime dateTime);</span></span></code> </pre> <br><p>  Das brauchen wir überhaupt nicht.  Wir wollten nur, dass der Programmierer beim Schreiben des Codes denkt: "Aber in welcher eigenen Zeitzone ist dieses Ereignis passiert?"  Woher bekommt man die Zone? "  Oft aus ganz anderen Bereichen, manchmal aus verwandten Tabellen.  Und dann einen Fehler zu machen, <em>ohne</em> sehr leicht <em>nachzudenken</em> . </p><br><p>  Verdammt implizite Konvertierungen! </p><br><h2 id="popytka-2">  Versuch 2 </h2><br><p>  Da habe ich davon gehört <del>  ein Hammer </del>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">statische Analysatoren</a> , alles scheint mir <del>  Nägel </del>  geeignete Fälle für sie.  Wir müssen einen statischen Analysator schreiben, der diese implizite Konvertierung verbietet und erklärt, warum ... Es sieht nach viel Arbeit aus.  Auf jeden Fall ist es Aufgabe des Compilers, die Typen zu überprüfen.  Setzen Sie diese Idee vorerst als ausführlich ein. </p><br><h2 id="popytka-3">  Versuch 3 </h2><br><p>  Nun, wenn wir in der Welt von F # wären, sagte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Kirillkos</a> . <br>  Wir würden dann: </p><br><pre> <code class="plaintext hljs">type DateTimeOffsetStrict = Value of DateTimeOffset</code> </pre> <br><p>  Und weiter <del>  kam nicht mit Improvisation </del>  Eine Art Magie würde uns retten.  Schade, dass sie in unserem Büro kein F # schreiben und wir Kirillkos auch nicht wirklich kennen :-) </p><br><h2 id="popytka-4">  Versuch 4 </h2><br><p>  Kann in C # nichts getan werden?  Es ist möglich, aber Sie werden gequält, indem Sie hin und her konvertieren.  Hören Sie auf, aber wir haben gerade gesehen, wie Sie implizite Conversions durchführen können! </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Same as </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="DateTimeOffset"/&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> but w/o implicit conversion from </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="DateTime"/&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public readonly struct DateTimeOffsetStrict { private DateTimeOffset Internal { get; } private DateTimeOffsetStrict(DateTimeOffset @internal) { Internal = @internal; } public static implicit operator DateTimeOffsetStrict(DateTimeOffset dto) =&gt; new DateTimeOffsetStrict(dto); public static implicit operator DateTimeOffset(DateTimeOffsetStrict strict) =&gt; strict.Internal; }</span></span></code> </pre> <br><p>  Das Interessanteste an diesem Typ ist, dass er implizit von <code>DateTimeOffset</code> hin und her <code>DateTimeOffset</code> wird. Ein Versuch, ihn implizit von <code>DateTime</code> zu konvertieren, <code>DateTime</code> jedoch zu einem Kompilierungsfehler. Konvertierungen von DateTime sind nur explizit möglich.  Der Compiler kann die "Kette" impliziter Konvertierungen nicht aufrufen. Wenn sie in unserem Code definiert sind, ist dies durch den Standard verboten ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zitat aus SO</a> ).  Das heißt, es funktioniert so: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTimeOffsetStrict EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event() {EventTime = DateTimeOffset.Now, Message = <span class="hljs-string"><span class="hljs-string">"Hello from unknown time!"</span></span>}, }; }</code> </pre> <br><p>  aber nicht so: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event() {EventTime = DateTime.Now, Message = <span class="hljs-string"><span class="hljs-string">"Hello from unknown time!"</span></span>}, }; }</code> </pre> <br><p>  Was wir brauchten! </p><br><h2 id="itog">  Zusammenfassung </h2><br><p>  Wir wissen noch nicht, ob wir es umsetzen werden.  Nur jeder war an DateTimeOffset gewöhnt, und jetzt ist es dumm, es durch <em>unseren</em> Typ zu ersetzen.  Ja, und auf der Ebene der EF-, ASP.NET-Parameterbindung und an tausend Stellen treten mit Sicherheit Probleme auf.  Aber die Lösung selbst scheint mir interessant zu sein.  Ich habe ähnliche Tricks verwendet, um die Sicherheit von Benutzereingaben zu überwachen. Ich habe den Typ <code>UnsafeHtml</code> , der implizit <em>aus einer</em> Zeichenfolge konvertiert wird. Sie können ihn jedoch nur durch Aufrufen von <code>IHtmlString</code> in eine Zeichenfolge oder einen <code>IHtmlString</code> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438946/">https://habr.com/ru/post/de438946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438932/index.html">Mustererkennung in der Aidetic Artificial Intelligence</a></li>
<li><a href="../de438934/index.html">Erstellen und konfigurieren Sie den portablen Build von Jupyter Notebook and Lab unter Windows. Teil 1</a></li>
<li><a href="../de438936/index.html">BotMan Bekanntschaft</a></li>
<li><a href="../de438940/index.html">Offener Kurs „Deep Learning an den Fingern“</a></li>
<li><a href="../de438942/index.html">2D-Schatten auf signierten Distanzfeldern</a></li>
<li><a href="../de438948/index.html">Warum brauchen wir eine Optimierung auf niedriger Ebene für Elbrus oder wie können wir das Erkennungssystem eineinhalb Mal beschleunigen?</a></li>
<li><a href="../de438950/index.html">Die Zentralbank startete einen Roboter, um im Internet nach Verdienstmöglichkeiten zu suchen</a></li>
<li><a href="../de438952/index.html">Was Sie lernen können, wenn Sie einen Audio-Player für verschiedene Browser entwickeln</a></li>
<li><a href="../de438954/index.html">Vorzeichenbehaftete Distanzfelder in 2D kombinieren</a></li>
<li><a href="../de438956/index.html">Magnetitis in den Zähnen: Sequenzierung der Transkriptome des Gewebes der Muschel-Mollusken-Radula</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>