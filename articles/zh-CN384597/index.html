<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙎🏽 👪 👃🏽 电量测量。第1部分。电压和电流测量 🤷🏾 📸 👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="介绍
 大家好！在传感器的周期结束后，有人提出了不同的计划来测量家用而非非常电器的消耗参数。谁消耗了多少，如何连接要测量的东西，发生了什么细微变化等等。现在是时候揭示该区域中的所有卡片。
 在本系列文章中，我们将考虑测量电参数的主题。这些参数实际上是一个非常大的数字，我将尝试以小系列逐步介绍。
 到...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>电量测量。第1部分。电压和电流测量</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384597/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/files/4df/1f8/1cd/4df1f81cd86c4e2a8f5afa1441fb88e5.jpg" alt="图片" align="left"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍</font></font></b></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大家好！</font><font style="vertical-align: inherit;">在传感器的周期结束后，有人提出了不同的计划来测量家用而非非常电器的消耗参数。</font><font style="vertical-align: inherit;">谁消耗了多少，如何连接要测量的东西，发生了什么细微变化等等。</font><font style="vertical-align: inherit;">现在是时候揭示该区域中的所有卡片。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本系列文章中，我们将考虑测量电参数的主题。</font><font style="vertical-align: inherit;">这些参数实际上是一个非常大的数字，我将尝试以小系列逐步介绍。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
到目前为止，该计划是三个系列：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电量测量。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电力质量。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 用于测量电参数的设备。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在分析过程中，我们将解决微控制器上的某些实际问题，直到获得结果为止。</font><font style="vertical-align: inherit;">当然，此周期的大部分时间将用于测量AC电压，并且对所有风扇控制其智能家居的电气设备很有用。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据整个周期的结果，我们将制造一种具有互联网访问权限的智能电表。</font><font style="vertical-align: inherit;">非常臭名昭著的风扇可以控制其智能家居的电气设备，例如在MajorDomo的基础上，可以为通信部分的实施提供所有可能的帮助。</font><font style="vertical-align: inherit;">可以这么说，让我们使OpenSource成为一个更好的智能家居。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本系列的两部分中，我们将讨论以下问题：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DC设备以及单相和三相AC电路中的电流和电压传感器的连接；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测量电流和电压的电流值;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功率因数测量；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满功率，有功功率和无功功率；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能量消耗;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过解决，您将找到此列表中前两个问题的答案。</font><font style="vertical-align: inherit;">我故意不涉及测量指标准确性的问题，从本系列中，我仅对使用正负韧皮鞋的准确性所获得的结果感到满意。</font><font style="vertical-align: inherit;">我肯定会在第三系列中专门针对此问题撰写文章。</font></font><br>
<a name="habracut"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.传感器连接</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://www.youtube.com/embed/ueE-XPjVkRY%3Ffeature%3Doembed&amp;usg=ALkJrhjnsksgm3LaxMzqy9cE6_qiPm6Z4A" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在上一个有关电压和电流传感器的系列文章中，我讨论了传感器的类型，但没有讨论如何使用它们以及将它们放置在何处。</font><font style="vertical-align: inherit;">是时候修复它了</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接直流传感器</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
显然，整个周期将专门用于交流系统，但我们还将快速介绍一下直流电路，因为这对于我们开发直流电源非常有用。以一个经典的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM </font></font></a><font style="vertical-align: inherit;"></font><br>
<img src="https://habrastorage.org/files/d35/255/0f2/d352550f2c04401ea57bcda120ee3790.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">降压转换器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为例</font><font style="vertical-align: inherit;">：</font><i><font style="vertical-align: inherit;">图1. PWM降压转换器</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
我们的目标是提供稳定的输出电压。另外，基于来自电流传感器的信息，可以控制电感器L1的操作模式，防止其饱和，并且还可以实现转换器的电流保护。坦率地说，安装传感器没有特别的选择。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
电阻分压器R1-R2形式的电压传感器安装在转换器的输出处，这是唯一能够使用直流电的传感器。通常，专用的转换器微电路具有反馈输入，并会尽一切努力确保在此输入（3）上有微电路文档中规定的特定电压电平。例如1.25V。如果我们的输出电压与此水平相符-一切都很好-我们直接将输出电压施加到此输入。如果不是，则设置分频器。如果我们需要提供5V的输出电压，则分压器必须提供4的分压系数，即R1 = 30k，R2 = 10k。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常将电流传感器安装在电源和转换器之间以及芯片上。根据点1和点2之间的电势差以及已知的电阻，电阻器Rs可以确定电感器电流的电流值。在电源和负载之间安装电流传感器不是一个好主意，因为滤波电容器将被电阻器从脉冲电流消耗器处切断。在公共线的间隙中安装电阻器也无济于事-会有两个接地层，仍然很有趣。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用非接触式电流传感器（例如霍尔传感器）可以避免电压降的问题：</font></font><br>
<img src="https://habrastorage.org/files/90c/b6b/1e2/90cb6b1e298b4d408bd27d971218781e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图2.非接触式电流传感器</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，有一种更棘手的方法来测量电流。毕竟，晶体管上的电压也会下降，并且与之流过的电感相同的电流。因此，通过其两端的压降，您还可以确定电流的电流值。老实说，如果您查看转换器电路的内部结构（例如从Texas Instruments获得），则发现这种方法的频率与以前的方法相同。这种方法的准确性当然不是最高的，但这足以使当前的截止频率起作用。</font></font><br>
<img src="https://habrastorage.org/files/2fd/ecb/bab/2fdecbbab26c483ea476483e32e2a0c9.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图3.晶体管作为电流传感器我们</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在类似转换器的其他电路（升压或反相）中</font><i><font style="vertical-align: inherit;">也做</font></i><font style="vertical-align: inherit;">同样的</font><i><font style="vertical-align: inherit;">事情</font></i><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，有必要分别提及变压器线性和反激式转换器。</font></font><br>
<img src="https://habrastorage.org/files/1d7/ebd/4b1/1d7ebd4b13214a919014f35a8a672b24.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图4.反激式转换器中电流传感器的连接</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
它们也可以使用外部电阻或晶体管。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这样，我们将传感器连接到DC / DC转换器。</font><font style="vertical-align: inherit;">如果您对其他选项有建议，我会很乐意为他们添加文章。</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2将传感器连接到单相交流电路</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在交流电路中，我们有更多可能的传感器选择。</font><font style="vertical-align: inherit;">让我们考虑几个选项。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最简单的方法是使用电阻分压器和电流分流器。</font></font><br>
<img src="https://habrastorage.org/files/458/c52/e43/458c52e436ac451d96927f6d3a14d772.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图5.电阻传感器的连接</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
但是，她有两个明显的缺点：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们将提供来自电流分流器的信号的大幅值，在其上分配大量功率，或者我们将对信号的小幅值感到满意，然后对其进行放大。其次，电阻器会在网络中性点和设备中性点之间产生电势差。如果该设备是隔离的，则没有关系，如果该设备具有接地端子，则由于没有连接电流传感器的信号，我们会冒着将其短路的风险。也许您应该尝试使用其他原理的传感器。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，我们使用电流和电压互感器，或者使用霍尔效应电流传感器和电压互感器。</font><font style="vertical-align: inherit;">在这里，由于中性线没有损耗，因此有更多使用设备的机会，而且最重要的是-在两种情况下，测量设备的电气隔离都非常有用。</font><font style="vertical-align: inherit;">但是，必须牢记，变压器电流和电压传感器的频率响应有限，如果我们要测量失真的谐波成分，那么就无法解决这一问题。</font></font><br>
<img src="https://habrastorage.org/files/b59/304/c28/b59304c2821d45ef87501f76acfa232a.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图6.变压器与非接触式电流和电压传感器的连接</font></font></i><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3将传感器连接到多相交流电路</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在多相网络中，我们连接电流传感器的能力稍差一些。这是因为根本无法使用电流分流器，因为分流器之间的电位差会在数百伏特内波动，而且我不知道任何通用控制器的模拟输入都能承受这种嘲笑。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，有一种使用电流分流器的方法-对于每个通道，必须进行电流隔离的模拟输入。但是使用其他传感器更容易，更可靠。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我的质量分析仪中，我使用电阻分压器和远程霍尔效应电流传感器。</font></font><br>
<img src="https://habrastorage.org/files/3e5/d90/547/3e5d90547af64b41a48bcfe42ee82429.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图7三相网络中的电流传感器</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从图中可以看出，我们使用四线连接。</font><font style="vertical-align: inherit;">当然，可以使用电流互感器或Rogowski回路代替霍尔效应上的电流传感器。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
代替电阻分压器，可以将变压器用于四线和三线系统。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在后一种情况下，变压器的初级绕组由三角形连接，而次级由星形连接，星形的公共点是测量电路的公共点。</font></font><br>
<img src="https://habrastorage.org/files/e4d/100/cf4/e4d100cf4d3048338dd15cacdb92a373.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图8.在三相网络中使用电压互感器</font></font></i><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2电压电流值</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://www.youtube.com/embed/TOaW9xvr8NE%3Ffeature%3Doembed&amp;usg=ALkJrhgdnv9ZZ4qdAd0Td9AbUhIQyywHXg" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在是解决测量信号问题的时候了。对我们来说，实际意义主要是电流和电压的电流值。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我提醒您传感器周期中的物料。定期使用微控制器的ADC，我们将固定瞬时电压值。因此，在测量期间，我们将获得一个瞬时电压值水平的数据数组（对于电流，一切都相似）。</font></font><br>
<img src="https://habrastorage.org/files/f70/ca7/063/f70ca706313a41a784c27c270cbd6eb2.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图9.一系列瞬时电压值</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
我们的任务是计算有效值。首先，我们使用积分公式：</font></font><br>
<img src="https://habrastorage.org/files/417/546/27d/41754627def647e89dce0c4037146eba.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在数字系统中，我们必须将自己限制在某个时间范围内，因此我们求和：</font></font><br>
<img src="https://habrastorage.org/files/17c/f0a/b23/17cf0ab2355a4a86a67504036f331c6b.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（2）</font><font style="vertical-align: inherit;">信号的采样周期</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里？</font></font><img src="https://habrastorage.org/files/c7c/ac5/dec/c7cac5dece7f4d03b262ad4c8ad30317.gif"><font style="vertical-align: inherit;"></font><img src="https://habrastorage.org/files/289/63f/958/28963f958bf74b1888aeef21b047c567.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-测量期间的样本数。在这里的某个地方，我通过视频开始摩擦有关区域平等的游戏。那天我不得不睡觉。 =）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在单相水银电表中使用的MSP430FE4252微控制器中，在1、2或4秒的测量周期内可获得4096个读数。在T = 1s和N = 4096时，我们将进一步依靠。此外，按照GOST的要求，每秒4096个点将使我们能够使用快速傅立叶变换算法来确定最多40个谐波的谐波频谱。但是在下一个系列中会更多地介绍这一点。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们为程序概述了算法。我们需要确保每1/8192秒ADC稳定启动一次，因为我们有两个通道，并且将交替测量此数据。为此，请配置定时器，然后中断信号将自动重启ADC。所有ADC都这样做。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将在arduino上编写未来的程序，因为许多程序都在手。到目前为止，我们仅具有学术兴趣。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
系统石英频率为16 MHz，并且具有8位定时器（这样看来生活就不那么美好了），我们需要确保任何定时器中断的工作频率为8192 Hz。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们为16 MHz未按需进行完全分频并且计时器的最终频率为8198 Hz感到遗憾。我们闭上眼睛，看到0.04％的误差，并且仍然每个通道读取4096个样本。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们很遗憾，arduino中的溢出中断正在忙于计算时间（它负责毫秒和延迟，因此它将停止正常工作），因此我们在比较中使用了该中断。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后我们突然意识到信号是双极性的，而msp430fe4252可以完美应对。我们对单极性ADC感到满意，因此，我们将一个双极性信号的简单转换器组装到运算放大器上的单极性ADC：</font></font><br>
<img src="https://habrastorage.org/files/18f/0dd/c20/18f0ddc202544b24be6d684ce9d98c23.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图10.将双极性信号转换为单极性的转换器</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
此外，我们的任务是确保正弦波相对于参考电压的一半进行振荡-然后我们将减去一半的范围或激活ADC设置中的选项并获得符号值。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arduino有一个10位ADC，因此我们从0-1023的无符号结果中减去一半，得到-512-511。我们</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查在LTSpiceIV中组装的模型，并确保一切正常。</font><font style="vertical-align: inherit;">在视频资料中，我们另外进行了实验验证。</font></font><br>
<img src="https://habrastorage.org/files/3de/320/1f6/3de3201f66f94937b29504236ded1044.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11.仿真结果。</font><font style="vertical-align: inherit;">绿色是原始信号，蓝色是输出</font></font></i><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于一个通道的Arduino草图</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{<font></font>
  autoadcsetup();<font></font>
  DDRD |=(<span class="hljs-number">1</span>&lt;&lt;PD2)|(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
  Serial.begin(<span class="hljs-number">38400</span>);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">double</span> urms = <span class="hljs-number">0</span>;
<span class="hljs-keyword">double</span> utemp = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> umoment = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> N = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> flag = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">if</span> (flag){<font></font>
    flag = <span class="hljs-number">0</span>;<font></font>
    Serial.println(urms);<font></font>
  }<font></font>
}<font></font>
<span class="hljs-keyword">int</span> i = <span class="hljs-number">255</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">autoadcsetup</span><span class="hljs-params">()</span></span>{
  <span class="hljs-comment">//set up TIMER0 to  4096Hz</span>
  <span class="hljs-comment">//TIMER0_OVF will be the trigger for ADC</span>
  <span class="hljs-comment">/*normal mode, prescaler 16
   16MHz / 64 / 61 = 4098 Hz 0.04% to 4096Hz*/</span>
  TCCR0B = (<span class="hljs-number">1</span> &lt;&lt; CS01)|(<span class="hljs-number">1</span> &lt;&lt; CS00);<span class="hljs-comment">//timer frequency = clk/64</span>
  OCR0A = <span class="hljs-number">60</span>;<span class="hljs-comment">//61-1</span>
  TIMSK0 = (<span class="hljs-number">1</span>&lt;&lt;OCIE0A);
  <span class="hljs-comment">//set ADC.</span>
  ADMUX =  (<span class="hljs-number">1</span> &lt;&lt; REFS0);<span class="hljs-comment">//8-bit mode, ADC0 channel, AVVCC as ref</span>
  ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADEN) | (<span class="hljs-number">1</span> &lt;&lt; ADATE) | (<span class="hljs-number">1</span> &lt;&lt; ADIE) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2);<span class="hljs-comment">//TUrn ADC On, trigger enable, Interrupt enable, sysclk/16=1MHz_ADC_clk=76kHz conv freq(13ticks per conversion)</span>
  ADCSRB = (<span class="hljs-number">1</span>&lt;&lt; ADTS1) | (<span class="hljs-number">1</span>&lt;&lt;ADTS0) | (<span class="hljs-number">1</span>&lt;&lt;MUX5);<span class="hljs-comment">//Auto trigger source</span><font></font>
}<font></font>
<font></font>
ISR(TIMER0_COMPA_vect){<font></font>
  <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD2)){<font></font>
    PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span>{<font></font>
    PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  TCNT0 = <span class="hljs-number">0</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
ISR(ADC_vect){<font></font>
<font></font>
  <span class="hljs-keyword">if</span>( ( UCSR0A &amp; (<span class="hljs-number">1</span>&lt;&lt;UDRE0)) ){<font></font>
    umoment = ADCL;<span class="hljs-comment">//copy result.</span>
    umoment += (ADCH&lt;&lt;<span class="hljs-number">8</span>);<font></font>
    umoment = umoment - <span class="hljs-number">512</span>;<font></font>
    utemp = utemp + <span class="hljs-built_in">pow</span>((<span class="hljs-keyword">double</span>)(umoment),<span class="hljs-number">2</span>)/<span class="hljs-number">4096</span>;<font></font>
    N++;<font></font>
    <span class="hljs-keyword">if</span> (N == <span class="hljs-number">4095</span>){<font></font>
      urms = <span class="hljs-built_in">sqrt</span>(utemp)/<span class="hljs-number">102</span>;<font></font>
      N = <span class="hljs-number">0</span>;<font></font>
      utemp = <span class="hljs-number">0</span>;<font></font>
      flag = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD3)){<font></font>
        PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span>{<font></font>
        PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该程序是在Arduino IDE中为ATmega1280微控制器编写的。</font><font style="vertical-align: inherit;">在我的调试板上，前8个通道是为满足板的内部需求而布线的，因此使用ADC8通道。</font><font style="vertical-align: inherit;">可以将此草图用于带有ATmega168的电路板，但是，必须选择正确的通道。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在中断内部，我们抽动了几个服务引脚以直观地看到工作的数字化频率。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于系数102的来源，首先要从发生器提供各种幅度的信号，从示波器读取有效电压值的指示，然后从控制台获取以ADC绝对单位表示的计算值。</font></font><br>
<table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大功率</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蠕虫</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已计算</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.08</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">212</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.73</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">176</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.38</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">141</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,03</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">106</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1个</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.684</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,358</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.25</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.179</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十九</font></font></td>
</tr>
</tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将第三列的值除以第二列的值，得出的平均值为102。这就是我们的“校准”系数。但是，可以注意到，当电压降低时，精度会急剧下降。这是由于我们的ADC的灵敏度较低。实际上，用于精确计算的10次放电非常小，如果可以用这种方法测量插座中的电压，那么放置10位ADC来测量负载消耗的电流将是一种违法计量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
至此，我们将停止。在下一部分中，我们将考虑本系列中的其他三个问题，并将平稳地进行设备本身的创建。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
展示的固件以及该系列的其他固件（由于我拍摄视频的速度比准备文章要快），您可以在GitHub的存储库中找到：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/radiolok/arduino_rms_count</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
关于电表的开发，将以</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI SimpleLink WiFi CC3200</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的参考作为基础</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">SmartPlug</font></a><font style="vertical-align: inherit;">，前几天的新闻飞到了我的邮件中。</font><font style="vertical-align: inherit;">我非常喜欢CC3200微控制器，因此我们将为现有的便当盒开发一个增强器包，并实现我们感兴趣的所有功能。</font><font style="vertical-align: inherit;">不要忘记使它在其他微控制器上如此出色地工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
邀请评论  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">progchip666</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对材料的评论和补充，以及  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart_alex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如之前对使用Arduino测量电流和电压感兴趣的那样。</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN384597/">https://habr.com/ru/post/zh-CN384597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN384583/index.html">《小马宝莉》的粉丝们根据动画系列（但有新角色）为格斗游戏筹集资金。</a></li>
<li><a href="../zh-CN384585/index.html">大众汽车公司关注失败的详细历史，并伪造了对环境友好的测试</a></li>
<li><a href="../zh-CN384589/index.html">用灯泡说话-VOCCA智能墨盒评测</a></li>
<li><a href="../zh-CN384593/index.html">[更新ISS]超级月球的全月食9月28日</a></li>
<li><a href="../zh-CN384595/index.html">辐射危害：裂变反应堆与聚变反应堆</a></li>
<li><a href="../zh-CN384599/index.html">为什么将灯泡换成LED</a></li>
<li><a href="../zh-CN384603/index.html">利马评论：无限的个人云服务</a></li>
<li><a href="../zh-CN384605/index.html">使用IFTTT和OpenHAB使传统微波更智能</a></li>
<li><a href="../zh-CN384607/index.html">互联网的形状是什么？</a></li>
<li><a href="../zh-CN384611/index.html">本周的太空照片（09.21-27.09）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>