<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçæ üñêüèæ ‚ôêÔ∏è Das nuvens √† terra: como criar Kubernetes de n√≠vel de produ√ß√£o em qualquer ambiente üßñüèø üëéüèº üë©üèø‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bom para todos! Bem, chegou a hora de nosso pr√≥ximo curso de Devops . Provavelmente, este √© um dos cursos mais est√°veis ‚Äã‚Äãe de refer√™ncia, mas ao mesm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Das nuvens √† terra: como criar Kubernetes de n√≠vel de produ√ß√£o em qualquer ambiente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/422179/">  Bom para todos!  Bem, chegou a hora de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nosso</a> pr√≥ximo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">curso de Devops</a> .  Provavelmente, este √© um dos cursos mais est√°veis ‚Äã‚Äãe de refer√™ncia, mas ao mesmo tempo o mais diversificado em termos de alunos, j√° que nenhum grupo se parece com o outro: em um, os desenvolvedores s√£o quase completamente, depois nos pr√≥ximos engenheiros, depois em administradores e assim por diante.  E isso tamb√©m significa que chegou a hora de materiais interessantes e √∫teis, al√©m de reuni√µes on-line. <br><br><img src="https://habrastorage.org/webt/v-/xe/oi/v-xeoia0xxkvb6vuzmclcvknrys.png" alt="imagem"><a name="habracut"></a><br><br>  Este artigo cont√©m recomenda√ß√µes sobre o lan√ßamento de um cluster Kubernetes de n√≠vel de produ√ß√£o em um data center local ou localiza√ß√£o perif√©rica (localiza√ß√£o da borda). <br>  O que significa grau de produ√ß√£o? <br><br><ul><li>  Instala√ß√£o segura </li><li>  O gerenciamento de implanta√ß√£o √© realizado usando um processo repetido e gravado; </li><li>  O trabalho √© previs√≠vel e consistente; </li><li>  √â seguro realizar atualiza√ß√µes e ajustes; </li><li>  Para detectar e diagnosticar erros e falta de recursos, h√° registro e monitoramento; </li><li>  O servi√ßo tem "alta disponibilidade" suficiente, levando em considera√ß√£o os recursos dispon√≠veis, incluindo restri√ß√µes de dinheiro, espa√ßo f√≠sico, energia etc. </li><li>  O processo de recupera√ß√£o est√° dispon√≠vel, documentado e testado para uso no caso de uma falha. </li></ul><br>  Em resumo, o grau de produ√ß√£o significa antecipar erros e preparar a recupera√ß√£o com o m√≠nimo de problemas e atrasos. <br><br><img src="https://habrastorage.org/webt/ji/b8/je/jib8jeiekbsaflpgjsteescumgg.png"><br><br>  Este artigo √© sobre a implanta√ß√£o local do Kubernetes em uma plataforma hipervisor ou bare-metal, dada a quantidade limitada de recursos de suporte em compara√ß√£o com o aumento nas principais nuvens p√∫blicas.  No entanto, algumas dessas recomenda√ß√µes podem ser √∫teis para a nuvem p√∫blica se o or√ßamento limitar os recursos selecionados. <br><br>  A implanta√ß√£o de um Minikube de um √∫nico metal sem metal pode ser um processo simples e barato, mas n√£o √© de n√≠vel de produ√ß√£o.  Por outro lado, voc√™ n√£o poder√° atingir o n√≠vel do Google com a Borg em uma loja offline, filial ou local perif√©rico, embora seja improv√°vel que voc√™ precise. <br><br>  Este artigo descreve dicas para obter uma implanta√ß√£o do Kubernetes no n√≠vel de produ√ß√£o, mesmo em situa√ß√µes com recursos limitados. <br><br>  <b>Componentes importantes no cluster Kubernetes</b> <br><br>  Antes de aprofundar nos detalhes, √© importante entender a arquitetura geral do Kubernetes. <br>  O cluster Kubernetes √© um sistema altamente distribu√≠do baseado no plano de controle e na arquitetura dos n√≥s do trabalhador em cluster, conforme mostrado abaixo: <br><br><img src="https://habrastorage.org/webt/_9/zu/xd/_9zuxdnulbsg6axshrcnxah2x_o.png"><br><br>  Normalmente, os componentes do API Server, do Controller Manager e do Scheduler est√£o localizados em v√°rias inst√¢ncias dos n√≥s no n√≠vel de controle (chamados Master).  Os n√≥s principais tamb√©m incluem o etcd, no entanto, existem scripts grandes e altamente acess√≠veis que exigem a execu√ß√£o do etcd em hosts independentes.  Os componentes podem ser executados como cont√™ineres e, opcionalmente, sob a supervis√£o do Kubernetes, ou seja, funcionar como lareiras est√°ticas. <br><br>  Inst√¢ncias redundantes desses componentes s√£o usadas para alta disponibilidade.  O significado e o n√≠vel exigido de redund√¢ncia podem variar. <br><table><tbody><tr><th>  <nobr>Componente</nobr> </th><th>  Fun√ß√µes </th><th>  Consequ√™ncias da perda </th><th>  Inst√¢ncias recomendadas </th></tr><tr><td>  etcd </td><td>  Mant√©m o estado de todos os objetos Kubernetes </td><td>  Perda catastr√≥fica de armazenamento.  Perda da maioria = o Kubernetes perde o n√≠vel de controle, o API Server depende do etcd, as chamadas de API somente leitura que n√£o precisam de quorum, como as cargas de trabalho j√° criadas, podem continuar funcionando. </td><td>  n√∫mero √≠mpar, 3+ </td></tr><tr><td>  Servidor API </td><td>  Fornece API para uso externo e interno </td><td>  N√£o foi poss√≠vel parar, iniciar, atualizar novos pods.  O Scheduler e o Controller Manager dependem do servidor de API.  As cargas continuam se n√£o dependerem de chamadas de API (operadores, controladores personalizados, CRD etc.) </td><td>  2+ </td></tr><tr><td>  kube-scheduler </td><td>  Coloca pods em n√≥s </td><td>  Os pods n√£o podem ser colocados, priorizados ou movidos entre eles. </td><td>  2+ </td></tr><tr><td>  kube-controller-manager </td><td>  Controla muitos controladores </td><td>  Os principais circuitos de controle respons√°veis ‚Äã‚Äãpelo estado param de funcionar.  A integra√ß√£o na √°rvore do provedor de nuvem √© interrompida. </td><td>  2+ </td></tr><tr><td>  gerenciador de controlador de nuvem (CCM) </td><td>  Integra√ß√£o de provedor de nuvem fora da √°rvore </td><td>  Quebras de integra√ß√£o do provedor de nuvem </td><td>  1 </td></tr><tr><td>  Adi√ß√µes (por exemplo, DNS) </td><td>  Diferente </td><td>  Diferente </td><td>  Depende do complemento (por exemplo, 2+ para DNS) </td></tr></tbody></table><br>  Os riscos desses componentes incluem falhas de hardware, bugs de software, atualiza√ß√µes incorretas, erros humanos, interrup√ß√µes de rede e sobrecarga do sistema, resultando em exaust√£o de recursos.  A redund√¢ncia pode reduzir o impacto desses perigos.  Al√©m disso, gra√ßas aos recursos da plataforma do hipervisor (planejamento de recursos, alta disponibilidade), voc√™ pode multiplicar os resultados usando o sistema operacional Linux, o Kubernetes e o tempo de execu√ß√£o do cont√™iner. <br><br>  O servidor da API usa v√°rias inst√¢ncias do balanceador de carga para obter escalabilidade e disponibilidade.  Um balanceador de carga √© um componente essencial para alta disponibilidade.  V√°rios registros A do servidor da API DNS podem servir como alternativa na aus√™ncia de um balanceador. <br><br>  O kube-scheduler e o kube-controller-manager est√£o envolvidos no processo de sele√ß√£o de um l√≠der em vez de usar um balanceador de carga.  Como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gerenciador de controlador de nuvem √©</a> usado para certos tipos de infraestrutura de hospedagem, cuja implementa√ß√£o pode variar, n√£o os discutiremos - apenas indicamos que eles s√£o um componente do n√≠vel de gerenciamento. <br><br>  Os pods em execu√ß√£o no Kubernetes s√£o gerenciados pelo agente kubelet.  Cada inst√¢ncia do trabalhador executa um agente kubelet e um ambiente de inicializa√ß√£o de cont√™iner compat√≠vel com CRI.  O pr√≥prio Kubernetes foi projetado para monitorar e se recuperar de falhas no n√≥ do trabalhador.  Por√©m, para fun√ß√µes cr√≠ticas de carga, gerenciamento de recursos do hipervisor e isolamento de carga, ela pode ser usada para melhorar a acessibilidade e aumentar a previsibilidade de seu trabalho. <br><br>  <b>etcd</b> <br><br>  O etcd √© um armazenamento persistente para todos os objetos do Kubernetes.  A disponibilidade e a capacidade de recupera√ß√£o do cluster etcd devem ser a principal prioridade ao implantar o Kubernetes com n√≠vel de produ√ß√£o. <br><br>  O cluster etcd composto por cinco n√≥s √© a melhor op√ß√£o se voc√™ pode permitir.  Porque  Porque voc√™ pode atender a um e, ao mesmo tempo, suportar falhas.  Um cluster de tr√™s n√≥s √© o m√≠nimo que podemos recomendar para um servi√ßo de n√≠vel de produ√ß√£o, mesmo que apenas um hipervisor host esteja dispon√≠vel.  Mais de sete n√≥s tamb√©m n√£o s√£o recomendados, com exce√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instala√ß√µes muito grandes que</a> cobrem v√°rias zonas de acesso. <br><br>  As recomenda√ß√µes m√≠nimas para hospedar um n√≥ de cluster etcd s√£o 2 GB de RAM e um disco r√≠gido de 8 GB SSD.  Normalmente, 8 GB de RAM e 20 GB de espa√ßo em disco r√≠gido s√£o suficientes.  O desempenho do disco afeta o tempo de recupera√ß√£o de um n√≥ ap√≥s uma falha.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Confira</a> para mais detalhes. <br><br>  <i>Em casos especiais, pense em v√°rios clusters etcd</i> <br><br>  Para clusters Kubernetes muito grandes, considere usar um cluster etcd separado para eventos Kubernetes, para que muitos eventos n√£o afetem o servi√ßo principal da API Kubernetes.  Ao usar a rede Flannel, a configura√ß√£o √© salva no etcd, e os requisitos de vers√£o podem diferir dos Kubernetes.  Isso pode complicar o backup do etcd, por isso recomendamos o uso de um cluster etcd separado especificamente para a flanela. <br><br>  <b>Implanta√ß√£o de host √∫nico</b> <br><br>  A lista de riscos de acessibilidade inclui hardware, software e o fator humano.  Se voc√™ estiver limitado a um √∫nico host, o uso de armazenamento redundante, mem√≥ria de corre√ß√£o de erros e uma fonte de alimenta√ß√£o dupla podem melhorar a prote√ß√£o contra falhas de hardware.  A execu√ß√£o de um hipervisor em um host f√≠sico permite o uso de componentes de software redundantes e adiciona benef√≠cios operacionais associados √† implanta√ß√£o, atualiza√ß√£o e monitoramento do uso de recursos.  Mesmo em situa√ß√µes estressantes, o comportamento permanece repet√≠vel e previs√≠vel.  Por exemplo, mesmo que voc√™ possa permitir apenas o lan√ßamento de singletones a partir de servi√ßos principais, eles devem estar protegidos contra sobrecarga e esgotamento de recursos, competindo com a carga de trabalho do seu aplicativo.  Um hipervisor pode ser mais eficiente e f√°cil de usar do que a prioriza√ß√£o no agendador do Linux, cgroups, sinalizadores do Kubernetes etc. <br><br>  Voc√™ pode implantar tr√™s m√°quinas virtuais etcd, se os recursos do host permitirem.  Cada VM deve ser suportada por um dispositivo de armazenamento f√≠sico separado ou usar partes separadas do armazenamento usando redund√¢ncia (espelhamento, RAID etc.). <br>  Inst√¢ncias redundantes duplas da API do servidor, planejador e gerenciador de controladores s√£o a pr√≥xima atualiza√ß√£o se seu √∫nico host tiver recursos suficientes para isso. <br><br>  <i>Op√ß√µes de implanta√ß√£o de host √∫nico, do menos adequado para produ√ß√£o √† maioria</i> <br><table><tbody><tr><th>  Tipo </th><th>  Caracter√≠sticas </th><th>  Resultado </th></tr><tr><td>  <nobr>Equipamento m√≠nimo</nobr> </td><td>  Etd Singleton e componentes principais. </td><td>  Laborat√≥rio dom√©stico, nem um n√≠vel de produ√ß√£o.  Ponto √∫nico de falha m√∫ltiplo (SPOF).  A recupera√ß√£o √© lenta e, quando o armazenamento √© perdido, est√° completamente ausente. </td></tr><tr><td>  Melhoria da redund√¢ncia de armazenamento </td><td>  etcd singleton e componentes principais, etcd armazenamento √© redundante. </td><td>  No m√≠nimo, voc√™ pode se recuperar de uma falha no dispositivo de armazenamento. </td></tr><tr><td>  Redund√¢ncia de n√≠vel gerenciado </td><td>  N√£o h√° hipervisor, v√°rias inst√¢ncias de componentes de n√≠vel gerenciado em pods est√°ticos. </td><td>  A prote√ß√£o contra bugs de software apareceu, mas o sistema operacional e o ambiente de inicializa√ß√£o do cont√™iner ainda s√£o o mesmo ponto de falha com atualiza√ß√µes devastadoras. </td></tr><tr><td>  Incluindo um Hypervisor </td><td>  Executando tr√™s inst√¢ncias redundantes de n√≠vel gerenciado na VM. </td><td>  H√° prote√ß√£o contra bugs de software e erros humanos e uma vantagem operacional na instala√ß√£o, gerenciamento de recursos, monitoramento e seguran√ßa.  As atualiza√ß√µes do SO e os ambientes de lan√ßamento de cont√™iner s√£o menos perturbadores.  O hypervisor √© o √∫nico ponto √∫nico de falha. </td></tr></tbody></table><br>  <b>Implanta√ß√£o de host duplo</b> <br><br>  Com dois hosts, os problemas de armazenamento etcd s√£o semelhantes √† op√ß√£o de host √∫nico - voc√™ precisa de redund√¢ncia.  √â prefer√≠vel executar tr√™s inst√¢ncias de encd.  Pode parecer pouco intuitivo, mas √© melhor concentrar todos os n√≥s etcd em um host.  Voc√™ n√£o aumentar√° a confiabilidade dividindo-os por 2 + 1 entre dois hosts - a perda de um n√≥ com a maioria das inst√¢ncias de encd levar√° a uma falha, independentemente de ser a maioria de 2 ou 3. Se os hosts n√£o forem iguais, coloque o cluster etcd inteiro no mais confi√°vel. <br><br>  √â recomend√°vel que voc√™ execute servidores de API redundantes, planejadores de kube e gerenciadores de controladores de kube.  Eles devem ser compartilhados entre os hosts para minimizar os riscos de falhas no ambiente de inicializa√ß√£o do cont√™iner, sistema operacional e hardware. <br><br>  O lan√ßamento de uma camada de hipervisor em hosts f√≠sicos permitir√° trabalhar com componentes de programa redundantes, fornecendo gerenciamento de recursos.  Ele tamb√©m tem a vantagem operacional da manuten√ß√£o programada. <br><br>  <i>Op√ß√µes de implanta√ß√£o para dois hosts, desde o menos adequado para produ√ß√£o at√© o mais</i> <br><table><tbody><tr><th>  Tipo </th><th>  Caracter√≠sticas </th><th>  Resultado </th></tr><tr><td>  <nobr>Equipamento m√≠nimo</nobr> </td><td>  Dois hosts, sem armazenamento redundante.  Etd Singleton e componentes principais no mesmo host. </td><td>  etcd - um √∫nico ponto de falha, n√£o faz sentido executar dois em outros servi√ßos principais.  O compartilhamento entre dois hosts aumenta o risco de falhas na camada gerenciada.  O benef√≠cio potencial de isolar recursos executando uma camada gerenciada em um host e cargas de trabalho de aplicativos em outro.  Se o armazenamento for perdido, n√£o h√° recupera√ß√£o. </td></tr><tr><td>  Melhoria da redund√¢ncia de armazenamento </td><td>  Etd Singleton e componentes principais no mesmo host, armazenamento etcd redundante. </td><td>  No m√≠nimo, voc√™ pode se recuperar de uma falha no dispositivo de armazenamento. </td></tr><tr><td>  Redund√¢ncia de n√≠vel gerenciado </td><td>  N√£o h√° hipervisor, v√°rias inst√¢ncias de componentes de n√≠vel gerenciado em pods est√°ticos.  etcd em um host, outros componentes de n√≠vel gerenciado s√£o separados. </td><td>  Uma falha de hardware, a atualiza√ß√£o do firmware, sistema operacional e ambiente de inicializa√ß√£o do cont√™iner em um host sem o etcd s√£o menos prejudiciais. </td></tr><tr><td>  Incluindo um Hipervisor nos Dois Hosts </td><td>  Tr√™s componentes redundantes de n√≠vel gerenciado est√£o sendo executados em m√°quinas virtuais, cluster etcd em um host e os componentes de n√≠vel gerenciado s√£o separados.  As cargas de trabalho do aplicativo podem residir nos dois n√≥s da VM. </td><td>  Melhor isolamento da carga do aplicativo.  As atualiza√ß√µes no sistema operacional e no ambiente de inicializa√ß√£o do cont√™iner s√£o menos perturbadoras.  A manuten√ß√£o agendada de hardware / firmware se torna n√£o destrutiva se o hipervisor suportar a migra√ß√£o da VM. </td></tr></tbody></table><br>  <b>Implanta√ß√£o em tr√™s (ou mais) hosts</b> <br><br>  Transi√ß√£o para um servi√ßo de n√≠vel de produ√ß√£o intransigente.  Recomendamos dividir o etcd entre os tr√™s hosts.  Uma falha de hardware reduzir√° a quantidade poss√≠vel de cargas de trabalho de aplicativos, mas n√£o resultar√° em uma interrup√ß√£o completa do servi√ßo. <br><br>  Clusters muito grandes exigir√£o mais inst√¢ncias. <br><br>  O lan√ßamento de uma camada de hipervisor fornece benef√≠cios operacionais e melhor isolamento das cargas de trabalho do aplicativo.  Isso est√° al√©m do escopo do artigo, mas, no n√≠vel de tr√™s ou mais hosts, podem estar dispon√≠veis fun√ß√µes aprimoradas (armazenamento compartilhado redundante em cluster, gerenciamento de recursos com um balanceador de carga din√¢mico, monitoramento autom√°tico de estado com migra√ß√£o ao vivo e failover). <br><br>  <i>Op√ß√µes de implanta√ß√£o para tr√™s (ou mais) hosts, do menos adequado √† produ√ß√£o ao mais</i> <br><table><tbody><tr><th>  Tipo </th><th>  Caracter√≠sticas </th><th>  Resultado </th></tr><tr><td>  <nobr>M√≠nimo</nobr> </td><td>  Tr√™s anfitri√µes.  Inst√¢ncia etcd em cada n√≥.  Componentes principais em cada n√≥. </td><td>  Perder um n√≥ reduz o desempenho, mas n√£o leva a uma queda no Kubernetes.  A possibilidade de recupera√ß√£o permanece. </td></tr><tr><td>  Incluindo um Hipervisor nos Hosts </td><td>  Nas m√°quinas virtuais em tr√™s hosts, etcd, um servidor de API, agendadores e um gerenciador de controladores est√£o em execu√ß√£o.  As cargas de trabalho est√£o em execu√ß√£o na VM em cada host. </td><td>  Adicionado prote√ß√£o contra bugs do SO / ambiente de inicializa√ß√£o de cont√™iner / software e erros humanos.  Benef√≠cios operacionais da instala√ß√£o, atualiza√ß√£o, gerenciamento de recursos, monitoramento e seguran√ßa. </td></tr></tbody></table><br>  <b>Configurar o Kubernetes</b> <br><br>  Os n√≥s mestre e trabalhador devem ser protegidos contra sobrecarga e esgotamento de recursos.  As fun√ß√µes do hipervisor podem ser usadas para isolar componentes cr√≠ticos e reservar recursos.  Tamb√©m existem defini√ß√µes de configura√ß√£o do Kubernetes que podem diminuir a velocidade da chamada da API.  Alguns kits de instala√ß√£o e distribui√ß√µes comerciais cuidam disso, mas se voc√™ estiver implantando o Kubernetes, as configura√ß√µes padr√£o podem n√£o ser adequadas, especialmente para recursos pequenos ou para um cluster muito grande. <br><br>  O consumo de recursos em n√≠vel gerenciado se correlaciona com o n√∫mero de lareiras e a taxa de sa√≠da de lareiras.  Clusters muito grandes e muito pequenos se beneficiar√£o das configura√ß√µes modificadas de solicita√ß√£o e redu√ß√£o de mem√≥ria do kube-apiserver. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O n√≥</a> aloc√°vel deve ser configurado nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√≥s</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">trabalhador com</a> base na densidade de carga suportada razo√°vel para cada n√≥.  Os espa√ßos para nome podem ser criados para dividir um cluster de n√≥s de trabalho em v√°rios clusters virtuais com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cotas</a> de CPU e mem√≥ria. <br><br>  <b>Seguran√ßa</b> <br><br>  Cada cluster Kubernetes possui uma autoridade de certifica√ß√£o raiz (CA).  Os certificados Controller Manager, API Server, Scheduler, cliente kubelet, kube-proxy e administrador devem ser gerados e instalados.  Se voc√™ usa uma ferramenta de instala√ß√£o ou distribui√ß√£o, pode n√£o ter que lidar com isso sozinho.  O processo manual √© descrito <a href="">aqui</a> .  Voc√™ deve estar preparado para reinstalar certificados se expandir ou substituir os n√≥s. <br><br>  Como o Kubernetes √© totalmente gerenciado pela API, √© imperativo controlar e limitar a lista daqueles que t√™m acesso ao cluster.  As op√ß√µes de criptografia e autentica√ß√£o s√£o discutidas nesta documenta√ß√£o. <br><br>  As cargas de trabalho do aplicativo Kubernetes s√£o baseadas em imagens de cont√™iner.  Voc√™ precisa que a fonte e o conte√∫do dessas imagens sejam confi√°veis.  Quase sempre, isso significa que voc√™ hospedar√° a imagem do cont√™iner no reposit√≥rio local.  O uso de imagens da Internet p√∫blica pode causar problemas de confiabilidade e seguran√ßa.  Voc√™ deve selecionar um reposit√≥rio que tenha suporte para assinar a imagem, verificar a seguran√ßa, controlar o acesso para enviar e baixar imagens e registrar atividades. <br><br>  Os processos devem ser configurados para dar suporte ao uso de host, hypervisor, OS6, Kubernetes e outras atualiza√ß√µes de firmware de depend√™ncia.  O monitoramento de vers√£o √© necess√°rio para dar suporte √† auditoria. <br><br>  Recomenda√ß√µes: <br><br><ul><li>  Fortalecer as configura√ß√µes de seguran√ßa padr√£o para componentes de n√≠vel gerenciado (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bloquear n√≥s do trabalhador</a> ); </li><li>  Use a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pol√≠tica de Seguran√ßa do Lar</a> ; </li><li>  Pense na integra√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NetworkPolicy</a> dispon√≠vel para sua solu√ß√£o de rede, incluindo rastreamento, monitoramento e solu√ß√£o de problemas; </li><li>  Use o RBAC para tomar decis√µes de autoriza√ß√£o; </li><li>  Pense em seguran√ßa f√≠sica, especialmente ao implantar em locais perif√©ricos ou remotos que podem ser negligenciados.  Adicione criptografia de armazenamento para limitar as conseq√º√™ncias do roubo de dispositivos e prote√ß√£o contra a conex√£o de dispositivos maliciosos, como chaves USB; </li><li>  Proteja as credenciais de texto do provedor de nuvem (chaves de acesso, tokens, senhas etc.). </li></ul><br>  Os objetos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">secretos do</a> Kubernetes s√£o adequados para armazenar pequenas quantidades de dados confidenciais.  Eles s√£o armazenados no etcd.  Eles podem ser usados ‚Äã‚Äãcom seguran√ßa para armazenar credenciais da API Kubernetes, mas h√° momentos em que uma carga de trabalho ou expans√£o do pr√≥prio cluster requer uma solu√ß√£o mais completa.  O projeto HashiCorp Vault √© uma solu√ß√£o popular se voc√™ precisar de mais do que os objetos secretos internos podem fornecer. <br><br>  <b>Recupera√ß√£o de desastres e backup</b> <br><br><img src="https://habrastorage.org/webt/gv/xp/kd/gvxpkd1qgpap0wosdhv-r4uu-9s.png"><br><br>  A implementa√ß√£o de redund√¢ncia por meio do uso de v√°rios hosts e VMs ajuda a reduzir o n√∫mero de certos tipos de falhas.  Mas cen√°rios como um desastre natural, uma atualiza√ß√£o ruim, um ataque de hackers, bugs de software ou um erro humano ainda podem resultar em falhas. <br><br>  Uma parte cr√≠tica de uma implanta√ß√£o de produ√ß√£o √© a expectativa de uma recupera√ß√£o futura. <br><br>  Tamb√©m √© importante notar que parte do seu investimento em design, documenta√ß√£o e automa√ß√£o do processo de recupera√ß√£o pode ser reutilizada se voc√™ precisar de implanta√ß√µes replicadas em larga escala em v√°rios sites. <br><br>  Entre os elementos de recupera√ß√£o de desastres, vale ressaltar os backups (e possivelmente r√©plicas), substitui√ß√µes, o processo planejado, as pessoas que executar√£o esse processo e o treinamento regular.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Os</a> frequentes exerc√≠cios e princ√≠pios de teste da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Chaos Engineering</a> podem ser usados ‚Äã‚Äãpara testar sua prontid√£o. <br><br>  Devido aos requisitos de disponibilidade, pode ser necess√°rio armazenar c√≥pias locais do sistema operacional, componentes do Kubernetes e imagens de cont√™ineres para permitir a recupera√ß√£o, mesmo se a Internet travar.  A capacidade de implantar hosts e n√≥s de substitui√ß√£o em uma situa√ß√£o de "isolamento f√≠sico" melhora a seguran√ßa e aumenta a velocidade de implanta√ß√£o. <br><br>  Todos os objetos do Kubernetes s√£o armazenados no etcd.  O backup peri√≥dico dos dados do cluster etcd √© um elemento importante na restaura√ß√£o de clusters do Kubernetes durante cen√°rios de emerg√™ncia, por exemplo, quando todos os n√≥s principais s√£o perdidos. <br><br>   etcd       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  etcd           .      Kubernetes    .   ,     Kubernetes. <br><br>   ,    Kubernetes      etcd ,      -  .     ,         . <br><br>       etcd. ,  ,    ,   ,     /.       ,        .           : <br><br><ul><li>    : CA, API Server, Apiserver-kubelet-client,  ServiceAccount, ‚ÄúFront proxy‚Äù,  Front proxy; </li><li>   DNS; </li><li>    IP/; </li><li>   ; </li><li>  kubeconfig; </li><li> LDAP    ; </li><li>      . </li></ul><br> <b>   </b> <br><br> Anti-affinity           .      ,    .  ,  Kubernetes         ,          .     ,              ,    -   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">    </a>          ,  . <br><br>   stateful-,    ‚Äî   Kubernetes    (,   SQL  ). ,   ,  Kubernetes,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">roadmap feature request</a> , ,  ,    Container Storage Interface (CSI).  ,       - ,    ,      . ,      Kubernetes      ,          ,    ,    Kubernetes . <br><br>  stateful- (, Cassandra)        ,    ,    .      - Kubernetes (    -)      . <br><br> <b> </b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> (    )    ,      ,        .     ,      , . <br><br>        ,    (, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ansible</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BOSH</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Chef</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Juju</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kubeadm</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Puppet</a>  .).        ,          . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> , ,          , ,          ,  ,        .       ,  Git,      . <br><br> <b></b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> ,     ,       ‚Äî   .     2   ,  ‚Äî   .          ‚Äî         ,    . <br><br> <b> </b> <br><br><img src="https://habrastorage.org/webt/a5/m-/gx/a5m-gxsrhmwpyxxwmcfsnfc8umm.png"><br><br>       ‚Äî    .          - ,    Airbus A320 ‚Äî  .   ,      .    ,   . <br><br>   ,       .   , ,    ,   . Kubernetes     ,    - ,     ,       (, FedEx, Amazon). <br><br>   production-grade  Kubernetes       .               .   , ,     ,    ,     .  ,    (,   Kubernetes   <a href="">self-hosting</a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√£o est√°ticas). </font><font style="vertical-align: inherit;">Talvez eles devam ser discutidos nos seguintes artigos, se houver interesse suficiente. </font><font style="vertical-align: inherit;">Al√©m disso, devido √† alta velocidade da melhoria do Kubernetes, se o seu mecanismo de pesquisa encontrou este artigo ap√≥s 2019, alguns de seus materiais j√° podem estar muito desatualizados.</font></font><br><br>  O FIM <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como sempre, estamos aguardando suas perguntas e coment√°rios aqui, e voc√™ pode ir </font><font style="vertical-align: inherit;">para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o Open Day de </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Titov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt422179/">https://habr.com/ru/post/pt422179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422169/index.html">O que o programa Ada Lovelace realmente fez?</a></li>
<li><a href="../pt422171/index.html">Como eu fiz um no-break interativo em linha. Parte 3</a></li>
<li><a href="../pt422173/index.html">O aprendizado de m√°quina √© cada vez mais usado na f√≠sica de part√≠culas.</a></li>
<li><a href="../pt422175/index.html">Polui√ß√£o ambiental reduz habilidades cognitivas humanas</a></li>
<li><a href="../pt422177/index.html">Por que o Arduino √© t√£o lento e o que pode ser feito sobre isso</a></li>
<li><a href="../pt422181/index.html">Como coletar servi√ßos corporativos em uma plataforma online: a hist√≥ria do MegaFon.</a></li>
<li><a href="../pt422183/index.html">E o que, poderia ser mais barato?</a></li>
<li><a href="../pt422185/index.html">Quanto os dados para o treinamento do modelo (n√£o) s√£o semelhantes a uma amostra de teste?</a></li>
<li><a href="../pt422187/index.html">Sberseasons: como passei este ver√£o</a></li>
<li><a href="../pt422189/index.html">A verdade sobre a implementa√ß√£o do portal da intranet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>