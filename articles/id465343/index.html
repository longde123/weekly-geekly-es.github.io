<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐟 🖕🏻 ♑️ Bagaimana kami membuat mesin dan game di dalamnya selama satu setengah tahun. Bagian Dua Infrastruktur ㊙️ 👩🏿‍🎤 🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pertama, beberapa komentar tentang jejak artikel sebelumnya. Kami dulu pernah bekerja di Wargaming , tempat kami mengembangkan mesin yang dikenal seba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami membuat mesin dan game di dalamnya selama satu setengah tahun. Bagian Dua Infrastruktur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465343/"> Pertama, beberapa komentar tentang jejak artikel sebelumnya.  Kami dulu pernah bekerja di <b>Wargaming</b> , tempat kami mengembangkan mesin yang dikenal sebagai <b>dava.framework</b> atau <b>dava.engine</b> .  Oleh karena itu, banyak kolega lama, dengan siapa kita masih berada dalam hubungan yang baik, secara aktif berpartisipasi dalam diskusi. <br><br>  Sejumlah orang memiliki keraguan: apakah ini teknologi yang sama atau yang lain?  Jawab: ini adalah teknologi baru yang ditulis dari awal. <br><br>  Bagaimana kami mengelola hanya dalam setahun?  Tim kami memiliki pengalaman luas.  Banyak yang telah mengembangkan mesin dan game selama lebih dari 15 tahun. <br><br>  Kenapa dari awal, jika Anda bisa mengambil mesin lama kami, yang juga terletak di open-source?  Dia berumur sekitar 10 tahun, dan sebagian besar kode sudah usang.  Bahkan bagian-bagian terbaik dari mesin, yang kami banggakan, kadang-kadang berisi potongan-potongan kode dan beberapa dasar 5, 7 dan kadang-kadang bahkan 10 tahun yang lalu.  Banyak solusi arsitektur yang dirancang untuk perangkat pada waktu itu - dimulai dengan iPhone 3G.  Sekarang kita fokus setidaknya pada iPad Air 1 dan perangkat Android yang memiliki kekuatan serupa.  Oleh karena itu, pendekatannya agak berubah. <br><a name="habracut"></a><br>  Dan pertanyaan paling umum: mengapa mesin sendiri?  Dalam artikel terakhir, ada beberapa argumen dengan tingkat persuasi yang berbeda-beda.  Saya ingin berkonsentrasi pada hal utama: hanya teknologi kami sendiri yang memungkinkan Anda untuk mendapatkan yang terbaik dari besi, membuat jumlah maksimal pengoptimalan khusus untuk gameplay Anda, gaya visual.  Kami memposisikan diri, termasuk sebagai perusahaan teknologi, bukan hanya pengembang game.  Kami percaya bahwa dengan tingkat insinyur dan pengalaman kami, kami dapat bersaing secara serius di pasar produk seluler berteknologi tinggi. <br><br>  Dan sekarang pada intinya: alat dan teknik apa yang telah membantu kita menyelesaikan tugas yang agak ambisius ini dalam waktu singkat? <br><br><h4>  Infrastruktur </h4><br>  Kami memilih Atlassian Bitbucket Server + Jenkins.  Di Bitbucket terletak repositori utama (master), yang terhubung dengan Jenkins.  Setiap pengembang memiliki garpu sendiri.  Untuk setiap tugas, garpu baru dibuat di garpu, yang diintegrasikan kembali melalui permintaan tarik.  Secara umum, skema ini cukup standar.  Setiap permintaan penarikan menjalani tinjauan wajib dan tes otomatis.  Dan, jika berhasil, secara otomatis bergabung ke master. <br><br><h4>  Jenkins </h4><br>  Jenkins memiliki beberapa kekurangan: dia adalah moncong web kuno, tidak terlalu cepat, rakus, seperti portal Internet dari tahun 90-an.  Namun, fleksibilitasnya, sejumlah besar modul dan bebas biaya menjadikannya pilihan yang baik bahkan pada tahun 2019.  Setelah bermain dengan modul dan pengaturan, Anda dapat mencapai tampilan yang dapat dicerna, deskripsi deklaratif dari pipa (berbaring di repositori).  Omong-omong, ada sekitar 40 saluran pipa sekarang: tes, editor, permainan untuk semua platform;  bekerja dengan infrastruktur server dan metagame.  Kumpulkan semuanya 20 buildagentov. <br><br>  Di masa depan, tentu saja, saya ingin mencoba solusi hipster modern, misalnya GitLab atau TravisCI yang dikelola sendiri.  Kami tidak mempertimbangkan sepenuhnya solusi cloud (Nevercode, Bitrise, CircleCI, dll.) Karena besarnya repositori, aset, dan, karenanya, waktu pembuatan dan ukuran artefak. <br><br><h4>  Membangun sistem </h4><br>  Persyaratan utama untuk sistem adalah sebagai berikut: pembuatan proyek untuk iOS, MacOS, Android, Windows, Linux dalam satu skrip.  Kami berhasil mencoba Premake, SCons, Bazel, dan CMake.  Karena berbagai alasan, kami berhenti di CMake yang teruji waktu. <br><br>  Dalam beberapa tahun terakhir, CMake hampir menjadi standar untuk pustaka C ++.  Hampir semuanya mulai dari abseil hingga SDL dapat dihubungkan ke proyek CMake Anda hanya dalam beberapa baris.  Tentu saja ada pengecualian, seperti OpenSSL atau V8, yang saya harus sedikit berkeringat.  Di atas Zmeik telanjang kami mengembangkan kerangka kecil (total sekitar 3.000 baris).  Fitur utama: <br>  Modularitas.  Masing-masing bagian mesin dirancang sebagai modul.  Misalnya, suara, UI, fisika, jaringan, dll.  Setiap modul dapat memiliki aset sendiri (misalnya, shader) dan mungkin memiliki ketergantungan pada modul lain. <br><br>  Aplikasi terakhir pada engine (gim, editor, utilitas) hanya menghubungkan modul-modul yang dibutuhkannya.  Sedikit terpisah adalah modul inti, yang merupakan ketergantungan untuk sebagian besar modul lainnya.  Core mengimplementasikan titik masuk, siklus aplikasi utama, interaksi dengan sistem operasi dan entitas dasar lainnya. <br>  Modul pihak ketiga.  Kerangka kerja kami memungkinkan Anda untuk mengunduh repositori git atau arsip dalam beberapa baris, membongkar, mengkompilasi, menyalin pustaka dan / atau sumber.  Hari ini kami memiliki 66 modul pihak ketiga tersebut: analitik, format file pihak ketiga, middleware seperti fisika, perpustakaan suara, dll. <br><br><h4>  Proses pengembangan </h4><br>  Berdasarkan pengalaman sebelumnya, kami memutuskan untuk menambahkan engine dan game ke dalam satu repositori.  Hal ini memungkinkan Anda untuk membuat perubahan pada API engine tanpa rasa sakit dan menyesuaikan game secara sinkron untuknya.  Hasilnya adalah monorepositori yang disebut dengan kelebihan dan kekurangannya.  Tapi, karena kami segera berencana untuk mempertahankan kecepatan pengembangan yang sangat tinggi, kemungkinan refactoring sinkron dari mesin dan permainan melebihi semua kelemahan lain dari solusi ini. <br><br>  Rata-rata, kami menambahkan lebih dari 20 permintaan tarik per hari.  Ini berarti bahwa master berpotensi rusak 20 kali sehari.  Untungnya, pada tahun 1991, mereka datang dengan teknik Integrasi Berkelanjutan.  Untuk apa kita datang? <br><br><h4>  Integrasi berkelanjutan </h4><br>  Seperti disebutkan di atas, brunch dibuat untuk setiap tugas di cabang pengembang.  Selanjutnya, permintaan tarik dibuat dari brunch ini ke repositori utama.  Permintaan penarikan ini melewati serangkaian tes otomatis di Jenkins: <br><br><ol><li>  Tes unit untuk semua platform (windows, linux, macos, ios, android).  Googletest digunakan sebagai dasar, dan OpenCppCoverage, yang laporannya diperiksa oleh skrip python tambahan, digunakan untuk memeriksa persentase cakupan.  Jika persentase cakupan untuk file tertentu kurang dari 75%, tes dianggap gagal.  Dengan demikian, kami telah membahas sebagian besar kelas engine tingkat rendah dengan pengujian. </li><li>  Pemformat kode  Untuk kode C ++ kami menggunakan format dentang.  Pemformatan kode yang diubah pertama kali secara otomatis terjadi ketika melakukan pada mesin pengembang, dan kemudian diperiksa dalam pengujian.  Untuk javascript, yang digunakan sebagai bahasa scripting, npm linter digunakan. </li><li>  Tes Aset.  Sekelompok tes yang cukup besar: dari memvalidasi format file hingga memeriksa dependensi (misalnya, memeriksa apakah tekstur yang digunakan di level gim memang ada). </li><li>  Tes unit dan fungsional editor.  Bagian integral dari mesin adalah editor, di mana level game dan aset lainnya dibuat dan diedit.  Selain tes unit, Squish froglogic untuk Qt digunakan untuk menguji editor - utilitas untuk pengujian GUI otomatis.  Semua ini memungkinkan kita untuk melakukannya tanpa pengujian manual dari editor.  Selain itu, menurut ulasan seniman dan desainer level, tingkat kualitas dan stabilitasnya lebih tinggi daripada di perusahaan sebelumnya, ketika kami memiliki tim yang terdiri dari lima penguji.  Pada saat yang sama, rilis terjadi setiap hari, dan dengan pengujian manual, rilis terjadi setiap 2 minggu. </li><li>  Tes fungsional permainan.  Jelas saya ingin menggunakan tes fungsional otomatis untuk game.  Oleh karena itu, kami mulai mengembangkan sistem berikut: </li></ol><br><ul><li>  aplikasi uji (khusus - skrip python) meluncurkan server permainan dan klien dengan parameter tertentu </li><li>  menjalankan server dan klien membuka port jaringan, </li><li>  Aplikasi tes terhubung dengan mereka dan mengirimkan perintah: unduh peta, pilih karakter dan senjata, pindah ke satu titik, membidik, menembak, dll. </li><li>  sintaks tes itu sendiri adalah python pytest.  Sistem ini sedang dalam pengembangan aktif. </li></ul><br>  Sebagian besar proyek untuk pengujian dikumpulkan dengan bendera "perlakukan peringatan sebagai kesalahan" dihidupkan, dan pada platform MacOS dengan AddressSanitizer dentang juga diaktifkan, yang memungkinkan Anda untuk menangkap lebih banyak kesalahan pada tahap mempersiapkan permintaan tarik. <br><br>  Selain tes, setiap permintaan tarik ditinjau oleh setidaknya dua pengembang lain dan, jika perlu, dikirim untuk revisi.  Ketika semua tes telah selesai dan pengulas tidak memiliki komentar, permintaan tarik otomatis membeku. <br>  Karena beberapa tes dapat memakan waktu yang cukup lama (misalnya, tes editor GUI lengkap berlangsung lebih dari satu jam), skrip pendek digunakan dalam permintaan tarik.  Set lengkap pengujian diluncurkan di wizard setiap 4 jam. <br><br>  Hingga saat ini, 6.600 pull-quest telah dibuat dan diadakan sedemikian rupa. <br><br><img src="https://habrastorage.org/webt/sh/io/7k/shio7kkx60nm-urpb2sx97z9w0s.jpeg"><br><br><h4>  Pengiriman terus menerus </h4><br>  Kami menggunakan konsep rilis harian otomatis (atau lebih tepatnya harian).  Bagaimana tepatnya hal ini terjadi: <br><br><ol><li>  tag git dibuat, </li><li>  itu menjalankan versi lengkap dari semua tes, </li><li>  jika berhasil, artefak dikumpulkan: </li></ol><br><ul><li>  editor untuk MacOS dan Windows.  Jadi, setiap pagi setiap orang memiliki versi alat yang baru.  Dan, berkat pengujian otomatis, kami yakin akan kualitas dan stabilitasnya. </li><li>  klien game dan server untuk semua platform.  Klien untuk iOS diunggah ke TestFlight, untuk Android - ke Google Play, platform lain - ke JFrog Artifactory, server game, dan layanan lainnya - ke cloud.  Artinya, setiap pagi kami memiliki versi baru dari permainan, siap untuk pengujian dan uji coba. </li></ul><br>  Tentu saja, tidak setiap rilis malam berakhir dengan sukses.  Beberapa tes mungkin gagal, atau kesalahan kritis akan terjadi pada permulaan aplikasi.  Dalam hal ini, masalah yang ditemukan diperbaiki oleh pengembang yang bertugas siang hari dan proses rilis dimulai kembali. <br>  Ada beberapa yang bertugas setiap hari: <br><br><ol><li>  Petugas tingkat 1.  Mengawasi stabilitas tes dalam repositori utama. </li><li>  Petugas level 2 di game.  Memperbaiki bug game. </li><li>  Petugas level 2 di redaksi.  Memperbaiki bug editorial, menyarankan pengguna (artis, desainer level, desainer game). </li></ol><br>  Juga pada hari tugas, Anda dapat terlibat dalam hutang teknis: tambahkan tes yang hilang untuk fungsi lama, melengkapi dokumentasi, atau melakukan refactoring, yang tidak memakan waktu selama perencanaan rilis biasa. <br><br><img src="https://habrastorage.org/webt/bu/kf/w-/bukfw-ef19i1in1woa5ozjxgecm.jpeg"><br><br>  Pada artikel selanjutnya, kita akan melihat lebih dekat arsitektur perangkat lunak dari mesin itu sendiri, serta modul utama dan subsistemnya. <br><br>  Dilanjutkan ... <br><br>  Bagian pertama: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/en/post/461623</a> <br><br><img src="https://habrastorage.org/webt/ic/l2/m8/icl2m8bbkuivjomsbt8ugzsibus.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id465343/">https://habr.com/ru/post/id465343/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id465323/index.html">Apa yang akan menjadi kriptografi pasca-kuantum?</a></li>
<li><a href="../id465325/index.html">Benda spesial yang sulit untuk direbut robot</a></li>
<li><a href="../id465329/index.html">Model pembelajaran mesin yang diinterpretasikan. Bagian 2</a></li>
<li><a href="../id465333/index.html">Cara melihat ke mata Cassandra dan tidak kehilangan data, stabilitas, dan kepercayaan pada NoSQL</a></li>
<li><a href="../id465341/index.html">Cara membuat cloud pribadi untuk pengawasan video</a></li>
<li><a href="../id465345/index.html">Acara Mempekerjakan FunCorp Mobile</a></li>
<li><a href="../id465349/index.html">Apakah Anda memerlukan Agile: 5 model untuk diuji</a></li>
<li><a href="../id465351/index.html">Masalah umum bagi mereka yang memenangkan Gostender</a></li>
<li><a href="../id465353/index.html">Audit Keamanan ICS</a></li>
<li><a href="../id465355/index.html">Ketika 'a' tidak sama dengan 'a'. Setelah satu retasan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>