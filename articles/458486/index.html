<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÜ ü§πüèæ üèïÔ∏è Secretos de trabajar con tela en el juego Alan Wake üë≤ üßíüèø üëè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[El programador de animaci√≥n de remedios Henrik Enquist cont√≥ c√≥mo su equipo cre√≥ una convincente simulaci√≥n de chaqueta de tweed del protagonista del...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Secretos de trabajar con tela en el juego Alan Wake</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458486/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c18/18e/a10/c1818ea10be738aafeb51e0157ad247b.jpg"></div><br>  <em>[El programador de animaci√≥n de remedios Henrik Enquist cont√≥ c√≥mo su equipo cre√≥ una convincente simulaci√≥n de chaqueta de tweed del protagonista del juego de suspenso y terror Alan Wake].</em> <br><br>  El personaje principal de nuestro thriller de acci√≥n es Alan Wake, un escritor atrapado en una pesadilla donde se ve obligado a luchar con fuerzas oscuras y resolver el misterio de la desaparici√≥n de su esposa.  No es un h√©roe de acci√≥n bien entrenado, sino una persona com√∫n. <br><br>  Para enfatizar el personaje, nuestro director de arte quer√≠a vestirlo con una vieja chaqueta de tweed con parches en los codos.  El juego tiene lugar en el entorno del mundo real, por lo tanto, a diferencia de un juego de fantas√≠a o un tirador espacial, los personajes est√°n limitados en las herramientas utilizadas.  Y esto significa que la ropa de nuestros personajes se vuelve mucho m√°s importante. <br><br>  Para transmitir la ilusi√≥n de una atm√≥sfera de suspenso, la chaqueta de Alan Wake debe ser lo m√°s cre√≠ble posible.  La chaqueta debe revolotear con el viento y agregar movimientos auxiliares al personaje cuando se mueva por el bosque.  Como programador, inmediatamente comenc√© a pensar en usar la simulaci√≥n de tejidos. <br><br>  La simulaci√≥n de tela se us√≥ en muchos juegos anteriores a nosotros, pero las t√©cnicas que a menudo se usan all√≠ daban la sensaci√≥n de seda o goma, materiales que no son adecuados para nosotros.  Recientemente, comenzaron a aparecer muy buenos sistemas de simulaci√≥n de tejidos de compa√±√≠as externas, pero en el momento en que necesit√°bamos una soluci√≥n estable, tales herramientas a√∫n no exist√≠an o no satisfac√≠an nuestras necesidades. <br><br>  En este art√≠culo, hablar√© sobre los problemas que tuvimos que enfrentar y sobre las soluciones para crear nuestra propia simulaci√≥n de tejidos. <br><a name="habracut"></a><br><h1>  Plataforma de la chaqueta </h1><br>  La chaqueta fue modelada junto con el resto del personaje como una malla de pelado regular.  Los huesos que controlan la malla de la chaqueta son una capa separada en la parte superior de un esqueleto regular.  Las mangas de la chaqueta usan el patr√≥n habitual para el hombro y el antebrazo.  Tanto los hombros como los antebrazos se dividen en un hueso principal y un hueso doblado.  La parte superior de la chaqueta est√° controlada por restricciones de observaci√≥n, y la parte inferior est√° controlada por la simulaci√≥n Verlet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c2/6a6/63c/0c26a663c171f554b18e4bd555601477.png"></div><br>  <strong>Figura 1. Chaqueta de plataforma en la parte superior de un esqueleto de juego normal.</strong> <br><br><h1>  Parte superior de la chaqueta </h1><br>  Los huesos de la chaqueta tienen una jerarqu√≠a que va de arriba a abajo (los inferiores son hijos de los superiores), de modo que cuando los huesos superiores se mueven, los huesos inferiores los siguen.  Estuvimos tentados de hacer que la hija de los huesos inferiores fuera directamente hacia el cofre, pero eso causar√≠a una p√©rdida de movimiento, especialmente movimiento vertical, cuando el personaje levanta los hombros. <br><br>  En la parte superior de la chaqueta, simulamos el movimiento de las almohadillas en los hombros, moviendo los huesos de los hombros con la ayuda de restricciones de observaci√≥n hacia los huesos de los hombros.  Gracias a esto, las almohadillas siguen el hombro, y cuando levantas la mano, la almohadilla levanta el resto de los huesos, como en una chaqueta real. <br><br><div class="spoiler">  <b class="spoiler_title">Aspecto de la restricci√≥n de restricci√≥n de aspecto</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/206/2a0/3af/2062a03af21d6458b3d9b2a278223b83.gif" alt="imagen"></div><br>  <b>Costraint look-to aplicado al cono rojo</b> </div></div><br>  Los siguientes huesos de la cadena son la capa entre la parte superior de la chaqueta y la parte inferior simulada.  Estos huesos son impulsados ‚Äã‚Äãdirectamente por las restricciones de observaci√≥n hacia abajo para compensar la rotaci√≥n que crean los hombros.  Tambi√©n agregamos restricciones de posici√≥n entre los huesos izquierdo y derecho para compensar el estiramiento que ocurre cuando se mueven las hombreras. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/085/686/dc2/085686dc265664fe90ab7659a199f7e0.png"></div><br>  <strong>Figura 2. El movimiento de los huesos al levantar un personaje de mano.</strong> <br><br>  Esto podr√≠a ser suficiente para implementar las restricciones en el exportador de animaciones y hornear los resultados en los datos de animaci√≥n, pero a√∫n tratamos de controlar los huesos en el motor del juego en tiempo real. <br><br>  Gracias a esto, pudimos guardar algunos bytes en los datos de la animaci√≥n, as√≠ como transferir f√°cilmente animaciones entre los personajes, independientemente de si hay chaquetas en ellos.  Adem√°s, los movimientos del hombro generados por la cinem√°tica inversa del juego (por ejemplo, al momento de apuntar) al resolver restricciones en tiempo real se aplicar√≠an correctamente. <br><br><h1>  La parte inferior de la chaqueta </h1><br>  Una vez resuelto el problema con la parte superior de la chaqueta, procedimos a simular la parte inferior.  La mayor√≠a de las simulaciones de juegos de telas usan una uni√≥n uno a uno entre los v√©rtices en la simulaci√≥n de tejido y los v√©rtices de la malla renderizada. <br><br>  Quer√≠amos mantener la precisi√≥n de la malla de la chaqueta para que no interfiriera con ninguna restricci√≥n definida por el programador.  Por ejemplo, si decidi√©ramos usar la misma malla para la simulaci√≥n de tela que para el renderizado, entonces la silueta de los bolsillos y el frente de la chaqueta se perder√≠a. <br><br>  Los mapas normales podr√≠an usarse para dar volumen a la chaqueta, pero sentimos que eso no ser√≠a suficiente.  Quer√≠amos que nuestros artistas modelaran la chaqueta como la quer√≠an, y luego les permitimos usar mapas normales para agregar pliegues u otros detalles, en lugar de compensar la geometr√≠a perdida. <br><br>  Llegamos a esta decisi√≥n: crear una malla de tela de baja resoluci√≥n para simular una chaqueta y luego unirla a los huesos del esqueleto que se usa para controlar la malla de desollar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/011/cf3/4e2/011cf34e28fedf303ecc5a62ee15a7b0.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f4/bd8/582/2f4bd8582bc2c876c24a6a0663784938.png"></div><br>  <strong>Figura 3. Comparaci√≥n de las siluetas de nuestra chaqueta y tela que tiene los mismos v√©rtices con una simulaci√≥n.</strong> <br><br><h1>  F√≠sica Werle </h1><br>  Primero miramos la f√≠sica de Verlet, y luego aprendemos c√≥mo crear una coincidencia para la simulaci√≥n de huesos.  Verl√© Physics es actualmente la soluci√≥n est√°ndar para simular tejidos en juegos.  Si no est√° familiarizado con la t√©cnica Verlet, para empezar, le recomiendo leer uno de estos art√≠culos sobre Gamasutra: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><u>Diablo en el vestido facetado azul: Animaci√≥n de tela en tiempo real</u></a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><u>F√≠sica avanzada de personajes</u></a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c62/348/0d0/c623480d0de44a9ae1041f6c2ba9a5e0.png"></div><br>  <strong>Figura 4. Una cuadr√≠cula de v√©rtices 4x4 y restricciones para uno de los v√©rtices.</strong> <br><br>  Por lo dem√°s, repetir√© brevemente el principio del trabajo.  La Figura 4 muestra una malla de tela y restricciones de resorte para uno de sus v√©rtices.  Como puede ver en la figura, cada v√©rtice de malla est√° conectado a todos los v√©rtices vecinos, as√≠ como a sus vecinos. <br><br>  Las restricciones de los vecinos inmediatos se denominan restricciones de estiramiento y se indican en azul.  Las restricciones largas indicadas en rojo se denominan restricciones de cizallamiento / plegado. <br><br>  Es importante almacenar estas restricciones en dos grupos, porque luego las resolveremos con diferentes par√°metros.  Tenga en cuenta que en nuestra chaqueta, la fila superior de puntos de tela est√° unida al personaje mediante desollado y no ser√° controlada por la simulaci√≥n. <br><br>  La presencia de una malla no es un requisito del algoritmo en s√≠ mismo, sin embargo, para simular un tejido con dicha topolog√≠a, es m√°s f√°cil trabajar con √©l.  La base de la simulaci√≥n de tejidos consta de dos partes.  La primera parte es la integraci√≥n de Verlet, en la que calculamos la velocidad de cada v√©rtice y la aplicamos a la posici√≥n. <br><br><pre><code class="cpp hljs">Vector3 vVelocity = vertex.vCurrentPosition - vertex.vPreviousPosition; vertex.vPreviousPosition = vertex.vCurrentPosition; vertex.vCurrentPosition += vVelocity * ( <span class="hljs-number"><span class="hljs-number">1.0f</span></span> - fDampingFactor ) + vAcceleration * fDeltaTime * fDeltaTime;</code> </pre> <br>  En nuestro proyecto, <code>vAcceleration</code> fue establecido por la suma de la fuerza gravitacional y el viento.  La atenuaci√≥n se utiliz√≥ para ajustar la apariencia de la chaqueta y estabilizar la simulaci√≥n.  Un factor de amortiguaci√≥n alto <code>fDampingFactor</code> le da a la chaqueta la sensaci√≥n de que la tela muy ligera desciende lenta y suavemente, mientras que un factor de amortiguaci√≥n bajo hace que la chaqueta sea m√°s pesada, haciendo que se balancee / oscile por m√°s tiempo despu√©s del movimiento. <br><br>  La segunda parte del algoritmo es la resoluci√≥n de restricciones de resorte (este proceso se llama relajaci√≥n).  Para cada restricci√≥n, atraemos o rechazamos los v√©rtices entre s√≠ para que satisfagan sus longitudes originales.  Aqu√≠ hay un fragmento de c√≥digo legible. <br><br><pre> <code class="cpp hljs">Vector3 vDelta = constraint.m_vertex1.m_vCurPos - constraint.m_vertex0.m_vCurPos; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fLength = vDelta.length(); vDelta.normalize(); Vector3 vOffset = vDelta * ( fLength - constraint.m_fRestLength ); constraint.m_vertex0.m_vCurrentPosition += vOffset / <span class="hljs-number"><span class="hljs-number">2.0f</span></span>; constraint.m_vertex1.m_vCurrentPosition -= vOffset / <span class="hljs-number"><span class="hljs-number">2.0f</span></span>;</code> </pre> <br>  Las restricciones de estiramiento mantienen unidas las partes superiores de la tela, y las restricciones de inclinaci√≥n / flexi√≥n ayudan a mantener la forma de la tela.  Como puede ver, con una soluci√≥n ideal para este sistema, la tela se mover√° demasiado fuerte.  Es por eso que, antes de resolver nuevas posiciones, agregamos un coeficiente a las restricciones de inclinaci√≥n / flexi√≥n. <br><br><pre> <code class="cpp hljs">vOffset *= fStiffness; constraint.m_vertex0.m_vCurrentPosition += vOffset / <span class="hljs-number"><span class="hljs-number">2.0f</span></span>; constraint.m_vertex1.m_vCurrentPosition -= vOffset / <span class="hljs-number"><span class="hljs-number">2.0f</span></span>;</code> </pre> <br>  Con un coeficiente de rigidez de 1.0, la tela no ser√° flexible y, a 0.0, la tela se doblar√° sin restricciones. <br><br><h1>  Paso de tiempo fijo </h1><br>  Ya debe haber notado que la integraci√≥n de Verlet sugiere que el paso de tiempo anterior era exactamente el mismo que el actual;  de lo contrario, la velocidad calculada ser√° incorrecta.  Cuando se utiliza la integraci√≥n Verlet, se puede prescindir de un paso de tiempo variable, pero la resoluci√≥n de las restricciones es muy sensible a los cambios en el paso de tiempo. <br><br>  Como el solucionador resuelve el problema al eludir de forma iterativa las restricciones, nunca se pueden resolver de manera ideal.  En el juego, esta imprecisi√≥n se manifestar√° como un estiramiento, y cuanto m√°s corto sea el tiempo, menos estiramiento ver√° el jugador. <br><br>  En √∫ltima instancia, esto ser√° un compromiso entre la precisi√≥n y la cantidad de tiempo de procesador que puede dedicar a la ropa.  Si el paso de tiempo no es constante, el estiramiento de la ropa variar√° e introduciremos vibraciones no deseadas en el sistema.  M√°s importante a√∫n, el paso de tiempo afectar√° el indicador de rigidez y otros par√°metros de la tela: cuanto m√°s corto sea el paso de tiempo, m√°s r√≠gida ser√° la tela, incluso cuando se use el mismo coeficiente de rigidez. <br><br>  En la pr√°ctica, esto significa que antes de comenzar a personalizar la apariencia de la ropa con la ayuda de los par√°metros de la tela, usted mismo debe decidir sobre un paso de tiempo fijo.  S√© que hay juegos en los que se usa un paso de tiempo variable para la f√≠sica, pero mi experiencia personal me dice que la vida se vuelve mucho m√°s f√°cil cuando se fija el paso de tiempo tanto para la f√≠sica como para la l√≥gica del juego. <br><br><h1>  Campana </h1><br>  Antes de entrar en los detalles de la simulaci√≥n de tejidos, echemos un vistazo r√°pido a c√≥mo se simula la campana.  Para desollar la parte superior de la malla de la capucha, utilizamos un hueso extra.  Creamos un p√©ndulo desde el centro del hueso hasta la posici√≥n detr√°s del cap√≥.  El final del p√©ndulo es una part√≠cula controlada por la f√≠sica de Verlet.  Luego, usando una restricci√≥n de observaci√≥n, el hueso se dirige hacia el p√©ndulo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/090/fdf/57a/090fdf57a84edb44d5db943b1430f2b8.png"></div><br>  <strong>Figura 5. Capucha y p√©ndulo.</strong> <br><br><h1>  Creando matrices √≥seas </h1><br>  La capucha nos da una pista sobre qu√© hacer a continuaci√≥n con la parte inferior de la chaqueta.  Usaremos las posiciones de v√©rtice en la malla simulada para calcular las transformaciones √≥seas. <br><br>  Lo primero que hacemos es mapear los huesos para que la bisagra de cada hueso coincida con la parte superior de la malla simulada.  Debido a esto, la tarea de la parte de la matriz relacionada con el desplazamiento ser√° un proceso trivial. <br><br>  Luego necesitamos calcular la matriz de rotaci√≥n 3x3.  Cada fila (o columna, seg√∫n la configuraci√≥n de la matriz) est√° definida por los ejes x, y y z del hueso. <br><br>  Definimos el eje x del hueso como la direcci√≥n desde el v√©rtice base hasta el siguiente debajo de √©l.  Luego, el eje y se define por el vector desde el v√©rtice de la izquierda hasta el v√©rtice de la derecha. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0d/ba1/428/c0dba1428673d304dc5119e43e96e92e.png"></div><br>  <strong>Figura 6. Huesos unidos a la malla de tela.</strong> <br><br>  En la Figura 6, el eje x se muestra en rojo y el eje y se muestra en verde.  Luego, el eje z se calcula como el producto vectorial de estos vectores.  Al final, tambi√©n ortonormalizamos la matriz para eliminar la distorsi√≥n en los datos de desplazamiento. <br><br>  Como puede ver, en la direcci√≥n vertical, usamos cada fila de la malla de tela (excepto la √∫ltima) para ajustar los huesos, pero en la direcci√≥n horizontal solo se usa cada segunda columna.  Adem√°s del hecho de que ofrece las ventajas art√≠sticas descritas anteriormente, este m√©todo tambi√©n es bastante r√°pido.  Gracias a esto, se pueden usar t√©cnicas de skinning tradicionales en el lado de la GPU para renderizar la malla, porque de lo contrario tendr√≠amos que actualizar el enorme buffer din√°mico de v√©rtices. <br><br>  Una malla de tela puede tener una resoluci√≥n bastante baja, lo que reduce la carga en la CPU.  El √∫nico costo adicional para nuestra soluci√≥n es convertir la simulaci√≥n de baja resoluci√≥n en una malla de alta resoluci√≥n, pero en nuestro esquema estos costos ser√°n insignificantes en comparaci√≥n con el resto de la simulaci√≥n. <br><br><h1>  Colisiones </h1><br>  Para resolver el problema de recortar tejido con piernas y cuerpo, utilizamos el reconocimiento de colisiones entre un elipsoide y una part√≠cula.  La Figura 7 muestra los elipsoides necesarios para resolver el truncamiento de una chaqueta por un modelo de personaje. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a4a/277/f0c/a4a277f0c2991b0a013d821a8879ecea.jpg"></div><br>  <strong>Figura 7. El sistema elipsoide para el modelo Wake.</strong> <br><br>  El reconocimiento de colisiones de elipsoides con part√≠culas es muy r√°pido.  Las colisiones se pueden resolver transformando el espacio en el que existen el elipsoide y la part√≠cula, de modo que el elipsoide se convierta en una esfera.  Luego puede realizar una prueba r√°pida de colisi√≥n de la esfera y la part√≠cula. <br><br>  En la pr√°ctica, esto se acompa√±a de la creaci√≥n de una transformaci√≥n inversa basada en los valores de la longitud, el ancho y la altura del elipsoide con su aplicaci√≥n a la posici√≥n de la part√≠cula.  El √∫nico problema aqu√≠ es que la colisi√≥n normal que tenemos despu√©s de convertir de nuevo al sistema de coordenadas original est√° distorsionada. <br><br>  Decidimos que podr√≠amos llegar a un acuerdo con una ligera imprecisi√≥n en el c√°lculo de la direcci√≥n de la colisi√≥n.  En los casos en que un elipsoide fuertemente estirado podr√≠a causar reacciones incorrectas, lo dividimos en dos m√°s homog√©neas. <br><br><h1>  La distancia m√°xima a la part√≠cula. </h1><br>  Otro problema que deb√≠a resolverse era la estabilidad de la chaqueta.  El tejido durante el movimiento r√°pido podr√≠a causar la creaci√≥n de nodos o aparecer en el otro lado del volumen de colisiones y pasar a trav√©s del cuerpo.  Resolvimos este problema estableciendo una distancia segura para cada v√©rtice del tejido simulado. <br><br>  Para cada v√©rtice, la posici√≥n de reposo inicial por desollado se une al hueso m√°s cercano y lo usamos como punto de referencia.  Si la simulaci√≥n excede el valor umbral, simplemente movemos el v√©rtice m√°s cerca del punto de referencia.  En nuestro dise√±o, permitimos que los picos de abajo se muevan una mayor distancia que los picos m√°s cerca de los hombros. <br><br>  La distancia m√°xima que podemos permitir que se muevan los picos es de aproximadamente 40 cm, cuando se excede este valor, comienzan a aparecer casos raros de nodos y truncamiento.  Tambi√©n intentamos usar otras t√©cnicas, por ejemplo, planos de colisi√≥n, pero el m√©todo de distancia m√°xima result√≥ ser el mejor.  Fue r√°pido, f√°cil de configurar y proporcion√≥ la mayor libertad de movimiento antes de que aparecieran errores notables en la tela. <br><br><h1>  M√°s tweed, menos goma </h1><br>  Hasta ahora, hemos podido encontrar buenas maneras de lograr nuestros objetivos.  Nuestro artista model√≥ su chaqueta como a √©l le gustaba;  para animar la chaqueta, no se necesitaba un animador, porque todo estaba simulado en el juego, y el procesador estaba satisfecho de que tuvi√©ramos suficientes recursos para otros c√°lculos en el juego.  Pero una cosa nos molest√≥: la tela parec√≠a goma. <br><br><h1>  Estiramiento de lucha </h1><br>  Primero, necesitamos deshacernos del estiramiento.  Como dije anteriormente, el fen√≥meno del estiramiento es causado por errores que aparecen debido a la naturaleza iterativa del algoritmo.  Este es un tema de investigaci√≥n popular y se pueden encontrar muchos m√©todos para resolver este problema. <br><br>  Desafortunadamente, todas las soluciones disponibles nos obligar√≠an a asignar recursos de CPU mucho m√°s escasos para los c√°lculos de tejido.  Por lo tanto, resolvimos el problema del estiramiento agregando el √∫ltimo paso a la simulaci√≥n de tejido, en la cual se aplican las llamadas "restricciones duras". <br><br>  Hicimos restricciones estrictas sobre las restricciones de estiramiento (todas est√°n dirigidas verticalmente).  Estas restricciones se ordenaron de arriba a abajo para que las restricciones cerca de los hombros se resolvieran a las restricciones cerca de las piernas. <br><br>  Como iteramos sobre las restricciones desde arriba, sabemos que el v√©rtice superior del par ya se ha resuelto y no causa ning√∫n estiramiento, por lo que solo debemos mover el v√©rtice inferior hacia el superior.  Gracias a esto, podemos estar seguros de que despu√©s de una sola iteraci√≥n, la longitud de arriba a abajo ser√° exactamente la misma que la longitud en reposo. <br><br><pre> <code class="cpp hljs">Vector3 vDelta = constraint.m_vertexTop.m_vCurPos - constraint.m_vertexDown.m_vCurPos; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fLength = vDelta.length(); vDelta.normalize(); Vector3 vOffset = vDelta * ( fLength - constraint.m_fRestLength ); constraint.m_vertexDown.m_vCurrentPosition += vOffset;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c7e/84c/a2a/c7e84ca2afe73e36a6c4c89a01fbec14.png"></div><br>  <strong>Figura 8. Restricciones estrictas.</strong> <br><br>  Como puede ver, no tenemos en cuenta el estiramiento horizontal de la chaqueta.  Es imposible aplicar restricciones estrictas a la direcci√≥n horizontal, porque en este caso el v√©rtice se resolver√° dos veces, es decir, perderemos los resultados de la etapa de c√°lculo vertical y la longitud de la tela no se mantendr√° en reposo. <br><br>  Sin embargo, notamos que en el caso de una chaqueta, el estiramiento horizontal en realidad permanece invisible para el ojo humano, y debido al estiramiento vertical, la chaqueta se ve muy mal.  Esta soluci√≥n result√≥ ser bastante buena. <br><br><h1>  Bordes de la chaqueta </h1><br>  En segundo lugar, quer√≠amos que los bordes de la chaqueta se movieran un poco m√°s que el resto.  Por ejemplo, si corre en una chaqueta abierta, notar√° que la resistencia al aire afecta m√°s los bordes de la chaqueta que la parte central.  Esto se debe a que tu cuerpo cubre el resto de la chaqueta del viento. <br><br>  Los bordes se pueden encontrar f√°cilmente por la cantidad de restricciones adjuntas a ellos.  Cualquier v√©rtice que tenga menos de cuatro restricciones de estiramiento es un borde.  Por lo tanto, podemos marcar estos v√©rtices y simularlos con otros par√°metros. <br><br><ul><li>  Atenuaci√≥n reducida. </li><li>  El viento global tiene un mayor impacto. </li><li>  El movimiento en el espacio mundial tiene un mayor impacto (para m√°s informaci√≥n sobre el movimiento en el espacio mundial, ver m√°s abajo). </li><li>  La distancia de seguridad m√°xima permitida es mayor. </li></ul><br>  Debido a esto, la frecuencia interna de los bordes ser√° diferente del resto de la chaqueta.  Ahora toda la chaqueta no responde a impulsos como un p√©ndulo grande, y solo los bordes agregan un hermoso movimiento auxiliar al movimiento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d8/31a/db6/8d831adb6fe8481e9b05830abf71e555.png"></div><br>  <strong>Figura 9. La parte superior de los bordes.</strong> <br><br><h1>  Movimiento en el espacio mundial y en el espacio local. </h1><br>  Luego notamos que al mover un personaje, el movimiento en el espacio mundial tiene un efecto bastante grande en la simulaci√≥n, mientras que los peque√±os movimientos locales del cuerpo o los movimientos del hombro pasan desapercibidos. <br><br>  En una simulaci√≥n de tejido tradicional, las posiciones de los v√©rtices se simulan en el espacio mundial.  Alguien puede decir que simular el tejido es correcto, pero se siente poco natural.  Por lo tanto, simulamos una chaqueta sobre personajes en el espacio local y por separado agregamos un peque√±o movimiento en el espacio mundial.  Notamos que los resultados que necesitamos se obtienen con una animaci√≥n 100% local del esqueleto con un movimiento del 10-30% en el espacio mundial. <br><br><h1>  Fricci√≥n </h1><br>  Y finalmente, quer√≠amos exagerar el contraste entre la chaqueta en movimiento lento y r√°pido.  Quer√≠amos que la chaqueta estuviera relativamente inm√≥vil al caminar, y cuando Alan salta o esquiva, el movimiento deber√≠a ser m√°s animado. <br><br>  Pensamos que cuando la chaqueta toca el cuerpo, debe moverse menos debido a la fricci√≥n entre la chaqueta y la camisa, y cuando la chaqueta se levanta, debe moverse m√°s fuerte porque nada lo restringe.  Simulamos esto aplicando un mayor valor de atenuaci√≥n a cada v√©rtice que toca el elipsoide.  Gracias a esto, las partes superiores que tocan el cuerpo aparecer√°n un poco pegajosas, creando suficiente contraste entre la chaqueta en situaciones normales y en movimientos r√°pidos. <br><br><h1>  Conclusi√≥n y trabajo adicional. </h1><br>  La primera forma de realizaci√≥n de la simulaci√≥n de tejidos fue bastante simple de implementar: solo buscamos la palabra "tejido" en la literatura de desarrollo de juegos y aplicamos los algoritmos que encontramos.  La segunda etapa, en la que tratamos de lograr una sensaci√≥n convincente de una chaqueta de tweed, requiri√≥ el estudio de art√≠culos cient√≠ficos, muchas pruebas y errores, e incluso la eliminaci√≥n de parte del c√≥digo. <br><br>  Por supuesto, siempre puedes mejorar algo.  Por ejemplo, usar simulaci√≥n de baja resoluci√≥n y vincularlo a una malla de alta resoluci√≥n complica la soluci√≥n al problema de todas las truncaciones.  No tuvimos tiempo suficiente para otros peque√±os detalles: por ejemplo, estas son tarjetas plegables en los lugares de los pliegues de la chaqueta o la implementaci√≥n de la interacci√≥n correcta entre la chaqueta y el tornado. <br><br>  En √∫ltima instancia, nuestros esfuerzos dieron sus frutos: nuestro tejido es muy diferente de la simulaci√≥n de tejidos en otros juegos.  Se parece mucho m√°s a un tweed que a la seda o el caucho.  Adem√°s, nuestro sistema result√≥ ser muy flexible y nos permiti√≥ simular otras telas, por ejemplo, la chaqueta de Barry Wheeler y el velo de la anciana.  Parece que al ajustar los par√°metros puede lograr la simulaci√≥n y otros tipos de tejido. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c18/18e/a10/c1818ea10be738aafeb51e0157ad247b.jpg"></div><br>  <strong>Figura 10. Chaqueta de tweed.</strong> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458486/">https://habr.com/ru/post/458486/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458468/index.html">¬øC√≥mo ejecutar una impresionante reuni√≥n de Kanban StandUp?</a></li>
<li><a href="../458470/index.html">Texturizado, o lo que necesitas saber para convertirte en un Artista de Surface. Parte 2. M√°scaras y texturas.</a></li>
<li><a href="../458472/index.html">Compilaci√≥n de una clasificaci√≥n de territorios por el m√©todo de potenciales t√©rmicos utilizando datos abiertos</a></li>
<li><a href="../458474/index.html">Los mejores informes con HighLoad ++ 2018</a></li>
<li><a href="../458482/index.html">Parte 3: Casi cargando Linux desde una tarjeta SD a RocketChip</a></li>
<li><a href="../458488/index.html">Data Science Digest (julio de 2019)</a></li>
<li><a href="../458490/index.html">Ag√°rrate fuerte al volante ... Nuestro proyecto para monitorear la condici√≥n de los conductores</a></li>
<li><a href="../458492/index.html">‚ÄúSiempre cre√≠mos en la competencia y en el derecho a elegir un usuario‚Äù ¬© Yandex</a></li>
<li><a href="../458494/index.html">Un ejemplo pr√°ctico del uso de las funciones de render de Vue: crear una cuadr√≠cula tipogr√°fica para un sistema de dise√±o</a></li>
<li><a href="../458496/index.html">Directrices pr√°cticas para desarrollar aplicaciones React a gran escala. Planificaci√≥n, acciones, or√≠genes de datos y API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>