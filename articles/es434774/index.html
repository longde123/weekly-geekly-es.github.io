<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🉑 💃🏼 👩🏼‍🏫 5 lecciones que aprendimos al escribir más de 300,000 líneas de código de infraestructura 👩‍❤️‍👩 🧑🏾‍🤝‍🧑🏽 💞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una breve clase magistral sobre el desarrollo de código de infraestructura 





 En octubre de este año, hice una presentación en la conferencia Hash...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>5 lecciones que aprendimos al escribir más de 300,000 líneas de código de infraestructura</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/434774/"><h3 id="kratkiy-master-klass-po-razrabotke-infrastrukturnogo-koda">  Una breve clase magistral sobre el desarrollo de código de infraestructura </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1f2/0b9/17f/1f20b917f7f598d845324b4b8ce18bbf.jpg" alt="imagen"></p><br><p>  En octubre de este año, hice una presentación en la conferencia HashiConf 2018, donde hablé sobre 5 lecciones clave que yo y mis colegas de Gruntwork aprendimos en el proceso de crear y mantener una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca de más de 300,000 líneas de código de infraestructura</a> utilizadas por cientos de empresas en sistemas de producción.  En esta publicación, compartiré videos y diapositivas de la presentación, así como una versión resumida de la descripción de las 5 lecciones principales. </p><br><h3 id="video-i-slaydy">  Videos y diapositivas </h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RTEgE2lcyk4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3 id="vstuplenie-devops-seychas--v-kamennom-veke">  Introducción: DevOps ahora en la Edad de Piedra </h3><br><p>  A pesar del hecho de que la industria está llena de palabras progresivas de moda: Kubernetes, microservicios, redes de servicios, infraestructura inmutable, big data, lagos de datos, etc., la realidad es que cuando estás inmerso en la creación de infraestructura, no sientes tan de moda y progresista. </p><a name="habracut"></a><br><p>  Personalmente, DevOps me recuerda más de esto: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/299/9f7/51e/2999f751eb309e5f9ee967deb56fb907.jpg" alt="imagen"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2a0/ddc/a9d/2a0ddca9d9f1ee2f83e1130e84788fb2.jpg" alt="imagen"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9d2/69e/1b4/9d269e1b44d8bd7bc65cc35accd2531f.jpg" alt="imagen"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/dad/458/a97/dad458a97d189cfad6ec939a535f1722.jpg" alt="imagen"></p><br><p>  Crear infraestructura a nivel de producción es difícil.  Este es el verdadero estrés.  Y come mucho tiempo.  Mucho tiempo </p><br><p>  Muestra cuánto tiempo llevará implementar el próximo proyecto de infraestructura.  Nos basamos en datos empíricos que recopilamos en el curso del trabajo con cientos de empresas diferentes: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e1b/84c/72c/e1b84c72c3dfa22ddbe8653f94e38fa9.png" alt="imagen"></p><br><h3 id="urok-1-cheklist-dlya-infrastruktury-proizvodstvennogo-urovnya">  Lección 1. Lista de verificación para la infraestructura de fabricación </h3><br><p>  Los proyectos DevOps siempre tardan más de lo esperado.  Siempre.  Por qué <br>  La primera razón es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">corte de pelo de yak</a> .  A continuación se muestra una ilustración vívida de este fenómeno (este es un extracto de la serie "Malcolm in the Spotlight") </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  La segunda razón es que el proceso de creación de una infraestructura de nivel de producción (por ejemplo, la infraestructura en la que pondría su empresa) consta de miles de piezas pequeñas.  La gran mayoría de los desarrolladores no conocen estos detalles, por lo tanto, al evaluar un proyecto, generalmente se olvida de muchas tareas críticas (y que requieren mucho tiempo). <br>  Para evitar esto, cada vez que comience a trabajar en una nueva sección de la infraestructura, use la siguiente lista de verificación: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/o2/xu/wu/o2xuwumkfwrh9epcydpmk-b76ru.jpeg"></a> </p><br><p>  No todos los elementos de la lista serán necesarios para cada pieza individual de infraestructura, pero debe documentar consciente y explícitamente qué elementos implementó y cuáles decidió omitir y por qué. </p><br><h3 id="urok-2-nabor-instrumentov">  Lección 2. Caja de herramientas </h3><br><p>  Enumeramos las principales herramientas que utilizamos en Gruntwork para crear y administrar infraestructura (a partir de 2018): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9c/656/c19/b9c656c197abcd9892102cc947e525fa.png" alt="imagen"></p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Terraform</a>  Usamos Terraform para desplegar toda la infraestructura subyacente, incluida la red, los subsistemas de equilibrio de carga, las bases de datos, las herramientas de administración de usuarios y permisos y todos nuestros servidores. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Packer</a>  Utilizamos Packer para configurar y crear imágenes de máquinas virtuales que ejecutamos en nuestros servidores. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Docker</a>  Algunos de nuestros servidores forman clústeres donde ejecutamos aplicaciones como contenedores Docker.  Para los clústeres de Docker, utilizamos principalmente las siguientes herramientas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kubernetes</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ECS</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fargate</a> . </li></ul><br><p>  Todas estas herramientas son útiles, pero ese no es el punto.  Debe comprender que algunas herramientas no son suficientes.  También es necesario cambiar el comportamiento del equipo. </p><br><p>  En particular, incluso las mejores herramientas del mundo no ayudarán a su equipo si no quieren usarlas o si no tienen el tiempo suficiente para aprender cómo usarlas.  Por lo tanto, la conclusión clave es que el uso de "infraestructura como código" es una inversión, es decir, se le requerirán ciertos costos iniciales.  Si invierte sabiamente, recibirá grandes dividendos a largo plazo. </p><br><h3 id="urok-3-bolshie-moduli--eto-zlo">  Lección 3. Los módulos grandes son malos </h3><br><p>  Los recién llegados a la aplicación de "infraestructura como código" a menudo definen toda su infraestructura para todos sus entornos (entorno de desarrollo, entorno intermedio, entorno de producción, etc.) en un archivo o un conjunto de archivos que se implementan como un todo.  En vano </p><br><p>  Estas son solo algunas de las desventajas de este enfoque: </p><br><ul><li> <strong>Baja velocidad</strong>  Si toda la infraestructura se define en un solo lugar, la ejecución de cualquier comando tomará mucho tiempo.  ¡Enfrentamos situaciones en las empresas cuando el equipo del <code>terraform plan</code> tardó 5-6 minutos en completarse! </li><li>  <strong>Baja seguridad</strong>  Si administra toda la infraestructura en conjunto, entonces para cambiar algo necesita permisos para acceder a todo.  Es decir, casi todos los usuarios deberían ser administradores, y esto también es muy inconveniente. </li><li>  <strong>Altos riesgos</strong>  Si coloca todos sus huevos en una canasta, cree una situación en la que un error local pueda interrumpir el funcionamiento de toda la infraestructura.  Por ejemplo, cuando realiza cambios menores en una aplicación externa en el entorno de desarrollo, un solo error tipográfico o un comando incorrecto puede provocar la eliminación de la base de datos de producción. </li><li>  <strong>Es dificil de entender</strong> .  Cuanto más código se coloca en un lugar, más difícil es para una persona entender todo esto.  Y cuando todo esto esté conectado, las partes incomprensibles jugarán una broma cruel contigo. </li><li>  <strong>Difícil de probar</strong> .  Probar el código de infraestructura es difícil;  probar grandes cantidades de código de infraestructura es casi imposible.  Volveremos a esto más tarde. </li><li>  <strong>Es difícil de analizar</strong> .  La salida de comandos como el plan de terraformación se vuelve inútil, ya que nadie se molesta en ver miles de líneas.  Además, el análisis de código se vuelve inútil. </li></ul><br><p>  En resumen, debe crear su código a partir de módulos compuestos pequeños, independientes y reutilizables.  Esto no es noticia ni descubrimiento.  Has escuchado esto miles de veces, aunque en situaciones ligeramente diferentes: </p><br><blockquote>  “Haz una cosa y hazlo bien” - Filosofía Unix. <br>  “La primera regla de funciones es que deberían ser pequeñas.  La segunda regla establece que las funciones deberían ser aún más pequeñas ".  - "Código limpio" </blockquote><br><h3 id="urok-4-infrastrukturnyy-kod-bez-avtomaticheskih-testov-neispraven">  Lección 4. El código de infraestructura sin pruebas automáticas es defectuoso </h3><br><p>  Si su código de infraestructura no tiene pruebas automatizadas, no funciona correctamente.  Simplemente no lo sabes aún.  Pero probar el código de infraestructura es difícil.  No tiene un "host local" (por ejemplo, no puede implementar la nube privada virtual de AWS VPC en su computadora portátil), ni "pruebas unitarias" reales (por ejemplo, no puede aislar el código Terraform del mundo "exterior", porque es como veces y está diseñado para comunicarse con el mundo exterior). </p><br><p>  Por lo tanto, para probar correctamente el código de infraestructura, generalmente debe implementarlo en un entorno real, ejecutar una infraestructura real, verificar que el código funciona y luego romperlo (para obtener una descripción de este estilo de prueba: consulte Terratest, esta es una biblioteca de código abierto que incluye herramientas para probar el código Terraform , Packer y Docker, trabajando con las API de AWS, GCP y Kubernetes, ejecutando comandos de shell localmente y en servidores remotos a través de SSH, así como muchas otras características).  Por lo tanto, al probar la infraestructura, debe redefinir ligeramente las condiciones: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e38/f8a/24d/e38f8a24dedcc2de2eec19291f885ccd.png" alt="imagen"></p><br><p>  <strong>Las pruebas unitarias</strong> implementan y prueban uno o más módulos de infraestructura estrechamente relacionados del mismo tipo (por ejemplo, módulos para una sola base de datos). </p><br><p>  <strong>Las pruebas de integración</strong> implementan y prueban varios módulos de infraestructura de varios tipos para verificar que funcionan juntos (por ejemplo, módulos de bases de datos y módulos de servicios web). </p><br><p>  <strong>Las pruebas de extremo a extremo</strong> (e2e) implementan y prueban toda la arquitectura. <br>  Tenga en cuenta que el diagrama es una pirámide: tenemos muchas pruebas unitarias, menos pruebas de integración y muy pocas pruebas e2e.  Por qué  Depende de la duración de cada tipo de prueba: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/071/040/730/07104073030dd617e05ad563d698e7b5.png" alt="imagen"></p><br><p>  Las pruebas de infraestructura toman mucho tiempo, especialmente en los niveles superiores de la pirámide, y, naturalmente, querrá encontrar y corregir tantos errores como sea posible en la parte inferior.  Para hacer esto, necesitas: </p><br><ol><li>  Cree módulos independientes pequeños y simples (consulte la Lección 3) y escriba muchas pruebas unitarias para ellos, asegúrese de que funcionen correctamente. </li><li>  Combine estos bloques pequeños, simples y probados para crear una infraestructura más sofisticada que pruebe con menos integración y pruebas E2E. </li></ol><br><h3 id="urok-5-process-reliza">  Lección 5. Proceso de lanzamiento </h3><br><p>  Para resumir todo lo anterior.  Así es como ahora creará y administrará su infraestructura: </p><br><ul><li>  Verifique la lista de verificación para la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">infraestructura de grado</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">producción</a> y asegúrese de estar trabajando en la dirección correcta. </li><li>  Defina su "infraestructura como código" con herramientas como Terraform, Packer y Docker.  Asegúrese de que su equipo tenga tiempo suficiente para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aprender</a> estas herramientas (ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Recursos de DevOps</a> ). </li><li>  Cree código a partir de módulos compuestos pequeños e independientes (o use módulos estándar de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la Infraestructura como biblioteca de códigos</a> ). </li><li>  Prepare pruebas automatizadas para sus módulos con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Terratest</a> . </li><li>  Complete la solicitud para incluir sus cambios para revisar su código. </li><li>  Lanza la nueva versión del código. </li><li>  Copie la nueva versión del código de un entorno a otro. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/43f/57b/1b6/43f57b1b6721ef8dd14eb583ffca2d66.png" alt="imagen"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es434774/">https://habr.com/ru/post/es434774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es434756/index.html">El futuro de Kubernetes es con máquinas virtuales.</a></li>
<li><a href="../es434758/index.html">Guía del moderador de Facebook: más de 1.400 páginas de diapositivas en conflicto</a></li>
<li><a href="../es434760/index.html">Resumen de noticias de PostgreSQL. Año nuevo (acortado) número 13</a></li>
<li><a href="../es434762/index.html">Notas de un fitoquímico. Plátano verde, o recuerde alimentar la microbiota</a></li>
<li><a href="../es434770/index.html">Energías renovables: palabras y su significado.</a></li>
<li><a href="../es434776/index.html">VK calcula tu ubicación por IP</a></li>
<li><a href="../es434780/index.html">La robotización puede conducir a la dictadura.</a></li>
<li><a href="../es434782/index.html">¿Cómo elegí un sistema CRM?</a></li>
<li><a href="../es434784/index.html">Cómo priorizar el desarrollo. Experiencia en la implementación de GIST + ICE en Yandex.Market</a></li>
<li><a href="../es434786/index.html">Siete plataformas automáticas gratuitas de resolución de problemas para nivelar habilidades de programación</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>