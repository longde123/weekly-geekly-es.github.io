<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤ üíÜüèø üåø Wie der Herzschlag klingt: Konvertieren des Papierkardiogramms in das WAV-Format üë© üôçüèº üçë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Viele Male musste eine Herzuntersuchung in medizinischen Einrichtungen mit einem Kardiographen durchgef√ºhrt werden. Dieses Ger√§t misst die bioelektris...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie der Herzschlag klingt: Konvertieren des Papierkardiogramms in das WAV-Format</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419527/"><img src="https://habrastorage.org/webt/vd/8i/cs/vd8icsdtkcxv6x3i-djvtgs6hrs.jpeg"><br>  Viele Male musste eine Herzuntersuchung in medizinischen Einrichtungen mit einem Kardiographen durchgef√ºhrt werden.  Dieses Ger√§t misst die bioelektrische Aktivit√§t des Herzens und zeichnet das Ergebnis auf einem Papierband auf.  Moderne Kardiographen zeichnen das Messergebnis nicht auf Papier, sondern im digitalen Speicher auf.  Papierband wird jedoch h√§ufig als endg√ºltiges Medium f√ºr aufgezeichnete Informationen verwendet.  Optisch handelt es sich um ein langes Millimeterpapier von geringer Breite, das zu einer Rolle verdreht wird.  Auf dem Papier wird zus√§tzlich zum Millimetergitter ein bestimmter Graph in voller L√§nge gezeichnet, der das Gesetz der zeitlichen √Ñnderung des Messwerts widerspiegelt.  Der gemessene Wert ist nach meinem Verst√§ndnis die Potentialdifferenz zwischen den Leitungen.  In den meisten F√§llen werden mehrere Diagramme gleichzeitig auf einem Band angezeigt, da potenzielle Unterschiede zwischen mehreren Ableitungen aufgezeichnet werden.  Ohne jedoch auf die Details der Medizin einzugehen, werden wir in Zukunft einen der ersten Hauptpl√§ne betrachten.  Zus√§tzlich zu den Grafiken enth√§lt das Band zus√§tzliche Textinformationen: horizontale Skala (mm / s), vertikale (mm / mV), gemessene Herzfrequenz (bpm) und mehr. <br><br>  Es gab die Idee, dieses Diagramm in ein Soundformat zu konvertieren, das Ergebnis zu reproduzieren und zu h√∂ren, wie es sich anh√∂rt. <br><a name="habracut"></a><br>  Nach vorl√§ufiger Analyse k√∂nnen wir schlie√üen, dass die Frequenzzusammensetzung einer solchen Welle nicht sehr ges√§ttigt ist.  Tats√§chlich handelt es sich hierbei um niedrige Frequenzen, einschlie√ülich Infraschall, der als unh√∂rbar angesehen wird.  Es wird jedoch m√∂glich sein zu sehen, wie der Tieft√∂nerkonus Schwingungen wiederholt, die den ‚ÄûSchwingungen‚Äú des Herzens √§hnlich sind.  Aufgrund des Vorhandenseins kapazitiver Differenzierungsschaltungen auf dem Signalausbreitungspfad von der PC-Soundkarte zum Bassverst√§rker wiederholen die Vibrationen des dynamischen Kopfes die auf dem Kardiogramm dargestellten Vibrationen nicht genau.  Und dies setzt voraus, dass Filter, die extrem niedrige Frequenzen abschneiden, nirgendwo installiert werden.  Dar√ºber hinaus treten nichtlineare Verzerrungen auf, die von mehreren hochfrequenten Harmonischen begleitet werden.  Unter Ber√ºcksichtigung der obigen Analyse stellen wir das Problem jedoch wie folgt dar: Konvertieren Sie das Diagramm auf Papier in das WAV-Format, sodass beim √ñffnen dieser Datei in einem Soundeditor die Wellenform der Papierversion entspricht und dar√ºber hinaus der Zeitskala entspricht. <br><br>  Zuerst m√ºssen Sie die Quantisierungstiefe (die Aufl√∂sung von digitalem Audio vertikal) sch√§tzen.  Ich betrachte einen der Standards: 8 oder 16 Bit.  Die zweite Option (16 Bit) sind 65536 vertikale Abtastwerte, die 65536 Pixel des Bildes entsprechen, bei dem es sich um einen Scan oder ein Foto eines Kardiogramms handelt.  Das ist viel und macht keinen Sinn.  Wenn Sie 8 Bit nehmen, sind dies 256 Samples oder 256 Pixel des Bildes.  Dies ist nun eine geeignetere Option.  In diesem Fall betr√§gt der Dynamikbereich des Audios 6 * 8 = 48 dB.  Ich wei√ü nicht, welchen Dynamikbereich das Kardiogramm hat, aber ich denke nicht mehr.  Das Ger√§t selbst ist nat√ºrlich gr√∂√üer, aber beim Anzeigen eines Kardiogramms auf Papier ist ein Fehler unvermeidlich, insbesondere beim direkten Zeichnen mit einem Stift.  √úbrigens √ºber Letzteres.  Ich werde alte Muster, die mit einem ‚Äûradialen‚Äú Stift gezeichnet wurden, nicht ber√ºcksichtigen.  Das Millimeter-Papierband f√ºr solche Kardiogramme ist spezifisch: Es werden vertikale B√∂gen anstelle von geraden Linien gezeichnet.  Die horizontale Skala - die Abtastrate - wird anhand der Skala des Kardiogramms und der Bildgr√∂√üe berechnet.  Die Wiedergabegeschwindigkeit h√§ngt von diesem Parameter ab und sollte der tats√§chlichen ‚ÄûKardiogrammgeschwindigkeit‚Äú entsprechen. <br><br>  Kardiogrammpapier sollte s / w mit Graustufen in ausreichender Aufl√∂sung gescannt werden.  Anschlie√üend m√ºssen Sie die Gr√∂√üe des Bilds so √§ndern, dass das gew√ºnschte Kardiogramm in einen Streifen mit einer Breite von 256 Pixel passt.  Ich habe im Internet viele Bilder mit Kardiogrammen gefunden.  Betrachten Sie als Beispiel zwei davon. <br><br><img src="https://habrastorage.org/webt/6a/ao/ve/6aaoveakfnrluqr-m-hybxevcly.jpeg"><br><br>  Das erste Bild, k√∂nnte man sagen, ist fast fertig.  Bildh√∂he - 431. Breite - 1023. Eine Welle √ºber die Breite f√ºllt das gesamte Bild vollst√§ndig aus.  Sie m√ºssen jedoch eine H√∂he von 256 belassen und das Bild oben und unten zuschneiden, damit sich die Welle ungef√§hr in der Mitte befindet. <br><br><img src="https://habrastorage.org/webt/1y/pl/9b/1ypl9b8u33wmyo2xa6cdkhbx9n0.png"><br><br>  Die zweite Abbildung zeigt mehrere Kardiogramme gleichzeitig.  Nimm den allerersten.  Nach dem Zuschneiden erhielten wir ein Bild von 508 mal 61. <br><br><img src="https://habrastorage.org/webt/od/sr/nc/odsrncybq1ghgyy1tmf-x7rxmh4.png"><br><br>  Ohne das Bild vertikal zu strecken, erstellen wir ein Bild mit einer H√∂he von 256 und f√ºllen den erstellten Bereich mit wei√üer Leere.  Die Welle sollte sich auch ungef√§hr in der Mitte befinden.  Beim Schneiden habe ich die Breite 508 so gew√§hlt, dass m√∂glichst viele ganzzahlige Millimeterzellen √ºbrig bleiben, die auch im Bild sichtbar sind. <br><br>  Beide Bilder m√ºssen in eine Ansicht konvertiert werden, in der nur ein schwarzes Diagramm auf wei√üem Hintergrund und sonst nichts sichtbar ist.  Dies geschieht auf elementare Weise.  Aufgrund der Tatsache, dass das Diagramm viel dicker als das Millimetergitter gezeichnet ist, k√∂nnen Sie im Grafikeditor mit den Einstellungen ‚ÄûHelligkeit, Kontrast, S√§ttigung‚Äú das gew√ºnschte Ergebnis erzielen.  Wenn die perfekte Konvertierung fehlschl√§gt, muss der √ºbersch√ºssige verbleibende ‚ÄûM√ºll‚Äú √ºber dem Diagramm mit dem Radiergummi entfernt werden.  Alle Bilder m√ºssen im monochromen BMP-Format gespeichert werden.  Somit bleiben definitiv nur wei√üe und schwarze Farben im Bild. <br><br>  Bevor Sie mit der Beschreibung des Algorithmus zum Konvertieren von Bildern in WAV beginnen, sollten Sie einige der Nuancen angeben, die die Programmierung vereinfachen.  Die resultierenden Bilder m√ºssen um 90 Grad gegen den Uhrzeigersinn gedreht werden (die Breite und H√∂he des Bildes √§ndern die Position).  Dies ist erforderlich, um den Anfang des Kardiogramms am Anfang der BMP-Datei auszurichten.  Es ist bekannt, dass die Farbdaten jedes Pixels in einer BMP-Datei ausgehend von der unteren linken Ecke zeilenweise in die Datei geschrieben werden.  Dann m√ºssen Sie die Bilder im Editor ‚ÄûMS Paint‚Äú (ich habe Windows XP) √∂ffnen und in 8-Bit-BMP (256 Farben) speichern.  Nat√ºrlich wird es eine "Neudefinition von Informationen" geben, aber bei diesem Format entspricht jedes Pixel im Bild einem Byte, was beim Programmieren sehr praktisch ist.  Byte "0" ist ein schwarzes Pixel und Byte "255" ist wei√ü.  Das Ergebnis sollte ungef√§hr so ‚Äã‚Äãaussehen (hier sind zwei Bilder verbunden und halbiert). <br><br><img src="https://habrastorage.org/webt/vr/cc/nh/vrccnhi1qkyegtfpanecxls5c40.jpeg"><br><br>  Das Ausgabeformat wird nicht in eine Standard-WAV-Datei, sondern in eine RAW-Datendatei (PCM) ausgegeben.  Dies vereinfacht auch die Programmierung, da Sie bei der Ausgabe an WAV immer noch auf den 44-Byte-Header achten m√ºssen.  Im allgemeinen Audio-Editor Adobe Audition 1.5 wird die PCM-Datei problemlos ge√∂ffnet.  Dar√ºber hinaus k√∂nnen Sie sogar Dezimalzahlen von PCM-Daten in eine Spalte in einer Textdatei ausgeben, die zuvor einen bestimmten Textkopf gebildet hat.  Seltsamerweise werden solche Dateien aber auch von Adobe Audition ge√∂ffnet. <br><br>  Wir beschreiben den Transformationsalgorithmus.  Und der Algorithmus ist sehr einfach: Sie m√ºssen jede Zeile der BMP-Datei von unten nach oben analysieren.  Die Analyse besteht aus dem Z√§hlen der wei√üen Pixel von links nach rechts in einer Reihe, bis Schwarz auftritt.  Die erhaltenen ganzzahligen nicht negativen Werte m√ºssen in bin√§rer Form in die Ausgabe-PCM-Datei geschrieben werden.  Die Gr√∂√üe der Ausgabedatei entspricht genau der H√∂he des verarbeiteten Bildes.  Die Quantisierungstiefe von 8 Bit des PCM-Audiodatenformats impliziert die Codierung von Samples nach dem gleichen Prinzip.  Der Wert ‚Äû0‚Äú ist der maximale negative Wert des Audio-Samples, der Wert ‚Äû255‚Äú ist der maximale positive Wert und ‚Äû128‚Äú ist der Nullwert (in der Mitte).  Beispielsweise enth√§lt eine PCM-Datei mit Stille-Audiodaten dieselben Bytes mit dem Wert "128".  Es ist erw√§hnenswert, dass eine Zeile abh√§ngig von der Dicke der Linie des Kardiogramms mehrere aufeinanderfolgende schwarze Pixel enthalten kann.  Der beschriebene Algorithmus ‚Äûf√§ngt‚Äú jedoch die obere H√ºllkurve, was ausreicht.  Dar√ºber hinaus werden die scharfen Spitzen des nach oben gerichteten Kardiogramms auf diese Weise besser erfasst. <br><br>  Jetzt k√∂nnen Sie mit dem Schreiben des Programmtextes beginnen.  Das in C geschriebene Programm ist sehr einfach und ben√∂tigt keine detaillierten Kommentare. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; // ,  ; int main(){ //  ; FILE *in,*out; //   ; unsigned long int h,i; //    ; unsigned char px,s; //     ; in=fopen("1.bmp","rb"); //   ; out=fopen("1.pcm","wb"); //   ; fseek(in,22,SEEK_SET); //    ,     fread(&amp;h,4,1,in); //   (4 ); for(i=0;i&lt;h;i++){ // -   ; fseek(in,0x436+i*256,SEEK_SET); //   i-  s=0; //  ( ); do{ //  ; fread(&amp;px,1,1,in); //  ; s+=1; //   ; }while(px); // ,     ; fwrite(&amp;s,1,1,out); //     ; } fclose(in); //  ; fclose(out); //  ; return 0; //  ; }</span></span></span></span></code> </pre> <br><br>  Nachdem das Programm in der Datei "1.bmp" ausgef√ºhrt wurde, wird die Datei "1.pcm" im selben Verzeichnis wie das Programm erstellt.  Wenn Sie versuchen, eine Datei in Adobe Audition zu √∂ffnen, sollte das folgende Fenster angezeigt werden. <br><br><img src="https://habrastorage.org/webt/sw/lj/pg/swljpg5dphpocfdbnvsartz0k-8.png"><br><br>  Sie m√ºssen "Mono", "8-Bit" ausw√§hlen und die Abtastfrequenz im Eingabefeld basierend auf der Berechnung drucken: f = h / (s / v), wobei h die H√∂he des Bildes ist (es ist auch die Anzahl der Abtastungen im Audio), s - die L√§nge des Kardiogramms in Millimetern, v ist die Skala des Kardiogramms in mm / s.  Der letzte Parameter wird in das Kardiogramm geschrieben.  Auf dem ersten Kardiogramm ist nichts geschrieben, aber der Ma√üstab betr√§gt in der Regel oft 25 mm / s.  Die Berechnung der Abtastraten in Excel f√ºr unsere Beispiele ist in der folgenden Abbildung dargestellt. <br><br><img src="https://habrastorage.org/webt/tl/vw/jp/tlvwjpkgjgxsh2z5bwrgkmzjuy8.png"><br><br>  Wie oben erw√§hnt, geben wir die erforderlichen Werte der Abtastfrequenzen f√ºr jedes der Beispiele in das entsprechende Feld ein.  Sie k√∂nnen sogar Dezimalstellen eingeben, dann erfolgt eine automatische Rundung auf das n√§chste Ganze. <br><br><img src="https://habrastorage.org/webt/ha/tr/jt/hatrjtjokkoinjcox4ed9ushjiw.png"><br><br>  Durch Klicken auf "OK" stimmen wir zu, dass wir mit "unsigned 8 bit" Samples arbeiten (es wird ein weiteres Fenster geben), wonach die Wellenform unserer Datei im Hauptfeld des Soundeditors erweitert wird.  Beachten Sie, dass diese Ansicht ‚Äûverkehrt herum‚Äú angezeigt wird. Um die Papierversion vollst√§ndig zu erf√ºllen, sollten Sie die Welle im entsprechenden Men√º umkehren.  Infolgedessen wird es so aussehen. <br><br><img src="https://habrastorage.org/webt/ru/pf/zj/rupfzjhna9czkxh3xifzjuzhubu.png"><br><br>  Das zweite Kardiogramm sieht "leiser" aus, da es urspr√ºnglich nicht sehr gro√ü war. <br><br><img src="https://habrastorage.org/webt/-u/fl/vz/-uflvzhf_iswthnmhrwsdd3xvl4.png"><br><br>  Leider k√∂nnen Sie nicht auf allen Soundkarten Audio mit einer beliebigen Abtastfrequenz abspielen, genauer gesagt, die √ºberwiegende Mehrheit wei√ü nicht wie.  Um die Datei korrekt abzuspielen, m√ºssen Sie die Funktion "Sample-Typ konvertieren" ausf√ºhren.  Wir werden auf den n√§chsten Standardwert von 8000 Hz konvertieren und gleichzeitig die Aufl√∂sung in der Amplitude auf 16 Bit erh√∂hen.  Letzteres ist f√ºr die Genauigkeit im Stadium der Interpolation w√§hrend des Upsamplings erforderlich.  Wenn Sie 8 Bits belassen, wird der verbleibende Bereich des Spektrums mit Quantisierungsrauschen gef√ºllt.  √úbrigens k√∂nnte dieses Verfahren in der BMP-PCM-Konvertierungsphase programmgesteuert durchgef√ºhrt werden, sogar unter Verwendung von Interpolation.  Eines der Ziele war jedoch die Einfachheit des Programmcodes. <br><br>  Nach dem Upsampling-Vorgang k√∂nnen Sie das Ergebnis anh√∂ren und genie√üen.  Sie k√∂nnen das Ergebnis in einer Standard-WAV- oder MP3-Datei speichern.  Es klingt genau so, wie ich es urspr√ºnglich erwartet hatte. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√úber diesen</a> Link k√∂nnen Sie das rar-Archiv herunterladen, das zwei WAV-Dateien mit dem Ergebnis enth√§lt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de419527/">https://habr.com/ru/post/de419527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de419513/index.html">Konfigurieren Sie die Kennwortsicherheitsrichtlinie in Zimbra</a></li>
<li><a href="../de419515/index.html">Wie ein ‚Äûmarkenfreies‚Äú Startup 240 Millionen US-Dollar bekam, um Amazon zu besiegen</a></li>
<li><a href="../de419519/index.html">Tipps f√ºr Handyspiele: Teil 1, Softstart</a></li>
<li><a href="../de419523/index.html">Das PVS-Studio-Team ist beim Schreiben von Artikeln unvoreingenommen</a></li>
<li><a href="../de419525/index.html">Von der API zuerst bei Swagger bis zum Einzelvertrag bei RAML</a></li>
<li><a href="../de419531/index.html">Das perfekte Paar f√ºr Ihre Ohren ausw√§hlen: zehn praktische Tipps</a></li>
<li><a href="../de419535/index.html">Update auf Toaster</a></li>
<li><a href="../de419537/index.html">CyberDemons: K√ºnstliche Intelligenz DOOM 2016</a></li>
<li><a href="../de419539/index.html">Offenes Webinar "Asynchrone Programmierung in Python"</a></li>
<li><a href="../de419547/index.html">Organisieren eines regul√§ren Log Digests mit Python und Ansible am Beispiel eines Sternchens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>