<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂üèΩ üëäüèø üôãüèº Infraestructura como c√≥digo, ganamos a escala (Kirill Vetchinkin, TYME) ü•© üõãÔ∏è üôÖüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El modelo de Infraestructura como C√≥digo (IaC), a veces denominado "infraestructura programable", es un modelo mediante el cual el proceso de configur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Infraestructura como c√≥digo, ganamos a escala (Kirill Vetchinkin, TYME)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438748/"><p>  El modelo de Infraestructura como C√≥digo (IaC), a veces denominado "infraestructura programable", es un modelo mediante el cual el proceso de configuraci√≥n de la infraestructura es similar al proceso de programaci√≥n de software.  Esencialmente, marc√≥ el comienzo de eliminar los l√≠mites entre escribir aplicaciones y crear entornos para estas aplicaciones.  Las aplicaciones pueden contener scripts que crean y administran sus propias m√°quinas virtuales.  Esta es la base de la computaci√≥n en la nube y una parte integral de DevOps. </p><br><p>  La infraestructura como c√≥digo le permite administrar m√°quinas virtuales a nivel de software.  Esto elimina la necesidad de configuraci√≥n manual y actualizaciones para los componentes individuales del equipo.  La infraestructura se vuelve extremadamente "resistente", es decir, reproducible y escalable.  Un operador puede implementar y administrar tanto una como 1000 m√°quinas usando el mismo conjunto de c√≥digo.  Entre los beneficios garantizados de la infraestructura como c√≥digo se encuentran la velocidad, la rentabilidad y la reducci√≥n de riesgos. </p><br><p>  Esto es exactamente de lo que se trata la decodificaci√≥n del informe de Kirill Vetchinkin en DevOpsDays Moscow 2018. El informe: reutilizaci√≥n de m√≥dulos Ansible, almacenamiento en Git, revisi√≥n, reconstrucci√≥n, beneficios financieros, escala horizontal con 1 clic. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/mElPCgMl_Wg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  A qui√©n le importa, por favor, debajo del gato. </p><a name="habracut"></a><br><p>  Hola a todos  Como ya dije, soy Vetchinkin Kirill.  Trabajo en TYME y hoy hablaremos de la infraestructura como un c√≥digo.  Tambi√©n hablaremos sobre c√≥mo aprendimos a ahorrar en esta pr√°ctica, porque es bastante costosa.  Escribir una gran cantidad de c√≥digo es bastante costoso para configurar la infraestructura. </p><br><p>  Hablar√© brevemente sobre la compa√±√≠a.  Yo trabajo en TYME.  Tuvimos un cambio de marca.  Ahora nos llamamos PaySystem, como su nombre lo indica, estamos comprometidos con los sistemas de pago.  Tenemos nuestras propias soluciones: estos son procesamientos y desarrollo personalizado.  El desarrollo personalizado es la banca electr√≥nica, la facturaci√≥n y similares.  Y como saben, si este es un desarrollo personalizado, entonces se trata de una gran cantidad de proyectos cada a√±o.  El proyecto va despu√©s del proyecto.  Cuantos m√°s proyectos, m√°s infraestructura del mismo tipo tiene que ser levantada.  Como los proyectos suelen estar muy cargados, utilizamos la arquitectura de microservicios.  Por lo tanto, en un proyecto hay muchos, muchos peque√±os subproyectos. </p><br><p><img src="https://habrastorage.org/webt/e2/pn/or/e2pnoryduehiqs7tpmruibojxng.png"></p><br><p>  En consecuencia, administrar todo este zool√≥gico sin un DevOps completo es muy dif√≠cil.  Por lo tanto, nuestra compa√±√≠a ha implementado varias pr√°cticas de DevOps.  Naturalmente, trabajamos en kanban, en SCRUM, almacenamos todo en git.  Despu√©s de comprometerse, hay una integraci√≥n continua, se ejecutan pruebas.  Los probadores escriben pruebas de punta a punta en PyTest que comienzan todas las noches.  La prueba unitaria comienza despu√©s de cada confirmaci√≥n.  Utilizamos un proceso de compilaci√≥n e implementaci√≥n por separado: ensamblado, luego implementamos en varios entornos muchas veces.  Est√°bamos en ventanas.  En Windows implementamos usando Octopus deploy. Este a√±o estamos desarrollando DotNet Core.  Por lo tanto, ahora podemos ejecutar software en sistemas Linux.  Dejamos Octopus y llegamos a Ansible.  Hoy hablaremos sobre esta parte, que es una nueva pr√°ctica que desarrollamos este a√±o, algo que no ten√≠amos antes.  Cuando tiene pruebas, cuando sabe c√≥mo construir bien la aplicaci√≥n, est√° bien implementarla en alg√∫n lugar.  Pero si tiene dos entornos configurados de manera diferente, a√∫n caer√° y caer√° en producci√≥n.  Por lo tanto, administrar configuraciones es una pr√°ctica muy importante.  De eso es de lo que hablaremos hoy. </p><br><p><img src="https://habrastorage.org/webt/_u/di/kj/_udikjskq0g3yi48718mjn1hf54.png"><br>  Describir√© brevemente c√≥mo se construye la econom√≠a laboral del producto: el <strong>60</strong> por ciento se gasta en <strong>desarrollo</strong> , el <strong>an√°lisis</strong> toma alrededor del <strong>10</strong> por ciento, el <strong>control de calidad</strong> (pruebas) toma alrededor del <strong>20</strong> por ciento, y todo lo dem√°s se asigna a la configuraci√≥n.  Cuando los sistemas funcionan a pleno rendimiento, tienen muchos software de terceros, los sistemas operativos se configuran casi de la misma manera.  Pasamos m√°s tiempo haciendo esto, esencialmente haciendo lo mismo.  Hubo una idea para automatizar todo y reducir el costo de configuraci√≥n de la infraestructura.  Tareas similares est√°n automatizadas, bien depuradas y no contienen operaciones manuales. </p><br><p><img src="https://habrastorage.org/webt/zf/vh/wm/zfvhwmb7pvlufeihfrgj0xk6dnq.png"><br>  Cada aplicaci√≥n funciona en alg√∫n tipo de entorno.  Veamos en qu√© consiste todo.  Como m√≠nimo, debemos tener un <strong>sistema operativo</strong> , debe configurarse, hay algunas <strong>aplicaciones de terceros</strong> que tambi√©n deben configurarse, <strong>la aplicaci√≥n en s√≠ misma</strong> debe recibir las configuraciones, pero para que todo el producto funcione, la aplicaci√≥n en s√≠ misma debe iniciarse, la cual opera en todo este sistema.  Tambi√©n hay una <strong>red</strong> que tambi√©n debe configurarse, pero hoy no hablaremos de la red porque tenemos diferentes clientes, diferentes dispositivos de red.  Tambi√©n intentamos automatizar la configuraci√≥n de la red, pero dado que los dispositivos son diferentes, no hubo ning√∫n beneficio particular de esto, gastamos m√°s recursos en esto.  Pero automatizamos los sistemas operativos, las aplicaciones de terceros y la transferencia de par√°metros de configuraci√≥n a las propias aplicaciones. </p><br><p><img src="https://habrastorage.org/webt/mp/gx/l0/mpgxl0kr4wzjrc9zymbmjn2pk6c.png"></p><br><p>  Hay dos enfoques sobre c√≥mo puede configurar los servidores: a mano: si los configura a mano, puede obtener una situaci√≥n en la que haya configurado la producci√≥n de una manera, la prueba de la otra, todo es verde en la prueba, las pruebas son verdes.  Se implementa en producci√≥n y no hay un marco all√≠, nada funciona para usted.  Otro ejemplo: tres servidores de aplicaciones se configuran a mano.  Un servidor de aplicaciones se configur√≥ de una manera, otro servidor de aplicaciones de una manera diferente.  Los servidores pueden trabajar de diferentes maneras.  Otro ejemplo: hubo una situaci√≥n en la que un servidor Stage dej√≥ de funcionar por completo para nosotros.  Comenzamos a crear un nuevo servidor usando y despu√©s de 30 el servidor estaba listo.  Otro ejemplo: el servidor simplemente dej√≥ de funcionar.  Si lo configura con sus manos, entonces debe buscar a una persona que sepa c√≥mo configurarlo, debe presentar la documentaci√≥n.  Como sabemos, la documentaci√≥n no es relevante.  Estos son grandes problemas.  Y, lo m√°s importante, esta es una auditor√≠a, es decir, en t√©rminos generales, tiene diez administradores, cada uno de ellos configura algo con sus manos, no est√° muy claro si lo configuraron correcta o incorrectamente, y c√≥mo entender si luego la configuraci√≥n, podr√≠an poner algo superfluo, abrir algunos puertos innecesarios. </p><br><p><img src="https://habrastorage.org/webt/uz/pr/be/uzprbex2cscs4xglphdoy_wsenw.png"></p><br><p>  Hay una opci√≥n alternativa, esto es exactamente de lo que estamos hablando hoy, esta es la configuraci√≥n del c√≥digo.  Es decir, tenemos un repositorio git en el que se almacena toda la infraestructura.  Todos los scripts se almacenan all√≠, con la ayuda de los cuales lo configuraremos.  Como todo esto est√° en git, obtenemos todos los beneficios de la gesti√≥n de c√≥digo, como en el desarrollo, es decir, podemos hacer revisiones, auditor√≠as, historial de cambios, qui√©n hizo, por qu√©, comentarios, podemos retroceder.  Para trabajar con el c√≥digo, debe usar la tuber√≠a de ensamblaje continuo: la tuber√≠a de implementaci√≥n.  Para que un sistema en particular realice cambios en los servidores, es decir, no una persona har√≠a algo con sus manos, sino que el sistema lo har√≠a exclusivamente. </p><br><p><img src="https://habrastorage.org/webt/0r/dj/j_/0rdjj_cdepjplmukudcdg5sbnlo.png"></p><br><p>  Como el sistema que realiza los cambios, utilizamos Ansible.  Como no tenemos una gran cantidad de servidores, es bastante adecuado para nosotros.  Si tiene 100-200 servidores all√≠, entonces tendr√° peque√±os problemas, ya que (es decir, Ansible) todav√≠a se conecta a cada uno y los configura a su vez, esto es un problema.  Es mejor usar otros medios que no empujen, sino que tiren.  Pero para nuestra historia, cuando tenemos muchos proyectos, pero no m√°s de 20 servidores, esto es muy adecuado para nosotros.  Ansible tiene una gran ventaja: es un umbral de entrada bajo.  Es decir, literalmente, cualquier especialista en TI en tres semanas puede dominarlo por completo.  √âl tiene muchos m√≥dulos.  Es decir, puede administrar las nubes, las redes, los archivos, la instalaci√≥n de programas, la implementaci√≥n, absolutamente todo.  Si no hay m√≥dulos, puede escribir los suyos, finalmente puede escribir algo utilizando el shell de Ansible o el m√≥dulo de comando. </p><br><p><img src="https://habrastorage.org/webt/y6/2j/vq/y62jvqqmsm9jwm0shngvgrp_5_g.png"></p><br><p>  En general, consideraremos brevemente c√≥mo se ve generalmente esta herramienta.  Ansible tiene m√≥dulos de los que ya habl√©.  Es decir, pueden ser entregados, escritos por ellos mismos, que est√°n haciendo algo.  Hay inventarios: aqu√≠ es donde implementaremos nuestros cambios, es decir, estos son los hosts, sus direcciones IP, variables espec√≠ficas de estos hosts.  Y, en consecuencia, el papel.  Los roles son lo que implementaremos en estos servidores.  Y tambi√©n nuestros hosts est√°n agrupados en grupos, es decir, en este caso vemos que tenemos dos grupos: el servidor de la base de datos y el servidor de aplicaciones.  En cada grupo tenemos tres autos.  Est√°n conectados a trav√©s de ssh.  Por lo tanto, resolvemos los problemas de los que hablamos anteriormente, que en primer lugar nuestros servidores est√°n configurados de manera id√©ntica, ya que el mismo rol se aplica a los servidores.  Y de la misma manera, si ejecutamos este rol en varias m√°quinas, para cada una funcionar√° de la misma manera. </p><br><p><img src="https://habrastorage.org/webt/h2/hr/-t/h2hr-t11qunwpnaa-9ro7wxhfio.png"></p><br><p>  Si analizamos m√°s a fondo c√≥mo est√° estructurado el proyecto Ansible, entonces aqu√≠ vemos que los hosts son aceptables para los inventarios de producci√≥n.  Este grupo est√° indicado y hay dos servidores en √©l.  Si vamos a un servidor espec√≠fico, vemos que la direcci√≥n IP de esta m√°quina se indica aqu√≠.  All√≠ tambi√©n se pueden indicar otros par√°metros: variables espec√≠ficas de este entorno.  Si nos fijamos en los roles.  Ese rol contiene varias tareas que se realizar√°n.  En este caso, esta es la funci√≥n para instalar PostgreSQL.  Es decir, instalamos la aplicaci√≥n necesaria, creamos la base de datos.  Aqu√≠ usamos un bucle.  Ellos (bases de datos) se crear√°n un poco.  Luego establecemos la conexi√≥n necesaria: direcciones IP que pueden iniciar sesi√≥n en esta base de datos.  Y, en consecuencia, configuramos al final del firewall.  La configuraci√≥n se aplicar√° a todos los servidores del grupo. </p><br><p><img src="https://habrastorage.org/webt/zg/ia/zo/zgiazoqklptftwwsjnxyqtq-1jc.png"></p><br><p>  Simplemente aborde el problema en s√≠: aprendimos c√≥mo configurar el servidor usando Ansible y todo estuvo bien.  Pero, como dije, tenemos muchos proyectos.  Son casi todos iguales.  Algunos de estos sistemas est√°n involucrados en cada proyecto (k8s, RabbitMQ, Vault, ELK, PostgreSQL, HAProxy).  Para cada uno, escribimos un papel.  Podemos rodar desde el bot√≥n. </p><br><p><img src="https://habrastorage.org/webt/c3/ob/ez/c3obezyaxpshu6akdh6_qodbhp4.png"></p><br><p>  Pero tenemos muchos proyectos, y en cada uno se superponen esencialmente.  Es decir, en uno de esos conjuntos, en el segundo, en el tercero.  Obtenemos puntos de intersecci√≥n en los que los mismos roles en diferentes proyectos. </p><br><p><img src="https://habrastorage.org/webt/zk/fi/ag/zkfiagc0lsac1-a9tnce_rr7cha.png"></p><br><p>  Tenemos un repositorio con una aplicaci√≥n, tenemos un repositorio con infraestructura para el proyecto.  El segundo proyecto tiene exactamente lo mismo.  Infraestructura continua.  Y el tercero.  Si implementamos lo mismo, entonces esencialmente resultar√° copiar y pegar.  Haremos el mismo papel en 10 lugares.  Entonces, si hay alg√∫n error, gobernaremos en 10 lugares. </p><br><p><img src="https://habrastorage.org/webt/g8/qe/ht/g8qehtvllis6iwedgzaasbu9pe8.png"></p><br><p>  Lo que hicimos: asumimos todos los roles que son comunes a todos los proyectos y todas sus configuraciones que vienen del exterior a un repositorio separado y los pusimos en un git en una carpeta separada, a la que llamamos Infraestructura TYME.  All√≠ tenemos un rol para PostgreSQL, para ELK, para implementar cl√∫steres de Kubernetes.  Si necesitamos poner alg√∫n proyecto, digamos el mismo PostgreSQL, luego enci√©ndalo como un subm√≥dulo, reescriba los inventarios, es decir, en t√©rminos generales, la configuraci√≥n en la que desempe√±ar este rol.  No reescribimos el rol en s√≠: ya existe.  Y con un clic de un bot√≥n, PostgreSQL aparece en todos los proyectos nuevos.  Si necesita aumentar un cl√∫ster de Kubernetes, lo mismo. </p><br><p><img src="https://habrastorage.org/webt/iy/q1/p0/iyq1p0mgtf6vhnk06s4mnirypls.png"></p><br><p>  Por lo tanto, result√≥ reducir el costo de escribir roles.  Es decir, escribieron una vez, lo usaron 10 veces.  Cuando el proyecto va despu√©s del proyecto, es muy conveniente.  Pero dado que ahora estamos trabajando con la infraestructura como c√≥digo, naturalmente necesitamos las canalizaciones de las que hablamos.  Las personas se comprometen en git, pueden cometer alg√∫n tipo de incorrecci√≥n: necesitamos rastrear todo esto.  Por lo tanto, hemos construido tal tuber√≠a.  Es decir, el desarrollador comete scripts Ansible en git.  Teamity los rastrea y los transfiere a Ansible.  Teamcity se necesita aqu√≠ solo por una raz√≥n: en primer lugar, tiene una interfaz visual (hay una versi√≥n gratuita de Ansible Tower - AWX, que resuelve el mismo problema - aprox. Ed.) A diferencia de Ansible gratis y, en principio, tenemos Teamcity como un solo Ci.  Entonces, en principio, Ansible tiene un m√≥dulo que puede rastrear a git.  Pero en este caso lo hicieron solo a imagen y semejanza.  Y tan pronto como lo rastrea, transfiere todo el c√≥digo a Ansible y Ansible, respectivamente, los inicia en el servidor de integraci√≥n y cambia la configuraci√≥n.  Si se viola este proceso, entonces estamos analizando lo que est√° mal, por qu√© los scripts fueron mal escritos. </p><br><p><img src="https://habrastorage.org/webt/rj/hc/wj/rjhcwjfpwdf_xwr8vpk4z2se26c.png"></p><br><p>  El segundo punto es que hay una infraestructura espec√≠fica, aqu√≠ tenemos la infraestructura implementada por separado, la aplicaci√≥n se implementa por separado.  Pero hay una infraestructura espec√≠fica para cada aplicaci√≥n, es decir, que debe implementarse antes de lanzarla.  Aqu√≠, en consecuencia, es imposible transferirlo a una tuber√≠a diferente.  Deber√≠a tener esto implementado en el mismo contenedor que la aplicaci√≥n misma.  Es decir, digamos, los marcos son algo popular cuando necesita instalar un marco para una nueva aplicaci√≥n y colocar otro marco para otra.  As√≠ es como con esta situaci√≥n.  O necesitas limpiar los cach√©s.  Por ejemplo, Ansible tambi√©n puede subir, limpiar el cach√©. </p><br><p><img src="https://habrastorage.org/webt/b5/qj/rf/b5qjrf25y_2k4znz0-zidclu7fi.png"></p><br><p>  Pero aqu√≠ usamos docker en combinaci√≥n con Ansible.  Es decir, nuestra infraestructura espec√≠fica est√° en la ventana acoplable, no espec√≠fica en Ansible.  Entonces, compartimos este peque√±o delta en Docker, todo lo dem√°s, fundamental, en Ansible. </p><br><p><img src="https://habrastorage.org/webt/xq/6i/21/xq6i21qkn6l18s8f68becyjgt7y.png"></p><br><p>  Un punto muy importante: si implementa la infraestructura a trav√©s de alg√∫n tipo de scripts, a trav√©s del c√≥digo, si todav√≠a tiene manipulaciones manuales del servidor, entonces esta es una vulnerabilidad potencial.  Porque digamos que pones Java en el servidor de prueba, escribiste el rol ELK, lo rodaste.  La implementaci√≥n en la prueba fue exitosa.  Implementar en producci√≥n, pero no hay Java.  Y no especific√≥ java en el script: la implementaci√≥n en producci√≥n cay√≥.  Por lo tanto, debe quitar los derechos de todos los servidores a los administradores para que no puedan rastrearlo con sus manos y realizar todos los cambios a trav√©s de git.  Todo este transportador por el que pasamos nosotros.  Hay una cosa, pero no apriete demasiado las tuercas.  Es decir, es necesario introducir dicho proceso gradualmente.  Porque todav√≠a est√° sin recortar.  En nuestro caso, dejamos acceso a todos los sistemas a la cabeza del administrador principal en caso de incidentes imprevistos.  El acceso se otorga con la condici√≥n de que no configurar√° nada a mano. </p><br><p><img src="https://habrastorage.org/webt/za/ka/i0/zakai07gy34i3f7gjx8d-jtvpfy.png"></p><br><p>  ¬øC√≥mo funciona el desarrollo?  Despliegue en la puesta en escena, la producci√≥n debe estar libre de errores.  Algo podr√≠a romperse aqu√≠.  Si el despliegue en el entorno de integraci√≥n cae constantemente en errores, ser√° malo.  Esto es similar a la depuraci√≥n de aplicaciones en una m√°quina remota.  Cuando un desarrollador desarrolla por primera vez todo en una m√°quina, lo compila.  Si todo se compila, luego lo env√≠a al repositorio.  Utiliza el mismo enfoque.  Los desarrolladores usan Visual Studio Code con complementos Ansible, Vagrant, Docker, etc.  Los desarrolladores prueban su c√≥digo de infraestructura en un vagabundo local.  Se levanta un sistema operativo limpio.  Los propios scripts para subir esta m√°quina tambi√©n est√°n en este repositorio con la infraestructura de la que hablamos.  El desarrollador comienza a instalar un servidor FTP en √©l.  Si algo sali√≥ mal, simplemente lo elimina, lo vuelve a cargar y nuevamente intenta instalar el software necesario utilizando scripts de implementaci√≥n.  Despu√©s de depurar los scripts de implementaci√≥n, realiza una solicitud de fusi√≥n a la rama principal.  Despu√©s de fusionar la Solicitud de fusi√≥n, el CI reenv√≠a estos cambios al servidor de integraci√≥n. </p><br><p><img src="https://habrastorage.org/webt/6q/os/qq/6qosqq_jtbghh6dvamxnj1sdvru.png"></p><br><p>  Como todos los scripts son de c√≥digo, podemos escribir pruebas.  Digamos que instalamos PostgreSQL.  Queremos verificar si funciona o no.  Para hacer esto, use el m√≥dulo de afirmaci√≥n Ansible.  Compare la versi√≥n instalada de PostgreSQL con la versi√≥n en los scripts.  Por lo tanto, entendemos que est√° instalado, generalmente se est√° ejecutando, es la versi√≥n que esper√°bamos. </p><br><p><img src="https://habrastorage.org/webt/fc/3g/lf/fc3glflk8ozxdmpluhltv2a5mye.png"></p><br><p>  Vemos que la prueba pas√≥.  Entonces nuestro libro de jugadas funcion√≥ correctamente.  Puedes escribir tantas pruebas como quieras.  Son idempotentes.  <strong>Idempotencia</strong> (una operaci√≥n que, si se aplica a cualquier valor varias veces, siempre da como resultado el mismo valor que con una sola aplicaci√≥n).  Si escribe scripts gratuitos para la instalaci√≥n y configuraci√≥n, aseg√∫rese de que sus scripts siempre obtengan el mismo valor si los ejecuta varias veces. </p><br><p><img src="https://habrastorage.org/webt/cn/tx/zd/cntxzd9yeatgui-yml_a61pegsa.png"></p><br><p>  Hay otro tipo de prueba que no se relaciona directamente con las pruebas de infraestructura.  Pero parecen afectarlo indirectamente.  Estas son pruebas de extremo a extremo.  Tenemos la infraestructura y las aplicaciones mismas est√°n instaladas en el mismo servidor, que los probadores prueban.  Si lanzamos alg√∫n tipo de infraestructura incorrecta, simplemente no pasaremos pruebas complejas.  Es decir, nuestra aplicaci√≥n de alguna manera funcionar√° incorrectamente.  En este ejemplo, instalamos una nueva versi√≥n en producci√≥n: la aplicaci√≥n funciona.  Luego se realiz√≥ una confirmaci√≥n en git y pruebas de extremo a extremo, que tienen lugar por la noche, con el seguimiento de que aqu√≠ no tenemos un archivo en ftp.  Desmontamos este caso y vemos que el problema est√° en la configuraci√≥n de ftp.  Arreglamos los scripts en el c√≥digo, lo implementamos nuevamente y todo se vuelve verde.  La misma historia con el c√≥digo.  El c√≥digo de infraestructura y la infraestructura se prueban indirectamente de una forma u otra.  Luego podemos implementarlo en producci√≥n. </p><br><p><img src="https://habrastorage.org/webt/mx/bo/e3/mxboe3llquz_vb46qalw6yir85m.png"></p><br><p>     , CI (Teamcity),     integration   8   10.      ,      .        ,   OPS ( )   .    Dashboard             .      <strong></strong> ‚Äî  ,      .   <strong></strong> ,     .  ,     .            .    .  ,    ,    ,   . :  -    .    .    Slack    ,   - - -    . </p><br><p><img src="https://habrastorage.org/webt/3b/bw/l1/3bbwl1jej_cien9satd3epefgqi.png"></p><br><p> Ok,     ,   ,    -  ,         .   trunk based .   Master  ‚Äî    .    Master  CI  (Teamcity)    integration .    CI  ,           integration .  release candidate.      .        .   ,  end-to-end  ,          staging .     production.         ,  staging     . </p><br><p><img src="https://habrastorage.org/webt/ut/lg/rb/utlgrbwe6gtssxn-ivmxwp3hpuc.png"></p><br><p>         .  ?   ,    PostgreSQL.      5     .    ,  .   1-2 .       .  ,  PostgreSQL      .      PostgreSQL  ,    staging, production 4 .   ,   ,         .          ,      .          - . </p><br><p><img src="https://habrastorage.org/webt/ts/28/cl/ts28clrdqnfeocxls1rudzn0k5i.png"></p><br><p>   git submodule     Ansible .       ,   .  git submodule  Ansible    .   inventories ,    .   30 .    git submodule         . </p><br><p><img src="https://habrastorage.org/webt/qx/y3/_w/qxy3_w7ra6n-35jnlc1oyhy_cew.png"></p><br><p>   :     ,           .   ,     ,     ,   staging    ,   . ,   ,   ,   ,   ,    ,     staging.       ‚Äî    , ,    -  . </p><br><p><img src="https://habrastorage.org/webt/mv/lv/nb/mvlvnbmp76dzsemwy9xdkv8nzda.png"></p><br><p>      6 .  ‚Äî   10  .            .      .    ,   . -    git submodule,         .      .      ,     ,      ,         .  ,       ,    . </p><br><p><img src="https://habrastorage.org/webt/tz/bm/n4/tzbmn4-jneygsmiecrtjudgw5ne.png"><br> . </p><br><p> -,   ,        :        ,   Ansible   git , : ‚Äú ,   - ‚Äù.     ?     git .   ,     .  100%  .  .       . </p><br><p>  ,     .    .   ,      RabbitMQ, ELK,    .     ,   ELK    .         ,  ,     ELK.    ELK,    ,    ELK  . </p><br><p>    ,    ,      ,   ,   .     , , ,   ,  .         ,     .       . </p><br><p>    .   ,    ,     ,  ,   ,  ,   .           git.    ,     ‚Äî    git,   ,  :     ,   -    .     . </p><br><p>   ,       ,    ,     code review.   ,     ,   .  ,    .  ,   , ,  ,  ,   .   ,    :      .   .          .     ,   - - . </p><br><p>    ,    . </p><br><p> :     ,       git submodule,        .     - ,     latest .      inventories.    ‚Äî   ,   .   , ,   ..  .  ‚Äî    .      . </p><br><p> :    -   Ansible          ( A   B, B  C      A,      )?   ,     ? </p><br><p> :      .      .  ,   -    IP  ,       ,   ,     ,      .       . ,      ,    ,    ,     ,  .        ,    -   ,  , , RabbitMQ     RabbitMQ,      . -      ,   . </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD: Sugiero que todos los interesados ‚Äã‚Äãen Github traduzcan al texto informes interesantes de conferencias. </font><font style="vertical-align: inherit;">Puedes hacer un grupo en github para traducir. </font><font style="vertical-align: inherit;">Hasta ahora, lo estoy traduciendo a texto en mi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuenta de github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; tambi√©n puede enviar una solicitud de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">extracci√≥n</font></a><font style="vertical-align: inherit;"> para corregir un art√≠culo all√≠.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438748/">https://habr.com/ru/post/438748/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438732/index.html">Mediciones de radioaficionados: an√°lisis de se√±al de bus I2C</a></li>
<li><a href="../438734/index.html">Mara√±a de personas de ideas afines</a></li>
<li><a href="../438736/index.html">DevDay for Managers: Administre TI</a></li>
<li><a href="../438740/index.html">Gesti√≥n de secretos con HashiCorp Vault</a></li>
<li><a href="../438746/index.html">En el camino hacia los principios f√≠sicos de la evoluci√≥n biol√≥gica. Continuaci√≥n</a></li>
<li><a href="../438750/index.html">Civilizaci√≥n de Springs, 4/5</a></li>
<li><a href="../438752/index.html">Contabilidad directamente en el banco: c√≥mo hacer felices a los empresarios individuales</a></li>
<li><a href="../438754/index.html">C√≥mo hicimos el monitoreo de red para 14,000 objetos</a></li>
<li><a href="../438756/index.html">Sexto control de cromo, ep√≠logo</a></li>
<li><a href="../438758/index.html">¬øPor qu√© Google cambia la interfaz URL est√°ndar en el navegador?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>