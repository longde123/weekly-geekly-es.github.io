<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèπ üèáüèø üëÇüèª Como roubar dinheiro de um cart√£o sem contato e do Apple Pay üñêüèø üêé üõçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O artigo examina os mitos e cen√°rios populares de fraude de pagamento sem contato usando o exemplo de um terminal POS real, cart√µes PayPass / payWave ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como roubar dinheiro de um cart√£o sem contato e do Apple Pay</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422551/"><img alt="Como roubar dinheiro de um cart√£o sem contato do seu bolso? Qu√£o seguro √© o PayPass e o Apple Pay?" src="https://habrastorage.org/webt/gb/2f/ry/gb2frybl-08fyn1a0w1xxjap9f0.jpeg"><br><br>  O artigo examina os mitos e cen√°rios populares de fraude de pagamento sem contato usando o exemplo de um terminal POS real, cart√µes PayPass / payWave e telefones com a fun√ß√£o Google Pay / Apple Pay. <br><br>  T√≥picos abordados: <br><br><ul><li>  <b>√â realmente poss√≠vel roubar dinheiro apoiando meu terminal de POS no bolso?</b>  - Vamos tentar reproduzir totalmente esse cen√°rio de fraude do come√ßo ao fim, usando um terminal POS real e cart√µes de pagamento em condi√ß√µes reais. </li><li>  <b>Qual √© a diferen√ßa entre os cart√µes Apple Pay f√≠sicos e virtuais?</b>  - como o cart√£o f√≠sico e o token Apple Pay est√£o vinculados e por que o Apple Pay √© muito mais seguro que um cart√£o comum. </li><li>  <b>Usamos um sniffer NFC de hardware (ISO 14443A)</b> - usaremos um dispositivo HydraNFC para interceptar dados entre o terminal POS e o cart√£o.  Considere quais dados confidenciais podem ser extra√≠dos do tr√°fego interceptado. </li><li>  <b>Analisamos o protocolo EMV</b> - quais dados o cart√£o troca com o terminal POS, o formato de solicita√ß√£o usado, os mecanismos de prote√ß√£o contra ataques de fraude e repeti√ß√£o. </li><li>  <b>Estudamos opera√ß√µes sem cart√£o (CNP, MO / TO)</b> - em que casos de fato (!) Voc√™ pode roubar dinheiro do cart√£o, tendo apenas os detalhes lidos sem contato e nos quais √© imposs√≠vel. </li></ul><br>  <font color="red"><b>Aten√ß√£o!</b></font> <br><br>  O artigo descreve em detalhes o esquema hipot√©tico de fraude, do come√ßo ao fim, atrav√©s dos olhos de um fraudador, a fim de cobrir todos os aspectos nos quais os mitos e erros s√£o cultivados.  Apesar do t√≠tulo provocador, a principal conclus√£o do artigo √© que os <b>pagamentos sem contato s√£o bastante seguros e os ataques a eles s√£o demorados e n√£o rent√°veis</b> . <br><br>  <font color="red">Os materiais no artigo s√£o apresentados apenas para fins informativos.</font>  <font color="red">Todas as cenas de fraude s√£o encenadas e executadas com o consentimento das partes envolvidas.</font>  <font color="red">Todo o dinheiro deduzido dos cart√µes foi devolvido aos seus propriet√°rios.</font>  <font color="red">O roubo do dinheiro do cart√£o √© uma ofensa criminal e √© pun√≠vel por lei.</font> <a name="habracut"></a><br><h1>  Como isso funciona? </h1><br>  Para come√ßar, considere os conceitos b√°sicos: qualquer movimenta√ß√£o de dinheiro usando cart√µes de pagamento √© poss√≠vel apenas atrav√©s de intermedi√°rios conectados ao sistema de pagamento, como VISA ou MasterCard.  Diferentemente das transfer√™ncias entre indiv√≠duos, o d√©bito em dinheiro do cart√£o est√° dispon√≠vel apenas para uma entidade legal (comerciante) com um contrato de aquisi√ß√£o com um banco. <br><br><img src="https://habrastorage.org/webt/d5/1w/ce/d51wcetyqo_5ppr5467wwknaaus.png"><br>  <i><font color="99999">Etapas da transa√ß√£o ao pagar atrav√©s de um terminal POS</font></i> <br><br>  A ilustra√ß√£o acima mostra o esquema de pagamento cl√°ssico atrav√©s de um terminal POS.  √â essa sequ√™ncia de a√ß√µes que ocorre quando, ap√≥s o pagamento no caixa, voc√™ est√° aguardando confirma√ß√£o no terminal. <br><br><ol><li>  O comprador aplica / ret√©m / insere o cart√£o no terminal POS; </li><li>  Um terminal POS transmite dados para um banco adquirente pela Internet; </li><li>  O banco adquirente atrav√©s do sistema de pagamento internacional (MPS) entra em contato com o banco emissor e pergunta se um titular de cart√£o espec√≠fico pode pagar pela compra; </li><li>  O banco emissor confirma ou rejeita a compra, ap√≥s a qual um boleto √© impresso (segundo cheque). </li></ol><br>  H√° exce√ß√µes neste esquema, por exemplo, transa√ß√µes offline, as consideraremos ainda mais.  Al√©m disso, se o banco adquirente e o banco emissor forem o mesmo banco, as etapas 2 e 4 ser√£o executadas no mesmo banco. <br><br>  <b>Vendedor</b> (comerciante) - uma pessoa ou organiza√ß√£o que fornece bens ou servi√ßos <br><br>  Banco adquirente √© um banco que fornece ao vendedor servi√ßos de aceita√ß√£o de pagamento por meio de cart√µes banc√°rios.  Nesse banco, geralmente, existe uma conta banc√°ria do vendedor em que o dinheiro debitado no cart√£o √© creditado. <br><br>  Banco <b>emissor</b> - o banco que emitiu o cart√£o.  Ele cont√©m a conta do titular do cart√£o, da qual o dinheiro √© debitado. <br><br>  <b>O Sistema Internacional de Pagamentos</b> (MPS) √© um sistema intermedi√°rio internacional entre bancos de todo o mundo que permite que os bancos fa√ßam acordos entre si sem concluir um contrato com cada banco separadamente.  Todos os bancos conectados ao Minist√©rio das Ferrovias concordam em trabalhar de acordo com as mesmas regras, o que simplifica bastante a intera√ß√£o.  Por exemplo, Visa, MasterCard, UnionPay, American Express, <s>MIR</s> (n√£o, o MIR n√£o funciona no exterior). <br><br>  <b>Titular do cart√£o</b> - uma pessoa que assinou um contrato de servi√ßo de cart√£o com o banco emissor. <br><br><h1>  Qual √© a diferen√ßa entre um cart√£o comum da Apple Pay ou Google Pay? </h1><br>  O procedimento para vincular um cart√£o banc√°rio ao sistema Apple Pay ou Google Pay devido √† incompreensibilidade do processo geralmente gera equ√≠vocos, mesmo entre os profissionais de TI.  Eu ouvi muitos mitos diferentes sobre essa tecnologia. <br><br><h4>  Mitos populares da Apple Pay </h4><br><ul><li>  <b><font color="D13CB8">O cart√£o √© copiado para o telefone</font></b> <br>  N√£o √© assim, o cart√£o do microprocessador cont√©m uma √°rea de mem√≥ria protegida com informa√ß√µes criptogr√°ficas que n√£o podem ser extra√≠das ap√≥s a emiss√£o do cart√£o.  Por esse motivo, um cart√£o com chip n√£o pode ser copiado, de forma alguma.  <i><font color="99999">Para ser justo, √© preciso dizer que esses ataques s√£o poss√≠veis, mas seu custo excede a quantidade total de dinheiro que a maioria dos leitores deste artigo gastar√° em toda a sua vida.</font></i> </li><li>  <b><font color="D13CB8">Cada vez que o telefone se conecta √† Internet durante o pagamento</font></b> <br>  O Google Pay / Apple Pay n√£o se conecta √† Internet durante o pagamento atrav√©s de um terminal POS.  Todas as informa√ß√µes necess√°rias s√£o armazenadas localmente no telefone. </li><li>  <b><font color="D13CB8">Um novo n√∫mero de cart√£o (PAN) √© gerado para cada pagamento</font></b> <br>  Pode parecer que voc√™ leia os comunicados de imprensa da Apple sobre a tecnologia Apple Pay.  Mas essa √© uma interpreta√ß√£o incorreta do conceito de token.  De fato, os detalhes do cart√£o virtual permanecem inalterados por um longo tempo. Voc√™ pode verificar isso pelos √∫ltimos d√≠gitos do n√∫mero do cart√£o no boleto (cheque banc√°rio) ao pagar pelas compras. </li><li>  <b><font color="D13CB8">Ao pagar atrav√©s do Apple Pay / Google Pay, √© cobrada uma taxa adicional</font></b> <br>  N√£o √© assim, voc√™ pagar√° exatamente o valor indicado no pre√ßo e de acordo com os termos do seu contrato com o banco emissor cujo cart√£o voc√™ vinculou. </li><li>  <b><font color="D13CB8">O dinheiro pode ser debitado duas vezes</font></b> <br>  Esse mito se aplica n√£o apenas ao Google Pay / Apple Pay, mas tamb√©m aos cart√µes banc√°rios comuns.  Acredito que ele apareceu por causa dos sistemas de pagamento de transporte p√∫blico, nos quais o terminal deduz dinheiro do ingresso toda vez que √© apresentado, para que voc√™ possa debitar duas ou mais vezes se trouxer o cart√£o incorretamente.  No caso de terminais POS, esse risco n√£o existe, pois o terminal para de trocar com o cart√£o assim que recebe os dados necess√°rios. </li></ul><br><br><img src="https://habrastorage.org/webt/z5/mt/og/z5mtogccxmh5picpde0ng_nmnnk.png"><br>  <i><font color="99999">Associando um cart√£o f√≠sico a um token no telefone</font></i> <br><br>  Sistemas como o Apple Pay s√£o equipados com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a especifica√ß√£o EMV Payment Tokenisation</a> .  O procedimento para associar um cart√£o f√≠sico e telefone ao Apple Pay n√£o foi descrito publicamente, portanto, analisaremos o processo com base em dados conhecidos: <br><br><ol><li>  O provedor (Google, Apple, Samsung) recebe informa√ß√µes do mapa; </li><li>  Por meio do MPS, o provedor solicita se este cart√£o (este banco emissor) suporta Tokeniza√ß√£o EMV; </li><li>  No lado do MPS, √© gerado um cart√£o virtual (token), que √© baixado para o armazenamento seguro no telefone.  <i><font color="99999">N√£o sei onde exatamente a chave privada do cart√£o virtual √© gerada, se √© transmitida pela Internet ou gerada localmente no telefone; nesse caso, n√£o importa.</font></i> </li><li>  Um cart√£o de token virtual gerado √© exibido no telefone, as opera√ß√µes nas quais o banco emissor interpreta como opera√ß√µes no primeiro cart√£o f√≠sico.  No caso de bloquear o cart√£o f√≠sico, o token tamb√©m √© bloqueado. </li></ol><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Seu navegador n√£o suporta v√≠deo HTML5. <source src="https://zhovner.com/forever/applepay_different_pan.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">O Apple Pay permite que voc√™ leia os detalhes de um cart√£o virtual.</font></i>  <i><font color="99999">O n√∫mero do PAN e a data de vencimento diferem do cart√£o vinculado do Alfa-Bank russo.</font></i>  <i><font color="99999">O BIN do cart√£o virtual (480099) √© determinado pelo MBNA AMERICA BANK.</font></i> <br><br>  Ao pagar por telefone, o terminal do PDV v√™ um VISA ou MasterCard comum e se comunica com ele da mesma maneira que com um cart√£o f√≠sico.  Um cart√£o de token virtual cont√©m todos os atributos de um cart√£o comum: n√∫mero PAN, data de validade etc.  Ao mesmo tempo, o n√∫mero do cart√£o virtual e o per√≠odo de validade diferem do cart√£o original anexado. <br><br><h2>  Cen√°rio 1 - terminal POS normal </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/jz/mj/fwjzmjgmj7beldkf8bh4hdwmlay.jpeg"></div><br>  <i><font color="99999">Fraudador de terminal POS</font></i> <br><br>  A trama mais popular de fraude na mente das pessoas comuns: um fraudador com um terminal ligado √© pressionado contra eles na multid√£o e anula dinheiro.  Vamos tentar reproduzir esse cen√°rio na realidade. <br><br>  <b>As condi√ß√µes s√£o as seguintes</b> : <br><br><ul><li>  O fraudador possui um <b>terminal POS normal,</b> totalmente funcional <b>,</b> conectado a um banco adquirente, o mesmo que em lojas e correios.  O firmware do terminal n√£o √© modificado.  No nosso caso - Ingenico iWL250.  Este √© um terminal POS port√°til com um modem GPRS que suporta pagamentos sem contato, funciona com energia da bateria e √© totalmente m√≥vel. </li><li>  O fraudador n√£o utiliza meios t√©cnicos adicionais, apenas um terminal POS </li><li>  Os fundos debitados s√£o creditados na conta corrente do fraudador, de acordo com todas as regras dos sistemas banc√°rios </li></ul><br><h3>  Entidade legal </h3><br><img src="https://habrastorage.org/webt/do/f_/qs/dof_qscba68g-7za5caz02pszqi.jpeg"><br><br>  Primeiro, precisamos de uma entidade legal com conta corrente e aquisi√ß√£o conectada.  N√≥s, como golpistas reais, n√£o descobrimos nada em nosso nome, mas tentamos comprar uma entidade legal pronta.  a pessoa no site pelos mesmos golpistas.  Para fazer isso, consulte os an√∫ncios na primeira p√°gina do Google para "buy ip" e "buy ooo". <br><br> <a href=""><img src="https://habrastorage.org/webt/lu/7v/yc/lu7vycgengac_zvziy7cltrjl-k.png"></a> <br>  <i><font color="99999">Ofertas para vender empresas prontas de golpistas (clic√°veis)</font></i> <br><br>  O pre√ßo de uma empresa no mercado negro com uma conta corrente varia de 20 a 300 mil rublos.  Consegui encontrar v√°rias ofertas de LLC com um terminal POS a partir de 200 mil rublos.  Essas empresas s√£o enquadradas por manequins e o comprador recebe todo o pacote de documentos, juntamente com um "cart√£o de cache" - este √© um cart√£o banc√°rio vinculado √† conta de liquida√ß√£o da empresa simulada.  Com esse cart√£o, um fraudador pode sacar dinheiro em um caixa eletr√¥nico. <br><br><blockquote>  Por uma quest√£o de simplicidade, assumimos que LLC + conta banc√°ria + aquisi√ß√£o e um terminal de PDV custar√£o ao fraudador <b>100.000 rublos</b> .  Na verdade, mais, mas simplificaremos a vida do nosso golpista hipot√©tico, reduzindo o custo do ataque.  Afinal, quanto menor o custo do ataque, mais f√°cil √© implementar. </blockquote><br><h2>  Vamos roubar dinheiro </h2><br>  Assim, o fraudador tem um terminal de ponto de venda e est√° pronto para ir a um local lotado para se apoiar nas v√≠timas e roubar dinheiro dos bolsos.  Em nosso experimento, todas as v√≠timas foram instru√≠das sobre nossas inten√ß√µes e todas as tentativas de amortizar o dinheiro foram feitas com o seu consentimento.  Nos casos em que os sujeitos n√£o tinham seus pr√≥prios cart√µes banc√°rios sem contato, eles eram solicitados a colocar nosso cart√£o em sua carteira.  Anteriormente, os participantes descobriam exatamente onde e como armazenam seus cart√µes, para que o fraudador soubesse com anteced√™ncia onde o cart√£o sem contato est√° na bolsa / bolso. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Seu navegador n√£o suporta v√≠deo HTML5. <source src="https://zhovner.com/forever/nfc_fraud_in_public.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">V√≠deo: um fraudador furioso em um shopping center</font></i> <br><br>  No caso de uma baixa com √™xito, a transa√ß√£o foi cancelada atrav√©s do menu do terminal e o dinheiro foi devolvido √† conta dos participantes.  Durante toda a dura√ß√£o do experimento, tentamos "roubar" dinheiro de 20 sujeitos no pr√©dio do shopping e na rua.  O resultado do teste √© descrito abaixo. <br><br><h1>  Problema: limite de transa√ß√£o sem PIN </h1><br>  O limite do valor m√°ximo da transa√ß√£o sem confirma√ß√£o com um c√≥digo PIN pode ser definido tanto no pr√≥prio terminal do PDV (limite obrigat√≥rio da CVM) quanto no lado do banco.  Na R√∫ssia, essa restri√ß√£o √© igual a 1000 rublos. <br><br><hr><br>  <font color="99999"><i><b>UPD</b> Nas configura√ß√µes do cart√£o, o tipo de autoriza√ß√£o dos m√©todos de verifica√ß√£o do titular do cart√£o (CVMs) pode ser definido como uma assinatura no cheque.</i></font>  <font color="99999"><i>Nesse caso, uma transa√ß√£o sem contato ocorrer√° por qualquer quantia sem um c√≥digo PIN.</i></font> <br><br><hr><br>  Nosso fraudador decide amortizar 999,99 rublos por vez.  Se voc√™ for solicitado a tentar anular novamente a quantia abaixo do limite em um curto per√≠odo de tempo, tamb√©m ser√° solicitado a inserir o c√≥digo PIN e, na maioria dos casos, n√£o ser√° poss√≠vel anular 999,99 rublos v√°rias vezes seguidas.  Portanto, a melhor estrat√©gia n√£o ser√° mais do que uma cobran√ßa de um cart√£o. <br><br><div style="text-align:center;"><img width="300" alt="Terminal POS com o valor de 999,99" src="https://habrastorage.org/webt/at/kg/lt/atkgltocfv4dmqiutgb-8rbcej8.png"></div><br>  <i><font color="99999">Na R√∫ssia, o valor m√°ximo debitado sem um c√≥digo PIN √© de 1000 rublos.</font></i> <br><br>  De fato, muitas baixas cont√°beis com a quantia de 999,99 rublos em um curto per√≠odo de tempo podem acionar um sistema antifraude do lado do banco adquirente; portanto, essa estrat√©gia n√£o √© ideal para um fraudador.  Portanto, na vida real, ele teria que escolher quantidades mais diversas, reduzindo assim a renda potencial. <br><br>  A prop√≥sito, muitos artigos sobre esse t√≥pico em russo dizem que voc√™ pode definir manualmente seu pr√≥prio limite para transa√ß√µes sem contato sem um c√≥digo PIN.  N√£o encontrei essa op√ß√£o nos principais bancos russos.  Talvez voc√™ saiba sobre essa possibilidade?  Trata-se de pagamentos sem contato e n√£o de transa√ß√µes com chip e pin. <br><br><h2>  Problema: V√°rios cart√µes na carteira </h2><br>  Este √© um ponto importante nesse cen√°rio de ataque, porque, na realidade, quase ningu√©m carrega <b>uma √∫nica carta</b> no bolso.  Na maioria dos casos, o cart√£o √© armazenado na carteira junto com outros cart√µes sem contato, como bilhetes de viagem ou outros cart√µes banc√°rios. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/im/x5/j1/imx5j1sci8ml-89qidz1_w8tdow.png" alt="Carteira cheia de cart√µes"></div><br>  Especificamente, meu terminal Igenico iWL250, quando detecta mais de uma placa no campo de a√ß√£o com um SAK indicando suporte para o protocolo 14443-4, retorna um erro: "apresente uma placa". <br><br>  Mas nem todos os terminais fazem isso.  Por exemplo, os terminais POS do VeriFone Sberbank escolhem um cart√£o aleat√≥rio dentre v√°rios.  Alguns terminais simplesmente ignoram todos os cart√µes se houver mais de um, sem mostrar mensagens de erro. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Seu navegador n√£o suporta v√≠deo HTML5. <source src="https://zhovner.com/forever/pos_terminal_declines_few_cards.mp4" type="video/mp4"></video></div></div></div><br>  <i><font color="99999">Tentando ler v√°rios cart√µes em uma carteira.</font></i>  <i><font color="99999">O terminal POS retorna um erro.</font></i> <br><br><h3>  Anticolis√£o ISO 14443-3 </h3><br>  Ler um cart√£o espec√≠fico de v√°rios n√£o √© uma tarefa f√°cil no n√≠vel f√≠sico.  Para resolver esse problema, existe um mecanismo de anticolis√µes.  Permite selecionar um cart√£o se uma resposta foi recebida de v√°rios cart√µes ao mesmo tempo.  Este √© o primeiro passo para estabelecer contato com um cart√£o sem contato no protocolo ISO-14443A.  Nesta fase, o leitor n√£o consegue descobrir qual dos cart√µes apresentados √© banc√°rio.  A √∫nica op√ß√£o √© escolher um cart√£o mais ou menos semelhante a um cart√£o banc√°rio, com base na resposta de SAK (Selecionar reconhecimento). <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/_k/ie/yz/_kieyz-qmexulctjyhmfnjyvff8.png"></div>  <i><font color="99999">Valor de bit na resposta SAK</font></i> <br><br>  Assim, por exemplo, o cart√£o Troika (padr√£o Mifare) usado no transporte p√∫blico de Moscou tem um valor de <b>SAK = 0x08 (b00001000)</b> , no qual o sexto bit √© zero.  Enquanto para todos os cart√µes banc√°rios nas respostas SAK, o sexto bit √© 1, o que significa suporte ao protocolo ISO 14443-4. <br><br>  Portanto, tudo o que o terminal pode fazer quando v√°rios cart√µes s√£o detectados ao mesmo tempo √© excluir cart√µes que n√£o suportam a ISO 14443-4 e escolher um semelhante ao banc√°rio.  O suporte ao protocolo ISO 14443-4, a prop√≥sito, n√£o garante que este cart√£o seja um cart√£o banc√°rio, mas muito provavelmente, na carteira de uma pessoa comum, n√£o haver√° outro tipo de cart√£o que suporte a ISO 14443-4. <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/4l/q0/e_/4lq0e_bzubjholfmtdiu29fmlxe.png"></div><br>  <i><font color="99999">Fluxograma do protocolo anticolis√£o</font></i> <br><br>  Por experi√™ncia pessoal: apesar da exist√™ncia de um protocolo de anticolis√µes, se houver pelo menos tr√™s cart√µes sem contato em sua carteira, √© <b><font color="red">EXTREMAMENTE</font></b> dif√≠cil ler com <b><font color="red">√™xito o</font></b> cart√£o desejado.  A maioria das tentativas resulta em erros de leitura.  √â ainda mais dif√≠cil fazer isso em fuga, agarrando-se aos bolsos e bolsas de outra pessoa. <br><br>  No entanto, consideraremos que nosso fraudador tem muita sorte e essa restri√ß√£o n√£o o incomoda. <br><br><h2>  Transa√ß√µes offline vs online </h2><br>  Em not√≠cias assustadoras, eles falam sobre golpistas com terminais POS em vag√µes do metr√¥, que escrevem dinheiro dos seus bolsos no caminho.  Essas hist√≥rias n√£o mencionam de onde o fraudador obteve Internet m√≥vel no vag√£o do metr√¥.  Talvez o terminal dele suporte transa√ß√µes offline? <br><br>  As especifica√ß√µes EMV permitem transa√ß√µes offline.  Nesse modo, o d√©bito ocorre sem confirma√ß√£o on-line do banco emissor.  Isso funciona, por exemplo, no transporte p√∫blico em Moscou e S√£o Petersburgo.  Para n√£o entrar na fila do √¥nibus, enquanto o terminal conclui a confirma√ß√£o on-line, eles permitem que voc√™ entre imediatamente, sem verificar se voc√™ tem dinheiro suficiente em sua conta para pagar a tarifa.  No final do dia, quando a Internet aparece no terminal, as transa√ß√µes assinadas s√£o enviadas ao banco emissor.  Se neste momento voc√™ n√£o tiver dinheiro para pagar a tarifa, o cart√£o ser√° adicionado √† lista de paradas em todos os terminais da cidade.  Voc√™ pode pagar a d√≠vida atrav√©s da sua conta pessoal pelo n√∫mero do cart√£o.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Leia mais</a> sobre o pagamento do √¥nibus em S√£o Petersburgo. <br><br>  Pessoalmente, n√£o consegui obter um terminal POS que suporte essa fun√ß√£o; portanto, no cen√°rio com o terminal POS "civil" usual, n√£o consideraremos a possibilidade de d√©bito offline.  Isso n√£o muda nada, exceto que o invasor precisar√° da Internet no terminal; portanto, o ataque, por exemplo, no metr√¥, √© muito mais complicado. <br>  Existem modelos de terminal que suportam WiFi e, em teoria, nosso fraudador poderia usar Wi-Fi no metr√¥, tendo anteriormente assumido a compra de acesso sem an√∫ncios para o endere√ßo MAC de seu terminal POS, de modo que a autentica√ß√£o n√£o precisaria ser feita atrav√©s do portal cativo, j√° que no POS o terminal n√£o pode fazer isso. <br><br><h2>  Calcular lucro </h2><br>  Em nosso cen√°rio, o custo do ataque foi de 100.000 rublos.  Isso significa que, para pelo menos retornar os investimentos, nosso her√≥i precisa concluir pelo menos 100 transa√ß√µes de mil rublos cada.  Imagine que ele era √°gil o suficiente e percorreu a cidade o dia inteiro, agarrando-se a todos em uma fila, de modo que, no final do dia, ele fez 120 baixas com √™xito.  N√£o levaremos em considera√ß√£o a comiss√£o de aquisi√ß√£o (em m√©dia 2%), a comiss√£o de desconto (4-10%) e outras comiss√µes. <br><br>  Ele pode sacar dinheiro com sucesso usando um cart√£o vinculado a uma conta corrente? <br><br>  Na realidade, nem tudo √© t√£o simples.  <b>O dinheiro ser√° creditado na conta do fraudador apenas em alguns dias!</b>  Durante esse per√≠odo, nosso fraudador deve esperar que nenhuma das cento e vinte v√≠timas desafie a transa√ß√£o, o que √© extremamente improv√°vel.  Portanto, na realidade, a conta do fraudador ser√° bloqueada antes mesmo que o dinheiro seja creditado nela. <br><br><blockquote>  <i>Se uma pessoa notou que foi feita uma compra em seu cart√£o que ela n√£o fez, deve entrar em contato com o banco emissor e registrar uma reclama√ß√£o.</i> <i>         30 ,   ,    ‚Äî  60 .    -   -,   -     ,          .</i> <br><br> <b> ,           ()</b> <br></blockquote><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O custo de um ataque em nosso cen√°rio √© de 100.000 rublos. De fato, ser√° v√°rias vezes maior, portanto, o fraudador precisar√° de muito mais esfor√ßo para obter lucro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em nosso cen√°rio, o fraudador sempre baixa 999,99 rublos, o que provavelmente resultar√° na opera√ß√£o do sistema antifraude do lado do banco adquirente. Na realidade, o fraudador precisar√° anular quantias menores. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para pelo menos recuperar os investimentos, o fraudador precisar√° processar v√°rias centenas de v√≠timas. Se uma d√∫zia deles entrar em contato com o banco emissor e contestar a transa√ß√£o, a conta do fraudador provavelmente ser√° bloqueada. O cen√°rio em que o banco adquirente est√° em conluio com o fraudador √© improv√°vel, porque a licen√ßa para trabalhar com o MPS custa muito mais do que qualquer lucro potencial desse tipo de fraude.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dos 20 sujeitos, apenas tr√™s conseguiram cancelar o dinheiro do cart√£o, o que representa 15% de sucesso em todas as tentativas. Esses eram casos artificiais quando havia um √∫nico cart√£o no seu bolso. Nos casos com carteira e v√°rios cart√µes, o terminal retornou um erro. Em um cen√°rio com um terminal que usa firmware modificado e implementa um mecanismo anticolis√£o, a porcentagem de cobran√ßas bem-sucedidas pode ser maior. No entanto, mesmo no caso de usar anticolis√µes, em condi√ß√µes reais em fuga, √© t√£o dif√≠cil contar uma carta de v√°rias, para que o d√©bito bem-sucedido nessas condi√ß√µes possa ser considerado sorte. Na realidade, a parcela de baixas com √™xito dificilmente exceder√° 10% do n√∫mero de tentativas.</font></font><br><br><blockquote> ,   ,      ,         .    -   ,     . <br></blockquote><br><h2>  2 ‚Äî  POS- </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digamos que nosso golpista trabalhe no caixa em uma loja ou em um mensageiro com um terminal de PDV m√≥vel. </font><font style="vertical-align: inherit;">Nesse caso, ele tem a oportunidade de coletar dados do cart√£o, que, em alguns casos, podem ser suficientes para pagar na Internet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, vamos descobrir como √© exatamente uma transa√ß√£o sem contato e que tipo de dados o cart√£o troca com um terminal POS. </font><font style="vertical-align: inherit;">Como estamos com pregui√ßa de ler milhares de p√°ginas da documenta√ß√£o das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especifica√ß√µes sem contato</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">EMV</font></a><font style="vertical-align: inherit;"> , simplesmente interceptamos a troca no n√≠vel f√≠sico usando o farejador HydraNFC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° alguma diferen√ßa entre a especifica√ß√£o EMV para MasterCard PayPass e Visa payWave. </font><font style="vertical-align: inherit;">Essa √© a diferen√ßa no formato da assinatura e em alguns dados. </font><font style="vertical-align: inherit;">Mas para n√≥s isso n√£o √© essencial.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Farejador NFC </font></font></h2><br><img src="https://habrastorage.org/webt/bs/sx/oy/bssxoy5b-wmgyab33hakrihmfyc.png"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O HydraNFC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um sniffer independente de c√≥digo aberto ISO-14443A que salva comandos APDU interceptados em um cart√£o SD. </font><font style="vertical-align: inherit;">A antena farejadora est√° localizada entre o terminal e o cart√£o e captura passivamente todas as informa√ß√µes transmitidas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site sobre o HydraBus e o escudo HydraNFC</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fontes de firmware</font></font></a> <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Seu navegador n√£o suporta v√≠deo HTML5. <source src="https://zhovner.com/forever/hydranfc_pos_terminal_sniff.mp4" type="video/mp4"></video></div></div></div><br> <i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demonstra√ß√£o de intercepta√ß√£o da troca entre o terminal POS e o telefone com a Apple Pay</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Olhando para o futuro, devo dizer que, nesse n√≠vel, o pagamento por telefone e um cart√£o pl√°stico comum n√£o √© diferente. </font><font style="vertical-align: inherit;">Para um terminal POS, este √© um cart√£o VISA comum. </font><font style="vertical-align: inherit;">No entanto, pagar por telefone √© muito mais seguro do que usar um cart√£o f√≠sico e analisaremos o porqu√™.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An√°lise de protocolo EMV </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Veja como √© o dep√≥sito de lixo registrado ao pagar chocolate e uma garrafa de √°gua por um valor total de 142,98 rublos usando o Apple Pay: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dados brutos recebidos do sniffer (spoiler aberto)</font></font></b> <div class="spoiler_text"><a href=""><img width="200" src="https://habrastorage.org/webt/ia/by/xg/iabyxg1ocokwqruiq9ew3qmwqws.png"></a><br>
<i><font color="99999">      ()</font></i><br>
<br>
<b>R (READER)</b> ‚Äî POS-<br>
<b>T (TAG)</b> ‚Äî  (   )<br>
<code>R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00<br>
R&gt;&gt; 93 20 <br>
T&lt;&lt; 08 fe e4 ec fe <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; 50 00 57 cd <br>
R&gt;&gt; 26 <br>
R&gt;&gt; 52 <br>
T&lt;&lt; 04 00 <br>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e <br>
T&lt;&lt; 20 fc 70 <br>
R&gt;&gt; e0 80 31 73 <br>
T&lt;&lt; 05 78 80 70 02 a5 46 <br>
R&gt;&gt; 02 00 a4 04 00 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 00 e0 42 <br>
T&lt;&lt; 02 6f 23 84 0e 32 50 41 59 2e 53 59 53 2e 44 44 46 30 31 a5 11 bf 0c 0e 61 0c 4f 07 a0 00 00 00 03 10 10 87 01 01 90 00 4b b3 <br>
R&gt;&gt; 03 00 a4 04 00 07 a0 00 00 00 03 10 10 00 bc 41 <br>
T&lt;&lt; 03 6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00 1d 66 <br>
R&gt;&gt; 02 80 a8 00 00 23 83 21 36 a0 40 00 00 00 00 01 42 98 00 00 00 00 00 00 06 43 00 00 00 00 00 06 43 18 09 18 00 e0 11 01 03 00 f9 14 <br>
T&lt;&lt; 02 77 62 82 02 00 40 94 04 18 01 01 00 9f 36 02 02 06 9f 26 08 d6 f5 6b 8a be d7 8f 23 9f 10 20 1f 4a ff 32 a0 00 00 00 00 10 03 02 73 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 9f 6c 02 00 80 57 13 48 00 99 72 50 51 17 56 d2 31 22 01 00 00 05 20 99 99 5f 9f 6e 04 23 88 00 00 9f 27 01 80 90 00 af c8 <br>
R&gt;&gt; 03 00 b2 01 1c 00 c9 05 <br>
T&lt;&lt; 03 70 37 5f 28 02 06 43 9f 07 02 c0 00 9f 19 06 04 00 10 03 02 73 5f 34 01 00 9f 24 1d 56 30 30 31 30 30 31 34 36 31 38 30 34 30 31 37 37 31 30 31 33 39 36 31 36 37 36 32 35 90 00 a7 7b <br>
</code><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos analisar cada linha do despejo interceptado separadamente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R &gt;&gt; - dados transmitidos pelo terminal POS </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T &gt;&gt; - dados transmitidos pelo cart√£o (no nosso caso, um telefone com Apple Pay)</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14443-A Select</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No in√≠cio da troca, o terminal estabelece uma conex√£o com o cart√£o no n√≠vel do canal. </font><font style="vertical-align: inherit;">Para aqueles que est√£o familiarizados com redes e o modelo OSI, ser√° conveniente apresent√°-lo como o n√≠vel L2 e o UID (Identificador √önico) da placa como o endere√ßo MAC do host.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na terminologia padr√£o ISO-14443: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dispositivo de acoplamento de proximidade) √© o nome do leitor; no nosso caso, √© um PIC-terminal </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PICC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (cart√£o de circuito integrado de proximidade) √© um cart√£o; no nosso caso, o telefone desempenha esse papel</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma diferen√ßa importante entre um cart√£o de pagamento regular da Apple Pay √© que o cart√£o √© sempre leg√≠vel e n√£o permite que voc√™ controle o processo de leitura. Ele pode ser lido de maneira descontrolada pelas roupas, enquanto o telefone, caindo no campo de a√ß√£o do leitor, solicita que o usu√°rio ative um cart√£o virtual. At√© o usu√°rio confirmar, o telefone n√£o transmite dados e o leitor nem sabe que existe um cart√£o virtual por perto.</font></font><br>
<br>
<pre><code class="plaintext">R&gt;&gt; 52 // WUPA (wake up)<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA (Answer To Request type A) <font></font>
R&gt;&gt; 93 20 // Select cascade 1 (Anti Collision CL1 SEL)<font></font>
T&lt;&lt; 08 fe e4 ec fe // UID (4 bytes) + BCC (Bit Count Check)<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SEL (select tag 0x9370) + UID + CRC16<font></font>
T&lt;&lt; 20 fc 70  // SAK (Select Acknowledge 0x20) + CRC16 <font></font>
R&gt;&gt; 50 00 57 cd // HALT (Disable communocaion 0x5000) + CRC16<font></font>
R&gt;&gt; 26 // REQA<font></font>
R&gt;&gt; 52 // WUPA<font></font>
T&lt;&lt; 04 00 // ATQA<font></font>
R&gt;&gt; 93 70 08 fe e4 ec fe dd 6e // SELECT<font></font>
T&lt;&lt; 20 fc 70 // SAK<font></font>
R&gt;&gt; e0 80 31 73 // RATS (Request Answer to Select 0xE080) + CRC16<font></font>
T&lt;&lt; 05 78 80 70 02 a5 46 // ATS (Answer to select response)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terminal envia constantemente o </font><font style="vertical-align: inherit;">comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x52</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wake-up (WUPA) e, assim que o cart√£o aparece no campo de a√ß√£o, ele responde com o comando Atender a solicitar o tipo A (ATQA), no caso, √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x04 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A resposta ATQA pode variar de acordo com os fabricantes de chips. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s receber uma resposta ATQA, o terminal inicia um procedimento de detec√ß√£o de colis√£o para determinar se h√° mais de um cart√£o no campo de a√ß√£o. O </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comando 0x93 0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Select cascade level 1 (SEL CL1) solicita a todos os cart√µes no campo de a√ß√£o que relatem a primeira parte de seus UIDs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A placa responde com </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08 0xFE 0xE4 0xEC 0xFE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , os quatro primeiros bytes s√£o o UID da placa virtual Apple Pay e a </font><font style="vertical-align: inherit;">verifica√ß√£o de contagem de bits </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xFE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (BCC) no final.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s receber os identificadores do cart√£o, o leitor acessa o cart√£o espec√≠fico com o comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x93 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (SELECT). Para uma equipe para ser cart√£o UID </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x08 0xfe 0xe4 0xec</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o BCC + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xDD 0x6E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cart√£o responde com </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x20</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Selecione Confirma√ß√£o (SAK) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xfc 0x70</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se v√°rias respostas SAK forem recebidas nesta etapa, o leitor poder√° reduzir o comprimento do UID no comando SELECT at√© que um √∫nico cart√£o responda. No entanto, como mostrado acima, alguns terminais POS se recusam a continuar se forem detectadas colis√µes neste est√°gio, ou seja, a presen√ßa de v√°rios cart√µes ao mesmo tempo.</font></font><br>
<br>
<blockquote> UID   4, 7  10 .    ,   ,      Apple Pay, UID   4 . ,  Apple Pay   UID   ,     ,  UID  . ,     ,         ,       UID     . <br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O leitor envia o comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x50 0x00</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HALT + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x57 0xcd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. Este √© um comando de finaliza√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, o procedimento √© repetido novamente, o leitor ativa o cart√£o novamente (WUPA), mas sem verificar colis√µes, SELECT √© executado imediatamente. Por que isso √© feito - n√£o sei, talvez seja uma maneira mais confi√°vel de determinar colis√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na segunda vez que o leitor j√° envia o comando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xE0 0x80</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solicitar resposta para selecionar (RATS) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x31 0x73</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cart√£o responde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x05 0x78 0x80 0x70 0x02</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Responda para selecionar a resposta (ATS) + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xA5 0x46</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CRC16. </font></font><br>
<br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Responda para selecionar</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- A resposta √© semelhante a ATR (resposta a redefini√ß√£o) para cart√µes de contato. </font><font style="vertical-align: inherit;">Ele cont√©m informa√ß√µes sobre o tamanho m√°ximo do quadro e os par√¢metros da camada de link. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse est√°gio, o n√≠vel de "canal" √© conclu√≠do e a troca come√ßa em um protocolo de n√≠vel superior, dependendo do aplicativo contido no cart√£o. </font><font style="vertical-align: inherit;">A opera√ß√£o SELECT √© a mesma para todos os cart√µes sem contato da norma ISO 14443A, incluindo etiquetas NFC, bilhetes de transporte p√∫blico, etc.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicita√ß√£o de aplicativos dispon√≠veis - SELECT PPSE</font></font></h4><br>
<font color="grey"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o oficial: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especifica√ß√µes sem contato do EMV - PPSE e gerenciamento de aplicativos para elemento seguro</font></font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O in√≠cio da comunica√ß√£o com um cart√£o EMV sempre ocorre lendo o PPSE (ambiente do sistema de pagamento). </font><font style="vertical-align: inherit;">O terminal pergunta ao cart√£o quais aplicativos de pagamento est√£o nele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na maioria das vezes, esse √© um aplicativo, como no nosso exemplo - VISA. </font><font style="vertical-align: inherit;">No entanto, existem cart√µes com v√°rios aplicativos de pagamento, por exemplo, existem cart√µes MIR dom√©sticos especiais com dois aplicativos de pagamento. </font><font style="vertical-align: inherit;">Como o sistema de pagamento MIR n√£o funciona no exterior, um segundo aplicativo de pagamento √© integrado ao cart√£o, de fato um segundo cart√£o. </font><font style="vertical-align: inherit;">Pode ser um aplicativo do sistema de pagamento JCB ou UnionPay. </font><font style="vertical-align: inherit;">Esses cart√µes s√£o chamados de cobertura. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comando APDU SELECT PPSE</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 00'<font></font>
  00 A4 04 00 //  select <font></font>
   0E //  command data (14 )<font></font>
    32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 // command data 2PAY.SYS.DDF01<font></font>
    00 //  <font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Responder a SELECT PPSE</font></font></b><br>
<br>
<pre><code class="cpp">'6F 23 84 0E 32 50 41 59 2E 53 59 53 2E 44 44 46 30 31 A5 11 BF 0C 0E 61 0C 4F 07 A0 00 00 00 03 10 10 87 01 01 90 00'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conveni√™ncia, analisaremos a resposta usando o analisador on-line do formato TVL </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info/lib/EMV/TLVs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A mesma resposta processada pelo analisador: </font></font><br>
<br>
<img width="900" alt="EMV SELECT PPSE VISA RESPONE parsed" src="https://habrastorage.org/webt/yi/x_/_y/yix__y6me7kqdg9inwi05eyk1yq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De tudo isso, estamos interessados ‚Äã‚Äãapenas no identificador de aplicativo de pagamento (AID). Nesse caso, esse valor √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A0000000031010</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , significando Visa International. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AID √© marcado com um marcador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4F</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O segundo bit ap√≥s o token √© o comprimento dos dados que ele cont√©m. Embora o comprimento do AID possa variar de 5 a 16 bytes, na maioria dos casos √© de 7 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grande lista de AID: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eftlab.co.uk/knowledge-base/211-emv-aid-rid-pix</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Alguns </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">AIDs</font></a><font style="vertical-align: inherit;"> populares</font></font><br>
<br>
<pre><code class="plaintext">A0000000031010 Visa International<font></font>
A0000000032020 Visa International<font></font>
A0000000041010 Mastercard International<font></font>
A0000000043060 Mastercard International United States Maestro (Debit)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indicador de prioridade do aplicativo - indica a prioridade dos aplicativos de pagamento. </font><font style="vertical-align: inherit;">Por exemplo, nos cart√µes de cobertura do MIR que possuem v√°rios aplicativos de pagamento, esse campo indica qual dos dois aplicativos √© priorizado. </font><font style="vertical-align: inherit;">Como temos apenas um pedido da Visa International, ele aponta para ele e n√£o h√° prioridade. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar aplicativo de pagamento - SELECIONE AJUDA</font></font></b><br>
<br>
<pre><code class="cpp">'00 A4 04 00 07 A0 00 00 00 03 10 10'<font></font>
  00 A4 04 00 //  select <font></font>
   07 //  command data (7 )<font></font>
    A0 00 00 00 03 10 10 // AID Visa International<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de selecionar o aplicativo de pagamento necess√°rio, o terminal o inicia. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PDOL (Lista de objetos de dados de op√ß√µes de processamento)</font></font></h4><br>
<pre><code class="cpp">'6f 31 84 07 a0 00 00 00 03 10 10 a5 26 9f 38 18 9f 66 04 9f 02 06 9f 03 06 9f 1a 02 95 05 5f 2a 02 9a 03 9c 01 9f 37 04 bf 0c 08 9f 5a 05 60 08 40 06 43 90 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos analisar a resposta com o analisador </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lo/jr/dh/lojrdhsptl6kkauc02a5c0qwnme.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resposta ao lan√ßamento do aplicativo de pagamento, o cart√£o relata um conjunto de par√¢metros que espera receber do terminal - PDOL (Lista de objetos de dados de op√ß√µes de processamento). </font><font style="vertical-align: inherit;">O terminal deve responder estritamente de acordo com esta sequ√™ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PDOLs para cart√µes diferentes podem variar. </font><font style="vertical-align: inherit;">O n√∫mero total de par√¢metros do PDOL √© de v√°rias dezenas. </font><font style="vertical-align: inherit;">Uma lista completa dos par√¢metros do PDOL pode ser encontrada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar uma olhada no PDOL. </font><font style="vertical-align: inherit;">O comprimento indicado ap√≥s o marcador √© o comprimento estritamente esperado da resposta do terminal a esta solicita√ß√£o. </font><font style="vertical-align: inherit;">Uma resposta vazia √© preenchida com zeros no comprimento desejado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An√°lise de solicita√ß√£o PDOL:</font></font><br>
<br>
<pre><code class="cpp">9F 38 18 //   PDOL.  18 (24 ) <font></font>
 9F 66 ( 04) // Terminal Transaction Qualifiers (TTQ).    . <font></font>
  9F 02 ( 06) //  <font></font>
   9F 03 ( 06) //  <font></font>
   9F 1A ( 02) //     ISO3166-1<font></font>
   95 ( 05) // Terminal Verification Results<font></font>
    5F 2A ( 02) //  ,    ,   ISO4217<font></font>
     9A ( 03) //    YYMMDD<font></font>
      9C ( 01) //   <font></font>
       9F 37 ( 04) //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At√© este ponto, todos os dados transmitidos s√£o id√™nticos para todas as transa√ß√µes neste cart√£o.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solicita√ß√£o de cobran√ßa - OBTENHA OP√á√ïES DE PROCESSAMENTO </font></font></h4><br>
<pre><code class="cpp">'80A8000023832136A0400000000001429800000000000006430000000000064318091800E011010300'<font></font>
 80 A8 00 00 //  GET PROCESSING OPTIONS (GPO)<font></font>
  23 //    (35 )<font></font>
   83 //  PDOL-<font></font>
    21 //  PDOL- (33 )<font></font>
     36 A0 40 00 // Terminal Transaction Qualifiers (TTQ)<font></font>
      00 00 00 01 42 98 //   (142,98 )<font></font>
       00 00 00 00 00 00 //   <font></font>
        06 43 //    (643 - )<font></font>
         00 00 00 00 00 // Terminal Verification Results (TVR)<font></font>
          06 43 //  (643 - russian ruble) <font></font>
           18 09 18 //  (18  2018 )<font></font>
            00 //  <font></font>
             E0 11 01 03 //   <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta resposta mostra claramente como o terminal, localizado na R√∫ssia, solicita o d√©bito no cart√£o no valor de 142,98 rublos. </font><font style="vertical-align: inherit;">Chamamos a aten√ß√£o para o n√∫mero aleat√≥rio no final (E0110103). </font><font style="vertical-align: inherit;">Este √© o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√∫mero imprevis√≠vel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do par√¢metro </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">9F37</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta √© a primeira men√ß√£o √† criptografia. </font><font style="vertical-align: inherit;">No futuro, esse n√∫mero, juntamente com os dados da transa√ß√£o, o cart√£o ter√° que assinar com uma assinatura criptogr√°fica. </font><font style="vertical-align: inherit;">Isso d√° ao terminal controle sobre a relev√¢ncia da assinatura do cart√£o e protege contra ataques de repeti√ß√£o.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resposta do cart√£o a GET PROCESSING OPTIONS </font></font></h4><br>
<pre><code class="cpp">'7762820200409404180101009F360202069F2608D6F56B8ABED78F239F10201F4AFF32A00000000010030273000000004000000000000000000000000000009F6C02008057134800997250511756D23122010000052099995F9F6E04238800009F2701809000'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta resposta cont√©m campos de dados espec√≠ficos do VISA, portanto, usei um analisador com suporte para a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especifica√ß√£o de pagamento sem contato VISA (VCSP)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img width="600" src="https://habrastorage.org/webt/n-/b0/la/n-b0laaskytjo0ahyyvlo6e7js0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perfil de interc√¢mbio de aplicativos (AIP) - cont√©m informa√ß√µes sobre os par√¢metros do aplicativo de pagamento. No nosso caso, o AIP √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00 40</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Considere os valores desse par√¢metro do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EMV 4.3, livro 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/rp/tc/ya/rptcyalvdwd6oaycintkbt02krq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nosso caso, um bit √© definido no segundo byte, que, de acordo com esta tabela, √© reservado para uso futuro (RFU). O que isso significa e qual √© o objetivo de investir no Apple Pay, eu n√£o sei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O AIP cont√©m informa√ß√µes importantes sobre os m√©todos de autentica√ß√£o suportados (SDA, CDA, DDA) de pagamento. Por que, no meu caso, todas essas bandeiras s√£o iguais a zero - eu n√£o entendo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AFL (Application File Locator) - Cont√©m informa√ß√µes do intervalo de registros SFI em um AID espec√≠fico. Com base nesta resposta, o terminal ir√° gerar uma solicita√ß√£o de READ RECORD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos analisar a resposta da AFL com mais detalhes: O </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Short File Identifier (SFI) √© 0x18. Este par√¢metro √© codificado com cinco bits em vez de oito. Assim, o valor 0x18 (b00011000) √© convertido em b00000011 e obtemos 0x3. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro registro = 1</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√öltimo registro = 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou seja, na "pasta" N¬∫ 3, existem entradas de 1 a 1, ou seja, uma entrada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Application Transaction Counter (ATC) √© um contador de transa√ß√£o incremental que aumenta um a cada vez que uma GET PROCESSING OPTIONS √© solicitada. Ao atingir o valor 0xFFFF ou 0x7FFF, o aplicativo de pagamento ser√° bloqueado permanentemente. Eu acredito que isso √© feito para proteger contra a for√ßa bruta da chave privada do cart√£o. No nosso caso, pode-se ver que este iPhone com Apple Pay j√° foi usado para pagar 518 (0x206) vezes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criptograma de aplicativo (AC) - uma assinatura criptogr√°fica calculada pelo cart√£o usando sua chave privada. Essa assinatura √© transmitida juntamente com o restante dos dados ao banco emissor, e a autenticidade da transa√ß√£o √© verificada com base. Como a chave privada do cart√£o n√£o pode ser (meio acess√≠vel) extra√≠da do cart√£o, isso elimina a possibilidade de copiar o cart√£o. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados do aplicativo do emissor (IAD) - cont√©m dados propriet√°rios espec√≠ficos do VISA. </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu n√£o dominava a an√°lise dessa estrutura, ajuda.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Qualificadores de transa√ß√£o de cart√£o (CTQ) - lista espec√≠fica de vistos de especifica√ß√µes de cart√µes suportadas. Por exemplo, √© poss√≠vel usar esse cart√£o sem contato para transa√ß√µes em um caixa eletr√¥nico ou n√£o, e que tipo de confirma√ß√£o ser√° necess√°ria. </font></font><br>
<br>
<img align="right" width="200" src="https://habrastorage.org/webt/vd/aw/ny/vdawnyz0tkkjbs-rradkbk0loiy.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faixa 2 Dados Equivalentes - </font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oppa!</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este campo cont√©m o n√∫mero do cart√£o e a data de validade. Mais detalhes sobre essas informa√ß√µes ser√£o discutidos posteriormente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indicador Facto do formul√°rio (FFI) - campo espec√≠fico do VISA. </font><font style="vertical-align: inherit;">Descreve o fator de forma e as caracter√≠sticas de um dispositivo de pagamento. </font><font style="vertical-align: inherit;">No nosso caso, √© claro que este √© um telefone m√≥vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dados de informa√ß√µes criptogr√°ficas (CID) - </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o dominei a an√°lise dessa estrutura, ajuda.</font></font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulta READ DATA RECORD</font></font></h4><br>
<pre><code class="cpp">'00 b2 01 1c 00'
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terminal envia uma solicita√ß√£o para ler os registros recebidos da AFL: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/od/jw/mv/odjwmvemclc5gd4q6dhvlcmqfjy.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nesse caso, a partir do byte </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x1C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , leia como dois valores, onde os cinco primeiros bits s√£o 0x18 (b000011) e SFI, e os pr√≥ximos tr√™s bits s√£o 0x04 (d100) e comp√µem o n√∫mero do registro.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Responder a LER RECORD</font></font></h2><br>
<pre><code class="cpp">'70375F280206439F0702C0009F19060400100302735F3401009F241D5630303130303134363138303430313737313031333936313637363235'
</code></pre><br>
<img src="https://habrastorage.org/webt/x9/ke/vv/x9kevvho_se85wg6vlgkwrd4jtw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Controle de uso de aplicativos (AUC) - determina se √© permitido pagar com um cart√£o no exterior e os tipos de opera√ß√µes permitidos. </font></font><br>
<br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9F19 √© algo incompreens√≠vel, aparentemente - a desatualiza√ß√£o de Tokeniza√ß√£o</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
EMV de </font><i><font color="99999"><font style="vertical-align: inherit;">Lista de Objetos de Dados de Autentica√ß√£o de Dados Din√¢micos (DDOL)</font></font></i><font style="vertical-align: inherit;"> , Refer√™ncia de Conta de Pagamento (PAR) √© um par√¢metro espec√≠fico para cart√µes tokenizados (virtuais). </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu n√£o dominava a an√°lise dessa estrutura, ajuda.</font></font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que pode ser extra√≠do de uma transa√ß√£o interceptada?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisamos um exemplo espec√≠fico do tr√°fego interceptado de uma transa√ß√£o sem contato do Apple Pay com um cart√£o VISA vinculado. O protocolo MasterCard √© um pouco diferente, mas em geral semelhante. A partir da an√°lise, pode-se ver que a transa√ß√£o √© protegida por assinatura criptogr√°fica e o protocolo √© protegido contra um ataque de repeti√ß√£o. </font></font><i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe um protocolo de pagamento desatualizado sem contato no modo Magnetic Stripe (MSD), que √© muito menos protegido contra ataques de repeti√ß√£o, mas neste artigo eu n√£o vou desmont√°-lo, porque, tanto quanto eu sei, ele quase n√£o √© suportado no CIS, talvez eu esteja enganado. </font></font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/ys/kk/8_/yskk8_eztdatvwiziqusnqsa2ee.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A partir dos dados interceptados, voc√™ pode extrair o n√∫mero do cart√£o (PAN) e a data de validade</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, do tr√°fego interceptado, voc√™ pode extrair o n√∫mero completo do cart√£o e a data de validade. </font><font style="vertical-align: inherit;">Embora o CVV n√£o esteja nesse lix√£o, esses dados j√° s√£o suficientes para pagar em algumas lojas online. </font><font style="vertical-align: inherit;">No caso de um cart√£o de pl√°stico f√≠sico comum, os dados interceptados conter√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o mesmo PAN e data de validade impressa no pr√≥prio cart√£o!</font></font></b><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pagamento pela Internet sem CVV (CNP, MO / TO)</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No meu artigo anterior </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúUsamos o cart√£o Apple Pay e Troika como um passe para o trabalho‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre o ACS baseado no Apple Pay, fui criticado nos coment√°rios, dizendo que apenas com os √∫ltimos 10 d√≠gitos do cart√£o voc√™ pode roubar dinheiro. No despejo acima, n√£o apenas o n√∫mero completo do meu cart√£o √© indicado, mas tamb√©m a data de validade. Esses dados s√£o suficientes para pagar em algumas lojas na Internet. Bem, tente fazer isso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ue/-q/wt/ue-qwtah0au0uftojwdu8qsrs3m.png"><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O formul√°rio de adi√ß√£o de cart√£o da Amazon n√£o requer CVV</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se fosse um n√∫mero de cart√£o f√≠sico, o dinheiro poderia realmente ser roubado, mas os dados do token Apple Pay podem ser usados ‚Äã‚ÄãSOMENTE para opera√ß√µes de Presente do Cliente (CP) quando o cart√£o assinar a transa√ß√£o com uma assinatura criptogr√°fica. </font><font style="vertical-align: inherit;">Esses dados n√£o podem ser utilizados para pagamento na Internet e outras opera√ß√µes como o Cart√£o n√£o presente (CNP), ou seja, por telefone ou e-mail. </font><font style="vertical-align: inherit;">√â isso a√≠! </font></font><br>
<br>
<font color="r"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para todos que desejam verificar isso, informo que os detalhes do despejo do Apple Pay interceptados acima s√£o relevantes no momento e est√£o vinculados a um cart√£o v√°lido com dinheiro. </font><font style="vertical-align: inherit;">No momento da reda√ß√£o deste artigo, s√£o 5 mil rublos. </font><font style="vertical-align: inherit;">Sugiro tentar roub√°-los :)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que o Apple Pay √© mais seguro que um cart√£o comum</font></font></h2><br>
<div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/jz/cn/2n/jzcn2ndu1pfw-znat4mxtab6k8k.png"></div><br>
<i><font color="99999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apple Pay vs cart√£o sem contato normal</font></font></font></i><br>
<br>
<ul>
<li> <b>Apple Pay   (  )    .</b>            POS-.  , ¬´¬ª        ,       ,   ,     ,   ,   .  Apple Pay  ,            ,       .</li>
<li><b>     </b> ‚Äî    Apple Pay      (13,56 ),   ,           .       .     Apple Pay     ,     .</li>
<li><b>       </b> ‚Äî         Card not present (CNP),      ,    ..     Apple Pay    . </li>
<li><b>   </b> ‚Äî        (Cardholder name)    .   ,   ,    .  Apple Pay    . </li>
</ul><br>
<h2></h2><br>
     .     ,         .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a>.<br>
<br>
  , Apple Pay     .      CNP- (  )    ,         .<br>
<br>
<hr><br>
 :<br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empresas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tehpos.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o hardware.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banco Ural de Reconstru√ß√£o e Desenvolvimento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e pessoalmente a Alexander Paderin (Diretor Gerente do Centro de Seguran√ßa da Informa√ß√£o) para consultas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Armazenar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aj.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para fornecer iPhones para testar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valeria </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquamine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ilustra√ß√µes para o artigo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleb </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JRun,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da Digital Security, para consultoria t√©cnica.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexGre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para consultas sobre o protocolo EMV.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habrayuzeru </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para um excelente analisador de EMV: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iso8583.info</font></font></a></li>
</ul></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt422551/">https://habr.com/ru/post/pt422551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422541/index.html">O drama dos buracos na Uni√£o se transformou em uma fantasmagoria</a></li>
<li><a href="../pt422543/index.html">Pense como um programador. Tutorial de solu√ß√£o de problemas</a></li>
<li><a href="../pt422545/index.html">Maneiras de sincronizar as guias do navegador</a></li>
<li><a href="../pt422547/index.html">Para eliminar Spectre e Meltdown, voc√™ pode precisar criar um tipo completamente novo de processador</a></li>
<li><a href="../pt422549/index.html">Corda: Kotlin</a></li>
<li><a href="../pt422553/index.html">Mega extens√£o oficial do navegador rouba compartilhamento de arquivos e criptomoeda</a></li>
<li><a href="../pt422555/index.html">Arquitetura multi-m√≥dulo Android. A a Z</a></li>
<li><a href="../pt422561/index.html">Como a Yandex aplicou a vis√£o computacional para melhorar a qualidade das transmiss√µes de v√≠deo. Tecnologia DeepHD</a></li>
<li><a href="../pt422565/index.html">Webinars de sexta-feira da Skillbox: tudo para programadores e designers</a></li>
<li><a href="../pt422569/index.html">De hora em hora, aplicativo de rastreamento de tempo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>