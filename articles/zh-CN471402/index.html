<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤓 🙏🏿 🥄 iptables和过滤来自穷人和懒惰异议者的流量 ❔ 👫 🛐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="阻止访问禁止资源的相关性会影响任何管理员，这些管理员可能会被正式出示违反法律或有关当局命令的指示。 



 当有专门用于我们任务的程序和发行版时，为什么要重新发明轮子，例如：Zeroshell，pfSense，ClearOS。 

 当局提出了另一个问题：所使用的产品是否具有我们所在州的安全证书？...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>iptables和过滤来自穷人和懒惰异议者的流量</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471402/"> 阻止访问禁止资源的相关性会影响任何管理员，这些管理员可能会被正式出示违反法律或有关当局命令的指示。 <br><br><img src="https://habrastorage.org/webt/9e/uq/ev/9euqevswnrg1zv6jaq_0nwcdnzu.png"><br><br> 当有专门用于我们任务的程序和发行版时，为什么要重新发明轮子，例如：Zeroshell，pfSense，ClearOS。 <br><br> 当局提出了另一个问题：所使用的产品是否具有我们所在州的安全证书？ <br><a name="habracut"></a><br> 我们有使用以下发行版的经验： <br><br><ul><li>  Zeroshell-开发人员甚至颁发了2年的许可证，但事实证明，利益分配对我们执行对我们而言至关重要的功能是不合逻辑的； </li><li>  pfSense-尊重和荣誉，同时无聊，习惯FreeBSD防火墙的命令行对我们来说还不够方便（我认为这是一个习惯问题，但事实证明不是“那样”）； </li><li>  ClearOS-事实证明，我们的硬件运行非常缓慢，我们无法进行严格的测试，为什么要使用如此繁重的接口？ </li><li>  Ideco SELECTA。 关于Aydeko产品，这是一个有趣的产品，有一个单独的话题，但是出于政治原因，它不适合我们，但我也想就相同的Linux，Roundcube等的许可证“咬”他们。 为什么他们获得了“剪切” <b>Python</b>界面并选择了超级用户权限的原因，他们可以出售由GPL等分发的Internet社区的开发和改进模块组成的成品。 </li></ul><br> 我了解到，现在负面的呼声会向我灌输要求，以详细证实我的主观感受，但是我想说这个网络节点还是Internet的4个外部通道的流量平衡器，并且每个通道都有其自己的特征。 另一个基石是需要在不同地址空间中的多个网络接口之一上工作，我<b>准备</b>承认我还<b>没有准备好在需要的</b>地方使用VLAN。 在使用中，存在诸如TP-Link TL-R480T +之类的设备-它们表现不佳，通常会有其细微差别。 事实证明，由于Ubuntu站点外<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">IP平衡，</a>这是在Linux上配置此部分的责任<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">：我们将多个Internet通道组合为一个</a> 。 而且，每个通道可以随时“下降”或上升。 如果您对目前可以运行的脚本感兴趣（这值得一本单独的出版物），请在注释中写下。 <br><br> 有问题的解决方案并不是唯一的，但我想问一个问题：“当您考虑替代方案时，为什么公司会适应具有严格硬件要求的可疑第三方产品？” <br><br> 如果在俄罗斯有一份清单列出了乌克兰的Roskomnadzor（国家安全委员会决定的附录）（例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a> ），那么领导人也不会在地面上睡觉。 例如，管理层认为，我们得到了一份被禁地点清单，这会使工作场所的劳动生产率恶化。 <br><br> 与默认情况下禁止所有站点的其他企业的同事进行通信，并且只有在得到老板许可的情况下，您才能访问特定的站点，恭敬地微笑，思考并“抽烟”，很明显，生活依然美好，我们开始搜索。 <br><br> 我们不仅有机会分析一下“家庭主妇书籍”中有关流量过滤的内容，而且还看到了不同提供商的渠道上发生了什么，我们注意到以下食谱（所有屏幕截图都被裁剪了，请理解并原谅）： <br><div class="scrollable-table"><table><tbody><tr><td> 提供者1 </td><td>  -不打扰并强加自己的DNS服务器和透明代理服务器。 好吗？..但是我们可以访问我们需要的位置（如果需要的话：）） </td></tr><tr><td> 提供者2 </td><td>  -他认为顶级提供商应该考虑一下，顶级提供商的技术支持甚至承认了为什么我无法为我打开必要的非禁止站点。 我认为图片会逗你:) <br><br><img src="https://habrastorage.org/webt/vm/qh/v2/vmqhv2z15q8rx7wo2hqmd62zlma.png"><br><br> 事实证明，它们将禁止站点的名称转换为IP地址并阻止IP（在该IP地址上可以托管20个站点并不打扰他们）。 <br></td></tr><tr><td> 提供者3 </td><td>  -将流量传递到那里，但不允许沿着路线返回。 </td></tr><tr><td> 提供者4 </td><td>  -禁止在指定方向上对软件包进行所有操作。 </td></tr></tbody></table></div> 与VPN（Opera浏览器方面）和浏览器插件怎么办？ 首先，使用Mikrotik集线器，我们甚至获得了L7的资源密集型配方，后来我们不得不放弃它（可能还有更多的禁忌名称，当除了其对路线的直接职责外，在数十个表达式上，PPC460GT处理器达到100时，它变得很可悲） ％）。 <br><br><img src="https://habrastorage.org/webt/mh/aa/5y/mhaa5y8mjctihnqzfcauqq8ctgc.png">  。 <br><br> 清楚的是： <br>  127.0.0.1上的CSN绝对不是万能药，现代版本的浏览器仍然可以让您绕过此类麻烦。 用剥夺的权利来限制所有用户是不可能的，并且一定不要忘记大量的替代DNS。 互联网不是静态的，除新的DNS地址外，被禁止的站点还会购买新地址，更改顶级域，并可以在其地址中添加/删除字符。 但是他仍然有权过这样的生活（主观地：在这种保护下，我看到浏览器茫然地等待答案，并且包含禁止内容的元素的页面需要花费很长时间来加载）： <br><br><pre><code class="bash hljs">ip route add blackhole 1.2.3.4</code> </pre> <br> 从被禁止站点列表中获取IP地址列表将非常有效，但是由于上述原因，我们转向了对Iptables的考虑。  CentOS Linux版本7.5.1804上已经有一个实时平衡器。 <br><br> 用户的互联网应该速度很快，浏览器也不应等待半分钟，因为该页面不可用。 在长期寻找不同的锁定选项之后，我们来到了这个模型： <br> 文件1-&gt; <b>/ script /拒绝主机</b> ，禁止名称列表： <br><br><pre> <code class="plaintext hljs">test.test blablabla.bubu torrent porno</code> </pre> <br> 文件2-&gt; <b>/ script / reject_range</b> ，禁止的地址空间和地址的列表： <br><br><pre> <code class="plaintext hljs">192.168.111.0/24 241.242.0.0/16</code> </pre> <br> 脚本文件3-&gt; <b>ipt.sh</b> ，可与ipables一起使用： <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#       HOSTS=`cat /script/denied_host | grep -v '^#'` RANGE=`cat /script/denied_range | grep -v '^#'` echo "Stopping firewall and allowing everyone..." #    iptables,      sudo iptables -F sudo iptables -X sudo iptables -t nat -F sudo iptables -t nat -X sudo iptables -t mangle -F sudo iptables -t mangle -X sudo iptables -P INPUT ACCEPT sudo iptables -P FORWARD ACCEPT sudo iptables -P OUTPUT ACCEPT #     (  ) sudo sh rout.sh #          for i in $HOSTS; do sudo iptables -I FORWARD -m string --string $i --algo bm --from 1 --to 600 -p tcp -j REJECT --reject-with tcp-reset; sudo iptables -I FORWARD -m string --string $i --algo bm --from 1 --to 600 -p udp -j DROP; done #          for i in $RANGE; do sudo iptables -I FORWARD -p UDP -d $i -j DROP; sudo iptables -I FORWARD -p TCP -d $i -j REJECT --reject-with tcp-reset; done</span></span></code> </pre><br> 使用sudo的原因是我们拥有一个可以通过WEB界面进行管理的小技巧，但是正如使用这种模型超过一年的经验所表明的那样，WEB并不是必须的。 实施后，人们希望在数据库中列出站点等。 被阻止的主机数量超过250 +十几个地址空间。 确实，当通过https连接切换到站点时以及系统管理员时存在问题，我对浏览器有抱怨:)，但是这些是特殊情况，大多数对缺乏资源访问权限的响应仍在我们这边，我们还成功阻止了Opera VPN，插件例如Microsoft的friGate和遥测。 <br><br><img src="https://habrastorage.org/webt/mm/_t/jy/mm_tjyvq1tpwumvwb3pezgfmixe.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471402/">https://habr.com/ru/post/zh-CN471402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471380/index.html">渗透测试人员处于网络安全的最前沿</a></li>
<li><a href="../zh-CN471384/index.html">免费上网联盟</a></li>
<li><a href="../zh-CN471388/index.html">爱丽丝技能开发的一些功能</a></li>
<li><a href="../zh-CN471394/index.html">《哈勃周刊》第22期/如何进行团队沟通，大型公司的新税，手指上的吨，亚马逊复制产品</a></li>
<li><a href="../zh-CN471396/index.html">CSS网格如何改变内容结构</a></li>
<li><a href="../zh-CN471404/index.html">通过在另一个国家担任工程师可以赚更多的钱吗？</a></li>
<li><a href="../zh-CN471408/index.html">嗡嗡声相位逆变器的替代产品：传输线（TQWT，ALT）</a></li>
<li><a href="../zh-CN471412/index.html">有关台式机上一堆垃圾的帖子</a></li>
<li><a href="../zh-CN471414/index.html">领先的帮助台系统。 我们如何获得需求并开发云服务？</a></li>
<li><a href="../zh-CN471418/index.html">VR市场可以教给游戏设计师什么？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>