<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ ๐๐ฟ ๐ฉ๐ฝโ๐คโ๐จ๐ป ุชุดุบูู ูุฑู ูู ุนูููุฉ ุชุณููู ุฅุตุฏุงุฑ ุชุทุจูู ุฌุฏูุฏ ุฅูู Kubernetes ๐ ๐ง ๐ณ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ููุงุฑุณุชูุง ุ ุบุงูุจูุง ูุง ููุงุฌู ูููุฉ ุชูููู ุชุทุจููุงุช ุงูุนููู ูุชุนูู ุนูู Kubernetes. ุนูุฏ ุชูููุฐ ูุฐู ุงูุฃุนูุงู ุ ููุดุฃ ุนุฏุฏ ูู ุงููุดุงูู ุงููููุฐุฌูุฉ. ูููุง ุจุชุบุทูุฉ ุฃุญุฏูุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุดุบูู ูุฑู ูู ุนูููุฉ ุชุณููู ุฅุตุฏุงุฑ ุชุทุจูู ุฌุฏูุฏ ุฅูู Kubernetes</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/476320/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bl/a1/wq/bla1wqhxnafiftfwcg0s3vsyvxe.png"><br><br>  ูู ููุงุฑุณุชูุง ุ ุบุงูุจูุง ูุง ููุงุฌู ูููุฉ ุชูููู ุชุทุจููุงุช ุงูุนููู ูุชุนูู ุนูู Kubernetes.  ุนูุฏ ุชูููุฐ ูุฐู ุงูุฃุนูุงู ุ ููุดุฃ ุนุฏุฏ ูู ุงููุดุงูู ุงููููุฐุฌูุฉ.  ูููุง ุจุชุบุทูุฉ ุฃุญุฏูุง ูุคุฎุฑูุง ูู ุงูููุงูุฉ ุ ุณูุชู ูุตู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููููุงุช ุงููุญููุฉ ุนูุฏ ููู ุทูุจ ุฅูู Kubernetes</a> ุ ูุณูุชู ูุตู ุงูุขุฎุฑ ุ ุงููุฑุชุจุท ุจุงููุนู ุจุนูููุงุช CI / CD ุ ูู ูุฐู ุงูููุงูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฃูุงูุฑ ุงูุชุนุณููุฉ ูุน ูููู ูุฑู </h2><br>  ูุง ูุนุฏ ุงูุชุทุจูู ููุทููุง ูุจูุงูุงุชูุง ููุนูู ููุท ุ ุจู ูู ุฃูุถูุง ูุฌููุนุฉ ูู ุงูุฃูุงูุฑ ุงูุชุนุณููุฉ ุงูุชู ูุฌุจ ุชูููุฐูุง ูุชูููุฐ ุชุญุฏูุซ ูุงุฌุญ.  ูููู ุฃู ุชููู ูุฐู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูููุงุช ุชุฑุญูู ูููุงุนุฏ ุงูุจูุงูุงุช ุ ู "ููุงุฏู" ูุชููุฑ ุงูููุงุฑุฏ ุงูุฎุงุฑุฌูุฉ ุ ุฃู ุจุนุถ ุฃุฌูุฒุฉ ุฅุฑุณุงู ุงูุดูุฑุงุช ุฃู ุฃุฌูุฒุฉ ูู ุงูุญุฒู ุ ูุงููุณุฌููู ูู ุฎุฏูุฉ ุงูุงูุชุดุงู ุงูุฎุงุฑุฌูุฉ - ููููู ุชูุจูุฉ ููุงู ูุฎุชููุฉ ูู ูุดุงุฑูุน ูุฎุชููุฉ. <br><br>  ูุงุฐุง ุชูุฏู Kubernetes ูุญู ูุฐู ุงููุดุงููุ <a name="habracut"></a>  Kubernetes ุฌูุฏ ูู ุชุดุบูู ุงูุญุงููุงุช ููุฑูู ุ ูุจุงูุชุงูู ูุฅู ุงูุญู ุงูููุงุณู ูู ุชุดุบูู ุฃูุฑ ูู ุตูุฑุฉ ูุง.  ููููุงู ุจุฐูู ุ ููุฌุฏ ุจุฏุงุฆู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>Job</b></a> ูู Kubernetes ูุณูุญ ูู ุจุชุดุบูู pod ูุน ุญุงููุงุช ุงูุชุทุจููุงุช ููุฑุงูุจุฉ ุงูุชูุงู ูุฐุง ุงูุญุงูุธุฉ. <br><br>  ูุฐูุจ <b>ูููู</b> ุฅูู ุฃุจุนุฏ ูู ุฐูู ูููุชุฑุญ ุฅุทูุงู Job's ูู ูุฑุงุญู ูุฎุชููุฉ ูู ุนูููุฉ ุงููุดุฑ.  ูุญู ูุชุญุฏุซ ุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎุทุงูุงุช Helm</a> ุงูุชู ููููู ูู ุฎูุงููุง ุชุดุบูู Job ูุจู ุฃู ุจุนุฏ ุชุญุฏูุซ ุจูุงูุงุช ุงูููุฑุฏ.  ูู ุชุฌุฑุจุชูุง ุ ูุฐู ููุฒุฉ ูููู ุฑุงุฆุนุฉ ูููู ุงุณุชุฎุฏุงููุง ูุญู ููุงู ุงููุดุฑ. <br><br>  ููุน ุฐูู ุ ูุฅูู ูู ุงููุณุชุญูู ุงูุญุตูู ุนูู ูุนูููุงุช ูุญุฏุซุฉ ุนู ุญุงูุฉ ุงููุงุฆูุงุช ุฃุซูุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>ุจุฏุก ุงูุชุดุบูู</b></a> ูู Helm ุ ูุจุงูุชุงูู ูุฅููุง ูุณุชุฎุฏู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>werf</b></a> ุ ุงูุชู ุชุฌุนู ูู ุงููููู ูุฑุงูุจุฉ ุญุงูุฉ ุงูููุงุฑุฏ ุฃุซูุงุก ุจุฏุก ุงูุชุดุบูู ูุจุงุดุฑุฉ ูู ูุธุงู CI ุ ูุฅุฐุง ูุฌุญูุง ูู ุฐูู ุ ูููู ุจุชุดุฎูุต ุงูููุงุฑ ุณุฑูุน. <br><br>  ููุง ุงุชุถุญ ูููุง ุจุนุฏ ุ ูุฅู ูุฐู ุงูููุฒุงุช ุงููููุฏุฉ Helm ู werf ุชููู ูู ุจุนุถ ุงูุฃุญูุงู ุญุตุฑูุฉ ุจุดูู ูุชุจุงุฏู ุ ูููู ููุงู ุฏุงุฆููุง ูุฎุฑุฌ.  ุถุน ูู ุงุนุชุจุงุฑู ููู ููููู ูุฑุงูุจุฉ ุญุงูุฉ ุงูููุงุฑุฏ ูุชุดุบูู ุฃูุงูุฑ ุนุดูุงุฆูุฉ ุนูู ูุซุงู ุนูููุงุช ุงูุชุฑุญูู. <cut></cut><br><br><h2 style=";text-align:right;direction:rtl">  ุชุดุบูู ุงููุฌุฑุงุช ูุจู ุงูุฅุตุฏุงุฑ </h2><br>  ุฌุฒุก ูุง ูุชุฌุฒุฃ ูู ุฅุตุฏุงุฑ ุฃู ุชุทุจูู ูุงุนุฏุฉ ุจูุงูุงุช ูู ุชุญุฏูุซ ูุฎุทุท ุงูุจูุงูุงุช.  ูุชุถูู ุงููุดุฑ ุงูููุงุณู ููุชุทุจููุงุช ุงูุชู ุชุทุจู ุนูููุงุช ุงูุชุฑุญูู ุนู ุทุฑูู ุชุดุบูู ุฃูุฑ ูููุตู ุงูุฎุทูุงุช ุงูุชุงููุฉ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญุฏูุซ ูุงุนุฏุฉ ุงูููุฏ ุ </li><li style=";text-align:right;direction:rtl">  ุจุฏุงูุฉ ุงููุฌุฑุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุชุญููู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ูู ุงูุชุทุจูู. </li></ol><br>  ุฏุงุฎู Kubernetes ุ ูุฌุจ ุฃู ุชููู ุงูุนูููุฉ ูู ููุณูุง ุ ูููู ูุน ุชุนุฏูููุง ุญุณุจ ูุง ูุญุชุงุฌ ุฅููู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุทูุงู ุญุงููุฉ ุจุฑูุฒ ุฌุฏูุฏ ุ ูุงูุชู ูุฏ ุชุญุชูู ุนูู ูุฌููุนุฉ ุฌุฏูุฏุฉ ูู ุนูููุงุช ุงูุชุฑุญูู ุ </li><li style=";text-align:right;direction:rtl">  ุงุจุฏุฃ ุนูููุฉ ุชุทุจูู ุงูุชุฑุญูู ููู ุ ุจุนุฏ ุงูููุงู ุจุฐูู ูุจู ุชุญุฏูุซ ุฅุตุฏุงุฑ ุงูุชุทุจูู. </li></ol><br>  ุถุน ูู ุงุนุชุจุงุฑู ุงูุฎูุงุฑ ุนูุฏูุง <b>ุชููู ูุงุนุฏุฉ ุจูุงูุงุช ุงูุชุทุจูู ููุฏ ุงูุชุดุบูู ุจุงููุนู</b> ููุง ูุญุชุงุฌ ุฅูู ูุดุฑูุง ูุฌุฒุก ูู ุงูุฅุตุฏุงุฑ ุงูุฐู ููุดุฑ ุงูุชุทุจูู.  ุฎุทุงูุงู ููุงุณุจุงู ูุชุทุจูู ุงููุฌุฑุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>pre-install</code> - ูุนูู ุนูู ุฅุตุฏุงุฑ Helm ุงูุฃูู ููุชุทุจูู ุจุนุฏ ูุนุงูุฌุฉ ุฌููุน ุงูููุงูุจ ุ ูููู ูุจู ุฅูุดุงุก ุงูููุงุฑุฏ ูู Kubernetes ุ </li><li style=";text-align:right;direction:rtl">  <code>pre-upgrade</code> - ูุนูู ุนูุฏ ุชุญุฏูุซ ุฅุตุฏุงุฑ Helm ูุชุดุบููู ุ ูุซู <code>pre-install</code> ุ ุจุนุฏ ูุนุงูุฌุฉ ุงูููุงูุจ ุ ูููู ูุจู ุฅูุดุงุก ุงูููุงุฑุฏ ูู Kubernetes. </li></ul><br>  ูุซุงู ุงููุธููุฉ ุจุงุณุชุฎุฏุงู ูููู ูุงูุณูุงููุฑ ุงููุฐููุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- apiVersion: batch/v1 kind: Job metadata: name: {{ .Chart.Name }}-apply-migrations annotations: "helm.sh/hook": pre-install,pre-upgrade spec: activeDeadlineSeconds: 60 backoffLimit: 0 template: metadata: name: {{ .Chart.Name }}-apply-migrations spec: imagePullSecrets: - name: {{ required ".Values.registry.secret_name required" .Values.registry.secret_name }} containers: - name: job command: ["/usr/bin/php7.2", "artisan", "migrate", "--force"] {{ tuple "backend" . | include "werf_container_image" | indent 8 }} env: {{ tuple "backend" . | include "werf_container_env" | indent 8 }} - name: DB_HOST value: postgres restartPolicy: Never</code> </pre> <br>  <i><b>ููุงุญุธุฉ</b> : ุชู ุฅูุดุงุก ูุงูุจ YAML ุฃุนูุงู ูุน ูุฑุงุนุงุฉ ุฎุตูุตูุงุช werf.</i>  <i>ูุชูููููุง ูุน ุฑุฃุณ "ูุธูู" ุ ูููู:</i> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <i>ูุณุชุนุงุถ ุนู <code>{{ tuple "backend" . | include "werf_container_image" | indent 8 }}</code></i> <i><code>{{ tuple "backend" . | include "werf_container_image" | indent 8 }}</code></i>  <i><code>{{ tuple "backend" . | include "werf_container_image" | indent 8 }}</code> ูุตูุฑุฉ ุงูุญุงููุฉ ุงูุชู ุชุญุชุงุฌ ุฅูููุง ุ</i> </li><li style=";text-align:right;direction:rtl">  <i>ุงุญุฐู ุงูุณุทุฑ <code>{{ tuple "backend" . | include "werf_container_env" | indent 8 }}</code></i> <i><code>{{ tuple "backend" . | include "werf_container_env" | indent 8 }}</code></i>  <i><code>{{ tuple "backend" . | include "werf_container_env" | indent 8 }}</code> ุ ูุงูุชู ุชู ุชุญุฏูุฏูุง ูู ููุชุงุญ <code>env</code> .</i> </li></ul><br>  ูุฐูู ุ ุณูู ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ูุงูุจ Helm ุฅูู ุฏููู <code>.helm/templates</code> ุ ูุงูุฐู ูุญุชูู ุจุงููุนู ุนูู ุจููุฉ ููุงุฑุฏ ุงูุฅุตุฏุงุฑ.  ุนูุฏ <code>werf deploy --stages-storage :local</code> ุงุณุชุฏุนุงุก <code>werf deploy --stages-storage :local</code> ุ ุณุชุชู ูุนุงูุฌุฉ ุฌููุน ุงูููุงูุจ ุฃููุงู ุ ุซู ูุชู ุชุญููููุง ูู ูุธุงู Kubernetes. <br><br><h2 style=";text-align:right;direction:rtl">  ุจุฏุก ุนูููุงุช ุงูุชุฑุญูู ุฃุซูุงุก ุนูููุฉ ุงูุฅุตุฏุงุฑ </h2><br>  ูุชุถูู ุงูุฎูุงุฑ ุฃุนูุงู ุงุณุชุฎุฏุงู ุนูููุงุช ุงูุชุฑุญูู ููุญุงูุฉ ุนูุฏูุง ุชููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฏ ุงูุชุดุบูู ุจุงููุนู.  ูููู ูุงุฐุง ูู ุงุญุชุฌูุง ุฅูู ุทุฑุญ ูุฑุงุฌุนุฉ ุงููุฑุน ููุชุทุจูู ุ ูุชู ุทุฑุญ <b>ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงูุชุทุจูู</b> ูู ุฅุตุฏุงุฑ ูุงุญุฏุ <br><br>  <i><b>ููุญูุธุฉ</b> : ูุฏ ุชูุงุฌู ูุดููุฉ ููุงุซูุฉ ุนูุฏ ุทุฑุญูุง ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ ุฅุฐุง ููุช ุชุณุชุฎุฏู ุงูุฎุฏูุฉ ุจููุทุฉ ููุงูุฉ ุชุญุชูู ุนูู ุนููุงู IP ููุงุนุฏุฉ ุงูุจูุงูุงุช ููุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช.</i> <br><br>  ูู ูุฐู ุงูุญุงูุฉ ุ ูุฅู ุงูุณูุงููุฑ ุงููุซุจุชุฉ <code>pre-upgrade</code> ููุณุช ููุงุณุจุฉ ููุง ุ ูุฃู ุงูุชุทุจูู ุณูุญุงูู ุชุทุจูู ุนูููุงุช ุงูุชุฑุญูู ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช <i>ุบูุฑ ุงูููุฌูุฏุฉ ุจุนุฏ</i> .  ูุจุงูุชุงูู ุ ููู ุงูุถุฑูุฑู ุฅุฌุฑุงุก ุงููุฌุฑุงุช <i>ุจุนุฏ</i> ุงูุฅูุฑุงุฌ. <br><br>  ุนูุฏ ุงุณุชุฎุฏุงู Helm ุ ุชููู ูุฐู ุงููููุฉ ูุงุจูุฉ ููุชุญููู ุ ูุฃููุง <i>ูุง ุชุฑุงูุจ</i> ุญุงูุฉ ุงูุชุทุจููุงุช.  ุจุนุฏ ุชุญููู ุงูููุงุฑุฏ ูู Kubernetes ุ ูุชู ุฅุทูุงู ุฎุทุงูุงุช ุงููุดุฑ <i>ุฏุงุฆููุง</i> : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>post-install</code> - ุจุนุฏ ุชุญููู ุฌููุน ุงูููุงุฑุฏ ูู K8s ูู ุงูุฅุตุฏุงุฑ ุงูุฃูู ุ </li><li style=";text-align:right;direction:rtl">  <code>post-upgrade</code> - ุจุนุฏ ุชุญุฏูุซ ุฌููุน ุงูููุงุฑุฏ ูู K8s ุนูุฏ ุชุญุฏูุซ ุงูุฅุตุฏุงุฑ. </li></ul><br>  ููุน ุฐูู ุ ููุง ุฐูุฑูุง ุฃุนูุงู ุ <b>ูุฏู werf ูุธุงู ุชุชุจุน ููุงุฑุฏ</b> ุฃุซูุงุก ุงูุฅุตุฏุงุฑ.  ุณูู ุฃุชูุงูู ูุฐุง ุจุงูุชูุตูู ุฃูุซุฑ ููููุงู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุชุชุจุน ุ ูุณุชุฎุฏู werf ุฅููุงููุงุช ููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">kubedog</a> ุ ุงูุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏุซูุง ุนููุง</a> ุจุงููุนู ูู ุงููุฏููุฉ. </li><li style=";text-align:right;direction:rtl">  ุชุชูุญ ููุง ูุฐู ุงูููุฒุฉ ูู werf ุชุญุฏูุฏ ุญุงูุฉ ุงูุฅุตุฏุงุฑ ูุนุฑุถ ุงููุนูููุงุช ุจุดูู ูุฑูุฏ ุนู ุงูุฅููุงู ุงููุงุฌุญ ุฃู ุบูุฑ ุงููุงุฌุญ ูููุดุฑ ูู ูุงุฌูุฉ ูุธุงู CI / CD. </li><li style=";text-align:right;direction:rtl">  ุฏูู ุชููู ูุฐู ุงููุนูููุงุช ุ ูุง ูููู ูููุฑุก ุฃู ูุชุญุฏุซ ุนู ุฃู ุฃุชูุชุฉ ูุนูููุฉ ุงูุฅุตุฏุงุฑ ุ ูุฃู ุงูุฅูุดุงุก ุงููุงุฌุญ ููููุงุฑุฏ ูู ูุฌููุนุฉ Kubernetes ูู ูุงุญุฏ ููุท ูู ุงููุฑุงุญู.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏ ูุง ูุจุฏุฃ ุงูุชุทุจูู ุจุณุจุจ ุชูููู ุบูุฑ ุตุญูุญ ุฃู ุจุณุจุจ ูุดููุฉ ูู ุงูุดุจูุฉ ุ ูููู ููุดุงูุฏุฉ ุฐูู ุจุนุฏ <code>helm upgrade</code> ุ ุณูุชุนูู ุนููู ุชูููุฐ ุฎุทูุงุช ุฅุถุงููุฉ. </li></ul><br>  ุนุงุฏ ุงูุขู ุฅูู ุชุทุจูู ุงููุฌุฑุงุช ุนูู ูููู ุจุนุฏ ุงูุณูุงููุฑ.  ุงููุดุงูู ุงูุชู ูุงุฌููุงูุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญูู ุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช ูุจู ุงูุจุฏุก ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ูู ุญุงูุฉ ุงูุฏุงุฆุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูุฐูู ุ ุจุฏูู ุนูููุงุช ุชุฑุญูู ุฌุฏูุฏุฉ ุ ูุฏ ูุง ูุจุฏุฃ ุงูุชุทุจูู. </li><li style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู werf ุ ุงูุชุฑุงุถููุง ุ ูุถูู ุฃู ุฌููุน ุงููุงุฆูุงุช ูู ุญุงูุฉ <code>Ready</code> ุ ููู ุชุนูู ุฑูุงุจุท ุงููุดุฑ ูุณุชูุดู ุนูููุงุช ุงูุชุฑุญูู. </li><li style=";text-align:right;direction:rtl">  ูููู ุชุนุทูู ูุงุฆูุงุช ุงูุชุชุจุน ูู ุฎูุงู ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉ ุงูุฅุถุงููุฉ ุ ูููู ุจุนุฏ ุฐูู ูุณุชุญูู ุงูุญุตูู ุนูู ูุนูููุงุช ููุซููุฉ ุญูู ูุชุงุฆุฌ ุงููุดุฑ. </li></ul><br>  ูุชูุฌุฉ ูุฐูู ุ ุชูุตููุง ุฅูู ูุง ููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุฅูุดุงุก ุงููุธุงุฆู ูุจู ุงูููุงุฑุฏ ุงูุฑุฆูุณูุฉ ุ ูุฐูู <b>ููุณุช ููุงู ุญุงุฌุฉ ูุงุณุชุฎุฏุงู ุฎุทุงูุงุช Helm ููุชุฑุญูู</b> . </li><li style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูุฌุจ ุชุดุบูู ูุธููุฉ ูุน ุงูุชุฑุญูู ูู ูู ุนูููุฉ ูุดุฑ.  ููู ูุญุฏุซ ูุฐุง ุ <b>ูุฌุจ ุฃู ูููู ูู Job ุงุณู ูุฑูุฏ</b> (ุนุดูุงุฆู): ูู ูุฐู ุงูุญุงูุฉ ุ ุจุงููุณุจุฉ ูู Helm ุ ูููู ูุฐุง ูู ูู ูุฑุฉ ูุงุฆููุง ุฌุฏูุฏูุง ูู ุงูุฅุตุฏุงุฑ ุ ุณูุชู ุฅูุดุงุคู ูู Kubernetes. </li><li style=";text-align:right;direction:rtl">  ูุน ูุฐุง ุงูุฅุทูุงู ุ ููุณ ููุงู ูุง ูุฏุนู ููููู ูู ุฃู Job ุณูู ุชุชุฑุงูู ูุน ุนูููุงุช ุงูุชุฑุญูู ุ ูุฃู ุฌููุนูุง ุณูููู ููุง ุฃุณูุงุก ูุฑูุฏุฉ ุ ูุณูุชู ุญุฐู Job ุงูุณุงุจู ุจุฅุตุฏุงุฑ ุฌุฏูุฏ. </li><li style=";text-align:right;direction:rtl">  <b>ูุฌุจ ุฃู ุชุญุชูู ุงููููุฉ ุงูุชู ุชุญุชูู ุนูู ุนูููุงุช ุชุฑุญูู ุนูู ุญุงููุฉ init</b> ุงูุชู ุชุชุญูู ูู ุชููุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช - ูุฅูุง ูุฅููุง ูุญุตู ุนูู ูุดุฑ ุชู ุฅุณูุงุทู (ุณูู ุชูุน ุงููููุฉ ุนูู ุญุงููุฉ init). </li></ul><br>  ูุจุฏู ุงูุชูููู ุงููุงุชุฌ ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">--- apiVersion: batch/v1 kind: Job metadata: name: {{ printf "%s-apply-migrations-%s" .Chart.Name (now | date "2006-01-02-15-04-05") }} spec: activeDeadlineSeconds: 60 backoffLimit: 0 template: metadata: name: {{ printf "%s-apply-migrations-%s" .Chart.Name (now | date "2006-01-02-15-04-05") }} spec: imagePullSecrets: - name: {{ required ".Values.registry.secret_name required" .Values.registry.secret_name }} initContainers: - name: wait-db image: alpine:3.6 ommand: ["/bin/sh", "-c", "while ! nc -z postgres 5432; do sleep 1; done;"] containers: - name: job command: ["/usr/bin/php7.2", "artisan", "migrate", "--force"] {{ tuple "backend" . | include "werf_container_image" | indent 8 }} env: {{ tuple "backend" . | include "werf_container_env" | indent 8 }} - name: DB_HOST value: postgres restartPolicy: Never</code> </pre> <br>  <i><b>ููุงุญุธุฉ</b> : ุจุงููุนูู ุงูุฏููู ูููููุฉ ุ ูู ุงูุฃูุถู ุงุณุชุฎุฏุงู ุญุงููุงุช ุงูุญุฑู ุงูุฃูู ููุชุญูู ูู ุชููุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูู ุฃู ุญุงู.</i> <br><br><h2 style=";text-align:right;direction:rtl">  ูุซุงู ุนูู ูุงูุจ ุนุงููู ูุฌููุน ุนูููุงุช ุงููุดุฑ </h2><br>  ููุน ุฐูู ุ ูุฏ ุชููู ุงูุนูููุงุช ุงูุชู ููุฒู ุฅุฌุฑุงุคูุง ุฃุซูุงุก ุงูุฅุตุฏุงุฑ ุฃูุซุฑ ูู ุฅุทูุงู ุนูููุงุช ุงูุชุฑุญูู ุงููุฐููุฑุฉ ุจุงููุนู.  ููููู ุงูุชุญูู ูู ุชุฑุชูุจ ุชูููุฐ Job ููุณ ููุท ูู ุฎูุงู ุฃููุงุน ุงูุณูุงููุฑ ุ ูููู ุฃูุถูุง ูู ุฎูุงู <b>ุชุนููู ูุฒู ููู ูููู</b> - ูู ุฎูุงู <code>helm.sh/hook-weight</code> .  ูุชู ูุฑุฒ ุงูุฎุทุงูุงุช ุญุณุจ ุงููุฒู ุจุชุฑุชูุจ ุชุตุงุนุฏู ุ ูุฅุฐุง ูุงู ุงููุฒู ูู ููุณู ุ ุญุณุจ ุงุณู ุงูููุฑุฏ. <br><br>  ูุน ูุฌูุฏ ุนุฏุฏ ูุจูุฑ ูู ุงููุธุงุฆู ุ ูู ุงูููุงุฆู ุฅูุดุงุก ูุงูุจ ุนุงููู ูููุธุงุฆู ุ ููุถุน ุงูุชูููู ูู <code>values.yaml</code> .  ูุฐุง ุงูุฃุฎูุฑ ูุฏ ูุจุฏู ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">deploy_jobs: - name: migrate command: '["/usr/bin/php7.2", "artisan", "migrate", "--force"]' activeDeadlineSeconds: 120 when: production: 'pre-install,pre-upgrade' staging: 'pre-install,pre-upgrade' _default: '' - name: cache-clear command: '["/usr/bin/php7.2", "artisan", "responsecache:clear"]' activeDeadlineSeconds: 60 when: _default: 'post-install,post-upgrade'</code> </pre> <br>  ... ูุงููุงูุจ ููุณู ูุดุจู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{{- range $index, $job := .Values.deploy_jobs }} --- apiVersion: batch/v1 kind: Job metadata: name: {{ $.Chart.Name }}-{{ $job.name }} annotations: "helm.sh/hook": {{ pluck $.Values.global.env $job.when | first | default $job.when._default }} "helm.sh/hook-weight": "1{{ $index }}" spec: activeDeadlineSeconds: {{ $job.activeDeadlineSeconds }} backoffLimit: 0 template: metadata: name: {{ $.Chart.Name }}-{{ $job.name }} spec: imagePullSecrets: - name: {{ required "$.Values.registry.secret_name required" $.Values.registry.secret_name }} initContainers: - name: wait-db image: alpine:3.6 ommand: ["/bin/sh", "-c", "while ! nc -z postgres 5432; do sleep 1; done;"] containers: - name: job command: {{ $job.command }} {{ tuple "backend" $ | include "werf_container_image" | indent 8 }} env: {{ tuple "backend" $ | include "werf_container_env" | indent 8 }} - name: DB_HOST value: postgres restartPolicy: Never {{- end }}</code> </pre> <br>  ูุชูุญ ูู ูุฐุง ุงูุฃุณููุจ ุฅุถุงูุฉ ุฃูุงูุฑ ุฌุฏูุฏุฉ ุจุณุฑุนุฉ ุฅูู ุนูููุฉ ุงูุฅุตุฏุงุฑ ููุฌุนู ูุงุฆูุฉ ุงูุฃูุงูุฑ ุงููุงุจูุฉ ููุชูููุฐ ูุฑุฆูุฉ ุฃูุซุฑ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br>  ุชูุฏู ูุฐู ุงูููุงูุฉ ุฃูุซูุฉ ุนูู ุงูููุงูุจ ุงูุชู ุชุณูุญ ูู ุจูุตู ุงูุนูููุงุช ุงูุดุงุฆุนุฉ ุงูุชู ุชุญุชุงุฌ ุฅูู ุชูููุฐูุง ูู ุนูููุฉ ุฅุตุฏุงุฑ ูุณุฎุฉ ุฌุฏูุฏุฉ ูู ุงูุชุทุจูู.  ุนูู ุงูุฑุบู ูู ุฃููุง ูุงูุช ูุชูุฌุฉ ููุชุฌุฑุจุฉ ูู ุชูููุฐ ุนูููุงุช CI / CD ูู ุงูุนุดุฑุงุช ูู ุงููุดุงุฑูุน ุ ุฅูุง ุฃููุง ูุง ูุตุฑ ุนูู ุฃู ููุงู ุญููุง ูุงุญุฏูุง ุตุญูุญูุง ูุฌููุน ุงูููุงู.  ุฅุฐุง ูุงูุช ุงูุฃูุซูุฉ ุงูููุถุญุฉ ูู ุงูููุงูุฉ ูุง ุชุบุทู ุงุญุชูุงุฌุงุช ูุดุฑูุนู ุ ูุณูุณุนุฏูุง ุฃู ูุฑู ููุงูู ูู ุงูุชุนูููุงุช ูู ุดุฃููุง ุฃู ุชุณุงุนุฏ ูู ุงุณุชููุงู ูุฐู ุงููุงุฏุฉ. <br><br>  ุชุนููู ูู ุงููุทูุฑูู werf: <br><blockquote style=";text-align:right;direction:rtl">  <i>ูู ุงููุณุชูุจู ุ ุชุฎุทุท werf ูุฅุฏุฎุงู ูุฑุงุญู ูุดุฑ ูุงุจูุฉ ููุชูููู ุจูุงุณุทุฉ ุงููุณุชุฎุฏู.</i>  <i>ุจูุณุงุนุฏุฉ ูุฐู ุงููุฑุงุญู ุ ุณูููู ูู ุงููููู ูุตู ููุชุง ุงูุญุงูุชูู ูููุณ ููุท.</i> </blockquote><br><h2 style=";text-align:right;direction:rtl">  PS </h2><br>  ุงูุฑุฃ ุฃูุถูุง ูู ูุฏููุชูุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุณุชุฎุฏุงู werf ูุทุฑุญ ูุฎุทุทุงุช Helm ุงููุนูุฏุฉ</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฌููุน ููุดุฑ ููุณ ุงูููุน ูู ุงูุฎุฏูุงุช ุงููุตุบุฑุฉ ูุน werf ู GitLab CI</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฏูุฌ ุซูุงุซู ุงูุงุชุฌุงูุงุช ูู werf: ูุดุฑ ูู Kubernetes ูุน Helm" ุนูู ุงูููุดุทุงุช "</a> " ุ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุตุงุฆุญ ูุญูู Kubernetes: ุชุณุฑูุน ุนูููุฉ ุงูุชูููุฏ ูููุงุนุฏ ุงูุจูุงูุงุช ุงููุจูุฑุฉ.</a> " </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar476320/">https://habr.com/ru/post/ar476320/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar476308/index.html">ุฃูุถู 5 ููุงุฑุณุงุช ูุชุทููุฑ ุงูุจุฑูุฌูุงุช ุชุชุจุน ูู ุนุงู 2020</a></li>
<li><a href="../ar476310/index.html">ุงููุฌู ุงูุฅูุณุงูู CRM</a></li>
<li><a href="../ar476312/index.html">ุงูุฑุฏ ุฃู ุงูุฒุงูู ุฃู Vue.js - ูุงุฐุง ุชุฎุชุงุฑุ</a></li>
<li><a href="../ar476316/index.html">Vue Storefront: ุชุนุจุฆุฉ ุงูุจูุงูุงุช ูู ES</a></li>
<li><a href="../ar476318/index.html">ููุงุฌู Joker 2019 ุชูุงููุง: ููู ุฐูุจ ุฃูุจุฑ ูุคุชูุฑ Java ูู ุฑูุณูุง</a></li>
<li><a href="../ar476322/index.html">ูุฎุทุทุงุช ุงูุชูุฒูุน ุงูุฑุฆูุณูุฉ ูุน ูุฑูุฒ ููุซูู ุจู: ูุฎุทุทุงุช Giraud ู Bloma</a></li>
<li><a href="../ar476324/index.html">ููุฎุต ุฃูุชูุจุฑ ูุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</a></li>
<li><a href="../ar476328/index.html">Starlink ูู ุตููุฉ ูุจูุฑุฉ</a></li>
<li><a href="../ar476330/index.html">ููุงุฐุง ุบุงุฏุฑุช ุณุงูุช ุจุทุฑุณุจุฑุบ ุฅูู ุจููุฒุง</a></li>
<li><a href="../ar476332/index.html">ุชุญุณูู ุงูุญูุณุจุฉ ุงููููููุฉ ูุน ุชุนูู ุงูุขูุฉ ุงูููุงุณูููุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>