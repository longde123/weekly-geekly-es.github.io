<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§õ üë©üèø‚Äçüíº ü•Ä (5-2) Maneiras de migrar uma grande tabela SQL üë©üèø‚Äçü§ù‚Äçüë®üèº üßïüèΩ üÖ±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 
 Ol√° pessoal! Este √© o meu primeiro artigo e estou escrevendo em nome de um engenheiro de desenvolvimento j√∫nior em C #. Portanto, n√£o ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>(5-2) Maneiras de migrar uma grande tabela SQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434800/"><h3>  1. Introdu√ß√£o </h3><br>  Ol√° pessoal!  Este √© o meu primeiro artigo e estou escrevendo em nome de um engenheiro de desenvolvimento j√∫nior em C #.  Portanto, n√£o haver√° informa√ß√µes detalhadas sobre SQL, apenas informa√ß√µes pr√°ticas e pensamentos sobre como resolver um problema bastante √≥bvio que eu tive que enfrentar pelos mesmos rec√©m-chegados que eu. <br><br>  Primeiro, descreverei a formula√ß√£o do meu problema como um exemplo, no qual h√° uma necessidade real de mover uma tabela grande. <br><br>  Ent√£o, digamos que voc√™ tenha um servi√ßo da Web e um banco de dados SQL (MS-SQL) com uma tabela de letras html que seu servi√ßo envia aos usu√°rios.  As cartas s√£o armazenadas por v√°rios anos e n√£o podem ser exclu√≠das, pois s√£o necess√°rias para a coleta de estat√≠sticas e an√°lises.  No entanto, a cada ano o n√∫mero de letras aumenta, o banco de dados aumenta e o espa√ßo no servidor SQL est√° diminuindo (no nosso caso, outro fator foi restaurar o banco de dados no site de teste, porque o tempo aumentou proporcionalmente) e algo precisa ser feito com isso fazer.  Felizmente, no nosso caso, h√° um servidor gratuito com muito espa√ßo livre (na realidade, pode n√£o ser, e √© claro que essa √© uma solu√ß√£o tempor√°ria, mas est√° al√©m do escopo do artigo).  Portanto, surgiu o problema de mover uma mesa grande (e dizer ‚Äúgrande‚Äù, quero dizer uma mesa muito grande, tudo o que vi enquanto procurava solu√ß√µes semelhantes estava na regi√£o de 60 a 100 GB, no nosso caso, a mesa pesava mais de 300 GB). <br><br>  Vamos considerar v√°rias maneiras de resolver esse problema, mas nem todas elas se relacionam √† transfer√™ncia do tipo servidor-servidor.  √Äs vezes, pode ser necess√°rio transferir uma tabela entre bancos de dados no mesmo servidor.  Al√©m disso, alguns m√©todos s√£o puramente te√≥ricos, eu n√£o os testei todos na pr√°tica, mas provavelmente deveriam funcionar. <br><a name="habracut"></a><br><h3>  M√©todo -1.  Dados </h3><br>  N√£o importa o qu√£o √≥bvio pare√ßa, mas voc√™ deve saber quais dados voc√™ ir√° transferir.  Na maioria das vezes, os dados n√£o s√£o armazenados da maneira mais ideal e o excesso de informa√ß√µes tamb√©m pode ser armazenado.  √â prov√°vel que, no seu caso particular, voc√™ possa fazer isso sem transferir todos os dados. <br><br>  Em primeiro lugar, excluir uma coluna provavelmente pode ajud√°-lo, mas esta √© uma opera√ß√£o de bloqueio e nem sempre √© poss√≠vel interromper um servi√ßo da web.  E em Habr√© h√° um artigo no qual √© contado como pode ser realizado. <br><br>  Em segundo lugar, n√£o se esque√ßa da normaliza√ß√£o.  Talvez alguns dados possam ser transferidos para o dicion√°rio (no caso das letras, foi poss√≠vel armazenar n√£o os corpos das letras, mas modelos com os dados inseridos l√°) e apenas o ID desses elementos pode ser armazenado em uma tabela grande, o que pode liberar muito espa√ßo para voc√™. <br><br><h3>  M√©todo 0. SELECT INTO </h3><br>  Piada =) Ent√£o voc√™ s√≥ pode se colocar como base.  No entanto, se estivermos falando sobre o tamanho pequeno da tabela (o que voc√™ est√° fazendo aqui), tente transferir o banco de dados usando esta instru√ß√£o.  Al√©m disso, se voc√™ tiver uma base de teste, poder√° realizar um experimento para avaliar o tempo total de transfer√™ncia usando este m√©todo "na testa". <br><br><h3>  M√©todo 1. Backup </h3><br>  A maneira mais "can√¥nica", foi essa que se tornou a solu√ß√£o para o meu problema.  Fazemos um backup do banco de dados que cont√©m nossa tabela, restauramos em outro servidor e limpamos tudo desnecess√°rio.  Al√©m disso, se for poss√≠vel interromper o servi√ßo da web, voc√™ pode reimplement√°-lo configurando o registro na tabela transferida e excluir o antigo <b>* *</b> (aqui provavelmente haver√° um momento em que ser√° necess√°rio escrever consultas nele com jun√ß√µes, para este google como vincular sql- servidores).  Se isso n√£o for poss√≠vel, fixamos o ID da √∫ltima letra (para sincroniza√ß√£o), e precisamos excluir <b>*</b> todas as letras transferidas (continuaremos escrevendo na tabela antiga). <br><br>  <b>* Ao</b> remover um t√≥pico separado para conversa√ß√£o, pode parecer que √© muito mais r√°pido do que transferir, mas n√£o √© assim e, no caso geral, aconselho a exclus√£o de partes. <br><br><h3>  M√©todo 2: MS-SQL Management Studio </h3><br>  Se voc√™ possui este est√∫dio, pode tentar usar a ferramenta interna para exportar e importar dados.  Pessoalmente, eu li no estouro da pilha que essa coisa estava pendurada em uma mesa de 60 GB e n√£o arriscava. <br><br><h3>  M√©todo 3. Parti√ß√£o </h3><br>  M√©todo de testa aprimorado.  A id√©ia √© transferir dados da maneira usual com um timer entre itera√ß√µes.  Voc√™ divide todas as linhas em partes (por exemplo, 100k cada), transfere a parte (e pode exclu√≠-la imediatamente, mas n√£o tem certeza de qu√£o segura √©), depois adormece e assim por diante.  √â melhor transferir do final para que voc√™ n√£o precise sincronizar dados no final.  O m√©todo √© obviamente muito lento, mas dessa forma voc√™ transferir√° tudo sem interromper o servi√ßo da web.  Provavelmente, ser√° mais conveniente implement√°-lo n√£o com um script SQL, mas com a ajuda de algum ORM. <br><br><h3>  Sum√°rio </h3><br>  O processo de transfer√™ncia de uma grande quantidade de dados sempre leva um certo tempo, e voc√™ deve estar preparado para isso.  N√£o existe uma maneira m√°gica de resolver instantaneamente o seu problema.  Em cada caso, voc√™ precisa desenvolver seus volumes e limita√ß√µes.  Se nenhum dos m√©todos funcionar para voc√™, considere se voc√™ pode usar qualquer combina√ß√£o deles. <br><br>  No final, gostaria de acrescentar 2 pontos importantes. <br><br>  Qualquer processo de transfer√™ncia / exclus√£o de linhas no SQL √© registrado no log de transa√ß√µes para a capacidade de reverter tudo no caso de um erro (eu anteriormente assumi que isso √© realizado apenas dentro da estrutura de uma transa√ß√£o).  Al√©m disso, o tamanho do log √© um pouco mais do que a quantidade de dados.  Verifique se voc√™ possui a quantidade necess√°ria de espa√ßo ou desative o log, mas isso n√£o √© seguro. <br><br>  Antes de transferir, voc√™ precisa garantir que o arquivo de dados e o arquivo de log tenham o tamanho certo, porque  as opera√ß√µes de expans√£o gastam uma quantidade consider√°vel de tempo e as configuram adequadamente, dessa forma voc√™ otimiza a migra√ß√£o. <br>  Obrigado a todos que leram!  Ficarei feliz em receber cr√≠ticas, coment√°rios e esclarecimentos.  Compartilhe suas maneiras e t√©cnicas para trabalhar com big data, como  frequentemente, essas s√£o informa√ß√µes muito importantes e necess√°rias que n√£o s√£o t√£o f√°ceis de encontrar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt434800/">https://habr.com/ru/post/pt434800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt434790/index.html">Tantos JDKs ... Qual deles usar e o que amea√ßa?</a></li>
<li><a href="../pt434792/index.html">Freelansim 2018: resultados do ano</a></li>
<li><a href="../pt434794/index.html">Soft-skills de um testador de sucesso</a></li>
<li><a href="../pt434796/index.html">Codificando a arte: como geramos gr√°ficos e anima√ß√£o em projetos de design</a></li>
<li><a href="../pt434798/index.html">Swagger - documenta√ß√£o inteligente para sua API da web RESTful - Revis√£o do desenvolvedor de back-end j√∫nior para iniciantes</a></li>
<li><a href="../pt434802/index.html">"Eu n√£o vou dar uma pedra" ou como os recursos do jogo "Terras Amaldi√ßoadas" s√£o organizados</a></li>
<li><a href="../pt434804/index.html">Robinhood, startup da Fintech, n√£o conseguiu lan√ßar um an√°logo de contas banc√°rias</a></li>
<li><a href="../pt434806/index.html">Desmonte de ano novo com uma canoa</a></li>
<li><a href="../pt434810/index.html">Starter para trabalhar com o Spring Cloud</a></li>
<li><a href="../pt434812/index.html">Gerenciamento de tempo do projeto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>