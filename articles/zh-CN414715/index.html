<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”ˆ â›µï¸ â„¢ï¸ ä»¥@Implementä¸ºä¾‹çš„ç¼–è¯‘æ—¶æ³¨é‡Š ğŸ”¬ ğŸ‘¨ğŸ¾â€ğŸ¤ ğŸ™ŒğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬éƒ½å–œæ¬¢åœ¨ç¼–è¯‘é˜¶æ®µæ•è·é”™è¯¯ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ã€‚ ä¿®å¤å®ƒä»¬çš„æœ€ç®€å•æ–¹æ³•æ˜¯ï¼Œç¼–è¯‘å™¨æœ¬èº«ä¼šæ˜¾ç¤ºæ‰€æœ‰éœ€è¦ä¿®å¤çš„ä½ç½®ã€‚ å°½ç®¡å¤§å¤šæ•°é—®é¢˜åªèƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶æ‰èƒ½æ£€æµ‹åˆ°ï¼Œä½†æˆ‘ä»¬ä»åœ¨å°è¯•å°½å¿«åšåˆ°è¿™ä¸€ç‚¹ã€‚  åœ¨ç±»çš„åˆå§‹åŒ–å—ä¸­ï¼Œåœ¨å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­ï¼Œåœ¨æ–¹æ³•çš„ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸­ï¼Œç­‰ç­‰ã€‚ æœ‰æ—¶æˆ‘ä»¬å¾ˆå¹¸è¿ï¼Œå³ä½¿åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“è¶³...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä»¥@Implementä¸ºä¾‹çš„ç¼–è¯‘æ—¶æ³¨é‡Š</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414715/"><img src="https://habrastorage.org/webt/zq/9v/1a/zq9v1afhchg4c2ft1koorkjfcss.png"><br><br> æˆ‘ä»¬éƒ½å–œæ¬¢åœ¨ç¼–è¯‘é˜¶æ®µæ•è·é”™è¯¯ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ã€‚ ä¿®å¤å®ƒä»¬çš„æœ€ç®€å•æ–¹æ³•æ˜¯ï¼Œç¼–è¯‘å™¨æœ¬èº«ä¼šæ˜¾ç¤ºæ‰€æœ‰éœ€è¦ä¿®å¤çš„ä½ç½®ã€‚ å°½ç®¡å¤§å¤šæ•°é—®é¢˜åªèƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶æ‰èƒ½æ£€æµ‹åˆ°ï¼Œä½†æˆ‘ä»¬ä»åœ¨å°è¯•å°½å¿«åšåˆ°è¿™ä¸€ç‚¹ã€‚ <a name="habracut"></a> åœ¨ç±»çš„åˆå§‹åŒ–å—ä¸­ï¼Œåœ¨å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­ï¼Œåœ¨æ–¹æ³•çš„ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸­ï¼Œç­‰ç­‰ã€‚ æœ‰æ—¶æˆ‘ä»¬å¾ˆå¹¸è¿ï¼Œå³ä½¿åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“è¶³ä»¥æ£€æŸ¥ç¨‹åºæ˜¯å¦å­˜åœ¨æŸäº›é”™è¯¯ã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«ç¼–å†™è¿™æ ·ä¸€ä¸ªæµ‹è¯•çš„ç»éªŒã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œå°±åƒç¼–è¯‘å™¨ä¸€æ ·ï¼Œåˆ›å»ºå¯ä»¥å¼•å‘é”™è¯¯çš„æ³¨é‡Šã€‚ é€šè¿‡åœ¨RuNetä¸­æ²¡æœ‰å¤ªå¤šå…³äºæ­¤ä¸»é¢˜çš„ä¿¡æ¯æ¥åˆ¤æ–­ï¼Œä¸Šè¿°çš„å¿«ä¹æƒ…å†µå¹¶ä¸å¸¸è§ã€‚ <br><br> æˆ‘å°†æè¿°é€šç”¨çš„éªŒè¯ç®—æ³•ï¼Œä»¥åŠæˆ‘èŠ±è´¹æ—¶é—´å’Œç¥ç»ç»†èƒçš„æ‰€æœ‰æ­¥éª¤å’Œç»†å¾®å·®åˆ«ã€‚ <br><br><h3> é—®é¢˜é™ˆè¿° </h3><br> åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘å°†ç»™å‡ºä¸€ä¸ªä½¿ç”¨æ­¤æ³¨é‡Šçš„ç¤ºä¾‹ã€‚ å¦‚æœæ‚¨å·²ç»çŸ¥é“è¦æ‰§è¡Œçš„æ£€æŸ¥ï¼Œåˆ™å¯ä»¥å®‰å…¨åœ°è·³è¿‡å®ƒã€‚ æˆ‘ç›¸ä¿¡è¿™ä¸ä¼šå½±å“æ¼”ç¤ºæ–‡ç¨¿çš„å®Œæ•´æ€§ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†è°ˆè®ºæ›´å¤šå…³äºæé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œè€Œä¸æ˜¯ä¿®å¤é”™è¯¯ã€‚ å¯ä»¥è¯´ä¸€ä¸ªä¾‹å­ï¼Œæ¥è‡ªç”Ÿæ´»ï¼Œæˆ–è€…æ¥è‡ªæˆ‘çš„ä¸šä½™çˆ±å¥½é¡¹ç›®ã€‚ <br><br> å‡è®¾æœ‰ä¸€ä¸ªUnitManagerç±»ï¼Œå®ƒå®é™…ä¸Šæ˜¯å•å…ƒçš„é›†åˆã€‚ å®ƒå…·æœ‰æ·»åŠ ï¼Œåˆ é™¤ï¼Œè·å–å•ä½ç­‰çš„æ–¹æ³•ã€‚ æ·»åŠ æ–°å•å…ƒæ—¶ï¼Œç®¡ç†å‘˜å°†ä¸ºå…¶åˆ†é…ä¸€ä¸ªIDã€‚  idçš„ç”Ÿæˆå§”æ‰˜ç»™RotateCounterç±»ï¼Œè¯¥ç±»è¿”å›ç»™å®šèŒƒå›´å†…çš„æ•°å­—ã€‚ è€Œä¸”æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼ŒRotateCounteræ— æ³•çŸ¥é“æ‰€é€‰IDæ˜¯å¦å¯ç”¨ã€‚ æ ¹æ®ä¾èµ–å…³ç³»åè½¬çš„åŸç†ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­æ˜¯RotateCounter.IClientï¼Œå®ƒå…·æœ‰å•ä¸ªæ–¹æ³•isValueFreeï¼ˆï¼‰ï¼Œè¯¥æ–¹æ³•æ¥æ”¶idï¼Œå¦‚æœidå¯ç”¨åˆ™è¿”å›trueã€‚ ç„¶åï¼ŒUnitManagerå®ç°æ­¤æ¥å£ï¼Œåˆ›å»ºRotateCounterçš„å®ä¾‹ï¼Œå¹¶å°†å…¶ä½œä¸ºå®¢æˆ·ç«¯ä¼ é€’ç»™è‡ªèº«ã€‚ <br><br> æˆ‘å°±æ˜¯è¿™æ ·åšçš„ã€‚ ä½†æ˜¯ï¼Œåœ¨å†™å®Œå‡ å¤©åæ‰“å¼€äº†UnitManagerçš„æºä»£ç åï¼Œå½“æˆ‘çœ‹åˆ°isValueFreeï¼ˆï¼‰æ–¹æ³•ä¸ç¬¦åˆUnitManagerçš„é€»è¾‘æ—¶ï¼Œæˆ‘é™·å…¥äº†æ··ä¹±ã€‚ å¦‚æœå¯ä»¥æŒ‡å®šå“ªä¸ªæ¥å£å®ç°æ­¤æ–¹æ³•ï¼Œåˆ™å°†æ›´åŠ ç®€å•ã€‚ ä¾‹å¦‚ï¼Œåœ¨æˆ‘æ¥è‡ªJavaçš„Cï¼ƒä¸­ï¼Œæ˜¾å¼æ¥å£å®ç°æœ‰åŠ©äºè§£å†³æ­¤é—®é¢˜ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¦–å…ˆï¼Œæ‚¨åªèƒ½åœ¨æ˜¾å¼è½¬æ¢ä¸ºæ¥å£çš„æƒ…å†µä¸‹è°ƒç”¨è¯¥æ–¹æ³•ã€‚ å…¶æ¬¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ›´é‡è¦çš„æ˜¯ï¼Œåœ¨æ–¹æ³•ç­¾åä¸­æ˜ç¡®æŒ‡å‡ºäº†æ¥å£åç§°ï¼ˆå¹¶ä¸”æ²¡æœ‰è®¿é—®ä¿®é¥°ç¬¦ï¼‰ï¼Œä¾‹å¦‚ï¼š <br><br><pre><code class="cs hljs">IClient.isValueFree(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { }</code> </pre> <br> ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æ·»åŠ å¸¦æœ‰å®ç°æ­¤æ–¹æ³•çš„æ¥å£åç§°çš„æ³¨é‡Šã€‚ ç±»ä¼¼äº<code>@Override</code> ï¼Œä»…å…·æœ‰æ¥å£ã€‚ æˆ‘åŒæ„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±åƒåœ¨Cï¼ƒä¸­ä¸€æ ·ï¼Œä¸èƒ½ä»…åœ¨å¯¹è±¡ä¸Šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œæ‚¨å¯ä»¥ç«‹å³çœ‹åˆ°å…¶å®ç°çš„æ¥å£ã€‚ ä½†æ˜¯ï¼Œè¿™å°†å¢åŠ ä»£ç é‡ï¼Œå› æ­¤ä¼šé™ä½å¯è¯»æ€§ã€‚ æ˜¯çš„ï¼Œæ‚¨éœ€è¦ä»¥æŸç§æ–¹å¼ä»ç±»ä¸­è·å–å®ƒ-åˆ›å»ºä¸€ä¸ªgetteræˆ–publicå­—æ®µï¼ˆæ¯•ç«Ÿï¼ŒJavaä¸­ä¹Ÿæ²¡æœ‰é‡è½½å¼ºåˆ¶è½¬æ¢è¯­å¥ï¼‰ã€‚ ä¸é”™çš„é€‰æ‹©ï¼Œä½†æˆ‘ä¸å–œæ¬¢å®ƒã€‚ <br><br> èµ·åˆï¼Œæˆ‘è®¤ä¸ºåœ¨Javaä¸­ï¼Œå°±åƒåœ¨Cï¼ƒä¸­ä¸€æ ·ï¼Œæ³¨é‡Šæ˜¯å®Œæ•´çš„ç±»ï¼Œå¯ä»¥ä»å®ƒä»¬ç»§æ‰¿ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åªéœ€è¦åˆ›å»ºä¸€ä¸ªä»<code>@Override</code>ç»§æ‰¿çš„æ³¨é‡Šå³å¯ã€‚ ä½†æ˜¯äº‹å®å¹¶éå¦‚æ­¤ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼Œæˆ‘ä¸å¾—ä¸æ¶‰è¶³ä»¤äººæƒŠå¥‡è€Œåˆä»¤äººææƒ§çš„æ£€æŸ¥ä¸–ç•Œã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">UnitManagerç¤ºä¾‹ä»£ç </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unit</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnitManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RotateCounter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Unit[] units; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RotateCounter idGenerator; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnitManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ units = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Unit[size]; idGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RotateCounter(<span class="hljs-number"><span class="hljs-number">0</span></span>, size, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addUnit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unit unit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id = idGenerator.findFree(); units[id] = unit; } <span class="hljs-meta"><span class="hljs-meta">@Implement</span></span>(RotateCounter.IClient.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValueFree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> units[value] == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeUnit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ units[id] = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RotateCounter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> IClient client; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> next; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> minValue; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxValue; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RotateCounter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> minValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxValue, IClient client)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client = client; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minValue = minValue; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxValue = maxValue; next = minValue; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">incrementAndGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> current = next; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (next &gt;= maxValue) { next = minValue; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> current; } next++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> current; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maxValue - minValue + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findFree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> range = range(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> trysCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++trysCounter &gt; range) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"No free values."</span></span>); } id = incrementAndGet(); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!client.isValueFree(id)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValueFree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span></span>; } }</code> </pre></div></div><br><h3> ä¸€ç‚¹ç†è®º </h3><br> æˆ‘å°†ç«‹å³è¿›è¡Œä¿ç•™ï¼Œä»¥ä¸Šæ‰€æœ‰æ–¹æ³•éƒ½æ˜¯å®ä¾‹ï¼Œå› æ­¤ï¼Œä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œæˆ‘å°†ä½¿ç”¨ç±»å‹åç§°å’Œä¸å¸¦å‚æ•°çš„æ–¹æ³•åç§°æ¥è¡¨ç¤ºæ–¹æ³•åç§°ï¼š <code>&lt;_&gt;.&lt;_&gt;()</code> ã€‚ <br><br> åœ¨ç¼–è¯‘é˜¶æ®µå¯¹å…ƒç´ çš„å¤„ç†æ¶‰åŠç‰¹æ®Šçš„å¤„ç†å™¨ç±»ã€‚ è¿™äº›æ˜¯ç»§æ‰¿è‡ª<code>javax.annotation.processing.AbstractProcessor</code>ç±»ï¼ˆæ‚¨å¯ä»¥ç®€å•åœ°å®ç°<code>javax.annotation.processing.Processor</code>æ¥å£ï¼‰ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>é˜…è¯»æœ‰å…³å¤„ç†å™¨çš„æ›´å¤šä¿¡æ¯ã€‚ å…¶ä¸­æœ€é‡è¦çš„æ–¹æ³•æ˜¯è¿‡ç¨‹ã€‚ åœ¨å…¶ä¸­æˆ‘ä»¬å¯ä»¥è·å–æ‰€æœ‰å¸¦æ³¨é‡Šå…ƒç´ çš„åˆ—è¡¨å¹¶è¿›è¡Œå¿…è¦çš„æ£€æŸ¥ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre> <br> èµ·åˆï¼Œæˆ‘éå¸¸å¤©çœŸï¼Œæˆ‘è®¤ä¸ºåœ¨ç¼–è¯‘é˜¶æ®µä½¿ç”¨ç±»å‹çš„å·¥ä½œæ˜¯ä»åå°„çš„è§’åº¦è¿›è¡Œçš„ï¼Œä½†æ˜¯â€¦â€¦æ²¡æœ‰ã€‚ ä¸€åˆ‡éƒ½åŸºäºé‚£é‡Œçš„å…ƒç´ ã€‚ <br><br>  <b>å…ƒç´ </b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">javax.lang.model.element.Element</a> ï¼‰-ä½¿ç”¨è¯¥è¯­è¨€çš„å¤§å¤šæ•°ç»“æ„å…ƒç´ çš„ä¸»ç•Œé¢ã€‚ å…ƒç´ çš„åä»£å¯ä»¥æ›´ç²¾ç¡®åœ°ç¡®å®šç‰¹å®šå…ƒç´ çš„å±æ€§ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a> ï¼‰ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ds.magic.example.implement; <span class="hljs-comment"><span class="hljs-comment">// PackageElement public class Unit // TypeElement { private int id; // VariableElement public void setId(int id) { // ExecutableElement this.id = id; } }</span></span></code> </pre> <br>  <b>TypeMirror</b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">javax.lang.model.type.TypeMirror</a> ï¼‰ä¸ç±»&lt;ï¼Ÿ&gt;ç±»ä¼¼ï¼Œç”±getClassï¼ˆï¼‰æ–¹æ³•è¿”å›ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥å°†å®ƒä»¬è¿›è¡Œæ¯”è¾ƒä»¥æ‰¾å‡ºå…ƒç´ ç±»å‹æ˜¯å¦åŒ¹é…ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>Element.asType()</code>æ–¹æ³•è·å–å®ƒã€‚ æ­¤ç±»å‹è¿˜è¿”å›ä¸€äº›ç±»å‹æ“ä½œï¼Œä¾‹å¦‚<code>TypeElement.getSuperclass()</code>æˆ–<code>TypeElement.getInterfaces()</code> ã€‚ <br><br>  <b>ç±»å‹</b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">javax.lang.model.util.Types</a> ï¼‰-æˆ‘å»ºè®®æ‚¨ä»”ç»†çœ‹ä¸€ä¸‹æ­¤ç±»ã€‚ æ‚¨å¯ä»¥åœ¨é‚£æ‰¾åˆ°å¾ˆå¤šæœ‰è¶£çš„ä¸œè¥¿ã€‚ æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ç»„ç”¨äºå¤„ç†ç±»å‹çš„å®ç”¨ç¨‹åºã€‚ ä¾‹å¦‚ï¼Œå®ƒå…è®¸æ‚¨ä»TypeMirroræ£€ç´¢TypeElementã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TypeElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asTypeElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TypeMirror typeMirror)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (TypeElement)processingEnv.getTypeUtils().asElement(typeMirror); }</code> </pre> <br>  <b>TypeKind</b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">javax.lang.model.type.TypeKind</a> ï¼‰-ä¸€ä¸ªæšä¸¾ï¼Œä½¿æ‚¨å¯ä»¥æ¾„æ¸…ç±»å‹ä¿¡æ¯ï¼Œæ£€æŸ¥ç±»å‹æ˜¯å¦ä¸ºæ•°ç»„ï¼ˆARRAYï¼‰ï¼Œè‡ªå®šä¹‰ç±»å‹ï¼ˆDECLAREDï¼‰ï¼Œç±»å‹å˜é‡ï¼ˆTYPEVARï¼‰ç­‰ã€‚ æ‚¨å¯ä»¥é€šè¿‡<code>TypeMirror.getKind()</code>è·å¾—å®ƒ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ElementKind</a> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">javax.lang.model.element.ElementKind</a> ï¼‰-æšä¸¾ï¼Œä½¿æ‚¨å¯ä»¥æ¾„æ¸…æœ‰å…³å…ƒç´ çš„ä¿¡æ¯ï¼Œæ£€æŸ¥å…ƒç´ æ˜¯å¦æ˜¯æ•°æ®åŒ…ï¼ˆPACKAGEï¼‰ï¼Œç±»ï¼ˆCLASSï¼‰ï¼Œæ–¹æ³•ï¼ˆMETHODï¼‰ï¼Œæ¥å£ï¼ˆINTERFACEï¼‰ç­‰ã€‚ <br><br>  <b>Name</b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">javax.lang.model.element.Name</a> ï¼‰-ä½¿ç”¨å…ƒç´ åç§°çš„æ¥å£ï¼Œå¯ä»¥é€šè¿‡<code>Element.getSimpleName()</code>è·å¾—ã€‚ <br><br> åŸºæœ¬ä¸Šï¼Œè¿™äº›ç±»å‹è¶³ä»¥è®©æˆ‘ç¼–å†™éªŒè¯ç®—æ³•ã€‚ <br><br> æˆ‘æƒ³æŒ‡å‡ºå¦ä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½ã€‚  Eclipseä¸­Elementæ¥å£çš„å®ç°ä½äºorg.eclipse ...åŒ…ä¸­ï¼Œä¾‹å¦‚ï¼Œè¡¨ç¤ºæ–¹æ³•çš„å…ƒç´ çš„ç±»å‹ä¸º<code>org.eclipse.jdt.internal.compiler.apt.model.ExecutableElementImpl</code> ã€‚ è¿™ä½¿æˆ‘æƒ³åˆ°äº†è¿™äº›æ¥å£æ˜¯ç”±æ¯ä¸ªIDEç‹¬ç«‹å®ç°çš„ã€‚ <br><br><h3> éªŒè¯ç®—æ³• </h3><br> é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºæ³¨é‡Šæœ¬èº«ã€‚ å…³äºå®ƒçš„æ–‡ç« å·²ç»å¾ˆå¤šäº†ï¼ˆä¾‹å¦‚ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a> ï¼‰ï¼Œå› æ­¤æˆ‘å°†ä¸å¯¹å…¶è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚ æˆ‘åªèƒ½è¯´å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤ä¸ªæ³¨é‡Š<code>@Target</code>å’Œ<code>@Retention</code> ã€‚ ç¬¬ä¸€ä¸ªæŒ‡ç¤ºæˆ‘ä»¬çš„æ³¨é‡Šåªèƒ½åº”ç”¨äºè¯¥æ–¹æ³•ï¼Œç¬¬äºŒä¸ªæŒ‡ç¤ºè¯¥æ³¨é‡Šå°†ä»…å­˜åœ¨äºæºä»£ç ä¸­ã€‚ <br><br> å¿…é¡»æŒ‡å®šæ³¨é‡Šï¼Œè¯¥æ¥å£å®ç°æ³¨é‡Šæ–¹æ³•ï¼ˆæ³¨é‡Šæ‰€åº”ç”¨çš„æ–¹æ³•ï¼‰ã€‚ è¿™å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®Œæˆï¼šè¦ä¹ˆä½¿ç”¨å­—ç¬¦ä¸²æŒ‡å®šæ¥å£çš„å…¨åï¼Œä¾‹å¦‚<code>@Implement("com.ds.IInterface")</code> ï¼Œè¦ä¹ˆç›´æ¥ä¼ é€’æ¥å£ç±»ï¼š <code>@Implement(IInterface.class)</code> ã€‚ ç¬¬äºŒç§æ–¹æ³•æ˜¾ç„¶æ›´å¥½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å°†ç›‘è§†æ­£ç¡®çš„æ¥å£åç§°ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœè°ƒç”¨æ­¤æˆå‘˜<b>å€¼ï¼ˆï¼‰ï¼Œ</b>åˆ™åœ¨å‘æ–¹æ³•ä¸­æ·»åŠ æ³¨é‡Šæ—¶ï¼Œæ— éœ€æ˜¾å¼æŒ‡å®šæ­¤å‚æ•°çš„åç§°ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({ElementType.METHOD}) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.SOURCE) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Implement { Class&lt;?&gt; value(); }</code> </pre> <br> ç„¶åï¼Œä¹è¶£å¼€å§‹äº†-åˆ›å»ºå¤„ç†å™¨ã€‚ åœ¨å¤„ç†æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è·å¾—æ‰€æœ‰å¸¦æ³¨é‡Šå…ƒç´ çš„åˆ—è¡¨ã€‚ ç„¶åï¼Œæˆ‘ä»¬è·å¾—æ³¨é‡Šæœ¬èº«åŠå…¶å«ä¹‰-æŒ‡å®šçš„æ¥å£ã€‚ é€šå¸¸ï¼Œå¤„ç†å™¨ç±»æ¡†æ¶å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SupportedAnnotationTypes</span></span>({<span class="hljs-string"><span class="hljs-string">"ds.magic.annotations.compileTime.Implement"</span></span>}) <span class="hljs-meta"><span class="hljs-meta">@SupportedSourceVersion</span></span>(SourceVersion.RELEASE_8) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImplementProcessor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Types typeUtils; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProcessingEnvironment procEnv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.init(procEnv); typeUtils = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.processingEnv.getTypeUtils(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Set&lt;? extends TypeElement&gt; annos, RoundEnvironment env)</span></span></span><span class="hljs-function"> </span></span>{ Set&lt;? extends Element&gt; annotatedElements = env.getElementsAnnotatedWith(Implement.class); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Element annotated : annotatedElements) { Implement annotation = annotatedElement.getAnnotation(Implement.class); TypeMirror interfaceMirror = getValueMirror(annotation); TypeElement interfaceType = asTypeElement(interfaceMirror); <span class="hljs-comment"><span class="hljs-comment">//... } return false; } private TypeElement asTypeElement(TypeMirror typeMirror) { return (TypeElement)typeUtils.asElement(typeMirror); } }</span></span></code> </pre> <br> æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œæ‚¨ä¸èƒ½åªè·å¾—é‚£æ ·çš„ä»·å€¼æ³¨é‡Šã€‚ å½“æ‚¨å°è¯•è°ƒç”¨<code>annotation.value()</code> ï¼Œå°†æŠ›å‡º<b>MirroredTypeException</b> ï¼Œä½†æ˜¯ä»ä¸­å¯ä»¥è·å¾—TypeMirrorã€‚ æˆ‘åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>æ‰¾åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†</a>è¿™ç§ä½œå¼Šæ–¹æ³•ä»¥åŠæ­£ç¡®çš„ä»·å€¼æ”¶æ®ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TypeMirror </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValueMirror</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Implement annotation)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { annotation.value(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(MirroredTypeException e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e.getTypeMirror(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br> æ£€æŸ¥æœ¬èº«åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¦‚æœå…¶ä¸­è‡³å°‘ä¸€ä¸ªå¤±è´¥ï¼Œåˆ™éœ€è¦æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯å¹¶ç»§ç»­ä¸‹ä¸€ä¸ªæ³¨é‡Šã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String message, Element annotatedElement)</span></span></span><span class="hljs-function"> </span></span>{ Messager messager = processingEnv.getMessager(); messager.printMessage(Kind.ERROR, message, annotatedElement); }</code> </pre> <br> ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥å€¼æ³¨é‡Šæ˜¯å¦ä¸ºæ¥å£ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (interfaceType.getKind() != ElementKind.INTERFACE) { String name = Implement.class.getSimpleName(); printError(<span class="hljs-string"><span class="hljs-string">"Value of @"</span></span> + name + <span class="hljs-string"><span class="hljs-string">" must be an interface"</span></span>, annotated); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦æ£€æŸ¥å¸¦æ³¨é‡Šçš„æ–¹æ³•æ‰€åœ¨çš„ç±»æ˜¯å¦å®é™…ä¸Šå®ç°äº†æŒ‡å®šçš„æ¥å£ã€‚ ä¸€å¼€å§‹ï¼Œæˆ‘æ„šè ¢åœ°ç”¨æ‰‹è¿›è¡Œäº†è¿™é¡¹æµ‹è¯•ã€‚ ä½†æ˜¯ï¼Œç„¶åï¼Œæ ¹æ®å¥½çš„å»ºè®®ï¼Œæˆ‘æŸ¥çœ‹äº†<b>Typesï¼Œ</b>å¹¶åœ¨å…¶ä¸­æ‰¾åˆ°<code>Types.isSubtype()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æ£€æŸ¥æ•´ä¸ªç»§æ‰¿æ ‘ï¼Œå¦‚æœå­˜åœ¨æŒ‡å®šçš„æ¥å£ï¼Œåˆ™è¿”å›trueã€‚ é‡è¦çš„æ˜¯ï¼Œä¸ç¬¬ä¸€ä¸ªé€‰é¡¹ä¸åŒï¼Œå®ƒå¯ä»¥ä¸æ³›å‹ç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚ <br><br><pre> <code class="java hljs">TypeElement enclosingType = (TypeElement)annotatedElement.getEnclosingElement(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!typeUtils.isSubtype(enclosingType.asType(), interfaceMirror)) { Name className = enclosingType.getSimpleName(); Name interfaceName = interfaceType.getSimpleName(); printError(className + <span class="hljs-string"><span class="hljs-string">" must implemet "</span></span> + interfaceName, annotated); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br> æœ€åï¼Œæ‚¨éœ€è¦ç¡®ä¿è¯¥æ¥å£å…·æœ‰ä¸å¸¦æ³¨é‡Šçš„æ–¹æ³•å…·æœ‰ç›¸åŒç­¾åçš„æ–¹æ³•ã€‚ æˆ‘æƒ³ä½¿ç”¨<code>Types.isSubsignature()</code>æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœè¯¥æ–¹æ³•å…·æœ‰ç±»å‹å‚æ•°ï¼Œå®ƒå°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å·èµ·è¢–å­ï¼Œç”¨æ‰‹å†™ä¸‹æ‰€æœ‰æ”¯ç¥¨ã€‚ æˆ‘ä»¬åˆæœ‰ä¸‰ä¸ªã€‚ å¥½å§ï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œæ–¹æ³•ç­¾åç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæ–¹æ³•çš„åç§°ï¼Œè¿”å›å€¼çš„ç±»å‹å’Œå‚æ•°åˆ—è¡¨ã€‚ æ‚¨éœ€è¦éå†æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶æ‰¾åˆ°é€šè¿‡æ‰€æœ‰ä¸‰é¡¹æ£€æŸ¥çš„æ–¹æ³•ã€‚ æœ€å¥½ä¸è¦å¿˜è®°è¯¥æ–¹æ³•å¯ä»¥ä»å¦ä¸€ä¸ªæ¥å£ç»§æ‰¿å¹¶é€’å½’åœ°å¯¹åŸºç¡€æ¥å£æ‰§è¡Œç›¸åŒçš„æ£€æŸ¥ã€‚ <br><br> è°ƒç”¨å¿…é¡»æ”¾åœ¨processæ–¹æ³•çš„å¾ªç¯æœ«å°¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!haveMethod(interfaceType, (ExecutableElement)annotatedElement)) { Name name = interfaceType.getSimpleName(); printError(name + <span class="hljs-string"><span class="hljs-string">" don't have \""</span></span> + annotated + <span class="hljs-string"><span class="hljs-string">"\" method"</span></span>, annotated); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br>  HaveMethodï¼ˆï¼‰æ–¹æ³•æœ¬èº«çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">haveMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TypeElement interfaceType, ExecutableElement method)</span></span></span><span class="hljs-function"> </span></span>{ Name methodName = method.getSimpleName(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Element interfaceElement : interfaceType.getEnclosedElements()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (interfaceElement <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ExecutableElement) { ExecutableElement interfaceMethod = (ExecutableElement)interfaceElement; <span class="hljs-comment"><span class="hljs-comment">// Is names match? if (!interfaceMethod.getSimpleName().equals(methodName)) { continue; } // Is return types match (ignore type variable)? TypeMirror returnType = method.getReturnType(); TypeMirror interfaceReturnType = method.getReturnType(); if (!isTypeVariable(interfaceReturnType) &amp;&amp; !returnType.equals(interfaceReturnType)) { continue; } // Is parameters match? if (!isParametersEquals(method.getParameters(), interfaceMethod.getParameters())) { continue; } return true; } } // Recursive search for (TypeMirror baseMirror : interfaceType.getInterfaces()) { TypeElement base = asTypeElement(baseMirror); if (haveMethod(base, method)) { return true; } } return false; } private boolean isParametersEquals(List&lt;? extends VariableElement&gt; methodParameters, List&lt;? extends VariableElement&gt; interfaceParameters) { if (methodParameters.size() != interfaceParameters.size()) { return false; } for (int i = 0; i &lt; methodParameters.size(); i++) { TypeMirror interfaceParameterMirror = interfaceParameters.get(i).asType(); if (isTypeVariable(interfaceParameterMirror)) { continue; } if (!methodParameters.get(i).asType().equals(interfaceParameterMirror)) { return false; } } return true; } private boolean isTypeVariable(TypeMirror type) { return type.getKind() == TypeKind.TYPEVAR; }</span></span></code> </pre> <br> çœ‹åˆ°é—®é¢˜äº†å—ï¼Ÿ ä¸è¡Œå— å¥¹åœ¨é‚£é‡Œã€‚ äº‹å®æ˜¯ï¼Œæˆ‘æ‰¾ä¸åˆ°ä¸€ç§æ–¹æ³•æ¥è·å–é€šç”¨æ¥å£çš„å®é™…ç±»å‹å‚æ•°ã€‚ ä¾‹å¦‚ï¼Œæˆ‘æœ‰ä¸€ä¸ªå®ç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Predicate</a>æ¥å£çš„ç±»ï¼š <br><pre> <code class="java hljs">MyPredicate implements Predicate&amp;ltString&amp;gt { <span class="hljs-meta"><span class="hljs-meta">@Implement</span></span>(Predicate.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br> åˆ†æç±»ä¸­çš„æ–¹æ³•æ—¶ï¼Œå‚æ•°çš„ç±»å‹ä¸º<code>String</code> ï¼Œè€Œåœ¨æ¥å£ä¸­ä¸º<code>T</code> ï¼Œå¹¶ä¸”æ‰€æœ‰å°è¯•è·å–<code>String</code>è€Œä¸æ˜¯<code>String</code>å°è¯•éƒ½ä¸ä¼šå¯¼è‡´ä»»ä½•ç»“æœã€‚ æœ€åï¼Œæˆ‘æ²¡æœ‰æƒ³åˆ°çš„å°±æ˜¯å¿½ç•¥ç±»å‹å‚æ•°ã€‚ è¯¥æ£€æŸ¥å°†é€šè¿‡ä»»ä½•å®é™…çš„ç±»å‹å‚æ•°ä¼ é€’ï¼Œå³ä½¿å®ƒä»¬ä¸åŒ¹é…ã€‚ å¹¸è¿çš„æ˜¯ï¼Œå¦‚æœè¯¥æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°ï¼Œå¹¶ä¸”æœªåœ¨åŸºç±»ä¸­å®ç°ï¼Œåˆ™ç¼–è¯‘å™¨å°†å¼•å‘é”™è¯¯ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°†éå¸¸æ„Ÿè°¢æ‚¨çš„æç¤ºã€‚ <br><br><h3> è¿æ¥åˆ°Eclipse </h3><br> å°±ä¸ªäººè€Œè¨€ï¼Œæˆ‘çˆ±Eclipceï¼Œåœ¨æˆ‘çš„å®è·µä¸­æˆ‘åªä½¿ç”¨å®ƒã€‚ å› æ­¤ï¼Œæˆ‘å°†æè¿°å¦‚ä½•å°†å¤„ç†å™¨è¿æ¥åˆ°æ­¤IDEã€‚ ä¸ºäº†ä½¿Eclipseèƒ½å¤Ÿçœ‹åˆ°å¤„ç†å™¨ï¼Œæ‚¨éœ€è¦å°†å…¶æ‰“åŒ…åˆ°å•ç‹¬çš„.JARä¸­ï¼Œæ‰¹æ³¨æœ¬èº«ä¹Ÿå°†åŒ…å«åœ¨å…¶ä¸­ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨é¡¹ç›®ä¸­åˆ›å»º<b>META-INF / services</b>æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º<b>javax.annotation.processing.Processor</b>æ–‡ä»¶<b>ï¼Œ</b>å¹¶æŒ‡å®šå¤„ç†å™¨ç±»çš„å…¨åï¼š <code>ds.magic.annotations.compileTime.ImplementProcessor</code> ï¼Œåœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ã€‚ ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘å°†æä¾›ä¸€ä¸ªå±å¹•æˆªå›¾ï¼Œä½†æ˜¯å½“å¯¹æˆ‘æ²¡æœ‰ä»»ä½•å¸®åŠ©æ—¶ï¼Œæˆ‘å‡ ä¹å¼€å§‹å¯¹é¡¹ç›®çš„ç»“æ„æ„Ÿåˆ°ä¸å¿«ã€‚ <br><br><img src="https://habrastorage.org/webt/bp/oo/ev/bpooev7zwn5msgfm6pyyhupedwi.png" alt="å›¾ç‰‡"><br><br> æ¥ä¸‹æ¥ï¼Œæ”¶é›†.JARå¹¶å°†å…¶è¿æ¥åˆ°æ‚¨çš„é¡¹ç›®ï¼Œé¦–å…ˆå°†å…¶ä½œä¸ºå¸¸è§„åº“ï¼Œä»¥ä½¿æ³¨é‡Šåœ¨ä»£ç ä¸­å¯è§ã€‚ ç„¶åï¼Œæˆ‘ä»¬è¿æ¥å¤„ç†å™¨ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„æœ‰</a>æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰ã€‚ ä¸ºæ­¤ï¼Œè¯·æ‰“å¼€<b>é¡¹ç›®å±æ€§ï¼Œ</b>ç„¶åé€‰æ‹©ï¼š <br><br><ol><li>  Javaç¼–è¯‘å™¨-&gt;æ³¨é‡Šå¤„ç†ï¼Œç„¶åé€‰ä¸­â€œå¯ç”¨æ³¨é‡Šå¤„ç†â€æ¡†ã€‚ </li><li>  Javaç¼–è¯‘å™¨-&gt;æ³¨é‡Šå¤„ç†-&gt;å·¥å‚è·¯å¾„ï¼Œé€‰ä¸­â€œå¯ç”¨é¡¹ç›®ç‰¹å®šè®¾ç½®â€å¤é€‰æ¡†ã€‚ ç„¶åå•å‡»â€œæ·»åŠ JAR ...â€ï¼Œç„¶åé€‰æ‹©ä»¥å‰åˆ›å»ºçš„JARæ–‡ä»¶ã€‚ </li><li> åŒæ„é‡å»ºé¡¹ç›®ã€‚ </li></ol><br><h3> æ€»ç»“ </h3><br> æ‰€æœ‰è¿™äº›ä»¥åŠåœ¨Eclipseé¡¹ç›®ä¸­éƒ½å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Š</a>çœ‹åˆ°ã€‚ åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå¦‚æœå¯ä»¥å°†æ³¨é‡Šç§°ä¸ºè¯¥ç±»ï¼Œåˆ™åªæœ‰ä¸¤ä¸ªç±»ï¼šImplement.javaå’ŒImplementProcessor.javaã€‚ æˆ‘æƒ³æ‚¨å·²ç»çŒœåˆ°äº†ä»–ä»¬çš„ç›®çš„ã€‚ <br><br> ä¹Ÿè®¸è¿™ä¸ªæ³¨é‡Šå¯¹æŸäº›äººä¼¼ä¹æ²¡æœ‰ç”¨ã€‚ ä¹Ÿè®¸æ˜¯ã€‚ ä½†å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œå½“æ–¹æ³•åç§°ä¸å¤ªé€‚åˆè¯¥ç±»ç›®çš„æ—¶ï¼Œæˆ‘è‡ªå·±ä½¿ç”¨å®ƒè€Œä¸æ˜¯<code>@Override</code> ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘è¿˜æ²¡æœ‰æ‘†è„±å¥¹çš„æ„¿æœ›ã€‚ æ€»çš„æ¥è¯´ï¼Œæˆ‘ä¸ºè‡ªå·±åšäº†ä¸€ä¸ªæ³¨é‡Šï¼Œè¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯å±•ç¤ºæˆ‘æ­£åœ¨æ”»å‡»çš„è€™å­ã€‚ æˆ‘å¸Œæœ›æˆ‘åšåˆ°äº†ã€‚ è°¢è°¢æ‚¨çš„å…³æ³¨ã€‚ <br><br>  PSã€‚ æ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">ohotNik_alex</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Comdivçš„</a>ç”¨æˆ·åœ¨ä¿®å¤é”™è¯¯æ–¹é¢çš„å¸®åŠ©ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN414715/">https://habr.com/ru/post/zh-CN414715/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414705/index.html">å…¨çƒæ‰¬å£°å™¨æ„é€ çš„æ°ä½œï¼šMonitor Audioä»ç»‡ç‰©åˆ°é‡‘å±å’Œå¤åˆææ–™çš„åˆ›æ–°ä¹‹è·¯</a></li>
<li><a href="../zh-CN414707/index.html">åŒºå—é“¾åˆ†æï¼Œæˆ–è€…ä¸ºä»€ä¹ˆæ··é¢‘å™¨ä¸­æ–­ï¼Ÿ</a></li>
<li><a href="../zh-CN414709/index.html">æ²™æ¼ ç‹®å­ä¸è‡ªçœ</a></li>
<li><a href="../zh-CN414711/index.html">è¥¿ç­ç‰™è¶³çƒåº”ç”¨ç¨‹å¼La Ligaä½¿å…¶ä½¿ç”¨è€…æˆä¸ºéè‡ªæ„¿è¯ˆéª—è€…</a></li>
<li><a href="../zh-CN414713/index.html">äº¤å‰åé¦ˆå‘¨</a></li>
<li><a href="../zh-CN414717/index.html">2018 4Kç”µè§†ï¼šæœ€ä½³é€‰æ‹©çš„å»ºè®®</a></li>
<li><a href="../zh-CN414719/index.html">å››è½®å¥½ï¼ŒäºŒè½®å¥½</a></li>
<li><a href="../zh-CN414723/index.html">ç¼–ç¨‹ç«èµ›ï¼šè´¸æ˜“</a></li>
<li><a href="../zh-CN414725/index.html">æ­£é¢å˜åŒ–ï¼šä¸ºä»€ä¹ˆå°†è´¨å­æµæ‰“å…¥äº”ç±³åšçš„æ··å‡åœŸå¢™</a></li>
<li><a href="../zh-CN414727/index.html">åŠ å¯†è´§å¸æ³•å³å°†åœ¨ä¿„ç½—æ–¯å¯åŠ¨ï¼šå®ƒå°†å¯¹å¸‚åœºå‚ä¸è€…äº§ç”Ÿä»€ä¹ˆå˜åŒ–</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>