<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê™ üë∏üèª üëäüèΩ Sobre o imut√°vel: hist√≥ria do 9¬∫ lugar da Copa da AI russa 2019 üñêüèΩ ü§ö üó∫Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chamo-me Andrey Rybalka, participo da Ta√ßa da AI da R√∫ssia com o apelido de lama e direi novamente como n√£o ganhar um macbook. Felizmente, sou uma pes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sobre o imut√°vel: hist√≥ria do 9¬∫ lugar da Copa da AI russa 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/485372/"><p>  Chamo-me Andrey Rybalka, participo da Ta√ßa da AI da R√∫ssia com o apelido de <a href="https://russianaicup.ru/profile/lama">lama</a> e <a href="https://habr.com/ru/post/440574/">direi</a> <a href="https://habr.com/ru/post/345598/">novamente</a> como n√£o ganhar um macbook.  Felizmente, sou uma pessoa experiente nisso - com essas m√£os n√£o ganhei at√© 7 pe√ßas. </p><br><p>  Ent√£o, a tarefa deste ano foi um jogo de plataformas / 2D, para o qual voc√™ teve que escrever um bot.  O jogo ficou assim: </p><br><p><img src="https://habrastorage.org/webt/81/rg/vp/81rgvptb0d2fztphudph9deltvc.jpeg"></p><br><p>  O bot ficou assim: </p><br><p><img src="https://habrastorage.org/webt/au/a7/qp/aua7qpjn5khyazt7nqnefeyvra0.png"></p><br><p>  Se voc√™ estiver interessado em saber como a figura 2 foi reproduzida na figura 1, por favor, abaixo do gato </p><a name="habracut"></a><br><p>  Se voc√™ n√£o participou e n√£o leu outros artigos, recomendo que voc√™ veja primeiro como tudo se parece em din√¢mica <a href="https://russianaicup.ru/profile/lama">no site</a> ou no tube: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/vfImU0kAFI0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="turnirnaya-sistema">  Sistema de torneio </h2><br><p>  Para iniciantes, s√£o fornecidas mais de 2 semanas para programa√ß√£o.  Ent√£o a primeira rodada come√ßa.  Dura 2 dias e os 300 melhores continuam.  Ap√≥s a rodada, as regras do jogo mudam (agora controlamos dois personagens ao mesmo tempo) e outra semana √© dada, ap√≥s a qual a segunda rodada passa.  Ent√£o as regras s√£o complicadas novamente (agora jogamos em mapas muito mais complexos), outra semana √© dada e, finalmente, jogamos a final. </p><br><p> Mas este n√£o √© o fim.  Ap√≥s as finais, h√° mais uma semana, no final da qual a caixa de areia simplesmente para, e as 6 melhores nela, excluindo os vencedores das finais, tamb√©m s√£o premiadas.  A diferen√ßa fundamental entre o final da √°rea restrita e a final do campeonato √© que, na √°rea restrita, os jogos s√£o criados em um formato aleat√≥rio, e n√£o apenas no formato da rodada atual. </p><br><h1 id="istoriya-uchastiya">  Hist√≥rico de participa√ß√£o </h1><br><p>  Onde sem ele?  Voc√™ pode pular quem n√£o estiver interessado.  A parte t√©cnica ser√° menor. </p><br><h2 id="nedelya-beta-testirovaniya-i-pervyy-raund">  Semana do Teste Beta e Rodada Um </h2><br><p>  Comecei a programar, ao que parece, no dia seguinte ao in√≠cio do Open Beta Test.  Mas, pessoalmente, foi um pouco desmotivador para mim que os organizadores desta vez, ao contr√°rio do passado, decidiram se afastar novamente da pr√°tica de publicar um pseudo-c√≥digo de um simulador.  Certamente entre os participantes estavam aqueles que gostam de escrever um simulador por engenharia reversa, mas eu n√£o sou um deles e fiquei entediado com isso.  Como este n√£o foi meu primeiro campeonato, eu sabia que mais cedo ou mais tarde me envolveria, mas, pelo motivo descrito acima, me envolvi tarde demais.  Como resultado, o que alguns participantes fizeram nos primeiros dias, fui capaz de me for√ßar a terminar em apenas uma semana e meia.  Como resultado, escrevi a primeira linha de c√≥digo do bot 5 dias antes da primeira rodada.  Em resumo, no in√≠cio do primeiro turno, eu n√£o estava pronto e o turno passou sem a minha participa√ß√£o.  Decidi entrar no segundo turno atrav√©s da discagem de ramal. </p><br><h2 id="vtoroy-raund">  Segunda rodada </h2><br><p>  Neste ponto, eu j√° programei ao m√°ximo, em m√©dia 4-6 horas por dia.  Alguns dias antes do in√≠cio do segundo turno, enviei a primeira vers√£o do bot.  Ela imediatamente subiu rapidamente e entrou rapidamente nas 10 principais caixas de areia.  Ent√£o a rodada come√ßou, onde eu fiquei em quinto lugar. </p><br><h2 id="final">  Final </h2><br><p>  Passei a primeira noite da semana final (em quatro, porque estava marcado um in√≠cio para sexta-feira) para encontrar o caminho.  Ainda havia muitas id√©ias, mas o que me concentrar e qual das potencialmente daria o melhor resultado n√£o estava claro, ent√£o tentei melhorar em primeiro lugar o que causou o maior n√∫mero de derrotas.  Na ter√ßa e na quarta-feira, houve melhorias na mira e no tiro, al√©m do controle dos kits de primeiros socorros. </p><br><p>  Ent√£o vi que algo havia acontecido que eu esperava h√° muito tempo, mas esperava que isso n√£o acontecesse - alguns oponentes come√ßaram a usar ativamente as minas. </p><br><p>  O fato √© que, durante o OBT, os organizadores ouviram a proposta dos participantes e mudaram uma das mec√¢nicas do jogo.  No caso geral, √© claro que isso √© bom quando os participantes s√£o ouvidos.  Mas, especificamente, desta vez, a presen√ßa de feedback fez uma piada cruel.  Em resumo, os organizadores tornaram poss√≠vel que as minas fossem detonadas com um tiro. </p><br><p>  Isso por si s√≥ √© l√≥gico.  Se eu fosse minha e eles atirassem em mim, eu tamb√©m explodiria.  Mas o problema √© que jogamos em pontos, e os pontos foram dados n√£o apenas por assassinatos, mas tamb√©m por danos.  Portanto, se voc√™ chegar perto o suficiente do inimigo, colocar minas sob voc√™ e atirar nelas, voc√™ mata o inimigo e a si mesmo com uma explos√£o.  √â imposs√≠vel esquivar.  Voc√™s dois recebem 1000 pontos pelos dois personagens que est√£o morrendo, mas tamb√©m recebem pontos por danos.  Assim, se o inimigo estiver saud√°vel, voc√™ receber√° 1000 pontos por matar e 100 por dano, e o inimigo - apenas 1000. </p><br><p>  Embora todos soubessem disso, mas no topo quase ningu√©m usava minas at√© o √∫ltimo.  N√£o sei como os outros, mas, pessoalmente, n√£o o usei simplesmente porque n√£o queria abusar do c√°lculo incorreto involunt√°rio.  Mas, como disseram em um filme, eu sabia que mais cedo ou mais tarde passaremos a esse lixo. </p><br><p>  Em resumo, no meio da noite, de quarta a quinta-feira, eu agitei a auto-interrup√ß√£o.  Puramente situacional, nada avan√ßado.  Apenas pelo princ√≠pio de que, se no momento atual, meu personagem √© rent√°vel para se matar, e ele pode faz√™-lo, ele faz.  Como a pr√°tica demonstrou, alguns outros participantes planejaram usar as minas com anteced√™ncia, por isso implementaram um suic√≠dio mais avan√ßado, mas planejaram estrategicamente liber√°-lo imediatamente antes da final.  Como resultado, aconteceu o que aconteceu - 9¬∫ lugar na final, assim como no ano passado. </p><br><h2 id="final-pesochnicy">  Sandbox Finale </h2><br><p>  Ap√≥s o final, eu deixei a cidade para as f√©rias.  Ele voltou uma semana depois e, na primeira noite, literalmente, em 2 a 3 horas de trabalho, melhorou muito as minas, sobre as quais vou escrever mais na parte t√©cnica.  O restante das altera√ß√µes dizia respeito principalmente √† edi√ß√£o de bugs e √† conclus√£o da fun√ß√£o de avalia√ß√£o.  Em resumo, um pouco de programa√ß√£o e muitos testes. </p><br><h1 id="tehnicheskaya-chast">  Parte t√©cnica </h1><br><p>  A velocidade do Java ou o raio de curvatura das m√£os, mas os dois juntos, mais uma vez n√£o me permitiram me dar bem com uma simula√ß√£o pura.  Portanto, o movimento, o disparo normal e a instala√ß√£o de minas s√£o separados de mim. </p><br><h2 id="simulyaciya">  Simula√ß√£o </h2><br><p>  Pelos olhos de um bot, o mundo era assim: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jwnUo2b96eA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  No v√≠deo, eu acho, e ent√£o tudo est√° aproximadamente claro.  No canto superior esquerdo, est√° a depura√ß√£o da fun√ß√£o de avalia√ß√£o.  Voc√™ pode ver em que consiste a pontua√ß√£o de cada trajet√≥ria.  Silhuetas amarelas (por exemplo, √†s 2:30) - essas s√£o as mesmas trajet√≥rias em 9 dire√ß√µes, sobre elas ser√£o mais baixas.  Linhas de flechas em algum ponto das 2:50 s√£o uma maneira de procurar (vermelho - para o inimigo, verde - para o kit de primeiros socorros, verde-amarelo - para a arma, azul - para a mina).  Os quadrados verdes no final do v√≠deo s√£o meus blocos PVS, que s√£o vis√≠veis no bloco selecionado.  Os pontos vermelhos no centro indicam de onde vem a visibilidade reversa. </p><br><p>  Movimentos de caracteres simulam sem microtics.  Os v√¥os de bala tamb√©m, mas neles eu uso v√°rios hacks para que as situa√ß√µes ocorram menos quando o marcador "atravessa" o personagem sem toc√°-lo, embora devesse ter tocado com microtics.  Por exemplo, se voc√™ pensar bem, a situa√ß√£o descrita pode ocorrer apenas nos cantos: </p><br><p><img src="https://habrastorage.org/webt/ve/b3/wf/veb3wfaqijpe7p-qk2scwgfrueq.png"></p><br><p> No ponto 1, o marcador est√° na posi√ß√£o 1, no ponto 2 - na posi√ß√£o 2, respectivamente.  Sem Mikrotik - Boris-r√°bano - voc√™ consegue, com Mikrotik - tiro na orelha.  Portanto, para que isso aconte√ßa, a posi√ß√£o do marcador nos pontos 1 e 2 deve estar em lados diferentes de pelo menos uma das faces do personagem ou lado a lado (um ret√¢ngulo de hortel√£).  Assim, √© poss√≠vel simular uma bala sem microtics at√© que, conforme aplicada na figura acima, a condi√ß√£o <code>old_bullet.x &gt; character_left_side.x != new_bullet.x &gt; character_left_side.x</code> e, se isso ocorrer, analise com mais cuidado . </p><br><p>  Al√©m disso, cada carrapato recontava as trajet√≥rias de todas as balas voadoras antes de colidirem com a parede e salvavam sua posi√ß√£o em cada carrapato em uma matriz, para que na simula√ß√£o voc√™ pudesse verificar rapidamente colis√µes com elas. </p><br><p>  Para uma bazuca, depois de bater em uma parede, eu matematicamente, sem microtics, calculei o ponto exato do impacto para calcular corretamente o epicentro da explos√£o. </p><br><p>  Al√©m disso, todos os <code>dodge_trajectories</code> que preenchi a matriz <code>dodge_trajectories</code> - simulavam o movimento de cada personagem, incluindo inimigos, em 8 dire√ß√µes para 25 ticks (silhuetas amarelas no v√≠deo do visualizador, depois de ativar a caixa de sele√ß√£o de trajet√≥ria poss√≠vel. Por exemplo, √†s 2:30).  E, como nas balas, ele mantinha todas as posi√ß√µes poss√≠veis em cada marca.  Foi ent√£o usado em muitos lugares, alguns dos quais mencionarei. </p><br><p>  Tamb√©m calculei o <a href="https://www.wikiwand.com/en/Potentially_visible_set">PVS</a> por blocos com anteced√™ncia.  Para cada c√©lula, eu mantinha uma lista de pe√ßas, cujo centro pode ser visto em p√© nela.  Foi calculado por tra√ßado de raios.  Isso pode ser visto no v√≠deo do visualizador, no final.  Quadrados verdes s√£o blocos que s√£o vis√≠veis na c√©lula selecionada.  Os pontos vermelhos no centro indicam de onde vem a visibilidade reversa. </p><br><h2 id="poisk-puti">  Procure uma maneira </h2><br><p>  Implementado pelo algoritmo de Dijkstra de acordo com os Waypoints.  O bloco em que voc√™ pode ficar foi considerado Waypoint.  A adapta√ß√£o do algoritmo para o jogo de plataformas 2D √© pr√≥pria, dom√©stica e, portanto, por uma quest√£o de otimiza√ß√£o, √© constru√≠da sobre muletas.  Mas funcionou r√°pido o suficiente: eu criei o Dijkstra anteriormente (n√£o sabia como diz√™-lo corretamente) de cada assunto no n√≠vel de cada bloco.  Eu constru√≠ estradas apenas aquelas que t√™m capacidade de m√£o dupla nos dois pa√≠ses.  Isso foi necess√°rio para que mais tarde voc√™ pudesse passar rapidamente de qualquer ladrilho para qualquer kit de primeiros socorros / arma / mina.  Era poss√≠vel se livrar dessa restri√ß√£o, mas, na pr√°tica, considerava mais razo√°vel dedicar tempo a outras coisas, porque n√£o havia muito dano com essa restri√ß√£o. </p><br><p>  Al√©m disso, cada vez que troquei para outro ladrilho com qualquer personagem (meu e do inimigo), contei para ele o caminho para o inimigo mais pr√≥ximo, o kit de primeiros socorros e tamb√©m para a mina e as armas, se ele ainda precisasse delas. </p><br><p>  No meu computador dom√©stico, em um jogo com 1000 ticks, toda a pesquisa de caminho levou cerca de 100 ms no total. </p><br><p>  Se o caminho cruza um inimigo ou amigo, simplesmente adiciono algumas d√∫zias de unidades ao seu peso.  Portanto, se houver um desvio relativamente curto, ou se, depois disso, for mais lucrativo correr para outro objeto, eu o farei.  No v√≠deo do visualizador acima, isso pode ser visto √†s 2:55, onde o caminho para o inimigo mais pr√≥ximo foi desviado, porque  um caminho reto cruza o segundo caractere. </p><br><p>  Visualiza√ß√£o do caminho de pesquisa: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Dyk03lk14Ho" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Quadrados roxos transl√∫cidos s√£o pontos de passagem, tamb√©m s√£o os v√©rtices do gr√°fico.  Setas verde lim√£o - arestas <sup>1</sup> coluna <sup>2</sup> <br>  <em><sup>1</sup> n√£o deve ser confundido com costelas; <sup>2</sup> quaisquer coincid√™ncias de natureza mon√°rquica s√£o aleat√≥rias [aprox.]</em> </p><br><h2 id="peredvizhenie">  Movimento </h2><br><p>  Dois personagens caminharam por sua vez.  Se voc√™ apenas pensou - "e agora chegou ao top 10?!", Ent√£o pensou corretamente.  :) N√£o havia recursos suficientes para andar com os dois.  Uma exce√ß√£o foi o caso do aparecimento de uma nova bala voadora. </p><br><p>  A base para a escolha de uma trajet√≥ria √© a gen√©tica sem cruzamento.  Mas se no ano passado, no futebol, a gen√©tica se mostrou perfeitamente, ent√£o este ano deu uma vantagem muito pequena.  Minhas experi√™ncias mostraram um resultado muito pr√≥ximo, tanto em gen√©tica quanto em pesquisas aleat√≥rias.  Vejo v√°rias raz√µes para isso, mas a principal me parece a seguinte: No futebol, t√≠nhamos um objetivo fixo - a bola.  Na maioria das vezes, seu comportamento era previs√≠vel - se encontrarmos uma boa trajet√≥ria para acertar a bola no gol e segui-la, depois de 20 tiques, essa trajet√≥ria provavelmente ainda ser√° boa, porque  a bola n√£o pode mudar espontaneamente seu caminho.  Mas este ano jogamos n√£o com a bola, mas com personagens inimigos.  Eles mudavam seu comportamento a cada carrapato.  Portanto, a relev√¢ncia da trajet√≥ria permaneceu muito curta. </p><br><p>  Eu ainda usava gen√©tica por dois motivos: </p><br><ol><li>  Acabei de copiar o c√≥digo dela do ano passado.  Foi at√© engra√ßado o qu√£o pouco eu tive que fazer altera√ß√µes, com exce√ß√£o da fun√ß√£o de avalia√ß√£o, para que o bot come√ßasse a se mover de forma toler√°vel.  Resumindo, escrevi um simulador por uma semana e meia e, em seguida, copiei a l√≥gica do movimento do ano passado, em outra hora, fiz uma estimativa simples e o bot, ao disparar no Quick Start, come√ßou a ganhar bastante com ele. </li><li>  Eu aparentemente amo a dor.  Caso contr√°rio, n√£o sei explicar por que escrevi em Java novamente, e n√£o como todos os tops normais: </li></ol><br><p><img src="https://habrastorage.org/webt/kt/qp/2n/ktqp2np94dkdbxjbajr9pgp0fky.png"></p><br><p>  Ent√£o eu tive que fazer tudo de todas as maneiras para que a estrat√©gia simplesmente n√£o ca√≠sse com um tempo limite em cada primeiro jogo.  E a abordagem com a gen√©tica me permitiu salvar um instant√¢neo da simula√ß√£o do mundo e os pontos contados e, ao calcular as pr√≥ximas gera√ß√µes, desativar os instant√¢neos apenas a partir do primeiro gene <em>mutado</em> . </p><br><p>  I.e.  grosso modo, se na primeira gera√ß√£o eu der 10 ticks para a direita e depois pular, e na segunda gera√ß√£o avaliar um mutante que vai 10 ticks para a direita e depois pular, o ponto de refer√™ncia para o mutante ser√° o instant√¢neo calculado anteriormente do mundo e os pontos ap√≥s 10 movimentos para a direita.  Assim, reduzi significativamente o c√°lculo. </p><br><p>  Igogo, um algoritmo de movimento aproximado: </p><br><ol><li>  Geramos N gen√≥tipos aleat√≥rios.  Cada um consiste em M genes aleat√≥rios.  Cada gene √© um n√∫mero codificado em a√ß√£o: um n√∫mero √© respons√°vel pela dire√ß√£o do movimento, o segundo √© para pular / caminhar / pular, o terceiro √© para o disparo b√°sico (puramente para a fun√ß√£o de avalia√ß√£o, o algoritmo b√°sico do disparo ser√° descrito abaixo), o quarto para o n√∫mero de repeti√ß√µes deste a√ß√£o.  O n√∫mero total de a√ß√µes no gen√≥tipo, juntamente com repeti√ß√µes, n√£o excede a profundidade da simula√ß√£o - 40 ticks. </li><li>  N√≥s adicionamos v√°rios gen√≥tipos codificados a eles: movimento direto em 9 dire√ß√µes (8 lados + parado) e algumas predefini√ß√µes simples, que na pr√°tica ajudaram a sair de algumas situa√ß√µes t√≠picas no labirinto um pouco mais r√°pido.  Por exemplo, estas s√£o as trajet√≥rias: ‚Æ§ ‚Æ• </li><li>  Adicione o melhor gen√≥tipo da jogada anterior. </li><li>  Avalie tudo, deixe o M melhor. </li><li>  Estamos criando a pr√≥xima gera√ß√£o em que, em cada gen√≥tipo, um ou mais genes sofreram muta√ß√µes. </li><li>  N√≥s os adicionamos ao pool geral, que j√° cont√©m o M best da √∫ltima gera√ß√£o. </li><li>  Repetimos, come√ßando no ponto 4, v√°rias vezes. </li></ol><br><h2 id="ocenochnaya-funkciya">  Fun√ß√£o de avalia√ß√£o </h2><br><p>  Na verdade, o lugar onde a estrat√©gia vive. </p><br><p>  Ao longo do campeonato, um monte de todos os tipos de m√©tricas foi adicionado (para ser preciso, 57).  Alguns deles n√£o viveram para assistir √†s finais.  A outra parte sobreviveu, mas no contexto da infla√ß√£o do Score durante o campeonato, como resultado, praticamente n√£o afetou o resultado, mas o restante, da ordem de 20 a 25, foi precisamente respons√°vel pelo movimento e tiro b√°sico. </p><br><p>  Vou dar alguns exemplos de m√©tricas importantes, em ordem aleat√≥ria: </p><br><ol><li>  Pena para uma explos√£o de bala / bazuca em mim. </li><li>  B√¥nus por graus de liberdade.  I.e.  para o n√∫mero de dire√ß√µes (para cima / baixo / esquerda / direita) onde eu posso mover do bloco atual.  Como voc√™ pode imaginar, quanto mais graus de liberdade - mais chances de desviar de uma bala.  Esse b√¥nus obrigou o bot a aderir a plataformas e escadas.  O b√¥nus √© tr√™s vezes maior se o oponente tiver uma bazuca. </li><li>  Penalidade pela dist√¢ncia (atrav√©s da busca pelo caminho) at√© o kit de primeiros socorros mais pr√≥ximo;  pela dist√¢ncia m√©dia (atrav√©s da busca pelo caminho) a todos os kits de primeiros socorros;  porque o caminho dele at√© o kit de primeiros socorros mais pr√≥ximo dele √© menor do que o caminho de mim at√© o (!) kit de primeiros socorros. </li><li>  Pena pelo fato de o inimigo ver minha cabe√ßa. </li><li>  Pena pelo fato de o inimigo ver minhas pernas (os pontos 4 e 5 for√ßaram o bot a se esconder atr√°s de abrigos parciais). </li><li>  Ataque b√¥nus enquanto recarrega as armas inimigas. </li><li>  B√¥nus por tiros feitos. </li><li>  Penalidade por muita ou pouca dist√¢ncia do inimigo.  Dependia de v√°rios fatores: a sa√∫de de ambos, se as armas de ambos foram recarregadas, etc. </li><li>  B√¥nus por condi√ß√µes perigosas de trabalho. </li><li>  Penalidades pelo estado de queda e pelo estado de voo no jumppad (porque esses dois estados n√£o podem ser interrompidos e, portanto, s√£o muito menos propensos a evitar a bala). </li><li>  O b√¥nus pelo n√∫mero de kits de primeiros socorros que est√£o do meu lado oposto, comparado com o inimigo (por exemplo, se o inimigo est√° √† minha direita, receberei um b√¥nus pelo n√∫mero de kits de primeiros socorros √† minha esquerda. Isso basicamente fazia sentido em Rodadas 1 e 2, onde o √∫nico caminho do inimigo para esses kits de primeiros socorros era atrav√©s de mim). </li><li>  B√¥nus por seguir o caminho para o inimigo, para o kit de primeiros socorros (se estou ferido), para uma mina (se tiver menos de dois), para armas (se n√£o houver). </li><li>  Penalidade pela proximidade das muralhas, caso o inimigo tenha uma bazuca.  Mais especificamente, considerei quantos carrapatos o foguete do inimigo, se ele o soltar, voar√° para a parede perto de mim e, com base nisso, aquela zona perto da parede da qual √© imposs√≠vel escapar da explos√£o era considerada perigosa e recebi uma multa por estar nela. </li><li>  B√¥nus de ano novo. </li></ol><br><h2 id="uklonenie-ot-pul">  Evas√£o √† bala </h2><br><p>  Isso acontece automaticamente, devido ao acima </p><br><h2 id="pricelivanie">  Visando </h2><br><p>  H√° muita coisa acontecendo.  Talvez o mais importante seja um algoritmo simples e eficaz que decida se devo apontar uma arma para o inimigo (porque apontar aumenta a propaga√ß√£o de armas): </p><br><ol><li>  Consideramos o √¢ngulo entre (last_angle - min_spread) e (last_angle + max_spread). </li><li>  Atiramos os raios do centro do meu personagem para os dois cantos da <a href="https://www.wikiwand.com/ru/AABB">AABB</a> inimiga mais pr√≥xima da perpendicular.  Se algum deles estiver fora do intervalo (last_angle - min_spread) ... (last_angle + max_spread), cortamos esse intervalo. </li><li>  Consideramos o √¢ngulo entre esses raios. </li><li>  Divida a primeira segunda esquina pela primeira, obtemos Cobertura (cobertura).  Representa a probabilidade <em>atual</em> em porcentagem de que a trajet√≥ria da bala disparada cruze com a caixa do oponente. </li><li>  Simulamos uma A√ß√£o em que ocorre um inimigo, juntamente com uma mudan√ßa na dispers√£o. </li><li>  Repita as etapas 1..4 para o novo conjunto [last_angle, min_spread, max_spread].  Assim, consideramos qual ser√° a cobertura caso pretendamos. </li><li>  Como resultado, temos a cobertura atual, bem como a cobertura prevista, caso apontemos a arma para o inimigo.  Se a cobertura estimada for maior que a atual, pretendemos. </li></ol><br><p>  Demonstra√ß√£o 2 pontos: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/au1eInNY9XQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Se as linhas s√£o verdes, o inimigo cai inteiramente na √°rea de mira.  Laranja - parcialmente vermelho - n√£o cai. </p><br><p>  Mas eu geralmente n√£o viso a barriga do inimigo, mas em algum ponto mais ideal. </p><br><p>  Para uma pistola e uma espingarda de assalto, se o inimigo estiver no ar, considero quantos tiques a bala alcan√ßar√° sua posi√ß√£o atual, ent√£o <code>dodge_trajectories</code> sua matriz <code>dodge_trajectories</code> descrita acima de todas as suas posi√ß√µes poss√≠veis atrav√©s desse n√∫mero de tiques, m√©dia todas as 8 posi√ß√µes e, ao apontar, considero que o inimigo est√° nesse ponto m√©dio. </p><br><p>  Se ele estiver no ch√£o, aponto "na cabe√ßa", com base nessas considera√ß√µes de que ele s√≥ pode pular para cima, de modo que um tiro na cabe√ßa seja muito mais dif√≠cil de se esquivar do que um tiro no est√¥mago e, mais ainda, nas pernas. </p><br><p>  Para uma bazuca, eu tamb√©m tomo 8 posi√ß√µes poss√≠veis em tantos carrapatos quanto o foguete atinge o inimigo.  Para eles, construo um cone (mais precisamente, um setor de um c√≠rculo) que descreve todas essas posi√ß√µes e, dentro desse cone, separo as trajet√≥rias com algum passo.  Para cada trajet√≥ria, eu simulo um v√¥o de foguete, juntamente com uma explos√£o no caso de um golpe na parede.  A trajet√≥ria em que o inimigo tem menos chance de desviar, eu uso para mirar. </p><br><p>  Mesmo em alguns casos, para cair e voar do jumppad (ou seja, aqueles estados que o inimigo n√£o pode interromper), simplesmente considero o ponto de intercepta√ß√£o pela bala do inimigo, resolvendo o sistema de equa√ß√µes de movimento.  O c√≥digo foi copiado de seu pr√≥prio bot de h√≥quei de 2014, onde foi usado para interceptar o disco.  :) </p><br><p>  Entre outras coisas, em algumas situa√ß√µes cancelei a mira se houver uma posi√ß√£o no meu caminho para os pr√≥ximos 10 tiques em que o raio do centro dessa posi√ß√£o na dire√ß√£o do √∫ltimo tri√¢ngulo final se cruza com o inimigo.  Isso me permitiu mirar com o movimento, sem alterar o √¢ngulo e, portanto, sem aumentar a propaga√ß√£o. </p><br><h2 id="strelba">  Tiro </h2><br><p>  O disparo b√°sico foi costurado na trajet√≥ria encontrada e era puramente situacional.  Mas tamb√©m, todo tick que meu bot tentou calcular se faz sentido disparar agora e, se o fez, disparou.  Por exemplo: </p><br><ul><li>  se n√£o h√° garantia de que o inimigo se esquive; </li><li>  se a cobertura estava acima de algum valor fixo. </li></ul><br><p>  Al√©m disso, se minha arma era uma bazuca, simulei todos os tipos de trajet√≥rias dentro do spread no caso de um tiro imediato, com algum passo.  E se o resultado mostrou que o benef√≠cio potencial excede o dano potencial, eu atirei.  Avaliei o benef√≠cio em 4 m√©tricas em ordem decrescente de import√¢ncia para mim e para o inimigo: morte garantida (minha ou inimiga), morte poss√≠vel, dano garantido, dano poss√≠vel.  Se havia pelo menos uma trajet√≥ria na qual, por exemplo, eu tinha a <em>garantia de</em> me matar e <em>possivelmente</em> matar o inimigo, n√£o atirei. </p><br><p>  Houve outros cheques.  Por exemplo, eu poderia cancelar um tiro se no pr√≥ximo tick da minha trajet√≥ria a cobertura potencial for maior do que na atual. </p><br><p>  Em geral, a l√≥gica me dizia que o disparo b√°sico deveria ser desativado, mas os testes mostraram o contr√°rio.  N√£o consigo imaginar o porqu√™. </p><br><h2 id="miny">  Minas </h2><br><p>  No momento da final, eles estavam na inf√¢ncia: marquei cada marca o que aconteceria se eu colocasse 1 ou 2 minas agora, dependendo da sa√∫de do oponente, e atire nelas.  Se eu tenho a garantia de matar o inimigo e se √© rent√°vel para mim (em pontos ou porque apenas o inimigo vai morrer), eu o fiz. </p><br><p>  Ap√≥s o ano novo, voltando de uma viagem, escrevi o algoritmo na primeira noite, o que me levou a 2-4 lugares na tabela.  O algoritmo era simples: eu apenas simulei cada tick o que aconteceria se eu mudasse imediatamente para o modo furioso e corresse em dire√ß√£o ao inimigo para explodi-lo com uma mina o mais r√°pido poss√≠vel.  Para o inimigo, simulei uma evas√£o simples usando os mesmos dodge_trajectories: fiz tr√™s trajet√≥rias que aumentaram a dist√¢ncia de mim.  Por exemplo, se eu estivesse √† esquerda do inimigo, analisei tr√™s casos: o inimigo foge para a direita;  o inimigo corre para a direita e pula;  corre para a direita e pula.  Se, nos tr√™s casos, eu tinha garantia de ter tempo para mat√°-lo com uma mina e ele n√£o podia colocar minas antes de mim, eu o fazia. </p><br><p>  Al√©m disso, o algoritmo foi capaz de pular ou pular no n√≠vel da estrat√©gia de In√≠cio R√°pido - simplesmente com base na diferen√ßa na coordenada Y. </p><br><p>  Como resultado, nos mapas finais, quase todas as partidas terminavam em menos de 1000 tiques com explos√µes autom√°ticas de meus dois personagens. </p><br><h2 id="pacifizm">  Pacifismo </h2><br><p>  Vendo como minhas minas eram eficazes, decidi verificar no meu <a href="https://t.me/aicups">telegrama</a> minha suposi√ß√£o anterior de que na final era poss√≠vel ocupar um lugar no topo sem disparar.  Ent√£o, eu apenas tirei e desliguei o tiro no meu bot, com exce√ß√£o de um tiro na mina.  A √∫nica coisa √© - para n√£o perder a classifica√ß√£o, este modo era ativado apenas se eu tivesse minas suficientes para matar o inimigo. </p><br><p>  Em resumo, meu bot se tornou pacifista.  Para demonstrar sua paz e humildade, ele nem olhou para o inimigo (veja o v√≠deo).  Bem, √†s vezes ele atirava em minas, voc√™ pensa.  Eu n√£o atirei nos oponentes!  E se eles morreram ao mesmo tempo - bem, o que voc√™ pode fazer, um tr√°gico acidente. </p><br><p>  Em geral, enviei esta vers√£o para o site, criei 4 jogos com cada um dos tr√™s primeiros e ... </p><br><p><img src="https://habrastorage.org/webt/sv/e8/69/sve869ijby1cp9lduijtx5wfusc.png"></p><br><p>  ... venceu 3 de 4 jogos contra cada um.  Em geral, √© estranho que os vizinhos n√£o tenham vindo reclamar da minha risada hom√©rica no meio da noite.  :) </p><br><p>  Admire-se: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ZpvvN21vufg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Eh, se eu passasse essas 2 ou 3 horas antes da final, e n√£o depois, talvez este artigo dissesse como ganhar um MacBook, e n√£o como evit√°-lo de qualquer maneira, quem sabe.  Infelizmente, a hist√≥ria n√£o conhece o humor subjuntivo. </p><br><h1 id="testirovanie">  Teste </h1><br><p>  Em geral, testei todas as altera√ß√µes tantas vezes que o resultado foi estatisticamente significativo.  Mais precisamente, o limite inferior do intervalo de confian√ßa deve exceder 50%.  Para as finais da caixa de areia, o script selecionou coeficientes.  Nos anos anteriores, tentei a gen√©tica, mas funcionou mal - para um resultado normal, voc√™ tinha que jogar muitos jogos.  Desta vez, apenas alterei um coeficiente de cada vez e recuperei 200 jogos.  Nos casos em que o resultado foi bom, realizei testes adicionais.  Em suma, deixou durante a noite duas d√∫zias de coeficientes e teve um resultado pela manh√£. </p><br><h1 id="v-zaklyuchenie">  Em conclus√£o </h1><br><p>  De alguma forma, tudo isso funcionou com o sofrimento pela metade. </p><br><p>  Nos √∫ltimos dias antes do final do sandbox, passei a maior parte do tempo em segundo lugar na tabela por uma margem significativa em rela√ß√£o ao terceiro, mas algumas horas antes do final do sandbox fiquei sem sorte e comecei uma s√©rie de jogos de acordo com as regras das rodadas 1 e 2, enquanto minha estrat√©gia jogou mais pelas regras do final.  Por exemplo, aqui de 13 jogos, h√° apenas 1 de acordo com as regras finais.  Ent√£o eu tamb√©m, minha taxa de vit√≥rias nesses jogos saiu muito pior que o normal.  Em geral, o todo-poderoso aleat√≥rio: </p><br><p><img src="https://habrastorage.org/webt/4-/xl/wi/4-xlwimvw-jwctcn8qerejyjsma.jpeg"></p><br><p>  Como resultado, perdi muitos jogos, perdi todas as minhas vantagens e ca√≠ de 2 para 4 lugares e n√£o tive tempo de me recuperar, porque o campeonato havia terminado.  √â bom que a sandbox n√£o tenha perdido o primeiro lugar na lista de vencedores. </p><br><p>  Mais uma vez, quero agradecer ao Mail.ru Group por este pr√≥ximo campeonato maravilhoso.   , ,   ,          ( 1100 ).      ‚Äî ,   .  ,         .  , , ,  ! </p><br><p>   ,    .  , ,       .       "   8 ". </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485372/">https://habr.com/ru/post/pt485372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485354/index.html">Motocicleta feita com impress√£o 3D SLS</a></li>
<li><a href="../pt485358/index.html">O desenvolvimento m√≥vel √© f√°cil e chato? Relat√≥rio Yandex</a></li>
<li><a href="../pt485362/index.html">Inova√ß√µes do JavaScript ES2020 com exemplos simples</a></li>
<li><a href="../pt485364/index.html">Como parar de desperdi√ßar tempo dos desenvolvedores com d√≠vidas t√©cnicas</a></li>
<li><a href="../pt485370/index.html">Como um desenvolvedor pode ajudar um gerente a fazer um acordo</a></li>
<li><a href="../pt485374/index.html">O cache √© o rei do desempenho: os processadores precisam de um quarto n√≠vel de cache</a></li>
<li><a href="../pt485376/index.html">Como tornar o frontend tr√™s vezes mais r√°pido e quando aplicar comandos em vez de reposit√≥rios? V√≠deo</a></li>
<li><a href="../pt485378/index.html">Estudo de caso: como se destacar no Google Play e adaptar o ASO a diferentes pa√≠ses</a></li>
<li><a href="../pt485380/index.html">Artesanato e sucesso em TI</a></li>
<li><a href="../pt485384/index.html">NeurIPS 2019: tend√™ncias de ML que estar√£o conosco na pr√≥xima d√©cada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>