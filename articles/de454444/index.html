<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçÔ∏è üêÖ üßëüèæ‚Äçü§ù‚Äçüßëüèª Wir profilieren das Laden von Habr oder wie 189 Anfragen auf der Seite Einfluss nehmen üåö üï¢ ü§Ωüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einiger Zeit interessierte ich mich f√ºr die Leistung von Websites, Download-Optimierungen und dergleichen. Und jetzt, als ich wieder ins Habr ging...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir profilieren das Laden von Habr oder wie 189 Anfragen auf der Seite Einfluss nehmen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454444/"><p><img src="https://habrastorage.org/webt/dg/5m/ab/dg5mabkefi6xhfiovvydhay2fkw.jpeg" alt="Nimm dicken Kirschsaft"></p><br><p>  Vor einiger Zeit interessierte ich mich f√ºr die Leistung von Websites, Download-Optimierungen und dergleichen.  Und jetzt, als ich wieder ins Habr ging, dachte ich, ich w√§re es gewohnt, eine ziemlich schnelle Ressourcenbelastung als gegeben zu betrachten, ohne dar√ºber nachzudenken, wie dies erreicht wurde.  Aus diesem Grund habe ich mich entschlossen, Gesch√§ft mit Vergn√ºgen zu verbinden - um zu sehen, wie sich die Leistung von Habr entwickelt und welche technischen L√∂sungen zur Optimierung entwickelt wurden. </p><br><p>  F√ºr diejenigen, die wissen m√∂chten, was getan wurde, damit wir den Inhalt so schnell wie m√∂glich erhalten und wie der Download des Habr aus Argentinien aussieht - bitte unter Katze. </p><a name="habracut"></a><br><h2 id="podgotovka">  Vorbereitung </h2><br><p>  Wir ben√∂tigen eine neue Version von Chrome / Canary, die im anonymen Modus arbeitet (stellen Sie sicher, dass alle Erweiterungen deaktiviert sind).  Au√üerdem m√ºssen Sie in der Entwicklerkonsole (Developer Tools - F12) auf der Registerkarte "Netzwerk" das Flag "Cache deaktivieren" setzen, da  <strong>Wir werden nur den ersten Start profilieren, solange sich noch keine Ressourcen im Cache befinden.</strong> </p><br><h2 id="etap-pervyy---po-verham">  Stufe Eins - "Oben" </h2><br><p>  Das Hauptziel dieses Teils ist es, die Site als Ganzes kennenzulernen, ihre Struktur zu verstehen und herauszufinden, welche spezifischen Ressourcen sie ben√∂tigt. </p><br><p>  Wir √∂ffnen Entwicklertools, gehen zur Registerkarte "Netzwerk", √∂ffnen die Site und sehen uns ganz unten auf der Registerkarte Statistiken zur Netzwerknutzung an: </p><br><p><img src="https://habrastorage.org/webt/ni/fs/yb/nifsybxewz18qswerh5jubfsn1a.png" alt="Und der Umhang einer wei√üen Mutter."></p><br><p>  Die gesamte Site wurde in 2,02 Sekunden geladen, was einfach gro√üartig aussieht (angesichts der Last von Habr).  Das Ereignis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DomContentLoaded</a> (im Folgenden einfach DCL) wurde im Allgemeinen in 1,01 Sekunden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">angezeigt,</a> was sogar noch besser aussieht.  Mit all dem stellt die Site 189 Anfragen und l√§dt 9,6 MB Ressourcen.  Dies sagt uns, dass entweder das Habra-Team ein Genie ist (es kann durchaus sein) und der Artikel hier fertiggestellt werden sollte (und sie das Team um Kaffee und Kekse bitten), oder dass ich einen 100-Mbit / s-Kanal und Core I7 habe .  Das hei√üt,  Sie m√ºssen der Realit√§t ein wenig n√§her kommen und zumindest die Kanalbreite begrenzen. </p><br><p>  Wir schalten den Fast 3G-Modus ein und schauen noch einmal: </p><br><p><img src="https://habrastorage.org/webt/bp/ov/lk/bpovlkvte1ojvmuamwcoki4uniq.png" alt="Gie√üen Sie den Saft trinken auf den Umhang -"></p><br><p>  Der DCL verschlechterte sich auf 3,48 Sekunden, was immer noch einigerma√üen akzeptabel ist.  Aber schlie√ülich wurde die Seite in atheistischen 54,76 Sekunden geladen.  Jetzt ist alles logisch - Sie k√∂nnen nicht einfach fast 10 Megabyte herunterladen und herunterladen, wenn Sie eine schwache Verbindung haben.  H√∂chstwahrscheinlich haben die Jungs gute Arbeit geleistet, um uns den Inhalt so schnell wie m√∂glich zu zeigen (dies wird durch die Tatsache belegt, dass DCL auch im Fast3G-Modus schnell genug auftritt), und sie haben alles, was f√ºr das Laden nicht kritisch war, im Hintergrund gelassen.  Wir werden das etwas sp√§ter √ºberpr√ºfen und jetzt wollen wir sehen, warum wir so lange geladen haben.  Sortieren Sie alle Anfragen nach Ladezeit: </p><br><p><img src="https://habrastorage.org/webt/el/jv/uc/eljvucnzbn0d83cd2konxv8ff-8.png" alt="Ein Punkt wird zu Einstellungen."><br>  <a href="">Klickbar</a> </p><br><p>  Bilder (Top-7) werden am l√§ngsten geladen und eine JavaScript-Datei ist prebid.js.  Wenn wir ihre Gr√∂√üe betrachten, k√∂nnen wir annehmen, dass dies genau der Grund f√ºr das langsame Laden ist. </p><br><div class="spoiler">  <b class="spoiler_title">√úber Annahmen</b> <div class="spoiler_text"><p>  Mit Annahmen m√ºssen Sie √§u√üerst vorsichtig sein.  Beispielsweise kann ein langes Laden einer Ressource nicht nur durch die Dateigr√∂√üe verursacht werden, sondern auch beispielsweise durch Probleme mit DNS, maximale Speicherlast oder einen Cold-Server-Cache.  Daher kann eine nicht √ºberpr√ºfte Annahme dazu f√ºhren, dass Sie Zeit damit verschwenden, ein Problem zu l√∂sen, das noch nicht einmal existiert. </p></div></div><br><p>  Wenn wir uns die Statistiken <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ansehen</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TTFB</a> : 0,610 ms, Last: 40 000 ms), k√∂nnen wir schlie√üen, dass unsere Annahme sehr wahrscheinlich ist.  Bewundern wir unsere TOP 1 (png, 1560X780, 24bit): </p><br><p><img src="https://habrastorage.org/webt/61/ts/aj/61tsajb8gnvzqjaw0cg-mqdj32e.png" alt="Jetzt, wo es keinen Platz mehr gibt"></p><br><p>  In der Tat sind Probleme mit Bildern haupts√§chlich Probleme unseres Verkehrs mit Ihnen.  Bilder (im Gegensatz zu Stilen und Skripten) blockieren das Rendern der Webseite nicht. Trotz des Vorhandenseins solcher Schwergewichte (es kann schlimmer sein, sie haben es gesehen) hat dies fast keinen Einfluss auf die Leistung.  Obwohl nat√ºrlich eine Optimierung in dieser Richtung (z. B. Transcodierung in jpeg2000 oder webp oder progressives Laden w√§re nicht √ºberfl√ºssig). </p><br><div class="spoiler">  <b class="spoiler_title">√úber Bilder</b> <div class="spoiler_text"><p>  Wie ich oben geschrieben habe, blockieren Bilder nicht das Rendern der Seite.  Aber sie nutzen unseren Verbindungspool und in http 1.x ist ihre Anzahl begrenzt, und auch bei http 2.x und Chrome ist nicht alles so reibungslos, wie ich geh√∂rt habe.  Daher besteht auch hier die M√∂glichkeit, dass ein Bild das Laden eines synchronen Skripts verlangsamt und das Rendern der Seite bereits beendet wird.  Dar√ºber hinaus kann das Laden des Bildes auch zu einer Nachz√§hlung des Layouts f√ºhren, wodurch das Rendern verlangsamt wird.  Wenn wir uns das Habr-Markup ansehen, haben fast alle img-Tags Breite und H√∂he.  Dadurch entf√§llt der Reflow, um die Download-Leistung positiv zu beeinflussen.  Mehr dazu lesen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p></div></div><br><p>  Mal sehen, welche anderen Ressourcen der Habr nutzt - wir werden die Typen durchgehen und sie nach Ladezeit sortieren.  Beginnen wir mit JavaScript </p><br><h3 id="javascript">  Javascript </h3><br><div class="spoiler">  <b class="spoiler_title">√úber Javascript</b> <div class="spoiler_text"><p>  JavaScript hat verschiedene Probleme mit der Leistung der Website.  Erstens (jeder wei√ü das schon lange) blockiert synchrones js das weitere Rendern von Seiten.  Das hei√üt,  Bis wir unser JavaScript erhalten und ausf√ºhren, wartet der Browser (eigentlich nicht ganz, der Browser, insbesondere Chrome, kann optimieren, aber dies ist eine andere Geschichte) und rendert keinen weiteren Inhalt.  Mit synchronen Skripten im Kopf verschieben wir den Moment, in dem der Benutzer mindestens etwas sieht (sogar Text).  Daher versucht jeder, Js am Ende der Seite zu werfen oder sie sogar asynchron zu machen.  Dies funktioniert, l√∂st aber nicht das zweite Problem, das uns die Tatsache bringt, dass JavaScript immer noch eine Skriptsprache ist.  Daher reicht der Browser nicht aus, um ihn nur herunterzuladen - er muss auch "verstanden" werden.  Und hier stellt sich heraus, dass dies ein Problem ist, da schwache Prozessoren (z. B. in billigen Telefonen oder Netbooks oder sogar guten Laptops im eingeschr√§nkten Leistungsmodus) dies langsam tun und den Haupt-Thread blockieren!  Im Folgenden finden Sie ein Beispiel daf√ºr, wie ein asynchrones Werbeskript in den kritischen Bereich des Habr-Renderings eingedrungen ist und zwar ein wenig, aber dennoch die Leistung beeintr√§chtigt hat.  Wenn jemand interessiert ist, gibt es einen sehr (sehr, sehr) guten Artikel zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Thema.</a> </p></div></div><br><p>  Habr-Skripte laden viel - 1,1 MB (und dies ist bereits in komprimierter Form) f√ºr 40 Anfragen.  Dies ist ehrlich gesagt wichtig, es kommt immer noch auf uns zur√ºck und wir m√ºssen etwas dagegen tun.  Sortieren Sie unsere Skripte "nach dem Wasserfall".  Unsere Aufgabe ist es, Skripte zu finden, die VOR der blauen Linie geladen wurden, da sie (h√∂chstwahrscheinlich) verhindern, dass wir die Site so schnell wie m√∂glich rendern. </p><br><p><img src="https://habrastorage.org/webt/0m/8g/u4/0m8gu4f9s-odx2kf7xg8jiweuke.png" alt="Auf dem Umhang meiner Mutter"><br>  <a href="">Klickbar</a> </p><br><p>  Wir √∂ffnen das HTML, das Habr uns gegeben hat (es ist wichtig, die Antwort zu lesen, da das endg√ºltige HTML anders aussehen wird) und gehen die Liste durch.  Wie Sie sehen k√∂nnen, werden jQuery, raven.js, Advertise.js und adriver.js synchron direkt vom Head-Tag geladen (d. H. Sie blockieren √ºberhaupt alles).  Gpt und Publisher werden vom Kopf geladen, aber bereits asynchron (d. H. Sie blockieren nichts, der Browser rendert die Seite weiter, w√§hrend sie geladen werden).  Vendors, Main und Math, Checklogin werden am Ende geladen, aber synchron (d. H. Der Text ist bereits vorhanden, wir k√∂nnen ihn lesen, aber die DCL wird erst angezeigt, wenn sie geladen werden).  Der Rest erscheint nicht in der ersten Antwort - sie werden dynamisch hinzugef√ºgt, aber dies ist ein anderes Thema. </p><br><p>  Wir haben also Skripte gefunden, die sich irgendwie darauf auswirken, wie schnell wir den Text auf der Seite sehen.  Dies sind die ersten Kandidaten f√ºr eine Optimierung.  Idealerweise sollten sie asynchron oder so niedrig wie m√∂glich platziert werden, damit der Browser Inhalte f√ºr uns rendern kann.  Das Ideal ist jedoch nicht erreichbar, da es h√∂chstwahrscheinlich andere Skripte auf der Site gibt, die von derselben jQuery abh√§ngen.  Der Wunsch, Raven so schnell wie m√∂glich herunterzuladen - eine Bibliothek zum Verfolgen verschiedener Fehler, die auf dem Client auftreten - kann ebenfalls verstanden werden.  Advertise.js und adriver.js sind jedoch bereits echte Kandidaten, um zumindest die Seite nach unten zu bewegen, und maximal auch im asynchronen Modus.  Eine √§hnliche Geschichte mit gpt und Publisher.  Ja, sie werden asynchron geladen, aber sie k√∂nnen (und werden) uns beim Laden st√∂ren.  Daher k√∂nnen auch sie ganz unten auf der Seite gesendet werden.  Dar√ºber hinaus k√∂nnen Sie versuchen, die Attribute " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ressourcenhinweise"</a> - "Preload / Prefetch / DNS-Prefetch" zu verwenden, um dem Browser mitzuteilen, was im Voraus geladen werden soll.  √úbrigens rate ich Ihnen, √ºber Ressourcenhinweise zu lesen - ein sehr interessantes Tool, wenn auch mit begrenzter (bisheriger) Unterst√ºtzung. </p><br><p>  Sortieren Sie nun die Liste nach Dateigr√∂√üe: </p><br><p><img src="https://habrastorage.org/webt/r-/om/kq/r-omkqj5qrslwffj42o5eogv_3s.png" alt="Der Umhang muss ganz verstaut sein"><br>  https://github.com/Drag13/articles/blob/habrformance/habrformance/scripts.PNG </p><br><p>  Wir sehen ein Skript, das zweimal geladen wird (Pubads).  Wir stellen au√üerdem fest, dass prebid.js aus dem Not-for-Prod-Ordner geladen wird </p><br><p><img src="https://habrastorage.org/webt/4e/su/7w/4esu7wsvwdpgmbw8nscc_sqcgmo.png" alt="In dickem Kirschsaft."></p><br><p>  Um unser Gewissen zu kl√§ren, √ºberpr√ºfen wir, ob alle Skripte minimiert sind.  Pl√∂tzlich wurden die Skripte check-login.js und adriver.js nicht minimiert.  Besonders zufrieden mit dem Inhalt des letzteren: </p><br><p><img src="https://habrastorage.org/webt/6q/nv/q8/6qnvq8dimcd_5m3w77mr3mkjlea.png" alt="Nimm den Umhang einer Kirschmutter"></p><br><p>  Und mit Skripten k√∂nnen Sie vor√ºbergehend beenden. </p><br><h3 id="stili">  Stile </h3><br><div class="spoiler">  <b class="spoiler_title">√úber Stile</b> <div class="spoiler_text"><p>  Bei Stilen ist auch nicht alles so einfach.  Erstens blockiert das synchrone Laden von Stilen auch den Hauptthread (obwohl sie schnell und schneller als JavaScript analysiert werden).  Und zweitens ist alles etwas komplizierter.  Warum ben√∂tigt der Browser CSS?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CSSOM erstellen</a> .  Was kann JavaScript mit CSS tun?  Das ist richtig - √§ndern.  Und was passiert, wenn CSSOM noch nicht erstellt wurde und js dort bereits versucht, etwas zu √§ndern?  Die Antwort ist wer wei√ü.  Daher verz√∂gert der Browser die Ausf√ºhrung von JavaScript, bis die CSSOM berechnet ist.  Wie in einem anderen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sehr n√ºtzlichen Artikel</a> richtig geschrieben - kein CSS = kein JavaScript.  Daher blockiert das Laden von CSS die JS-Ausf√ºhrung. </p></div></div><br><p>  Hier sind die Stile, die Habr l√§dt: </p><br><p><img src="https://habrastorage.org/webt/nm/6y/a7/nm6ya7qcp1bdqcp5sl2fiingrp8.png" alt="Und eine Tasse Milch."><br>  <a href="">Klickbar</a> </p><br><p>  Wie Sie sehen k√∂nnen, gibt es nur drei davon, wobei der zweite und der dritte in einem separaten Frame geladen sind. Daher ignorieren wir sie.  Der erste Satz von Stilen ist jedoch f√ºr die gesamte Site von entscheidender Bedeutung.  Und wir haben es sehr lange heruntergeladen.  Warum?  Erstens haben sie lange auf eine Antwort vom Server gewartet (TTFB 570 ms, wir werden im dritten Abschnitt darauf zur√ºckkommen), und zweitens wurden 713 ms f√ºr eine lange Zeit geladen.  Was kann man hier machen?  Die erste und einfachste M√∂glichkeit besteht darin, das Preload-Attribut hinzuzuf√ºgen.  Dadurch wird der Browser aufgefordert, CSS so fr√ºh wie m√∂glich zu laden.  Die zweite M√∂glichkeit besteht darin, kritisches CSS hervorzuheben und direkt in die Webseite einzubetten und den Rest synchron (oder sogar asynchron) zu laden.  Dies f√ºhrt zu einer Vergr√∂√üerung der Seite (aber sie ist bereits nicht klein und + 5 KB verderben nichts) und einer m√∂glichen Neugestaltung des Layouts (Zeitverlust), aber Sie k√∂nnen es versuchen. </p><br><p>  Ich werde nicht einmal Schriftarten anzeigen.  Es ist alleine da, obwohl es aus irgendeinem Grund direkt vom Habr-Server anstelle des CDN geladen wird (und h√∂chstwahrscheinlich aus einem Grund).  Aber ich werde mich daf√ºr bedanken, dass es nur eine Schriftart gibt. </p><br><p>  Hierbei kann der √úbersichtsteil der Site-Analyse als abgeschlossen betrachtet werden.  Zeit, tiefer zu gehen. </p><br><h2 id="etap-vtoroy---ruchnoy-rezhim">  Stufe zwei - "Manueller Modus" </h2><br><p>  In der letzten Phase haben wir gesehen, <em>dass</em> Habr l√§dt.  Jetzt werden wir sehen, <em>wie</em> dies gerendert wird. </p><br><p>  Wechseln Sie zur Registerkarte Profilerstellung.  Wir √ºberpr√ºfen, was Slow3g verlangsamt (dann ohne Einschr√§nkungen erneut ausf√ºhren) und f√ºhren es aus.  Zun√§chst interessieren wir uns f√ºr alles, was vor dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">First Contentful Paint (FCP) -Ereignis</a> passiert, und f√ºr alle F√§lle f√ºr DCL.  Wir w√§hlen den Bereich vom Beginn des Ladens in FCP aus und sehen uns das endg√ºltige Diagramm an. </p><br><p><img src="https://habrastorage.org/webt/1s/nb/qi/1snbqidqssgm4mxoulzysms7swu.png" alt="Gie√üen Sie die Milch ordentlich -"></p><br><p>  Alles geht ziemlich schnell - 2,161 Sekunden vor FCP (es war schneller, aber anscheinend hatte sich etwas ge√§ndert), aber wie Sie sehen k√∂nnen, war der Browser die meiste Zeit im Leerlauf.  Die Nutzlast dauerte nur 14% der Zeit (ca. 310 ms).  Im Idealfall wird der Hauptbrowser-Thread kontinuierlich ausgef√ºhrt. Beim Parsen von HTML, CSS und JS wird JS ausgef√ºhrt.  Und hier - nichts.  Warum?  Weil der Browser einfach nichts zu tun hatte.  Erinnerst du dich, dass wir den Verkehr reduziert haben?  Der Browser hat Anfragen gesendet und wartet nun nur darauf, dass diese abgeschlossen werden.  Wenn wir das Diagramm der Netzwerkprozesse (das oberste) √∂ffnen, wird alles sofort klar. </p><br><p><img src="https://habrastorage.org/webt/uf/1-/gt/uf1-gt0kx7rkdpd9tzeod3hv99o.png" alt="Ein Punkt wird zu Einstellungen."><br>  <a href="">Klickbar</a> </p><br><p>  Im Jahr 2029 sah der Browser main.bundle.css, schickte eine Anfrage, um sie zu erhalten, und begann zu warten.  Zu diesem Zeitpunkt stellte der Prescanner (Smart Chrome, es kann vorauslaufen) fest, dass sich unten synchrone Skripte befinden, und ohne auf das Eintreffen von CSS zu warten, schickte er eine Anfrage nach Skripten.  Dann werben und adriver laden (aber wir erinnern uns, dass CSSOM nicht erstellt wird, Sie JS jedoch nicht ber√ºhren k√∂nnen), sodass der Browser sie ignorierte.  Danach wurden gpt und raven geladen, aber das CSS wurde noch geladen, sodass sie ebenfalls ignoriert wurden.  Schlie√ülich wurde CSS geladen, das der Browser in 12 ms analysierte und sofort das in die Seite eingebettete JS analysierte.  Dann schlief der Browser nach fast 150 ms wieder ein und wartete auf jQuery.min.js.  Und danach habe ich bereits ernsthaft angefangen zu arbeiten - ich habe die geladene jQuery (20 ms) herausgefunden, raven.js (4 ms) analysiert, fast die gesamte Seite (36 ms) analysiert, die Stile (28 ms) nachgez√§hlt, das Layout berechnet (78 ms + 8 ms) und Schlie√ülich haben wir f√ºr ~ 6 ms die Seite gemalt.  Hier haben wir FCP.  Als n√§chstes analysieren wir die Seite, analysieren die Skripte - Hallo an niemanden (publishertag.js, gpt.js, der vor DCL in den Hauptthread gelangt ist), spielten ein wenig mit Stilen herum (was aufgrund der Neuberechnung des Layouts einen leichten Zeitverlust verursachte) und warteten auf Anbieter. bundle.js.  Um auf die Anbieter zu warten, haben wir fast 1100 ms im Leerlauf verbracht.  Parallel dazu haben wir auch main.bundle.js geladen (die √ºbrigens schneller gebootet haben), also ist nicht alles so schlecht.  Dann ging alles wieder gut.  Wir haben die Anbieter analysiert, das Hauptpaket analysiert, Math.Jax analysiert und schlie√ülich die Seite analysiert und DCL erhalten.  Zwar funktionierte genau dort eine Art Handler, der auf meinem I7 den Hauptthread bei 80 ms stoppte (d. H. Die Site schien bei 80 ms einzufrieren).  Jetzt haben wir das fast nicht bemerkt, aber auf einem schwachen Prozessor kann es theoretisch auffallen. Wenn Sie dies nach dem Rendern des Inhalts sehen, ist dies eine Gelegenheit, JS zu √ºberpr√ºfen. </p><br><p>  Was soll ich sagen  Wieder trotz der Tatsache, dass es ziemlich gut aussieht.  Die Hauptprobleme wurden uns geliefert: </p><br><ul><li>  Ein gro√üer einfacher Browser (auch aufgrund des k√ºnstlichen Ungleichgewichts zwischen der Rechenleistung des Computers und der Kanalbreite, aber dies ist auch ein durchaus g√ºltiges Szenario) </li><li>  Langes CSS-Laden, das die Arbeit mit kritischen js verz√∂gerte </li><li>  Synchrones Laden von jQuery, Anbietern und Hauptpaketen, wodurch das Auftreten von Inhalten gestoppt wurde. </li></ul><br><p>  Was wir damit machen k√∂nnen, haben wir bereits besprochen: </p><br><ul><li>  Versuchen Sie, das Preload-Attribut f√ºr CSS und m√∂glicherweise JS hinzuzuf√ºgen </li><li>  CSS reduzieren oder inline </li><li>  Versuchen Sie im Allgemeinen, Skripte aus dem synchronen Laden herauszuwerfen (zumindest einige). </li></ul><br><p>  Wiederholen wir nun dasselbe ohne Einschr√§nkungen der Kanalbreite.  Das Bild ist schon viel besser: 0,452 Sekunden zu FMP, dem einfachsten von allen!  13 ms.  DCL - 953 ms, einfach 15 ms.  So sieht mein Traum-Download aus.  Genau das ist passiert, weil ich einen neuen Tab ge√∂ffnet und das Caching nicht entfernt habe.  Versuchen wir dasselbe, aber ohne Cache: </p><br><p><img src="https://habrastorage.org/webt/g5/ji/5q/g5ji5qscsjud50jdqkoazqoxsga.png" alt="Jetzt, wo es keinen Platz mehr gibt"></p><br><p>  Alles ist auch ganz gut, FCP / FMP - 1689, Nutzlast 45%.  √úbrigens ist es auch schlecht, die Last auf 100% einzustellen, da schw√§chere Maschinen √ºberlastet werden.  Es ist also besser, eine Reserve f√ºr Ausfallzeiten zu haben.  Aber hier wurde unerwartet viel Zeit f√ºr das Rendern aufgewendet - 400 ms f√ºr FMP.  Davon entfielen 200 ms auf die Neuberechnung von Stilen und die Neuberechnung des Layouts. </p><br><p>  √úbrigens ein weiterer interessanter Punkt.  Erinnern Sie sich an die Anzeigenskripte - gpt.js und publishertag.js, die im ersten Teil erw√§hnt wurden?  Jetzt k√∂nnen Sie sehen, dass sie trotz ihrer Asynchronit√§t (wenn auch ein wenig) unsere Statistiken ruinieren konnten.  Dies geschah, weil die Ausf√ºhrung von asynchronen Skripten entsprechend der Bereitschaft der Skripte selbst erfolgt.  Das hei√üt,  Dies kann jederzeit geschehen, auch vor FCP / DCL, was 3309 geschah. </p><br><p>  Also haben wir die manuelle Demontage durchgef√ºhrt.  Es ist Zeit, die Automatisierung aufzudecken. </p><br><h2 id="etap-tretiy---s-etogo-nado-bylo-nachinat">  Stufe drei - ‚ÄûWir mussten damit anfangen‚Äú </h2><br><div class="spoiler">  <b class="spoiler_title">√úber die Kollektivfarm</b> <div class="spoiler_text"><p>  Ich denke, jeder versteht, dass diese Studie sehr willk√ºrlich ist.  Zumindest, weil die ganze Zeit, w√§hrend ich neue Artikel testete, die Last auf dem Server und die Last auf den Netzwerk-Backbones ge√§ndert wurden.  Auf eine gute Weise m√ºssen Sie einen dedizierten Server bereitstellen, auf dem niemand etwas schreibt, die relevante Last mit relevanten Verz√∂gerungen emuliert und erst dann ein Profil erstellt.  Andernfalls k√∂nnen Sie einige Annahmen treffen (z. B. √ºber die Notwendigkeit, ein Preload-Attribut in CSS hinzuzuf√ºgen), es hinzuf√ºgen, f√ºr die Produktion bereitstellen, und dann stellt sich heraus, dass die Last w√§hrend des Tests stark gestiegen ist und der Server uns 500 ms sp√§ter den gleichen Stil gegeben hat.  Und es stellt sich heraus, dass die Vorspannung schlecht ist - es hat alles nur noch schlimmer gemacht.  Und der Autor ist der letzte Rettich √ºberhaupt.  Dar√ºber hinaus macht die manuelle Profilerstellung (wie im zweiten Teil) wenig Sinn, bis Sie alle automatischen Werkzeuge entfernt und die dort gefundenen Probleme gel√∂st haben, da sich das Bild nach Ihren ersten √Ñnderungen √§ndert. </p><br><p>  Daher ben√∂tigen wir vor allen Experimenten die stabilste Umgebung.  Diesmal.  Das zweite - Sie sollten niemals von Anfang an tief gehen (zum Beispiel in die Profilerstellung).  Starten Sie zuerst die automatischen Werkzeuge und lassen Sie sie f√ºr Sie arbeiten.  Sammeln Sie Berichte und sehen Sie, was in k√ºrzester Zeit so gut wie m√∂glich getan werden kann.  Versuche es zu tun.  Wenn m√∂glich, haben Sie m√∂glicherweise bereits genug.  Zum Beispiel wiegt Ihr css.bundle 100 KB, aber in Wirklichkeit ben√∂tigen Sie 45 KB (√ºbrigens die reale Situation: Sie haben den gesamten Bootstrap genommen, aber nur das Raster wurde ben√∂tigt).  Sie reduzierten die Gr√∂√üe der Stile und gewannen praktisch umsonst eine halbe Sekunde.  Das sind zwei.  Immer √ºberpr√ºfen.  Es scheint, dass Stile inline sind, alles sollte besser werden, aber es wird schlechter.  Und warum?  Und weil in den Stilen von 50 KB Base64-Bildern und unserer Seite gerade 200 KB Ressourcen geladen wurden.  Denken Sie daran, dass es keine Silberkugel und universelle Skripte gibt.  Das sind drei.  Und das letzte, auch wenn es dem vorherigen Satz widerspricht.  Wenn Sie keine komplizierte Site haben, √ºberwachen Sie einfach TTFB (Serverprobleme), die Gr√∂√üe der heruntergeladenen Ressourcen (Hallo zu den Logos f√ºr 2 MB) und gew√§hren Sie niemandem Zugriff auf Google Tag Manager.  H√∂chstwahrscheinlich wird dies v√∂llig ausreichen. </p></div></div><br><p>  Wir werden nicht weit gehen. √ñffnen Sie in denselben Entwicklertools die Registerkarte "√úberwachung" und starten Sie LightHouse (LH) mit den folgenden Einstellungen: Desktop, nur Leistung, keine Drosselung, Speicherplatz l√∂schen.  Nachdem wir ein wenig gewartet haben (verlassen Sie nicht die Seite, auf der das Audit durchgef√ºhrt wird, und machen Sie nichts besseres), erhalten wir fantastische Zahlen (auch wenn der Cache deaktiviert ist). </p><br><p><img src="https://habrastorage.org/webt/cg/cu/rc/cgcurczrbd7r4xhjqrtqgw-pj5s.png" alt="Auf dem Umhang meiner Mutter"></p><br><p>  Es scheint mir sogar, dass sie speziell auf diese Figuren zugeschnitten waren. </p><br><p>  LH beschwert sich jedoch immer noch √ºber: </p><br><ul><li>  Veraltetes Bildformat (empfiehlt die Verwendung von webp, jpeg2000 usw.) </li><li>  DOM node ‚Äì    : 2533,   1500. </li><li>    </li><li>     ‚Äî     23  </li><li>  document.write </li></ul><br><p>   .     (), DOM ‚Äî      node (-),      (  ),   document.write-  writer ( -    ) </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p>    (       )   .    ,  ,  , .  ,   ,      .       CSS, ‚Äî      ,   ,      JavaScript. ,        ,     .                       . </p></div></div><br><p>     ,       fast3g , ,      ( I7,  celeron): </p><br><p><img src="https://habrastorage.org/webt/td/ei/3j/tdei3jxtwbcvda5csqvvmgz2tua.png" alt="Der Umhang muss ganz verstaut sein"></p><br><p>      ( FCP   3500 ms, FMP 5.7): </p><br><ul><li>   ,   . LH    next-gen  ,  ,   ,     11   </li><li>      .       adriver.js  advertise.js  50 ,     . </li><li>    CSS    ,    5kb  45kb. </li><li>      main thread.           JavaScript ‚Äî (8.5   script evaluation   2186 ms   raven.js).   ? </li></ul><br><p>     ?         .    -    .  : </p><br><ul><li>   </li><li>   DOM </li><li>   JavaScript   </li></ul><br><p>    ,        ,         (,  raven.js). </p><br><p>  ,      ,       ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">webpagetest.org</a> </p><br><p>    ‚Äî   ,  ,  .        ‚Äî     ,      .   ,    .   ,    ,   . ,       ,      ,   ‚Äî  -. </p><br><p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://habr.com</a> ( ru/en ). </p><br><p><img src="https://habrastorage.org/webt/qz/hb/gn/qzhbgnvpgll4xbdlvejmvfzpndm.png" alt="In einer Pfanne mit Milch."></p><br><p> ( ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> ) </p><br><p>    .     ( )    DNS (500 ms   ),     , ssl   .   ,    1150 ms    c      (    ). ,     (    habrastorage). </p><br><p>      main.bundle.css. ,     dr.habracdn.net ,     dns lookup ‚Äî 36 ms (     400 ms).  SSL negotiation 606 ms,  TTFB 601 ms,   .    .       DCL ‚Äî 4100 ms   ,   . </p><br><p>     image analysis , ,        .  -      PNG  1.4,   webp + downscaling ( ,   ) ‚Äî 17.7 KB.  ,       ,     png  154.          . ,  : </p><br><ul><li>         (   ,        , ..    ). </li><li>   .   ,    . </li><li>  TTFB (webpagetest    F  ) ‚Äî     </li><li>       ,       (         ) </li></ul><br><h2 id="vyvody">  Schlussfolgerungen </h2><br><p>      .     : </p><br><p>  : </p><br><ul><li>  TTFB   500 ms      ( <strong></strong> dns, ssl  initial connection) </li><li>  habrastorage </li></ul><br><p>  : </p><br><ul><li>    </li><li>   DOM-a </li><li>       </li></ul><br><p>  , ,      .      ,     ,    . ,   SPA,       ,    JS   ‚Äî    .     .       //,           </p><br><h2 id="poleznye-ssylki">  N√ºtzliche Links </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Webpagetest</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  webpagetest</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   1</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   2</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> FCP</a> </li></ul><br><p>  PS.       (  )   .      ,    .1, .2, .3    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454444/">https://habr.com/ru/post/de454444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454432/index.html">Unterhaltsame Arch√§ologie: Der Style Guide R unter der Lupe</a></li>
<li><a href="../de454434/index.html">PDA (Pocket Travel Computer): Schaltkreis-GPS-Logger</a></li>
<li><a href="../de454436/index.html">Petty Petty Joy # 1: Loguru</a></li>
<li><a href="../de454440/index.html">Petty Little Fun # 2: Starlette</a></li>
<li><a href="../de454442/index.html">So w√§hlen Sie ein Proxy-Netzwerk f√ºr Ihr Unternehmen aus: 3 praktische Tipps</a></li>
<li><a href="../de454446/index.html">Was ist neu in C # 8?</a></li>
<li><a href="../de454450/index.html">Wie Edison Wireless erfand und nichts verstand</a></li>
<li><a href="../de454452/index.html">Wir zeigen Inhalte auf dem erkannten Bild nach bestimmten Regeln an</a></li>
<li><a href="../de454456/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 7. FAQ</a></li>
<li><a href="../de454458/index.html">Metamorphe Tests: Warum wei√ü fast niemand etwas √ºber diese vielversprechende Technik?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>