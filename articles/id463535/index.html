<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§õüèæ ü¶í üë®‚Äçüë®‚Äçüë¶‚Äçüë¶ Memeriksa .NET Core Libraries Source Code oleh PVS-Studio Static Analyzer üè© üë©üèæ‚Äç‚öïÔ∏è üë©üèø‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=".NET Core libraries adalah salah satu proyek C # paling populer di GitHub. Ini tidak mengherankan, karena dikenal dan digunakan secara luas. Karena in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memeriksa .NET Core Libraries Source Code oleh PVS-Studio Static Analyzer</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/463535/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/-a/bm/pb/-abmpb2yelga7y1zu59bejm6vgo.png" alt="Gambar 19"></div><br>  .NET Core libraries adalah salah satu proyek C # paling populer di GitHub.  Ini tidak mengherankan, karena dikenal dan digunakan secara luas.  Karena ini, upaya untuk mengungkap sudut-sudut gelap dari kode sumber menjadi lebih menawan.  Jadi ini yang akan kami coba lakukan dengan bantuan analisa statis PVS-Studio.  Apa yang Anda pikirkan - pada akhirnya kami akan menemukan sesuatu yang menarik? <br><a name="habracut"></a><br>  Saya telah berjalan menuju artikel ini selama lebih dari satu setengah tahun.  Pada titik tertentu, saya punya ide di kepala saya bahwa perpustakaan .NET Core adalah berita gembira, dan ceknya sangat menjanjikan.  Saya telah memeriksa proyek beberapa kali, alat analisis terus menemukan semakin banyak fragmen kode yang menarik, tetapi tidak lebih dari sekadar menggulir daftar peringatan.  Dan ini dia - akhirnya terjadi!  Proyek diperiksa, artikelnya tepat di depan Anda. <br><br><h2>  Rincian tentang Proyek dan Periksa </h2><br>  Jika Anda berupaya menyelami investigasi kode - Anda dapat mengabaikan bagian ini.  Namun, saya sangat ingin Anda membacanya, karena di sini saya bercerita lebih banyak tentang proyek dan penganalisa, serta tentang melakukan analisis dan mereproduksi kesalahan. <br><br><h3>  Proyek di bawah cek </h3><br>  Mungkin, saya bisa saja tidak mengatakan apa itu CoreFX (.NET Core Libraries), tetapi jika Anda belum pernah mendengarnya, uraiannya diberikan di bawah ini.  Itu sama dengan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">halaman proyek di GitHub</a> , di mana Anda juga dapat mengunduh kode sumber. <br><br>  Deskripsi: <i>Repo ini berisi implementasi perpustakaan (disebut "CoreFX") untuk .NET Core.</i>  <i>Ini termasuk System.Collections, System.IO, System.Xml, dan banyak komponen lainnya.</i>  <i>Repo .NET Core Runtime yang sesuai (disebut "CoreCLR") berisi implementasi runtime untuk .NET Core.</i>  <i>Ini termasuk RyuJIT, .NET GC, dan banyak komponen lainnya.</i>  <i>Kode perpustakaan khusus-runtime (System.Private.CoreLib) hidup di repo CoreCLR.</i>  <i>Itu perlu dibangun dan versi bersama-sama dengan runtime.</i>  <i>Sisa CoreFX adalah agnostik implementasi runtime dan dapat dijalankan pada runtime .NET yang kompatibel (misalnya CoreRT)</i> . <br><br><h3>  Penganalisis Digunakan dan Metode Analisis </h3><br>  Saya memeriksa kode menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>analisa statis PVS-Studio</u></a> .  Secara umum, PVS-Studio dapat menganalisis tidak hanya kode C #, tetapi juga C, C ++, Java.  Analisis kode C # sejauh ini hanya berfungsi di bawah Windows, sedangkan kode C, C ++, Java dapat dianalisis di bawah Windows, Linux, macOS. <br><br>  Biasanya untuk memeriksa proyek C # saya menggunakan plugin PVS-Studio untuk Visual Studio (mendukung versi 2010-2019), karena mungkin itu skenario analisis yang paling sederhana dan nyaman dalam kasus ini: solusi terbuka, jalankan analisis, tangani daftar peringatan.  Namun, itu keluar sedikit lebih rumit dengan CoreFX. <br><br>  Bagian yang sulit adalah bahwa proyek tidak memiliki file .sln tunggal, oleh karena itu membukanya di Visual Studio dan melakukan analisis penuh, menggunakan plugin PVS-Studio, tidak mungkin.  Itu mungkin hal yang baik - saya tidak benar-benar tahu bagaimana Visual Studio akan mengatasi solusi sebesar ini. <br><br>  Namun, tidak ada masalah dengan analisis, karena distribusi PVS-Studio termasuk versi baris perintah analyzer untuk proyek MSBuild (dan .sln).  Semua yang harus saya lakukan adalah menulis skrip kecil, yang akan menjalankan "PVS-Studio_Cmd.exe" untuk masing-masing .sln di direktori CoreFX dan menyimpan hasil dalam direktori terpisah (ditentukan oleh bendera baris perintah penganalisis) . <br><br>  Presto!  Akibatnya, saya memiliki kotak Pandora dengan satu set laporan yang menyimpan beberapa hal menarik.  Jika diinginkan, log ini dapat dikombinasikan dengan utilitas PlogConverter, yang merupakan bagian dari distributif.  Bagi saya, itu lebih nyaman untuk bekerja dengan log terpisah, jadi saya tidak menggabungkannya. <br><br>  Ketika menjelaskan beberapa kesalahan, saya merujuk pada dokumentasi dari paket docs.microsoft.com dan NuGet, tersedia untuk diunduh dari nuget.org.  Saya berasumsi bahwa kode yang dijelaskan dalam dokumentasi / paket mungkin sedikit berbeda dari kode yang dianalisis.  Namun, akan sangat aneh jika, misalnya, dokumentasi tidak menjelaskan pengecualian yang dihasilkan ketika memiliki dataset input tertentu, tetapi versi paket baru akan menyertakannya.  Anda harus mengakui itu akan menjadi kejutan yang meragukan.  Mereproduksi kesalahan dalam paket dari NuGet menggunakan data input yang sama yang digunakan untuk debugging perpustakaan menunjukkan bahwa masalah ini bukan hal baru.  Yang paling penting, Anda dapat 'menyentuhnya' tanpa membangun proyek dari sumber. <br><br>  Dengan demikian, memungkinkan untuk beberapa desinkronisasi teoritis kode, saya merasa dapat diterima untuk merujuk pada deskripsi metode yang relevan di docs.microsoft.com dan untuk mereproduksi masalah menggunakan paket dari nuget.org. <br><br>  Selain itu, saya ingin mencatat bahwa deskripsi oleh tautan yang diberikan, informasi (komentar) dalam paket (dalam versi lain) dapat diubah selama penulisan artikel. <br><br><h3>  Proyek Lain yang Diperiksa </h3><br>  Omong-omong, artikel ini tidak unik dari jenisnya.  Kami menulis artikel lain tentang cek proyek.  Dengan tautan ini Anda dapat menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">daftar proyek yang diperiksa</a> .  Selain itu, di situs kami Anda tidak hanya akan menemukan artikel pemeriksaan proyek, tetapi juga berbagai artikel teknis tentang C, C ++, C #, Java, serta beberapa catatan menarik.  Anda dapat menemukan semua ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>blog</u></a> . <br><br>  Rekan saya sebelumnya telah memeriksa perpustakaan .NET Core pada tahun 2015. Hasil analisis sebelumnya dapat ditemukan di artikel yang relevan: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>Analisis Natal Perpustakaan NET Core. (CoreFX)</u></a> ." <br><br><h2>  Kesalahan yang Terdeteksi, Bagian yang Mencurigakan dan Menarik </h2><br>  Seperti biasa, untuk minat yang lebih besar, saya sarankan Anda mencari sendiri kesalahan dalam fragmen yang diberikan, dan baru kemudian membaca pesan penganalisa dan deskripsi masalahnya. <br><br>  Untuk kenyamanan, saya telah dengan jelas memisahkan masing-masing bagian menggunakan label <b>Issue N</b> - dengan cara ini lebih mudah untuk mengetahui di mana deskripsi satu kesalahan berakhir, diikuti oleh yang berikutnya.  Selain itu, lebih mudah merujuk pada fragmen tertentu. <br><br>  <b>Edisi 1</b> <br><br><pre><code class="cpp hljs">abstract <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Principal</span></span></span><span class="hljs-class"> :</span></span> IDisposable { .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PrincipalContext context)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( context.ContextType == ContextType.Machine || _ctx.ContextType == ContextType.Machine) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException( SR.SaveToNotSupportedAgainstMachineStore); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context == null) { Debug.Assert(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unpersisted == <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(SR.NullArguments); } .... } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3095 Objek</u></a> 'konteks' digunakan sebelum diverifikasi terhadap nol.  Periksa baris: 340, 346. Principal.cs 340 <br><br>  Pengembang dengan jelas menyatakan bahwa nilai <i>nol</i> untuk parameter <i>konteks</i> tidak valid, mereka ingin menekankan ini dengan menggunakan pengecualian dari tipe <i>InvalidOperationException</i> .  Namun, tepat di atas dalam kondisi sebelumnya kita dapat melihat referensi tanpa syarat dari <i>konteks</i> referensi - <i>context.ContextType</i> .  Akibatnya, jika nilai <i>konteksnya</i> <i>nol,</i> pengecualian tipe <i>NullReferenceException</i> akan dihasilkan alih-alih <i>InvalidOperationExcetion yang</i> diharapkan <i>.</i> <br><br>  Mari kita coba mereproduksi masalahnya.  Kami akan menambahkan referensi ke pustaka <i>System.DirectoryServices.AccountManagement</i> ke proyek dan menjalankan kode berikut: <br><br><pre> <code class="cpp hljs">GroupPrincipal groupPrincipal = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GroupPrincipal(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PrincipalContext(ContextType.Machine)); groupPrincipal.Save(null);</code> </pre> <br>  <i>GroupPrincipal</i> mewarisi dari kelas abstrak <i>Kepala Sekolah</i> yang mengimplementasikan metode <i>Simpan</i> yang kami minati.  Jadi kami mengeksekusi kode dan melihat apa yang diperlukan untuk membuktikan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/290/09a/2cc/29009a2cc3a5408808b9814d48bb0dea.png" alt="Gambar 1"></div><br>  Untuk kepentingan, Anda dapat mencoba mengunduh paket yang sesuai dari NuGet dan mengulangi masalah dengan cara yang sama.  Saya menginstal paket 4.5.0 dan memperoleh hasil yang diharapkan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3de/891/b4a/3de891b4a4ba8100bb63af19e4455842.png" alt="Gambar 2"></div><br>  <b>Edisi 2</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SearchResultCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> findMoreThanOne)</span></span></span><span class="hljs-function"> </span></span>{ searchResult = null; DirectoryEntry clonedRoot = null; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_assertDefaultNamingContext == null) { clonedRoot = SearchRoot.CloneBrowsable(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { clonedRoot = SearchRoot.CloneBrowsable(); } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3004</u></a> Pernyataan 'then' setara dengan pernyataan 'else'.  DirectorySearcher.cs 629 <br><br>  Terlepas dari apakah kondisi <i>_assertDefaultNamingContext == null</i> benar atau salah, tindakan yang sama akan diambil, saat <i>itu</i> dan cabang-cabang <i>lain</i> dari pernyataan <i>if</i> memiliki badan yang sama.  Entah harus ada tindakan lain di cabang, atau Anda bisa menghilangkan pernyataan <i>if</i> untuk tidak membingungkan pengembang dan analis. <br><br>  <b>Edisi 3</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DirectoryEntry</span></span></span><span class="hljs-class"> :</span></span> Component { .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] propertyNames)</span></span></span><span class="hljs-function"> </span></span>{ .... object[] names = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> object[propertyNames.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; propertyNames.Length; i++) names[i] = propertyNames[i]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_propertyCollection != null &amp;&amp; propertyNames != null) .... .... } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3095 Objek</u></a> 'propertyNames' digunakan sebelum diverifikasi dengan null.  Periksa baris: 990, 1004. DirectoryEntry.cs 990 <br><br>  Sekali lagi, kita melihat urutan tindakan yang aneh.  Dalam metode ini, ada check <i>propertyNames! = Tidak</i> , pengembang menutup basis mereka dari <i>nol yang</i> masuk ke metode.  Tetapi di atas Anda dapat melihat beberapa operasi akses dengan referensi yang berpotensi nol ini - <i>propertyNames. Panjang</i> dan <i>propertyNames [i]</i> .  Hasilnya cukup dapat diprediksi - terjadinya pengecualian dari tipe <i>NullReferenceExcepption</i> jika referensi nol dilewatkan ke metode. <br><br>  Kebetulan sekali!  <i>RefreshCache</i> adalah metode publik di kelas publik.  Bagaimana dengan mencoba mereproduksi masalah?  Untuk melakukan ini, kami akan menyertakan Sistem perpustakaan yang diperlukan. <i>Layanan</i> Direktori ke proyek dan kami akan menulis kode seperti ini: <br><br><pre> <code class="cpp hljs">DirectoryEntry de = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DirectoryEntry(); de.RefreshCache(null);</code> </pre> <br>  Setelah kami mengeksekusi kode, kami dapat melihat apa yang kami harapkan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d9/040/d0a/2d9040d0ae8d91394c476d6788aa7275.png" alt="Gambar 3"></div><br>  Hanya untuk iseng, Anda dapat mencoba mereproduksi masalah pada versi rilis paket NuGet.  Selanjutnya, kita menambahkan referensi ke paket <i>System.DirectoryServices</i> (saya menggunakan versi 4.5.0) ke proyek dan menjalankan kode yang sudah akrab.  Hasilnya di bawah. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d6/31e/309/0d631e3096fa8ba00b41fe10ad1001db.png" alt="Gambar 4"></div><br>  <b>Masalah 4</b> <br><br>  Sekarang kita akan pergi dari kebalikan - pertama kita akan mencoba untuk menulis kode, yang menggunakan contoh kelas, dan kemudian kita akan melihat ke dalam.  Mari kita merujuk ke struktur <i>System.Drawing.CharacterRange</i> dari perpustakaan <i>System.Drawing.Common</i> dan paket NuGet dengan nama yang sama. <br><br>  Kami akan menggunakan kode ini: <br><br><pre> <code class="cpp hljs">CharacterRange range = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CharacterRange(); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> eq = range.Equals(null); Console.WriteLine(eq);</code> </pre> <br>  Untuk berjaga-jaga, untuk sekadar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>menguras</u></a> ingatan kita, kita akan membahas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>docs.microsoft.com</u></a> untuk mengingat kembali nilai yang diharapkan dari ekspresi objek. <i>Sama dengan (nol)</i> : <br><br>  <i>Pernyataan berikut harus benar untuk semua implementasi metode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><i>Persamaan (Objek)</i></u></a> .</i>  <i>Dalam daftar, x, y, dan z mewakili referensi objek yang bukan nol.</i> <br><br>  <i>....</i> <br><br>  <b><i>x.Equals (null) mengembalikan false.</i></b> <br><br>  Apakah menurut Anda teks "Salah" akan ditampilkan di konsol?  Tentu saja tidak.  Itu akan terlalu mudah.  :) Oleh karena itu, kami mengeksekusi kode dan melihat hasilnya. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e87/159/8f6/e871598f6ca5dacdb4a4fae7b5776520.png" alt="Gambar 5"></div><br>  Itu adalah output dari kode di atas menggunakan paket NuGet <i>System.Drawing.Common</i> versi 4.5.1.  Langkah selanjutnya adalah menjalankan kode yang sama dengan versi pustaka debugging.  Inilah yang kami lihat: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e9/f27/f1a/6e9f27f1a78768078fdd940e0a4be0ad.png" alt="Gambar 6"></div><br>  Sekarang mari kita lihat kode sumber, khususnya, penerapan metode <i>Persamaan</i> dalam struktur <i>CharacterRange</i> dan peringatan penganalisa: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj.GetType() != typeof(CharacterRange)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; CharacterRange cr = (CharacterRange)obj; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((_first == cr.First) &amp;&amp; (_length == cr.Length)); }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3115</u></a> Melewati <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>metode</u></a> 'null' ke 'Equals' tidak boleh menghasilkan 'NullReferenceException'.  CharacterRange.cs 56 <br><br>  Kita dapat mengamati, apa yang harus dibuktikan - parameter <i>obj</i> tidak ditangani dengan benar.  Karena ini, pengecualian <i>NullReferenceException</i> terjadi dalam ekspresi bersyarat saat memanggil metode instance <i>GetType.</i> <br><br>  <b>Edisi 5</b> <br><br>  Saat kami menjelajahi pustaka ini, mari kita pertimbangkan bagian lain yang menarik - metode <i>Ikon</i> <i>.</i> <i>Simpan</i> <i>.</i>  Sebelum penelitian, mari kita lihat deskripsi metode. <br><br>  Tidak ada deskripsi metode ini: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffd/fef/402/ffdfef402f77c462c94b9ff284f42e0c.png" alt="Gambar 7"></div><br>  Mari kita membahas docs.microsoft.com - " <u>Icon.Save (Stream) Method</u> ".  Namun, tidak ada batasan pada input atau informasi tentang pengecualian yang dihasilkan. <br><br>  Sekarang mari kita beralih ke inspeksi kode. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> sealed partial <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Icon</span></span></span><span class="hljs-class"> :</span></span> MarshalByRefObject, ICloneable, IDisposable, ISerializable { .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Stream outputStream)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_iconData != null) { outputStream.Write(_iconData, <span class="hljs-number"><span class="hljs-number">0</span></span>, _iconData.Length); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputStream == null) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"dataStream"</span></span>); .... } } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3095 Objek</u></a> 'outputStream' digunakan sebelum diverifikasi terhadap nol.  Periksa baris: 654, 672. Icon.Windows.cs 654 <br><br>  Sekali lagi, ini adalah cerita yang sudah kita ketahui - kemungkinan referensi referensi nol, karena parameter metode ini direferensikan tanpa memeriksa <i>nol</i> .  Sekali lagi, suatu kebetulan keadaan yang berhasil - baik kelas dan metodenya bersifat publik, sehingga kami dapat mencoba mereproduksi masalahnya. <br><br>  Tugas kami sederhana - untuk membawa eksekusi kode ke ekspresi <i>outputStream.Write (_iconData, 0, _iconData.Length);</i>  dan pada saat yang sama menyimpan nilai variabel <i>outputStream</i> - <i>null</i> .  Memenuhi persyaratan <i>_iconData! = Null</i> sudah cukup untuk ini. <br><br>  Mari kita lihat konstruktor publik paling sederhana: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Icon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fileName, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br>  Itu hanya mendelegasikan pekerjaan ke konstruktor lain. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Icon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (FileStream f = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(fileName, FileMode.Open, FileAccess.Read, FileShare.Read)) { Debug.Assert(f != null, <span class="hljs-string"><span class="hljs-string">"File.OpenRead returned null instead of throwing an exception"</span></span>); _iconData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)f.Length]; f.Read(_iconData, <span class="hljs-number"><span class="hljs-number">0</span></span>, _iconData.Length); } Initialize(width, height); }</code> </pre> <br>  Itu dia, itu yang kita butuhkan.  Setelah memanggil konstruktor ini, jika kami berhasil membaca data dari file dan tidak ada crash dalam metode <i>Initialize</i> , bidang <i>_iconData</i> akan berisi referensi ke objek, ini yang kami butuhkan. <br><br>  Ternyata kita harus membuat turunan dari kelas <i>Ikon</i> dan menentukan file ikon yang sebenarnya untuk mereproduksi masalah.  Setelah ini kita perlu memanggil metode <i>Simpan</i> , setelah melewati nilai <i>nol</i> sebagai argumen, itulah yang kami lakukan.  Kode mungkin terlihat seperti ini, misalnya: <br><br><pre> <code class="cpp hljs">Icon icon = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Icon(@<span class="hljs-string"><span class="hljs-string">"D:\document.ico"</span></span>); icon.Save(null);</code> </pre> <br>  Hasil eksekusi diharapkan. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b37/fdb/dd1/b37fdbdd1288c054fdaaa0add0ffcfcf.png" alt="Gambar 8"></div><br>  <b>Edisi 6</b> <br><br>  Kami melanjutkan ulasan dan melanjutkan.  Cobalah untuk menemukan 3 perbedaan antara tindakan, dieksekusi dalam <i>case CimType.UInt32</i> dan <i>case</i> lainnya. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertToNumericValueAndAddToArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> retFunctionName = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Empty; enumType = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(cimType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CimType.UInt8: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CimType.SInt8: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CimType.SInt16: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CimType.UInt16: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CimType.SInt32: arrayToAdd.Add(System.Convert.ToInt32( numericValue, (IFormatProvider)CultureInfo.InvariantCulture .GetFormat(typeof(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)))); retFunctionName = <span class="hljs-string"><span class="hljs-string">"ToInt32"</span></span>; enumType = <span class="hljs-string"><span class="hljs-string">"System.Int32"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CimType.UInt32: arrayToAdd.Add(System.Convert.ToInt32( numericValue, (IFormatProvider)CultureInfo.InvariantCulture .GetFormat(typeof(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)))); retFunctionName = <span class="hljs-string"><span class="hljs-string">"ToInt32"</span></span>; enumType = <span class="hljs-string"><span class="hljs-string">"System.Int32"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> retFunctionName; }</code> </pre> <br>  Tentu saja, tidak ada perbedaan, karena penganalisa memperingatkan kita tentang hal itu. <br><br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3139</u></a> Dua atau lebih cabang kasus melakukan tindakan yang sama.  WMIGenerator.cs 5220 <br><br>  Secara pribadi, gaya kode ini tidak begitu jelas.  Jika tidak ada kesalahan, saya pikir, logika yang sama seharusnya tidak diterapkan pada kasus yang berbeda. <br><br>  <b>Edisi 7</b> <br><br>  Perpustakaan <i>Microsoft.CSharp</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IList&lt;KeyValuePair&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, object&gt;&gt; QueryDynamicObject(object obj) { .... List&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; names = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(mo.GetDynamicMemberNames()); names.Sort(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (names != null) { .... } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3022</u></a> Ekspresi 'nama! = Null' selalu benar.  DynamicDebuggerProxy.cs 426 <br><br>  Saya mungkin bisa mengabaikan peringatan ini bersama dengan banyak peringatan serupa yang dikeluarkan oleh diagnostik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3022</u></a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3063</u></a> .  Ada banyak (banyak) cek aneh, tetapi yang ini entah bagaimana masuk ke dalam jiwaku.  Mungkin, alasannya terletak pada apa yang terjadi sebelum membandingkan variabel <i>nama</i> lokal dengan <i>nol.</i>  Referensi tidak hanya disimpan dalam variabel <i>nama</i> untuk objek yang baru dibuat, tetapi metode <i>Urutkan</i> contoh juga disebut.  Tentu, ini bukan kesalahan tetapi, bagi saya, patut diperhatikan. <br><br>  <b>Edisi 8</b> <br><br>  Sepotong kode menarik lainnya: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InsertChildNoGrow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Symbol child)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (sym?.nextSameName != null) { sym = sym.nextSameName; } Debug.Assert(sym != null &amp;&amp; sym.nextSameName == null); sym.nextSameName = child; .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3042</u></a> Kemungkinan NullReferenceException.  '?.'  dan '.'  operator digunakan untuk mengakses anggota objek 'sym' SymbolStore.cs 56 <br><br>  Lihat apa masalahnya.  Loop berakhir setelah kepatuhan setidaknya satu dari dua kondisi: <br><br><ul><li>  <i>sym == null</i> ; </li><li>  <i>sym.nextSameName == null</i> . </li></ul><br>  Tidak ada masalah dengan kondisi kedua, yang tidak dapat dikatakan tentang kondisi pertama.  Karena bidang instance <i>names</i> diakses tanpa syarat di bawah ini dan jika <i>sym</i> - <i>null</i> , pengecualian dari tipe <i>NullReferenceException</i> akan muncul. <br><br>  Apakah kamu buta?  Ada panggilan <i>Debug.Assert</i> , di mana ia memeriksa <i>sym itu! = Null</i> ‚Äù- seseorang mungkin berdebat.  Justru sebaliknya, itu intinya!  Saat bekerja dalam versi Rilis, <i>Debug.Assert</i> tidak akan membantu apa pun dan dengan kondisi di atas, semua yang akan kita dapatkan adalah <i>NullReferenceException</i> .  Selain itu, saya sudah melihat kesalahan serupa di proyek lain dari Microsoft - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>Roslyn</u></a> , di mana situasi serupa dengan <i>Debug.Assert</i> terjadi.  Biarkan aku menyingkir sejenak untuk Roslyn. <br><br>  Masalahnya dapat direproduksi baik ketika menggunakan perpustakaan <i>Microsoft.CodeAnalysis</i> , atau tepat di Visual Studio saat menggunakan Syntax Visualizer.  Di Visual Studio 16.1.6 + Sintaks Visualizer 1.0 masalah ini masih dapat direproduksi. <br><br>  Kode ini cukup untuknya: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C1</span></span></span><span class="hljs-class">&lt;T1, T2&gt; {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ T1 val = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (val is null) { } } }</code> </pre> <br>  Lebih lanjut, dalam Sintaks Visualizer kita perlu menemukan simpul pohon sintaks tipe <i>ConstantPatternSyntax</i> , yang sesuai dengan <i>nol</i> dalam kode dan meminta <i>TypeSymbol</i> untuk itu. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/855/b9c/baa/855b9cbaa67c9a5909117d513e154293.png" alt="Gambar 9"></div><br>  Setelah itu, Visual Studio akan restart.  Jika kita pergi ke Event Viewer, kita akan menemukan beberapa informasi tentang masalah di perpustakaan: <br><br><pre> <code class="cpp hljs">Application: devenv.exe Framework Version: v4<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.30319</span></span> Description: The process was terminated due to an unhandled exception. Exception Info: System.Resources.MissingManifestResourceException at System.Resources.ManifestBasedResourceGroveler .HandleResourceStreamMissing(System.String) at System.Resources.ManifestBasedResourceGroveler.GrovelForResourceSet( System.Globalization.CultureInfo, System.Collections.Generic.Dictionary<span class="hljs-string"><span class="hljs-string">'2 &lt;System.String,System.Resources.ResourceSet&gt;, Boolean, Boolean, System.Threading.StackCrawlMark ByRef) at System.Resources.ResourceManager.InternalGetResourceSet( System.Globalization.CultureInfo, Boolean, Boolean, System.Threading.StackCrawlMark ByRef) at System.Resources.ResourceManager.InternalGetResourceSet( System.Globalization.CultureInfo, Boolean, Boolean) at System.Resources.ResourceManager.GetString(System.String, System.Globalization.CultureInfo) at Roslyn.SyntaxVisualizer.DgmlHelper.My. Resources.Resources.get_SyntaxNodeLabel() ....</span></span></code> </pre> <br>  Adapun masalah dengan devenv.exe: <br><br><pre> <code class="cpp hljs">Faulting application name: devenv.exe, version: <span class="hljs-number"><span class="hljs-number">16.1</span></span><span class="hljs-number"><span class="hljs-number">.29102</span></span><span class="hljs-number"><span class="hljs-number">.190</span></span>, time stamp: <span class="hljs-number"><span class="hljs-number">0x5d1c133b</span></span> Faulting <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> name: KERNELBASE.dll, version: <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.18362</span></span><span class="hljs-number"><span class="hljs-number">.145</span></span>, time stamp: <span class="hljs-number"><span class="hljs-number">0xf5733ace</span></span> Exception code: <span class="hljs-number"><span class="hljs-number">0xe0434352</span></span> Fault offset: <span class="hljs-number"><span class="hljs-number">0x001133d2</span></span> ....</code> </pre> <br>  Dengan versi debug perpustakaan Roslyn, Anda dapat menemukan tempat di mana ada pengecualian: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Conversion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClassifyImplicitBuiltInConversionSlow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( TypeSymbol source, TypeSymbol destination, ref HashSet&lt;DiagnosticInfo&gt; useSiteDiagnostics)</span></span></span><span class="hljs-function"> </span></span>{ Debug.Assert((object)source != null); Debug.Assert((object)destination != null); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( source.SpecialType == SpecialType.System_Void || destination.SpecialType == SpecialType.System_Void) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Conversion.NoConversion; } .... }</code> </pre> <br>  Di sini, sama seperti dalam kode dari .NET Core libraries yang dipertimbangkan di atas, ada pemeriksaan <i>Debug.Assert</i> yang tidak akan membantu ketika menggunakan versi rilis libraries. <br><br>  <b>Edisi 9</b> <br><br>  Kami punya sedikit titik di sini, jadi mari kita kembali ke perpustakaan .NET Core.  Paket <i>System.IO.IsolatedStorage</i> berisi kode menarik berikut. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ContainsUnknownFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> directory)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (files.Length &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> || ( (!IsIdFile(files[<span class="hljs-number"><span class="hljs-number">0</span></span>]) &amp;&amp; !IsInfoFile(files[<span class="hljs-number"><span class="hljs-number">0</span></span>]))) || (files.Length == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; !IsIdFile(files[<span class="hljs-number"><span class="hljs-number">1</span></span>]) &amp;&amp; !IsInfoFile(files[<span class="hljs-number"><span class="hljs-number">1</span></span>])) ); }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3088</u></a> Ekspresi tertutup oleh tanda kurung dua kali: ((ekspresi)).  Sepasang tanda kurung tidak perlu atau salah cetak ada.  IsolatedStorageFile.cs 839 <br><br>  Mengatakan bahwa pemformatan kode membingungkan adalah cara lain untuk tidak mengatakan apa pun.  Setelah melihat sekilas kode ini, saya akan mengatakan bahwa operan kiri yang pertama | |  Operator yang saya temui adalah <i>file. Panjang&gt; 2</i> , yang benar adalah yang ada dalam tanda kurung.  Setidaknya kodenya diformat seperti ini.  Setelah melihat sedikit lebih hati-hati, Anda bisa mengerti bahwa bukan itu masalahnya.  Bahkan, operan yang tepat - <i>((! IsIdFile (file [0]) &amp;&amp;! IsInfoFile (file [0]))))</i> .  Saya pikir kode ini cukup membingungkan. <br><br>  <b>Edisi 10</b> <br><br>  PVS-Studio 7.03 memperkenalkan aturan diagnostik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3138</u></a> , yang mencari kesalahan dalam string interpolasi.  Lebih tepatnya, dalam string yang kemungkinan besar harus diinterpolasi, tetapi karena simbol <i>$ yang</i> terlewat, mereka tidak <i>.</i>  Di perpustakaan <i>System.Net</i> saya menemukan beberapa kejadian menarik dari aturan diagnostik ini. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CacheCredential</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SafeFreeCredentials newHandle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ExceptionCheck.IsFatal(e)) { NetEventSource.Fail(null, <span class="hljs-string"><span class="hljs-string">"Attempted to throw: {e}"</span></span>); } } }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3138</u></a> String literal berisi ekspresi potensial yang diinterpolasi.  Pertimbangkan untuk memeriksa: e.  SSPIHandleCache.cs 42 <br><br>  Sangat mungkin, bahwa argumen kedua dari metode <i>Fail</i> harus berupa string yang diinterpolasi, di mana representasi string dari pengecualian <i>e</i> akan diganti.  Namun, karena simbol <i>$ yang</i> terlewat, tidak ada representasi string yang diganti. <br><br>  <b>Edisi 11</b> <br><br>  Ini kasus serupa lainnya. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> async Task&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; GetDigestTokenForCredential(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NetEventSource.IsEnabled) NetEventSource.Error(digestResponse, <span class="hljs-string"><span class="hljs-string">"Algorithm not supported: {algorithm}"</span></span>); .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3138</u></a> String literal berisi ekspresi potensial yang diinterpolasi.  Pertimbangkan untuk memeriksa: algoritma.  AuthenticationHelper.Digest.cs 58 <br><br>  Situasinya mirip dengan yang di atas, sekali lagi simbol <i>$</i> terjawab, menghasilkan string yang salah, masuk ke metode <i>Kesalahan</i> <i>.</i> <br><br>  <b>Edisi 12</b> <br><br>  Paket <i>System.Net.Mail</i> .  Metode ini kecil, saya akan mengutipnya secara keseluruhan untuk membuat mencari bug lebih menarik. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Stream stream)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stream == null) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(stream)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_streamSet) { _stream.Close(); _stream = null; _streamSet = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } _stream = stream; _streamSet = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; _streamUsedOnce = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; TransferEncoding = TransferEncoding.Base64; }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3008 Variabel</u></a> '_streamSet' diberi nilai dua kali berturut-turut.  Mungkin ini sebuah kesalahan.  Periksa baris: 123, 119. MimePart.cs 123 <br><br>  Penugasan nilai ganda ke variabel <i>_streamSet</i> terlihat aneh (pertama - di bawah kondisi, kemudian - di luar).  Kisah yang sama dengan mengatur ulang variabel <i>aliran</i> .  Akibatnya, <i>_stream</i> akan tetap memiliki value <i>stream</i> , dan <i>_streamSet</i> akan menjadi <i>true.</i> <br><br>  <b>Masalah 13</b> <br><br>  Fragmen kode yang menarik dari pustaka <i>System.Linq.Expressions</i> yang memicu 2 peringatan penganalisa sekaligus.  Dalam hal ini, lebih seperti fitur, daripada bug.  Namun, metode ini sangat tidak biasa ... <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// throws NRE when o is null protected static void NullCheck(object o) { if (o == null) { o.GetType(); } }</span></span></code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3010</u></a> Nilai balik fungsi 'GetType' harus digunakan.  Instruction.cs 36 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3080</u></a> Kemungkinan null dereference.  Pertimbangkan untuk memeriksa 'o'.  Instruction.cs 36 </li></ul><br>  Mungkin tidak ada komentar di sini. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c9/a88/a22/5c9a88a221d4cd5ba5f4f1d9f74a346b.png" alt="Gambar 20"></div><br>  <b>Edisi 14</b> <br><br>  Mari kita pertimbangkan kasus lain, yang akan kita tangani "dari luar".  Pertama, kita akan menulis kode, mendeteksi masalah, dan kemudian kita akan melihat ke dalam.  Kami akan mengambil pustaka <i>System.Configuration.ConfigurationManager</i> dan paket NuGet dengan nama yang sama untuk ditinjau.  Saya menggunakan paket versi 4.5.0.  Kami akan berurusan dengan kelas <i>System.Configuration.CommaDelimitedStringCollection</i> . <br><br>  Mari kita lakukan sesuatu yang tidak canggih.  Misalnya, kita akan membuat objek, mengekstrak representasi stringnya dan mendapatkan panjang string ini, lalu mencetaknya.  Kode yang relevan: <br><br><pre> <code class="cpp hljs">CommaDelimitedStringCollection collection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommaDelimitedStringCollection(); Console.WriteLine(collection.ToString().Length);</code> </pre> <br>  Untuk berjaga-jaga, kami akan memeriksa deskripsi metode <i>ToString</i> : <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8dc/544/56d/8dc54456dd1296d89fbe447fac71ac17.png" alt="Gambar 11"></div><br>  Tidak ada yang istimewa - representasi string dari suatu objek dikembalikan.  Untuk berjaga-jaga, saya akan memeriksa docs.microsoft.com - " <u>CommaDelimitedStringCollection.ToString Method</u> ".  Sepertinya tidak ada yang istimewa di sini. <br><br>  Oke, mari kita jalankan kodenya, aaand ... <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa5/89f/1af/fa589f1afc8ceb9415694e1261e59ab7.png" alt="Gambar 12"></div><br>  Hmm, kejutan.  Baiklah, mari kita coba menambahkan item ke koleksi dan kemudian mendapatkan representasi string-nya.  Selanjutnya, kita akan "benar-benar tidak sengaja" menambahkan string kosong :).  Kode akan berubah dan terlihat seperti ini: <br><br><pre> <code class="cpp hljs">CommaDelimitedStringCollection collection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommaDelimitedStringCollection(); collection.Add(String.Empty); Console.WriteLine(collection.ToString().Length);</code> </pre> <br>  Jalankan dan lihat ... <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d37/4bc/d2e/d374bcd2ed23bd048276493ed19d30fe.png" alt="Gambar 13"></div><br>  Apa lagi?  Baiklah, mari kita akhirnya membahas implementasi metode <i>ToString</i> dari kelas <i>CommaDelimitedStringCollection</i> .  Kode di bawah ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Count &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); foreach (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> str in <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { ThrowIfContainsDelimiter(str); <span class="hljs-comment"><span class="hljs-comment">// .... sb.Append(str.Trim()); sb.Append(','); } if (sb.Length &gt; 0) sb.Length = sb.Length - 1; return sb.Length == 0 ? null : sb.ToString(); }</span></span></code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3108</u></a> Tidak disarankan untuk mengembalikan 'null' dari metode 'ToSting ()'.  StringAttributeCollection.cs 57 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3108</u></a> Tidak disarankan untuk mengembalikan 'null' dari metode 'ToSting ()'.  StringAttributeCollection.cs 71 </li></ul><br>  Di sini kita dapat melihat 2 fragmen, di mana implementasi <i>ToString</i> saat ini dapat mengembalikan <i>nol.</i>  Pada titik ini, kita akan mengingat rekomendasi oleh Microsoft tentang implementasi metode <i>ToString</i> .  Jadi mari kita lihat docs.microsoft.com - " <u>Metode Object.ToString</u> ": <br><br>  <i>Notes to Inheritors .... Overrides dari metode ToString () harus mengikuti panduan ini:</i> <br><br><ul><li>  <i>....</i> </li><li>  <i>Penggantian ToString () Anda tidak boleh mengembalikan</i> <i>string</i> <i>Kosong atau</i> <b><i>null</i></b> <i>.</i> </li><li>  <i>....</i> </li></ul><br>  Inilah yang diperingatkan PVS-Studio.  Dua fragmen kode yang diberikan di atas yang kami tulis untuk mereproduksi masalah mendapatkan titik keluar yang berbeda - masing-masing poin pengembalian <i>nol</i> pertama dan kedua.  Mari menggali lebih dalam. <br><br>  Kasus pertama.  <i>Count</i> adalah properti dari kelas <i>StringCollection</i> dasar.  Karena tidak ada elemen yang ditambahkan, <i>Hitung == 0</i> , kondisi <i>Hitung &lt;= 0</i> benar, nilai <i>nol</i> dikembalikan. <br><br>  Dalam kasus kedua kami menambahkan elemen, menggunakan metode instance <i>CommaDelimitedStringCollection.Add</i> untuk itu. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">new</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ ThrowIfReadOnly(); ThrowIfContainsDelimiter(value); _modified = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; base.Add(value.Trim()); }</code> </pre> <br>  Cek berhasil dalam metode <i>ThrowIf ...</i> dan elemen ditambahkan dalam koleksi dasar.  Dengan demikian, nilai <i>Hitung</i> menjadi 1. Sekarang mari kita kembali ke metode <i>ToString</i> .  Nilai ekspresi <i>Count &lt;= 0</i> - <i>false</i> , oleh karena itu metode tidak kembali dan eksekusi kode berlanjut.  Koleksi internal akan dilintasi, 2 elemen ditambahkan ke instance dari tipe <i>StringBuilder</i> - string kosong dan koma.  Akibatnya, ternyata bahwa <i>sb</i> hanya mengandung koma, nilai properti <i>Panjang</i> masing-masing sama dengan 1. Nilai dari ekspresi <i>sb. Panjang&gt; 0</i> <i>benar</i> , kurangi dan tuliskan dalam <i>sb. Panjang</i> dilakukan, sekarang nilainya dari <i>sb.Length</i> adalah 0. Ini mengarah pada fakta bahwa nilai <i>nol</i> dikembalikan lagi dari metode. <br><br>  <b>Edisi 15</b> <br><br>  Tiba-tiba, saya punya keinginan untuk menggunakan <i>System.Configuration.ConfigurationProperty</i> kelas.  Mari kita mengambil konstruktor dengan jumlah parameter terbesar: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigurationProperty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, Type type, object defaultValue, TypeConverter typeConverter, ConfigurationValidatorBase validator, ConfigurationPropertyOptions options, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> description)</span></span></span></span>;</code> </pre> <br>  Mari kita lihat deskripsi parameter terakhir: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// description: // The description of the configuration entity.</span></span></code> </pre> <br>  Hal yang sama ditulis dalam deskripsi konstruktor di docs.microsoft.com.  Baiklah, mari kita lihat bagaimana parameter ini digunakan dalam tubuh konstruktor: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigurationProperty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> description)</span></span></span><span class="hljs-function"> </span></span>{ ConstructorInit(name, type, options, validator, typeConverter); SetDefaultValue(defaultValue); }</code> </pre> <br>  Percaya atau tidak, parameter tidak digunakan. <br><br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3117</u></a> 'Deskripsi' parameter konstruktor tidak digunakan.  ConfigurationProperty.cs 62 <br><br>  Mungkin, pembuat kode sengaja tidak menggunakannya, tetapi deskripsi parameter yang relevan sangat membingungkan. <br><br>  <b>Edisi 16</b> <br><br>  Berikut ini adalah bagian yang serupa: coba cari kesalahan sendiri, saya berikan kode konstruktor di bawah ini. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SectionXmlInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> configKey, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> definitionConfigPath, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> targetConfigPath, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> subPath, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lineNumber, object streamVersion, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rawXml, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> configSource, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> configSourceStreamName, object configSourceStreamVersion, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> protectionProviderName, OverrideModeSetting overrideMode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> skipInChildApps)</span></span></span><span class="hljs-function"> </span></span>{ ConfigKey = configKey; DefinitionConfigPath = definitionConfigPath; TargetConfigPath = targetConfigPath; SubPath = subPath; Filename = filename; LineNumber = lineNumber; StreamVersion = streamVersion; RawXml = rawXml; ConfigSource = configSource; ConfigSourceStreamName = configSourceStreamName; ProtectionProviderName = protectionProviderName; OverrideModeSetting = overrideMode; SkipInChildApps = skipInChildApps; }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>Parameter</u></a> konstruktor V3117 'configSourceStreamVersion' tidak digunakan.  SectionXmlInfo.cs 16 <br><br>  Ada properti yang sesuai, tetapi terus terang, ini terlihat agak aneh: <br><br><pre> <code class="cpp hljs">internal object ConfigSourceStreamVersion { <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { } }</code> </pre> <br>  Secara umum, kode tersebut terlihat mencurigakan.  Mungkin parameter / properti dibiarkan untuk kompatibilitas, tapi itu hanya dugaan saya. <br><br>  <b>Edisi 17</b> <br><br>  Mari kita lihat hal-hal menarik di perpustakaan <i>System.Runtime.WindowsRuntime.UI.Xaml</i> dan kode paket dengan nama yang sama. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepeatBehavior</span></span></span><span class="hljs-class"> :</span></span> IFormattable { .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InternalToString(null, null); } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3108</u></a> Tidak disarankan untuk mengembalikan 'null' dari metode 'ToSting ()'.  RepeatBehavior.cs 113 <br><br>  Cerita yang sudah kita kenal - metode <i>ToString</i> dapat mengembalikan nilai <i>nol</i> .  Karena hal ini, penulis kode pemanggil, yang mengasumsikan bahwa <i>RepeatBehavior.ToString</i> selalu mengembalikan referensi yang tidak nol, mungkin akan terkejut pada beberapa titik.  Sekali lagi, itu bertentangan dengan pedoman Microsoft. <br><br>  Baiklah, tetapi metode ini tidak menjelaskan bahwa <i>ToString</i> dapat mengembalikan <i>nol</i> - kita harus masuk lebih dalam dan mengintip ke dalam metode <i>InternalToString</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InternalToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> format, IFormatProvider formatProvider)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (_Type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RepeatBehaviorType.Forever: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Forever"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RepeatBehaviorType.Count: StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.AppendFormat( formatProvider, <span class="hljs-string"><span class="hljs-string">"{0:"</span></span> + format + <span class="hljs-string"><span class="hljs-string">"}x"</span></span>, _Count); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RepeatBehaviorType.Duration: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _Duration.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } }</code> </pre> <br>  Analiser telah mendeteksi bahwa jika cabang <i>default</i> dijalankan dalam <i>switch</i> , <i>InternalToString</i> akan mengembalikan nilai <i>nol</i> .  Oleh karena itu, <i>ToString</i> akan mengembalikan <i>nol</i> juga. <br><br>  <i>RepeatBehavior</i> adalah struktur publik, dan <i>ToString</i> adalah metode publik, jadi kami dapat mencoba mereproduksi masalah dalam praktik.  Untuk melakukannya, kita akan membuat instance <i>RepeatBehavior</i> , panggil metode <i>ToString</i> darinya dan sambil melakukan itu kita tidak boleh ketinggalan bahwa <i>_Type</i> tidak boleh sama dengan <i>RepeatBehaviorType.Forever</i> , <i>RepeatBehaviorType.Count</i> atau <i>RepeatBehaviorType.Duration</i> . <br><br>  <i>_Type</i> adalah bidang pribadi, yang dapat ditugaskan melalui properti publik: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepeatBehavior</span></span></span><span class="hljs-class"> :</span></span> IFormattable { .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RepeatBehaviorType _Type; .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RepeatBehaviorType Type { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _Type; } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { _Type = value; } } .... }</code> </pre> <br>  Sejauh ini, sangat bagus.  Mari kita lanjutkan dan lihat apa jenis <i>RepeatBehaviorType</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> RepeatBehaviorType { Count, Duration, Forever }</code> </pre> <br>  Seperti yang bisa kita lihat, <i>RepeatBehaviorType</i> adalah enumerasi, yang mengandung ketiga elemen.  Bersamaan dengan ini, ketiga elemen ini tercakup dalam ekspresi <i>switch yang</i> kami minati.  Namun, ini tidak berarti bahwa cabang default tidak dapat dijangkau. <br><br>  Untuk mereproduksi masalah kita akan menambahkan referensi ke paket <i>System.Runtime.WindowsRuntime.UI.Xaml</i> ke proyek (saya menggunakan versi 4.3.0) dan menjalankan kode berikut. <br><br><pre> <code class="cpp hljs">RepeatBehavior behavior = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RepeatBehavior() { Type = (RepeatBehaviorType)<span class="hljs-number"><span class="hljs-number">666</span></span> }; Console.WriteLine(behavior.ToString() is null);</code> </pre> <br>  <i>True</i> ditampilkan di konsol seperti yang diharapkan, yang berarti <i>ToString</i> mengembalikan <i>nol</i> , karena <i>_Type</i> tidak sama dengan nilai apa pun dalam cabang <i>kasus</i> , dan cabang <i>default</i> menerima kontrol.  Itulah yang kami coba lakukan. <br><br>  Saya juga ingin mencatat bahwa tidak ada komentar untuk metode ini, atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>docs.microsoft.com</u></a> menentukan bahwa metode tersebut dapat mengembalikan nilai <i>nol</i> . <br><br>  <b>Edisi 18</b> <br><br>  Selanjutnya, kita akan memeriksa beberapa peringatan dari <i>System.Private.DataContractSerialization</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CharType</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte None = <span class="hljs-number"><span class="hljs-number">0x00</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte FirstName = <span class="hljs-number"><span class="hljs-number">0x01</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte Name = <span class="hljs-number"><span class="hljs-number">0x02</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte Whitespace = <span class="hljs-number"><span class="hljs-number">0x04</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte Text = <span class="hljs-number"><span class="hljs-number">0x08</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte AttributeText = <span class="hljs-number"><span class="hljs-number">0x10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte SpecialWhitespace = <span class="hljs-number"><span class="hljs-number">0x20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte Comment = <span class="hljs-number"><span class="hljs-number">0x40</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> byte[] s_charType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[<span class="hljs-number"><span class="hljs-number">256</span></span>] { .... CharType.None, <span class="hljs-comment"><span class="hljs-comment">/* 9 (.) */</span></span> CharType.None| CharType.Comment| CharType.Comment| CharType.Whitespace| CharType.Text| CharType.SpecialWhitespace, <span class="hljs-comment"><span class="hljs-comment">/* A (.) */</span></span> CharType.None| CharType.Comment| CharType.Comment| CharType.Whitespace| CharType.Text| CharType.SpecialWhitespace, <span class="hljs-comment"><span class="hljs-comment">/* B (.) */</span></span> CharType.None, <span class="hljs-comment"><span class="hljs-comment">/* C (.) */</span></span> CharType.None, <span class="hljs-comment"><span class="hljs-comment">/* D (.) */</span></span> CharType.None| CharType.Comment| CharType.Comment| CharType.Whitespace, <span class="hljs-comment"><span class="hljs-comment">/* E (.) */</span></span> CharType.None, .... };</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3001</u></a> Ada sub-ekspresi identik 'CharType.Comment' di sebelah kiri dan di kanan '|'  operator.  XmlUTF8TextReader.cs 56 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3001</u></a> Ada sub-ekspresi identik 'CharType.Comment' di sebelah kiri dan di kanan '|'  operator.  XmlUTF8TextReader.cs 58 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3001</u></a> Ada sub-ekspresi identik 'CharType.Comment' ke kiri dan ke kanan '|'  operator.  XmlUTF8TextReader.cs 64 </li></ul><br>  Penganalisa menemukan penggunaan ekspresi <i>CharType.Comment | CharType.Comment</i> mencurigakan.  Terlihat agak aneh, seperti <i>(CharType.Comment | CharType.Comment) == CharType.Comment</i> .  Saat menginisialisasi elemen array lain, yang menggunakan <i>CharType.Comment</i> , tidak ada duplikasi seperti itu. <br><br>  <b>Edisi 19</b> <br><br>  Mari kita lanjutkan.  Mari kita periksa informasi pada nilai <i>pengembalian</i> metode <i>XmlBinaryWriterSession.TryAdd</i> dalam deskripsi metode dan di docs.microsoft.com - " <u>XmlBinaryWriterSession.TryAdd (XmlDictionaryString, Int32) Metode</u> ": <i>Pengembalian: true jika string dapat ditambahkan;</i>  <i>jika tidak, salah.</i> <br><br>  Sekarang mari kita melihat isi dari metode ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XmlDictionaryString value, out </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key)</span></span></span><span class="hljs-function"> </span></span>{ IntArray keys; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value == null) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> System.Runtime .Serialization .DiagnosticUtility .ExceptionUtility .ThrowHelperArgumentNull(nameof(value)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_maps.TryGetValue(value.Dictionary, out keys)) { key = (keys[value.Key] - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (key != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// If the key is already set, then something is wrong throw System.Runtime .Serialization .DiagnosticUtility .ExceptionUtility .ThrowHelperError( new InvalidOperationException( SR.XmlKeyAlreadyExists)); } key = Add(value.Value); keys[value.Key] = (key + 1); return true; } key = Add(value.Value); keys = AddKeys(value.Dictionary, value.Key + 1); keys[value.Key] = (key + 1); return true; }</span></span></code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3009</u></a> Aneh bahwa metode ini selalu mengembalikan satu dan nilai 'benar' yang sama.  XmlBinaryWriterSession.cs 29 <br><br>  Tampaknya aneh bahwa metode mengembalikan <i>true</i> atau melempar pengecualian, tetapi nilai <i>false</i> tidak pernah dikembalikan. <br><br>  <b>Edisi 20</b> <br><br>  Saya menemukan kode dengan masalah yang sama, tetapi dalam kasus ini, sebaliknya - metode selalu mengembalikan <i>false</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnHandleReference</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlWriter.depth &lt; depthToCheckCyclicReference) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (canContainCyclicReference) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_byValObjectsInScope.Contains(obj)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ....; _byValObjectsInScope.Push(obj); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3009</u></a> Aneh bahwa metode ini selalu mengembalikan satu dan nilai yang sama dari 'salah'.  XmlObjectSerializerWriteContext.cs 415 <br><br>  Yah, kita sudah datang jauh!  Jadi sebelum melanjutkan, saya sarankan Anda beristirahat sebentar: aduk otot, jalan-jalan, istirahatkan mata, lihat ke luar jendela ... <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/008/d6a/92d/008d6a92d6f4cf4066e744e4c857b47d.png" alt="Gambar 24"></div><br>  Saya harap pada titik ini Anda penuh energi lagi, jadi mari kita lanjutkan.  :) <br><br>  <b>Edisi 21</b> <br><br>  Mari kita tinjau beberapa fragmen yang menarik dari proyek <i>System.ecurity.Cryptography.Algorithms</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> override byte[] GenerateMask(byte[] rgbSeed, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cbReturn) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (HashAlgorithm hasher = (HashAlgorithm)CryptoConfig.CreateFromName(_hashNameValue)) { byte[] rgbCounter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[<span class="hljs-number"><span class="hljs-number">4</span></span>]; byte[] rgbT = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[cbReturn]; uint counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ib = <span class="hljs-number"><span class="hljs-number">0</span></span>; ib &lt; rgbT.Length;) { <span class="hljs-comment"><span class="hljs-comment">// Increment counter -- up to 2^32 * sizeof(Hash) Helpers.ConvertIntToByteArray(counter++, rgbCounter); hasher.TransformBlock(rgbSeed, 0, rgbSeed.Length, rgbSeed, 0); hasher.TransformFinalBlock(rgbCounter, 0, 4); byte[] hash = hasher.Hash; hasher.Initialize(); Buffer.BlockCopy(hash, 0, rgbT, ib, Math.Min(rgbT.Length - ib, hash.Length)); ib += hasher.Hash.Length; } return rgbT; } }</span></span></code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>V3080</u></a> Kemungkinan null dereference.  Pertimbangkan untuk memeriksa 'hasher'.  PKCS1MaskGenerationMethod.cs 37 <br><br>  Penganalisis memperingatkan bahwa nilai variabel <i>hasher</i> bisa menjadi <i>nol</i> ketika mengevaluasi <i>hasher.</i> Ekspresi <i>TransformBlock</i> menghasilkan pengecualian dari tipe <i>NullReferenceException</i> .  Kejadian peringatan ini menjadi mungkin karena analisis antar-prosedur. <br><br>  Jadi untuk mengetahui apakah <i>hasher</i> dapat mengambil nilai <i>nol</i> dalam kasus ini, kita perlu mencelupkan ke dalam metode <i>CreateFromName</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateFromName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CreateFromName(name, null); }</code> </pre> <br>  Sejauh ini tidak ada - mari kita masuk lebih dalam.  Badan versi <i>CreateFromName yang</i> kelebihan beban dengan dua parameter cukup besar, jadi saya mengutip versi pendeknya. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateFromName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, params object[] args)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (retvalType == null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cons == null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candidates.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rci == null || typeof(Delegate).IsAssignableFrom(rci.DeclaringType)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> retval; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti yang Anda lihat, ada beberapa titik keluar dalam metode di mana nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dikembalikan secara eksplisit. Oleh karena itu, setidaknya secara teoritis, dalam metode di atas, yang memicu peringatan, pengecualian </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mungkin terjadi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teori itu hebat, tetapi mari kita coba mereproduksi masalah dalam praktik. Untuk melakukan ini, kita akan melihat lagi pada metode asli dan perhatikan poin-poin utama. Kami juga akan mengurangi kode yang tidak relevan dari metode.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PKCS1MaskGenerationMethod</span></span></span><span class="hljs-class"> :</span></span> .... <span class="hljs-comment"><span class="hljs-comment">// &lt;= 1 { .... public PKCS1MaskGenerationMethod() // &lt;= 2 { _hashNameValue = DefaultHash; } .... public override byte[] GenerateMask(byte[] rgbSeed, int cbReturn) // &lt;= 3 { using (HashAlgorithm hasher = (HashAlgorithm)CryptoConfig.CreateFromName(_hashNameValue)) // &lt;= 4 { byte[] rgbCounter = new byte[4]; byte[] rgbT = new byte[cbReturn]; // &lt;= 5 uint counter = 0; for (int ib = 0; ib &lt; rgbT.Length;) // &lt;= 6 { .... Helpers.ConvertIntToByteArray(counter++, rgbCounter); // &lt;= 7 hasher.TransformBlock(rgbSeed, 0, rgbSeed.Length, rgbSeed, 0); .... } .... } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita lihat lebih dekat poin-poin utama: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1, 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kelas dan metode memiliki </font><font style="vertical-align: inherit;">pengubah akses </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publik</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Karenanya, antarmuka ini tersedia saat menambahkan referensi ke perpustakaan - kami dapat mencoba mereproduksi masalah ini. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kelas adalah contoh non-abstrak, memiliki konstruktor publik. Pasti mudah untuk membuat contoh, yang akan kami kerjakan. Dalam beberapa kasus, yang saya pertimbangkan, kelas adalah abstrak, jadi untuk mereproduksi masalah saya harus mencari pewaris dan cara untuk mendapatkannya. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFromName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak boleh menghasilkan pengecualian dan harus mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - poin paling penting, kami akan kembali lagi nanti. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5, 6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cbReturn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nilai harus&gt; 0 (tetapi, tentu saja, dalam batas yang memadai untuk pembuatan array yang berhasil). </font><font style="vertical-align: inherit;">Kesesuaian kondisi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cbReturn&gt; 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diperlukan untuk memenuhi kondisi selanjutnya </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ib &lt;rgbT. Panjang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan masuk ke loop body. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Helpres.ConvertIntToByteArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus berfungsi tanpa pengecualian. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk memenuhi kondisi yang bergantung pada parameter metode, cukup dengan memberikan argumen yang sesuai, misalnya:</font></font><br><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rgbCeed</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - byte baru [] {0, 1, 2, 3};</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cbReturn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 42.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk "mendiskreditkan" </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptoConfig.CreateFromName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kita harus dapat mengubah nilai </font><font style="vertical-align: inherit;">bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_hashNameValue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Untungnya, kami memilikinya, karena kelas mendefinisikan properti wrapper untuk bidang ini:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> HashName { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _hashNameValue; } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { _hashNameValue = value ?? DefaultHash; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan menetapkan nilai 'sintetis' untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HashName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (yaitu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_hashNameValue),</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kita bisa mendapatkan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFromName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di titik keluar pertama dari yang kita tandai. </font><font style="vertical-align: inherit;">Saya tidak akan masuk ke detail menganalisis metode ini (harap Anda akan memaafkan saya untuk ini), karena metode ini cukup besar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Akibatnya, kode yang akan menyebabkan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mungkin terlihat sebagai berikut:</font></font><br><br><pre> <code class="cpp hljs">PKCS1MaskGenerationMethod tempObj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PKCS1MaskGenerationMethod(); tempObj.HashName = <span class="hljs-string"><span class="hljs-string">"Dummy"</span></span>; tempObj.GenerateMask(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[] { <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span> }, <span class="hljs-number"><span class="hljs-number">42</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sekarang kita tambahkan referensi ke pustaka debugging, jalankan kodenya dan dapatkan hasil yang diharapkan: </font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ab/384/8e5/2ab3848e542172cd92a7e03f55bba9fe.png" alt="Gambar 10"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hanya untuk bersenang-senang, saya mencoba menjalankan kode yang sama menggunakan paket NuGet versi 4.3.1. </font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b4/a94/766/7b4a947666444496ca077e7530415c76.png" alt="Gambar 14"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak ada informasi tentang pengecualian yang dihasilkan, batasan parameter output dalam deskripsi metode. </font><font style="vertical-align: inherit;">Docs.microsoft.com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKCS1MaskGenerationMethod.GenerateMask (Byte [], Int32) Metode</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "tidak menentukannya juga. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ngomong-ngomong, tepat ketika menulis artikel dan menggambarkan urutan tindakan untuk mereproduksi masalah, saya menemukan 2 cara lain untuk "Hancurkan" metode ini:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berikan nilai yang terlalu besar sebagai </font><font style="vertical-align: inherit;">argumen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cbReturn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lulus nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebagai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rgbSeed.</font></font></i> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam kasus pertama, kita akan mendapatkan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OutOfMemoryException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c50/474/7f9/c504747f9a771843da10a128866811dd.png" alt="Gambar 15"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam kasus kedua, kita akan mendapatkan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saat mengeksekusi </font><font style="vertical-align: inherit;">ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rgbSeed.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dalam hal ini, penting, bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasher</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memiliki nilai bukan nol. </font><font style="vertical-align: inherit;">Kalau tidak, aliran kontrol tidak akan sampai ke </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rgbSeed.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 22</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya menemukan beberapa tempat yang serupa.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignatureDescription</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> FormatterAlgorithm { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> DeformatterAlgorithm { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SignatureDescription</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> AsymmetricSignatureDeformatter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDeformatter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( AsymmetricAlgorithm key)</span></span></span><span class="hljs-function"> </span></span>{ AsymmetricSignatureDeformatter item = (AsymmetricSignatureDeformatter) CryptoConfig.CreateFromName(DeformatterAlgorithm); item.SetKey(key); <span class="hljs-comment"><span class="hljs-comment">// &lt;= return item; } public virtual AsymmetricSignatureFormatter CreateFormatter( AsymmetricAlgorithm key) { AsymmetricSignatureFormatter item = (AsymmetricSignatureFormatter) CryptoConfig.CreateFromName(FormatterAlgorithm); item.SetKey(key); // &lt;= return item; } .... }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan null dereference. </font><font style="vertical-align: inherit;">Pertimbangkan untuk memeriksa 'item'. </font><font style="vertical-align: inherit;">SignatureDescription.cs 31</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan null dereference. </font><font style="vertical-align: inherit;">Pertimbangkan untuk memeriksa 'item'. </font><font style="vertical-align: inherit;">SignatureDescription.cs 38</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekali lagi, dalam </font><font style="vertical-align: inherit;">properti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FormatterAlgorithm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeformatterAlgorithm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kita dapat menulis nilai-nilai tersebut, dimana </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptoConfig.CreateFromName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateDeformatter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFormatter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Lebih lanjut, saat memanggil </font><font style="vertical-align: inherit;">metode instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">pengecualian </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan. Masalahnya, sekali lagi, mudah direproduksi dalam praktik:</font></font><br><br><pre> <code class="cpp hljs">SignatureDescription signature = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignatureDescription() { DeformatterAlgorithm = <span class="hljs-string"><span class="hljs-string">"Dummy"</span></span>, FormatterAlgorithm = <span class="hljs-string"><span class="hljs-string">"Dummy"</span></span> }; signature.CreateDeformatter(null); <span class="hljs-comment"><span class="hljs-comment">// NRE signature.CreateFormatter(null); // NRE</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam hal ini, saat memanggil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateDeformatter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> serta memanggil </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateFormatter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dilemparkan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 23</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita tinjau fragmen menarik dari </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Private.Xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteBase64</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte[] buffer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_inAttr &amp;&amp; (_inCDataSection || StartCDataSection())) _wrapped.WriteBase64(buffer, index, count); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> _wrapped.WriteBase64(buffer, index, count); }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pernyataan 'then' setara dengan pernyataan 'else'. </font><font style="vertical-align: inherit;">QueryOutputWriterV1.cs 242 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kelihatannya aneh bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemudian</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cabang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pernyataan berisi kode yang sama. </font><font style="vertical-align: inherit;">Entah ada kesalahan di sini dan tindakan lain harus dilakukan di salah satu cabang, atau </font><font style="vertical-align: inherit;">pernyataan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bisa dihilangkan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 24</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Depends</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XmlSchemaObject item, ArrayList refs)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (content is XmlSchemaSimpleTypeRestriction) { baseType = ((XmlSchemaSimpleTypeRestriction)content).BaseType; baseName = ((XmlSchemaSimpleTypeRestriction)content).BaseTypeName; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (content is XmlSchemaSimpleTypeList) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (content is XmlSchemaSimpleTypeRestriction) { baseName = ((XmlSchemaSimpleTypeRestriction)content).BaseTypeName; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t == typeof(XmlSchemaSimpleTypeUnion)) { .... } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3003</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Penggunaan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;">pola</font></u></a><font style="vertical-align: inherit;"> 'if (A) {...} else if (A) {...}' terdeteksi. </font><font style="vertical-align: inherit;">Ada kemungkinan kehadiran kesalahan logis. </font><font style="vertical-align: inherit;">Periksa baris: 381, 396. ImportContext.cs 381 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam urutan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if-else-if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ada dua ekspresi kondisional yang sama - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">konten adalah XmlSchemaSimpleTypeRestriction</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Terlebih lagi, badan </font><font style="vertical-align: inherit;">cabang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemudian</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari pernyataan masing-masing berisi serangkaian ekspresi yang berbeda. </font><font style="vertical-align: inherit;">Bagaimanapun, baik badan dari cabang pertama yang relevan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maka</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dieksekusi (jika ekspresi kondisional benar), atau tidak ada dari mereka dalam kasus jika ekspresi yang relevan salah. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 25</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Untuk membuatnya lebih menarik untuk mencari kesalahan pada metode selanjutnya, saya akan mengutip seluruh tubuh. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MatchesXmlType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IList&lt;XPathItem&gt; seq, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexType)</span></span></span><span class="hljs-function"> </span></span>{ XmlQueryType typBase = GetXmlType(indexType); XmlQueryCardinality card; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (seq.Count) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: card = XmlQueryCardinality.Zero; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: card = XmlQueryCardinality.One; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: card = XmlQueryCardinality.More; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(card &lt;= typBase.Cardinality)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; typBase = typBase.Prime; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; seq.Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!CreateXmlType(seq[<span class="hljs-number"><span class="hljs-number">0</span></span>]).IsSubtypeOf(typBase)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda sudah berhasil - selamat! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika tidak - PVS-Studio untuk penyelamatan: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3102</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Akses mencurigakan ke elemen objek 'seq' dengan indeks konstan di dalam sebuah loop. XmlQueryRuntime.cs 738 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> loop dieksekusi, ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i &lt;seq.Count</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah Digunakan sebagai dengan sebuah kondisi keluar. Ini menunjukkan gagasan bahwa pengembang ingin memotong </font><font style="vertical-align: inherit;">urutan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tetapi dalam loop, penulis mengakses elemen urutan bukan dengan menggunakan counter - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seq [i]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi sejumlah literal - nol ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seq [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 26</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kesalahan berikutnya cocok dengan sepotong kecil kode, tetapi tidak kalah menarik.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ WriteValue(value); }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3110</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan rekursi tak terbatas di dalam metode 'WriteValue'. XmlAttributeCache.cs 166 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode ini memanggil dirinya sendiri, membentuk rekursi tanpa kondisi keluar. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 27</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;XPathNavigator&gt; DocOrderDistinct(IList&lt;XPathNavigator&gt; seq) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (seq.Count &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> seq; XmlQueryNodeSequence nodeSeq = (XmlQueryNodeSequence)seq; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeSeq == null) nodeSeq = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlQueryNodeSequence(seq); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nodeSeq.DocOrderDistinct(_docOrderCmp); }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'seq' digunakan sebelum diverifikasi dengan null. Periksa baris: 880, 884. XmlQueryRuntime.cs 880 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode ini bisa mendapatkan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebagai argumen. Karena ini, ketika mengakses </font><font style="vertical-align: inherit;">properti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hitung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan. Di bawah variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodeSeq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diperiksa. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodeSeq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diperoleh sebagai hasil dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> casting </font><font style="vertical-align: inherit;">eksplisit </font><font style="vertical-align: inherit;">, masih belum jelas mengapa pemeriksaan dilakukan. Jika nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aliran kontrol tidak akan sampai ke pemeriksaan ini karena pengecualian. Jika nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lalu:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika casting gagal, pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidCastException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika casting berhasil, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nodeSeq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jelas bukan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 28</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya menemukan 4 konstruktor, berisi parameter yang tidak digunakan. </font><font style="vertical-align: inherit;">Mungkin, mereka dibiarkan untuk kompatibilitas, tetapi saya tidak menemukan komentar tambahan pada parameter yang tidak digunakan ini. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Constructor</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"> V3117</font></u></a><font style="vertical-align: inherit;"> 'securityUrl' tidak digunakan. </font><font style="vertical-align: inherit;">XmlSecureResolver.cs 15</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> konstruktor 'strdata' V3117 tidak digunakan. </font><font style="vertical-align: inherit;">XmlEntity.cs 18</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Lokasi' parameter konstruktor</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"> V3117</font></u></a><font style="vertical-align: inherit;"> tidak digunakan. </font><font style="vertical-align: inherit;">Compilation.cs 58</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Akses' parameter konstruktor</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"> V3117</font></u></a><font style="vertical-align: inherit;"> tidak digunakan. </font><font style="vertical-align: inherit;">XmlSerializationILGen.cs 38</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yang pertama paling menarik minat saya (setidaknya, itu masuk ke daftar peringatan untuk artikel). </font><font style="vertical-align: inherit;">Apa yang spesial? </font><font style="vertical-align: inherit;">Tidak yakin </font><font style="vertical-align: inherit;">Mungkin namanya.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">XmlSecureResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XmlResolver resolver, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> securityUrl)</span></span></span><span class="hljs-function"> </span></span>{ _resolver = resolver; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demi kepentingan, saya memeriksa apa yang ditulis di docs.microsoft.com - " </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XmlSecureResolver Constructors</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " tentang </font><font style="vertical-align: inherit;">parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">securityUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL yang digunakan untuk membuat PermissionSet yang akan diterapkan pada XmlResolver yang mendasarinya. XmlSecureResolver memanggil PermitOnly () pada PermissionSet yang dibuat sebelum memanggil GetEntity (Uri, String, Type) pada XmlResolver yang mendasarinya. </font></font></i> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 29</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dalam </font><font style="vertical-align: inherit;">paket </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Private.Uri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya menemukan metode, yang tidak mengikuti persis pedoman Microsoft pada </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menimpa. Di sini kita perlu mengingat salah satu tips dari halaman " </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object.ToString Method</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ":</font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Override ToString () Anda seharusnya tidak memberikan pengecualian</font></font></i></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode yang diganti sendiri terlihat seperti ini:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_username.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; _password.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UriFormatException(SR.net_uri_BadUserPassword); } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tidak disarankan untuk membuang pengecualian dari metode 'ToSting ()'. </font><font style="vertical-align: inherit;">UriBuilder.cs 406 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode pertama-tama menetapkan string kosong untuk </font><font style="vertical-align: inherit;">bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_username</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nonempty untuk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bidang </font><i><font style="vertical-align: inherit;">_password</font></i><font style="vertical-align: inherit;"> masing-masing melalui properti publik </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kata Sandi. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah itu memanggil </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Akhirnya kode ini akan mendapatkan pengecualian. </font><font style="vertical-align: inherit;">Contoh kode tersebut:</font></font><br><br><pre> <code class="cpp hljs">UriBuilder uriBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UriBuilder() { UserName = String.Empty, Password = <span class="hljs-string"><span class="hljs-string">"Dummy"</span></span> }; String stringRepresentation = uriBuilder.ToString(); Console.WriteLine(stringRepresentation);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapi dalam hal ini pengembang dengan jujur ‚Äã‚Äãmemperingatkan bahwa panggilan mungkin menghasilkan pengecualian. </font><font style="vertical-align: inherit;">Ini dijelaskan dalam komentar untuk metode ini dan di docs.microsoft.com - " </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UriBuilder.ToString Method</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 30</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lihatlah peringatan, yang dikeluarkan pada </font><font style="vertical-align: inherit;">kode proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Data.Common</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ArrayList _tables; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> DataTable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableName, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ns)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_tables.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (DataTable)_tables[<span class="hljs-number"><span class="hljs-number">0</span></span>]; .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan indeks sudah di luar batas. </font><font style="vertical-align: inherit;">Indeks '0' menunjuk di luar batas '_tables'. </font><font style="vertical-align: inherit;">XMLDiffLoader.cs 277 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah kode ini terlihat tidak biasa? </font><font style="vertical-align: inherit;">Anda pikir apa itu? </font><font style="vertical-align: inherit;">Cara yang tidak biasa untuk menghasilkan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArgumentOutOfRangeException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">Saya tidak akan terkejut dengan pendekatan ini. </font><font style="vertical-align: inherit;">Secara keseluruhan, ini kode yang sangat aneh dan mencurigakan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 31</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal XmlNodeOrder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComparePosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XPathNodePointer other)</span></span></span><span class="hljs-function"> </span></span>{ RealFoliate(); other.RealFoliate(); Debug.Assert(other != null); .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'lain' digunakan sebelum diverifikasi terhadap nol. </font><font style="vertical-align: inherit;">Periksa baris: 1095, 1096. XPathNodePointer.cs 1095 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari Ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LAINNYA = null!</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seperti dengan argumen dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug.Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> metode Mengusulkan, Bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ComparePosition</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> metode BISA Mendapatkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari nilai seperti dengan argumen itu. </font><font style="vertical-align: inherit;">Setidaknya, tujuannya adalah untuk menangkap kasus-kasus seperti itu. </font><font style="vertical-align: inherit;">Tetapi pada saat yang sama, garis di atas yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lain.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Metode instance </font><i><font style="vertical-align: inherit;">realealo</font></i><font style="vertical-align: inherit;"> dipanggil. </font><font style="vertical-align: inherit;">Akibatnya, jika yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan sebelum memeriksa melalui </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 32</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> PropertyDescriptorCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Attribute[] attributes)</span></span></span><span class="hljs-function"> </span></span>{ .... foreach (Attribute attribute in attributes) { Attribute attr = property.Attributes[attribute.GetType()]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (attr == null &amp;&amp; !attribute.IsDefaultAttribute()) || !attr.Match(attribute)) { match = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3080</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan null dereference. Pertimbangkan untuk memeriksa 'attr'. DbConnectionStringBuilder.cs 534 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ekspresi bersyarat pernyataan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terlihat cukup mencurigakan. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Match</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah metode instan. Menurut tanda centang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attr == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah nilai yang dapat diterima (diharapkan) untuk variabel ini. Oleh karena itu, jika aliran kontrol sampai ke operan kanan || operator (jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), kita akan mendapatkan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan demikian, kondisi terjadinya pengecualian adalah sebagai berikut:</font></font><br><br><ol><li> The value of <i>attr</i> ‚Äî <i>null</i> . The right operand of the &amp;&amp; operator is evaluated. </li><li> The value of <i>!attribute.IsDefaultAttribute()</i> ‚Äî <i>false</i> . The overall result of the expression with the &amp;&amp; operator ‚Äî <i>false</i> . </li><li> Since the left operand of the || operator is of the <i>false</i> value, the right operand is evaluated. </li><li> Since <i>attr</i> ‚Äî <i>null</i> , when calling the <i>Match</i> method, an exception is generated. </li></ol><br> <b>Issue 33</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadOldRowData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( DataSet ds, ref DataTable table, ref </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos, XmlReader row)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table == null) { row.Skip(); <span class="hljs-comment"><span class="hljs-comment">// need to skip this element if we dont know about it, // before returning -1 return -1; } .... if (table == null) throw ExceptionBuilder.DiffgramMissingTable( XmlConvert.DecodeName(row.LocalName)); .... }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ada dua pernyataan 'jika' dengan ekspresi kondisional yang identik. Pernyataan 'jika' pertama berisi pengembalian metode. Ini berarti bahwa kedua 'jika' pernyataan adalah XMLDiffLoader.cs tidak masuk akal </font><font style="vertical-align: inherit;">301 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada dua dua </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pernyataan, yang Mengandung ekspresi yang sama - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabel == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dengan itu, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maka</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cabang dari pernyataan ini berisi tindakan yang berbeda - dalam kasus pertama, metode keluar dengan nilai -1, dalam yang kedua - pengecualian dihasilkan. The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variabel tidak berubah untuk Antara pemeriksaan. Dengan demikian, pengecualian yang dipertimbangkan tidak akan dihasilkan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 34</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lihatlah metode menarik dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.ComponentModel.Typeconverter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek. Baiklah, pertama mari kita baca komentar, dengan menggambarkannya: </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menghapus karakter terakhir dari string yang diformat. (Hapus karakter terakhir dalam string virtual). Saat keluar, param keluar berisi posisi di mana operasi sebenarnya dilakukan. Posisi ini relatif terhadap string uji. Parameter MaskedTextResultHint out memberikan informasi lebih lanjut tentang hasil operasi. Mengembalikan nilai </font></font></i> <b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada kesuksesan, </font></font></i> <b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">false</font></font></i></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebaliknya.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Titik kunci pada nilai kembali: jika operasi berhasil, metode mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jika tidak - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mari kita lihat apa yang sebenarnya terjadi.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(out </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> testPosition, out MaskedTextResultHint resultHint)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastAssignedPos == INVALID_INDEX) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// nothing to remove. } .... return true; }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3009</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aneh bahwa metode ini selalu mengembalikan satu dan nilai 'benar' yang sama. MaskedTextProvider.cs 1529 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bahkan, ternyata satu-satunya nilai pengembalian metode ini </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 35</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_table != null) { .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_table.fInitInProgress &amp;&amp; _delayLoadingConstraints != null) { .... } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '_table' digunakan setelah diverifikasi terhadap null. Periksa baris: 437, 423. ConstraintCollection.cs 437 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_table! =</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cek </font><i><font style="vertical-align: inherit;">kosong</font></i><font style="vertical-align: inherit;"> berbicara untuk dirinya sendiri - </font><font style="vertical-align: inherit;">variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_table</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Setidaknya, dalam hal ini penulis kode direasuransikan. Namun, di bawah ini mereka menangani bidang instance melalui </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_table</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tetapi tanpa memeriksa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_table .fInitInProgress</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 36</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sekarang mari kita pertimbangkan beberapa peringatan, yang dikeluarkan untuk kode </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Runtime.Serialization.Formatters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memberNameInfo != null) { .... _serWriter.WriteObjectEnd(memberNameInfo, typeNameInfo); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((objectInfo._objectId == _topId) &amp;&amp; (_topName != null)) { _serWriter.WriteObjectEnd(topNameInfo, typeNameInfo); .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ReferenceEquals(objectInfo._objectType, Converter.s_typeofString)) { _serWriter.WriteObjectEnd(typeNameInfo, typeNameInfo); } }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3038</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Argumen dilewatkan ke metode beberapa kali. </font><font style="vertical-align: inherit;">Ada kemungkinan bahwa argumen lain harus disahkan. </font><font style="vertical-align: inherit;">BinaryObjectWriter.cs 262 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penganalisis bingung dengan panggilan terakhir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_serWriter.WriteObjectEnd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan dua argumen yang sama - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typeNameInfo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sepertinya kesalahan ketik, tapi saya tidak bisa mengatakannya dengan pasti. </font><font style="vertical-align: inherit;">Saya memutuskan untuk memeriksa apa itu </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteObjectEnd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> callee </font><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteObjectEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NameInfo memberNameInfo, NameInfo typeNameInfo)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Baiklah ... Ayo lanjut. </font></font> :) <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 37</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteSerializationHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> topId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> headerId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> minorVersion, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> majorVersion)</span></span></span><span class="hljs-function"> </span></span>{ var record = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SerializationHeaderRecord( BinaryHeaderEnum.SerializedStreamHeader, topId, headerId, minorVersion, majorVersion); record.Write(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat mengulas kode ini, saya tidak akan langsung mengatakan apa yang salah di sini atau apa yang tampak mencurigakan. Tetapi penganalisa mungkin mengatakan apa masalahnya. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3066</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan urutan argumen yang salah diteruskan ke konstruktor 'SerializationHeaderRecord': 'minorVersion' dan 'majorVersion'. BinaryFormatterWriter.cs 111 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lihat konstruktor callee dari </font><font style="vertical-align: inherit;">kelas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SerializationHeaderRecord</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SerializationHeaderRecord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( BinaryHeaderEnum binaryHeaderEnum, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> topId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> headerId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> majorVersion, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> minorVersion)</span></span></span><span class="hljs-function"> </span></span>{ _binaryHeaderEnum = binaryHeaderEnum; _topId = topId; _headerId = headerId; _majorVersion = majorVersion; _minorVersion = minorVersion; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti yang dapat kita lihat, parameter konstruktor mengikuti urutan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">majorVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minorVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; sedangkan ketika memanggil konstruktor, mereka dilewatkan dalam urutan ini: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minorVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">majorVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sepertinya salah ketik. Dalam kasus itu dibuat dengan sengaja (bagaimana jika?) - Saya pikir itu akan membutuhkan komentar tambahan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 38</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ObjectManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ISurrogateSelector selector, StreamingContext context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> checkSecurity, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isCrossAppDomain)</span></span></span><span class="hljs-function"> </span></span>{ _objects = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectHolder[DefaultInitialSize]; _selector = selector; _context = context; _isCrossAppDomain = isCrossAppDomain; }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> konstruktor 'checkSecurity' V3117 tidak digunakan. </font><font style="vertical-align: inherit;">ObjectManager.cs 33 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">checksecurity</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter constructor tidak Digunakan dalam cara apapun. </font><font style="vertical-align: inherit;">Tidak ada komentar tentang itu. </font><font style="vertical-align: inherit;">Saya kira itu dibiarkan untuk kompatibilitas, tetapi bagaimanapun, dalam konteks percakapan keamanan baru-baru ini, itu terlihat menarik. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 39</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inilah kode yang sepertinya tidak biasa bagi saya. </font><font style="vertical-align: inherit;">Pola terlihat satu dan sama dalam ketiga kasus yang terdeteksi dan terletak di metode dengan nama yang sama dan nama variabel. </font><font style="vertical-align: inherit;">Akibatnya:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> baik saya tidak cukup tercerahkan untuk mendapatkan tujuan duplikasi seperti itu; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau kesalahan disebarkan oleh metode salin-tempel. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kode itu sendiri: </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnlargeArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newLength = _values.Length * <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newLength &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newLength == <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SerializationException(SR.Serialization_TooManyElements); } newLength = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; } FixupHolder[] temp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FixupHolder[newLength]; Array.Copy(_values, <span class="hljs-number"><span class="hljs-number">0</span></span>, temp, <span class="hljs-number"><span class="hljs-number">0</span></span>, _count); _values = temp; }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ekspresi</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"> V3022</font></u></a><font style="vertical-align: inherit;"> 'newLength == int.MaxValue' selalu salah. </font><font style="vertical-align: inherit;">ObjectManager.cs 1423</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ekspresi</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"> V3022</font></u></a><font style="vertical-align: inherit;"> 'newLength == int.MaxValue' selalu salah. </font><font style="vertical-align: inherit;">ObjectManager.cs 1511</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ekspresi</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"> V3022</font></u></a><font style="vertical-align: inherit;"> 'newLength == int.MaxValue' selalu salah. </font><font style="vertical-align: inherit;">ObjectManager.cs 1558</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apa yang berbeda dalam metode lain adalah jenis </font><font style="vertical-align: inherit;">elemen array </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (bukan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FixupHolder</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panjang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objek</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Jadi saya masih memiliki kecurigaan terhadap copy-paste ... </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 40</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kode dari </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Data.Odbc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnquoteIdentifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrEmpty(quotePrefix) || quotePrefix != <span class="hljs-string"><span class="hljs-string">" "</span></span>) { .... } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ekspresi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '! String.IsNullOrEmpty (quotePrefix) || quotePrefix! = "" 'selalu benar. OdbcCommandBuilder.cs 338 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer mengasumsikan bahwa ekspresi yang diberikan selalu memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebenarnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Benar-benar begitu. Bahkan tidak masalah nilai apa sebenarnya dalam </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - kondisi itu sendiri ditulis secara tidak benar. Mari kita sampai ke bagian bawah ini. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memiliki || operator, sehingga nilai ekspresi akan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jika operan kiri atau kanan (atau keduanya) akan memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebenarnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Semuanya jelas dengan yang kiri. Yang kanan akan dievaluasi hanya dalam kasus jika yang kiri memiliki yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nilai. </font><font style="vertical-align: inherit;">Berarti yang ini, jika ungkapan tersebut Terdiri dalam cara Bahwa nilai dari operan kanan selalu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ketika nilai dari kiri seseorang adalah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">palsu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dengan hasil dari ekspresi Seluruh permanen akan dari BE </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ke true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dari kode di atas kita tahu bahwa jika operan yang tepat dievaluasi, nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ekspresi.IsNullOrEmpty </font><i><font style="vertical-align: inherit;">(quotePrefix)</font></i><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jadi salah satu dari pernyataan ini benar:</font></font><br><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika salah satu dari pernyataan ini benar, ungkapan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix! = ""</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Akan juga benar, yang ingin kami buktikan. Berarti nilai seluruh ekspresi selalu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , terlepas dari </font><font style="vertical-align: inherit;">konten </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quotePrefix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 41</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kembali ke konstruktor dengan parameter yang tidak digunakan:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> sealed <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PendingGetConnection</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PendingGetConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dueTime, DbConnection owner, TaskCompletionSource&lt;DbConnectionInternal&gt; completion, DbConnectionOptions userOptions)</span></span></span><span class="hljs-function"> </span></span>{ DueTime = dueTime; Owner = owner; Completion = completion; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> DueTime { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbConnection Owner { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TaskCompletionSource&lt;DbConnectionInternal&gt; Completion { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DbConnectionOptions UserOptions { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3117</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter konstruktor 'userOptions' tidak digunakan. </font><font style="vertical-align: inherit;">DbConnectionPool.cs 26 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kita dapat melihat dari peringatan penganalisa dan kode, bahwa hanya satu parameter konstruktor yang tidak digunakan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- userOptions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan yang lain digunakan untuk menginisialisasi properti dengan nama yang sama. </font><font style="vertical-align: inherit;">Sepertinya pengembang lupa menginisialisasi salah satu properti. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 42</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ada kode yang mencurigakan, yang kami temui 2 kali. </font><font style="vertical-align: inherit;">Polanya sama.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> DataTable </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecuteCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... foreach (DataRow row in schemaTable.Rows) { resultTable.Columns .Add(row[<span class="hljs-string"><span class="hljs-string">"ColumnName"</span></span>] as <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, (Type)row[<span class="hljs-string"><span class="hljs-string">"DataType"</span></span>] as Type); } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3051</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pemain tipe berlebihan. </font><font style="vertical-align: inherit;">Objek sudah dari tipe 'Type'. </font><font style="vertical-align: inherit;">DbMetaDataFactory.cs 176</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3051</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pemain tipe berlebihan. </font><font style="vertical-align: inherit;">Objek sudah dari tipe 'Type'. </font><font style="vertical-align: inherit;">OdbcMetaDataFactory.cs 1109</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Tipe) baris ["Tipe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Data </font><i><font style="vertical-align: inherit;">"] sebagai Tipe</font></i><font style="vertical-align: inherit;"> tampak mencurigakan. Pertama, casting eksplisit akan dilakukan, setelah itu - casting melalui </font><font style="vertical-align: inherit;">operator </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baris</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nilai </font><i><font style="vertical-align: inherit;">["DataType"]</font></i><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> itu akan berhasil melewati kedua coran dan akan dilakukan sebagai argumen untuk </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambahkan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baris ["DataType"]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan nilai, yang tidak dapat dilemparkan ke </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipe, pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidCastException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan tepat selama pemeran eksplisit. Pada akhirnya, mengapa kita perlu dua casting di sini? Pertanyaannya terbuka. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 43</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita lihat fragmen mencurigakan dari</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Runtime.InteropServices.RuntimeInformation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> FrameworkDescription { get { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s_frameworkDescription == null) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> versionString = (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>)AppContext.GetData(<span class="hljs-string"><span class="hljs-string">"FX_PRODUCT_VERSION"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (versionString == null) { .... versionString = typeof(object).Assembly .GetCustomAttribute&lt; AssemblyInformationalVersionAttribute&gt;() ?.InformationalVersion; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> plusIndex = versionString.IndexOf(<span class="hljs-string"><span class="hljs-string">'+'</span></span>); .... } .... } .... } }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3105 Variabel</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'versiString' digunakan setelah ditugaskan melalui operator kondisional nol. </font><font style="vertical-align: inherit;">NullReferenceException dimungkinkan. </font><font style="vertical-align: inherit;">RuntimeInformation.cs 29 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penganalisis memperingatkan tentang kemungkinan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saat memanggil </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk </font><font style="vertical-align: inherit;">variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versiString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saat menerima nilai untuk variabel, pembuat kode menggunakan '?.' </font><font style="vertical-align: inherit;">operator untuk menghindari </font><font style="vertical-align: inherit;">pengecualian </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ketika mengakses </font><font style="vertical-align: inherit;">properti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfromationalVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Caranya adalah jika panggilan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCustomAttribute &lt;...&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pengecualian masih akan dihasilkan, tetapi di bawah ini - saat memanggil </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexOf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , karena </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versionString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 44</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita membahas </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.ComponentModel.Composition</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan melihat melalui beberapa peringatan. </font><font style="vertical-align: inherit;">Dua peringatan dikeluarkan untuk kode berikut:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanSpecialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... object[] genericParameterConstraints = ....; GenericParameterAttributes[] genericParameterAttributes = ....; <span class="hljs-comment"><span class="hljs-comment">// if no constraints and attributes been specifed, anything can be created if ((genericParameterConstraints == null) &amp;&amp; (genericParameterAttributes == null)) { return true; } if ((genericParameterConstraints != null) &amp;&amp; (genericParameterConstraints.Length != partArity)) { return false; } if ((genericParameterAttributes != null) &amp;&amp; (genericParameterAttributes.Length != partArity)) { return false; } for (int i = 0; i &lt; partArity; i++) { if (!GenericServices.CanSpecialize( specialization[i], (genericParameterConstraints[i] as Type[]). CreateTypeSpecializations(specialization), genericParameterAttributes[i])) { return false; } } return true; }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'genericParameterConstraints' digunakan setelah diverifikasi terhadap nol. </font><font style="vertical-align: inherit;">Periksa baris: 603, 589. GenericSpecializationPartCreationInfo.cs 603</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'genericParameterAttributes' digunakan setelah diverifikasi terhadap null. </font><font style="vertical-align: inherit;">Periksa baris: 604, 594. GenericSpecializationPartCreationInfo.cs 604</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam kode ada pemeriksaan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">genericParameterAttributes! = Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">genericParameterConstraints! = Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Karenanya, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - nilai yang dapat diterima untuk variabel-variabel ini, kami akan mempertimbangkannya. Jika kedua variabel memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kami akan keluar dari metode, tanpa pertanyaan. Bagaimana jika salah satu dari dua variabel yang disebutkan di atas adalah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi dengan melakukannya kita tidak keluar dari metode? Jika hal tersebut memungkinkan dan eksekusi dapat melewati loop, kami akan mendapatkan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 45</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selanjutnya kita akan pindah ke peringatan lain yang menarik dari proyek ini. Namun, mari kita lakukan sesuatu yang berbeda - pertama kita akan menggunakan kelas lagi, dan kemudian melihat kode. Selanjutnya, kita akan menambahkan referensi ke paket NuGet dengan nama yang sama dari versi pra-rilis yang tersedia terakhir dalam proyek (saya menginstal paket versi 4.6.0-preview6.19303.8). Mari kita menulis kode sederhana, misalnya, seperti:</font></font><br><br><pre> <code class="cpp hljs">LazyMemberInfo lazyMemberInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LazyMemberInfo(); var eq = lazyMemberInfo.Equals(null); Console.WriteLine(eq);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang Setara</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> metode tidak dikomentari, I DID tidak menemukan deskripsi metode ini untuk NET Inti AT docs.microsoft.com, hanya untuk .NET Framework. </font><font style="vertical-align: inherit;">Jika kita melihatnya (" </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metode LazyMemberInfo.Equals (Obyek)</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ") - kita tidak akan melihat sesuatu yang istimewa apakah itu mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tidak ada informasi tentang pengecualian yang dihasilkan. </font><font style="vertical-align: inherit;">Kami akan menjalankan kode dan melihat:</font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e5/8f7/aa4/8e58f7aa4e5a274751cde57da4d9497f.png" alt="Gambar 16"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kita bisa sedikit memutar dan menulis kode berikut dan juga mendapatkan output yang menarik: </font></font><br><br><pre> <code class="cpp hljs">LazyMemberInfo lazyMemberInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LazyMemberInfo(); var eq = lazyMemberInfo.Equals(typeof(String)); Console.WriteLine(eq);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hasil dari eksekusi kode. </font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e74/199/292/e74199292d39b2df8a7b205218c9c1fe.png" alt="Gambar 17"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menariknya, kedua pengecualian ini dihasilkan dalam ekspresi yang sama. </font><font style="vertical-align: inherit;">Mari kita lihat di dalam </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ LazyMemberInfo that = (LazyMemberInfo)obj; <span class="hljs-comment"><span class="hljs-comment">// Difefrent member types mean different members if (_memberType != that._memberType) { return false; } // if any of the lazy memebers create accessors in a delay-loaded fashion, // we simply compare the creators if ((_accessorsCreator != null) || (that._accessorsCreator != null)) { return object.Equals(_accessorsCreator, that._accessorsCreator); } // we are dealing with explicitly passed accessors in both cases if(_accessors == null || that._accessors == null) { throw new Exception(SR.Diagnostic_InternalExceptionMessage); } return _accessors.SequenceEqual(that._accessors); }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3115</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Melewati </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;">metode</font></u></a><font style="vertical-align: inherit;"> 'null' ke 'Equals' tidak boleh menghasilkan 'NullReferenceException'. LazyMemberInfo.cs 116 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebenarnya dalam hal ini kasus analyzer mengacaukan closeup sedikit, karena dengan IT, mengeluarkan peringatan untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that._memberType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ekspresi. Namun, pengecualian terjadi sebelumnya ketika mengeksekusi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obj (LazyMemberInfo)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kami sudah membuat catatan tentang itu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya pikir semuanya jelas dengan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidCastException.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mengapa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dihasilkan? Faktanya adalah bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LazyMemberInfo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah sebuah struct, oleh karena itu, ia akan dibebaskan dari kotak. Nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unboxing, pada gilirannya,mengarah ke terjadinya pengecualian </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jenis. </font><font style="vertical-align: inherit;">Juga ada beberapa kesalahan ketik dalam komentar - penulis mungkin harus memperbaikinya. </font><font style="vertical-align: inherit;">Pengecualian eksplisit melempar masih di tangan penulis. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 46</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> By the way, saya menemukan kasus serupa di </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Drawing.Common</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam </font><font style="vertical-align: inherit;">struktur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TriState</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object o)</span></span></span><span class="hljs-function"> </span></span>{ TriState state = (TriState)o; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _value == state._value; }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3115</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Melewati </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;">metode</font></u></a><font style="vertical-align: inherit;"> 'null' ke 'Equals' tidak boleh menghasilkan 'NullReferenceException'. </font><font style="vertical-align: inherit;">TriState.cs 53 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalahnya sama seperti dalam kasus yang dijelaskan di atas. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 47</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita pertimbangkan beberapa fragmen dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Text.Json</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingat saya menulis bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak boleh mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">Saatnya memantapkan pengetahuan ini.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (TokenType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JsonTokenType.None: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JsonTokenType.Null: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JsonTokenType.True: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>.TrueString; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JsonTokenType.False: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>.FalseString; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JsonTokenType.Number: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JsonTokenType.StartArray: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> JsonTokenType.StartObject: { <span class="hljs-comment"><span class="hljs-comment">// null parent should have hit the None case Debug.Assert(_parent != null); return _parent.GetRawValueAsString(_idx); } case JsonTokenType.String: return GetString(); case JsonTokenType.Comment: case JsonTokenType.EndArray: case JsonTokenType.EndObject: default: Debug.Fail($"No handler for {nameof(JsonTokenType)}.{TokenType}"); return string.Empty; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada pandangan pertama, metode ini tidak mengembalikan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi penganalisa berpendapat sebaliknya. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3108</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tidak disarankan untuk mengembalikan 'null' dari metode 'ToSting ()'. </font><font style="vertical-align: inherit;">JsonElement.cs 1460 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analyzer menunjuk ke garis dengan memanggil metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetString ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mari kita melihatnya.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ CheckValidInstance(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _parent.GetString(_idx, JsonTokenType.String); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bahas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lebih dalam versi berlebihan dari </font><font style="vertical-align: inherit;">metode </font><i><font style="vertical-align: inherit;">GetString</font></i><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, JsonTokenType expectedType)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokenType == JsonTokenType.Null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tepat setelah kami melihat kondisinya, yang pelaksanaannya akan menghasilkan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - baik dari metode ini dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang awalnya kami pertimbangkan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 48</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fragmen menarik lainnya:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal JsonPropertyInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePolymorphicProperty</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ JsonPropertyInfo runtimeProperty = CreateProperty(property.DeclaredPropertyType, runtimePropertyType, property.ImplementedPropertyType, property?.PropertyInfo, Type, options); property.CopyRuntimeSettingsTo(runtimeProperty); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> runtimeProperty; }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3042</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kemungkinan NullReferenceException. '?.' dan '.' operator digunakan untuk mengakses anggota objek 'properti' JsonClassInfo.AddProperty.cs 179 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat memanggil </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateProperty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , properti dirujuk beberapa kali melalui </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properti</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variabel </font><font style="vertical-align: inherit;">: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">property.DeclaredPropertyType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">property.ImplementedPropertyType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">property? .PropertyInfo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Seperti yang Anda lihat, dalam satu kasus, penulis menggunakan kode '?.'</font></font> operator.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika tidak salah di sini dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">properti</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , operator ini tidak akan membantu, sebagai pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan dengan akses langsung. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 49</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fragmen mencurigakan berikut ini ditemukan dalam </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Security.Cryptography.Xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mereka berpasangan, sama seperti beberapa kali dengan peringatan lainnya. </font><font style="vertical-align: inherit;">Sekali lagi, kode ini terlihat seperti salin-tempel, bandingkan sendiri. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen pertama:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StringBuilder strBuilder, DocPosition docPos, AncestralNamespaceContextManager anc)</span></span></span><span class="hljs-function"> </span></span>{ docPos = DocPosition.BeforeRootElement; foreach (XmlNode childNode in ChildNodes) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (childNode.NodeType == XmlNodeType.Element) { CanonicalizationDispatcher.Write( childNode, strBuilder, DocPosition.InRootElement, anc); docPos = DocPosition.AfterRootElement; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { CanonicalizationDispatcher.Write(childNode, strBuilder, docPos, anc); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fragmen kedua. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HashAlgorithm hash, DocPosition docPos, AncestralNamespaceContextManager anc)</span></span></span><span class="hljs-function"> </span></span>{ docPos = DocPosition.BeforeRootElement; foreach (XmlNode childNode in ChildNodes) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (childNode.NodeType == XmlNodeType.Element) { CanonicalizationDispatcher.WriteHash( childNode, hash, DocPosition.InRootElement, anc); docPos = DocPosition.AfterRootElement; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { CanonicalizationDispatcher.WriteHash(childNode, hash, docPos, anc); } } }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter 'docPos' selalu ditulis ulang dalam tubuh metode sebelum digunakan. </font><font style="vertical-align: inherit;">CanonicalXmlDocument.cs 37</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3061</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parameter 'docPos' selalu ditulis ulang dalam tubuh metode sebelum digunakan. </font><font style="vertical-align: inherit;">CanonicalXmlDocument.cs 54</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam kedua metode </font><font style="vertical-align: inherit;">parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docPos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditimpa sebelum nilainya digunakan. </font><font style="vertical-align: inherit;">Oleh karena itu, nilai, yang digunakan sebagai argumen metode, diabaikan begitu saja. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 50</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita pertimbangkan beberapa peringatan pada kode </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Data.SqlClient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsBOMNeeded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MetaType type, object value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type.NullableType == TdsEnums.SQLXMLTYPE) { Type currentType = value.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentType == typeof(SqlString)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!((SqlString)value).IsNull &amp;&amp; ((((SqlString)value).Value).Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((((SqlString)value).Value[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) != <span class="hljs-number"><span class="hljs-number">0xff</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((currentType == typeof(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>)) &amp;&amp; (((String)value).Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((value != null) &amp;&amp; (((<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>)value)[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>) != <span class="hljs-number"><span class="hljs-number">0xff</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentType == typeof(SqlXml)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!((SqlXml)value).IsNull) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentType == typeof(XmlDataFeed)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Values will eventually converted to unicode string here } } return false; }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'nilai' digunakan sebelum diverifikasi terhadap nol. Periksa baris: 8696, 8708. TdsParser.cs 8696 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penganalisis bingung dengan nilai cek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! = Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di salah satu kondisi. Sepertinya hilang di sana selama refactoring, karena </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nilainya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berulang kali. Jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nilai</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semuanya buruk. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 51</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kesalahan berikutnya adalah dari tes, tetapi tampaknya menarik bagi saya, jadi saya memutuskan untuk mengutipnya.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> TDSMessageCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateQueryResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( lowerBatchText.Contains(<span class="hljs-string"><span class="hljs-string">"name"</span></span>) &amp;&amp; lowerBatchText.Contains(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) &amp;&amp; lowerBatchText.Contains(<span class="hljs-string"><span class="hljs-string">"databases"</span></span>) &amp;&amp; lowerBatchText.Contains(<span class="hljs-string"><span class="hljs-string">"db_name"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">// SELECT [name], [state] FROM [sys].[databases] WHERE [name] = db_name() { // Delegate to current database response responseMessage = _PrepareDatabaseResponse(session); } .... }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3053</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ekspresi yang berlebihan. Periksa substring 'nama' dan 'db_name'. QueryEngine.cs 151 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faktanya adalah bahwa dalam hal ini kombinasi dari subekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowerBatchText.Contains ("name")</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowerBatchText.Contains ("db_name")</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berlebihan. Memang, jika string yang dicentang mengandung substring </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"db_name"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , itu akan berisi </font><font style="vertical-align: inherit;">substring </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"nama"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> juga. Jika string tidak mengandung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"nama"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">string juga tidak </font><font style="vertical-align: inherit;">akan mengandung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"db_name"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Akibatnya, ternyata cek lebih </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rendahBatchText.Contains ("nama")</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berlebihan. Kecuali itu dapat mengurangi jumlah ekspresi yang dievaluasi, jika string yang dicentang tidak mengandung </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"nama"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 52</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fragmen yang mencurigakan dari kode </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Net.Requests</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override PipelineInstruction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PipelineCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( PipelineEntry entry, ResponseDescription response, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NetEventSource.IsEnabled) NetEventSource.Info(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, $<span class="hljs-string"><span class="hljs-string">"Command:{entry?.Command} Description:{response?.StatusDescription}"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// null response is not expected if (response == null) return PipelineInstruction.Abort; .... if (entry.Command == "OPTS utf8 on\r\n") .... .... }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'entri' digunakan setelah diverifikasi terhadap nol. Periksa baris: 270, 227. FtpControlStream.cs 270 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat membuat string interpolasi, ekspresi seperti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entri ?. Perintah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respons ?. Deskripsi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digunakan. '?.' operator digunakan alih-alih '.' Operator tidak mendapatkan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jika seandainya ada parameter yang sesuai memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dalam hal ini, teknik ini berfungsi. Lebih lanjut, seperti yang dapat kita lihat dari kode, kemungkinan </font><font style="vertical-align: inherit;">nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respons</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terpecah (keluar dari metode jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respons == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), sedangkan tidak ada yang serupa untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">masuk. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Akibatnya, jika </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lebih lanjut di sepanjang kode ketika mengevaluasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entri. Perintah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dengan penggunaan '.', Bukan '?.'), Pengecualian akan dihasilkan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada titik ini, tinjauan kode yang cukup rinci sedang menunggu kami, jadi saya sarankan Anda istirahat sejenak, membuat teh atau kopi. </font><font style="vertical-align: inherit;">Setelah itu saya akan di sini untuk melanjutkan.</font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/3fc/f07/56a3fcf075284f021a56249627e518bb.png" alt="Gambar 21"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah kamu kembali? </font><font style="vertical-align: inherit;">Kalau begitu mari kita lanjutkan.</font></font> :) <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 53</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sekarang mari kita cari sesuatu yang menarik dalam </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Collections.Immutable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kali ini kita akan melakukan beberapa eksperimen dengan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Collections.Immutable.ImmutableArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> struct </font><i><font style="vertical-align: inherit;">&lt;T&gt;</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IStructuralEquatable.Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IStructuralComparable.CompareTo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menarik bagi kami. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita mulai dengan </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IStructuralEquatable.Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kode diberikan di bawah ini, saya sarankan Anda mencoba untuk mendapatkan apa yang salah sendiri:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IStructuralEquatable.Equals(object other, IEqualityComparer comparer) { var self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; Array otherArray = other as Array; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherArray == null) { var theirs = other as IImmutableArray; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (theirs != null) { otherArray = theirs.Array; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span> == null &amp;&amp; otherArray == null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span> == null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } } IStructuralEquatable ours = self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ours.Equals(otherArray, comparer); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah Anda berhasil? </font><font style="vertical-align: inherit;">Jika ya - selamat saya.</font></font> :) <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio warning: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'ours' digunakan setelah diverifikasi dengan null. Periksa baris: 1212, 1204. ImmutableArray_1.cs 1212 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penganalisis bingung dengan panggilan instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method melalui </font><font style="vertical-align: inherit;">variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kita</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang terletak di </font><font style="vertical-align: inherit;">ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengembalian</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terakhir </font><font style="vertical-align: inherit;">, karena menunjukkan bahwa pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mungkin terjadi di sini. Mengapa penganalisa menyarankan demikian? Untuk membuatnya lebih mudah dijelaskan, saya memberikan fragmen kode yang disederhanakan dari metode yang sama di bawah ini.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IStructuralEquatable.Equals(object other, IEqualityComparer comparer) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span> == null &amp;&amp; otherArray == null) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span> == null) { .... } } } IStructuralEquatable ours = self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ours.Equals(otherArray, comparer); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam ekspresi terakhir, kita dapat melihat, bahwa nilai </font><font style="vertical-align: inherit;">variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kita</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berasal dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dilakukan beberapa kali di atas. Yang berarti, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">milik kita,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sama seperti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dapat memiliki nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Setidaknya secara teori. Apakah kondisi ini dapat dicapai dalam praktik? Mari kita coba mencari tahu. Untuk melakukan ini, sekali lagi saya mengutip tubuh metode dengan menetapkan poin-poin penting.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IStructuralEquatable.Equals(object other, IEqualityComparer comparer) { var self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= 1 Array otherArray = other as Array; if (otherArray == null) // &lt;= 2 { var theirs = other as IImmutableArray; if (theirs != null) // &lt;= 3 { otherArray = theirs.Array; if (self.array == null &amp;&amp; otherArray == null) { return true; } else if (self.array == null) // &lt;= 4 { return false; } } IStructuralEquatable ours = self.array; // &lt;= 5 return ours.Equals(otherArray, comparer); }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poin kunci 1. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == this.array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (karena </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self = ini</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Oleh karena itu, sebelum memanggil metode, kita perlu mendapatkan kondisi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.array == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poin kunci 2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kita dapat mengabaikan ini </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang akan menjadi cara paling sederhana untuk mendapatkan apa yang kita inginkan. Untuk mengabaikan ini </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jika</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kita hanya perlu </font><font style="vertical-align: inherit;">variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari </font><font style="vertical-align: inherit;">jenis </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau yang diturunkan, dan tidak mengandung nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dengan cara ini, setelah menggunakan </font><font style="vertical-align: inherit;">operator </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , referensi non-nol akan ditulis dalam </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OtherArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan kami akan mengabaikan </font><font style="vertical-align: inherit;">pernyataan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pertama </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></i> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poin kunci 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Poin ini membutuhkan pendekatan yang lebih kompleks. </font><font style="vertical-align: inherit;">Kita pasti perlu keluar pada </font><font style="vertical-align: inherit;">pernyataan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kedua </font><font style="vertical-align: inherit;">(yang dengan ekspresi kondisional </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">milik mereka! = Null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Jika itu tidak terjadi dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kemudian</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cabang mulai dieksekusi, pasti kita tidak akan mendapatkan poin 5 yang diperlukan dalam kondisi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> karena titik kunci 4. Untuk menghindari memasukkan </font><font style="vertical-align: inherit;">pernyataan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari titik kunci 3, salah satu syarat ini harus dipenuhi:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lainnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lain yang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebenarnya </font><font style="vertical-align: inherit;">tidak boleh mengimplementasikan </font><font style="vertical-align: inherit;">antarmuka </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IImmutableArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poin kunci 5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Jika kita sampai pada titik ini dengan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.array == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , itu berarti bahwa kita telah mencapai tujuan kita, dan pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mendapatkan kumpulan data berikut yang akan mengarahkan kami ke titik yang dibutuhkan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertama: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.array - nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kedua - salah satu dari yang berikut:</font></font><br><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lainnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang lain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memiliki </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau yang berasal darinya;</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yang lain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak memiliki </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau yang diturunkan darinya dan dengan melakukan itu, tidak mengimplementasikan </font><font style="vertical-align: inherit;">antarmuka </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IImmutableArray</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah bidang, dideklarasikan dengan cara berikut:</font></font><br><br><pre> <code class="cpp hljs">internal T[] <span class="hljs-built_in"><span class="hljs-built_in">array</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImmutableArray &lt;T&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah struktur, ia memiliki konstruktor default (tanpa argumen) yang akan menghasilkan </font><font style="vertical-align: inherit;">bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">array yang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengambil nilai secara default, yang merupakan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol. </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan itulah yang kami butuhkan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jangan lupa bahwa kami sedang menyelidiki implementasi eksplisit dari metode antarmuka, oleh karena itu, casting harus dilakukan sebelum panggilan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang kita memiliki permainan di tangan untuk mencapai kejadian pengecualian dalam tiga cara. </font><font style="vertical-align: inherit;">Kami menambahkan referensi ke versi pustaka debugging, menulis kode, mengeksekusi dan melihat apa yang terjadi. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen kode 1.</font></font></b> <br><br><pre> <code class="cpp hljs">var comparer = EqualityComparer&lt;String&gt;.Default; ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImmutableArray&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(); ((IStructuralEquatable)immutableArray).Equals(null, comparer);</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen kode 2.</font></font></b> <br><br><pre> <code class="cpp hljs">var comparer = EqualityComparer&lt;String&gt;.Default; ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImmutableArray&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(); ((IStructuralEquatable)immutableArray).Equals(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>[] { }, comparer);</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmen kode 3.</font></font></b> <br><br><pre> <code class="cpp hljs">var comparer = EqualityComparer&lt;String&gt;.Default; ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImmutableArray&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(); ((IStructuralEquatable)immutableArray).Equals(typeof(Object), comparer);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hasil eksekusi dari ketiga fragmen kode akan sama, hanya dicapai oleh input data input yang berbeda, dan jalur eksekusi. </font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/a3b/e8a/13aa3be8a0b68a646aee130773f2c862.png" alt="Gambar 18"></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 54</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jika Anda tidak lupa, kami memiliki metode lain yang perlu kami mendiskreditkan. </font><font style="vertical-align: inherit;">:) Tapi kali ini kami tidak akan membahasnya secara mendetail. </font><font style="vertical-align: inherit;">Apalagi kita sudah mengetahui beberapa informasi dari contoh sebelumnya.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> IStructuralComparable.CompareTo(object other, IComparer comparer) { var self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; Array otherArray = other as Array; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherArray == null) { var theirs = other as IImmutableArray; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (theirs != null) { otherArray = theirs.Array; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span> == null &amp;&amp; otherArray == null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span> == null ^ otherArray == null) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException( SR.ArrayInitializedStateNotEqual, nameof(other)); } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherArray != null) { IStructuralComparable ours = self.<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ours.CompareTo(otherArray, comparer); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } throw new ArgumentException(SR.ArrayLengthsNotEqual, nameof(other)); }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio warning: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'ours' digunakan setelah diverifikasi dengan null. </font><font style="vertical-align: inherit;">Periksa baris: 1265, 1251. ImmutableArray_1.cs 1265 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti yang Anda lihat, kasus ini sangat mirip dengan contoh sebelumnya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita menulis kode berikut:</font></font><br><br><pre> <code class="cpp hljs">Object other = ....; var comparer = Comparer&lt;String&gt;.Default; ImmutableArray&lt;String&gt; immutableArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImmutableArray&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(); ((IStructuralComparable)immutableArray).CompareTo(other, comparer);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami akan mencoba menemukan beberapa data entri untuk mencapai titik tersebut, di mana pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mungkin terjadi: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nilai: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lainnya</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string baru [] {}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil:</font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eef/d77/08a/eefd7708a187f5060f2074e642f18434.png" alt="Gambar 22"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jadi, kami kembali berhasil menemukan data tersebut, dengan pengecualian yang terjadi dalam metode ini. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 55</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dalam proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Net.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HTTP Listener, saya menemukan beberapa tempat mencurigakan dan sangat mirip. </font><font style="vertical-align: inherit;">Sekali lagi, saya tidak bisa menghilangkan perasaan tentang copy-paste, yang terjadi di sini. </font><font style="vertical-align: inherit;">Karena polanya sama, kita akan melihat satu contoh kode. </font><font style="vertical-align: inherit;">Saya akan mengutip peringatan penganalisa untuk kasus-kasus lainnya.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override IAsyncResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte[] buffer, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NetEventSource.IsEnabled) { NetEventSource.Enter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); NetEventSource.Info(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"buffer.Length:"</span></span> + buffer.Length + <span class="hljs-string"><span class="hljs-string">" size:"</span></span> + size + <span class="hljs-string"><span class="hljs-string">" offset:"</span></span> + offset); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buffer == null) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(buffer)); } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'buffer' digunakan sebelum diverifikasi terhadap null. Periksa baris: 51, 53. HttpRequestStream.cs 51 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generasi pengecualian </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArgumentNullException di</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bawah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kondisi </font><i><font style="vertical-align: inherit;">== null</font></i><font style="vertical-align: inherit;"> jelas menunjukkan bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah nilai yang tidak dapat diterima untuk variabel ini. Namun, jika nilai </font><font style="vertical-align: inherit;">ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetEventSource.IsEnabled </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ketika mengevaluasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ekspresi panjang, pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan. Seperti yang bisa kita lihat, kita bahkan tidak akan mencapai</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer == null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> periksa dalam hal ini. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio dikeluarkan untuk metode lain dengan pola:</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'buffer' digunakan sebelum diverifikasi terhadap null. </font><font style="vertical-align: inherit;">Periksa baris: 49, 51. HttpResponseStream.cs 49</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'buffer' digunakan sebelum diverifikasi terhadap null. </font><font style="vertical-align: inherit;">Periksa baris: 74, 75. HttpResponseStream.cs 74</font></font></li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 56</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Potongan kode serupa ada di </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Transactions.Local</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnterState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InternalTransaction tx)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tx._outcomeSource._isoLevel == IsolationLevel.Snapshot) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> TransactionException.CreateInvalidOperationException( TraceSourceType.TraceSourceLtm, SR.CannotPromoteSnapshot, null, tx == null ? Guid.Empty : tx.DistributedTxId); } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'tx' digunakan sebelum diverifikasi dengan null. Periksa baris: 3282, 3285. TransactionState.cs 3282 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam kondisi tertentu, penulis ingin melempar pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidOperationException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Saat memanggil metode untuk membuat objek pengecualian, pembuat kode menggunakan </font><font style="vertical-align: inherit;">parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , periksa untuk </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk menghindari pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saat mengevaluasi </font><font style="vertical-align: inherit;">ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tx.DistributedTxId</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sangat ironis bahwa pemeriksaan tidak akan membantu, seperti ketika mengevaluasi kondisi </font><font style="vertical-align: inherit;">pernyataan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , bidang contoh diakses melalui </font><font style="vertical-align: inherit;">variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tx._outcomeSource._isoLevel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 57</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kode dari </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Runtime.Caching</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cacheMemoryLimitMegabytes)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> cacheMemoryLimit = cacheMemoryLimitMegabytes; cacheMemoryLimit = cacheMemoryLimit &lt;&lt; MEGABYTE_SHIFT; _memoryLimit = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// never override what the user specifies as the limit; // only call AutoPrivateBytesLimit when the user does not specify one. if (cacheMemoryLimit == 0 &amp;&amp; _memoryLimit == 0) { // Zero means we impose a limit _memoryLimit = EffectiveProcessMemoryLimit; } else if (cacheMemoryLimit != 0 &amp;&amp; _memoryLimit != 0) { // Take the min of "cache memory limit" and // the host's "process memory limit". _memoryLimit = Math.Min(_memoryLimit, cacheMemoryLimit); } else if (cacheMemoryLimit != 0) { // _memoryLimit is 0, but "cache memory limit" // is non-zero, so use it as the limit _memoryLimit = cacheMemoryLimit; } .... }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio:</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ekspresi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'cacheMemoryLimit! = 0 &amp;&amp; _memoryLimit! = 0' selalu salah. CacheMemoryMonitor.cs 250 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda memperhatikan kode ini, Anda akan melihat bahwa salah satu ekspresi - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cacheMemoryLimit! = 0 &amp;&amp; _memoryLimit! = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan selalu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Karena </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_memoryLimit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memiliki nilai 0 (diatur sebelum </font><font style="vertical-align: inherit;">pernyataan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), operan kanan operator &amp;&amp; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Oleh karena itu, hasil dari seluruh ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 58</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saya mengutip fragmen kode yang mencurigakan dari </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Diagnostics.TraceSource di</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bawah ini.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ StackNode n = _stack.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == null) { base.Pop(); } _stack.Value = n.Prev; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n.Value; }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3125 Objek</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'n' digunakan setelah diverifikasi terhadap null. Periksa baris: 115, 111. CorrelationManager.cs 115 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bahkan, ini adalah kasus yang menarik. Karena centang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n == null,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya berasumsi, bahwa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah nilai yang diharapkan untuk variabel lokal ini. Jika demikian, pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan dihasilkan ketika mengakses properti instance - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n.Prev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika dalam kasus ini </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak pernah bisa menjadi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base.Pop ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak akan pernah dipanggil. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 59</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fragmen kode yang menarik dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Drawing.Primitive</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyek. </font><font style="vertical-align: inherit;">Sekali lagi, saya sarankan Anda mencoba menemukan masalahnya sendiri. </font><font style="vertical-align: inherit;">Berikut kodenya:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToHtml</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Color c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> colorString = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c.IsEmpty) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> colorString; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ColorUtil.IsSystemColor(c)) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (c.ToKnownColor()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ActiveBorder: colorString = <span class="hljs-string"><span class="hljs-string">"activeborder"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.GradientActiveCaption: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ActiveCaption: colorString = <span class="hljs-string"><span class="hljs-string">"activecaption"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.AppWorkspace: colorString = <span class="hljs-string"><span class="hljs-string">"appworkspace"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.Desktop: colorString = <span class="hljs-string"><span class="hljs-string">"background"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.Control: colorString = <span class="hljs-string"><span class="hljs-string">"buttonface"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ControlLight: colorString = <span class="hljs-string"><span class="hljs-string">"buttonface"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ControlDark: colorString = <span class="hljs-string"><span class="hljs-string">"buttonshadow"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ControlText: colorString = <span class="hljs-string"><span class="hljs-string">"buttontext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ActiveCaptionText: colorString = <span class="hljs-string"><span class="hljs-string">"captiontext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.GrayText: colorString = <span class="hljs-string"><span class="hljs-string">"graytext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.HotTrack: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.Highlight: colorString = <span class="hljs-string"><span class="hljs-string">"highlight"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.MenuHighlight: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.HighlightText: colorString = <span class="hljs-string"><span class="hljs-string">"highlighttext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.InactiveBorder: colorString = <span class="hljs-string"><span class="hljs-string">"inactiveborder"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.GradientInactiveCaption: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.InactiveCaption: colorString = <span class="hljs-string"><span class="hljs-string">"inactivecaption"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.InactiveCaptionText: colorString = <span class="hljs-string"><span class="hljs-string">"inactivecaptiontext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.Info: colorString = <span class="hljs-string"><span class="hljs-string">"infobackground"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.InfoText: colorString = <span class="hljs-string"><span class="hljs-string">"infotext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.MenuBar: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.Menu: colorString = <span class="hljs-string"><span class="hljs-string">"menu"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.MenuText: colorString = <span class="hljs-string"><span class="hljs-string">"menutext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ScrollBar: colorString = <span class="hljs-string"><span class="hljs-string">"scrollbar"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ControlDarkDark: colorString = <span class="hljs-string"><span class="hljs-string">"threeddarkshadow"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ControlLightLight: colorString = <span class="hljs-string"><span class="hljs-string">"buttonhighlight"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.Window: colorString = <span class="hljs-string"><span class="hljs-string">"window"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.WindowFrame: colorString = <span class="hljs-string"><span class="hljs-string">"windowframe"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.WindowText: colorString = <span class="hljs-string"><span class="hljs-string">"windowtext"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c.IsNamedColor) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == Color.LightGray) { <span class="hljs-comment"><span class="hljs-comment">// special case due to mismatch between Html and enum spelling colorString = "LightGrey"; } else { colorString = c.Name; } } else { colorString = "#" + cRToString("X2", null) + cGToString("X2", null) + cBToString("X2", null); } return colorString; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oke, oke, hanya bercanda ... Atau apakah Anda masih menemukan sesuatu? </font><font style="vertical-align: inherit;">Bagaimanapun, mari kita kurangi kodenya untuk secara jelas menyatakan masalahnya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini adalah versi kode pendek:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (c.ToKnownColor()) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.Control: colorString = <span class="hljs-string"><span class="hljs-string">"buttonface"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KnownColor.ControlLight: colorString = <span class="hljs-string"><span class="hljs-string">"buttonface"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3139</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dua atau lebih cabang kasus melakukan tindakan yang sama. </font><font style="vertical-align: inherit;">ColorTranslator.cs 302 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya tidak bisa mengatakan dengan pasti, tapi saya pikir itu adalah kesalahan. </font><font style="vertical-align: inherit;">Dalam kasus lain, ketika pengembang ingin mengembalikan nilai yang sama untuk beberapa enumerator, ia menggunakan beberapa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">case</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mengikuti satu sama lain. </font><font style="vertical-align: inherit;">Dan cukup mudah untuk membuat kesalahan dengan copy-paste di sini, saya pikir. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari menggali lebih dalam. </font><font style="vertical-align: inherit;">Untuk mendapatkan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"buttonface"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari </font><font style="vertical-align: inherit;">metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ToHtml yang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dianalisis </font><font style="vertical-align: inherit;">, Anda bisa meneruskan salah satu dari nilai berikut ini ke sana (diharapkan):</font></font><br><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.Control</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.ControlLight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jika kami memeriksa nilai ARGB untuk masing-masing warna ini, kami akan melihat yang berikut: </font></font><br><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.Control</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(255, 240, 240, 240)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SystemColors.ControlLight - (255, 227, 227, 227)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika kita memanggil metode konversi terbalik </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FromHtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada nilai yang diterima ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"buttonface"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), kita akan mendapatkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontrol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> warna </font><i><font style="vertical-align: inherit;">(255, 240, 240, 240)</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Bisakah kita mendapatkan </font><font style="vertical-align: inherit;">warna </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ControlLight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FromHtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">Ya </font><font style="vertical-align: inherit;">Metode ini berisi tabel warna, yang merupakan dasar untuk menyusun warna (dalam hal ini). </font><font style="vertical-align: inherit;">Inisialisasi tabel memiliki baris berikut:</font></font><br><br><pre> <code class="cpp hljs">s_htmlSysColorTable[<span class="hljs-string"><span class="hljs-string">"threedhighlight"</span></span>] = ColorUtil.FromKnownColor(KnownColor.ControlLight);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan demikian, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FromHtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengembalikan </font><i><font style="vertical-align: inherit;">warna </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ControlLight (255, 227, 227, 227)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"threedhighlight"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Saya pikir itu persis apa yang seharusnya digunakan dalam </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kasusiketahuiColor.ControlLight</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 60</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami akan memeriksa beberapa peringatan menarik dari </font><font style="vertical-align: inherit;">proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Text.RegularExpressions</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextposDescription</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ var sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> remaining; sb.Append(runtextpos); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sb.Length &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) sb.Append(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> - sb.Length); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runtextpos &gt; runtextbeg) sb.Append(RegexCharClass.CharDescription(runtext[runtextpos - <span class="hljs-number"><span class="hljs-number">1</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sb.Append(<span class="hljs-string"><span class="hljs-string">'^'</span></span>); sb.Append(<span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>); remaining = runtextend - runtextpos; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = runtextpos; i &lt; runtextend; i++) { sb.Append(RegexCharClass.CharDescription(runtext[i])); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sb.Length &gt;= <span class="hljs-number"><span class="hljs-number">64</span></span>) { sb.Length = <span class="hljs-number"><span class="hljs-number">61</span></span>; sb.Append(<span class="hljs-string"><span class="hljs-string">"..."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { sb.Append(<span class="hljs-string"><span class="hljs-string">'$'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio warning: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3137 Variabel</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'tersisa' ditugaskan tetapi tidak digunakan pada akhir fungsi. RegexRunner.cs 612 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nilai ditulis dalam </font><font style="vertical-align: inherit;">variabel </font><font style="vertical-align: inherit;">lokal yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tersisa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi tidak lagi digunakan dalam metode. Mungkin, beberapa kode, menggunakannya, dihapus, tetapi variabel itu sendiri dilupakan. Atau ada kesalahan penting dan variabel ini harus entah bagaimana digunakan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 61</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> first, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> last)</span></span></span><span class="hljs-function"> </span></span>{ _rangelist.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleRange(first, last)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_canonical &amp;&amp; _rangelist.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; first &lt;= _rangelist[_rangelist.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>].Last) { _canonical = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bagian dari ekspresi kondisional selalu benar jika dievaluasi: _rangelist.Count&gt; 0. RegexCharClass.cs 523 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penganalisa dengan tepat mencatat, bahwa bagian dari ekspresi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_rangelist.Count&gt; 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan selalu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">benar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jika kode ini dieksekusi. Bahkan jika daftar ini (yang </font><font style="vertical-align: inherit;">menunjuk pada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penginjil</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), kosong, setelah menambahkan elemen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_rangelist.Add (....)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> itu tidak akan sama. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah 62</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita lihat peringatan </font><font style="vertical-align: inherit;">aturan diagnostik </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3128</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam proyek </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Drawing.Common</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Transactions.Local</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayEnumerator</span></span></span><span class="hljs-class"> :</span></span> IEnumerator { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> object[] _array; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> object _item; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _index; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _startIndex; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _endIndex; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ArrayEnumerator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object[] </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">array</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count)</span></span></span><span class="hljs-function"> </span></span>{ _array = <span class="hljs-built_in"><span class="hljs-built_in">array</span></span>; _startIndex = startIndex; _endIndex = _index + count; _index = _startIndex; } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3128</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kolom '_index' digunakan sebelum diinisialisasi dalam konstruktor. PrinterSettings.Windows.cs 1679 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat menginisialisasi </font><font style="vertical-align: inherit;">bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_endIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_index</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lain </font><font style="vertical-align: inherit;">digunakan, yang memiliki nilai standar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">standar (int)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , (yaitu </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) pada saat penggunaannya. Bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_index</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diinisialisasi di bawah. Jika itu bukan kesalahan - </font><font style="vertical-align: inherit;">variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_index</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seharusnya dihilangkan dalam ekspresi ini agar tidak membingungkan. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 63</font></font></b> <br><br><pre> <code class="cpp hljs">internal <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TransactionTable</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _timerInterval; .... <span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TransactionTable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Create a timer that is initially disabled by specifing // an Infinite time to the first interval _timer = new Timer(new TimerCallback(ThreadTimer), null, Timeout.Infinite, _timerInterval); .... // Store the timer interval _timerInterval = 1 &lt;&lt; TransactionTable.timerInternalExponent; .... } }</span></span></code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peringatan PVS-Studio: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3128</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kolom '_timerInterval' digunakan sebelum diinisialisasi dalam konstruktor. TransactionTable.cs 151 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kasusnya mirip dengan yang di atas. Pertama nilai </font><font style="vertical-align: inherit;">bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_timerInterval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> digunakan (saat ini masih </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default (int)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) untuk menginisialisasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_timer.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hanya setelah itu </font><font style="vertical-align: inherit;">bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_timerInterval</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> itu sendiri akan diinisialisasi. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edisi 64</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peringatan berikutnya dikeluarkan oleh aturan diagnostik, yang masih dalam pengembangan. Tidak ada dokumentasi atau pesan terakhir, tetapi kami telah menemukan beberapa fragmen menarik dengan bantuannya. Lagi-lagi fragmen ini terlihat seperti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salin-tempel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , jadi kami hanya akan mempertimbangkan satu fragmen kode.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessNotifyConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... WeakReference reference = (WeakReference)( LdapConnection.s_handleTable[referralFromConnection]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( reference != null &amp;&amp; reference.IsAlive &amp;&amp; null != ((LdapConnection)reference.Target)._ldapHandle) { .... } .... }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio warning (stub):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VXXXX TODO_MESSAGE. LdapSessionOptions.cs 974 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari Caranya Bahwa adalah setelah memeriksa </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reference.IsAlive</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sampah dari kekuatan Dikumpulkan yang BE dan objek, yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para WeakReference</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> poin, BE akan sampah Dikumpulkan. Dalam hal ini, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan mengembalikan nilai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nol</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Akibatnya, ketika mengakses bidang instance </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_ldapHandle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pengecualian dari </font><font style="vertical-align: inherit;">tipe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> akan terjadi. Microsoft sendiri memperingatkan tentang jebakan ini dengan cek IsAlive. Kutipan dari docs.microsoft.com - " </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WeakReference.IsAlive Property</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ":</font></font><i>Because an object could potentially be reclaimed for garbage collection immediately after the IsAlive property returns true, using this property is not recommended unless you are testing only for a false return value.</i> <br><br><h2> Summary on Analysis </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah ini semua kesalahan dan tempat menarik, ditemukan selama analisis? Tentu saja tidak! Ketika melihat melalui hasil analisis, saya benar-benar memeriksa peringatan. Ketika jumlah mereka bertambah dan menjadi jelas ada cukup banyak dari mereka untuk sebuah artikel, saya menggulung hasilnya, mencoba untuk memilih hanya yang menurut saya paling menarik. Ketika saya sampai pada yang terakhir (log terbesar), saya hanya bisa melihat peringatan sampai pemandangan menangkap sesuatu yang tidak biasa. Jadi, jika Anda menggali, saya yakin Anda dapat menemukan tempat-tempat yang jauh lebih menarik. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh, saya dari diabaikan oleh Hampir semua </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3022</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3063</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peringatan. Jadi bisa dikatakan, jika saya menemukan kode seperti itu:</font></font><br><br><pre> <code class="cpp hljs">String str = null; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str == null) ....</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya akan menghilangkannya, karena ada banyak tempat menarik yang ingin saya gambarkan. Ada peringatan tentang penguncian yang tidak aman menggunakan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pernyataan kunci</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan penguncian oleh </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan seterusnya - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3090</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; panggilan acara tidak aman - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3083</font></font></u></a> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> objek, yang jenisnya menerapkan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDisposable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi yang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buang</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tutup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak disebut - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3072</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan diagnostik serupa dan banyak lagi.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya juga tidak mencatat masalah, ditulis dalam tes. Setidaknya, saya mencoba, tetapi tidak sengaja bisa mengambilnya. Kecuali beberapa tempat yang menurut saya cukup menarik untuk menarik perhatian mereka. Tetapi kode pengujian juga dapat mengandung kesalahan, karena itu tes akan bekerja secara tidak benar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secara umum, masih banyak hal yang harus diselidiki - tetapi saya tidak memiliki niat untuk menandai </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">semua masalah yang ditemukan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kualitas kode itu terasa tidak merata bagi saya. Beberapa proyek benar-benar bersih, yang lain berisi tempat-tempat yang mencurigakan. Mungkin kita bisa mengharapkan proyek bersih, terutama ketika datang ke kelas perpustakaan yang paling umum digunakan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Singkatnya, kita dapat mengatakan, bahwa kodenya berkualitas cukup tinggi, karena jumlahnya cukup besar. Tapi, seperti artikel ini sarankan, ada beberapa sudut gelap.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ngomong-ngomong, proyek sebesar ini juga merupakan tes yang bagus untuk penganalisa. </font><font style="vertical-align: inherit;">Saya berhasil menemukan sejumlah peringatan palsu / aneh yang saya pilih untuk dipelajari dan dikoreksi. </font><font style="vertical-align: inherit;">Jadi sebagai hasil analisis, saya berhasil menemukan poin, di mana kita harus bekerja pada PVS-Studio itu sendiri.</font></font><br><br><h2>  Kesimpulan </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda sampai di tempat ini dengan membaca seluruh artikel - biarkan saya menjabat tangan Anda! </font><font style="vertical-align: inherit;">Saya harap saya bisa menunjukkan kepada Anda kesalahan yang menarik dan menunjukkan manfaat analisis statis. </font><font style="vertical-align: inherit;">Jika Anda telah mempelajari sesuatu yang baru untuk diri Anda sendiri, itu akan membuat Anda menulis kode yang lebih baik - saya akan sangat senang.</font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ef/dbc/f2d/6efdbcf2d984bef000cf44face04c6a4.png" alt="Gambar 23"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimanapun, beberapa bantuan oleh analisis statis tidak akan merugikan, jadi sarankan Anda </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mencoba PVS-Studio</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pada proyek Anda dan melihat tempat menarik apa yang dapat ditemukan dengan penggunaannya. </font><font style="vertical-align: inherit;">Jika Anda memiliki pertanyaan atau Anda hanya ingin berbagi fragmen yang menarik - jangan ragu untuk menulis di </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support@viva64.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> :) <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Salam terbaik! </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PS Untuk .NET Core pustaka pengembang </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terima kasih banyak atas apa yang kamu lakukan! </font><font style="vertical-align: inherit;">Kerja bagus! </font><font style="vertical-align: inherit;">Semoga artikel ini akan membantu Anda membuat kode sedikit lebih baik. </font><font style="vertical-align: inherit;">Ingat, bahwa saya belum menulis semua tempat yang mencurigakan dan Anda sebaiknya memeriksa sendiri proyek menggunakan penganalisis. </font><font style="vertical-align: inherit;">Dengan cara ini, Anda dapat menyelidiki semua peringatan secara detail. </font><font style="vertical-align: inherit;">Selain itu, akan lebih mudah untuk bekerja dengannya, daripada dengan log teks sederhana / daftar kesalahan ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saya menulis tentang ini lebih terinci di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id463535/">https://habr.com/ru/post/id463535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id463513/index.html">Kerangka kerja pengembangan web terbaik di tahun 2019</a></li>
<li><a href="../id463515/index.html">Menggunakan HTMS API untuk bekerja dengan database jaringan relasional</a></li>
<li><a href="../id463525/index.html">Selenium, Selenoid, Selenide, Selendroid ... Apa artinya semua ini?</a></li>
<li><a href="../id463527/index.html">Muncul! Ditranskripsikan di iOS</a></li>
<li><a href="../id463533/index.html">Apa yang harus diketahui setiap pengembang sejak awal</a></li>
<li><a href="../id463537/index.html">Verifikasi kode sumber pustaka .NET Core oleh penganalisa statis PVS-Studio</a></li>
<li><a href="../id463541/index.html">Pelatihan Cisco 200-125 CCNA v3.0. Hari 17. Ringkasan dan peta jalan kursus CCNA</a></li>
<li><a href="../id463551/index.html">Bagaimana berhubungan dengan karyawan dan mengatur alur kerja di perusahaan IT besar</a></li>
<li><a href="../id463553/index.html">"Apakah kamu orang google?" atau 5 hal yang kami lakukan saat merekrut (tetapi tidak lagi)</a></li>
<li><a href="../id463559/index.html">Pelatihan Cisco 200-125 CCNA v3.0. Hari 18. Dasar-dasar Routing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>