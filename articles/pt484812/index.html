<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüè´ üññüèΩ ü•ú Minha experi√™ncia com o Plesk üôÖüèΩ üßëüèΩ‚Äçü§ù‚Äçüßëüèª üèπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quero compartilhar algumas impress√µes sobre a necessidade ou a desnecessidade de algo como um painel de controle para um projeto comercial da Web de s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Minha experi√™ncia com o Plesk</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/484812/">  Quero compartilhar algumas impress√µes sobre a necessidade ou a desnecessidade de algo como um painel de controle para um projeto comercial da Web de servidor √∫nico com um administrador de meio per√≠odo.  A hist√≥ria come√ßou h√° alguns anos, quando conhecidos de amigos me pediram para acompanhar a compra de uma empresa - um site de not√≠cias - do ponto de vista t√©cnico.  Era necess√°rio entender um pouco o que estava trabalhando, garantir que todos os detalhes necess√°rios fossem transferidos na forma e no volume adequados e descobrir estrategicamente o que poderia ser melhorado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h_/nh/e1/h_nhe1ce2n1r02nwfk-v2coszz0.png"></div><br>  O acordo ocorreu, o violinista n√£o era mais necess√°rio.  O fim  Na verdade n√£o. <br><a name="habracut"></a><br>  O site estava rodando em um VMk dual-core de 4 GB no Linode, em algum Debian5 musgoso com tempo de atividade de 400 dias e uma lista de pacotes n√£o atualizados.  Web part em Samopisny TsMSke, nginx, php5.3 FPM, mysql ajustado em Percona.  Em princ√≠pio, funcionou. <br><br>  Paralelamente √†s conversas comigo, o novo propriet√°rio procurava um programador para levar o projeto √†s expectativas.  Encontrei.  O programador avaliou o tr√°fego e os volumes e decidiu que era capaz de otimizar e gerenciar custos.  Ele migrou o site inteiro para uma hospedagem compartilhada de 700 rublos, sob o controle de seu IS IS normal.  Alguns dias depois, novamente uma liga√ß√£o do propriet√°rio: "tudo est√° diminuindo a velocidade e parece que est√°vamos quebrados".  Tentei consertar a situa√ß√£o atrav√©s do painel, mas ap√≥s algumas tentativas infrut√≠feras de alterar a vers√£o do PCP ou do manipulador de fcgi para fpm, desisti e entrei no shell.  L√° encontrei a depura√ß√£o inclu√≠da, que brilhava em toda a Internet com uma senha de um m√∫sculo, 777 em algumas pastas que, naquela √©poca, estavam estalando devido a uma avalanche de malvari e jogos similares.  O propriet√°rio percebeu e decidiu que economizar na hospedagem, no programador e no administrador, que olharia de olho em como as coisas est√£o indo, est√° errado. <br><br>  N√≥s estamos indo para o RuVDS.  Um pouco mais perto do que o brit√¢nico Linode, e se voc√™ deseja armazenar dados pessoais e tudo isso de repente, n√£o precisa se mudar para outro lugar.  Como o projeto estava planejado para ser expandido, eles usaram o VMKU "para crescimento": 4 n√∫cleos, 8 GB de mem√≥ria, 80 GB de disco.  N√£o √© que eu n√£o saiba usar as configura√ß√µes do nginx com as m√£os, apenas n√£o tive o entusiasmo de fazer esse projeto t√£o intimamente (veja acima, em tempo parcial).  Porque - coloque o Plesk (aqui vou omitir os detalhes da instala√ß√£o, porque em geral eles n√£o est√£o l√°: lancei o instalador, configurei a senha do administrador, digitei a chave - tudo), na √©poca era 17.0.  As configura√ß√µes b√°sicas funcionam razoavelmente prontas para uso, existem fail2ban e as √∫ltimas vers√µes dispon√≠veis do PHP, nginx. <br><br>  Provavelmente vale a pena parar e explicar o porqu√™.  Como raramente fa√ßo essas coisas e n√£o tenho ferramentas especiais e um conjunto de espa√ßos em branco para cada caso, ficou claro que era necess√°rio algum tipo de automa√ß√£o de coisas b√°sicas, primeiro, r√°pido, segundo, com seguran√ßa e terceiro todas as pr√°ticas recomendadas algu√©m j√° implementou. <br><br>  Ent√£o, pronto.  Ele economizou tempo decentemente, reiniciar o site no novo servidor acabou sendo quase instant√¢neo.  Restava mexer na configura√ß√£o do m√∫sculo, fornecendo metade da mem√≥ria e aumentando o n√∫mero de buffer pools e dando metade dos n√∫cleos ao nginx (o Splash n√£o toca nas configura√ß√µes globais) e entrando no shell por alguns dias para examinar as estat√≠sticas do mysqltuner.  Sim, e comprei um ImunifyAV pago do cat√°logo de extens√µes para me livrar dos malvari inundados.  Havia algo em torno de 11.000 arquivos infectados.  A abomina√ß√£o √© que peda√ßos de c√≥digo ofuscados despejavam a est√°tica, e escov√°-lo com as m√£os seria completamente mon√≥tono.  No come√ßo, tentei o ClamAV, mas ele n√£o aceitou essas coisas, mas o ImunifyAV conseguiu.  Al√©m disso, os arquivos curados permanecem em condi√ß√µes de funcionamento, apenas uma parte do malware √© removida. <br><br>  A aritm√©tica √© simples: US $ 50 por m√™s para o VMku, US $ 10 para o Splash (na verdade, menos, porque voc√™ o comprou imediatamente por um ano com um desconto de dois meses) e US $ 3 para um antiv√≠rus.  Ou muitas malas de dinheiro para o meu tempo, que eu gastaria no servidor a princ√≠pio, ajuntando esses est√°bulos manualmente.  O propriet√°rio est√° muito feliz com esse alinhamento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bed/f5c/257/bedf5c257f2211a4c9a20db4f3662354.png"></div><br>  Enquanto isso, eles encontraram um novo programador.  Concordamos com ele na distribui√ß√£o de responsabilidades, criamos um subdom√≠nio para a vers√£o de teste e o trabalho come√ßou.  Ele viu uma nova vers√£o do site no Laravel, e eu olhei para fail2ban%). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/567/ed3/0eb/567ed30eba271841e9ba2ca1628c908c.png"></div><br>  Curiosamente, o fluxo de curiosos n√£o para, e sempre h√° cerca de cem endere√ßos na lista de endere√ßos proibidos.  O efeito √© interessante: em particular, geralmente, quando vou ao shell, vejo cerca de 20000-30000 tentativas malsucedidas de entrar via SSH na sauda√ß√£o.  Com o fail2ban ativado, cerca de 70. Esfor√ßo investido: 0. Infelizmente, houve uma queda de alcatr√£o.  Por padr√£o, o WAF (modsecurity) era "semi-ativado": no modo de descoberta.  Ou seja, ele escreveu atividades suspeitas no log, mas na verdade n√£o tomou nenhuma a√ß√£o.  E o fail2ban leu indiscriminadamente todos os registros, de acordo com as pris√µes inclu√≠das, e encharcou tudo que se mexia.  Assim, banimos metade da equipe editorial: D.  Eu tive que desativar essa pris√£o e colocar os endere√ßos IP necess√°rios na lista branca para garantir a confiabilidade.  O esfor√ßo √© investido: cutuque duas vezes com o mouse e ensine os editores a dizer seu endere√ßo IP. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2a/59f/5d9/e2a59f5d93ccd9a0345d82631cfed146.png"></div><br>  O que o programador gostou imediatamente foi a capacidade de fazer upload de bancos de dados diretamente no painel e o acesso r√°pido ao phpMyAdmin <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cca/0ef/a51/cca0efa516535e771efaa46456b891b9.png"></div><br>  O que eu gostei - logs e backups.  Os logs s√£o gravados e rotacionados para fora da caixa;  os backups s√£o configurados de maneira muito simples.  Nos momentos mais lentos, √© feito um backup completo, em algum lugar em 10 shows e, em seguida, todos os dias em incrementos de 200 megabytes, por uma semana.  Recupera√ß√£o granular para um arquivo ou banco de dados espec√≠fico.  Se voc√™ precisar restaurar a partir de incremental, n√£o precisar√° se contorcer primeiro com a restaura√ß√£o completa e toda a cadeia, o Splash far√° tudo sozinho.  Voc√™ pode fazer o upload de backups em qualquer lugar: em ftp, dropbox, s3 bucket, google drive e muito mais. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f1/46d/d83/9f146dd83e49e565596513bb1b32bea2.png"></div><br>  Dia F: o programador finalmente terminou o novo mecanismo, o despejamos no produto, importamos os dados antigos e sentamos para escolher a cor do futuro Maserati.  Ainda estamos escolhendo. <br><br>  Os primeiros problemas come√ßaram.  O novo site era provavelmente mais pesado que o antigo, mas o verdadeiro rake foi que o Yandex.Zen foi usado entre outras coisas para atrair tr√°fego, que alcan√ßou os visitantes em lotes.  O site foi dobrado em 150 conex√µes simult√¢neas (n√£o estou falando de RPS, porque n√£o o medi).  Come√ßamos a apertar bot√µes e girar bot√µes na √°rea de configura√ß√µes do php_fpm: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c0/f96/3b3/8c0f963b3771a9452e8dee1ea82ac6cc.png"></div><br>  Op, j√° possui 500 conex√µes.  √Ä medida que o cart√£o de cr√©dito √© aplicado aos meios de promo√ß√£o, as ondas de tr√°fego aumentam.  O pr√≥ximo marco √© de 1000 conex√µes simult√¢neas.  Aqui eu tive que refrear o c√≥digo e olhar para os m√∫sculos da minha alma.  O respingo n√£o ajudou, mas eles realmente n√£o esperavam.  Eles ativaram o log de consultas lentas, travaram √≠ndices no banco de dados, removeram consultas desnecess√°rias do c√≥digo, vasculharam a configura√ß√£o do mysql mais uma vez, seguindo o conselho do mysqltuner. <br><br>  Novo desafio - 2000 conex√µes.  Consegui apenas lan√ßar a vers√£o Plesk 17.8, na qual, entre outras coisas, danificava o cache do nginx.  Atualizado (surpreendentemente f√°cil).  N√≥s tentamos.  Isso funciona!  E ent√£o eles entraram suavemente, o feed Yandex.Zen parou de funcionar.  O site est√° funcionando, o feed n√£o est√° funcionando.  O feed n√£o funciona, sem tr√°fego.  A atmosfera est√° esquentando.  Sob a press√£o das circunst√¢ncias e a falta de imagina√ß√£o, imediatamente subi ao nginx e encontrei o que estava procurando.  Acontece que, em algum momento, o est√∫pido nginx armazenou em cache o 500¬∫ erro em tempo real, como uma resposta ao Yandex get feed.xml.  Corrigido adicionando exce√ß√µes √†s configura√ß√µes de cache: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c5/168/69b/8c516869b5e3fdb0ef6c79774d829940.png"></div><br>  √â claro que o propriet√°rio precisa AINDA, as ondas est√£o aumentando lentamente.  Enquanto estamos lidando com isso, mas come√ßamos a experimentar antecipadamente o memcached, pois o Laravel o suporta quase que imediatamente.  De alguma forma, eu n√£o queria colocar o memcached em minhas m√£os para brincar, ent√£o instalei a imagem do docker.  Diretamente do painel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07e/083/342/07e083342590e63f033747c7dfe7f013.png"></div><br>  Bem, estou mentindo, tive que entrar no shell e colocar o m√≥dulo no pecl.  Diretamente de acordo com as <a href="https://support.plesk.com/hc/en-us/articles/115001544133-Unable-to-install-memcached-PHP-module-memcached-support-requires-libmemcached">instru√ß√µes</a> .  N√£o h√° nada a dizer sobre o aumento na taxa de transfer√™ncia, n√£o houve influxos grandes o suficiente.  O mecanismo do site pegou no localhost: 11211, as estat√≠sticas s√£o mostradas, a mem√≥ria est√° consumindo.  Se voc√™ gosta, vamos ver o que fazer a seguir.  Deixe assim ou coloque o "real" no Eixo.  Ou tente redis da mesma maneira <br><br>  Ent√£o eu precisava anexar uma lista de discuss√£o.  Sem rel√©s, apenas autentica√ß√£o SMTP.  Eu tenho um endere√ßo para correspond√™ncia, atrav√©s dos detalhes atrav√©s do PHP, fazemos o boletim. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/107/53e/269/10753e269e8ea0736ba771a506e04c28.png"></div><br>  H√° n√£o muito tempo, o Plesk Obsidian (18.0) foi lan√ßado, atualizado de acordo com a experi√™ncia passada sem medo.  Tudo correu muito bem, n√£o h√° nada para falar.  Do agrad√°vel - a interface melhorou muito a qualidade, modernizou-se e tornou-se mais conveniente em alguns lugares.  Cool piece Monitoramento avan√ßado no Grafana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/921/e9d/230/921e9d230ede253edc7e479a3a435c94.png"></div><br>  Ainda n√£o descobri, mas voc√™ pode, por exemplo, configurar alertas para qualquer par√¢metro no e-mail.  Para o propriet√°rio, lol. <br><br>  Como estou falando da interface, ela √© adapt√°vel e funciona muito bem no telefone.  Nos est√°gios iniciais, enquanto tent√°vamos encontrar as configura√ß√µes ideais do PHP e outras coisas, isso ajudou muito.  E, especialmente, quando um programador com um entusiasmo profissional faz algo √†s 23 horas, e eu bebo vodka no banho com um entusiasmo profissional, e urgentemente preciso mudar alguma coisa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/865/dbc/dd9/865dbcdd9b452936c3450cae4067bbc9.png"></div><br>  Ah, a prop√≥sito.  Na foto, o PHP Composer apareceu.  Ainda n√£o brincamos com ele, mas, digamos, para o mesmo Laravel, ele pode salvar alguns logins no shell e algum tempo para instalar depend√™ncias.  O mesmo sistema existe para Node.JS e Ruby. <br><br>  Com o SSL, tudo √© simples.  Se o dom√≠nio resolver onde deveria estar, o Let's Encrypt ser√° feito com um clique e ser√° atualizado ainda mais, tanto no pr√≥prio dom√≠nio quanto nos subdom√≠nios e at√© nos servi√ßos de correio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/e59/c84/ffee59c848d2cdc814028a527fbeeda7.png"></div><br>  O pr√≥prio Plesk, como software, √© atualmente bastante agrad√°vel e est√°vel.  Atualiza-se e o Eixo √© silencioso, consome poucos recursos, funciona sem problemas.  Eu nem me lembro que em algum lugar pisei em algo, o que seria um defeito claro no produto.  Obviamente, houve problemas, mas eles foram causados ‚Äã‚Äãpor imperfei√ß√µes da configura√ß√£o ou em algum lugar do cruzamento, portanto n√£o havia o que reclamar.  As impress√µes de trabalhar com o Splash geralmente s√£o agrad√°veis.  O que est√° faltando nele, e √© preciso entender isso, √© qualquer (qualquer) cluster.  Nem LB nem HA.  Voc√™ pode tentar, mas haver√° tanto esfor√ßo investido que √© melhor fazer algo diferente inicialmente. <br><br>  Eu acho que voc√™ pode resumir.  Para o caso em que n√£o h√° administrador, ou n√£o √© suficiente, quando o pre√ßo da hospedagem e o (s) site (s) rodando nele excederem, digamos 100u.e. vale a pena optar por contratar um administrador em per√≠odo parcial ou comprar um software e obter um administrador por "meio per√≠odo", ou simplesmente n√£o iniciar - definitivamente faz sentido.  Do ponto de vista do administrador remoto - a mesma coisa.  10 $ por m√™s, economiza tempo e oferece flexibilidade no trabalho por uma quantia muito grande.  Se, por exemplo, me pedem fortemente que assuma um projeto semelhante, insistirei no transporte para Plesk. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484812/">https://habr.com/ru/post/pt484812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484798/index.html">Por que a classifica√ß√£o r√°pida √© realmente lenta? Novo m√©todo de classifica√ß√£o de matriz</a></li>
<li><a href="../pt484800/index.html">Analisador de C√≥digo-Fonte do Microsoft Application Inspector</a></li>
<li><a href="../pt484802/index.html">Modo de autodestrui√ß√£o: decomposi√ß√£o da c√°psula endosc√≥pica devido √† luz</a></li>
<li><a href="../pt484804/index.html">O que criptografar em um sistema corporativo? E por que isso?</a></li>
<li><a href="../pt484806/index.html">Diferen√ßa entre cPanel e Plesk Obsidian</a></li>
<li><a href="../pt484814/index.html">6. Introdu√ß√£o ao Fortinet v6.0. Filtragem da Web e controle de aplicativos</a></li>
<li><a href="../pt484816/index.html">Usando ganchos de opera√ß√µes para fazer backup de arquivos no macOS em tempo real</a></li>
<li><a href="../pt484818/index.html">O livro "C ++. A pr√°tica da programa√ß√£o multithread "</a></li>
<li><a href="../pt484820/index.html">FAQ.Net - um programa gratuito de anota√ß√µes para Windows com um design atualizado</a></li>
<li><a href="../pt484822/index.html">Blazor: como evitar que um componente fique doente ou duas abordagens para separar o c√≥digo da marca√ß√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>