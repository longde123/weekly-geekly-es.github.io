<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¿â€ğŸš’ ğŸ’ƒğŸ½ ğŸ‘‹ğŸ¾ R tidyrè½¯ä»¶åŒ…åŠå…¶æ–°çš„ivot_longerå’Œpivot_widerå‡½æ•° ğŸ–¥ï¸ ğŸ˜ ğŸˆ³</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="tidyrè½¯ä»¶åŒ…æ˜¯Rè¯­è¨€-tidyverseä¸­æœ€å—æ¬¢è¿çš„åº“ä¹‹ä¸€çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ 
 è¯¥è½¯ä»¶åŒ…çš„ä¸»è¦ç›®çš„æ˜¯ä½¿æ•°æ®å¤–è§‚æ•´æ´ã€‚ 


 åœ¨HabrÃ©ä¸Šå·²ç»æœ‰ä¸“é—¨é’ˆå¯¹æ­¤è½¯ä»¶åŒ…çš„å‡ºç‰ˆç‰© ï¼Œä½†æ˜¯å®ƒå¯ä»¥è¿½æº¯åˆ°2015å¹´ã€‚ æˆ‘æƒ³å‘Šè¯‰æ‚¨æœ€ç›¸å…³çš„æ›´æ”¹ï¼Œå‡ å¤©å‰å…¶ä½œè€…å“ˆå¾·åˆ©Â·å¨å…‹æ±‰å§†ï¼ˆHadley Wickhamï¼‰å®£å¸ƒäº†è¿™ä¸€æ›´...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R tidyrè½¯ä»¶åŒ…åŠå…¶æ–°çš„ivot_longerå’Œpivot_widerå‡½æ•°</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444622/"><p>  <strong>tidyr</strong>è½¯ä»¶åŒ…æ˜¯Rè¯­è¨€<strong>-tidyverseä¸­</strong>æœ€å—æ¬¢è¿çš„åº“ä¹‹ä¸€çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ <br> è¯¥è½¯ä»¶åŒ…çš„ä¸»è¦ç›®çš„æ˜¯ä½¿æ•°æ®å¤–è§‚æ•´æ´ã€‚ </p><br><p> åœ¨HabrÃ©ä¸Šå·²ç»æœ‰ä¸“é—¨é’ˆå¯¹æ­¤è½¯ä»¶åŒ…çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡ºç‰ˆç‰©</a> ï¼Œä½†æ˜¯å®ƒå¯ä»¥è¿½æº¯åˆ°2015å¹´ã€‚ æˆ‘æƒ³å‘Šè¯‰æ‚¨æœ€ç›¸å…³çš„æ›´æ”¹ï¼Œå‡ å¤©å‰å…¶ä½œè€…å“ˆå¾·åˆ©Â·å¨å…‹æ±‰å§†ï¼ˆHadley Wickhamï¼‰å®£å¸ƒäº†è¿™ä¸€æ›´æ”¹ã€‚ </p><br><img src="https://habrastorage.org/getpro/habr/post_images/21a/cf9/6f5/21acf96f56c9b005b125708f5b122a2b.png" alt="å›¾ç‰‡"><br><blockquote> <b>SJK</b> ï¼šæ˜¯å¦<b>ä¼šä¸å»ºè®®ä½¿ç”¨</b> collectï¼ˆï¼‰å’Œspreadï¼ˆï¼‰å‡½æ•°ï¼Ÿ <br><br>  <b>å“ˆå¾·åˆ©Â·å¨å…‹å§†ï¼ˆHadley Wickhamï¼‰</b> ï¼šåœ¨æŸç§ç¨‹åº¦ä¸Šã€‚ æˆ‘ä»¬å°†ä¸å†å»ºè®®ä½¿ç”¨è¿™äº›åŠŸèƒ½å¹¶æ›´æ­£å®ƒä»¬ä¸­çš„é”™è¯¯ï¼Œä½†å®ƒä»¬å°†ç»§ç»­ä»¥å½“å‰çŠ¶æ€å‡ºç°åœ¨åŒ…è£…ä¸­ã€‚ </blockquote><a name="habracut"></a><br><h2 id="soderzhanie"> ç›®å½•å†…å®¹ </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TidyDataæ¦‚å¿µ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">tidyrè½¯ä»¶åŒ…ä¸­åŒ…å«çš„ä¸»è¦åŠŸèƒ½</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†æ•°æ®ä»å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼ï¼Œåä¹‹äº¦ç„¶çš„æ–°æ¦‚å¿µ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„tidyr 0.8.3.9000</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ‡æ¢åˆ°æ–°åŠŸèƒ½</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†æ•°æ®ä»å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼çš„ç®€å•ç¤ºä¾‹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŠ€æœ¯æŒ‡æ ‡</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨å¤šä¸ªå€¼ï¼ˆ.valueï¼‰çš„è§„èŒƒ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†æ—¥æœŸå¸§ä»é•¿è½¬æ¢ä¸ºå®½</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†è¡¨è½¬æ¢ä¸ºå®½æ ¼å¼çš„æœ€ç®€å•ç¤ºä¾‹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»å¤šä¸ªæºå˜é‡ç”Ÿæˆåˆ—å</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€äº›ä½¿ç”¨æ–°æ½®æ±æ¦‚å¿µçš„é«˜çº§ç¤ºä¾‹</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»¥ç¾å›½æ”¶å…¥å’Œç§Ÿé‡‘æ™®æŸ¥æ•°æ®é›†ä¸ºä¾‹ï¼Œä½¿æ•°æ®æ•´æ´</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸–ç•Œé“¶è¡Œ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è”ç»œäººæ¸…å•</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»“è®º</a> </li></ul><br><h2 id="koncepciya-tidydata">  TidyDataæ¦‚å¿µ </h2><br><p>  <strong>tidyr</strong>çš„ç›®çš„æ˜¯å¸®åŠ©æ‚¨å°†æ•°æ®å‘ˆç°ä¸ºæ‰€è°“çš„æ•´æ´å¤–è§‚ã€‚ å‡†ç¡®çš„æ•°æ®æ˜¯å…¶ä¸­çš„æ•°æ®ï¼š </p><br><ul><li> æ¯ä¸ªå˜é‡éƒ½åœ¨ä¸€åˆ—ä¸­ã€‚ </li><li> æ¯ä¸ªè§‚å¯Ÿç»“æœéƒ½æ˜¯ä¸€æ¡çº¿ã€‚ </li><li> æ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªå•å…ƒæ ¼ã€‚ </li></ul><br><p> èµ‹äºˆæ•´æ´æ•°æ®çš„æ•°æ®åœ¨åˆ†æè¿‡ç¨‹ä¸­ä½¿ç”¨èµ·æ¥æ›´ç®€å•ï¼Œæ›´æ–¹ä¾¿ã€‚ </p><br><h2 id="osnovnye-funkcii-vhodyaschie-v-paket-tidyr">  tidyrè½¯ä»¶åŒ…ä¸­åŒ…å«çš„ä¸»è¦åŠŸèƒ½ </h2><br><p>  tidyråŒ…å«ä¸€ç»„ç”¨äºè½¬æ¢è¡¨çš„å‡½æ•°ï¼š </p><br><ul><li> <code>fill()</code> -ç”¨å…ˆå‰çš„å€¼å¡«å……åˆ—ä¸­çš„ç¼ºå¤±å€¼ï¼› </li><li>  <code>separate()</code> -é€šè¿‡åˆ†éš”ç¬¦å°†ä¸€ä¸ªå­—æ®µåˆ†æˆå¤šä¸ªå­—æ®µï¼› </li><li>  <code>unite()</code> -æ‰§è¡Œå°†å‡ ä¸ªå­—æ®µç»„åˆä¸ºä¸€ä¸ªå­—æ®µçš„æ“ä½œï¼Œä¸split <code>separate()</code>å‡½æ•°ç›¸åã€‚ </li><li>  <code>pivot_longer()</code> -ä¸€ç§å°†æ•°æ®ä»å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼çš„å‡½æ•°ï¼› </li><li>  <code>pivot_wider()</code> -ä¸€ç§å°†æ•°æ®ä»é•¿æ ¼å¼è½¬æ¢ä¸ºå®½æ ¼å¼çš„å‡½æ•°ã€‚ è¯¥æ“ä½œä¸<code>pivot_longer()</code>å‡½æ•°æ‰§è¡Œçš„æ“ä½œç›¸åã€‚ </li><li>  <strong>ä¸æ¨èä½¿ç”¨</strong> <code>gather()</code> -ä¸€ç§å°†æ•°æ®ä»å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼çš„å‡½æ•°ï¼› </li><li>  <strong>ä¸æ¨èä½¿ç”¨split</strong> <code>spread()</code> -ä¸€ç§å°†æ•°æ®ä»é•¿æ ¼å¼è½¬æ¢ä¸ºå®½æ ¼å¼çš„å‡½æ•°ã€‚  <code>gather()</code>å‡½æ•°æ‰§è¡Œçš„æ“ä½œçš„ç›¸åæ“ä½œã€‚ </li></ul><br><h2 id="novaya-koncepciya-preobrazovaniya-dannyh-iz-shirokogo-formata-v-dlinnyy-i-naoborot"> å°†æ•°æ®ä»å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼ï¼Œåä¹‹äº¦ç„¶çš„æ–°æ¦‚å¿µ </h2><br><p> ä»¥å‰ï¼Œå‡½æ•°<code>gather()</code>å’Œ<code>spread()</code>ç”¨äºè¿™ç§è½¬æ¢ã€‚ å¤šå¹´æ¥ï¼Œè¿™äº›åŠŸèƒ½çš„å­˜åœ¨å¯¹æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬ç¨‹åºåŒ…çš„ä½œè€…ï¼‰è€Œè¨€ï¼Œè¿™äº›åŠŸèƒ½çš„åç§°åŠå…¶å‚æ•°éƒ½ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œå¹¶ä¸”åœ¨æŸ¥æ‰¾å®ƒä»¬ä»¥åŠç†è§£è¿™äº›åŠŸèƒ½ä¸­çš„å“ªäº›ä½¿æ—¥æœŸèŒƒå›´ä»å®½åˆ°é•¿æ–¹é¢é€ æˆäº†å›°éš¾ã€‚æ ¼å¼ï¼Œåä¹‹äº¦ç„¶ã€‚ </p><br><p> åœ¨è¿™æ–¹é¢ï¼Œ <strong>tidyr</strong>ä¸­æ·»åŠ äº†ä¸¤ä¸ªæ–°çš„é‡è¦åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æ—¨åœ¨è½¬æ¢æ—¥æœŸèŒƒå›´ã€‚ </p><br><p> æ–°åŠŸèƒ½<code>pivot_longer()</code>å’Œ<code>pivot_wider()</code>çš„çµæ„Ÿæ¥è‡ªJohn Mountå’ŒNina Zumelåˆ›å»ºçš„<strong>cdata</strong>åŒ…ä¸­çš„æŸäº›åŠŸèƒ½ã€‚ </p><br><h3 id="ustanovka-naibolee-aktualnoy-versii-tidyr-0839000"> å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„tidyr 0.8.3.9000 </h3><br><p> è¦å®‰è£…æ–°çš„æœ€æ–°ç‰ˆæœ¬çš„<strong>tidyr 0.8.3.9000</strong> <em>è½¯ä»¶åŒ…</em> ï¼ˆå…¶ä¸­æä¾›äº†æ–°åŠŸèƒ½ï¼‰ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹ä»£ç ã€‚ </p><br><p> <code>devtools::install_github("tidyverse/tidyr")</code> </p> <br><p> åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¿™äº›åŠŸèƒ½ä»…åœ¨GitHubä¸Šçš„è½¯ä»¶åŒ…çš„devç‰ˆæœ¬ä¸­å¯ç”¨ã€‚ </p><br><h3 id="perehod-na-novye-funkcii"> åˆ‡æ¢åˆ°æ–°åŠŸèƒ½ </h3><br><p> å®é™…ä¸Šï¼Œè½¬ç§»æ—§è„šæœ¬ä»¥ä½¿ç”¨æ–°åŠŸèƒ½å¹¶ä¸éš¾ï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘å°†ä»¥æ—§å‡½æ•°çš„æ–‡æ¡£ä¸ºä¾‹ï¼Œå¹¶è¯´æ˜å¦‚ä½•ä½¿ç”¨æ–°çš„<code>pivot_*()</code>å‡½æ•°æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ </p><br><p> å°†å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ”¶é›†åŠŸèƒ½æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ä»£ç </b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># example library(dplyr) stocks &lt;- data.frame( time = as.Date('2009-01-01') + 0:9, X = rnorm(10, 0, 1), Y = rnorm(10, 0, 2), Z = rnorm(10, 0, 4) ) # old stocks_gather &lt;- stocks %&gt;% gather(key = stock, value = price, -time) # new stocks_long &lt;- stocks %&gt;% pivot_longer(cols = -time, names_to = "stock", values_to = "price")</code> </pre></div></div><br><p> å°†é•¿æ ¼å¼è½¬æ¢ä¸ºå®½æ ¼å¼ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ‰©å±•åŠŸèƒ½æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ä»£ç </b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># old stocks_spread &lt;- stocks_gather %&gt;% spread(key = stock, value = price) # new stock_wide &lt;- stocks_long %&gt;% pivot_wider(names_from = "stock", values_from = "price")</code> </pre></div></div><br><p> å› ä¸º åœ¨ä¸Šé¢ä½¿ç”¨<code>pivot_longer()</code>å’Œ<code>pivot_wider()</code>ç¤ºä¾‹ä¸­ï¼Œåœ¨æºè¡¨<em>åº“</em>ä¸­ï¼Œ <em>names_to</em>å’Œ<em>values_toå‚æ•°</em>ä¸­æœªåˆ—å‡ºä»»ä½•åˆ—<em>ï¼Œ</em>å®ƒä»¬çš„åç§°å¿…é¡»ç”¨å¼•å·å¼•èµ·æ¥ã€‚ </p><br><p> åœ¨è¡¨æ ¼çš„å¸®åŠ©ä¸‹ï¼Œæ‚¨å¯ä»¥æœ€è½»æ¾åœ°å¼„æ¸…æ¥šå¦‚ä½•åˆ‡æ¢åˆ°ä½¿ç”¨æ–°çš„<strong>tidyr</strong>æ¦‚å¿µã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/127/fc7/70a/127fc770a8175c98168864954e498199.png" alt="å›¾ç‰‡"></p><br><h2 id="primechanie-ot-avtora"> ä½œè€…æ³¨ </h2><br><blockquote> ä¸‹é¢çš„æ‰€æœ‰æ–‡æœ¬éƒ½æ˜¯é€‚åº”æ€§çš„ï¼Œæˆ‘ä»€è‡³è¦è¯´è¯´tidyverseåº“çš„å®˜æ–¹ç½‘ç«™ä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°æ’å›¾</a>çš„å…è´¹ç¿»è¯‘ã€‚ </blockquote><br><h2 id="prostoy-primer-preobrazovaniya-dannyh-iz-shirokogo-formata-v-dlinnyy"> å°†æ•°æ®ä»å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼çš„ç®€å•ç¤ºä¾‹ </h2><br><p>  <code>pivot_longer ()</code> -é€šè¿‡å‡å°‘åˆ—æ•°å’Œå¢åŠ è¡Œæ•°æ¥ä½¿æ•°æ®é›†æ›´é•¿ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/760/8bb/c5d/7608bbc5d0873682bb5cb8ad3fb9857e.png" alt="å›¾ç‰‡"></p><br><p> è¦è¿è¡Œæœ¬æ–‡ä¸­æä¾›çš„ç¤ºä¾‹ï¼Œæ‚¨å¿…é¡»é¦–å…ˆè¿æ¥å¿…è¦çš„ç¨‹åºåŒ…ï¼š </p><br><pre> <code class="plaintext hljs">library(tidyr) library(dplyr) library(readr)</code> </pre> <br><p> å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¼ è¡¨ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹è°ƒæŸ¥ç»“æœï¼Œå…¶ä¸­ï¼ˆå…¶ä¸­åŒ…æ‹¬ï¼‰è¯¢é—®äººä»¬å…¶å®—æ•™ä¿¡ä»°å’Œå¹´æ”¶å…¥ï¼š </p><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 18 x 11 #&gt; religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` #&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 Agnostic 27 34 60 81 76 137 #&gt; 2 Atheist 12 27 37 52 35 70 #&gt; 3 Buddhist 27 21 30 34 33 58 #&gt; 4 Catholic 418 617 732 670 638 1116 #&gt; 5 Don't kâ€¦ 15 14 15 11 10 35 #&gt; 6 Evangelâ€¦ 575 869 1064 982 881 1486 #&gt; 7 Hindu 1 9 7 9 11 34 #&gt; 8 Historiâ€¦ 228 244 236 238 197 223 #&gt; 9 Jehovahâ€¦ 20 27 24 24 21 30 #&gt; 10 Jewish 19 19 25 25 30 95 #&gt; # â€¦ with 8 more rows, and 4 more variables: `$75-100k` &lt;dbl&gt;, #&gt; # `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;, `Don't know/refused` &lt;dbl&gt;</code> </pre> <br><p> è¯¥è¡¨æŒ‰è¡ŒåŒ…å«å—è®¿è€…çš„å®—æ•™æ•°æ®ï¼Œæ”¶å…¥æ°´å¹³åˆ†æ•£åœ¨å„åˆ—åç§°ä¸­ã€‚ æ¥è‡ªæ¯ä¸ªç±»åˆ«çš„å—è®¿è€…æ•°é‡å­˜å‚¨åœ¨å®—æ•™å’Œæ”¶å…¥æ°´å¹³ç›¸äº¤çš„å•å…ƒæ ¼å€¼ä¸­ã€‚ è¦å°†è¡¨æ ¼è°ƒæ•´ä¸ºæ•´æ´ï¼Œæ­£ç¡®çš„æ ¼å¼ï¼Œåªéœ€ä½¿ç”¨<code>pivot_longer()</code> ï¼š </p><br><pre> <code class="plaintext hljs">pew %&gt;% pivot_longer(cols = -religion, names_to = "income", values_to = "count")</code> </pre> <br><pre> <code class="plaintext hljs">pew %&gt;% pivot_longer(cols = -religion, names_to = "income", values_to = "count") #&gt; # A tibble: 180 x 3 #&gt; religion income count #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 Agnostic &lt;$10k 27 #&gt; 2 Agnostic $10-20k 34 #&gt; 3 Agnostic $20-30k 60 #&gt; 4 Agnostic $30-40k 81 #&gt; 5 Agnostic $40-50k 76 #&gt; 6 Agnostic $50-75k 137 #&gt; 7 Agnostic $75-100k 122 #&gt; 8 Agnostic $100-150k 109 #&gt; 9 Agnostic &gt;150k 84 #&gt; 10 Agnostic Don't know/refused 96 #&gt; # â€¦ with 170 more rows</code> </pre> <br><p> å‚æ•°<code>pivot_longer()</code> </p><br><ul><li> ç¬¬ä¸€ä¸ªå‚æ•°<em>cols</em>æè¿°è¦åˆå¹¶çš„åˆ—ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤<em>time</em>å¤–çš„æ‰€æœ‰åˆ—ã€‚ </li><li>  <em>names_to</em>å‚æ•°ç»™å‡ºå°†ä»æˆ‘ä»¬åˆå¹¶çš„åˆ—åç§°åˆ›å»ºçš„å˜é‡çš„åç§°ã€‚ </li><li>  <em>values_to</em>ç»™å‡ºå°†ä»å­˜å‚¨åœ¨è”æ¥åˆ—çš„å•å…ƒæ ¼å€¼ä¸­çš„æ•°æ®åˆ›å»ºçš„å˜é‡çš„åç§°ã€‚ </li></ul><br><h2 id="specifikacii"> æŠ€æœ¯æŒ‡æ ‡ </h2><br><p> è¿™æ˜¯<strong>tidyr</strong>è½¯ä»¶åŒ…çš„æ–°åŠŸèƒ½ï¼Œä»¥å‰åœ¨ä½¿ç”¨è¿‡æ—¶çš„åŠŸèƒ½æ—¶ä¸å¯ç”¨ã€‚ </p><br><p> è§„èŒƒæ˜¯ä¸€ä¸ªæ•°æ®æ¡†ï¼Œå…¶æ¯ä¸€è¡Œå¯¹åº”äºæ–°çš„è¾“å‡ºæ—¥æœŸæ¡†ä¸­çš„ä¸€åˆ—ï¼Œä»¥åŠä¸¤ä¸ªä»¥ä¸‹åˆ—å¼€å¤´çš„ç‰¹æ®Šåˆ—ï¼š </p><br><ul><li>  <em>.name</em>åŒ…å«åˆ—çš„åŸå§‹åç§°ã€‚ </li><li>  <em>.value</em>åŒ…å«å•å…ƒæ ¼å€¼å°†è¿›å…¥çš„åˆ—çš„åç§°ã€‚ </li></ul><br><p> è§„èŒƒçš„å…¶ä½™åˆ—åæ˜ äº†<em>.nameä¸­</em>å¯å‹ç¼©åˆ—çš„åç§°å°†å¦‚ä½•åœ¨æ–°åˆ—ä¸­æ˜¾ç¤ºã€‚ </p><br><p> è¯¥è§„èŒƒæè¿°äº†å­˜å‚¨åœ¨åˆ—åä¸­çš„å…ƒæ•°æ®ï¼Œæ¯ä¸€åˆ—ä¸€è¡Œï¼Œæ¯ä¸€ä¸ªå˜é‡ä¸åˆ—åç»„åˆåœ¨ä¸€èµ·ï¼Œè¿™ä¸€å®šä¹‰ç°åœ¨çœ‹æ¥ä¼¼ä¹ä»¤äººå›°æƒ‘ï¼Œä½†æ˜¯è€ƒè™‘äº†å‡ ä¸ªç¤ºä¾‹ä¹‹åï¼Œä¸€åˆ‡å°†å˜å¾—æ›´åŠ æ¸…æ™°ã€‚ </p><br><p> è¯¥è§„èŒƒçš„å«ä¹‰æ˜¯æ‚¨å¯ä»¥æ£€ç´¢ï¼Œä¿®æ”¹å’Œè®¾ç½®è½¬æ¢åçš„æ•°æ®æ¡†çš„æ–°å…ƒæ•°æ®ã€‚ </p><br><p> å½“å°†è¡¨ä»å®½æ ¼å¼è½¬æ¢ä¸ºé•¿æ ¼å¼æ—¶ï¼Œ <code>pivot_longer_spec()</code>å‡½æ•°<code>pivot_longer_spec()</code>å¤„ç†è§„èŒƒã€‚ </p><br><p> è¯¥å‡½æ•°å¦‚ä½•å·¥ä½œï¼Œéœ€è¦ä»»ä½•æ—¥æœŸæ¡†æ¶ï¼Œå¹¶å¦‚ä¸Šæ‰€è¿°ç”Ÿæˆå…¶å…ƒæ•°æ®ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<strong>tidyr</strong>åŒ…éšé™„çš„whoæ•°æ®é›†ã€‚ è¯¥æ•°æ®é›†åŒ…å«å›½é™…å«ç”Ÿç»„ç»‡æä¾›çš„æœ‰å…³ç»“æ ¸ç—…å‘ç—…ç‡çš„ä¿¡æ¯ã€‚ </p><br><pre> <code class="plaintext hljs">who #&gt; # A tibble: 7,240 x 60 #&gt; country iso2 iso3 year new_sp_m014 new_sp_m1524 new_sp_m2534 #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 Afghanâ€¦ AF AFG 1980 NA NA NA #&gt; 2 Afghanâ€¦ AF AFG 1981 NA NA NA #&gt; 3 Afghanâ€¦ AF AFG 1982 NA NA NA #&gt; 4 Afghanâ€¦ AF AFG 1983 NA NA NA #&gt; 5 Afghanâ€¦ AF AFG 1984 NA NA NA #&gt; 6 Afghanâ€¦ AF AFG 1985 NA NA NA #&gt; 7 Afghanâ€¦ AF AFG 1986 NA NA NA #&gt; 8 Afghanâ€¦ AF AFG 1987 NA NA NA #&gt; 9 Afghanâ€¦ AF AFG 1988 NA NA NA #&gt; 10 Afghanâ€¦ AF AFG 1989 NA NA NA #&gt; # â€¦ with 7,230 more rows, and 53 more variables</code> </pre> <br><p> æˆ‘ä»¬æ„é€ å®ƒçš„è§„èŒƒã€‚ </p><br><pre> <code class="plaintext hljs">spec &lt;- who %&gt;% pivot_longer_spec(new_sp_m014:newrel_f65, values_to = "count")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 56 x 3 #&gt; .name .value name #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 new_sp_m014 count new_sp_m014 #&gt; 2 new_sp_m1524 count new_sp_m1524 #&gt; 3 new_sp_m2534 count new_sp_m2534 #&gt; 4 new_sp_m3544 count new_sp_m3544 #&gt; 5 new_sp_m4554 count new_sp_m4554 #&gt; 6 new_sp_m5564 count new_sp_m5564 #&gt; 7 new_sp_m65 count new_sp_m65 #&gt; 8 new_sp_f014 count new_sp_f014 #&gt; 9 new_sp_f1524 count new_sp_f1524 #&gt; 10 new_sp_f2534 count new_sp_f2534 #&gt; # â€¦ with 46 more rows</code> </pre> <br><p> å­—æ®µ<em>country</em> ï¼Œ <em>iso2</em> ï¼Œ <em>iso3</em>å·²ç»æ˜¯å˜é‡ã€‚ æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å°†åˆ—ä»<em>new_sp_m014</em>ç¿»è½¬åˆ°<em>newrel_f65</em> ã€‚ </p><br><p> è¿™äº›åˆ—çš„åç§°å­˜å‚¨ä»¥ä¸‹ä¿¡æ¯ï¼š </p><br><ul><li> å‰ç¼€<code>new_</code>è¡¨ç¤ºè¯¥åˆ—åŒ…å«æœ‰å…³ç»“æ ¸ç—…æ–°ç—…ä¾‹çš„æ•°æ®ï¼Œå½“å‰æ—¥æœŸæ¡†æ¶ä»…åŒ…å«æœ‰å…³æ–°ç–¾ç—…çš„ä¿¡æ¯ï¼Œå› æ­¤è¯¥å‰ç¼€åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ä¸å…·æœ‰ä»»ä½•æ„ä¹‰ã€‚ </li><li>  <code>sp</code> / <code>rel</code> / <code>sp</code> / <code>ep</code>æè¿°äº†ä¸€ç§è¯Šæ–­ç–¾ç—…çš„æ–¹æ³•ã€‚ </li><li>  <code>m</code> / <code>f</code>æ‚£è€…æ€§åˆ«ã€‚ </li><li>  <code>014</code>æ‚£è€…çš„å¹´é¾„èŒƒå›´ã€‚ </li></ul><br><p> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„<code>extract()</code>å‡½æ•°æ¥åˆ†éš”è¿™äº›åˆ—ã€‚ </p><br><pre> <code class="plaintext hljs">spec &lt;- spec %&gt;% extract(name, c("diagnosis", "gender", "age"), "new_?(.*)_(.)(.*)")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 56 x 5 #&gt; .name .value diagnosis gender age #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 new_sp_m014 count sp m 014 #&gt; 2 new_sp_m1524 count sp m 1524 #&gt; 3 new_sp_m2534 count sp m 2534 #&gt; 4 new_sp_m3544 count sp m 3544 #&gt; 5 new_sp_m4554 count sp m 4554 #&gt; 6 new_sp_m5564 count sp m 5564 #&gt; 7 new_sp_m65 count sp m 65 #&gt; 8 new_sp_f014 count sp f 014 #&gt; 9 new_sp_f1524 count sp f 1524 #&gt; 10 new_sp_f2534 count sp f 2534 #&gt; # â€¦ with 46 more rows</code> </pre> <br><p> è¯·æ³¨æ„ï¼Œ <em>.name</em>åˆ—å¿…é¡»ä¿æŒä¸å˜ï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬åœ¨æºæ•°æ®é›†çš„åˆ—åä¸­çš„ç´¢å¼•ã€‚ </p><br><p> æ€§åˆ«å’Œå¹´é¾„ï¼ˆâ€œ <em>æ€§åˆ«</em>å’Œ<em>å¹´é¾„â€</em>åˆ—ï¼‰å…·æœ‰å›ºå®šçš„å·²çŸ¥å€¼ï¼Œå› æ­¤å»ºè®®å°†è¿™äº›åˆ—è½¬æ¢ä¸ºå› å­ï¼š </p><br><pre> <code class="plaintext hljs">spec &lt;- spec %&gt;% mutate( gender = factor(gender, levels = c("f", "m")), age = factor(age, levels = unique(age), ordered = TRUE) )</code> </pre> <br><p> æœ€åï¼Œä¸ºäº†å°†æˆ‘ä»¬åˆ›å»ºçš„è§„èŒƒåº”ç”¨äº<em>who</em>æ¡†æ¶çš„åŸå§‹æ—¥æœŸï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>pivot_longer()</code>å‡½æ•°ä¸­ä½¿ç”¨<em>spec</em>å‚æ•°ã€‚ </p><br><p> <code>who %&gt;% pivot_longer(spec = spec)</code> </p> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 405,440 x 8 #&gt; country iso2 iso3 year diagnosis gender age count #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;fct&gt; &lt;ord&gt; &lt;int&gt; #&gt; 1 Afghanistan AF AFG 1980 sp m 014 NA #&gt; 2 Afghanistan AF AFG 1980 sp m 1524 NA #&gt; 3 Afghanistan AF AFG 1980 sp m 2534 NA #&gt; 4 Afghanistan AF AFG 1980 sp m 3544 NA #&gt; 5 Afghanistan AF AFG 1980 sp m 4554 NA #&gt; 6 Afghanistan AF AFG 1980 sp m 5564 NA #&gt; 7 Afghanistan AF AFG 1980 sp m 65 NA #&gt; 8 Afghanistan AF AFG 1980 sp f 014 NA #&gt; 9 Afghanistan AF AFG 1980 sp f 1524 NA #&gt; 10 Afghanistan AF AFG 1980 sp f 2534 NA #&gt; # â€¦ with 405,430 more rows</code> </pre> <br><p> æˆ‘ä»¬åˆšæ‰æ‰€åšçš„ä¸€åˆ‡éƒ½å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼ç¤ºæ„æ€§åœ°æè¿°ï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/90c/84b/16d/90c84b16d3e4c9860b8ced6e411757b3.png" alt="å›¾ç‰‡"></p><br><h2 id="specifikaciya-s-ispolzovaniem-neskolkih-znacheniyvalue"> ä½¿ç”¨å¤šä¸ªå€¼ï¼ˆ.valueï¼‰çš„è§„èŒƒ </h2><br><p> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ <em>.value</em>è§„èŒƒåˆ—ä»…åŒ…å«ä¸€ä¸ªå€¼ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ </p><br><p> ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå½“æ‚¨éœ€è¦ä»å€¼ä¸­å…·æœ‰ä¸åŒæ•°æ®ç±»å‹çš„åˆ—ä¸­æ”¶é›†æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ç§æƒ…å†µã€‚ ä½¿ç”¨ä¸æ¨èä½¿ç”¨çš„<code>spread()</code>å‡½æ•°ï¼Œè¿™å°†éå¸¸å›°éš¾ã€‚ </p><br><p> ä»¥ä¸‹ç¤ºä¾‹æ˜¯ä»å°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ’å›¾ä¸­</a>å€Ÿç”¨çš„<strong>data.table</strong>åŒ…ã€‚ </p><br><p> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè®­ç»ƒæ•°æ®æ¡†æ¶ã€‚ </p><br><pre> <code class="plaintext hljs">family &lt;- tibble::tribble( ~family, ~dob_child1, ~dob_child2, ~gender_child1, ~gender_child2, 1L, "1998-11-26", "2000-01-29", 1L, 2L, 2L, "1996-06-22", NA, 2L, NA, 3L, "2002-07-11", "2004-04-05", 2L, 2L, 4L, "2004-10-10", "2009-08-27", 1L, 1L, 5L, "2000-12-05", "2005-02-28", 2L, 1L, ) family &lt;- family %&gt;% mutate_at(vars(starts_with("dob")), parse_date)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 5 x 5 #&gt; family dob_child1 dob_child2 gender_child1 gender_child2 #&gt; &lt;int&gt; &lt;date&gt; &lt;date&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 1 1998-11-26 2000-01-29 1 2 #&gt; 2 2 1996-06-22 NA 2 NA #&gt; 3 3 2002-07-11 2004-04-05 2 2 #&gt; 4 4 2004-10-10 2009-08-27 1 1 #&gt; 5 5 2000-12-05 2005-02-28 2 1</code> </pre> <br><p> æ¯è¡Œä¸­åˆ›å»ºçš„æ—¥æœŸæ¡†æ¶åŒ…å«æœ‰å…³ä¸€ä¸ªå®¶åº­çš„å­©å­çš„æ•°æ®ã€‚ å®¶åº­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªå­©å­ã€‚ å¯¹äºæ¯ä¸ªå­©å­ï¼Œéƒ½æä¾›äº†æœ‰å…³å‡ºç”Ÿæ—¥æœŸå’Œæ€§åˆ«çš„æ•°æ®ï¼Œå¹¶ä¸”æ¯ä¸ªå­©å­çš„æ•°æ®éƒ½åœ¨ä¸åŒçš„åˆ—ä¸­ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯å°†è¿™äº›æ•°æ®è½¬æ¢ä¸ºæ­£ç¡®çš„æ ¼å¼ä»¥è¿›è¡Œåˆ†æã€‚ </p><br><p> è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªå˜é‡ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ¯ä¸ªå­©å­çš„ä¿¡æ¯ï¼šä»–çš„æ€§åˆ«å’Œå‡ºç”Ÿæ—¥æœŸï¼ˆå¸¦æœ‰å‰ç¼€<em>dopçš„</em>åˆ—åŒ…å«å‡ºç”Ÿæ—¥æœŸï¼Œå¸¦æœ‰å‰ç¼€<em>æ€§åˆ«çš„</em>åˆ—åŒ…å«è¯¥å­©å­çš„æ€§åˆ«ï¼‰ã€‚ åœ¨é¢„æœŸçš„ç»“æœä¸­ï¼Œå®ƒä»¬åº”è¯¥æ”¾åœ¨å•ç‹¬çš„åˆ—ä¸­ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªè§„èŒƒï¼Œå…¶ä¸­<code>.value</code>åˆ—å°†å…·æœ‰ä¸¤ä¸ªä¸åŒçš„å€¼ã€‚ </p><br><pre> <code class="plaintext hljs">spec &lt;- family %&gt;% pivot_longer_spec(-family) %&gt;% separate(col = name, into = c(".value", "child"))%&gt;% mutate(child = parse_number(child))</code> </pre><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 3 #&gt; .name .value child #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 dob_child1 dob 1 #&gt; 2 dob_child2 dob 2 #&gt; 3 gender_child1 gender 1 #&gt; 4 gender_child2 gender 2</code> </pre> <br><p> å› æ­¤ï¼Œè®©æˆ‘ä»¬é€æ­¥å®Œæˆä¸Šè¿°ä»£ç æ‰§è¡Œçš„æ­¥éª¤ã€‚ </p><br><ul><li>  <code>pivot_longer_spec(-family)</code> -åˆ›å»ºä¸€ä¸ªè§„èŒƒï¼Œä»¥å‹ç¼©é™¤familyåˆ—ä¹‹å¤–çš„æ‰€æœ‰å¯ç”¨åˆ—ã€‚ </li><li>  <code>separate(col = name, into = c(".value", "child"))</code> -åˆ†å¼€<em>.name</em>åˆ—ï¼Œå…¶ä¸­åŒ…å«æºå­—æ®µçš„åç§°ï¼ŒåŠ ä¸‹åˆ’çº¿ï¼Œç„¶åå°†å€¼æ”¾å…¥<em>.value</em>å’Œ<em>child</em>åˆ—ä¸­ã€‚ </li><li>  <code>mutate(child = parse_number(child))</code> -å°†<em>å­</em>å­—æ®µçš„å€¼ä»æ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—æ•°æ®ç±»å‹ã€‚ </li></ul><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¥æ”¶åˆ°çš„è§„èŒƒåº”ç”¨äºåˆå§‹æ•°æ®å¸§ï¼Œå¹¶å°†è¡¨è°ƒæ•´ä¸ºæ‰€éœ€çš„å½¢å¼ã€‚ </p><br><pre> <code class="plaintext hljs">family %&gt;% pivot_longer(spec = spec, na.rm = T)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 9 x 4 #&gt; family child dob gender #&gt; &lt;int&gt; &lt;dbl&gt; &lt;date&gt; &lt;int&gt; #&gt; 1 1 1 1998-11-26 1 #&gt; 2 1 2 2000-01-29 2 #&gt; 3 2 1 1996-06-22 2 #&gt; 4 3 1 2002-07-11 2 #&gt; 5 3 2 2004-04-05 2 #&gt; 6 4 1 2004-10-10 1 #&gt; 7 4 2 2009-08-27 1 #&gt; 8 5 1 2000-12-05 2 #&gt; 9 5 2 2005-02-28 1</code> </pre> <br><p> æˆ‘ä»¬ä½¿ç”¨å‚æ•°<code>na.rm = TRUE</code> ï¼Œå› ä¸ºå½“å‰æ•°æ®å½¢å¼è¿«ä½¿æˆ‘ä»¬ä¸ºä¸å­˜åœ¨çš„è§‚å¯Ÿåˆ›å»ºé¢å¤–çš„è¡Œã€‚ å› ä¸º å®¶æ—2åªæœ‰ä¸€ä¸ªå­©å­ï¼Œ <code>na.rm = TRUE</code>ç¡®ä¿å®¶æ—2åœ¨è¾“å‡ºä¸­åªæœ‰ä¸€è¡Œã€‚ </p><br><h2 id="preobrazovanie-data-freymov-iz-dlinnogo-formata-k-shirokomu"> å°†æ—¥æœŸå¸§ä»é•¿è½¬æ¢ä¸ºå®½ </h2><br><p>  <code>pivot_wider()</code> -æ˜¯é€†å˜æ¢ï¼Œåä¹‹äº¦ç„¶ï¼Œå®ƒé€šè¿‡å‡å°‘è¡Œæ•°æ¥å¢åŠ æ¡†æ¶æ—¥æœŸä¸­çš„åˆ—æ•°ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b0d/a51/f47/b0da51f47f968a49e485989eba044914.png" alt="å›¾ç‰‡"></p><br><p> è¿™ç§è½¬æ¢å¾ˆå°‘ç”¨äºä½¿æ•°æ®å¤–è§‚æ•´æ´ï¼Œä½†æ˜¯ï¼Œæ­¤æŠ€æœ¯å¯¹äºåˆ›å»ºæ¼”ç¤ºæ–‡ç¨¿ä¸­ä½¿ç”¨çš„æ•°æ®é€è§†è¡¨æˆ–ä¸ä»»ä½•å…¶ä»–å·¥å…·é›†æˆå¾ˆæœ‰ç”¨ã€‚ </p><br><p> å®é™…ä¸Šï¼ŒåŠŸèƒ½<code>pivot_longer()</code>å’Œ<code>pivot_wider()</code>æ˜¯å¯¹ç§°çš„ï¼Œå¹¶ä¸”å®ƒä»¬æ‰§è¡Œç›¸åçš„æ“ä½œï¼Œå³ï¼š <code>df %&gt;% pivot_longer(spec = spec) %&gt;% pivot_wider(spec = spec)</code>å’Œ<code>df %&gt;% pivot_wider(spec = spec) %&gt;% pivot_longer(spec = spec)</code>å°†è¿”å›åŸå§‹dfã€‚ </p><br><h3 id="prosteyshiy-primer-privedeniya-tablicy-k-shirokomu-formatu"> å°†è¡¨è½¬æ¢ä¸ºå®½æ ¼å¼çš„æœ€ç®€å•ç¤ºä¾‹ </h3><br><p> ä¸ºäº†æ¼”ç¤º<code>pivot_wider()</code>å‡½æ•°çš„æ“ä½œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<em>fish_encountersæ•°æ®é›†</em> ï¼Œè¯¥<em>æ•°æ®é›†</em>å­˜å‚¨æœ‰å…³å„ä¸ªç«™ç‚¹å¦‚ä½•è®°å½•é±¼æ²¿æ²³è¿åŠ¨çš„ä¿¡æ¯ã€‚ </p><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 114 x 3 #&gt; fish station seen #&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; #&gt; 1 4842 Release 1 #&gt; 2 4842 I80_1 1 #&gt; 3 4842 Lisbon 1 #&gt; 4 4842 Rstr 1 #&gt; 5 4842 Base_TD 1 #&gt; 6 4842 BCE 1 #&gt; 7 4842 BCW 1 #&gt; 8 4842 BCE2 1 #&gt; 9 4842 BCW2 1 #&gt; 10 4842 MAE 1 #&gt; # â€¦ with 104 more rows</code> </pre> <br><p> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨åœ¨å•ç‹¬çš„åˆ—ä¸­æä¾›æ¯ä¸ªç«™ç‚¹çš„ä¿¡æ¯ï¼Œåˆ™è¯¥è¡¨å°†æ›´å…·ä¿¡æ¯æ€§ä¸”æ˜“äºä½¿ç”¨ã€‚ </p><br><p> <code>fish_encounters %&gt;% pivot_wider(names_from = station, values_from = seen)</code> </p> <br><pre> <code class="plaintext hljs">fish_encounters %&gt;% pivot_wider(names_from = station, values_from = seen) #&gt; # A tibble: 19 x 12 #&gt; fish Release I80_1 Lisbon Rstr Base_TD BCE BCW BCE2 BCW2 MAE #&gt; &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 4842 1 1 1 1 1 1 1 1 1 1 #&gt; 2 4843 1 1 1 1 1 1 1 1 1 1 #&gt; 3 4844 1 1 1 1 1 1 1 1 1 1 #&gt; 4 4845 1 1 1 1 1 NA NA NA NA NA #&gt; 5 4847 1 1 1 NA NA NA NA NA NA NA #&gt; 6 4848 1 1 1 1 NA NA NA NA NA NA #&gt; 7 4849 1 1 NA NA NA NA NA NA NA NA #&gt; 8 4850 1 1 NA 1 1 1 1 NA NA NA #&gt; 9 4851 1 1 NA NA NA NA NA NA NA NA #&gt; 10 4854 1 1 NA NA NA NA NA NA NA NA #&gt; # â€¦ with 9 more rows, and 1 more variable: MAW &lt;int&gt;</code> </pre> <br><p> è¯¥æ•°æ®é›†ä»…åœ¨ç«™æ£€æµ‹åˆ°é±¼æ—¶æ‰è®°å½•ä¿¡æ¯ï¼Œå³ å¦‚æœæŸä¸ªç«™ç‚¹æ²¡æœ‰å›ºå®šä»»ä½•é±¼ç±»ï¼Œåˆ™è¯¥æ•°æ®å°†ä¸åœ¨è¡¨æ ¼ä¸­ã€‚ è¿™æ„å‘³ç€è¾“å‡ºå°†ç”±NAå¡«å……ã€‚ </p><br><p> ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“ç¼ºå°‘è®°å½•æ„å‘³ç€æ²¡æœ‰æ³¨æ„åˆ°é±¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨<code>pivot_wider()</code>å‡½æ•°ä¸­ä½¿ç”¨<em>values_fill</em>å‚æ•°ï¼Œå¹¶ç”¨é›¶å¡«å……è¿™äº›ç¼ºå¤±çš„å€¼ï¼š </p><br><pre> <code class="plaintext hljs">fish_encounters %&gt;% pivot_wider( names_from = station, values_from = seen, values_fill = list(seen = 0) )</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 19 x 12 #&gt; fish Release I80_1 Lisbon Rstr Base_TD BCE BCW BCE2 BCW2 MAE #&gt; &lt;fct&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; #&gt; 1 4842 1 1 1 1 1 1 1 1 1 1 #&gt; 2 4843 1 1 1 1 1 1 1 1 1 1 #&gt; 3 4844 1 1 1 1 1 1 1 1 1 1 #&gt; 4 4845 1 1 1 1 1 0 0 0 0 0 #&gt; 5 4847 1 1 1 0 0 0 0 0 0 0 #&gt; 6 4848 1 1 1 1 0 0 0 0 0 0 #&gt; 7 4849 1 1 0 0 0 0 0 0 0 0 #&gt; 8 4850 1 1 0 1 1 1 1 0 0 0 #&gt; 9 4851 1 1 0 0 0 0 0 0 0 0 #&gt; 10 4854 1 1 0 0 0 0 0 0 0 0 #&gt; # â€¦ with 9 more rows, and 1 more variable: MAW &lt;int&gt;</code> </pre> <br><h3 id="generaciya-imeni-stolbca-iz-neskolkih-ishodnyh-peremennyh"> ä»å¤šä¸ªæºå˜é‡ç”Ÿæˆåˆ—å </h3><br><p> æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«äº§å“ï¼Œå›½å®¶å’Œå¹´ä»½ç»„åˆçš„è¡¨æ ¼ã€‚ è¦ç”Ÿæˆæµ‹è¯•æ—¥æœŸï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="plaintext hljs">df &lt;- expand_grid( product = c("A", "B"), country = c("AI", "EI"), year = 2000:2014 ) %&gt;% filter((product == "A" &amp; country == "AI") | product == "B") %&gt;% mutate(value = rnorm(nrow(.)))</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 45 x 4 #&gt; product country year value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; #&gt; 1 A AI 2000 -2.05 #&gt; 2 A AI 2001 -0.676 #&gt; 3 A AI 2002 1.60 #&gt; 4 A AI 2003 -0.353 #&gt; 5 A AI 2004 -0.00530 #&gt; 6 A AI 2005 0.442 #&gt; 7 A AI 2006 -0.610 #&gt; 8 A AI 2007 -2.77 #&gt; 9 A AI 2008 0.899 #&gt; 10 A AI 2009 -0.106 #&gt; # â€¦ with 35 more rows</code> </pre> <br><p> æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æ‰©å±•æ—¥æœŸèŒƒå›´ï¼Œä»¥ä½¿ä¸€åˆ—åŒ…å«äº§å“å’Œå›½å®¶/åœ°åŒºæ¯ç§ç»„åˆçš„æ•°æ®ã€‚ ä¸ºæ­¤ï¼Œåªéœ€å°†åŒ…å«è¦è¿æ¥çš„å­—æ®µåç§°çš„å‘é‡ä¼ é€’åˆ°<em>names_from</em>å‚æ•°ä¸­ã€‚ </p><br><pre> <code class="plaintext hljs">df %&gt;% pivot_wider(names_from = c(product, country), values_from = "value")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 15 x 4 #&gt; year A_AI B_AI B_EI #&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 2000 -2.05 0.607 1.20 #&gt; 2 2001 -0.676 1.65 -0.114 #&gt; 3 2002 1.60 -0.0245 0.501 #&gt; 4 2003 -0.353 1.30 -0.459 #&gt; 5 2004 -0.00530 0.921 -0.0589 #&gt; 6 2005 0.442 -1.55 0.594 #&gt; 7 2006 -0.610 0.380 -1.28 #&gt; 8 2007 -2.77 0.830 0.637 #&gt; 9 2008 0.899 0.0175 -1.30 #&gt; 10 2009 -0.106 -0.195 1.03 #&gt; # â€¦ with 5 more rows</code> </pre> <br><p> æ‚¨è¿˜å¯ä»¥å°†è§„èŒƒåº”ç”¨äº<code>pivot_wider()</code>å‡½æ•°ã€‚ ä½†æ˜¯ï¼Œå½“å°†æ•°æ®é¦ˆé€åˆ°<code>pivot_wider()</code>è§„èŒƒæ‰§è¡Œä¸<code>pivot_longer()</code>ç›¸åçš„<code>pivot_longer()</code> ï¼š <em>.name</em>ä¸­æŒ‡å®šçš„åˆ—æ˜¯ä½¿ç”¨<em>.value</em>å’Œå…¶ä»–åˆ—ä¸­çš„å€¼åˆ›å»ºçš„ã€‚ </p><br><p> å¯¹äºæ­¤æ•°æ®é›†ï¼Œå¦‚æœå¸Œæœ›å›½å®¶å’Œäº§å“çš„æ¯ç§å¯èƒ½ç»„åˆéƒ½æœ‰è‡ªå·±çš„åˆ—ï¼Œè€Œä¸ä»…ä»…æ˜¯æ•°æ®ä¸­å­˜åœ¨çš„åˆ—ï¼Œåˆ™å¯ä»¥ç”Ÿæˆç”¨æˆ·è§„èŒƒï¼š </p><br><pre> <code class="plaintext hljs">spec &lt;- df %&gt;% expand(product, country, .value = "value") %&gt;% unite(".name", product, country, remove = FALSE)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 4 #&gt; .name product country .value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 A_AI A AI value #&gt; 2 A_EI A EI value #&gt; 3 B_AI B AI value #&gt; 4 B_EI B EI value</code> </pre> <br><pre> <code class="plaintext hljs">df %&gt;% pivot_wider(spec = spec) %&gt;% head()</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 6 x 5 #&gt; year A_AI A_EI B_AI B_EI #&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 2000 -2.05 NA 0.607 1.20 #&gt; 2 2001 -0.676 NA 1.65 -0.114 #&gt; 3 2002 1.60 NA -0.0245 0.501 #&gt; 4 2003 -0.353 NA 1.30 -0.459 #&gt; 5 2004 -0.00530 NA 0.921 -0.0589 #&gt; 6 2005 0.442 NA -1.55 0.594</code> </pre> <br><h2 id="neskolko-prodvinutyh-primerov-raboty-s-novoy-koncepciey-tidyr"> ä¸€äº›ä½¿ç”¨æ–°æ½®æ±æ¦‚å¿µçš„é«˜çº§ç¤ºä¾‹ </h2><br><h3 id="privedenie-dannyh-k-akkuratnomu-vidu-na-primere-nabora-dannyh-o-perepisi-dohoda-i-arendnoy-platy-v-ssha"> ä»¥ç¾å›½æ”¶å…¥å’Œç§Ÿé‡‘æ™®æŸ¥æ•°æ®é›†ä¸ºä¾‹ï¼Œä½¿æ•°æ®æ•´æ´ </h3><br><p>  <em>us_rent_incomeæ•°æ®é›†</em>åŒ…å«æœ‰å…³2017å¹´ç¾å›½å„å·å¹³å‡æ”¶å…¥å’Œç§Ÿé‡‘çš„ä¿¡æ¯ï¼ˆè¯¥æ•°æ®é›†å¯åœ¨<strong>tidycensus</strong>è½¯ä»¶åŒ…ä¸­æ‰¾åˆ°ï¼‰ã€‚ </p><br><pre> <code class="plaintext hljs">us_rent_income #&gt; # A tibble: 104 x 5 #&gt; GEOID NAME variable estimate moe #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 01 Alabama income 24476 136 #&gt; 2 01 Alabama rent 747 3 #&gt; 3 02 Alaska income 32940 508 #&gt; 4 02 Alaska rent 1200 13 #&gt; 5 04 Arizona income 27517 148 #&gt; 6 04 Arizona rent 972 4 #&gt; 7 05 Arkansas income 23789 165 #&gt; 8 05 Arkansas rent 709 5 #&gt; 9 06 California income 29454 109 #&gt; 10 06 California rent 1358 3 #&gt; # â€¦ with 94 more rows</code> </pre> <br><p> ä»¥us_rent_income <em>æ•°æ®é›†ä¸­çš„æ•°æ®çš„</em>å­˜å‚¨å½¢å¼æ¥ä½¿ç”¨å®ƒä»¬éå¸¸ä¸ä¾¿ï¼Œå› æ­¤æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹åˆ—çš„æ•°æ®é›†ï¼š <em>rent</em> ï¼Œ <em>rent_moe</em> ï¼Œ <em>come</em> ï¼Œ <em>income_moe</em> ã€‚ åˆ›å»ºæ­¤è§„èŒƒçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä½†æ˜¯æœ€ä¸»è¦çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆå˜é‡å€¼å’Œ<em>ä¼°ç®—å€¼/ moeçš„</em>æ¯ç§ç»„åˆï¼Œç„¶åç”Ÿæˆåˆ—åã€‚ </p><br><pre> <code class="plaintext hljs"> spec &lt;- us_rent_income %&gt;% expand(variable, .value = c("estimate", "moe")) %&gt;% mutate( .name = paste0(variable, ifelse(.value == "moe", "_moe", "")) )</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 3 #&gt; variable .value .name #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 income estimate income #&gt; 2 income moe income_moe #&gt; 3 rent estimate rent #&gt; 4 rent moe rent_moe</code> </pre> <br><p> æä¾›æ­¤è§„æ ¼ç»™<code>pivot_wider()</code>ä¸ºæˆ‘ä»¬æä¾›æ‰€éœ€çš„ç»“æœï¼š </p><br><p> <code>us_rent_income %&gt;% pivot_wider(spec = spec)</code> </p> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 52 x 6 #&gt; GEOID NAME income income_moe rent rent_moe #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 01 Alabama 24476 136 747 3 #&gt; 2 02 Alaska 32940 508 1200 13 #&gt; 3 04 Arizona 27517 148 972 4 #&gt; 4 05 Arkansas 23789 165 709 5 #&gt; 5 06 California 29454 109 1358 3 #&gt; 6 08 Colorado 32401 109 1125 5 #&gt; 7 09 Connecticut 35326 195 1123 5 #&gt; 8 10 Delaware 31560 247 1076 10 #&gt; 9 11 District of Columbia 43198 681 1424 17 #&gt; 10 12 Florida 25952 70 1077 3 #&gt; # â€¦ with 42 more rows</code> </pre> <br><h3 id="vsemirnyy-bank"> ä¸–ç•Œé“¶è¡Œ </h3><br><p> æœ‰æ—¶ï¼Œå°†æ•°æ®é›†è½¬æ¢ä¸ºæ­£ç¡®çš„æ ¼å¼éœ€è¦å‡ ä¸ªæ­¥éª¤ã€‚ <br>  world_bank_pop <em>æ•°æ®é›†</em>åŒ…å«ä¸–ç•Œé“¶è¡Œå…³äº2000å¹´è‡³2018å¹´æ¯ä¸ªå›½å®¶äººå£çš„æ•°æ®ã€‚ </p><br><pre> <code class="plaintext hljs">#&gt; # A tibble: 1,056 x 20 #&gt; country indicator `2000` `2001` `2002` `2003` `2004` `2005` `2006` #&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 ABW SP.URB.Tâ€¦ 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4 4.49e+4 #&gt; 2 ABW SP.URB.Gâ€¦ 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 #&gt; 3 ABW SP.POP.Tâ€¦ 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5 1.01e+5 #&gt; 4 ABW SP.POP.Gâ€¦ 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0 7.98e-1 #&gt; 5 AFG SP.URB.Tâ€¦ 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6 5.93e+6 #&gt; 6 AFG SP.URB.Gâ€¦ 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0 4.12e+0 #&gt; 7 AFG SP.POP.Tâ€¦ 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7 2.59e+7 #&gt; 8 AFG SP.POP.Gâ€¦ 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0 3.23e+0 #&gt; 9 AGO SP.URB.Tâ€¦ 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7 1.15e+7 #&gt; 10 AGO SP.URB.Gâ€¦ 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0 4.92e+0 #&gt; # â€¦ with 1,046 more rows, and 11 more variables: `2007` &lt;dbl&gt;, #&gt; # `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, #&gt; # `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code> </pre> <br><p> æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªæ•´æ´çš„æ•°æ®é›†ï¼Œå…¶ä¸­æ¯ä¸ªå˜é‡éƒ½åœ¨å•ç‹¬çš„åˆ—ä¸­ã€‚ ç›®å‰å°šä¸æ¸…æ¥šå“ªäº›æ­¥éª¤æ˜¯å¿…éœ€çš„ï¼Œä½†æˆ‘ä»¬å°†ä»æœ€æ˜æ˜¾çš„é—®é¢˜å¼€å§‹ï¼šå¹´ä»½åˆ†å¸ƒåœ¨å‡ åˆ—ä¸­ã€‚ </p><br><p> ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨<code>pivot_longer()</code>å‡½æ•°ã€‚ </p><br><pre> <code class="plaintext hljs">pop2 &lt;- world_bank_pop %&gt;% pivot_longer(`2000`:`2017`, names_to = "year")</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 19,008 x 4 #&gt; country indicator year value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 ABW SP.URB.TOTL 2000 42444 #&gt; 2 ABW SP.URB.TOTL 2001 43048 #&gt; 3 ABW SP.URB.TOTL 2002 43670 #&gt; 4 ABW SP.URB.TOTL 2003 44246 #&gt; 5 ABW SP.URB.TOTL 2004 44669 #&gt; 6 ABW SP.URB.TOTL 2005 44889 #&gt; 7 ABW SP.URB.TOTL 2006 44881 #&gt; 8 ABW SP.URB.TOTL 2007 44686 #&gt; 9 ABW SP.URB.TOTL 2008 44375 #&gt; 10 ABW SP.URB.TOTL 2009 44052 #&gt; # â€¦ with 18,998 more rows</code> </pre> <br><p>   â€”   indicator. <br> <code>pop2 %&gt;% count(indicator)</code> </p> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 4 x 2 #&gt; indicator n #&gt; &lt;chr&gt; &lt;int&gt; #&gt; 1 SP.POP.GROW 4752 #&gt; 2 SP.POP.TOTL 4752 #&gt; 3 SP.URB.GROW 4752 #&gt; 4 SP.URB.TOTL 4752</code> </pre> <br><p>  SP.POP.GROW â€”  , SP.POP.TOTL â€”   ,  SP.URB. *  ,     .       : area â€”  (total  urban)      (population  growth): </p><br><pre> <code class="plaintext hljs">pop3 &lt;- pop2 %&gt;% separate(indicator, c(NA, "area", "variable"))</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 19,008 x 5 #&gt; country area variable year value #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; #&gt; 1 ABW URB TOTL 2000 42444 #&gt; 2 ABW URB TOTL 2001 43048 #&gt; 3 ABW URB TOTL 2002 43670 #&gt; 4 ABW URB TOTL 2003 44246 #&gt; 5 ABW URB TOTL 2004 44669 #&gt; 6 ABW URB TOTL 2005 44889 #&gt; 7 ABW URB TOTL 2006 44881 #&gt; 8 ABW URB TOTL 2007 44686 #&gt; 9 ABW URB TOTL 2008 44375 #&gt; 10 ABW URB TOTL 2009 44052 #&gt; # â€¦ with 18,998 more rows</code> </pre> <br><p>       variable   : </p><br><pre> <code class="plaintext hljs">pop3 %&gt;% pivot_wider(names_from = variable, values_from = value)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 9,504 x 5 #&gt; country area year TOTL GROW #&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1 ABW URB 2000 42444 1.18 #&gt; 2 ABW URB 2001 43048 1.41 #&gt; 3 ABW URB 2002 43670 1.43 #&gt; 4 ABW URB 2003 44246 1.31 #&gt; 5 ABW URB 2004 44669 0.951 #&gt; 6 ABW URB 2005 44889 0.491 #&gt; 7 ABW URB 2006 44881 -0.0178 #&gt; 8 ABW URB 2007 44686 -0.435 #&gt; 9 ABW URB 2008 44375 -0.698 #&gt; 10 ABW URB 2009 44052 -0.731 #&gt; # â€¦ with 9,494 more rows</code> </pre> <br><h3 id="spisok-kontaktov">   </h3><br><p>  , ,      ,       -: </p><br><pre> <code class="plaintext hljs">contacts &lt;- tribble( ~field, ~value, "name", "Jiena McLellan", "company", "Toyota", "name", "John Smith", "company", "google", "email", "john@google.com", "name", "Huxley Ratcliffe" )</code> </pre> <br><p>        ,    ,   ,     .    , ,          ("name"),      ,       ,    field   â€œnameâ€: </p><br><pre> <code class="plaintext hljs">contacts &lt;- contacts %&gt;% mutate( person_id = cumsum(field == "name") ) contacts</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 6 x 3 #&gt; field value person_id #&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; #&gt; 1 name Jiena McLellan 1 #&gt; 2 company Toyota 1 #&gt; 3 name John Smith 2 #&gt; 4 company google 2 #&gt; 5 email john@google.com 2 #&gt; 6 name Huxley Ratcliffe 3</code> </pre> <br><p> ,         ,        : </p><br><pre> <code class="plaintext hljs">contacts %&gt;% pivot_wider(names_from = field, values_from = value)</code> </pre> <br><pre> <code class="plaintext hljs">#&gt; # A tibble: 3 x 4 #&gt; person_id name company email #&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; #&gt; 1 1 Jiena McLellan Toyota &lt;NA&gt; #&gt; 2 2 John Smith google john@google.com #&gt; 3 3 Huxley Ratcliffe &lt;NA&gt; &lt;NA&gt;</code> </pre> <br><h2 id="zaklyuchenie"> ç»“è®º </h2><br><p>   ,    <strong>tidyr</strong>    ,        <code>spread()</code>  <code>gather()</code> .        <code>pivot_longer()</code>  <code>pivot_wider()</code> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN444622/">https://habr.com/ru/post/zh-CN444622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN444610/index.html">å®æ—¶ç»Ÿè®¡å’Œç›‘è§†PHPè„šæœ¬ã€‚ ClickHouseå’ŒGrafanaå»å¸®åŠ©Pinba</a></li>
<li><a href="../zh-CN444612/index.html">C ++ä»£ç çš„å®å±å®³</a></li>
<li><a href="../zh-CN444614/index.html">Linuxçš„æ•´ä¸ªå†å²ã€‚ ç¬¬äºŒéƒ¨åˆ†ï¼šä¼ä¸šé£é£é›¨é›¨</a></li>
<li><a href="../zh-CN444616/index.html">ä½¿ç”¨Kotlinåˆ›å»ºè‡ªå·±çš„Androidå½•éŸ³æœº</a></li>
<li><a href="../zh-CN444620/index.html">ä½¿ç”¨Linuxå†…æ ¸åºåˆ—æ–‡ä»¶</a></li>
<li><a href="../zh-CN444624/index.html">ç”µåŠ¨æ±½è½¦ç€ç«å’Œæ²æµ´</a></li>
<li><a href="../zh-CN444630/index.html">å’¨è¯¢å°ï¼šå…¨çƒäº’è”ç½‘å€¡è®®</a></li>
<li><a href="../zh-CN444634/index.html">Epic Gameså‘å¼€å‘äººå‘˜æä¾›1äº¿ç¾å…ƒ</a></li>
<li><a href="../zh-CN444636/index.html">æˆ‘ä¸ºä»€ä¹ˆä¸èƒ½ä¸ºäº†é’±è€Œæˆé•¿</a></li>
<li><a href="../zh-CN444638/index.html">åœ¨CodeFestä¸Šè¿›è¡Œè´¨é‡æ£€æŸ¥ã€‚ è‡ªåŠ¨åŒ–ï¼Œç®¡ç†ï¼ŒåŸºç¡€è®¾æ–½ï¼Œå•†åº—ä¸­é¥ºå­çš„é”€å”®</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>