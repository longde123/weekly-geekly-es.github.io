<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèø‚Äçü§ù‚Äçüßëüèº ü§úüèæ üå¥ C√≥mo hicimos el monitoreo de red para 14,000 objetos ‚õÖÔ∏è üë≤üèΩ üë®üèΩ‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ten√≠amos 14,000 objetos, zabbix, api, python y una renuencia a agregar objetos a mano. Debajo del corte, sobre c√≥mo los administradores de red impleme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hicimos el monitoreo de red para 14,000 objetos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/438754/">  Ten√≠amos 14,000 objetos, zabbix, api, python y una renuencia a agregar objetos a mano.  Debajo del corte, sobre c√≥mo los administradores de red implementaron el monitoreo con la adici√≥n autom√°tica de nodos de red, y un poco sobre el dolor por el que tuve que pasar. <br><br>  Este art√≠culo se centra m√°s en ingenieros de redes con poca experiencia en python.  Para ayudar con la automatizaci√≥n del monitoreo y la mejora de la calidad de vida y el trabajo, en ausencia de la necesidad de actualizar manualmente toda la flota de objetos. <br><br><img src="https://habrastorage.org/webt/mw/-u/ev/mw-uevvuik_o6poo21krw2rt0gy.jpeg"><br><a name="habracut"></a><br><h2>  Larga historia corta, hemos construido un monitoreo </h2><br>  Hola  Mi nombre es Alexander Prokhorov y, junto con el equipo de ingenieros de redes de nuestro departamento, estamos trabajando en una red en # ITX5.  Nuestro departamento desarrolla infraestructura de red, monitoreo de redes y automatizaci√≥n.  S√≠, y todo lo relacionado con la transferencia de datos. <br><br><img src="https://habrastorage.org/webt/g1/mu/mr/g1mumrtfj5tkbmqs52gl05_d2la.png"><br><br>  Romper√≠a el sistema de monitoreo en 5 subtareas: <br><br><ul><li>  Descargar datos maestros </li><li>  Obtenci√≥n de informaci√≥n sobre el estado de los objetos. </li><li>  Disparadores y Alertas </li><li>  Informes </li><li>  Visualizaci√≥n </li></ul><br>  En este art√≠culo nos gustar√≠a compartir c√≥mo hicimos la integraci√≥n de monitoreo con datos maestros en nuestra empresa. <br><br>  Tenemos 14,000 propiedades comerciales, y la primera tarea que resolvimos fue la determinaci√≥n de objetos inaccesibles, su n√∫mero y distribuci√≥n geogr√°fica. <br><br>  El monitoreo se realiz√≥ en <b><font color="#cc0000">Zabbix</font></b> .  En pocas palabras, por qu√©: suerte y legado.  El resto: <br><br><div class="spoiler">  <b class="spoiler_title">Larga historia</b> <div class="spoiler_text"> Todo comenz√≥ con la instalaci√≥n de monitoreo en una computadora debajo de la mesa ... <br><br>  Cuando vine a trabajar para la compa√±√≠a en 2013, no ten√≠amos monitoreo de red, aunque la red, incluso en ese momento, era grande, alrededor de 4000 objetos.  Aprendimos sobre ca√≠das masivas (y no tan frecuentes) a partir de la recepci√≥n de aplicaciones, usuarios o de otros departamentos como avalanchas. <br><br><img src="https://habrastorage.org/webt/ge/6l/du/ge6lduplk0odlklh6iazcjsw6vk.jpeg"><br><br>  El primero se instal√≥ Zabbix 1.8, como un producto que gana impulso (moderno, moderno, juvenil), liviano y asequible para instalar de c√≥digo abierto con una gran comunidad.  Tuvimos suerte con la elecci√≥n. <br><br>  No hubo recursos para la instalaci√≥n, nadie solicit√≥.  No estaba claro si esto funcionar√≠a en absoluto; nadie ten√≠a experiencia en implementaci√≥n.  Pero lo necesit√°bamos, y lo instalamos en la computadora "debajo de la mesa".  Nivel de redundancia - UPS. <br><br>  La pregunta principal despu√©s de la instalaci√≥n es c√≥mo verter todos los objetos (¬°4k!) En la supervisi√≥n y, al mismo tiempo, lograr crear aplicaciones que ya est√©n bloqueadas en Remedy.  Zabbix ya admit√≠a la importaci√≥n / exportaci√≥n de xml con datos en hosts.  El n√∫mero de objetos es grande, no ten√≠a sentido crear un grupo separado para el objeto (y no apareci√≥), y se decidi√≥ cargar el enrutador de objetos como un nodo de red.  M√°s del equipo de red no estaba controlado (ya administrado). <br><br>  Se realiz√≥ el an√°lisis de nuestro archivo con los hosts de red (IPAM en Excel) y se volvi√≥ a formatear en xml, que Zabbix acepta digerir.  No es la primera vez, pero todos los hosts se cargaron, la actualizaci√≥n se realiz√≥ una vez cada tres meses, eliminando los objetos cerrados y agregando otros nuevos.  Con el tiempo, result√≥ que Zabbix se convirti√≥ en la principal y √∫nica fuente de informaci√≥n para nosotros y la l√≠nea directa sobre la disponibilidad de instalaciones y, lo m√°s importante, sobre ca√≠das masivas.  Esto permiti√≥ que la l√≠nea directa se enterara de accidentes masivos incluso de noche y despertara a los ingenieros con llamadas (por cierto, cuando nadie lo sab√≠a, era m√°s f√°cil vivir).  No siempre los cortes de energ√≠a nocturnos en la oficina permitieron que el UPS mantenga adecuadamente el monitoreo de nuestra red.  En alg√∫n momento, comenzamos <b>a</b> hacer copias de seguridad.  Porque  El monitoreo era inestable e intermitente, las compa√±√≠as decidieron organizar un grupo dedicado exclusivamente a esta tarea.  Muy pronto, comenz√≥ a implementar un Zabbix centralizado, que verifica no solo la red. <br><br>  Nuestro viejo Zabbix continu√≥ viviendo debajo de la mesa.  Despu√©s de agregar una cierta cantidad de elementos, la base de datos comenz√≥ a disminuir un poco, la web, la cola y el retraso en el sondeo crecieron, as√≠ que pronto tuve que obtener dos computadoras m√°s como proxy y ponerlas todas en la cruz, para que la reserva real (y el lugar debajo de la mesa terminara) .  Se admiti√≥ la vida en √©l para agregar r√°pidamente alg√∫n tipo de par√°metro personalizado para monitorearlo y observarlo.  Por lo dem√°s, nos mudamos a una centralizada. <br><br>  El monitoreo centralizado estuvo a cargo de todos los equipos de TI: enrutadores, servidores, cajas registradoras, terminales.  Despu√©s de un tiempo, creci√≥ con una gran cantidad de art√≠culos.  Para acceder a informaci√≥n invaluable de accesibilidad, tuvo que esperar un poco, tal vez incluso tomar un caf√©.  Adem√°s, ten√≠amos m√°s y m√°s requisitos para un monitoreo de red m√°s espec√≠fico y personalizado.  Teniendo en ese momento algo de experiencia trabajando con el sistema, decidimos hacer la implementaci√≥n anterior desde cero, pero con raz√≥n, bajo el nombre de zabbix.noc.x5.ru, estaba ubicada en el centro de datos con la implementaci√≥n de las funciones necesarias por nosotros mismos.  Sobre esta introducci√≥n y el cuerpo principal del art√≠culo. <br></div></div><br>  La versi√≥n de Zabbix es 3.0 <abbr title="Soporte a largo plazo">LTS</abbr> .  Actualizado solo dentro de las versiones LTS. <br><br>  Configuraci√≥n - 4 m√°quinas virtuales: servidor + base de datos, proxy, proxy, web <br><br>  Por recursos, intentamos seguir las recomendaciones en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">zabbix.com</a> para una implementaci√≥n grande y muy grande. <br><br>  El primer problema al que nos enfrentamos fue la adici√≥n autom√°tica de nodos de red a la supervisi√≥n.  Descubrimiento regular desapareci√≥ de inmediato.  Nuestra gama de redes se encuentra en todos los espacios abiertos de la superred 10/8.  Tendr√≠an que sondearse muchas direcciones y el descubrimiento autom√°tico ocupar√≠a muchos recursos del sistema, pero no resolver√≠a el problema de agregar informaci√≥n no t√©cnica sobre un objeto. <br><br><img src="https://habrastorage.org/webt/1r/on/nm/1ronnmq5d1dutzqrzwn-3tfypdm.png" align="right" width="240"><h2>  C√≥mo agregar objetos </h2><br>  La soluci√≥n fue usar scripts externos para agregar objetos.  Los datos maestros sobre objetos comerciales se encontraron en el SAP utilizado en la empresa.  El acceso sincronizado al <i>servicio web</i> para cargar datos directamente desde SAP no sali√≥, la solicitud de todos los objetos tom√≥ bastante tiempo.  Hizo una llamada asincr√≥nica.  Exactamente a la medianoche, la exportaci√≥n completa de SAP se agrega a ftp en forma de <i>XML</i> , y durante el d√≠a recae sobre <i>XML</i> con diferencias de las √∫ltimas versiones. <br><br clear="right">  Zabbix us√≥ la <b><font color="#cc0000">API de Zabbix</font></b> para cargar datos e interactu√≥ con ella desde <i>Python</i> . <br><br>  En la primera etapa, se determin√≥ el conjunto de datos que necesit√°bamos para crear el objeto.  Utilizamos todos los signos obtenidos para la clasificaci√≥n correcta de un objeto en el sistema o para mayor comodidad.  Estos signos incluyen: <br><br><ul><li>  <i>Direcci√≥n IP</i> : el campo m√°s importante para crear una interfaz de monitoreo </li><li>  <i>ID de SAP</i> : tenemos un identificador de objeto √∫nico </li><li>  <i>Estado</i> : abierto / cerrado </li><li>  <i>Nombre</i> : el nombre o el n√∫mero del objeto, que los usuarios suelen utilizar al contactar </li><li>  <i>Ubicaci√≥n</i> : direcci√≥n f√≠sica </li><li>  <i>Tel√©fono</i> - tel√©fono de contacto </li><li>  <i>Grupos</i> : este grupo de grupos se forma seg√∫n el tipo y la ubicaci√≥n del objeto </li></ul><br><img src="https://habrastorage.org/webt/hr/hc/29/hrhc29q4zq8axnta-ift3gjpcwm.png"><br><br><h3>  M√≥dulo Sap-sync.py </h3><br><div class="spoiler">  <b class="spoiler_title">XML de SAP</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">werks</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WERKS</span></span></span><span class="hljs-tag">&gt;</span></span>1234<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WERKS</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NAME1</span></span></span><span class="hljs-tag">&gt;</span></span>4321-<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NAME1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PLANT_IP</span></span></span><span class="hljs-tag">&gt;</span></span>192.168.1.50<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PLANT_IP</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REGION</span></span></span><span class="hljs-tag">&gt;</span></span>31<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REGION</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PSTLZ</span></span></span><span class="hljs-tag">&gt;</span></span>308580<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PSTLZ</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CITY1</span></span></span><span class="hljs-tag">&gt;</span></span>.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CITY1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CITY2</span></span></span><span class="hljs-tag">&gt;</span></span> .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CITY2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">STREET</span></span></span><span class="hljs-tag">&gt;</span></span> .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">STREET</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HOUSE_NUM1</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HOUSE_NUM1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TEL_NUMBER</span></span></span><span class="hljs-tag">&gt;</span></span>(999)777-77-77<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TEL_NUMBER</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BRANCH</span></span></span><span class="hljs-tag">&gt;</span></span>CH<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BRANCH</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REGION</span></span></span><span class="hljs-tag">&gt;</span></span>CH_MSK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REGION</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REGION_NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">REGION_NAME</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORMAT</span></span></span><span class="hljs-tag">&gt;</span></span>CH_MSK_D<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORMAT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">STATUS</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">STATUS</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">werks</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">sap-sync.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 import sys, os, getopt, ipaddress from datetime import datetime as dt from zabbix.api import ZabbixAPI import xml.etree.cElementTree as et from report import report import existhost def ping(ip): if os.system('ping -c 2 -W 1 %s &gt; /dev/null'%ip) == 0: return True else: return False def main(argv): global opath try: opts, args = getopt.getopt(argv,"hp:",["path="]) except getopt.GetoptError: print('sync-sap-chg.py -p &lt;path&gt;') sys.exit(2) for opt, arg in opts: if opt == '-h': print('sync-sap-chg.py -p &lt;path&gt;') sys.exit() elif opt in ("-p", "--path"): opath = arg def asynchronization(file, reportdata): zapi = ZabbixAPI(url='http://z.noc.x5.ru', user='user', password='pwd') #,    left_kidney = '17855' right_kidney = '17856' f_type={'S':'Super','D':'DK','H':'Giper','A':'DK'} format={'D':'13','S':'14','H':'12','A':'13'} region={'CT':'21','UR':'19','SZ':'17',~omit~} try: #  XML tree = et.ElementTree(file=file) root = tree.getroot() for werks in root.iter('werks'): #     Zabbix interfaces=[{ 'main':'1', 'type':'2', 'useip':'1', 'port':'161' }] shop={ 'inventory':{}, 'interfaces':interfaces, 'groups':[], 'templates':[{'templateid':'10194'}], 'inventory_mode':'1' } #,     XML di = { 'WERKS':'', ~omit~, 'STATUS':'Object Opened' } #    for item in werks: di[item.tag] = item.text #  SAPID   if item.tag == 'WERKS': n_proxy = ''.join(filter(lambda x: x.isdigit(), item.text)) # IP    .   /26 try: ipaddress.ip_interface('%s/%s'%(di['PLANT_IP'].strip(),26)) ip_chk = True except: ip_chk = False # ,   IP   if (di['PLANT_IP'] != '1.1.1.1') and ip_chk: #    if di['FORMAT'][-1] in ['D','A','S','H']: shop['inventory']['alias']=di['WERKS'] shop['inventory']['name']=di['NAME1'] shop['inventory']['poc_1_phone_a']=di['TEL_NUMBER'] shop['inventory']['location']=di['STREET'] #    if (di['FORMAT'][-1] in ['H']): shop['host']=f_type[di['FORMAT'][-1]]+di['WERKS'] shop['interfaces'][0]['ip']=str(ipaddress.ip_interface('%s/%s'%(di['PLANT_IP'].strip(),24)).network[1]) # ID     shop['templates'][0]['templateid']='29529' elif (di['FORMAT'][-1] in ['S']): ~omit~ #For D balance in proxies if int(n_proxy[-1]) % 2 == 0: shop['proxy_hostid'] = right_kidney else: shop['proxy_hostid'] = left_kidney # inventory   IP shop['inventory']['oob_ip']=shop['interfaces'][0]['ip'] #    format  region shop['groups']=[{'groupid':'9'}] shop['groups'].append({'groupid':format[di['FORMAT'][-1]]}) shop['groups'].append({'groupid':region[di['FORMAT'][:2]]}) #   if di['STATUS'] == ' ': shop['status']='0' else: shop['status']='1' #   T = dt.date(dt.now()).strftime("%d %B %Y") shop['inventory']['date_hw_decomm'] = T #      Zabbix hostid = existhost.exist(shop['host']) ip = shop['interfaces'][0]['ip'] #  - ! if hostid == 0 and shop['status'] == '0' and ping(ip): zapi.host.create(shop) reportdata['new'].append(di['WERKS']) #   - ! elif hostid != 0 and di['PLANT_IP'] != '1.1.1.1': #  HOSTID  shop['hostid']=hostid #     shop.pop('interfaces') zapi.host.update(shop) reportdata['update'].append(di['WERKS']) #     os.system('mv %s /mnt/ftp/old_data/'%(file)) except: reportdata['error'].append(di['WERKS']) report('   %s.   :%s'%(file, str(reportdata['error'])), 'SAP Sync Failed!') sys.exit() def checking(path): files = os.listdir(path) files.sort() reportdata ={'new':[], 'update':[], 'error':[]} for file in files: asynchronization(path+file, reportdata) if files != []: report(' %s  ! \n  %s . \n  sap:\n %s. \n  %s . \n  sap:\n %s'%(str(files), len(reportdata['new']), str(reportdata['new']), len(reportdata['update']), str(reportdata['update'])), 'SAP Sync Succeed!') if __name__ == "__main__": main(sys.argv[1:]) checking(opath)</span></span></code> </pre><br></div></div><br>  El objetivo principal de este m√≥dulo es el an√°lisis <i>XML</i> y la traducci√≥n <font color="#008080"><abbr title="Notaci√≥n de objeto JavaScript">JSON</abbr></font> para la API de Zabbix.  Es muy conveniente en este caso utilizar diccionarios de Python, ya que  no es necesario formatearlos adicionalmente: con el m√≥dulo <font color="#008080">zabbix.api</font> , simplemente puede darle un diccionario con la estructura correcta.  <i>JSON</i> con la estructura se ve as√≠: <br><br><pre> <code class="json hljs">{ 'host': 'Hostname' 'groups': [...] 'interfaces': [{},{},{}] 'inventory': {} 'templates': [{},{},{}] 'inventory_mode': '<span class="hljs-number"><span class="hljs-number">1</span></span>' 'proxy_hostid': 'INT' 'status': '<span class="hljs-number"><span class="hljs-number">0</span></span>' } [] -  {} - </code> </pre><br>  En nuestro campo con la direcci√≥n IP en SAP, la direcci√≥n del servidor se almacena, no el enrutador, pero usando el m√≥dulo <font color="#008080">ipaddress</font> consideramos la primera direcci√≥n de subred, que en nuestro caso siempre es un enrutador. <br><br><pre> <code class="python hljs">str(ipaddress.ip_interface(<span class="hljs-string"><span class="hljs-string">'%s/%s'</span></span>%(di[<span class="hljs-string"><span class="hljs-string">'PLANT_IP'</span></span>].strip(),<span class="hljs-number"><span class="hljs-number">24</span></span>)).network[<span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre><br>  La fecha de la √∫ltima actualizaci√≥n exitosa se registra en el <i>Inventario</i> , en situaciones controvertidas ayuda a comprender qu√© tan relevante es la informaci√≥n en el sistema. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   T = dt.date(dt.now()).strftime("%d %B %Y") shop['inventory']['date_hw_decomm'] = T</span></span></code> </pre><br>  Entonces es muy conveniente mirar las estad√≠sticas sobre la fecha de actualizaci√≥n en los datos del inventario: <br><br><img src="https://habrastorage.org/webt/ja/7j/kp/ja7jkpml-hjexniqyu-_5e2vrau.png"><br><br>  El campo m√°s importante - <b>ESTADO</b> , <i>"abierto"</i> - se agrega y comienza a ser monitoreado, cualquier otro estado - desactiva el host.  No eliminamos objetos para preservar datos hist√≥ricos y estad√≠sticas. <br><br>  Despu√©s de las pruebas, tuve que agregar la funci√≥n ping para verificar si el host es accesible antes de la adici√≥n inicial, porque  en la pr√°ctica, comenzaron a aparecer estados <i>"abiertos"</i> , que a√∫n no est√°n abiertos, pero casi. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ip)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.system(<span class="hljs-string"><span class="hljs-string">'ping -c 2 -W 1 %s &gt; /dev/null'</span></span>%ip) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br>  Anteriormente, la API de Zabbix ten√≠a una funci√≥n <b><font color="#008080">host.exist</font></b> , pero en las nuevas versiones se combinaba con <b><font color="#008080">host.get</font></b> .  Si el nodo existe, la solicitud devuelve <i>hostid</i> en la base de datos zabbix.  Si no se encuentra, devuelve 0. Para la verificaci√≥n, ahora ten√≠a que agregar <font color="#008080">existhost</font> , pero de hecho es <b><font color="#008080">host.get</font></b> . <br><br><div class="spoiler">  <b class="spoiler_title">existhost.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 import sys, getopt from zabbix.api import ZabbixAPI def main(argv): global aname try: opts, args = getopt.getopt(argv,"hn:",["name="]) except getopt.GetoptError: print('existhost.py -n &lt;name&gt;') sys.exit(2) for opt, arg in opts: if opt == '-h': print('existhost.py -n &lt;name&gt;') sys.exit() elif opt in ("-n", "--name"): aname = arg def exist(name): zapi = ZabbixAPI(url='http://z.noc.x5.ru/', user='user', password='pwd') hostget = zapi.host.get(search={'name':'%s'%name}, output='hostid') if hostget == []: return 0 else: return int(hostget[0]['hostid']) if __name__ == "__main__": main(sys.argv[1:]) print(exist(aname))</span></span></code> </pre><br></div></div><br>  Finalmente, recopilamos informaci√≥n sobre el trabajo realizado, la agregamos a los registros, informes y movemos el archivo procesado al repositorio en OLD. <br><br><div class="spoiler">  <b class="spoiler_title">report.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 # -*- coding: utf-8 -*- import smtplib, sys from email.mime.text import MIMEText def report(message, subject): me = 'zbx-scripts@x5.ru' you = 'mail@x5.ru' smtp_server = 'smtp.ru' msg = MIMEText(message) msg['Subject'] = subject msg['From'] = me msg['To'] = you s = smtplib.SMTP(smtp_server) s.sendmail(me, [you], msg.as_string()) s.quit() if __name__ == '__main__': report(sys.argv[2], sys.argv[1])</span></span></code> </pre><br></div></div><br>  En general, la base de monitoreo est√° lista, ejecuta el script en cron para la ejecuci√≥n autom√°tica y olv√≠dalo. <br><br><img src="https://habrastorage.org/webt/il/hk/0r/ilhk0rph3lcm1azoquz00y_zck0.jpeg"><br><br><h2>  C√≥mo llenar inventario </h2><br>  <i>Ya no somos nosotros, somos networkers.</i> <br><br>  La segunda etapa es llenar objetos con datos que los ingenieros necesitan para trabajar.  Es necesario ver todos los datos para resolver el incidente en un sistema, para no correr en diferentes sistemas, recolectando informaci√≥n en partes de diferentes fuentes.  Y dado que los datos t√©cnicos principales est√°n en el monitoreo, tambi√©n dibujamos el resto en el monitoreo. <br>  Para recopilar y transmitir la informaci√≥n necesaria, Zabbix escribi√≥ <b><font color="#008080">Inventory.py</font></b> , que se dedica principalmente a recopilar datos <font color="#008080"><abbr title="Protocolo simple de administraci√≥n de red">SNMP</abbr></font> del equipo y, en menor medida, a analizar el archivo Excel. <br><br>  La pregunta comienza: ¬øpor qu√© no utilizar los elementos integrados e ingresar su resultado en el <i>inventario</i> utilizando las herramientas de Zabbix?  Hay tres respuestas: <br><br><ol><li>  Anidaci√≥n insuficiente de acciones, como  a menudo es necesario extraer el valor sobre SNMP y usar el resultado en la siguiente consulta. </li><li>  La ejecuci√≥n de una recopilaci√≥n de datos una vez al d√≠a en todos los nodos con un script externo no carga la actividad de monitoreo principal y no hay cola para item'am </li><li>  Hay datos que no se pueden recopilar a trav√©s de SNMP </li></ol><br>  Los datos sobre los proveedores, de los cuales los ingenieros de primera y segunda l√≠nea no pueden prescindir, se almacenan en un archivo de Excel en una unidad de red compartida y los gerentes que realizan contratos de comunicaciones los actualizan.  La integraci√≥n con el archivo caus√≥ grandes dudas: el an√°lisis de Excel, completado manualmente, que puede cambiar la estructura, el nombre, la ubicaci√≥n, etc., probablemente arrojar√° errores constantemente.  Pero debido a la falta de otra fuente relevante de dichos datos, tuve que usarlo.  Para protegernos de alguna manera de la edici√≥n constante del script, acordamos con los gerentes sobre la estructura y el llenado correcto, explicamos c√≥mo se realizar√° la descarga autom√°tica y que es importante observar la estructura actual.  En la pr√°ctica, por supuesto, se produjeron errores, pero los rastreamos r√°pidamente, los maldecimos, pero los corregimos. <br><br><div class="spoiler">  <b class="spoiler_title">inventario.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 # -*- coding: utf-8 -*- import sys, json, pysnmp, ipaddress, xlrd from datetime import datetime as dt from pysnmp.entity.rfc3413.oneliner import cmdgen def snmp(host, operation, *oid): generator = cmdgen.CommandGenerator() auth_data = cmdgen.UsmUserData('user', 'pwd', 'hash') transport = cmdgen.UdpTransportTarget((host, 161)) getAtt = getattr(generator, '%sCmd'%operation) rst = (errorIndication, errorStatus, errorIndex, varBinds) = getAtt(auth_data, transport, *oid) if not errorIndication is None or errorStatus is True: return "Error: %s %s %s %s" % rst else: if operation=='get': return varBinds elif operation=='next': result=[] for var in varBinds: result.append(var) return result def xlsdata(file, sap): rb = xlrd.open_workbook(file) sheet = rb.sheet_by_index(0) base = {} for i in range(0, sheet.nrows-1): sapnum = str(round(sheet.cell(i,4).value)) if isinstance(sheet.cell(i,4).value,float) else sheet.cell(i,4).value name = str(round(sheet.cell(i,8).value)) if isinstance(sheet.cell(i,8).value,float) else sheet.cell(i,8).value if sap.upper() == sapnum.upper(): base = { 'type' : (sheet.cell(i,2).value), 'serialno_a' : (sheet.cell(i,13).value), 'serialno_b' : (sheet.cell(i,20).value), 'tag' : ('2') if sheet.cell(i, 20).value != '' else ('1'), 'macaddress_a' : (sheet.cell(i, 15).value), 'macaddress_b' : (sheet.cell(i, 22).value) } base['date_hw_purchase'] = dt.date(dt.now()).strftime("%d %B %Y") return (base) def inventory(host, sap): BGPASBASE={} for line in open('/path/a.prokhorov/integration/BGP-AS-BASE.cfg'): if ':' in line: line = line.split(':') BGPASBASE[line[0]]='%s(%s)'%(line[1].rstrip(), line[0]) ### Get Data from Operator shop = xlsdata('/mnt/oprf/providers_base.xlsx', sap) shop['date_hw_expiry'] = 'Failed' ### Get SNMP data shop['host_router'] = 'None' shop['host_netmask'] = 'None' shop['host_networks'] = 'None' try: ### Get Networks from router networks = '' for ip,mask in snmp(host, 'next', 'iso.3.6.1.2.1.4.20.1.1', 'iso.3.6.1.2.1.4.20.1.3'): networks = networks+str(ipaddress.ip_interface(u'%s/%s'%(ip[1].prettyPrint(), mask[1].prettyPrint())))+'\n' shop['host_networks']=networks ### Get BGP information bgppeers, ispnames = '','' for peer,asbgp in snmp(host, 'next', 'iso.3.6.1.2.1.15.3.1.7', 'iso.3.6.1.2.1.15.3.1.9'): asbgp = asbgp[1].prettyPrint() bgppeers = bgppeers+peer[1].prettyPrint()+'\n' ispnames = ispnames+(BGPASBASE.get(asbgp) if BGPASBASE.get(asbgp)!=None else asbgp)+'\n' shop['host_router'] = bgppeers.strip()[:38] shop['host_netmask'] = ispnames.strip()[:38] ### Get Vendor name and Model type hardware = snmp(host, 'get', 'iso.3.6.1.2.1.47.1.1.1.1.13.1', 'iso.3.6.1.2.1.47.1.1.1.1.10.1', 'iso.3.6.1.2.1.47.1.1.1.1.12.1', 'iso.3.6.1.2.1.1.1.0', 'iso.3.6.1.2.1.47.1.1.1.1.7.1') if str(hardware[0][1]) == '0235A325': shop['model'] = hardware[4][1].prettyPrint() else: shop['model'] = hardware[0][1].prettyPrint() shop['os_short'] = hardware[1][1].prettyPrint() shop['vendor'] = hardware[2][1].prettyPrint() version = hardware[3][1].prettyPrint() os = version.split('\n')[0] shop['os_full'] = version[:250] shop['os'] = ''.join(os.split(',')[:2])[:60] ### Make indicators shop['date_hw_expiry'] = 'Success' shop['date_hw_install'] = dt.date(dt.now()).strftime("%d %B %Y") except: shop.pop('host_router') shop.pop('host_netmask') shop.pop('host_networks') return shop #return json.dumps(dict([('inventory',shop)]), sort_keys=True, indent=4) if __name__ == "__main__": print(inventory(sys.argv[1], sys.argv[2]))</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">BGP-AS-BASE.cfg</b> <div class="spoiler_text"> <code>3216:Beeline <br> 9002:Retn <br> 2854:Orange <br> ~omit~ <br> 8359:MTS <br></code> <br></div></div><br>  El <i>archivo BGP-AS-BASE.cfg</i> representa la correspondencia del n√∫mero <i>AS</i> y el nombre del proveedor.  Es necesario determinar el proveedor con el que <i>est√°</i> instalado <i>BGP</i> (de repente hay un error en el archivo con los contratos).  La base externa no se utiliz√≥, ya que  Hay muchos n√∫meros <i>AS</i> privados. <br><br>  En t√©rminos de <font color="#008080">SNMP</font> : <br><br><ul><li>  solicitamos de las subredes del enrutador por <font color="#008080"><abbr title="Identificador de objeto">OID</abbr></font> <i>1.3.6.1.2.1.4.20.1.1</i> y m√°scaras de subred por <i>OID</i> <i>1.3.6.1.2.1.4.20.1.3</i> en una solicitud.  Lo procesamos, lo traducimos a <i>xxxx / xx</i> y lo escribimos en la celda <i>host_networks</i> . </li><li>  Solicitamos datos sobre las direcciones IP de los pares de <i>BGP</i> , as√≠ como su <i>ASN</i> , encontramos el nombre del proveedor por n√∫mero en la base de datos que creamos.  Los escribimos en los <i>campos</i> <i>host_router</i> y <i>host_netmask</i> .  Es importante establecer de inmediato un l√≠mite de 38 caracteres, ya que  Estos campos no admiten m√°s.  Nuestros nombres de campo en la base de datos no siempre coinciden con los datos que almacenan, porque  utiliz√≥ los campos existentes en la base de datos Zabbix, para no meterse con la creaci√≥n de nuevos campos en la tabla.  Los nombres de campo correctos fueron corregidos en la WEB, no hubo confusi√≥n. </li><li>  cargamos datos sobre el proveedor, modelo y equipo de software.  Parsim, escribe a las variables.  El dise√±o asociado con la escritura del modelo del hardware se debe al hecho de que para algunos modelos <i>Cisco tiene un</i> nombre escrito en un <font color="#008080">OID</font> diferente (con mayor frecuencia para el chasis), por lo que tuve que hacer una verificaci√≥n de datos adicional. </li></ul><br>  Todo el bloque asociado con SNMP est√° encerrado en <i>try-except</i> , de modo que si no hay SNMP en el equipo, el script no se cae, y al menos obtenemos datos de Excel por parte de los proveedores.  Para comprender qu√© parte del script se ha completado y cu√°l no, escribimos el √©xito del bloque SNMP en el campo <i>date_hw_expiry</i> , adem√°s de la fecha en que la √∫ltima vez que pudimos eliminar todos los datos de SNMP y la fecha en que fue la √∫ltima vez que pudimos encontrar los datos en el archivo de Excel. <br><img src="https://habrastorage.org/webt/cc/he/en/ccheenqcce-qkrwbxcerarkji2e.png"><br><br>  Todo esto vuelve en forma de <i>JSON</i> listo para Zabbix. <br><br>  La actualizaci√≥n de todos los datos de inventario se inicia una vez al d√≠a, descargando todos los hosts e iniciando <b><i>Inventory.py</i></b> para cada objeto. <br><br><div class="spoiler">  <b class="spoiler_title">mp-update.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 # -*- coding: utf-8 -*- from multiprocessing import Pool import time from zabbix.api import ZabbixAPI from inventory import inventory from report import report def updating(shop): try: shop['inventory'] = inventory(shop['interfaces'][0]['ip'], shop['host'][-4:]) shop.pop('interfaces') shop['inventory_mode'] = '1' shop.pop('host') print (shop['hostid']) return zapi.host.update(shop) except: print("&gt;&gt;&gt;",shop['hostid']) with open ('/home/local/integration/error.txt', 'a') as err: err.write(shop['hostid']) err.write("\n") if __name__ =='__main__': t = time.time() zapi = ZabbixAPI(url='http://z.noc.x5.ru/', user='user', password='pwd') shopbase = zapi.host.get(output=['host', 'hostid'], groupids= ['12', '13', '14'], monitored="1", selectInterfaces=['ip']) pool = Pool(processes=10) p=[0 for x in range(0,len(shopbase))] for i in range(0, len(shopbase), 10): print ("Index:", i,"\n",shopbase[i],"\n") pool.map(updating,shopbase[i:i+10]) pool.close() pool.join() print(time.time()-t) report('    Zabbix.', 'Inventory updating succeed')</span></span></code> </pre><br></div></div><br>  <font color="#008080">Se</font> utiliza el <font color="#008080">multiprocesamiento</font> (se toma un ejemplo de las vastas extensiones de Internet).  Para buscar, utilizamos la <i>ID de SAP</i> , que tenemos en el nombre del host.  El resultado resultante es la <i>actualizaci√≥n</i> escrita 'ohm en Zabbix. <br><br><h3>  Resumen </h3><br>  Para la implementaci√≥n de toda la integraci√≥n, actualizaci√≥n autom√°tica y actualizaci√≥n de los mecanismos integrados, la API de Zabbix es m√°s que suficiente.  Las funciones principales utilizadas son <i>host.get</i> , <i>host.create</i> y <i>host.update</i> , que juntas le permiten controlar completamente la creaci√≥n y actualizaci√≥n de la base de datos de objetos de monitoreo.  Los datos de entrada de estas funciones pueden enviarse desde cualquier sistema y fuente disponible. <br><br>  Los principales m√≥dulos de Python que nos ayudaron a hacer frente a esta tarea: <i>pysnmp</i> , <i>xlrd</i> , <i>zabbix.api</i> , <i>xml</i> , <i>ipaddress</i> , <i>json</i> . <br>  <i><font color="#008080">xlrd</font></i> : an√°lisis de Excel. <br>  <i><font color="#008080">xml</font></i> : an√°lisis XML. <br>  <i><font color="#008080">pysnmp</font></i> : extracci√≥n de datos SNMP del equipo. <br><br>  La interacci√≥n SNMP es m√°s f√°cil que SSH, al menos porque en la pr√°ctica la pieza de hardware responde m√°s r√°pidamente a SNMP que a SSH, analizar las respuestas SNMP es pr√°cticamente innecesario, aunque las CLI de diferentes proveedores a menudo son muy diferentes entre s√≠, y las conclusiones son las mismas. los equipos pueden diferir incluso en diferentes modelos del mismo proveedor. <br><br>  Los principales <i>OID</i> aplicados: <br>  <i>iso.3.6.1.2.1.4.20.1.1</i> : direcciones de todas las interfaces de enrutador <br>  <i>iso.3.6.1.2.1.4.20.1.3</i> : m√°scaras de subred de todas las interfaces de enrutador <br>  <i>iso.3.6.1.2.1.15.3.1.7</i> - todos los pares BGP del enrutador <br>  <i>iso.3.6.1.2.1.15.3.1.9</i> - AS de todos los pares BGP del enrutador <br>  <i>iso.3.6.1.2.1.47.1.1.1.1.13.1</i> - modelo <br>  <i>iso.3.6.1.2.1.47.1.1.1.1.10.1</i> - versi√≥n corta del software <br>  <i>iso.3.6.1.2.1.47.1.1.1.1.1.12.1</i> - proveedor <br>  <i>iso.3.6.1.2.1.1.1.0</i> - versi√≥n detallada del software <br>  <i>iso.3.6.1.2.1.47.1.1.1.1.7.1</i> - modelo, tipo de chasis <br><br>  <i>Dashboard</i> tuvo que agregarse un poco para dividir los problemas en las redes de distribuci√≥n y no interferir con ellos en un mont√≥n.  Agregue tambi√©n varios campos, por ejemplo, ip, nombre y direcci√≥n del proveedor, de modo que en caso de un accidente masivo ser√≠a suficiente copiar y pegar del navegador en el mensaje todos los objetos con un problema, inmediatamente con todos los datos necesarios para el proveedor. <br><img src="https://habrastorage.org/webt/ea/m3/zo/eam3zojwyhottbk5offhtkltg3o.png"><br><br>  <i>"Workview"</i> se escribi√≥ por <i>separado</i> , en el que podemos encontrar toda la informaci√≥n recopilada, adem√°s de los gr√°ficos que se recopilan para este objeto. <br><br><img src="https://habrastorage.org/webt/m1/m-/jp/m1m-jpml-eypxjlgqlsoltn7in4.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438754/">https://habr.com/ru/post/438754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438740/index.html">Gesti√≥n de secretos con HashiCorp Vault</a></li>
<li><a href="../438746/index.html">En el camino hacia los principios f√≠sicos de la evoluci√≥n biol√≥gica. Continuaci√≥n</a></li>
<li><a href="../438748/index.html">Infraestructura como c√≥digo, ganamos a escala (Kirill Vetchinkin, TYME)</a></li>
<li><a href="../438750/index.html">Civilizaci√≥n de Springs, 4/5</a></li>
<li><a href="../438752/index.html">Contabilidad directamente en el banco: c√≥mo hacer felices a los empresarios individuales</a></li>
<li><a href="../438756/index.html">Sexto control de cromo, ep√≠logo</a></li>
<li><a href="../438758/index.html">¬øPor qu√© Google cambia la interfaz URL est√°ndar en el navegador?</a></li>
<li><a href="../438762/index.html">DBX: intente deshacerse de compilar consultas MySQL</a></li>
<li><a href="../438764/index.html">Sexta prueba de cromo, ep√≠logo</a></li>
<li><a href="../438766/index.html">ADN extracelular como biomarcador del envejecimiento y diversas patolog√≠as.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>