<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèø üõ∂ üéûÔ∏è Monitoramento de sistemas distribu√≠dos - Google Experience (tradu√ß√£o do cap√≠tulo do livro do Google SRE) üë®üèª‚Äçüé§ üôÜüèø üëßüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SRE (Site Reliability Engineering) - uma abordagem para garantir a disponibilidade de projetos da web. Ele √© considerado uma estrutura para o DevOps e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento de sistemas distribu√≠dos - Google Experience (tradu√ß√£o do cap√≠tulo do livro do Google SRE)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484246/"><img src="https://habrastorage.org/webt/rj/u4/8s/rju48s3gqxozu32f2esipgkpc6c.png"><br><br>  SRE (Site Reliability Engineering) - uma abordagem para garantir a disponibilidade de projetos da web.  Ele √© considerado uma estrutura para o DevOps e mostra como ter sucesso na aplica√ß√£o de pr√°ticas do DevOps.  Este artigo √© uma tradu√ß√£o do <a href="https://landing.google.com/sre/book/chapters/monitoring-distributed-systems.html">Cap√≠tulo 6 Monitorando sistemas distribu√≠dos</a> do livro <a href="https://landing.google.com/sre/book.html">Engenharia de confiabilidade</a> do <a href="https://landing.google.com/sre/book.html">site</a> do Google.  Eu mesmo preparei esta tradu√ß√£o e confiei em minha pr√≥pria experi√™ncia na compreens√£o dos processos de monitoramento.  No canal de telegrama <a href="https://t.me/monitorim_it/28">@monitorim_it</a> e no <a href="https://medium.com/%40antonkasimov/%25D1%2586%25D0%25B5%25D0%25BB%25D0%25B8-%25D1%2583%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BD%25D1%258F-%25D0%25BE%25D0%25B1%25D1%2581%25D0%25BB%25D1%2583%25D0%25B6%25D0%25B8%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F-%25D0%25BE%25D0%25BF%25D1%258B%25D1%2582-google-630008918e9f%3Fsource%3Dfriends_link%255E_%255Eamp%255E_%255Esk%3D0b7f6ab888298580001b027434c53c56">blog Medium,</a> tamb√©m publiquei um link para a tradu√ß√£o do quarto cap√≠tulo do mesmo livro sobre os objetivos do n√≠vel de servi√ßo. <br><br>  Tradu√ß√£o por cat.  Boa leitura! <br><a name="habracut"></a><br>  As equipes do Google SRE t√™m os princ√≠pios b√°sicos e as pr√°ticas recomendadas para criar sistemas bem-sucedidos de monitoramento e notifica√ß√£o.  Este cap√≠tulo fornece recomenda√ß√µes sobre quais problemas um visitante da p√°gina da Web pode encontrar e como resolver problemas que dificultam a exibi√ß√£o da p√°gina. <br><br><h1>  Defini√ß√µes </h1><br>  N√£o existe um vocabul√°rio √∫nico usado para discutir t√≥picos relacionados ao monitoramento.  Mesmo no Google, os termos abaixo n√£o s√£o comumente usados, mas listaremos as interpreta√ß√µes mais comuns. <br><br><h3>  Monitoramento </h3><br>  Coleta, processamento, agrega√ß√£o e exibi√ß√£o de dados quantitativos em tempo real sobre o sistema: n√∫mero de solicita√ß√µes e tipos de solicita√ß√µes, n√∫mero de erros e tipos de erros, tempo de processamento da solicita√ß√£o e tempo de atividade do servidor. <br><br><h3>  Monitoramento de caixa branca </h3><br>  Monitoramento com base nas m√©tricas exibidas pelos componentes internos do sistema, incluindo logs, m√©tricas de cria√ß√£o de perfil da Java virtual machine ou manipulador HTTP que geram estat√≠sticas internas. <br><br><h3>  Monitoramento de caixa preta </h3><br>  Testando o comportamento do aplicativo do ponto de vista do usu√°rio. <br><br><h3>  Painel (pain√©is) </h3><br>  Uma interface (geralmente a web) que fornece uma vis√£o geral dos principais indicadores de sa√∫de dos servi√ßos.  O painel pode ter filtros, a capacidade de selecionar indicadores a serem exibidos etc. A interface √© criada para identificar os indicadores mais importantes para os usu√°rios.  As informa√ß√µes da equipe de suporte t√©cnico tamb√©m podem ser exibidas no painel: fila de solicita√ß√µes, lista de erros de alta prioridade, engenheiro designado para uma determinada √°rea de responsabilidade. <br><br><h3>  Alerta (aviso) </h3><br>  Notifica√ß√µes projetadas para serem recebidas por uma pessoa por email ou de outra maneira, que podem ser iniciadas como resultado de erros ou um aumento na fila de solicita√ß√µes.  As notifica√ß√µes s√£o classificadas como: tickets, alertas por email e mensagens do messenger. <br><br><h3>  Causa raiz </h3><br>  Um defeito de software ou fator humano que n√£o deve ocorrer novamente quando eliminado.  O problema pode ter v√°rios motivos principais: automa√ß√£o insuficiente de processos, defeito de software, estudo insuficiente da l√≥gica do aplicativo.  Cada um desses fatores pode ser a causa raiz e cada um deles deve ser eliminado. <br><br><h3>  N√≥ e m√°quina </h3><br>  Termos intercambi√°veis ‚Äã‚Äãpara indicar uma √∫nica inst√¢ncia de um aplicativo em execu√ß√£o em um servidor f√≠sico, m√°quina virtual ou cont√™iner.  Pode haver v√°rios servi√ßos em uma m√°quina.  Os servi√ßos podem ser: <br><br><ul><li>  relacionados entre si: por exemplo, um servidor de cache e um servidor da web; </li><li>  servi√ßos n√£o relacionados em um √∫nico hardware: por exemplo, um reposit√≥rio de c√≥digos e um assistente para um sistema de configura√ß√£o, como <a href="https://puppetlabs.com/puppet/puppet-open-source">Puppet</a> ou <a href="https://www.chef.io/chef/">Chef</a> . </li></ul><br><h3>  Push </h3><br>  Qualquer altera√ß√£o na configura√ß√£o do software. <br><br><h1>  Por que o monitoramento √© necess√°rio </h1><br>  H√° v√°rias raz√µes pelas quais os aplicativos devem ser monitorados: <br><br><h3>  An√°lise de tend√™ncias longas </h3><br>  Qual √© o tamanho do banco de dados e com que rapidez est√° crescendo?  Como o n√∫mero di√°rio de usu√°rios est√° mudando? <br><br><h3>  Compara√ß√£o de desempenho </h3><br>  As consultas do Acme Bucket of Bytes 2.72 s√£o mais r√°pidas que o Ajax DB 3.14?  Qual a melhor qualidade das solicita√ß√µes em cache ap√≥s o aparecimento de um n√≥ adicional?  O site ficou mais lento em compara√ß√£o com a semana passada? <br><br><h3>  Alerta (notifica√ß√µes) </h3><br>  Algo est√° quebrado e algu√©m precisa corrigi-lo.  Ou algo vai quebrar em breve e algu√©m deve dar uma olhada em breve. <br><br><h3>  Criar pain√©is </h3><br>  Os pain√©is devem responder a perguntas b√°sicas e incluir alguns dos <a href="https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/">"4 sinais de ouro"</a> - lat√™ncia, tr√°fego, erros e carga (satura√ß√£o). <br><br><h3>  Realizando uma an√°lise retrospectiva (depura√ß√£o) </h3><br>  O atraso no processamento de solicita√ß√µes aumentou e o que mais aconteceu ao mesmo tempo? <br>  Os sistemas de monitoramento s√£o √∫teis como fonte de dados para sistemas de intelig√™ncia de neg√≥cios e para simplificar a an√°lise de incidentes de seguran√ßa.  Como este livro se concentra nas √°reas de engenharia nas quais os SREs t√™m experi√™ncia, n√£o discutiremos aqui as t√©cnicas de monitoramento. <br><br>  O monitoramento e alertas permitem que o sistema avise quando ele quebrou ou est√° prestes a quebrar.  Quando o sistema n√£o pode se recuperar automaticamente, queremos que o alerta seja analisado pela pessoa, determinado se o problema √© relevante, corrigido e determinado sua causa raiz.  Se voc√™ n√£o auditar os componentes do sistema, nunca receber√° um alerta simplesmente porque "algo parece um pouco estranho". <br><br>  A carga de alertas humanos √© um uso bastante caro do tempo do funcion√°rio.  Se um funcion√°rio estiver trabalhando, um alerta interrompe o fluxo de trabalho.  Se o funcion√°rio estiver em casa, a notifica√ß√£o interrompe o tempo pessoal e, possivelmente, dorme.  Quando os alertas ocorrem com muita frequ√™ncia, os funcion√°rios examinam, atrasam ou ignoram rapidamente os alertas recebidos.  De tempos em tempos, eles ignoram o alerta real, mascarado por eventos de ru√≠do.  As interrup√ß√µes do servi√ßo podem durar muito tempo, porque os eventos de ru√≠do interferem no diagn√≥stico e solu√ß√£o de problemas r√°pidos.  Sistemas de alerta eficientes t√™m uma boa rela√ß√£o sinal / ru√≠do. <br><br><h1>  Definindo expectativas razo√°veis ‚Äã‚Äãde um sistema de monitoramento </h1><br>  Configurar o monitoramento de um aplicativo complexo √©, por si s√≥, uma tarefa de engenharia dif√≠cil.  Mesmo com uma infraestrutura significativa de ferramentas para coletar, exibir e alertar, a equipe do Google SRE com 10 a 12 membros geralmente inclui uma ou duas pessoas cujo objetivo principal √© criar e manter sistemas de monitoramento.  Esse n√∫mero diminuiu com o tempo √† medida que generalizamos e centralizamos a infraestrutura de monitoramento, mas cada equipe de SRE geralmente possui pelo menos uma equipe de monitoramento.  Devo dizer que, embora seja bastante interessante observar os pain√©is do sistema de monitoramento, as equipes do SRE evitam cuidadosamente situa√ß√µes que exigem que algu√©m olhe a tela para monitorar problemas. <br><br>  Em geral, o Google mudou para sistemas de monitoramento simples e r√°pidos, com ferramentas ideais para an√°lise p√≥s-factum.  Evitamos sistemas "m√°gicos" que tentam prever limites ou detectar automaticamente a causa raiz.  Sensores que detectam conte√∫do inapropriado nas solicita√ß√µes do usu√°rio final s√£o os √∫nicos contra-exemplos;  Enquanto esses sensores permanecerem simples, eles poder√£o identificar rapidamente as causas de anomalias graves.  Outros formatos para usar dados de monitoramento, como planejamento de capacidade ou previs√£o de tr√°fego, s√£o mais desafiadores.  A observa√ß√£o realizada por um per√≠odo muito longo (meses ou anos) com uma baixa taxa de amostragem (horas ou dias) revelar√° uma tend√™ncia de longo prazo. <br><br>  A equipe do Google SRE trabalhou com sucesso vari√°vel com hierarquias de depend√™ncia complexas.  Raramente usamos regras como "se eu descobrir que o banco de dados come√ßou a funcionar lentamente, recebo uma notifica√ß√£o sobre a lentid√£o do banco de dados, caso contr√°rio, recebo um alerta sobre um site de execu√ß√£o lenta".  As regras baseadas em depend√™ncia geralmente se aplicam a partes invari√°veis ‚Äã‚Äãdo nosso sistema, como um sistema para filtrar o tr√°fego do usu√°rio em um data center.  Por exemplo, ‚Äúse a filtragem de tr√°fego para o datacenter estiver configurada, n√£o me avise sobre atrasos no processamento de solicita√ß√µes de usu√°rio‚Äù - essa √© uma regra geral para notifica√ß√µes do datacenter.  Poucas equipes no Google suportam hierarquias de depend√™ncia complexas porque nossa infraestrutura tem uma taxa de refatora√ß√£o cont√≠nua e constante. <br><br>  Algumas das id√©ias descritas neste cap√≠tulo ainda s√£o relevantes: sempre h√° a oportunidade de passar mais rapidamente de um sintoma para uma causa raiz, especialmente em sistemas em constante mudan√ßa.  Portanto, embora este cap√≠tulo descreva alguns objetivos para os sistemas de monitoramento e maneiras de alcan√ß√°-los, √© importante que os sistemas de monitoramento sejam simples e compreens√≠veis para todos da equipe. <br><br>  Da mesma forma, para manter um n√≠vel baixo de ru√≠do e alto n√≠vel de sinal, as abordagens para monitorar objetos para os quais os alertas est√£o sendo feitos devem ser muito simples e confi√°veis.  As regras que geram avisos para as pessoas devem ser f√°ceis de entender e apresentar um problema claro. <br><br><h1>  Sintomas vs. Causas </h1><br>  Seu sistema de monitoramento deve responder a duas perguntas: "o que quebrou" e "por que quebrou". <br>  "O que est√° quebrado" fala do sintoma e "por que est√° quebrado" da causa.  A tabela abaixo mostra exemplos desses pacotes configur√°veis. <br><div class="scrollable-table"><table><tbody><tr><td align="center">  <b>Sintoma</b> </td><td align="center">  <b>Raz√£o</b> </td></tr><tr><td>  Obtendo o erro HTTP 500 ou 404 </td><td>  Servidores de banco de dados rejeitam conex√µes </td></tr><tr><td>  Respostas lentas do servidor </td><td>  Alta utiliza√ß√£o da CPU ou danos no cabo Ethernet </td></tr><tr><td>  Usu√°rios da Ant√°rtica n√£o recebem gifs de gatos </td><td>  Seu CDN odeia cientistas e gatos, ent√£o alguns endere√ßos IP est√£o na lista negra </td></tr><tr><td>  Conte√∫do privado est√° dispon√≠vel em qualquer lugar </td><td>  A implanta√ß√£o de uma nova vers√£o do software fez o firewall esquecer todas as ACLs e deixar todos em fila </td></tr></tbody></table></div><br>  ‚ÄúO que‚Äù e ‚Äúpor que‚Äù s√£o alguns dos elementos mais importantes para criar um bom sistema de monitoramento com sinal m√°ximo e ru√≠do m√≠nimo. <br><br><h3>  Caixa preta vs caixa branca </h3><br>  Combinamos um amplo monitoramento de caixa branca com um modesto monitoramento de caixa preta para m√©tricas cr√≠ticas.  A maneira mais f√°cil de comparar a caixa preta com a caixa branca √© que a caixa preta √© orientada por sintomas e √© reativa ao inv√©s de monitoramento proativo: "o sistema n√£o est√° funcionando no momento".  A caixa branca depende dos recursos da verifica√ß√£o interna do sistema: logs de eventos ou servidores da web.  Assim, a caixa branca permite detectar problemas futuros, mau funcionamento que se assemelha a uma retransmiss√£o de uma solicita√ß√£o, etc. <br><br>  Observe que, em um sistema multicamada, um sintoma na √°rea de responsabilidade de um engenheiro √© um sintoma na √°rea de responsabilidade de outro engenheiro.  Por exemplo, o desempenho do banco de dados diminuiu.  As leituras lentas do banco de dados s√£o um sintoma para os SREs nos bancos de dados que os detectam.  No entanto, para o SRE front-end, que observa um site lento, o motivo da mesma leitura lenta do banco de dados √© a opera√ß√£o lenta do banco de dados.  Portanto, o monitoramento da caixa branca √†s vezes √© focado nos sintomas e √†s vezes em raz√µes, dependendo de qu√£o extenso √©. <br><br>  Ao coletar telemetria, √© necess√°rio o monitoramento de caixa branca para depura√ß√£o.  Se os servidores da Web responderem lentamente √†s consultas ao banco de dados, voc√™ precisar√° saber com que rapidez o servidor da Web interage com o banco de dados e com que rapidez ele responde.  Caso contr√°rio, voc√™ n√£o poder√° distinguir um servidor de banco de dados lento de um problema de rede entre o servidor da Web e o banco de dados. <br><br>  O monitoramento de caixa preta tem uma vantagem importante ao enviar alertas: voc√™ inicia uma notifica√ß√£o para o destinat√°rio quando o problema j√° levou a sintomas reais.  Por outro lado, para um problema de caixa preta que ainda n√£o surgiu, mas √© iminente, o monitoramento √© in√∫til. <br><br><h1>  Quatro sinais de ouro </h1><br>  Os quatro sinais de monitoramento dourados s√£o lat√™ncia, tr√°fego, erros e satura√ß√£o.  Se voc√™ puder medir apenas quatro m√©tricas em um sistema de usu√°rio, concentre-se nessas quatro. <br><br><h3>  Atraso </h3><br>  O tempo necess√°rio para processar a solicita√ß√£o.  √â importante distinguir entre o atraso de solicita√ß√µes com e sem √™xito.  Por exemplo, um erro HTTP 500 causado por uma perda de conex√£o com um banco de dados ou outro back-end pode ser diagnosticado muito rapidamente; no entanto, um erro HTTP 500 pode indicar uma falha na solicita√ß√£o.  Identificar o efeito do erro 500 no atraso geral pode levar a conclus√µes err√¥neas.  Por outro lado, um erro lento √© mesmo um erro r√°pido!  Portanto, √© importante rastrear o atraso com um erro, e n√£o apenas filtrar os erros. <br><br><h3>  Tr√°fego </h3><br>  O n√∫mero de solicita√ß√µes para o seu sistema √© medido em m√©tricas de alto n√≠vel do sistema.  Para um servi√ßo da Web, essa dimens√£o normalmente representa o n√∫mero de solicita√ß√µes HTTP por segundo, separadas pela natureza da solicita√ß√£o (por exemplo, conte√∫do est√°tico ou din√¢mico).  Para um sistema de streaming de √°udio, essa medi√ß√£o pode ser concentrada na velocidade de E / S da rede ou no n√∫mero de sess√µes simult√¢neas.  Para um sistema de armazenamento de valores-chave, essa medida pode ser transa√ß√µes ou resultados de pesquisa por segundo. <br><br><h3>  Erros </h3><br>  Essa √© a frequ√™ncia de solicita√ß√µes sem √™xito que s√£o explicitamente (por exemplo, HTTP 500), implicitamente (por exemplo, HTTP 200, mas em combina√ß√£o com o conte√∫do errado) ou uma pol√≠tica (por exemplo, ‚ÄúSe voc√™ registrou a resposta em um segundo, qualquer segundo √© um erro‚Äù).  Se os c√≥digos de resposta do protocolo HTTP forem insuficientes para expressar todas as condi√ß√µes de falha, protocolos secund√°rios (internos) podem ser necess√°rios para detectar falhas parciais.  O monitoramento de todas essas solicita√ß√µes incorretas pode n√£o ser informativo, enquanto os testes completos do sistema ajudar√£o voc√™ a descobrir que est√° processando o conte√∫do errado. <br><br><h3>  Satura√ß√£o </h3><br>  A m√©trica mostra a intensidade com que seu servi√ßo √© usado.  Essa √© uma medida de monitoramento do sistema que identifica os recursos mais limitados (por exemplo, em um sistema com mem√≥ria limitada, ela mostra mem√≥ria, em um sistema com limita√ß√µes de E / S, o n√∫mero de E / S √© mostrado).  Observe que muitos sistemas degradam o desempenho antes de atingirem 100% de utiliza√ß√£o; portanto, √© importante ter um objetivo de uso. <br><br>  Em sistemas complexos, a satura√ß√£o pode ser complementada medindo a carga de um n√≠vel mais alto: seu servi√ßo pode lidar adequadamente com o tr√°fego duplo, processar apenas 10% mais tr√°fego ou processar ainda menos tr√°fego do que atualmente?  Para servi√ßos simples que n√£o possuem par√¢metros que alteram a complexidade da solicita√ß√£o (por exemplo, "N√£o me d√™ nada" ou "N√£o preciso de um √∫nico n√∫mero inteiro mon√≥tono") que raramente alteram sua configura√ß√£o, o valor est√°tico do teste de carga pode ser adequado. discutido no par√°grafo anterior, a maioria dos servi√ßos deve usar sinais indiretos, como utiliza√ß√£o da CPU ou largura de banda da rede, que possuem um limite superior conhecido.  O aumento da lat√™ncia geralmente √© um indicador prim√°rio de satura√ß√£o.  Medir o tempo de resposta do 99¬∫ percentil em uma pequena janela (por exemplo, um minuto) pode gerar um sinal de satura√ß√£o muito cedo. <br><br>  Por fim, a satura√ß√£o tamb√©m est√° associada a previs√µes de satura√ß√£o iminente, por exemplo: "Parece que seu banco de dados ir√° encher seu disco r√≠gido em 4 horas". <br><br>  Se voc√™ medir todos os quatro sinais dourados e quando surgir um problema com uma das m√©tricas (ou, no caso de satura√ß√£o, quase um problema), notifique a pessoa, seu servi√ßo ser√° mais ou menos monitorado. <br><br><h1>  Ansiedade sobre a cauda (ou instrumenta√ß√£o e desempenho) </h1><br>  Ao criar um sistema de monitoramento a partir do zero, √© tentador desenvolver um sistema com base em valores m√©dios: lat√™ncia m√©dia, utiliza√ß√£o m√©dia da CPU dos n√≥s ou ocupa√ß√£o m√©dia do banco de dados.  O perigo dos dois √∫ltimos exemplos √© √≥bvio: processadores e bancos de dados s√£o descartados de maneira muito imprevis√≠vel.  O mesmo vale para o atraso.  Se voc√™ executar um servi√ßo da Web com um atraso m√©dio de 100 ms a 1000 solicita√ß√µes por segundo, 1% das solicita√ß√µes poder√° levar 5 segundos.  Se os usu√°rios dependem de v√°rios desses servi√ßos da web, o percentil 99 de um back-end pode facilmente se tornar o tempo m√©dio de resposta da interface. <br><br>  A maneira mais simples de distinguir entre uma m√©dia lenta e uma ‚Äúcauda‚Äù muito lenta de consultas √© coletar dimens√µes de consulta expressas em estat√≠sticas (uma ferramenta adequada para exibir histogramas) em vez de atrasos reais: quantas solicita√ß√µes foram atendidas pelo servi√ßo, que levou entre 0 ms e 10 ms, entre 10 ms e 30 ms, entre 30 ms e 100 ms, entre 100 ms e 300 ms, etc. Expandir as bordas do histograma aproximadamente exponencialmente (com um coeficiente aproximado de 3) geralmente √© uma maneira simples de visualizar a distribui√ß√£o das consultas. <br><br><h1>  Selecionando o grau de detalhe apropriado para medi√ß√µes </h1><br>  Diferentes elementos do sistema devem ser medidos com diferentes graus de detalhe.  Por exemplo: <br><br><ul><li>  O monitoramento da utiliza√ß√£o da carga da CPU em um intervalo de tempo espec√≠fico n√£o mostrar√° valores discrepantes de longo prazo que resultam em altas lat√™ncias. </li><li>  Por outro lado, para um servi√ßo da Web que se concentre em n√£o mais de 9 horas de tempo de inatividade por ano (99,9% do tempo de atividade anual), a verifica√ß√£o de uma resposta HTTP de 200 mais de uma ou duas vezes por minuto provavelmente ser√° desnecessariamente frequente. </li><li>  Da mesma forma, a verifica√ß√£o de espa√ßo livre no disco r√≠gido para disponibilidade de 99,9% mais de uma vez a cada 1-2 minutos √© provavelmente desnecess√°ria. </li></ul><br>  Cuide de como voc√™ estrutura a granularidade das dimens√µes.  A frequ√™ncia de coleta da carga da CPU uma vez por segundo pode fornecer dados interessantes, mas essas medi√ß√µes frequentes podem ser muito caras para coletar, armazenar e analisar.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o objetivo de monitoramento exigir alta granularidade e n√£o exigir uma alta taxa de rea√ß√£o, voc√™ poder√° reduzir esses custos configurando a coleta de m√©tricas no servidor e, em seguida, configurando um sistema externo para coletar e agregar essas m√©tricas. </font><font style="vertical-align: inherit;">Voc√™ pode:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Me√ßa a utiliza√ß√£o da CPU a cada segundo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Corte os detalhes para 5%. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agregue m√©tricas a cada minuto. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Essa estrat√©gia permitir√° que os dados sejam coletados com alta granularidade sem sofrer alta an√°lise e sobrecarga de armazenamento. </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T√£o simples quanto poss√≠vel, mas n√£o mais f√°cil </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A imposi√ß√£o de requisitos diferentes entre si pode levar a um sistema de monitoramento muito complexo. </font><font style="vertical-align: inherit;">Por exemplo, seu sistema pode ter os seguintes elementos complicadores:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alertas de acordo com diferentes valores limite para o atraso no processamento de solicita√ß√µes, em diferentes percentis, para todos os tipos de indicadores diferentes. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Escrevendo c√≥digo adicional para detectar e identificar poss√≠veis causas. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Crie pain√©is relacionados para cada uma das poss√≠veis causas de problemas. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As fontes de complica√ß√µes potenciais nunca terminam. </font><font style="vertical-align: inherit;">Como todos os sistemas de software, o monitoramento pode se tornar t√£o complicado que se torna fr√°gil e dif√≠cil de mudar e manter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, projete seu sistema de monitoramento para simplific√°-lo o m√°ximo poss√≠vel. </font><font style="vertical-align: inherit;">Ao escolher o que rastrear, lembre-se do seguinte:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As regras que mais frequentemente capturam incidentes reais devem ser t√£o simples, previs√≠veis e confi√°veis ‚Äã‚Äãquanto poss√≠vel. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As configura√ß√µes para coleta, agrega√ß√£o e alertas de dados que raramente s√£o executadas (por exemplo, menos de uma vez por trimestre para alguns comandos do SRE) devem ser exclu√≠das. </font></font></li><li> ,  ,     -      - ,    . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No Google, a coleta e agrega√ß√£o b√°sicas de indicadores, combinadas com alertas e pain√©is, funcionam bem como um sistema relativamente aut√¥nomo (na verdade, o sistema de monitoramento do Google √© dividido em v√°rios subsistemas, mas geralmente as pessoas conhecem todos os aspectos desses subsistemas). Pode ser tentador combinar o monitoramento com outros m√©todos de verifica√ß√£o de sistemas complexos: cria√ß√£o de perfil detalhado do sistema, depura√ß√£o de processos, rastreamento de detalhes sobre exce√ß√µes ou falhas, teste de carga, coleta e an√°lise de logs ou verifica√ß√£o de tr√°fego. Embora a maioria dessas coisas tenha caracter√≠sticas comuns ao monitoramento b√°sico, mistur√°-las resultar√° em muitos resultados na cria√ß√£o de um sistema complexo e fr√°gil. Como em muitos outros aspectos do desenvolvimento de software, o suporte a v√°rios sistemas √© claro, simples,pontos de integra√ß√£o fracamente acoplados s√£o uma estrat√©gia melhor (por exemplo, usar uma API da web para recuperar dados resumidos em um formato que possa permanecer constante por um longo per√≠odo de tempo).</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vinculando princ√≠pios </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os princ√≠pios discutidos neste cap√≠tulo podem ser integrados a uma filosofia de monitoramento e alerta endossada e respeitada pelas equipes do Google SRE. </font><font style="vertical-align: inherit;">Aderir a essa filosofia de monitoramento √© desej√°vel, √© um bom ponto de partida para criar ou revisar uma metodologia de alerta e pode ajudar a fazer as perguntas certas ao servi√ßo operacional, independentemente do tamanho da sua organiza√ß√£o ou da complexidade do servi√ßo ou sistema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao criar regras de monitoramento e alerta, fazendo as seguintes perguntas, voc√™ pode evitar falsos positivos e alertas desnecess√°rios:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Essa regra detecta um estado indetect√°vel do sistema que √© urgente, exigindo a√ß√£o e inevitavelmente afetando o usu√°rio? </font></font></li><li>      , ,   ?               ? </li><li>    ,     ?   ,      , , -       ,     ? </li><li>          ?           ?     ?          ? </li><li>        ,      ? </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Essas perguntas refletem a filosofia fundamental de alertas e sistemas de alerta: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda vez que um alerta chega, devo responder com urg√™ncia. </font><font style="vertical-align: inherit;">Posso reagir com urg√™ncia v√°rias vezes ao dia antes de me cansar.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cada alerta deve ser relevante. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada resposta a um alerta deve exigir interven√ß√£o humana. </font><font style="vertical-align: inherit;">Se o alerta puder ser processado automaticamente, ele n√£o dever√° aparecer.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Os alertas devem ser sobre um novo problema ou evento que n√£o existia antes. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa abordagem apaga certas diferen√ßas: se a notifica√ß√£o atender √†s quatro condi√ß√µes anteriores, n√£o importa se a notifica√ß√£o √© enviada pelo sistema de monitoramento de caixa branca ou caixa preta. </font><font style="vertical-align: inherit;">Essa abordagem tamb√©m refor√ßa certas diferen√ßas: √© melhor gastar muito mais esfor√ßo na identifica√ß√£o dos sintomas do que nas causas; </font><font style="vertical-align: inherit;">Quando se trata de raz√µes, voc√™ s√≥ precisa se preocupar com as raz√µes inevit√°veis.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Monitoramento a longo prazo </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos ambientes produtivos atuais, os sistemas de monitoramento rastreiam um sistema produtivo em constante evolu√ß√£o com a arquitetura de software, as caracter√≠sticas de carga e o desempenho pretendido. Alertas atualmente dif√≠ceis de automatizar podem se tornar uma ocorr√™ncia frequente, talvez at√© digna de ser resolvida. Nesse ponto, algu√©m deve encontrar e eliminar as causas do problema; se essa permiss√£o n√£o for poss√≠vel, a resposta √† notifica√ß√£o exigir√° automa√ß√£o total.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â importante que as decis√µes de monitoramento sejam tomadas com objetivos de longo prazo em mente. </font><font style="vertical-align: inherit;">Cada aviso que √© realizado hoje distrai uma pessoa de melhorar o sistema amanh√£, com tanta frequ√™ncia que h√° uma diminui√ß√£o na disponibilidade ou produtividade de um sistema produtivo pelo tempo necess√°rio para melhorar o sistema de monitoramento a longo prazo. </font><font style="vertical-align: inherit;">Vejamos dois exemplos que ilustram esse fen√¥meno.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bigtable SRE: Hist√≥rico de alertas </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A infraestrutura interna do Google √© normalmente fornecida e medida em termos de n√≠vel de servi√ßo (SLO). Muitos anos atr√°s, o servi√ßo SLO da Bigtable era baseado no desempenho m√©dio de uma transa√ß√£o sint√©tica simulando um cliente que trabalha. Devido a problemas no Bigtable e em n√≠veis mais baixos da pilha de armazenamento de dados, o desempenho m√©dio ocorreu devido √† cauda ‚Äúgrande‚Äù: os piores 5% dos pedidos eram geralmente muito mais lentos que os demais.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As notifica√ß√µes por email foram enviadas √† medida que se aproximavam do limite do SLO, e os alertas ao mensageiro foram enviados quando o SLO foi excedido. Os dois tipos de alertas foram enviados com frequ√™ncia suficiente, consumindo quantidades inaceit√°veis ‚Äã‚Äãde tempo de engenharia: a equipe gastou um tempo consider√°vel analisando alertas para encontrar alguns que eram realmente relevantes. Muitas vezes perd√≠amos um problema que realmente afetava os usu√°rios, porque apenas alguns dos alertas eram especificamente para esse problema. Muitos dos alertas n√£o eram urgentes devido a problemas compreens√≠veis na infraestrutura e funcionavam de maneira padr√£o ou n√£o foram processados.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para remediar a situa√ß√£o, a equipe adotou uma abordagem tripla: ao fazer grandes esfor√ßos para melhorar o desempenho da Bigtable, definimos temporariamente o percentil 75 como nosso objetivo de SLO para atrasar a resposta √† solicita√ß√£o. </font><font style="vertical-align: inherit;">Tamb√©m desativamos os alertas por e-mail, pois havia muitos deles que eram imposs√≠veis de gastar tempo diagnosticando-os. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa estrat√©gia nos permitiu fazer uma pausa para come√ßar a corrigir problemas de longo prazo no Bigtable e nos n√≠veis mais baixos da pilha de armazenamento de dados, em vez de corrigir constantemente problemas t√°ticos. </font><font style="vertical-align: inherit;">Os engenheiros podiam realmente fazer o trabalho quando n√£o eram constantemente atacados por alertas. </font><font style="vertical-align: inherit;">Por fim, o atraso tempor√°rio no processamento de notifica√ß√µes nos permitiu melhorar a qualidade do servi√ßo.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gmail: respostas previs√≠veis e algor√≠tmicas de pessoas </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No in√≠cio, o Gmail foi criado em um sistema de controle de processo da fila de trabalho modificado, criado para fragmentos de √≠ndice de pesquisa de processo em lote. A fila de trabalho foi adaptada a processos de longa dura√ß√£o e posteriormente aplicada ao Gmail, mas alguns erros no c√≥digo do agendador opaco acabaram sendo muito dif√≠ceis de resolver. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naquele momento, o monitoramento do Gmail era estruturado de forma que os alertas eram acionados quando tarefas individuais eram canceladas usando a fila de trabalho. Essa abordagem n√£o era ideal, porque mesmo naquela √©poca o Gmail executava muitos milhares de tarefas, cada uma delas fornecida a fra√ß√µes de um por cento de nossos usu√°rios. Garantimos que os usu√°rios do Gmail tivessem uma boa interface de usu√°rio, mas a elabora√ß√£o de tantos alertas era inating√≠vel.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para resolver esse problema, o Gmail SRE criou uma ferramenta que ajudou a depurar o agendador da melhor maneira poss√≠vel, a fim de minimizar o impacto nos usu√°rios. A equipe teve v√°rias discuss√µes sobre se era apenas necess√°rio automatizar todo o ciclo, desde detectar um problema at√© resolv√™-lo at√© que uma solu√ß√£o de longo prazo fosse encontrada, mas alguns deles estavam preocupados com o fato de que tal solu√ß√£o atrasaria a corre√ß√£o real do problema.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa tens√£o era comum na equipe e geralmente refletia uma falta de confian√ßa na autodisciplina: enquanto alguns membros da equipe desejam dar tempo para uma corre√ß√£o correta, outros se preocupam com o fato de que a corre√ß√£o final ser√° esquecida e a corre√ß√£o tempor√°ria durar√° para sempre. Esse problema merece aten√ß√£o, pois √© muito f√°cil corrigir problemas temporariamente, em vez de precisar corrigir a situa√ß√£o continuamente. Gerentes e equipe t√©cnica desempenham um papel fundamental na implementa√ß√£o de corre√ß√µes de longo prazo, apoiando e priorizando corre√ß√µes potencialmente de longo prazo, mesmo quando a ‚Äúdor‚Äù inicial desaparece.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alertas recorrentes regulares e respostas algor√≠tmicas devem ser sinalizadores vermelhos. </font><font style="vertical-align: inherit;">A falta de vontade da sua equipe em automatizar esses alertas significa que a equipe n√£o tem confian√ßa de que pode confiar nos algoritmos. </font><font style="vertical-align: inherit;">Esse √© um problema s√©rio que precisa ser resolvido.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A longo prazo </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um tema comum vincula os exemplos do Bigtable e do Gmail: a competi√ß√£o entre a disponibilidade a curto e a longo prazo. </font><font style="vertical-align: inherit;">Freq√ºentemente, um grande esfor√ßo pode ajudar um sistema fr√°gil a obter alta disponibilidade, mas esse caminho geralmente dura pouco, repleto de desgaste da equipe e depend√™ncia de um pequeno n√∫mero de membros dessa equipe muito her√≥ica.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma diminui√ß√£o controlada e de curto prazo na disponibilidade geralmente √© uma tarefa dolorosa, mas estrategicamente importante para a estabilidade do sistema a longo prazo. √â importante n√£o considerar cada alerta isoladamente, mas considerar se o n√≠vel geral de alertas leva a um sistema saud√°vel e adequadamente acess√≠vel, com uma equipe vi√°vel e um progn√≥stico favor√°vel. Analisamos as estat√≠sticas da frequ√™ncia dos alertas (geralmente expressos como incidentes de turno, quando um incidente pode consistir em v√°rios incidentes relacionados) em relat√≥rios trimestrais com a ger√™ncia, que permite que os tomadores de decis√£o apresentem constantemente a carga no sistema de alerta e no estado geral da equipe.</font></font><br><br><h1>  Conclus√£o </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O caminho para o monitoramento e alertas saud√°veis ‚Äã‚Äã√© simples e direto. Ele se concentra nos sintomas do problema para o qual os alertas s√£o emitidos e o monitoramento da causa serve como uma ajuda para depurar problemas. O monitoramento de sintomas √© ainda mais f√°cil, quanto mais alto voc√™ estiver na pilha que controla, embora o monitoramento da carga e do desempenho do banco de dados deva ser feito diretamente nele. As notifica√ß√µes por email t√™m benef√≠cios muito limitados e tendem a crescer com facilidade; em vez disso, voc√™ deve usar um painel que monitore todos os problemas atuais enviados por email. O painel tamb√©m pode ser emparelhado com um log de eventos para analisar correla√ß√µes hist√≥ricas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A longo prazo, √© necess√°rio obter uma altern√¢ncia bem-sucedida de alertas sobre sintomas e problemas reais inevit√°veis, adaptar metas para garantir que o monitoramento suporte o diagn√≥stico r√°pido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obrigado por ler a tradu√ß√£o at√© o fim. </font><font style="vertical-align: inherit;">Inscreva-se no meu canal de telegrama sobre o monitoramento </font></font><a href="https://t.me/monitorim_it"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@monitorim_it</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><a href="https://medium.com/%40antonkasimov"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog no Medium</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484246/">https://habr.com/ru/post/pt484246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484224/index.html">Classifica√ß√£o LSD bit a bit (classifica√ß√£o Radix)</a></li>
<li><a href="../pt484236/index.html">Fantasmas nas nuvens: detalhes de invadir muitas empresas</a></li>
<li><a href="../pt484238/index.html">O aprendizado de m√°quina enfrentou um problema de matem√°tica n√£o resolvido</a></li>
<li><a href="../pt484240/index.html">Torne-se um palestrante no Positive Hack Days 10. Come√ßa a chamada de trabalhos</a></li>
<li><a href="../pt484244/index.html">Paul Graham sobre Java e as Linguagens de Programa√ß√£o Hacker (2001)</a></li>
<li><a href="../pt484248/index.html">Paul Graham: Um Teste de Depend√™ncia (The Island Test, 2006)</a></li>
<li><a href="../pt484250/index.html">Paul Graham: Sobre a neutralidade pol√≠tica e a independ√™ncia do pensamento (os dois tipos de moderados)</a></li>
<li><a href="../pt484252/index.html">Antiguidades: 20 anos de tecnologia da computa√ß√£o em publica√ß√µes na m√≠dia</a></li>
<li><a href="../pt484254/index.html">Como: infogr√°ficos ou infogr√°ficos?</a></li>
<li><a href="../pt484270/index.html">Vamos resolver algum dinheiro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>