<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗡️ ✉️ 🚙 Cara berbicara dengan mikrokontroler dari JS 👩🏿‍🏭 🙌🏿 🥥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mengapa mikrokontroler diperlukan? Misalnya, untuk menyiapkan tempat pembuatan bir di rumah. Jika tempat pembuatan bir Anda tidak cukup, maka Anda dap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara berbicara dengan mikrokontroler dari JS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/450826/">  Mengapa mikrokontroler diperlukan?  Misalnya, untuk menyiapkan tempat pembuatan bir di rumah.  Jika tempat pembuatan bir Anda tidak cukup, maka Anda dapat melakukan sesuatu yang lebih besar: membangun ruang pencarian, mengatur presentasi, air mancur interaktif yang menggambar dengan tetesan air, atau tempat pameran untuk sebuah perusahaan besar.  Anda dapat melakukan apa saja dengan mikrokontroler - semuanya tergantung pada imajinasi Anda. <br><br>  Ada kesalahpahaman bahwa untuk membuat kelenjar Anda sendiri, Anda perlu tahu assembler, C / C ++, dapat mengelola memori dan sangat memahami listrik.  Setelah itu, tetapi teknologi berkembang dan sekarang untuk implementasi penuh proyeknya, hanya JS yang cukup! <br><br><img src="https://habrastorage.org/webt/cc/wc/ou/ccwcoucl5o2c-9xayxy04jc8fsq.jpeg"><br><br>  Oke, kita tahu JavaScript, tetapi bagaimana menghubungkannya ke perangkat keras?  Jenis besi apa yang ada di sana dan apa yang bisa dilakukannya?  Bagaimana cara mengkonfigurasi seluruh sistem?  Dalam transkrip laporan, Victor Nakoryakova di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FrontendConf akan</a> belajar: bagaimana, hanya menggunakan JS, untuk mengontrol servos, cara menggabungkan sistem secara fisik dengan PC, dan tentang opsi komunikasi untuk aplikasi pada JS.  Kami akan membahas paket serialport dan Firmata, serialport dengan firmware yang ditulis sendiri dalam C ++, Espruino dan pemrograman pengontrol langsung pada JS, Raspberry Pi, HTTP pada jaringan lokal dan HTTP dan MQTT melalui cloud. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yqeTaf44vNk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <strong>Victor Nakoryakov</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">nailxx</a> ) - direktur teknis, salah satu pendiri Amperka.  Ia menyukai teknologi pengembangan canggih, pemrograman fungsional, dan komputasi fisik.  Amperka memproduksi dan menjual modul elektronik sehingga non-profesional membuat perangkat pintar dengan tangan mereka sendiri, kit pelatihan dan blok bangunan individual yang dapat ditambahkan ke perangkat mereka - motor, GPS, SMS. <br><br><h2>  Tempat menulis JavaScript </h2><br>  <strong>Espruino memiliki mikrokontroler yang berdiri sendiri dengan JavaScript.</strong>  Platform Espruino memungkinkan Anda menulis JS langsung ke mikrokontroler.  Ini adalah hal yang otonom: terhubung ke komputer, dipasang, dan kemudian berfungsi secara independen. <br><br>  <strong>Raspberry Pi</strong> adalah komputer kecil dengan GPIO. <br><br>  <strong>Dalam aplikasi web</strong> , ke frontend atau backend. <br><br>  Saya akan menunjukkan operasi sistem menggunakan contoh katak.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Buka toad.amperka.ru</a> dari ponsel Anda - antarmuka web sederhana akan muncul. <br><br><img src="https://habrastorage.org/webt/pd/ya/be/pdyabe5bjmklkee0jjco7nontue.jpeg"><br><br>  Kolom kiri mengontrol mata kiri, kanan - kanan.  Prinsipnya sederhana - saya menekan tombol, motor servo memutar mata. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/z5/re/ocz5rert1d774i6ic7dzkaahjpa.gif" width="350"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video</a> demonstrasi dudukan dengan katak selama laporan. <br><br><h2>  Cara kerja katak </h2><br>  Ketika Anda membuka toad.amperka.ru, Anda mendapatkan halaman web statis dengan JS statis yang menggunakan pustaka <a href="">MQTT.js.</a>  Perpustakaan ini menghubungi broker MQTT di cloud. <br><br><img src="https://habrastorage.org/webt/5r/7h/it/5r7hit4db5ds9369m2fgmsua8t4.jpeg"><br><br>  Jika Anda tahu Redis, Publikasikan / Berlangganan, RabbitMQ atau antrian pesan lainnya, maka Anda segera mengerti tentang apa itu.  <strong>MQTT adalah pialang pesan antar-mesin</strong> .  Ringan dan sederhana sehingga kelenjar yang lemah pun bisa menggunakannya. <br><br>  MQTT membutuhkan broker di server.  Tetapi Anda bahkan tidak perlu mengangkatnya - menyewanya.  Untuk beberapa dolar sebulan, Anda akan memiliki broker MQTT Anda sendiri.  Tidak perlu backend. <br><br>  Di sisi lain, ada pengontrol dari broker MQTT.  Ada banyak perangkat berbeda dengan peran ini, misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Slot Wi-Fi</a> .  Ini adalah pengontrol yang dapat terhubung ke Internet. <br><br><img src="https://habrastorage.org/webt/th/dz/jc/thdzjcdluwlertps_bl5lbkdjui.jpeg"><br><br>  Ini bekerja berdasarkan chip ESP8266 yang populer.  Menambah kemampuan daya melalui micro-USB dan menghubungkan periferal eksternal melalui tiga kontak untuk terhubung ke perangkat lain. <br><br><h2>  Cara memprogram perangkat keras di JS </h2><br>  Tidak ada yang luar biasa, JS biasa - ES6 hampir penuh.  Beberapa fungsi dan objek untuk bekerja pada level rendah dengan sinyal listrik telah ditambahkan ke perpustakaan standar.  Misalnya, fungsi untuk membaca dan menulis digital sederhana. <br><br>  <strong>digitalRead - pembacaan digital</strong> .  Ini adalah pertanyaan untuk controller: "Apakah ada tiga volt pada pin nomor 4?"  Jika ada tegangan, itu akan mengembalikan BENAR, jika tidak, SALAH.  Ini mengimplementasikan pembacaan sensor biner sederhana: tombol, sakelar, kunci buluh dan sensor gerak inframerah. <br><br>  <strong>digitalWrite adalah rekaman digital sederhana</strong> .  Kami mengatakan digitalWrite TRUE - 3V cocok dengan pin.  Kami katakan digitalWrite FALSE - 0V.  Dengan menggunakan prinsip sederhana ini, Anda dapat menyalakan / mematikan strip LED atau meluncurkan rudal nuklir.  Kami mengirim sinyal lemah ke relay, itu mengangkut beban besar dan roket terbang. <br><br>  Ada juga fungsi untuk bekerja dengan nilai antara antara 0 dan 3V: <br><br><ul><li>  analogRead; </li><li>  analogWrite; </li><li>  setWatch; </li><li>  digitalPulse. </li></ul><br>  Perintah memungkinkan Anda untuk menginterogasi semua jenis tikungan dan menyediakan fungsi untuk perekaman fuzzy. <br><br>  Selanjutnya adalah objek untuk bekerja dengan antarmuka yang diterima di dunia mikrokontroler.  Jika di web kita mengerti dan terbiasa dengan HTTP, WebSocket, TCP, maka untuk mikrokontroler ini adalah: <br><br><ul><li>  Serial - port serial; </li><li>  Bus I2C </li><li>  Bus SPI </li><li>  Bus OneWire. </li></ul><br><h2>  Cara menendang servomotor </h2><br>  Sebagai contoh, saya akan memberi tahu Anda cara mengontrol motor yang berdiri di hypodermic.  Protokol motorik sederhana.  0V diterapkan pada pin kontrol - batas bawah.  Sekali setiap 20 μs, perlu ditendang, memberikan unit stabil 3V, dan setelah beberapa saat - reset ke 0. <br><br><img src="https://habrastorage.org/webt/io/1t/aj/io1tajdpojik7cxsab0mrddw0bi.jpeg"><br><br>  Kemudian semuanya terulang lagi.  Tergantung pada panjang unit, kami mendapatkan kecepatan rotasi yang berbeda.  Dengan panjang pulsa 1.500 μs, motor berhenti.  Ketika menyimpang dalam satu arah atau yang lain, itu berputar searah atau berlawanan arah jarum jam.  Besarnya deviasi mempengaruhi kecepatan rotasi. <br><br><h2>  Cara memprogram </h2><br>  Pemrograman platform Espruino dilakukan dalam IDE Espruino dengan nama yang sama.  Papan mikrokontroler terhubung ke komputer dengan kabel mikro-USB.  Satu-satunya hal adalah Anda harus menginstal driver, yang memakan waktu 1,5 menit.  Driver diinstal untuk MAC dan Windows, dan di Linux semuanya berfungsi dengan baik. <br><br>  Berikut adalah contoh program yang memuat ke lingkungan dengan satu klik.  Berkedip LED sekali per detik: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> on = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ on = !on; LED1.write(on); },<span class="hljs-number"><span class="hljs-number">500</span></span>);</code> </pre> <br>  Di sebelah kiri di lingkungan adalah juru bahasa REPL.  Masukkan "1 + 1".  Program ini memberikan jawaban "2".  Keajaiban <br><br>  Keajaibannya adalah ketika Anda menekan tombol, angka "1", tanda "+" dan unit berikutnya melalui kabel ke controller.  Saat Anda menekan ENTER, ekspresi dieksekusi di dalam mikrokontroler, bukan komputer.  Mikrokontroler mendapat hasil "2" dan mengembalikannya melalui kabel ke komputer.  "2" ditampilkan di monitor. <br><br><blockquote>  JavaScript dijalankan di dalam perangkat keras. </blockquote><br>  Selain hiburan dengan aritmatika, Anda dapat memutar motor.  Anda akan membutuhkan fungsi analogWrite, yang mengirimkan gelombang persegi.  Kami berbicara pada pin apa untuk memberikan gelombang.  Misalnya, di papan saya ditandatangani sebagai A7.  Kemudian kami menunjukkan durasi - misalnya, 1300 μs dari 20 000 μs yang akan kami sajikan.  Yang juga diperlukan adalah opsi yang menetapkan frekuensi tendangan ini - 50 kali per detik, ini adalah 20.000 μs. <br><br><pre> <code class="javascript hljs">&gt;analogWrite(A7, <span class="hljs-number"><span class="hljs-number">1300</span></span> / <span class="hljs-number"><span class="hljs-number">2000</span></span>, {<span class="hljs-attr"><span class="hljs-attr">freq</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>}} =<span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt;</code> </pre> <br>  Kami akan melewati 1500 - kami akan memaksa untuk berputar ke arah lain dengan kecepatan yang lebih besar. <br><br><pre> <code class="javascript hljs">&gt;analogWrite(A7, <span class="hljs-number"><span class="hljs-number">2300</span></span> / <span class="hljs-number"><span class="hljs-number">2000</span></span>, {<span class="hljs-attr"><span class="hljs-attr">freq</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>}} =<span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt;</code> </pre> <br>  Atau katakan berhenti. <br><br><pre> <code class="javascript hljs">&gt;digitalWrite(A7, <span class="hljs-number"><span class="hljs-number">0</span></span>) =<span class="hljs-literal"><span class="hljs-literal">undefined</span></span> &gt;</code> </pre> <br>  Dengan menggunakan fungsi yang sama, Anda dapat menulis seluruh program yang, tergantung pada faktor-faktor eksternal - menekan tombol, membaca sensor - akan melakukan apa yang Anda inginkan. <br><br><h3>  Perpustakaan </h3><br>  Tidak selalu mudah untuk mengingat detail implementasi protokol.  Karena itu, untuk semua jenis besi, banyak perpustakaan telah dibuat, dari kecil hingga raksasa.  Mereka mengandung semua fitur teknis.  Perpustakaan menggunakan metode yang dapat dimengerti: membaca data dari tag nfc, membaca konsentrasi karbon dioksida dalam ppm, atau mengirim pesan ke Telegram. <br><ul><li>  servo.write; </li><li>  barometer.init; </li><li>  barometer.baca; </li><li>  suhu barometer; </li><li>  nfc.listen; </li><li>  nfc.on ('tag', ...); </li><li>  nfc.readPage; </li><li>  nfc.writePage; </li><li>  relay.turnOn; </li><li>  relay.turnOff; </li><li>  gas. kalibrasi; </li><li>  gas.read ('CO2'); </li><li>  telegram.sendMessage. </li></ul><br>  Sangat berguna untuk memahami perintah tingkat rendah, tetapi untuk mulai membuat itu tidak perlu diketahui. <br><br><h2>  Kode Klien </h2><br>  Jadi, ketika kita mengklik salah satu tombol kolom kiri atau kanan di katak kita, nilai yang ingin kita atur pada servo yang sesuai dikirim ke topik kodok / mata / kiri atau kanan. <br><br><img src="https://habrastorage.org/webt/y1/3e/mt/y13emt_fcb-qdw2j_tihccn8ukm.jpeg"><br><br><pre> <code class="javascript hljs">&lt;button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"toad__eye__control"</span></span> data-queue=<span class="hljs-string"><span class="hljs-string">"left"</span></span> data-payload=<span class="hljs-string"><span class="hljs-string">"1300"</span></span>&gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;</span></span></code> </pre> <br>  1300 adalah durasi pulsa.  Dari mana kiri dan 1300 berasal?  Saya baru saja menambahkannya ke HTML sebagai atribut data. <br><br>  Di JS, kami menulis kode sederhana. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mqtt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mqtt'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> client = mqtt.connect(<span class="hljs-string"><span class="hljs-string">`ws://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.hostname}</span></span></span><span class="hljs-string">:9001`</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEyeControlClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { queue, payload } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataset; client.publish(<span class="hljs-string"><span class="hljs-string">`toad/eye/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${queue}</span></span></span><span class="hljs-string">`</span></span>, payload); } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">".toad__eye__control"</span></span>) .forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> e.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, onEyeControlClick));</code> </pre> <br>  Mari kita menganalisis kode dalam beberapa bagian.  Pada awalnya, kami terhubung ke broker, yang secara default berfungsi pada port 9001: <code>const client = mqtt.connect(`ws://${location.hostname}:9001`);</code>  . <br><br>  Ketika mengklik salah satu tombol, kami menerbitkan pesan baru dengan payload, yang kami dapatkan dari atribut data: <code>client.publish(`toad/eye/${queue}`, payload);</code>  . <br><br>  Selanjutnya, kami menerbitkan pada topik, yang juga dibentuk berdasarkan atribut-data.  Ini semua kode JS kami di browser. <br><br><h2>  Kode Dewan </h2><br>  Ketika Slot Wi-fi dimulai, ia berlangganan ke topik yang menarik dan menerima data.  Ketika mereka tiba, slot merespons dan membuat motor bekerja. <br><br><img src="https://habrastorage.org/webt/5r/7h/it/5r7hit4db5ds9369m2fgmsua8t4.jpeg"><br><br>  Kode di papan tulis secara konvensional dibagi menjadi beberapa bagian.  Untuk memulai, kami menghubungkan perpustakaan.  Secara khusus, ini hanya <strong>perpustakaan yang menjalankan Servo</strong> agar tidak mengingat detail.  Mereka berada dalam ruang lingkup amperka. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ssid = <span class="hljs-string"><span class="hljs-string">"Droidxx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = <span class="hljs-string"><span class="hljs-string">"****"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> brokerHostname = <span class="hljs-string"><span class="hljs-string">"toad.amperka.ru"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> leftEye = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"@amperka/servo"</span></span>).connect(A5); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rightEye = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"@amperka/servo"</span></span>).connect(A7).</code> </pre> <br>  Setiap orang dapat membuat dan menerbitkan perpustakaan mereka sendiri.  Kami telah membuat beberapa lusin untuk modul populer kami sendiri dan lainnya.  Semua Sumber Terbuka - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masuk, gunakan</a> . <br><br>  Maka kita membutuhkan <strong>perpustakaan untuk bekerja dengan broker Wi-Fi dan MQTT</strong> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wifi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"Wifi"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mqtt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"tinyMQTT"</span></span>).create(brokerHostname);</code> </pre> <br>  Tidak ada OS, jadi bahkan menghubungkan ke Wi-Fi adalah operasi manual.  Perawatan koneksi adalah milik Anda, tetapi tidak begitu sulit.  Untuk terhubung ke jaringan, kita cukup memanggil metode "sambungkan", yang, jika berhasil atau tidak berhasil, akan memanggil "panggilan balik" dan melaporkan hasil operasi. <br><br><pre> <code class="javascript hljs">wifi.connect(ssid, { <span class="hljs-attr"><span class="hljs-attr">password</span></span>: password }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Error connecting:"</span></span>, e); wifi.disconnect(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Wi-Fi OK, connecting to broker ..."</span></span>); mqtt.connect(); } });</code> </pre> <br>  Jika semuanya baik-baik saja, sambungkan ke broker MQTT. <br><br>  Setelah koneksi berhasil, kami berlangganan ke topik menarik, yaitu segala sesuatu yang dimulai dengan katak / mata. <br><br><pre> <code class="javascript hljs">mqtt.on(<span class="hljs-string"><span class="hljs-string">"connected"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ mqtt.subscribe(<span class="hljs-string"><span class="hljs-string">"toad/eye/*"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Connected to broker"</span></span>, brokerHostname); });</code> </pre> <br>  Ketika kami menerima pesan, kami mencari tahu dari mana pesan itu berasal.  Ini sangat mirip dengan parsing URL sederhana.  Bergantung pada topiknya, kami memutuskan mata mana yang akan kami pengaruhi.  Jika Anda mendapatkan sesuatu yang disadari, maka di mata ini kami menulis apa yang muncul dalam "payload" dalam mikrodetik. <br><br><pre> <code class="javascript hljs">mqtt.on(<span class="hljs-string"><span class="hljs-string">"message"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> eye = (msg.topic === <span class="hljs-string"><span class="hljs-string">"toad/eye/left"</span></span>) ? leftEye : (msg.topic === <span class="hljs-string"><span class="hljs-string">"toad/eye/right"</span></span>) ? rightEye : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eye) { eye.write(<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(msg.message), <span class="hljs-string"><span class="hljs-string">"us"</span></span>); } });</code> </pre> <br>  Itu semua keajaiban katak. <br><br><h2>  Batasan Espruino JS </h2><br>  Kami membahas platform Espruino.  Memutar katak bukan satu-satunya pilihannya.  Tetapi platform memiliki beting sendiri, yang membuat kita mempertimbangkan opsi lain. <br><br>  <strong>“Total” 1-4 Mb RAM</strong> .  Ada batasan pada RAM.  Pada kode dan data pada saat yang sama hanya beberapa megabyte yang diberikan.  Tampaknya di era ketika RAM diukur dengan pertunjukan, ini tidak cukup.  Tetapi untuk sekelompok perangkat kecil ini sudah cukup.  Dengan kecepatan 2 Mb Anda dapat melakukan hal-hal indah - cukup untuk air mancur. <br><br>  <strong>Tidak begitu sederhana dengan NPM</strong> .  Masalah ini berlaku untuk Espruino IDE.  Jika kita menulis "wajib", Espruino mencari di satu tempat, di tempat lain, dan jika tidak, itu menghasilkan fallback pada NPM.  Pada titik ini, ia bisa melambat.  Espruino tidak selalu dapat menangani paket yang rumit.  Kekuatannya dalam hal ini jauh lebih rendah daripada Webpack atau Parcel yang sama.  Ini menyakitkan, tetapi jika Anda mengkonfigurasi rantai alat sendiri, dengan pemahaman tentang apa yang terjadi di dalam setrika, maka tidak ada masalah. <br><br>  <strong>Bermacam-macam besi.</strong>  Tidak semua perangkat keras yang disebut platform pengembangan akan menarik Espruino.  Dengan standar dunia mikrokontroler, Espruino rakus - membutuhkan 500 Kb RAM.  Ingatan seperti itu tidak akan menghasilkan besi.  Arduino Uno atau Arduino Nano kanonik hanya memiliki 2 Kb RAM - oleh karena itu, tidak mungkin di sana.  Dimungkinkan untuk bekerja dengan Espruino pada perangkat keras, yang kami lakukan pada perangkat keras resmi dari Espruino. <br><br><img src="https://habrastorage.org/webt/gb/fx/9-/gbfx9-t4nskmti1hepnxlkz-lx0.png"><br><br>  Espruino adalah perusahaan satu orang yang sering menggunakan Kickstarter dengan produk baru dan selalu berhasil mengumpulkan.  Jika Anda ingin mendukung platform - beli secara resmi. <br><br>  Ada opsi ketiga - ambil yang cukup kuat, tapi papan pihak ketiga.  Misalnya, perusahaan ST, yang memproduksi "Nuclear" dan "Discovery".  Besi berlabel STM32 kemungkinan akan menarik Espruino. <br><br>  Mari kita membahas dua opsi alternatif.  Yang pertama adalah Raspberry Pi. <br><br><h2>  Raspberry pi </h2><br><blockquote>  Ini adalah komputer Linux ukuran kartu lengkap. </blockquote><br><br><img src="https://habrastorage.org/webt/y_/af/ws/y_afwsgmlr9e7fvkesyrwlvobak.jpeg"><br><br>  Selain itu ada pin input / output.  Jika Anda memiliki Raspberry Pi yang Anda inginkan, gunakan topologi perangkat berikut. <br><br><img src="https://habrastorage.org/webt/if/1a/jf/if1ajfsmxsvwwcap7ac_cpu8i2k.jpeg"><br><br>  Di sini cloud bersifat opsional - perangkat seluler dapat terhubung langsung ke perangkat melalui nama host, API atau sistem untuk secara otomatis mendeteksi perangkat di jaringan.  Saya memiliki TV pintar dan hard drive cadangan di rumah.  Mereka dapat diakses dari semua perangkat lain hanya karena mereka berada di LAN yang sama. <br><br>  Prinsipnya sama.  Letakkan perangkat di Raspberry Pi di jaringan dan bangun klien sehingga terhubung langsung melalui HTTP atau WebSocket, melewati perantara.  Cloud menggunakan aplikasi pada Raspberry Pi untuk tujuannya: ia mencatat sensor atau menyiarkan ramalan cuaca. <br><br>  Topologi selanjutnya yang mungkin dengan backend penuh. <br><br><img src="https://habrastorage.org/webt/if/1a/jf/if1ajfsmxsvwwcap7ac_cpu8i2k.jpeg"><br><br>  Server naik di awan.  Kliennya adalah aplikasi seluler yang sama yang menjaga koneksi melalui HTTP atau WebSocket.  Di sisi lain, koneksi sudah dipegang melalui Raspberry Pi, menggunakan HTTP atau MQTT yang sama. <br><br>  Dalam pendekatan ini, keuntungannya adalah kontrol penuh: validasi, otorisasi, penolakan kepada pelanggan.  Pada saat yang sama, ketersediaan di seluruh dunia adalah perangkat di Moskow, dan komunikasi dengannya tersedia dari Vladivostok. <br><br><h3>  Keterbatasan Raspberry Pi </h3><br>  <strong>Pemuatan panjang.</strong>  Raspberry Pi adalah komputer yang lengkap dan membutuhkan waktu untuk memulai.  Sebagai hard drive, kartu SD digunakan.  Bahkan kartu tercepat masih kehilangan HDD biasa, belum lagi SSD.  Pada waktunya, beban mendekati satu menit. <br><br>  <strong>Kelemahan berikutnya adalah konsumsi energi</strong> .  Dalam hal efisiensi energi, bicarakan Raspberry Pi sebagai perangkat seluler.  Ini tidak akan bertahan lama dari baterai - tagihan pergi ke jam.  Agar perangkat berfungsi selama enam bulan atau satu tahun, diperlukan program yang kompeten untuk mikrokontroler dan satu set baterai. <br><br>  <strong>GPIO yang buruk adalah input / output untuk tujuan umum</strong> .  Fitur-fitur feed gelombang, wave read, bekerja dengan sinyal analog di Raspberry Pi jauh lebih lemah daripada mikrokontroler, yang merupakan tugas utama.  Misalnya, di luar kotak pada Raspberry Pi, itu tidak akan mungkin untuk mengontrol servo dalam mode perangkat keras. <br><br><img src="https://habrastorage.org/webt/0r/sz/oj/0rszojmbxar2o-zhp26divehxj4.jpeg"><br><br>  Pembatasan itu bersyarat, karena bisa dielakkan dengan ekstensi.  Misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sepotong Troyka Cap dari</a> besi, yang mengambil semua kontrol tingkat rendah bekerja dengan sinyal itu sendiri.  Raspberry Pi berkomunikasi dengannya melalui paket tingkat tinggi.  Memberi perintah untuk memutar servo dan berfungsi.  Dengan menggunakan kartu ekspansi ini, Anda dapat menghubungkan apa pun yang Anda inginkan. <br><br><h2>  Arduino </h2><br>  Anda dapat mengambil <strong>Arduino</strong> biasa, yang semua orang bosan.  Tetapi JavaScript harus dipindahkan ke suatu tempat yang dapat mengubah Node JS - komputer lama atau Raspberry Pi yang sama. <br><br><img src="https://habrastorage.org/webt/fc/z2/gx/fcz2gxhtqtz7gsoqbopfki6tlqm.jpeg"><br><br>  Kami menghubungkan komputer lama yang tidak perlu ke Arduino melalui kabel USB.  Di Arduino, isi firmware <a href="">Firmata</a> standar <a href="">sekali</a> .  Dia mengubah Arduino menjadi zombie yang mengikuti instruksi master - komputer lama.  Master mengatakan untuk mengirimkan sinyal ini dan itu ke pin ini dan itu, dan Arduino mentransmisikan. <br><br>  Untuk komunikasi, perpustakaan dengan NPM - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SerialPort</a> dan Firmata dengan API yang jelas digunakan.  Jadi Anda lagi di dunia JS, menulis program tingkat tinggi yang Anda kirim ke server Anda.  Anda memercayai Arduino untuk bekerja dengan sinyal, dan dia melakukannya. <br><br>  Tidak selalu dengan Firmata akan mengelola untuk mengelola segalanya.  Itu dapat memberikan interaksi dengan perangkat keras yang dimaksudkan: servos, strip LED, pengontrol media.  Tetapi jika kemampuan membaca giroskop atau akselerometer yang sangat spesifik tidak dimasukkan - itu tidak akan berhasil.  Maka Anda harus menulis sebuah program dalam C pada Arduino biasa. <br><br>  Tapi itu belum semuanya - jika Anda tidak ingin menulis dalam C, gunakan alat Open Source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">XOD.io.</a> <br><br><img src="https://habrastorage.org/webt/-p/-9/j0/-p-9j0ex1ngdm7pfdq-lv5dej9u.jpeg"><br><br>  Ini adalah lingkungan pemrograman visual di mana grafik yang Anda buat berubah menjadi kode, dan Anda sudah dapat menyusun dan mengisinya.  XOD.io memungkinkan orang yang tidak terbiasa dengan seluk-beluk dan nuansa pemrograman mikrokontroler untuk dengan cepat membuat program sederhana.  Jika Anda tumbuh dari Firmata, tetapi masih belum merasakan kekuatan untuk menulis pada level rendah - gunakan XOD.io. <br><br><blockquote>  Konferensi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FrontendConf</a> berikutnya akan diadakan pada bulan Oktober.  Anda tahu tentang JavaScript yang sebagian besar pengembang front-end tidak tahu, mengembangkan antarmuka yang nyaman digunakan atau menemukan grail kinerja dan siap untuk mengetahui di mana itu, kami sedang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menunggu aplikasi</a> untuk laporan. <br><br>  Kami mengumpulkan laporan menarik dalam program, berita konferensi, video, dan artikel ke dalam buletin reguler - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">daftar</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id450826/">https://habr.com/ru/post/id450826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id450816/index.html">Tajuk HTTP untuk pengembang yang bertanggung jawab</a></li>
<li><a href="../id450818/index.html">Dari Latensi Ceph Tinggi ke Patch Kernel dengan eBPF / BCC</a></li>
<li><a href="../id450820/index.html">Komite program FrontendConf: kerangka kerja, cakrawala, pengalaman dunia dan misi konferensi</a></li>
<li><a href="../id450822/index.html">Kerangka kerja yang hilang</a></li>
<li><a href="../id450824/index.html">Keadaan css</a></li>
<li><a href="../id450828/index.html">Ketika kota tertidur ...</a></li>
<li><a href="../id450830/index.html">Nikita Dubko pada konferensi, sindrom penipu dan pelaporan</a></li>
<li><a href="../id450832/index.html">Kisah satu animasi</a></li>
<li><a href="../id450834/index.html">Situs parsing - dan apakah secara umum legal di Rusia?</a></li>
<li><a href="../id450836/index.html">Di rel di belakang awan: cara mencuci kaca di gedung pencakar langit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>