<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèΩ üôãüèæ üë®üèΩ‚ÄçüöÄ Historique des correctifs Apple üò• üëèüèº ‚õé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette ann√©e, a1exdandy et moi avons parl√© lors de conf√©rences VolgaCTF et KazHackStan avec une pr√©sentation des programmes Patch Diffing √©crits sur Ob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Historique des correctifs Apple</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/479972/"><p><img src="https://habrastorage.org/webt/wh/kp/c3/whkpc3ybatnoasln45yfqbbvrkc.jpeg" alt="image"></p><br><p>  Cette ann√©e, <a href="https://habr.com/ru/users/a1exdandy/" class="user_link">a1exdandy</a> et <a href="https://habr.com/ru/users/a1exdandy/" class="user_link">moi avons</a> parl√© lors de conf√©rences VolgaCTF et KazHackStan avec une pr√©sentation des programmes Patch Diffing √©crits sur Objective-C, et comment l'utiliser pour rechercher et trouver des vuln√©rabilit√©s 0 et 1 jour dans les produits Apple.  Vous pouvez regarder la vid√©o de la pr√©sentation <a href="https://youtu.be/G1p0CVNxK28%3Ft%3D5191">ici</a> , et pour lire l'article, bienvenue √† cat. </p><a name="habracut"></a><br><p>  Binary Diffing est le processus de comparaison de deux fichiers ex√©cutables afin de trouver des similitudes et des diff√©rences entre eux.  Patch Diffing est un cas particulier de Binary Diffing lorsqu'un fichier vuln√©rable est compar√© √† un fichier fixe (fichier avec un patch).  Vous pouvez donc savoir quelles corrections le d√©veloppeur a apport√©es et comprendre quelle √©tait la vuln√©rabilit√©. </p><br><p>  Il y a quelques ann√©es (notamment en 2013), <a href="https://xakep.ru/issues/xa/169/">un article a</a> √©t√© <a href="https://xakep.ru/issues/xa/169/">publi√©</a> sur les programmes Patch Diffing pour Windows, auxquels nous avons √©galement particip√©.  Nous vous recommandons de vous familiariser avec celui-ci si vous √™tes int√©ress√© par cette rubrique en lien avec le syst√®me d'exploitation Windows.  Dans le m√™me article, nous parlerons de l'analyse des programmes pour apple OS. </p><br><h2 id="chem-mogut-byt-polezny-binary-diffing-i-patch-diffing">  Comment la diff√©renciation binaire et la diff√©renciation de patchs peuvent-elles √™tre utiles? </h2><br><p>  La t√¢che principale de Binary Diffing est de suivre les modifications apport√©es √† l'application.  Pour ce faire, vous devez prendre l'ancienne version et la comparer avec la nouvelle pour voir quels changements le d√©veloppeur a ajout√©s et comment ils sont mis en ≈ìuvre. </p><br><p>  Examinons les situations dans lesquelles cela peut √™tre utile: </p><br><ul><li>  <strong>Analyse du d√©veloppement du programme</strong> : en comparant les nouvelles et anciennes versions, vous pouvez comprendre comment l'application se d√©veloppe, quelles nouvelles fonctionnalit√©s sont ajout√©es, qui sont supprim√©es et quels changements le code existant a subi. </li><li>  <strong>Importation des connaissances existantes</strong> : dans les programmes qui n'utilisent pas d'informations symboliques, les ing√©nieurs en r√©tro-ing√©nierie doivent consacrer beaucoup plus de temps √† √©tudier la logique et √† rechercher les vuln√©rabilit√©s.  Mais il arrive que dans une version du logiciel, les d√©veloppeurs laissent accidentellement ou d√©lib√©r√©ment des informations symboliques.  Ces informations peuvent √™tre port√©es √† partir de l√† vers la version logicielle dont vous avez besoin.  <a href="https://googleprojectzero.blogspot.com/2019/10/the-story-of-adobe-reader-symbols.html">Par exemple</a> , les employ√©s de Google Project Zero utilisant Binary Diffing ont pu obtenir des caract√®res pour de nouvelles versions Windows d'Adobe Reader √† partir de versions plus anciennes pour d'autres syst√®mes d'exploitation, ce qui les a aid√©s √† trouver des vuln√©rabilit√©s; </li><li>  <strong>Formation sur les vrais logiciels</strong> : √† notre avis, Patch Diffing est un excellent moyen de passer facilement de l'√©tude de petits probl√®mes CTF √† la recherche de vrais logiciels.  En explorant le correctif, vous pouvez regarder la vraie vuln√©rabilit√© d'un grand logiciel avec toutes ses fonctionnalit√©s (tout en sachant avec certitude que la vuln√©rabilit√© est pr√©sente dans le code).  En explorant les erreurs dans un produit, vous pouvez progressivement passer √† la recherche des m√™mes vuln√©rabilit√©s.  En prime, vous pouvez essayer d'√©crire des exploits pour eux; </li><li>  <strong>Cr√©ation d'exploits d'un jour</strong> : lorsqu'un d√©veloppeur a d√©j√† publi√© un correctif, vous pouvez rapidement l'analyser, √©crire un exploit pour cette vuln√©rabilit√© et obtenir un exploit d'un jour.  Dans le m√™me temps, il y a ce que l'on appelle le Patch Gapping - le temps entre la sortie du patch et son installation directe par les clients.  Pendant ce temps, un exploit d'une journ√©e peut fonctionner avec succ√®s et b√©n√©ficier √† son auteur (installer les mises √† jour en temps opportun!) Jusqu'√† ce que tout le monde installe le correctif publi√© par les d√©veloppeurs.  Il existe des situations o√π une vuln√©rabilit√© est corrig√©e dans une biblioth√®que, mais les programmes utilisent toujours une version obsol√®te de la biblioth√®que.  Voici quelques exemples int√©ressants de Patch Gapping pour <a href="https://blog.exodusintel.com/2019/09/09/patch-gapping-chrome/">Chrome</a> et <a href="https://googleprojectzero.blogspot.com/2019/08/jsc-exploits.html">WebKit</a> ; </li><li>  <strong>Recherche de vuln√©rabilit√©s √† 0 jour</strong> : peu importe √† quel point cela peut para√Ætre √©trange, en analysant les correctifs, vous pouvez √©galement trouver des vuln√©rabilit√©s pr√©c√©demment inconnues (vuln√©rabilit√©s √† 0 jour).  Les d√©veloppeurs se trompent √©galement et, par cons√©quent, dans le processus de cr√©ation d'un correctif, la vuln√©rabilit√© peut ne pas √™tre ferm√©e correctement.  Ainsi, en analysant un patch, vous pouvez trouver un moyen de le contourner.  Par exemple, les d√©veloppeurs d'Apache Struts ont corrig√© une vuln√©rabilit√© cinq fois, mais le correctif ne fonctionnait que dans sa sixi√®me version!  De plus, souvent un d√©veloppeur, accomplissant clairement la t√¢che qui lui a √©t√© assign√©e pour corriger une certaine vuln√©rabilit√©, peut ne pas remarquer ce qui se passe dans les sections voisines du code.  Il pourrait y avoir exactement la m√™me vuln√©rabilit√© √† proximit√©, et en cas de d√©tection, ce sera 0 jour.  Il est important d'√©tudier le mod√®le d'une erreur de d√©veloppeur d√©tect√©e et d'essayer de trouver quelque chose de similaire dans le m√™me programme.  Si le d√©veloppeur a fait une erreur √† un endroit, la probabilit√© de r√©p√©ter la m√™me erreur ailleurs est √©lev√©e. </li></ul><br><p>  Il existe un mythe selon lequel masquer les informations sur les correctifs de vuln√©rabilit√© augmente la s√©curit√©.  Cependant, les attaquants, en r√®gle g√©n√©rale, ont d√©j√† d√©velopp√© une infrastructure pour analyser les correctifs, de sorte qu'ils trouveront rapidement les donn√©es qui les int√©ressent.  Cacher les vuln√©rabilit√©s complique le travail de ceux qui sont responsables de la protection du syst√®me, car sans un acc√®s complet aux informations, il est impossible de comprendre l'importance de ce correctif pour l'entreprise.  √Ä ce sujet, nous vous recommandons fortement de lire l'article <a href="http://addxorrol.blogspot.com/2019/08/rashomon-of-disclosure.html">¬´Rashomon ofclosure¬ª</a> du chercheur Halvar Flake, o√π la situation est vue sous diff√©rents angles. </p><br><p>  Les vuln√©rabilit√©s d√©couvertes ne sont pas toujours cach√©es intentionnellement.  Les d√©veloppeurs peuvent ne pas attacher une importance particuli√®re √† certaines des lacunes de leur produit et les corriger sans publicit√©, comme un bogue normal. </p><br><p>  Nous sommes s√ªrs que ce ne sont pas toutes les situations dans lesquelles vous pouvez utiliser la diff√©renciation binaire et la correction de patch, et dans les commentaires, vous pouvez √©crire vos propres scripts. </p><br><h2 id="instrumentariy">  Bo√Æte √† outils </h2><br><p>  De la th√©orie, nous passons progressivement √† la pratique.  Naturellement, faire manuellement la diff√©rence binaire est une entreprise folle.  Une bo√Æte √† outils compl√®te a √©t√© d√©velopp√©e depuis longtemps, comprenant √† la fois des programmes autonomes et des plugins pour les analyseurs binaires populaires: Diaphora, BinDiff, DarunGrim, YaDiff, rizzo, Realyze, Turbodiff, patchdiff2, rematch et autres. </p><br><p><img src="https://habrastorage.org/webt/ek/ou/r0/ekour0t64vi9hsrnpnvpaqzra6e.png" alt="image"><br>  <em>Interface BinDiff.</em> </p><br><p><img src="https://habrastorage.org/webt/g_/q_/k1/g_q_k1bg4g_x858ps6k24ywuonk.png" alt="image"><br>  <em>Interface Diaphora</em> </p><br><p>  En pratique, nous n'utilisons principalement que les deux premiers (ils sont pr√©sent√©s dans les captures d'√©cran ci-dessus).  La plupart des outils actuels, malheureusement, ne sont pas encourageants avec la qualit√© du travail, ou sont compl√®tement abandonn√©s.  Il existe maintenant de nouveaux outils utilisant ML, mais leur qualit√© laisse beaucoup √† d√©sirer, bien qu'ils aient des id√©es int√©ressantes pour comparer des fichiers binaires de diff√©rentes architectures. </p><br><p>  Je voudrais √©galement noter s√©par√©ment les outils r√©cemment apparus pour comparer le code open-source dans les fichiers binaires: Pigaios et Karta.  Il s'agit d'une direction tr√®s int√©ressante et utile.  Ils collectent des m√©triques √† partir du code source, puis les utilisent pour comparer des fonctions dans des fichiers binaires.  Ceci est tr√®s utile en l'absence de caract√®res et de liens statiques.  La t√¢che de ces outils est de mapper des fonctions d'un fichier √† des fonctions d'un autre. </p><br><h2 id="sravnenie-patchey-dlya-operacionnyh-sistem-apple">  Comparaison des correctifs pour les syst√®mes d'exploitation Apple </h2><br><p>  En r√®gle g√©n√©rale, les applications pour Apple OS √©crivent sur Objective-C.  Il s'agit d'une extension orient√©e objet pour C, bas√©e sur des paradigmes de langage Smalltalk avec son propre runtime. </p><br><p>  Si nous ouvrons le programme sur Objective-C dans un analyseur binaire (dans notre cas, c'est un IDA), nous verrons quelque chose comme ceci: les fonctions en C / C ++ auront des noms abstraits, et les fonctions en Objective-C seront appel√©es tr√®s joliment.  (Nous dirons tout de suite que nous ne consid√©rons pas les situations d'obscurcissement de code - c'est une histoire distincte.) Cela facilite l'ing√©nierie inverse: il est facile de voir quel objet est appel√©, quelle m√©thode est utilis√©e et quels arguments il contient.  De plus, ces informations symboliques simplifient consid√©rablement le travail avec les outils de comparaison de fichiers binaires.  Il vous permet de cartographier rapidement et avec un nombre minimum de fonctions d'erreurs. </p><br><p><img src="https://habrastorage.org/webt/nc/dc/ri/ncdcrissgbl_y_deb3fx9qaqd9a.png" alt="image"></p><br><p>  Lorsqu'il n'y a pas de symboles, les outils doivent utiliser des algorithmes internes pour l'analyse, l'heuristique, etc.  Naturellement, ils ne fonctionnent pas toujours correctement. </p><br><h2 id="use-cases-gde-patch-diffing-byl-ochen-polezen">  Cas d'utilisation o√π la diff√©rence de patch √©tait tr√®s utile </h2><br><p>  Probablement, cette pr√©sentation (au format de 45 minutes) et cet article n'auraient pas vu le jour si r√©cemment, Apple n'avait pas surpris la communaut√© mondiale de la recherche √† plusieurs reprises.  Regardons ces cas. </p><br><h3 id="case-1-cve-2019-8606">  Cas 1: CVE-2019-8606 </h3><br><p>  En mai 2019, iOS 12.3 pour iPhone a √©t√© publi√©, o√π la vuln√©rabilit√© avec laquelle il √©tait possible d'installer le jailbreak a √©t√© corrig√©e.  En juillet de la m√™me ann√©e, Apple a publi√© la version 12.4, o√π le jailbreak a recommenc√© √† fonctionner: les employ√©s ont accidentellement retir√© le patch de protection.  La version corrig√©e n'a √©t√© publi√©e qu'apr√®s un mois: tout ce temps, tout appareil sur la derni√®re version pouvait √™tre facilement soumis √† des op√©rations de jailbreak.  Tout cela a √©t√© d√©couvert gr√¢ce au patch diff√©rent. </p><br><p><img src="https://habrastorage.org/webt/97/ri/gn/97rign6v9ubqzhnwlo3zgc0shre.png" alt="image"></p><br><h3 id="case-2-cve-2019-7278-i-cve-2019-7286">  Cas 2: CVE-2019-7278 et CVE-2019-7286 </h3><br><p>  L'exp√©rience personnelle avec Patch diff√©rant lors de la conf√©rence Hack in the Box dans son rapport <a href="https://gsec.hitb.org/materials/sg2019/D2%2520-%2520Recreating%2520an%2520iOS%25200day%2520Jailbreak%2520Out%2520of%2520Apple%25E2%2580%2599s%2520Security%2520Updates%2520-%2520Stefan%2520Esser.pdf">Recr√©er un jailbreak iOS 0 jours √† partir des correctifs de s√©curit√© d'Apple a √©t√©</a> d√©crite par le chercheur en s√©curit√© Stefan Esser.  Il a parl√© de CVE-2019-7278 et CVE-2019-7286 - ils sont remarquables pour ceux qui ont √©t√© d√©couverts gr√¢ce au Google Threat Analysis Group lors de leur utilisation r√©elle par les attaquants (ITW, dans la nature).  Apple a re√ßu des informations √† leur sujet, mais ni eux ni les gars de Google n'ont r√©v√©l√© de d√©tails techniques.  Stefan s'est alors demand√© ce que les attaquants utilisaient.  Nous vous recommandons fortement de lire son rapport, car il parle √©galement du processus de comparaison des composants du noyau et de l'espace utilisateur. <br>  Fait int√©ressant: un jour ou deux avant le discours de Stefan, Project Zero Ian Beer a publi√© une s√©rie d'articles <a href="https://googleprojectzero.blogspot.com/2019/08/a-very-deep-dive-into-ios-exploit.html">¬´Une plong√©e tr√®s profonde dans les cha√Ænes d'exploitation iOS trouv√©es dans la nature¬ª</a> , ce qui a quelque peu confondu les cartes pour le chercheur;) </p><br><h3 id="case-3-checkm8">  Cas 3: checkm8 </h3><br><p>  Les appareils Apple utilisent deux chargeurs de d√©marrage: Bootrom et Iboot.  Le premier commence √† fonctionner d√®s que l'appareil s'allume.  Il est en m√©moire morte et ne peut pas √™tre mis √† jour.  Iboot est un chargeur de d√©marrage de deuxi√®me niveau qui am√©liore l'authentification qui s'ex√©cute dans la cha√Æne de d√©marrage. <br>  La particularit√© des chargeurs est qu'ils partagent le code.  Au d√©but de l'ann√©e derni√®re, les sp√©cialistes ont compar√© les mises √† jour pour Iboot et ont constat√© qu'Apple avait corrig√© une vuln√©rabilit√© dans la pile USB.  Sachant que le m√™me code est utilis√© dans la partie non mise √† jour de Bootrom, ils ont r√©alis√© que cette vuln√©rabilit√© existe √©galement l√†-bas.  Puis le d√©veloppement de l'exploit checkm8 a commenc√©.  D√©sormais, tous les appareils bas√©s sur des puces de A5 √† A11 (de l'iPhone 4s √† l'iPhone X) sont compl√®tement vuln√©rables, et il est possible d'y ex√©cuter votre propre code.  Dans le m√™me temps, sur les appareils des versions XR et 11, cette vuln√©rabilit√© est d√©j√† ferm√©e, et il n'y a eu aucun rapport de cela d'Apple. <br>  Donc, sachant o√π il a √©t√© corrig√© et comment le code est divis√©, vous pouvez trouver des trucs vraiment cool! </p><br><h2 id="nasha-istoriya-cve-2019-8574">  Notre histoire: CVE-2019-8574 </h2><br><p><img src="https://habrastorage.org/webt/sb/4a/hj/sb4ahjfaar4slhvzgdhshhe6qye.png" alt="image"><br>  En mai, Apple a publi√© une nouvelle mise √† jour pour ses appareils.  Nous avons examin√© la liste des vuln√©rabilit√©s corrig√©es et trouv√© l'utilitaire sysdiagnose.  Ce programme collecte des informations de diagnostic √† partir de diverses sources et les transf√®re √† l'utilisateur sous la forme d'une archive pour une analyse plus approfondie, un support ou un centre de service.  Il semblait impossible d'influencer la fa√ßon dont elle recueille les informations.  La description du correctif indiquait que la vuln√©rabilit√© pouvait √™tre utilis√©e pour √©lever les privil√®ges et √©tait une erreur de corruption de m√©moire, ce qui nous intriguait encore plus.  Et l'auteur de la d√©couverte lui-m√™me n'a publi√© aucune description de lui-m√™me ... </p><br><p><img src="https://habrastorage.org/webt/ss/qj/xs/ssqjxs3dnufltlr6qvqkakimzbw.png" alt="image"></p><br><p>  Vous pouvez appeler sysdiagnose sur macOS en appuyant sur Ctrl + Option + Maj +., Ou en utilisant la commande sudo sysdiagnose.  Sur les appareils iOS, vous devez maintenir enfonc√©es la touche marche / arr√™t et les touches de volume. </p><br><h3 id="patch-diffing-apple-na-praktike">  Patch Apple diff√©rent dans la pratique </h3><br><p>  Si vous souhaitez patcher diff√©rents appareils Apple, vous devez obtenir deux versions de la mise √† jour (ancienne et nouvelle).  Sur macOS, vous pouvez analyser des fichiers dans le catalogue de mises √† jour logicielles.  Cette m√©thode n'aide pas toujours, car Apple supprime certaines mises √† jour.  Les mises √† jour se trouvent √©galement dans le r√©pertoire / Library / Updates.  Vous pouvez trouver le firmware pour les appareils iOS sur le site Web <a href="https://ipsw.me/">ipsw.me.</a> <br>  Pour macOS, vous devez extraire les fichiers ex√©cutables, les fichiers de biblioth√®que, les frameworks et le noyau √† l'aide de l'utilitaire Suspicious Package. <br>  Pour les appareils iOS, les choses sont un peu plus compliqu√©es.  La mise √† jour elle-m√™me est une archive ZIP.  Dans cette archive, vous devez trouver le fichier kernelcache: √† l'int√©rieur se trouve le noyau et son extension.  Cependant, avant l'analyse, vous devez convertir le fichier au format Mach-O.  Cela peut √™tre fait en utilisant les utilitaires img4tool, joker, jtool2 et autres. <br>  Le firmware du composant utilisateur se trouve dans la plus grande image DMG: il contient le syst√®me racine et les fichiers ex√©cutables.  Cependant, si vous regardez les biblioth√®ques et les frameworks partag√©s, ils ne seront pas l√†.  Le fait est que pour optimiser l'espace, ils sont plac√©s dans dyld_shared_cache.  Ce fichier contient toutes les biblioth√®ques de l'iPhone et occupe plus de 1 gigaoctet, ce qui complique son analyse.  Si vous devez t√©l√©charger une partie distincte du fichier ipsw, utilisez l'utilitaire ipsw ( <a href="https://github.com/blacktop/ipsw">https://github.com/blacktop/ipsw</a> ). </p><br><h3 id="patchdifing-cve-2019-8574">  Patchdifting CVE-2019-8574 </h3><br><p>  Pour √©tudier le patch CVE-2019-8574, nous obtenons un fichier de Library / Updates et extrayons deux fichiers ex√©cutables sysdiagnose (anciens et nouveaux) √† l'aide du paquet suspect, puis v√©rifions les mises √† jour via des utilitaires pour comparer les codes binaires, par exemple Diaphora ou BinDiff (ils sont beaucoup mieux que l'√©diteur hexad√©cimal). </p><br><h3 id="kak-rabotaet-patch">  Comment fonctionne le patch </h3><br><p>  Pour l'architecture x86_64, nous n'avons trouv√© qu'une seule fonction modifi√©e.  Il y a plus de changements dans ARM, mais ils sont insignifiants. </p><br><p><img src="https://habrastorage.org/webt/lz/-r/kw/lz-rkw3czadbapcb5bkywgenypo.png" alt="image"></p><br><p>  Le probl√®me venait de la m√©thode [SDTask start]: elle a ajout√© une nouvelle v√©rification.  Dans la figure, vous pouvez voir comment un appel √† une fonction isAppleInternal est appel√© et la pr√©sence de la sous-cha√Æne / usr / local dans un chemin est v√©rifi√©e. </p><br><p><img src="https://habrastorage.org/webt/hd/8u/vc/hd8uvcvbusgs1m52yx0xn8ka4ie.png" alt="image"></p><br><p>  Comme indiqu√© pr√©c√©demment, sysdiagnose collecte des informations √† partir de diverses sources.  Les sources peuvent √™tre soit des fichiers (par exemple, un journal des √©v√©nements), soit la sortie de certaines commandes d'informations (par exemple, r√©pertorier les processus ou les threads √† l'aide de ps) - ces t√¢ches sont stock√©es dans sysdiagnose en tant qu'objets SDTask.  La m√©thode [SDTask start] d√©marre l'ex√©cution des t√¢ches.  Dans la figure ci-dessous, vous pouvez voir le code dans lequel toutes les t√¢ches sont form√©es.  Tous les chemins des fichiers ex√©cutables et leurs arguments sont √©crits directement dans le programme, et il existe des t√¢ches provenant de divers r√©pertoires, dont / usr / local. </p><br><p><img src="https://habrastorage.org/webt/5y/kj/uc/5ykjuc8umbymhffj-xo01ohw2oi.png" alt="image! [] (./ assets / 8.png)"></p><br><p>  Ainsi, avant d'installer le correctif, n'importe quelle t√¢che peut √™tre effectu√©e quel que soit l'emplacement du fichier ex√©cutable.  Apr√®s l'installation du correctif, la fonction isAppleInternal est appel√©e, qui v√©rifie si l'appareil est un appareil de test interne d'Apple.  S'il s'agit d'un p√©riph√©rique interne, la t√¢che est effectu√©e de mani√®re standard et, si elle est c√¥t√© client, la pr√©sence de la sous-cha√Æne / usr / local / dans le chemin du fichier ex√©cutable de la t√¢che est v√©rifi√©e.  Si une sous-cha√Æne est trouv√©e, la t√¢che ne sera pas termin√©e. </p><br><p>  Rappelons que dans la description de la vuln√©rabilit√©, il a √©t√© dit qu'il s'agit d'une erreur de corruption de m√©moire, mais dans le patch nous n'avons rien remarqu√© de tel ... A notre avis, il s'agit d'une vuln√©rabilit√© logique bien exploit√©e et stable. </p><br><h3 id="kak-eto-ekspluatirovat">  Comment l'exploiter </h3><br><p>  Pour exploiter la vuln√©rabilit√©, vous devez effectuer les √©tapes suivantes: <br>  Cr√©ez n'importe quel fichier ex√©cutable (script binaire ou shell) que sysdiagnose lance √† partir de / usr / local / bin, et placez-y notre charge utile.  La liste des fichiers valides est donn√©e ci-dessous.  Il est important que le gestionnaire de paquets de brassage soit install√© sur le syst√®me: il permet √† l'utilisateur de cr√©er des fichiers dans / usr / local / sans augmenter les privil√®ges. </p><br><p>  Il est n√©cessaire d'appeler sysdiagnose.  Dans le m√™me temps, notre charge utile sera ex√©cut√©e avec les droits d'utilisateur root, et sa sortie sera plac√©e dans l'archive que sysdiagnose forme.  Ainsi, nous obtenons une √©l√©vation de privil√®ges.  Cependant, l'ex√©cution de sysdiagnose lui-m√™me n√©cessite des privil√®ges √©lev√©s.  Mais, comme mentionn√© ci-dessus, sysdiagnose peut √©galement √™tre lanc√© √† l'aide du raccourci clavier, et cela fonctionne m√™me √† partir de l'√©cran de verrouillage macOS. <br>  Cette vuln√©rabilit√© peut √™tre utilis√©e pour cr√©er divers programmes malveillants. </p><br><pre><code class="plaintext hljs">/usr/local/bin/airplayutil /usr/local/bin/amstool /usr/local/bin/apsclient /usr/local/bin/audioDeviceDump /usr/local/bin/cdcontexttool /usr/local/bin/cddebug /usr/local/bin/cdknowledgetool /usr/local/bin/dastool /usr/local/bin/idstool /usr/local/bin/imtool /usr/local/bin/keystorectl /usr/local/bin/pmtool /usr/local/bin/xcpm /usr/local/efi/bin/efi-perf</code> </pre> <br><p>  Il est int√©ressant de noter que d'autres vuln√©rabilit√©s pourraient √™tre associ√©es au gestionnaire de paquets de brassage, ou plut√¥t √† la possibilit√© d'√©crire dans / usr / local / sans privil√®ges. </p><br><h2 id="vyvod">  Conclusion </h2><br><p>  Avec cette √©tude, nous aimerions montrer l'importance et la criticit√© des correctifs diff√©rant non seulement pour les attaquants, mais aussi pour augmenter la s√©curit√© des produits logiciels.  Malheureusement, le patch peut non seulement fermer la vuln√©rabilit√©, mais aussi jouer entre les mains de l'attaquant. </p><br><p>  N√©anmoins, cette approche permet non seulement d'√©tudier les vuln√©rabilit√©s connues, mais aussi d'en rechercher de nouvelles comme elles.  Par cons√©quent, nous pensons que le patch diffing est un must have pour tout chercheur. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479972/">https://habr.com/ru/post/fr479972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479958/index.html">Vuln√©rabilit√©s du micrologiciel et du processeur</a></li>
<li><a href="../fr479960/index.html">Le mod√®le de l'efficacit√© de la publicit√© m√©diatique pour les boutiques en ligne</a></li>
<li><a href="../fr479966/index.html">Playrix CI / CD: comment nous construisons et testons nos jeux</a></li>
<li><a href="../fr479968/index.html">Le bureau de Nginx est perquisitionn√© en raison du proc√®s du groupe Rambler. Le service de presse plaignant a confirm√© le proc√®s</a></li>
<li><a href="../fr479970/index.html">Mille et un bogues d'interface utilisateur, ou comment aider un d√©veloppeur √† √©viter les erreurs d'interface utilisateur courantes</a></li>
<li><a href="../fr479974/index.html">Attaques z√©ro clic: lorsque votre s√©curit√© ne d√©pend pas de vous</a></li>
<li><a href="../fr479978/index.html">Comme sans douleur, sans captcha et gratuitement pour apporter des extraits du Fonds f√©d√©ral des biens de l'√âtat du Registre d'√âtat unifi√© des droits de l'homme sous une forme lisible par l'homme (*)</a></li>
<li><a href="../fr479982/index.html">Vidos et insectes</a></li>
<li><a href="../fr479988/index.html">Concours technologiques Radiofest-2019. R√©sum√©</a></li>
<li><a href="../fr479992/index.html">Comment enseigner √† UITextView √† se d√©marquer magnifiquement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>