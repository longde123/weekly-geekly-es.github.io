<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÑ üçì üê´ R√©duction des tailles de bundle avec Webpack Analyzer et React Lazy / Suspense üçÆ üöñ üßñüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä mesure que la complexit√© des applications client augmente, la taille de leurs bundles devient de plus en plus. Dans cette situation, les personnes s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©duction des tailles de bundle avec Webpack Analyzer et React Lazy / Suspense</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/468225/">  √Ä mesure que la complexit√© des applications client augmente, la taille de leurs bundles devient de plus en plus.  Dans cette situation, les personnes souffrent le plus, oblig√©es, pour diverses raisons, d'utiliser des connexions Internet lentes.  De plus, chaque jour, cela ne fait qu'empirer. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/yp/wc/u-/ypwcu-trdbiswrdeltqb677yqxk.jpeg"></a> <br><br>  L'auteur de l'article, dont nous publions aujourd'hui la traduction, travaille sous Wix.  Il veut expliquer comment il a pu r√©duire la taille d'un paquet d'environ 80%, en utilisant Webpack Analyzer et React Lazy / Suspense. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">√Ä quelle heure commence l'optimisation?</font> </h2><br>  Si vous venez de commencer √† travailler sur votre nouvelle application Web, vous essayez probablement de vous concentrer sur sa cr√©ation, pour ainsi dire, ¬´d√©coller¬ª, en essayant de la faire fonctionner.  Vous ne pr√™tez probablement pas beaucoup d'attention aux performances ou √† la taille du bundle.  Je peux comprendre √ßa.  Cependant, mon exp√©rience sugg√®re que les performances et la taille des bundles doivent √™tre prises en compte d√®s le d√©but.  Une bonne architecture d'application et une ¬´r√©flexion sur l'avenir du projet¬ª en temps opportun vous permettront de gagner du temps et de ne pas accumuler de dettes techniques importantes.  De toute √©vidence, il est difficile de ¬´tout pr√©voir¬ª √† l'avance, mais vous devez vous efforcer de tout faire d√®s le premier jour de travail sur le projet. <br><br>  Voici quelques excellents outils qui, je pense, devraient √™tre utilis√©s d√®s le d√©part.  Ces outils vous aideront √† reconna√Ætre les packages NPM ¬´probl√©matiques¬ª avant m√™me qu'ils n'occupent une place importante dans l'application. <br><br><h3>  <font color="#3AC1EF">UndBundlephobia</font> </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bundlephobia</a> est un site qui vous permet de savoir dans quelle mesure un certain package NPM augmentera la taille d'un bundle.  Il s'agit d'un excellent outil pour aider le programmeur √† prendre les bonnes d√©cisions concernant le choix des packages tiers dont il peut avoir besoin.  Bundlephobia aide √† concevoir l'architecture de l'application afin que sa taille ne se r√©v√®le pas trop grande.  La figure suivante montre les r√©sultats de la v√©rification d'une biblioth√®que populaire pour travailler avec le temps, appel√© moment.  Vous pouvez voir que cette biblioth√®que est assez grande - pr√®s de 66 Ko sous forme compress√©e.  Pour de nombreux utilisateurs travaillant sur Internet haut d√©bit, ce n'est rien.  Cependant, il convient de pr√™ter attention √† la dur√©e de t√©l√©chargement de ce package dans les r√©seaux 2G / 3G.  Elle est respectivement de 2,2 et 1,32 seconde.  Et, faites attention, nous ne parlons que de ce seul paquet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/298/eed/1c1298eed8992918c5314e651ea04032.png"></div><br>  <i><font color="#999999">R√©sultats de l'analyse du paquet de moment Bundlephobia</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç Co√ªt d'importation</font> </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Import Cost</a> est une extension tr√®s int√©ressante pour de nombreux √©diteurs de code populaires (il compte plus d'un million de t√©l√©chargements pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VS Code</a> ).  Il peut montrer le "co√ªt" des colis import√©s.  Je l'aime particuli√®rement car cela aide √† identifier les zones probl√©matiques de l'application tout en y travaillant.  La figure suivante (tir√©e de la page Import Cost GitHub) montre un excellent exemple de l'impact sur les dimensions du projet d'une approche diff√©rente de l'importation d'entit√©s.  Ainsi, l'importation de la seule propri√©t√© <code>uniqueId</code> partir de Lodash entra√Æne l'importation de la biblioth√®que enti√®re dans le projet (70 Ko).  Et si vous importez directement la fonction <code>uniqueId</code> , alors seulement 2 Ko seront ajout√©s √† la taille du projet.  En savoir plus sur le co√ªt d'importation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d1/488/bbb/8d1488bbb04afc1739a0a94967f74c2b.gif"></div><br>  <i><font color="#999999">Le "co√ªt" de l'importation de la biblioth√®que Lodash enti√®re dans le projet et d'une seule fonction sp√©cifique de cette biblioth√®que</font></i> <br><br><h2>  <font color="#3AC1EF">Le cas des paquets d√©raisonnablement grands</font> </h2><br>  Ainsi, vous avez cr√©√© votre merveilleuse application.  Il fonctionne tr√®s bien sur votre Internet haut d√©bit et sur votre ordinateur le plus puissant, plein de RAM.  Vous l'avez sorti dans le monde r√©el.  Apr√®s un certain temps, des plaintes ont commenc√© √† √©maner de vous ou de vos propres analystes.  Ces plaintes concernaient les temps de chargement des applications.  Quelque chose de similaire m'est arriv√© r√©cemment lorsque nous, chez Wix, avons d√©voil√© une nouvelle fonctionnalit√© sur laquelle je travaillais. <br><br>  Afin de vous mettre un peu au courant, parlons de cette nouvelle opportunit√©.  Il s'agit d'une nouvelle barre de progression situ√©e en haut du panneau lat√©ral de l'interface des param√®tres du site utilisateur.  Le but de ce m√©canisme est d'attirer l'attention de l'utilisateur sur les diff√©rentes √©tapes qu'il doit effectuer pour que son projet d'entreprise ait de meilleures chances de r√©ussite (connexion SEO, ajout de r√©gions dans lesquelles les marchandises sont livr√©es, ajout du premier produit , etc.). <br><br>  La barre de progression est mise √† jour automatiquement en se connectant au serveur √† l'aide de sockets Web.  Lorsque l'utilisateur a termin√© toutes les √©tapes recommand√©es, une fen√™tre contextuelle s'affiche avec des f√©licitations.  Une fois cette fen√™tre ferm√©e, la barre de progression est masqu√©e et ne s'affiche plus jamais lorsque vous travaillez avec le site dans lequel vous l'avez utilis√©.  C'est ce dont nous venons de parler. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2eb/b42/282/2ebb4228298df39e9b83358aaa7ebaac.gif"></div><br>  <i><font color="#999999">Barre de progression et fen√™tre de f√©licitations</font></i> <br><br>  Que s'est-il pass√©?  Pourquoi nos analystes se plaignent-ils que le temps de chargement des pages a augment√©?  Lorsque j'ai examin√© la situation √† l'aide de l'onglet R√©seau des outils de d√©veloppement Chrome, il est imm√©diatement devenu clair pour moi que mon ensemble √©tait assez gros.  A savoir, sa taille √©tait de 190 Kb. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f13/0ce/631/f130ce631ea4399322aa95583c7b2fa5.png"></div><br>  <i><font color="#999999">Taille de l'ensemble trouv√©e √† l'aide des outils de d√©veloppement Chrome</font></i> <br><br>  "Pourquoi cette petite chose a-t-elle besoin d'un paquet relativement grand?" J'ai alors pens√©.  Mais la v√©rit√© - pourquoi? <br><br><h3>  <font color="#3AC1EF">‚ñçRechercher les points probl√©matiques dans le bundle</font> </h3><br>  Apr√®s avoir r√©alis√© que la taille du paquet est trop grande, il est temps de d√©couvrir la raison de cela.  C'est l√† que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Webpack Bundle Analyzer a</a> √©t√© utile - un excellent outil pour identifier les zones probl√©matiques des bundles.  Il ouvre un nouvel onglet de navigateur et affiche des informations de d√©pendance. <br><br>  C'est ce qui s'est pass√© apr√®s avoir analys√© le bundle avec cet outil. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f17/465/f5f/f17465f5f21c29bbbb57f37373b0c92e.png"></div><br>  <i><font color="#999999">R√©sultats de Webpack Bundle Analyzer</font></i> <br><br>  Avec l'aide de l'analyseur, j'ai pu d√©tecter le "criminel".  Le package lottie-web a √©t√© utilis√© ici, ce qui a ajout√© 61,45 Ko √† la taille du bundle.  Lottie est une tr√®s belle biblioth√®que JavaScript qui permet d'utiliser des outils de navigation standard pour produire des animations cr√©√©es dans Adobe After Effect.  Dans mon cas, c'√©tait pour que notre designer ait besoin d'une belle animation, qui a √©t√© r√©alis√©e lorsque la fen√™tre de f√©licitations est apparue.  Il a cr√©√© cette animation et me l'a donn√©e sous la forme d'un fichier JSON, que j'ai transf√©r√© dans le package Lottie et obtenu une belle animation.  En plus du package lottie-web, j'avais √©galement un fichier JSON avec des descriptions d'animation.  La taille de ce fichier √©tait de 26 Kb.  En cons√©quence, la biblioth√®que Lottie, le fichier JSON, ainsi que certaines petites d√©pendances auxiliaires me "co√ªtent" environ 94 Ko.  Et ce n'est qu'une animation de la fen√™tre avec des f√©licitations √† l'utilisateur.  L'utilisateur, quand il a vu ces f√©licitations, aurait d√ª √™tre content.  Tout cela m'a rendu triste. <br><br><h2>  <font color="#3AC1EF">La technologie React Lazy / Suspense vient √† la rescousse</font> </h2><br>  Apr√®s avoir d√©couvert la cause du probl√®me, il est temps de r√©soudre ce probl√®me.  Il √©tait clair qu'il n'√©tait pas n√©cessaire de charger au tout d√©but du travail tout ce qui √©tait n√©cessaire pour l'animation.  En fait, il y avait une chance consid√©rable qu'au cours de la session en cours de l'utilisateur, il n'ait pas √† afficher une fen√™tre de f√©licitations.  Ensuite, je me suis familiaris√© avec les technologies React Lazy / Suspense r√©cemment apparues et j'ai pens√© que maintenant j'avais probablement une bonne occasion de les tester. <br><br>  Si vous n'√™tes pas familier avec le concept de composants "paresseux" (paresseux), sachez que leur signification est de diviser l'application en petits morceaux de code.  Le t√©l√©chargement de ces fragments n'est effectu√© que lorsqu'ils sont n√©cessaires.  Dans mon cas, cela s'est exprim√© dans le fait que je devais s√©lectionner dans la fonction principale de la barre de progression le composant qui √©tait responsable de montrer les f√©licitations.  Il √©tait n√©cessaire de charger ce composant uniquement lorsque l'utilisateur a termin√© la s√©quence d'√©tapes recommand√©e. <br><br>  React 16.6.0 (et les versions plus r√©centes) poss√®de une API simple con√ßue pour rendre les composants paresseux.  Ce sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React.lazy et React.Suspense</a> .  Prenons un exemple: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OtherComponent = React.lazy(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./OtherComponent'</span></span>)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (    <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">      </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">React.Suspense</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fallback</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Loading...</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">}&gt;        </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">OtherComponent</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">      </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">React.Suspense</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  ); }</span></span></code> </pre> <br>  Nous avons un composant qui affiche l'√©l√©ment <code>&lt;div&gt;</code> , et il <code>OtherComponent</code> un composant <code>Suspense</code> qui enveloppe le composant <code>OtherComponent</code> .  Si vous regardez la premi√®re ligne de cet exemple, vous pouvez voir que <code>OtherComponent</code> pas import√© directement dans le code.  En r√®gle g√©n√©rale, une importation comme celle-ci ressemble √† l' <code>import OtherComponent from './OtherComponent';</code>  . <br><br>  Au lieu de cela, la commande d'importation est encadr√©e comme une fonction qui prend un chemin de fichier.  Ce m√©canisme fonctionne car Webpack dispose d'outils de s√©paration de code int√©gr√©s.  Lorsqu'une construction similaire est pr√©sente dans le code, une promesse est retourn√©e, qui, apr√®s avoir t√©l√©charg√© le fichier, est r√©solue avec le contenu de ce fichier.  Notre √©quipe d'importation est envelopp√©e dans une fonction <code>React.lazy</code> . <br><br>  Dans les mat√©riaux de rendu renvoy√©s par <code>MyComponent</code> , <code>OtherComponent</code> dans un composant <code>React.Suspense</code> qui a une propri√©t√© de <code>fallback</code> .  Dans notre cas, il s'av√®re que lorsque le rendu atteint <code>OtherComponent</code> , le chargement du composant correspondant commence.  En attendant, ce qui est √©crit dans la propri√©t√© de <code>fallback</code> est rendu.  Dans cet exemple, il s'agit du texte <code>Loading‚Ä¶</code>  En fait, c'est tout.  Ces m√©canismes font tout simplement leur travail. <br><br>  Il est vrai que vous devez prendre en compte quelques fonctionnalit√©s lorsque vous travaillez avec Lazy / Suspense. <br><br><ol><li>  Un composant import√© de mani√®re "paresseuse" doit contenir l'exportation par d√©faut, qui sera le point d'entr√©e du composant.  Les exportations nomm√©es ne peuvent pas √™tre utilis√©es ici. </li><li>  Vous devez <code>React.lazy</code> le composant import√© √† l'aide de la fonction <code>React.lazy</code> dans le composant <code>React.Suspense</code> .  Le composant <code>React.Suspense</code> fournir la propri√©t√© de <code>fallback</code> .  Sinon, une erreur se produira.  Cependant, si vous ne voulez tout simplement pas rendre quoi que ce soit tant que le composant n'a pas termin√© le chargement paresseux, vous pouvez simplement √©crire <code>null</code> en <code>fallback</code> sans essayer de contourner la n√©cessit√© d'√©crire quelque chose dans cette propri√©t√© de mani√®re d√©licate. </li></ol><br><h2>  <font color="#3AC1EF">L'utilisation de React Lazy / Suspense m'a-t-elle aid√©?</font> </h2><br>  Oui, √ßa a aid√©!  Le fractionnement de code a fonctionn√© de mani√®re incroyable.  Jetons un coup d'≈ìil aux r√©sultats de l'analyse du nouveau bundle √† l'aide de Webpack. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21e/502/fff/21e502fffa9544e33a750a8d23c33ede.png"></div><br>  <i><font color="#999999">R√©sultats de Webpack Bundle Analyzer apr√®s la division du code</font></i> <br><br>  Comme vous pouvez le voir, la taille de mon bundle a diminu√© d'environ 50% - √† 96 Ko.  Super! <br><br>  Alors quoi, maintenant le probl√®me est r√©solu?  Non, malheureusement.  Quand j'ai regard√© la page, il s'est av√©r√© que la fen√™tre contextuelle avec f√©licitations a perdu son positionnement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b9/4a0/25d/3b94a025d8577c55a2d973928acf7c5f.png"></div><br>  <i><font color="#999999">La fen√™tre de f√©licitations n'appara√Æt pas l√† o√π vous en avez besoin</font></i> <br><br>  Le probl√®me √©tait que j'ai ¬´demand√©¬ª √† la fen√™tre de s'ouvrir en changeant l'√©tat du composant React.  Pendant ce temps, j'ai d√©j√† rendu <code>null</code> (c'est-√†-dire que je n'ai rien rendu) en utilisant le composant <code>React.Suspense</code> .  Apr√®s le chargement paresseux des donn√©es n√©cessaires, les documents pertinents ont √©t√© ajout√©s au DOM.  Cependant, le positionnement du popup a d√©j√† √©t√© fait.  Par cons√©quent, du fait que les propri√©t√©s du composant correspondant n'ont pas chang√©, ce composant ¬´ne savait pas¬ª qu'il devait r√©soudre le probl√®me de positionnement.  Si je modifiais la taille de la fen√™tre du navigateur, la fen√™tre contextuelle apparaissait au bon endroit car le composant correspondant observait les changements de propri√©t√©s et les √©v√©nements de redimensionnement de la fen√™tre, initiant, si n√©cessaire, un repositionnement. <br><br>  Comment r√©soudre ce probl√®me?  La solution √©tait d'√©liminer ¬´l'interm√©diaire¬ª. <br><br>  J'ai d√ª d'abord charger le composant "paresseux", et ensuite seulement √©crire √† l'√©tat qui dirait √† la fen√™tre avec des f√©licitations qu'elle doit s'ouvrir.  J'ai pu le faire en utilisant les m√™mes m√©canismes de partage de code Webpack, mais maintenant - sans impl√©menter les importations en utilisant <code>React.lazy</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> loadAndSetHappyMoment() {  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(    <span class="hljs-string"><span class="hljs-string">'../SidebarHappyMoment/SidebarHappyMoment.component'</span></span>  );  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SidebarHappyMoment = component.SidebarHappyMoment;  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({    <span class="hljs-attr"><span class="hljs-attr">tooltipLevel</span></span>: TooltipLevel.happyMoment,  }); }</code> </pre> <br>  Cette fonction est appel√©e apr√®s que mon composant, via le m√©canisme des sockets Web, soit inform√© qu'il doit afficher une fen√™tre avec f√©licitations.  J'ai utilis√© la fonction d' <code>import</code> Webpack (deuxi√®me ligne de code).  Si vous vous souvenez, j'ai dit ci-dessus que cette fonction renvoie une promesse, en cons√©quence j'ai pu utiliser la construction <code>async/await</code> . <br><br>  Une fois le chargement du composant termin√©, je l'√©cris dans l'instance de mon composant (avec la commande <code>this.SidebarHappyMoment = component.SidebarHappyMoment;</code> ).  Cela me donne l'opportunit√© de l'utiliser plus tard lors du rendu.  Veuillez noter que je peux maintenant utiliser des exportations nomm√©es.  Dans mon cas, j'ai utilis√©, dans la ligne ci-dessus, le nom <code>SidebarHappyMoment</code> .  Et enfin, et ce n'est pas moins important que tout le reste, j'informe la fen√™tre qu'elle doit s'ouvrir, en changeant son √©tat en cons√©quence une fois que je sais que le composant est pr√™t √† fonctionner. <br><br>  Par cons√©quent, le code de rendu ressemble maintenant √† ceci: <br><br><pre> <code class="javascript hljs">renderTooltip() {  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.tooltipLevel === TooltipLevel.happyMoment) {    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">this.SidebarHappyMoment</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">;  }  // ... }</span></span></code> </pre> <br>  Notez que la commande <code>return &lt;this.SidebarHappyMoment /&gt;;</code>  renvoie <code>this.SidebarHappyMoment</code> - ce que j'ai √©crit pr√©c√©demment √† l'instance de mon composant.  Il s'agit maintenant d'une fonction de rendu synchrone normale, identique √† celles que vous avez utilis√©es un million de fois.  Et maintenant, la fen√™tre de f√©licitations s'affiche exactement √† l'endroit o√π elle doit √™tre affich√©e.  Et le fait est qu'il ne s'ouvre que lorsque son contenu est pr√™t √† l'emploi. <br><br><h2>  <font color="#3AC1EF">Le produit d√©finit l'architecture</font> </h2><br>  Si l'id√©e dans le titre de cette section a soulev√© un point d'interrogation important dans votre imagination, sachez que c'est le cas.  Le produit d√©finit l'architecture. <br><br>  Il s'agit du fait que le produit d√©finit ce qui doit √™tre visible et interactif lors du premier rendu du composant.  Cela aide le d√©veloppeur √† comprendre exactement ce qu'il peut s√©parer du code principal et charger plus tard, si n√©cessaire.  J'ai r√©fl√©chi √† la situation et je me suis souvenu qu'apr√®s que l'utilisateur a termin√© les √©tapes recommand√©es pour configurer le site, ou s'il n'est pas l'administrateur du site, je n'ai pas besoin de lui montrer la barre de progression et le contenu connect√©.  Maintenant, en utilisant ces informations, j'ai pu continuer √† partager le bundle.  Voil√† ce que j'ai. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36f/5f2/eb9/36f5f2eb91ead3a7188f5d5162d75b3e.png"></div><br>  <i><font color="#999999">La s√©paration continue du paquet</font></i> <br><br>  Apr√®s cela, la taille du paquet n'√©tait plus que de 38 Ko.  Et je vous rappelle que nous avons commenc√© avec 190 Ko.  Il y a une r√©duction de 80% de la taille du paquet.  Et en passant, je vois d√©j√† d'autres possibilit√©s de s√©paration de code.  J'ai h√¢te de continuer √† optimiser le bundle. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Les d√©veloppeurs ont la possibilit√© de s'efforcer de rester dans leur ¬´zone de confort¬ª et de ne pas se plonger dans autre chose que l'appareil du code lui-m√™me et sa fonctionnalit√©.  Cependant, un programmeur qui utilise les outils d√©crits ci-dessus, r√©fl√©chit de mani√®re cr√©ative et travaille en √©troite collaboration avec d'autres sp√©cialistes, peut √™tre en mesure d'am√©liorer les performances de son application en r√©duisant consid√©rablement la taille du bundle contenant ce qui est n√©cessaire pour commencer √† travailler avec cette application. <br><br>  <b>Chers lecteurs!</b>  Utilisez-vous le fractionnement de code pour acc√©l√©rer le chargement de vos applications Web? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468225/">https://habr.com/ru/post/fr468225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468211/index.html">¬´Je voulais juste faire une blague, mais personne n'a compris¬ª ou comment ne pas m'enterrer lors de la pr√©sentation du projet</a></li>
<li><a href="../fr468213/index.html">tinc-boot - r√©seau maill√© sans douleur</a></li>
<li><a href="../fr468217/index.html">Dr. Jekyll et M. Hyde Culture d'entreprise</a></li>
<li><a href="../fr468219/index.html">M√©canismes d'extensibilit√© extensible en JavaScript</a></li>
<li><a href="../fr468223/index.html">Habr Weekly # 19 / BT-porte pour le chat, pourquoi l'IA triche, que demander au futur employeur, une journ√©e avec iPhone 11 Pro</a></li>
<li><a href="../fr468227/index.html">Acc√©l√©ration instagram.com. partie 1</a></li>
<li><a href="../fr468229/index.html">Une note sur void en JavaScript et TypeScript</a></li>
<li><a href="../fr468231/index.html">La s√©curit√© dans AEM est-elle un probl√®me de plate-forme ou d'impl√©mentation?</a></li>
<li><a href="../fr468233/index.html">La fa√ßon de taper la v√©rification de 4 millions de lignes de code Python. partie 1</a></li>
<li><a href="../fr468235/index.html">La fa√ßon de taper la v√©rification de 4 millions de lignes de code Python. 2e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>