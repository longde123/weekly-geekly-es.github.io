<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§πüèΩ üë©üèø‚Äçü§ù‚Äçüë©üèº üéå Hacemos un plan de terreno interactivo en 15 minutos. üßöüèΩ ü§Ø üëêüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la Tostadora, a menudo preguntan c√≥mo hacer un diagrama interactivo de una casa, un plan de su estructura interna, la capacidad de seleccionar piso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hacemos un plan de terreno interactivo en 15 minutos.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478698/"><p><img src="https://habrastorage.org/webt/n0/jb/-9/n0jb-9sfsmw2ewd-etwnl04ayvc.jpeg"></p><br><p> En la Tostadora, a menudo preguntan c√≥mo hacer un diagrama interactivo de una casa, un plan de su estructura interna, la capacidad de seleccionar pisos o apartamentos con informaci√≥n sobre ellos, mostrar informaci√≥n sobre los detalles de un producto en particular cuando pasa el mouse sobre ellos en una fotograf√≠a, etc.  No se trata de un modelo tridimensional, sino de una imagen con la capacidad de resaltar ciertos detalles.  Todas estas tareas son similares y se resuelven de manera bastante simple, pero aun as√≠ siguen apareciendo preguntas, por lo que hoy veremos c√≥mo se hacen tales cosas usando SVG, un editor gr√°fico y una pizca de JavaScript. </p><a name="habracut"></a><br><p>  La elecci√≥n de SVG se debe al hecho de que esta es la opci√≥n m√°s simple para el desarrollo y la depuraci√≥n.  Conoc√≠ a personas que aconsejaron que todo esto se hiciera en lienzo, pero all√≠ es mucho m√°s dif√≠cil entender lo que est√° sucediendo, y las coordenadas de todos los puntos en las curvas deben calcularse de antemano de alguna manera, pero aqu√≠ abr√≠ las herramientas del desarrollador e inmediatamente vi toda la estructura, todos los objetos, con el que hay interacci√≥n, y todo lo dem√°s se puede hacer clic con el mouse en una interfaz amigable para los humanos.  El rendimiento entre el lienzo 2D habitual y SVG dif√≠cilmente diferir√°.  WebGL puede dar algo de bonificaci√≥n a este respecto, pero el cronograma de desarrollo aumentar√° significativamente, sin mencionar el soporte adicional, que no siempre se ajusta al presupuesto.  Incluso dir√≠a "nunca encaja". </p><br><p>  En este tutorial, haremos algo as√≠ como un widget para un sitio ficticio para alquilar casas privadas en alguna √°rea, pero est√° claro que los principios para crear esas cosas en cuesti√≥n se aplican a cualquier tema. </p><br><h2 id="nachinaem-nachinat">  Empezando </h2><br><p>  Mostrar√© todo con <a href="https://inkscape.org/">Inkscape</a> como ejemplo, pero se pueden realizar las mismas acciones en cualquier otro editor usando funciones similares. </p><br><p>  Para trabajar, necesitamos dos cuadros de di√°logo principales: </p><br><ul><li>  Editor XML (Ctrl + Shift + X o un icono con corchetes angulares): para ver la estructura del documento en forma de marcado y editar elementos individuales. </li><li>  Relleno y trazo (Ctrl + Shift + F o el icono con un pincel en el marco), principalmente para rellenar contornos. </li></ul><br><p>  In√≠cielos inmediatamente y proceda a la creaci√≥n del documento. </p><br><blockquote>  Si los arrastr√≥ accidentalmente a una ventana separada, puede hacer clic debajo del marco superior de esta ventana (donde no hay nada) y arrastrarlos nuevamente a la ventana principal.  Esto no es del todo intuitivo, sino m√°s bien conveniente. </blockquote><p>  Abra una foto con una vista del √°rea.  Podemos optar por insertar la imagen en s√≠ misma como una cadena base64 o un enlace externo.  Como es grande, seleccione el enlace.  Luego cambiaremos el camino hacia la imagen con nuestras manos al introducir todo en las p√°ginas del sitio.  Se crea un documento SVG en el que la foto se incrustar√° mediante la etiqueta de imagen. </p><br><blockquote>  Para las im√°genes r√°ster incrustadas en SVG, incrustadas en HTML, ser√° posible utilizar la carga diferida, as√≠ como tambi√©n las im√°genes normales en las p√°ginas.  En este ejemplo, no nos detendremos en tales optimizaciones, pero no nos olvidemos de ellas en el trabajo pr√°ctico. </blockquote><p>  En la etapa actual, vemos frente a nosotros algo como esto: </p><br><p><img src="https://habrastorage.org/webt/nf/1v/ak/nf1vak7y46k_uto-ov-85ifimrc.jpeg"></p><br><p>  Ahora cree una nueva capa (Ctrl + Shift + N o Men√∫&gt; Capa&gt; Agregar capa).  En el editor XML, vemos que ha aparecido el elemento g regular.  Si bien no hemos llegado lejos, podemos darle una clase, que usaremos m√°s adelante en los scripts. </p><br><blockquote>  No conf√≠es en la identificaci√≥n.  Cuanto m√°s compleja es la interfaz, m√°s f√°cil es hacer que se repitan y obtener errores extra√±os.  Y en nuestra tarea, todav√≠a no tienen ning√∫n beneficio.  Por lo tanto, las clases o los atributos de datos son nuestra elecci√≥n. </blockquote><p>  Si observa detenidamente la estructura del documento en el editor XML, notar√° que hay muchas cosas superfluas.  Cualquier editor de gr√°ficos vectoriales m√°s o menos complejo agregar√° algo propio a los documentos.  Eliminar todo esto con las manos es una tarea larga e ingrata, el editor constantemente agregar√° algo nuevamente.  Por lo tanto, la limpieza de SVG de la basura se realiza solo al final del trabajo.  Y preferiblemente en una forma automatizada, ya que hay opciones preparadas, el mismo <a href="https://github.com/svg/svgo">svgo,</a> por ejemplo. </p><br><p>  Encuentre una herramienta llamada Dibujar curvas Bezier y L√≠neas rectas (Shift + F6).  Con ella, dibujaremos contornos cerrados alrededor de los objetos.  En nuestra tarea, necesitamos delinear todos los edificios.  Por ejemplo, nos limitamos a seis, pero en condiciones reales valdr√≠a la pena preasignar el tiempo para delinear con precisi√≥n todos los objetos necesarios.  Aunque a menudo sucede que hay muchas entidades similares, los mismos pisos en un edificio pueden ser absolutamente id√©nticos.  En tales casos, puede acelerar un poco y copiar y pegar las curvas. </p><br><p>  Despu√©s de haber rodeado los edificios necesarios, volvemos al editor XML, agregamos clases o, lo m√°s probable, ser√° a√∫n m√°s conveniente, atributos de datos con √≠ndices para ellos (es posible con direcciones, pero dado que tenemos un √°rea ficticia, solo hay √≠ndices), y mueva todo a la capa creada anteriormente para que todo est√© "dispuesto en los estantes".  Y la imagen, por cierto, tambi√©n ser√° √∫til para moverse all√≠, de modo que todo est√© en un solo lugar, pero estos son peque√±os detalles. </p><br><p>  Ahora, habiendo elegido un camino, una curva alrededor del edificio, puede seleccionarlos todos con Ctrl + A o Men√∫&gt; Editar&gt; Seleccionar todo y editar al mismo tiempo.  Debe pintarlos a todos en la ventana Relleno y trazo, y al mismo tiempo eliminar el trazo adicional all√≠.  Bueno, o agr√©guelo si lo necesita por razones de dise√±o. </p><br><p><img src="https://habrastorage.org/webt/du/qi/7d/duqi7d2_rtovsgoo9osa-vo25-w.jpeg"></p><br><blockquote>  Tiene sentido pintar todos los contornos con un poco de color con un valor de opacidad m√≠nimo para ellos, incluso si esto no es necesario en t√©rminos de dise√±o.  El hecho es que los navegadores "inteligentes" creen que no puede hacer clic en un camino vac√≠o, sino en uno inundado, puede hacerlo, incluso si nadie ve este relleno. </blockquote><p>  En nuestro ejemplo, dejaremos un peque√±o resaltado en blanco para ver mejor con qu√© edificios trabajamos, guardar todo y movernos sin problemas al navegador y al editor de c√≥digo m√°s familiar. </p><br><h2 id="bazovyy-primer">  Ejemplo b√°sico </h2><br><p>  Creemos una p√°gina html vac√≠a, peguemos el SVG resultante directamente y agreguemos algo de CSS para que nada salga de la pantalla.  No hay nada que comentar. </p><br><pre><code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.map</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">90%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">max-width</span></span>: <span class="hljs-number"><span class="hljs-number">1300px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">2rem</span></span> auto; <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: <span class="hljs-number"><span class="hljs-number">1rem</span></span> solid <span class="hljs-number"><span class="hljs-number">#fff</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">1rem</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-number"><span class="hljs-number">5rem</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .3); } <span class="hljs-selector-class"><span class="hljs-selector-class">.map</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">svg</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: auto; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: .<span class="hljs-number"><span class="hljs-number">5rem</span></span>; }</code> </pre> <br><p>  Recordamos que agregamos clases a los edificios y los usamos para que CSS est√© m√°s o menos estructurado. </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">transition</span></span>: opacity .<span class="hljs-number"><span class="hljs-number">3s</span></span> ease-in-out; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; <span class="hljs-attribute"><span class="hljs-attribute">opacity</span></span>: .<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.-available</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">fill</span></span>: <span class="hljs-number"><span class="hljs-number">#0f0</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.-reserved</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">fill</span></span>: <span class="hljs-number"><span class="hljs-number">#f00</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.-service</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">fill</span></span>: <span class="hljs-number"><span class="hljs-number">#fff</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre> <br><p>  Como definimos estilos en l√≠nea en Inkscape, necesitamos interrumpirlos en CSS.  ¬øSer√≠a m√°s conveniente hacer todo en CSS?  Si y no  Depende de la situaci√≥n.  A veces no hay elecci√≥n.  Por ejemplo, si un dise√±ador dibuj√≥ una gran cantidad de todo colorido y lo envolvi√≥ todo en CSS e infl√≥ a la imposibilidad de que de alguna manera no se volviera il faut.  En este ejemplo, uso la opci√≥n "inconveniente" para mostrar que no da mucho miedo en el contexto del problema que se est√° resolviendo. </p><br><p><img src="https://habrastorage.org/webt/t0/r4/nr/t0r4nr0bqr-zyblc_srzafnogis.jpeg"></p><br><p>  Supongamos que recibimos datos nuevos sobre las casas y les agregamos diferentes clases, seg√∫n su estado actual: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = { <span class="hljs-attr"><span class="hljs-attr">id_0</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'service'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_2</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_3</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_4</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_5</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">messages</span></span>: { <span class="hljs-string"><span class="hljs-string">'available'</span></span>: <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'reserved'</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'service'</span></span>: <span class="hljs-string"><span class="hljs-string">'  1-2 '</span></span> } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> map = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'my-map'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildings = map.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.building'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (building <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> buildings) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = building.getAttribute(<span class="hljs-string"><span class="hljs-string">'data-building-id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> status = data[<span class="hljs-string"><span class="hljs-string">`id_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">`</span></span>].status; building.classList.add(<span class="hljs-string"><span class="hljs-string">`-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${status}</span></span></span><span class="hljs-string">`</span></span>); }</code> </pre> <br><p>  Obtenemos algo como esto: </p><br><p><img src="https://habrastorage.org/webt/zm/n6/tx/zmn6txixk7isjsgy9hdkukjjyc0.jpeg"></p><br><p>  Algo similar a lo que necesitamos ya es visible.  En esta etapa, hemos resaltado objetos en el terreno que responden al desplazamiento del mouse.  Y no es dif√≠cil agregarles una respuesta a un clic del mouse a trav√©s del addEventListener est√°ndar. </p><br><h2 id="leader-line">  L√≠nea l√≠der </h2><br><p>  A menudo existe la tarea de hacer l√≠neas que conecten los objetos en el mapa y algunos elementos de la p√°gina con informaci√≥n adicional, as√≠ como hacer una m√≠nima informaci√≥n sobre herramientas al pasar el cursor sobre estos mismos objetos.  Para resolver estos problemas, la mini biblioteca de <a href="https://github.com/anseki/leader-line">l√≠nea l√≠der</a> es muy adecuada, lo que crea flechas vectoriales para todos los gustos y colores. </p><br><p>  Agreguemos precios para la informaci√≥n sobre herramientas a los datos y dibujemos estas l√≠neas. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = { <span class="hljs-attr"><span class="hljs-attr">id_0</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'3000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'service'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'3000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_2</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'2000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_3</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'5000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_4</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'2500'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_5</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'2500'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">messages</span></span>: { <span class="hljs-string"><span class="hljs-string">'available'</span></span>: <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'reserved'</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'service'</span></span>: <span class="hljs-string"><span class="hljs-string">'   (1-2 )'</span></span> } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> map = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'my-map'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildings = map.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.building'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> info = map.querySelector(<span class="hljs-string"><span class="hljs-string">'.info'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> lines = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (building <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> buildings) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = building.getAttribute(<span class="hljs-string"><span class="hljs-string">'data-building-id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> status = data[<span class="hljs-string"><span class="hljs-string">`id_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">`</span></span>].status; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> price = data[<span class="hljs-string"><span class="hljs-string">`id_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">`</span></span>].price; building.classList.add(<span class="hljs-string"><span class="hljs-string">`-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${status}</span></span></span><span class="hljs-string">`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> line = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LeaderLine( LeaderLine.pointAnchor(building, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span> }), LeaderLine.pointAnchor(info, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }), { <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#fff'</span></span>, <span class="hljs-attr"><span class="hljs-attr">startPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'arrow1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'behind'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endSocket</span></span>: <span class="hljs-string"><span class="hljs-string">'top'</span></span> } ); lines.push(line); }</code> </pre> <br><p>  Como puede ver, no pasa nada complicado.  La l√≠nea tiene "puntos de fijaci√≥n" a los elementos.  Las coordenadas de estos puntos en relaci√≥n con los elementos suelen ser convenientes para determinar en porcentaje.  En general, hay muchas opciones diferentes, no tiene sentido enumerar y recordar, por lo que le recomiendo que solo consulte la documentaci√≥n.  Una de estas opciones, startLabel, ser√° necesaria para que podamos crear una peque√±a informaci√≥n sobre herramientas con un precio. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> line = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LeaderLine( LeaderLine.pointAnchor(building, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span> }), LeaderLine.pointAnchor(info, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }), { <span class="hljs-attr"><span class="hljs-attr">startLabel</span></span>: LeaderLine.captionLabel(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${price}</span></span></span><span class="hljs-string">/`</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fontFamily</span></span>: <span class="hljs-string"><span class="hljs-string">'Rubik Mono One'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fontWeight</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-attr"><span class="hljs-attr">offset</span></span>: [<span class="hljs-number"><span class="hljs-number">-30</span></span>, <span class="hljs-number"><span class="hljs-number">-50</span></span>], <span class="hljs-attr"><span class="hljs-attr">outlineColor</span></span>: <span class="hljs-string"><span class="hljs-string">'#555'</span></span> }), <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#fff'</span></span>, <span class="hljs-attr"><span class="hljs-attr">startPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'arrow1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'behind'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endSocket</span></span>: <span class="hljs-string"><span class="hljs-string">'top'</span></span>, <span class="hljs-attr"><span class="hljs-attr">hide</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } );</code> </pre> <br><blockquote>  Nadie se molesta en dibujar todos los consejos en un editor gr√°fico.  Si se supone que tienen un contenido consistente, incluso puede ser conveniente.  Especialmente si hay un deseo de pedirles diferentes posiciones para diferentes objetos. </blockquote><p>  Tambi√©n podemos agregar la opci√≥n de ocultar para que todas las l√≠neas no se muestren como una escoba.  Les mostraremos uno a la vez cuando pase el cursor sobre los edificios a los que corresponden: </p><br><pre> <code class="javascript hljs">building.addEventListener(<span class="hljs-string"><span class="hljs-string">'mouseover'</span></span>, () =&gt; { line.show(); }); building.addEventListener(<span class="hljs-string"><span class="hljs-string">'mouseout'</span></span>, () =&gt; { line.hide(); });</code> </pre> <br><p>  Aqu√≠ puede mostrar informaci√≥n adicional (en nuestro caso, simplemente el estado actual del objeto) en el lugar para obtener informaci√≥n.  Resultar√° casi lo que se necesita: </p><br><p><img src="https://habrastorage.org/webt/dj/6q/-3/dj6q-39gunb8vxq35elxb0bwse0.jpeg"></p><br><p>  Esas cosas rara vez est√°n dise√±adas para dispositivos m√≥viles, pero vale la pena recordar que a menudo se hacen a pantalla completa en el escritorio, e incluso con algunos paneles en el lateral para obtener informaci√≥n adicional y necesita estirar todo maravillosamente.  Algo como esto, por ejemplo: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">svg</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; }</code> </pre> <br><p>  En este caso, las proporciones del elemento SVG definitivamente no coincidir√°n con las proporciones de la imagen en el interior.  Que hacer </p><br><h2 id="nesovpadayuschie-proporcii">  Proporciones no coincidentes </h2><br><p>  Lo primero que viene a la mente es el <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit">ajuste de objeto:</a> propiedad de <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit">cubierta</a> de CSS.  Pero hay un punto: no puede trabajar con SVG.  E incluso si funcion√≥, entonces las casas a lo largo de los bordes del plan podr√≠an salir de los bordes del esquema y volverse completamente inaccesibles.  As√≠ que aqu√≠ tienes que ir un poco m√°s complicado. </p><br><p>  Primer paso  SVG tiene un atributo <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/preserveAspectRatio">preserveAspectRatio</a> , que es algo similar a la propiedad de ajuste de objeto (no del todo, por supuesto, pero ...).  Al <code>preserveAspectRatio="xMinYMin slice"</code> para el elemento SVG principal de nuestro plan, obtenemos un circuito extendido sin vac√≠os en los bordes y sin distorsi√≥n. </p><br><p>  Paso dos  Debe arrastrar y soltar con el mouse.  T√©cnicamente, todav√≠a tenemos esa oportunidad.  Aqu√≠ la tarea es m√°s complicada, especialmente para principiantes.  En teor√≠a, tenemos eventos est√°ndar para el mouse y la pantalla t√°ctil que se pueden procesar y obtener el valor de cu√°nto se debe mover el mapa.  Pero en la pr√°ctica, puede quedar atrapado en esto durante mucho tiempo.  <a href="https://hammerjs.github.io/">Hammer.js</a> vendr√° al <a href="https://hammerjs.github.io/">rescate</a> : otra peque√±a biblioteca que toma toda la cocina interna sobre s√≠ misma y proporciona una interfaz simple para trabajar con arrastrar y soltar, deslizar, etc. </p><br><p>  Necesitamos mover la capa con los edificios y la imagen en todas las direcciones.  Hazlo f√°cil: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildingsLayer = map.querySelector(<span class="hljs-string"><span class="hljs-string">'.buildings_layer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hammertime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hammer(buildingsLayer); hammertime.get(<span class="hljs-string"><span class="hljs-string">'pan'</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">direction</span></span>: Hammer.DIRECTION_ALL });</code> </pre> <br><p>  Por defecto, hammer.js tambi√©n incluye el reconocimiento de svaypas, pero no los necesitamos en el mapa, as√≠ que ap√°guelos de inmediato para no enga√±arnos: </p><br><pre> <code class="javascript hljs">hammertime.get(<span class="hljs-string"><span class="hljs-string">'swipe'</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">enable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> });</code> </pre> <br><p>  Ahora debe comprender de alguna manera qu√© es exactamente lo que necesita publicar para mover el mapa solo a sus bordes, pero no m√°s.  Con una representaci√≥n simple de dos rect√°ngulos en nuestra cabeza, entendemos que para esto necesitamos descubrir la sangr√≠a de la capa con edificios del elemento padre (SVG en nuestro caso) desde los cuatro lados.  GetBoundingClientRect viene al rescate: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> layer = buildingsLayer.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parent = svg.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> offsets = { <span class="hljs-attr"><span class="hljs-attr">top</span></span>: layer.top - parent.top, <span class="hljs-attr"><span class="hljs-attr">bottom</span></span>: layer.bottom - parent.bottom, <span class="hljs-attr"><span class="hljs-attr">right</span></span>: layer.right - parent.right, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: layer.left - parent.left, };</code> </pre> <br><p>  ¬øY por qu√© todav√≠a no tenemos una forma m√°s civilizada (y de trabajo estable) para hacer esto?  Obtener getBoundingClientRect cada vez es muy malo en t√©rminos de rendimiento, pero la elecci√≥n no es muy rica y es casi imposible notar la inhibici√≥n, por lo que no obtendremos optimizaciones prematuras donde todo funcione bien.  De una forma u otra, esto nos permite verificar la posici√≥n de la capa con los edificios y mover todo solo si tiene sentido: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> translateX = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> translateY = <span class="hljs-number"><span class="hljs-number">0</span></span>; hammertime.on(<span class="hljs-string"><span class="hljs-string">'pan'</span></span>, (e) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> layer = buildingsLayer.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parent = svg.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> offsets = { <span class="hljs-attr"><span class="hljs-attr">top</span></span>: layer.top - parent.top, <span class="hljs-attr"><span class="hljs-attr">bottom</span></span>: layer.bottom - parent.bottom, <span class="hljs-attr"><span class="hljs-attr">right</span></span>: layer.right - parent.right, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: layer.left - parent.left, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speedX = e.velocityX * <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speedY = e.velocityY * <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (speedX &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; offsets.left &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  } else if (speedX &lt; 0 &amp;&amp; offsets.right &gt; 0) { //  } if (speedY &gt; 0 &amp;&amp; offsets.top &lt; 0) { //  } else if (speedY &lt; 0 &amp;&amp; offsets.bottom &gt; 0) { //   } buildingsLayer.setAttribute('transform', `translate(${translateX} ${translateY})`); });</span></span></code> </pre> <br><p>  En los bordes, generalmente vale la pena reducir la velocidad para que no haya paradas o sacudidas repentinas.  Por lo tanto, todo va y viene en algo como esto: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (speedX &lt; -offsets.left) { translateX += speedX; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { translateX += -offsets.left * speedX / <span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre> <br><p>  Hay muchas opciones para ralentizaciones.  Este es el m√°s f√°cil.  Y s√≠, no es muy hermoso, pero es tonto y claro.  Los coeficientes en tales ejemplos generalmente se seleccionan a simple vista, dependiendo del comportamiento deseado de la tarjeta. </p><br><p>  Si abre un navegador y juega con el tama√±o de la ventana en las herramientas del desarrollador, puede encontrar que algo sali√≥ mal ... </p><br><h2 id="nechistye-sily">  Fuerzas impuras </h2><br><p>  En dispositivos de escritorio, todo funciona, pero en dispositivos m√≥viles, ocurre magia, es decir, en lugar de mover el mapa, el elemento del cuerpo se mueve.  Oooooooo!  Solo el elenco all√≠ no es suficiente.  Aunque est√° bien, esto sucede porque algo se est√° desbordando en alg√∫n lugar y no se ha configurado una sobrescritura: oculto.  Pero en nuestro caso, puede suceder que nada se mueva en absoluto. </p><br><blockquote>  Un acertijo para las m√°quinas de escribir verdes: est√° el elemento g, dentro del elemento svg, dentro del elemento div, dentro del elemento del cuerpo, dentro del elemento html.  Doctype naturalmente html.  Si agrega transform: translate (...) para arrastrar el elemento g, entonces en la computadora port√°til se mover√°, como estaba previsto, pero en el tel√©fono ni siquiera se mover√°.  No hay errores en la consola.  Pero definitivamente hay un error.  El navegador es el √∫ltimo Chrome tanto all√≠ como all√≠.  La pregunta es por qu√©. </blockquote><p>  <em>Le sugiero que piense unos 10 minutos sin Google antes de ver la respuesta.</em> </p><br><p><img src="https://habrastorage.org/webt/th/ec/yg/thecygjfpw8dtmjtlwtc1ds5x8m.png"></p><br><div class="spoiler">  <b class="spoiler_title">La respuesta</b> <div class="spoiler_text"><p>  Jaja  Te enga√±e  M√°s precisamente, no es as√≠.  Describ√≠ lo que observar√≠amos con las pruebas manuales.  Pero en realidad, todo funciona como deber√≠a.  Esto no es un error, sino una caracter√≠stica relacionada con la propiedad CSS de <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action">la acci√≥n t√°ctil</a> .  En el contexto de nuestra tarea (¬°de repente!) Se revela que existe y, adem√°s, tiene un cierto valor que rompe toda la l√≥gica de interacci√≥n con el mapa.  Entonces tratamos con √©l muy groseramente: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">svg</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">touch-action</span></span>: none <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre> </div></div><br><p>  Pero volvamos a nuestras ovejas y veamos el resultado (es mejor, por supuesto, abrir en una pesta√±a separada): </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://codepen.io/sfi0zy/embed/preview/ZEYYjZL" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Decid√≠ no personalizar el c√≥digo para ninguno de los marcos de moda, de modo que permanezca en la forma de un espacio en blanco neutral sin forma, desde el cual puede construir al crear sus componentes. </p><br><h2 id="chto-v-itoge">  Cual es el resultado? </h2><br><p>  Despu√©s de pasar bastante tiempo, hicimos un plan en el que hay una imagen rasterizada, destacando sus diversos detalles, conectando objetos no relacionados con flechas y reacciones al mouse.  Espero haber logrado transmitir la idea b√°sica de c√≥mo se hace todo esto en la versi√≥n de "presupuesto".  Como notamos al comienzo del art√≠culo, hay muchas aplicaciones diferentes, incluidas aquellas que no est√°n relacionadas con alg√∫n tipo de sitios de dise√±o confusos (aunque este enfoque se usa con mucha frecuencia en ellos).  Bueno, si est√° buscando algo para leer sobre cosas interactivas, pero ya tridimensionales, le dejo un enlace a un art√≠culo sobre el tema: <a href="https://habr.com/ru/post/433876/">presentaciones tridimensionales de productos en Three.js para los m√°s peque√±os</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/478698/">https://habr.com/ru/post/478698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../478672/index.html">Pruebas de IA y puesta en marcha: entrevista con Adam Carmi (Applitools)</a></li>
<li><a href="../478680/index.html">¬øPor qu√©, y lo m√°s importante, a d√≥nde va la gente de TI?</a></li>
<li><a href="../478688/index.html">C√≥mo fue estudiar Data Science en 2019</a></li>
<li><a href="../478692/index.html">C√≥mo se admite Java 8 en Android</a></li>
<li><a href="../478696/index.html">C√≥mo visit√© Urban Tech 2019. Informe del evento</a></li>
<li><a href="../478702/index.html">Trucos de procesamiento m√©trico en Kapacitor</a></li>
<li><a href="../478704/index.html">Qu√© hacer si los correos ya han llegado a Spam: 5 pasos pr√°cticos</a></li>
<li><a href="../478706/index.html">Arquitecto de alta carga. Nuevo curso de OTUS</a></li>
<li><a href="../478708/index.html">C√≥mo los randomisers te permiten dar nueva vida a los viejos juegos</a></li>
<li><a href="../478710/index.html">Despliegue f√°cil y sencillo de aplicaciones en el cartucho de Tarantool (parte 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>