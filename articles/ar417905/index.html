<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍂 👩🏻‍✈️ 🚠 11 طريقة (لا) لتصبح ضحية القرصنة في Kubernetes 🏭 ⚠️ 💔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ملاحظة perev. : تم نشر أصل هذه المقالة على مدونة Kubernetes الرسمية وكتبها أندرو مارتن ، أحد مؤسسي شركة Control Plane البريطانية الشابة المتخصصة في أم...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>11 طريقة (لا) لتصبح ضحية القرصنة في Kubernetes</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/417905/" style=";text-align:right;direction:rtl">  <i><b>ملاحظة</b></i>  <i><b>perev.</b></i>  <i>: تم نشر أصل هذه المقالة على مدونة Kubernetes الرسمية وكتبها أندرو مارتن ، أحد مؤسسي شركة Control Plane البريطانية الشابة المتخصصة في أمن التطبيقات السحابية الأصلية التي تعمل على K8s.</i> <br><br><img src="https://habrastorage.org/webt/em/sv/dw/emsvdwgvf4ym5fydg8ob7jxomcq.jpeg"><br><br>  لقد قطع الأمن في Kubernetes شوطا طويلا منذ وصول المشروع ، لكن المزالق لا تزال تحدث.  نقدم قائمة من التوصيات المفيدة حول كيفية حماية المجموعات وزيادة استقرارها في حالة القرصنة: سنبدأ بمستوى التحكم ، ونستمر في أعباء العمل وأمن الشبكة ، وننتهي بتقييم للأمن المستقبلي. <a name="habracut"></a><br><br><h2 style=";text-align:right;direction:rtl">  الجزء الأول: طائرة التحكم </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">طائرة التحكم</a> هي دماغ Kubernetes.  لديه فكرة عامة عن كل حاوية وجراب يعمل في المجموعة ، ويمكنه تخطيط القرون الجديدة (التي يمكن أن تحتوي على حاويات مع وصول الجذر إلى العقد الأصلية) ، ويمكنه قراءة جميع الأسرار المخزنة في المجموعة.  يعد هذا مكونًا مهمًا جدًا يحتاج إلى حماية مستمرة ضد تسرب البيانات غير المقصود والإجراءات الضارة: سواء عند الوصول إليه أو عندما لا يحدث أي شيء وعندما يتم نقل البيانات عبر الشبكة. <br><br><h3 style=";text-align:right;direction:rtl">  1. TLS في كل مكان </h3><br>  <b>لكل مكون يدعم TLS ، يجب تمكينه - لمنع استنشاق حركة المرور والتحقق من هوية الخادم والتحقق من هوية العميل (في حالة Mutual TLS).</b> <br><br><blockquote style=";text-align:right;direction:rtl">  "يرجى ملاحظة أن بعض المكونات وطرق التثبيت قد تنشط المنافذ المحلية لـ HTTP ، لذا يحتاج المسؤولون إلى التعرف على إعدادات كل مكون لتحديد المسارات المحتملة لحركة المرور غير الآمنة". <br><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">من وثائق Kubernetes</a></i> </blockquote><br>  يوضح الرسم التخطيطي للشبكة أدناه من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Lucas Käldström</a> المكان الذي تحتاج إليه TLS بشكل مثالي: بين كل مكون في المعالج ، وبين Kubelet وخادم API.  تقدم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kelsey Hightower</a> <a href="">Kubernetes The Hard Way</a> الكلاسيكية <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ووثائق الأمان على etcd</a> تعليمات مفصلة لتحقيق هذه الأهداف. <br><br><img src="https://habrastorage.org/webt/tl/z6/9p/tlz69p-_qgydpvdbkb8i0wkwjlm.png"><br><br>  تاريخيا ، لم يكن التحجيم التلقائي لعقد Kubernetes سهلاً ، لأن كل عقدة تتطلب مفتاح TLS للاتصال بالسيد ، وحفظ الأسرار في الصور الأساسية هو ممارسة سيئة.  يسمح <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubelet TLS bootstrapping</a> الجديد لـ Kubelet بإنشاء طلب توقيع شهادة بحيث يتم إنشاء الشهادات في وقت التمهيد: <br><br><img src="https://habrastorage.org/webt/js/7x/bw/js7xbwddp6cgld-bgcp20r657qy.png"><br><br><h3 style=";text-align:right;direction:rtl">  2. الحد الأدنى من الامتيازات في RBAC ، وتعطيل ABAC ، ومراقبة السجل </h3><br>  <b>يوفر التحكم في الوصول المستند إلى الأدوار (RBAC) إدارة سياسات دقيقة يتم من خلالها وصول المستخدمين إلى الموارد مثل مساحات الأسماء.</b> <br><br><img src="https://habrastorage.org/webt/if/so/hz/ifsohz4fgeo5alqvpe4pbvimujq.png"><br><br>  تم استبدال التحكم في الوصول المستند إلى السمة (ABAC) في Kubernetes بـ RBAC منذ K8s 1.6 ولا يجب تمكينه على جانب الخادم من API.  استخدم RBAC بدلاً من ذلك: <code>--authorization-mode=RBAC</code> (أو هذه العلامة لـ GKE: <code>--authorization-mode=RBAC</code> ). <br><br>  هناك العديد <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">من الأمثلة الجيدة</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لسياسات RBAC</a> للخدمات المختلفة في مجموعة ، وكذلك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الوثائق</a> .  ولكن لا تتوقف عند هذا الحد: يمكن الحصول على الإعدادات المختصة لسياسات RBAC باستخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Audit2rbac</a> من سجلات <code>audit</code> . <br><br>  سياسات RBAC غير الصحيحة أو المفرطة هي خطر أمني إذا تم اختراق الموقد.  يجب أن يكون الحفاظ على قواعد RBAC مع الحد الأدنى من الامتيازات ، ومراجعتها باستمرار ، وتحسينها جزءًا من "النظافة الفنية للديون" التي تطبقها الفرق في دورة حياة التطوير. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">يوفر تسجيل التدقيق</a> (بيتا في Kubernetes 1.10) واجهة برمجة تطبيقات تسجيل مخصصة لأحمال العمل (مثل الطلب والاستجابة) وعلى مستوى البيانات الوصفية.  يمكن تكوين مستوى التسجيل وفقًا لسياسة أمان المؤسسة - يطبق <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GKE</a> قيمًا افتراضية معقولة لأولئك الذين بدأوا للتو في العمل معها. <br><br>  بالنسبة لطلبات القراءة مثل <i>get</i> و <i>list</i> و <i>watch</i> ، يتم تخزين الكائن المطلوب فقط في سجلات التدقيق ، بدون كائن استجابة.  للاستعلامات التي تتضمن بيانات حساسة مثل <i>Secret</i> أو <i>ConfigMap</i> ، يتم تصدير بيانات التعريف فقط.  بالنسبة لجميع الطلبات الأخرى ، يتم تسجيل كلا الجسمين في سجلات التدقيق: كلا من الطلب والاستجابة. <br><br>  لا تنس: إن تخزين هذه السجلات داخل الكتلة يمثل خطرًا أمنيًا في حالة حدوث تسوية.  يجب وضع هذه السجلات ، مثل أي سجلات أخرى حساسة للأمان ، خارج المجموعة لتجنب العواقب السلبية في حالة الضعف. <br><br><h3 style=";text-align:right;direction:rtl">  3. استخدم مصادقة الطرف الثالث لخادم API </h3><br>  <b>تساعد مركزية المصادقة والتفويض للمؤسسة بأكملها (أي الدخول الموحد) في عمليات قبول الموظفين الجدد وتركهم ، وضمان حقوق وصول متسقة.</b> <br><br>  يوفر تكامل Kubernetes مع موفري المصادقة من جهات خارجية (مثل Google أو GitHub) ضمانات للهوية من نظام أساسي بعيد (مع حماية مثل المصادقة الثنائية) ويزيل الحاجة إلى المسؤولين لإعادة تكوين خادم API في Kubernetes لإضافة / إزالة المستخدمين. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Dex</a> هو OpenID Connect Identity (OIDC) وموفر OAuth 2.0 مع المكونات الإضافية.  ذهب Pusher إلى أبعد من ذلك من خلال توفير <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">أدوات قابلة للتخصيص</a> ، بالإضافة إلى وجود <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">بعض</a> المساعدين <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الآخرين الذين</a> يركزون على التطبيقات الأخرى. <br><br><h3 style=";text-align:right;direction:rtl">  4. افصل وضع المجموعة الخاصة بك خلف جدار الحماية </h3><br>  <b>يخزن etcd معلومات عن حالة Kubernetes وأسراره ، وهو عنصر حاسم في K8s - يجب حمايته بشكل منفصل عن بقية المجموعة.</b> <br><br>  حق الوصول للكتابة إلى etcd في خادم API يعادل إصدار حقوق الجذر إلى المجموعة بأكملها ، ويمكن حتى الوصول إلى القراءة بسهولة لتصعيد الامتيازات. <br><br>  تقوم أداة جدولة Kubernetes في بحث etcd بتعريفات الجراب التي لا تحتوي على عقدة.  ثم يرسل جميع القرون الموجودة إلى Kubelet المتاحة للتخطيط.  يتم التحقق من هذه الأقراص من قبل خادم API قبل كتابتها إلى etcd ، لذلك يمكن للمهاجمين الذين يكتبون مباشرة إلى etcd تجاوز العديد من آليات الأمان - على سبيل المثال ، <code>PodSecurityPolicies</code> . <br><br>  ينبغي تكوين etcd باستخدام <a href="">كل من شهادات TLS</a> ( <i>العميل</i> <i>والنظير</i> ) ونشرها في العقد المخصصة.  للحد من مخاطر السرقة واستخدام المفاتيح الخاصة من عقد العمل ، يمكنك أيضًا تحديد جدار الحماية لمجموعة خادم API. <br><br><h3 style=";text-align:right;direction:rtl">  5. تناوب مفاتيح التشفير </h3><br>  <b>التدوير المنتظم لمفاتيح وشهادات الأمان هو أفضل ممارسة أمنية تسمح لك بتحديد "نصف قطر التدمير" عند اختراق المفتاح.</b> <br><br>  ستقوم Kubernetes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تلقائيًا بتدوير</a> بعض الشهادات (على وجه الخصوص ، شهادات Kubelet للعميل والخادم) من خلال إنشاء CSR جديدة بعد انتهاء صلاحية الشهادات الحالية. <br><br>  ومع ذلك ، فإن <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المفاتيح المتماثلة</a> المستخدمة من قبل خادم API لتشفير قيم etcd لا يتم تدويرها تلقائيًا - يجب <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">القيام بذلك يدويًا</a> .  تتطلب هذه العملية وصولاً رئيسيًا ، لذلك تخفي الخدمات المُدارة (مثل GKE و AKS) المشكلة عن المستخدم. <br><br><h2 style=";text-align:right;direction:rtl">  الجزء 2: أعباء العمل </h2><br>  مع الحد الأدنى من الأمان على مستوى مستوى التحكم ، يمكن أن تعمل المجموعة بالفعل بأمان.  ومع ذلك ، كما هو الحال مع السفينة التي يحتمل أن تكون خطرة ، يجب على حاويات هذه السفينة حماية البضائع في حالة وقوع حادث أو تسرب غير متوقع.  وينطبق الشيء نفسه على أعباء عمل Kubernetes (Pods ، <i>Deployments</i> ، <i>Jobs</i> ، <i>Sets</i> ، إلخ) - يمكن الوثوق بها في وقت النشر ، ولكن إذا كان الوصول إليها من الخارج ، فهناك دائمًا خطر أن يتم استغلالهم لاحقًا من قبل [المهاجمين].  يمكن تخفيف هذا الخطر من خلال تشغيل أعباء العمل مع الحد الأدنى من الامتيازات وتكوينها الآمن. <br><br><h3 style=";text-align:right;direction:rtl">  6. استخدام ميزات أمان Linux و PodSecurityPolicies </h3><br>  <b>يحتوي Linux kernel على العديد من ملحقات الأمان المتداخلة جزئيًا (الإمكانيات ، SELinux ، AppArmor ، seccomp-bpf) التي يمكن تكوينها لمنح التطبيقات الحد الأدنى من الامتيازات.</b> <br><br>  ستساعدك الأدوات المساعدة مثل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bane في</a> إنشاء ملفات تعريف لـ AppArmor ، وسيساعدك docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">-slim في</a> إنشاء ملفات تعريف seccomp ، ولكن كن حذرًا: لتحديد جميع الآثار الجانبية لتطبيق هذه السياسات ، تحتاج إلى مجموعة شاملة من الاختبارات للتحقق من جميع رموز التطبيق. <br><br>  تحكم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PodSecurityPolicies</a> استخدام ملحقات الأمان هذه ، بالإضافة إلى توجيهات أمان Kubernetes الأخرى.  هم مسؤولون عن الحد الأدنى من المتطلبات التي يجب استيفاؤها للوصول إلى خادم API ، بما في ذلك ملفات تعريف الأمان ، وعلامة الامتياز ، وشبكة المضيف المشتركة ، والعمليات أو مساحات الأسماء لـ IPC. <br><br>  هذه التوجيهات مهمة لأنها تساعد في منع العمليات الحاوية من الفرار من حدودها المعزولة.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مثال PodSecurityPolicy من Tim Allclair</a> متعدد الاستخدامات للغاية - يمكنك أخذه كأساس وتخصيصه <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لحالتك</a> . <br><br><h3 style=";text-align:right;direction:rtl">  7. إجراء تحليل ثابت ل YAML </h3><br>  <b>إذا كان PodSecurityPolicies يقيد الوصول إلى خادم API ، فيمكن أيضًا استخدام التحليل الثابت في عملية التطوير لنمذجة المتطلبات التنظيمية للمؤسسة والرغبة في المخاطرة.</b> <br><br>  لا يجب تخزين المعلومات الحساسة في موارد YAML مثل المداخن ( <i>Pods</i> و <i>Deployments</i> و <i>Sets</i> وما إلى ذلك) ، ويجب تشفير <i>ConfigMaps</i> <i>والأسرار</i> الحساسة باستخدام أدوات مثل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Vault</a> (مع مشغل من CoreOS) أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">git-crypt</a> أو sealing أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">KMS cloud مزود</a> . <br><br>  يمكن استخدام التحليل الثابت لتكوين YAML كأساس للأمان أثناء بدء التشغيل.  يولد <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">kubesec</a> تقييمات مخاطر للموارد: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{ "score": -30, "scoring": { "critical": [{ "selector": "containers[] .securityContext .privileged == true", "reason": "Privileged containers can allow almost completely unrestricted host access" }], "advise": [{ "selector": "containers[] .securityContext .runAsNonRoot == true", "reason": "Force the running image to run as a non-root user to ensure least privilege" }, { "selector": "containers[] .securityContext .capabilities .drop", "reason": "Reducing kernel capabilities available to a container limits its attack surface", "href": "https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" }] } }</code> </pre> <br>  و <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">kubetest</a> هو إطار عمل لاختبار وحدة تكوينات Kubernetes: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">#<span class="hljs-comment"><span class="hljs-comment">// vim: set ft=python: def test_for_team_label(): if spec["kind"] == "Deployment": labels = spec["spec"]["template"]["metadata"]["labels"] assert_contains(labels, "team", "should indicate which team owns the deployment") test_for_team_label()</span></span></code> </pre> <br>  تقوم هذه الأدوات بتنفيذ نهج <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التحول الأيسر</a> (أي أنها تنقل المصادقة والتحقق إلى المراحل الأولى من دورة التطوير).  يوفر اختبار الأمان في مرحلة التطوير للمستخدمين ملاحظات سريعة حول الكود والتكوين ، والتي يمكن رفضها لاحقًا عن طريق التحقق اليدوي أو الآلي ، ويمكن أيضًا تسهيل إدخال ممارسات أمان إضافية. <br><br><h3 style=";text-align:right;direction:rtl">  8. تشغيل الحاويات لا الجذر </h3><br>  <b>غالبًا ما يكون للحاويات التي تعمل كجذر حقوق أكثر بكثير مما تتطلبه أعباء عملها ، وإذا تم اختراقها ، فإنها تساعد المهاجمين على تحقيق قدرات كبيرة.</b> <br><br>  لا تزال الحاويات تعتمد على نموذج أمان UNIX التقليدي (يسمى DAC ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التحكم في الوصول التقديري</a> ) - كل شيء هو ملف ، ويتم منح الحقوق للمستخدمين والمجموعات. <br><br>  لا تعمل مساحات أسماء المستخدمين في Kubernetes.  هذا يعني أن جدول معرف المستخدم في الحاوية تم تعيينه إلى جدول المستخدم المضيف ، وبدء العملية بامتيازات الجذر داخل الحاوية يتسبب في تشغيله بامتيازات الجذر على المضيف.  على الرغم من إضافة آليات إلى كل هذا لمنع الخروج من الحاوية ، إلا أنه لا يوصى بالتشغيل كجذر داخل الحاوية. <br><br>  تستخدم العديد من صور الحاوية المستخدم الجذر لتشغيل PID 1: إذا تم اختراق هذه العملية ، يصبح المهاجم متجذرًا في الحاوية ، ومع أي خطأ في التكوين ، يصبح تشغيل المشكلة أسهل بكثير. <br><br>  قام Bitnami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">بعمل رائع</a> في ترجمة صور الحاويات الخاصة به إلى المستخدمين <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">العاديين (غير الجذر)</a> (وهو أيضًا متطلبات OpenShift الافتراضية) ، والتي يمكن أن تبسط عملية الترحيل إلى الصور غير الجذر أيضًا. <br><br>  يمنع جزء PodSecurityPolicy عمليات الجذر من التشغيل في الحاوية والتصعيد إلى الجذر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Required to prevent escalations to root. allowPrivilegeEscalation: false runAsUser: # Require the container to run without root privileges. rule: 'MustRunAsNonRoot'</code> </pre> <br>  لا يمكن للحاويات التي لا تستخدم الجذر أن تشغل المنافذ ذات الامتيازات ، أي  حتى 1024 (الإمكانية المقابلة في نواة Linux - <code>CAP_NET_BIND_SERVICE</code> مسؤولة عن ذلك) ، ومع ذلك ، فإن استخدام <i>الخدمات</i> يساعد على التحايل على هذا القيد.  في ما يلي مثال لتطبيق MyApp ، الذي يشغل المنفذ 8443 في الحاوية ، لكن <i>الخدمة</i> تجعله متاحًا على المنفذ 443 ، طلبات <code>targetPort</code> لـ <code>targetPort</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kind: Service apiVersion: v1 metadata: name: my-service spec: selector: app: MyApp ports: - protocol: TCP port: 443 targetPort: 8443</code> </pre> <br>  ستظل الحاجة إلى تشغيل أحمال العمل بدون استخدام الجذر حتى يتم تضمين مساحة اسم المستخدم أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">وقت التشغيل</a> لإطلاق حاويات بدون جذر في وقت تشغيل الحاوية. <br><br><h3 style=";text-align:right;direction:rtl">  9. استخدام سياسات الشبكة </h3><br>  <b>بشكل افتراضي ، تسمح شبكة Kubernetes لجميع حركة المرور بين القرون.</b>  <b>يمكن تقييد هذا الإعداد من خلال سياسة الشبكة - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><i>NetworkPolicy</i></a> .</b> <br><br><img src="https://habrastorage.org/webt/kd/cv/xu/kdcvxufrkq2dm0jw13vk8hvowae.png"><br><br>  تقتصر الخدمات التقليدية على جدران الحماية باستخدام عناوين IP الثابتة ونطاقات المنافذ لكل خدمة.  نظرًا لأن عناوين IP هذه تتغير نادرًا جدًا ، فقد تم استخدامها تاريخيًا كشكل من أشكال المصادقة.  نادرًا ما تحتوي الحاويات على عناوين IP ثابتة - تشير طبيعتها إلى إمكانية السقوط السريع وإعادة الإنشاء ، حيث يتم استخدام اكتشاف الخدمة بدلاً من عناوين IP الثابتة.  تعقد هذه الميزات بشكل كبير التكوين والتحقق من جدران الحماية. <br><br>  نظرًا لأن Kubernetes يخزن جميع البيانات حول حالة النظام في etcd ، فمن الممكن تكوين جدار حماية ديناميكي - إذا كان هناك الدعم اللازم في المكون الإضافي لشبكة CNI.  Calico و Cilium و kube-router و Romana و Weave Net - تدعم جميع هذه المكونات الإضافية سياسات الشبكة. <br><br>  من المهم أن نلاحظ أن السياسات تعمل على مبدأ الفشل المغلق ، أي أن غياب <code>podSelector</code> هنا بشكل افتراضي يساوي جميع القيم الممكنة (حرف البدل): <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: default-deny spec: podSelector:</code> </pre> <br>  فيما يلي مثال على <i>NetworkPolicy</i> ، الذي يمنع كل شيء من الخروج باستثناء UDP 53 (DNS) ، والذي يمنع أيضًا الاتصالات الواردة للتطبيق.  سياسات <i>الشبكة</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هي</a> سياسات <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">رسمية</a> ، لذلك سيستمر التطبيق في تلقي ردود على الاتصالات الصادرة. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: myapp-deny-external-egress spec: podSelector: matchLabels: app: myapp policyTypes: - Egress egress: - ports: - port: 53 protocol: UDP - to: - namespaceSelector: {}</code> </pre> <br>  لا يمكن تطبيق سياسات شبكة Kubernetes على أسماء DNS.  والسبب هو أن DNS يدعم خاصية التوجيه المستدير لعناوين IP متعددة واستجابات ديناميكية تعتمد على الوصول إلى IP ، لذلك تنطبق سياسات الشبكة فقط على عناوين IP الثابتة أو <code>podSelector</code> (لعناوين IP الديناميكية Kubernetes). <br><br>  أفضل الممارسات هي البدء بحظر جميع حركة المرور لمساحة الاسم وخطوة خطوة بخطوة بإضافة المسارات التي يتطلبها التطبيق لاجتياز اختبار القبول.  يمكن أن تكون العملية صعبة ، لذلك طورت ControlPlane <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">netassert</a> ، وهي أداة لاختبار أمان الشبكة في نصوص DevSecOps ذات nmap متوازية للغاية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">k8s: # used for Kubernetes pods deployment: # only deployments currently supported test-frontend: # pod name, defaults to `default` namespace test-microservice: 80 # `test-microservice` is the DNS name of the target service test-database: -80 # `test-frontend` should not be able to access test-database's port 80 169.254.169.254: -80, -443 # AWS metadata API metadata.google.internal: -80, -443 # GCP metadata API new-namespace:test-microservice: # `new-namespace` is the namespace name test-database.new-namespace: 80 # longer DNS names can be used for other namespaces test-frontend.default: 80 169.254.169.254: -80, -443 # AWS metadata API metadata.google.internal: -80, -443 # GCP metadata API</code> </pre> <br>  تُعد واجهة برمجة التطبيقات التي تحتوي على بيانات وصفية من موفر السحابة مصدرًا ثابتًا للتصعيد المحتمل ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">كما هو موضح في مكافأة الأخطاء</a> الأخيرة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">من Shopify</a> ) ، لذا فإن الاختبارات الخاصة التي تؤكد حظر واجهة برمجة التطبيقات على شبكة الحاويات ستساعد في الحماية من أخطاء التكوين. <br><br><h3 style=";text-align:right;direction:rtl">  10. مسح الصور وتشغيل IDS </h3><br>  <b>خوادم الويب هي نقطة انطلاق لمهاجمة الشبكات التي ترتبط بها.</b>  <b>يتيح لك فحص الملفات المثبتة في الصور التحقق من عدم وجود ثغرات معروفة يمكن للمهاجم استخدامها للوصول إلى الحاوية عن بُعد.</b>  <b>تسجل أنظمة كشف التسلل (IDS) هذه الأحداث إذا حدثت.</b> <br><br>  تسمح Kubernetes بالإرسال إلى المجموعة من خلال مجموعة من فحوصات التحكم (في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">وحدة التحكم</a> في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">القبول</a> ) ، والتي لا تنطبق فقط على القرون ، ولكن أيضًا على الموارد الأخرى مثل عمليات <i>النشر</i> .  فيها ، يمكن التحقق من صحة كل قسم فرعي للقبول أو يمكن تغيير محتوياته ، بالإضافة إلى دعم عمليات الرد على الويب على الجانب الخلفي الآن. <br><br><img src="https://habrastorage.org/webt/0s/-h/fw/0s-hfwbv4xf-izil5ljtxjxdyjm.png"><br><br>  يمكن استخدام أدوات التتبع عبر الويب هذه بواسطة أدوات مسح صورة الحاوية للتحقق من الصور قبل نشرها في المجموعة.  لن تتلقى الصور التي تفشل في التحقق موافقة وحدة التحكم. <br><br>  يساعد فحص صور الحاوية بحثًا عن الثغرات الأمنية المعروفة على تقليل الوقت الذي يمكن للمهاجم من خلاله الاستفادة من CVE المفتوح.  لمنع نشر الصور مع نقاط الضعف الحرجة في خط أنابيب النشر ، يمكنك استخدام أدوات مساعدة مجانية مثل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Clair</a> من CoreOS و <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Micro Scanner</a> من Aqua. <br><br>  تسمح لك أدوات مثل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Grafeas</a> بتخزين البيانات الوصفية للصور للتحقق المستمر من الامتثال والتحقق من الثغرات باستخدام توقيع حاوية فريد (أو تجزئة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">معالجة المحتوى</a> الخاصة).  مسح صورة حاوية باستخدام هذا التجزئة هو بمثابة مسح للصور المنشورة في الإنتاج ويمكن إجراؤه بشكل مستمر دون الحاجة إلى الوصول إلى بيئات الإنتاج. <br><br>  ستكون ثغرات يوم 0 غير معروفة موجودة دائمًا ، لذلك يجب على Kubernetes نشر نظام كشف التسلل مثل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Twistlock</a> أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Aqua</a> أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Sysdig Secure</a> .  يكشف IDS عن سلوك غير عادي في الحاوية ويوقفها أو يقتلها.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Sysdig's Falco</a> هو محرك قاعدة مفتوح المصدر ونقطة انطلاق لهذا النظام البيئي. <br><br><h2 style=";text-align:right;direction:rtl">  الجزء الثالث: المستقبل </h2><br>  يبدو أن المرحلة التالية من الأمن في "التطور الأصلي السحابي" هي شبكة الخدمة ، على الرغم من أن اعتمادها لن يحدث على الفور: يتطلب هذا الترحيل تحويل تعقيد التطبيقات إلى البنية التحتية للشبكة ، ويتعين على المنظمات تحقيق هذه أفضل الممارسات. <br><br><img src="https://habrastorage.org/webt/rm/qu/_m/rmqu_mfve6uvnnlaidl_bkjutqm.png"><br><br><h3 style=";text-align:right;direction:rtl">  11. إطلاق شبكة الخدمة </h3><br>  <b>شبكة الخدمة عبارة عن شبكة من الاتصالات المشفرة المستمرة التي يتم إجراؤها بين "متصلين جانبيًا" <i>(على غرار "sidecar")</i> ، وخوادم بروكسي عالية الأداء مثل Envoy و Linkerd.</b>  <b>فهو يوفر إدارة المرور والمراقبة والسياسات - كل ذلك دون تغيير في الخدمات الدقيقة.</b> <br><br>  كان نقل الأمان والرمز المرتبط بالشبكة من الخدمات المصغرة إلى مجموعة مكتبة مشتركة تم اختبارها في المعركة ممكنًا بالفعل مع <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Linkerd</a> ، وقدّم ظهور <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Istio</a> من Google و IBM و Lyft بديلاً لهذه المساحة.  مع إضافة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SPIFFE</a> لهوية التشفير لكل جراب والعديد من الميزات الأخرى ، يمكن لـ Istio تبسيط نشر أمان الشبكة من الجيل التالي. <br><br>  في شبكات "الثقة صفر" ، قد لا تكون هناك حاجة لجدار حماية تقليدي أو سياسات شبكة Kubernetes ، حيث يحدث كل تفاعل باستخدام mTLS (TLS المتبادل) ، والذي لا يضمن فقط أمان التفاعل ، ولكنه يؤكد أيضًا هوية كلتا الخدمتين . <br><br>  لن يكون هذا التحول من أساليب الشبكات التقليدية إلى مبادئ الأمان في Cloud Native أمرًا سهلاً لمن لديهم عقلية أمنية تقليدية.  كمقدمة لهذا العالم الجديد ، نوصي بشدة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">بكتاب Zero Trust Networking</a> للكاتب <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Evan Gilman</a> من SPIFFE. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">يتوفر Istio 0.8 LTS</a> حاليًا ، ويقترب المشروع بسرعة من إصدار 1.0.  يتم تنفيذ إصدار المشروع من حيث الاستقرار بشكل مشابه لنموذج Kubernetes: نواة مستقرة مع واجهات برمجة تطبيقات منفصلة يشار إليها بحالة ألفا أو بيتا باستخدام مساحات الأسماء.  نتوقع رؤية Istio تتوسع في الأشهر القادمة. <br><br><h2 style=";text-align:right;direction:rtl">  الخلاصة </h2><br>  تحتوي تطبيقات Cloud Native على مجموعة أكثر تفصيلاً من بدائل الأمان خفيفة الوزن التي تساعد على حماية أعباء العمل والبنية التحتية.  إن قوة ومرونة هذه الأدوات هي نعمة ونقمة على حد سواء: بدون أتمتة كافية [لاستخدامها] ، أصبح كشف التطبيقات غير الآمنة التي تسمح لها بتجاوز الحاوية أو أصبح نموذج عزلها أسهل. <br><br>  يمكن الوصول إلى الأدوات المساعدة للحماية أكثر من أي وقت مضى ، ومع ذلك ، للحد من احتمال الهجوم واحتمال التكوينات غير الصحيحة ، يجب عليك استخدامها بحذر. <br><br>  إذا أدى الأمن إلى إبطاء سرعة المؤسسة في إحداث التغيير ، فلن تكون الأولوية على الإطلاق.  يسمح استخدام مبادئ التسليم المستمر فيما يتعلق بسلسلة توريد البرامج للمؤسسة بتحقيق الامتثال التنظيمي والتدقيق المستمر والإدارة المحسنة دون التأثير على أداء الأعمال. <br><br>  يعد التحسين الأمني ​​السريع والمتزايد أسهل طريقة باستخدام مجموعة اختبار شاملة.    Continuous Security —          pipeline', ,    ,     . <br><br><h2 style=";text-align:right;direction:rtl">  ملاحظة من المترجم </h2><br>  اقرأ أيضا في مدونتنا: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">OPA  SPIFFE —     CNCF    </a> »; </li><li style=";text-align:right;direction:rtl"> « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Vulnerable Docker VM — -  Docker  pentesting</a> »; </li><li style=";text-align:right;direction:rtl"> « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  service mesh      [    ]?</a>  "؛ </li><li style=";text-align:right;direction:rtl"> « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Conduit —  service mesh  Kubernetes</a> »; </li><li style=";text-align:right;direction:rtl"> « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">      Kubernetes</a> »; </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">البنية التحتية مع Kubernetes كخدمة بأسعار معقولة</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar417905/">https://habr.com/ru/post/ar417905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar417895/index.html">إصلاح الطابعات ثلاثية الأبعاد وأدوات الآلات: كيف تعمل خدمة Top 3D Shop في موسكو وسان بطرسبرغ</a></li>
<li><a href="../ar417897/index.html">ملخص PHP رقم 135 (9-23 يوليو 2018)</a></li>
<li><a href="../ar417899/index.html">البحث عن عقد تباين التحكم (كيفية التوقف عن القيام بعمل غبي ونقله إلى آخر)</a></li>
<li><a href="../ar417901/index.html">كيف بدأنا في عقد اجتماعات طويلة رائعة ، ولماذا لم يعد هذا شرًا عالميًا</a></li>
<li><a href="../ar417903/index.html">مراجعة حالة التعليمات البرمجية 1</a></li>
<li><a href="../ar417909/index.html">لماذا تحتاج Splunk؟ تحليلات التطبيق</a></li>
<li><a href="../ar417911/index.html">التصميم المستمر في التنمية: المنهجية والمبدأ</a></li>
<li><a href="../ar417913/index.html">تحسين عرض مشهد من كارتون ديزني "Moana". الجزء 3</a></li>
<li><a href="../ar417915/index.html">كيف تلعب زميل الغرفة</a></li>
<li><a href="../ar417917/index.html">ASC'18: المثابرة والتدريب المنتظم كوسيلة لتحقيق الهدف</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>