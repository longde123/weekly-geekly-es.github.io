<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСФ ЁЯЩОЁЯП╗ ЁЯСг рдХрдореНрдкрд╛рдЗрд▓рд░ рдЬрд╛рдУ: SSA рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реЗрд╢рди рд░реВрд▓реНрд╕ рдбрд┐рдЯреЗрд▓реНрд╕ рд▓реИрдВрдЧреНрд╡реЗрдЬ ЁЯд╝ ЁЯФЪ ЁЯжИ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="gc рдХрдВрдкрд╛рдЗрд▓рд░ рд╕реНрдЯреЗрдЯрд┐рдХ рд╕рд┐рдВрдЧрд▓ рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ (рдПрд╕рдПрд╕рдП) рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдореЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рд▓рд┐рд╕реНрдк рдЬреИрд╕реА рдСрдмреНрдЬреЗрдХреНрдЯ-рдУрд░рд┐рдПрдВрдЯреЗрдб рднрд╛рд╖рд╛ ( рдбреАрдПрд╕рдПрд▓ ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдХрдореНрдкрд╛рдЗрд▓рд░ рдЬрд╛рдУ: SSA рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реЗрд╢рди рд░реВрд▓реНрд╕ рдбрд┐рдЯреЗрд▓реНрд╕ рд▓реИрдВрдЧреНрд╡реЗрдЬ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415771/"><p><img src="https://habrastorage.org/webt/0b/vq/ua/0bvquazri632jnibzwkywt7hfim.png"></p><br><p> <code>gc</code> рдХрдВрдкрд╛рдЗрд▓рд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрдЯреЗрдЯрд┐рдХ рд╕рд┐рдВрдЧрд▓ рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ</a> (рдПрд╕рдПрд╕рдП) рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдореЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рд▓рд┐рд╕реНрдк рдЬреИрд╕реА рдСрдмреНрдЬреЗрдХреНрдЯ-рдУрд░рд┐рдПрдВрдЯреЗрдб рднрд╛рд╖рд╛ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбреАрдПрд╕рдПрд▓</a> ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдореИрдВ рдЗрд╕ рднрд╛рд╖рд╛ рдХреЗ рдореБрдЦреНрдп рддрддреНрд╡реЛрдВ, рдЗрд╕рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдФрд░ рд╕реАрдорд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рд╕реНрддрд╛рд╡ рдХрд░рддрд╛ рд╣реВрдВред <br>  рдПрдХ рдЕрднреНрдпрд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдЗрдП рдЧреЛ рдХрдВрдкрд╛рдЗрд▓рд░ рдХреЛ рдПрдХ рдирд┐рд░реНрджреЗрд╢ рдХреА рдкреАрдврд╝реА рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ, рдЬреЛ рдкрд╣рд▓реЗ рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рд╣реБрдЖ рдерд╛, рдЬреЛ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЛ <code>a*b+c</code> рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдпрд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧреЛ рдПрд╕рдПрд╕рдП рд╕рдВрдХрд▓рдХ рдмреИрдХрдПрдВрдб</a> рдХреЗ рдЖрдВрддрд░рд┐рдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд╛ рдкрд╣рд▓рд╛ рд▓реЗрдЦ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдирд┐рдпрдореЛрдВ рдХреЗ рдбреАрдПрд╕рдПрд▓ рд╡рд┐рд╡рд░рдг рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдЕрдкрдиреЗ рдЕрдЧрд▓реЗ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЖрдзрд╛рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдмрдВрдзрд┐рдд рдШрдЯрдХреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗред </p><a name="habracut"></a><br><h1 id="vvedenie">  рдкрд░рд┐рдЪрдп </h1><br><p>  рдРрдиреНрдЯреЗрдиреЗрдЯреЗрдб рдПрдПрд╕рдЯреА рд╕реЗ рдПрд╕рдПрд╕рдП рджреГрд╢реНрдп рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд╕рдордп рдлреНрд░рдВрдЯрдПрдВрдб рдЧреЛ рдХрдВрдкрд╛рдЗрд▓рд░ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред  рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдХрд╛рд░реНрдп <a href="">cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / gc / ssa.go.</a> рдореЗрдВ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдПрд╕рдПрд╕рдП рдмреИрдХрдПрдВрдб рдХрд╛ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ <code>ssa.Compile</code> рдлрд╝рдВрдХреНрд╢рди рд╣реИ, рдЬрд┐рд╕реЗ <a href="">cmd / compile / рдЖрдВрддрд░рд┐рдХ / ssa / compile.go</a> рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рд╢рдмреНрджрд╛рд╡рд▓реА</b> <div class="spoiler_text"><table><thead><tr><th>  рдПрди </th><th>  рдЖрд░рдпреВ </th><th>  рдореВрд▓реНрдп </th></tr></thead><tbody><tr><td>  рд╕рдВрдХрд▓рдХ рд╕рд╛рдордиреЗ </td><td>  рд╕рдВрдХрд▓рдХ рд╕рд╛рдордиреЗ </td><td>  рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдФрд░ рд▓реЗрдХреНрд╕рд┐рдХрд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдХрднреА-рдХрднреА рдЯрд╛рдЗрдк рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди, рдордзреНрдпрд╡рд░реНрддреА рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╕реНрд░реЛрдд рдХреЛрдб рдХреЗ рдХрд░реАрдм рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рдХреБрдЫ рдПрдиреЛрдЯреЗрдЯ рдПрдПрд╕рдЯреАред </td></tr><tr><td>  рд╕рдВрдХрд▓рдХ рдмреИрдХрдПрдВрдб </td><td>  рд╕рдВрдХрд▓рдХ рдмреИрдХрдПрдВрдб </td><td>  рдирд┐рдЪрд▓реЗ рд╕реНрддрд░ рдХреЗ рдЕрдиреБрдХреВрд▓рди рдФрд░ рдордзреНрдпрд╡рд░реНрддреА рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡, рдХреЛрдб рдкреАрдврд╝реАред </td></tr><tr><td>  рдкреНрд░рдкрддреНрд░ </td><td>  рдЖрдХрд╛рд░ </td><td>  рд╢рдмреНрдж "рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐" (рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐) рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рдПрдХ рдкрд░реНрдпрд╛рдпрд╡рд╛рдЪреАред  рдЖрдорддреМрд░ рдкрд░ рд▓рд┐рд╕реНрдк рдореЗрдВ, <code>form</code> рдкреНрд░реЛрдЧреНрд░рд╛рдо рддрддреНрд╡ рдХрд╛ рдирд╛рдо рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ рд╣реИ, рдпрд╣ рдПрдХ рд╕реВрдЪреА рдпрд╛ рдПрдХ рдкрд░рдорд╛рдгреБ рд╣реЛред </td></tr><tr><td>  рдЕрдиреБрдХреВрд▓рди рдкрд╛рд╕ </td><td>  рдЕрдиреБрдХреВрд▓рди рдЪрд░рдг </td><td>  рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рдкрд░ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрдиред  "рдкрд╛рд╕" рд╢рдмреНрдж рдХреБрдЫ рдЕрд╕реНрдкрд╖реНрдЯ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдЪрд░рдг рдХрдИ рдкрд╛рд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ / рдпрд╛ рдПрдХ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЕрдиреНрдп рдЪрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдо рд╣реИред </td></tr></tbody></table><br><p>  рдпрджрд┐, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рд▓реЗрдЦ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрдврд╝рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдПрдХ рд╢рдмреНрдж рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдордЭ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИ, рдпрд╣ рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд╛рдпрдХ рд╣реИ, рдЗрд╕реЗ рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p></div></div><br><p>  рдПрд╕рдПрд╕рдП рдЧреЛ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝рд░ рдореЗрдВ рдХрдИ рдЪрд░рдг рд╣реЛрддреЗ рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрдХрд▓рд┐рдд рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдЧреБрдЬрд░рддрд╛ рд╣реИред  рдХреБрдЫ рдЪрд░рдг рддрдерд╛рдХрдерд┐рдд "рдкреБрдирд░реНрд▓реЗрдЦрди рдирд┐рдпрдо" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рдПрд╕рдПрд╕рдП рдЕрдиреБрдХреНрд░рдо рдХреЛ рджреВрд╕рд░реЗ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо, рд╕рдВрднрд╡рддрдГ рдЕрдзрд┐рдХ рдЗрд╖реНрдЯрддрдоред </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрд╕-рдПрдХреНрд╕рдкреНрд░реЗрд╢рди</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░рд┐рд╡рд░реНрддрди рдирд┐рдпрдореЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЗрди рднрд╛рд╡реЛрдВ рдХреЗ рддрддреНрд╡ <a href="">ssa.Value рд╣реИрдВ</a> ред  рд╕рдмрд╕реЗ рд╕рд░рд▓ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпреЗ рдирд┐рдпрдо рдЖрдкрдХреЛ рдПрдХ <code>ssa.Value</code> рдХреЛ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рдХреЛрдб 8-рдмрд┐рдЯ рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЗ рдЧреБрдгрди рдХреЛ рдврд╣рддрд╛ рд╣реИ: </p><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">Mul8</span></span> (<span class="hljs-name"><span class="hljs-name">Const8</span></span> [c]) (<span class="hljs-name"><span class="hljs-name">Const8</span></span> [d])) -&gt; (<span class="hljs-name"><span class="hljs-name">Const8</span></span> [int64(<span class="hljs-name"><span class="hljs-name">int8</span></span>(<span class="hljs-name"><span class="hljs-name">c*d</span></span>))])</code> </pre> <br><p>  SSA рдорд╛рдиреЛрдВ рдХреА рджреЛ рдореБрдЦреНрдп рд╢реНрд░реЗрдгрд┐рдпрд╛рдВ рд╣реИрдВ: рдЙрдЪреНрдЪ-рд╕реНрддрд░, рд▓рдХреНрд╖реНрдп рдорд╢реАрди рд╕реЗ рд▓рдЧрднрдЧ рд╕реНрд╡рддрдВрддреНрд░, рдФрд░ рдЬреЛ рдХрд┐ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╣реИрдВ (рдЖрдорддреМрд░ рдкрд░ 1-in-1 рдорд╢реАрди рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдореИрдк рдХреА рдЬрд╛рддреА рд╣реИрдВ)ред </p><br><p>  рдЗрди рджреЛрдиреЛрдВ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЕрдиреБрдХреВрд▓рди рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдкрд╣рд▓реЗ, рд╕рднреА рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдФрд░ рд╕рд╛рдорд╛рдиреНрдп, рдлрд┐рд░ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо-рдЙрдиреНрдореБрдЦред </p><br><p>  рдирд┐рдпрдореЛрдВ рд╕реЗ рдЬреБрдбрд╝реЗ рд╕рднреА рдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / ssa / gen</a> рдореЗрдВ рдирд┐рд╣рд┐рдд рд╣реИрдВред  рд╣рдо рджреЛ рд╕реЗрдЯреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗ: </p><br><ol><li>  <a href="">genericOps.go</a> - рдорд╢реАрди-рд╕реНрд╡рддрдВрддреНрд░ рд╕рдВрдЪрд╛рд▓рдиред </li><li>  <a href="">AMD64Ops.go</a> - рд╕рдВрдЪрд╛рд▓рди <code>GOARCH=AMD64</code> (64-рдмрд┐рдЯ x86) рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╣реИред </li></ol><br><p>  рдЕрдореВрд░реНрдд рдорд╢реАрди рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрд╣рд▓реЗ рдХреБрдЫ рдЪрд░рдгреЛрдВ рдХреЗ рдмрд╛рдж, рддрдерд╛рдХрдерд┐рдд <code>genericOps</code> рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк <code>genericOps</code> рд╕реЗ <code>genericOps</code> рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИред  рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдпрд╣ <code>AMD64Ops</code> рд╣реЛрдЧрд╛ред  рдЗрд╕ рдмрд┐рдВрджреБ рдХреЗ рдмрд╛рдж, рд╕рднреА рдмрд╛рдж рдХреЗ рдЪрд░рдг рджреВрд╕рд░реА рд╢реНрд░реЗрдгреА рд╕реЗ рдкреНрд░рд╕реНрддреБрддрд┐ рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝рд░ рдХреЗ рдмрд╛рдж, рдПрдХ рдХреЛрдб рдЬрдирд░реЗрдЯрд░ рдЦреЗрд▓рдиреЗ рдореЗрдВ рдЖрддрд╛ рд╣реИред  AMD64 рдХреЗ рд▓рд┐рдП, рдХреЛрдб рдЬрдирд░реЗрд╢рди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкреИрдХреЗрдЬ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / amd64</a> рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдХреЛрдб рдЬрдирд░реЗрдЯрд░ рдХрд╛ рдХрд╛рд░реНрдп <code>ssa.Block</code> рдФрд░ <code>ssa.Value</code> рдХреЛ рдЕрдиреБрдХреНрд░рдо <a href="">obj</a> рд╕реЗ рдмрджрд▓рдирд╛ рд╣реИред  рдЕрд╕реЗрдВрдмрд▓рд░ рдорд╢реАрди рдХреЛрдб рдПрдХрддреНрд░ рдХрд░реЗрдЧрд╛, рдЬреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд┐рдВрдХ</a> рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрдЧрд╛ред </p><br><h1 id="pravila-optimizaciy">  рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдо </h1><br><p>  рдпрджрд┐ рдСрдкрд░реЗрд╢рди рдкрд░рд┐рднрд╛рд╖рд╛ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ " <code>${ARCH}Ops.go</code> " рдирд╛рдо рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдореЛрдВ рдХреЛ " <code>${ARCH}.Rules</code> " рдореЗрдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред </p><br><p>  рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдирд┐рдпрдо рд╕рд░рд▓ рд░реВрдкрд╛рдВрддрд░рдг рдХрд░рддреЗ рд╣реИрдВ, рдЕрдзрд┐рдХрд╛рдВрд╢ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд┐рд░рдВрддрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ</a> рдХреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рддрд╣</a> , рд╕рд╛рде рд╣реА рд╕рд╛рде рдХреБрдЫ рдкрд░рд┐рд╡рд░реНрддрди рдЬреЛ рдмрд╛рдж рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддреЗ рд╣реИрдВред </p><br><p>  рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдирд┐рдпрдореЛрдВ рд╡рд╛рд▓реА рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рджреЛ рднрд╛рдЧ рд╣реЛрддреЗ рд╣реИрдВ: </p><br><ol><li>  рдХрдо рдХрд░рдирд╛ - рдорд╢реАрди рд╕рдордХрдХреНрд╖реЛрдВ рдХреЗ рд╕рд╛рде рдЕрдореВрд░реНрдд рд╕рдВрдЪрд╛рд▓рди рдХреА рдЬрдЧрд╣ред </li><li>  рдЕрдиреБрдХреВрд▓рди рд╕реНрд╡рдпрдВред </li></ol><br><p>  рдПрдХ рдорд╢реАрди рдореЗрдВ рдПрдХ рдСрдкрд░реЗрд╢рди рдХреЛ рдХрдо рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">Const32</span></span> [val]) -&gt; (<span class="hljs-name"><span class="hljs-name">MOVLconst</span></span> [val]) // L - long, <span class="hljs-number"><span class="hljs-number">32</span></span>- (<span class="hljs-name"><span class="hljs-name">Const64</span></span> [val]) -&gt; (<span class="hljs-name"><span class="hljs-name">MOVQconst</span></span> [val]) // Q - quad, <span class="hljs-number"><span class="hljs-number">64</span></span>- | | generic op | AMD64 op</code> </pre> <br><p>  рдпрд╣ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реЗрд╢рди рдореЗрдВ рд╣реИ рдХрд┐ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реЗрд╢рди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдВрдЪрд╛рд▓рди рдХреА рд▓рд╛рдЧрдд</a> рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрдо рдХрд░рдирд╛</a> , рдкреНрд░реЛрд╕реЗрд╕рд░ рдореЗрдВ рдЙрдкрд▓рдмреНрдз <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореЗрдореЛрд░реА рдПрдбреНрд░реЗрд╕рд┐рдВрдЧ рдореЛрдб</a> рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдПрдореНрдмреЗрдб рдХрд░рдирд╛ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред </p><br><p>  рдСрдкрд░реЗрд╢рдиреНрд╕ рдореЗрдВ рдПрдХ рдПрдордиреЛрдореЛрдирд┐рдХ рдирд╛рдо рд╣реИ, рдЬрд┐рд╕реЗ рдЖрдорддреМрд░ рдкрд░ рдПрдХ рдУрдкрдХреЛрдб рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддреБрдХрд▓рд╛-рдирд┐рд░реНрднрд░ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдСрдкрдХреЛрдб рдЖрдорддреМрд░ рдкрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдирд╛рдореЛрдВ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред </p><br><h1 id="sintaksis-yazyka-opisaniya-pravil">  рдирд┐рдпрдо рд╡рд┐рд╡рд░рдг рднрд╛рд╖рд╛ рд╕рд┐рдВрдЯреЗрдХреНрд╕ </h1><br><p>  рдореВрд▓ рд╡реНрдпрд╛рдХрд░рдг <a href="">рдирд┐рдпрдо</a> рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╣реИред </p><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// rule syntax: // sexpr [&amp;&amp; extra conditions] -&gt; [@block] sexpr // // sexpr are s-expressions (lisp-like parenthesized groupings) // sexpr ::= [variable:](opcode sexpr*) // | variable // | &lt;type&gt; // | [auxint] // | {aux} // // aux ::= variable | {code} // type ::= variable | {code} // variable ::= some token // opcode ::= one of the opcodes from the *Ops.go files</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдирд┐рдкреЗрдЯ рдЕрдиреБрд╡рд╛рдж рдКрдкрд░</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//  : // sexpr [&amp;&amp;  ] -&gt; [@block] sexpr // // sexpr -  S- (   ) // sexpr ::= [variable:](opcode sexpr*) // | variable // | &lt;type&gt; // | [auxint] // | {aux} // // aux ::= variable | {code} // type ::= variable | {code} // variable ::= Go  ( ) // opcode ::=   *Ops.go </span></span></code> </pre> <br></div></div><br><p>  рдпрд╣ рднреА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ " <code>//</code> " рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рдЕрдВрджрд░ <code>.Rules</code> рдлрд╝рд╛рдЗрд▓реЗрдВред </p><br><p>  рдЖрдЗрдП рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ рдЬрд┐рд╕рдореЗрдВ рдпреЗ рд╕рднреА рддрддреНрд╡ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: </p><br><pre> <code class="lisp hljs"> Opcode=ADDLconst -    <span class="hljs-number"><span class="hljs-number">32</span></span>-  : AuxInt=c - ,    `x` : : (<span class="hljs-name"><span class="hljs-name">ADDLconst</span></span> [c] x) &amp;&amp; int32(<span class="hljs-name"><span class="hljs-name">c</span></span>)==0 -&gt; x | / | / | | / | / | | / | /    | /   ( `<span class="hljs-symbol"><span class="hljs-symbol">&amp;&amp;</span></span>`    ) ,    </code> </pre> <br><blockquote>  рдпреЗ рд╕рднреА рд╡реНрдпрд╛рдЦреНрдпрд╛рддреНрдордХ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╡реИрдз рдирд┐рдпрдо рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд╣реАрдВ рд╣реИрдВред </blockquote><p>  рдпрд╣ рдирд┐рдпрдо <code>x+0</code> рдХреЛ <code>x</code> рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╢рд░реНрддреЛрдВ рдЕрдиреБрднрд╛рдЧ рдХреЗ рдЕрдВрджрд░ рд╕рдм рдХреБрдЫ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЧреЛ рдХреЛрдб рд╣реИ, <br>  рдЬрдм рддрдХ рднрд╛рд╡реЛрдВ рддрдХ рд╕реАрдорд┐рдд рдирд╣реАрдВ, рдЬрд┐рд╕рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдПрдХ <code>bool</code> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br>  рдЖрдк <a href="">rewrite.go</a> рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╡рд┐рдзреЗрдп рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд╕рд╛рдорд╛рдиреНрдп рдСрдкрдХреЛрдб рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдВрдпреЛрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрдИ рдирд┐рдпрдореЛрдВ рдХреЛ рдЬрдиреНрдо рджреЗрддрд╛ рд╣реИ: </p><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ADD</span></span>(<span class="hljs-name"><span class="hljs-name">Q</span></span><span class="hljs-name"><span class="hljs-name">|L)const [off] x:(SP)) -&gt; (LEA(Q|</span></span><span class="hljs-name"><span class="hljs-name">L</span></span>) [off] x) //  Q|L alternation: (<span class="hljs-name"><span class="hljs-name">ADDQconst</span></span> [off] x:(<span class="hljs-name"><span class="hljs-name">SP</span></span>)) -&gt; (<span class="hljs-name"><span class="hljs-name">LEAQ</span></span> [off] x) (<span class="hljs-name"><span class="hljs-name">ADDLconst</span></span> [off] x:(<span class="hljs-name"><span class="hljs-name">SP</span></span>)) -&gt; (<span class="hljs-name"><span class="hljs-name">LEAL</span></span> [off] x) //    `x`: (<span class="hljs-name"><span class="hljs-name">ADDQconst</span></span> [off] (<span class="hljs-name"><span class="hljs-name">SP</span></span>)) -&gt; (<span class="hljs-name"><span class="hljs-name">LEAQ</span></span> [off] (<span class="hljs-name"><span class="hljs-name">SP</span></span>)) (<span class="hljs-name"><span class="hljs-name">ADDLconst</span></span> [off] (<span class="hljs-name"><span class="hljs-name">SP</span></span>)) -&gt; (<span class="hljs-name"><span class="hljs-name">LEAL</span></span> [off] (<span class="hljs-name"><span class="hljs-name">SP</span></span>))</code> </pre> <br><blockquote>  <code>(SP)</code> рдЬреЗрдиреЗрд░рд┐рдХрдСрдкреНрд╕.рдУрдЧреЛ рдореЗрдВ рд╕реЗ рдПрдХ рдСрдкрд░реЗрд╢рди рд╣реИ рдФрд░ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕реНрдЯреИрдХ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░ рд▓реЛрдб рдХрд░рдиреЗ рдХреЛ рд╡реНрдпрдХреНрдд рдХрд░рддрд╛ рд╣реИред  рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдЬрд╣рд╛рдВ рдХреЛрдИ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ <code>SP</code> , рдЗрд╕рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </blockquote><p>  рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдореЗрдВ рд╡реИрд░рд┐рдПрдмрд▓ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ (S- рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдХреЗ рдмрд╛рдИрдВ рдУрд░ <code>-&gt;</code> ): </p><br><ul><li>  рдЪрд░, рдЬреИрд╕реЗ <code>x</code> , рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдмрд┐рдирд╛ <code>:</code> рдХреБрдЫ рднреА рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ </li><li>  рдПрдХ рдирд┐рдпрдорд┐рдд рдЪрд░ рдХреА рддрд░рд╣, <code>_</code> рдХрд┐рд╕реА рднреА рдореВрд▓реНрдп рдХреЛ рдкрдХрдбрд╝рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </li></ul><br><pre> <code class="lisp hljs">//       :    ADDQconst, //          : (<span class="hljs-name"><span class="hljs-name">ADDQconst</span></span> _) -&gt; v (<span class="hljs-name"><span class="hljs-name">ADDQconst</span></span> x) -&gt; (<span class="hljs-name"><span class="hljs-name">ADDQconst</span></span> x)</code> </pre> <br><p>  рдпрджрд┐ <code>AuxInt</code> рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рд╣реИ (рд╡рд░реНрдЧ рдХреЛрд╖реНрдардХреЛрдВ рдореЗрдВ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐), рддреЛ рдирд┐рдпрдо рдХрд┐рд╕реА рднреА <code>AuxInt</code> рдорд╛рди рдкрд░ рдлрд╛рдпрд░ рдХрд░реЗрдЧрд╛ред  рдЗрд╕реА рддрд░рд╣ рд╕реЗ <code>{}</code> -рдкреИрд░рд╛рдореАрдЯрд░ (рдиреАрдЪреЗ рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ)ред </p><br><p>  рдирд╛рдо <code>v</code> рдЕрд░реНрде рд╣реИ рд╕рдмрд╕реЗ рдмрд╛рд╣рд░реА рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд░реВрдкред <br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ <code>(ADDQconst (SUBQconst x))</code> рдмрд╛рд╣рд░реА рд░реВрдк <code>ADDQconst</code> ред </p><br><p>  рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдИ рдмрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд╕реЗ рдЖрдкрдХреЛ рдПрд╕-рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдХреЗ рдХрдИ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЛ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: </p><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ADDQconst</span></span> [v] (<span class="hljs-name"><span class="hljs-name">ADDQconst</span></span> [v] x)) // , ,  <span class="hljs-string"><span class="hljs-string">"x+2+2"</span></span> (<span class="hljs-name"><span class="hljs-name">x+v+v</span></span>).</code> </pre> <br><h1 id="tipy-v-pravilah">  рдирд┐рдпрдореЛрдВ рдореЗрдВ рдкреНрд░рдХрд╛рд░ </h1><br><p>  рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдФрд░ / рдпрд╛ рдорд┐рд▓рд╛рди рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред <br>  рдкреНрд░рдХрд╛рд░ рдХреЛ "рддреНрд░рд┐рдХреЛрдгреАрдп рдХреЛрд╖реНрдардХ" рдореЗрдВ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, C ++ рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдореЗрдВ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ: </p><br><pre> <code class="lisp hljs">// typ.UInt32 -   BTSLconst. // BSFL    typ.UInt32,    //    . (<span class="hljs-name"><span class="hljs-name">Ctz16</span></span> x) -&gt; (<span class="hljs-name"><span class="hljs-name">BSFL</span></span> (<span class="hljs-name"><span class="hljs-name">BTSLconst</span></span> &lt;typ.UInt32&gt; [<span class="hljs-number"><span class="hljs-number">16</span></span>] x))</code> </pre> <br><p>  рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, "рд╡рд░реНрдг" рд╣реИрдВ (рдпрд╛, рдЕрдзрд┐рдХ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рд░реВрдк рд╕реЗ - <code>Aux</code> рдЧреБрдг)ред </p><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">StaticCall</span></span> [argsWidth] {target} mem) -&gt; (<span class="hljs-name"><span class="hljs-name">CALLstatic</span></span> [argsWidth] {target} mem)</code> </pre> <br><ul><li>  <code>[argsWidth]</code> - <code>Value.AuxInt</code>  <code>StaticCall</code> - рддрд░реНрдХреЛрдВ рдХрд╛ рдХреБрд▓ рдЖрдХрд╛рд░ рдкрд╛рд░рд┐рдд рд╣реБрдЖ </li><li>  <code>{target}</code> - <code>Value.Aux</code> ред  <code>StaticCall</code> - рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ </li><li>  <code>&lt;typ.UInt32&gt;</code> - <code>Value.Type</code> ред  рдорд╛рди рдкреНрд░рдХрд╛рд░ </li></ul><br><p>  <code>Aux</code> рдФрд░ <code>AuxInt</code> рд╢рдмреНрджрд╛рд░реНрде рдСрдкрд░реЗрд╢рди рд╕реЗ рдСрдкрд░реЗрд╢рди рддрдХ рдмрд╣реБрдд рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдкреНрд░рд▓реЗрдЦрди рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╕реНрд░реЛрдд <code>*Ops.go</code> рдлрд╛рдЗрд▓реЗрдВ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ opData opcode <code>opData</code> рдореЗрдВ рдПрдХ <code>aux</code> рдХреНрд╖реЗрддреНрд░ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЗрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдмрддрд╛рддрд╛ рд╣реИред </p><br><p>  рдкреНрд░рдХрд╛рд░ рдХреЗ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдкреИрдХреЗрдЬ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ</a> ред  рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдПрд╕рдПрд╕рдП рдмреИрдХрдПрдВрдб рдХреЗ рд▓рд┐рдП <code>types.TypeFlags</code> , рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП <code>types.TypeFlags</code> , рдмрд╛рдХреА <code>cmd/compile/internal/gc</code> рдФрд░ <code>types.TypeFlags</code> <code>cmd/compile/internal/gc</code> <code>types.TypeFlags</code> рдмреАрдЪ рдЖрдо рд╣реИрдВред </p><br><h1 id="osobye-tipy">  рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХрд╛рд░ рдХреЗ </h1><br><p>  рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХрд╛рд░ рдХреЗ рдкреНрд░рдХрд╛рд░ рд╣реИред <code>types.TypeMem</code> , рдЬреЛ рдПрдХ рд╣реА рдмрд╛рд░ рдореЗрдВ рдХрдИ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ: </p><br><ol><li>  рдЖрдкрдХреЛ рдореЗрдореЛрд░реА рдПрдХреНрд╕реЗрд╕ рдкреИрдЯрд░реНрди рджреНрд╡рд╛рд░рд╛ <code>ssa.Value</code> рдХреЛ рд╕реЙрд░реНрдЯ рдФрд░ рд╕рдореВрд╣ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдпрд╣ рдмреЗрд╕ рдмреНрд▓реЙрдХ (рдЙрдирдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдиреАрдЪреЗ) рдХреЗ рдврд╛рдВрдЪреЗ рдХреЗ рднреАрддрд░ рд╕рд╣реА рдирд┐рд╖реНрдкрд╛рджрди рдЖрджреЗрд╢ рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИред </li><li>  рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рдореЗрдореЛрд░реА рд╕реНрдЯреНрд░реАрдо рдХреА рд╕реНрдерд┐рддрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рдирд┐рд░реНрджреЗрд╢ рдореЗрдореЛрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдПрдХ рдирдпрд╛ SSA рдорд╛рди рдЯрд╛рдЗрдк рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рдСрдкрд░реЗрд╢рди рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдЯрд╛рдЗрдк <code>types.TypeMem</code> рдЬрд╛рдПрдЧрд╛ред </li></ol><br><p>  <code>OpPhi</code> рдХреЗ рд╡рд┐рд╢реЗрд╖ рдЕрд░реНрде рдХреА <code>OpPhi</code> , рдореЗрдореЛрд░реА рдХреЛ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝рд░ рдХреЗ рдХрдИ рдЪрд░рдгреЛрдВ рдореЗрдВ рдЕрд╕рд╛рдзрд╛рд░рдг рд░реВрдк рд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЬрд╛рддреА рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рдлреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛</b> <div class="spoiler_text"><p>  <code>Phi</code> рдХреА рдПрдХ рднреВрдорд┐рдХрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рдЪрд░рдг рджрд░ рдЪрд░рдг рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛрддреА рд╣реИред </p><br><p>  рд╕рдВрдХрд▓рдХ рдХреЗ рдПрд╕рдПрд╕рдП рдХрд╛рд░реНрдп рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ, <code>Phi</code> рдЕрдкрдиреЗ рдХреНрд▓рд╛рд╕рд┐рдХ рдЙрджреНрджреЗрд╢реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрди рдкрде рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдореВрд▓реНрдп рдХреА рдкрд╕рдВрдж рдХреЛ рд╡реНрдпрдХреНрдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рд╣рдореЗрдВ рдЗрд╕ рдореВрд▓реНрдп рддрдХ рдкрд╣реБрдВрдЪрд╛рдпрд╛ред </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдХрд┐рд╕реА рдмреНрд▓реЙрдХ рдореЗрдВ рджреЛ рдЬрдВрдк рд╣реИрдВ, рдФрд░ рджреЛрдиреЛрдВ рдореЗрдореЛрд░реА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЧрдВрддрд╡реНрдп рдмреНрд▓реЙрдХ рдХреЛ <code>(Phi mem1 mem2)</code> рдмрд░рд╛рдмрд░ рдореЗрдореЛрд░реА рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧреАред  рдЪрдХреНрд░ рднреА <code>Phi</code> рдорд╛рди рдХреЛ рдЦреАрдВрдЪрддреЗ рд╣реИрдВред </p></div></div><br><p>  рдПрдХ рдЕрдиреНрдп рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХрд╛рд░ <code>types.TypeFlags</code> рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИред  рдпрд╣ рдкреНрд░рдХрд╛рд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реАрдкреАрдпреВ рдЭрдВрдбреЗ</a> рдкреИрджрд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрджреЗрд╢ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, <code>ADDQ</code> рдЬреИрд╕реЗ рдирд┐рд░реНрджреЗрд╢, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡реЗ рдЭрдВрдбреЗ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред <code>types.Flags</code> , рд▓реЗрдХрд┐рди <code>clobberFlags</code> рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рд╣реЛрддреЗ рд╣реИрдВред </p><br><p>  <code>types.Flags</code> рдЙрдкрдпреЛрдЧ <code>CMPQ</code> рдЬреИрд╕реЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЙрдирдХреЗ рдХрд┐рд╕реА рднреА рд╕реНрдкрд╖реНрдЯ рдСрдкрд░реЗрдВрдб рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдирд╣реАрдВ рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреА рдЖрдВрддрд░рд┐рдХ рд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдЧрд▓реЗ рдирд┐рд░реНрджреЗрд╢ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  <code>SETL</code> рдЬреИрд╕реЗ рдирд┐рд░реНрджреЗрд╢ рдЖрдкрдХреЛ рдЭрдВрдбреЗ рдХреЛ "рдкрдврд╝рдиреЗ" рдФрд░ <code>ssa.Value</code> рд░реВрдк рдореЗрдВ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рдПрдХ рд░рдЬрд┐рд╕реНрдЯрд░ рдореЗрдВ рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><pre> <code class="lisp hljs"> L-less than G-greater than | | (<span class="hljs-name"><span class="hljs-name">SETL</span></span> (<span class="hljs-name"><span class="hljs-name">InvertFlags</span></span> x)) -&gt; (<span class="hljs-name"><span class="hljs-name">SETG</span></span> x) | ,  </code> </pre> <br><h1 id="inspekciya-ssa-programmy">  SSA рдирд┐рд░реАрдХреНрд╖рдг рдХрд╛рд░реНрдпрдХреНрд░рдо </h1><br><p>  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕ рддрд░рд╣ рдХрд╛ рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ ( <code>example.go</code> ): </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> example <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fusedMulAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b, c </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float64</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">float64</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a*c + b }</code> </pre> <br><p>  рд╣рдо SSA рдХреЛрдб рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ <code>fusedMulAdd</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП <code>fusedMulAdd</code> рд╣реИ: </p><br><pre> <code class="bash hljs">$ GOSSAFUNC=fusedMulAdd go tool compile example.go &gt; ssa.txt</code> </pre> <br><p>  рдЕрдм рдХрд╛рд░реНрдпрд╢реАрд▓ (рд╡рд░реНрддрдорд╛рди) рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ: </p><br><ul><li>  <code>ssa.txt</code> рдореЗрдВ рдЯреЗрдХреНрдЯ рдбрдВрдк рд╢рд╛рдорд┐рд▓ рд╣реИред </li><li>  <code>ssa.html</code> , рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рдЙрд╕рдореЗрдВ рд╕рдорд╛рди рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдзрд┐рдХ рд╕рдВрд╡рд╛рджрд╛рддреНрдордХ рдФрд░ рдЖрд╕рд╛рдиреА рд╕реЗ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдкреНрд░рд╛рд░реВрдк рдореЗрдВред  рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред </li></ul><br><div class="spoiler">  <b class="spoiler_title">FusedMulAdd рдХреЗ рд▓рд┐рдП рдорд╢реАрди рдХреЛрдб</b> <div class="spoiler_text"><p>  рдЪрд░рд┐рддреНрд░ <code>~r3</code> рдирд╛рдо рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><pre> <code class="hljs erlang"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v7</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> MOVSD </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SP)</span></span></span><span class="hljs-function">, X0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v11</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> MOVSD </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function">+16</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SP)</span></span></span><span class="hljs-function">, X1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v12</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> MULSD X1, X0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v6</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> MOVSD </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">+8</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SP)</span></span></span><span class="hljs-function">, X1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v13</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> ADDSD X1, X0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v15</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> MOVSD X0, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ret</span></span></span><span class="hljs-function">+24</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SP)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b1</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> RET</span></span></code> </pre> </div></div><br><p>  <code>lower</code> рдЪрд░рдг рдХреЗ рдмрд╛рдж <code>fusedMulAdd</code> рд▓рд┐рдП рдпрд╣ SSA рдкреНрд░реЛрдЧреНрд░рд╛рдо <code>fusedMulAdd</code> рджрд┐рдЦрддрд╛ рд╣реИ: (ssa.html): </p><br><p><img src="https://habrastorage.org/webt/zs/yb/ax/zsybaxjcr1s0_u1csmhgkt3d1za.png"></p><br><div class="spoiler">  <b class="spoiler_title">рдкрд╛рда рдкреНрд░рд╛рд░реВрдк SSA рдХрд╛рд░реНрдпрдХреНрд░рдо</b> <div class="spoiler_text"><p>  рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдЖрдк рдЗрд╕реЗ рдХреЙрдкреА рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ: </p><br><pre> <code class="hljs xml">lower [77667 ns] b1: v1 (?) = InitMem <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mem</span></span></span><span class="hljs-tag">&gt;</span></span> v2 (?) = SP <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uintptr</span></span></span><span class="hljs-tag">&gt;</span></span> v7 (?) = LEAQ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*float64</span></span></span><span class="hljs-tag">&gt;</span></span> {~r3} v2 v8 (3) = Arg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> {a} v9 (3) = Arg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> {b} v10 (3) = Arg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> {c} v12 (+4) = MULSD <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> v8 v10 v13 (4) = ADDSD <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> v12 v9 v14 (4) = VarDef <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mem</span></span></span><span class="hljs-tag">&gt;</span></span> {~r3} v1 v15 (4) = MOVSDstore <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mem</span></span></span><span class="hljs-tag">&gt;</span></span> {~r3} v2 v13 v14 Ret v15 (line +4)</code> </pre> </div></div><br><p>  рдЗрд╕рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдПрд╕-рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ: </p><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">MOVQstore</span></span> {~r3} (<span class="hljs-name"><span class="hljs-name">SP</span></span>) (<span class="hljs-name"><span class="hljs-name">ADDSD</span></span> (<span class="hljs-name"><span class="hljs-name">MULSD</span></span> (<span class="hljs-name"><span class="hljs-name">Arg</span></span> {a}) (<span class="hljs-name"><span class="hljs-name">Arg</span></span> {c})) (<span class="hljs-name"><span class="hljs-name">Arg</span></span> {b})))</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд░реЗрдЧреЙрд▓реЙрдХ рдЪрд░рдг рдХреЗ рдмрд╛рдж рдПрд╕.рдПрд╕.рдП.</b> <div class="spoiler_text"><p>  рдпрд╣ <code>regalloc</code> рдЪрд░рдг рдХреЗ рд▓рд┐рдП <code>ssa.html</code> рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/ef/kx/u5/efkxu5pdwqvs14c9xwblajxoywo.png"></p><br><pre> <code class="hljs xml">regalloc [87237 ns] b1: v1 (?) = InitMem <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mem</span></span></span><span class="hljs-tag">&gt;</span></span> v14 (4) = VarDef <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mem</span></span></span><span class="hljs-tag">&gt;</span></span> {~r3} v1 v2 (?) = SP <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uintptr</span></span></span><span class="hljs-tag">&gt;</span></span> : SP v8 (3) = Arg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> {a} : a[float64] v9 (3) = Arg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> {b} : b[float64] v10 (3) = Arg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> {c} : c[float64] v7 (4) = LoadReg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> v8 : X0 v11 (4) = LoadReg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> v10 : X1 v12 (+4) = MULSD <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> v7 v11 : X0 v6 (4) = LoadReg <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> v9 : X1 v13 (4) = ADDSD <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">float64</span></span></span><span class="hljs-tag">&gt;</span></span> v12 v6 : X0 v15 (4) = MOVSDstore <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mem</span></span></span><span class="hljs-tag">&gt;</span></span> {~r3} v2 v13 v14 Ret v15 (line +4)</code> </pre> </div></div><br><h1 id="dobavlenie-novyh-pravil-optimizaciy">  рдирдП рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдо рдЬреЛрдбрд╝рдирд╛ </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">FMA рд╡рд╛рд▓реЗ</a> рдкреНрд░реЛрд╕реЗрд╕рд░ рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">,</a> рд╣рдо рджреЛ рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ <code>a*c + b</code> рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд▓рд┐рдпрд╛ рддреЛрдХрд░</a> рдХреЗ рд▓реЗрдЦрди рдХреЗ рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL117295</a> рд▓реЗрдВред </p><br><p>  рдЖрдкрдХреА рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code> diff</code> рдкреИрдЪ</a> рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рд╣реИред <br></p><br><h3 id="1-dobavlenie-novoy-operacii---fmasd">  1. рдПрдХ рдирдпрд╛ рдСрдкрд░реЗрд╢рди рдЬреЛрдбрд╝рдирд╛ - FMASD </h3><br><p>  рдлрд╝рд╛рдЗрд▓ <code>compile/internal/ssa/gen/AMD64Ops.go</code> рдореЗрдВ <code>AMD64ops</code> рд╕реНрд▓рд╛рдЗрд╕ <code>AMD64ops</code> рдФрд░ рдПрдХ рдирдпрд╛ рддрддреНрд╡ (рдХрд╣реАрдВ рднреА) рдЬреЛрдбрд╝реЗрдВ: </p><br><pre> <code class="go hljs">{ <span class="hljs-comment"><span class="hljs-comment">// fp64 fma name: "FMASD", //   SSA argLength: 3, reg: fp31, //   regalloc,   resultInArg0: true, //     source,  destination asm: "VFMADD231SD", //   },</span></span></code> </pre> <br><p>  рдЪреВрдВрдХрд┐ рдкрд╣рд▓реЗ рдХреЛрдИ рдСрдкрд░реЗрд╢рди <code>(fp,fp,fp -&gt; fp)</code> рдереЗ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рдирдП рдХреНрд╡рд╛рд▓реАрдлрд╛рдпрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="diff hljs"> fp01 = regInfo{inputs: nil, outputs: fponly} fp21 = regInfo{inputs: []regMask{fp, fp}, outputs: fponly} + fp31 = regInfo{inputs: []regMask{fp, fp, fp}, outputs: fponly}</code> </pre> <br><h3 id="2-dobavlenie-pravila-optimizacii">  2. рдПрдХ рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдо рдЬреЛрдбрд╝рдирд╛ </h3><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ADDSD</span></span> (<span class="hljs-name"><span class="hljs-name">MULSD</span></span> xy) z) -&gt; (<span class="hljs-name"><span class="hljs-name">FMASD</span></span> zxy)</code> </pre> <br><p>  рдПрдХ рдЕрдзрд┐рдХ рд╕рд╣реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдмрд┐рдирд╛ рд╢рд░реНрдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдФрд░ FMA рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ред  рд╣рдо рдпрд╣ рдорд╛рдиреЗрдВрдЧреЗ рдХрд┐ рд╣рдорд╛рд░реЗ рдЯрд╛рд░рдЧреЗрдЯ рдорд╢реАрди рдкрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдПрдлрдПрдордП рд╣реИред </p><br><p>  рд╕рдВрдХрд▓рдХ рдРрд╕реЗ рдЪреЗрдХ рдХреЗ рд▓рд┐рдП <code>config</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="lisp hljs">//  config.useFMA=false,    . (<span class="hljs-name"><span class="hljs-name">ADDSD</span></span> (<span class="hljs-name"><span class="hljs-name">MULSD</span></span> xy) z) &amp;&amp; config.useFMA-&gt; (<span class="hljs-name"><span class="hljs-name">FMASD</span></span> zxy)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдПрдлрдПрдордП рд╕рдорд░реНрдерди рдХреА рдЬрд╛рдВрдЪ рдХреИрд╕реЗ рдХрд░реЗрдВ?</b> <div class="spoiler_text"><p>  рдпрджрд┐ рд╕рд┐рд╕реНрдЯрдо рдкрд░ <code>lscpu</code> рдЙрдкрд▓рдмреНрдз рд╣реИ, рддреЛ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣: </p><br><pre> <code class="bash hljs">$ lscpu | grep fma</code> </pre> </div></div><br><h3 id="3-realizaciya-kodogeneracii">  3. рдХреЛрдб рдкреАрдврд╝реА рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди </h3><br><p>  рдЕрдм, <code>ssaGenValue</code> рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ, <code>compile/internal/amd64/ssa.go</code> рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЖрдкрдХреЛ <code>FMASD</code> рд▓рд┐рдП рдХреЛрдб рдкреАрдврд╝реА рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ssaGenValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s *gc.SSAGenState, v *ssa.Value)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> v.Op { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ssa.OpAMD64FMASD: p := s.Prog(v.Op.Asm()) <span class="hljs-comment"><span class="hljs-comment">//   obj.Prog    // From:  source . p.From = obj.Addr{Type: obj.TYPE_REG, Reg: v.Args[2].Reg()} // To: destination . // v.Reg()  ,      FMASD. p.To = obj.Addr{Type: obj.TYPE_REG, Reg: v.Reg()} // From3:  source . //  From3 .     //  RestArgs,    source ,  . p.SetFrom3(obj.Addr{ Type: obj.TYPE_REG, Reg: v.Args[1].Reg(), }) if v.Reg() != v.Args[0].Reg() { //   resultInArg0 s := v.LongString() v.Fatalf("input[0] and output not in same register %s", s) } //    ,     case. } }</span></span></code> </pre> <br><p>  рдЕрдм рд╣рдорд╛рд░реЗ рдирдП рдЕрдиреБрдХреВрд▓рди рдХреЗ рдХрд╛рдо рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рддреИрдпрд╛рд░ рд╣реИред  рдирдП рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рдмрд╣реБрдд рджреБрд░реНрд▓рдн рд╣реИ, рдЖрдорддреМрд░ рдкрд░ рдирдП рдЕрдиреБрдХреВрд▓рди рдкрд╣рд▓реЗ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдПрд╕рдПрд╕рдП рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </p><br><h1 id="proverka-rezultatov">  рдЬрд╛рдБрдЪ рдкрд░рд┐рдгрд╛рдо </h1><br><p>  рдкрд╣рд▓рд╛ рдХрджрдо рдЕрджреНрдпрддрди <code>gen/AMD64Ops.go</code> рдФрд░ <code>gen/AMD64.Rules</code> рд╕реЗ рдЧреЛ рдХреЛрдб рдЙрддреНрдкрдиреНрди <code>gen/AMD64.Rules</code> ред </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  GOROOT  ,   ,   `go env GOROOT`. cd $GOROOT/src/cmd/compile/internal/ssa/gen &amp;&amp; go run *.go</span></span></code> </pre> <br><p>  рдЕрдЧрд▓рд╛, рд╣рдореЗрдВ рдЕрдкрдирд╛ рдирдпрд╛ рд╕рдВрдХрд▓рдХ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="bash hljs">go install cmd/compile</code> </pre> <br><p>  рдЕрдм, рдПрдХ рд╣реА рдЙрджрд╛рд╣рд░рдг рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдПрдХ рдЕрд▓рдЧ рдорд╢реАрди рдХреЛрдб рдорд┐рд▓рддрд╛ рд╣реИ: </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">- v7 (4) MOVSD a(SP), X0 - v11 (4) MOVSD c+16(SP), X1 - v12 (4) MULSD X1, X0 - v6 (4) MOVSD b+8(SP), X1 - v13 (4) ADDSD X1, X0 - v15 (4) MOVSD X0, ret+24(SP) - b1 (4) RET + v12 (4) MOVSD b+8(SP), X0 + v7 (4) MOVSD a(SP), X1 + v11 (4) MOVSD c+16(SP), X2 + v13 (4) VFMADD231SD X2, X1, X0 + v15 (4) MOVSD X0, ret+24(SP) + b1 (4) RET</span></span></code> </pre> <br><h1 id="bazovye-bloki-basic-blocks">  рдмреБрдирд┐рдпрд╛рджреА рдмреНрд▓реЙрдХ </h1><br><p>  рдЕрдм рдЬрдм рд╕рдмрд╕реЗ рдХрдард┐рди рдХрд╛рдо рд╣реЛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдЗрдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдзрд╛рд░ рдмреНрд▓реЙрдХреЛрдВ рдХреЗ</a> рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдЬрд┐рди рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╣рдордиреЗ рдКрдкрд░ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рд╣реИ рд╡реЗ рдмреНрд▓реЙрдХ рдореЗрдВ рд╣реИрдВ, рдФрд░ рдмреНрд▓реЙрдХ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╣реИрдВред </p><br><p>  рдмреНрд▓реЙрдХ, рдЬреИрд╕реЗ <code>ssa.Value</code> , рд╕рд╛рд░ рдФрд░ рдорд╢реАрди-рдирд┐рд░реНрднрд░ рд╣реИрдВред  рд╕рднреА рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рдареАрдХ рдПрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдмрд┐рдВрджреБ рд╣реИ рдФрд░ 0 рд╕реЗ 2 рдЧрдВрддрд╡реНрдп рдмреНрд▓реЙрдХреЛрдВ (рдмреНрд▓реЙрдХ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░) рд╣реИред </p><br><p>  рд╕рдмрд╕реЗ рд╕рд░рд▓ рдмреНрд▓реЙрдХ рд╣реИрдВ <code>If</code> , <code>Exit</code> рдФрд░ <code>Plain</code> : </p><br><ul><li>  <code>Exit</code> рдмреНрд▓реЙрдХ рдореЗрдВ 0 рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдмреНрд▓реЙрдХ рд╣реИрдВред  рдпреЗ рдкрддреНрддреА рдмреНрд▓реЙрдХ рд╣реИрдВ рдЬреЛ рдЧреИрд░-рд╕реНрдерд╛рдиреАрдп рдХреВрдж рдмрдирд╛рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>panic</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдПред </li><li>  <code>Plain</code> рдмреНрд▓реЙрдХ рдореЗрдВ 1 рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдмреНрд▓реЙрдХ рд╣реЛрддрд╛ рд╣реИред  рдмреНрд▓реЙрдХ рдХреЗ рд╕рднреА рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рджреВрд╕рд░реЗ рдмреНрд▓реЙрдХ рдореЗрдВ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЗрд╕реЗ рдмрд┐рдирд╛ рд╢рд░реНрдд рдХреВрдж рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </li><li>  <code>If</code> рдмреНрд▓реЙрдХ рдореЗрдВ 2 рдЧрдВрддрд╡реНрдп рдмреНрд▓реЙрдХ рд╣реИрдВред  рд╕рдВрдХреНрд░рдордг рдХреА рд╕реНрдерд┐рддрд┐ ( <code>Block.Control</code> ) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ul><br><p>  рдпрд╣рд╛рдБ <code>AMD64</code> рдмреНрд▓реЙрдХ рдореЗрдВ рд╕рд╛рд░ рдмреНрд▓реЙрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВ: </p><br><pre> <code class="lisp hljs">  <span class="hljs-string"><span class="hljs-string">"then"</span></span> ( ) |  <span class="hljs-string"><span class="hljs-string">"else"</span></span> ( ) | | (<span class="hljs-name"><span class="hljs-name">If</span></span> (<span class="hljs-name"><span class="hljs-name">SETL</span></span> cmp) yes no) -&gt; (<span class="hljs-name"><span class="hljs-name">LT</span></span> cmp yes no) (<span class="hljs-name"><span class="hljs-name">If</span></span> (<span class="hljs-name"><span class="hljs-name">SETLE</span></span> cmp) yes no) -&gt; (<span class="hljs-name"><span class="hljs-name">LE</span></span> cmp yes no)</code> </pre> <br><p>  рдХрдВрдкрд╛рдЗрд▓рд░ рдХреЗ рдПрд╕рдПрд╕рдП рднрд╛рдЧ рдореЗрдВ рдЕрдиреНрдп рдЕрдиреБрдХреВрд▓рди рдЪрд░рдгреЛрдВ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдмреНрд▓реЙрдХреЛрдВ рдХреЗ рд╡рд┐рд╖рдп рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><h1 id="ogranicheniya-pravil-optimizaciy">  рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдореЛрдВ рдХреА рд╕реАрдорд╛рдПрдВ </h1><br><p>  рдПрд╕рдПрд╕рдП рдмреИрдХреЗрдВрдб рдХреЗ рдЕрдкрдиреЗ рдлрд╛рдпрджреЗ рд╣реИрдВред  рдХреБрдЫ рдЕрдиреБрдХреВрд▓рди <code>O(1)</code> рдореЗрдВ рд╕рдВрднрд╡ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рдореЗрдВ рдХрдорд┐рдпрд╛рдВ рднреА рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рдЕрдХреЗрд▓реЗ рдЕрдиреБрдХреВрд▓рдХ рдХрд╛ SSA рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХрдо рд╕реЗ рдХрдо рддрдм рддрдХ рдЬрдм рддрдХ рдЗрд╕рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдХреБрдЫ рдкрд╣рд▓реВ рдирд╣реАрдВ рдмрджрд▓ рдЬрд╛рддреЗред </p><br><p>  рдорд╛рди рд▓реЗрдВ рдХрд┐ рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>  append</code></a> рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ: </p><br><pre> <code class="go hljs">xs = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(xs, <span class="hljs-string"><span class="hljs-string">'a'</span></span>) xs = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(xs, <span class="hljs-string"><span class="hljs-string">'b'</span></span>) <span class="hljs-comment"><span class="hljs-comment">// =&gt; xs = append(xs, 'a', 'b')</span></span></code> </pre> <br><p>  рдЬрд┐рд╕ рд╕рдордп рдПрд╕рдПрд╕рдП рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рдЙрд╕ рд╕рдордп рдХреЛрдб рдХреА рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рд╕рдВрд░рдЪрдирд╛ рдЦреЛ рдЬрд╛рддреА рд╣реИ рдФрд░ <code>append</code> , рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдпреБрдХреНрдд рдмреНрд▓реЙрдХ рдХреЗ рд╢рд░реАрд░ рдореЗрдВ рдирд┐рд░реНрдорд┐рдд рд╣реЛрддрд╛ рд╣реИред  рдЖрдкрдХреЛ рдПрдХ рдмреЛрдЭрд┐рд▓ рдирд┐рдпрдо рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ <code>append</code> рд▓рд┐рдП рд╕реГрдЬрд┐рдд рдкрд░рд┐рдЪрд╛рд▓рдиреЛрдВ рдХреЗ рд╕рдВрдкреВрд░реНрдг рдЕрдиреБрдХреНрд░рдо рдХреЛ рдкрдХрдбрд╝рддрд╛ рд╣реИред </p><br><p>  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ <code>.Rules</code> рдмрд╛рд░реЗ рдореЗрдВ рдмреЛрд▓рддреЗ рд╣реБрдП, рдлрд┐рд░ рдЗрд╕ DSL рдореЗрдВ рдмреНрд▓реЙрдХ ( <code>ssa.Block</code> ) рдХреЗ рд╕рд╛рде рдХрдордЬреЛрд░ рдХрд╛рдо рд╣реИред  рдЗрд╕ рднрд╛рд╖рд╛ рдореЗрдВ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд▓рд┐рдП рдмреНрд▓реЙрдХреЛрдВ рд╕реЗ рдЬреБрдбрд╝рд╛ рдХреЛрдИ рднреА рдирд┐рд░рдВрдХреБрд╢ рдЕрдиреБрдХреВрд▓рди рдЕрд╕рдВрднрд╡ рд╣реИред  рдЖрдВрд╢рд┐рдХ рдмреНрд▓реЙрдХ рдЕрджреНрдпрддрди рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред  рдмреНрд▓реЙрдХ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рдирд╛ рднреА рдЕрд╕рдВрднрд╡ рд╣реИ (рд▓реЗрдХрд┐рди <code>First</code> рдмреНрд▓реЙрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╣реИрдХ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдб рдХреЛрдб рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред </p><br><blockquote>  рднрд▓реЗ рд╣реА рдХреБрдЫ рдХрдорд┐рдпрд╛рдВ рдареАрдХ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реЛрдВ, рдЕрдзрд┐рдХрд╛рдВрд╢ рдХрдВрдкрд╛рдЗрд▓рд░ рдЗрд╕ рдмрд╛рдд рд╕реЗ рд╕рд╣рдордд рд╣реИрдВ рдХрд┐ рдХреЛрдб рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдПрдХрд▓ рдФрд░ рдмреЗрд╣рддрд░ рдордзреНрдпрд╡рд░реНрддреА рд░реВрдк рдирд╣реАрдВ рд╣реИред </blockquote><br><h1 id="go-that-goes-faster">  рдЬрд╛рдУ рдХрд┐ рддреЗрдЬреА рд╕реЗ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ </h1><br><p>  рдпрджрд┐ рдЖрдк рдХреБрдЫ рд╢рд╛рдВрдд рдЕрдиреБрдХреВрд▓рди рдирд┐рдпрдореЛрдВ рдХреЗ рд╕рд╛рде рдЖрддреЗ рд╣реИрдВ, рддреЛ рдмреЗрдЭрд┐рдЭрдХ рдЗрд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">go-review.googlesource.com</a> рдкрд░ рднреЗрдЬреЗрдВред  рдореБрдЭреЗ рд╕рдореАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдореЗрдВ рдЦреБрд╢реА рд╣реЛрдЧреА (CC рдореЗрдВ <code>iskander.sharipov@intel.com</code> рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ)ред </p><br><p>  рд╣реИрдкреНрдкреА рд╣реИрдХрд┐рдВрдЧ рдХрдВрдкрд╛рдЗрд▓рд░! </p><br><p><img src="https://habrastorage.org/webt/op/wr/50/opwr50a-n6imbex_ykcxpia5_ny.gif"></p><br><h2 id="bonusnyy-material">  рдмреЛрдирд╕ рд╕рд╛рдордЧреНрд░реА </h2><br><p>  рдЬрд╛рдиреЗ рдпрд╛ рдмрджрд▓реЗ рдЧрдП SSA рдирд┐рдпрдореЛрдВ рдореЗрдВ рдЕрдЪреНрдЫреЗ рдкреИрдЪ рдХреЗ рдЙрджрд╛рд╣рд░рдг: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL99656: cmd / рд╕рдВрдХрд▓рд┐рдд / рдЖрдВрддрд░рд┐рдХ / ssa: IMUL3 {L / Q} рдХреЗ рд▓рд┐рдП MUL {L / Q} x x рдкрд░ рдХрд╛рд╕реНрдЯ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL102277: cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / ssa: рджреВрд░ amd64 рдкрд░ рдбрдмрд▓ NEG рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХрд░реЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL54410: cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / ssa: amse64 рдкрд░ рд╢реВрдиреНрдп рд╕реЗ sse рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL58090: cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / ssa: amd64 рдкрд░ рдирд┐рд░рд░реНрдердХ рдЬрд╝реАрд░реЛрдХреНрд╕реНрдЯреЗрдВрд╢рди рд╣рдЯрд╛ рджреЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL95475: cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / ssa: amd64 рдкрд░ рдмрд╛рдЗрдЯ рд╕реНрдЯреЛрд░ рдХреЛ рдорд┐рд▓рд╛рдПрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL97175: cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / ssa: arm64 рдкрд░ рд▓рдЧрд╛рддрд╛рд░ LittleEndian рд╕реНрдЯреЛрд░реНрд╕ рдХреЛ рдорд┐рд▓рд╛рдПрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL115617: cmd / рд╕рдВрдХрд▓рди / рдЖрдВрддрд░рд┐рдХ / ssa: рдмреЗрдХрд╛рд░ рд╢реВрдиреНрдп рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рд╣рдЯрд╛ рджреЗрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CL101275: cmd / рд╕рдВрдХрд▓рди: amd64 LEAL {1,2,4,8} ops рдЬреЛрдбрд╝реЗрдВ</a> </li></ul><br><p>  рдЗрддрдиреА рджреЗрд░ рдкрд╣рд▓реЗ рдирд╣реАрдВ, рдПрдХ <a href="">README</a> рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕рдВрдХрд▓рдХ рдХреЗ рдПрд╕рдПрд╕рдП рднрд╛рдЧ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛ред <br>  рдкрдврд╝рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреАред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi415771/">https://habr.com/ru/post/hi415771/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi415761/index.html">Playable Ads рдкрд░ рдХреНрдпрд╛, рдХреИрд╕реЗ рдФрд░ рдХреНрдпреЛрдВ</a></li>
<li><a href="../hi415763/index.html">рдЕрдореЗрд░рд┐рдХреА рд╕рд░рдХрд╛рд░ рдЖрдИрдПрдПрдирдП рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░ рд░рд╣реА рд╣реИ [рд▓реЗрдХрд┐рди рдЗрд╕рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИ]</a></li>
<li><a href="../hi415765/index.html">рдХреНрдпреЛрдВ VMware рдЙрджреНрдпрдо blockchains рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдордВрдЪ рдмрдирд╛рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi415767/index.html">рдЯреЗрд╕реНрд▓рд╛ рдЗрдВрдХ рдиреЗ рдХрдирд╛рдбрд╛ рдФрд░ рд╕рдВрдпреБрдХреНрдд рд░рд╛рдЬреНрдп рдЕрдореЗрд░рд┐рдХрд╛ рдХреЗ рдирд┐рд╡рд╛рд╕рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЯреЗрд╕реНрд▓рд╛ рдореЙрдбрд▓ 3 рдХреЗ рдСрд░реНрдбрд░ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдЦреЛрд▓ рджрд┐рдпрд╛ рд╣реИ</a></li>
<li><a href="../hi415769/index.html">TeamCity рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Android рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ UI рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХрд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд▓реЙрдиреНрдЪ рд╕реЗрдЯ рдХрд░реЗрдВ</a></li>
<li><a href="../hi415773/index.html">рдЧреИрд░-рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ: рд╕реНрдХреЗрд▓реЗрдмрд┐рд▓рд┐рдЯреА</a></li>
<li><a href="../hi415775/index.html">рдПрдХ рд╢рд╛рдВрдд рд╕рдореНрдореЗрд▓рди рдХреЗ рд▓рд┐рдП рдПрдХ рд░рд┐рдкреЛрд░реНрдЯ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░рд▓, рд▓реЗрдХрд┐рди рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ</a></li>
<li><a href="../hi415777/index.html">рд╡рд┐рдХрд╛рд╕ рдореЗрдВ рдкрд╣рд▓реА рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдЪреИрдореНрдкрд┐рдпрдирд╢рд┐рдк</a></li>
<li><a href="../hi415779/index.html">рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдПрдирдПрдПрд╕ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди</a></li>
<li><a href="../hi415781/index.html">рднреМрддрд┐рдХрд╡рд┐рджреЛрдВ рдХреЛ рдХреНрдпреЛрдВ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕рд┐рджреНрдзрд╛рдВрдд "рд╣рд░ рдЪреАрдЬ рдХрд╛ рд╕рд┐рджреНрдзрд╛рдВрдд" рд╣реЛ рд╕рдХрддрд╛ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>