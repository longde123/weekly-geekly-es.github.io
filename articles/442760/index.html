<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôåüèº üßëüèø‚Äçü§ù‚Äçüßëüèº üñï Un art√≠culo sobre c√≥mo CommVault respalda PostgreSQL üö¥üèΩ üññüèø üëßüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, revisaremos nuestra experiencia con CommVault para las copias de seguridad de PostgreSQL. Para hacer esto, analizaremos una peque√±a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un art√≠culo sobre c√≥mo CommVault respalda PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/softline/blog/442760/">  En este art√≠culo, revisaremos nuestra experiencia con CommVault para las copias de seguridad de PostgreSQL.  Para hacer esto, analizaremos una peque√±a parte de uno de nuestros proyectos anteriores, donde configuramos una copia de seguridad de la base de datos PostgreSQL del cliente. <br><br><img src="https://habrastorage.org/webt/zl/io/gr/zliogravp0udjmycafd9nm6yrow.jpeg"><a name="habracut"></a><br><br><h4>  <font color="#2e74b5">Sobre CommVault</font> </h4><br>  CommVault es una plataforma √∫nica escalable que proporciona protecci√≥n integrada de datos y gesti√≥n de contenido.  La plataforma admite m√≥dulos de software con funciones para realizar copias de seguridad y restaurar datos, su archivado, deduplicaci√≥n, replicaci√≥n, distribuci√≥n jer√°rquica de medios y cifrado.  Los m√≥dulos de la plataforma funcionan con contenido corporativo de varias fuentes y proporcionan recuperaci√≥n de informaci√≥n de extremo a extremo en el entorno corporativo y su disponibilidad constante incluso desde archivos gracias a una indexaci√≥n inteligente de documentos en un repositorio virtual.  La plataforma tambi√©n est√° equipada con herramientas anal√≠ticas avanzadas que generan informes sobre las acciones de los usuarios y las aplicaciones y sobre el funcionamiento de la infraestructura. <br><br>  CommVault protege, restaura y gestiona datos y acceso a ellos en entornos f√≠sicos y virtuales. <br><br><h4>  <font color="#2e74b5">Acerca de la copia de seguridad de PostgreSQL</font> </h4><br>  Para realizar una copia de seguridad de la base de datos PostgreSQL, se utiliza un agente (iDataAgent), que se instala en el servidor donde se ejecuta la base de datos.  El agente est√° dise√±ado para administrar y proteger de manera efectiva datos comerciales importantes en bases de datos PostgreSQL.  Puede usar este agente para hacer una copia de seguridad y restaurar todo el servidor PostgreSQL o bases de datos individuales.  Si es necesario, tambi√©n puede restaurar tablas individuales. <br><br><h4>  <font color="#2e74b5">Caracter√≠sticas clave:</font> </h4><br>  PostgreSQL iDataAgent proporciona la flexibilidad para hacer una copia de seguridad de las bases de datos en varios modos y restaurarlas en un tiempo m√≠nimo.  Puede realizar una copia de seguridad o una copia de seguridad de todo el servidor PostgreSQL, bases de datos individuales o registros archivados en cualquier momento. <br><br>  Las funciones de copia de seguridad y recuperaci√≥n que se pueden realizar en diferentes modos: <br><br><ul><li>  iDataAgent proporciona la capacidad de restaurar todo el servidor PostgreSQL.  Todas las bases de datos ubicadas en el servidor de origen se pueden restaurar en el servidor de destino. </li><li>  Defina una √∫nica base de datos o grupo de bases de datos como datos de subcliente y realice una copia de seguridad y restauraci√≥n. </li><li>  Haga una copia de seguridad solo de los registros en el servidor PostgreSQL.  Estos archivos de registro se pueden usar para recuperar las transacciones de la base de datos perdidas debido a un sistema operativo o falla del disco. </li><li>  Restaure todo su servidor PostgreSQL en un momento espec√≠fico para la Copia de seguridad basada en el sistema de archivos. </li><li>  Vea y verifique el estado de las operaciones de copia de seguridad y recuperaci√≥n desde Job Controller y Event Viewer en la consola CommCell.  Realice un seguimiento del estado de su trabajo con informes que puede guardar y distribuir. </li><li>  Utilice las copias de seguridad a nivel de bloque como una forma m√°s r√°pida de hacer una copia de seguridad de los datos, ya que las copias de seguridad son solo para extensiones (o partes modificadas de la base de datos) y no para toda la base de datos PostgreSQL. </li><li>  Desduplicaci√≥n a nivel de bloque  La deduplicaci√≥n proporciona una forma m√°s inteligente de almacenar datos mediante la identificaci√≥n y eliminaci√≥n de duplicados en las operaciones de protecci√≥n de datos. </li></ul><br><h4>  <font color="#2e74b5">Arquitectura</font> </h4><br>  <font color="#2e74b5"><b>Esquema</b></font> <br><br><img src="https://habrastorage.org/webt/ys/ji/ct/ysjict_mkf-7kcsciptlw7du77y.png"><br><br>  <font color="#2e74b5"><b>C√≥mo funciona</b></font> <br><br>  La plataforma CommVault se implementa en la red como parte del servidor de administraci√≥n CommServe y un servidor MediaAgent separado (se recomienda usar un servidor f√≠sico). <br><br>  Se instala un agente (iDataAgent) en el servidor con la base de datos PostgreSQL y sus pol√≠ticas de respaldo se configuran de acuerdo con los requisitos.  iDataAgent recopila los datos necesarios, comprime, deduplica, si es necesario, los cifra y los transfiere a MediaAgent. <br><br>  Adem√°s, los datos se colocan en el sistema de almacenamiento, en una biblioteca de cintas o en el almacenamiento en la nube. <br>  Para la recuperaci√≥n, los datos se extraen del almacenamiento y se copian al servidor con PostgreSQL. <br><br>  <font color="#2e74b5"><b>Configuraci√≥n en la consola CommVault</b></font> <br><br>  Ahora veamos c√≥mo hacer esto en la consola de administraci√≥n. <br><br>  1. Para iniciar la copia de seguridad de la base de datos en este momento, seleccione en la consola del navegador CommCell: <br><br>  Equipos cliente |  El |  PostgreSQL |  El |  DumpBasedBackupSet. <br><br>  Haga clic derecho en la carpeta <b>predeterminada</b> en el <b>subcliente</b> y seleccione <b>Copia de seguridad</b> . <br><br><img src="https://habrastorage.org/webt/q5/nm/uj/q5nmujdizcusqcmygdyfz_5xdtq.png"><br><br>  2. Seleccione <b>Completo</b> como tipo de copia de seguridad y seleccione <b>Inmediato</b> . <br><br>  3. Haga clic en <b>Aceptar</b> .  <b>Se inicia la</b> copia de seguridad de <b>PostgreSQL</b> . <br><br><img src="https://habrastorage.org/webt/zi/cn/ea/zicneazi3vlxtzvxq0nlth7whda.png"><br><br>  4. Durante la ejecuci√≥n del trabajo, su ventana de <b>trabajo de la</b> consola <b>CommCell</b> puede monitorear su estado. <br><br><img src="https://habrastorage.org/webt/dp/wm/cl/dpwmcly1yjwuwkdthl5fdg8kom4.png"><br><br>  5. Una vez que se complete la tarea, puede ver los detalles de la tarea completa desde la ventana <b>Historial de copia de seguridad</b> .  Seleccione la carpeta <b>predeterminada</b> en el <b>subcliente</b> y seleccione <b>Historial de copia de seguridad</b> . <br><br><img src="https://habrastorage.org/webt/f8/ye/ju/f8yeju8l0lihgvro3kowl5ntgza.png"><br><br>  6. En la ventana <b>Historial de copia de seguridad</b> , puede ver los siguientes datos sobre las tareas completadas: <br><br>  - Errores de copia de seguridad al completar una tarea; <br>  - Elementos que fueron respaldados con √©xito; <br>  - Detalles de la tarea; <br>  - eventos; <br>  - archivos de registro; <br>  - Medios en los que se almacenan los datos. <br><br>  <font color="#2e74b5"><b>¬øPor qu√© puedes retroceder?</b></font> <br><br>  Copia de seguridad basada en volcado: <br><br><ul><li>  Bases de datos del sistema PostgreSQL; </li><li>  Bases de datos de usuarios de PostgreSQL </li><li>  Copia de seguridad de un sistema de archivos (Copia de seguridad basada en el sistema de archivos). </li></ul><br>  Bases de datos PostgreSQL (datos y registros) (datos y registros): <br><br><ul><li>  Archivos de registro. </li></ul><br>  Lo que no se copia: <br><br><ul><li>  Archivos de aplicaci√≥n PostgreSQL (archivos de aplicaci√≥n); </li><li>  Datos del sistema operativo. </li></ul><br>  Use el Agente de datos del sistema de archivos para hacer una copia de seguridad de los componentes anteriores. <br><br><h4>  <font color="#2e74b5">Desaf√≠o</font> </h4><br>  El cliente necesitaba implementar la plataforma CommVault para hacer una copia de seguridad de sus servicios.  Uno de los servicios fue la base de datos PostgreSQL, que se implement√≥ en una configuraci√≥n de cl√∫ster de 2 nodos: Master y Standby.  Ambos trabajaron en servidores f√≠sicos. <br><br>  <font color="#2e74b5"><b>Caracter√≠sticas de configuraci√≥n del cliente PostgreSQL</b></font> <br><br>  La configuraci√≥n del cl√∫ster PostgreSQL se eligi√≥ para garantizar la tolerancia a errores del servidor de la base de datos. <br><br>  El cliente realiz√≥ la copia de seguridad de la base de datos PostgreSQL usando pg_dump. <br><br>  El esquema de trabajo se presenta en la siguiente figura: <br><br><img src="https://habrastorage.org/webt/2q/cw/li/2qcwlitdhowursvmsnpc4jak7ec.png"><br><br><h4>  <font color="#2e74b5">Configurar copia de seguridad con CommVault</font> </h4><br>  Para unificar la plataforma de respaldo y aprovechar el almacenamiento de respaldo, decidimos usar CommVault para respaldar la base de datos PostgreSQL. <br><br>  Porque  el cliente us√≥ la configuraci√≥n de cl√∫ster PostgreSQL, para la copia de seguridad decidimos usar la opci√≥n Copia de seguridad basada en el sistema de archivos para la copia de seguridad de archivos.  Al mismo tiempo, tuve que abandonar el uso de la copia de seguridad de bloque (Block Level Backup), porque  La versi√≥n del kernel de Linux utilizada en la que se implementa PostgreSQL es m√°s alta que la CommVault oficialmente compatible.  Debido al hecho de que el servicio es cr√≠tico para la organizaci√≥n, decidieron hacer un cronograma de respaldo de acuerdo con la tabla: <br><table><tbody><tr><th><br></th><th>  Copia completa <br></th><th>  Registros de transacciones <br></th></tr><tr><td>  Graph <br></td><td>  Una vez al d√≠a, a las 23 horas. <br></td><td>  Cada hora durante 24 horas </td></tr><tr><td>  Periodo de almacenamiento de copias <br></td><td>  7 dias <br></td><td>  1 dia <br></td></tr></tbody></table><br>  El volumen total de la base de datos era m√°s de 1.5 Tb y para mantenerse dentro de los RTO y RPO requeridos, se utiliz√≥ una red LAN separada para el respaldo a una velocidad de 10 Gb / s. <br><br>  La copia de seguridad se realiz√≥ de acuerdo con el siguiente diagrama: <br><br><img src="https://habrastorage.org/webt/b4/j-/mv/b4j-mvywwwqd0c8_1qpr9rg6-hq.png"><br><br>  Las copias de seguridad se tomaron de un servidor PostgreSQL Standby y se almacenaron en un servidor con MediaAgent instalado.  A continuaci√≥n, una vez al mes, se cargaron copias completas en la nube de Amazon para una vida √∫til de un a√±o. <br><br>  Se realizaron todos los ajustes necesarios y la copia de seguridad se realiz√≥ correctamente. <br><br>  <font color="#2e74b5"><b>Caracter√≠sticas de configuraci√≥n de respaldo de PostgreSQL</b></font> <br><br>  Al instalar y configurar la copia de seguridad, encontramos algunas dificultades, que se enumeran a continuaci√≥n.  Creo que ser√° √∫til tener en cuenta estas caracter√≠sticas al realizar proyectos similares y al configurar los administradores de bases de datos PostgreSQL. <br><br><ol><li>  Verifique que los nodos Master y Standby tengan la misma configuraci√≥n de servicio PostgreSQL establecida de acuerdo con la documentaci√≥n de CommVault: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21491.htm</a> </li><li>  Compruebe que los par√°metros especificados en Soluci√≥n de problemas de copia de seguridad son consistentes con los especificados por los enlaces: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21723.htm</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21518.htm</a> </li><li>  Aseg√∫rese de que los derechos de acceso al servidor de base de datos y las bases de datos se establecieron de acuerdo con los siguientes requisitos: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21523.htm</a> </li></ol><br>  <font color="#2e74b5"><b>Recuperaci√≥n</b></font> <br><br>  Retroceder es bueno.  Naturalmente, estamos interesados ‚Äã‚Äãno solo en el proceso de su creaci√≥n, sino tambi√©n en la restauraci√≥n.  Por lo que est√° hecho. <br><br>  En esta situaci√≥n, la restauraci√≥n, basada en nuestra experiencia, puede ser necesaria para el cliente en 2 casos: <br><br><ol><li>  Restaurar la base de datos en un momento determinado para acceder a datos que, por ejemplo, podr√≠an eliminarse de la base de datos; </li><li>  En caso de p√©rdida de todo el cl√∫ster de base de datos PostgreSQL. </li></ol><br>  Para restaurar la base de datos, solo lea la documentaci√≥n en este enlace: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentation.commvault.com/commvault/v11_sp14/article?p=21502.htm</a> <br><br>  Tambi√©n enfocar√≠amos su atenci√≥n en las siguientes caracter√≠sticas y pasos durante la recuperaci√≥n: <br><br><ol><li>  SIEMPRE siga el procedimiento de recuperaci√≥n con el DBA PostgreSQL.  Esto lo ayudar√° a evitar acciones incorrectas y resolver r√°pidamente los problemas que surjan durante el proceso de recuperaci√≥n; </li><li>  La recuperaci√≥n debe realizarse en un nodo con el rol de Maestro; </li><li>  Al restaurar, aseg√∫rese de verificar que los servicios de PostgreSQL no se inicien despu√©s de que se complete la operaci√≥n; </li><li>  En el nodo restaurado, cambie la configuraci√≥n al rol Maestro, porque  en nuestro caso, respaldamos los nodos en espera; </li><li>  Deshabilite los servicios en el nodo En espera, habil√≠telos en el nodo Maestro, luego habilite el nodo En espera y configure la replicaci√≥n nuevamente. </li></ol><br><h4>  <font color="#2e74b5">Conclusi√≥n</font> </h4><br>  En este art√≠culo, no tomamos en cuenta la copia de seguridad del sistema operativo Linux y otros sistemas.  Debe hacerse por separado.  La documentaci√≥n de CommVault describe esto en detalle.  Si nuestro art√≠culo despierta inter√©s y hay muchos deseos, definitivamente describiremos c√≥mo hacer una copia de seguridad de otros sistemas.  Escriba en los comentarios qu√© sistemas ser√≠an de su inter√©s. <br><br>  Esperamos que nuestra experiencia lo ayude a configurar una copia de seguridad mediante el DBA PostgreSQL. <br><br>  Autores <br>  Sergey Alexandrov, jefe del grupo de respaldo, Softline <br>  Artyom Khmelenko, ingeniero jefe, Softline </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442760/">https://habr.com/ru/post/442760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442746/index.html">Aplicaci√≥n tonta para la tienda de Windows</a></li>
<li><a href="../442748/index.html">Lo que pasa con el sombrero: los 10 mejores informes de Heisenbug 2018 Mosc√∫</a></li>
<li><a href="../442750/index.html">Virtual Djinn el 8 de marzo, o c√≥mo sorprender a tus empleados en un d√≠a de primavera</a></li>
<li><a href="../442754/index.html">Bases de datos operativas frente a anal√≠ticas: almacenamiento de columnas frente a filas</a></li>
<li><a href="../442758/index.html">5 trucos para optimizar consultas SQL en Greenplum</a></li>
<li><a href="../442762/index.html">Aprendiz Vasya y sus historias sobre idempotencia API</a></li>
<li><a href="../442764/index.html">Resumen de gesti√≥n de productos. Lo que emociona a los productos y a los vendedores en 2019</a></li>
<li><a href="../442770/index.html">Descripci√≥n general de los esc√°neres de c√≥digo de barras JavaScript</a></li>
<li><a href="../442772/index.html">Matem√°ticas para el cient√≠fico de datos: secciones necesarias</a></li>
<li><a href="../442776/index.html">√çndices en PostgreSQL - 3 (Hash)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>