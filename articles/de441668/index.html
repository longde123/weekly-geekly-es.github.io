<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¼â€ğŸ’¼ ğŸ‘ğŸ¾ ğŸ‘©ğŸ½â€ğŸš’ STM32. Gewichtsverlust Praxis oder DiÃ¤t fÃ¼r den Controller ğŸ§ğŸ½ ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¿ ğŸ•´ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Was fÃ¼r ein Unsinn, werden einige Leser wahrscheinlich denken, wenn sie den Titel der VerÃ¶ffentlichung sehen. Hat der Autor einen Fehler in der Ressou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>STM32. Gewichtsverlust Praxis oder DiÃ¤t fÃ¼r den Controller</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441668/"><img src="https://habrastorage.org/webt/u0/9v/yw/u09vyw-escpdlkeezud4cab8trw.jpeg"><br><br><p>  Was fÃ¼r ein Unsinn, werden einige Leser wahrscheinlich denken, wenn sie den Titel der VerÃ¶ffentlichung sehen.  Hat der Autor einen Fehler in der Ressource gemacht?  Oder war geplant, es im Hub "Geek Health" zu platzieren?  Und sie werden teilweise richtig sein, aber nur teilweise ... Unter dem Strich werden wir Ã¼ber eine Methode zur Reduzierung und Optimierung des Energieverbrauchs elektronischer GerÃ¤te sprechen. </p><a name="habracut"></a><br><p>  Vor einiger Zeit fiel mir das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A-Board</a> in die HÃ¤nde, das vorerst im Leerlauf war, bis ich mich entschied, den Stromverbrauch eines bestimmten GerÃ¤ts mit autonomer Leistung zu untersuchen. </p><br><img src="https://habrastorage.org/webt/v-/ma/qp/v-maqpklxovwalvp3dc_99ireja.jpeg"><br><p>  Diese Karte wurde von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">STMicroelectronics entwickelt</a> und ist als "Power Shield, Nucleo-Erweiterungskarte zur Messung des Stromverbrauchs" positioniert.  Ich fand im Netzwerk keine erklÃ¤rende Beschreibung in russischer Sprache fÃ¼r die Arbeit mit diesem Devkit und beschloss, es selbst herauszufinden und gleichzeitig Informationen mit der angesehenen Habro-Community zu teilen. </p><br><p>  Wenn wir die wichtigste hervorheben, ist die Erweiterungskarte eine programmierbare Stromquelle von 1,8 bis 3,3 Volt mit der FÃ¤higkeit, den Laststrom in Echtzeit (im dynamischen Modus bis zu) zu messen <br>  50 mA) mit einer Abtastfrequenz von bis zu 100 kHz.  Das GerÃ¤t kann sowohl unabhÃ¤ngig als auch als Teil eines Hardware-Software-Komplexes betrieben werden.  Zur grafischen Anzeige der Messwerte wird das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienstprogramm STM32Cube MonitorPower verwendet</a> .  Mit dieser Software kÃ¶nnen Sie auch alle erforderlichen Parameter einstellen und die Verarbeitung beim Auftreten eines Ereignisses durchfÃ¼hren (Triggerstart).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A ist</a> fÃ¼r die Arbeit mit Nucleo-32 (64, 144), Arduino Nano (Uno) Boards geschÃ¤rft. Zu diesem Zweck werden die entsprechenden Abschirmungen darauf platziert, es ist jedoch mÃ¶glich, mit beliebigen Boards zu arbeiten.  Das Foto unten zeigt den Anschluss des untersuchten GerÃ¤ts an einen der AnschlÃ¼sse auf der Platine. </p><br><img src="https://habrastorage.org/webt/3p/o-/ll/3po-lljw_abqlzhztomwkzncw0i.jpeg"><br><br><p>  ZusÃ¤tzlich zur Anwendungssoftware unterstÃ¼tzt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A</a> den Befehlsmodus, fÃ¼r den <s>jedes Terminalprogramm</s> funktionieren <s>sollte</s> .  (Hier scheine ich ein wenig aufgeregt zu sein, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://">HTerm wurde</a> mit einem halben Tritt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://">aufgewickelt</a> , aber ich musste ein bisschen mit meinem Lieblings-ZOC spielen).  DarÃ¼ber hinaus kann das GerÃ¤t gemÃ¤ÃŸ der Beschreibung mithilfe des VCP-Treibers Daten mit einer Geschwindigkeit von bis zu 3686400 Baud in den COM-Port einspeisen.  Eine derart hohe Geschwindigkeit wird insbesondere durch die Ãœbertragung eines binÃ¤ren Datenstroms (fÃ¼r Abtastfrequenzen Ã¼ber 50 kHz) sichergestellt, bei ASCII-Zeichen ist die Geschwindigkeit etwas geringer. </p><br><p>  Die Aufgabe, die ich mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A</a> zu lÃ¶sen versuchen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werde,</a> ist: </p><ol><li><p>  Um Informationen Ã¼ber den dynamischen Stromverbrauch der interessierenden Knoten im entworfenen Produkt zu erhalten, verwenden Sie den Trigger-Trigger <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A</a> an den untersuchten Stellen des Programmcodes. </p></li><li><p>  Im Prozess des kontinuierlichen Betriebs der Vorrichtung, um die Akkumulation der notwendigen Fragmente fÃ¼r die anschlieÃŸende verallgemeinerte Analyse zu organisieren. </p></li></ol><br><p>  Der folgende Screenshot zeigt das aktuelle Protokoll der SD-Karte wÃ¤hrend der Datenaufzeichnung. </p><br> <a href=""><img src="https://habrastorage.org/webt/_g/t6/3h/_gt63h_pmhohs4w_q-higuefp8k.jpeg"></a> <br><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mit STM32Cube MonitorPower</a> kann nicht nur qualitativ, sondern auch der Energieverbrauch des untersuchten GerÃ¤ts quantifiziert werden.  Die minimalen, maximalen, durchschnittlichen Werte des verbrauchten Stroms und des integrierten Energiewertes werden im unteren Teil des Bildes angezeigt.  Solche Daten sind sowohl fÃ¼r die gesamte Messung als auch fÃ¼r das ausgewÃ¤hlte Fragment verfÃ¼gbar. </p><br><p>  In der Bedienungsanleitung wird darauf hingewiesen, dass die TriggerauslÃ¶sung der Messung durch einen Impuls am Bein des D7-Arduino-Schildes erfolgt.  Wie sich herausstellte, funktioniert nur ein einziger Start des Prozesses mit anschlieÃŸender kontinuierlicher Aufzeichnung.  Ein Versuch, einen Start-Stopp-Modus fÃ¼r die Stromaufzeichnung (an beiden Fronten des Impulses) zu organisieren, war erfolglos.  Das heiÃŸt, sobald die Aufnahme an der richtigen Stelle an der ansteigenden Front beginnt, ist es nicht mÃ¶glich, den Prozess mit einer abfallenden Front des Impulses zu verlangsamen.  Und das ist nicht ganz das, was ich von diesem GerÃ¤t erwartet habe. </p><br><div class="spoiler">  <b class="spoiler_title">Ein vollstÃ¤ndig gesteuerter Start-Stopp-Modus kann Ã¼ber die Befehlsfolge aus dem Terminalprogramm eingestellt werden</b> <div class="spoiler_text"><table cellpadding="2"><tbody><tr><td><p>  das Team </p></td><td><p>  die Beschreibung </p></td></tr><tr><td><p>  htc </p></td><td><p>  Host-Steuerungserfassung </p></td></tr><tr><td><p>  Volt 3300-03 </p></td><td><p>  Versorgungsspannung am gemessenen Kanal 3300 mV </p></td></tr><tr><td><p>  acqtime 0 </p></td><td><p>  kontinuierliche Messung ohne zeitliche Begrenzung </p></td></tr><tr><td><p>  Frequenz 10000 </p></td><td><p>  Abtastfrequenz 10 kHz </p></td></tr><tr><td><p>  starten </p></td><td><p>  Beginn der Messung </p></td></tr><tr><td><p>  ... </p></td><td><p>  Messung (Daten werden in das Terminal eingegossen) </p></td></tr><tr><td><p>  hÃ¶r auf </p></td><td><p>  Ende der Messung </p></td></tr></tbody></table></div></div><br><p>  Das Problem ist, dass dies eine manuelle Steuerung ist, die nicht mit den Ereignissen in der Zielsteuerung synchronisiert ist.  NatÃ¼rlich kÃ¶nnen Sie versuchen, die angegebene Befehlsfolge auf der Seite des zu untersuchenden GerÃ¤ts zu bilden, nicht auf dem Host, aber dann wird auch der Datenausgabestream von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A</a> in den Controller gestreut, und es ist nicht klar, was mit ihnen zu tun ist, und die Umleitung der Ausgabe "irgendwo_ an einen anderen Ort" ist ebenfalls nicht verfÃ¼gbar ( Obwohl sich UART Tx- und Rx-Pins auf der Platine befinden, werden diese im Handbuch als "reserviert" angezeigt und sind wahrscheinlich nicht an der aktuellen Firmware-Version beteiligt.  Ich bin wie folgt aus dieser Situation herausgekommen: </p><br><div class="spoiler">  <b class="spoiler_title">Die folgende Befehlsfolge wird auf der Hostseite (Computer) gebildet</b> <div class="spoiler_text"><table cellpadding="4"><tbody><tr><td><p>  das Team </p></td><td><p>  die Beschreibung </p></td></tr><tr><td><p>  htc </p></td><td><p>  Host-Steuerungserfassung </p></td></tr><tr><td><p>  Volt 3300-03 </p></td><td><p>  Versorgungsspannung am gemessenen Kanal 3300 mV </p></td></tr><tr><td><p>  <em><strong>acqtime 1</strong></em> </p></td><td><p>  Messdauer <br>  (Ein Bereich von 10 Î¼s bis 10 Sekunden kann verwendet werden.) </p></td></tr><tr><td><p>  <em><strong>trigsrc d7</strong></em> </p></td><td><p>  Synchronisation des Messbeginns mit steigender Flanke <br>  Impuls an Pin D7 </p></td></tr><tr><td><p>  Frequenz 10000 </p></td><td><p>  Abtastfrequenz 10 kHz </p></td></tr><tr><td><p>  starten </p></td><td><p>  Beginn der Messung </p></td></tr><tr><td><p>  ... </p></td><td><p>  Messung (Daten beginnen am Rand des Impulses und hÃ¶ren auf <br>  nach der in acqtime angegebenen Zeit einfÃ¼llen) </p></td></tr></tbody></table></div></div><br><p>  Jetzt werden die Daten stapelweise und nicht mehr kontinuierlich erfasst.  Mit diesem Ansatz kÃ¶nnen Sie den Verbrauch der Schaltung an verschiedenen Stellen des Programms und in verschiedenen Zeitintervallen untersuchen, die ziemlich weit voneinander entfernt sind.  Das heiÃŸt, wenn Informationen Ã¼ber den Energieverbrauch eines GerÃ¤ts gesammelt werden mÃ¼ssen, das eine Stunde (Tag, Woche) arbeitet, mÃ¼ssen Sie keinen kontinuierlichen Stream und sogar mit einer maximalen Abtastrate schreiben und dann dieses Durcheinander verstehen, sondern nur den oben genannten Betriebsalgorithmus bereitstellen.  Und wenn das Terminalprogramm Zeitmarkierungen in sein Protokoll schreibt, wie in der folgenden Abbildung gezeigt, ist es recht einfach, den Ereignisverlauf aus einer solchen Datei zu analysieren. </p><br> <a href=""><img src="https://habrastorage.org/webt/pu/0j/cp/pu0jcpgvy-7wnmcgipzauzjjlw0.jpeg"></a> <br><br><p>  Es ist wie ein Videorecorder mit Bewegungserkennung und Zeitstempeln. </p><br><p>  Lassen Sie mich ein paar Screenshots geben, die mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A aufgenommen wurden</a> .  Der erste ist der Stromverbrauch des Controllers beim Lesen von Daten vom eingebauten ADC.  32 Werte werden per Timer-Interrupt mit einer Frequenz von 4 kHz gelesen und gespeichert. </p><br> <a href=""><img src="https://habrastorage.org/webt/yu/d-/lz/yud-lz-ormre9rvdr9pqklka9e4.jpeg"></a> <br><br><p>  Beim zweiten - Ã¤hnliches Lesen und Speichern von Daten, aber nur die Steuerung "lÃ¤sst sich nach jeder Messung" schlafen ", bis der nÃ¤chste Timer-Interrupt auftritt, wobei einer der verfÃ¼gbaren Energiesparmodi verwendet wird. </p><br> <a href=""><img src="https://habrastorage.org/webt/zb/ze/zu/zbzezucrkjdtpxou_jll9hk3owm.jpeg"></a> <br><br><p>  Ein signifikantes Delta der Stromaufnahme wÃ¤hrend der Messung, ~ 6 mA, ist sofort erkennbar.  Diese beiden Beispiele erheben keinen Anspruch auf Optimierung des Stromverbrauchs von GerÃ¤ten mit geringem Stromverbrauch, sondern demonstrieren nur die LeistungsfÃ¤higkeit des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X-NUCLEO-LPM01A</a> , der StrÃ¶me ab 1 nA messen kann. </p><br><p>  AbschlieÃŸend mÃ¶chte ich sagen, dass dieses Devkit meiner bescheidenen Meinung nach ein perfekt geeignetes Werkzeug zu sein scheint, das seinen rechtmÃ¤ÃŸigen Platz neben dem Oszilloskop und dem Logiksignalanalysator auf dem Einbettungstisch einnehmen kann.  Die Verwendung des beschriebenen Ansatzes ermÃ¶glicht es nicht nur, den Appetit des Controllers bei der Entwicklung leistungskritischer GerÃ¤te zu â€mildernâ€œ, sondern auch die Dynamik von Prozessen in den verschiedenen Energiesparmodi, die von Entwicklern moderner elektronischer GerÃ¤te aktiv genutzt werden, besser zu verstehen. </p><br><p>  Die Kosten fÃ¼r das Board - mehr als 7000 Rubel - Ã¼berschatten den Regenbogen des Bildes, aber kann eine so unbedeutende Menge in der heutigen Zeit einen echten Geek davon abhalten, dieses wunderbare Devkit zu besitzen? </p><br><p>  PS Trotz des Hinweises in UM, dass UART fÃ¼r zukÃ¼nftige Anwendungen reserviert ist, habe ich mich immer noch daran gehalten und festgestellt, dass es als zweite Schnittstelle (E / A wird von VCP dupliziert) mit einer Geschwindigkeit von 921600 8N1 ausgefÃ¼hrt wird und als Befehl verwendet werden kann Start und Stopp fÃ¼r den Anfang - das Ende der Messung.  Der Nachteil dieses Ansatzes ist die obligatorische VerfÃ¼gbarkeit von freiem UART auf der Seite des untersuchten Controllers, ganz zu schweigen von der Tatsache, dass 921600 Bauds bei niedrigen Taktfrequenzen hÃ¤ufig unmÃ¶glich sind. </p><br><p>  PPS Bereits nach dem Schreiben des Artikels bemerkte ich einen Unterschied in den letzten Bildern von ~ 2 mA am Eingang zur Messung und am Ende.  Ich habe die ADC-Taktung wahrscheinlich nicht ausgeschaltet oder den Timer zum Arbeiten gelassen, aber das ist, wie Leonid Kanevsky gerne sagt: "Eine ganz andere Geschichte" ... </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de441668/">https://habr.com/ru/post/de441668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de441648/index.html">EinfÃ¼hrung in Microsoft HoloLens 2</a></li>
<li><a href="../de441650/index.html">Webinar Group-IB â€Forensische Sicht auf den Schutz von CII-Objekten im Jahr 2019â€œ</a></li>
<li><a href="../de441654/index.html">Wie mache ich ein Praktikum bei einem groÃŸen IT-Unternehmen?</a></li>
<li><a href="../de441660/index.html">STM32F103C8T6 als Flash-Laufwerk mit FAT12-Dateisystem</a></li>
<li><a href="../de441664/index.html">Linus Torvalds glaubt nicht, dass Server in der ARM-Architektur x86 ersetzen werden. "Verkauf eines 64-Bit-Modells - Idiotie"</a></li>
<li><a href="../de441674/index.html">Testlayout? Einfach</a></li>
<li><a href="../de441676/index.html">Wie man Freunde PLUTO und HDSDR macht</a></li>
<li><a href="../de441678/index.html">Spieltornado-Physik: Wie Aerodynamik in Just Cause 4 (Verkehr) implementiert wird</a></li>
<li><a href="../de441680/index.html">Lua In Moskau 2019 Konferenzprogramm</a></li>
<li><a href="../de441682/index.html">HyperX Fury 3D - SSD mit klarem Stammbaum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>