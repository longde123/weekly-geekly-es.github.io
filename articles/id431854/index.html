<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😻 🤘🏽 ☹️ Konsistensi data dalam sistem yang sarat muatan 🚺 🐩 🍕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Masalah 
 Hampir semua sistem informasi membutuhkan penyimpanan data secara berkelanjutan. Di sebagian besar sistem dengan beban kecil dan menengah, f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Konsistensi data dalam sistem yang sarat muatan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431854/"><h2>  Masalah </h2><br>  Hampir semua sistem informasi membutuhkan penyimpanan data secara berkelanjutan.  Di sebagian besar sistem dengan beban kecil dan menengah, fungsi ini dilakukan oleh DBMS relasional, yang keunggulannya tidak dapat disangkal adalah jaminan konsistensi data. <br><br>  Contoh klasik yang menjelaskan apa itu konsistensi data - operasi transfer dana dari satu akun ke akun lainnya.  Pada saat operasi mengubah saldo dari satu akun telah selesai dan yang lain belum punya waktu, kegagalan dapat terjadi.  Kemudian dana akan didebit dari satu akun, tetapi tidak akan dikreditkan ke akun lain.  Keadaan sistem data ini disebut tidak konsisten, dan, mungkin, tidak perlu menjelaskan apa akibatnya.  DBMS relasional menyediakan mekanisme transaksi yang menjamin konsistensi data pada waktu tertentu.  Suatu transaksi adalah serangkaian operasi terbatas yang mentransfer satu status konsisten ke status konsisten lainnya. <a name="habracut"></a>  Jika terjadi kesalahan pada langkah apa pun, DBMS membatalkan semua operasi yang dilakukan sebelumnya dan mengembalikan data ke kondisi semula yang disepakati.  Dengan kata lain, semua operasi akan dilakukan, atau tidak satu pun. <br><br>  Adapun sistem skala besar, jauh dari selalu mungkin untuk menggunakan satu database di dalamnya karena beban yang terlalu berat.  Dalam kasus seperti itu, setiap modul sistem (layanan) disediakan dengan basis datanya sendiri yang terpisah.  Dalam kasus ini, muncul pertanyaan bagaimana memastikan konsistensi data untuk arsitektur cluster tersebut. <br><br><h2>  Memecahkan Konsistensi Data </h2><br>  Salah satu solusinya adalah transaksi terdistribusi.  Pertama, semua node cluster harus menyetujui bahwa operasi itu mungkin, maka perubahan dilakukan ke semua node.  Karena node tidak memiliki perangkat penyimpanan umum, satu-satunya cara untuk mencapai pendapat umum adalah dengan menyetujui menggunakan beberapa protokol konsensus terdistribusi. <br><br>  Protokol sederhana untuk menangkap transaksi global adalah komitmen dua fase (2PC).  Node yang melakukan transaksi dianggap sebagai koordinator.  Pada tahap persiapan (persiapan), koordinator memberi tahu node lain tentang komit transaksi dan menunggu konfirmasi dari mereka bahwa mereka siap berkomitmen.  Jika setidaknya satu node tidak siap, transaksi terputus.  Pada fase komit, koordinator menginformasikan semua node keputusan untuk melakukan transaksi.  Setelah menerima konfirmasi dari semua orang bahwa semuanya baik-baik saja, koordinator juga menangkap transaksi. <br><br><img src="https://access.redhat.com/webassets/avalon/d/JBoss_Enterprise_Application_Platform-5-Transactions_Development_Guide-en-US/images/721547b5fb5ee9da94ec3200cb1231fe/fig-two-phase-commit-overview.png" alt="gambar"><br><br><h4>  Gambar 1 - Skema umum dari komitmen dua fase </h4><br>  Protokol ini menghindari pesan minimum, tetapi tidak kuat.  Misalnya, jika koordinator gagal setelah fase persiapan, node yang tersisa tidak memiliki informasi tentang apakah transaksi harus dilakukan atau dibatalkan (mereka harus menunggu kegagalan diperbaiki).  Kelemahan serius lain dari 2PC (dan protokol transaksi terdistribusi lainnya, misalnya 3PC) adalah bahwa ketika jumlah node cluster bertambah, kinerja dari komitmen dua fase menurun. <br><br><img src="http://www.techort.com/wp-content/uploads/2018/10/1539271021_859_data-integrity-in-microservice-architecture-how-to-ensure-it-without-distributed-transactions-and-tight-connectivity-avito-habr-blog.png" alt="gambar"><br><br><h4>  Gambar 2 - Ketergantungan kecepatan komit dua-basis pada jumlah server dalam cluster DBMS </h4><br>  Selain itu, pendekatan transaksi terdistribusi memberlakukan batasan: semua modul sistem harus menggunakan DBMS yang sama, yang tidak selalu nyaman. <br><br>  Pilihan lain adalah menyediakan mekanisme yang memungkinkan Anda untuk bekerja dengan basis data berbeda (untuk layanan) sebagai satu basis data (untuk menyelesaikan masalah dengan integritas data dalam basis data terdistribusi).  Pada saat yang sama, analog tertentu dari suatu transaksi untuk sistem terdistribusi ("transaksi bisnis") diperlukan. <br><br>  Dalam transaksi biasa, serta dalam komitmen dua fase, semua operasi dikendalikan oleh mekanisme transaksi (menggunakan kunci), dan ini dilakukan untuk memberikan kemampuan untuk memutar kembali operasi apa pun (pendekatan pesimistis - kami menganggap setiap operasi berpotensi menyebabkan kegagalan).  Ini adalah hambatan dari sistem.  Alternatifnya adalah apa yang disebut pendekatan optimis: kami percaya bahwa sebagian besar operasi diselesaikan dengan sukses.  Kami juga melakukan tindakan tambahan atas fakta kegagalan.  Yaitu  mengurangi biaya untuk sebagian besar operasi, yang mengarah pada peningkatan produktivitas. <br><br><h2>  Apa itu Saga dan bagaimana cara kerjanya </h2><br>  Alternatif transaksi untuk arsitektur layanan mikro adalah Saga.  Saga (saga) adalah serangkaian langkah yang dilakukan oleh berbagai modul sistem (layanan);  Layanan saga juga diperlukan, yang bertanggung jawab untuk operasi (transaksi bisnis) secara keseluruhan.  Langkah-langkah dihubungkan melalui grafik acara.  Setelah saga selesai, sistem harus pergi dari satu negara yang disepakati ke negara lain (jika eksekusi berhasil), atau kembali ke negara yang disepakati sebelumnya (jika terjadi pembatalan). <br><br>  Bagaimana cara menerapkan pengembalian atau kemunduran dari transaksi bisnis?  Untuk melakukan ini, hikayat ini menggunakan mekanisme pembatalan langkah-langkah (tindakan kompensasi).  Misalnya, salah satu langkah berhasil (misalnya, entri ditambahkan ke tabel database pengguna), tetapi salah satu langkah berikut gagal, dan seluruh kisah harus dibatalkan.  Kemudian layanan yang sama menerima perintah - batalkan tindakan.  Namun dalam DBMS layanan, transaksi lokal telah selesai, catatan pengguna telah ditambahkan.  Kemudian, untuk kembali ke keadaan sebelumnya, layanan harus melakukan tindakan kompensasi (dalam contoh kami, hapus catatan).  Pembatalan langkah-langkah memungkinkan atomicity ("semua atau tidak sama sekali") diimplementasikan dalam kerangka saga - semua langkah dilakukan atau dikompensasi. <br><br><img src="https://cdn-images-1.medium.com/max/1200/1*IUfYVaCXhQHWqM13_6sLhQ.png" alt="gambar"><br><br><h4>  Gambar 3 - Mekanisme Saga dan sifat dari efek kompensasi </h4><br>  Pada Gambar 3, langkah-langkah saga ditetapkan sebagai T1 ... T4, tindakan kompensasi: C1 ... C4. <br>  Sagas mendukung idempotensi langkah (tindakan yang pengulangan berulangnya setara dengan satu langkah).  Pendekatan sag memberikan kesempatan untuk mengulangi langkah apa pun (misalnya, jika Anda tidak menerima respons atas penyelesaian yang berhasil).  Idempotency juga memungkinkan Anda untuk memulihkan keadaan saat data hilang pada sembarang simpul (kegagalan dan pemulihan).  Saat melakukan langkah, setiap layanan harus menentukan (dengan kunci idempotency) apakah sudah melakukan langkah ini atau tidak (jika tidak, jalankan, atau lewati).  Untuk tindakan kompensasi, dimungkinkan juga untuk menambahkan kunci idempotensi dan pengulangan operasi (memastikan kegigihan / stabilitas). <br><br><h2>  Ringkasan </h2><br>  Dari empat persyaratan untuk sistem transaksi ACID (atomisitas, konsistensi, isolasi, stabilitas), mekanisme penurunan memungkinkan tiga untuk dilaksanakan - semua kecuali isolasi.  Kurangnya isolasi dapat menyebabkan anomali ("bacaan kotor", "bacaan yang tidak dapat diulang", menulis ulang perubahan antara transaksi bisnis yang berbeda, dll.).  Untuk mengatasi situasi seperti itu, diperlukan untuk menggunakan mekanisme tambahan, misalnya, versi objek yang bisa berubah. <br><br>  Sagas memungkinkan Anda untuk menyelesaikan tugas-tugas berikut: <br><br><ul><li>  Berikan perubahan data dependen untuk data penting bisnis; </li><li>  Mampu menetapkan urutan langkah-langkah yang ketat; </li><li>  Mematuhi konsistensi 100% (mengoordinasikan data bahkan dalam kasus kecelakaan); </li><li>  Berikan pemeriksaan kinerja di semua tingkatan. </li></ul><br><h2>  Cakupan dan contoh aplikasi </h2><br>  Sagas sering digunakan pada sistem dengan sejumlah besar permintaan.  Misalnya, layanan email populer, jejaring sosial.  Namun, pendekatan ini dapat menemukan aplikasi dalam proyek-proyek skala kecil. <br><br>  Perusahaan kami memiliki pengalaman dalam mengembangkan sistem akuntansi untuk perusahaan besar yang dirancang untuk beberapa lusin pengguna dan semua data disimpan dalam satu DBMS relasional.  Masalah muncul ketika menerapkan perhitungan otomatis pekerjaan yang direncanakan: dalam beberapa kasus, perhitungannya sangat besar dan membutuhkan penyisipan jutaan catatan dalam tabel DBMS, yang secara signifikan memuat DBMS dan memperlambat operasi seluruh sistem. <br><br>  Sebuah solusi ditemukan - untuk menempatkan logika perhitungan kerja ke dalam layanan terpisah dengan DBMS sendiri untuk menyimpan karya itu sendiri dan objek terkait.  Konsistensi data dipastikan oleh saga.  Jika perhitungan gagal, maka modul utama aplikasi menerima perintah untuk membatalkan operasi perhitungan logis. <br><br><h2>  Pustaka yang mendukung Saga </h2><br>  Aplikasi ini dikembangkan di .Net, dan untuk teknologi ini ada beberapa perpustakaan pengelola layanan dengan dukungan untuk kisah-kisah.  Kami melihat perpustakaan NServiceBus, MassTransit, dan Rebus.  Sebagai hasilnya, kami memilih Rebus - perpustakaan ini lebih mudah dipelajari, sambil sepenuhnya menyadari prinsip saga dan bebas untuk digunakan.  NServiceBus dan MassTransit adalah alat yang lebih canggih dengan banyak fitur tambahan.  Mereka tidak diperlukan sebagai bagian dari tugas kami, tetapi mungkin disarankan untuk menggunakannya dalam proyek masa depan dengan logika yang lebih kompleks. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431854/">https://habr.com/ru/post/id431854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431844/index.html">Swift Heroes 2018. Bagaimana itu</a></li>
<li><a href="../id431846/index.html">GeekBrains mulai menyiapkan pengembang Python full-stack</a></li>
<li><a href="../id431848/index.html">Saat saya menulis naskah terbesar untuk Altium Designer</a></li>
<li><a href="../id431850/index.html">Heisenbug 2018 Moskow: siaran online gratis, pesta, dan banyak lagi</a></li>
<li><a href="../id431852/index.html">Meretas 50.000 printer jaringan dan mencetak teks arbitrer? Tidak ada yang lebih mudahǃ</a></li>
<li><a href="../id431856/index.html">Memperluas Editor Persatuan dengan Jendela Editor, Objek Skrip, dan Editor Kustom</a></li>
<li><a href="../id431858/index.html">Mitap Sbertekh di Rostov-on-Don</a></li>
<li><a href="../id431860/index.html">Pada opsi driver Linux, atau bagaimana saya menghabiskan akhir pekan</a></li>
<li><a href="../id431862/index.html">Mitap Sbertekh di Yekaterinburg</a></li>
<li><a href="../id431864/index.html">PVS-Studio ROI: bagaimana tidak kehilangan jutaan (draft versi artikel)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>