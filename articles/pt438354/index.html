<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∏ üòì üå•Ô∏è Vue, Storybook, TypeScript - iniciando um novo projeto com as melhores pr√°ticas em mente üëàüèæ üåò üëºüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(publicado originalmente no Medium ) 


 Eu gosto de escrever o c√≥digo React. Essa pode ser uma introdu√ß√£o estranha a uma hist√≥ria sobre o Vue, mas vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vue, Storybook, TypeScript - iniciando um novo projeto com as melhores pr√°ticas em mente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438354/"><p><img src="https://habrastorage.org/webt/3l/z_/hj/3lz_hjzvuh91eqfwdlcux6yluyy.png"></p><br><p>  <em>(publicado originalmente no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Medium</a> )</em> </p><br><p>  Eu gosto de escrever o c√≥digo React.  Essa pode ser uma introdu√ß√£o estranha a uma hist√≥ria sobre o Vue, mas voc√™ precisa entender meus antecedentes para entender por que estou aqui discutindo o Vue. </p><br><p>  Eu gosto de escrever c√≥digo React e odeio l√™-lo.  O JSX √© uma √≥tima id√©ia para montar as pe√ßas rapidamente, o Material-UI √© uma solu√ß√£o incr√≠vel para inicializar a interface do usu√°rio da sua pr√≥xima inicializa√ß√£o, a computa√ß√£o CSS a partir de constantes JS permite que voc√™ seja muito flex√≠vel.  No entanto, a leitura de seus JSXs antigos √© horr√≠vel - mesmo com pr√°ticas escrupulosas de revis√£o de c√≥digo, voc√™ pode co√ßar a cabe√ßa nem uma vez ao tentar entender o complexo agrupamento dos componentes. </p><br><p>  Ouvi muitas coisas sobre Vue - o garoto n√£o t√£o novo no quarteir√£o - e finalmente decidi me molhar;  trazendo toda a minha bagagem mental de React e Polymer (e Angular, mas n√£o vamos falar sobre isso). </p><a name="habracut"></a><br><p> O Vue √© muito parecido com o Polymer, mais ainda pelos autores o nomeiam como uma das fontes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inspira√ß√£o</a> .  A estrutura dos arquivos <code>*.vue</code> parecia as melhores partes do Polymer e eu mergulhei direto.  Poucos dias depois, sa√≠ do p√¢ntano do desenvolvimento de texto datilografado, orientado √† interface do usu√°rio e in√∫meras pr√°ticas recomendadas e estou pronto para compartilhar o que encontrei. </p><br><h2 id="lets-go">  Vamos l√°! </h2><br><p>  Usaremos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npx</a> para executar os comandos.  Se voc√™ ainda n√£o possui o npx, veja como obt√™-lo: <code>npm install -g npx</code> .  Npx √© um salva-vidas quando voc√™ lida com os pacotes npm cli e n√£o deseja <code>npm install -g</code> dezenas de aplicativos.  Voc√™ tamb√©m precisar√° do Yarn se n√£o o tiver - o <code>npm install -g yarn</code> deve <code>npm install -g yarn</code> lo. </p><br><pre> <code class="plaintext hljs">$ npx vue create not-a-todo-app Vue CLI v3.3.0 ? Please pick a preset: Manually select features ? Check the features needed for your project: Babel, TS, PWA, Router, Vuex, CSS Pre-processors, Linter, Unit, E2E ? Use class-style component syntax? Yes ? Use Babel alongside TypeScript for auto-detected polyfills? Yes ? Use history mode for router? (Requires proper server setup for index fallback in production) Yes ? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Sass/SCSS ? Pick a linter / formatter config: TSLint ? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Lint on save ? Pick a unit testing solution: Jest ? Pick a E2E testing solution: Cypress ? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In dedicated config files ? Save this as a preset for future projects? No</code> </pre> <br><p>  Vue Cli tem um bom assistente para gui√°-lo;  neste tutorial, usaremos o modo manual e ativaremos <strong>todos os recursos</strong> .  Excesso?  Talvez, mas queremos ver como o Vue funciona com tudo o que pode oferecer imediatamente.  Ainda assim, vamos analisar as op√ß√µes e a raz√£o de como e por qu√™. </p><br><p>  Precisamos de <strong>Babel</strong> e <strong>TypeScript</strong> habilitados.  O TS ser√° o idioma principal de escolha e o Babel suportar√° o processamento de c√≥digo externo que requer transpila√ß√£o.  Voc√™ pode argumentar que o TypeScript tamb√©m pode transpilar o c√≥digo JS e, de fato, √© esse o caso, mas em meus experimentos (especialmente relacionados ao teste de unidade e ao Vuetify), achei muito melhor manter TS para <code>*.ts</code> e usar Babel para todo o resto. </p><br><p>  <strong>Os pr√©-processadores CSS</strong> ser√£o √∫teis para o Vuetify;  Embora seja fornecido com CSS pr√©-minificado, conv√©m incluir os arquivos de <code>styl</code> originais para trabalhar com estilos.  <strong>Linter / Formatter</strong> √© um requisito √≥bvio para qualquer novo projeto (voc√™ deve aderir a um estilo de c√≥digo √∫nico e pode me agradecer em um ano quando ler seu c√≥digo antigo).  <strong>Ativamos o teste de</strong> <strong>unidade</strong> e o <strong>teste</strong> <strong>E2E -</strong> embora voc√™ n√£o queira fazer os casos de teste completos do e2e, √© √∫til saber como corrigi-los depois de concluirmos o Vuetify. </p><br><p>  <strong>O suporte para o Progressive Web App (PWA)</strong> , o <strong>roteador</strong> e o <strong>Vuex</strong> n√£o s√£o estritamente necess√°rios para este tutorial e n√£o os usaremos, mas habilit√°-los simplificar√° sua vida em um projeto real. </p><br><p>  <strong>Usar sintaxe de componente no estilo de classe?</strong>  Sim  As classes tornam o c√≥digo um pouco mais volumoso, mas mais leg√≠vel e f√°cil de raciocinar;  eles tamb√©m facilitam sua vida TypeScript. </p><br><p>  <strong>Usar o Babel ao lado do TypeScript para polyfills detectados automaticamente?</strong>  Sim  Queremos Babel e TS para o caso que examinaremos mais adiante. </p><br><p>  <strong>Usar o modo hist√≥rico para o roteador?</strong>  Sim (mas YMMV).  N√£o escreveremos nenhum back-end para servir isso na produ√ß√£o, mas geralmente √© uma boa ideia usar a API de hist√≥rico. </p><br><p>  <strong>Escolha um pr√©-processador CSS (PostCSS, Autoprefixer e CSS Modules s√£o suportados por padr√£o):</strong> usaremos apenas m√≥dulos CSS neste tutorial, para que voc√™ possa escolher sass / less / stylus com base em suas prefer√™ncias. </p><br><p>  <strong>Escolha uma configura√ß√£o de linter / formatador:</strong> TSlint √© uma escolha √≥bvia, pois queremos usar o TypeScript o m√°ximo poss√≠vel. </p><br><p>  <strong>Escolha recursos adicionais de fiapos:</strong> ative os dois ( <code>a</code> ).  Linting √© bom. </p><br><p>  <strong>Escolha uma solu√ß√£o de teste de unidade:</strong> este tutorial se concentra no Jest, portanto voc√™ deve selecion√°-lo. </p><br><p>  <strong>Escolha uma solu√ß√£o de teste E2E:</strong> este tutorial se concentra no Cypress. </p><br><p>  <strong>Onde voc√™ prefere colocar a configura√ß√£o para Babel, PostCSS, ESLint, etc.?</strong>  Voc√™ n√£o acha que √© meio estranho que todos tentem colocar ainda mais coisas no <code>package.json</code> ?  O arquivo mal pode ser lido do jeito que est√° agora.  Use arquivos de configura√ß√£o dedicados - eles s√£o muito mais f√°ceis de trabalhar e seu hist√≥rico do git ser√° mais bonito. </p><br><p>  Hora de verificar a configura√ß√£o, execute o <code>yarn serve</code> : <br><img src="https://habrastorage.org/webt/5p/ak/ty/5paktyugcycg2dzdtjt1ss1vfoi.png"></p><br><p>  N√£o deve haver erros no console e a navega√ß√£o para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 8080 / o</a> receber√° com: <br><img src="https://habrastorage.org/webt/z4/hj/hv/z4hjhvcto1oaxdxokxi5rmuzque.png"></p><br><p>  Verificando os testes de unidade, execute o <code>yarn test:unit</code> : <br><img src="https://habrastorage.org/webt/gd/v1/i1/gdv1i1hpoxsejeovp1bvbc4jnbg.png"></p><br><p>  E trabalho de teste e2e ( <code>yarn test:e2e --headless</code> ): <br><img src="https://habrastorage.org/webt/_p/td/ho/_ptdhoshlgew083bq7hfaapmvnu.png"></p><br><p>  √ìtimo!  Passando para a interface do usu√°rio. </p><br><h2 id="the-material-dilemma">  O dilema material </h2><br><p>  Existem algumas bibliotecas de UI de material para o Vue com um n√≠vel diferente de flexibilidade e aprimoramento.  Certamente, existem dezenas de outras bibliotecas de componentes, portanto voc√™ pode usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bootstrap Vue,</a> se quiser.  Este tutorial se concentra no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vuetify</a> por v√°rios motivos: </p><br><ul><li>  √© a biblioteca de materiais mais estrelada no GitHub; </li><li>  foi uma pena real faz√™-lo funcionar, por isso √© uma √≥tima demonstra√ß√£o de todos os casos extremos nos quais voc√™ pode trope√ßar. </li></ul><br><p>  Convencido?  Prossiga com a instala√ß√£o e: <code>vue add vuetify</code> .  Selecione a op√ß√£o <strong>Configurar (avan√ßado)</strong> . </p><br><p>  <strong>Usar um modelo pr√©-fabricado?</strong>  O Vuetify substituir√° App.vue padr√£o e HelloWorld.vue.  Responda sim a isso, pois √© um novo projeto. </p><br><p>  <strong>Usar tema personalizado?</strong>  Sim  Voc√™ precisar√° de um mais cedo ou mais tarde, ent√£o vamos configur√°-lo.  Pelas mesmas raz√µes, responda sim para <strong>Usar propriedades personalizadas (vari√°veis ‚Äã‚ÄãCSS)?</strong>  . </p><br><p>  <strong>Selecione a fonte do √≠cone:</strong> √çcones dos materiais (mas tamb√©m mostrarei como corrigi-lo no Font Awesome mais tarde).  <strong>Usar fontes como uma depend√™ncia?</strong>  N√£o.  Obteremos as fontes da CDN. </p><br><p>  <strong>Use componentes √† la carte?</strong>  Sim  Essa parece ser a maneira mais f√°cil de usar o Vuetify. <br><img src="https://habrastorage.org/webt/w1/aa/v9/w1aav901fzrpaeqnnvluidjoufu.png"></p><br><p>  H√° v√°rias mudan√ßas, mas o mais importante √© que, quando voc√™ executa o <code>yarn serve</code> agora ver√° uma imagem diferente: <br><img src="https://habrastorage.org/webt/3l/z_/hj/3lz_hjzvuh91eqfwdlcux6yluyy.png"></p><br><p>  (voc√™ tamb√©m receber√° uma d√∫zia de avisos no seu linter). </p><br><p>  Vamos verificar os testes de unidade ... <br><img src="https://habrastorage.org/webt/ov/ks/29/ovks2927ibmuxyxblnxamj_jyb8.png"></p><br><h2 id="making-vuetify-work-with-unit-and-e2e-tests">  Fazendo o Vuetify funcionar com testes de unidade e e2e </h2><br><p>  Vamos verificar <code>./tests/unit/example.spec.ts</code> .  O teste verifica se a <em>mensagem</em> exibe " <em>nova mensagem</em> ", mas o modelo que acompanha o Vuetify n√£o suporta mais esse suporte.  Em uma situa√ß√£o do mundo real, voc√™ removeria o componente HelloWorld e seu teste, mas aqui atualizamos a mensagem para procurar algo que esteja no componente: </p><br><pre> <code class="plaintext hljs">const msg = 'Welcome to Vuetify';</code> </pre> <br><p>  Agora o teste passa (verifique com o <code>yarn test:unit</code> ), mas ainda h√° uma boa d√∫zia de avisos semelhantes a </p><br><pre> <code class="plaintext hljs">[Vue warn]: Unknown custom element: &lt;v-layout&gt; - did you register the component correctly? For recursive components, make sure to provide the "name" option.</code> </pre> <br><p>  Da maneira como o Vuetify funciona, ele adiciona <code>./src/plugins/vuetify.ts</code> que configura o Vuetify como parte do aplicativo.  Este arquivo √© origens de <code>./src/main.ts</code> .  Infelizmente o <code>main.ts</code> √© ignorado quando voc√™ executa testes de unidade. </p><br><p>  Primeiro, vamos corrigir os erros e avisos no <code>vuetify.ts</code> gerado. </p><br><p>  Abra seu <code>./tsconfig.json</code> e adicione <code>vuetify</code> √† se√ß√£o <code>compilerOptions.types</code> : </p><br><pre> <code class="plaintext hljs"> "types": [ "webpack-env", "vuetify", "jest" ],</code> </pre> <br><p>  Isso informa ao compilador TypeScript de onde obter os tipos Vuetify e o erro em <code>./src/plugins/vuetify.ts</code> desaparece.  Vamos corrigir alguns avisos de estilo para limp√°-lo: </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Agora precisamos carregar o Vuetify no contexto de nossos testes de unidade.  Crie um novo arquivo em <code>./tests/jest-setup.js</code> com o seguinte conte√∫do: </p><br><pre> <code class="plaintext hljs">import '@/plugins/vuetify';</code> </pre> <br><p>  e atualize <code>./jest.config.js</code> para carreg√°-lo: </p><br><pre> <code class="plaintext hljs">module.exports = { ... setupFiles: ['./tests/jest-setup.js'], }</code> </pre> <br><p><img src="https://habrastorage.org/webt/xi/xk/-h/xixk-hz2bwqbiqo5_nlxo1ahgq8.png"></p><br><p>  Os testes ainda falham, mas de uma maneira um tanto enigm√°tica.  O que aconteceu? </p><br><p>  <code>vuetify/lib</code> √© uma fonte bruta n√£o processada do Vuetify, que inclui itens como m√≥dulos ES.  O Jest executa transforma√ß√µes apenas para o seu c√≥digo-fonte por padr√£o, o que significa que ele ignora tudo em <code>node_modules</code> .  Mais ainda, j√° que dissemos ao Vue para usar o TypeScript, o gracejo n√£o est√° configurado para transpilar JS. </p><br><p>  Para corrigir isso, precisamos fazer duas altera√ß√µes em <code>./jest.config.js</code> : </p><br><pre> <code class="plaintext hljs">module.exports = { ... transform: { '^.+\\.vue$': 'vue-jest', '.+\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$': 'jest-transform-stub', '^.+\\.tsx?$': 'ts-jest', '^.+\\.jsx?$': 'babel-jest', // &lt;-- (1) }, transformIgnorePatterns: [ 'node_modules/(?!(vuetify)/)', // &lt;-- (2) ], }</code> </pre> <br><p>  Em <strong>(1)</strong> dizemos ao Jest para transformar qualquer arquivo <code>*.js</code> ou <code>*.jsx</code> com Babel (e Babel √© pr√©-configurado para n√≥s por Vue Cli), mas o que √© <strong>(2)</strong> ?  <code>transformIgnorePatterns</code> especifica os caminhos que o Jest ignorar√° ao transpilar c√≥digo e, como observei anteriormente, o padr√£o inclui <code>node_modules</code> .  Aqui, substitu√≠mos o padr√£o por um regex enigm√°tico <code>node_modules/(?!(vuetify)/)</code> que significa "ignore qualquer caminho que comece com <code>node_modules/</code> menos que seja seguido por <code>vuetify</code> ": <br><img src="https://habrastorage.org/webt/7e/z_/yi/7ez_yimfw1mdrnxxm0didej0piq.png"></p><br><p>  Observe como os dois primeiros caminhos t√™m uma correspond√™ncia, mas o terceiro n√£o.  Esse truque ser√° √∫til quando adicionarmos o Storybook, mas por enquanto. </p><br><p>  Executando os testes novamente ... <br><img src="https://habrastorage.org/webt/p9/yy/sa/p9yysa_dproyxl5wtyovsh0p6f8.png"></p><br><p>  Os elementos personalizados desconhecidos est√£o de volta;  mas pelo menos compila e executa com sucesso.  O Vuetify √© transpilado, mas ainda precisamos registrar os componentes manualmente.  Existem algumas op√ß√µes sobre como fazer isso ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">verifique os documentos para outras op√ß√µes</a> );  o que faremos aqui √© importar os componentes necess√°rios para o escopo global do Vue.  Abra <code>./src/plugins/vuetify.ts</code> novamente e atualize-o para: </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify, { VFlex, VLayout, VContainer, VImg } from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { components: { VFlex, VLayout, VContainer, VImg }, theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Finalmente, os testes passam: <br><img src="https://habrastorage.org/webt/5f/7s/n1/5f7sn17rr8sk9ei5pgib4x3kc_0.png"></p><br><p>  Os testes do E2E tamb√©m falhar√£o ( <code>yarn test:e2e --headless</code> ), mas √© devido a <code>./tests/e2e/specs/test.js</code> √† procura de uma string que n√£o existe mais.  Os testes E2E ativam seu aplicativo real em um navegador real, para que n√£o haja c√≥digo a ser corrigido - o Vuetify est√° definido no seu aplicativo.  Corrija o <code>test.js</code> para procurar o novo cabe√ßalho: </p><br><pre> <code class="plaintext hljs">cy.contains('h1', 'Welcome to Vuetify')</code> </pre> <br><p>  e ficar√° verde novamente. </p><br><p>  Vamos recapitular.  Adicionamos o Vuetify, corrigimos os testes de unidade e e2e para lidar com um novo modelo e atualizamos o Jest para transpilar o c√≥digo-fonte do Vuetify e carreg√°-lo.  Nossa aplica√ß√£o √© funcional e podemos usar v√°rios componentes materiais.  Passando para as hist√≥rias! </p><br><h2 id="storybooks">  Livros de hist√≥rias </h2><br><p>  Os livros de hist√≥rias s√£o uma id√©ia brilhante: voc√™ escreve seus casos de teste da perspectiva do designer: pequenos componentes para o aplicativo completo.  Voc√™ pode argumentar com o fluxo de dados, garantir que tudo pare√ßa exatamente como o seu designer de interface do usu√°rio exp√¥s no Photoshop, testar seus componentes isoladamente.  Vamos adicionar suporte ao livro de hist√≥rias! </p><br><p>  Existe um plugin de livro de hist√≥rias do Vue, mas achei que o <code>sb init</code> fornece um modelo padr√£o melhor, ent√£o vamos us√°-lo.  Execute <code>npx -p @storybook/cli sb init</code> e, ap√≥s alguns minutos, voc√™ dever√° receber um prompt para executar o <code>yarn storybook</code> .  Vamos fazer isso: <br><img src="https://habrastorage.org/webt/zl/nk/zp/zlnkzp3a8aoo-hvz9m_n8yu3moa.png"></p><br><p>  Vamos adicionar uma nova hist√≥ria!  Crie <code>./src/components/LoveButton.stories.ts</code> com o seguinte conte√∫do: </p><br><pre> <code class="plaintext hljs">import { storiesOf } from '@storybook/vue'; import LoveButton from './LoveButton.vue'; storiesOf('LoveButton', module) .add('default', () =&gt; ({ components: { LoveButton }, template: `&lt;love-button love="vue"/&gt;`, }));</code> </pre> <br><p>  (observe que voc√™ pode usar o <code>LoveButton.stories.js</code> aqui se quiser ser menos <code>LoveButton.stories.js</code> ao digitar suas hist√≥rias). </p><br><p>  O TypeScript avisa sobre os tipos ausentes que voc√™ pode corrigir com o <code>yarn add -D @types/storybook__vue</code> . </p><br><p>  Agora crie <code>./src/components/LoveButton.vue</code> com o seguinte conte√∫do: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span>favorite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span> {{love}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ts"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> Vue </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vue'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">export</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">default</span></span></span><span class="javascript"> Vue.extend({ </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">props</span></span></span><span class="javascript">: [</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'love'</span></span></span><span class="javascript">], }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Por padr√£o, o Storybook analisar√° <code>./stories</code> para suas hist√≥rias, mas muitas vezes √© mais pr√°tico manter as hist√≥rias mais pr√≥ximas de seus componentes (como fizemos).  Para contar ao livro de hist√≥rias onde procurar por eles, atualize seu <code>./.storybook/config.js</code> : </p><br><pre> <code class="plaintext hljs">import { configure } from '@storybook/vue'; const req = require.context('../src', true, /.stories.(j|t)s$/); function loadStories() { req.keys().forEach(filename =&gt; req(filename)); } configure(loadStories, module);</code> </pre> <br><p>  Agora, execute o <code>yarn storybook</code> novamente: <br><img src="https://habrastorage.org/webt/zp/et/ow/zpetowrxhyjw0fk58backjxdtj8.png"></p><br><p>  N√£o √© muito emocionante.  O console est√° cheio de avisos: <br><img src="https://habrastorage.org/webt/8r/cr/kj/8rcrkj3uud0cc8kaaya3rr1lkho.png"></p><br><p>  No entanto, sabemos o que √© isso agora.  O livro de hist√≥rias √© outro contexto "raiz" com seu pr√≥prio ponto de entrada;  ele n√£o usa <code>main.ts</code> e, como tal, n√£o carrega o Vuetify, por isso precisamos dizer a ele para fazer isso.  Atualize <code>./.storybook/config.js</code> : </p><br><pre> <code class="plaintext hljs">import { configure } from '@storybook/vue'; import '../src/plugins/vuetify'; // &lt;-- add this const req = require.context('../src', true, /.stories.(j|t)s$/); function loadStories() { req.keys().forEach(filename =&gt; req(filename)); } configure(loadStories, module);</code> </pre> <br><p>  Estamos carregando nossa configura√ß√£o existente novamente, o que garante que o Storybook use o mesmo tema do aplicativo real.  Infelizmente, o <code>yarn storybook</code> falhar√° agora: <br><img src="https://habrastorage.org/webt/lb/g0/nq/lbg0nq7fapzeztm7zfrzrhx8lz8.png"></p><br><p>  O Storybook n√£o sabe que usamos o TypeScript, por isso n√£o pode carregar o arquivo <code>vuetify.ts</code> .  Para corrigir isso, precisamos atualizar a pr√≥pria configura√ß√£o do webpack do Storybook.  Crie <code>./.storybook/webpack.config.js</code> com o seguinte conte√∫do: </p><br><pre> <code class="plaintext hljs">const ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin'); module.exports = (baseConfig, env, defaultConfig) =&gt; { defaultConfig.resolve.extensions.push('.ts', '.tsx', '.vue', '.css', '.less', '.scss', '.sass', '.html') defaultConfig.module.rules.push({ test: /\.ts$/, exclude: /node_modules/, use: [ { loader: 'ts-loader', options: { appendTsSuffixTo: [/\.vue$/], transpileOnly: true }, } ], }); defaultConfig.module.rules.push({ test: /\.less$/, loaders: [ 'style-loader', 'css-loader', 'less-loader' ] }); defaultConfig.module.rules.push({ test: /\.styl$/, loader: 'style-loader!css-loader!stylus-loader' }); defaultConfig.plugins.push(new ForkTsCheckerWebpackPlugin()) return defaultConfig; };</code> </pre> <br><p>  Isso carrega a configura√ß√£o padr√£o, adiciona <code>ts-loader</code> para arquivos TypeScript e tamb√©m adiciona suporte para less e styl (que o Vuetify usa). </p><br><p>  Os avisos ainda est√£o l√°, porque precisamos registrar os componentes que usamos.  Agora, vamos usar componentes locais para que voc√™ possa ver a diferen√ßa (em um aplicativo de produ√ß√£o real, √© muito mais simples registr√°-los no <code>vuetify.ts</code> ).  Atualize <code>./src/components/LoveButton.vue</code> : </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span>favorite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span> {{love}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ts"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> Vue </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vue'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { VBtn, VIcon } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vuetify/lib'</span></span></span><span class="javascript">; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// &lt;-- add this export default Vue.extend({ components: { VBtn, VIcon }, // &lt;-- and this props: ['love'], }); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  O livro de hist√≥rias √© atualizado ao salvar: <br><img src="https://habrastorage.org/webt/jb/eb/yn/jbebynfkavexxg2og5kbdcvtaou.png"></p><br><p>  Marginalmente melhor.  O que est√° faltando?  O instalador do Vuetify adicionou as fontes css diretamente em <code>./public/index.html</code> mas o Storybook n√£o usa esse arquivo, por isso precisamos adicionar a fonte ausente dos √≠cones dos materiais.  Crie <code>./.storybook/preview-head.hmtl</code> com o seguinte (copiando de <code>./public/index.html</code> ): </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://fonts.googleapis.com/css?family=Material+Icons"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  (existem outras maneiras de fazer o mesmo, por exemplo, usando CSS <code>@import</code> ). </p><br><p>  Voc√™ precisa reiniciar o seu <code>yarn storybook</code> de <code>yarn storybook</code> para que ele seja re-renderizado corretamente: <br><img src="https://habrastorage.org/webt/ar/pn/i2/arpni2dvklu5w-cdct4fvgtl00q.png"></p><br><p>  Muito melhor, mas ainda menor: a fonte de texto est√° incorreta porque o Vuetify espera que todos os seus componentes sejam aninhados no <code>v-app</code> que aplica os estilos de p√°gina.  Certamente n√£o podemos adicionar o <code>v-app</code> ao nosso bot√£o, ent√£o vamos decorar a hist√≥ria.  Atualize seu <code>./src/components/LoveButton.stories.ts</code> : </p><br><pre> <code class="plaintext hljs">import { storiesOf } from '@storybook/vue'; import { VApp, VContent } from 'vuetify/lib'; // &lt;-- add the import import LoveButton from './LoveButton.vue'; // add the decorator const appDecorator = () =&gt; { return { components: { VApp, VContent }, template: ` &lt;v-app&gt; &lt;div style="background-color: rgb(134, 212, 226); padding: 20px; width: 100%; height: 100%;"&gt; &lt;v-content&gt; &lt;story/&gt; &lt;/v-content&gt; &lt;/div&gt; &lt;/v-app&gt; `, }; }; storiesOf('LoveButton', module) .addDecorator(appDecorator) // &lt;-- decorate the stories .add('default', () =&gt; ({ components: { LoveButton }, template: `&lt;love-button love="vue"/&gt;`, }));</code> </pre> <br><p>  Voc√™ deve registrar o <code>VApp</code> e o <code>VContent</code> no escopo global, atualizar seu <code>./src/plugins/vuetify.ts</code> : </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify, { VFlex, VLayout, VContainer, VImg, VApp, VContent } from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { components: { VFlex, VLayout, VContainer, VImg, VApp, VContent }, theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Finalmente, o resultado √© espetacular: <br><img src="https://habrastorage.org/webt/gv/4a/nn/gv4ann-op0rqahdnqjpuzjqlgya.png"></p><br><h2 id="adding-storybook-testing">  Adicionando teste de livro de hist√≥rias </h2><br><p>  Finalmente, vamos garantir que nossas hist√≥rias sejam cobertas por testes de unidade.  Adicione as depend√™ncias necess√°rias: <code>yarn add -D @storybook/addon-storyshots jest-vue-preprocessor babel-plugin-require-context-hook</code> e crie <code>./test/unit/storybook.spec.js</code> : </p><br><pre> <code class="plaintext hljs">import registerRequireContextHook from 'babel-plugin-require-context-hook/register'; import initStoryshots from '@storybook/addon-storyshots'; registerRequireContextHook(); initStoryshots();</code> </pre> <br><p>  A configura√ß√£o do livro de hist√≥rias usa o <code>require.context</code> para coletar todas as fontes;  essa fun√ß√£o √© fornecida pelo webpack e precisamos usar o <code>babel-plugin-require-context-hook</code> para substitu√≠-lo no Jest.  Modifique seu <code>./babel.config.js</code> : </p><br><pre> <code class="plaintext hljs">module.exports = api =&gt; ({ presets: ['@vue/app'], ...(api.env('test') &amp;&amp; { plugins: ['require-context-hook'] }), });</code> </pre> <br><p>  Aqui, adicionamos o plug <code>require-context-hook</code> in <code>require-context-hook</code> se o babel for executado para testes de unidade. </p><br><p>  Finalmente, precisamos permitir que o Jest transpile os arquivos <code>*.vue</code> do livro de hist√≥rias.  Lembra-se do regex lookahead em <code>./jest.config.js</code> ?  Vamos revisit√°-lo agora: </p><br><pre> <code class="plaintext hljs">module.exports = { ... transformIgnorePatterns: [ 'node_modules/(?!(vuetify/|@storybook/.*\\.vue$))', ], }</code> </pre> <br><p>  Observe que n√£o podemos simplesmente adicionar uma segunda linha l√°.  Lembre-se de que √© um padr√£o de ignor√¢ncia; portanto, se o primeiro padr√£o ignora tudo, menos o Vuetify, os arquivos do livro de hist√≥rias j√° s√£o ignorados quando o Jest chega ao segundo regex. </p><br><p>  Os novos testes funcionam conforme o esperado: <br><img src="https://habrastorage.org/webt/dn/t6/22/dnt622f3au95rkrhcfgusnkdj_e.png"></p><br><p>  Este teste executar√° todas as suas hist√≥rias e as verificar√° nos snapshots locais em <code>./tests/unit/__snapshots__/</code> .  Para v√™-lo em a√ß√£o, voc√™ pode remover <code>&lt;v-icon&gt;favorite&lt;/v-icon&gt;</code> do componente de bot√£o e executar novamente o teste para ver se ele falha: <br><img src="https://habrastorage.org/webt/rf/oh/09/rfoh09qhni7mvf_jzsj_dmzuf_e.png"></p><br><p>  <code>yarn test:unit -u</code> atualizar√° seu instant√¢neo para o novo layout de bot√£o. </p><br><h2 id="recap">  Recapitular </h2><br><p>  Neste tutorial, aprendemos como criar um novo aplicativo Vue com o TypeScript ativado;  como adicionar a biblioteca Vuetify aos componentes da interface do usu√°rio do material.  Garantimos que nossos testes de unidade e e2e funcionem conforme o esperado.  Finalmente, adicionamos suporte para livros de hist√≥rias, criamos uma amostra de hist√≥ria e garantimos que as altera√ß√µes na interface do usu√°rio sejam cobertas por nossos testes de unidade. </p><br><h2 id="closing-thoughts">  Pensamentos finais </h2><br><p>  JS √© um mundo em movimento, as coisas mudam constantemente, novos padr√µes surgem, velhos s√£o esquecidos.  Este tutorial pode ficar obsoleto em apenas alguns meses, ent√£o, aqui est√£o algumas dicas √∫teis. </p><br><p>  Conhe√ßa o seu ferramental.  N√£o h√° problema em copiar e colar linhas do estouro de pilha at√© que seu c√≥digo funcione, mas voc√™ <strong>deve</strong> pesquisar por que a altera√ß√£o o fez funcionar posteriormente.  Leia os documentos e entenda o que exatamente a mudan√ßa faz. </p><br><p>  Se voc√™ tem algo para trabalhar, mesmo que parcialmente - fa√ßa um commit.  Mesmo que seja um trabalho em andamento, voc√™ ter√° algo a reverter, caso suas altera√ß√µes adicionais quebrem alguma coisa. </p><br><p>  Experimente!  Se algo n√£o funcionar da maneira que voc√™ pensa e os documentos dizem o contr√°rio, experimente!  O mundo do front-end √© principalmente de c√≥digo aberto, ent√£o procure as fontes de terceiros e veja se voc√™ pode mexer com seus instrumentos por dentro para adicionar o log de depura√ß√£o. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438354/">https://habr.com/ru/post/pt438354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438342/index.html">Por que engana a IA amig√°vel em Ghost Recon Wildlands</a></li>
<li><a href="../pt438346/index.html">Como eles fazem isso? Vis√£o geral das tecnologias de anonimiza√ß√£o de criptomoedas</a></li>
<li><a href="../pt438348/index.html">Como aprender a programar aos 9 anos independentemente</a></li>
<li><a href="../pt438350/index.html">Guia completo para pesquisa profissional de c√¢meras ocultas e dispositivos espi√µes</a></li>
<li><a href="../pt438352/index.html">V√≠deo da descida do ve√≠culo espacial "Yutu-2", seus primeiros metros na superf√≠cie da lua. O sono de duas semanas na lua acabou</a></li>
<li><a href="../pt438356/index.html">Arquitetura certificada Fast Track (DWFT) do SQL Server Data Warehouse: o que significa e como funciona</a></li>
<li><a href="../pt438358/index.html">Ex-agentes da NSA espionando iPhones das v√≠timas encomendados pelos Emirados √Årabes Unidos</a></li>
<li><a href="../pt438362/index.html">Como traduzimos a configura√ß√£o de nossos servi√ßos de XML para YAML</a></li>
<li><a href="../pt438364/index.html">Replica√ß√£o do primeiro embaralhador de voz digital do mundo</a></li>
<li><a href="../pt438366/index.html">Mais uma an√°lise dos tokens de hardware OATH no Azure Cloud MFA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>