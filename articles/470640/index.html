<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è´ ‚ô®Ô∏è üòî Dimensionar Elasticsearch üèáüèΩ üë®‚Äçüë©‚Äçüëß‚Äçüëß üë•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- ¬øQu√© tama√±o de cl√∫ster necesito? 
 - Bueno, depende ... (risita enojada) 
 Elasticsearch es el coraz√≥n de Elastic Stack, en el que tiene lugar toda ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dimensionar Elasticsearch</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/galssoftware/blog/470640/"><img src="https://habrastorage.org/webt/ro/ow/rs/roowrsc0jqrmwlmtiiuca083_r4.png"><br><br><blockquote>  - ¬øQu√© tama√±o de cl√∫ster necesito? <br>  - Bueno, depende ... (risita enojada) </blockquote><br>  Elasticsearch es el coraz√≥n de Elastic Stack, en el que tiene lugar toda la magia de los documentos: emisi√≥n, recepci√≥n, procesamiento y almacenamiento.  El rendimiento depende del n√∫mero correcto de nodos y la arquitectura de la soluci√≥n.  Y el precio, por cierto, tambi√©n, si su suscripci√≥n es Gold o Platinum. <br><br>  Las caracter√≠sticas principales del hardware son disco (almacenamiento), memoria (memoria), procesadores (c√≥mputo) y red (red).  Cada uno de estos componentes es responsable de la acci√≥n que Elasticsearch realiza en los documentos, que son, respectivamente, almacenamiento, lectura, computaci√≥n y recepci√≥n / transmisi√≥n.  Hablemos de los principios generales de dimensionamiento y revelemos el mismo "depende".  Y al final del art√≠culo hay enlaces a seminarios web y art√≠culos relacionados.  Vamos! <br><a name="habracut"></a><br>  Este art√≠culo se basa en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el dimensionamiento del seminario web y la planificaci√≥n de capacidad de David Moore</a> .  Complementamos su razonamiento con enlaces y comentarios para hacerlo un poco m√°s claro.  Al final del art√≠culo, una pista adicional es enlaces a materiales el√°sticos para aquellos que desean sumergirse mejor en el tema.  Si tiene buena experiencia con Elasticsearch, comparta en los comentarios c√≥mo dise√±ar un cl√∫ster.  Nosotros y todos los colegas estar√≠amos interesados ‚Äã‚Äãen conocer su opini√≥n. <br><br><h1>  Elasticsearch Arquitectura y Operaciones </h1><br>  Al comienzo del art√≠culo, hablamos sobre 4 componentes que forman el hardware: disco, memoria, procesadores y red.  El papel de un nodo afecta la disposici√≥n de cada uno de estos componentes.  Un nodo puede realizar varios roles a la vez, pero con el crecimiento del cl√∫ster, estos roles deben distribuirse entre diferentes nodos. <br><br>  <b>Los nodos maestros</b> supervisan el estado del cl√∫ster en su conjunto.  En el trabajo del nodo maestro, se debe observar un qu√≥rum, es decir  su n√∫mero debe ser impar (quiz√°s 1, pero mejor 3). <br><br>  <b>Los nodos de datos</b> realizan funciones de almacenamiento.  Para aumentar el rendimiento del cl√∫ster, los nodos deben dividirse en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"activo", "activo" y "fr√≠o" (congelado)</a> .  Los primeros son para el acceso en l√≠nea, el segundo para el almacenamiento y el tercero para el archivo.  En consecuencia, para "caliente" es razonable usar unidades SSD locales, y para la matriz de HDD "caliente" y "fr√≠a" es adecuada localmente o en SAN. <br><br>  Para determinar la capacidad de almacenamiento de los nodos para el almacenamiento, Elastic recomienda usar la siguiente l√≥gica: "caliente" ‚Üí 1:30 (30 GB de espacio en disco por gigabyte de memoria), "caliente" ‚Üí 1: 100, "fr√≠o" ‚Üí 1: 500).  Bajo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JVM Heap, no m√°s del 50% de la memoria total</a> y no m√°s de 30 GB para evitar la redada del recolector de basura.  La memoria restante se usar√° como cach√© del sistema operativo. <br><br>  Los indicadores de rendimiento de la instancia de Elastisearch, como los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">grupos de subprocesos y las colas de subprocesos, se</a> ven m√°s afectados por la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utilizaci√≥n del</a> n√∫cleo del procesador.  Los primeros se forman sobre la base de las acciones que realiza el nodo: buscar, analizar, escribir y otros.  Los segundos son la cola de las solicitudes correspondientes de varios tipos.  El n√∫mero de procesadores Elasticsearch disponibles para su uso se determina autom√°ticamente, pero puede especificar este valor manualmente en la configuraci√≥n (puede ser √∫til cuando tiene 2 o m√°s instancias de Elasticsearch ejecut√°ndose en el mismo host).  El n√∫mero m√°ximo de grupos de subprocesos y colas de subprocesos de cada tipo se puede establecer en la configuraci√≥n.  La m√©trica de agrupaciones de subprocesos es la m√©trica de rendimiento principal para Elasticsearch. <br><br>  <b>Los nodos de ingesta</b> toman informaci√≥n de los recolectores (Logstash, Beats, etc.), realizan conversiones en ellos y escriben en el √≠ndice de destino. <br><br>  <b>Los nodos de aprendizaje autom√°tico</b> est√°n destinados al an√°lisis de datos.  Como escribimos en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo sobre aprendizaje autom√°tico en Elastic Stack</a> , el mecanismo est√° escrito en C ++ y funciona fuera de la JVM, en la que Elasticsearch est√° girando, por lo que es razonable realizar tales an√°lisis en un nodo separado. <br><br>  <b>Los nodos coordinadores</b> aceptan una solicitud de b√∫squeda y la enrutan.  La presencia de este tipo de nodo acelera el procesamiento de consultas de b√∫squeda. <br><br>  Si consideramos la carga en los nodos en t√©rminos de capacidades de infraestructura, la distribuci√≥n ser√° algo como esto: <br><div class="scrollable-table"><table><tbody><tr><td align="center">  <b>Noda</b> </td><td align="center">  <b>Conducir</b> </td><td align="center">  <b>El recuerdo</b> </td><td align="center">  <b>CPU</b> </td><td align="center">  <b>Red</b> </td></tr><tr><td>  Maestro </td><td align="center">  ‚Üì </td><td align="center">  ‚Üì </td><td align="center">  ‚Üì </td><td align="center">  ‚Üì </td></tr><tr><td>  Datos </td><td align="center">  ‚Üë‚Üë </td><td align="center">  ‚Üë </td><td align="center">  ‚Üë </td><td align="center">  ‚Üí </td></tr><tr><td>  Ingerir </td><td align="center">  ‚Üì </td><td align="center">  ‚Üí </td><td align="center">  ‚Üë </td><td align="center">  ‚Üí </td></tr><tr><td>  Aprendizaje autom√°tico </td><td align="center">  ‚Üì </td><td align="center">  ‚Üë‚Üë </td><td align="center">  ‚Üë‚Üë </td><td align="center">  ‚Üí </td></tr><tr><td>  Coordinador </td><td align="center">  ‚Üì </td><td align="center">  ‚Üí </td><td align="center">  ‚Üí </td><td align="center">  ‚Üí </td></tr><tr><td colspan="5" align="center">  ‚Üë‚Üë - muy alto, ‚Üë - alto, ‚Üí - medio, ‚Üì - bajo </td></tr></tbody></table></div><br>  A continuaci√≥n, presentamos 4 tipos principales de operaciones en Elasticsearch, cada una de las cuales requiere un cierto tipo de recurso. <br><br>  <b>√çndice</b> : procesar y guardar un documento en el √≠ndice.  El siguiente diagrama muestra los recursos utilizados en cada etapa. <br><br><img src="https://habrastorage.org/webt/h0/80/ek/h080ekuwv9hk320oxjbzhe2myou.png"><br><br>  <b>Eliminar</b> : elimina un documento del √≠ndice. <br><br><img src="https://habrastorage.org/webt/zn/f2/y8/znf2y8pjrr1gcwsijy8b0e7jqog.png"><br><br>  <b>Actualizaci√≥n</b> : funciona como Indexar y Eliminar, porque los documentos en Elasticsearch son inmutables. <br><br>  <b>B√∫squeda</b> : obtener uno o m√°s documentos o su agregaci√≥n de uno o m√°s √≠ndices. <br><br><img src="https://habrastorage.org/webt/mw/wr/8g/mwwr8gypmhrb267m7z6eqefk5se.png"><br><br>  Descubrimos la arquitectura y los tipos de cargas, ahora pasemos a la formaci√≥n de un modelo de dimensionamiento. <br><br><h1>  Dimensionar Elasticsearch y preguntas antes de su formaci√≥n </h1><br>  Elastic recomienda usar dos estrategias de dimensionamiento: orientado al almacenamiento y rendimiento.  En el primer caso, los recursos del disco y la memoria son de suma importancia, y en el segundo caso, la memoria, la potencia del procesador y la red. <br><br><h3>  Tama√±o de la arquitectura Elasticsearch basada en el tama√±o de almacenamiento </h3><br>  Antes de los c√°lculos, obtenemos los datos iniciales.  Necesita: <br><br><ul><li>  La cantidad de datos sin procesar por d√≠a; </li><li>  El per√≠odo de almacenamiento de datos en d√≠as; </li><li>  Factor de transformaci√≥n de datos (factor json + factor de indexaci√≥n + factor de compresi√≥n); </li><li>  N√∫mero de replicaci√≥n de fragmentos; </li><li>  La cantidad de nodos de datos de memoria; </li><li>  La relaci√≥n de memoria a datos (1:30, 1: 100, etc.). </li></ul><br>  Desafortunadamente, el factor de transformaci√≥n de datos se calcula solo emp√≠ricamente y depende de varias cosas: el formato de los datos sin procesar, el n√∫mero de campos en los documentos, etc.  Para averiguarlo, debe cargar una parte de los datos de prueba en el √≠ndice.  Sobre el tema de tales pruebas, hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">video interesante de la conferencia</a> y una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">discusi√≥n en la comunidad Elastic</a> .  En general, puede dejarlo igual a 1. <br><br>  Por defecto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Elasticsearch comprime los datos</a> usando el algoritmo LZ4, pero tambi√©n existe DEFLATE, que presiona un 15% m√°s.  En general, se puede lograr una compresi√≥n del 20-30%, pero esto tambi√©n se calcula emp√≠ricamente.  Al cambiar al algoritmo DEFLATE, aumenta la carga de potencia inform√°tica. <br><br>  A√∫n hay recomendaciones adicionales: <br><br><ul><li>  Deposite el 15% para tener una reserva en el espacio en disco; </li><li>  Contribuir 5% para necesidades adicionales; </li><li>  Establezca 1 equivalente de un nodo de datos para garantizar una migraci√≥n r√°pida. </li></ul><br>  Ahora pasemos a las f√≥rmulas.  Aqu√≠ no hay nada complicado, y creemos que ser√° interesante para usted verificar que su cl√∫ster cumpla con estas recomendaciones. <br><blockquote>  <b>Cantidad total de datos (GB)</b> = Datos sin procesar por d√≠a * N√∫mero de d√≠as de almacenamiento * Factor de transformaci√≥n de datos * (n√∫mero de r√©plicas - 1) </blockquote><br><blockquote>  <b>Almacenamiento total de datos (GB)</b> = Datos totales (GB) * (1 + 0.15 stock + 0.05 necesidades adicionales) </blockquote><br><blockquote>  <b>N√∫mero total de nodos</b> = OK (Almacenamiento total de datos (GB) / Volumen de memoria por nodo / relaci√≥n de memoria a datos + 1 equivalente de nodo de datos) </blockquote><br><h3>  Dimensionamiento de la arquitectura Elasticsearch para determinar la cantidad de fragmentos y nodos de datos seg√∫n el tama√±o de almacenamiento </h3><br>  Antes de los c√°lculos, obtenemos los datos iniciales.  Necesita: <br><br><ul><li>  El n√∫mero de patrones de √≠ndice que crear√°; </li><li>  El n√∫mero de fragmentos de n√∫cleo y r√©plicas; </li><li>  Despu√©s de cu√°ntos d√≠as se realizar√° la rotaci√≥n del √≠ndice, si es que lo hace; </li><li>  El n√∫mero de d√≠as para almacenar los √≠ndices; </li><li>  La cantidad de memoria para cada nodo. </li></ul><br>  A√∫n hay recomendaciones adicionales: <br><br><ul><li>  No exceda 20 fragmentos por 1 GB JVM Heap en cada nodo; </li><li>  No exceda los 40 GB de espacio en disco de fragmento. </li></ul><br>  Las f√≥rmulas son las siguientes: <br><blockquote>  <b>N√∫mero de fragmentos</b> = N√∫mero de patrones de √≠ndice * N√∫mero de fragmentos principales * (N√∫mero de fragmentos replicados + 1) * N√∫mero de d√≠as de almacenamiento </blockquote><br><blockquote>  <b>N√∫mero de nodos de datos</b> = OK (N√∫mero de fragmentos / (20 * Memoria para cada nodo)) <br></blockquote><br><h3>  Tama√±o de ancho de banda de Elasticsearch </h3><br>  El caso m√°s com√∫n cuando se necesita un gran ancho de banda es frecuente y en grandes n√∫meros las consultas de b√∫squeda. <br><br>  Datos iniciales necesarios para el c√°lculo: <br><br><ul><li>  Pico de b√∫squedas por segundo; </li><li>  Tiempo de respuesta promedio permitido en milisegundos; </li><li>  El n√∫mero de n√∫cleos y subprocesos por n√∫cleo de procesador en los nodos de datos. </li></ul><br><blockquote>  Valor m√°ximo de subprocesos = OK UP (n√∫mero m√°ximo de consultas de b√∫squeda por segundo * cantidad de tiempo promedio para responder a una consulta de b√∫squeda en milisegundos / 1000 milisegundos) </blockquote><br><blockquote>  Grupo de subprocesos de volumen = OKRUP ((n√∫mero de n√∫cleos f√≠sicos por nodo * n√∫mero de subprocesos por n√∫cleo * 3/2) +1) </blockquote><br><blockquote>  N√∫mero de nodos de datos = OK (valor m√°ximo de subproceso / volumen de grupo de subprocesos) </blockquote><br>  Quiz√°s no todos los datos iniciales estar√°n en sus manos cuando dise√±e la arquitectura, pero despu√©s de mirar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">seminario web</a> o leer este art√≠culo, aparecer√° una comprensi√≥n que, en principio, afecta la cantidad de recursos de hardware. <br><br>  Tenga en cuenta que no es necesario adherirse a la arquitectura dada (por ejemplo, crear nodos coord coord y nodos manejadores).  Es suficiente saber que existe una arquitectura de referencia de este tipo y puede proporcionar un aumento de rendimiento que no podr√≠a lograr por otros medios. <br><br>  En uno de los siguientes art√≠culos, publicaremos una lista completa de preguntas que deben responderse para determinar el tama√±o del cl√∫ster. <br><br>  Para contactarnos, puede usar mensajes personales en Habr√© o el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">formulario de comentarios en el sitio</a> . <br><br>  <b>Materiales adicionales</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Seminario web "Dimensionamiento de Elasticsearch y planificaci√≥n de capacidad"</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Seminario web de planificaci√≥n de capacidad de Elasticsearch</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Discurso en ElasticON con el tema "Dimensionamiento cuantitativo de cl√∫steres"</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Seminario web sobre la utilidad Rally para determinar los indicadores de rendimiento del cl√∫ster</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo de tama√±o de Elasticsearch</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Seminario web de pila el√°stica</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/470640/">https://habr.com/ru/post/470640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../470622/index.html">Descripci√≥n general de los m√©todos de selecci√≥n de funciones</a></li>
<li><a href="../470628/index.html">Simulador de naves espaciales construcci√≥n naval</a></li>
<li><a href="../470632/index.html">Arend: lenguaje de tipo dependiente basado en HoTT (parte 2)</a></li>
<li><a href="../470634/index.html">Identifique la comunidad cruzada en Instagram para identificar los intereses de los usuarios.</a></li>
<li><a href="../470638/index.html">M√©todos cuasi-newtonianos, o cuando hay demasiadas segundas derivadas para Athos</a></li>
<li><a href="../470642/index.html">Conoce a Yandex.Station Mini. Gran historia de un peque√±o dispositivo.</a></li>
<li><a href="../470644/index.html">Por qu√© los blogs corporativos a veces son amargos: algunas observaciones y consejos</a></li>
<li><a href="../470646/index.html">Matem√°ticas para la ciencia de datos. Nuevo curso de OTUS</a></li>
<li><a href="../470648/index.html">IBM LTO-8: forma f√°cil de almacenar datos en fr√≠o</a></li>
<li><a href="../470650/index.html">Preparaci√≥n de datos en un proyecto de Data Science: recetas para j√≥venes amas de casa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>