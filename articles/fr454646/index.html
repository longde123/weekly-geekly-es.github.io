<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙋 🌒 #⃣ @Pythonetc compilation, mai 2019 ✋🏽 👨‍👨‍👦‍👦 🧖🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ceci est la onzième sélection de conseils et de programmation Python de mon flux @pythonetc. 

 ← Collections précédentes 


 L' break bloque une exce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>@Pythonetc compilation, mai 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454646/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d63/195/6d5/d631956d535edaa7d72b6a30165e8e58.png"></div><br><br>  Ceci est la onzième sélection de conseils et de programmation Python de mon flux @pythonetc. <br><br>  ← <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Collections précédentes</a> <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  L' <code>break</code> bloque une exception si elle est appliquée dans un bloc <code>finally</code> , même s'il n'y a pas de bloc <code>except</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> / i <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: print(<span class="hljs-string"><span class="hljs-string">'finally'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> print(<span class="hljs-string"><span class="hljs-string">'after try'</span></span>) print(<span class="hljs-string"><span class="hljs-string">'after while'</span></span>)</code> </pre> <br>  Résultat: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> after <span class="hljs-keyword"><span class="hljs-keyword">while</span></span></code> </pre> <br>  La même chose est vraie pour <code>continue</code> , cependant cette expression ne peut être utilisée que jusqu'à la version 3.8 de Python: <br><br><pre> <code class="python hljs">SyntaxError: <span class="hljs-string"><span class="hljs-string">'continue'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> supported inside <span class="hljs-string"><span class="hljs-string">'finally'</span></span> clause</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Vous pouvez ajouter des caractères Unicode aux littéraux de chaîne non seulement par leurs index, mais aussi par leur nom. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">'\N{EM DASH}'</span></span> <span class="hljs-string"><span class="hljs-string">'—'</span></span> &gt;&gt;&gt; <span class="hljs-string"><span class="hljs-string">'\u2014'</span></span> <span class="hljs-string"><span class="hljs-string">'—'</span></span></code> </pre> <br>  Cette méthode est également compatible avec les lignes f: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>width = <span class="hljs-number"><span class="hljs-number">800</span></span> &gt;&gt;&gt; <span class="hljs-string"><span class="hljs-string">f'Width \N</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{EM DASH}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{width}</span></span></span><span class="hljs-string">'</span></span> <span class="hljs-string"><span class="hljs-string">'Width — 800'</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Il existe six méthodes «magiques» pour les objets Python qui définissent les règles de comparaison: <br><br><ul><li>  <code>__lt__</code> pour <code>&lt;</code> </li><li>  <code>__gt__</code> pour <code>&gt;</code> </li><li>  <code>__le__</code> pour <code>&lt;=</code> </li><li>  <code>__ge__</code> pour <code>&gt;=</code> </li><li>  <code>__eq__</code> pour <code>==</code> </li><li>  <code>__ne__</code> pour <code>!=</code> </li></ul><br>  Si l'une de ces méthodes n'est pas définie ou renvoie <code>NotImplemented</code> , les règles suivantes s'appliquent: <br><br><ul><li>  <code>a.__lt__(b)</code> identique à <code>b.__gt__(a)</code> </li><li>  <code>a.__le__(b)</code> identique à <code>b.__ge__(a)</code> </li><li>  <code>a.__eq__(b)</code> le même que <code>not a.__ne__(b)</code> (notez que dans ce cas <code>a</code> et <code>b</code> n'ont pas changé de place) </li></ul><br>  Cependant, les conditions <code>a &gt;= b</code> et <code>a != b</code> ne signifient pas automatiquement que <code>a &gt; b</code> .  Le décorateur <code>functools.total_ordering</code> crée les six méthodes basées sur <code>__eq__</code> et l'une d'elles: <code>__lt__</code> , <code>__gt__</code> , <code>__le__</code> ou <code>__ge__</code> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> total_ordering @total_ordering <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pk, name)</span></span></span><span class="hljs-function">:</span></span> self.pk = pk self.name = name <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__le__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, other)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.pk &lt;= other.pk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__eq__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, other)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.pk == other.pk <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> User(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'Vadim'</span></span>) &lt; User(<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-string"><span class="hljs-string">'Catherine'</span></span>)</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Parfois, vous devez utiliser les versions décorée et non décorée de la fonction.  La façon la plus simple d'y parvenir est de ne pas utiliser de syntaxe de décoration spéciale (avec le symbole <code>@</code> ) et de créer une fonction de décoration manuellement: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(result, list): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [result] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) load_data = ensure_list(load_data_orig) print(load_data(<span class="hljs-string"><span class="hljs-string">'3'</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># [3] print(load_data_orig('4')) 4</span></span></code> </pre> <br>  Ou vous pouvez écrire un décorateur qui décore la fonction, tout en conservant la version originale dans son attribut <code>orig</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> ... @saving_orig(ensure_list) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) print(load_data(<span class="hljs-string"><span class="hljs-string">'3'</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># [3] print(load_data.orig('4')) # 4</span></span></code> </pre> <br>  Si tous vos décorateurs sont créés via <code>functools.wraps</code> , vous pouvez utiliser l'attribut <code>__wrapped__</code> pour accéder à une fonction non décorée: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wraps <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> @wraps(f) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(result, list): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [result] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated @ensure_list <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) print(load_data(<span class="hljs-string"><span class="hljs-string">'3'</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># [3] print(load_data.__wrapped__('4')) # 4</span></span></code> </pre> <br>  Mais rappelez-vous que cette approche ne fonctionne pas pour les fonctions décorées avec plusieurs décorateurs: vous devez vous référer à <code>__wrapped__</code> chacun des décorateurs appliqués: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_ints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> @wraps(f) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated @ensure_ints @ensure_list <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( load_data, load_data.__wrapped__, load_data.__wrapped__.__wrapped__, ): print(repr(f(<span class="hljs-string"><span class="hljs-string">'"4"'</span></span>)))</code> </pre> <br>  Résultat: <br><br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">4</span></span>] [<span class="hljs-string"><span class="hljs-string">'4'</span></span>] <span class="hljs-string"><span class="hljs-string">'4'</span></span></code> </pre> <br>  Le décorateur <code>@saving_orig</code> mentionné ci-dessus prend un autre décorateur comme argument.  Et si elle sera paramétrée?  Puisqu'un décorateur paramétré est une fonction qui renvoie un vrai décorateur, cette situation est traitée automatiquement: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wraps <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_ints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*, default=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> @wraps(f) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) ints = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: x_int = int(x) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> default <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: x_int = default ints.append(x_int) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ints <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator @saving_orig(ensure_ints(default=<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) print(repr(load_data(<span class="hljs-string"><span class="hljs-string">'["2", "3", "A"]'</span></span>))) print(repr(load_data.orig(<span class="hljs-string"><span class="hljs-string">'["2", "3", "A"]'</span></span>)))</code> </pre> <br>  Le décorateur <code>@saving_orig</code> ne <code>@saving_orig</code> pas ce que nous voulons si plusieurs décorateurs sont appliqués à la fonction.  Ensuite, pour chacun d'eux, vous devez appeler <code>orig</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wraps <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_ints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*, default=None)</span></span></span><span class="hljs-function">:</span></span> ... @saving_orig(ensure_ints(default=<span class="hljs-number"><span class="hljs-number">42</span></span>)) @saving_orig(ensure_list) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( load_data, load_data.orig, load_data.orig.orig, ): print(repr(f(<span class="hljs-string"><span class="hljs-string">'"X"'</span></span>)))</code> </pre> <br>  Résultat: <br><br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">42</span></span>] [<span class="hljs-string"><span class="hljs-string">'X'</span></span>] <span class="hljs-string"><span class="hljs-string">'X'</span></span></code> </pre> <br>  Cela peut être <code>saving_orig</code> en prenant en charge un nombre arbitraire de décorateurs comme arguments pour <code>saving_orig</code> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*decorators)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = f <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> reversed(decorators): decorated = d(decorated) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator ... @saving_orig( ensure_ints(default=<span class="hljs-number"><span class="hljs-number">42</span></span>), ensure_list, ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( load_data, load_data.orig, ): print(repr(f(<span class="hljs-string"><span class="hljs-string">'"X"'</span></span>)))</code> </pre> <br>  Résultat: <br><br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">42</span></span>] <span class="hljs-string"><span class="hljs-string">'X'</span></span></code> </pre> <br>  Il existe une autre solution: faites en <code>saving_orig</code> que <code>saving_orig</code> passe l' <code>orig</code> d'une fonction décorée à une autre: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hasattr(f, <span class="hljs-string"><span class="hljs-string">'orig'</span></span>): decorated.orig = f.orig <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator @saving_orig(ensure_ints(default=<span class="hljs-number"><span class="hljs-number">42</span></span>)) @saving_orig(ensure_list) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string)</code> </pre> <br>  Lorsque le décorateur devient trop compliqué, il est préférable de le convertir d'une fonction en classe avec la méthode <code>__call__</code> : <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SavingOrig</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, another_decorator)</span></span></span><span class="hljs-function">:</span></span> self._another = another_decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, f)</span></span></span><span class="hljs-function">:</span></span> decorated = self._another(f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hasattr(f, <span class="hljs-string"><span class="hljs-string">'orig'</span></span>): decorated.orig = f.orig <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated saving_orig = SavingOrig</code> </pre> <br>  La dernière ligne vous permet de nommer la classe dans le boîtier Camel et d'enregistrer le nom du décorateur dans le boîtier Snake. <br><br>  Au lieu de convertir la fonction décorée, vous pouvez créer une autre classe appelée et renvoyer des instances de la fonction au lieu de la fonction: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallableWithOrig</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, to_call, orig)</span></span></span><span class="hljs-function">:</span></span> self._to_call = to_call self._orig = orig <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._to_call(*args, **kwargs) @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(self._orig, type(self)): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._orig.orig <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._orig <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SavingOrig</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, another_decorator)</span></span></span><span class="hljs-function">:</span></span> self._another = another_decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CallableWithOrig(self._another(f), f) saving_orig = SavingOrig</code> </pre> <br>  Tout le code est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici.</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454646/">https://habr.com/ru/post/fr454646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454630/index.html">Situations exceptionnelles: partie 1 de 4</a></li>
<li><a href="../fr454634/index.html">Security Week 23: vulnérabilité du bloc-notes, un million de systèmes avec RDP non corrigé</a></li>
<li><a href="../fr454640/index.html">Débogage à distance du microservice via SSH sous VPN en 4 tours</a></li>
<li><a href="../fr454642/index.html">"" Faire une application pour les gens "- ce n'est pas à gribouiller": à propos du développement mobile dans CFT</a></li>
<li><a href="../fr454644/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 8. Configuration du commutateur</a></li>
<li><a href="../fr454648/index.html">Trucs et astuces de ma chaîne Telegram @pythonetc, mai 2019</a></li>
<li><a href="../fr454652/index.html">Moteur à réaction sur une imprimante 3D domestique</a></li>
<li><a href="../fr454658/index.html">Gadgets de beauté - Affaires sérieuses</a></li>
<li><a href="../fr454662/index.html">Déménagement prudent aux Pays-Bas avec sa femme et son hypothèque. Partie 1: Recherche d'emploi</a></li>
<li><a href="../fr454664/index.html">Jouer à Tetris en AR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>