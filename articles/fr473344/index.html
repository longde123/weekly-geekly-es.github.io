<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔻 ⚒️ 🍈 Concerts et événements KudaGo dans votre miroir 🍈 ☣️ 🌰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je vais vous expliquer comment j'ai rendu possible la réception et l'affichage d'informations sur l'API publique KudaGo sur votre miroir. Bien sûr, il...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Concerts et événements KudaGo dans votre miroir</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473344/">  Je vais vous expliquer comment j'ai rendu possible la réception et l'affichage d'informations sur l'API publique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">KudaGo</a> sur votre miroir.  Bien sûr, il ne s'agit pas d'un miroir simple, mais d'un miroir «intelligent». <br><a name="habracut"></a><br><h3>  Qu'est-ce qu'un miroir intelligent? </h3><br>  Très probablement, beaucoup ont entendu parler de la plate-forme modulaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MagicMirror²</a> , qui vous permet de déployer une application sur Raspberry Pi qui peut transformer un miroir pour un hall d'entrée ou une salle de bain en votre assistant personnel.  Vous pouvez implémenter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ceci</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela en</a> utilisant le miroir dit "bidirectionnel", le moniteur, les bras droits et le micro-ordinateur susmentionné. <br><br>  La magie dans MagicMirror est uniquement dans le nom.  Si j'ai bien compris, tout cela a été développé sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Electron</a> , ce qui signifie que Node.js. est impliqué dans l'affaire.  L '"Application" crée une page html qui, lorsqu'elle est lancée, s'ouvre dans une fenêtre de navigateur, et les soi-disant modules y sont déjà affichés, tous deux préinstallés (Horloge, Calendrier, Météo actuelle, Prévisions météorologiques, Flux d'actualités.) Et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">développés par la communauté</a> .  Et il y a suffisamment d'intéressant (à la fois utile et <s>têtu</s> inhabituel), par exemple, voici quelques-uns de plus d'une centaine de modules: <br><br><h4>  Utile </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Intégration de l'Assistant Google</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Commande vocale</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Reconnaissance faciale</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">YouTube</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suivi des résultats sportifs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flux Instagram</a> </li></ul><br><h4>  Fantaisie </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Statistiques FortNite</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suivi du taux de crypto-monnaie</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vidéo en direct de la Terre depuis la Station spatiale internationale.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Statut de l'essaim Docker</a> </li></ul><br><h3>  Contexte </h3><br>  Sur la façon dont j'ai récupéré mon miroir, je ne peindrai pas en détail.  Si quelqu'un s'intéresse, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez lire ici</a> .  Si vous souhaitez créer le vôtre, une simple recherche Google renverra des dizaines d'exemples \ guides \ manuels.  Je veux montrer comment créer un module pour un tel miroir. <br><br>  Je suis un grand fan d'assister à divers concerts et événements de Saint-Pétersbourg.  Mais il arrive parfois que (même en tenant compte de l'abondance de la publicité contextuelle, du spam et des affiches) j'apprenne certains événements presque un jour ou deux avant eux.  Par conséquent, j'ai toujours cherché un moyen de filtrer de manière optimale le flux d'informations les concernant.  Les applications sur un smartphone aux fonctionnalités similaires ne sont pas restées longtemps (plus précisément, je les ai oubliées).  Toutes les affiches ont nécessité du temps et un passage constant de la quête «choisissez 10 filtres et devinez lequel est le bon».  Les flux de médias sociaux se sont généralement transformés en spam publicitaire.  Et puis l'idée est venue avec l'idée d'implémenter un «analyseur» qui sélectionnerait périodiquement des informations sur ses propres critères et les afficherait quelque part. <br><br><h3>  Développement de votre module </h3><br>  Si quelqu'un veut immédiatement voir le résultat, ou installer le module sur un «miroir», alors voici le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers le référentiel</a> .  Il y a aussi des instructions d'installation. <br><br>  En tant que source d'informations, le service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kudago</a> s'est avéré être le plus adéquat.  Aucune inscription requise.  Méthodes sensées.  Des données concises dans la réponse.  Ce n'est pas une couverture étrange, cela inclut non seulement les "trottoirs urbains" et "non-caoutchouc", mais aussi 9 grandes villes russes en plus. <br><br>  Notre module développé doit être stocké dans le <i>dossier modules / modulename</i> .  Pour créer un module simple (comme le mien), nous devons créer deux fichiers dans ce dossier: <br><br><ul><li>  modulename / modulename.js est le script du module principal. </li><li>  modulename / node_helper.js est l '"aide facultative" qui sera chargée par le script.  L'assistant et le script de module peuvent communiquer entre eux à l'aide d'un système de socket intégré. </li></ul><br>  Après avoir bricolé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide du développeur MagicMirror</a> , ainsi que regarder les solutions d'autres personnes, j'ai téléchargé un script pour obtenir des entrées de l'API kudago en utilisant XMLHttpRequest.  Et a rencontré le problème des requêtes inter-domaines.  Je ne suis pas du tout un expert en javascript (et même pas un développeur).  Tout ce que j'ai compris, c'est d'envoyer une demande "exécuter un script dans un navigateur" et d'obtenir une réponse de kudago, je n'ai pas réussi.  Voici ce que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">learn.javascript m'a</a> expliqué <br><br><blockquote>  Les demandes interdomaines font l'objet d'un contrôle de sécurité spécial, dont le but est d'empêcher les pirates malveillants de conquérir Internet. <br><br>  Sérieusement.  Les développeurs de la norme ont fourni toutes les barrières afin que le «hacker maléfique» ne puisse pas, en utilisant la nouvelle norme, faire quelque chose de fondamentalement différent de ce qu'il aurait pu faire auparavant et, par conséquent, «casser» un serveur exécutant l'ancienne norme. et ne rien attendre de fondamentalement nouveau. </blockquote><br>  Enfin, pas vraiment ce que je voulais.  Je n'avais aucune envie de comprendre les problèmes javascript.  Après tout, à portée de main était le Python familier et prévisible.  Je vais juste obtenir des informations de la bibliothèque de <i>requêtes</i> , en écrivant le résultat dans json.  Il ne reste plus qu'à résoudre la question de savoir comment faire exécuter du code Python à partir de js. <br><br>  Il s'avère que node_helper.js m'est utile!  Lors du démarrage de notre module, vous pouvez utiliser les capacités de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python-shell</a> .  Spécifiez simplement le chemin d'accès à l'interpréteur Python, le chemin d'accès au script, les arguments et leurs valeurs.  Sous cette forme, kudago m'a gentiment retourné une réponse réussie. <br><br><div class="spoiler">  <b class="spoiler_title">Code d'appel du script Python</b> <div class="spoiler_text"><pre><code class="javascript hljs">kudagoGetData: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//call python script for collecting events from KudaGo api self = this; var options = { pythonPath: this.config.pythonPath, scriptPath: './modules/MMM-KudaGo', mode: 'json', args: [ "--location", this.config.location, "--days", this.config.days, "--categories", this.config.categories, "--tags", this.config.tags, ] }; pyshell.PythonShell.run('KudaGo.py', options, function (err) { if (err) throw err; }); }</span></span></code> </pre> <br></div></div><br>  De plus, seul node_helper.js est capable de lire les informations du fichier json (par défaut, le fichier se trouvera sur le chemin <i>kudago / events.json</i> ) avec les données téléchargées de kudago.  Nous y implémentons la même lecture du fichier. <br><br><div class="spoiler">  <b class="spoiler_title">Code pour lire les informations d'un fichier</b> <div class="spoiler_text"><pre> <code class="javascript hljs">readData: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//read a file with events fs.readFile("./modules/MMM-KudaGo/kudago/events.json", "utf8", (err, data) =&gt; { if (err) throw err; this.sendSocketNotification("DATA", data); }); }</span></span></code> </pre> <br></div></div><br>  Comme je l'ai déjà écrit, dans MagicMirror tous les modules communiquent via un système de socket, donc pour que notre script Python s'exécute au démarrage, ajoutez le code approprié à node_helper.js <br><br><div class="spoiler">  <b class="spoiler_title">Code pour démarrer le module au démarrage</b> <div class="spoiler_text"><pre> <code class="javascript hljs">socketNotificationReceived: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">notification, payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (notification === <span class="hljs-string"><span class="hljs-string">"START"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config = payload; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.kudagoGetData(); setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.kudagoGetData(); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config.updateInterval); } }</code> </pre> <br></div></div><br>  Tous les paramètres obtenus à partir de <i>this.config</i> sont soit les variables prédéfinies dans le fichier principal du module, soit celles spécifiées dans config.js - le fichier de configuration générale pour tous les modules MagicMirror. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de configuration pour le module créé</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">module</span></span>: <span class="hljs-string"><span class="hljs-string">'MMM-KudaGo'</span></span>, <span class="hljs-attr"><span class="hljs-attr">disabled</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">position</span></span>: <span class="hljs-string"><span class="hljs-string">'bottom_bar'</span></span>, <span class="hljs-attr"><span class="hljs-attr">config</span></span>: { <span class="hljs-attr"><span class="hljs-attr">location</span></span>: <span class="hljs-string"><span class="hljs-string">"spb"</span></span>, <span class="hljs-attr"><span class="hljs-attr">categories</span></span>: <span class="hljs-string"><span class="hljs-string">"concert"</span></span>, <span class="hljs-attr"><span class="hljs-attr">tags</span></span>: <span class="hljs-string"><span class="hljs-string">"  --,"</span></span>, <span class="hljs-attr"><span class="hljs-attr">days</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span> } }</code> </pre> <br></div></div><br>  Eh bien, dans le fichier principal de notre module <a href="">MMM-KudaGo.js, il</a> y a des paramètres par défaut, des fonctions pour gérer les données d'événement (prises à partir d'un fichier json), des signes pour dessiner une plaque (à partir de laquelle les gens qui savent vont saigner du sang de mes yeux, mais je suis dans un réservoir, la chose principale pour moi est travaillé).  En raison du fait que j'ai retiré le travail avec l'API dans des fichiers python, les fichiers .js ne sont pas surchargés de code (contrairement à la plupart des autres modules), imbriqués (ou comment sont-ils appelés ici?) Fonctions, boucles et autres nouilles. <br><br><h3>  Résultat </h3><br><div class="spoiler">  <b class="spoiler_title">Capture d'écran du module lui-même</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/2c0/d50/2f0/2c0d502f052e78c683af398ab6000092.jpg" alt="image"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Capture d'écran miroir</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/yf/fh/7k/yffh7ks7qlbu6gvufqrpd7ffes8.png" alt="image"><br></div></div><br>  Il s'est avéré implémenter une recherche pour une ou plusieurs catégories d'événements, une recherche par balises, une recherche pour un intervalle de jours donné, avec une mise à jour à des intervalles spécifiés (pour une liste plus détaillée des catégories et des balises, voir le <a href="">fichier Lisez</a> - <a href="">moi</a> ).  Et affichez le tout sur l'écran, en indiquant le lieu, le nom, la date et le prix, sous une forme lisible, et sans perdre de temps sur une recherche indépendante. <br><br>  Bien sûr, vous devez regarder attentivement plusieurs fois ce que l'applet y renvoie pour comprendre quelles balises vous devez mettre afin qu'elle ne montre pas de concerts ou de représentations théâtrales, mais par exemple des cours de yoga ou des festivals gratuits dans votre ville.  Mais personnellement, mes besoins sont pleinement satisfaits! <br><br>  J'espère que vous avez également trouvé et créé un module utile pour la communauté, que vous partagez avec les autres sur une page spéciale du projet.  Soit dit en passant, si vous avez de bonnes idées ou besoin de quelque chose, écrivez dans les commentaires.  Peut-être pousser quelqu'un à la création! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473344/">https://habr.com/ru/post/fr473344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473332/index.html">Mitya Alexandrov et Dmitry Konstantinov à la réunion jug.msk.ru</a></li>
<li><a href="../fr473334/index.html">Cat Ghonim: Comment faire en sorte que les chats ne se soulagent pas sur la pelouse à la maison?</a></li>
<li><a href="../fr473338/index.html">TDD: comment écrire correctement les spécifications (décrit)</a></li>
<li><a href="../fr473340/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 386 (21-27 octobre 2019)</a></li>
<li><a href="../fr473342/index.html">"La longue route vous attend ..." ou résoudre le problème de prévision en C # en utilisant Ml.NET (DataScience)</a></li>
<li><a href="../fr473346/index.html">Création d'une API REST avec Node.js et une base de données Oracle. 2e partie</a></li>
<li><a href="../fr473348/index.html">L'idée d'inertie (SGDm), l'idée de mise à l'échelle (Adagrad) et de régularisation dans l'apprentissage automatique en utilisant le problème de la classification comme exemple</a></li>
<li><a href="../fr473350/index.html">Création d'une API REST avec Node.js et une base de données Oracle. 3e partie</a></li>
<li><a href="../fr473352/index.html">Collections simultanées en 10 minutes</a></li>
<li><a href="../fr473354/index.html">À propos des bizarreries de la habrostatistique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>