<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•´ üî¥ üß§ T√¢ches et solutions pour PostgreSQL Fighter üìÅ üÜó üöù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations √† tous les amateurs de SQL! 

 Sur Internet, j'ai rarement vu des articles couvrant diff√©rents points de travail et subtilit√©s associ√©s au...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>T√¢ches et solutions pour PostgreSQL Fighter</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423097/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/x3/ee/eo/x3eeeo65jv-nyf7mh9ks2dordqg.jpeg"></div><br>  Salutations √† tous les amateurs de SQL! <br><br>  Sur Internet, j'ai rarement vu des articles couvrant diff√©rents points de travail et subtilit√©s associ√©s au <b>traitement des donn√©es en SQL</b> . <br>  J'aime quand vous pouvez apprendre beaucoup de choses d'un article √† la fois, m√™me en termes g√©n√©raux. <br>  Par cons√©quent, j'ai d√©cid√© d'√©crire mon article contenant diverses t√¢ches et r√©ponses avec des explications √† leur sujet. <br>  Convient √† ceux qui ma√Ætrisent bien toutes les comp√©tences de base et souhaitent se d√©velopper davantage. <br><br>  Les r√©ponses fournies conviennent √† <b>PostgreSQL</b> (la <u>plupart des t√¢ches conviendront √† d'autres SGBD</u> , mais les r√©sultats et les solutions peuvent √™tre diff√©rents. C'est m√™me int√©ressant o√π les diff√©rences surviennent) <br><br>  <i><u>Essayez de vous r√©pondre</u> avant d'ouvrir le spoiler.</i> <i><br></i> <br>  C'est parti! <br><a name="habracut"></a><br><br>  Je vais essayer de marquer avec un ast√©risque quelque chose de purement pour PostgreSQL * (il n'y a pas beaucoup de tels moments) <br><br><h4>  1. Un peu sur les op√©rations num√©riques </h4><br>  <b>1.1</b> Ces demandes seront-elles satisfaites?  Quels r√©sultats reviendront-ils? <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- )     SELECT 3/2; -- ) SELECT min('- '::TEXT), avg('- '::TEXT); -- )*      FALSE,     ? SELECT 7.2 = (3.8::FLOAT + 3.4) -- ) SELECT (20/25)*25.0;</span></span></code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">R√©ponses √† 1.1</b> <div class="spoiler_text">  A) R√©ponse: <b>1</b> <br>  Seule la partie enti√®re sera affich√©e, car  l'op√©ration utilise des entiers.  Cela se trouve souvent dans d'autres langues. <br><br>  B) R√©ponse: la demande <b>ne sera pas ex√©cut√©e</b> . <br><br>  <b>avg</b> donnera une erreur puisque  accepte uniquement les nombres et les intervalles de temps * <br><br>  Cependant, la fonction <b>min / max</b> peut √™tre ex√©cut√©e sur des donn√©es de texte (conform√©ment au tri alphab√©tique dans la base de donn√©es). <br>  Parfois, cela peut √™tre utile lorsque vous devez au moins consulter une colonne qui n'est pas r√©pertori√©e dans <i>GROUP BY</i> <br>  Ou lorsque vous devez appliquer un tri alphab√©tique aux nombres, dans lequel '10' &lt;'2' <br><br>  B) R√©ponse: <b>FAUX</b> <br><br>  Cela peut sembler √©trange, mais cela est <u>acceptable</u> , car  il s'agit d'une caract√©ristique d'un ordinateur repr√©sentant certains nombres √† virgule flottante; un nombre peut prendre la forme 7.1 (9) <br>  Je me rappelle comment j'ai trait√© une demande pendant longtemps sans le savoir. <br><br>  D) R√©ponse: <b>0</b> .  le hic est que l'expression entre parenth√®ses sera = 0 <br><br>  SELECT (20 / 25.0) * 25 fonctionnerait plus correctement </div></div><br><br>  <b>1.2</b> √âtant donn√© la table " <i>table_2</i> " (avec une seule colonne " <i>valeur</i> " (INTEGER)) compos√©e des 5 lignes suivantes: <br><table border="1" cellpadding="1"><tbody><tr><th width="120">  valeur </th></tr><tr><td>  5 </td></tr><tr><td>  5 </td></tr><tr><td>  Null </td></tr><tr><td>  5 </td></tr><tr><td>  5 </td></tr></tbody></table><br>  Quel r√©sultat renverra la requ√™te: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)*<span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*)) - <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_2;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Options de r√©ponse</b> <div class="spoiler_text"><ul><li>  -4 </li><li>  0 </li><li>  Null </li><li>  5 </li><li>  Cela provoquera une erreur car  non sp√©cifi√© GROUP BY </li><li>  Aucun des inscrits </li></ul><br></div></div><br><div class="spoiler">  <b class="spoiler_title">R√©ponse 1.2</b> <div class="spoiler_text">  r√©ponse: <b>5</b> <br><br>  Les fonctions d'agr√©gation appliqu√©es √† une colonne particuli√®re ignorent <i>NULL</i> , mais count <b>(*)</b> comptera toutes les lignes <br>  5 * 5 - 20 </div></div><br><br><h4>  2. Probl√®mes g√©n√©raux </h4><br>  <b>2.1</b> Dans quels cas une requ√™te ne peut-elle pas renvoyer tout le contenu d'une table?  ( <i>parent_id</i> INTEGER, le tableau est rempli d'une vari√©t√© de donn√©es) <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id = parent_id;</code> </pre><br>  Comment se comportera la demande ci-dessous?  Quelles donn√©es sortiront-elles?  <i>* PostgreSQL</i> <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> any_table <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> parent_id <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> parent_id;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">R√©ponses √† 2.1</b> <div class="spoiler_text">  La premi√®re requ√™te affichera toutes les entr√©es sauf celles o√π <i>parent_id</i> est <b>NULL</b> <br><br>  La deuxi√®me requ√™te affichera toutes les entr√©es de table.  <u>IS DISTINCT FROM</u> est logiquement similaire √† l'op√©rateur <b>! =</b> Dans lequel NULL est identique √† NULL <br>  <u>N'EST <b>PAS</b> DISTINCT DE</u> transforme logiquement l'in√©galit√© en √©galit√© <br></div></div><br>  <b>2.2.</b>  Quel sera le r√©sultat de la demande? <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- ) SELECT * FROM ( SELECT 1 UNION ALL SELECT 1 ) x(y) UNION ( SELECT 2 UNION ALL SELECT 2 );</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">R√©pondre √† 2.2</b> <div class="spoiler_text">  Le r√©sultat sera 2 lignes avec les valeurs <b>1</b> et <b>2</b> , <i>UNION</i> supprimera tous les doublons dans la s√©lection <u>r√©sultante</u> , et pas seulement entre les deux tables jointes.  J'ai remarqu√© que ce n'est pas √©vident pour tout le monde. </div></div><br>  <b>2.3</b> √âcrivez une requ√™te qui affiche la date de demain. <br><br><div class="spoiler">  <b class="spoiler_title">R√©ponse √† 2.3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CAST</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()+ <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-string"><span class="hljs-string">'1 DAY'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>)</code> </pre> <br>  Tout le monde ne travaille pas souvent avec des dates, mais cela vaut la peine de ma√Ætriser un minimum <br>  * Solution Postgres, mais je pense que les autres SGBD ne sont pas tr√®s diff√©rents <br><br>  Si travailler avec des dates est nouveau pour vous, je vous conseille d'exp√©rimenter la demande <br>  Par exemple: <br>  - remplacez DAY par (semaine, mois, ann√©e, etc.) <br>  - remplacer +1 par -9000 <br>  - remplacer DATE par TIME <br>  - supprimer CAST <br>  - laissez seulement MAINTENANT () <br>  etc. <br><br>  Et, inspir√© par certains r√©sultats, allez lire le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MANUEL</a> , tous les sujets y sont d√©crits en d√©tail <br><br></div></div><br>  <b>2.4</b> Les <b>instructions UPDATE</b> , <b>DELETE</b> , <b>INSERT</b> et <b>MERGE sont</b> con√ßues pour manipuler les donn√©es des tableaux.  <b>SELECT .. l'</b> ex√©cution est-elle "s√ªre"?  Une requ√™te peut-elle affecter les donn√©es de la table? <br><div class="spoiler">  <b class="spoiler_title">R√©ponse √† 2.4</b> <div class="spoiler_text">  La question peut cependant sembler primitive ... <br><br>  Au tout d√©but de l'apprentissage de SQL, j'avais l'avis que cette d√©claration ne peut afficher que des donn√©es, mais: <br><br>  Outre le fait que SELECT est capable de verrouiller la table pour le changement (BEGIN; SELECT ... FOR UPDATE) * <br>  SELECT est capable d'appeler des fonctions qui peuvent effectuer presque toutes les manipulations. <br><br>  Les d√©butants doivent comprendre cela tout de suite, et non apr√®s avoir rempli la "petite demande d'information" sur le serveur de <s>production</s> </div></div><br><br><h4>  3. Uniquement PostgreSQL </h4><br>  <b>3.1</b> D√©crivez ce qui se passe lorsque cette requ√™te est ex√©cut√©e dans la bo√Æte de dialogue SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">R√©pondre √† 3.1</b> <div class="spoiler_text">  En r√®gle g√©n√©rale, SELECT INTO est utilis√© dans les fonctions <i>plpgsql</i> pour √©crire une valeur dans une variable. <br><br>  En dehors de plpgsql, l'effet de la commande sera similaire √† la requ√™te ci-dessous: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> wtf <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre> <br></div></div><br>  <b>3.2</b> Que montrera cette "simple" demande <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wtf_ <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> wtf_ ;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">R√©pondre √† 3.2</b> <div class="spoiler_text">  pg_stat_activity vue syst√®me (VIEW) des processus actifs dans la base de donn√©es. <br><br>  La particularit√© de la requ√™te est qu'une colonne avec des lignes (ROW) ayant TYPE pg_stat_activity (ou une autre table) sera affich√©e.  Vous devez le savoir plus t√¥t pour ceux qui √©crivent des fonctions. Vous pouvez en lire plus dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manuel.</a> <br>  La question a √©t√© ajout√©e car un d√©butant peut facilement obtenir un tel r√©sultat par erreur et ne pas comprendre quel est le probl√®me </div></div><br><h4>  4. Travaillez avec du texte.  Expressions r√©guli√®res </h4><br>  Je pense que vous devez √™tre en mesure non seulement de g√©n√©rer des requ√™tes, mais √©galement de pr√©senter les r√©sultats de la bonne mani√®re. <br>  Les expressions r√©guli√®res sont un √©norme sujet distinct, avec de nombreux articles de qualit√©.  Par cons√©quent, je ne montrerai que des exemples, sans explications d√©taill√©es. <br><br>  <b>4.1.</b>  Supposons qu'il existe une table " <i>table_5</i> " avec une colonne de texte " <i>X</i> " et de nombreuses lignes diff√©rentes.  Quelle requ√™te peut obtenir les 10 derniers caract√®res de chaque ligne? <br><br><div class="spoiler">  <b class="spoiler_title">R√©pondre √† 4.1</b> <div class="spoiler_text">  SQL vous permet de trouver de nombreuses solutions au m√™me probl√®me, par exemple: <br>  la chose la plus simple qui me vient √† l'esprit est la <b>bonne (X, 10)</b> <br>  regex peut √™tre utilis√©: <b>sous</b> - <b>cha√Æne (X, '. {0,10} $')</b> <br>  vous pouvez m√™me <s>nakostylyat</s> "esquiver" (dans tous les sens) comme ceci: <b>reverse (substring (reverse (X) for 10))</b> </div></div><br><br>  <b>4.2</b> Il existe une table ¬´table_6¬ª avec une colonne de texte ¬´X¬ª.  Le tableau contient une ligne (tout le texte en anglais et en russe uniquement): <br><pre> <code class="sql hljs">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</code> </pre> <br>  A) √âcrivez une requ√™te qui renverra les 42e √† 68e caract√®res de cette cha√Æne <br>  B) Comment extraire uniquement des lettres MAJUSCULES (russe ou anglais) dans une cha√Æne en utilisant SQL? <br>  C) Comment calculer la somme des nombres ( <u>pas des chiffres</u> ) dans une cha√Æne en utilisant SQL <br><br><div class="spoiler">  <b class="spoiler_title">Esquisse SQL</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_6(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 17 text Ultimate Answer of Life ?? 777'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> table_6</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">R√©ponses √† 4.2</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-comment"><span class="hljs-comment">--    WITH  "SQL " -- ) SELECT SUBSTRING(LEFT(X,68) FROM 42 ) FROM table_6 -- 1  SELECT SUBSTRING(X, 42, (68-42)+1) FROM table_6 -- 2  -- 3    -- )  ,        SELECT regexp_replace(X,'[^A-Z-]', '','g') FROM table_6 --  ''      - --   'g'    1  -- )        --   regexp_matches   **     ,      SELECT sum(x[1]::INT) FROM ( SELECT regexp_matches(X,'[0-9]+','g') FROM table_6 ) AS y(x) -- *        -- **   +,     (   1 ,     )</span></span></code> </pre> </div></div><br><br>  <b>4.3</b> Comment remplacer tous les espaces doubles (triples ou plus) par un seul espace dans le texte (cellule du tableau)?  (par tradition: la table " <i>table_7</i> " avec la colonne " <i>X</i> ") (PS il suffira d'√©crire <i>SELECT</i> renvoyant le r√©sultat souhait√©, et non <i>UPDATE table_7 ...</i> ) <br><br><div class="spoiler">  <b class="spoiler_title">R√©pondre √† 4.3</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> table_7(X) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'Lorem 3 Ipsum 23 standard 7 dummy 11 text'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- 1 .    (2   ) SELECT regexp_replace(X, '( ){2,}', ' ', 'g') FROM table_7 -- 2 .     (,  ,    ..)   ,      SELECT regexp_replace(X, '\s+', ' ', 'g') FROM table_7 --  !  ,  -    ,    "" .    .. --   ,    , ,        --    ,      ,    SELECT replace(replace(replace(X, ' ', '&lt;&gt;'), '&gt;&lt;', ''), '&lt;&gt;', ' ') FROM table_7</span></span></code> </pre><br></div></div><br>  <b>4.4</b> Il existe une cha√Æne " <i>X</i> " dans laquelle les fautes de frappe sont autoris√©es.  Au lieu des lettres russes (e, o, s, C), des caract√®res similaires de l'ext√©rieur de l'alphabet anglais ont √©t√© utilis√©s.  Remplacez ces caract√®res par SQL. <br><br>  PS La ligne ne doit contenir que des caract√®res russes, et vous ne devez pas vous inqui√©ter d'un √©ventuel changement de mots anglais. <br><br>  (Si vous √©prouvez des difficult√©s √† remplacer tous les personnages, remplacez-en au moins un) <br><br>  Exemple de ligne: <br><br> <code>X = 'Coeo  eoc oe'</code> <br> <br><div class="spoiler">  <b class="spoiler_title">R√©pondre √† 4.4</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- , Replace(Replace(Replace(..  ,  --        (1   1 ) SELECT TRANSLATE('Coeo  eoc oe', 'Cceo', '')</span></span></code> </pre> </div></div><br>  <b>4.5</b> √âcrivez une requ√™te qui convertit une cha√Æne: <br>  <b>¬´</b> <b>Ivan Ivanov et Ivanovich¬ª</b> √† l'esp√®ce <b>¬´Ivan Ivanov</b> <br><br><div class="spoiler">  <b class="spoiler_title">R√©pondre √† 4.5</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  ,     SELECT initcap('  ') *     </span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Qu√™te bonus pour ceux qui ont r√©ussi</b> <div class="spoiler_text">  <s>Id√©al s'il y a une fonction pr√™te √† l'emploi</s> <br>  Pouvez-vous convertir l'inverse?  (de pr√©f√©rence sans perdre de rembourrage). <br>  Peut-√™tre que la t√¢che n'est pas typique, mais elle sera utile pour le d√©veloppement. <br><br>  <b>¬´IVANOV IVAN IVANOVICH¬ª</b> converti en <b>¬´IVANOV IVAN IVANOVICH¬ª</b> <br>  <s>et inverser le cas?</s> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">R√©ponse au d√©fi bonus</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> string_agg(<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span>(x,<span class="hljs-number"><span class="hljs-number">1</span></span>)) || <span class="hljs-keyword"><span class="hljs-keyword">UPPER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(x <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)), <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rn) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> regexp_split_to_table(<span class="hljs-string"><span class="hljs-string">'    4 TesT'</span></span>, <span class="hljs-string"><span class="hljs-string">'\y'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDINALITY</span></span> y(x, rn) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> z <span class="hljs-comment"><span class="hljs-comment">-- *  PostgreSQL,      --    ,     --      ,      --      . -- WITH ORDINALITY      (   9.4) --      --          -- ..</span></span></code> </pre> </div></div><br><h4>  5. Un peu sur les transactions </h4><br>  Les transactions sont une chose tr√®s importante dans un SGBD, il est important de comprendre les principaux points. <br><br>  Je vais essayer de simuler un exemple: <br><br>  Supposons qu'il existe une table ¬´biens¬ª avec laquelle deux utilisateurs vont travailler. <br>  Il a une colonne de <i>remise</i> enti√®re √©gale √† <u>10</u> pour toutes les lignes. <br>  Les param√®tres de la base de donn√©es sont standard (READ COMMITTED - lecture des donn√©es valid√©es). <br><br>  L'utilisateur <i>User_1</i> ouvre une transaction, ex√©cute la demande suivante: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre><br>  Une seconde plus tard, un autre utilisateur ( <i>User_2</i> ) <br>  Il effectue presque la m√™me demande sans ouvrir de transaction: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> discount = discount + <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  Que pensez-vous qu'il se passera dans les situations suivantes: <br><br>  <b>A)</b> Quel r√©sultat l'Utilisateur_2 obtiendra-t-il si l'Utilisateur_1 laisse la transaction ouverte (c'est-√†-dire qu'il ne confirme pas la transaction / n'annule pas les modifications)? <br>  Ce que User_1 verra sur demande: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> discount <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  <b>B)</b> Que se passe-t-il si User_1 fait ROLLBACK?  Quels r√©sultats obtiendra User_2? <br><br>  <b>Q)</b> Que se passe-t-il si User_1 COMMIT?  Quels r√©sultats obtiendra User_2? <br><br><div class="spoiler">  <b class="spoiler_title">Les r√©ponses</b> <div class="spoiler_text">  Pour autant que je sache, READ <b>UN</b> COMMITTED n'est pas pris en charge dans PostgreSQL, et les donn√©es sales (non confirm√©es) ne peuvent pas √™tre lues <br><br>  Les r√©ponses seront les suivantes: <br><br>  A) La requ√™te <u>User_2</u> attendra COMMIT ou ROLLBACK de User_1.  (la demande semble geler) <br>  <u>L'utilisateur_1</u> dans sa transaction verra sa version de l'instantan√© de la base de donn√©es, o√π la <i>remise est</i> d√©j√† √©gale √† <b>15</b> <br><br>  B) Si User_1 effectue un ROLLBACK, la valeur de la <i>remise</i> restera la m√™me, puis User_2 sera ex√©cut√©, ce qui ajoutera 10 √† la <i>remise</i> et la remise sera de <b>20</b> <br><br>  C) Si User_1 effectue COMMIT, la valeur de la <i>remise</i> augmentera de 5, puis User_2 sera ex√©cut√©e, ce qui ajoutera 10 √† la <i>remise</i> et la remise sera de <b>25</b> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Une autre version de cette t√¢che</b> <div class="spoiler_text">  Une version l√©g√®rement diff√©rente de la t√¢che 13 de l'utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">kirill_petrov</a> sur READ COMMITTED <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--      CREATE TABLE goods (discount) AS (SELECT 10::INT UNION ALL SELECT 15); -- 1. User_1   (  ): BEGIN; UPDATE goods SET discount = discount + 5; --2. User_2  : UPDATE goods SET discount = discount + 100 WHERE discount = 15 --3. User_1  COMMIT;</span></span></code> </pre>  Quelles donn√©es figureront dans le tableau? <br></div></div><br><h4>  Conclusion </h4><br>  Je pense que cela a touch√© des points assez int√©ressants. <br><br>  J'esp√®re que les t√¢ches aideront √† motiver les d√©butants, car il est ennuyeux d'apprendre quelque chose sans buts / objectifs / directions sp√©cifiques. <br><br>  Je peux √™tre heureux pour ceux qui ont √©t√© faciles √† r√©pondre √† toutes les questions.  Et ceux qui ont eu des difficult√©s, je l'esp√®re, se sont <s>lanc√©s dans la</s> voie du d√©veloppement.  Ceux qui ne comprennent pas grand-chose mais veulent apprendre le SQL, j'invite le cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PostgreSQL pour les jeunes combattants</a> √† mon dernier article. <br><br>  J'attends avec impatience tous les ajouts, solutions √† des probl√®mes particuli√®rement int√©ressants (vous pouvez exploiter) et d'autres commentaires! <br><br>  Merci de votre attention!  Je vous souhaite beaucoup de succ√®s dans l'apprentissage du SQL! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423097/">https://habr.com/ru/post/fr423097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423087/index.html">Ne me pousse pas dans les yeux</a></li>
<li><a href="../fr423089/index.html">Programmeurs √† MBLT DEV 2018</a></li>
<li><a href="../fr423091/index.html">Flutter pour les d√©veloppeurs Android. Comment cr√©er une interface utilisateur pour une activit√© √† l'aide de Flutter</a></li>
<li><a href="../fr423093/index.html">Nous augmentons le caract√®re al√©atoire du fait que [probablement] [presque] par accident</a></li>
<li><a href="../fr423095/index.html">Nouveaut√©s d'Apple Presentation</a></li>
<li><a href="../fr423101/index.html">D√©ploiement du stockage LINSTOR pour Proxmox</a></li>
<li><a href="../fr423103/index.html">Podcasts Python: c'est tout ce que nous avons trouv√©</a></li>
<li><a href="../fr423105/index.html">System.IO.Pipelines: E / S hautes performances dans .NET</a></li>
<li><a href="../fr423107/index.html">Nous vous invitons √† la r√©union Go in Production</a></li>
<li><a href="../fr423109/index.html">Ce qu'Apple a pr√©sent√© et ce qu'en pensent les d√©veloppeurs iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>