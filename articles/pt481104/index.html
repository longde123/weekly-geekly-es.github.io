<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßïüèø üëØ ü§¥üèæ Misturando OpenJDK e NodeJS: intera√ß√µes entre idiomas e arquitetura vertical üèñÔ∏è ‚ûñ üåÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! 

 Durante muito tempo, tive a ideia de discutir o GraalVM com voc√™, adiada at√© finalmente encontrar o artigo de hoje, cujo assunto vai muit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Misturando OpenJDK e NodeJS: intera√ß√µes entre idiomas e arquitetura vertical</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/481104/">  Ol√° Habr! <br><br>  Durante muito tempo, tive a ideia de discutir o <a href="https://www.graalvm.org/">GraalVM</a> com voc√™, adiada at√© finalmente encontrar o artigo de hoje, cujo assunto vai muito al√©m do escopo da an√°lise de uma m√°quina virtual espec√≠fica.  O autor Mike Hearn descreve todo o paradigma de intera√ß√£o entre idiomas e programa√ß√£o multil√≠ngue (programa√ß√£o poliglota).  A seguir, √© apresentado o famoso exemplo de escala vertical e um artigo muito longo sob o corte. <br><br><img src="https://habrastorage.org/webt/w8/rn/pl/w8rnplm8qono1q-owxp4_dcmlxk.jpeg"><br><a name="habracut"></a><br>  Este artigo √© sobre uma maneira inovadora de escrever software que pode se tornar popular no futuro, mas provavelmente n√£o agora.  O artigo tem um c√≥digo, honestamente! <br><br>  Nos tempos antigos, ou seja, em 2015, escrevi <a href="https://blog.plan99.net/why-kotlin-is-my-next-programming-language-c25c001e26e3%3F">por que o Kotlin seria minha pr√≥xima linguagem de programa√ß√£o</a> e em 2016 escrevi sobre <a href="https://blog.plan99.net/graal-truffle-134d8f28fb69">Graal e Truffle</a> : dois projetos radicais de pesquisa relacionados a compiladores que n√£o apenas aceleram significativamente o trabalho de linguagens como Ruby , mas tamb√©m incorporam, na realidade, intera√ß√µes interl√≠ngua perfeitas.  Nesses projetos, o compilador din√¢mico (JIT) ou OpenJDK √© substitu√≠do por um novo que tem a capacidade de transformar int√©rpretes anotados em compiladores JIT de ponta ... automaticamente. <br><br>  Voltando a esses t√≥picos em 2019, gostaria de mostrar tr√™s coisas: <br><br><ol><li>  Como usar a pequena biblioteca que escrevi para usar quase perfeitamente m√≥dulos NPM a partir do c√≥digo de programas escritos em Java ou Kotlin. </li><li>  Explique todas as boas raz√µes pelas quais voc√™ pode precisar, mesmo se voc√™ acha que JavaScript / Java √© a pior coisa do mundo, sem contar o √≥leo de peixe. </li><li>  Explore brevemente o conceito de arquitetura vertical que compete com o design orientado a microsservi√ßos.  Est√° localizado na interse√ß√£o das vers√µes mais recentes do GraalVM e do OpenJDK e requer o hardware mais avan√ßado. </li></ol><br><h4>  Usando NPMs de Java e Kotlin </h4><br>  Tomaremos apenas tr√™s etapas simples: <br><br><ol><li> Tome <a href="https://www.graalvm.org/">GraalVM</a> .  Este √© um conjunto de corre√ß√µes, constru√≠do sobre o OpenJDK, que apareceu bem a tempo: ele pode executar todo o c√≥digo de bytes da JVM que voc√™ possui. </li><li>  Pegamos meu kit de ferramentas <a href="https://github.com/mikehearn/nodejvm">NodeJVM</a> do github e o adicionamos ao nosso caminho. </li><li> Substitua <code>java</code> na linha de comandos por <code>nodejvm</code> .  Isso √© tudo! </li></ol><br>  Ok, ok.  Eu admito, aqui eu desenho um pouco e exagero, at√© o final do artigo voc√™ ter√° que suportar esse estilo.  Claro, nem tudo √© t√£o simples: voc√™ ainda precisa pegar o m√≥dulo e us√°-lo. <br><br>  Considere como se parece: <br><br><img src="https://habrastorage.org/webt/f3/ov/xv/f3ovxvzch5mpwwmhy8w7tqyyiaw.png"><br><br>  C√≥digo de amostra usando o NodeJVM <br><br>  D√™ uma olhada nesta foto.  Sim, √© exatamente isso que parece: Kotlin com uma sequ√™ncia de v√°rias linhas incorporada na qual ocorre o preenchimento autom√°tico de JavaScript, ap√≥s o qual a an√°lise est√°tica de JavaScript √© realizada e a sintaxe √© destacada corretamente.  As mesmas opera√ß√µes funcionam com Java ou outras linguagens para a JVM que o IntelliJ entende.  Para obter essas oportunidades, √© necess√°rio clicar no comutador nas configura√ß√µes do IDE (leia o leia-me do NodeJVM para saber como fazer isso), mas mais tarde essa fun√ß√£o funcionar√° automaticamente.  Se o IntelliJ conseguir descobrir, analisando o fluxo de dados que sua sequ√™ncia deve eventualmente ser passada para os m√©todos <code>run</code> ou <code>eval</code> , ela ser√° tratada como JS incorporado. <br><br>  Aqui vou falar sobre a API do Kotlin, j√° que √© um pouco mais bonita e mais conveniente do que a API em Java normal, mas tudo o que descrevo abaixo tamb√©m pode ser feito a partir de Java. <br><br>  No c√≥digo acima, preste aten√ß√£o a v√°rios dos seguintes recursos: <br><br><ul><li>  Para acessar o JavaScript, voc√™ deve usar o bloco <code>nodejs {}</code> .  O fato √© que o JavaScript √© de thread √∫nico e, portanto, para executar os m√≥dulos do NPM, √© necess√°rio "inserir o fluxo do n√≥".  O bloco <code>nodejs {}</code> executa essa sincroniza√ß√£o para n√≥s, independentemente do segmento em que estamos.  Portanto, voc√™ precisa se lembrar constantemente: para executar qualquer c√≥digo JS, em princ√≠pio, voc√™ precisa estar dentro desse bloco.  Voc√™ pode inseri-lo novamente quantas vezes quiser, para que seja seguro usar esse bloco em qualquer lugar onde for necess√°rio.  Quaisquer retornos de chamada JavaScript ser√£o executados no encadeamento Node e, portanto, todos os outros encadeamentos ter√£o acesso negado ao bloco <code>nodejs</code> ; portanto, se voc√™ estiver preocupado com o desempenho ou com a renderiza√ß√£o da GUI, evite executar opera√ß√µes de longa execu√ß√£o nos retornos de chamada. </li><li>  A sintaxe <code>var x by bind(SomeObject())</code> est√° dispon√≠vel apenas no bloco <code>nodejs</code> e permite conectar-se √† mesma vari√°vel no escopo global do JavaScript.  Quando x muda do Kotlin, ele muda no JS e vice-versa.  Aqui estou anexando um objeto Java <code>File</code> regular ao mundo JS. </li><li>  O m√©todo <code>eval</code> retorna ... o que pedimos para retornar, no entanto, na forma de digita√ß√£o est√°tica.  Essa √© uma fun√ß√£o gen√©rica e, simplesmente especificando o tipo de entidade que atribu√≠mos a ela, garantiremos que o eval transmita automaticamente o objeto JavaScript para uma classe tipicamente estatizada ou para uma interface Java / Kotlin / Scala / etc.  Embora isso n√£o tenha sido explicitamente declarado acima, <code>MemoryUsage</code> √© um tipo de interface simples que eu defini e possui as fun√ß√µes <code>rss()</code> e <code>heapTotal()</code> .  Eles s√£o mapeados para as propriedades JavaScript com o mesmo nome, aplicando-as ao que voc√™ obt√©m da API do <code>process.memoryUsage()</code> .  A maioria dos tipos JS pode, portanto, ser convertida em tipos Java "normais";  documenta√ß√£o detalhada de como funciona est√° dispon√≠vel no site do GraalVM.  Os objetos resultantes podem ser armazenados em qualquer lugar, mas o m√©todo que os chama, √© claro, deve ser feito no bloco <code>nodejs</code> . </li><li>  Os objetos JavaScript tamb√©m podem ser considerados mapeamentos simples de uma string para um objeto, o que de muitas maneiras realmente corresponde √† sua natureza.  Por sua vez, esses mapeamentos de uma string para um objeto podem ser trazidos de volta para algo mais forte do tipo, que pode ser visto claramente no retorno de chamada.  Use a apresenta√ß√£o que voc√™ preferir. </li><li>  Voc√™ pode usar o <code>require</code> e ele procurar√° por m√≥dulos nos diret√≥rios <code>node_modules</code> da maneira usual. </li></ul><br>  O trecho de c√≥digo acima usa o protocolo <a href="https://dat.foundation/">DAT</a> , que permite conectar-se a uma rede ponto a ponto remotamente semelhante ao BitTorrent e, em seguida, procurar pares que tenham o arquivo desejado.  Uso o DAT como exemplo, uma vez que √© (a) descentralizado e, portanto, exclusivamente chique e (b) para o bem ou para o mal, sua implementa√ß√£o de refer√™ncia √© escrita em JavaScript.  Este n√£o √© um programa que eu poderia escrever completamente sem usar JS em um tempo razo√°vel. <br><br>  Isso tamb√©m pode ser feito no Java: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.plan99.nodejs.NodeJS; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Demo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = NodeJS.runJS(() -&gt; NodeJS.eval(<span class="hljs-string"><span class="hljs-string">"return 2 + 3 + 4"</span></span>).asInt() ); System.out.println(result); } }</code> </pre> <br>  A API Java n√£o fornece uma liga√ß√£o vari√°vel agrad√°vel e convers√£o autom√°tica como a API Kotlin, mas √© bastante f√°cil de usar.  Aqui, mostramos como convertemos o resultado em um tipo inteiro Java ( <code>int</code> ) e o retornamos ‚Äúdo‚Äù fluxo Node: nesse caso, o fluxo Java principal <b>n√£o</b> √© <b>o mesmo que o</b> fluxo NodeJS, mas alternamos esses fluxos completamente sem problemas. <br><br>  O NodeJVM √© um inv√≥lucro muito, muito pequeno, sobre o <a href="https://www.graalvm.org/">GraalVM</a> .  Ele adiciona uma quantidade insignificante de c√≥digo; portanto, n√£o se preocupe, pois ele pode deixar de ser suportado ou desaparecer: 99,99% de todo o trabalho √°rduo nesse caso √© realizado pela equipe do GraalVM. <br><br>  Aqui est√£o algumas id√©ias √≥bvias para sugerir melhorias: <br><br><ul><li>  Permita que os m√≥dulos JS importem m√≥dulos Java pela coordenada Maven. </li><li>  Formular algumas ‚Äúmelhores pr√°ticas‚Äù para a javiza√ß√£o de m√≥dulos NPM.  Por exemplo, um arquivo JAR pode conter um diret√≥rio node_modules (em resumo: n√£o, pois o NodeJS ainda organiza a E / S do arquivo de sua pr√≥pria maneira e n√£o sabe nada sobre zips, long: yes, se voc√™ se esfor√ßar). </li><li>  Mais idiomas: Python e Ruby n√£o precisam da ‚Äúcola‚Äù para sincroniza√ß√£o de threads necess√°ria no NodeJS; portanto, voc√™ pode usar apenas a <a href="https://www.graalvm.org/docs/reference-manual/polyglot/">API</a> regular do <a href="https://www.graalvm.org/docs/reference-manual/polyglot/">GraalVM Polyglot</a> .  Mas os usu√°rios do Kotlin descobrir√£o que m√©todos de convers√£o / extens√£o e APIs para vari√°veis ‚Äã‚Äãde liga√ß√£o seriam bons em qualquer idioma. </li><li>  Suporte do Windows. </li><li>  Plugin Gradle para que os programas possam ter listas de depend√™ncia em um conjunto misto de idiomas </li><li>  Integra√ß√£o com a ferramenta de <code>native-image</code> , o chamado  SubstrateVM;  portanto, se voc√™ n√£o precisar do desempenho completo do HotSpot em tempo de execu√ß√£o, poder√° fornecer pequenos bin√°rios vinculados estaticamente no estilo Golang. </li><li>  Talvez algum tipo de conversor para converter TypeScript em Java, para que voc√™ possa usar o <a href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a> e mergulhar rapidamente no mundo est√°tico. </li></ul><br>  Patches s√£o bem-vindos. <br><br><h4>  Por que voc√™ precisaria disso? </h4><br>  Talvez voc√™ j√° esteja pensando: "Uau, o JavaScript, n√≥s, desenvolvido, agora podemos estar em amor m√∫tuo, respeito e harmonia m√∫tuos!" <br><br><img src="https://habrastorage.org/webt/pg/hg/_d/pghg_dqd6pgbortse6gaqdks-p8.gif"><br><br>  Rea√ß√£o Entusiasmada Idealizada <br><br>  √â muito poss√≠vel que voc√™ esteja mais pr√≥ximo deste ponto de vista: <br><br><img src="https://habrastorage.org/webt/j9/th/g6/j9thg6dscg5ce13x_vtpajwvjmm.jpeg"><br><br>  JavaScript e Java n√£o s√£o apenas linguagens.  Essas s√£o culturas, e nada √© t√£o doce para os desenvolvedores quanto as CULTURAL WARS! <br><br>  √â por isso que voc√™ deve pelo menos marcar esta p√°gina como refer√™ncia futura, mesmo que voc√™ queira apenas pegar a arma com o simples pensamento de $ OTHER_LANG invadindo seu precioso ecossistema: <br><br><ul><li>  Se voc√™ √© principalmente desenvolvedor <b>Java</b> , agora tem acesso a m√≥dulos JavaScript exclusivos que podem n√£o ter um equivalente na JVM (por exemplo, o protocolo DAT).  Voc√™ pode ador√°-lo ou odi√°-lo, mas o fato permanece: muitas pessoas escrevem m√≥dulos NPM de c√≥digo aberto, e alguns desses m√≥dulos s√£o muito bons.  Voc√™ tamb√©m pode reutilizar o c√≥digo executado em suas interfaces da Web sem a necessidade de transportadores de idiomas.  E se voc√™ estiver trabalhando com uma base de c√≥digo herdada no NodeJS, que gostaria de portar gradualmente para Java, de repente esse trabalho ser√° bastante simplificado. </li><li>  Se voc√™ √© principalmente desenvolvedor de <b>JavaScript</b> , agora tem acesso f√°cil a bibliotecas exclusivas da JVM, que em JavaScript podem n√£o ter um equivalente direto (por exemplo, <a href="http://lucene.apache.org/">Lucene</a> , <a href="https://github.com/OpenHFT/Chronicle-Map">Mapa de Cr√¥nicas</a> ) ou podem oferecer apenas an√°logos pouco documentados, imaturos ou menos produtivos .  Se voc√™ quiser ficar sem HTML em seu pr√≥ximo projeto, poder√° explorar a <a href="https://blog.plan99.net/reacts-tictactoe-tutorial-in-kotlin-javafx-715c75a947d2">estrutura</a> da <a href="https://blog.plan99.net/reacts-tictactoe-tutorial-in-kotlin-javafx-715c75a947d2">GUI para uma pessoa branca</a> .  Voc√™ tamb√©m obt√©m acesso a <b>muitos outros idiomas</b> , por exemplo, objetos Ruby e R. JVM podem ser compartilhados entre funcion√°rios do NodeJS, <a href="https://medium.com/graalvm/multi-threaded-java-javascript-language-interoperability-in-graalvm-2f19c1f9c37b">aproveitando o multithreading na mem√≥ria compartilhada</a> , se, de acordo com o seu perfilador, essa oportunidade puder ser usada.  E se voc√™ estiver trabalhando com uma base herdada de c√≥digo Java que gostaria de portar gradualmente para o NodeJS, subitamente esse trabalho ser√° bastante simplificado. </li><li>  Se voc√™ <b>aprender todos os idiomas de uma s√≥ vez</b> , poder√° fazer a programa√ß√£o multil√≠ngue.  Os programadores poliglotas n√£o s√£o odiadores, pelo contr√°rio, podem fazer amizade com o melhor c√≥digo dispon√≠vel, independentemente da cultura de origem.  Eles s√£o como estudantes do Renascimento que estudaram imediatamente Ingl√™s, Franc√™s Latim ... todos esses idiomas s√£o um para eles.  Eles misturam as bibliotecas Java, Kotlin, JavaScript, Scala, Python, Ruby, Lisp, R, Rust, Smalltalk, C / C ++ e at√© FORTRAN, unindo puramente um inteiro puro no GraalVM. </li><li>  Por fim, se voc√™ √© um usu√°rio feliz do NodeJS e outros idiomas n√£o o incomodam, voc√™ ainda pode experimentar o GraalVM. </li></ul><br>  O NodeJS √© baseado na V8, uma m√°quina virtual projetada para usar scripts de thread √∫nico de curta dura√ß√£o que s√£o executados em PCs e smartphones.  √â exatamente isso que √© financiado pelo Google, mas o V8 tamb√©m √© usado em servidores.  O OpenJDK foi otimizado por d√©cadas em servidores.  As vers√µes mais recentes cont√™m <a href="https://wiki.openjdk.java.net/display/zgc/Main">ZGC</a> e <a href="https://wiki.openjdk.java.net/display/shenandoah/Main">Shenandoah</a> , dois coletores de lixo que permitem lat√™ncia m√≠nima, ferramentas que permitem consumir terabytes de mem√≥ria, com apenas alguns milissegundos de pausas.  Portanto, voc√™ pode at√© reduzir custos usando a <a href="https://www.graalvm.org/docs/reference-manual/tools/">excelente infraestrutura e ferramentas do GraalVM</a> , sem sequer abandonar o monolingualismo. <br><br><img src="https://habrastorage.org/webt/tn/4y/68/tn4y68r7cmq6z9tpheeuwafpncy.png"><br><br>  Exibir a pilha que cont√©m objetos Ruby <br><br><img src="https://habrastorage.org/webt/ko/vc/jj/kovcjjmwvhnayjpfix25cs-rx48.png"><br><br>  M√©tricas de CPU dispon√≠veis atrav√©s de HTTP <br><br><img src="https://habrastorage.org/webt/sb/fq/qy/sbfqqy9mzuppcp-vnro8tdscc_o.png"><br><br>  Diagn√≥stico especializado ultra-profundo, demonstrando como o c√≥digo foi otimizado <br><br><h4>  Arquitetura vertical </h4><br>  Chegamos ao √∫ltimo t√≥pico que gostaria de discutir neste artigo. <br><br>  √Äs vezes digo a algu√©m tudo o que foi dito acima, mas elas me respondem: ‚Äú <i>Isso √© √≥timo, mas todos esses microsservi√ßos n√£o est√£o nos dando tudo isso?</i>  <i>Por que toda essa confus√£o?</i>  √â dif√≠cil entender por que gosto tanto de programa√ß√£o multil√≠ngue, mas o fato √© que me parece que as arquiteturas de microsservi√ßos precisam de uma concorr√™ncia saud√°vel. <br><br>  Em primeiro lugar, sim, √†s vezes voc√™ precisa dirigir muitos servi√ßos em uma variedade de servidores que precisam interagir.  Trabalhei por mais de 7 anos no Google, lidando quase diariamente com o orquestrador de cont√™ineres Borg.  Escrevi "microsservi√ßos", embora nem lig√°ssemos para eles e eu os consumi.  Caso contr√°rio, n√£o havia como lidar, porque nossas cargas de trabalho exigiam a participa√ß√£o de milhares de m√°quinas! <br><br>  No entanto, para essas arquiteturas, voc√™ deve pagar um pre√ßo alto: <br><br><ol><li>  <b>Serializa√ß√£o</b>  Isso resulta imediatamente em uma diminui√ß√£o da produtividade, mas, mais importante, exige que voc√™ alinhe constantemente suas estruturas de dados pelo menos parcialmente digitadas e otimizadas, transformando-as em √°rvores simples.  Ao recorrer ao JSON, voc√™ perde a capacidade de fazer coisas simples, por exemplo, ter muitos objetos pequenos que apontam para v√°rios objetos grandes (para evitar repeti√ß√µes, voc√™ deve usar seus pr√≥prios √≠ndices). </li><li>  <b>Versionamento</b>  Isso √© complicado.  As universidades geralmente n√£o ensinam essa disciplina dif√≠cil, mas todos os dias, no campo da engenharia de software e, mesmo que voc√™ pense que entendeu completamente a diferen√ßa entre compatibilidade direta e reversa, mesmo que tenha certeza de que entende o que √© rolagem em v√°rios est√°gios, pode garantir que tudo isso ser√° entendido pela pessoa que o substituir√°?  Voc√™ est√° realizando testes de integra√ß√£o corretamente para v√°rias combina√ß√µes de vers√µes que podem se desenvolver durante a implanta√ß√£o n√£o at√¥mica?  Nas arquiteturas distribu√≠das, vi v√°rios desastres genu√≠nos que se resumiam ao fato de as vers√µes se perderem. </li><li>  <b>Coer√™ncia</b> .  Realizar opera√ß√µes at√¥micas no mesmo servidor √© bastante f√°cil.  √â muito mais dif√≠cil garantir que os usu√°rios, em qualquer situa√ß√£o, vejam uma imagem absolutamente consistente quando muitas m√°quinas estiverem envolvidas no sistema, especialmente se ocorrer compartilhamento de dados entre eles.  √â por isso que, historicamente, os mecanismos de banco de dados relacional n√£o podem se orgulhar de boa escalabilidade.  Deixe-me dizer: os <a href="https://www.piter.com/collection/all/product/site-reliability-engineering-nadezhnost-i-bezotkaznost-kak-v-google">melhores engenheiros do Google passaram d√©cadas</a> tentando simplificar a programa√ß√£o distribu√≠da para suas equipes, tentando constru√≠-lo para que pare√ßa mais com o tradicional. </li><li>  <b>Re-implementa√ß√£o</b> .  Como as chamadas de procedimento remoto s√£o caras, voc√™ n√£o far√° muitas chamadas e n√£o h√° mais o que fazer para resolver alguns problemas, mas reimplementar o c√≥digo.  O Google criou algumas bibliotecas para trabalhar com v√°rios idiomas ao mesmo tempo, projetadas para fazer chamadas para procedimentos remotos;  H√° tamb√©m situa√ß√µes em que esse c√≥digo deve ser reescrito do zero. </li></ol><br>  Ent√£o, qual √© a alternativa? <br><br>  Simplificando, muito ferro.  Esse m√©todo pode parecer absurdamente av√¥, mas lembre-se de que o custo do hardware est√° diminuindo constantemente, muitas cargas de trabalho n√£o s√£o chamadas de "global global" e sua intui√ß√£o sobre o que voc√™ deve gastar pode falhar. <br><br>  Aqui est√° uma <a href="http://www.deltaserverstore.com/dell-r910.html">lista de pre√ßos</a> relativamente recente de um fabricante canadense: <br><br><img src="https://habrastorage.org/webt/_2/ko/qq/_2koqq_9uanqjed7ebsfcwjzyqy.png"><br><br>  Uma m√°quina nuclear de quarenta com um terabyte de RAM e quase um terabyte no disco r√≠gido custa hoje cerca de US $ 6 mil.  Imagine quanto tempo, durante toda a vida do projeto, sua equipe ter√° para resolver problemas com sistemas distribu√≠dos e quanto isso lhe custar√°. <br><br>  Sim, mas nem todas as empresas de hoje s√£o baseadas na Web globalmente? <br><br>  Em suma, n√£o. <br><br>  O mundo est√° cheio de empresas para as quais o seguinte √© verdadeiro: <br><br><ul><li>  Eles operam em mercados est√°veis. </li><li>  Eles ganham vendendo coisas. </li><li>  Consequentemente, sua base de clientes √© de v√°rias dezenas de milhares a dezenas de milh√µes de pessoas, mas n√£o na casa dos bilh√µes. </li><li>  Seus conjuntos de dados geralmente s√£o associados a seus pr√≥prios clientes e produtos. </li></ul><br>  Um bom exemplo dessa empresa √© um banco.  Os bancos n√£o experimentam "hiper-crescimento", n√£o se tornam "virais".  Seu modelo de crescimento √© moderado e previs√≠vel, se algu√©m assumir que possui algum tipo de crescimento (os bancos s√£o regionais e geralmente operam em mercados saturados).  A base de clientes do maior banco dos EUA √© de cerca de 50 milh√µes de usu√°rios e, √© claro, n√£o dobra a cada seis meses.  Nesse caso, a situa√ß√£o n√£o √© igual √† do Instagram.  Portanto, √© de admirar que o mainframe ainda seja baseado em um sistema banc√°rio t√≠pico?  Obviamente, o mesmo vale para empresas de log√≠stica, manufaturas, etc.  Este √© o p√£o com manteiga da nossa economia. <br><br>  Nesses neg√≥cios, √© perfeitamente poss√≠vel que as necessidades de cada aplicativo espec√≠fico relacionado a eles sempre possam ser atendidas com os recursos de apenas uma m√°quina grande.  Sim, at√© mesmo alguns sites p√∫blicos hoje cabem em uma √∫nica m√°quina.  Em 2015, Maciej Tseglovsky fez uma palestra muito interessante sobre ‚Äú <a href="https://idlewords.com/talks/website_obesity.htm">A crise com a obesidade dos sites</a> ‚Äù e observou que seu pr√≥prio site com servi√ßo de bookmarking era rent√°vel, mas seu concorrente postou o mesmo site na AWS - e perdeu, apenas por causa dos custos diferentes equipamentos e v√°rias suposi√ß√µes sobre complexidade.  Em um estudo sobre a compara√ß√£o <a href="https://blog.codinghorror.com/scaling-up-vs-scaling-out-hidden-costs/">das escalas vertical e horizontal,</a> verificou-se que o PlentyOfFish roda em aproximadamente ~ um megaserver (o artigo data de 2009, para que voc√™ possa ignorar os pre√ßos dos equipamentos listados l√°).  O autor faz alguns c√°lculos e mostra que um servidor n√£o √© t√£o est√∫pido quanto parece.  Por fim, se voc√™ est√° considerando o Hadoop e o Big Data, leia este <a href="https://www.researchgate.net/publication/261862149_Scale-up_vs_scale-out_for_Hadoop_time_to_rethink">artigo de pesquisa da Microsoft em 2013,</a> que demonstra que muitas das cargas de trabalho do Hadoop da Microsoft, Yahoo e Facebook s√£o realmente executadas com muito mais rapidez e efici√™ncia em uma √∫nica m√°quina grande do que em um cluster.  E assim foi h√° 6 anos!  √â prov√°vel que, desde ent√£o, a √™nfase a favor da escala vertical tenha se tornado ainda mais pronunciada. <br><br>  No entanto, a economia real n√£o est√° associada a nenhum equipamento, mas √† otimiza√ß√£o do tempo de trabalho extremamente caro dos engenheiros, que √© gasto na cria√ß√£o de v√°rios microsservi√ßos min√∫sculos que devem ser dimensionados horizontalmente com o gerenciamento el√°stico da demanda.  Essa abordagem de engenharia √© arriscada e demorada, mesmo se voc√™ usar os brinquedos mais recentes dispon√≠veis na nuvem.  Voc√™ pode perder transa√ß√µes SQL, SOLID, cria√ß√£o de perfil unificado e definitivamente perder√° informa√ß√µes como rastreamento de pilha entre sistemas.  A seguran√ßa de tipo desaparecer√° sempre que voc√™ for al√©m do servidor.  Voc√™ receber√° chamadas para fun√ß√µes que podem exceder o tempo limite, sobrecarga excessiva associada √† compila√ß√£o din√¢mica, falhas inesperadas de contrapress√£o, mecanismos de orquestra√ß√£o complexos com formatos de configura√ß√£o sofisticados e ... ah, as mem√≥rias realmente inundaram.  Foi interessante trabalhar com tudo isso quando eu tinha a arquitetura propriet√°ria do Google e um or√ßamento de engenharia pesado √† minha disposi√ß√£o, mas hoje arriscaria repetir isso apenas se n√£o tivesse outra escolha. <br><br>  Segundo a experi√™ncia, √© imposs√≠vel trabalhar com servidores muito grandes que operam na coleta de lixo - o fato √© que a coleta de lixo em si era uma tecnologia pouco desenvolvida e, portanto, esse t√≥pico permaneceu puramente acad√™mico.  De qualquer forma, voc√™ tinha que dirigir v√°rios servidores ao mesmo tempo. ,   ZGC  Shenandoah,   ,   80          ‚Äì      .    ,     -,       ‚Äì  ,     . <br><br> ,         ?         ‚Äì   ,        ?   ‚Äì    :  ,      ,        ‚Ä¶    . <br><br><h4>  Conclus√£o </h4><br> NodeJVM ‚Äì  ,    GraalVM.     NPM    Java/Kotlin,   JS  ,    Kotlin   JavaScript,      JS  ,   V8. <br><br>     ,    JS  Java,    Java  JS         . <br><br>        ,           4 ,     ‚Äì      ‚Äì  ,            .             . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt481104/">https://habr.com/ru/post/pt481104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt481086/index.html">Vivaldi 2.10 - Agente secreto</a></li>
<li><a href="../pt481092/index.html">A coisa mais interessante no PHP 8</a></li>
<li><a href="../pt481094/index.html">Sobre os fones de ouvido sem fio JBL com energia solar e o que h√° de errado com eles</a></li>
<li><a href="../pt481100/index.html">Angular 9, o que h√° de novo?</a></li>
<li><a href="../pt481102/index.html">Lan√ßamento do kit de ferramentas de interface do usu√°rio .NET entre plataformas AvaloniaUI 0.9</a></li>
<li><a href="../pt481106/index.html">Como LANIT filmou uma com√©dia DIY em seu escrit√≥rio</a></li>
<li><a href="../pt481110/index.html">Playme VEGA review: gravador combinado com tela sens√≠vel ao toque e montagem em espelho</a></li>
<li><a href="../pt481112/index.html">O que o "chiclete" de 5700 anos vai dizer sobre a pessoa que o mastigou?</a></li>
<li><a href="../pt481114/index.html">Seccomp em Kubernetes: 7 coisas que voc√™ precisa saber desde o in√≠cio</a></li>
<li><a href="../pt481116/index.html">Publique automaticamente postagens da comunidade VKontakte no Discord</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>