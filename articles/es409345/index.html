<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìπ üî• üè≥Ô∏è Comprender el c√≥digo gen√©tico de los criptoc√≥ticos üöÇ üï∫üèæ üòø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... y aprenda a trabajar con las herramientas de desarrollo de Ethereum utilizando un ejemplo de la vida real. 

 Parte cero: el objeto apareci√≥ a la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comprender el c√≥digo gen√©tico de los criptoc√≥ticos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wirex/blog/409345/">  ... y aprenda a trabajar con las herramientas de desarrollo de Ethereum utilizando un ejemplo de la vida real. <br><br><h3>  Parte cero: el objeto apareci√≥ a la vista </h3><br>  Acabo de terminar mis conferencias sobre el curso completo de desarrollo de aplicaciones descentralizadas basadas en Ethereum en Solidity en chino.  Lo di en mi tiempo libre para aumentar el nivel de conocimiento sobre blockchain y contratos inteligentes entre la comunidad china de desarrolladores.  Durante mi trabajo me hice amigo de un par de estudiantes. <br><br>  Y justo al final del curso, de repente nos encontramos rodeados de estas criaturas: <br><br><img src="https://habrastorage.org/webt/ev/e-/ov/eve-ovga3bt6vx11ichn6jmkufm.png"><br><br>  <i>Imagen de cryptokitties.co</i> <br><br>  Como la mayor√≠a de las personas que se han encontrado con este fen√≥meno, nosotros tampoco pudimos resistir estas criptocreaciones lindas y r√°pidamente nos volvimos adictos al juego.  Nos gust√≥ sacar nuevos gatos e incluso reemplazamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el m√©todo del patito con el</a> m√©todo del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gato criptogr√°fico</a> .  Creo que la adicci√≥n a los juegos es mala, pero no en este caso, porque la pasi√≥n por la cr√≠a de gatitos nos llev√≥ r√°pidamente a la pregunta: <br><br><h3>  ¬øC√≥mo obtienen ciertos criptogatos su conjunto de genes? </h3><br>  Decidimos dedicar el s√°bado por la noche a encontrar la respuesta, y creemos que logramos progresar en el desarrollo de software que nos permite determinar la mutaci√≥n gen√©tica de los cripto gatitos reci√©n nacidos antes de que nazcan.  En otras palabras, este programa puede ayudarlo a verificar y determinar el momento apropiado para la fecundaci√≥n de la gata madre y, por lo tanto, obtener la m√°s interesante de las posibles mutaciones. <br><br>  Publicamos este material con la esperanza de que sirva a todos como un art√≠culo introductorio para familiarizarse con herramientas de desarrollo de Ethereum muy √∫tiles, al igual que los propios cripto gatitos permitieron que muchas personas no familiarizadas con blockchain se unan a las filas de los usuarios de criptomonedas. <a name="habracut"></a><br><br><h3>  Primera parte: la l√≥gica de alto nivel de generar gatitos </h3><br>  Para empezar, nos preguntamos: ¬øc√≥mo es el nacimiento de los cripto gatitos? <br><br>  Para responder a esto, utilizamos el excelente conductor de cadena de bloques Etherscan, que nos permite hacer mucho m√°s que simplemente "estudiar los par√°metros y el contenido de los bloques".  Entonces descubrimos el c√≥digo fuente del contrato CryptoKittiesCore: <br><br><img src="https://habrastorage.org/webt/co/od/v1/coodv1ao8ns32llhof2bhbpp3h8.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code</a> <br><br>  Tenga en cuenta que el contrato ampliado es en realidad un poco diferente del utilizado en el programa de recompensas.  Seg√∫n este c√≥digo, un gatito beb√© se forma en dos pasos: 1) la gata es fertilizada por la gata;  2) un poco m√°s tarde, cuando termina el per√≠odo de maduraci√≥n de la fruta, se llama a la funci√≥n giveBirth.  Por lo general, esta funci√≥n es invocada por cierto demonio de proceso, pero, como ver√° m√°s adelante, para obtener mutaciones interesantes, deber√° seleccionar correctamente el bloque en el que naci√≥ su gatito. <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">giveBirth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 _matronId)</span></span></span><span class="hljs-function"> external whenNotPaused </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256)</span></span></span><span class="hljs-function"> </span></span>{ Kitty storage matron = kitties[_matronId]; <span class="hljs-comment"><span class="hljs-comment">// ,  - . require(matron.birthTime != 0); // ,       ! require(_isReadyToGiveBirth(matron)); //      -. uint256 sireId = matron.siringWithId; Kitty storage sire = kitties[sireId]; // ,         uint16 parentGen = matron.generation; if (sire.generation &gt; matron.generation) { parentGen = sire.generation; } //     . uint256 childGenes = geneScience.mixGenes(matron.genes, sire.genes, matron.cooldownEndBlock - 1);</span></span></code> </pre> <br>  En el c√≥digo anterior, puede ver claramente que los genes de un gatito reci√©n nacido se determinan justo en el momento del nacimiento llamando a la funci√≥n mixGenes del contrato inteligente externo geneScience.  Esta funci√≥n toma tres par√°metros: el gen madre, el gen padre y el n√∫mero de bloque en el que el gato estar√° listo para dar a luz. <br><br>  Probablemente tendr√° una pregunta l√≥gica, ¬øpor qu√© los genes no est√°n determinados en el momento de la concepci√≥n, como es el caso en el mundo real?  Como ver√° en el curso de la narraci√≥n posterior, esto le permite defenderse con bastante elegancia de los intentos de predecir y descifrar genes.  Este enfoque elimina la posibilidad de una predicci√≥n 100% precisa de los genes del gatito antes de que se registre el hecho del embarazo gato-madre en la cadena de bloques.  E incluso si pudiera encontrar el c√≥digo exacto responsable de mezclar los genes, esto no le dar√≠a ninguna ventaja. <br><br>  Sea como fuere, al principio a√∫n no sab√≠amos esto, as√≠ que continuemos.  Ahora necesitamos averiguar la direcci√≥n del contrato de geneScience.  Para hacer esto, use MyEtherWallet: <br><br> <a href=""><img src="https://habrastorage.org/webt/nf/fa/yl/nffaylnytgmybdkavya0so0ugmi.png"></a> <br><br>  <i>Direcci√≥n del contrato de GeneScience</i> <br><br>  As√≠ es como se ve el c√≥digo de bytes del contrato: <br><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">0x60606040526004361061006c5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630d9f5aed81146100715780631597ee441461009f57806354c15b82146100ee57806361a769001461011557806377a74a201461017e575b600080fd5b341561007c57600080fd5b61008d6004356024356044356101cd565b604051908152602001604051809</span></span>........</code> </pre> <br>  Por su apariencia, no puede decir que, como resultado, algo tan lindo como un gatito aparece en todo, pero tenemos mucha suerte de que esta sea una direcci√≥n p√∫blica, y no necesitamos buscarla en el repositorio).  De hecho, creemos que no debe hacerse tan f√°cilmente accesible.  Si los desarrolladores realmente quer√≠an asegurarse de que la direcci√≥n del contrato fuera correcta, deber√≠an usar la funci√≥n checkScienceAddress, pero no nos molestar√°. <br><br><h3>  Segunda parte: el colapso de una hip√≥tesis simple </h3><br>  Entonces, ¬øqu√© queremos lograr al final?  Debe entenderse que no nos fijamos el objetivo de compilar completamente el c√≥digo de bytes, convirti√©ndolo en un c√≥digo de solidez legible por humanos.  Necesitamos un m√©todo barato (sin la necesidad de pagar las transacciones en el blockchain de combate) para determinar los genes del gatito, siempre que sepamos qui√©nes son sus padres.  Esto es lo que haremos. <br><br>  Para comenzar, usemos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramienta de c√≥digo de operaci√≥n</a> Etherscan para un an√°lisis r√°pido.  Se ve as√≠: <br><br> <a href=""><img src="https://habrastorage.org/webt/m6/nt/72/m6nt72740bwhn4qz6dlkz0pc6qi.png"></a> <br><br>  <i>Mucho m√°s claro</i> <br><br>  Seguimos la regla de oro de decodificar el c√≥digo del ensamblador: comenzamos con una hip√≥tesis simple y audaz sobre el comportamiento del programa y, en lugar de tratar de entender su trabajo en su conjunto, nos enfocamos en confirmar la suposici√≥n hecha.  Revisaremos el c√≥digo de bytes para responder algunas preguntas: <br><br><ol><li>  ¬øUtiliza marcas de tiempo?  No, porque falta el c√≥digo de operaci√≥n TIMESTAMP.  Si hay alg√∫n accidente simple en √©l, entonces su fuente es definitivamente otro c√≥digo de operaci√≥n. </li><li>  ¬øSe utiliza un hash de bloque?  S√≠, BLOCKHASH ocurre dos veces.  Por lo tanto, la aleatoriedad, si la hay, puede surgir de sus c√≥digos de operaci√≥n, pero a√∫n no estamos seguros de esto. </li><li>  ¬øSe utiliza alg√∫n hash?  S√≠, hay SHA3.  Sin embargo, no est√° claro qu√© est√° haciendo. </li><li>  ¬øSe utiliza msg.sender?  No, porque falta el c√≥digo de operaci√≥n CALLER.  Por lo tanto, no se aplica ning√∫n control de acceso al contrato. </li><li>  ¬øSe est√° utilizando alg√∫n contrato externo?  No, no hay c√≥digo de llamada CALL. </li><li>  ¬øSe utiliza COINBASE?  No, y por lo tanto excluimos otra posible fuente de aleatoriedad. </li></ol><br>  Despu√©s de recibir la respuesta a estas preguntas, presentamos y tenemos la intenci√≥n de probar una hip√≥tesis simple: el resultado de mixGene est√° determinado por tres y solo tres par√°metros de entrada de esta funci√≥n.  Si esto es as√≠, entonces podr√≠amos simplemente implementar este contrato localmente, continuar llamando a esta funci√≥n con los par√°metros que nos interesan, y luego, tal vez, podr√≠amos obtener un kit de genes de gatito incluso antes de la fertilizaci√≥n de la gata madre. <br><br>  Para verificar esta suposici√≥n, llamamos a la funci√≥n mixGene en la red principal con tres par√°metros aleatorios: 1111115, 80, 40 y obtenemos alg√∫n resultado X. Luego, implemente este bytecode usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">truffle y testrpc</a> .  Entonces, nuestra pereza condujo a una forma algo no est√°ndar de usar trufa. <br><br><pre> <code class="java hljs">contract GeneScienceSkeleton { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mixGenes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 genes1, uint256 genes2, uint256 targetBlock)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256)</span></span></span><span class="hljs-function"> </span></span>{} }</code> </pre> <br>  Comenzamos con el esqueleto del contrato, lo colocamos en la estructura de carpetas del marco de trufas y ejecutamos la compilaci√≥n de trufas.  Sin embargo, en lugar de migrar directamente este contrato vac√≠o a testrpc, reemplazamos el bytecode del contrato en la carpeta de compilaci√≥n con el bytecode real expandido y el bytecode del contrato geneScience.  Esta es una forma at√≠pica pero r√°pida si desea implementar un contrato con solo bytecode y alguna interfaz abierta limitada para pruebas locales.  Despu√©s de eso, llamamos directamente a Mixgenes con los par√°metros 1111115, 80, 40, y desafortunadamente obtenemos un error con la respuesta revertir en respuesta.  Ok, mira m√°s profundo.  Como sabemos, la firma de las funciones mixGene es 0x0d9f5aed, por lo que tomamos un bol√≠grafo y papel y rastreamos la ejecuci√≥n del c√≥digo de bytes, comenzando desde el punto de entrada de esta funci√≥n para dar cuenta de los cambios en la pila y el almacenamiento.  Despu√©s de algunos saltos, nos encontramos aqu√≠: <br><br><pre> <code class="java hljs">[<span class="hljs-number"><span class="hljs-number">497</span></span>] DUP1 [<span class="hljs-number"><span class="hljs-number">498</span></span>] NUMBER [<span class="hljs-number"><span class="hljs-number">499</span></span>] DUP14 [<span class="hljs-number"><span class="hljs-number">500</span></span>] SWAP1 [<span class="hljs-number"><span class="hljs-number">501</span></span>] GT [<span class="hljs-number"><span class="hljs-number">504</span></span>] PUSH2 <span class="hljs-number"><span class="hljs-number">0x01fe</span></span> [<span class="hljs-number"><span class="hljs-number">505</span></span>] JUMPI [<span class="hljs-number"><span class="hljs-number">507</span></span>] PUSH1 <span class="hljs-number"><span class="hljs-number">0x00</span></span> [<span class="hljs-number"><span class="hljs-number">508</span></span>] DUP1 [<span class="hljs-number"><span class="hljs-number">509</span></span>] <span class="hljs-string"><span class="hljs-string">'fd'</span></span>(Unknown Opcode)</code> </pre> <br>  A juzgar por el contenido de estas l√≠neas, si el n√∫mero del bloque actual es menor que el tercer par√°metro, se llama a revert ().  Bueno, este es un comportamiento bastante razonable: llamar a una funci√≥n real en un juego con un n√∫mero de bloque del futuro es imposible y esto es l√≥gico. <br><br>  Esta verificaci√≥n de entrada es f√°cil de eludir: solo extraemos algunos bloques en testrpc y llamamos a la funci√≥n nuevamente.  Esta vez, la funci√≥n devuelve con √©xito Y. <br><br>  Pero desafortunadamente X! = Y <br><br>  Que mal.  Esto significa que el resultado de la ejecuci√≥n de la funci√≥n depende no solo de los par√°metros de entrada, sino tambi√©n del estado de la cadena de bloques de la red principal, que, por supuesto, difiere del estado de la prueba falsa de blockchain. <br><br><h3>  Tercera parte: remangar nuestras mangas y excavar en la pila </h3><br>  Esta bien  As√≠ que es hora de arremangarse.  El papel ya no es adecuado para rastrear el estado de la pila.  Entonces, para un trabajo m√°s serio, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzaremos un</a> desensamblador EVM muy √∫til llamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">evmdis</a> . <br><br>  En comparaci√≥n con el papel y la pluma, este es un paso tangible hacia adelante.  Continuemos con lo que nos detuvimos en el √∫ltimo cap√≠tulo.  La siguiente es una conclusi√≥n alentadora con evmdis: <br><br><pre> <code class="java hljs">............. :label22 # Stack: [@<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1EB</span></span> PUSH(<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-number"><span class="hljs-number">0x1ED</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1EE</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1EF</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F0</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F1</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F3</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x1F9</span></span> JUMPI(:label23, NUMBER() &gt; POP()) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1FA</span></span> PUSH(<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-number"><span class="hljs-number">0x1FC</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1FD</span></span> REVERT() :label23 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1FF</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x200</span></span> PUSH(BLOCKHASH(POP())) <span class="hljs-number"><span class="hljs-number">0x201</span></span> SWAP11 <span class="hljs-number"><span class="hljs-number">0x202</span></span> POP() <span class="hljs-number"><span class="hljs-number">0x203</span></span> DUP11 <span class="hljs-number"><span class="hljs-number">0x209</span></span> JUMPI(:label25, !!POP()) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x20C</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x213</span></span> PUSH((NUMBER() &amp; ~<span class="hljs-number"><span class="hljs-number">0xFF</span></span>) + (POP() &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span>)) <span class="hljs-number"><span class="hljs-number">0x214</span></span> SWAP13 <span class="hljs-number"><span class="hljs-number">0x215</span></span> POP() <span class="hljs-number"><span class="hljs-number">0x217</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x21E</span></span> JUMPI(:label24, !!(POP() &lt; NUMBER())) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x213</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x222</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x223</span></span> PUSH(POP() - <span class="hljs-number"><span class="hljs-number">0x100</span></span>) <span class="hljs-number"><span class="hljs-number">0x224</span></span> SWAP13 <span class="hljs-number"><span class="hljs-number">0x225</span></span> POP() :label24 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x223</span></span> | @<span class="hljs-number"><span class="hljs-number">0x213</span></span>] @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x227</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x228</span></span> PUSH(BLOCKHASH(POP())) <span class="hljs-number"><span class="hljs-number">0x229</span></span> SWAP11 <span class="hljs-number"><span class="hljs-number">0x22A</span></span> POP() :label25 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x200</span></span> | @<span class="hljs-number"><span class="hljs-number">0x228</span></span>] <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x88</span></span> | @<span class="hljs-number"><span class="hljs-number">0x223</span></span> | @<span class="hljs-number"><span class="hljs-number">0x213</span></span>] @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x22C</span></span> DUP11 <span class="hljs-number"><span class="hljs-number">0x22D</span></span> DUP16 <span class="hljs-number"><span class="hljs-number">0x22E</span></span> DUP16 ...........</code> </pre> <br>  Para lo que evmdis es realmente bueno es su utilidad para analizar JUMPDEST en las etiquetas correctas, que no se pueden sobreestimar. <br><br>  Entonces, despu√©s de pasar el requisito inicial, nos encontramos en la etiqueta 23. Vemos DUP13 y recordamos del cap√≠tulo anterior que el n√∫mero 13 en la pila es nuestro tercer par√°metro.  As√≠ que estamos tratando de obtener el BLOCKHASH de nuestro tercer par√°metro.  Sin embargo, la acci√≥n de BLOCKHASH est√° limitada a 256 bloques.  Es por eso que es seguido por JUMPI (esta es una construcci√≥n if).  Si traducimos la l√≥gica de los c√≥digos de operaci√≥n al lenguaje del pseudoc√≥digo, obtenemos algo como esto: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blockhash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentBlockNumber - p &lt; <span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash(p); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bhash = blockhash(thrid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bhash == <span class="hljs-number"><span class="hljs-number">0</span></span>) { thirdProjection = (currentBlockNumber &amp; ~<span class="hljs-number"><span class="hljs-number">0xff</span></span>) + (thridParam &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (thirdProjection &gt; currentBlockNumber) { thirdProjection -= <span class="hljs-number"><span class="hljs-number">256</span></span>; } thirdParam = thirdProjection; bhash = blockhash(thirdProjection); } label <span class="hljs-number"><span class="hljs-number">25</span></span> and beyond ..... some more stuff related to thirdParam and bhash</code> </pre> <br>  algunas cosas m√°s relacionadas con thirdParam y bhash - otro c√≥digo relacionado con thirdParam y bloque hash <br><br>  Ahora creemos que hemos encontrado una raz√≥n por la cual nuestros resultados difieren de los que observamos en la red principal.  M√°s importante a√∫n, aparentemente logramos descubrir la fuente del azar.  A saber: el hash de bloque se calcula en funci√≥n del tercer par√°metro, o el <i>pron√≥stico del</i> tercer par√°metro.  Es importante tener en cuenta que en la pila el tercer par√°metro tambi√©n se reemplaza con este n√∫mero de bloque predicho. <br><br>  Obviamente, durante la ejecuci√≥n local fuera de la red principal, no tenemos una opci√≥n simple para imponer un retorno BLOCKHASH que coincida con los valores de la red principal.  Sea como fuere, dado que conocemos los tres par√°metros, podemos monitorear f√°cilmente la red principal y obtener el hash del bloque H para el tercer par√°metro, as√≠ como el hash del bloque predicho. <br><br>  A continuaci√≥n, podemos insertar este hash directamente en el c√≥digo de byte en nuestro entorno de prueba local, y si todo va de acuerdo con el plan, finalmente obtendremos el conjunto correcto de genes. <br><br>  Pero hay un inconveniente: DUP13 y BLOCKHASH son solo 2 bytes en el c√≥digo, y si solo los reemplazamos con 33 bytes PUSH32 0x * hash *, el contador del programa cambiar√° completamente y tendremos que arreglar cada JUMP y JUMPI.  O tendremos que hacer JUMP al final del c√≥digo y reemplazar las instrucciones del c√≥digo implementado, etc. <br><br>  Bueno, como hemos llegado hasta aqu√≠, olfatearemos un poco m√°s.  Dado que empujamos el hash de 32 bytes que no es cero en la rama if, la condici√≥n siempre ser√° verdadera y, por lo tanto, todo lo escrito en la parte else puede simplemente descartarse para dejar espacio para nuestro hash de 32 bytes.  Bueno, en general, esto es lo que hicimos: <br><br> <a href=""><img src="https://habrastorage.org/webt/n1/xx/-x/n1xx-xl6ew1nlx-xjwzkgtk90cs.png"></a> <br><br>  El punto clave es que, dado que abandonamos la otra parte de la condici√≥n, debemos reemplazar el tercer par√°metro de entrada de la funci√≥n mixGene con el pron√≥stico del tercer par√°metro antes de llamarlo. <br><br>  Esto es hasta el punto de que si est√° tratando de obtener el resultado de una operaci√≥n <br>  mixGene (X, Y, Z), donde currentBlockNumber es Z &lt;256, solo necesita reemplazar el hash PUSH32 con el hash del bloque Z. <br>  Sin embargo, si tiene la intenci√≥n de hacer lo siguiente <br>  mixGene (X, Y, Z), donde currentBlockNumber es Z ‚â• 256, deber√° reemplazar el hash PUSH32 con el hash del bloque proj_Z, donde proj_Z se define de la siguiente manera: <br><br><pre> <code class="java hljs">proj_Z = (currentBlockNumber &amp; ~<span class="hljs-number"><span class="hljs-number">0xff</span></span>) + (Z &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (proj_Z &gt; currentBlockNumber) { proj_Z -= <span class="hljs-number"><span class="hljs-number">256</span></span>; } &lt;b&gt;    Z  proj_Z   ,   mixGene(X, Y, proj_Z).&lt;/b&gt;</code> </pre> <br>  Tenga en cuenta que proj_Z permanecer√° sin cambios en un cierto rango de bloques.  Por ejemplo, si Z &amp; 0xff = 128, entonces proj_Z cambia solo en cada bloque cero y 128o. <br><br>  Para confirmar esta hip√≥tesis y verificar si hay alg√∫n inconveniente por delante, cambiamos el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digo de bytes</a> y usamos otra utilidad genial llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hevm</a> . <br><br> <a href=""><img src="https://habrastorage.org/webt/ey/d5/cx/eyd5cxlyauklees28j70widdisg.png"></a> <br><br>  Si nunca ha usado hevm, le recomiendo que lo pruebe.  La herramienta est√° disponible junto con su propio marco, pero sobre todo en su conjunto, debe tenerse en cuenta algo tan indispensable como un depurador de pila interactivo. <br><br><pre> <code class="java hljs">Usage: hevm exec --code TEXT [--calldata TEXT] [--address ADDR] [--caller ADDR] [--origin ADDR] [--coinbase ADDR] [--value W256] [--gas W256] [--number W256] [--timestamp W256] [--gaslimit W256] [--gasprice W256] [--difficulty W256] [--debug] [--state STRING] Available options: -h,--help</code> </pre> <br>  Arriba est√°n las opciones de lanzamiento.  La utilidad le permite especificar una variedad de par√°metros.  Entre ellos se encuentra --debug, que le brinda la capacidad de depurar de manera interactiva. <br><br>  Entonces, aqu√≠ hemos realizado varias llamadas al contrato geneScience implementado en la cadena de bloques de la red principal y registrado los resultados.  Luego usamos hevm para ejecutar nuestro bytecode roto con datos preparados teniendo en cuenta las reglas descritas anteriormente y ... <br><br>  ¬°Los resultados son los mismos! <br><br><h3>  El √∫ltimo cap√≠tulo: conclusi√≥n y continuaci√≥n del trabajo (?) </h3><br>  Entonces, ¬øqu√© hemos podido lograr? <br><br>  Usando nuestro software de pirateo, puede 100% de posibilidades de predecir un gen de 256 bits para un gatito reci√©n nacido si nace en el rango de bloques [coolDownEndBlock (cuando el beb√© est√° listo para aparecer), el bloque actual es + 256 (aproximadamente)].  Puede razonar sobre esto de esta manera: cuando el beb√© est√° en el √∫tero de la gata, sus genes mutan con el tiempo, debido a la fuente de entrop√≠a en forma de un hash del bloque coolDownEndBlock predicho, que tambi√©n cambia con el tiempo.  Por lo tanto, puede usar este programa para verificar c√≥mo se ver√° el gen del beb√© si naci√≥ en este momento.  Y si no le gusta este gen, puede esperar unos 256 bloques m√°s (en promedio) y verificar el nuevo gen. <br><br>  Alguien puede decir que esto no es suficiente, ya que solo el 100% de precisi√≥n de la predicci√≥n puede considerarse un pirateo ideal incluso antes del embarazo de una madre gata.  Sin embargo, esto no es posible, ya que el gen del gatito est√° determinado no solo por los genes de sus padres, sino tambi√©n por el hash predicho del bloqueo como factor de mutaci√≥n, que simplemente no se puede conocer antes de la fertilizaci√≥n. <br><br>  ¬øQu√© se puede mejorar y cu√°les son los matices aqu√≠? <br><br>  Revisamos r√°pidamente los cambios que ocurren en la pila en la parte l√≥gica real del contrato inteligente (etiqueta 25 y todo lo que sigue) y creemos que esta parte predecible del c√≥digo mixGene est√° bastante sujeta a an√°lisis y estudio.  Esperamos que el hash de bloque como factor de mutaci√≥n tambi√©n tenga cierta importancia f√≠sica, ayudando, por ejemplo, a determinar qu√© gen debe mutar.  Si logramos resolver esto, obtendremos el gen original, sin mutaciones.  Esto es √∫til porque si no tiene un buen gen fuente, incluso la mejor mutaci√≥n puede no ser suficiente. <br><br>  Tampoco medimos la correlaci√≥n entre el gen de 256 bits y los rasgos del gatito (color de ojos, tipo de cola, etc.), pero creemos que esto es bastante posible con la ayuda de un bot de alto rendimiento y un clasificador simple. <br><br>  Y, en general, comprendemos completamente la intenci√≥n del equipo de desarrollo de CryptoKitties de estabilizar la mutaci√≥n en un corto per√≠odo de tiempo.  Pero la otra cara de este enfoque es la capacidad de realizar un an√°lisis como lo hicimos nosotros. <br><br>  Tambi√©n nos gustar√≠a agradecer a la maravillosa comunidad ethereum por desarrollar herramientas como Etherscan, hevm, evmdis, truffle, testrpc, myetherwallet y Solidity.  Esta es una comunidad genial y estamos felices de ser parte de ella. <br><br>  Y finalmente, el c√≥digo modificado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/modong/GeneScienceCracked/</a> <br><br>  Recuerde cambiar $ CONSTBLOCKHASH $ al hash del bloque predicho. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/4bd/bf6/597/4bdbf659775744b1bdbb4d8a00a0a980.png" alt="imagen"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es409345/">https://habr.com/ru/post/es409345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es409335/index.html">Cient√≠ficos de Cambridge crearon un mod para Civilization V con la implementaci√≥n del escenario para el desarrollo de una IA fuerte</a></li>
<li><a href="../es409337/index.html">Usando VR, AR y MR en simulaciones y entrenamiento</a></li>
<li><a href="../es409339/index.html">Descripci√≥n general del DVR con informador GPS AdvoCam-FD Black-II GPS + GLONASS</a></li>
<li><a href="../es409341/index.html">Desarrollo de una unidad de control electr√≥nico para la lavadora Oriole.</a></li>
<li><a href="../es409343/index.html">Regalos de a√±o nuevo, tercera parte: si nos portamos bien</a></li>
<li><a href="../es409347/index.html">La aplicaci√≥n de Android Edward Snowden's Haven protege objetos f√≠sicos</a></li>
<li><a href="../es409349/index.html">¬øNecesita una taza "inteligente" o bastante com√∫n, o qu√© tan r√°pido se enfr√≠a el caf√©?</a></li>
<li><a href="../es409351/index.html">¬øExplotar√° el espacio ruso en 2018?</a></li>
<li><a href="../es409355/index.html">¬øCu√°nto deber√≠a costar Bitcoin?</a></li>
<li><a href="../es409357/index.html">Estaciones de trabajo Dell: para tareas creativas y productividad extrema</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>