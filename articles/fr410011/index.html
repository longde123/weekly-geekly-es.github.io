<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåüèΩ üë∏üèª üçö L'histoire de la cr√©ation d'un cloud domestique. Partie 3. Cr√©ation d'un cloud personnel - installation et configuration de Nextcloud ‚¨ÜÔ∏è ü¶Ö üìÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En route vers la cr√©ation de notre propre service cloud, alors que nous nous sommes habitu√©s au syst√®me Debian et avons cr√©√© un serveur web . Il est m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'histoire de la cr√©ation d'un cloud domestique. Partie 3. Cr√©ation d'un cloud personnel - installation et configuration de Nextcloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/410011/">  En route vers la cr√©ation de notre propre service cloud, alors que nous nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">sommes habitu√©s au syst√®me Debian</a> et avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">cr√©√© un serveur web</a> .  Il est maintenant temps pour la derni√®re √©tape - cr√©er et configurer un cloud personnel bas√© sur le serveur Nextcloud. <br><br><img src="https://habrastorage.org/webt/hd/zf/np/hdzfnpy3coj3pu5hr6xs8ssjop8.jpeg"><br><a name="habracut"></a><br><hr><a name="chap0"></a><br><h3>  Table des mati√®res </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 1. Configurer votre environnement Debian pour un usage quotidien</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 2. Cr√©er un serveur - configurer LAMP dans Debian</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 3. Cr√©ation d'un cloud personnel - installation et configuration de Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 4. Mise √† jour 2018 - Debian 9 et Nextcloud 13</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 5. Mise √† jour 2019 - PHP 7.2, MariaDB 10.4 et Nextcloud 17</a> <br><br><hr><br><h3>  Navigation rapide dans les chapitres </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©face</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©paration d'un serveur pour installer Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installer Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Organisation du stockage Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configurer l'acc√®s √† la machine virtuelle Nextcloud √† partir du r√©seau local</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration de Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©glage avanc√© Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Protection pour Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Smartphone Cloud Sync</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Synchronisation avec le cloud de l'ordinateur personnel</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postface</a> <br><br><hr><a name="chap1"></a><br><h3>  Pr√©face </h3><br>  Nous sommes donc arriv√©s √† la chose m√™me pour laquelle tout a commenc√© et √† laquelle nous n'avons pas avanc√© rapidement.  Cette partie d√©crira l'installation et certains points de la configuration du serveur Nextcloud dans la machine virtuelle VMWare, ainsi qu'une petite exp√©rience de travail sous la forme de la synchronisation du contenu d'une paire de smartphones et de dossiers Windows sur un ordinateur de bureau.  Les instructions d'installation suivantes pour Nextcloud impliquent que le service est d√©ploy√© sur un serveur qui a √©t√© cr√©√© selon les instructions de la partie pr√©c√©dente de mon histoire. <br><br>  Initialement, ce chapitre √©tait pr√©vu pour √™tre petit, car je voulais me limiter √† d√©crire simplement l'installation et la configuration de Nextcloud, mettant fin essentiellement √† cette histoire de ¬´juste entrer dans Linux pour une t√¢che sp√©cifique¬ª.  Mais, pensant que cela pouvait sembler int√©ressant pour quelqu'un, il a d√©cid√© de montrer comment j'avais r√©solu le probl√®me de la synchronisation des dossiers de mon ordinateur personnel, donc ce dernier chapitre d√©coulait en douceur d'instructions claires sur quoi et comment faire en programmation.  Cela explique une certaine ¬´vinaigrette¬ª dans cette partie - elle commence par le travail et les param√®tres sous Linux, coule au niveau des param√®tres du r√©seau et des logiciels virtuels, et se termine avec des b√©quilles de rabotage sous Windows.  Par contre, cette s√©rie d'articles a pour titre ¬´Histoire de la cr√©ation ...¬ª et j'ai d√©cid√© de la raconter jusqu'au bout. <br><br>  <b>Remarque</b> <br>  Suite √† la lecture des constructions du formulaire http: // 127.0.0.1 (https: // 127.0.0.1), l'espace apr√®s http: // (https: //) doit √™tre supprim√© lors de la saisie de la barre d'adresse du navigateur.  Un espace a √©t√© ins√©r√© lors de la publication de cet article afin d'emp√™cher le moteur de convertir automatiquement le texte en liens. <br><br><hr><a name="chap2"></a><br><h3>  Pr√©paration d'un serveur pour installer Nextcloud </h3><br>  Nextcloud est une application Web qui poss√®de un ensemble de fichiers et fonctionne avec une base de donn√©es MySQL donn√©e.  L'application Web est install√©e en tant que site standard, pour l'installation dont vous avez besoin de t√©l√©charger les fichiers ¬´moteur¬ª sur le serveur, ex√©cutez le fichier d'installation et sp√©cifiez les d√©tails d'acc√®s √† la base de donn√©es pr√©c√©demment cr√©√©e pour ce site lors de l'installation. <br><br>  Cr√©ez un r√©pertoire dans lequel les fichiers Nextcloud seront plac√©s: <br>  <b># mkdir / var / www / nextcloud</b> <br><br>  J'ai d√©cid√© de refuser HTTP, ne laissant l'acc√®s que via HTTPS.  Pour ce faire, vous devez configurer apache. <br><br>  Ouvrez le fichier: <br>  <b># nano /etc/apache2/sites-available/default-ssl.conf</b> <br>  Et avant la balise, ajoutez le contenu suivant: <br><br><pre><code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;Directory /var/www/nextcloud&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span></span></span> FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt;</code> </pre> <br><br>  D√©sactivez la configuration HTTP: <br>  <b># a2dissite 000-default.conf</b> <br><br>  Fermez le port 80: <br>  <b># ufw delete allow 80</b> <br><br>  Et red√©marrez le serveur Web: <br>  <b># service apache2 restart</b> <br><br>  Vous devez maintenant cr√©er une base de donn√©es pour nextcloud.  Nous entrons dans mysql en entrant le mot de passe du superutilisateur mysql: <br>  <b># mysql -u root -p</b> <br><br>  Cr√©ez une base de donn√©es appel√©e nextcloud: <br>  <b>mysql&gt; CREATE DATABASE `nextcloud`;</b> <br><br>  Cr√©ez un utilisateur avec le nom nextcloud et le mot de passe trivial nc123: <br>  <b>mysql&gt; CREATE USER 'nextcloud' @ 'localhost' IDENTIFIED BY 'nc123';</b> <br><br>  Nous donnons un acc√®s complet √† l'utilisateur nextcloud √† la base de donn√©es nextcloud: <br>  <b>mysql&gt; ACCORDER TOUS LES PRIVIL√àGES SUR `nextcloud`. * TO 'nextcloud' @ 'localhost';</b> <br><br>  Mettre √† jour la table des privil√®ges: <br>  <b>mysql&gt; FLUSH PRIVILEGES;</b> <br><br>  Quittez mysql: <br>  <b>mysql: mysql&gt; exit</b> <br><br>  De plus, vous devez installer des modules suppl√©mentaires pour PHP: <br>  <b># apt-get install curl libcurl3 libcurl3-dev php5-curl</b> <b><br></b>  <b># a2enmod r√©√©criture</b> <br><br>  Dans la premi√®re partie de cette histoire, nous avons ouvert des ports pour l'interaction r√©seau et courrier, mais pour notre cible, ils ne sont pas requis et il est pr√©f√©rable de les fermer.  Supprimez les r√®gles: <br>  <b># ufw delete allow 138 / udp</b> <b><br></b>  <b># ufw delete allow 139 / udp</b> <b><br></b>  <b># ufw delete allow 139 / tcp</b> <b><br></b>  <b># ufw delete allow 445 / tcp</b> <b><br></b>  <b># ufw delete allow 25</b> <b><br></b>  <b># ufw delete allow 465</b> <b><br></b>  <b># ufw delete allow 110</b> <b><br></b>  <b># ufw delete allow 143</b> <b><br></b>  <b># ufw delete allow 993</b> <br><br><hr><a name="chap3"></a><br><h3>  Installer Nextcloud </h3><br>  T√©l√©chargez les fichiers et d√©compressez-les dans le r√©pertoire pr√©vu: <br>  <b># wget <a href="" rel="nofollow">download.nextcloud.com/server/releases/nextcloud-11.0.2.tar.bz2</a></b> <b><br></b>  <b># tar xjf nextcloud-11.0.2.tar.bz2 -C / var / www</b> <br><br>  Modifier les autorisations de dossier: <br>  <b># chmod 755 / var / www / nextcloud</b> <br><br>  Et nous attribuons au propri√©taire de ce dossier un serveur Web afin qu'il n'y ait aucun probl√®me √† y √©crire: <br>  <b># chown -R www-data: www-data / var / www / nextcloud</b> <br><br>  C‚Äôest tout!  Le service est install√©, si vous tapez dans le navigateur https: // 127.0.0.1/nextcloud, l'assistant d'installation s'ouvre.  Mais attendons avec cela, ayant d√©j√† pr√©par√© un endroit pour stocker les donn√©es utilisateur. <br><br>  Il convient de mentionner que la version 11.0.2 de Nextcloud est actuellement assez obsol√®te et contient des vuln√©rabilit√©s qui ne sont pas pr√©sentes dans les versions plus r√©centes et plus r√©centes, donc si vous installez la branche 11.x, il est pr√©f√©rable d'installer une version plus r√©cente (au d√©but de 2018 - ce version 11.0.7). <br><br><hr><a name="chap4"></a><br><h3>  Organisation du stockage Nextcloud </h3><br>  Cette partie est facultative et peut √™tre ignor√©e sans probl√®me - tout fonctionnera sans elle.  Cependant, si vous allez cr√©er un r√©pertoire de donn√©es en dehors de la machine virtuelle, je vous recommande de vous familiariser avec celui-ci. <br><br>  Par d√©faut, le contenu synchronis√© sera stock√© dans le r√©pertoire / var / www / nextcloud / nxcdata.  Cette option ne me convenait pas tout de suite pour plusieurs raisons.  D'une part, je ne voudrais pas augmenter constamment la taille de fichier d'un disque virtuel.  D'un autre c√¥t√©, j'aimerais avoir une solution de stockage des donn√©es de machine virtuelle distincte et ind√©pendante.  La chose la plus simple qui me vient imm√©diatement √† l'esprit est l'utilisation d'une cl√© USB.  S'il n'y a pas assez d'espace, le lecteur peut simplement √™tre remplac√©.  Si n√©cessaire, il peut √™tre connect√© √† un autre ordinateur et t√©l√©charger les fichiers n√©cessaires.  Mobile et pratique.  Cependant, je ne voulais pas utiliser l'USB 2.0 en raison de la bande passante relativement petite par rapport aux normes modernes, et je n'ai pas r√©ussi avec l'USB 3.0 - les logiciels de virtualisation (WMVare et VirtualBox) ne voulaient pas transmettre normalement les appareils connect√©s via un contr√¥leur USB 3.0. <br><br>  Mes app√©tits dans le processus de cr√©ation du cloud ont augment√© et je n'avais pas moins d'un t√©raoctet, donc j'ai finalement d√©cid√© de connecter un disque dur ordinaire de deux t√©raoctets √† la machine virtuelle, qui √©tait d√©j√† situ√©e et connect√©e √† l'int√©rieur de l'ordinateur.  Si n√©cessaire, il peut √™tre retir√© sans probl√®me et connect√© via l'adaptateur SATA &lt;-&gt; USB 3.0 existant. <br><br>  Ainsi, l'id√©e principale est d'organiser un point permanent pour connecter un r√©pertoire avec un contenu utilisateur en dehors du r√©pertoire / var / www / nextcloud, dans lequel un lien symbolique appel√© nxcdata est cr√©√© qui fait r√©f√©rence au r√©pertoire de donn√©es r√©elles, qui peut √™tre connect√© de diff√©rentes mani√®res sur diff√©rents supports. <br><br>  Cr√©ez un r√©pertoire: <br>  <b># mkdir / mnt / nxcdata</b> <br><br>  Nous changeons les droits: <br>  <b># chmod 770 / mnt / nxcdata</b> <br><br>  Nous faisons le propri√©taire du serveur web: <br>  <b># chown www-data: www-data / mnt / nxcdata</b> <br><br>  Je peux placer les donn√©es n'importe o√π et n'importe o√π, l'essentiel est de placer un lien symbolique vers ce r√©pertoire dans le r√©pertoire / mnt / nxcdata et de le nommer nxcdata, c'est-√†-dire  le chemin complet ressemblera √† / mnt / nxcdata / nxcdata. <br><br>  J'ai d'abord test√© la solution du dossier local que j'ai cr√©√© dans le r√©pertoire personnel. <br><br>  Cr√©√© un dossier au bon endroit: <br>  <b>$ mkdir / home / user / nxcdata</b> <br><br>  Chang√© les droits: <br>  <b># chmod 755 / home / user / nxcdata</b> <br><br>  Propri√©taire du serveur Web: <br>  <b># chown -R www-data: www-data / home / user / nxcdata</b> <br><br>  Cr√©ation d'un lien symbolique: <br>  <b># ln -s / home / user / nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  Cette solution √©tait r√©alisable, vous pouvez donc continuer.  Le r√©pertoire de donn√©es externe peut √™tre connect√© de deux mani√®res - via le service partag√© VMWare ou directement en tant que disque physique ou partition.  Il faut comprendre que la premi√®re solution n'est possible que si les outils vmware sont install√©s, qui sont install√©s sans probl√®me uniquement s'il existe une interface graphique du syst√®me d'exploitation (sinon, vous devrez √©diter les scripts d'installation des outils vmware).  Si nous abandonnons l'interface graphique, il ne reste alors que la possibilit√© de connecter le lecteur directement √† la machine virtuelle, mais avec cette solution j'ai d√ª beaucoup souffrir.  Apr√®s un certain temps, j'ai toujours trouv√© une version de travail stable, en tenant compte du fait qu'un script universel a √©t√© invent√©, qui incorporait les deux options de connexion. <br><br>  Pour un dossier connect√© via VMWare Shared Folders dans la section Dossiers partag√©s des param√®tres de la machine virtuelle, vous devez connecter le dossier n√©cessaire √† partir du syst√®me h√¥te et lui donner le nom vmw-nxcdata.  Ce dossier peut faire r√©f√©rence √† un r√©pertoire du disque dur ou directement au r√©pertoire racine d'un disque du syst√®me h√¥te. <br><br>  Le dossier mont√© appara√Ætra automatiquement dans le syst√®me virtuel le long du chemin / mnt / hgfs / vmw-nxcdata.  Cependant, le probl√®me est que le serveur Web ne disposera pas de droits suffisants pour √©crire des fichiers sur ce chemin et que les moyens standard du syst√®me ne peuvent pas r√©affecter les droits √† ce r√©pertoire.  Par cons√©quent, j'ai d√ª trouver comment monter manuellement de telles ressources. <br><br>  Cr√©ez un dossier: <br>  <b># mkdir / mnt / vmw-nxcdata</b> <br><br>  Nous montons en utilisant le module vmhgfs, qui a √©t√© install√© avec vmware-tools: <br>  <b># mount -t vmhgfs -o uid = www-data, gid = www-data, fmask = 007, dmask = 007 .host: / vmw-nxcdata / mnt / vmw-nxcdata</b> <br><br>  Le montage doit √™tre effectu√© avec exactement ces param√®tres pour un fonctionnement sans probl√®me du serveur Web √† l'avenir.  Au d√©part, je montais sans sp√©cifier uid / gid et masques, mais ensuite cela ne conduisait √† rien de bon, car il n'√©tait plus possible de changer les droits apr√®s le montage.  Une fois le montage termin√©, il peut s'afficher: ¬´Impossible d'ajouter une entr√©e √† mtab, en continuant¬ª, mais il se montera et fonctionnera. <br><br>  Super, nous avons mont√© le r√©pertoire.  Vous pouvez maintenant placer un lien symbolique vers ce r√©pertoire dans / mnt / nxcdata.  Mais je ne voudrais pas le faire manuellement chaque fois que je d√©marre ou red√©marre le serveur.  La mani√®re la plus simple consiste √† entrer la commande ci-dessus dans le fichier /etc/rc.local pour la monter sur la ligne ¬´exit 0¬ª.  Cependant, je voulais que le d√©montage automatique ait lieu lorsque la machine virtuelle √©tait √©teinte pour une s√©curit√© des donn√©es fiable.  Et j'ai d√©cid√© de tout faire au niveau du service et de m'occuper un peu des m√©canismes init / update-rc, d'autant plus j'√©tais curieux et √ßa s'est av√©r√© assez int√©ressant. <br><br>  La signification des actions suivantes est de cr√©er un service syst√®me qui serait appel√© et ex√©cuter des commandes pr√©d√©finies lorsque le syst√®me est allum√© ou √©teint.  Le service est d√©crit par un script compil√© selon certaines r√®gles et se trouve dans /etc/init.d.  Le bloc INIT INFO est situ√© au tout d√©but du script et contient des informations auxiliaires dans lesquelles je voudrais mentionner les directives Default-Start et Default-Stop - elles sp√©cifient les niveaux d'ex√©cution auxquels le script doit √™tre d√©marr√© ou arr√™t√© par d√©faut. <br><br>  Niveaux d'ex√©cution: <br><br>  0 - ex√©cution de script lorsque le syst√®me est √©teint <br>  1 - ex√©cution de script au d√©marrage du syst√®me en mode mono-utilisateur <br>  2 - ex√©cution de script au d√©marrage du syst√®me en mode multi-utilisateur <br>  3 - 5 - r√©serv√© <br>  6 - ex√©cution de script au red√©marrage du syst√®me <br><br>  Apr√®s avoir √©crit le script, il est activ√© √† l'aide du m√©canisme update-rc, qui, en fait, cr√©e des liens vers le script dans les r√©pertoires n√©cessaires /etc/rc0.d - /etc/rc6.d, dont le contenu correspond aux t√¢ches effectu√©es par les niveaux d'ex√©cution.  Les liens peuvent √™tre cr√©√©s ind√©pendamment, mais, contrairement √† l'activation ou la d√©sactivation des configurations de serveur Web Apache, vous devez prendre en compte de nombreuses nuances ici, vous devez donc activer ou d√©sactiver le service via update-rc. <br><br>  Alors, cr√©ez un fichier: <br>  <b># nano /etc/init.d/nxcdata_automount.sh</b> <br><br>  Et √©crivez-y le contenu suivant: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # nxcdata_automount.sh 1.0 ### BEGIN INIT INFO # Provides: myscript # Required-Start: # Required-Stop: # Default-Start: 1 2 3 4 5 # Default-Stop: 0 6 # Short-Description: nxcdata_automount.sh 1.0 # Description: nxcdata_automount.sh 1.0 ### END INIT INFO . /lib/lsb/init-functions # Start actions perform_start() { log_daemon_msg ¬´Start nxcdata_automount¬ª sleep 30 mount -t vmhgfs -o uid=www-data,gid=www-data,fmask=007,dmask=007 .host:/vmw-nxcdata /mnt/vmw-nxcdata #mount -t ntfs-3g -o uid=www-data,gid=www-data,fmask=007,dmask=007 /dev/sdb1 /mnt/sdb1 #mount -t ext4 /dev/sdb1 /mnt/sdb1 sleep 5 service fail2ban restart log_end_msg 0 return 0 } # Stop actions perform_stop() { log_daemon_msg ¬´Stop nxcdata_automount¬ª umount /mnt/nxcdata log_end_msg 0 return 0 } case $1 in start) perform_start ;; stop) perform_stop ;; *) echo ‚ÄúUsage: /etc/init.d/myscript {start|stop}‚Äù exit 3 ;; esac</span></span></code> </pre><br><br>  Faites attention √† quelques √©quipes comment√©es dans la section perform_start - c'est notre travail de base pour l'avenir.  De plus, apr√®s le montage, le service fail2ban est red√©marr√©. <br><br>  Le paradoxe est qu'apr√®s un an, je ne me souviens plus pourquoi j'ai fait √ßa, mais je doute beaucoup que cela se soit fait comme √ßa.  De toute √©vidence, apr√®s le montage du service, pour une raison quelconque, le service s'est √©cras√© ou n'a pas pu d√©marrer initialement et a d√ª √™tre red√©marr√© manuellement. <br><br>  Apr√®s une telle distraction, nous continuons de configurer davantage.  Cr√©ez un lien symbolique: <br>  <b># ln -s / mnt / vmw-nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  Nous rendons notre script ex√©cutable: <br>  <b># chmod + x /etc/init.d/nxcdata_automount.sh</b> <br><br>  Ajoutez le script au d√©marrage: <br>  <b># update-rc.d nxcdata_automount.sh par d√©faut</b> <br><br>  Nous red√©marrons le syst√®me et nous assurons que le montage automatique a r√©ussi et que tout est accessible de la bonne mani√®re. <br><br>  Pour supprimer le script, vous devrez ex√©cuter quelques commandes: <br>  <b># update-rc.d -f nxcdata_automount.sh supprimer</b> <b><br></b>  <b># rm -f /etc/init.d/nxcdata_automount.sh</b> <br><br>  Dans le cas du montage d'un lecteur non via des dossiers partag√©s VMWare, vous devez suivre directement les m√™mes √©tapes que lors du montage via des dossiers partag√©s VMWare, mais en tenant compte du fait qu'un deuxi√®me lecteur complet appara√Æt dans le syst√®me.  Comment trouver la lettre de lecteur? <br><br>  La plupart des p√©riph√©riques de blocs Linux sont connect√©s via l'interface SCSI, donc dans la plupart des cas, les disques commencent par les lettres sd.  La troisi√®me lettre du nom du disque signifie son num√©ro de s√©rie dans le syst√®me et est indiqu√©e par ordre alphab√©tique: sda - le premier disque, sdb - le deuxi√®me disque, sdc - le troisi√®me et ainsi de suite.  Vient ensuite le num√©ro qui d√©finit le num√©ro de partition sur le disque: sda1, sda2 et ainsi de suite.  La fa√ßon la plus simple de voir tous les lecteurs mapp√©s est de regarder le contenu du r√©pertoire / dev / et de filtrer les p√©riph√©riques sd: <br><br>  <b>$ ls -l / dev / |</b>  <b>grep sd</b> <br><br>  Par exemple, nous devons connecter un lecteur sdb1 avec un syst√®me de fichiers NTFS. <br><br>  Cr√©ez un r√©pertoire et montez le disque dedans: <br>  <b># mkdir / mnt / sdb1</b> <b><br></b>  <b># mount -t ext4 / dev / sdb1 / mnt / sdb1</b> <br><br>  Cr√©ez un r√©pertoire pour les donn√©es, d√©finissez les droits et l'utilisateur correspondant: <br>  <b># mkdir / mnt / sdb1 / nxcdata &amp; chmod 770 / mnt / sdb1 / nxcdata &amp; chown -R www-data: www-data / mnt / sdb1 / nxcdata</b> <br><br>  Ensuite, vous devez √©galement cr√©er un script pour le montage automatique et ajuster la commande de montage dans le script (des exemples de connexion d'un lecteur avec NTFS et EXT4 sont d√©j√† dans le script et comment√©s) et ajoutez le script au chargement automatique. <br><br>  B cr√©er un lien symbolique vers le r√©pertoire de donn√©es: <br>  <b># ln -s / mnt / sdb1 / nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  En fait, tous ces probl√®mes avec un tas de r√©pertoires nxcdata sont con√ßus pour une chose: pour fournir un transfert simple du r√©pertoire de donn√©es √† l'avenir - vous n'aurez pas besoin de modifier la configuration dans le moteur Nextcloud et g√©n√©ralement d'y grimper - tout ce que vous devez faire est de connecter un nouveau disque, de le copier sur lui des donn√©es et recr√©er un lien symbolique menant √† un nouveau r√©pertoire avec des donn√©es.  En m√™me temps, toutes les actions ne d√©passent pas le r√©pertoire / mnt.  Donc, tout s'est av√©r√© compliqu√© sur le plan √©volutif, je ne voulais tout simplement pas perdre les solutions que j'avais. <br><br>  Quelle est la meilleure fa√ßon de transf√©rer des donn√©es en dehors de la machine virtuelle?  Je vais partager mon exp√©rience sur quelle option j'ai arr√™t√© et pourquoi. <br><br>  Les cl√©s USB ont √©t√© automatiquement captur√©es lorsque la machine virtuelle a d√©marr√©, se sont correctement et compl√®tement jet√©es √† l'int√©rieur, et tout a toujours fonctionn√©, mais uniquement jusqu'√† ce que le disque soit d√©connect√© du syst√®me pour une raison quelconque.  Le red√©marrage ou la d√©connexion physique et la connexion d'un disque ont aid√©.  La d√©cision s'est av√©r√©e peu fiable.  Il n'y avait pas un tel probl√®me avec les lecteurs flash, mais leur volume et leur vitesse de travail ne me convenaient absolument pas.  Peut-√™tre que cela valait la peine d'essayer un disque externe avec une alimentation autonome. <br><br>  Le transfert d'annuaire via VMWare Shared Folders a fonctionn√© de mani√®re stable et parfaite.  Cette solution a compl√®tement satisfait la t√¢che de synchronisation de deux smartphones.  Tout a fonctionn√© pendant plusieurs jours, des dizaines de gigaoctets de donn√©es ont √©t√© pomp√©s.  Cependant, lorsque j'ai d√©cid√© d'ajouter des donn√©es de l'ordinateur au cloud, j'ai soudainement trouv√© un probl√®me avec les longs chemins d'acc√®s et les noms de fichiers.  En th√©orie, la limite de nom de fichier / dossier NTFS est de 255 caract√®res, mais en pratique, l'API Windows la limite √† 244 caract√®res.  En th√©orie, la limite de la longueur du chemin d'acc√®s √† un fichier ou un dossier dans NTFS est de 32 767 caract√®res, mais en pratique, l'API Windows la limite √† 245 caract√®res.  √âtant donn√© que je suis un grand fan d'informations structurantes, la longueur de mon chemin peut √™tre tr√®s grande.  Le titre non abr√©g√© des livres peut √©galement facilement contenir de 100 √† 150 caract√®res, espaces compris.  Cette restriction est un probl√®me connu des dossiers partag√©s VMWare, qui ne pouvait pas √™tre r√©solu m√™me lorsque vous utilisez Windows 10 avec toutes sortes de cl√©s intelligentes dans le registre pour supprimer la limite de 255 caract√®res.  Une raison possible est les limitations de vmhgfs.  Cette mani√®re pratique de se connecter a d√ª √™tre abandonn√©e.  La raison est r√©solue √† coup s√ªr - le probl√®me est dans le syst√®me de fichiers virtuel, qui est utilis√© dans le m√©canisme des dossiers partag√©s VMWare. <br><br>  La solution suivante consiste √† connecter le disque dur directement √† la machine virtuelle.  Cela n'a pas non plus fonctionn√© sans probl√®me.  La structure des donn√©es (ou syst√®me de fichiers, et cela √©tait √©vident pour NTFS et EXT2 / 3/4) est constamment tomb√©e en panne soit lorsque le disque ou sa partition a √©t√© ¬´captur√©¬ª par le logiciel de la machine virtuelle, soit lorsqu'il a √©t√© renvoy√© au syst√®me h√¥te m√™me si j'ai transf√©r√© l'ensemble Conduisez hors ligne sur le syst√®me h√¥te.  Dans certains modes, je n‚Äô√©cris ni ne lis les donn√©es - je ne pouvais m√™me pas formater correctement le disque dur ou la partition transf√©r√©s.  Cependant, nous avons r√©ussi √† trouver un mode de fonctionnement: un disque dur physique avec une partition, format√© en NTFS, √©tait connect√© √† la machine virtuelle dans un certain mode de connexion: SATA / Ind√©pendant / Persistant / Utiliser une partition individuelle.  Le dossier nxcdata contenant les donn√©es doit se trouver sur le disque dur. <br><br><hr><a name="chap5"></a><br><h3>  Configurer l'acc√®s √† la machine virtuelle Nextcloud √† partir du r√©seau local </h3><br>  Nous n'avons aucun probl√®me √† ouvrir des sites Web sur une machine virtuelle ou √† partir d'un syst√®me h√¥te.  Mais comment ouvrir le site cr√©√© √† partir d'un autre ordinateur sur le r√©seau local?  Examinons la structure de notre r√©seau, illustr√©e ci-dessous. <br><br><img src="https://habrastorage.org/webt/vt/ge/zt/vtgeztmrqy5y22zje4pgdn-40ro.png"><br><br>  L'image montre que le routeur est directement connect√© √† Internet et configur√© de sorte qu'il distribue automatiquement les adresses IP aux appareils connect√©s dans la plage 192.168.0.2-192.168.0.254.  L'adresse 192.168.0.2 a √©t√© re√ßue par notre ordinateur, et 192.168.0.3 - le deuxi√®me ordinateur sur lequel nous faisons le serveur.  Cependant, le logiciel de virtualisation est install√© sur le deuxi√®me ordinateur, qui a cr√©√© son propre routeur virtuel et configur√© son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">DHCP</a> sur le sous-r√©seau 192.168.233.0/24.  Notre serveur virtuel a re√ßu l'IP 192.168.133.138. <br><br>  Je peux facilement ouvrir le site √† l'int√©rieur de la machine virtuelle 192.168.233.138.  Je peux facilement ouvrir le site √† partir de la machine 192.168.0.3 en entrant simplement l'adresse IP souhait√©e dans le navigateur - le logiciel de virtualisation a d√©j√† pris en charge la configuration correcte de l'environnement r√©seau sur la machine h√¥te.  Mais comment puis-je acc√©der au site √† partir de l'ordinateur 192.168.0.2?  Si j'entre l'adresse IP 192.168.233.138, rien ne s'ouvrira pour moi, car ni mon ordinateur ni le vrai routeur ne savent quoi que ce soit sur ce sous-r√©seau.  Si j'entre l'adresse 192.168.0.3, rien ne m'ouvrira non plus, car il n'y a vraiment pas de site sur cet ordinateur - il est √† l'int√©rieur de sa machine virtuelle. <br><br>  Pour r√©soudre ce probl√®me, vous devez configurer le routeur virtuel de l'ordinateur 192.168.0.3.  Nous savons d√©j√† que l'acc√®s aux sites se fait sur les ports 80 et 443. Lorsque vous acc√©dez √† ces ports √† une machine 192.168.0.3, nous devons cr√©er un routage afin que les requ√™tes soient transmises √† la machine virtuelle 192.168.233.138.  Heureusement pour cela, nous avons les outils disponibles.  VMWare Workstation dispose d'un outil Virtual Network Editor qui peut √™tre ouvert √† partir du menu de la machine virtuelle (Edition -&gt; Virtual Network Editor). <br><br><img src="https://habrastorage.org/webt/07/-x/ml/07-xmlj7novkph4sr6e0yrmabnw.jpeg"><br><br>  Cet outil vous permet de g√©rer de mani√®re assez flexible les param√®tres r√©seau.  Nous devons s√©lectionner la carte r√©seau virtuelle VMNet8 et cliquer sur le bouton "Param√®tres NAT ..." qui est devenu disponible.  Dans la fen√™tre qui s'ouvre, vous devez ajouter des r√®gles pour cr√©er le routage dont nous avons besoin. <br><br><img src="https://habrastorage.org/webt/uc/jh/dp/ucjhdp0cif4azermsxbwfra4v-o.jpeg"><br><br>  Sp√©cifiez le port du syst√®me h√¥te, puis sp√©cifiez l'adresse IP et le port de la machine virtuelle o√π les demandes doivent √™tre redirig√©es.  Pour transf√©rer le trafic HTTPS, vous devez sp√©cifier le port du syst√®me h√¥te 443 et le port 443 et l'adresse de la machine virtuelle 192.168.233.138.  Apr√®s avoir cr√©√© les r√®gles, cliquez sur ¬´OK¬ª dans toutes les fen√™tres - l'environnement de r√©seau virtuel est reconfigur√© automatiquement. <br><br>  Apr√®s ces modifications, nos sites commenceront √† s'ouvrir √† partir de la machine 192.168.0.2 lors de l'acc√®s √† l'adresse 192.168.0.3. <br><br>  Des param√®tres similaires pour la redirection de port sont disponibles non seulement pour VMWare, mais aussi pour VirtualBox (Param√®tres ‚Üí R√©seau ‚Üí s√©lectionnez l'adaptateur requis ‚Üí Avanc√© ‚Üí Redirection de port).  Cependant, lors des exp√©riences de connexion du disque dur √† cette √©tape, j'ai trouv√© le lecteur VMWare gratuit install√©, dans lequel l'√©diteur de r√©seau virtuel ne l'√©tait pas.  Je n'ai rien trouv√© sur la redirection de port pour VMWare Player sur Internet et j'ai d√ª utiliser une version d'essai de VMWare Workstation - lors de l'installation du produit, cela donne 30 jours d'utilisation gratuite.  Apr√®s 30 jours, le produit peut √™tre retir√©, nettoy√© et r√©install√©, mais une telle attention au serveur est en quelque sorte redondante et clairement ind√©sirable.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et puis je suis all√© √† un petit (ou gros) truc. L'ensemble de fichiers VMWare Workstation contient l'utilitaire vmnetcfg, qui s'ex√©cute essentiellement via l'√©l√©ment Virtual Network Editor. Cependant, il ne faisait pas partie du jeu de fichiers VMWare Player. Mais lors de l'installation de VMWare Player, est-ce qu'il configure en quelque sorte son environnement r√©seau? Je viens de prendre cet utilitaire et de le copier dans le dossier avec VMWare Player, puis de le lancer. √âtonnamment, tout a fonctionn√©. Il est possible que les param√®tres r√©seau l√©gers dans l'environnement VMWare Player ne fonctionnent pas, mais la redirection de port est fournie, et je n'en ai pas besoin de plus.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour acc√©der √† notre serveur depuis Internet, vous devez rediriger les ports sur un routeur connect√© √† Internet de la m√™me mani√®re. Dans le firmware de la grande majorit√© des routeurs, il existe une section de redirection de port o√π vous pouvez configurer le routage en sp√©cifiant le port externe et le port et l'adresse IP de la machine interne. Cependant, il y a une l√©g√®re nuance. Si le fournisseur nous a donn√© une v√©ritable adresse IP ou que nous l'avons achet√©e chez lui, il n'y aura aucun probl√®me - nous entrons cette adresse IP depuis un ordinateur de n'importe o√π dans le monde, le vrai routeur redirigera le trafic vers un ordinateur avec une machine virtuelle sur laquelle le routeur virtuel redirigera le trafic directement vers le virtuel une voiture. Mais que faire √† quelqu'un qui n'a pas la possibilit√© d'obtenir une v√©ritable adresse IP et qui obtient des adresses dynamiques ou est derri√®re </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NAT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fournisseur, obtenir une adresse IP "grise"? </font><font style="vertical-align: inherit;">Je n'ai pas eu √† r√©soudre un tel probl√®me, car j'ai une adresse IP "blanche" statique. </font><font style="vertical-align: inherit;">Quiconque doit r√©soudre un tel probl√®me d'une mani√®re ou d'une autre devra y faire face. </font><font style="vertical-align: inherit;">Je conseillerais de regarder dans le sens de dyndns ou freedns.afraid.org dans le cas d'adresses dynamiques, ou d'acheter un VDS bon march√© pour essayer de trouver vous-m√™me une sorte de routage, car dans tous les cas, sans serveur externe avec une adresse IP statique, ce probl√®me ne peut pas √™tre r√©solu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir configur√© le routage, j'ai corrig√© les adresses IP des ordinateurs 192.168.0.3 et 192.168.233.138, en les √©crivant manuellement dans les param√®tres de la carte r√©seau de ces machines afin d'exclure leur r√©affectation automatique.</font></font><br><br><hr><a name="chap6"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Configuration de Nextcloud </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est maintenant temps d'ouvrir https: // 127.0.0.1/nextcloud dans le navigateur √† l'int√©rieur de la machine virtuelle, https: // 192.168.233.138/nextcloud depuis le syst√®me h√¥te ou, en fonction du routage configur√© d√©crit ci-dessus, https: // 192.168.0.3/nextcloud depuis n'importe quel ordinateur sur le r√©seau local. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, nous d√©finissons le login / mot de passe de l'administrateur, l'acc√®s √† la base de donn√©es pr√©c√©demment cr√©√©e et comme emplacement de stockage, sp√©cifions le chemin d'acc√®s complet au r√©pertoire nxcdata: / mnt / nxcdata / nxcdata. Cette √©tape de configuration n'est pas diff√©rente de l'installation d'un site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans les param√®tres d'administration, j'ai apport√© les modifications simples suivantes: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Personnel ‚Üí choisi le russe et sp√©cifi√© un e-mail pour l'utilisateur administrateur @ localhost </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Administration ‚Üí Acc√®s g√©n√©ral ‚Üí d√©sactiv√© tous les √©l√©ments </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Administration ‚Üí Enqu√™te d'utilisation ‚Üí d√©sactiv√© tous les √©l√©ments</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Administration ‚Üí Param√®tres avanc√©s ‚Üí Gestion des fichiers: ¬´Taille maximale du fichier de t√©l√©chargement¬ª d√©fini sur 25 Go </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Utilisateurs ‚Üí cr√©√© le groupe d'utilisateurs et ajout√© un nouvel utilisateur √† celui-ci </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s le r√©glage, vous devez activer la mise en cache. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez le fichier: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /var/www/nextcloud/config/config.php</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et tout √† la fin, avant ");" ajoutez ce qui suit: </font><font style="vertical-align: inherit;">Vous devez maintenant autoriser l'acc√®s externe au site au niveau de son "moteur". </font><font style="vertical-align: inherit;">Ouvrez le fichier: </font><b><font style="vertical-align: inherit;"># nano /var/www/nextcloud/config/config.php</font></b><font style="vertical-align: inherit;"> Dans la section trusted_domains, vous devez ajouter l'adresse IP du serveur √† la baie, ajoutez l'adresse sur laquelle Nexcloud est install√©. La section trusted_domains dans notre cas ressemblera √† ceci:</font></font><br><br> <code>'memcache.local' =&gt; '\OC\Memcache\Memcached', <br> 'memcache.distributed' =&gt; '\OC\Memcache\Memcached', <br> 'memcached_servers' =&gt; array( <br> array('localhost', 11211), <br> ), <br></code> <br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br><br> <code>'trusted_domains' =&gt; <br> array ( <br> 0 =&gt; '127.0.0.1', <br> 1 =&gt; '192.168.233.138', <br> ), <br></code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez maintenant v√©rifier le bon fonctionnement du service - ouvrez le site et connectez-vous en tant qu'utilisateur utilisateur. Si l'autorisation a r√©ussi, le service est pr√™t pour la bataille - vous pouvez installer l'application de synchronisation sur les ordinateurs et les smartphones, pour acc√©der, entrez l'adresse IP 192.168.0.3 et les d√©tails d'acc√®s au compte cr√©√©s pour chaque appareil. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heureusement ou malheureusement, je n'ai pas eu √† utiliser tout le potentiel du service cr√©√©, car au d√©part j'avais besoin d'un syst√®me de sauvegarde avec v√©rification et au d√©part je voulais seulement me d√©brouiller avec subversion, mais la vitesse de validation d'un nombre particuli√®rement important de petits fichiers m'a beaucoup attrist√©. J'ai tout fait pour grandir, mais je n'allais pas en profiter, et puis, d'une mani√®re ou d'une autre, ce n'est plus du tout le cloud.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un utilisateur plus d√©taill√© de l'utilisation du service a √©t√© r√©alis√© </font><font style="vertical-align: inherit;">fin 2017 </font><font style="vertical-align: inherit;">par l'utilisateur de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wtigga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans son article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Comment t√©l√©charger VPS: votre¬´ cloud ¬ªNextcloud</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Du point de vue de l'utilisateur, l'article donne un aper√ßu du nouveau serveur Nextcloud, version 12.</font></font><br><br><hr><a name="chap7"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√©glage avanc√© Nextcloud </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors du fonctionnement du cloud pendant le premier mois de travail, certains probl√®mes sont apparus que j'ai d√ª r√©soudre avec l'aide de la communaut√© ou par moi-m√™me. </font><font style="vertical-align: inherit;">Je dois dire que j'ai utilis√© le service tr√®s dur et en fait v√©rifi√© sa r√©sistance au stress. </font><font style="vertical-align: inherit;">La synchronisation de quelques gigaoctets de donn√©es de t√©l√©phones au cours de la soir√©e et jusqu'√† un million de petits fichiers √† partir d'un ordinateur √©tait chose courante. </font><font style="vertical-align: inherit;">En g√©n√©ral, le service m'a fait une impression tr√®s positive.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je ne dirais pas que les solutions ci-dessous sont correctes et belles, mais ces b√©quilles fonctionnent au moins pour la version 11.0.2, sinon il serait impossible d'utiliser le service. Dans la version 12.x, quelque chose peut avoir √©t√© am√©lior√© et corrig√©, donc je ne recommanderais pas de d√©finir ces param√®tres imm√©diatement dans le cadre du param√®tre de d√©marrage, tandis que pour la ligne 11.x, ils peuvent √™tre appliqu√©s imm√©diatement. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probl√®me 1</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une erreur comme ¬´le fichier est verrouill√©¬ª se produit pendant la synchronisation. La synchronisation s'arr√™te. Le probl√®me est connu - il est n√©cessaire d'effacer le contenu de la table oc_file_locks en ex√©cutant la requ√™te suivante √† partir de la console mysql (lors de l'autorisation de l'utilisateur nextcloud): </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql&gt; DELETE FROM oc_file_locks WHERE 1</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme de telles erreurs ne sont pas rares, je n'ai rien trouv√© de mieux que de cr√©er un script et de le placer directement dans le dossier racine: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano / root / empty_oc_file_locks Contenu du script</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash mysql -unextcloud &gt; -pnc123 -D nextcloud &lt;&lt;MY_QUERY DELETE FROM oc_file_locks WHERE 1 MY_QUERY</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le script peut √™tre ex√©cut√© manuellement, mais ce n'est pas notre m√©thode. </font><font style="vertical-align: inherit;">J'ai d√©cid√© de l'ex√©cuter automatiquement toutes les 15 minutes en utilisant cron (https://ru.wikipedia.org/wiki/Cron). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ce faire, cr√©ez un fichier: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano / root / crontab</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avec le contenu suivant: </font><font style="vertical-align: inherit;">Vous devez maintenant apporter des modifications au planificateur: </font><b><font style="vertical-align: inherit;"># crontab / root / crontab</font></b><font style="vertical-align: inherit;"> Vous pouvez v√©rifier des changements comme celui-ci: </font><b><font style="vertical-align: inherit;"># crontab -l </font></b><b><font style="vertical-align: inherit;">Probl√®me 2</font></b><font style="vertical-align: inherit;"> Lors de la synchronisation via webDAV dans les journaux (voir panneau d'administration, autoris√© par l'administrateur), les erreurs suivantes peuvent appara√Ætre:</font></font><br><br> <code>*/15 * * * * root bash /root/empty_oc_file_locks <br></code> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br><br> <code>Error PHP reset() expects parameter 1 to be array, null given at /var/www/nextcloud/apps/files_versions/lib/Storage.php#783 <br> Error PHP ksort() expects parameter 1 to be array, null given at /var/www/nextcloud/apps/files_versions/lib/Storage.php#782 <br> Error PHP Invalid argument supplied for foreach() at /var/www/nextcloud/apps/files_versions/lib/Storage.php#759 <br> Error PHP Undefined index: by_file at /var/www/nextcloud/apps/files_versions/lib/Storage.php#759 <br> Error PHP Undefined index: all at /var/www/nextcloud/apps/files_versions/lib/Storage.php#757 <br></code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette fois, la communaut√© n'a rien fait et a d√ª mener l'enqu√™te seule. La raison r√©side dans l'erreur "Index non d√©fini ... Storage.php # 757", qui entra√Æne plusieurs autres erreurs. Nous regardons le code de ce fichier. Tout le probl√®me √©tait dans le quota. Sur cette ligne du code (Storage.php # 757), l'espace libre est calcul√© en tenant compte du volume des fichiers d'archive. Quelque chose ne va pas dans le calcul, bien que le quota soit d√©fini sur "illimit√©". Pour corriger l'erreur dans le panneau d'administration, j'ai d√©fini un quota ¬´infini mais num√©rique¬ª pour chaque utilisateur, par exemple, 100 To. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probl√®me 3</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le probl√®me avec la synchronisation des fichiers .htaccess - ils ne se synchronisent tout simplement pas! </font><font style="vertical-align: inherit;">Et je n'√©tais pas seul, dans certains forums, ils ont pos√© des questions similaires. </font><font style="vertical-align: inherit;">Cependant, je n'ai pas rencontr√© de solution toute faite. </font><font style="vertical-align: inherit;">J'ai d√ª repenser moi-m√™me. </font><font style="vertical-align: inherit;">√Ä la suite de la recherche sur Google, de la visualisation des journaux, de l'analyse de code, je n'ai rien trouv√© de mieux que la fa√ßon de r√©parer le fichier du moteur nextcloud. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le fichier /var/www/nextcloud/lib/private/Files/filesystem.php nous recherchons la ligne suivante: </font><font style="vertical-align: inherit;">Et nous la mettons sous la forme suivante:</font></font><br><br> <code>$blacklist = \OC::$server-&gt;getConfig()-&gt;getSystemValue('blacklisted_files', array('.htaccess')); <br></code> <br><br><font style="vertical-align: inherit;"></font><br><br> <code>$blacklist = \OC::$server-&gt;getConfig()-&gt;getSystemValue('blacklisted_files', array('')); <br></code> <br><br><hr><a name="chap8"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Protection pour Nextcloud </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez prot√©ger notre service contre la s√©lection de mots de passe pour le panneau d'administration √† l'aide de fail2ban. Pour ce faire, vous devez d√©crire l'expression caract√©ristique qui se produit dans les journaux nextcloud lorsque l'authentification √©choue, selon laquelle le d√©clencheur correspondant se d√©clenchera. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ez le fichier: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano /etc/fail2ban/filter.d/nextcloud.conf</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avec le contenu suivant: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Definition] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">failregex = {"reqId": ". *", "RemoteAddr": ". *", "App": " core "," message ":" √âchec de la connexion: '. *' \ (IP distante: '' \) "," level ": 2," time ":". * "} </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignoreregex = </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez le fichier: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># nano / etc /fail2ban/jail.local</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et √† la fin du fichier, ajoutez ce qui suit: </font><font style="vertical-align: inherit;">Red√©marrez le service: </font><b><font style="vertical-align: inherit;"># service fail2ban restart</font></b><font style="vertical-align: inherit;"> V√©rifiez un filtre actif:</font></font><br><br> <code>#       nextcloud <br> [nextcloud] <br> enabled = true <br> port = http,https <br> protocol = tcp <br> filter = nextcloud <br> logpath = /var/log/nextcloud.log <br></code> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"></font></b> <br><br><font style="vertical-align: inherit;"></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># fail2ban-client status nextcloud</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> N'oubliez pas que, conform√©ment aux param√®tres fail2ban de la partie pr√©c√©dente, si le mot de passe est entr√© sans succ√®s six fois de suite pendant 12 heures, votre adresse IP sera bloqu√©e pendant 30 jours. </font><font style="vertical-align: inherit;">J'ai en quelque sorte pass√© deux soir√©es en raison d'un mot de passe incorrect sur l'un des t√©l√©phones, jusqu'√† ce que je d√©couvre ce simple fait dans les journaux syst√®me.</font></font><br><br><hr><a name="chap9"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Smartphone Cloud Sync </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour synchroniser le contenu des t√©l√©phones fonctionnant sous Android, il existe une merveilleuse application FolderSync. Le programme justifie pleinement son bas prix. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez d'abord cr√©er un nouveau compte dans lequel sp√©cifier https: // 192.168.0.3/nextcloud comme adresse de serveur, entrez le login et le mot de passe du compte cr√©√© pr√©c√©demment et activez le certificat auto-sign√©. Cliquez sur le bouton "Test" et assurez-vous que la connexion au serveur est en ordre.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, vous devez cr√©er une t√¢che. Dans la t√¢che, sp√©cifiez le compte cr√©√© pr√©c√©demment et s√©lectionnez le type de synchronisation - ¬´Vers le dossier distant¬ª. Sp√©cifiez le dossier distant (vous pouvez le cr√©er directement √† partir de l'application "et s√©lectionnez le dossier local pour la synchronisation. J'ai fix√© le planning √† 2 heures du matin tous les jours. Dans les param√®tres de synchronisation, j'ai activ√©" Synchronisation des sous-dossiers "et" Synchronisation des dossiers inclus ", j'ai √©galement s√©lectionn√© l'option de toujours remplacer les anciens fichiers et en cas de conflit j'ai autoris√© √† utiliser le fichier local par d√©faut. Dans la section "Connexions", j'ai d√©sactiv√© toutes les connexions sauf le Wi-Fi, et j'ai enregistr√© le SSID de mon r√©seau Wi-Fi domestique dans la section "SSID WiFi autoris√©s" - application bourgeon Je ne peux synchroniser que sur mon r√©seau domestique et ne pas essayer de rechercher le serveur sur d'autres r√©seaux, j'ai laiss√© le reste des param√®tres par d√©faut.Ici, vous pouvez ajouter un filtrage. J'ai cr√©√© un nouveau filtre, ¬´Le nom du dossier contient¬ª et sp√©cifi√© la valeur [nosync]. Ainsi, je peux exclure certains dossiers du dossier local sp√©cifi√© de la synchronisation en ajoutant simplement le nom ¬´[nosync]¬ª √† la fin.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce param√®tre a √©t√© fait pour des dossiers locaux tels que DCIM, Download, Telegram, viber, WhatsApp. </font><font style="vertical-align: inherit;">Plus quelques dossiers utilisateur de plusieurs gigaoctets. </font><font style="vertical-align: inherit;">Une fois par jour, le contenu de ces dossiers est synchronis√© avec le serveur et les anciennes versions des fichiers sur le serveur ne sont pas supprim√©es, mais sont renomm√©es et d√©plac√©es vers l'archive. </font><font style="vertical-align: inherit;">Cela m'a permis de r√©cup√©rer rapidement un fichier supprim√© accidentellement ou d'annuler des modifications dans d'autres fichiers.</font></font><br><br><hr><a name="chap10"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Synchronisation avec le cloud de l'ordinateur personnel </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je ne me consid√®re pas comme un vrai programmeur. Au cours des dix derni√®res ann√©es, j'ai programm√© dans des langages de programmation qui ne sont utilis√©s que dans le d√©veloppement de processeurs ou de chipsets. √âtant donn√© que je n'avais rien fait en C / C ++ depuis 15 ans, mais que j'avais besoin d'automatiser quelque chose sur l'ordinateur, j'ai plut√¥t utilis√© activement des langages de script tels que BAT / CMD ou des logiciels tels que Sign 0f Mistery ou xStarter. Une fois que j'ai d√©couvert et essay√© ce qu'est AutoIt, c'est devenu une nouvelle √®re dans l'automatisation de mon PC.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir √©t√© convaincu de la stabilit√© et de la fiabilit√© du syst√®me de synchronisation sur les smartphones, j'ai pens√© que ce serait bien de synchroniser les donn√©es sur mon ordinateur personnel. Nextcloud a son propre client pour Windows et, naturellement, il est devenu le premier candidat aux tests. J'allais synchroniser un volume de donn√©es de l'ordre d'un t√©raoctet, compos√© de centaines de milliers de fichiers de tailles diff√©rentes. Les donn√©es √©taient diff√©rentes: musique, images, documents, livres √©lectroniques, distributions, sites de sauvegarde, etc., etc. Il serait raisonnable de r√©duire tout cela √† la synchronisation de donn√©es plus critiques, telles que des documents, par exemple, mais l'enthousiasme s'est empar√© de moi et j'ai voulu v√©rifier la force du service.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dix heures apr√®s le d√©but de la synchronisation, et en fait le premier t√©l√©chargement de contenu sur le serveur, le client est tomb√© sur un fichier au nom long. √Ä ce moment-l√†, sur le serveur, j'ai √©galement utilis√© la connexion de stockage externe via les dossiers partag√©s VMWare et j'ai d√ª essayer une douzaine de clients, puis faire des exp√©riences simples sur la copie manuelle de fichiers sur le serveur afin de comprendre que le probl√®me est du c√¥t√© serveur. Ainsi, apr√®s une semaine de lancement r√©ussi du service, j'ai d√ª revenir √† la machine virtuelle de sauvegarde et abandonner le m√©canisme VMWare Shared Folders, en recommen√ßant √† z√©ro. Au final, j'ai supprim√© ce goulot d'√©tranglement c√¥t√© serveur, test√© la fiabilit√© de la solution pendant une semaine de synchronisation des smartphones, et d√©cid√© de revenir sur mon ordinateur personnel. Cette fois, le client n'a pas tr√©buch√© sur le dossier malheureux et j'√©tais d√©j√† heureuxcependant, apr√®s une demi-journ√©e de synchronisation de petits fichiers, le client s'est de nouveau fig√©. Maintenant, il s'est av√©r√© que le chemin est trop long du c√¥t√© de l'ordinateur domestique et que le client Nextcloud ne peut pas le traiter correctement. Malheureusement, le client natif Nextcloud ne fonctionnait pas et son contenu d'informations n'√©tait pas tr√®s √©lev√©, j'ai donc d√ª l'abandonner.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai pass√© un certain temps √† essayer de trouver un programme de synchronisation pratique qui prend en charge la gestion en ligne de commande. Je voulais faire ma t√¢che pour chaque grand dossier sur l'ordinateur et les ex√©cuter en mode batch. Auparavant, j'avais d√©j√† cr√©√© et √©labor√© un ensemble de fichiers BAT pour la synchronisation √† l'aide de scripts et la gestion de FreeFileSync via la ligne de commande. Le probl√®me des chemins longs ou des noms de fichiers a √©t√© r√©solu en d√©finissant des dossiers locaux de la forme "\\? \ D: \ Info", c'est-√†-dire se r√©f√©rant essentiellement au dossier local en tant que dossier r√©seau. Cependant, ce qui est webdav FreeFileSync ne sait pas. Malheureusement, il n'y avait pas d'analogues complets de FolderSync pour Windows, mais plus d'une fois sur les forums, ils ont recommand√© GoodSync et, apr√®s avoir lanc√© une douzaine d'autres programmes, j'ai d√©cid√© de l'essayer. Malheureusement, GoodSync est beaucoup plus cher,mais un gaspillage unique de 15 $ pour la s√©curit√© de leurs pr√©cieuses donn√©es, en principe, un d√©chet r√©alisable. Le programme a un mode de test, vous pouvez donc d'abord v√©rifier ses performances et sa stabilit√©.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GoodSync s'est av√©r√© √™tre un logiciel assez convivial. Il existe une version portable sp√©ciale appel√©e GoodSync2Go. Elle m'a donc int√©ress√©. Pendant l'installation, vous devez s√©lectionner la lettre de lecteur et le programme est install√© dessus dans le dossier GoodSync. J'ai cr√©√© le dossier Sync dans le r√©pertoire racine du lecteur, disons D, et j'ai d√©plac√© le dossier GoodSync cr√©√© avec tout le contenu. </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce texte a √©t√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©crit sp√©cifiquement pour le site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geektimes.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlexanderS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le lien vers la source est facultatif, mais sa r√©f√©rence est hautement souhaitable!</font></font></sup>  <sup>]</sup> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s l'installation, le programme doit cr√©er des t√¢ches: le dossier local et le dossier distant pour la synchronisation sont indiqu√©s. Dans les param√®tres du travail, j'ai s√©lectionn√© la synchronisation de gauche √† droite avec le choix des options ¬´Suppression synchrone¬ª et ¬´Enregistrer les versions pr√©c√©dentes des fichiers supprim√©s / remplac√©s¬ª. Dans les param√®tres sur le c√¥t√© gauche, j'ai s√©lectionn√© "Safe Copy" et "Ne pas cr√©er le dossier _gsdata_", sur le c√¥t√© droit - "Safe Copy" et "Quick Pre-Analysis by Timestamps". Ainsi, des t√¢ches sont cr√©√©es pour chaque dossier requis. Disons que j'ai configur√© la t√¢che sur le dossier Info et l'ai nomm√©e ¬´bck_Info¬ª. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, dans le dossier D: \ Sync, le fichier bck_Info.bat est cr√©√© avec le contenu suivant:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 @%dir%GoodSync\GoodSync2Go-v10.exe /miniwin /<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> sync <span class="hljs-string"><span class="hljs-string">"%~n0"</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit du langage de script BAT. Dans la premi√®re ligne de code, le chemin actuel du script en cours d'ex√©cution est d√©fini sur la variable. La deuxi√®me ligne d√©marre le fichier GoodSync2Go-v10.exe √† partir du dossier GoodSync le long de ce chemin, dans lequel la t√¢che doit √™tre ex√©cut√©e avec le nom du fichier (bck_Info), la fen√™tre d'ex√©cution de la t√¢che est r√©duite et le programme doit se fermer automatiquement √† la fin de la t√¢che. Je peux copier ce script plusieurs fois, en changeant √† chaque fois uniquement son nom en celui d'une t√¢che pr√©c√©demment cr√©√©e dans GoodSync. Ainsi, en cliquant simplement sur le bouton Entr√©e du fichier BAT, je peux d√©marrer la synchronisation des dossiers dont j'ai besoin individuellement.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ajouter une nouvelle t√¢che dans FreeFileSync, je pouvais simplement copier le fichier de script xml et le corriger manuellement, c'est-√†-dire </font><font style="vertical-align: inherit;">l'ex√©cution du shell graphique du programme n'√©tait pas du tout n√©cessaire. </font><font style="vertical-align: inherit;">Dans GoodSync, toutes les t√¢ches sont enregistr√©es dans le fichier D: \ Sync \ GoodSync \ GoodSync \ Profile \ jobs.tic et pour ajouter une nouvelle t√¢che, vous devrez ouvrir le programme et le cr√©er, car </font><font style="vertical-align: inherit;">la modification de ce fichier est quelque peu probl√©matique et on ne sait pas √† quoi cela pourrait conduire. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour synchroniser tous les dossiers, vous pouvez maintenant √©crire un simple script bck_all.bat:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_Info.bat call %dir%bck_Info2.bat call %dir%bck_Info3.bat call %dir%bck_Info4.bat</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chaque ligne du script provoque simplement l'ex√©cution d'un script distinct, qui d√©marre la synchronisation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout cela fonctionne tr√®s bien et commod√©ment, mais il n'y a pas de contr√¥le d'erreur pendant la synchronisation. Par exemple, si le serveur n'est pas allum√©, toutes les t√¢ches se termineront rapidement et moi, √©tant revenu apr√®s une heure, penserai que la synchronisation est d√©j√† termin√©e. Dans le m√™me temps, les journaux de toutes les t√¢ches sont cr√©√©s sur le chemin D: \ Sync \ GoodSync \ GoodSync \ Profile \ *. Log. Il suffit de regarder le journal de chaque synchronisation pour la pr√©sence du mot "ERREUR" - pour une raison quelconque, c'est ainsi que les √©checs de synchronisation sont signal√©s dans le journal. Par cons√©quent, il a √©t√© d√©cid√© d'√©crire un petit programme pour analyser ces journaux apr√®s toutes les synchronisations, qui devrait √™tre d√©marr√© automatiquement apr√®s la synchronisation de tous les dossiers. Le programme a re√ßu le fier nom log_analayser et est √©crit dans le langage de semi-scripting </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoIt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si quelqu'un est int√©ress√©, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©chargez sa version compl√®te</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez le faire sur le site officiel d'AutoIt, qui contient les biblioth√®ques n√©cessaires, le compilateur et SciTE - un √©diteur multiplateforme pour le code √† partir duquel vous pouvez compiler le programme. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel temps j'ai pass√© √† d√©velopper et d√©boguer le code, le r√©sultat a √©t√© un fichier log_analayser.au3 avec le contenu suivant:</font></font><br><br><pre> <code class="plaintext hljs">; LOG Analyser 1.0 ;      - #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|LOG Analyser #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|log_analyser.exe #AutoIt3Wrapper_Res_Comment=     - #AutoIt3Wrapper_Res_Description= - ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) #include &lt;Array.au3&gt; #include &lt;_FileDirList.au3&gt; ;  Local $msg_title = "LOG Analyser 1.0" Local $path = @ScriptDir Local $soft_open_log = "notepad.exe" Local $path, $dir_mode, $word, $file_analyse_name, $file_analyse_ext, $log_path, $log_msg_on Local $file_log, $word_detect, $file_analyse, $cnt_files, $i ;    if ($CmdLine[0] &lt; 6) then MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit else if (StringCompare($CmdLine[1], "file") = 0) then $dir_mode = 0 elseif (StringCompare($CmdLine[1], "dir") = 0) then $dir_mode = 1 else MsgBox(0x10, $msg_title, "     'file'  'dir'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif $word = $CmdLine[2] if ($dir_mode = 0) then $file_analyse_name = $CmdLine[3] else $dir_analyse = $CmdLine[3] endif $file_analyse_ext = $CmdLine[4] $log_path = $CmdLine[5] if (StringCompare($CmdLine[6], "err_msg_on") = 0) then $log_msg_on = 1 elseif (StringCompare($CmdLine[6], "err_msg_off") = 0) then $log_msg_on = 0 else MsgBox(0x10, $msg_title, "     'log_msg_on'  'log_msg_off'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif endIf ;   $file_log = $log_path &amp; "\" &amp; "log_analyser" &amp; "-" &amp; @YEAR &amp; "-" &amp; @MON &amp; "-" &amp; @MDAY &amp; "-" &amp; @HOUR &amp; "-" &amp; @MIN &amp; "-" &amp; @SEC &amp; ".log" $word_detect = 0 ;    if ($dir_mode = 0) then $file_analyse = $file_analyse_name &amp; "." &amp; $file_analyse_ext if (_file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) = 1) then $word_detect = 1 endif else ;     $dir_arr = _FileDirList($dir_analyse, "*."&amp;$file_analyse_ext, 1, 1, 0) ;_ArrayDisplay($dir_arr) ;    -       if ($dir_arr = 0) then MsgBox(0x10, $msg_title, "       !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif $cnt_files = $dir_arr[0] ;    $i = 0 While $i &lt;&gt; $cnt_files $i = $i + 1 $file_analyse = $dir_arr[$i] if (_file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) = 1) then $word_detect = 1 endif WEnd endif ;    if ($word_detect = 1) and ($log_msg_on = 1) then if (MsgBox (0x41034, $msg_title, " !" &amp; @CRLF &amp; "      : " &amp; $file_log &amp; @CRLF &amp; @CRLF &amp; "   ?")) = 6 then ShellExecuteWait($soft_open_log, $file_log) endif endif Exit ;                    ;   ,   ,     Func _file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) Local $file1, $file2, $file_line, $write_once $word_detect = 0 $write_once = 0 $file1 = FileOpen($file_analyse, 0) ;     If $file1 = -1 Then FileClose($file1) MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit EndIf ;       While 1 $file_line = FileReadLine($file1) If @error = -1 Then ExitLoop if (StringInStr($file_line, $word) &lt;&gt; 0) then $word_detect = 1 ;            if (FileExists($file_log) = 0) then $file2 = FileOpen($file_log, 1) FileClose($file2) endif ;        if ($write_once = 0) then $write_once = 1 $file2 = FileOpen($file_log, 1) FileWriteLine($file2, " : " &amp; $file_analyse) FileClose($file2) endif ;       $file2 = FileOpen($file_log, 1) FileWriteLine($file2, $file_line) FileClose($file2) endif WEnd ;     ,          if ($word_detect = 1) then $file2 = FileOpen($file_log, 1) FileWriteLine($file2, @CRLF) FileClose($file2) endif FileClose($file1) Return $word_detect EndFunc</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir tap√© le code, appuyez sur le bouton F7 dans l'√©diteur SciTE et obtenez le fichier log_analayser.exe √† la sortie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le programme analyse le fichier pour la pr√©sence d'un mot, lorsqu'il est trouv√©, un fichier journal est cr√©√©, dans lequel la ligne trouv√©e contenant ce mot est copi√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le programme peut fonctionner en deux modes: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- analyse d'un fichier sp√©cifique </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- analyse du dossier contenant les fichiers √† analyser (tous les sous-dossiers sont √©galement analys√©s). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque vous effectuez un appel de console, vous devez d√©finir six param√®tres pour le programme: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - mode de fonctionnement [fichier = analyse de fichier; dir = analyse du dossier contenant les fichiers] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 - mot cl√© de recherche </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 - nom du fichier ou chemin complet vers le dossier </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 - extension de fichier ou fichiers √† analyser dans le dossier</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 - le chemin complet vers le dossier o√π se trouvera le journal du programme; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 - affichage de la fen√™tre apr√®s analyse de tous les fichiers dans le cas de trouver le mot donn√© [err_msg_on = display; </font><font style="vertical-align: inherit;">err_msg_off = ne pas afficher] </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, nous avons obtenu un nouveau script bck_auto.bat:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_all.bat log_analyser.exe dir  %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le script lance un fichier √† partir duquel les t√¢ches de synchronisation de tous les dossiers n√©cessaires sont appel√©es individuellement les unes apr√®s les autres, puis l'analyseur du journal de synchronisation est appel√©, apr√®s quoi, en cas d'erreur, un message s'affiche vous demandant de regarder les lignes de journal o√π ces erreurs sont trouv√©es et vous pouvez comprendre quelle t√¢che des probl√®mes sont survenus. </font><font style="vertical-align: inherit;">Ces lignes sont √©crites dans un fichier journal distinct dans le dossier D: \ Sync \ LOG.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et puis j'ai subi un terrible √©chec. L'analyseur de journaux n'a pas fonctionn√©. Non, cela fonctionnait tr√®s bien sur les fichiers de test, mais ne voulait obstin√©ment pas voir les erreurs dans les journaux. Pendant longtemps, je n'ai pas pu comprendre la raison jusqu'√† ce que je d√©couvre une chose terrible: non seulement que dans le journal en anglais, l'√©chec est affich√© par le seul mot russe "ERROR", mais aussi l'encodage de cet alphabet cyrillique est Macintosh! Je ne sais pas pourquoi les programmeurs de Siber Systems ont fait cela; c'est probablement le r√©sultat d'une terrible b√©quille √† l'int√©rieur du logiciel. Eh bien, qui a dit que la programmation devait √™tre ennuyeuse? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'y avait pas d'autre choix que de supporter une b√©quille avec une autre et, par cons√©quent, une construction fonctionnelle est apparue:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, le probl√®me suivant est apparu: GoodSync lui-m√™me ne supprime pas les fichiers journaux, de nouveaux fichiers sont apparus √† chaque nouvelle ex√©cution de t√¢che. </font><font style="vertical-align: inherit;">Et si une sorte de synchronisation a √©chou√©, notre analyseur trouvera toujours ce fichier et signalera joyeusement l'erreur. </font><font style="vertical-align: inherit;">Par cons√©quent, avant de d√©marrer la synchronisation, il a √©t√© d√©cid√© de nettoyer automatiquement le dossier D: \ Sync de tous les fichiers journaux. </font><font style="vertical-align: inherit;">Un √©l√©gant script clean_logs.bat a √©t√© cr√©√© pour cela:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 For /R %dir% %%i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>) Do ( Del /q <span class="hljs-string"><span class="hljs-string">"%%i"</span></span>) @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> on</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le script d√©sactive la sortie de tous les messages, d√©couvre le r√©pertoire de lancement du script, analyse tous les fichiers (y compris les sous-dossiers) jusqu'√† leur fin et supprime tous les fichiers avec l'extension de journal. </font><font style="vertical-align: inherit;">√Ä la fin du travail, la sortie du message est activ√©e. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le script bck_auto.bat a chang√©:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 @call clean_logs.bat call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout fonctionne tr√®s bien, mais le but est d'automatiser les actions de routine. </font><font style="vertical-align: inherit;">Pourquoi ne pas simplement √©teindre l'ordinateur la nuit et aller dormir, et il synchronisera lui-m√™me un tas de fichiers, analysera et d√©sactivera le chemin? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifions notre script bck_auto.bat:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup &amp; PCOFF @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 start MonitorOnOff.exe 0 @call clean_logs.bat call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_off shutdown /s /t 0 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux nouvelles lignes sont apparues dans le script. </font><font style="vertical-align: inherit;">L'application MonitorOnOff √©teint simplement le moniteur (afin qu'il n'√©claire pas la pi√®ce, mais qu'il soit √©teint manuellement tous les soirs et qu'il s'allume tous les matins est tr√®s paresseux), et la commande d'arr√™t √©teint l'ordinateur. </font><font style="vertical-align: inherit;">Le param√®tre responsable de l'affichage des messages lorsqu'une erreur a √©t√© trouv√©e a chang√© dans log_analyser, car apr√®s la synchronisation, il n'est pas n√©cessaire de ralentir l'ex√©cution du script par ce message, mais de lui permettre d'√©teindre l'ordinateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonitorOnOff est √©galement √©crit en AutoIt.</font></font><br><br><pre> <code class="plaintext hljs">; Monitor On Off 1.0 ;   /  #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|Monitor On Off #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|MonitorOnOff.exe #AutoIt3Wrapper_Res_Comment=  /  #AutoIt3Wrapper_Res_Description=  /  ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) HotKeySet("{F10}", "_Monitor_ON") HotKeySet("{F11}", "_Monitor_OFF") HotKeySet("{Esc}", "_Quit") Global Const $lciWM_SYSCommand = 274 Global Const $lciSC_MonitorPower = 61808 Global Const $lciPower_Off = 2 Global Const $lciPower_On = -1 Global $MonitorIsOff = False if ($CmdLine[0] &lt;&gt; 0) then _Monitor_OFF() endif While 1 Sleep(10) WEnd Func _Monitor_ON() $MonitorIsOff = False Local $Progman_hwnd = WinGetHandle('[CLASS:Progman]') DllCall('user32.dll', 'int', 'SendMessage', _ 'hwnd', $Progman_hwnd, _ 'int', $lciWM_SYSCommand, _ 'int', $lciSC_MonitorPower, _ 'int', $lciPower_On) EndFunc Func _Monitor_OFF() $MonitorIsOff = True Local $Progman_hwnd = WinGetHandle('[CLASS:Progman]') While $MonitorIsOff = True DllCall('user32.dll', 'int', 'SendMessage', _ 'hwnd', $Progman_hwnd, _ 'int', $lciWM_SYSCommand, _ 'int', $lciSC_MonitorPower, _ 'int', $lciPower_Off) _IdleWaitCommit(0) Sleep(20) WEnd EndFunc Func _IdleWaitCommit($idlesec) Local $iSave, $LastInputInfo = DllStructCreate ("uint;dword") DllStructSetData ($LastInputInfo, 1, DllStructGetSize ($LastInputInfo)) DllCall ("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr ($LastInputInfo)) Do $iSave = DllStructGetData ($LastInputInfo, 2) Sleep(60) DllCall ("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr ($LastInputInfo)) Until (DllStructGetData ($LastInputInfo, 2)-$iSave) &gt; $idlesec Or $MonitorIsOff = False Return DllStructGetData ($LastInputInfo, 2)-$iSave EndFunc Func _Quit() _Monitor_ON() Exit EndFunc</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le programme lanc√© est contr√¥l√© par trois touches: F10 allume le moniteur, F11 - s'√©teint et le bouton ESC termine le programme et le d√©charge de la m√©moire. Si vous sp√©cifiez un param√®tre lors du d√©marrage du programme, le programme en cours √©teint imm√©diatement l'√©cran.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, tout allait bien - avant d'aller me coucher, j'ai juste couru bck_all.bat, au lieu de "√âteindre l'ordinateur" et je me suis couch√©. Le moniteur n'a pas √©clair√© toute la pi√®ce, la synchronisation a √©t√© effectu√©e automatiquement et son succ√®s a √©t√© automatiquement analys√©. Le matin, il suffisait de regarder le contenu du dossier D: \ Sync \ GoodSync \ LOG \ pour au moins certains fichiers. Mais ce n'est pas le cas non plus - pourquoi perdre du temps si tout va bien? Je dois cr√©er un journal d'analyseur de journal d'analyseur de journal et le suspendre au d√©marrage du syst√®me afin qu'il fonctionne le lendemain lorsque l'ordinateur d√©marre et n'inqui√®te mon attention qu'en cas d'√©chec de la synchronisation. C'est ainsi qu'est n√© le programme check_file_exist.</font></font><br><br><pre> <code class="plaintext hljs">; Check File Exist 1.0 ;        #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|Check File Exist #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|check_file_exist.exe #AutoIt3Wrapper_Res_Comment=       #AutoIt3Wrapper_Res_Description=   ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) #include &lt;Array.au3&gt; #include &lt;_FileDirList.au3&gt; ;  Local $msg_title = "Check File Exist 1.0" Local $path = @ScriptDir Local $soft_open_dir = "explorer.exe" Local $path, $dir_analyse, $words, $msg_open ;    if ($CmdLine[0] &lt; 5) then MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit else $dir_analyse = $CmdLine[1] $file = $CmdLine[2] $words0 = $CmdLine[3] $words1 = $CmdLine[4] if (StringCompare($CmdLine[5], "msg_on") = 0) then $msg_open = 1 elseif (StringCompare($CmdLine[5], "msg_off") = 0) then $msg_open = 0 else MsgBox(0x10, $msg_title, "     'msg_on'  'msg_off'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif endIf ;      $dir_arr = _FileDirList($dir_analyse, "*"&amp;$file&amp;"*", 1, 0, 0) ;_ArrayDisplay($dir_arr) ;      if ($dir_arr = 0) then if (StringCompare($words0, "0") &lt;&gt; 0) then if ($msg_open = 0) then MsgBox(0x41030, $msg_title, $words0) else if (MsgBox(0x41034, $msg_title, $words0 &amp; @CRLF &amp; @CRLF &amp; "     ?")) = 6 then ShellExecuteWait($soft_open_dir, $dir_analyse) endif endif endif else if (StringCompare($words1, "0") &lt;&gt; 0) then if ($msg_open = 0) then MsgBox(0x41030, $msg_title, $words1) else if (MsgBox(0x41034, $msg_title, $words1 &amp; @CRLF &amp; @CRLF &amp; "    ?")) = 6 then ShellExecuteWait($soft_open_dir, $dir_analyse) endif endif endif endif Exit</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essentiellement, ce programme est une fonctionnalit√© log_analyser l√©g√®rement tronqu√©e. Le programme analyse le dossier sp√©cifi√© (√† l'exclusion des sous-dossiers) pour les fichiers et les noms qui correspondent au moins partiellement au mot de recherche sp√©cifi√© et affiche un message sur le r√©sultat de l'analyse. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Param√®tres du programme: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 - le chemin d'acc√®s complet au dossier (sans le caract√®re barre oblique - /) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 - le mot cl√© pour rechercher dans les noms de fichier, ou le nom de fichier complet </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 - cha√Æne de texte affich√©e lorsque le fichier n'est pas trouv√©, si = 0 - n'affiche pas le message </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 - texte la ligne affich√©e lorsque le fichier est trouv√©, si = 0 - n'affiche pas de message</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 - sortie de message: msg_off - seul un message sur la pr√©sence / absence de fichiers est affich√©, msg_on - dans la fen√™tre affich√©e il est √©galement propos√© d'ouvrir le dossier dans lequel les fichiers sont d√©tect√©s ou non. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, pour ce programme j'ai cr√©√© le script Check_LOG_from_log_analyser.bat, le lien dont j'ai plac√© √† l'habituel D√©marrage de Windows:</font></font><br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0LOG start check_file_exist.exe %dir% .<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> 0 <span class="hljs-string"><span class="hljs-string">"     !"</span></span> msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, au final, nous avons obtenu une solution compl√®tement autonome qui ne d√©pend pas de l'emplacement du dossier Sync et fonctionnera correctement de n'importe o√π sur notre ordinateur. </font><font style="vertical-align: inherit;">La solution est non seulement r√©alisable, mais √©galement stable - sous Windows 7 x64, cet ensemble de scripts a fonctionn√© pendant un an et il n'y a eu absolument aucun probl√®me.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peut-√™tre que maintenant tout cela semble quelque peu monstrueux, mais cela n'a rien de compliqu√©. </font><font style="vertical-align: inherit;">Si vous regardez attentivement le code AutoIt, la construction de base est les boucles si-alors-sinon-fin habituelles du m√™me type pour n'importe quel langage de programmation, dans lesquelles certains op√©rateurs et fonctions AutoIt r√©p√©titifs sont appris, qui sont appris litt√©ralement en quelques soir√©es. </font><font style="vertical-align: inherit;">Le langage de script BAT ne peut m√™me pas √™tre enseign√©, car la plupart des solutions sont standard et ont longtemps √©t√© d√©crites sur Internet. </font><font style="vertical-align: inherit;">Pouvoir utiliser la programmation est non seulement int√©ressant, mais peut √™tre tr√®s utile.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ode au code de Dark Dragon</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mt/oe/bi/mtoebi7ufvsfmzqjs52tihnxwiy.jpeg"><br></div></div><br><hr><a name="chap11"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Postface </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour √™tre honn√™te, je suppose, mais je ne m'attendais pas √† un tel volume d'articles, que j'ai d√ª passer jusqu'√† cinquante heures. En r√®gle g√©n√©rale, l'installation de votre cloud sur Internet est r√©duite √† des dictons comme: "Oui, vous devez y ex√©cuter plusieurs commandes." C'est vrai - l'installation est banale. Lorsque vous savez quelles commandes entrer dans la console et ce qu'elles signifient. Lorsque vous comprenez l'essence du routage sur le r√©seau. Lorsque vous disposez d√©j√† d'un serveur fonctionnel et que vous comprenez comment y ajouter un h√¥te. Lorsque vous savez comment cr√©er un site. Autrement dit, pour appliquer ces plusieurs commandes, vous devez avoir une certaine quantit√© de connaissances et d'exp√©rience. Le but de ces trois articles est de tenter de cr√©er de tels bagages en collectant les informations suffisantes n√©cessaires en un seul endroit et en expliquant comment les utiliser correctement. J'esp√®re sinc√®rementque cette s√©rie d'articles aidera quelqu'un √† faire ses premiers pas conscients dans le monde du logiciel libre.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revenez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au d√©but, √† la table des mati√®res</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'histoire de la cr√©ation d'un cloud domestique. </font><font style="vertical-align: inherit;">Partie 3. Cr√©ation d'un cloud personnel - installation et configuration de Nextcloud. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version textuelle: 1.2.1. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Date de premi√®re publication: 02/08/2018. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Derni√®re modification: 15/01/2020.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Journal de mise √† jour</font></font></b> <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2.1 [15-01-2020] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise √† jour de la table des mati√®res. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2.0 [08-02-2018] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Correction du texte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.0 [08-02-2018] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Correction du texte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.0.0 [08-02-2018] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La premi√®re version. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il d√©crit l'installation et la configuration de Nextcloud 11.0.2 dans la machine virtuelle VMWare, la configuration de l'environnement r√©seau VMWare et met en √©vidence certains des points de configuration qui sont apparus lors du fonctionnement de Nextcloud.</font></font><br></div></div><br><hr><a name="bug"></a><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informations pour l'administration de la ressource (bug suspect)</font></font></b> <div class="spoiler_text">   -  (, code  blockquote) <b>  </b>   : <br><blockquote> [Definition] <br> failregex={¬´reqId¬ª:".*",¬´remoteAddr¬ª:".*",¬´app¬ª:¬´core¬ª,¬´message¬ª:¬´Login failed: '.*' \(Remote IP: ''\)¬ª,¬´level¬ª:2,¬´time¬ª:".*"} <br> ignoreregex = <br></blockquote><br>          !       , ..      .    (/)  ‚Äî    .  : <br> ‚Äî   <br> ‚Äî          <br> ‚Äî  ,   ¬´  Nextcloud¬ª   , ,  <br> ‚Äî  ,         <br><br></div></div><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr410011/">https://habr.com/ru/post/fr410011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr410001/index.html">Comment la perception humaine de l'espace s'est-elle d√©velopp√©e et pourquoi avons-nous besoin de mesures</a></li>
<li><a href="../fr410003/index.html">R√©sultats de recherche: le piratage aide √† am√©liorer les ventes de nombreux artistes</a></li>
<li><a href="../fr410005/index.html">√âliminez l'√©lectricit√©</a></li>
<li><a href="../fr410007/index.html">Distr. Examen des programmes utiles tard depuis 16 ans</a></li>
<li><a href="../fr410009/index.html">La blockchain est-elle une s√©curit√© personnelle ou un danger personnel?</a></li>
<li><a href="../fr410013/index.html">8 r√®gles de communication dans un environnement multilingue: instructions pour les employ√©s des entreprises internationales</a></li>
<li><a href="../fr410017/index.html">L'UNICEF encourage les joueurs √† exploiter une √©mission pour les enfants syriens</a></li>
<li><a href="../fr410019/index.html">Ce que vous devez savoir sur les yeux des enfants</a></li>
<li><a href="../fr410023/index.html">Test du tout-en-un Dell Precision 5720: tout-en-un puissant</a></li>
<li><a href="../fr410025/index.html">Ce qui changera en SSD et RAM en 2018 - les nouveaux Kingston et HyperX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>