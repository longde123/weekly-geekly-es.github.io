<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔚 🚜 🧝🏻 QueryFilter: das Konzept des Filterns von Modellen 🙉 👌 💠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich möchte Sie auf das Konzept der Filterung nach URL-Anforderungen aufmerksam machen. Zum Beispiel werde ich die PHP-Sprache und das Laravel-Framewor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>QueryFilter: das Konzept des Filterns von Modellen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485520/">  Ich möchte Sie auf das Konzept der Filterung nach URL-Anforderungen aufmerksam machen.  Zum Beispiel werde ich die PHP-Sprache und das Laravel-Framework verwenden. <br><br><h4>  Konzept </h4><br>  Die Idee ist, eine universelle <i>QueryFilter-</i> Klasse für die Arbeit mit Filtern zu erstellen. <br><br><pre><code class="php hljs">GET /posts?title=source&amp;status=active</code> </pre> <br>  In diesem Beispiel werden <i>Beiträge</i> (Beitragsmodell) nach den folgenden Kriterien gefiltert: <br><br><ul><li>  Das Vorhandensein des Wortes "Quelle" im Titelfeld; </li><li>  Der Wert "Publizieren" im <i>Statusfeld</i> ; </li></ul><a name="habracut"></a><br><h4>  Anwendungsbeispiel </h4><br>  Beitragsmodell <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * The attributes that are mass assignable. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $fillable = [ <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'slug'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-string"><span class="hljs-string">'published_at'</span></span>, <span class="hljs-string"><span class="hljs-string">'updated_at'</span></span>, ]; }</code> </pre><br>  Route hinzufügen: <br><br><pre> <code class="php hljs">Route::get(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'PostController@index'</span></span>);</code> </pre> <br>  Erstellen Sie eine <i>Resource \ Post-</i> Datei für die Ausgabe im <i>JSON-Format</i> : <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Resources</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Resources</span></span>\<span class="hljs-title"><span class="hljs-title">Json</span></span>\<span class="hljs-title"><span class="hljs-title">JsonResource</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Transform the resource into an array. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Http\Request $request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ID, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_title, <span class="hljs-string"><span class="hljs-string">'slug'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_name, <span class="hljs-string"><span class="hljs-string">'status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_status, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_type, <span class="hljs-string"><span class="hljs-string">'published_at'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_date, <span class="hljs-string"><span class="hljs-string">'updated_at'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_modified, ]; } }</code> </pre><br>  Und die Steuerung selbst mit einer einzigen Aktion: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Resources</span></span>\<span class="hljs-title"><span class="hljs-title">Post</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">PostResource</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Post</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Http\Resources\Json\AnonymousResourceCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $posts = Post::limit(<span class="hljs-number"><span class="hljs-number">10</span></span>)-&gt;get(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PostResource::collection($posts); } }</code> </pre><br>  Die Standardfilterung ist nach folgendem Code organisiert: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Http\Resources\Json\AnonymousResourceCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function"> </span></span>{ $query = Post::limit(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;filled(<span class="hljs-string"><span class="hljs-string">'status'</span></span>)) { $query-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_status'</span></span>, $request-&gt;get(<span class="hljs-string"><span class="hljs-string">'status'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;filled(<span class="hljs-string"><span class="hljs-string">'title'</span></span>)) { $title = $request-&gt;get(<span class="hljs-string"><span class="hljs-string">'title'</span></span>); $query-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_title'</span></span>, <span class="hljs-string"><span class="hljs-string">'like'</span></span>, <span class="hljs-string"><span class="hljs-string">"%$title%"</span></span>); } $posts = $query-&gt;get(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PostResource::collection($posts); }</code> </pre><br>  Bei diesem Ansatz sehen wir uns mit dem unerwünschten Wachstum des Controllers konfrontiert. <br><br><h4>  Implementieren von QueryFilter </h4><br>  Die Bedeutung eines solchen Konzepts besteht darin, für jede Entität eine eigene Klasse zu verwenden, die jedem Feld Methoden zum Filtern zuordnet. <br><br>  Auf Anfrage filtern: <br><br><pre> <code class="php hljs">GET /posts?title=source&amp;status=publish</code> </pre> <br>  Zum Filtern stehen die <i>PostFilter-</i> Klasse sowie die Methoden <i>title ()</i> und <i>status ()</i> zur Verfügung.  <i>PostFilter</i> erweitert die abstrakte Klasse <i>QueryFiler,</i> die für den Abgleich von Klassenmethoden mit übergebenen Parametern verantwortlich ist. <br><br>  <b>Methode <i>anwenden ()</i></b> <br><br>  Die <i>QueryFIlter-</i> Klasse verfügt über eine <i>apply ()</i> -Methode, die für das <i>Aufrufen von</i> Filtern verantwortlich ist, die sich in der <i>PostFilter-Kindklasse befinden</i> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Builder</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Request */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $request; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Builder */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $builder; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request = $request; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Builder $builder */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $builder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder = $builder; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;fields() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $field =&gt; $value) { $method = camel_case($field); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $method)) { call_user_func_array([<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $method], (<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>)$value); } } } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_filter( array_map(<span class="hljs-string"><span class="hljs-string">'trim'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;all()) ); } }</code> </pre><br>  Im Endeffekt haben wir für jedes Feld, das über <i>Request übergeben wird</i> , eine separate Methode in der untergeordneten Filterklasse (PostFilter-Klasse).  Auf diese Weise können wir die Logik für jedes Filterfeld anpassen. <br><br>  <b><i>PostFilter-</i> Klasse</b> <br><br>  Nun wollen wir eine <i>PostFilter-</i> Klasse <i>erstellen,</i> die <i>QueryFilter erweitert</i> .  Wie bereits erwähnt, muss diese Klasse Methoden für jedes Feld enthalten, nach denen gefiltert werden muss.  In unserem Fall die Methoden <i>title ($ value)</i> und <i>status ($ value)</i> <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Builder</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostFilter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $status */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">status</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $status)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_status'</span></span>, strtolower($status)); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $title */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $title)</span></span></span><span class="hljs-function"> </span></span>{ $words = array_filter(explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>, $title)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $query)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($words)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($words <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $word) { $query-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_title'</span></span>, <span class="hljs-string"><span class="hljs-string">'like'</span></span>, <span class="hljs-string"><span class="hljs-string">"%$word%"</span></span>); } }); } }</code> </pre><br>  Hier sehe ich keinen Grund für eine detaillierte Analyse der einzelnen Methoden, ganz normale Abfragen.  Der Punkt ist, dass wir jetzt für jedes Feld eine separate Methode haben und jede Logik verwenden können, die wir zum Bilden der Anfrage benötigen. <br><br>  <b><i>ScopeFilter ()</i> erstellen</b> <br><br>  Jetzt müssen wir den Modell- und Abfrage-Designer binden <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Builder $builder * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> QueryFilter $filter */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scopeFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $builder, QueryFilter $filter)</span></span></span><span class="hljs-function"> </span></span>{ $filter-&gt;apply($builder); }</code> </pre><br>  Um zu suchen, müssen wir die <i>filter ()</i> -Methode aufrufen und eine Instanz von <i>QueryFilter übergeben</i> , in unserem Fall <i>PostFilter</i> . <br><br><pre> <code class="php hljs">$filteredPosts = Post::filter($postFilter)-&gt;get();</code> </pre> <br>  Daher wird die gesamte <i>Filterlogik</i> durch Aufrufen der <i>Filtermethode ($ postFilter) verarbeitet</i> , wodurch der Controller vor unnötiger Logik <i>geschützt wird</i> . <br><br>  Um die Wiederverwendung zu vereinfachen, können Sie die <i>scopeFilter-</i> Methode in das Merkmal <i>einfügen</i> und für jedes Modell verwenden, das gefiltert werden muss. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Builder</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Filterable { <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Builder $builder * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> QueryFilter $filter */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scopeFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $builder, QueryFilter $filter)</span></span></span><span class="hljs-function"> </span></span>{ $filter-&gt;apply($builder); } }</code> </pre><br>  In <i>Post</i> hinzufügen: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CorcelPost</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Filterable</span></span>;</code> </pre><br>  Es bleibt übrig, der Controller-Methode <i>index ()</i> als <i>PostFilter-</i> Parameter <i>hinzuzufügen</i> und die <i>Modellmethode</i> <i>filter ()</i> aufzurufen. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> PostFilter $filter * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Http\Resources\Json\ResourceCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PostFilter $filter)</span></span></span><span class="hljs-function"> </span></span>{ $posts = Post::filter($filter)-&gt;limit(<span class="hljs-number"><span class="hljs-number">10</span></span>)-&gt;get(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PostResource::collection($posts); } }</code> </pre><br>  Das ist alles.  Wir haben die gesamte Filterlogik in die entsprechende Klasse verschoben und dabei das Prinzip der Einzelverantwortung beachtet (S im SOLID-Prinzipensystem). <br><br><h2>  Fazit </h2><br>  Dieser Ansatz zur Implementierung von Filtern ermöglicht es Ihnen, sich an den Trailer Thin Controller zu halten, und erleichtert auch das Schreiben von Tests. <br><br>  Hier ist ein Beispiel mit PHP und Laravel.  Aber wie gesagt, das ist ein Konzept und kann mit jeder Sprache oder jedem Framework funktionieren. <br><br><h4>  Referenzen </h4><br><ul><li>  Junior Grossi <a href="https://blog.jgrossi.com/">Blog</a> </li><li>  <a href="https://packagist.org/packages/kblais/query-filter">Fertiges Paket</a> von Killian Blais </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485520/">https://habr.com/ru/post/de485520/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485504/index.html">Indem wir die Gesichtserkennung verbieten, verpassen wir den Punkt</a></li>
<li><a href="../de485508/index.html">Auf dem Weg zu einem funktionsfähigen DBMS und NoSQL ERP: Salden- und Kalkulationsspeicher</a></li>
<li><a href="../de485510/index.html">So starten Sie ein Produkt alleine, wenn Sie Entwickler sind: Tipps von Taylor Otvel, dem Schöpfer von Laravel. Teil 3: Gib nicht auf</a></li>
<li><a href="../de485514/index.html">EBlink - GDB Server für ARM Cortex-M Mikrocontroller</a></li>
<li><a href="../de485518/index.html">Der Versuch, das Nicht-Komponierbare zu komponieren: Erhebe alles</a></li>
<li><a href="../de485522/index.html">Hack The Box - Walkthrough AI. SQLi in API Text To Sreach, SSH-Weiterleitung und RCE in JDWP</a></li>
<li><a href="../de485524/index.html">Die Zusammenstellung interessanter Materialien für den mobilen Entwickler # 330 (20. - 26. Januar)</a></li>
<li><a href="../de485526/index.html">Wer und warum will das Internet "geteilt" machen</a></li>
<li><a href="../de485528/index.html">So schließen Sie ein Softwareentwicklungsprojekt richtig ab</a></li>
<li><a href="../de485530/index.html">Geführtes Lernen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>