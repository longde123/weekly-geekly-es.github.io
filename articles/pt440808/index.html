<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∫ ‚ñ´Ô∏è üë©üèΩ‚Äçüåæ TDE no Apache Ignite: uma importante hist√≥ria em um grande projeto de c√≥digo aberto ‚ôéÔ∏è üëéüèª üêé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitas organiza√ß√µes, especialmente as financeiras, precisam lidar com v√°rios padr√µes de seguran√ßa - por exemplo, o PCI DSS. Tais certifica√ß√µes requere...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TDE no Apache Ignite: uma importante hist√≥ria em um grande projeto de c√≥digo aberto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440808/">  Muitas organiza√ß√µes, especialmente as financeiras, precisam lidar com v√°rios padr√µes de seguran√ßa - por exemplo, o PCI DSS.  Tais certifica√ß√µes requerem criptografia de dados.  Criptografia de dados transparente no disco A Criptografia de dados transparente √© implementada em muitos DBMSs industriais. <br><br>  O Apache Ignite √© usado em bancos, portanto, foi decidido implementar o TDE nele. <br><br>  Descreverei como desenvolvemos a TDE atrav√©s da comunidade, publicamente, atrav√©s dos processos Apachev. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/BOJ-0N8VnDw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Abaixo est√° uma vers√£o em texto do relat√≥rio: <br><br>  Vou tentar falar sobre arquitetura, sobre a complexidade do desenvolvimento, como ele realmente se parece em c√≥digo aberto. <br><br><h3>  O que foi feito e o que resta a ser feito? </h3><br>  Atualmente implementado Apache Ignite TDE.  Fase 1. <br><br>  Inclui os recursos b√°sicos do trabalho com caches criptografados: <br><br><ul><li> Gerenciamento de chaves </li><li>  Criando caches criptografados </li><li>  Salvando todos os dados do cache em disco no formato criptografado </li></ul><br>  Na Fase 2, est√° planejado permitir a possibilidade de rota√ß√£o (altera√ß√£o) da chave mestra. <br>  Na fase 3, a capacidade de girar chaves de cache. <br><br><h3>  Terminologia </h3><br><ul><li>  Criptografia de dados transparente - criptografia de dados transparente (para o usu√°rio) ao salvar em disco.  No caso de Ignite, criptografia de cache, porque Ignite √© sobre caches. </li><li>  Ignite cache - cache de valor-chave no Apache Ignite.  Os dados do cache podem ser salvos no disco </li><li>  P√°ginas - p√°ginas de dados.  No Ignite, todos os dados s√£o paginados.  As p√°ginas s√£o gravadas no disco e devem ser criptografadas. </li><li>  WAL - escreve o log antecipado.  Todas as altera√ß√µes de dados no Ignite s√£o salvas l√°, todas as a√ß√µes que realizamos para todos os caches. </li><li>  Keystore - keystore java padr√£o, que √© gerado pelo keytool Javascript.  Ele funciona e √© certificado em todos os lugares, n√≥s o usamos. </li><li>  Chave mestra - chave mestra.  Utilizando-o, as chaves das tabelas s√£o criptografadas, as chaves de criptografia de cache.  Armazenado no keystore java. </li><li>  Chaves de cache - chaves com as quais os dados s√£o realmente criptografados.  Juntamente com a chave mestra, √© obtida uma estrutura de dois n√≠veis.  A chave mestra √© armazenada separadamente do cache e dos dados mestres - por motivos de seguran√ßa, separa√ß√£o de direitos de acesso, etc. </li></ul><br><h3>  Arquitetura </h3><br>  Tudo √© implementado de acordo com o seguinte esquema: <br><br><ul><li>  Todos os dados do cache s√£o criptografados usando o novo SPI de criptografia. </li><li>  Por padr√£o, o AES √© usado - um algoritmo de criptografia industrial. </li><li>  A chave mestra √© armazenada em um arquivo JKS - um arquivo java padr√£o para chaves. </li></ul><br>  Bancos e outras organiza√ß√µes usam seus pr√≥prios algoritmos de criptografia: GOST e outros.  √â claro que demos a oportunidade de reduzir nosso SPI de criptografia - a implementa√ß√£o de criptografia de que um usu√°rio espec√≠fico precisa. <br><br><h3>  Esquema de trabalho </h3><br><img src="https://habrastorage.org/webt/fr/mv/4v/frmv4vrfmccufua78ppdj4ikj1s.png" alt="imagem"><br><br>  Portanto, temos RAM - mem√≥ria de acesso aleat√≥rio com p√°ginas contendo dados puros.  Usar RAM implica que n√£o estamos protegidos contra um hacker que obteve acesso root e despejou toda a mem√≥ria.  N√≥s nos protegemos do administrador que pega o disco r√≠gido e o vende no mercado Tushino (ou onde dados semelhantes est√£o sendo vendidos no momento). <br><br>  Al√©m das p√°ginas com um cache, os dados tamb√©m s√£o armazenados no log de grava√ß√£o antecipada, que grava no disco o delta dos registros alterados na transa√ß√£o.  O metastore armazena chaves de criptografia de cache.  E em um arquivo separado - uma chave mestra. <br><br>  Sempre que uma chave para o cache √© criada, antes de gravar ou transferir para a rede, criptografamos essa chave usando uma chave mestra.  Para que ningu√©m possa obter a chave de cache ap√≥s receber dados do Ignite.  Somente roubando a chave mestra e os dados voc√™ pode acess√°-los.  Isso √© improv√°vel, pois o acesso a esses arquivos requer v√°rios direitos. <br><br>  O algoritmo de a√ß√µes √© o seguinte: <br><br><ul><li>  No in√≠cio do n√≥, subtraia a chave mestra de jks. </li><li>  No in√≠cio dos n√≥s, leia o meta store e descriptografe as chaves de cache. </li><li>  Quando associar n√≥s em um cluster: <br>  - verifique os hashes da chave mestra. <br>  - verifique as chaves para caches compartilhados. <br>  - salve as chaves para novos caches. <br></li><li>  Ao criar um cache dinamicamente, geramos uma chave e a salvamos na meta-loja. </li><li>  Ao ler / escrever uma p√°gina, n√≥s a descriptografamos / criptografamos. </li><li>  Cada entrada WAL para o cache criptografado tamb√©m √© criptografada. </li></ul><br>  Agora com mais detalhes: <br><br>  No in√≠cio do n√≥, temos um retorno de chamada que inicia nosso EncryptionSPI.  De acordo com os par√¢metros, subtra√≠mos a chave mestra do arquivo jks. <br><br>  Em seguida, quando o metastore estiver pronto, obteremos as chaves de criptografia armazenadas.  Nesse caso, j√° temos uma chave mestra, para que possamos descriptografar as chaves e obter acesso aos dados do cache. <br><br>  Separadamente, h√° um processo muito interessante - como unimos um novo n√≥ a um cluster.  J√° temos um sistema distribu√≠do que consiste em v√°rios n√≥s.  Como garantir que o novo n√≥ esteja configurado corretamente e que n√£o seja um invasor? <br><br>  Realizamos estas a√ß√µes: <br><br><ul><li>  Quando um novo n√≥ chega, ele envia um hash da chave mestra.  Parece que ele corresponde ao existente. </li><li>  Em seguida, verificamos as chaves para caches compartilhados.  Do n√≥, vem o identificador de cache e a chave de cache criptografada.  N√≥s os verificamos para garantir que todos os dados em todos os n√≥s sejam criptografados com a mesma chave.  Se n√£o for assim, simplesmente n√£o temos o direito de permitir que o n√≥ entre no cluster, caso contr√°rio, ele trafegar√° por chaves e dados. </li><li>  Se houver novas chaves e caches no novo n√≥, salve-os para uso futuro. </li><li>  Ao criar um cache dinamicamente, uma fun√ß√£o de gera√ß√£o de chave √© fornecida.  N√≥s o geramos, salvamos na meta store e podemos continuar executando as opera√ß√µes descritas. </li></ul><br>  A segunda parte √© uma superestrutura sobre as opera√ß√µes de E / S.  As p√°ginas s√£o gravadas no arquivo de parti√ß√£o.  Nosso suplemento analisa o cache da p√°gina, criptografa-os de acordo e os salva. <br><br>  O mesmo vale para o WAL.  H√° um serializador que serializa objetos de registro WAL.  E se o registro for para caches criptografados, devemos criptograf√°-lo e somente salv√°-lo em disco. <br><br><h3>  Dificuldades de desenvolvimento </h3><br>  Dificuldades comuns a todos os projetos de c√≥digo aberto mais ou menos complexos: <br><br><ol><li>  Primeiro, voc√™ precisa entender completamente o dispositivo Ignite.  Por que, o que e como foi feito l√°, como e em que lugares para anexar seus manipuladores. </li><li>  √â necess√°rio fornecer compatibilidade com vers√µes anteriores.  Isso pode ser bastante dif√≠cil, n√£o √≥bvio.  Ao desenvolver um produto usado por outras pessoas, √© necess√°rio considerar que os usu√°rios desejam ser atualizados sem problemas.  A compatibilidade com vers√µes anteriores √© correta e boa.  Quando voc√™ faz uma melhoria t√£o grande como a TDE, altera as regras para salvar em disco e criptografa alguma coisa.  E a compatibilidade com vers√µes anteriores deve ser trabalhada. </li><li>  Outro ponto n√£o √≥bvio est√° relacionado √† distribui√ß√£o do nosso sistema.  Quando clientes diferentes tentam criar o mesmo cache, voc√™ precisa concordar com a chave de criptografia, porque, por padr√£o, ser√£o gerados dois diferentes.  N√≥s resolvemos esse problema.  N√£o vou me aprofundar em mais detalhes - a solu√ß√£o merece um post separado.  Agora temos a garantia de usar uma chave. </li><li>  A pr√≥xima coisa importante levou a grandes melhorias, quando parecia que tudo estava pronto (uma hist√≥ria familiar?) :).  A criptografia possui sobrecarga.  Temos um vetor init - zero dados aleat√≥rios que s√£o usados ‚Äã‚Äãno algoritmo AES.  Eles s√£o armazenados de forma aberta e, com a ajuda deles, aumentamos a entropia: os mesmos dados ser√£o criptografados de maneira diferente em diferentes sess√µes de criptografia.  Grosso modo, mesmo se tivermos dois Ivan Petrovs com o mesmo sobrenome, cada vez que criptografamos, receberemos dados criptografados diferentes.  Isso reduz a chance de hackers. <br><br>  A criptografia ocorre em blocos de 16 bytes e, se os dados n√£o estiverem alinhados por 16 bytes, adicionamos informa√ß√µes de preenchimento - a quantidade de dados que realmente criptografamos.  Em um disco, voc√™ precisa escrever uma p√°gina com m√∫ltiplos de 2 Kb.  Estes s√£o os requisitos de desempenho: devemos usar o buffer de disco.  Se n√£o escrevermos 2 Kb (n√£o 4 ou 8, dependendo do buffer do disco), obteremos imediatamente um grande desempenho de queda. <br><br>  Como resolvemos o problema?  Eu tive que rastrear o PageIO, na RAM, e cortar 16 bytes de cada p√°gina, que seriam criptografados quando gravados no disco.  Nestes 16 bytes, escrevemos o vetor init. <br></li><li>  Outra dificuldade √© n√£o quebrar nada.  Isso √© comum quando voc√™ vem e faz algumas altera√ß√µes.  Na realidade, n√£o √© t√£o simples quanto parece. <br></li><li>  No MVP, foram produzidas 6 mil linhas.  √â dif√≠cil revisar, e poucas pessoas querem fazer isso, principalmente de especialistas que j√° n√£o t√™m tempo.  Temos v√°rias partes - API p√∫blica, parte principal, gerenciadores de SPI, armazenamento persistente de p√°ginas, gerenciadores de WAL.  Altera√ß√µes em v√°rios subsistemas exigem que elas sejam revisadas por pessoas diferentes.  E isso tamb√©m imp√µe dificuldades adicionais.  Especialmente quando voc√™ trabalha em uma comunidade onde todas as pessoas est√£o ocupadas com suas tarefas.  No entanto, tudo deu certo para n√≥s. <br></li></ol><br><h3>  O que acontecer√° no TDE.Fase 2 e 3 </h3><br>  A fase 1. agora est√° implementada.Voc√™, como desenvolvedor, pode ajudar na fase 2. Os desafios futuros s√£o interessantes.  O PCI DSS, como outros padr√µes, requer recursos adicionais do sistema de criptografia.  Nosso sistema deve poder alterar a chave mestra.  Por exemplo, se ele foi comprometido ou a hora acabou de chegar de acordo com a pol√≠tica de seguran√ßa.  Agora o Ignite n√£o sabe como.  Mas em vers√µes futuras, ensinaremos a TDE a alterar a chave mestra. <br><br>  A mesma coisa com a capacidade de alterar a chave de cache sem parar o cluster e trabalhar com dados.  Se o cache tiver vida longa e, ao mesmo tempo, armazenar alguns dados - financeiros, m√©dicos - o Ignite poder√° alterar a chave de criptografia do cache e criptografar tudo rapidamente.  Vamos resolver esse problema na terceira fase. <br><br><h3>  Total: como implementar um grande recurso em um projeto de c√≥digo aberto? </h3><br>  Para resumir.  Eles ser√£o relevantes para qualquer fonte aberta.  Eu participei do Kafka e de outros projetos - em todos os lugares a hist√≥ria √© a mesma. <br><br><ol><li>  Comece com pequenas tarefas.  Nunca tente resolver um grande problema imediatamente.  √â necess√°rio entender o que est√° acontecendo, como est√° acontecendo, como est√° sendo realizado.  Quem o ajudar√°.  E em geral - de que lado abordar este projeto. </li><li>  Entenda o projeto.  Normalmente, todos os desenvolvedores - pelo menos eu - v√™m e dizem: tudo precisa ser reescrito.  Tudo estava ruim diante de mim, e agora vou reescrev√™-lo - e tudo ficar√° bem.  √â aconselh√°vel adiar essas declara√ß√µes, descobrir o que exatamente √© ruim e se precisa ser alterado. </li><li>  Discuta se s√£o necess√°rias melhorias.  Eu tive casos em que cheguei √†s v√°rias comunidades com experi√™ncia, por exemplo, no Spark.  Ele me disse, mas a comunidade n√£o estava interessada por algum motivo.  De qualquer forma, isso acontece.  Voc√™ precisa dessa revis√£o, mas a comunidade diz: n√£o, n√£o estamos interessados, n√£o vamos nos fundir e ajudar. </li><li>  Fa√ßa um design.  Existem projetos de c√≥digo aberto nos quais isso √© obrigat√≥rio.  Voc√™ n√£o pode come√ßar a codificar sem um design acordado pelo comit√™ e por pessoas experientes.  No Ignite, isso n√£o √© formalmente verdade, mas, em geral, √© uma parte importante do desenvolvimento.  √â necess√°rio fazer uma descri√ß√£o em ingl√™s ou russo competente, dependendo do projeto.  Para que o texto possa ser lido e ficou claro o que exatamente voc√™ far√°. </li><li>  Discuta a API p√∫blica.  O principal argumento: se houver uma API p√∫blica bonita e compreens√≠vel que seja f√°cil de usar, o design estar√° correto.  Essas coisas geralmente s√£o adjacentes uma √† outra. </li></ol><br>  Outras dicas mais √≥bvias que n√£o s√£o t√£o f√°ceis de seguir: <br><br><ul><li>  Implemente o recurso sem quebrar nada.  Fa√ßa os testes. </li><li>  Pe√ßa e aguarde (isso √© mais dif√≠cil) uma revis√£o dos profissionais certos, dos membros certos da comunidade. </li><li>  Fa√ßa benchmarks, descubra se voc√™ tem uma queda no desempenho.  Isso √© especialmente importante ao finalizar alguns subsistemas cr√≠ticos. </li><li>  Aguarde a mesclagem, fa√ßa alguns exemplos e documenta√ß√£o. </li></ul><br>  Obrigado pela leitura! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440808/">https://habr.com/ru/post/pt440808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440796/index.html">Confer√™ncia DEFCON 19. Tr√™s gera√ß√µes de ataques de nega√ß√£o de servi√ßo (envolvendo o p√∫blico como v√≠timas). Parte 2</a></li>
<li><a href="../pt440800/index.html">Lan√ßamento do Kali Linux 2019.1</a></li>
<li><a href="../pt440802/index.html">WearMouse, um mouse a√©reo para rel√≥gios Wear OS</a></li>
<li><a href="../pt440804/index.html">Op√ß√£o de clonagem de banco de dados para desenvolvimento / teste</a></li>
<li><a href="../pt440806/index.html">Dark Mobile no CodeFest: Swift funcional, equ√≠vocos Arquitetura limpa e #ClaroZheKotlin</a></li>
<li><a href="../pt440810/index.html">Talos - ‚ÄúUma distribui√ß√£o moderna de Linux para Kubernetes‚Äù introduzida</a></li>
<li><a href="../pt440814/index.html">LPWAN Soberana, Parte 1: Licenciamento e Opera√ß√£o de Redes LPWAN na R√∫ssia - Antigos Requisitos do Novo Estado</a></li>
<li><a href="../pt440816/index.html">Desenvolvimento de Git e equipe (para manequins)</a></li>
<li><a href="../pt440818/index.html">Realizamos uma auditoria de erros</a></li>
<li><a href="../pt440820/index.html">Controle e controle novamente: mudan√ßa na dire√ß√£o magn√©tica devido √† tens√£o em Fe / BaTiO3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>