<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôäÔ∏è üôÖ üë©üèø‚Äç‚úàÔ∏è R√©duisez les sauvegardes de 99,5% avec le hachage üêà üë®üèª‚Äç‚úàÔ∏è üë©üèø‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="hashget est un d√©duplicateur gratuit bas√© sur l'op√©ra - un utilitaire de type archiveur qui peut r√©duire consid√©rablement la taille des sauvegardes, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©duisez les sauvegardes de 99,5% avec le hachage</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454826/"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hashget</a> est un <em>d√©duplicateur</em> gratuit bas√© sur l'op√©ra - un utilitaire de type archiveur qui peut r√©duire consid√©rablement la taille des sauvegardes, ainsi qu'organiser des sch√©mas de sauvegarde incr√©mentiels et diff√©rentiels et plus encore. </p><br><p>  Il s'agit d'un article de revue pour d√©crire les fonctionnalit√©s.  L'utilisation de hashget lui-m√™me (assez simple) est d√©crite dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">README</a> et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation wiki</a> du projet. </p><br><h1 id="sravnenie">  Comparaison </h1><br><p>  Selon la loi du genre, je vais commencer tout de suite par l'intrigue - comparer les r√©sultats: </p><br><div class="scrollable-table"><table><thead><tr><th>  √âchantillon de donn√©es </th><th>  taille d√©ball√©e </th><th>  .tar.gz </th><th>  hashget .tar.gz </th></tr></thead><tbody><tr><td>  Wordpress-5.1.1 </td><td>  43 Mo </td><td>  11 Mo (26%) </td><td>  155 Ko ( <strong>0,3%</strong> ) </td></tr><tr><td>  Noyau Linux 5.0.4 </td><td>  934 Mo </td><td>  161 Mo (20%) </td><td>  4,7 Mo ( <strong>0,5%</strong> ) </td></tr><tr><td>  Debian 9 (LAMP) LXC VM </td><td>  724 Mo </td><td>  165 Mo (23%) </td><td>  4,1 Mo ( <strong>0,5%</strong> ) </td></tr></tbody></table></div><br><h1 id="predystoriya-kakim-dolzhen-byt-idealnyy-i-effektivnyy-bekap">  Contexte de ce que devrait √™tre une sauvegarde id√©ale et efficace </h1><br><p>  Chaque fois que je faisais une sauvegarde d'une machine virtuelle fra√Æchement cr√©√©e, j'√©tais hant√©e par le sentiment que je faisais quelque chose de mal.  Pourquoi est-ce que j'obtiens une sauvegarde lourde d'un syst√®me o√π ma cr√©ativit√© inestimable inestimable est un index.html sur une seule ligne avec le texte "Hello world"? </p><a name="habracut"></a><br><p>  Pourquoi y a-t-il 16 m√©gaoctets / usr / sbin / mysqld dans ma sauvegarde?  Est-ce vraiment dans ce monde que j'ai l'honneur de stocker cet important fichier, et si je ne peux pas le faire, il sera perdu pour l'humanit√©?  Probablement pas.  Il est stock√© sur des serveurs Debian tr√®s fiables (dont la fiabilit√© et la continuit√© ne peuvent √™tre compar√©es √† ce que je peux fournir), ainsi que dans des copies de sauvegarde (des millions d'entre eux) d'autres administrateurs.  Avons-nous vraiment besoin de cr√©er 10 000 000 + 1√®re copie de ce fichier important pour augmenter la fiabilit√©? </p><br><p> En g√©n√©ral, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hashget</a> r√©sout ce probl√®me.  Lors de l'emballage - il cr√©e une tr√®s petite sauvegarde.  Lors du d√©ballage - un syst√®me compl√®tement d√©ball√©, similaire √† celui qui serait avec <code>tar -c</code> / <code>tar -x</code> .  (En d'autres termes, il s'agit d'un emballage sans perte) </p><br><h1 id="kak-rabotaet-hashget">  Comment fonctionne le hashget </h1><br><p>  Hashget a les concepts de Package et HashPackage, avec leur aide, il effectue la d√©duplication. </p><br><p>  <em>Paquet</em>  Un fichier (g√©n√©ralement une archive .deb ou .tar.gz) qui peut √™tre t√©l√©charg√© de mani√®re fiable √† partir du r√©seau et √† partir duquel un ou plusieurs fichiers peuvent √™tre obtenus. </p><br><p>  <em>HashPackage</em> est un petit fichier JSON repr√©sentant le package, y compris l'URL du package et la somme de hachage (sha256) des fichiers qu'il contient.  Par exemple, pour le paquet mariadb-server-core de 5 m√©gaoctets, la taille du hachage n'est que de 6 kilo-octets.  Un millier de fois plus petit. </p><br><p>  <em>D√©duplication</em> - cr√©ation d'une archive sans fichiers en double (si le d√©doublonneur sait o√π le package d'origine peut √™tre t√©l√©charg√©, il r√©duit les doublons de l'archive). </p><br><h2 id="zapakovka">  Emballage </h2><br><p>  Lors de l'emballage, tous les fichiers du r√©pertoire compress√© sont affich√©s, leurs sommes de hachage sont prises en compte et si la somme est trouv√©e dans l'un des HashPackages connus, les m√©tadonn√©es du fichier (nom, hachage, autorisations, etc.) sont enregistr√©es dans un fichier sp√©cial .hashget-restore.json, qui sera √©galement inclus dans l'archive. </p><br><p>  L'emballage lui-m√™me dans le cas le plus simple ne semble pas plus compliqu√© que le goudron: </p><br><pre> <code class="plaintext hljs">hashget -zf /tmp/mybackup.tar.gz --pack /path/to/data</code> </pre> <br><h2 id="raspakovka">  D√©ballage </h2><br><p>  Le d√©ballage se fait en deux √©tapes.  Tout d'abord, le d√©ballage habituel du goudron: </p><br><pre> <code class="plaintext hljs">tar -xf mybackup.tar.gz -C /path/to/data</code> </pre> <br><p>  puis restaurez √† partir du r√©seau: </p><br><pre> <code class="plaintext hljs">hashget -u /path/to/data</code> </pre> <br><p>  Lors de la r√©cup√©ration, hashget lit le fichier .hashget-restore.json, t√©l√©charge les packages n√©cessaires, les d√©compresse et extrait les fichiers n√©cessaires, en les d√©finissant dans les bons chemins, avec le propri√©taire / groupe / autorisations n√©cessaires. </p><br><h1 id="bolee-slozhnye-veschi">  Des choses plus compliqu√©es </h1><br><p>  Ce qui est d√©crit ci-dessus est d√©j√† suffisant pour ceux qui "veulent du tar, mais pour emballer ma Debian dans 4 m√©gaoctets".  De plus, nous examinerons des choses plus difficiles. </p><br><h2 id="indeksirovanie">  Indexation </h2><br><p>  Si un hashget n'avait pas du tout de HashPackage, il ne pourrait tout simplement pas d√©dupliquer quoi que ce soit. </p><br><p>  Vous pouvez √©galement cr√©er un HashPackage manuellement (simplement: <code>hashget --submit https://wordpress.org/wordpress-5.1.1.zip -p my</code> ), mais il existe un moyen plus pratique. </p><br><p>  Afin d'obtenir le hashpackage dont vous avez besoin, il y a une √©tape d' <em>indexation</em> (elle est automatiquement effectu√©e lorsque la commande <code>--pack</code> est <code>--pack</code> ) et une <em>heuristique</em> .  Lors de l'indexation, le hachage "alimente" chaque fichier trouv√© vers toutes les heuristiques existantes qui l'int√©ressent.  L'heuristique peut ensuite indexer n'importe quel package pour cr√©er un HashPackage. </p><br><p>  Par exemple, une heuristique Debian aime le fichier / var / lib / dpkg / status et d√©tecte les paquets Debian install√©s, et s'ils ne sont pas index√©s (HashPackage n'a pas √©t√© cr√©√© pour eux), les t√©l√©charge et les indexe.  Le r√©sultat est un effet tr√®s agr√©able - hashget d√©dupliquera toujours efficacement les OS Debian, m√™me s'ils ont les derniers paquets. </p><br><h2 id="fayly-podskazki-hinty">  Fichiers d'indices </h2><br><p>  Si votre r√©seau utilise une sorte de package propri√©taire ou un package public qui n'est pas inclus dans l'heuristique de hachage, vous pouvez lui ajouter un fichier de conseil simple hashget-hint.json comme suit: </p><br><pre> <code class="plaintext hljs">{ "project": "wordpress.org", "url": "https://ru.wordpress.org/wordpress-5.1.1-ru_RU.zip" }</code> </pre> <br><p>  De plus, chaque fois que l'archive est cr√©√©e, le package sera index√© (si ce n'est pr√©c√©demment) et les fichiers du package seront d√©dupliqu√©s √† partir de l'archive.  Aucune programmation n'est n√©cessaire, tout peut √™tre fait √† partir de vim et enregistr√© dans chaque sauvegarde.  Notez que gr√¢ce √† l'approche via des hachages, si certains fichiers du package sont modifi√©s localement (par exemple, le fichier de configuration est modifi√©), les fichiers modifi√©s seront enregistr√©s dans l'archive ¬´tels quels¬ª et ne seront pas r√©duits. </p><br><p>  Si certains de vos propres packages sont mis √† jour p√©riodiquement, mais que les modifications ne sont pas tr√®s importantes, vous ne pouvez sugg√©rer que des versions majeures.  Par exemple, dans la version 1.0, ils ont fait un indice indiquant mypackage-1.0.tar.gz, et il sera compl√®tement d√©dupliqu√©, puis ils ont publi√© la version 1.1, qui est l√©g√®rement diff√©rente, mais ils n'ont pas mis √† jour l'indice.  Rien √† craindre.  Seuls les fichiers qui correspondent (qui peuvent √™tre restaur√©s) √† la version 1.0 sont d√©dupliqu√©s. </p><br><p>  Une heuristique qui traite un fichier d'indices est un bon exemple pour comprendre le m√©canisme interne de l'heuristique.  Il ne traite que les fichiers hashget-hint.json (ou .hashget-hint.json avec un point) et ignore tout le monde.  √Ä l'aide de ce fichier, il d√©termine quelle URL de package doit √™tre index√©e et hashget l'indexe (si cela n'a pas √©t√© fait auparavant) </p><br><h2 id="hashserver">  Hashver </h2><br><p>  Il serait assez long de r√©aliser une indexation compl√®te lors de la cr√©ation de sauvegardes.  Pour ce faire, vous devez t√©l√©charger chaque package, d√©compresser, indexer.  Par cons√©quent, hashget utilise un sch√©ma avec un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HashServer</a> .  Si un paquet Debian est install√©, s'il ne se trouve pas dans le HashPackage local, une tentative est d'abord faite pour simplement t√©l√©charger le HashPackage depuis le serveur de hachage.  Et seulement si cela ne fonctionne pas - hashget lui-m√™me t√©l√©charge et hache le paquet (et le t√©l√©charge sur hashserver, afin que hashserver le fournisse plus tard). </p><br><p>  HashServer - un √©l√©ment facultatif du sch√©ma, non critique, est utilis√© exclusivement pour acc√©l√©rer et r√©duire la charge sur les r√©f√©rentiels.  Il est facilement d√©connect√© (avec l'option <code>--hashserver</code> sans param√®tres).  De plus, vous pouvez facilement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©er votre propre serveur de hachage</a> . </p><br><h2 id="inkrementalnye-i-differencialnye-bekapy-zaplanirovannoe-ustarevanie">  Sauvegardes incr√©mentielles et diff√©rentielles, obsolescence planifi√©e </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hashget</a> rend tr√®s simple la r√©alisation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sauvegardes incr√©mentielles et diff√©rentielles</a> .  Pourquoi ne pas indexer notre sauvegarde elle-m√™me (avec tous nos fichiers uniques)?  Une √©quipe - <code>--submit</code> et vous avez termin√©!  La prochaine sauvegarde cr√©√©e par hashget n'inclura pas les fichiers de cette archive. </p><br><p>  Mais ce n'est pas une tr√®s bonne approche, car il peut s'av√©rer que lors de la r√©cup√©ration, nous devrons r√©cup√©rer toutes les sauvegardes de hachage pour tout l'historique (si chacun a au moins un fichier unique).  Pour cela, il existe un m√©canisme d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">obsolescence de sauvegarde planifi√©e</a> .  Lors de l'indexation, vous pouvez sp√©cifier la date d'expiration de HashPackage - <code>--expires 2019-06-01</code> , et √† cette date (√† partir de 00:00), elle ne sera pas utilis√©e.  L'archive elle-m√™me ne peut pas √™tre supprim√©e apr√®s cette date (bien que hashget puisse facilement afficher les URL de toutes les sauvegardes que nous avons pourries / pourries en ce moment ou √† n'importe quelle date). </p><br><p>  Par exemple, si vous effectuez une sauvegarde compl√®te le 1er jour et l'indexez avec une dur√©e de vie avant la fin du mois, nous obtiendrons un sch√©ma de sauvegarde diff√©rentielle. </p><br><p>  Si nous indexons √©galement de nouvelles sauvegardes, il y aura un sch√©ma de sauvegardes incr√©mentielles. </p><br><p>  Contrairement aux sch√©mas traditionnels, hashget vous permet d'utiliser plusieurs sources de base.  La sauvegarde sera r√©duite en raison de la r√©duction des fichiers des sauvegardes pr√©c√©dentes (le cas √©ch√©ant) et des fichiers publics (ce qui peut √™tre t√©l√©charg√©). </p><br><p>  Si, pour une raison quelconque, nous ne faisons pas confiance √† la fiabilit√© des ressources Debian ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://snapshot.debian.org/</a> ) ou si nous utilisons une autre distribution, nous pouvons simplement effectuer une sauvegarde compl√®te avec tous les paquets une fois, puis nous y fier d√©j√† ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©sactiver l'heuristique</a> )  Maintenant, si tous les serveurs de nos distributions se r√©v√®lent inaccessibles pour nous (dans Internet souvenir ou pendant l'apocalypse zombie), mais nos sauvegardes sont en ordre - nous pouvons r√©cup√©rer √† partir de n'importe quelle sauvegarde de diff√©rence courte qui ne repose que sur nos sauvegardes pr√©c√©dentes. </p><br><blockquote>  Hashget ne d√©pend que de sources de r√©cup√©ration fiables √† votre discr√©tion.  Ce que vous consid√©rez fiable - ceux-ci seront utilis√©s. </blockquote><br><h2 id="filepool-i-glacier">  FilePool et Glacier </h2><br><p>  Le m√©canisme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FilePool</a> vous permet de ne pas acc√©der constamment √† des serveurs externes pour t√©l√©charger des packages, mais d'utiliser des packages √† partir d'un r√©pertoire local ou d'un serveur d'entreprise, par exemple: </p><br><pre> <code class="plaintext hljs">$ hashget -u . --pool /tmp/pool</code> </pre> <br><p>  ou </p><br><pre> <code class="plaintext hljs">$ hashget -u . --pool http://myhashdb.example.com/</code> </pre> <br><p>  Pour cr√©er un pool dans un r√©pertoire local - il suffit de cr√©er un r√©pertoire et d'y t√©l√©charger des fichiers, hashget lui-m√™me trouvera ce dont il a besoin par hachage.  Pour rendre le pool accessible via HTTP, vous devez cr√©er des liens symboliques d'une mani√®re sp√©ciale, cela se fait avec une seule commande ( <code>hashget-admin --build /var/www/html/hashdb/ --pool /tmp/pool</code> ).  HTTP FilePool lui-m√™me est un fichier statique, donc tout serveur Web simple peut le servir, la charge sur le serveur est presque nulle. </p><br><p>  Gr√¢ce √† FilePool, non seulement les ressources http (s) peuvent √™tre utilis√©es comme ressources de base, mais aussi, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par exemple</a> , Amazon Glacier. </p><br><p>  Apr√®s le t√©l√©chargement de sauvegarde sur le glacier, nous obtenons son ID de t√©l√©chargement et nous l'utilisons comme URL.  Par exemple: </p><br><pre> <code class="plaintext hljs">hashget --submit Glacier_Upload_ID --file /tmp/my-glacier-backup.tar.gz --project glacier --hashserver --expires 2019-09-01</code> </pre> <br><p>  D√©sormais, les nouvelles sauvegardes (diff√©rentielles) s'appuieront sur cette sauvegarde et seront plus courtes.  Apr√®s avoir d√©ball√© tar le diffback, nous pouvons voir sur quelles ressources il s'appuie: </p><br><pre> <code class="plaintext hljs">hashget --info /tmp/unpacked/ list</code> </pre> <br><p>  et utilisez simplement le script shell pour t√©l√©charger tous ces fichiers du glacier dans le pool et ex√©cutez la r√©cup√©ration habituelle: hashget -u / tmp / unpacked --pool / tmp / pool </p><br><h3 id="stoit-li-ovchinka-vydelki">  Le jeu en vaut-il la chandelle </h3><br><p>  Dans le cas le plus simple, vous paierez simplement moins cher pour les sauvegardes (si vous les stockez quelque part dans le cloud pour de l'argent).  Peut-√™tre - beaucoup, beaucoup moins. </p><br><p>  Mais ce n'est pas le seul.  La quantit√© va dans la qualit√©.  Vous pouvez l'utiliser pour obtenir une mise √† niveau du sch√©ma de sauvegarde de haute qualit√©.  Par exemple, puisque nos sauvegardes sont maintenant plus courtes - vous ne pouvez pas faire une sauvegarde mensuelle, mais une sauvegarde quotidienne.  Gardez-les non pas six mois, comme avant, mais 5 ans.  Auparavant, ils √©taient stock√©s dans un stockage "froid" lent mais bon march√© (Glacier), vous pouvez d√©sormais le stocker √† chaud, d'o√π vous pouvez toujours t√©l√©charger rapidement une sauvegarde et r√©cup√©rer en quelques minutes, pas en une journ√©e. </p><br><p>  Vous pouvez augmenter la fiabilit√© du stockage de sauvegarde.  Si nous les stockons maintenant dans un magasin, alors en r√©duisant le volume des sauvegardes - nous pouvons stocker dans 2-3 magasins et survivre en toute s√©curit√© si l'un d'eux est endommag√©. </p><br><h3 id="kak-poprobovat-i-nachat-polzovatsya">  Comment essayer et commencer √† utiliser? </h3><br><p>  Nous allons √† la page gitlab <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://gitlab.com/yaroslaff/hashget</a> , l'installons avec une seule commande ( <code>pip3 install hashget[plugins]</code> ) et lisons et <code>pip3 install hashget[plugins]</code> simplement le d√©marrage rapide.  Je pense que toutes les choses simples √† faire - cela prendra 10-15 minutes.  Ensuite, vous pouvez essayer de secouer vos machines virtuelles, cr√©er des fichiers de conseil si n√©cessaire, pour presser plus fort, jouer avec des pools, une base de donn√©es de hachage locale et un serveur de hachage, si cela est int√©ressant, et voir le lendemain quelle sera la taille de la sauvegarde incr√©mentielle par rapport √† hier. </p><br><h3 id="restic--hashget">  Restic + HashGet </h3><br><p>  <em>(Ce chapitre a √©t√© ajout√© plus tard. Merci aux commentateurs pour leurs critiques et leur motivation.)</em> </p><br><p>  Il existe un bon outil pratique pour les sauvegardes - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">restic</a> .  Il peut √©galement effectuer la d√©duplication, mais uniquement au sein du r√©f√©rentiel, ne peut pas la d√©duplication externe, ce que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hashget</a> fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">facilement</a> .  Mais en combinaison de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">restic + hashget</a> , nous parvenons √† utiliser les avantages des deux approches! </p><br><p>  Pr√©paration (d√©baller wordpress et indexer): </p><br><pre> <code class="plaintext hljs"># wget -q https://wordpress.org/wordpress-5.2.2.tar.gz # hashget --submit https://wordpress.org/wordpress-5.2.2.tar.gz -p my --file wordpress-5.2.2.tar.gz --hashserver # tar -xf wordpress-5.2.2.tar.gz # du -sh wordpress 46M wordpress</code> </pre> <br><p>  Ajout d'un instantan√© √† restic via </p><br><pre> <code class="plaintext hljs"># hashget -X exclude-list --prepack wordpress --hashserver Saved: 1468 files, 1 pkgs, size: 40.5M. Download: 10.7M # restic --exclude-file exclude-list backup wordpress password is correct scan [/tmp/wp/wordpress] scanned 193 directories, 367 files in 0:02 [0:04] 100.00% 700.829 KiB / 700.829 KiB 560 / 560 items 0 errors ETA 0:00 duration: 0:04 snapshot 76b54230 saved # du -sh /tmp/restic-repo/ 2,1M /tmp/restic-repo/</code> </pre> <br><p>  √Ä ce stade, nous avons ajout√© un instantan√© de catalogue (40+ Mo) et la taille du r√©f√©rentiel n'a augment√© que de 1 Mo. </p><br><p>  La r√©cup√©ration se fait par deux commandes: </p><br><pre> <code class="plaintext hljs"># restic restore 76b54230 -t unpacked password is correct restoring &lt;Snapshot 76b54230 of [/tmp/wp/wordpress] at 2019-06-19 04:30:55.760618336 +0700 +07 by root@braconnier&gt; to unpacked # hashget -u unpacked/wordpress/ --hashserver Recovered 1468/1468 files 40.5M bytes (0 downloaded, 0 from pool, 10.7M cached) in 1.56s</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454826/">https://habr.com/ru/post/fr454826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454810/index.html">De l'air frais sur Mars: pliez une mol√©cule de CO2 et obtenez de l'oxyg√®ne</a></li>
<li><a href="../fr454816/index.html">Configuration de l'ensemble php-fpm + nginx sous WSL</a></li>
<li><a href="../fr454818/index.html">Rekko Challenge - comment prendre la 2e place au concours pour la cr√©ation de syst√®mes de recommandation</a></li>
<li><a href="../fr454820/index.html">Recherche Azure</a></li>
<li><a href="../fr454824/index.html">L'amplificateur op√©rationnel le plus simple sur des √©l√©ments discrets</a></li>
<li><a href="../fr454828/index.html">Cr√©ation d'une image en mosa√Øque</a></li>
<li><a href="../fr454830/index.html">3 qualit√©s cl√©s pour un chef de produit r√©ussi: Alexander Belyaev</a></li>
<li><a href="../fr454832/index.html">Pourquoi une semaine de travail de quatre jours est une mauvaise histoire</a></li>
<li><a href="../fr454834/index.html">Les termes r√©els de l'√©tude de l'impression tactile √† faible motivation</a></li>
<li><a href="../fr454840/index.html">D√©m√©nagement prudent aux Pays-Bas avec sa femme et son hypoth√®que. Partie 2: pr√©parer des documents et d√©m√©nager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>