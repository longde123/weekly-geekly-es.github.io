<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìØ üë®üèª‚Äçüíº ü¶á Experiencia transfiriendo un proyecto Maven a Jar de lanzamiento m√∫ltiple: ya es posible, pero a√∫n dif√≠cil ‚òùüèΩ üöª üëä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tengo una peque√±a biblioteca StreamEx que extiende la API Java 8 Stream. Tradicionalmente colecciono la biblioteca a trav√©s de Maven, y en su mayor pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experiencia transfiriendo un proyecto Maven a Jar de lanzamiento m√∫ltiple: ya es posible, pero a√∫n dif√≠cil</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472312/"><p> Tengo una peque√±a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">StreamEx</a> que extiende la API Java 8 Stream.  Tradicionalmente colecciono la biblioteca a trav√©s de Maven, y en su mayor parte estoy contento con todo.  Sin embargo, quer√≠a experimentar. </p><br><p> Algunas cosas en la biblioteca deber√≠an funcionar de manera diferente en diferentes versiones de Java.  El ejemplo m√°s llamativo son los nuevos m√©todos de Stream API como <code>takeWhile</code> , que apareci√≥ solo en Java 9. Mi biblioteca tambi√©n proporciona una implementaci√≥n de estos m√©todos en Java 8, pero cuando expande Stream API usted mismo, se encuentra con algunas restricciones que no mencionar√© aqu√≠.  Desear√≠a que los usuarios de Java 9+ tuvieran acceso a una implementaci√≥n est√°ndar. </p><a name="habracut"></a><br><p>  Para que el proyecto contin√∫e compilando usando Java 8, esto generalmente se hace usando herramientas de reflexi√≥n: descubrimos si hay un m√©todo correspondiente en la biblioteca est√°ndar y, si es as√≠, lo llamamos, y si no, usamos nuestra implementaci√≥n.  Sin embargo, decid√≠ usar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API MethodHandle</a> , porque declara menos sobrecarga de llamadas.  Puede obtener <code>MethodHandle</code> por adelantado y guardarlo en un campo est√°tico: </p><br><pre> <code class="java hljs">MethodHandles.Lookup lookup = MethodHandles.publicLookup(); MethodType type = MethodType.methodType(Stream.class, Predicate.class); MethodHandle method = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { method = lookup.findVirtual(Stream.class, <span class="hljs-string"><span class="hljs-string">"takeWhile"</span></span>, type); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchMethodException | IllegalAccessException e) { <span class="hljs-comment"><span class="hljs-comment">// ignore }</span></span></code> </pre> <br><p>  Y luego √∫salo: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Stream&lt;T&gt;)method.invokeExact(stream, predicate); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Java 8 polyfill }</span></span></code> </pre> <br><p>  Todo esto est√° bien, pero se ve feo.  Y lo m√°s importante, en cada punto donde es posible una variaci√≥n de implementaciones, debe escribir tales condiciones.  Un enfoque ligeramente alternativo es separar las estrategias de Java 8 y Java 9 como una implementaci√≥n de la misma interfaz.  O, para guardar el tama√±o de la biblioteca, simplemente implemente todo para Java 8 en una clase no final separada y sustituya un heredero por Java 9.  Se hizo algo como esto: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    Internals static final VersionSpecific VER_SPEC = System.getProperty("java.version", "").compareTo("1.9") &gt; 0 ? new Java9Specific() : new VersionSpecific();</span></span></code> </pre> <br><p>  Luego, en los puntos de uso, simplemente puede escribir <code>return Internals.VER_SPEC.takeWhile(stream, predicate)</code> .  Toda la magia con manejadores de m√©todos ahora solo est√° en la clase <code>Java9Specific</code> .  Este enfoque, por cierto, salv√≥ la biblioteca para usuarios de Android que se hab√≠an quejado previamente de que no funcionaba en principio.  La m√°quina virtual de Android no es Java, ni siquiera implementa la especificaci√≥n Java 7. En particular, no hay m√©todos con una firma polim√≥rfica como <code>invokeExact</code> , y la sola presencia de esta llamada en el <code>invokeExact</code> lo rompe todo.  Ahora estas llamadas se colocan en una clase que nunca se inicializa. </p><br><p>  Sin embargo, todo esto sigue siendo feo.  Una soluci√≥n hermosa (al menos en teor√≠a) es usar el Multi Release Jar, que viene con Java 9 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JEP-238</a> ).  Para hacer esto, parte de las clases deben compilarse en Java 9 y los archivos de clase compilados se colocan en <code>META-INF/versions/9</code> dentro del archivo Jar.  Adem√°s, debe agregar la l√≠nea <code>Multi-Release: true</code> al manifiesto.  Entonces Java 8 ignorar√° con √©xito todo esto, y Java 9 y versiones posteriores cargar√°n nuevas clases en lugar de clases con los mismos nombres que se encuentran en el lugar habitual. </p><br><p>  La primera vez que intent√© hacer esto hace m√°s de dos a√±os, poco antes del lanzamiento de Java 9. Fue muy dif√≠cil y lo dej√©.  Incluso fue dif√≠cil hacer que el compilador del proyecto compilara desde Java 9: ‚Äã‚Äãmuchos complementos de Maven simplemente se rompieron debido a las API internas cambiadas <code>java.version</code> cadena <code>java.version</code> cambiado u otra cosa. </p><br><p>  Un nuevo intento este a√±o fue m√°s exitoso.  En su mayor parte, los complementos se han actualizado y funcionan en el nuevo Java de manera bastante adecuada.  El primer paso traduje todo el ensamblado a Java 11. Para esto, adem√°s de actualizar las versiones del complemento, tuve que hacer lo siguiente: </p><br><ul><li>  Cambie los enlaces de <code>&lt;a name="..."&gt;</code> de la forma <code>&lt;a name="..."&gt;</code> a <code>&lt;a id="..."&gt;</code> .  De lo contrario, JavaDoc se queja. </li><li>  Especifique <code>additionalOptions = --no-module-directories</code> en maven-javadoc-plugin.  Sin esto, hubo errores extra√±os con las funciones de b√∫squeda de JavaDoc: los directorios con m√≥dulos todav√≠a no se crearon, pero al cambiar al resultado de b√∫squeda, <code>/undefined/</code> agreg√≥ a la ruta (hola, JavaScript).  Esta caracter√≠stica en Java 8 no era para nada, por lo que mi actividad ya ha tenido un buen resultado: JavaDoc se ha convertido en una b√∫squeda. </li><li>  Arregle el complemento para publicar los resultados de la cobertura de prueba en Overol ( <code>coveralls-maven-plugin</code> ).  Por alguna raz√≥n, se abandona, lo cual es extra√±o, dado que Overol vive solo y ofrece servicios comerciales.  El jaxb-api que usa el complemento ha desaparecido de Java 11.  Afortunadamente, no es dif√≠cil solucionar el problema usando las herramientas de Maven: es suficiente registrar expl√≠citamente la dependencia del complemento: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.eluder.coveralls<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>coveralls-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>javax.xml.bind<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jaxb-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ul><br><p>  El siguiente paso fue la adaptaci√≥n de las pruebas.  Dado que el comportamiento de la biblioteca es obviamente diferente en Java 8 y Java 9, ser√≠a l√≥gico ejecutar pruebas para ambas versiones.  Ahora estamos ejecutando todo en Java 11, por lo que no se prueba el c√≥digo espec√≠fico de Java 8.  Este es un c√≥digo bastante grande y no trivial.  Para solucionar esto, hice una pluma artificial: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> VersionSpecific VER_SPEC = System.getProperty(<span class="hljs-string"><span class="hljs-string">"java.version"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).compareTo(<span class="hljs-string"><span class="hljs-string">"1.9"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !Boolean.getBoolean(<span class="hljs-string"><span class="hljs-string">"one.util.streamex.emulateJava8"</span></span>) ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Java9Specific() : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VersionSpecific();</code> </pre> <br><p>  Ahora solo pase <code>-Done.util.streamex.emulateJava8=true</code> cuando ejecute las pruebas, <br>  para probar lo que generalmente funciona en Java 8. Ahora agregue un nuevo bloque <code>&lt;execution&gt;</code> a la configuraci√≥n de <code>maven-surefire-plugin</code> con <code>argLine = -Done.util.streamex.emulateJava8=true</code> , y las pruebas pasan dos veces. </p><br><p>  Sin embargo, me gustar√≠a considerar las pruebas de cobertura total.  Uso JaCoCo, y si no le dices nada, la segunda ejecuci√≥n simplemente sobrescribir√° los resultados de la primera.  ¬øC√≥mo funciona JaCoCo?  Primero ejecuta el destino del <code>prepare-agent</code> , que establece la propiedad argLine Maven, firmando algo como <code>-javaagent:blah-blah/.m2/org/jacoco/org.jacoco.agent/0.8.4/org.jacoco.agent-0.8.4-runtime.jar=destfile=blah-blah/myproject/target/jacoco.exec</code> .  Quiero que se formen dos archivos exec diferentes.  Puedes hackearlo de esta manera.  Agregue <code>destFile=${project.build.directory}</code> configuraci√≥n del <code>prepare-agent</code> .  √Åspero pero efectivo.  Ahora <code>argLine</code> terminar√° en <code>blah-blah/myproject/target</code> .  S√≠, este no es un archivo, sino un directorio.  Pero ya podemos sustituir el nombre del archivo al comienzo de las pruebas.  Regresamos al <code>maven-surefire-plugin</code> y establecemos <code>argLine = @{argLine}/jacoco_java8.exec -Done.util.streamex.emulateJava8=true</code> para la ejecuci√≥n de Java 8 y <code>argLine = @{argLine}/jacoco_java11.exec</code> para la ejecuci√≥n de Java 11.  Entonces es f√°cil combinar estos dos archivos usando el objetivo de <code>merge</code> , que tambi√©n proporciona el complemento JaCoCo, y obtenemos la cobertura general. </p><br><p>  <strong>Actualizaci√≥n:</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Godin</a> en los comentarios dijo que era innecesario, puede escribir en un archivo y pegar√° autom√°ticamente el resultado con el anterior.  Ahora no estoy seguro de por qu√© este escenario no funcion√≥ para m√≠ inicialmente. </p><br><p>  Bueno, estamos bien preparados para cambiar al Jar de lanzamiento m√∫ltiple.  Encontr√© una serie de recomendaciones sobre c√≥mo hacer esto.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El primero</a> sugiri√≥ el uso de un proyecto Maven multimodular.  No quiero: esta es una gran complicaci√≥n de la estructura del proyecto: hay cinco pom.xml, por ejemplo.  Perder el tiempo por un par de archivos que deben compilarse en Java 9 parece ser demasiado.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Otro</a> sugiri√≥ comenzar la compilaci√≥n a trav√©s de <code>maven-antrun-plugin</code> .  Aqu√≠ decid√≠ mirar solo como √∫ltimo recurso.  Est√° claro que cualquier problema en Maven se puede resolver usando Ant, pero esto es bastante torpe.  Finalmente, vi una recomendaci√≥n para usar un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento de</a> terceros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de lanzamiento m√∫ltiple, jar-maven-plugin</a> .  Ya sonaba delicioso y correcto. </p><br><p>  El complemento recomienda colocar c√≥digos fuente espec√≠ficos para nuevas versiones de Java en directorios como <code>src/main/java-mr/9</code> , lo cual hice.  Todav√≠a decid√≠ evitar al m√°ximo las colisiones en los nombres de clase, por lo que la √∫nica clase (incluso la interfaz) que est√° presente tanto en Java 8 como en Java 9, tengo esto: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Java 8 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new VersionSpecific(); } // Java 9 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new Java9Specific(); }</span></span></code> </pre> <br><p>  La vieja constante se mud√≥ a un nuevo lugar, pero nada m√°s cambi√≥ realmente.  Solo que ahora la clase <code>Java9Specific</code> vuelto mucho m√°s simple: todas las sentadillas con MethodHandle se han reemplazado con √©xito por llamadas a m√©todos directos. </p><br><p>  El complemento promete hacer lo siguiente: </p><br><ul><li>  Reemplace el <code>maven-compiler-plugin</code> est√°ndar <code>maven-compiler-plugin</code> y compile en dos pasos con una versi√≥n de destino diferente. </li><li>  Reemplace el <code>maven-jar-plugin</code> est√°ndar <code>maven-jar-plugin</code> y <code>maven-jar-plugin</code> resultado de <code>maven-jar-plugin</code> compilaci√≥n con las rutas correctas. </li><li>  Agregue la l√≠nea <code>Multi-Release: true</code> to <code>MANIFEST.MF</code> . </li></ul><br><p>  Para que funcione, tom√≥ bastantes pasos. </p><br><ol><li><p>  Cambie el embalaje de <code>jar</code> a <code>jar</code> <code>multi-release-jar</code> . </p><br></li><li><p>  A√±adir build-extension: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p>  Copie la configuraci√≥n de <code>maven-compiler-plugin</code> .  Solo ten√≠a la versi√≥n predeterminada en el esp√≠ritu de <code>&lt;source&gt;1.8&lt;/source&gt;</code> y <code>&lt;arg&gt;-Xlint:all&lt;/arg&gt;</code> </p><br></li><li><p>  Pens√© que el <code>maven-compiler-plugin</code> ahora se puede eliminar, pero result√≥ que el nuevo plugin no reemplaza la compilaci√≥n de pruebas, por lo que la versi√≥n de Java se restableci√≥ a la predeterminada (1.5!) Y el <code>-Xlint:all</code> argumentos desaparecieron.  Entonces tuve que irme. </p><br></li><li><p>  Para no duplicar el origen y el destino de los dos complementos, descubr√≠ que ambos respetan las propiedades de <code>maven.compiler.source</code> y <code>maven.compiler.target</code> .  Los instal√© y elimin√© las versiones de la configuraci√≥n del complemento.  Sin embargo, de repente result√≥ que <code>maven-javadoc-plugin</code> usa la <code>source</code> de la configuraci√≥n de <code>maven-compiler-plugin</code> para encontrar la URL del JavaDoc est√°ndar, que debe vincularse cuando se hace referencia a m√©todos est√°ndar.  Y ahora no respeta <code>maven.compiler.source</code> .  Por lo tanto, tuve que devolver <code>&lt;source&gt;${maven.compiler.source}&lt;/source&gt;</code> a la configuraci√≥n de <code>maven-compiler-plugin</code> .  Afortunadamente, no se necesitaron otros cambios para generar JavaDoc.  Muy bien se puede generar a partir de fuentes Java 8, porque todo el carrusel con versiones no afecta a la API de la biblioteca. </p><br></li><li><p>  El <code>maven-bundle-plugin</code> , lo que convirti√≥ mi biblioteca en un artefacto OSGi.  Simplemente se neg√≥ a trabajar con <code>packaging = multi-release-jar</code> .  En principio, nunca me gust√≥.  Escribe un conjunto de l√≠neas adicionales en el manifiesto, al mismo tiempo estropea el orden de clasificaci√≥n y agrega m√°s basura.  Afortunadamente, result√≥ que no es dif√≠cil deshacerse de √©l escribiendo todo lo que necesita a mano.  Solo, por supuesto, no en <code>maven-jar-plugin</code> , sino en el nuevo.  La configuraci√≥n completa del complemento <code>multi-release-jar</code> eventualmente se volvi√≥ as√≠ (defin√≠ algunas propiedades como <code>project.package</code> ): </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span>-Xlint:all<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.name}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span>${project.description}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span>${license.url}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span>${project.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package};version="${project.version}"<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p>  Pruebas  Ya no tenemos <code>one.util.streamex.emulateJava8</code> , pero puede lograr el mismo efecto modificando las pruebas de class-path.  Ahora lo contrario es cierto: por defecto, la biblioteca funciona en modo Java 8, y para Java 9 necesita escribir: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span>${basedir}/target/classes-9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.outputDirectory}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span>@{argLine}/jacoco_java9.exec<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Un punto importante: las <code>classes-9</code> deben adelantarse a los archivos de clase ordinarios, por lo que tuvimos que transferir los habituales a <code>additionalClasspathElements</code> , que se agregan despu√©s. </p><br></li><li><p>  Fuentes  Voy a tener source-jar, y ser√≠a bueno incluir fuentes de Java 9 en √©l para que, por ejemplo, el depurador en el IDE pueda mostrarlas correctamente.  No estoy muy preocupado por duplicar <code>VerSpec</code> , porque hay una l√≠nea, que se ejecuta solo durante la inicializaci√≥n.  Est√° bien que deje solo la versi√≥n de Java 8. Sin embargo, ser√≠a bueno que <code>Java9Specific.java</code> adjunte.  Esto se puede hacer agregando manualmente un directorio fuente adicional: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.codehaus.mojo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>build-helper-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>add-source<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrce</span></span></span><span class="hljs-tag">&gt;</span></span>src/main/java-mr/9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrce</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sou‚Äãrces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Despu√©s de recolectar el artefacto, lo conect√© a un proyecto de prueba y lo verifiqu√© en el depurador IntelliJ IDEA.  Todo funciona a la perfecci√≥n: dependiendo de la versi√≥n de la m√°quina virtual utilizada para ejecutar el proyecto de prueba, terminamos en una fuente diferente al depurar. </p><br><p>  Ser√≠a genial que esto lo hiciera el complemento jar de liberaci√≥n m√∫ltiple, as√≠ que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hice</a> una sugerencia. </p><br></li><li><p>  JaCoCo.  Result√≥ ser lo m√°s dif√≠cil con √©l, y no podr√≠a prescindir de la ayuda externa.  El hecho es que el complemento exec-files perfectamente generado para Java-8 y Java-9, normalmente los peg√≥ en un solo archivo, sin embargo, al generar informes en XML y HTML, ignoraron obstinadamente las fuentes de Java-9.  Hurgando <a href="">en la fuente</a> , vi que solo genera un informe para los archivos de clase encontrados en <code>project.getBuild().getOutputDirectory()</code> .  Este directorio, por supuesto, puede ser reemplazado, pero de hecho tengo dos de ellos: <code>classes</code> y <code>classes-9</code> .  Te√≥ricamente, puede copiar todas las clases en un directorio, cambiar el <code>outputDirectory</code> salida e iniciar JaCoCo, y luego cambiar el <code>outputDirectory</code> nuevo para no romper el ensamblaje JAR.  Pero eso suena completamente feo.  En general, decid√≠ posponer la soluci√≥n a este problema en mi proyecto por ahora, pero les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escrib√≠ a los</a> chicos de JaCoCo que ser√≠a bueno poder especificar varios directorios con archivos de clase. </p><br><p>  Para mi sorpresa, solo unas horas despu√©s, uno de los desarrolladores de JaCoCo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">godin</a> vino a mi proyecto y trajo una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solicitud de extracci√≥n</a> , que resuelve el problema.  ¬øC√≥mo se decide?  Usando Ant, por supuesto!  Result√≥ que el complemento Ant para JaCoCo es m√°s avanzado y puede generar un informe resumido para varios directorios de origen y archivos de clase.  Ni siquiera necesitaba un paso de <code>merge</code> separado, porque pod√≠a alimentar varios archivos ejecutivos a la vez.  En general, Ant no se puede evitar, que as√≠ sea.  Lo principal que funcion√≥, y pom.xml creci√≥ solo seis l√≠neas. </p><br><p><img src="https://habrastorage.org/webt/-y/qd/q9/-yqdq9suyxlqtaw2d9dkjoc0rg8.png"></p><br><p>  Incluso tuite√© en corazones: </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1185422598810800129"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br></li></ol><br><p>  As√≠ que obtuve un proyecto muy funcional que construye un hermoso Jar Multi-Release.  Al mismo tiempo, el porcentaje de cobertura incluso aument√≥, porque <code>catch (NoSuchMethodException | IllegalAccessException e)</code> todo tipo de <code>catch (NoSuchMethodException | IllegalAccessException e)</code> que eran inalcanzables en Java 9. Desafortunadamente, esta estructura del proyecto no es compatible con IntelliJ IDEA, por lo que tuve que abandonar la importaci√≥n de POM y configurar el proyecto en el IDE manualmente .  Espero que en el futuro todav√≠a haya una soluci√≥n est√°ndar que sea compatible autom√°ticamente con todos los complementos y herramientas. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472312/">https://habr.com/ru/post/472312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472298/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 385 (14-20 de octubre de 2019)</a></li>
<li><a href="../472300/index.html">Descenso de gradiente estoc√°stico (SGD) para la funci√≥n de p√©rdida logar√≠tmica (LogLoss) en un problema de clasificaci√≥n binaria</a></li>
<li><a href="../472304/index.html">NASA contrata ingenieros para desarrollar robot humanoide de pr√≥xima generaci√≥n</a></li>
<li><a href="../472306/index.html">PHP Digest No. 166 (7-21 de octubre de 2019)</a></li>
<li><a href="../472310/index.html">Identificaci√≥n del cliente en sitios sin contrase√±as y cookies: solicitud de est√°ndar</a></li>
<li><a href="../472314/index.html">Me gusta la gente de carton</a></li>
<li><a href="../472318/index.html">Rastreo Distribuido en Istio</a></li>
<li><a href="../472320/index.html">Entrevista con Zabbix: 12 respuestas francas</a></li>
<li><a href="../472326/index.html">Nuestra industria espacial ... ¬øY si nos fijamos en los problemas de la industria desde la perspectiva de un geek?</a></li>
<li><a href="../472334/index.html">La vida por cupones o c√≥mo optimizamos el trabajo de los servicios sociales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>