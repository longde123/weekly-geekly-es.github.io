<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЬПя╕П ЁЯХ║ЁЯП╛ ЁЯЩЕ Redux Thunk рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрдб рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рд╡рд┐рд╡рд░рдг ЁЯЩНЁЯП╜ ЁЯОЕЁЯП╗ ЁЯНЙ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░! 


 рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ, рдореИрдВ рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ Redux Thunk рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрдб рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рджреГрд╖реНрдЯрд┐рдХреЛ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redux Thunk рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрдб рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рд╡рд┐рд╡рд░рдг</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/469371/"><p>  рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░! </p><br><p>  рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ, рдореИрдВ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛</a> рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Redux Thunk</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрдб рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ред </p><br><p>  рдЗрд╕рдХреЗ рд▓рд┐рдП рд░рд╛рд╕реНрддрд╛ рд▓рдВрдмрд╛ рдФрд░ рдХрд╛рдВрдЯреЗрджрд╛рд░ рдерд╛, рдЗрд╕рд▓рд┐рдП рдореИрдВ рд╡рд┐рдЪрд╛рд░ рдФрд░ рдкреНрд░реЗрд░рдгрд╛ рдХреА рдЯреНрд░реЗрди рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реВрдВрдЧрд╛, рдЬреЛ рдЕрдВрддрд┐рдо рдирд┐рд░реНрдгрдп рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛ред </p><a name="habracut"></a><br><h2 id="opisanie-prilozheniya-i-postanovka-problemy">  рдЖрд╡реЗрджрди рдФрд░ рд╕рдорд╕реНрдпрд╛ рдмрдпрд╛рди рдХрд╛ рд╡рд┐рд╡рд░рдг </h2><br><p>  рдкрд╣рд▓рд╛, рдереЛрдбрд╝рд╛ рд╕рдВрджрд░реНрднред </p><br><p>  рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЖрдВрдХрдбрд╝рд╛ рд╣рдорд╛рд░реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреГрд╖реНрда рдХрд╛ рд▓реЗрдЖрдЙрдЯ рджрд┐рдЦрд╛рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/rk/je/ac/rkjeacwa1f4shulpc5ge5y4oi6q.jpeg"></p><br><p>  рдХреНрд░рдо рдореЗрдВ: </p><br><ul><li>  рддрд╛рд▓рд┐рдХрд╛ (рдирдВрдмрд░ 1) рдореЗрдВ рдбреЗрдЯрд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдмрд╣реБрдд рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рд╕рд╛рджрд╛ рдкрд╛рда, рд▓рд┐рдВрдХ, рдЪрд┐рддреНрд░ рдЖрджрд┐)ред </li><li>  рд╕реЙрд░реНрдЯрд┐рдВрдЧ рдкреИрдирд▓ (рдирдВрдмрд░ 2) рд╕реНрддрдВрдн рджреНрд╡рд╛рд░рд╛ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдбреЗрдЯрд╛ рд╕реЙрд░реНрдЯрд┐рдВрдЧ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред </li><li>  рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдкреИрдирд▓ (рдирдВрдмрд░ 3) рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдХреЙрд▓рдо рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╡рд┐рднрд┐рдиреНрди рдлрд╝рд┐рд▓реНрдЯрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред </li><li>  рдХреЙрд▓рдо рдкреИрдирд▓ (рдирдВрдмрд░ 4) рдЖрдкрдХреЛ рдЯреЗрдмрд▓ рдХреЙрд▓рдо (рдкреНрд░рджрд░реНрд╢рди / рдЫрд┐рдкрд╛рдиреЗ) рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </li><li>  рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдХрд╛ рдкреИрдирд▓ (рдирдВрдмрд░ 5) рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╕реЗрдЯрд┐рдВрдЧ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХрд╛ рдЪрдпрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдореЗрдВ рдкреИрдирд▓ рдирдВрдмрд░ 2, рдирдВрдмрд░ 3, рдирдВрдмрд░ 4 рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдХреБрдЫ рдЕрдиреНрдп рдбреЗрдЯрд╛ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреЙрд▓рдо рдХреА рд╕реНрдерд┐рддрд┐, рдЙрдирдХрд╛ рдЖрдХрд╛рд░, рдЖрджрд┐ред </li></ul><br><p>  рдкреИрдирд▓ рд╕рдВрдмрдВрдзрд┐рдд рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ рдЦреЛрд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><p>  рдХрд┐рд╕реА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдХреМрди рд╕реЗ рд╕реНрддрдВрдн рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрдирдореЗрдВ рдХреМрди рд╕рд╛ рдбреЗрдЯрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдХреМрди рд╕реЗ рдлрд╝рд┐рд▓реНрдЯрд░ рдлрд╝рд┐рд▓реНрдЯрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдореЗрдЯрд╛-рдбреЗрдЯрд╛ рдореЗрдВ рд╕рдорд╛рд╣рд┐рдд рд╣реИ, рдЬреЛ рдкреЗрдЬ рд▓реЛрдбрд┐рдВрдЧ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдбреЗрдЯрд╛ рд╕реЗ рдЕрд▓рдЧ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рддрд╛рд▓рд┐рдХрд╛ рдХреА рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдФрд░ рдЗрд╕рдореЗрдВ рдбреЗрдЯрд╛ рддреАрди рдХрд╛рд░рдХреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ: </p><br><ul><li>  рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдореЗрдЯрд╛ рдбреЗрдЯрд╛ рд╕реЗ рдбреЗрдЯрд╛ред </li><li>  рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЪрдпрдирд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯрд┐рдВрдЧреНрд╕ред </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ (рдЪрдпрдирд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреЛрдИ рднреА рдкрд░рд┐рд╡рд░реНрддрди рдПрдХ рддрд░рд╣ рдХреЗ "рдбреНрд░рд╛рдлреНрдЯ" рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рдПрдХ рдирдП рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рддреЛ рдирдИ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд╕рд╛рде рд╡рд░реНрддрдорд╛рди рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ, рдпрд╛ рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛ рджреЗрдВ рдФрд░ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рдЕрдкрдиреА рдореВрд▓ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд▓реМрдЯрд╛ рджреЗрдВ)ред </li></ul><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдРрд╕рд╛ рдкреГрд╖реНрда рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╣реИред  рдРрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдкреГрд╖реНрда (рдпрд╛ рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ, рдЗрд╕рдореЗрдВ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд▓рд┐рдП) рдХреЗ рд▓рд┐рдП, Redux рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рдФрд░ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд▓рди рдХреА рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдЗрдХрд╛рдИ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред </p><br><p>  рдардЧ рдФрд░ рдПрдХреНрд╢рди рдХреНрд░рд┐рдПрдЯрд░реНрд╕ рдХреЗ рд╕рдЬрд╛рддреАрдп рд╕реЗрдЯ рдФрд░ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЗрдХрд╛рдИ рдкрд░ рдбреЗрдЯрд╛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ</a> (рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдХрд╛рд░рдЦрд╛рдирд╛): </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* --- ACTIONS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error }; } <span class="hljs-comment"><span class="hljs-comment">/* --- THUNKS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> dispatch =&gt; { dispatch(fetchTotalCounterStart()); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { dispatch(fetchTotalCounterError(error)); } }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter, dispatch</span></span></span><span class="hljs-function">) </span></span>{ dispatch(fetchTotalCounter(filter)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> entityModel.fetchData(filter); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = getCurrentStore(store); <span class="hljs-comment"><span class="hljs-comment">// 'getFilter' comes from selectors. const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); dispatch(applyFilterSuccess(payload)); } catch (error) { dispatch(applyFilterError(error)); } }; } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, applyFilterSuccess, applyFilterError, fetchTotalCounter, fetchData, applyFilter, }; };</span></span></code> </pre> <br><p>  рдЬрд╣рд╛рдВ: </p><br><ul><li>  <code>prefix</code> - Redux рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдЗрдХрд╛рдИ рдЙрдкрд╕рд░реНрдЧред  рдпрд╣ "CATS_", "MICE_", рдЖрджрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИред </li><li>  <code>getCurrentStore</code> - рдПрдХ рдЪрдпрдирдХрд░реНрддрд╛ рдЬреЛ Redux рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдЗрдХрд╛рдИ рдкрд░ рд╡рд░реНрддрдорд╛рди рдбреЗрдЯрд╛ рд▓реМрдЯрд╛рддрд╛ рд╣реИред </li><li>  <code>entityModel</code> - рдЗрдХрд╛рдИ рдореЙрдбрд▓ рд╡рд░реНрдЧ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдгред  рдПрдХ рдУрд░, рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрд░реЛрдз рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореЙрдбрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рджреВрд╕рд░реА рддрд░рдл, рдХреБрдЫ рдЬрдЯрд┐рд▓ (рдпрд╛ рдРрд╕рд╛ рдирд╣реАрдВ) рдбреЗрдЯрд╛ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рд▓реЙрдЬрд┐рдХ рд╡рд░реНрдгрд┐рдд рд╣реИред </li></ul><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрд╣ рдХрд╛рд░рдЦрд╛рдирд╛ рдЖрдкрдХреЛ рд▓рдЪреАрд▓реЗ рдврдВрдЧ рд╕реЗ Redux рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЗрдХрд╛рдИ рдХреЗ рдбреЗрдЯрд╛ рдФрд░ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рдкреНрд░рдмрдВрдзрди рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдФрд░ рдЗрд╕ рдЗрдХрд╛рдИ рдХреЗ рдЕрдиреБрд░реВрдк рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд╕рд╛рде рд╕рдВрдмрджреНрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  рдЪреВрдВрдХрд┐ рдЗрд╕ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рдкреНрд░рдмрдВрдзрди рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реА рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдерди рдЬрдЯрд┐рд▓, рд╕реНрд╡реИрдЪреНрдЫрд┐рдХ, рднреНрд░рд╛рдордХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ рджреЛрд╣рд░рд╛рд╡ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрдиреНрд╣реЗрдВ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рд╛рде рд╣реА рдХреЛрдб рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬрдЯрд┐рд▓ рдереНрд░рдХреНрд╕ рдХреЛ рд╕рд░рд▓ рд▓реЛрдЧреЛрдВ рдореЗрдВ рддреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рд░рдЪрдирд╛ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдЕрдм рдпрд╣ рдкрддрд╛ рдЪрд▓ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдардЧ рджреВрд╕рд░реЗ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд╛рдорд╛рдиреНрдп <code>applyFilter</code> рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ <code>applyFilter</code> рдмрдВрдбрд▓ - рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рд╕реЗ <code>fetchTotalCounter</code> )ред  рдФрд░ рдЬрдм рд╕рднреА рдореБрдЦреНрдп рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдердВрдХ рдФрд░ рдПрдХреНрд╢рди рдХреНрд░рд┐рдПрдЯрд░реНрд╕ рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ рдПрдХреНрд╢рди рдХреНрд░рд┐рдПрдЯрд░ рдлрд╝рдВрдХреНрд╢рди рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреЛрдб рдХреА ~ 1200 рд▓рд╛рдЗрдиреЗрдВ рдереАрдВ рдФрд░ рдорд╣рд╛рди рд╕реНрдХреНрд╡реИрдХ рдХреЗ рд╕рд╛рде рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рдЧрднрдЧ 1200 рд▓рд╛рдЗрдиреЗрдВ рднреА рдереАрдВ, рд▓реЗрдХрд┐рди рдХрд╡рд░реЗрдЬ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ 40-50% рдерд╛ред </p><br><p>  рдпрд╣рд╛рдВ, рдЙрджрд╛рд╣рд░рдг, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдмрд╣реБрдд рд╕рд░рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рджреЛрдиреЛрдВ рдардЧ рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдЙрдирдХреЗ рдЖрдВрддрд░рд┐рдХ рддрд░реНрдХ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред </p><br><p>  рдКрдкрд░ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ 2 рдкреНрд░рдХрд╛рд░ рдХреЗ рдердВрдХ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ: </p><br><ul><li>  <code>fetchTotalCounter</code> - рдкреНрд░реЗрд╖рдг-рдпрд╣ рдХреЗрд╡рд▓ <code>fetchTotalCounter</code> ред </li><li>  <code>applyFilter</code> - рдЗрд╕рдХреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд <code>applyFilter</code> рдХреЗ рдкреНрд░реЗрд╖рдг рдХреЗ рдЕрд▓рд╛рд╡рд╛ ( <code>applyFilterSuccess</code> , <code>applyFilterError</code> ), рдкреНрд░реЗрд╖рдг - рдпрд╣ рднреА рдПрдХ рдФрд░ <code>fetchTotalCounter</code> ( <code>fetchTotalCounter</code> ) рд╣реИред <br>  рд╣рдо рдереЛрдбрд╝реА рджреЗрд░ рдмрд╛рдж рдЙрдирдХреЗ рдкрд╛рд╕ рд▓реМрдЯ рдЖрдПрдВрдЧреЗред </li></ul><br><p>  рдпрд╣ рд╕рдм <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░</a> рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ (рдлреНрд░реЗрдо рдХрд╛ рдЙрдкрдпреЛрдЧ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреЗрд╕реНрдЯ</a> рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureMockStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-mock-store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> thunk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-thunk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { actionsCreator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'actionsCreator'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultState = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> middlewares = [thunk]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mockStore = configureMockStore(middlewares); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> defaultState; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: jest.fn(), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: jest.fn(), }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> actions; beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { actions = actionsCreator(prefix, getCurrentStore, entityModel); }); describe(<span class="hljs-string"><span class="hljs-string">'fetchTotalCounter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: counter }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ <span class="hljs-comment"><span class="hljs-comment">// fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); it('should dispatch correct actions on error', () =&gt; { const error = {}; const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockRejectedValueOnce(error); entityModel.fetchTotalCounter.mockResolvedValueOnce({ data: { payload: counter }, }); const expectedActions = [ // fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_ERROR`, error, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); }); });</span></span></code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдкрд╣рд▓реЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдердВрдХ рдХреЗ рдкрд░реАрдХреНрд╖рдг рдореЗрдВ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ - рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдПрдВрдЯрдореЙрдбрд▓ рдореЙрдбрд▓ <code>entityModel</code> рдХреЛ рд╣реБрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рджреВрд╕рд░рд╛ рдкреНрд░рдХрд╛рд░ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ - рдЖрдкрдХреЛ рдкреВрд░реА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЛ рдердВрдХ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдореЙрдбрд▓ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдкреЛрдВрдЫрдирд╛ рд╣реЛрдЧрд╛ред  рдЕрдиреНрдпрдерд╛, рдкрд░реАрдХреНрд╖рдг рдбреЗрдЯрд╛ рдХреЗ рд╡рд┐рдШрдЯрди ( <strong>{рдбреЗрдЯрд╛: {рдкреЗрд▓реЛрдб}}</strong> ) рдкрд░ рдкрдбрд╝реЗрдЧрд╛, рдФрд░ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдпрд╛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд░реВрдк рд╕реЗ рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╣ рдРрд╕рд╛ рдерд╛ рдХрд┐ рдкрд░реАрдХреНрд╖рдг рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкрд╛рд░рд┐рдд рд╣реЛ рдЧрдпрд╛, рд▓реЗрдХрд┐рди рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рд╢реЛрдз рдореЗрдВ рдпрд╣ рджреЗрдЦрд╛ рдЧрдпрд╛ рдХрд┐ рджреВрд╕рд░реЗ рдпрд╛ рддреАрд╕рд░реЗ рдореЗрдВ рдЗрд╕ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд╛ рд▓рд┐рдВрдХ рд▓реЙрдХ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреА рдХрдореА рдХреЗ рдХрд╛рд░рдг рдкрд░реАрдХреНрд╖рдг рдореЗрдВ рдПрдХ рдЧрд┐рд░рд╛рд╡рдЯ рдереА)ред  рдпрд╣ рднреА рдмреБрд░рд╛ рд╣реИ рдХрд┐ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХрд╛рд░реНрдпреЛрдВ рдХреА рдЗрдХрд╛рдИ рдкрд░реАрдХреНрд╖рдг рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рдПрдХреАрдХрд░рдг рдореЗрдВ рдмрджрд▓ рдЬрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдирд┐рдХрдЯрддрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><p>  рд╕рд╡рд╛рд▓ рдпрд╣ рдЙрдарддрд╛ рд╣реИ: рдХреНрдпреЛрдВ <code>applyFilter</code> рдлрдВрдХреНрд╢рди рдореЗрдВ рдпрд╣ рдЬрд╛рдБрдЪреЗрдВ рдХрд┐ рдЕрдЧрд░ рдЗрд╕рдХреЗ <strong>рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕реЗ рд╣реА</strong> рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╡рд┐рд╕реНрддреГрдд рдкрд░реАрдХреНрд╖рдг рд▓рд┐рдЦреЗ <strong>рдЬрд╛ рдЪреБрдХреЗ рд╣реИрдВ</strong> рддреЛ <code>fetchTotalCounter</code> рдлрд╝рдВрдХреНрд╢рди рдХреИрд╕реЗ <code>fetchTotalCounter</code> рд╣реИ?  рдореИрдВ рджреВрд╕рд░реЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдердВрдХ рдХреЗ рдкрд░реАрдХреНрд╖рдг рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рд╕реНрд╡рддрдВрддреНрд░ рдХреИрд╕реЗ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реВрдВ?  рдпрд╣ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХрд╛ рдЕрд╡рд╕рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛ рдХрд┐ <code>fetchTotalCounter</code> (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ <code>fetchTotalCounter</code> ) рдХреЛ <strong>рд╕рд╣реА рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ</strong> , рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореЛрдХреНрд╕ рдХреА рджреЗрдЦрднрд╛рд▓ рдХрд░рдиреЗ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред </p><br><p>  рд▓реЗрдХрд┐рди рдпрд╣ рдХреИрд╕реЗ рдХрд░реЗрдВ?  рд╕реНрдкрд╖реНрдЯ рдирд┐рд░реНрдгрдп рджрд┐рдорд╛рдЧ рдореЗрдВ рдЖрддрд╛ рд╣реИ: fetchData рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╣реБрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬрд┐рд╕реЗ <code>applyFilter</code> рдореЗрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╛ <code>fetchTotalCounter</code> (рдХреНрдпреЛрдВрдХрд┐ рдЕрдХреНрд╕рд░ рджреВрд╕рд░реЗ <code>fetchTotalCounter</code> рдХреЛ рд╕реАрдзреЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ <code>fetchData</code> рдЬреИрд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ) <code>fetchData</code> ред </p><br><p>  рдЪрд▓реЛ рдЗрд╕реЗ рдЖрдЬрдорд╛рдПрдБред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ рдПрдХ рд╕рдлрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдмрджрд▓ рджреЗрдВрдЧреЗред </p><br><ul><li>  рд╡рд┐рдХрд▓реНрдк рд╕рдВрдЦреНрдпрд╛ 1ред  рдирдХрд▓реА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>fetchData</code></a> рдХрд╛рд░реНрдп: </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); - entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchData = jest.spyOn(actions, 'fetchData'); + // or fetchData.mockImplementationOnce(Promise.resolve({ data: { payload } })); + fetchData.mockResolvedValueOnce({ data: { payload } }); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p>  рдпрд╣рд╛рдБ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>jest.spyOn</code></a> рд╡рд┐рдзрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреА рдЬрдЧрд╣ (рдФрд░ рд╢рд╛рдпрдж рдмрд┐рд▓рдХреБрд▓) рдмрджрд▓ рджреЗрддреА рд╣реИ: </p><br><pre> <code class="javascript hljs">actions.fetchData = jest.fn(actions.fetchData);</code> </pre> <br><p>  рдпрд╣ рд╣рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХреЛ "рдореЙрдирд┐рдЯрд░" рдХрд░рдиреЗ рдФрд░ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЗрд╕реЗ рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдХрд┐рди рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рдеред </p><br><p>  рд╣рдореЗрдВ рдирд┐рдореНрди рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ: </p><br><pre> <code class="diff hljs">Difference: - Expected + Received Array [ Object { - "payload": Object {}, - "type": "TEST_APPLY_FILTER_SUCCESS", + "type": "TEST_FETCH_TOTAL_COUNTER_START", }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_FETCH_TOTAL_COUNTER_ERROR", + }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_APPLY_FILTER_ERROR", + }, ]</code> </pre> <br><p>  рдЕрдЬреАрдм рдмрд╛рдд рд╣реИ, рд╣рдо рдЕрдкрдиреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ <code>fetchData</code> рдХрд░рддреЗ рд╣реБрдП, fetchData рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЫрд┐рдкрд╛рддреЗ рд╣реИрдВ </p><br><pre> <code class="javascript hljs">fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } })</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдлрд╝рдВрдХреНрд╢рди рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рд╣реА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдпрд╛рдиреА рдореЙрдХ рдиреЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдпрд╛!  рдЖрдЗрдП рдЗрд╕реЗ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рдЖрдЬрдорд╛рдПрдВред </p><br><ul><li>  рд╡рд┐рдХрд▓реНрдк рд╕рдВрдЦреНрдпрд╛ 2ред  рдирдХрд▓реА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>fetchTotalCounter</code></a> рд╕рдорд╛рд░реЛрд╣: </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchTotalCounter = jest.spyOn(actions, 'fetchTotalCounter'; + fetchTotalCounter.mockImplementation(() =&gt; {}); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p>  рд╣рдореЗрдВ рдареАрдХ рд╡реИрд╕реА рд╣реА рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИред  рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ, рд╣рдорд╛рд░реЗ рдореЛрдХреНрд╕ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдореВрд▓ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдЕрдкрдиреЗ рдЖрдк рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдЫ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд</a> рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ рдорд╣рд╕реВрд╕ рдХрд┐рдпрд╛ рдХрд┐ рдпрд╣ рд╕рдорд╕реНрдпрд╛ рди рдХреЗрд╡рд▓ рдореЗрд░реЗ рдкрд╛рд╕ рдореМрдЬреВрдж рд╣реИ, рдФрд░ рдЗрд╕реЗ (рдореЗрд░реА рд░рд╛рдп рдореЗрдВ) рдХрд╛рдлреА рдЧрдВрднреАрд░ рд░реВрдк рд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрди рд╕реНрд░реЛрддреЛрдВ рдореЗрдВ рд╡рд░реНрдгрд┐рдд рдЙрджрд╛рд╣рд░рдг рддрдм рддрдХ рдЕрдЪреНрдЫреЗ рд╣реИрдВ рдЬрдм рддрдХ рд╡реЗ рдХрд┐рд╕реА рдРрд╕реА рдЪреАрдЬ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд╣реАрдВ рдмрди рдЬрд╛рддреЗ рд╣реИрдВ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИ (рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдХрд╛рд░рдЦрд╛рдирд╛ рд╣реИ)ред </p><br><p>  рдЬреЗрдирдХрд┐рдВрд╕ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рд╣рдорд╛рд░реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рд╕реЛрдирд╛рд░рдХреНрдпреВрдм рд╕реЗ рдПрдХ рдХреЛрдб рдХреА рдЬрд╛рдВрдЪ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдЬреЛ рдорд░реНрдЬ / рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╣реИрдВ) <code>&gt; 60%</code> ред  рдЪреВрдВрдХрд┐ рдЗрд╕ рдХрд╛рд░рдЦрд╛рдиреЗ рдХрд╛ рдХрд╡рд░реЗрдЬ, рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдХрд╣рд╛ рдЧрдпрд╛ рдерд╛, рдЕрд╕рдВрддреЛрд╖рдЬрдирдХ рдерд╛, рдФрд░ рдЗрд╕ рддрд░рд╣ рдХреА рдлрд╛рдЗрд▓ рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рдХреА рдмрд╣реБрдд рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА рдХреЗрд╡рд▓ рдЕрд╡рд╕рд╛рдж рдХрд╛ рдХрд╛рд░рдг рдерд╛, рдЗрд╕рдХреЗ рд╕рд╛рде рдХреБрдЫ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдерд╛, рдЕрдиреНрдпрдерд╛ рдирдИ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рд╡рд┐рддрд░рдг рд╕рдордп рдХреЗ рд╕рд╛рде рдзреАрдорд╛ рд╣реЛ рд╕рдХрддрд╛ рдерд╛ред  рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдорд░реНрдЬ / рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЕрдиреНрдп рдлрд╛рдЗрд▓реЛрдВ (рдШрдЯрдХреЛрдВ, рдХрд╛рд░реНрдпреЛрдВ) рдХреЗ рдкрд░реАрдХреНрд╖рдг рдХрд╡рд░реЗрдЬ рдХреЛ рдмрдЪрд╛рдпрд╛, рддрд╛рдХрд┐ рд╡рд╛рдВрдЫрд┐рдд рдХрд╡рд░реЗрдЬ рддрдХ% рдХрд╡рд░реЗрдЬ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗ, рд▓реЗрдХрд┐рди, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рдПрдХ рд╕рдорд╛рдзрд╛рди рдерд╛, рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВред  рдФрд░ рдПрдХ рдареАрдХ рдХреНрд╖рдг, рд╕реНрдкреНрд░рд┐рдВрдЯ рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕рдордп рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВ рд╕реЛрдЪрдиреЗ рд▓рдЧрд╛ рдХрд┐ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдХреИрд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h2 id="popytka-resheniya-problemy-1-ya-chto-to-slyshal-pro-redux-saga">  рд╕рдорд╕реНрдпрд╛ рдирдВрдмрд░ 1 рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ред  рдореИрдВрдиреЗ Redux-Saga рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╕реБрдирд╛ ... </h2><br><p>  ... рдФрд░ рдЙрдиреНрд╣реЛрдВрдиреЗ рдореБрдЭреЗ рдмрддрд╛рдпрд╛ рдХрд┐ рдЗрд╕ рдорд┐рдбрд▓рд╡реЗрдпрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдкрд░реАрдХреНрд╖рдг рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрджрд┐ рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ</a> , рддреЛ рдЖрдкрдХреЛ рдЖрд╢реНрдЪрд░реНрдп рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рддрдирд╛ рд╕рд░рд▓ рд╣реИред  рд░рд╕ рд╕реНрд╡рдпрдВ рдЗрд╕ рддрдереНрдп рдореЗрдВ рдирд┐рд╣рд┐рдд рд╣реИ рдХрд┐ рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рдЗрд╕ рддрдереНрдп рдкрд░ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреБрдЫ рдЧрд╛рдерд╛ рдПрдХ рдФрд░ рдЧрд╛рдерд╛ рдХрд╣ рд╕рдХрддреА рд╣реИ - рд╣рдо рдЧреАрд▓реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдорд┐рдбрд▓рд╡реЗрдпрд░ ( <code>put</code> , <code>take</code> , рдЖрджрд┐) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдпреЛрдВ рдХреЛ "рд╕реБрди" рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ (рдФрд░ рд╕рд╣реА рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред  рдпрд╣реА рд╣реИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдлрд╝рдВрдХреНрд╢рди рд╕реАрдзреЗ рджреВрд╕рд░реЗ рдлрд╝рдВрдХреНрд╢рди рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╕реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рддрдм рдЕрдиреНрдп рдЖрд╡рд╢реНрдпрдХ рдлрд╝рдВрдХреНрд╢рди / рд╕рд╛рдЧрд╛ рдХрд╣рддрд╛ рд╣реИред </p><br><p>  "рдЗрд╕ рдорд┐рдбрд▓рд╡реЗрдпрд░ рдХреА рдХреЛрд╢рд┐рд╢ рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХреА рдЧрдИ?"  рдореИрдВрдиреЗ рд╕реЛрдЪрд╛, рдФрд░ рдХрд╛рдо рдкрд░ рд▓рдЧ рдЧрдпрд╛ред  рдЙрдиреНрд╣реЛрдВрдиреЗ рдЬреАрд░рд╛ рдореЗрдВ рдПрдХ рддрдХрдиреАрдХреА рдЗрддрд┐рд╣рд╛рд╕ рд╢реБрд░реВ рдХрд┐рдпрд╛, рдЗрд╕рдореЗрдВ рдХрдИ рдХрд╛рд░реНрдп рдмрдирд╛рдП (рдЕрдиреБрд╕рдВрдзрд╛рди рд╕реЗ рд▓реЗрдХрд░ рдЗрд╕ рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдФрд░ рд╡рд┐рд╡рд░рдг рддрдХ), "рдЧреЛ-рдлреЙрд░рд╡рд░реНрдб" рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдФрд░ рдПрдХ рдирдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рд╡рд░реНрддрдорд╛рди рдкреНрд░рдгрд╛рд▓реА рдХреА рдПрдХ рдиреНрдпреВрдирддрдо рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ред </p><br><p>  рд╢реБрд░реБрдЖрдд рдореЗрдВ, рд╕рдм рдХреБрдЫ рдареАрдХ рдЪрд▓рд╛ред  рдбреЗрд╡рд▓рдкрд░реНрд╕ рдореЗрдВ рд╕реЗ рдПрдХ рдХреА рд╕рд▓рд╛рд╣ рдкрд░, рдирдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рддреНрд░реБрдЯрд┐ рд╕реЗ рдирд┐рдкрдЯрдиреЗ рдХреЗ рд▓рд┐рдП</a> рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реИрд╢реНрд╡рд┐рдХ рдЧрд╛рдерд╛</a> рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рдерд╛ред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреБрдЫ рдмрд┐рдВрджреБ рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░реАрдХреНрд╖рдг рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдПрдВ рдереАрдВ</a> (рдЬреЛ, рд╕рдВрдпреЛрдЧ рд╕реЗ, рдЕрдм рддрдХ рд╣рд▓ рдирд╣реАрдВ рд╣реБрдИ рд╣реИрдВ)ред  рдореИрдВрдиреЗ рд╕реЛрдЪрд╛ рдерд╛ рдХрд┐ рдпрд╣ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╕рднреА рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЛ рдирд╖реНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдмрдЧреЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рдкреИрджрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдЗрд╕ рдХрд╛рд░реНрдп рдкрд░ рдХрд╛рдо рдХреЛ рд╕реНрдердЧрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ рдЬрдм рддрдХ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдХреБрдЫ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реБрдЖ, рдФрд░ рдЙрддреНрдкрд╛рджрдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЙрддрд░ рдЧрдпрд╛ред </p><br><p>  рдПрдХ рдпрд╛ рджреЛ рдорд╣реАрдиреЗ рдмреАрдд рдЧрдП, рдХреЛрдИ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛, рдФрд░ рдХреБрдЫ рдмрд┐рдВрджреБ рдкрд░, рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдЪрд░реНрдЪрд╛ рдХреАред  рдЗрд╕ рдХрд╛рд░реНрдп рдореЗрдВ рдЕрдЧреНрд░рдгреА (рдЕрдиреБрдкрд╕реНрдерд┐рдд) рдкреНрд░рдЧрддрд┐, рдЙрдиреНрд╣реЛрдВрдиреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ Redux-Saga рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕ рд╕рдордп рддрдХ рдпрд╣ рд╢реНрд░рдо рд▓рд╛рдЧрдд рдФрд░ рдмрдЧ рдХреА рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдмрд╣реБрдд рдорд╣рдВрдЧрд╛ рд╣реЛ рдЧрдпрд╛ рдерд╛ред  рдЗрд╕рд▓рд┐рдП рд╣рдо рдЖрдЦрд┐рд░рдХрд╛рд░ Redux Thunk рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛ рдЧрдПред </p><br><h2 id="popytka-resheniya-problemy-2-thunk-moduli">  рд╕рдорд╕реНрдпрд╛ рдирдВрдмрд░ 2 рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ред  рдердВрдХ рдореЙрдбреНрдпреВрд▓ </h2><br><p>  рдЖрдк рд╕рднреА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕реЙрд░реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдПрдХ рдердВрдХ рджреВрд╕рд░реЗ (рдЖрдпрд╛рддрд┐рдд) рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдЖрдк рдпрд╛ рддреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>jest.mock</code></a> рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╛ рдЙрд╕реА <code>jest.spyOn</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рдЖрдпрд╛рдд рдХреЛ рдорд┐рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдЙрдкрд░реЛрдХреНрдд рдХрд╛рд░реНрдп рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдХреБрдЫ рдмрд╛рд╣рд░реА рдардЧ рдХреЛ рдЖрд╡рд╢реНрдпрдХ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде <strong>рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ рдерд╛</strong> , рдЗрд╕рдХреЗ рд▓рд┐рдП рдореЛрдХ рдХреА рдЪрд┐рдВрддрд╛ рдХрд┐рдП рдмрд┐рдирд╛ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рднреА рдлрдВрдХ рдХреЛ рдЙрдирдХреЗ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рдЕрдиреБрд╕рд╛рд░ рддреЛрдбрд╝рдирд╛ рдмреЗрд╣рддрд░ рд╣реЛрдЧрд╛, рддрд╛рдХрд┐ рдЙрди рд╕рднреА рдХреЛ рдПрдХ рдвреЗрд░ рдореЗрдВ рди рд░рдЦрд╛ рдЬрд╛рдПред  рддреЛ рдРрд╕реА рддреАрди рдкреНрд░рдЬрд╛рддрд┐рдпреЛрдВ рдХреЛ рдкреНрд░рддрд┐рд╖реНрдард┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛: </p><br><ul><li>  рдЯреЗрдореНрдкреНрд▓реЗрдЯ - <code>templates</code> рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рддред </li><li>  рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд (рдЫрдВрдЯрд╛рдИ, рдХреЙрд▓рдо рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛) - <code>filter</code> ред </li><li>  рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд (рд╕реНрдХреНрд░реЙрд▓ рдХрд░рддреЗ рд╕рдордп рдирдпрд╛ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдирд╛, рдЪреВрдВрдХрд┐ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рд╕реНрдХреНрд░реЙрд▓ рд╣реИ, рдореЗрдЯрд╛-рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдирд╛, рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд░рд┐рдХреЙрд░реНрдб рдХреЗ рдХрд╛рдЙрдВрдЯрд░ рджреНрд╡рд╛рд░рд╛ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдирд╛, рдЖрджрд┐) - <code>table</code> ред </li></ul><br><p>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝реЛрд▓реНрдбрд░ рдФрд░ рдлрд╝рд╛рдЗрд▓ рд╕рдВрд░рдЪрдирд╛ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдереА: </p><br><pre> <code class="bash hljs">src/ |-- store/ | |-- filter/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- applyFilter.test.js | | | | |-- applyFilter.js | | | |-- actionCreators.js | | | |-- index.js | |-- table/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- fetchData.test.js | | | | | |-- fetchTotalCounter.test.js | | | | |-- fetchData.js | | | | |-- fetchTotalCounter.js | | | |-- actionCreators.js | | | |-- index.js (main file with actionsCreator)</code> </pre> <br><p>  рдЗрд╕ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ рд╣реИ</a> ред </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ApplyFilter рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдлрд╝рд╛рдЗрд▓ рдореЗрдВ,</a> рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдЙрд╕ рд▓рдХреНрд╖реНрдп рддрдХ рдкрд╣реБрдБрдЪ рдЪреБрдХреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╣рдо рдкреНрд░рдпрд╛рд╕ рдХрд░ рд░рд╣реЗ рдереЗ - рдЖрдк <code>fetchData</code> / <code>fetchTotalCounter</code> рдХрд╛ рд╕рд╣реА рд╕рдВрдЪрд╛рд▓рди рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдореЛрдХ рдирд╣реАрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдХрд┐рд╕ рдХреАрдордд рдкрд░ ... </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>applyFilter.js</code></a> : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applyFilterSuccess, applyFilterError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fetchData } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../../table/actions'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export function applyFilter(prefix, getCurrentStore, entityModel) { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(prefix, entityModel)(filter, dispatch); dispatch(applyFilterSuccess(prefix)(payload)); } catch (error) { dispatch(applyFilterError(prefix)(error)); } }; }; }</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>actionsCreator</code></a> </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> filterActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tableActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterStart</span></span>: tableActions.fetchTotalCounterStart(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterSuccess</span></span>: tableActions.fetchTotalCounterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterError</span></span>: tableActions.fetchTotalCounterError(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterSuccess</span></span>: filterActions.applyFilterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterError</span></span>: filterActions.applyFilterError(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: tableActions.fetchTotalCounter(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: tableActions.fetchData(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">applyFilter</span></span>: filterActions.applyFilter(prefix, getCurrentStore, entityModel) }; };</code> </pre> <br><p>  рд╣рдореЗрдВ рдХреЛрдб рдХреЗ рджреЛрд╣рд░рд╛рд╡ рдФрд░ рдПрдХ-рджреВрд╕рд░реЗ рдкрд░ рдмрд╣реБрдд рдордЬрдмреВрдд рдирд┐рд░реНрднрд░рддрд╛ рдХреЗ рд╕рд╛рде рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреА рдорд╛рдк рдХреЗ рд▓рд┐рдП рднреБрдЧрддрд╛рди рдХрд░рдирд╛ рдкрдбрд╝рд╛ред  рдХреЙрд▓ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдорд╛рдореВрд▓реА рдмрджрд▓рд╛рд╡ рд╕реЗ рднрд╛рд░реА рд░рд┐рдлреИрдХреНрдЯрд┐рдВрдЧ рд╣реЛ рдЬрд╛рдПрдЧреАред </p><br><p>  рдКрдкрд░ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, <code>table</code> рдФрд░ <code>filter</code> рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреА рд╕реНрдерд┐рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдП рдЧрдП рдереЗред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд░реАрдлреИрдХреНрдЯрд░рд┐рдВрдЧ рдХреЛ <code>templates</code> рд╕рд╛рде рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ (рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рд╕рд░рд▓ рд╣реЛ рдЧрдпрд╛ рдерд╛), рдФрд░ рд╡рд╣рд╛рдВ, рдКрдкрд░ рд░рд┐рдлреИрдХреНрдЯрд░рд┐рдВрдЧ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдХреЛ рдереЛрдбрд╝рд╛ рдмрджрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдПрдХ рдзрд╛рд░рдгрд╛ рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рдПрдХ рдкреГрд╖реНрда (рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдХреА рддрд░рд╣) рдкрд░ рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдкреИрдирд▓ рдХреЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрд╕ рд╕рдордп рдпрд╣ рд╕рд┐рд░реНрдл рдФрд░ рд╕рд┐рд░реНрдл рдпрд╣реА рдерд╛ <del>  рдЪреВрдХ </del>  рдзрд╛рд░рдгрд╛ рдиреЗ рд╣рдореЗрдВ <code>prefix</code> рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдХрд░ рдХреЛрдб рдХреЛ рдереЛрдбрд╝рд╛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреАред <br>  рдореБрдЦреНрдп рд╡рд┐рдХрд╛рд╕ рд╢рд╛рдЦрд╛ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдП рдЬрд╛рдиреЗ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВ рд╢рд╛рдВрдд рдЖрддреНрдорд╛ рдХреЗ рд╕рд╛рде рдЫреБрдЯреНрдЯреА рдкрд░ рдЧрдпрд╛ рддрд╛рдХрд┐ рд▓реМрдЯрдиреЗ рдХреЗ рдмрд╛рдж рдмрд╛рдХреА рдХреЛрдб рдХреЛ рдПрдХ рдирдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХреВрдВред </p><br><p>  рдЫреБрдЯреНрдЯреА рд╕реЗ рд▓реМрдЯрдиреЗ рдХреЗ рдмрд╛рдж, рдореБрдЭреЗ рдпрд╣ рдЬрд╛рдирдХрд░ рдЖрд╢реНрдЪрд░реНрдп рд╣реБрдЖ рдХрд┐ рдореЗрд░реЗ рдкрд░рд┐рд╡рд░реНрддрди рд╡рд╛рдкрд╕ рдХрд┐рдП рдЧрдП рдереЗред  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдПрдХ рдкреГрд╖реНрда рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛, рдЬрд┐рд╕ рдкрд░ рдХрдИ рд╕реНрд╡рддрдВрддреНрд░ рддрд╛рд▓рд┐рдХрд╛рдПрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН, рдкрд╣рд▓реЗ рдХреА рдЧрдИ рдзрд╛рд░рдгрд╛ рдиреЗ рд╕рдм рдХреБрдЫ рддреЛрдбрд╝ рджрд┐рдпрд╛ред  рдЕрддрдГ рд╕рднреА рдХрд╛рд░реНрдп рд╡реНрдпрд░реНрде рд╣реЛ рдЧрдПтАж </p><br><p>  рдЦреИрд░, рд▓рдЧрднрдЧред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╕рднреА рд╕рдорд╛рди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ (рдорд░реНрдЬ / рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдХрд╛ рд▓рд╛рдн рдЧрд╛рдпрдм рдирд╣реАрдВ рд╣реБрдЖ, рд▓реЗрдХрд┐рди рдЗрддрд┐рд╣рд╛рд╕ рдореЗрдВ рд░рд╣рд╛), рдЯреЗрдореНрдкрд▓реЗрдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рдЫреЛрдбрд╝ рджрд┐рдпрд╛, рдФрд░ рдХреЗрд╡рд▓ рдердВрдХ-рдПрд╕ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛ред  рд▓реЗрдХрд┐рди рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЕрднреА рднреА рдЕрдкрдиреА рд╕реБрд╕рдВрдЧрддрддрд╛ рдФрд░ рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рдХрд╛рд░рдг рдЖрддреНрдорд╡рд┐рд╢реНрд╡рд╛рд╕ рдХреЛ рдкреНрд░реЗрд░рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рдерд╛ред  рдЗрд╕реЗ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рдХреА рдХреЛрдИ рдЗрдЪреНрдЫрд╛ рдирд╣реАрдВ рдереА, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрд╕рдиреЗ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд╕рд╛рде рд╕рдВрдХреЗрддрд┐рдд рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ред  рдпрд╣ рдХреБрдЫ рдФрд░, рд╕рд░рд▓ рдФрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреЗ рд╕рд╛рде рдЖрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдерд╛ред </p><br><h2 id="popytka-resheniya-problemy-3-kto-ischet-tot-naydyot">  рд╕рдорд╕реНрдпрд╛ рд╕рдВрдЦреНрдпрд╛ 3 рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ред  рд╡рд╣ рдЬреЛ рдЦреЛрдЬрддрд╛ рд╣реИ рд╡рд╣ рдкрд╛ рд▓реЗрдЧрд╛ </h2><br><p>  рд╡реИрд╢реНрд╡рд┐рдХ рд░реВрдк рд╕реЗ рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ рдердВрдХ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХреИрд╕реЗ рд▓рд┐рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдХреИрд╕реЗ рдФрд░ рдХрд┐рддрдиреА рдЖрд╕рд╛рдиреА рд╕реЗ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рддрд░реАрдХреЗ (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдСрдмреНрдЬреЗрдХреНрдЯ рдлрд╝реАрд▓реНрдб) <code>entityModel</code> ред </p><br><p>  рддрдм рдпрд╣ рд╡рд┐рдЪрд╛рд░ рд╕рд╛рдордиреЗ рдЖрдпрд╛: рдХреНрдпреЛрдВ рди рдПрдХ рдРрд╕рд╛ рд╡рд░реНрдЧ рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдЬрд┐рд╕рдХреЗ рддрд░реАрдХреЗ рдардЧ рдФрд░ рдПрдХреНрд╢рди рдХреНрд░рд┐рдПрдЯрд░ рд╣реЛрдВ?  рдХрд╛рд░рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд░рд┐рдд рдХрд┐рдП рдЧрдП рдкреИрд░рд╛рдореАрдЯрд░ рдЗрд╕ рд╡рд░реНрдЧ рдХреЗ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ рдФрд░ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд▓рдн рд╣реЛрдВрдЧреЗред  рдЖрдк рддреБрд░рдВрдд рдПрдХреНрд╢рди рдХреНрд░рд┐рдПрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд░реНрдЧ рдФрд░ рдердВрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╕реЗ рдПрдХ рдЫреЛрдЯрд╛ рдЕрдиреБрдХреВрд▓рди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реЗ рд╕реЗ рдПрдХ рд╡рд╛рд░рд┐рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпреЗ рд╡рд░реНрдЧ рдПрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдВрдЧреЗ (рдЬрдм рд╡рд╛рд░рд┐рд╕ рд╡рд░реНрдЧ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рддреЗ рд╣реИрдВ), рд▓реЗрдХрд┐рди рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрдЧ рдХреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдкрдврд╝рдирд╛, рд╕рдордЭрдирд╛ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред </p><br><p>  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдХреЛрдб рд╣реИред </p><br><p>  рдЖрдЗрдП рдкреНрд░рддреНрдпреЗрдХ рджрд┐рдЦрд╛рдИ рдФрд░ рдмрджрд▓реА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>FilterActionCreators.js</code></a> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>FilterActionCreators.js</code></a> рдПрдХ рд╡рд░реНрдЧ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд╡рд┐рдзрд┐рдпрд╛рдБ рдПрдХреНрд╢рди рдХреНрд░рд┐рдПрдЯрд░ рд╣реИрдВ: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FilterActionCreators</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.prefix = config.prefix; } applyFilterSuccess = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload, }); applyFilterError = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error, }); }</code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>FilterActions.js</code></a> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>FilterActions.js</code></a> <code>FilterActionCreators</code> рд╡рд░реНрдЧ рд╕реЗ рдЗрдирд╣реЗрд░рд┐рдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕ рдХреНрд▓рд╛рд╕ рдХреА рдПрдХ рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ thunk <code>applyFilter</code> рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдПрдХреНрд╢рди <code>applyFilterSuccess</code> рдФрд░ <code>applyFilterError</code> рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActionCreators } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'/FilterActionCreators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } applyFilter = ({ fetchData }) =&gt; { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = this.getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); // Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; }; }; }</span></span></code> </pre> <br><ul><li>  рд╕рднреА рдердВрдХ рдФрд░ рдПрдХреНрд╢рди <code>FilterActions</code> рд╕рд╛рде <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореБрдЦреНрдп рдлрд╛рдЗрд▓ рдореЗрдВ</a> , рд╣рдо <code>FilterActions</code> рдХреНрд▓рд╛рд╕ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдЖрд╡рд╢реНрдпрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред  рдлрд╝рдВрдХреНрд╢рдВрд╕ рдирд┐рд░реНрдпрд╛рдд рдХрд░рддреЗ рд╕рдордп ( <code>applyFilter</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдмрд╣реБрдд рдЕрдВрдд рдореЗрдВ), <code>applyFilter</code> рдХреЛ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>applyFilter</code> рд╡рд┐рдзрд┐ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдирд╛ рди рднреВрд▓реЗрдВ: </li></ul><br><pre> <code class="diff hljs"><span class="hljs-addition"><span class="hljs-addition">+ import { FilterActions } from './filter/actions/FilterActions'; - // selector - const getFilter = store =&gt; store.filter; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + const config = { prefix, getCurrentStore, entityModel }; + const filterActions = new FilterActions(config); /* --- ACTIONS BLOCK --- */ function fetchTotalCounterStart() { return { type: `${prefix}FETCH_TOTAL_COUNTER_START` }; } function fetchTotalCounterSuccess(payload) { return { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload }; } function fetchTotalCounterError(error) { return { type: `${prefix}FETCH_TOTAL_COUNTER_ERROR`, error }; } - function applyFilterSuccess(payload) { - return { type: `${prefix}APPLY_FILTER_SUCCESS`, payload }; - } - - function applyFilterError(error) { - return { type: `${prefix}APPLY_FILTER_ERROR`, error }; - } /* --- THUNKS BLOCK --- */ function fetchTotalCounter(filter) { return async dispatch =&gt; { dispatch(fetchTotalCounterStart()); try { const { data: { payload } } = await entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } catch (error) { dispatch(fetchTotalCounterError(error)); } }; } function fetchData(filter, dispatch) { dispatch(fetchTotalCounter(filter)); return entityModel.fetchData(filter); } - function applyFilter(newFilter) { - return async (dispatch, getStore) =&gt; { - try { - const store = getStore(); - const currentStore = getCurrentStore(store); - // 'getFilter' comes from selectors. - const filter = newFilter || getFilter(currentStore); - const { data: { payload } } = await fetchData(filter, dispatch); - - dispatch(applyFilterSuccess(payload)); - } catch (error) { - dispatch(applyFilterError(error)); - } - }; - } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, - applyFilterSuccess, - applyFilterError, fetchTotalCounter, fetchData, - applyFilter + ...filterActions, + applyFilter: filterActions.applyFilter({ fetchData }), }; };</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░реАрдХреНрд╖рдг</a> рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдФрд░ рдкрдврд╝рдиреЗ рдореЗрдВ рджреЛрдиреЛрдВ рдЖрд╕рд╛рди рд╣реЛ рдЧрдП рд╣реИрдВ: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../FilterActions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'FilterActions'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> store; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dispatch = jest.fn(); beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch.mockClear(); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterSuccess = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterSuccess'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterError = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterError'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre><br><p>  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдкрд░реАрдХреНрд╖рдгреЛрдВ рдореЗрдВ, рдЖрдк рдЕрдВрддрд┐рдо рдЬрд╛рдВрдЪ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">- expect(applyFilterSuccess).toBeCalledWith(payload); + expect(dispatch).toBeCalledWith(applyFilterSuccess(payload)); - expect(applyFilterError).toBeCalledWith(error); + expect(dispatch).toBeCalledWith(applyFilterError(error));</span></span></code> </pre> <br><p>  рддрдм рдЙрдиреНрд╣реЗрдВ <code>jest.spyOn</code> рд╕рд╛рде <code>jest.spyOn</code> рдХрд░рдиреЗ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред    ,  ,            .        thunk,       .    ,    ... </p><br><p>    ,  ,    ,     -: ,  thunk-  action creator-      ,    ,   .        ,   .         <code>actionsCreator</code> -   ,   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions/FilterActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TemplatesActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./templates/actions/TemplatesActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TableActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions/TableActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TemplatesActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TableActions(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...filterActions, ...templatesActions, ...tableActions, }; };</code> </pre> <br><p>     .     <code>filterActions</code>          <code>templatesActions</code>  <code>tableActions</code> ,   ,   ,     <code>filterActions</code> ?           ,    .           .         - ,      ,    . </p><br><p>   .      ,     back-end  (  Java),      .   ,  Java/Spring      ,   .         - ? </p><br><p>      : </p><br><ul><li>    thunk-   <code>setDependencies</code> ,        тАФ <code>dependencies</code> : </li></ul><br><pre> <code class="diff hljs">export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } + setDependencies = dependencies =&gt; { + this.dependencies = dependencies; + };</code> </pre> <br><ul><li>                     : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const actions = { + ...filterActions, + ...templatesActions, + ...tableActions, + }; + + filterActions.setDependencies(actions); + templatesActions.setDependencies(actions); + tableActions.setDependencies(actions); + return actions; - return { - ...filterActions, - ...templatesActions, - ...tableActions, - }; };</code> </pre> <br><ul><li>     <code>this.dependencies</code> : </li></ul><br><pre> <code class="javascript hljs">applyFilter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { fetchData } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore(store); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = newFilter || getFilter(currentStore); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetchData(filter, dispatch); <span class="hljs-comment"><span class="hljs-comment">// Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; };</span></span></code> </pre> <br><p>    ,        <code>applyFilter</code>   ,   -  <code>this.dependencies</code>    .         ,         . </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from '../FilterActions'; describe('FilterActions', () =&gt; { const prefix = 'TEST_'; const getCurrentStore = store =&gt; store; const entityModel = {}; + const dependencies = { + fetchData: jest.fn(), + }; const config = { prefix, getCurrentStore, entityModel }; const actions = new FilterActions(config); + actions.setDependencies(dependencies); const dispatch = jest.fn(); beforeEach(() =&gt; { dispatch.mockClear(); }); describe('applyFilter', () =&gt; { const getStore = () =&gt; ({}); const newFilter = {}; it('should dispatch correct actions on success', async () =&gt; { const payload = {}; - const fetchData = jest.fn().mockResolvedValueOnce({ data: { payload } }); + dependencies.fetchData.mockResolvedValueOnce({ data: { payload } }); const applyFilterSuccess = jest.spyOn(actions, 'applyFilterSuccess'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it('should dispatch correct actions on error', async () =&gt; { const error = {}; - const fetchData = jest.fn().mockRejectedValueOnce(error); + dependencies.fetchData.mockRejectedValueOnce(error); const applyFilterError = jest.spyOn(actions, 'applyFilterError'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre> <br><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> . </p><br><p>       ,   ,            : </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; - export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + export const actionsCreator = (prefix, getCurrentStore, entityModel, ExtendedActions) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const extendedActions = ExtendedActions ? new ExtendedActions(config) : undefined; const actions = { ...filterActions, ...templatesActions, ...tableActions, + ...extendedActions, }; filterActions.setDependencies(actions); templatesActions.setDependencies(actions); tableActions.setDependencies(actions); + if (extendedActions) { + extendedActions.setDependencies(actions); + } return actions; };</code> </pre> <br><ul><li>   <code>ExtendedActions</code>    ,     : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendedActions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore = config.getCurrentStore; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityModel = config.entityModel; } setDependencies = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dependencies</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies = dependencies; }; <span class="hljs-comment"><span class="hljs-comment">// methods to re-define }</span></span></code> </pre> <br><p>  ,    ,   : </p><br><ul><li>    ,     . </li><li>      . </li><li>     ,   ,     thunk-         . </li><li>   ,      ,   thunk-/action creator-      99-100%. </li></ul><br><h2 id="bonus">  </h2><br><p>   action creator-     ( <code>filter</code> , <code>templates</code> , <code>table</code> ),   reducer-   -  ,        ,    <code>actionsCreator</code> - ,         reducer-  ~400-500  . </p><br><p>      : </p><br><ul><li>   reducer-: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> isNull <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash/isNull'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getDefaultState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../getDefaultState'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { templatesReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/templates/reducers/templatesReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { filterReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/filter/reducers/filterReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { tableReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/table/reducers/tableReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createTableReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> prefix, initialState = getDefaultState(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entityModel</span></span></span><span class="hljs-function">, ) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, initialState, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesReducer = templatesReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterReducer = filterReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducer = tableReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesState = templatesReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(templatesState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> templatesState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterState = filterReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(filterState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filterState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableState = tableReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(tableState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tableState; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }; };</code> </pre> <br><ul><li> <code>tableReducerConfigurator</code> ( ): </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducerConfigurator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ prefix, entityModel }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: action.payload, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.error, }; } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }; };</code> </pre> <br><p>  : </p><br><ol><li>   <code>reducerConfigurator</code> -    action type-,   ┬л┬╗.  action type      case,    <em>null</em> (). </li><li>   <code>reducerConfigurator</code> -      ,  <em>null</em> ,     <code>reducerConfigurator</code> -  <em>!null</em> .    ,    <code>reducerConfigurator</code> -   case,      <code>reducerConfigurator</code> -. </li><li>   ,      <code>reducerConfigurator</code> -    case-   action type-,     (  reducer-). </li></ol><br><p>    ,    <code>actionsCreator</code> -,     ,      ,  ,  . </p><br><p>   ,   ! <br> ,             Redux Thunk. </p><br><p>   ,    Redux Thunk      .   ,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi469371/">https://habr.com/ru/post/hi469371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi469355/index.html">рдПрдХ рдмреЛрд░рд┐рдВрдЧ NumPy рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓</a></li>
<li><a href="../hi469357/index.html">рднрд╛рдЧреЛ, рдЧреЛрдлрд░, рднрд╛рдЧреЛ! - рд╣рдо рдЧреЛрд▓рдВрдЧрдХреЙрдиреНрдлрд╝ рдореЗрдВ рдХреНрдпрд╛ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗ</a></li>
<li><a href="../hi469361/index.html">рджрд░реНрдж рдФрд░ рдЖрдБрд╕реВ Svelte 3 рдореЗрдВ</a></li>
<li><a href="../hi469367/index.html">Windows рдХреЗ рдЕрдВрддрд░реНрдЧрдд STM32CubeIDE рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЗрдХрд╛рдИ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдВ</a></li>
<li><a href="../hi469369/index.html">30 рд╕рд┐рддрдВрдмрд░ рд╕реЗ 06 рдЕрдХреНрдЯреВрдмрд░ рддрдХ рдорд╛рд╕реНрдХреЛ рдореЗрдВ рдбрд┐рдЬрд┐рдЯрд▓ рдХрд╛рд░реНрдпрдХреНрд░рдо</a></li>
<li><a href="../hi469373/index.html">рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓рдХрд╡рд╛рдЧреНрд░рд╕реНрдд рд░реЛрдЧрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдиреЗ рдкреНрд░рд╢реНрди рдореЗрдВ рдмреБрд▓рд╛рдпрд╛ рд╣реИ</a></li>
<li><a href="../hi469375/index.html">рдореЛрдЬрд╝рд┐рд▓рд╛, рдХреЙрдЗрд▓ рдФрд░ рдХреНрд░рд┐рдПрдЯрд┐рд╡ рдХреЙрдордиреНрд╕ рдиреЗ рдУрдкрди рд╕реЛрд░реНрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП $ 100 рдорд┐рд▓рд┐рдпрди рдХреНрдпреЛрдВ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рд╣реИрдВ?</a></li>
<li><a href="../hi469379/index.html">рдпреВрдЖрдИ рдХреЗ рд▓рд┐рдП рдФрдкрдЪрд╛рд░рд┐рдХ рдореЙрдбрд▓ рд╕рддреНрдпрд╛рдкрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ</a></li>
<li><a href="../hi469381/index.html">рдПрдЧреЛрдиреНрд╕, рдПрдХ рдмрд╣реБ-рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧреЗрдо рд╕рд░реНрд╡рд░ рдмрдирд╛рддреЗ рд╣реИрдВред рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдФрд░ рд╕реНрдерд╛рдкрдирд╛</a></li>
<li><a href="../hi469383/index.html">Hyperconverged рд╕рдорд╛рдзрд╛рди AERODISK vAIRред рдЖрдзрд╛рд░ - ARDFS рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>