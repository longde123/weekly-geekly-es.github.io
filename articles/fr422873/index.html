<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•õ üßëüèª üèª Pizza ala semi-supervis√©e üë®üèª‚Äçüî¨ ü§† üê©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je voudrais parler de certaines techniques pour travailler avec des donn√©es lors de la formation d'un mod√®le. En particulier, commen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pizza ala semi-supervis√©e</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ods/blog/422873/">  Dans cet article, je voudrais parler de certaines techniques pour travailler avec des donn√©es lors de la formation d'un mod√®le.  En particulier, comment extraire la segmentation des objets sur les bo√Ætes, ainsi que comment entra√Æner le mod√®le et obtenir le balisage de l'ensemble de donn√©es, en ne marquant que quelques √©chantillons. <br><img src="https://habrastorage.org/webt/wo/lz/ab/wolzab2hx3sxc7qnqrmrucfhynk.png"><br><a name="habracut"></a><br><h2>  D√©fi </h2><br>  Il existe un certain processus de fabrication de pizza et de photos √† partir de ses diff√©rentes √©tapes (y compris non seulement la pizza).  Il est connu que si la recette de la p√¢te est g√¢t√©e, il y aura des boutons blancs sur la cro√ªte.  Il existe √©galement un marquage binaire de la qualit√© du test pour chaque exemple de pizza, r√©alis√© par des experts.  Il est n√©cessaire de d√©velopper un algorithme qui d√©terminera la qualit√© du test √† partir d'une photographie. <br><br>  L'ensemble de donn√©es se compose de photographies prises √† partir de diff√©rents t√©l√©phones, dans diff√©rentes conditions, sous diff√©rents angles.  Instances de pizza - 17k.  Nombre total de photos - 60k. <br><br>  √Ä mon avis, la t√¢che est assez typique et bien adapt√©e pour montrer diff√©rentes approches de traitement des donn√©es.  Pour le r√©soudre, vous devez: <br><br>  1. Choisissez des photos o√π il y a une cro√ªte de pizza; <br>  2. Sur les photos s√©lectionn√©es, mettez en surbrillance le g√¢teau; <br>  3. Entra√Ænez le r√©seau neuronal dans les zones s√©lectionn√©es. <br><br><h2>  Filtrer les photos </h2><br>  √Ä premi√®re vue, il semble que le moyen le plus simple serait de confier cette t√¢che aux scribers, puis de former l'ensemble de donn√©es sur des donn√©es propres.  Cependant, j'ai d√©cid√© qu'il √©tait plus facile pour moi de marquer moi-m√™me une petite partie que d'expliquer avec un scribe quel angle √©tait correct.  De plus, je n'avais pas de crit√®re dur pour l'angle droit. <br><br>  Voici donc ce que j'ai fait: <br><br>  1. 100 photos de bord marqu√©es; <br><br><img src="https://habrastorage.org/webt/r3/_e/po/r3_epoxo9v9p_e0aljlsnqcdgge.png"><br><br>  2. Comptage des entit√©s apr√®s extraction globale de la grille resnet-152 avec les poids de imagenet11k_places365; <br><br><img src="https://habrastorage.org/webt/im/my/0c/immy0cck12em7iyx24yrxyzubwy.png"><br><br>  3. A pris la moyenne des caract√©ristiques de chaque classe, recevant deux ancres; <br><br>  4. J'ai calcul√© la distance entre chaque ancre et toutes les caract√©ristiques des 50 000 photos restantes; <br><br>  5. Le top 300 √† proximit√© d'une ancre est pertinent pour la classe positive, le top 500 de la plus proche d'une autre ancre est n√©gatif; <br><br><img src="https://habrastorage.org/webt/ga/wn/xn/gawnxnw_jio9rg8yboqzqb3rmac.png"><br><br>  6. J'ai form√© LightGBM sur ces √©chantillons avec les m√™mes fonctionnalit√©s (XGboost est indiqu√© dans l'image, car il a un logo et est plus reconnaissable, mais LightGBM n'a pas de logo); <br><br>  7. En utilisant ce mod√®le, j'ai obtenu le balisage de l'ensemble de donn√©es complet. <br><br><img src="https://habrastorage.org/webt/bd/vb/rq/bdvbrqhqcf5crt3scgwhw5zttms.png"><br><br>  J'ai utilis√© approximativement la m√™me approche dans les comp√©titions de kaggle comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ligne de base</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Une explication sur les doigts pourquoi cette approche fonctionne m√™me</b> <div class="spoiler_text">  Un r√©seau de neurones peut √™tre per√ßu comme une transformation fortement non lin√©aire d'une image.  Dans le cas de la classification, l'image est convertie en probabilit√©s des classes qui √©taient dans l'ensemble d'apprentissage.  Et ces probabilit√©s peuvent essentiellement √™tre utilis√©es comme fonctionnalit√©s pour Light GBM.  Cependant, c'est une description plut√¥t m√©diocre, et dans le cas de la pizza, nous dirons donc que la classe de g√¢teau est conditionnellement 0,3 chat et 0,7 chien, et la poubelle est le reste.  Au lieu de cela, vous pouvez utiliser des fonctionnalit√©s moins clairsem√©es apr√®s le regroupement moyen global.  Ils ont une telle propri√©t√© que les caract√©ristiques sont g√©n√©r√©es √† partir des √©chantillons de l'ensemble d'apprentissage, qui doivent √™tre s√©par√©s par une transformation lin√©aire (une couche enti√®rement connect√©e avec Softmax).  Cependant, √©tant donn√© qu'il n'y avait pas de pizza explicite dans le train imagenet, il est pr√©f√©rable de prendre une transformation non lin√©aire sous forme d'arbres pour s√©parer les classes du nouvel ensemble d'entra√Ænement.  En principe, vous pouvez aller encore plus loin et prendre des fonctionnalit√©s de certaines couches interm√©diaires du r√©seau neuronal.  Ils seront meilleurs dans la mesure o√π ils n'ont pas encore perdu la localisation des objets.  Mais ils sont bien pires en raison de la taille du vecteur d'entit√©s.  Et en plus, ils sont moins lin√©aires qu'en face d'une couche enti√®rement connect√©e. <br></div></div><br><h2>  Une l√©g√®re digression </h2><br>  ODS s'est r√©cemment plaint que personne n'√©crive sur leurs √©checs.  Corriger la situation.  Il y a environ un an, j'ai particip√© au concours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kaggle Sea Lions</a> avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Eugene Nizhibitsky</a> .  La t√¢che consistait √† compter les otaries √† fourrure dans les images du drone.  Le balisage a √©t√© donn√© simplement sous la forme de coordonn√©es de carcasse, mais √† un moment donn√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vladimir Iglovikov les a</a> marqu√©es avec des bo√Ætes et a g√©n√©reusement partag√© cela avec la communaut√©.  √Ä cette √©poque, je me consid√©rais comme un p√®re de segmentation s√©mantique (apr√®s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kaggle Dstl</a> ) et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">j'ai</a> d√©cid√© qu'Unet faciliterait grandement la t√¢che de comptage si j'apprenais √† distinguer classiquement les chats. <br><br><div class="spoiler">  <b class="spoiler_title">Explication de la segmentation s√©mantique</b> <div class="spoiler_text">  La segmentation s√©mantique est essentiellement une classification pixel par pixel d'une image.  Autrement dit, chaque pixel source de l'image doit √™tre associ√© √† une classe.  Dans le cas d'une segmentation binaire (cas de l'article), ce sera soit une classe positive soit une classe n√©gative.  Dans le cas de la segmentation multiclasse, chaque pixel se verra attribuer une classe de l'ensemble d'apprentissage (fond, herbe, chat, homme, etc.).  Dans le cas de la segmentation binaire, l'architecture du r√©seau neuronal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">U-net</a> fonctionnait bien √† l'√©poque.  Ce r√©seau de neurones a une structure similaire √† un codeur-d√©codeur conventionnel, mais avec une transmission de caract√©ristiques de la partie codeur au d√©codeur aux √©tages de taille appropri√©e. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cdf/52f/999/cdf52f99903a93bd403db1b073f19ba0.png"><br><br>  Sous forme vanille, cependant, personne ne l'utilise plus, mais au moins ils ajoutent la norme de lot.  Eh bien, en r√®gle g√©n√©rale, ils prennent un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gros encodeur</a> et gonflent le d√©codeur.  Les architectures de type U-net ont √©t√© remplac√©es par de nouvelles grilles de segmentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FPN</a> , qui affichent de bonnes performances sur certaines t√¢ches.  Cependant, les architectures de type Unet n'ont pas perdu de leur pertinence √† ce jour.  Ils fonctionnent bien comme ligne de base, ils sont faciles √† former et il est tr√®s simple de faire varier la profondeur / la taille des neurosciences en changeant diff√©rents eccodeurs. <br></div></div><br>  En cons√©quence, j'ai commenc√© √† enseigner la segmentation, n'ayant pour cible au premier stade que des chats de boxe.  Apr√®s la premi√®re √©tape de la formation, j'ai pr√©dit le train et regard√© √† quoi ressemblaient les pr√©dictions.  √Ä l'aide de l'heuristique, on pourrait s√©lectionner la confiance abstraite dans le masque et diviser conditionnellement les pr√©dictions en deux groupes: o√π tout est bon et o√π tout est mauvais. <br><br><img src="https://habrastorage.org/webt/wx/84/jt/wx84jttvncmdiykyt25csspnyec.png"><br><br>  Des pr√©dictions o√π tout va bien pourraient √™tre utilis√©es pour former la prochaine it√©ration du mod√®le.  Les pr√©dictions, o√π tout va mal, pourraient √™tre choisies avec de grandes zones sans scell√©s, les mains masqu√©es et √©galement jet√©es dans le train.  Et donc de mani√®re it√©rative, Eugene et moi avons form√© un mod√®le qui a m√™me appris √† segmenter les nageoires d'otaries √† fourrure pour les gros individus. <br><br><img src="https://habrastorage.org/webt/_a/g6/xz/_ag6xzccipgeizeek1qnncwxz4k.png"><br><br>  Mais ce fut un √©chec f√©roce: nous avons pass√© beaucoup de temps √† apprendre √† segmenter les chats cool et ... Cela n'a presque pas aid√© dans leur calcul.  L'hypoth√®se que la densit√© des phoques (le nombre d'individus par unit√© de surface du masque) est constante n'a pas fonctionn√©, car le drone a vol√© √† diff√©rentes hauteurs et les images avaient des √©chelles diff√©rentes.  Et en m√™me temps, la segmentation n'indiquait toujours pas les individus individuels s'ils √©taient serr√©s - ce qui arrivait assez souvent.  Et avant l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">approche innovante de la s√©paration des objets</a> de l'√©quipe Tocoder au DSB2018, il y avait encore une ann√©e.  En cons√©quence, nous sommes rest√©s avec rien mais avons termin√© √† la 40e place sur 600 √©quipes. <br><br>  Cependant, j'ai fait deux conclusions: la segmentation s√©mantique est une approche pratique pour visualiser et analyser le fonctionnement de l'algorithme, et les masques peuvent √™tre soud√©s √† partir des bo√Ætes avec un certain effort. <br><br>  Mais revenons √† la pizza.  Afin de mettre en √©vidence le g√¢teau sur les photos s√©lectionn√©es et filtr√©es, l'option la plus correcte serait de confier la t√¢che aux scribers.  √Ä cette √©poque, nous avions d√©j√† impl√©ment√© les bo√Ætes et l'algorithme de consensus pour elles.  Je viens donc de jeter quelques exemples et de les donner au balisage.  En cons√©quence, j'ai obtenu 500 √©chantillons avec une zone de cro√ªte s√©lectionn√©e avec pr√©cision. <br><br><img src="https://habrastorage.org/webt/pd/pr/nh/pdprnh1katpk2nl7gzq-edoy8cm.png"><br><br>  Ensuite, j'ai d√©terr√© mon code des scell√©s et j'ai approch√© plus formellement la proc√©dure actuelle.  Apr√®s la premi√®re it√©ration de la formation, il √©tait √©galement clairement visible o√π le mod√®le s'√©tait tromp√©.  Et la confiance des pr√©dictions peut √™tre d√©finie comme suit: <br>  1 - (zone grise) / (zone de masque) # il y aura une formule, je le promets <br><br><img src="https://habrastorage.org/webt/hz/eb/9d/hzeb9dqh2fazgyo0gpdclqbp1du.png"><br><br>  Maintenant, pour faire la prochaine it√©ration de tirer les bo√Ætes sur les masques, un petit ensemble pr√©dira le train TTA.  Cela peut √™tre consid√©r√© dans une certaine mesure comme une distillation des connaissances WAAAAGH, mais il est plus correct d'appeler le pseudo √©tiquetage. <br><br><img src="https://habrastorage.org/webt/qk/he/eo/qkheeobxrxzxbim3gk8s8gihoyu.png"><br><br>  Ensuite, vous devez choisir avec vos yeux un certain seuil de confiance, √† partir duquel nous formons un nouveau train.  Et vous pouvez √©ventuellement marquer les √©chantillons les plus complexes que l'ensemble n'a pas pu g√©rer.  J'ai d√©cid√© que ce serait utile et j'ai peint une vingtaine de photos quelque part en dig√©rant le d√©jeuner. <br><br><img src="https://habrastorage.org/webt/13/4e/wz/134ewz9jgris1o-9jmss90qt7ew.png"><br><br>  Et maintenant, la derni√®re partie du pipeline: la formation de mod√®les.  Pour pr√©parer les √©chantillons, j'ai extrait la zone du masque du g√¢teau.  J'ai √©galement gonfl√© un peu le masque avec dilatation et l'ai appliqu√© √† l'image pour supprimer l'arri√®re-plan, car il ne devrait pas y avoir d'informations sur la qualit√© du test.  Et puis je viens de d√©poser plusieurs mod√®les du zoo d'Imagenet.  Au total, j'ai pu collecter environ 12 000 √©chantillons confiants.  Par cons√©quent, je n'ai pas enseign√© l'ensemble du r√©seau neuronal, mais seulement le dernier groupe de convolutions, afin que le mod√®le ne soit pas recycl√©. <br><br><div class="spoiler">  <b class="spoiler_title">Pourquoi vous devez geler les couches</b> <div class="spoiler_text">  Il y a deux b√©n√©fices √† cela: 1. Le r√©seau apprend plus vite, car vous n'avez pas besoin de lire les d√©grad√©s pour les couches fig√©es.  2. Le r√©seau n'est pas recycl√©, car il a d√©sormais moins de param√®tres libres.  On soutient que les premiers groupes de circonvolutions au cours de la formation sur Imagenet g√©n√®rent des signes assez communs tels que des transitions de couleurs nettes et des textures qui conviennent √† une tr√®s large classe d'objets en photographie.  Cela signifie que vous ne pouvez pas les former pendant l'apprentissage Transer. <br></div></div><br><img src="https://habrastorage.org/webt/_1/vq/-5/_1vq-5oea_ikx7b68me9v_hrjq0.png"><br><br>  Le meilleur mod√®le unique √©tait Inception-Resnet-v2, et pour elle, le ROC-AUC sur un pli √©tait de 0,700.  Si vous ne s√©lectionnez rien et soumettez des images brutes telles quelles, alors ROC-AUC est 0,58.  Pendant que je d√©veloppais la solution, le prochain lot de donn√©es a √©t√© cuit chez DODO pizza, et il a √©t√© possible de tester l'ensemble du pipeline sur une tenue honn√™te.  Nous avons v√©rifi√© tout le pipeline et obtenu ROC-AUC 0,83. <br><br>  Regardons maintenant les erreurs: <br><br>  Top False Negative <br><br><img src="https://habrastorage.org/webt/nc/as/lz/ncaslzpmdyudlv5joncem_h9gcy.png"><br><br>  On peut voir ici qu'ils sont associ√©s √† une erreur de marquage du g√¢teau, car il y a clairement des signes d'un test g√¢t√©. <br><br>  Top des faux positifs <br><br><img src="https://habrastorage.org/webt/bu/hn/cz/buhncz0hnwtl5mf2l5bhqbfuat0.png"><br><br>  Ici, les erreurs sont li√©es au fait que le premier mod√®le a √©t√© choisi pas un tr√®s bon angle, selon lequel il est difficile de trouver des signes cl√©s de la qualit√© du test. <br><br><h2>  Conclusion </h2><br>  Des coll√®gues me taquinent parfois que je r√©sous de nombreux probl√®mes par segmentation en utilisant Unet.  Cependant, √† mon avis, c'est une approche assez puissante et pratique.  Il vous permet de visualiser les erreurs du mod√®le et la confiance de ses pr√©dictions.  De plus, l'ensemble de la ligne de paiement semble tr√®s simple et il existe maintenant un tas de r√©f√©rentiels pour n'importe quel cadre. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422873/">https://habr.com/ru/post/fr422873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422863/index.html">Tribus, guildes, build train et no TDD: comment fonctionne le d√©veloppement mobile dans Uber, Spotify, Odnoklassniki et Avito</a></li>
<li><a href="../fr422865/index.html">Java Enterprise Open Lesson "CDI en action"</a></li>
<li><a href="../fr422867/index.html">D√©termination du nombre d'√©tages d'une maison √† partir de sa photo sans apprentissage automatique</a></li>
<li><a href="../fr422869/index.html">Nous ma√Ætrisons de nouveaux langages de programmation, en nous appuyant sur les acquis</a></li>
<li><a href="../fr422871/index.html">Identifier des profils significatifs dans VK</a></li>
<li><a href="../fr422875/index.html">Pourquoi ne pas louer un VPS / VDS pour 200 roubles ou comment choisir le bon serveur virtuel</a></li>
<li><a href="../fr422877/index.html">"Est-ce l'IdO?" - apprenez √† ne pas appeler l'internet des objets d'affil√©e</a></li>
<li><a href="../fr422879/index.html">Security Week 34: pourquoi les routeurs se brisent</a></li>
<li><a href="../fr422881/index.html">Pr√©sentation de SOCI - Biblioth√®que d'acc√®s √† la base de donn√©es C ++</a></li>
<li><a href="../fr422883/index.html">Votre copywriting est nul. Voici comment y rem√©dier.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>