<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêâ üïã üëÆ PVS-Studio inclui suporte para o GNU Arm Embedded Toolchain üó≥Ô∏è üà∏ üë©‚Äç‚ù§Ô∏è‚Äçüë©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os sistemas embarcados h√° muito e firmemente entraram em nossas vidas. Os requisitos para sua estabilidade e confiabilidade s√£o muito altos e a corre√ß...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio inclui suporte para o GNU Arm Embedded Toolchain</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/427447/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/427/f4c/fef427f4c05625dec0a8cfd484ad79d0.png" alt="Cadeia de ferramentas embarcada GNU Arm + PVS-Studio"></div><br>  Os sistemas embarcados h√° muito e firmemente entraram em nossas vidas.  Os requisitos para sua estabilidade e confiabilidade s√£o muito altos e a corre√ß√£o de erros √© cara.  Portanto, √© especialmente importante que os desenvolvedores incorporados usem regularmente ferramentas especializadas para garantir a qualidade do c√≥digo-fonte.  Este artigo abordar√° o suporte da GNU Arm Embedded Toolchain no analisador PVS-Studio e os defeitos de c√≥digo encontrados no projeto Mbed OS. <br><a name="habracut"></a><br><h2>  1. Introdu√ß√£o </h2><br>  O analisador PVS-Studio j√° suporta v√°rios compiladores comerciais para sistemas embarcados, por exemplo: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IAR Embedded Workbench</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Keil Ferramentas de desenvolvimento incorporadas para arm</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ferramentas de gera√ß√£o de c√≥digo TI ARM</a> </li></ul><br>  Agora, outra ferramenta de desenvolvedor foi adicionada para oferecer suporte - o GNU Embedded Toolchain. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O GNU Embedded Toolchain</a> √© uma cole√ß√£o de compiladores da Arm baseados na GNU Compiler Collection.  O primeiro lan√ßamento oficial ocorreu em 2012 e, desde ent√£o, o projeto vem sendo desenvolvido em conjunto com o GCC. <br><br>  O principal objetivo do GNU Embedded Toolchain √© gerar c√≥digo que √© executado no bare metal, ou seja, diretamente no processador sem um intercalar na forma de um sistema operacional.  O pacote inclui compiladores para C e C ++, assembler, um conjunto de utilit√°rios GNU Binutils e a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Newlib</a> .  O c√≥digo fonte de todos os componentes √© totalmente aberto e licenciado sob a GNU GPL.  No site oficial, voc√™ pode baixar vers√µes para Windows, Linux e macOS. <br><br><h2>  Mbed OS </h2><br>  Para testar o analisador, voc√™ precisa do c√≥digo-fonte poss√≠vel.  Geralmente, n√£o h√° problema com isso, mas quando estamos lidando com desenvolvimento incorporado voltado principalmente para dispositivos inclu√≠dos na IoT, pode ser dif√≠cil encontrar um n√∫mero suficiente de projetos grandes.  Felizmente, esse problema foi resolvido por sistemas operacionais especializados, cujo c√≥digo fonte na maioria dos casos est√° aberto.  Al√©m disso, falaremos sobre um deles. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb9/5b1/8a8/bb95b18a83f4b1b97c8cb2519c6d7018.png" alt="Mbed OS + PVS-Studio"></div><br><br>  Embora o principal objetivo deste artigo seja falar sobre o suporte ao GNU Embedded Toolchain, √© dif√≠cil escrever muito sobre isso.  Al√©m disso, os leitores de nossos artigos provavelmente est√£o aguardando uma descri√ß√£o de alguns erros interessantes.  Bem, n√£o vamos enganar as expectativas deles e executar o analisador no projeto Mbed OS.  Este √© um sistema operacional de c√≥digo aberto desenvolvido com a assist√™ncia da Arm. <br><br>  Site oficial: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.mbed.com/</a> <br><br>  C√≥digo fonte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/ARMmbed/mbed-os</a> <br><br>  A escolha no Mbed OS n√£o caiu por acidente, eis como os autores descrevem o projeto: <br><br>  O Arm Mbed OS √© um sistema operacional incorporado de c√≥digo aberto projetado especificamente para as "coisas" na Internet das Coisas.  Inclui todos os recursos necess√°rios para desenvolver um produto conectado com base em um microcontrolador Arm Cortex-M, incluindo seguran√ßa, conectividade, um RTOS e drivers para sensores e dispositivos de E / S. <br><br>  Este √© um projeto de constru√ß√£o ideal usando o GNU Embedded Toolchain, especialmente considerando o envolvimento da Arm em seu desenvolvimento.  Farei uma reserva imediatamente que n√£o tinha o objetivo de encontrar e mostrar o maior n√∫mero poss√≠vel de erros em um projeto espec√≠fico, para que os resultados da revis√£o sejam revisados ‚Äã‚Äãbrevemente. <br><br><h2>  Erros </h2><br>  Durante a verifica√ß√£o do c√≥digo do Mbed OS, o analisador PVS-Studio gerou 693 avisos, 86 deles com alta prioridade.  N√£o vou consider√°-los todos em detalhes, principalmente porque muitos deles s√£o repetidos ou n√£o t√™m interesse particular.  Por exemplo, o analisador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gerou</a> muitos avisos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V547</a> (Express√£o sempre verdadeira / falsa) relacionados aos mesmos fragmentos de c√≥digo.  O analisador pode ser configurado para reduzir significativamente o n√∫mero de respostas falsas e desinteressantes, mas essa tarefa n√£o foi definida ao escrever um artigo.  Quem desejar pode ver um exemplo dessa configura√ß√£o descrito no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Especifica√ß√µes do analisador PVS-Studio usando o exemplo das bibliotecas principais da EFL, 10 a 15% dos falsos positivos</a> ". <br><br>  Para o artigo, selecionei alguns erros interessantes para demonstrar a opera√ß√£o do analisador. <br><br><h2>  Vazamentos de mem√≥ria </h2><br>  Vamos come√ßar com a classe comum de erros em C e C ++ - vazamentos de mem√≥ria. <br><br>  Aviso do analisador: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V773</a> CWE-401 A fun√ß√£o foi encerrada sem liberar o ponteiro 'read_buf'.  √â poss√≠vel um vazamento de mem√≥ria.  cfstore_test.c 565 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> cfstore_test_init_1(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { .... read_buf = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(max_len); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(read_buf == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { CFSTORE_ERRLOG(....); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(node-&gt;key_name != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { .... ret = drv-&gt;Create(....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ret &lt; ARM_DRIVER_OK){ CFSTORE_ERRLOG(....); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } .... free(read_buf); return ret; }</span></span></code> </pre> <br>  A situa√ß√£o cl√°ssica ao trabalhar com mem√≥ria din√¢mica.  O buffer alocado em <i>malloc</i> √© usado apenas dentro da fun√ß√£o e liberado antes de sair.  O problema √© que isso n√£o acontece se a fun√ß√£o parar de funcionar mais cedo.  Observe o mesmo c√≥digo nos blocos <i>if</i> .  Provavelmente, o autor copiou o fragmento superior e esqueceu de adicionar uma chamada <i>gratuita</i> . <br><br>  Outro exemplo semelhante ao anterior. <br><br>  Aviso do analisador: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V773</a> CWE-401 A fun√ß√£o foi encerrada sem liberar o ponteiro da 'interface'.  √â poss√≠vel um vazamento de mem√≥ria.  nanostackemacinterface.cpp 204 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">nsapi_error_t</span></span> Nanostack::add_ethernet_interface( EMAC &amp;emac, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> default_if, Nanostack::EthernetInterface **interface_out, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *mac_addr) { .... Nanostack::EthernetInterface *interface; interface = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (nothrow) Nanostack::EthernetInterface(*single_phy); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!interface) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NSAPI_ERROR_NO_MEMORY; } <span class="hljs-keyword"><span class="hljs-keyword">nsapi_error_t</span></span> err = interface-&gt;initialize(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } *interface_out = interface; return NSAPI_ERROR_OK; }</span></span></code> </pre> <br>  O ponteiro para a mem√≥ria alocada √© retornado atrav√©s do par√¢metro de sa√≠da, mas somente se a chamada de <i>inicializa√ß√£o</i> for bem-sucedida e, no caso de um erro, ocorrer√° um vazamento porque a vari√°vel de <i>interface</i> local fica fora do escopo e o ponteiro √© simplesmente perdido.  Aqui, deve-se chamar <i>delete</i> ou, pelo menos, fornecer o endere√ßo armazenado na vari√°vel da <i>interface</i> para o exterior em qualquer caso, para que o c√≥digo de chamada possa cuidar disso. <br><br><h2>  Memset </h2><br>  O uso da fun√ß√£o <i>memset</i> geralmente leva a erros; exemplos dos problemas associados a ela podem ser encontrados no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A fun√ß√£o mais perigosa do mundo C / C ++</a> ". <br><br>  Considere o seguinte aviso do analisador: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V575</a> CWE-628 A fun√ß√£o 'memset' processa elementos '0'.  Inspecione o terceiro argumento.  mbed_error.c 282 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">mbed_error_status_t</span></span> mbed_clear_all_errors(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { .... <span class="hljs-comment"><span class="hljs-comment">//Clear the error and context capturing buffer memset(&amp;last_error_ctx, sizeof(mbed_error_ctx), 0); //reset error count to 0 error_count = 0; .... }</span></span></code> </pre> <br>  O programador pretendia redefinir a mem√≥ria ocupada pela estrutura <i>last_error_ctx</i> , mas misturou o segundo e o terceiro argumentos.  Como resultado, <i>0</i> bytes s√£o preenchidos com o valor <i>sizeof (mbed_error_ctx)</i> . <br><br>  Exatamente o mesmo erro est√° presente centenas de linhas acima: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V575</a> CWE-628 A fun√ß√£o 'memset' processa elementos '0'.  Inspecione o terceiro argumento.  mbed_error.c 123 <br><br><h2>  Instru√ß√£o 'return' incondicional em um loop </h2><br>  Aviso do analisador: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V612</a> CWE-670 Um 'retorno' incondicional dentro de um loop.  thread_network_data_storage.c 2348 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread_nd_service_anycast_address_mapping_from_network_data</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">thread_network_data_cache_entry_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *networkDataList, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *rlocAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> S_id)</span></span></span><span class="hljs-function"> </span></span>{ ns_list_foreach(<span class="hljs-keyword"><span class="hljs-keyword">thread_network_data_service_cache_entry_t</span></span>, curService, &amp;networkDataList-&gt;service_list) { <span class="hljs-comment"><span class="hljs-comment">// Go through all services if (curService-&gt;S_id != S_id) { continue; } ns_list_foreach(thread_network_data_service_server_entry_t, curServiceServer, &amp;curService-&gt;server_list) { *rlocAddress = curServiceServer-&gt;router_id; return true; // &lt;= } } return false; }</span></span></code> </pre> <br>  Nesse snippet, <i>ns_list_foreach</i> √© a macro que se expande na instru√ß√£o <i>for</i> .  O loop interno executa n√£o mais de uma itera√ß√£o devido √† chamada para <i>retornar</i> imediatamente ap√≥s a linha na qual o par√¢metro de sa√≠da da fun√ß√£o √© inicializado.  Talvez esse c√≥digo funcione como pretendido, mas o uso do loop interno parece bastante estranho nesse contexto.  Provavelmente, a inicializa√ß√£o e a sa√≠da do <i>rlocAddress</i> devem ser executadas por condi√ß√£o, ou voc√™ pode se livrar do loop interno. <br><br><h2>  Erros nas condi√ß√µes </h2><br>  Como eu disse acima, o analisador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gerou um</a> n√∫mero bastante grande de avisos desinteressantes do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V547</a> , ent√£o os estudei com flu√™ncia e escrevi apenas dois casos para o artigo. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V547</a> CWE-570 A express√£o 'pcb-&gt; state == LISTEN' √© sempre falsa.  lwip_tcp.c 689 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> tcp_state { CLOSED = <span class="hljs-number"><span class="hljs-number">0</span></span>, LISTEN = <span class="hljs-number"><span class="hljs-number">1</span></span>, .... }; <span class="hljs-function"><span class="hljs-function">struct tcp_pcb * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tcp_listen_with_backlog_and_err</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct tcp_pcb *pcb, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">u8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> backlog, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">err_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *err)</span></span></span><span class="hljs-function"> </span></span>{ .... LWIP_ERROR(<span class="hljs-string"><span class="hljs-string">"tcp_listen: pcb already connected"</span></span>, pcb-&gt;state == CLOSED, res = ERR_CLSD; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> done); <span class="hljs-comment"><span class="hljs-comment">/* already listening? */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pcb-&gt;state == LISTEN) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= lpcb = (struct tcp_pcb_listen*)pcb; res = ERR_ALREADY; goto done; } .... }</span></span></code> </pre> <br>  O analisador considera que a condi√ß√£o <i>pcb-&gt; state == LISTEN √©</i> sempre falsa, vamos <i>ver o</i> porqu√™. <br><br>  Antes da <i>instru√ß√£o if</i> , √© <i>usada a</i> macro <i>LWIP_ERROR</i> , que, de acordo com a l√≥gica de sua opera√ß√£o, se assemelha a <i>assert</i> .  O an√∫ncio dele fica assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LWIP_ERROR(message, expression, handler) do { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!(expression)) { \ LWIP_PLATFORM_ERROR(message); handler;}} while(0)</span></span></code> </pre> <br>  Se a condi√ß√£o for falsa, a macro relata um erro e executa o c√≥digo passado pelo par√¢metro <i>manipulador</i> ; nesse fragmento de c√≥digo, h√° um salto incondicional usando <i>goto</i> . <br><br>  Neste exemplo, a condi√ß√£o 'pcb-&gt; state == CLOSED' est√° marcada, ou seja, a transi√ß√£o para o r√≥tulo <i>conclu√≠do</i> ocorre quando <i>pcb-&gt; state</i> possui outro valor.  A <i>instru√ß√£o if</i> ap√≥s a chamada para <i>LWIP_ERROR</i> verifica <i>pcb-&gt; state</i> para <i>LISTEN</i> , mas essa condi√ß√£o nunca √© atendida, porque o <i>estado</i> nessa linha pode conter apenas o valor <i>CLOSED</i> . <br><br>  Considere mais um aviso relacionado √†s condi√ß√µes: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V517</a> CWE-570 O uso do padr√£o 'if (A) {...} else if (A) {...}' foi detectado.  H√° uma probabilidade de presen√ßa de erro l√≥gico.  Verifique as linhas: 62, 65. libdhcpv6_server.c 62 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">libdhcpv6_address_generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entry-&gt;linkType == DHCPV6_DUID_HARDWARE_EUI64_TYPE) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { memcpy(ptr, entry-&gt;linkId, 8); *ptr ^= 2; } else if (entry-&gt;linkType == DHCPV6_DUID_HARDWARE_EUI64_TYPE)// &lt;= { *ptr++ = entry-&gt;linkId[0] ^ 2; *ptr++ = entry-&gt;linkId[1]; .... } }</span></span></code> </pre> <br>  Aqui, <i>if</i> e <i>else if,</i> verifique a mesma condi√ß√£o, como resultado, o c√≥digo no corpo <i>else if</i> nunca √© executado.  Esses erros geralmente ocorrem ao escrever c√≥digo usando o m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">copiar e colar</a> . <br><br><h2>  Express√£o sem dono </h2><br>  Vamos dar uma olhada em um peda√ßo divertido de c√≥digo. <br><br>  Aviso do analisador: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V607</a> Express√£o sem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dono</a> '&amp; discover_response_tlv'.  thread_discovery.c 562 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread_discovery_response_send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">thread_discovery_class_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *class, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">thread_discovery_response_msg_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *msg_buffers)</span></span></span><span class="hljs-function"> </span></span>{ .... thread_extension_discover_response_tlv_write( &amp;discover_response_tlv, class-&gt;version, linkConfiguration-&gt;securityPolicy); .... }</code> </pre> <br>  Agora, vamos dar uma olhada na <i>declara√ß√£o</i> da macro <i>thread_extension_discover_response_tlv_write</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> thread_extension_discover_response_tlv_write \ ( data, version, extension_bit)\ (data)</span></span></code> </pre> <br>  A macro √© expandida para o argumento de dados, ou seja, sua chamada dentro da fun√ß√£o <i>thread_discovery_response_send</i> ap√≥s o pr√©-processamento se transformar em uma express√£o <i>(&amp; discover_response_tlv)</i> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/721/781/148/721781148d58d4fcfe8a8882c16bf2c5.png" alt="Espera o que"></div><br><br>  N√£o tenho coment√°rios.  Provavelmente n√£o √© um erro, mas esse c√≥digo sempre me coloca em um estado semelhante √† imagem na figura :). <br><br><h2>  Conclus√£o </h2><br>  A lista de compiladores suportados no PVS-Studio foi expandida.  Se voc√™ tem um projeto destinado √† montagem usando o GNU Arm Embedded Toolchain, sugiro tentar test√°-lo usando nosso analisador.  Fa√ßa o download da demo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Preste aten√ß√£o tamb√©m √† op√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">licen√ßa gratuita</a> , adequada para alguns projetos pequenos. <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link para a tradu√ß√£o: Yuri Minaev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O PVS-Studio agora oferece suporte √† cadeia de ferramentas incorporada GNU Arm</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427447/">https://habr.com/ru/post/pt427447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427435/index.html">STM32H7 - acerto do rel√≥gio sem HAL</a></li>
<li><a href="../pt427437/index.html">Configurando servidores vinculados: ms sql server e teradata</a></li>
<li><a href="../pt427439/index.html">Toda a verdade sobre o RTOS. Artigo 16. Signals</a></li>
<li><a href="../pt427441/index.html">Converg√™ncia com Kubernetes</a></li>
<li><a href="../pt427443/index.html">Vivissec√ß√£o do sucesso</a></li>
<li><a href="../pt427449/index.html">Como entender o Tensorflow e n√£o morrer, e at√© ensinar algo sobre um carro</a></li>
<li><a href="../pt427451/index.html">Conectar tarefas do phpStorm ao Bitrix24</a></li>
<li><a href="../pt427453/index.html">Como eu fiz a transmiss√£o de som no Raspberry Pi</a></li>
<li><a href="../pt427457/index.html">A Terceira Onda de Intelig√™ncia Artificial e Sistemas de Seguran√ßa do Estado</a></li>
<li><a href="../pt427459/index.html">L√¢mpadas LED Diall da loja Castorama</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>