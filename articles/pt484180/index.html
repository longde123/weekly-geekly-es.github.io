<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëºüèª ‚õîÔ∏è ‚õπüèº PBX virtual Rostelecom: o que e como pode ser feito atrav√©s da API ‚ÜîÔ∏è ü§≥üèø üë∂üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As empresas modernas percebem os telefones fixos como uma tecnologia desatualizada: a comunica√ß√£o celular fornece mobilidade e disponibilidade constan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PBX virtual Rostelecom: o que e como pode ser feito atrav√©s da API</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rostelecom/blog/484180/"><img src="https://habrastorage.org/webt/9p/4z/il/9p4zilg_eledccytuo6hslf19f0.png"><br><br>  As empresas modernas percebem os telefones fixos como uma tecnologia desatualizada: a comunica√ß√£o celular fornece mobilidade e disponibilidade constante de funcion√°rios, redes sociais e mensagens instant√¢neas s√£o um canal de comunica√ß√£o mais f√°cil e r√°pido.  Para acompanhar seus concorrentes, os PBXs de escrit√≥rio est√£o se tornando cada vez mais parecidos com eles: eles v√£o para as nuvens, s√£o gerenciados via interface da Web e s√£o integrados a outros sistemas atrav√©s da API.  Neste post, mostraremos quais fun√ß√µes a API de PBX virtual da Rostelecom possui e como trabalhar com ela atrav√©s das fun√ß√µes b√°sicas de um PBX virtual. <br><a name="habracut"></a><br>  A principal tarefa da API de PBX virtual da Rostelecom √© interagir com sites de CRM ou da empresa.  Por exemplo, a API inclui widgets "retorno de chamada" e "chamada do site" para os principais sistemas de controle: WordPress, Bitrix, OpenCart.  A API permite que voc√™: <br><br><ul><li>  Receba informa√ß√µes, notifique sobre status e fa√ßa chamadas, mediante solicita√ß√£o, de um sistema externo; <br></li><li>  Obtenha um link tempor√°rio para a grava√ß√£o da conversa; <br></li><li>  Gerenciar e receber configura√ß√µes de restri√ß√£o dos usu√°rios; <br></li><li>  Obtenha informa√ß√µes sobre o usu√°rio de um PBX virtual; <br></li><li>  Solicitar um hist√≥rico de cobran√ßas e cobran√ßas nas chamadas; <br></li><li>  Fa√ßa o download do registro de chamadas. <br></li></ul><br><h2>  Como a API funciona </h2><br>  A API de integra√ß√£o e o sistema externo interagem entre si usando solicita√ß√µes HTTP.  Na sua conta pessoal, o administrador define os endere√ßos para onde as solicita√ß√µes √† API devem vir e para onde as solicita√ß√µes da API devem ser enviadas.  O sistema externo deve ter um endere√ßo p√∫blico acess√≠vel na Internet com um certificado SSL instalado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aef/32c/8c5/aef32c8c5b54534a5b002a87166cb724.png"><br><br>  Al√©m disso, em sua conta pessoal, o administrador do dom√≠nio pode restringir as fontes IP de solicita√ß√µes ao acessar a API. <br><br><h2>  Obtemos informa√ß√µes sobre os usu√°rios do PBX virtual </h2><br>  Para obter uma lista de usu√°rios ou grupos, voc√™ precisa enviar uma solicita√ß√£o ao PBX virtual usando o m√©todo <i>/ users_info</i> . <br><br><pre><code class="plaintext hljs">{         "domain":"example.ru" }</code> </pre> <br>  Ser√° retornada uma lista que voc√™ pode salvar. <br><br><pre> <code class="plaintext hljs">{ "result":0, "resultMessage":"", "users":[                           {                            "display_name":"test_user_1",                            "name":"admin",                            "pin":^_^quot öquot^_^,                           "is_supervisor":true,                            "is_operator":false,                            "email":"test_user_1@mail.gov","recording":1                             },                            {                            "display_name":"test_user_2",                            "name":"test",                            "pin":^_^quot øquot^_^,                            "is_supervisor":true,                            "is_operator":false,                            "email":"",                           "recording":1                            }              ], "groups":              [                            {                            "name":"testAPI",                            "pin":^_^quot«¥quot^_^,                            "email":"Ivanov@mail.gov",                            "distribution":1,                           "users_list":[^_^quot öquot^_^,^_^quot øquot^_^]                            }              ]</code> </pre><br>  Nesse m√©todo, duas matrizes s√£o passadas.  Um com usu√°rios do dom√≠nio, outro com grupos de dom√≠nio.  O grupo tamb√©m pode especificar o email que ser√° enviado na solicita√ß√£o. <br><br><h2>  Processamos informa√ß√µes sobre uma chamada recebida </h2><br>  A conex√£o da telefonia corporativa a v√°rios sistemas de CRM economiza o tempo dos funcion√°rios que interagem com os clientes e acelera o processamento das chamadas recebidas.  Por exemplo, em uma chamada do cliente atual, o CRM pode abrir o cart√£o e, no CRM, voc√™ pode enviar uma chamada para o cliente e conect√°-la ao funcion√°rio. <br><br>  Para obter informa√ß√µes sobre chamadas atrav√©s da API, voc√™ precisa usar o m√©todo <i>/ get_number_info</i> , que forma uma lista de chamadas com informa√ß√µes sobre o grupo no qual a chamada √© distribu√≠da.  Suponha que uma chamada do n√∫mero 1234567890 tenha chegado ao n√∫mero virtual do PBX. Em seguida, uma solicita√ß√£o ser√° enviada a partir do PBX: <br><br><pre> <code class="plaintext hljs">{        "session_id":"SDsnZugDFmTW7Sec",        "timestamp":"2019-12-27 15:34:44.461",        "type":"incoming",        "state":"new",        "from_number":"sip:&lt;/i^_^gt lt&amp;i;gt^_^@192.168.0.1",        "from_pin":"",        "request_number":"sip:&lt;/i^_^gt lt&amp;i;gt^_^@1192.168.0.1",        "request_pin":^_^quot…üquot^_^,        "disconnect_reason":"",        "is_record":"" }</code> </pre><br>  Em seguida, voc√™ precisa conectar o manipulador <i>/ get_number_info</i> .  A solicita√ß√£o deve ser executada quando uma chamada de entrada chega em uma linha de entrada antes de rotear chamadas.  Se a resposta √† solicita√ß√£o n√£o for recebida dentro do tempo definido, a chamada ser√° roteada de acordo com as regras estabelecidas no dom√≠nio. <br><br>  Manipulador de exemplo no lado do CRM. <br><br><pre> <code class="plaintext hljs">if ($account) {        $data = [            'result' =&gt; 0,            'resultMessage' =&gt; ' ',            'displayName' =&gt; $account-&gt;name,            //'PIN' =&gt; $crm_users,        ];    }        else                {        $data = [            'result' =&gt; 0,            'resultMessage' =&gt; '  ',            'displayName' =&gt; '  '.$contact,            //'PIN' =&gt; crm_users,        ];    }    return $data;</code> </pre><br>  A resposta do manipulador. <br><br><pre> <code class="plaintext hljs">{        "result":0,        "resultMessage":" ",        "displayName":"   +1&lt;/i&gt; 234-56-78-90&lt;i&gt;" }</code> </pre><br><h2>  Monitoramos o status e baixamos os registros de conversas </h2><br>  Na central telef√¥nica virtual da Rostelecom, a grava√ß√£o de conversas √© ativada em sua conta pessoal.  Usando a API, voc√™ pode rastrear o status desta fun√ß√£o.  Ao processar o encerramento de chamadas em <i>call_events,</i> voc√™ pode ver o <i>sinalizador 'is_record',</i> que notifica o usu√°rio sobre o status da grava√ß√£o: <i>true</i> significa que o usu√°rio tem uma fun√ß√£o de grava√ß√£o de conversas <i>ativada</i> . <br><br>  Para baixar um registro, voc√™ precisa enviar uma solicita√ß√£o para <i>api.cloudpbx.rt.ru/get_record usando o</i> ID da sess√£o da chamada <i>session_id</i> <i>.</i> <i><br></i> <br><pre> <code class="plaintext hljs">{        "session_id":"SDsnZugDFmTW7Sec" }</code> </pre><br>  A resposta ser√° um link tempor√°rio para baixar o arquivo de grava√ß√£o de conversa. <br><br><pre> <code class="plaintext hljs">{        "result": ^_^quot&amp;#0;quot^_^,        "resultMessage": "  ",    "url": "https://api.cloudpbx.rt.ru/records_new_scheme/record/download/501a8fc4a4aca86eb35955419157921d/188254033036" }</code> </pre><br><br>  O tempo de armazenamento de arquivos √© definido nas configura√ß√µes da sua conta pessoal.  Depois que o arquivo √© exclu√≠do. <br><br><h2>  Estat√≠sticas e Relat√≥rios </h2><br>  Na sua conta, em uma p√°gina separada, voc√™ pode ver estat√≠sticas e relat√≥rios de todas as chamadas e aplicar filtros por status e hora.  Por meio da API, voc√™ deve primeiro processar a chamada com o m√©todo <i>/ call_events</i> : <br><br><pre> <code class="plaintext hljs">    {        "session_id":"SDsnZugDFmTW7Sec",        "timestamp":"2019-12-27 15:34:59.349",        "type":"incoming",        "state":"end",        "from_number":"sip:&lt;/i^_^gt lt&amp;i;gt^_^@192.168.0.1",        "from_pin":"",        "request_number":"sip:&lt;/i^_^gt lt&amp;i;gt^_^@192.168.0.1",        "request_pin":^_^quot öquot^_^,        "disconnect_reason":"",        "is_record":"true"        }</code> </pre><br>  Em seguida, chame o m√©todo <i>call_info</i> para processar a matriz e exibir a chamada no sistema CRM. <br><br><pre> <code class="plaintext hljs">   {        "session_id":"SDsnZugDFmTW7Sec" }</code> </pre><br>  A resposta ser√° uma matriz de dados que pode ser processada para armazenar dados no log do CRM. <br><br><pre> <code class="plaintext hljs">{        "result":0,        "resultMessage":"",        "info":        {                "call_type":1,                "direction":1,                "state":1,                "orig_number":"sip:&lt;/i^_^gt lt&amp;i;gt^_^@192.168.0.1",                "orig_pin":null,                "dest_number":"sip:&lt;/i^_^gt lt&amp;i;gt^_^@192.168.0.1",                "answering_sipuri":"admin@example.ru",                "answering_pin":^_^quot…üquot^_^,                "start_call_date":^_^quot quot^_^,                "duration":14,                 "session_log":"0:el:123456789;0:ru:admin;7:ct:admin;9:cc:admin;14:cd:admin;",                "is_voicemail":false,                "is_record":true,                "is_fax":false,                "status_code":^_^quot&amp;#0;quot^_^,                "status_string":""        } }</code> </pre><br><br><h2>  Outros recursos √∫teis de PBX virtual </h2><br>  Al√©m da API, o PBX virtual possui algumas fun√ß√µes mais √∫teis que voc√™ pode usar.  Por exemplo, este √© um menu de voz interativo e uma combina√ß√£o de comunica√ß√µes celulares e fixas. <br><br>  Resposta de voz interativa (IVR) √© o que ouvimos no receptor antes que uma pessoa atenda.  De fato, este √© um operador eletr√¥nico que redireciona as chamadas para os departamentos apropriados e responde a algumas das perguntas automaticamente.  Em breve, ser√° poss√≠vel trabalhar com a URA por meio da API: agora estamos desenvolvendo um software que permitir√° que voc√™ acompanhe o andamento de uma chamada atrav√©s da URA e receba informa√ß√µes sobre as teclas pressionadas quando o chamador estiver no menu de voz. <br><br>  Para transferir telefonia corporativa para telefones celulares, voc√™ pode usar aplicativos de softphone ou conectar separadamente o servi√ßo FMC (Fixed Mobile Convergence).  Em qualquer um dos m√©todos, as chamadas na rede s√£o gratuitas, √© poss√≠vel trabalhar com n√∫meros curtos, as chamadas podem ser gravadas e as estat√≠sticas gerais podem ser mantidas nelas. <br><br>  A diferen√ßa √© que os softphones precisam da Internet para se comunicar, mas n√£o est√£o vinculados a uma operadora, e o FMC est√° vinculado a uma operadora espec√≠fica, mas pode at√© ser usado em telefones antigos com bot√£o de press√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484180/">https://habr.com/ru/post/pt484180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484168/index.html">Escrevemos nossa estrat√©gia de rolagem virtual a partir do Angular CDK</a></li>
<li><a href="../pt484172/index.html">Integra√ß√£o cont√≠nua no Unity: como reduzir o tempo de montagem e economizar recursos + linha de pagamento como presente</a></li>
<li><a href="../pt484174/index.html">Beber em castelo em condi√ß√µes "extremas" ou como participamos do show "DOZOR"</a></li>
<li><a href="../pt484176/index.html">Implementando o modelo de status no Unity</a></li>
<li><a href="../pt484178/index.html">Switch Ethernet inteligente para o planeta Terra</a></li>
<li><a href="../pt484182/index.html">Xenobots: nanorob√¥s vivos de c√©lulas de sapo</a></li>
<li><a href="../pt484186/index.html">LDAP - "autentica√ß√£o" √© um antipadr√£o</a></li>
<li><a href="../pt484188/index.html">Padr√µes de Design de Banco de Dados</a></li>
<li><a href="../pt484192/index.html">F√°cil e f√°cil de implantar aplicativos no cartucho Tarantool (parte 2)</a></li>
<li><a href="../pt484194/index.html">Kubernetes traduzido em crian√ßas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>