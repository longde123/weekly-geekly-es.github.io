<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📪 🍸 🧒 Kapacitor中的度量处理技巧 🎗️ 🦆 🎂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最有可能的是，今天没有人质疑为什么他们需要收集服务指标。 下一步的逻辑步骤是为收集的指标配置警报，该警报将在您方便使用的渠道（邮件，Slack，电报）中通知您数据的任何偏差。 在Ostrovok.ru酒店的在线预订服务中，我们服务的所有度量标准都已注入InfluxDB并显示在Grafana中，还在那...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kapacitor中的度量处理技巧</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ostrovok/blog/478702/"> 最有可能的是，今天没有人质疑为什么他们需要收集服务指标。 下一步的逻辑步骤是为收集的指标配置警报，该警报将在您方便使用的渠道（邮件，Slack，电报）中通知您数据的任何偏差。 在<a href="https://www.habr.com/%3Futm_source%3Dhabr%26utm_medium%3Dpr%26utm_campaign%3DErmolaev_dec19%26utm_content%3Darticle">Ostrovok.ru</a>酒店的在线预订服务中，我们服务的所有度量标准都已注入InfluxDB并显示在Grafana中，还在那里设置了基本警报。 对于诸如“您需要计算并进行比较”之类的任务，我们使用Kapacitor。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oe/cl/5h/oecl5hgip8nkmeau21l2qaem8ek.png"></div><br>  Kapacitor是TICK堆栈的一部分，可以处理来自InfluxDB的指标。 他可以将多个维度相互连接（联接），从接收到的数据中计算出有用的东西，将结果写回到InfluxDB，向Slack / Telegram / mail发送警报。 <br><br> 整个<a href="">文档库</a>都有很酷且详细的<a href="">文档</a> ，但是总有一些有用的内容没有在手册中明确指定。 在本文中，我决定收集一些此类有用的非显而易见的技巧（ <a href="https://docs.influxdata.com/kapacitor/v1.5/tick/syntax/">此处</a>描述了基本的TICKscipt语法），并以解决我们的问题之一为例，展示了如何应用它们。 <br><br> 走吧 <br><a name="habracut"></a><br><h4> 浮点数和整数，计算错误 </h4><br> 绝对标准的问题，是通过种姓解决的： <br><br><pre><code class="python hljs">var alert_float = <span class="hljs-number"><span class="hljs-number">5.0</span></span> var alert_int = <span class="hljs-number"><span class="hljs-number">10</span></span> data|eval(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: float(<span class="hljs-string"><span class="hljs-string">"value"</span></span>) &gt; alert_float OR float(<span class="hljs-string"><span class="hljs-string">"value"</span></span>) &lt; float(<span class="hljs-string"><span class="hljs-string">"alert_int"</span></span>))</code> </pre> <br><h4> 使用默认值（） </h4><br> 如果未填写标签/字段，则在计算中将发生错误： <br><br><pre> <code class="python hljs">|default() .tag(<span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'empty'</span></span>) .field(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br><h4> 填写联接（内部与外部） </h4><br> 默认情况下，join将删除没有数据的点（内部）。 <br> 使用fill（'null'），将执行外部联接，之后您需要执行default（）并填充空值： <br><br><pre> <code class="python hljs">var data = res1 |join(res2) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(<span class="hljs-string"><span class="hljs-string">'res1'</span></span>, <span class="hljs-string"><span class="hljs-string">'res2) .fill('</span></span>null<span class="hljs-string"><span class="hljs-string">') |default() .field('</span></span>res1.value<span class="hljs-string"><span class="hljs-string">', 0.0) .field('</span></span>res2.value<span class="hljs-string"><span class="hljs-string">', 100.0)</span></span></code> </pre><br> 仍然有细微差别。 如果在上面的示例中，序列之一（res1或res2）为空，则最终序列（数据）也将为空。 在github（ <a href="https://github.com/influxdata/influxdb/issues/6967">1633，1871，6967</a> ）上有几张关于该主题的票证-我们正在等待修复，并且会稍有痛苦。 <br><br><h4> 在计算中使用条件（如果在lambda中） </h4><br><pre> <code class="python hljs">|eval(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"value"</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, true, false)</code> </pre><br><h4> 在此期间，管道的最后五分钟 </h4><br> 例如，您需要将最近五分钟的值与前一周的值进行比较。 您可以使用两个单独的batch'ami获取两个数据包，或者从较大的时期中提取部分数据： <br><br><pre> <code class="python hljs"> |where(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: duration((unixNano(now()) - unixNano(<span class="hljs-string"><span class="hljs-string">"time"</span></span>))/<span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>u) &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>m)</code> </pre><br> 最后五分钟的替代方法是使用BarrierNode节点，该节点在指定时间之前切断数据： <br><br><pre> <code class="python hljs">|barrier() .period(<span class="hljs-number"><span class="hljs-number">5</span></span>m)</code> </pre><br><h2> 在消息中使用Go'sh模式的示例 </h2><br> 模板与<a href="https://golang.org/pkg/text/template/">text.template</a>包中的格式相对应，以下是一些常见任务。 <br><br><h4> 如果-否则 </h4><br> 我们将事情井井有条，我们不会再用文字触发人们： <br><br><pre> <code class="python hljs">|alert() ... .message( <span class="hljs-string"><span class="hljs-string">'{{ if eq .Level "OK" }}It is ok now{{ else }}Chief, everything is broken{{end}}'</span></span> )</code> </pre><br><h4> 邮件中的小数点后两位 </h4><br> 提高消息的可读性： <br><br><pre> <code class="python hljs">|alert() ... .message( <span class="hljs-string"><span class="hljs-string">'now value is {{ index .Fields "value" | printf "%0.2f" }}'</span></span> )</code> </pre><br><h4> 在消息中扩展变量 </h4><br> 我们在消息中显示更多信息，以回答“为什么大喊大叫？”的问题。 <br><br><pre> <code class="python hljs">var warnAlert = <span class="hljs-number"><span class="hljs-number">10</span></span> |alert() ... .message( <span class="hljs-string"><span class="hljs-string">'Today value less then '</span></span>+string(warnAlert)+<span class="hljs-string"><span class="hljs-string">'%'</span></span> )</code> </pre><br><h4> 唯一警报标识 </h4><br> 当数据中存在多个组时，这是正确的，否则只会生成一个警报： <br><br><pre> <code class="python hljs">|alert() ... .id(<span class="hljs-string"><span class="hljs-string">'{{ index .Tags "myname" }}/{{ index .Tags "myfield" }}'</span></span>)</code> </pre><br><h4> 自定义处理程序 </h4><br> 大量的处理程序都有exec，它使您可以通过传递的参数（stdin）执行脚本-创造力等等！ <br><br> 我们的自定义工具之一是一个小的python脚本，用于向松弛发送通知。 <br> 首先，我们要从消息中受授权保护的grafana发送图片。 之后-将OK写入同一组中上一个警报的线程，而不是作为单独的消息。 稍后-将最近X分钟内最常见的错误附加到邮件中。 <br><br> 一个单独的主题是与其他服务的通信以及由警报启动的任何操作（仅当您的监视工作足够好时）。 <br> 描述处理程序的示例，其中slack_handler.py是我们自己编写的脚本： <br><br><pre> <code class="python hljs">topic: slack_graph id: slack_graph.alert match: level() != INFO AND changed() == TRUE kind: <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> options: prog: /sbin/slack_handler.py args: [<span class="hljs-string"><span class="hljs-string">"-c"</span></span>, <span class="hljs-string"><span class="hljs-string">"CHANNELID"</span></span>, <span class="hljs-string"><span class="hljs-string">"--graph"</span></span>, <span class="hljs-string"><span class="hljs-string">"--search"</span></span>]</code> </pre><br><h2> 如何首次亮相？ </h2><br><h4> 日志输出选项 </h4><br><pre> <code class="python hljs">|log() .level(<span class="hljs-string"><span class="hljs-string">"error"</span></span>) .prefix(<span class="hljs-string"><span class="hljs-string">"something"</span></span>)</code> </pre><br> 观看（CLI）：kapacitor -url <a href="http://host-or-ip/">host-or-ip</a> ：9092日志lvl =错误 <br><br><h4> 带有httpOut的变体 </h4><br> 显示当前管道中的数据： <br><br><pre> <code class="python hljs">|httpOut(<span class="hljs-string"><span class="hljs-string">'something'</span></span>)</code> </pre><br> 观看（获取）： <a href="http://host-or-ip/">host-or-ip</a> ：9092 / kapacitor / v1 /任务/ task_name /其他 <br><br><h4> 执行方案 </h4><br><ul><li> 每个任务都以<a href="https://www.graphviz.org/">graphviz</a>格式返回带有有用数字的运行树。 </li><li> 拿<a href="http://host-or-ip:9092/kapacitor/v1/tasks/task_name%3Fdot-view%3Dlabels">点</a>块。 </li><li> 我们插入查看器中， <a href="https://dreampuf.github.io/GraphvizOnline">欣赏</a> 。 <br></li></ul><br><br><h2> 我还能在哪里得到耙 </h2><br><h4> 回写时的influxdb时间戳 </h4><br> 例如，我们为每小时的请求总数（groupBy（1h））设置了一个警报，并希望将发生的警报记录在influxdb中（以在grafana的图表上漂亮地显示问题的事实）。 <br><br>  influxDBOut（）会将警报的时间值分别写入时间戳，图表上的点将在警报出现之前/之后进行记录。 <br><br> 当需要准确性时：我们通过调用自定义处理程序来绕过此问题，该处理程序将使用当前时间戳将数据写入influxdb。 <br><br><h4> 码头工人，建立和部署 </h4><br> 启动时，kapacitor可以从[load]块中config中指定的目录中加载任务，模板和处理程序。 <br><br> 要正确创建任务，需要执行以下操作： <br><br><ol><li> 文件名-扩展为ID /脚本名 </li><li> 类型-流/批次 </li><li>  dbrp-指示脚本在哪个数据库+策略中工作的关键字（dbrp“供应商”。“ autogen”） </li></ol><br> 如果某个批处理任务中没有与dbrp匹配的行，则整个服务将拒绝启动，并如实地在日志中写出它。 <br><br> 相反，在chronograf中，此行不应被接受，它不会被接口接受并引发错误。 <br><br> 构建容器时会被黑客入侵：如果在//.+dbrp中有一行，则Dockerfile会以-1退出，这将在构建构建时立即了解文件的原因。 <br><br><h4> 一对多加入 </h4><br> 任务示例：您需要每周使用服务运行时间的95％，并将最后10分钟的每分钟与该值进行比较。 <br><br> 您无法按一组点加入一对，最后/均值/中位数将节点转换为流，将返回错误“无法添加子项不匹配的边：批处理-&gt;流”。 <br><br> 批处理的结果作为lambda表达式中的变量，也不会被替换。 <br><br> 有一个选项可以通过udf将第一批中的必要编号保存到文件中，并通过sideload加载该文件。 <br><br><h2> 我们决定了什么？ </h2><br> 我们大约有100家酒店供应商，每个供应商都可以有多个联系，我们称其为渠道。 这些通道大约有300个；每个通道都可能掉线。 在所有记录的指标中，我们将监视错误率（请求和错误）。 <br><br><h4> 为什么不使用格拉法纳呢？ </h4><br> 在grafan中配置的错误警报有几个缺点。 根据情况的不同，有些危急，有些可以闭上眼睛。 <br><br>  Grafana不知道如何在维度+警报之间进行计算，但是我们需要一个比率（请求-错误）/请求。 <br><br> 错误看起来很恶心： <br><br><img src="https://habrastorage.org/webt/iq/0h/nq/iq0hnqauk_l0nm4akwynyeb0hbc.png"><br><br> 与成功的请求一起查看时，不会那么恶毒 <br><br><img src="https://habrastorage.org/webt/mw/vs/ok/mwvsok9hb7qfa3lifpna4_rrno4.png"><br><br> 好的，我们可以在grafana之前预先计算服务中的费率，并且在某些情况下可以。 但不是我们的，因为 对于每个通道，其比率均被视为“正常”，并且警报根据静态值工作（我们用眼睛观察，如果经常警报，则将其更改）。 <br><br> 这些是不同渠道的“正常”示例： <br><br><img src="https://habrastorage.org/webt/3f/d5/fg/3fd5fg6los9dg7pjlkuanfuv_mk.png"><br><br><img src="https://habrastorage.org/webt/hp/n-/q6/hpn-q6cnqtaugwlsmch1jvapnuc.png"><br><br> 我们忽略了上一段，并假设所有供应商的情况都是“正常”的。 现在一切都很好，我们可以通过grafana中的警报来度过难关吗？ <br> 我们可以，但实际上不希望这样做，因为我们必须选择以下选项之一： <br>  a）为每个通道分别制作许多图形（并痛苦地陪伴它们） <br>  b）在所有通道中保留一张图表（并迷失在彩色线条和已调整的警报中） <br><br><img src="https://habrastorage.org/webt/sk/8c/-b/sk8c-bayyodb08xuchmfbfjhe8q.png"><br><br><h4> 你是怎么做到的？ </h4><br> 再次，该文档提供了一个很好的入门示例（ <a href="https://docs.influxdata.com/kapacitor/v1.5/guides/join_backfill/">计算各个系列的比率</a> ），您可以窥视或作为类似任务的基础。 <br><br> 结果您做了什么： <br><br><ul><li> 在几个小时内加入两集，按频道分组； </li><li> 如果没有数据，请按组填写系列； </li><li> 比较最近10分钟的中位数和先前的数据； </li><li> 如果发现什么我们就尖叫； </li><li> 在influxdb中写入计算的速率和发生的警报； </li><li> 发送有用的消息到松弛状态。 </li></ul><br> 在我看来，我们尽可能地精美地管理了我们希望在输出中获得的所有内容（使用自定义处理程序甚至更多）。 <br><br> 在github.com上，您可以看到<a href="">示例代码</a>和所得脚本的<a href="">最小图表（graphviz）</a> 。 <br><br><div class="spoiler">  <b class="spoiler_title">结果代码示例：</b> <div class="spoiler_text"><pre> <code class="python hljs">dbrp <span class="hljs-string"><span class="hljs-string">"supplier"</span></span>.<span class="hljs-string"><span class="hljs-string">"autogen"</span></span> var name = <span class="hljs-string"><span class="hljs-string">'requests.rate'</span></span> var grafana_dash = <span class="hljs-string"><span class="hljs-string">'pczpmYZWU/mydashboard'</span></span> var grafana_panel = <span class="hljs-string"><span class="hljs-string">'26'</span></span> var period = <span class="hljs-number"><span class="hljs-number">8</span></span>h var todayPeriod = <span class="hljs-number"><span class="hljs-number">10</span></span>m var every = <span class="hljs-number"><span class="hljs-number">1</span></span>m var warnAlert = <span class="hljs-number"><span class="hljs-number">15</span></span> var warnReset = <span class="hljs-number"><span class="hljs-number">5</span></span> var reqQuery = <span class="hljs-string"><span class="hljs-string">'SELECT sum("count") AS value FROM "supplier"."autogen"."requests"'</span></span> var errQuery = <span class="hljs-string"><span class="hljs-string">'SELECT sum("count") AS value FROM "supplier"."autogen"."errors"'</span></span> var prevErr = batch |query(errQuery) .period(period) .every(every) .groupBy(<span class="hljs-number"><span class="hljs-number">1</span></span>m, <span class="hljs-string"><span class="hljs-string">'channel'</span></span>, <span class="hljs-string"><span class="hljs-string">'supplier'</span></span>) var prevReq = batch |query(reqQuery) .period(period) .every(every) .groupBy(<span class="hljs-number"><span class="hljs-number">1</span></span>m, <span class="hljs-string"><span class="hljs-string">'channel'</span></span>, <span class="hljs-string"><span class="hljs-string">'supplier'</span></span>) var rates = prevReq |join(prevErr) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(<span class="hljs-string"><span class="hljs-string">'req'</span></span>, <span class="hljs-string"><span class="hljs-string">'err'</span></span>) .tolerance(<span class="hljs-number"><span class="hljs-number">1</span></span>m) .fill(<span class="hljs-string"><span class="hljs-string">'null'</span></span>) //   ,     |default() .field(<span class="hljs-string"><span class="hljs-string">'err.value'</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) .field(<span class="hljs-string"><span class="hljs-string">'req.value'</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>) // <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>:  ,     |eval(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"err.value"</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100.0</span></span> * (float(<span class="hljs-string"><span class="hljs-string">"req.value"</span></span>) - float(<span class="hljs-string"><span class="hljs-string">"err.value"</span></span>)) / float(<span class="hljs-string"><span class="hljs-string">"req.value"</span></span>), <span class="hljs-number"><span class="hljs-number">100.0</span></span>)) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(<span class="hljs-string"><span class="hljs-string">'rate'</span></span>) //      rates |influxDBOut() .quiet() .create() .database(<span class="hljs-string"><span class="hljs-string">'kapacitor'</span></span>) .retentionPolicy(<span class="hljs-string"><span class="hljs-string">'autogen'</span></span>) .measurement(<span class="hljs-string"><span class="hljs-string">'rates'</span></span>) //     <span class="hljs-number"><span class="hljs-number">10</span></span> ,   var todayRate = rates |where(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: duration((unixNano(now()) - unixNano(<span class="hljs-string"><span class="hljs-string">"time"</span></span>)) / <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>u) &lt; todayPeriod) |median(<span class="hljs-string"><span class="hljs-string">'rate'</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(<span class="hljs-string"><span class="hljs-string">'median'</span></span>) var prevRate = rates |median(<span class="hljs-string"><span class="hljs-string">'rate'</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(<span class="hljs-string"><span class="hljs-string">'median'</span></span>) var joined = todayRate |join(prevRate) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(<span class="hljs-string"><span class="hljs-string">'today'</span></span>, <span class="hljs-string"><span class="hljs-string">'prev'</span></span>) |httpOut(<span class="hljs-string"><span class="hljs-string">'join'</span></span>) var trigger = joined |alert() .warn(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: (<span class="hljs-string"><span class="hljs-string">"prev.median"</span></span> - <span class="hljs-string"><span class="hljs-string">"today.median"</span></span>) &gt; warnAlert) .warnReset(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: (<span class="hljs-string"><span class="hljs-string">"prev.median"</span></span> - <span class="hljs-string"><span class="hljs-string">"today.median"</span></span>) &lt; warnReset) .flapping(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>) .stateChangesOnly() //   message      .message( <span class="hljs-string"><span class="hljs-string">'{{ .Level }}: {{ index .Tags "channel" }} err/req ratio ({{ index .Tags "supplier" }}) {{ if eq .Level "OK" }}It is ok now{{ else }} '</span></span>+string(todayPeriod)+<span class="hljs-string"><span class="hljs-string">' median is {{ index .Fields "today.median" | printf "%0.2f" }}%, by previous '</span></span>+string(period)+<span class="hljs-string"><span class="hljs-string">' is {{ index .Fields "prev.median" | printf "%0.2f" }}%{{ end }} http://grafana.ostrovok.in/d/'</span></span>+string(grafana_dash)+ <span class="hljs-string"><span class="hljs-string">'?var-supplier={{ index .Tags "supplier" }}&amp;var-channel={{ index .Tags "channel" }}&amp;panelId='</span></span>+string(grafana_panel)+<span class="hljs-string"><span class="hljs-string">'&amp;fullscreen&amp;tz=UTC%2B03%3A00'</span></span> ) .id(<span class="hljs-string"><span class="hljs-string">'{{ index .Tags "name" }}/{{ index .Tags "channel" }}'</span></span>) .levelTag(<span class="hljs-string"><span class="hljs-string">'level'</span></span>) .messageField(<span class="hljs-string"><span class="hljs-string">'message'</span></span>) .durationField(<span class="hljs-string"><span class="hljs-string">'duration'</span></span>) .topic(<span class="hljs-string"><span class="hljs-string">'slack_graph'</span></span>) // <span class="hljs-string"><span class="hljs-string">"today.median"</span></span>   <span class="hljs-string"><span class="hljs-string">"value"</span></span>,        (keep) trigger |eval(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: <span class="hljs-string"><span class="hljs-string">"today.median"</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(<span class="hljs-string"><span class="hljs-string">'value'</span></span>) .keep() |influxDBOut() .quiet() .create() .database(<span class="hljs-string"><span class="hljs-string">'kapacitor'</span></span>) .retentionPolicy(<span class="hljs-string"><span class="hljs-string">'autogen'</span></span>) .measurement(<span class="hljs-string"><span class="hljs-string">'alerts'</span></span>) .tag(<span class="hljs-string"><span class="hljs-string">'alertName'</span></span>, name)</code> </pre><br></div></div><br><h2> 结论是什么？ </h2><br>  Kapacitor非常擅长监视一组警报，根据已记录的指标执行其他计算，执行自定义操作并运行脚本（udf）。 <br><br> 进入门槛不是很高-如果grafana或其他工具不能完全满足您的愿望，请尝试。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN478702/">https://habr.com/ru/post/zh-CN478702/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN478690/index.html">使用版本化文档的示例站点使用werf动态组装和部署Docker映像</a></li>
<li><a href="../zh-CN478692/index.html">Android如何支持Java 8</a></li>
<li><a href="../zh-CN478694/index.html">正如我们在ivi在线电影院中推荐的最新目录（+ Python代码）</a></li>
<li><a href="../zh-CN478696/index.html">我如何参观Urban Tech2019。活动报告</a></li>
<li><a href="../zh-CN478698/index.html">我们在15分钟内制定了互动地形图</a></li>
<li><a href="../zh-CN478704/index.html">如果邮件已经到达垃圾邮件该怎么办：5个实际步骤</a></li>
<li><a href="../zh-CN478706/index.html">高负载架构师。 OTUS的新课程</a></li>
<li><a href="../zh-CN478708/index.html">随机发生器如何让您为旧游戏注入新的活力</a></li>
<li><a href="../zh-CN478710/index.html">在Tar​​antool弹药筒上轻松且分阶段地部署应用程序（第1部分）</a></li>
<li><a href="../zh-CN478712/index.html">如何不为Java托管或Google App Engine快速入门付费</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>