<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∞üèª üëÄ üëÇüèª Monoreposit√≥rios: por favor üîÖ üë®üèª‚Äçüé® üôÜüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma tradu√ß√£o do artigo foi preparada para os alunos do curso DevOps Practices and Tools no projeto educacional OTUS . 



 Voc√™ deve escolher um mono-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monoreposit√≥rios: por favor</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/453958/"><p><img src="https://habrastorage.org/webt/zb/qs/gu/zbqsgutqkd38ocudlbvzx5zeldc.png" alt="imagem"></p><br><p>  <em>Uma tradu√ß√£o do artigo foi preparada para os alunos do curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DevOps Practices and Tools no</a> projeto educacional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OTUS</a> .</em> </p><br><hr><br><p>  Voc√™ deve escolher um mono-reposit√≥rio, porque o comportamento que ele promove em suas equipes √© a transpar√™ncia e a responsabilidade coletiva, especialmente quando as equipes crescem.  De qualquer forma, voc√™ ter√° que investir em ferramentas, mas √© sempre melhor quando o comportamento padr√£o √© o que voc√™ deseja ver em seus comandos. <a name="habracut"></a></p><br><h1 id="pochemu-my-govorim-ob-etom">  Por que estamos falando sobre isso? </h1><br><p>  Matt Klein escreveu um artigo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Monorepos: Por favor, n√£o!"</a>  (coment√°rio do tradutor: tradu√ß√£o em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hub "Monoreposit√≥rios: por favor, n√£o"</a> ).  Eu gosto de Matt, acho que ele √© muito inteligente, e voc√™ deve ler o ponto de vista dele.  Ele originalmente twittou a enquete: </p><br><p><img src="https://habrastorage.org/webt/x2/pl/sm/x2plsmnmw3xzn-hoeo7ksirx1rm.png" alt="imagem"></p><br><p>  <em>Tradu√ß√£o:</em> <br>  <em>Neste dia de ano novo, discutirei sobre o qu√£o rid√≠culos s√£o os monoreposit√≥rios.</em>  <em>2019 come√ßou despercebido.</em>  <em>Nesse esp√≠rito, ofere√ßo-lhe uma pesquisa.</em>  <em>Quem s√£o os grandes fan√°ticos?</em>  <em>Apoiantes:</em> <br>  - <em>Monoreposit√≥rio</em> <br>  - <em>Ferrugem</em> <br>  - <em>Inqu√©rito errado / aqueles e aqueles</em> </p><br><p>  Minha resposta foi: "Eu literalmente sou essas duas pessoas".  Em vez de falar sobre que tipo de droga Rust, vamos descobrir por que acho que ele est√° errado sobre os mono-reposit√≥rios.  Um pouco sobre voc√™.  Eu sou o CTO do Chef Software.  Temos cerca de 100 engenheiros, uma base de c√≥digo de 11 a 12 anos e 4 produtos principais.  Parte desse c√≥digo est√° no poli-reposit√≥rio (minha posi√ß√£o inicial), parte no monoreposit√≥rio (minha posi√ß√£o atual). </p><br><p>  Antes de come√ßar: todo argumento que cito aqui ser√° aplicado aos dois tipos de reposit√≥rios.  Na minha opini√£o, n√£o h√° raz√µes t√©cnicas para voc√™ escolher um ou outro tipo de reposit√≥rio.  Voc√™ pode fazer qualquer abordagem funcionar.  Fico feliz em falar sobre isso, mas n√£o estou interessado nas raz√µes t√©cnicas artificiais pelas quais uma √© superior √† outra. </p><br><p>  Eu concordo com a primeira parte do ponto de vista de Matt: </p><br><p>  <em>Como, em grande escala, o monoreposit√≥rio resolver√° todos os mesmos problemas que o poli-reposit√≥rio, mas ao mesmo tempo, provocar√° uma forte coer√™ncia do seu c√≥digo e exigir√° esfor√ßos incr√≠veis para aumentar a escalabilidade do seu sistema de controle de vers√£o.</em> </p><br><p>  Voc√™ precisa resolver os mesmos problemas, independentemente de escolher um monoreposit√≥rio ou poli-reposit√≥rio.  Como voc√™ libera lan√ßamentos?  Qual √© a sua abordagem para atualiza√ß√µes?  Compat√≠vel com vers√µes anteriores?  Depend√™ncias entre projetos?  Quais estilos de arquitetura s√£o aceit√°veis?  Como voc√™ gerencia sua infraestrutura de constru√ß√£o e teste?  A lista √© intermin√°vel.  E voc√™ resolver√° todos eles √† medida que crescer.  N√£o h√° queijo gr√°tis. </p><br><p>  Eu acho que o argumento de Matt √© semelhante √†s opini√µes compartilhadas por muitos engenheiros (e gerentes) que eu respeito.  Isso acontece do ponto de vista do engenheiro que trabalha no componente ou da equipe que trabalha no componente.  Voc√™ ouve coisas como: </p><br><ul><li>  A base de c√≥digo √© complicada - n√£o preciso de todo esse lixo. </li><li> Isso √© mais dif√≠cil de testar porque tenho que verificar todo esse lixo que n√£o preciso. </li><li>  √â mais dif√≠cil trabalhar com depend√™ncias externas. </li><li>  Eu preciso dos meus pr√≥prios sistemas de controle de vers√£o virtual. </li></ul><br><p>  Claro, todos esses pontos s√£o razo√°veis.  Isso acontece nos dois casos - no poli-reposit√≥rio, eu tenho minhas pr√≥prias coisas, al√©m do que √© necess√°rio para a montagem ... Eu tamb√©m posso precisar de outras coisas.  Portanto, "apenas" crio ferramentas que fazem checkout de todo o projeto.  Ou estou criando um reposit√≥rio mono falso com subm√≥dulos.  N√≥s poder√≠amos andar o dia todo por isso.  Mas acho que o argumento de Matt erra o principal motivo, que eu quase virei a favor do monoreposit√≥rio: </p><br><h1 id="on-provociruet-obschenie-i-pokazyvaet-problemy">  Provoca comunica√ß√£o e mostra problemas. </h1><br><p>  Quando compartilhamos reposit√≥rios, de fato criamos um problema de coordena√ß√£o e transpar√™ncia.  Isso corresponde √† maneira como pensamos sobre as equipes (especialmente √† maneira como os participantes pensam sobre elas): somos respons√°veis ‚Äã‚Äãpor um componente espec√≠fico.  Trabalhamos em relativo isolamento.  Os limites s√£o fixos na minha equipe e nos componentes em que estamos trabalhando. </p><br><p>  Com a complexidade da arquitetura, uma equipe n√£o pode mais gerenci√°-la sozinha.  Muito poucos engenheiros mant√™m todo o sistema em mente.  Suponha que voc√™ controle um componente comum A, usado pelos comandos B, C e D. Os refatoradores da equipe A, aprimoram a API e tamb√©m alteram a implementa√ß√£o interna.  Como resultado, as mudan√ßas s√£o incompat√≠veis com vers√µes anteriores.  Que conselho voc√™ daria? </p><br><ul><li>  Encontre todos os lugares onde a API antiga √© usada. </li><li>  Existem lugares onde a nova API n√£o pode ser usada? </li><li>  Voc√™ pode consertar e testar outros componentes para garantir que eles n√£o quebrem? </li><li>  Essas equipes podem verificar suas altera√ß√µes agora? </li></ul><br><p>  Observe que essas perguntas s√£o independentes do tipo de reposit√≥rio.  Voc√™ precisar√° encontrar as equipes B, C e D. Voc√™ precisar√° conversar com elas, descobrir o tempo, entender suas prioridades.  Pelo menos, esperamos que voc√™ fa√ßa isso. </p><br><p>  Ningu√©m realmente quer fazer isso.  Isso √© muito menos divertido do que apenas consertar a maldita API.  Tudo isso √© humano e confuso.  No reposit√≥rio, voc√™ pode simplesmente fazer altera√ß√µes, revisar aqueles que est√£o trabalhando neste componente (provavelmente n√£o B, C ou D) e seguir em frente.  As equipes B, C e D podem simplesmente permanecer na vers√£o atual.  Eles ser√£o atualizados quando perceberem seu g√™nio! </p><br><p>  Em um √∫nico reposit√≥rio, a responsabilidade √© alterada por padr√£o.  A equipe A altera seu componente e, se n√£o tomar cuidado, interrompe imediatamente B, C e D. Isso faz com que B, C e D apare√ßam na porta A, perguntando-se por que a equipe A interrompeu a montagem.  Isso ensina A que eles n√£o podem pular minha lista acima.  Eles devem falar sobre o que v√£o fazer.  B, C e D podem se mover?  E se B e C puderem, mas D estiver intimamente relacionado a um efeito colateral do antigo algoritmo? </p><br><p>  Ent√£o precisamos conversar sobre como sa√≠mos dessa situa√ß√£o: </p><br><ol><li>  Suporte para v√°rias APIs internas, enquanto o algoritmo antigo ser√° marcado como obsoleto at√© que D possa parar de us√°-lo. </li><li>  Suporte para v√°rias vers√µes de vers√µes, uma com a interface antiga e outra com a nova. </li><li>  Libera√ß√£o atrasada das altera√ß√µes em A at√© que B, C e D possam aceit√°-la. </li></ol><br><p>  Suponha que selecionemos 1, v√°rias APIs.  Nesse caso, temos dois peda√ßos de c√≥digo.  Velho e novo.  Muito √∫til em algumas situa√ß√µes.  Retornamos o c√≥digo antigo, marcamos como obsoleto e concordamos com uma programa√ß√£o para sua remo√ß√£o com o comando D. √â essencialmente id√™ntico para poli e para o mono-reposit√≥rio. </p><br><p>  Para lan√ßar v√°rias vers√µes, precisamos de um ramo.  Agora temos dois componentes - A1 e A2.  As equipes B e C usam A2 e D usa A1.  Precisamos que cada componente esteja pronto para o lan√ßamento, porque antes que o D possa seguir em frente, podem ser necess√°rias atualiza√ß√µes de seguran√ßa e outras corre√ß√µes.  No reposit√≥rio, podemos ocult√°-lo em um ramo de longa dura√ß√£o que se sente bem.  No mono-reposit√≥rio, for√ßamos o c√≥digo no novo m√≥dulo.  A equipe D ainda precisar√° fazer altera√ß√µes no componente "antigo".  Todos podem ver o custo que pagamos aqui - agora temos o dobro do c√≥digo e quaisquer corre√ß√µes de erros que se apliquem a A1 e A2 devem ser aplicadas a ambos.  Com a abordagem de usar ramifica√ß√µes em um reposit√≥rio, isso est√° oculto por tr√°s da sele√ß√£o de cereja.  Consideramos o custo menor porque n√£o h√° duplica√ß√£o.  Do ponto de vista pr√°tico, o custo √© o mesmo: voc√™ criar√°, liberar√° e manter√° duas bases de c√≥digo basicamente id√™nticas at√© poder excluir uma delas.  A diferen√ßa √© que, no monoreposit√≥rio, essa dor √© direta e vis√≠vel.  <strong>Isso √© ainda pior e bom.</strong> </p><br><p>  Finalmente, chegamos ao terceiro ponto.  Atraso de libera√ß√£o.  √â poss√≠vel que as altera√ß√µes feitas por A melhorem a vida da equipe A. √â importante, mas n√£o urgente.  Podemos apenas aguentar?  No reposit√≥rio, estamos pressionando isso para consolidar o artefato.  Claro, estamos falando sobre esse time D. Apenas fique na vers√£o antiga at√© voc√™ se atualizar!  Isso cria um jogo covarde.  A equipe A continua trabalhando no seu componente, ignorando o fato de que a equipe D est√° usando uma vers√£o cada vez mais desatualizada (esse √© um problema para a equipe D, eles s√£o est√∫pidos).  Enquanto isso, a equipe D est√° falando mal da atitude descuidada da equipe A em rela√ß√£o √† estabilidade do c√≥digo, se √© que falam sobre isso.  Meses se passam.  Finalmente, a equipe D decide dar uma olhada na op√ß√£o de atualiza√ß√£o, mas h√° apenas mais altera√ß√µes em A.  A equipe A mal lembra quando e como eles quebraram D. A atualiza√ß√£o √© mais dolorosa e levar√° mais tempo.  O que o envia mais abaixo na pilha de prioridades.  At√© aquele dia, at√© que tenhamos um problema de seguran√ßa em A, o que nos for√ßa a fazer uma filial.  A equipe A deve voltar no tempo, encontrar o momento em que D estava est√°vel, corrigir o problema e prepar√°-lo para o lan√ßamento.  <strong>Essa √© a escolha de fato que as pessoas fazem, e √© de longe a pior.</strong>  Isso parece ser bom para as equipes A e D, desde que possamos nos ignorar. </p><br><p>  No monoreposit√≥rio, o terceiro n√£o √© realmente uma op√ß√£o.  Voc√™ √© for√ßado a lidar com a situa√ß√£o de duas maneiras.  Voc√™ precisa ver os custos de ter duas ramifica√ß√µes de libera√ß√£o.  Aprenda a se proteger de atualiza√ß√µes que quebram a compatibilidade com vers√µes anteriores.  Mas a principal coisa: <em>voc√™ n√£o pode evitar uma conversa dif√≠cil.</em> </p><br><p>  Na minha experi√™ncia, quando as equipes se tornam grandes, n√£o √© mais poss√≠vel manter todo o sistema em mente, e essa √© a parte mais importante.  Voc√™ precisa melhorar a visibilidade das diverg√™ncias no sistema.  Voc√™ deve trabalhar ativamente para que as equipes desviem os olhos dos componentes e examinem o trabalho de outras equipes e consumidores. </p><br><p>  Sim, voc√™ pode criar ferramentas que tentar√£o resolver o problema dos poli-reposit√≥rios.  Mas minha experi√™ncia no ensino da entrega e automa√ß√£o cont√≠nuas em grandes empresas me diz o seguinte: o comportamento padr√£o sem o uso de ferramentas adicionais √© o que voc√™ espera ver.  <strong>O comportamento padr√£o do reposit√≥rio √© o isolamento, esse √© o ponto.</strong>  <strong>O comportamento padr√£o de um mono-reposit√≥rio √© responsabilidade e transpar√™ncia compartilhadas, esse √© o ponto.</strong>  Nos dois casos, vou criar uma ferramenta que suavizar√° cantos afiados.  Como l√≠der, sempre escolherei um mono-reposit√≥rio, porque os instrumentos devem fortalecer a cultura que eu quero, e a cultura vem de pequenas decis√µes e do trabalho di√°rio da equipe. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453958/">https://habr.com/ru/post/pt453958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453942/index.html">Sobre √©tica com o exemplo do PMI Codex</a></li>
<li><a href="../pt453944/index.html">Erros mascarados no embedd</a></li>
<li><a href="../pt453950/index.html">Voc√™ deveria estar aqui! 22 anos do lan√ßamento do lend√°rio jogo Duke Nukem 3D</a></li>
<li><a href="../pt453952/index.html">‚ÄúA solicita√ß√£o amadureceu‚Äù: Alexei Fedorov sobre uma nova confer√™ncia sobre sistemas distribu√≠dos</a></li>
<li><a href="../pt453956/index.html">Museum DataArt. Terminal de v√≠deo ADM-3A. O carro √© pesado, confi√°vel, abate</a></li>
<li><a href="../pt453960/index.html">Global DevOps Bootcamp 2019 em Moscou</a></li>
<li><a href="../pt453962/index.html">RxSwift e Coroutines na Kotlin - desenvolvimento m√≥vel opcional da AGIMA e GeekBrains</a></li>
<li><a href="../pt453964/index.html">POO na linguagem R (parte 1): classes S3</a></li>
<li><a href="../pt453968/index.html">Desaprender pr√°ticas de revis√£o de c√≥digo t√≥xico</a></li>
<li><a href="../pt453970/index.html">Escrevemos o proxy reverso socks5 no PowerShell.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>