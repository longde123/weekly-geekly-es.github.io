<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïö üó£Ô∏è ü§üüèΩ Cr√©ez des constructions de syntaxe JavaScript personnalis√©es √† l'aide de Babel. Partie 1 üë¶ üîâ üëû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous publions la premi√®re partie de la traduction du mat√©riel, qui est d√©di√©e √† la cr√©ation de vos propres constructions syntaxiques pour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ez des constructions de syntaxe JavaScript personnalis√©es √† l'aide de Babel. Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470876/">  Aujourd'hui, nous publions la premi√®re partie de la traduction du mat√©riel, qui est d√©di√©e √† la cr√©ation de vos propres constructions syntaxiques pour JavaScript √† l'aide de Babel. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/af/mm/2j/afmm2jwbgwm7bzi3nwdf3namowg.jpeg"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Revue</font> </h2><br>  Tout d'abord, regardons ce que nous r√©aliserons lorsque nous arriverons √† la fin de ce document: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  '@@'   `foo`   function @@ foo(a, b, c) {   return a + b + c; } console.log(foo(1, 2)(3)); // 6</span></span></code> </pre> <br>  Nous allons impl√©menter la syntaxe <code>@@</code> qui permet les fonctions de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">curry</a> .  Cette syntaxe est similaire √† celle utilis√©e pour cr√©er des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions de g√©n√©rateur</a> , mais dans notre cas, au lieu du signe <code>*</code> , une s√©quence de caract√®res <code>@@</code> est plac√©e entre le mot-cl√© de la <code>function</code> et le nom de la <code>function</code> .  Par cons√©quent, lors de la d√©claration de fonctions, vous pouvez utiliser une construction de la <code>function @@ name(arg1, arg2)</code> formulaire <code>function @@ name(arg1, arg2)</code> . <br><br>  Dans l'exemple ci-dessus, lorsque vous travaillez avec la fonction <code>foo</code> , vous pouvez utiliser son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">application partielle</a> .  Appeler la fonction <code>foo</code> en lui passant autant de param√®tres qui est inf√©rieur au nombre d'arguments dont elle a besoin, renverra une nouvelle fonction qui peut prendre les arguments restants: <br><br><pre> <code class="javascript hljs">foo(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 6 const bar = foo(1, 2); // (n) =&gt; 1 + 2 + n bar(3); // 6</span></span></code> </pre> <br>  J'ai choisi la s√©quence de caract√®res <code>@@</code> car le symbole <code>@</code> ne peut pas √™tre utilis√© dans les noms de variables.  Cela signifie qu'une construction de la <code>function@@foo(){}</code> formulaire <code>function@@foo(){}</code> sera √©galement syntaxiquement correcte.  De plus, "l'op√©rateur" <code>@</code> est utilis√© pour les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions de d√©corateur</a> , et je voulais utiliser quelque chose de compl√®tement nouveau.  En cons√©quence, j'ai choisi la construction <code>@@</code> . <br><br>  Pour atteindre notre objectif, nous devons effectuer les actions suivantes: <br><br><ul><li>  Cr√©ez une fourchette de l'analyseur Babel. </li><li>  Cr√©ez votre propre plugin Babel pour la transformation de code. </li></ul><br>  On dirait quelque chose d'impossible? <br>  En fait, il n'y a rien de terrible ici, nous analyserons tout en d√©tail ensemble.  J'esp√®re que lorsque vous lirez ceci, vous ma√Ætriserez magistralement les subtilit√©s de Babel. <br><br><h2>  <font color="#3AC1EF">Cr√©ation d'une fourchette Babel</font> </h2><br>  Acc√©dez au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel</a> Babel sur GitHub et cliquez sur le bouton <code>Fork</code> , qui se trouve dans le coin sup√©rieur gauche de la page. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/adb/5d3/eff/adb5d3effaecdfaead72747dd75f6991.png"></div><br>  <i><font color="#999999">Cr√©ation d'une fourchette de Babel ( <a href="">image en taille r√©elle</a> )</font></i> <br><br>  Et en passant, si vous venez de cr√©er le fork du projet open source populaire pour la premi√®re fois - f√©licitations! <br><br>  Maintenant, clonez la fourche Babel sur votre ordinateur et <a href="">pr√©parez-la pour le travail</a> . <br><br><pre> <code class="javascript hljs">$ git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/tanhauhau/babel.git # set up $ cd babel $ make bootstrap $ make build</span></span></code> </pre> <br>  Permettez-moi maintenant de parler bri√®vement de l'organisation du r√©f√©rentiel Babel. <br><br>  Babel utilise un monorepositaire.  Tous les packages (par exemple <code>@babel/core</code> , <code>@babel/parser</code> , <code>@babel/plugin-transform-react-jsx</code> et ainsi de suite) se trouvent dans le dossier <code>packages/</code> .  Cela ressemble √† ceci: <br><br><pre> <code class="javascript hljs">- doc - packages  - babel-core  - babel-parser  - babel-plugin-transform-react-jsx  - ... - Gulpfile.js - Makefile - ...</code> </pre> <br>  Je note que Babel utilise un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Makefile</a> pour automatiser les t√¢ches.  Lors de la construction d'un projet par la <code>make build</code> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gulp est</a> utilis√© comme gestionnaire de t√¢ches. <br><br><h2>  <font color="#3AC1EF">Conversion de code en AST Short Course</font> </h2><br>  Si vous n'√™tes pas familier avec des concepts tels que ¬´analyseur¬ª et ¬´arbre de syntaxe abstraite¬ª (AST), puis avant de continuer la lecture, je vous recommande fortement de jeter un ≈ìil √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce</a> mat√©riel. <br><br>  Si vous parlez tr√®s bri√®vement de ce qui se passe lors de l'analyse (analyse) du code, vous obtenez les informations suivantes: <br><br><ul><li>  Le code pr√©sent√© sous forme de cha√Æne (type <code>string</code> ) ressemble √† une longue liste de caract√®res: <code>f, u, n, c, t, i, o, n, , @, @, f, ...</code> </li><li>  Au tout d√©but, Babel effectue la tokenisation du code.  Dans cette √©tape, Babel scanne le code et cr√©e des jetons.  Par exemple, quelque chose comme <code>function, @@, foo, (, a, ...</code> </li><li>  Ensuite, les jetons sont pass√©s √† travers l'analyseur pour leur analyse.  Ici Babel, bas√© sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sp√©cification</a> du langage JavaScript, cr√©e un arbre de syntaxe abstrait. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici une</a> excellente ressource pour ceux qui veulent en savoir plus sur les compilateurs. <br><br>  Si vous pensez que le ¬´compilateur¬ª est quelque chose de tr√®s complexe et d'incompr√©hensible, sachez qu'en r√©alit√© tout n'est pas si myst√©rieux.  La compilation consiste simplement √† analyser le code et √† cr√©er un nouveau code sur sa base, que nous appellerons XXX.  Le code XXX peut √™tre repr√©sent√© par le code machine (peut-√™tre, le code machine est ce qui appara√Æt d'abord dans l'esprit de la plupart d'entre nous lorsque nous pensons au compilateur).  Il peut s'agir d'un code JavaScript compatible avec les anciens navigateurs.  En fait, l'une des principales fonctions de Babel est la compilation de code JS moderne en code compr√©hensible pour les navigateurs obsol√®tes. <br><br><h2>  <font color="#3AC1EF">D√©velopper votre propre analyseur pour Babel</font> </h2><br>  Nous allons travailler dans le dossier <code>packages/babel-parser/</code> : <br><br><pre> <code class="javascript hljs">- src/  - tokenizer/  - parser/  - plugins/    - jsx/    - typescript/    - flow/    - ... - test/</code> </pre> <br>  Nous avons d√©j√† parl√© de la tokenisation et de l'analyse.  Vous pouvez trouver le code qui impl√©mente ces processus dans des dossiers avec les noms correspondants.  Le <code>plugins/</code> dossier contient des plugins (plugins) qui √©tendent les capacit√©s de l'analyseur de base et ajoutent la prise en charge de syntaxes suppl√©mentaires dans le syst√®me.  C'est exactement ainsi, par exemple, que le <code>jsx</code> et le <code>flow</code> sont impl√©ment√©s. <br><br>  R√©solvons notre probl√®me en utilisant la technologie de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©veloppement par</a> le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biais de tests</a> (d√©veloppement pilot√© par les tests, TDD).  √Ä mon avis, il est plus facile d'√©crire un test d'abord, puis, en travaillant progressivement sur le syst√®me, de faire ce test sans erreurs.  Cette approche est particuli√®rement bonne lorsque vous travaillez dans une base de code inconnue.  TDD permet de comprendre facilement o√π vous devez apporter des modifications au code pour impl√©menter vos fonctionnalit√©s pr√©vues. <br><br><pre> <code class="javascript hljs">packages/babel-parser/test/curry-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">import</span></span></span><span class="hljs-function"> </span></span>{ parse } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../lib'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code</span></span></span><span class="hljs-function">) </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> parse(code, { <span class="hljs-attr"><span class="hljs-attr">sourceType</span></span>: <span class="hljs-string"><span class="hljs-string">'module'</span></span> }); } describe(<span class="hljs-string"><span class="hljs-string">'curry function syntax'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{  it(<span class="hljs-string"><span class="hljs-string">'should parse'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{    expect(getParser(<span class="hljs-string"><span class="hljs-string">`function @@ foo() {}`</span></span>)()).toMatchSnapshot();  }); });</code> </pre> <br>  Vous pouvez ex√©cuter le test de <code>babel-parser</code> comme ceci: <code>TEST_ONLY=babel-parser TEST_GREP="curry function" make test-only</code> .  Cela vous permettra de voir les erreurs: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">SyntaxError</span></span>: Unexpected token (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>) at Parser.raise (packages/babel-parser/src/parser/location.js:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">63</span></span>) at Parser.raise [<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> unexpected] (packages/babel-parser/src/parser/util.js:<span class="hljs-number"><span class="hljs-number">133</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>) at Parser.unexpected [<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parseIdentifierName] (packages/babel-parser/src/parser/expression.js:<span class="hljs-number"><span class="hljs-number">2090</span></span>:<span class="hljs-number"><span class="hljs-number">18</span></span>) at Parser.parseIdentifierName [<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parseIdentifier] (packages/babel-parser/src/parser/expression.js:<span class="hljs-number"><span class="hljs-number">2052</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span>) at Parser.parseIdentifier (packages/babel-parser/src/parser/statement.js:<span class="hljs-number"><span class="hljs-number">1096</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>)</code> </pre> <br>  Si vous trouvez que la visualisation de tous les tests prend trop de temps, vous pouvez, pour ex√©cuter le test souhait√©, appeler directement <code>jest</code> : <br><br><pre> <code class="javascript hljs">BABEL_ENV=test node_modules/.bin/jest -u packages/babel-parser/test/curry-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span></span></code> </pre> <br>  Notre analyseur a d√©couvert 2 <code>@</code> jetons, apparemment compl√®tement innocents, o√π ils ne devraient pas √™tre. <br><br>  Comment le savais-je?  La r√©ponse √† cette question nous aidera √† trouver l'utilisation du mode de surveillance de code lanc√© par la <code>make watch</code> . <br><br>  La visualisation de la pile d'appels nous conduit √† <a href="">packages / babel-parser / src / parser / expression.js</a> , o√π l'exception <code>this.unexpected()</code> lev√©e. <br><br>  Ajoutez quelques commandes de journalisation √† ce fichier: <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/parser/expression.js parseIdentifierName(pos: number, liberal?: boolean): string {  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.match(tt.name)) {    <span class="hljs-comment"><span class="hljs-comment">// ...  } else {    console.log(this.state.type); //      console.log(this.lookahead().type); //      throw this.unexpected();  } }</span></span></code> </pre> <br>  Comme vous pouvez le voir, les deux jetons sont <code>@</code> : <br><br><pre> <code class="javascript hljs">TokenType {  <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'@'</span></span>,  <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  Comment ai-je d√©couvert que les constructions <code>this.state.type</code> et <code>this.lookahead().type</code> me donneront les jetons actuels et suivants? <br>  J'en parlerai dans la section de ce document consacr√©e aux fonctions <code>this.eat</code> , <code>this.match</code> et <code>this.next</code> . <br><br>  Avant de continuer, r√©sumons: <br><br><ul><li>  Nous avons √©crit un test pour <code>babel-parser</code> . </li><li>  Nous avons ex√©cut√© le test en utilisant <code>make test-only</code> . </li><li>  Nous avons utilis√© le mode de surveillance du code √† l'aide de <code>make watch</code> . </li><li>  Nous avons appris l'√©tat de l'analyseur et <code>this.state.type</code> informations sur le type du jeton actuel ( <code>this.state.type</code> ) dans la console. </li></ul><br>  Et maintenant, nous allons nous assurer que 2 caract√®res <code>@</code> ne sont pas per√ßus comme des jetons s√©par√©s, mais comme un nouveau jeton <code>@@</code> , celui que nous avons d√©cid√© d'utiliser pour les fonctions de curry. <br><br><h2>  <font color="#3AC1EF">Nouveau jeton: "@@"</font> </h2><br>  Tout d'abord, regardons o√π les types de jetons sont d√©termin√©s.  Il s'agit du fichier <a href="">packages / babel-parser / src / tokenizer / types.js</a> . <br><br>  Vous trouverez ici une liste de jetons.  Ajoutez ici la d√©finition du nouveau jeton <code>atat</code> : <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/tokenizer/types.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> types: { [name: string]: TokenType } = {  <span class="hljs-comment"><span class="hljs-comment">// ...  at: new TokenType('@'),  atat: new TokenType('@@'), };</span></span></code> </pre> <br>  Cherchons maintenant l'endroit dans le code o√π, dans le processus de tokenisation, les jetons sont cr√©√©s.  La recherche de la s√©quence de caract√®res <code>tt.at</code> dans <code>babel-parser/src/tokenizer</code> nous conduit au fichier: <a href="">packages / babel-parser / src / tokenizer / index.js</a> .  Dans <code>babel-parser</code> les types de jetons sont import√©s en tant que <code>tt</code> . <br><br>  Maintenant, si apr√®s le symbole <code>@</code> actuel vient un autre <code>@</code> , cr√©ez un nouveau jeton <code>tt.atat</code> au lieu du jeton <code>tt.at</code> : <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/tokenizer/index.js getTokenFromCode(code: number): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> {  <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (code) {    <span class="hljs-comment"><span class="hljs-comment">// ...    case charCodes.atSign:      //    -  `@`      if (this.input.charCodeAt(this.state.pos + 1) === charCodes.atSign) {        //  `tt.atat`  `tt.at`        this.finishOp(tt.atat, 2);      } else {        this.finishOp(tt.at, 1);      }      return;    // ...  } }</span></span></code> </pre> <br>  Si vous relancez le test, vous remarquerez que les informations sur les jetons actuels et suivants ont chang√©: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   TokenType {  label: '@@',  // ... } //   TokenType {  label: 'name',  // ... }</span></span></code> </pre> <br>  √áa a d√©j√† l'air plut√¥t bien.  Nous allons continuer le travail. <br><br><h2>  <font color="#3AC1EF">Nouvel analyseur</font> </h2><br>  Avant de poursuivre, regardez comment les fonctions du g√©n√©rateur sont repr√©sent√©es dans AST. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ea/cc0/a9f/3eacc0a9fe1c5f780013f7d1d3d1ebe3.png"></div><br>  <i><font color="#999999">AST pour la fonction g√©n√©rateur ( <a href="">image en taille r√©elle</a> )</font></i> <br><br>  Comme vous pouvez le voir, l'attribut <code>generator: true</code> de l'entit√© <code>FunctionDeclaration</code> indique qu'il s'agit d'une <code>FunctionDeclaration</code> g√©n√©rateur. <br><br>  Nous pouvons adopter une approche similaire pour d√©crire une fonction qui prend en charge le curry.  √Ä savoir, nous pouvons ajouter l'attribut <code>curry: true</code> √† <code>FunctionDeclaration</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a6/056/e68/3a6056e68a6cd80fc136c6e010444d0b.png"></div><br>  <i><font color="#999999">AST pour la fonction de curry ( <a href="">image en taille r√©elle</a> )</font></i> <br><br>  En fait, nous avons maintenant un plan.  Traitons de sa mise en ≈ìuvre. <br><br>  Si vous recherchez dans le code le mot <code>FunctionDeclaration</code> , vous pouvez acc√©der √† la fonction <code>parseFunction</code> , qui est d√©clar√©e dans <a href="">packages / babel-parser / src / parser / statement.js</a> .  Ici vous pouvez trouver la ligne o√π l'attribut <code>generator</code> est d√©fini.  Ajoutez une autre ligne au code: <br><br><pre> <code class="javascript hljs">packages/babel-parser/src/parser/statement.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatementParser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExpressionParser</span></span></span><span class="hljs-class"> </span></span>{  <span class="hljs-comment"><span class="hljs-comment">// ...  parseFunction&lt;T: N.NormalFunction&gt;(    node: T,    statement?: number = FUNC_NO_FLAGS,    isAsync?: boolean = false  ): T {    // ...    node.generator = this.eat(tt.star);    node.curry = this.eat(tt.atat);  } }</span></span></code> </pre> <br>  Si nous refaisons le test, une agr√©able surprise nous attendra.  Le code est test√© avec succ√®s! <br><br><pre> <code class="javascript hljs">PASS packages/babel-parser/test/curry-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">curry</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">syntax</span></span></span><span class="hljs-function">    ‚úì </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">should</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">12</span></span></span></span><span class="hljs-function"><span class="hljs-params">ms</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br>  C'est tout?  Qu'avons-nous fait pour que le test r√©ussisse miraculeusement? <br><br>  Pour le savoir, parlons du fonctionnement de l'analyse.  Au cours de cette conversation, j'esp√®re que vous comprendrez comment la ligne <code>node.curry = this.eat(tt.atat);</code>  . <br><br>  √Ä suivre ... <br><br>  <b>Chers lecteurs!</b>  Utilisez-vous babel? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470876/">https://habr.com/ru/post/fr470876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470864/index.html">√Ä propos des plaisirs de passer au panneau et pas seulement</a></li>
<li><a href="../fr470868/index.html">Temps de premier octet: qu'est-ce que c'est et pourquoi est-il important</a></li>
<li><a href="../fr470870/index.html">Pr√©chargement des polices</a></li>
<li><a href="../fr470872/index.html">Mesures de performances pour la recherche d'applications Web incroyablement rapides</a></li>
<li><a href="../fr470874/index.html">Optimiser le chargement de JavaScript sur Wikipedia</a></li>
<li><a href="../fr470878/index.html">Cr√©ez des constructions de syntaxe JavaScript personnalis√©es √† l'aide de Babel. 2e partie</a></li>
<li><a href="../fr470880/index.html">M√©canique du jeu. Aventure, le concept de l'orthophonie z√©ro et convaincante</a></li>
<li><a href="../fr470882/index.html">Pourquoi avez-vous attrap√© ma souris ou un jeu de soci√©t√© comme mod√®le d'interaction sociale</a></li>
<li><a href="../fr470884/index.html">√âcriture et lecture de donn√©es dans la blockchain Bitcoin</a></li>
<li><a href="../fr470888/index.html">L√©gislation russe et internationale dans le domaine de la protection des donn√©es personnelles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>