<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•à üèúÔ∏è ‚ô†Ô∏è Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 4: ‚ÄúCompartilhando Privil√©gios‚Äù, Parte 2 üé£ üë©üèΩ‚Äçüî¨ ‚èèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instituto de Tecnologia de Massachusetts. Curso de Aula n¬∫ 6.858. "Seguran√ßa de sistemas de computador". Nikolai Zeldovich, James Mickens. 2014 ano 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 4: ‚ÄúCompartilhando Privil√©gios‚Äù, Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418197/"><h3>  Instituto de Tecnologia de Massachusetts.  Curso de Aula n¬∫ 6.858.  "Seguran√ßa de sistemas de computador".  Nikolai Zeldovich, James Mickens.  2014 ano </h3><br>  Computer Systems Security √© um curso sobre o desenvolvimento e implementa√ß√£o de sistemas de computador seguros.  As palestras abrangem modelos de amea√ßas, ataques que comprometem a seguran√ßa e t√©cnicas de seguran√ßa baseadas em trabalhos cient√≠ficos recentes.  Os t√≥picos incluem seguran√ßa do sistema operacional (SO), recursos, gerenciamento de fluxo de informa√ß√µes, seguran√ßa de idiomas, protocolos de rede, seguran√ßa de hardware e seguran√ßa de aplicativos da web. <br><br>  Palestra 1: ‚ÄúIntrodu√ß√£o: modelos de amea√ßas‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br>  Palestra 2: ‚ÄúControle de ataques de hackers‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br>  Aula 3: ‚ÄúEstouros de Buffer: Explora√ß√µes e Prote√ß√£o‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br>  Palestra 4: ‚ÄúSepara√ß√£o de Privil√©gios‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <a name="habracut"></a><br><br>  Ent√£o, o que mais t√≠nhamos nessa lista?  Processos.  A mem√≥ria √© algo que acontece simultaneamente com o processo.  Portanto, se voc√™ n√£o estiver nesse processo, n√£o poder√° acessar sua mem√≥ria.  A mem√≥ria virtual aprimora perfeitamente esse isolamento para n√≥s.  Al√©m disso, o mecanismo de depura√ß√£o permite "pop" na mem√≥ria de outro processo, se voc√™ tiver o mesmo ID do usu√°rio <br><br>  Em seguida, temos a rede.  As redes no <b>Unix</b> n√£o correspondem exatamente ao modelo descrito acima, em parte devido ao fato de o <b>sistema</b> operacional <b>Unix ter</b> sido desenvolvido pela primeira vez e, em seguida, aparecer uma rede, que logo se tornou popular.  Tem um conjunto de regras ligeiramente diferente.  Portanto, as opera√ß√µes que realmente precisamos cuidar est√£o conectando algu√©m √† rede se voc√™ gerencia a rede ou escutando alguma porta se voc√™ atua como servidor.  Pode ser necess√°rio ler ou gravar dados nessa conex√£o ou enviar e receber pacotes <b>brutos</b> . <br><br><img src="https://habrastorage.org/webt/dw/gn/zv/dwgnzva6txwuj_esllvdnx3uexg.jpeg"><br><br>  Assim, as redes no <b>Unix n√£o</b> s√£o relacionadas √† <b>identifica√ß√£o</b> do <b>usu√°rio</b> .  As regras s√£o que qualquer pessoa sempre pode conectar-se a qualquer m√°quina ou endere√ßo IP ou abrir uma conex√£o.  Se voc√™ deseja escutar em uma porta, nesse caso, h√° uma diferen√ßa: a maioria dos usu√°rios est√° proibida de escutar portas com um n√∫mero abaixo do "valor m√°gico" de 1024. Em princ√≠pio, voc√™ pode escutar essas portas, mas nesse caso voc√™ deve Seja um usu√°rio especial chamado <b>"superusu√°rio"</b> com <b>uid = 0</b> . <br><br>  Em geral, no Unix, existe o conceito de administrador ou superusu√°rio, representado pelo identificador uid = 0, que pode ignorar quase todas essas verifica√ß√µes; portanto, se voc√™ trabalha com direitos de root, pode ler e gravar arquivos, alterar os direitos de acesso a eles.  O sistema operacional permitir√° que voc√™ fa√ßa isso porque acha que voc√™ deve ter todos os privil√©gios.  E voc√™ realmente precisa de tais privil√©gios para ouvir em portas com n√∫mero &lt;1024. O que voc√™ acha dessa restri√ß√£o t√£o estranha? <br><br>  <b>P√∫blico:</b> identifica n√∫meros de porta espec√≠ficos para conex√µes espec√≠ficas, por exemplo, para <b>http</b> na porta 80. <br><br>  <b>Professor:</b> sim, por padr√£o, o <b>protocolo HTTP</b> usa a porta 80. Por outro lado, outros servi√ßos podem usar portas com um n√∫mero maior que 1024, por que essa restri√ß√£o √© necess√°ria?  Qual √© a utilidade aqui? <br><br>  <b>P√∫blico:</b> porque voc√™ n√£o deseja que ningu√©m escute acidentalmente seu <b>HTTP</b> . <br><br>  <b>Professor:</b> sim.  Eu acho que a raz√£o para isso √© que voc√™ costumava ter muitos usu√°rios na mesma m√°quina.  Eles efetuaram login com seus logins, lan√ßaram seus aplicativos, para que voc√™ desejasse ter certeza de que algum usu√°rio aleat√≥rio, tendo efetuado login no computador, n√£o seria capaz de se apossar do servidor Web em execu√ß√£o.  Como os usu√°rios que se conectam de fora n√£o sabem quem trabalha nessa porta e apenas se conectam √† porta 80. Se eu quiser entrar nesta m√°quina e iniciar meu pr√≥prio servidor da Web, transfiro todo o tr√°fego do servidor da Web para esse carro.  Esse provavelmente n√£o √© um plano muito bom, mas √© o modo como o subsistema de rede Unix impede que usu√°rios aleat√≥rios controlem servi√ßos conhecidos executados nesses n√∫meros de porta baixos.  Essa √© a l√≥gica de tal limita√ß√£o. <br><br><img src="https://habrastorage.org/webt/ba/0o/qn/ba0oqn2qgabud4-_hmizsks086s.jpeg"><br><br>  Al√©m disso, do ponto de vista da leitura e grava√ß√£o de dados de conex√£o, se voc√™ tiver um arquivo descritor para um soquete espec√≠fico, o <b>Unix</b> permitir√° que voc√™ leia e <b>grave</b> quaisquer dados nessa <b>conex√£o TCP</b> ou <b>uTP</b> .  Ao enviar pacotes <b>brutos</b> , o <b>Unix</b> se comporta como um paran√≥ico, portanto n√£o permite o envio de pacotes arbitr√°rios pela rede.  Isso deve estar dentro do contexto da conex√£o especial, a menos que voc√™ tenha o <b>root - o</b> certo e voc√™ possa fazer o que quiser. <br><br>  Ent√£o, uma pergunta interessante que voc√™ poderia fazer √© de onde v√™m todos esses <b>IDs de usu√°rio</b> ? <br><br>  Estamos falando de processos com <b>userid</b> ou <b>groupid</b> .  Ao iniciar o <b>PS</b> no seu computador, voc√™ definitivamente ver√° uma s√©rie de processos com diferentes valores de <b>uid</b> .  De onde eles vieram? <br><br>  Precisamos de algum mecanismo para carregar todos esses valores de <b>ID</b> do <b>usu√°rio</b> .  <b>O Unix</b> possui v√°rias chamadas de sistema projetadas para isso.  Portanto, para inicializar esses valores de identificador, existe uma fun√ß√£o chamada <b>setuid (uid)</b> , para que voc√™ possa atribuir o n√∫mero de <b>uid</b> de algum processo atual a esse valor.  Esta √© realmente uma opera√ß√£o perigosa, como tudo na tradi√ß√£o do <b>Unix</b> , porque voc√™ s√≥ pode fazer isso se o seu <b>uid = 0</b> .  De qualquer forma, deve ser assim. <br><br>  Portanto, se voc√™ √© um usu√°rio com direitos de root e possui <b>uid = 0</b> , pode chamar <b>setuid (uid)</b> e alternar o usu√°rio para qualquer processo.  Existem algumas outras chamadas de sistema semelhantes para inicializar o <b>gid</b> relacionado ao processo: s√£o <b>setgid</b> e <b>setgroups</b> .  Portanto, essas chamadas do sistema permitem configurar privil√©gios de processo. <br><br><img src="https://habrastorage.org/webt/qs/6m/bk/qs6mbkc520bn-n_vlpznivx1z0q.jpeg"><br><br>  O fato de seus processos obterem os direitos de acesso corretos quando voc√™ efetua login na m√°quina <b>Unix</b> n√£o ocorre porque voc√™ tem o mesmo <b>ID</b> dos processos, porque o sistema ainda n√£o sabe quem voc√™ √©.  Em vez disso, no <b>Unix,</b> existe algum tipo de procedimento de login quando o <b>protocolo</b> shell seguro <b>SSH</b> inicia o processo para qualquer pessoa que se conecta ao computador e tenta autenticar o usu√°rio. <br><br>  Portanto, inicialmente esse processo de login come√ßa com <b>uid = 0,</b> como para um usu√°rio com direitos de root, e quando recebe um nome de usu√°rio e senha espec√≠ficos, ele os verifica em seu pr√≥prio banco de dados de contas.  Como regra, no <b>Unix,</b> esses dados s√£o armazenados em dois arquivos: <b>/ etc / password</b> (por raz√µes hist√≥ricas, as senhas n√£o s√£o mais armazenadas nesse arquivo) e no arquivo <b>/ etc / shadow</b> , no qual as senhas s√£o armazenadas.  No entanto, h√° uma tabela no arquivo <b>/ etc / password</b> que exibe cada nome de usu√°rio no sistema como um valor inteiro. <br><br>  Portanto, seu nome de usu√°rio √© mapeado para um n√∫mero inteiro espec√≠fico neste arquivo <b>/ etc / password</b> e, em seguida, o processo de login verifica se sua senha est√° correta de acordo com este arquivo.  Se encontrar seu <b>uid</b> inteiro, ele definir√° as fun√ß√µes <b>setuid</b> para esse valor de <b>uid</b> e iniciar√° o shell com o comando <b>exec (/ bin / sh)</b> .  Agora voc√™ pode interagir com o shell, mas ele funciona sob o seu <b>uid</b> ; portanto, voc√™ n√£o poder√° causar danos acidentais a esta m√°quina. <br><br><img src="https://habrastorage.org/webt/oa/vi/t8/oavit8bjjn_skjz8-n1k5dhc6co.jpeg"><br><br>  <b>P√∫blico: √©</b> poss√≠vel iniciar um novo processo com <b>uid = 0</b> se o seu <b>uid</b> n√£o for realmente 0? <br><br>  <b>Professor:</b> se voc√™ tiver privil√©gios de root, poder√° se limitar a outro <b>uid</b> , diminuir sua autoridade, mas, em qualquer caso, poder√° criar um processo com apenas o mesmo <b>uid</b> que o seu.  Mas acontece que, por v√°rias raz√µes, voc√™ deseja aumentar seus privil√©gios.  Suponha que voc√™ precise instalar um pacote, para o qual voc√™ precisa de privil√©gios de <b>root</b> . <br><br>  Existem duas maneiras de definir privil√©gios no <b>Unix</b> .  Um que j√° mencionamos √© um descritor de arquivo.  Portanto, se voc√™ realmente deseja aumentar seus privil√©gios, pode conversar com algu√©m que trabalha com direitos de root e pedir que ele abra esse arquivo para voc√™.  Ou voc√™ precisa instalar uma nova interface, esse assistente abre um arquivo para voc√™ e retorna um descritor de arquivo para voc√™ usando a transfer√™ncia <b>fd</b> .  Essa √© uma maneira de aumentar seus privil√©gios, mas √© inconveniente porque, em alguns casos, existem processos em execu√ß√£o com um grande n√∫mero de privil√©gios.  Para isso, o <b>Unix</b> possui um mecanismo inteligente, mas ao mesmo tempo problem√°tico, chamado <b>"bin√°rios setuid"</b> .  Esse mecanismo √© execut√°vel regularmente em um <b>sistema de</b> arquivos <b>Unix</b> , exceto quando voc√™ executa <b>exec</b> no bin√°rio <b>setuid</b> , por exemplo, <b>/ bin / su</b> na maioria das m√°quinas, ou <b>sudo</b> , na inicializa√ß√£o. <br><br>  Um sistema <b>Unix</b> t√≠pico possui um monte de bin√°rios <b>setuid</b> .  A diferen√ßa √© que, quando voc√™ executa um desses bin√°rios, na verdade, ele alterna a <b>identifica√ß√£o do usu√°rio do</b> processo para o propriet√°rio desse bin√°rio.  Esse mecanismo parece estranho quando voc√™ o v√™ pela primeira vez.  Como regra, as maneiras de us√°-lo s√£o que esse ‚Äúbin√°rio‚Äù provavelmente possui um propriet√°rio <b>de</b> 0, porque voc√™ realmente deseja restaurar muitos privil√©gios. <br><br><img src="https://habrastorage.org/webt/zt/s5/8d/zts58db83nchnbo1a6qqobpbpuw.jpeg"><br><br>  Voc√™ deseja restaurar os direitos do superusu√°rio para poder executar este comando <b>su</b> , e o kernel, ao executar esse bin√°rio, alternar√° o processo <b>uid</b> para 0, para que este programa agora execute algumas coisas privilegiadas. <br><br>  <b>P√∫blico:</b> se voc√™ tiver <b>uid = 0</b> e alterar o <b>uid de</b> todos esses bin√°rios <b>setuid</b> para algo diferente de 0, poder√° restaurar seus privil√©gios? <br><br>  <b>Professor:</b> n√£o, muitos processos n√£o poder√£o restaurar privil√©gios ao diminuir o n√≠vel de acesso; portanto, voc√™ pode ficar preso nesse local.  Este mecanismo n√£o est√° vinculado a <b>uid = 0</b> .  Como qualquer usu√°rio de um sistema <b>Unix</b> , voc√™ pode criar qualquer arquivo bin√°rio, criar um programa, compil√°-lo e definir esse bit <b>setuid</b> para o pr√≥prio programa.  Pertence a voc√™, usu√°rio, seu ID de usu√°rio.  E isso significa que qualquer pessoa que execute seu programa executar√° esse c√≥digo com seu ID de usu√°rio.  Existe algum problema com isso?  O que precisa ser feito? <br><br>  <b>P√∫blico:</b> ou seja, se houve um erro no seu aplicativo, algu√©m poderia fazer algo com ele, agindo com seus privil√©gios? <br><br>  <b>Professor:</b> certo, isso acontece se meu aplicativo for "buggy" ou se permitir que voc√™ execute tudo o que deseja.  Suponha que eu possa copiar o shell do sistema e <b>defini-</b> lo para mim, mas qualquer um pode executar esse shell na minha conta.  Este provavelmente n√£o √© o melhor plano de a√ß√£o.  Mas esse mecanismo n√£o cria um problema, porque a √∫nica pessoa que pode definir o bit <b>setuid</b> em um arquivo bin√°rio √© o propriet√°rio desse arquivo.  Voc√™, como propriet√°rio do arquivo, tem o privil√©gio <b>uid</b> , para poder transferir sua conta para outra pessoa, mas essa outra pessoa n√£o poder√° criar o bin√°rio <b>setuid</b> com seu <b>ID do usu√°rio</b> . <br><br>  Esse bit setuid √© armazenado pr√≥ximo a esses bits de permiss√£o, ou seja, em cada <b>inode</b> tamb√©m h√° um bit <b>setuid</b> que diz se esse arquivo execut√°vel deve ou se o programa mudou para o propriet√°rio <b>uid</b> durante a execu√ß√£o. <br><br><img src="https://habrastorage.org/webt/4d/o0/cf/4do0cfauri7y6g94omunnrdyv14.jpeg"><br><br>  Acontece que este √© um mecanismo muito complicado quando usado corretamente e, gra√ßas a ele, o kernel implementa o programa corretamente.  Na verdade, isso √© bastante f√°cil de fazer, porque apenas uma verifica√ß√£o √© realizada: se esse bit <b>setuid</b> existe, o processo muda para <b>uid</b> .  √â bem simples. <br><br>  Mas us√°-lo com seguran√ßa √© bastante dif√≠cil, porque, como acabamos de indicar, se este programa cont√©m erros ou faz algo inesperado, voc√™ pode fazer coisas arbitr√°rias sob <b>uid = 0</b> ou sob qualquer outro <b>uid</b> .  No <b>Unix,</b> quando voc√™ executa um programa, herda muitas coisas do processo pai. <br><br>  Por exemplo, voc√™ pode passar vari√°veis ‚Äã‚Äãde ambiente para bin√°rios <b>setuid</b> .  O fato √© que, no <b>Unix,</b> voc√™ pode especificar qual biblioteca compartilhada usar para o processo, definindo a vari√°vel de ambiente, e os bin√°rios <b>setuid</b> n√£o se importam em filtrar essas vari√°veis ‚Äã‚Äãde ambiente. <br><br>  Por exemplo, voc√™ pode executar o <b>bin / su</b> , mas use bibliotecas compartilhadas para a fun√ß√£o <b>printf</b> , para que o <b>printf</b> inicie quando o <b>bin / su</b> imprimir alguma coisa e voc√™ possa executar o shell em vez de o printingf. <br><br>  Existem muitas sutilezas que voc√™ deve entender corretamente em rela√ß√£o √† desconfian√ßa do programa com os dados inseridos pelo usu√°rio.  Como voc√™ geralmente confia na entrada do usu√°rio, o <b>setuid</b> nunca foi a parte mais segura de um sistema <b>Unix</b> inteiro.  Tem perguntas sobre isso? <br><br>  <b>P√∫blico:</b> o <b>setuid</b> tamb√©m se aplica a grupos ou apenas ao usu√°rio? <br><br>  <b>Professor:</b> existe um bit <b>setgid</b> sim√©trico ao bit <b>setuid</b> , que voc√™ tamb√©m pode definir.  Se o arquivo tiver um <b>gid</b> espec√≠fico e esse bit <b>setgid</b> estiver definido quando o programa for iniciado, voc√™ o receber√°. <br><br>  <b>O Setgid</b> n√£o <b>√©</b> particularmente usado, mas pode ser √∫til nos casos em que voc√™ deseja fornecer privil√©gios muito espec√≠ficos.  Por exemplo, o <b>bin / su</b> provavelmente precisa de muitos privil√©gios, mas talvez haja algum programa que precise de alguns privil√©gios extras, por exemplo, para gravar algo em um arquivo de log especial.  Portanto, voc√™ provavelmente deseja fornecer a ela um determinado grupo e criar um arquivo de log que seja grav√°vel por esse grupo.  Portanto, mesmo que o programa seja "buggy", voc√™ n√£o perder√° nada al√©m deste grupo.  Isso √© √∫til como um mecanismo que, por algum motivo, n√£o √© usado com muita frequ√™ncia, porque, afinal, as pessoas devem usar mais os direitos de root. <br><br>  <b>P√∫blico:</b> existem restri√ß√µes sobre quem pode alterar o acesso? <br><br>  <b>Professor:</b> sim.  Implementa√ß√µes diferentes do <b>Unix</b> t√™m verifica√ß√µes diferentes para isso.  A regra geral √© que apenas o root pode alterar o propriet√°rio do arquivo, porque voc√™ n√£o deseja criar arquivos que pertencer√£o a outra pessoa e, √© claro, n√£o deseja se apropriar dos arquivos de outras pessoas.  Portanto, se o seu <b>uid</b> n√£o <b>for</b> 0, voc√™ estar√° preso.  Voc√™ n√£o pode alterar a propriedade de nenhum arquivo.  Se seu <b>uid = 0</b> , voc√™ possui privil√©gios de root e pode alterar o propriet√°rio para qualquer um.  Existem algumas complica√ß√µes se voc√™ tiver um <b>setuid</b> bin√°rio e mudar de um <b>uid</b> para outro, isso √© bastante complicado, mas basicamente voc√™ n√£o pode alterar o propriet√°rio do arquivo se n√£o tiver privil√©gios de root. <br><br>  Por todas as contas, este √© um sistema um pouco desatualizado.  Voc√™ provavelmente poderia imaginar v√°rias maneiras de simplificar os processos descritos acima, mas, na verdade, os sistemas mais avan√ßados se parecem com isso porque evoluem com o tempo.  Mas voc√™ pode usar perfeitamente esses mecanismos como uma "caixa de areia". <br><br>  Estes s√£o apenas alguns tipos de princ√≠pios b√°sicos do <b>Unix</b> , que aparecem em quase todos os sistemas operacionais do tipo Unix: <b>Mac OS X</b> , <b>Linux</b> , <b>FreeBSD</b> , <b>Solaris</b> , se algu√©m o usa, e assim por diante.  Mas cada um desses sistemas possui mecanismos mais sofisticados que voc√™ pode usar.  Por exemplo, no <b>Linux,</b> existe um conjunto de "sandbox" <b>COMP</b> , o <b>Mac OS X</b> usa o cinto de <b>seguran√ßa</b> "sandbox".  Na pr√≥xima semana, darei exemplos de caixas de prote√ß√£o dispon√≠veis em todos os sistemas baseados em <b>Unix</b> . <br><br>  Portanto, um dos √∫ltimos mecanismos, que consideraremos antes de mergulhar no <b>OKWS</b> , explica como voc√™ precisa lidar com bin√°rios <b>setuid</b> e mostra como voc√™ pode se proteger contra falhas de seguran√ßa existentes.  O problema √© que voc√™ inevitavelmente ter√° alguns bin√°rios <b>setuid</b> no seu sistema, como <b>/ bin / su</b> ou <b>sudo</b> ou qualquer outra coisa, e √© prov√°vel que seus programas apresentem erros.  Por isso, algu√©m poder√° executar o bin√°rio <b>setuid</b> e o processo poder√° obter acesso <b>root</b> , o que voc√™ n√£o deseja permitir. <br><br><img src="https://habrastorage.org/webt/gy/nt/aa/gyntaadl0kgyfcku6ncq8v334kg.jpeg"><br><br>  O mecanismo <b>Unix</b> , que geralmente √© usado para impedir a execu√ß√£o de um processo potencialmente malicioso usando bin√°rios <b>setuid</b> , √© usar o namespace do sistema de arquivos para alter√°-lo usando a chamada do sistema <b>chroot</b> , a opera√ß√£o de alterar o diret√≥rio raiz.  <b>O OKWS</b> , como servidor da web especializado na cria√ß√£o de servi√ßos da web r√°pidos e seguros, usa isso amplamente. <br><br><img src="https://habrastorage.org/webt/m3/x1/xr/m3x1xrg_tmht2b2l8rwd8kzzy7s.jpeg"><br><br>  Ent√£o, no <b>Unix,</b> voc√™ pode executar <b>chroot</b> em um diret√≥rio espec√≠fico, ent√£o talvez voc√™ tamb√©m possa executar <b>chroot ("/ foo")</b> . <br><br>  Existem 2 explica√ß√µes para o que o <b>chroot</b> faz.  O primeiro √© apenas intuitivo, significa que, ap√≥s executar o <b>chroot</b> , o diret√≥rio raiz ou o diret√≥rio localizado atr√°s da barra √© basicamente equivalente ao que <b>/ foo usou</b> antes de voc√™ chamar <b>chroot</b> .  Parece limitar o namespace abaixo do seu <b>/ foo</b> .  Portanto, se voc√™ tem um arquivo que costumava ser chamado <b>/ foo / x</b> , depois de chamar o <b>chroot,</b> pode obt√™-lo simplesmente abrindo <b>/ x</b> .  Portanto, basta limitar seu espa√ßo para nome a um subdiret√≥rio.  Aqui est√° o que √© a vers√£o intuitiva. <br><br><img src="https://habrastorage.org/webt/2w/58/wf/2w58wflgecku62k-urraxwggxcc.jpeg"><br><br>  Obviamente, em seguran√ßa, n√£o √© a vers√£o intuitiva que importa, mas o que exatamente o kernel faz com essa chamada de sistema?  E faz basicamente duas coisas.  Primeiro, ele altera o valor dessa barra, portanto, sempre que voc√™ acessa ou inicia o nome do diret√≥rio com uma barra, o kernel inclui qualquer arquivo que voc√™ forneceu nas opera√ß√µes <b>chroot</b> .  No nosso exemplo, este √© o arquivo <b>/ foo</b> antes de voc√™ chamar <b>chroot</b> , ou seja, obtemos esse <b>/ = / foo</b> . <br><br><img src="https://habrastorage.org/webt/gn/yx/-t/gnyx-tksd5brn4avys0dhppaw6c.jpeg"><br><br>  A pr√≥xima coisa que o kernel tentar√° fazer √© proteg√™-lo de ser capaz de "escapar" do seu <b>/</b> se voc√™ fizer <b>/../</b> .  Porque no <b>Unix,</b> eu poderia pedir que voc√™ me desse, por exemplo, <b>/../etc/password</b> .  Portanto, se eu apenas suplementasse essa linha assim: <b>/foo/../etc/password</b> , isso n√£o seria bom, porque eu poderia simplesmente sair do <b>/ foo</b> e continuar com o <b>/ etc / password</b> . <br><br>  A segunda coisa que o kernel faz com uma chamada de sistema <b>Unix</b> √© que, quando voc√™ chama <b>chroot</b> para esse processo espec√≠fico, ele muda a maneira como <b>/../ √©</b> avaliado neste diret√≥rio.  Portanto, modifica <b>/../</b> para que <b>/ foo</b> aponte para si mesmo.  Portanto, isso n√£o permite que voc√™ "escape", e essa altera√ß√£o se aplica apenas a esse processo e n√£o afeta o resto.  Que id√©ias voc√™ tem sobre como "escapar" do ambiente <b>chroot</b> usando como ele √© implementado? <br><br>  Curiosamente, o kernel monitora apenas um diret√≥rio <b>chroot</b> , ent√£o voc√™ provavelmente pode executar a opera√ß√£o <b>chroot = (/ foo)</b> , mas voc√™ estaria preso a esse local.  Ent√£o voc√™ quer obter o <b>/ etc / password</b> , mas como faz√™-lo?  Voc√™ pode abrir o diret√≥rio raiz agora mesmo, digitando <b>abrir (* / *)</b> .  Isso fornecer√° um descritor de arquivo descrevendo o que √© <b>/ foo</b> .  Ent√£o voc√™ pode chamar <b>chroot</b> novamente e executar <b>chroot (`/ bar)</b> . <br><br><img src="https://habrastorage.org/webt/er/ce/o6/erceo6xadygvj95nuy8fj-zn1bi.jpeg"><br><br> ,    : <b>root</b>   <b>/foo</b> ,  <b>/foo/bar</b>   <b>/../</b>     <b>/foo / bar/..</b> <br><br><img src="https://habrastorage.org/webt/gi/vb/zy/givbzygict7u1xirzzwneycl3sw.jpeg"><br><br>  ,          <b>/foo</b> .            <b>fchdir (fd)</b>     <b>(*/*)</b> ,      <b>chdir (..)</b> . <br><br><img src="https://habrastorage.org/webt/lb/qz/mx/lbqzmxnz8308avfwfyaxxprq7d8.jpeg"><br><br><img src="https://habrastorage.org/webt/gu/cn/kd/gucnkdez6q9ntda3zwtotnc4igg.jpeg"><br><br>       <b>/foo</b> ,     <b>/../</b> .     <b>/foo</b>        ,       <b>root</b> ,       . <br><br> ,    ,       .       .   <b>Unix</b>    root-   <b>chroot</b> ,  <b>chroot</b>     .  ,  <b>Unix</b>    <b>uid = 0</b>  ,      <b>chroot</b> .   .           ,         ,    <b>chroot</b> ,   <b>userid</b>   .   ,     <b>Unix</b> ,     ,    <b>root</b> ,    . <br><br>       ,  , ,     .      <b>chroot</b>       ‚Äî      .    . <br><br> <b>:</b>  ,       <b>inod</b> ,      ? <br><br> <b>:</b>    !              ,  , , : ¬´   <b>inode</b>  23¬ª,      -        <b>hroot</b> .  ,  <b>Unix</b>     <b>inode</b>   <b>inode</b> ,  , ,   root-. <br><br>  ,      ,  ,   <b>OKWS</b> .  ,      <b>OKWS</b> . <br><br>  ,     -,   ,      -  ,      .          , , <b>httpd</b> , ,  <b>Apache</b> . <br><br>        <b>userid</b>   <b>www</b>  <b>/etc/password</b> .     ,   ,     <b>SSL</b> ,      <b>PHP</b>   ,        .   ,       , , <b>MySQL</b> ,           .    <b>MySQL</b>     .      <b>MySQL</b> , , ,      . <br><br><img src="https://habrastorage.org/webt/sx/tx/gd/sxtxgdpf7q9jr3q_tfxyzi6zgdc.jpeg"><br><br> ,  ,    ,    <b>MySQL</b>    ,        ,             . <br><br>         ,       ,  ,         ,   .    ,      , ,     <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou talvez no c√≥digo do aplicativo ou no interpretador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E, como existem erros, voc√™ pode us√°-los para obter todo o conte√∫do do aplicativo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52:30 min </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continua√ß√£o:</font></font><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Curso MIT "Seguran√ßa de sistemas de computadores".</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Palestra 4: ‚ÄúCompartilhando Privil√©gios‚Äù, Parte 2</font></font></a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/dNl22h1kW1k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vers√£o completa do curso est√° dispon√≠vel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  Obrigado por ficar conosco.  Voc√™ gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando a seus amigos, um <b>desconto de 30% para os usu√°rios da Habr em um an√°logo exclusivo de servidores b√°sicos que inventamos para voc√™:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Toda a verdade sobre o VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD 1Gbps de US $ 20 ou como dividir o servidor?</a>  (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). <br><br>  <b>Dell R730xd 2 vezes mais barato?</b>  Somente n√≥s temos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2 TVs Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 a partir de US $ 249</a> na Holanda e nos EUA!</b>  Leia sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como criar um pr√©dio de infraestrutura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418197/">https://habr.com/ru/post/pt418197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418187/index.html">Na Am√©rica, eles sugeriram a substitui√ß√£o de todas as bibliotecas pelos hubs da Amazon. O p√∫blico est√° indignado</a></li>
<li><a href="../pt418189/index.html">Herdeiro de Zeus: por que o Trojan IcedID √© perigoso para clientes de bancos</a></li>
<li><a href="../pt418191/index.html">An√°logos em Python e JavaScript. Parte tr√™s</a></li>
<li><a href="../pt418193/index.html">Como √© criar um jogo para o Game Boy em 2017</a></li>
<li><a href="../pt418195/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 4: ‚ÄúCompartilhando Privil√©gios‚Äù, Parte 1</a></li>
<li><a href="../pt418199/index.html">Como fazer uma tarefa t√©cnica simples e n√£o perder dinheiro e nervos</a></li>
<li><a href="../pt418201/index.html">Podemos reviver Duck Hunt?</a></li>
<li><a href="../pt418203/index.html">API do GraphQL (CRUD) on Go</a></li>
<li><a href="../pt418205/index.html">Space Language Vol. 2: Bem-vindo, GJ273b</a></li>
<li><a href="../pt418207/index.html">An√°lise dos laptops para jogos ASUS ROG Strix GL504GS SCAR II e ASUS ROG Strix GL504GM HERO II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>