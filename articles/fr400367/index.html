<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§πüèª üí≤ üöº Que faire le week-end: interphone avec t√©l√©commande, remappage sans budget Nextion, confrontation avec Onlaym ‚ôæ üëáüèº üôçüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le vendredi, la fiction est parfois consid√©r√©e comme acceptable ici. Aujourd'hui, bien s√ªr, ce n'est pas vendredi, mais ce n'est pas tout √† fait de la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Que faire le week-end: interphone avec t√©l√©commande, remappage sans budget Nextion, confrontation avec Onlaym</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/400367/"><img src="https://habrastorage.org/files/044/f5f/30d/044f5f30df86463087940fff4fc4ba92.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le vendredi, la fiction est parfois consid√©r√©e comme acceptable ici. </font><font style="vertical-align: inherit;">Aujourd'hui, bien s√ªr, ce n'est pas vendredi, mais ce n'est pas tout √† fait de la fiction, mais plut√¥t trois mini-romans qui ont quelque chose √† voir avec ma vie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un lecteur h√¢tif peut √©galement se demander quelles relations peuvent r√©ellement connecter l'interphone et le fournisseur Internet. </font><font style="vertical-align: inherit;">Et ce sera exact, parce que moi non plus je n'y suis pas imm√©diatement arriv√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais √† propos de tout (Arduino, hacks de la vie banale, querelles t√©l√©phoniques) dans l'ordre.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-sim, ouvre-toi!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour √™tre honn√™te, la t√©l√©commande de l'interphone selon ma version est presque inutile, et je l'ai pleinement r√©alis√© avant m√™me de commencer. Par cons√©quent, pour justifier l'engagement, j'ai d√ª utiliser tout le pouvoir de l'imagination pour proposer quelques cas, comme on dit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, j'ai d√©cid√© que de cette fa√ßon je laisserais les invit√©s se r√©chauffer sous le porche, si je n'avais pas encore r√©ussi √† rentrer √† la maison. Ou je ne prendrai pas particuli√®rement la peine d‚Äôobtenir les cl√©s √† l‚Äôavance - apr√®s tout, vous pouvez simplement configurer le t√©l√©phone pour qu‚Äôil donne l‚Äôordre d‚Äôouvrir la porte lorsque j‚Äôapproche de la maison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les gens ordinaires, cela semble assez sauvage, mais comme on dit, per aspera ad astra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et je voulais vraiment utiliser en quelque sorte quelques relais dans le bo√Ætier, qui √©taient inactifs dans le contr√¥leur central depuis le tout d√©but de son fonctionnement. En fait, la situation est ridicule: √† l'√©poque, il n'y avait qu'un bloc pour 4 relais √† port√©e de main, dont seulement deux √©taient n√©cessaires. Et je ne voulais pas attendre encore un mois pour le bloc √† deux relais, alors je me suis √©loign√© de ce qui √©tait √† port√©e de main et j'ai imm√©diatement commenc√© √† me soucier de la redondance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, aux interphones. En g√©n√©ral, l'ouverture automatique d'un syst√®me d'interphone n'est pas une chose exclusive. Par exemple, ici √† Geektimes, camarade </font><font style="vertical-align: inherit;">En 2013 (lorsque le dollar valait 30), </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fabriquait non seulement une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©l√©commande, mais aussi un r√©pondeur pour les invit√©s</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est de loin la chose la plus cool que j'ai vue dans cette classe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais beaucoup plus t√¥t, les visiteurs de RadioKota et de nombreux autres forums th√©matiques</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'est amus√© avec des appareils tels que "ouvreur"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - d√©verrouiller l'interphone imm√©diatement lors d'un appel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'allais pas r√©p√©ter ni l'un ni l'autre. </font><font style="vertical-align: inherit;">Le premier - parce que c'est difficile, et parce que j'avais d√©j√† un contr√¥leur qui fonctionnait, que j'avais pr√©vu de donner de nouveaux pouvoirs. </font><font style="vertical-align: inherit;">Le second pour des raisons plus √©videntes: trop de d√©tails et trop peu de sens, je m'excuse si j'ai offens√© les auteurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sens, bien s√ªr, pour moi, et pas du tout. </font><font style="vertical-align: inherit;">Autrement dit, je n'aime pas cat√©goriquement le r√©gime, qui ouvre avec hospitalit√© la porte √† quiconque compose un num√©ro d'appartement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'o√π les exigences de base pour mon ouvre-porte: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Utiliser un contr√¥leur central pour contr√¥ler via Internet et la radio </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Protection minimale contre les acc√®s non autoris√©s</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Interf√©rence minimale √† l'int√©rieur</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commencer</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai commenc√© par me familiariser avec le principe de fonctionnement de l'interphone, que j'ai emprunt√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le tube fonctionne tr√®s simplement: lorsque le tube est pos√©, il a une r√©sistance de 50 Ohms, lorsque le tube est retir√©, la r√©sistance est d'env. </font><font style="vertical-align: inherit;">400 Ohm, lorsque le bouton de d√©verrouillage est enfonc√©, la r√©sistance est mesur√©e en kilo-ohms ... Lorsqu'il n'y a pas d'appel, il n'y a pas de tension dans la ligne. </font><font style="vertical-align: inherit;">Lorsqu'un appel arrive et que le combin√© d√©pose un courant important et que la tension se r√©v√®le petite 5-7 V, lorsque le combin√© est absent et que la r√©sistance est appel√©e √† l'infini et que la tension est au maximum env. </font><font style="vertical-align: inherit;">15V lorsque le combin√© est √©teint, tension d'environ 10V. </font><font style="vertical-align: inherit;">Lorsque le bouton de tension est enfonc√©, le maximum est d'env. </font><font style="vertical-align: inherit;">15V - appuyer sur le bouton √©quivaut √† un saut de ligne.</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cas de Digital, cela est l√©g√®rement diff√©rent, car la documentation du combin√©, mais j'avais KM-2NO (au fait, j'exprime ma gratitude √† Digital pour avoir publi√© le sch√©ma) indique:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Consommation de courant en mode "Talk" 18-22 mA </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Tension de ligne avec un tube install√© sur le bo√Ætier 1,5‚Äì2,5 V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Tension de ligne avec un tube jusqu'√† 5,8-6,5 V</font></font><br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, je me suis familiaris√© plus en d√©tail avec le sch√©ma de circuit de ma pipe: </font></font><br>
<br>
<img src="https://habrastorage.org/files/b76/591/c8f/b76591c8f87c4eaca7a8bfec1f652f39.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et j'ai trouv√© que tout est exactement le m√™me en termes de r√©sistance, et tr√®s probablement, le reste de la logique du Digital n'est gu√®re diff√©rent de la Visit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'attire l'attention sur le fait que ma modification est sans LED. Mais cela s'est av√©r√© juste, car ce fait facilite la transmission des informations d'appel au contr√¥leur central. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A savoir: l'appel sonne, la LED ¬´s'allume¬ª, l'optocoupleur s'allume, sur la broche du contr√¥leur nous avons un changement de niveau de haut en bas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors au lieu de la LED, j'ai install√© mon optocoupleur 4N35, dont j'ai envoy√© la sortie directement √† l'Arduino. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selon le sch√©ma standard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du m√™me Internet:</font></font><br>
<br>
<img src="https://habrastorage.org/files/a7f/c39/9f8/a7fc399f840e4931b225370b2f21c3cd.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et comme je voulais me d√©brouiller avec un minimum de d√©tails et de ressources de contr√¥leur disponibles, dont les broches num√©riques se sont av√©r√©es √™tre les plus pr√©cieuses (Uno n'en avait pas assez), au lieu d'une r√©sistance de rappel 10K, j'ai utilis√© la r√©sistance de rappel int√©gr√©e Arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'il est connect√© √† une broche num√©rique, il ressemble √† ceci:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT_PULLUP);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsqu'il est connect√© √† une broche analogique:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT);<font></font>
digitalWrite(ringPin, HIGH);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai d√©cid√© de placer l'optron du microcontr√¥leur. </font><font style="vertical-align: inherit;">Je ne peux pas le justifier, mais je pensais qu'il y avait moins de risque de faux positifs de possibles micros. </font><font style="vertical-align: inherit;">Il est possible qu'il se trompe, mais jusqu'√† pr√©sent, tout est normal avec des conseils </font><font style="vertical-align: inherit;">ils ne le sont pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant √† la terre dans l'exemple ci-dessus, vous devez comprendre: bien que la terre semble √™tre commune dans le diagramme, ce n'est pas le cas - en fait, il y a en fait un isolement opto√©lectronique. </font><font style="vertical-align: inherit;">Eh bien, pour cela, il est un exemple.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©barrasse-toi de moi!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La d√©cision de se d√©barrasser compl√®tement des circuits d'interphone n'est pas venue imm√©diatement, mais in√©vitablement. Soit dit en passant, je me souviens tr√®s bien du cas d'il y a six ans, lorsque j'ai vu comment un moment g√™nant avec un verrou √©lectromagn√©tique s'est form√© lors de l'installation d'un ACS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne sais pas comment c'est arriv√©, mais il s'est av√©r√© que le ch√¢teau fonctionnait d'une mani√®re ou d'une autre. Ce "ramper", puis rien du tout, et les installateurs eux-m√™mes se sont d√©j√† cass√© la t√™te. Mais √† la fin, il a √©t√© sugg√©r√© qu'ils avaient un court-circuit inattendu quelque part (ou quelque chose comme √ßa) dans les circuits de contr√¥le. Bien s√ªr, nous avons tout v√©rifi√©, bien s√ªr, sans grand succ√®s, car ils ont √©t√© d√©finis clairement selon les instructions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De l'huile a √©t√© ajout√©e au feu par le fait que la m√™me serrure √©tait exactement dans la m√™me configuration, mais cela fonctionnait tr√®s bien √† l'autre √©tage.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendant combien de temps, bri√®vement, ils ont d√©cid√© que l'affaire √©tait dans la porte elle-m√™me, sur laquelle la serrure est attach√©e. √Ä mon avis, il a √©t√© sugg√©r√© que lors de son installation, ils se soient coinc√©s dans l'armature, qui, √† son tour, √©tait mise √† la terre, ce qui a entra√Æn√© des effets inattendus sur la serrure (qui, √©ventuellement, avait un verrou de commande sur le bo√Ætier). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, ils ont r√©gl√© assez longtemps et fastidieusement. Et je ne voulais pas r√©p√©ter la m√™me chose √† la maison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, je n'ai pas enregistr√© les fils et connect√© les contacts de relais de la mani√®re la plus simple: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Normalement ferm√© un relais - en s√©rie avec le bouton haut SW1 (car ce bouton est ferm√© √† l'√©tat normal) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Normalement ouvert un autre relais - en parall√®le avec le bouton d'ouverture de porte SB1 ( car ce bouton est normalement ouvert)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des contacts de commande de relais, bien s√ªr, connect√©s aux broches num√©riques libres (hourra, elles l'√©taient toujours) du microcontr√¥leur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au total, il est facile d'imaginer qu'il a fallu six fils: deux pour l'optocoupleur et quatre de plus pour le relais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'excuse pour le primitivisme de l'illustration:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De l'interphone</font></font></h4><br>
<img src="https://habrastorage.org/files/cfe/2f2/23c/cfe2f223cb2b4d49ad1b853482b3895a.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par Arduino</font></font></h4><br>
<img src="https://habrastorage.org/files/c99/84f/e4b/c9984fe4be554b13b2ec17915ca86474.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les relais ici sont repr√©sent√©s exclusivement de mani√®re sch√©matique. </font><font style="vertical-align: inherit;">Depuis, je le r√©p√®te, j'ai utilis√© des modules relais pr√™ts √† l'emploi avec bourrage complet - optocoupleurs, transistors, diodes, etc. </font><font style="vertical-align: inherit;">Je recommande fortement de ne pas connecter de relais nus √† Arduino.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et ne m'appelle plus!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©j√† √† ce stade, j'ai pu ouvrir tr√®s facilement l'interphone via Internet ou le r√©seau local √† partir d'un ordinateur ou d'un smartphone selon le principe suivant: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Au moment o√π l'interphone sonne, le contr√¥leur passe en mode autorisation pour ouvrir la porte pendant 40 secondes. L'heure est s√©lectionn√©e sur la base de la documentation de l'interphone num√©rique, o√π il est indiqu√© que la dur√©e du signal d'appel est exactement de 40 secondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est-√†-dire plus longtemps, il est inutile de rester conditionnellement ouvert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) D√®s r√©ception d'une commande d'ouverture via Internet (HTTP POST), le contr√¥leur commute s√©quentiellement le relais. Tout d'abord, il ouvre le relais du tube, qui simule sa mont√©e. Puis, apr√®s une courte pause, le relais du bouton d'ouverture se ferme, simulant ainsi son appui. Apr√®s - "rel√¢che" le bouton et "raccroche" le t√©l√©phone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le banc d'essai √©tait tr√®s primitif:</font></font><br>
<br>
<img src="https://habrastorage.org/files/3b5/44c/db1/3b544cdb17ab4f67953d7643d98e0156.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il serait possible de s'arr√™ter l√†-dessus si, en tant que fier propri√©taire du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTsDV-12-2, je ne savais</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas √† quel point cela est g√™nant - de contourner la t√©l√©commande ou le t√©l√©phone √† chaque fois que vous devez allumer / √©teindre quelque chose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, en particulier, si je n'avais pas r√©cemment termin√© une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">station m√©t√©o de bureau avec un √©cran tactile</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et, semble-t-il, un potentiel pas compl√®tement d√©velopp√©. </font></font><br>
<br>
<img src="https://habrastorage.org/files/90a/d36/f45/90ad36f45757421295f332c7425578fa.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En bref, j'ai rapidement (en fait pas) ajout√© √† la station m√©t√©o l'√©metteur 433 MHz le plus courant et le plus vulgaire avec modulation d'amplitude, dont les tonnes sont vendues sur Aliexpress pour de l'argent ridicule. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, la station m√©t√©o est devenue un autre point de contr√¥le pour l'interphone, et donc, si une cloche sonne et que vous vous asseyez √† c√¥t√©, il n'y a aucun sens √† casser le t√©l√©phone, car directement depuis l'√©cran, vous pouvez:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Ouvrez le verrou </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) D√©crochez le combin√© lentement (selon la documentation, la conversation dure 1,5 minute contre 40 secondes de l'appel), allez √† l'interphone, r√©pondez et d√©cidez d'ouvrir ou non </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) R√©pondez √† l'appel (le contr√¥leur d√©croche et imm√©diatement "Raccroche") </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour cela, bien s√ªr, j'ai d√ª l√©g√®rement modifier le code et l'interface de la station m√©t√©o, mais en cours de route, j'ai trouv√© des erreurs g√™nantes dans l'affichage des graphiques (comme il s'est av√©r√© - je l'ai dans mon ADN, mais c'est une autre histoire). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, la nouvelle interface ne ressemble plus du tout √† HAL. Maintenant, tout est tellement color√© et dr√¥le que vous n'avez qu'√† rire. Et vous voyez, comprenez: je n'ai pas bu de smoothies, les hipsters ne m'ont pas mordu, il n'y avait pas de lamberseks dans la famille, et le mat√©riel me tire comme jamais auparavant dans ma vie:</font></font><br>
<br>
<img src="https://habrastorage.org/files/71a/154/0d4/71a1540d420441d3aa62d3ca673f3a43.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cet √©cran remplace les donn√©es climatiques lorsque l'interphone sonne: √† ce moment, le contr√¥leur central √©met une commande radio, √† laquelle l'affichage m√©t√©o r√©pond. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela peut √™tre un peu illogique ici, mais la cloche au centre vous informe principalement de l'appel interphone. </font><font style="vertical-align: inherit;">Une pression (illogique ici) coupe le son de l'interphone de la mani√®re la plus barbare - en imitant le processus de mont√©e et de descente du combin√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le ch√¢teau √† gauche est l'ouverture du ch√¢teau. </font><font style="vertical-align: inherit;">Combin√© √† droite - d√©crocher le combin√© pour simuler le d√©but d'une conversation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©cran passe √† l'√©cran principal apr√®s 40 secondes √† partir du d√©but de l'appel, et pas imm√©diatement en appuyant sur le bouton ic√¥ne. </font><font style="vertical-align: inherit;">Cela vous permet d'appuyer plusieurs fois si le contr√¥leur n'a soudainement pas ¬´entendu¬ª une commande, ce qui n'est pas rare compte tenu du type de canal radio utilis√©.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des algorithmes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai mentionn√©, au d√©but, j'√©tais modeste et je ne voulais qu'une chose: ouvrir l'interphone sur commande du t√©l√©phone, et au moment de l'appel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais apr√®s avoir jou√© quelques jours, j'ai r√©alis√© que se tenir devant l'interphone et piquer sur l'√©cran est une t√¢che plut√¥t ennuyeuse, et il est beaucoup plus int√©ressant de permettre une ouverture "retard√©e" lorsque vous approchez de l'entr√©e. Ensuite, il ne reste plus qu'√† composer le num√©ro d'appartement sur le panneau de l'interphone et le tour est jou√©, la porte est ouverte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, j'ai pens√© que dans cette situation, il est probablement logique d'interdire l'ouverture - en g√©n√©ral. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ensuite il s'est ressaisi, puis s'est l√¢ch√©, a pris un outil plus utile, commun√©ment appel√© le rasoir d'Occam, et s'est rapidement d√©barrass√© des entit√©s suppl√©mentaires. A savoir: puisque je faisais la t√©l√©commande, ce n'√©tait pas pour l'√©teindre. Par cons√©quent, l'arr√™t n'est pas n√©cessaire du tout.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deuxi√®mement, selon une pens√©e sobre (et pas comme d'habitude), il s'est av√©r√© qu'il n'y avait pas de diff√©rence particuli√®re entre l'ouverture par une commande imm√©diatement au moment de l'appel ou par une commande donn√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, pour revenir √† l'ergonomie du contr√¥le, je veux dire que plus il y a de modes - moins les gens ordinaires les utiliseront. Oui, je suis ennuyeux, mais comme j'imaginais que j'avais trois modes pour diff√©rentes occasions, j'ai r√©alis√© que j'en utiliserais toujours un. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, le mode est un et la commande est un, et il y a deux processeurs: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Si l'interphone sonne, le contr√¥leur permet l'ouverture dans les 40 secondes suivant le d√©but de l'appel</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Si la commande d'ouverture est re√ßue en premier, le contr√¥leur autorise l'ouverture et attend un appel dans les N minutes √† partir du moment o√π la commande a √©t√© re√ßue (c'est pour pr√©parer l'interphone √† l'ouverture sur le chemin de la maison) Il </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
peut </font><font style="vertical-align: inherit;">y </font><font style="vertical-align: inherit;">avoir deux sources de la commande d'ouverture: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) HTTP POST- une demande via un r√©seau local ou Internet (par exemple: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myserver.com/?sim-sim-openup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), c'est-√†-dire vous pouvez ouvrir au moins depuis Kuala Lumpur </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) La commande radio depuis les panneaux ou boutons de la maison (dans mon impl√©mentation, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via la biblioth√®que RC-Switch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puisque toute la structure est connect√©e au combin√© sans affecter son fonctionnement, l'interphone peut continuer √† √™tre utilis√© de la mani√®re habituelle (bell-handset-hi-hi-button), c'est-√†-dire </font><font style="vertical-align: inherit;">domestique, pas en mesure d'appr√©cier les m√©rites du progr√®s technologique, et ne sont pas tenus de se plonger dans les d√©tails.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus soudains</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me si vous n'utilisez pas la fonction d'ouverture de porte, il s'av√®re maintenant que le contr√¥leur notifie r√©guli√®rement que quelqu'un se gratte √† la porte de l'entr√©e via l'interphone. </font><font style="vertical-align: inherit;">Pour moi, en tant que curieux, cette information n'est pas sans int√©r√™t - et maintenant je la re√ßois r√©guli√®rement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus important encore, cette fonction continue de fonctionner m√™me si vous √©teignez le combin√© de l'interphone avec son interrupteur. </font><font style="vertical-align: inherit;">Potentiellement, cela signifie que maintenant il y a moins de chances de laisser l'interphone d√©sactiv√©, si vous devez soudainement exclure temporairement la possibilit√© de ses appels. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, le circuit d'interphone est tel que lorsqu'il est √©teint, il devient impossible de contr√¥ler √† distance la serrure (il semble que la centrale consid√®re que dans ce cas le combin√© est ¬´raccroch√©¬ª, quelle que soit sa position r√©elle).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et am√©nagement paysager</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je m'effor√ßais de minimiser les interf√©rences √† l'int√©rieur, j'ai d√ª d√©cider comment me connecter au contr√¥leur central, sur la base du fait que le contr√¥leur et l'interphone se trouvaient sur des c√¥t√©s diff√©rents de la porte et que le contr√¥leur avait de l'√©lectricit√©, mais pas l'interphone. </font></font><br>
<br>
<img src="https://habrastorage.org/files/7b6/8e8/6c3/7b68e86c3aab453e8fcbc579149f4e2a.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au final, j'ai d√©cid√© qu'il valait mieux √©tirer le c√¢ble derri√®re le cadre de la porte et fermer ses fragments avec des panneaux d√©coratifs imprim√©s sur une imprimante 3D que d'occuper une autre prise avec une alimentation, on ne sait pas comment tirer son fil vers le combin√© de l'interphone et bloquer le canal radio entre le combin√© et le contr√¥leur. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e65/a91/84a/e65a9184ab9d4cb29e84e515689e607e.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et je pense que dans mes conditions, c'est la meilleure option. </font><font style="vertical-align: inherit;">Oui, et le relais est entr√© en activit√©, mais avec une cha√Æne radio - serait encore rest√© en r√©serve.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remappage de Nextion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En parlant de l'affichage m√©t√©o du bureau (station m√©t√©o, si vous voulez), j'ai mentionn√© que pendant le processus de finition, j'ai r√©ussi √† endommager le composant principal - l'√©cran tactile Nextion lui-m√™me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La panne n'a pas affect√© le fonctionnement de son microcontr√¥leur embarqu√© et de l'affichage des donn√©es, mais l'√©cran tactile a presque √©chou√©. Cependant, exp√©rimentalement, j'ai d√©couvert que m√™me si vous n'exercez pas trop de pression sur la carte Nextion √† un certain endroit, vous pouvez ainsi restaurer la sensibilit√© de la moiti√© gauche (environ) de l'√©cran. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette astuce fonctionne instable et pas toujours, mais assez souvent pour que je puisse le supporter, en pensant √† commander un nouvel √©cran.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, cela m'a rendu heureux et triste. D'une part, il √©tait possible d'obtenir une op√©rabilit√© partielle. Par contre, j'aimerais jouer un peu plus avec les charts. Et puis j'ai soudainement r√©alis√© dans quel pi√®ge stupide je suis tomb√©: pour une raison quelconque, j'√©tais obs√©d√© par l'utilisation de toute la zone de l'√©cran, quand je pouvais transf√©rer librement les boutons ¬´non fonctionnels¬ª dans la zone de travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je comprends que pour beaucoup, c'est vraiment une d√©cision banale. Mais je voudrais partager une joie innocente avec ceux qui, comme moi, aiment aller √† l'extr√™me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, je l'ai compris, j'ai l√©g√®rement chang√© la taille des boutons, dessin√© un nouveau circuit de contr√¥le virtuel dans ma t√™te et le tour est jou√©! Nous avons presque enti√®rement restaur√© la fonctionnalit√© d'un √©cran partiellement tu√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'√©tait: </font></font><br>
<br>
<img src="https://habrastorage.org/files/8cb/774/fc0/8cb774fc06b444ce994ad1470e7319d8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est devenu:</font></font><br>
<br>
<img src="https://habrastorage.org/files/202/2b8/82f/2022b882fd2245a79cc4fae8514ddde5.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cours de route, cependant, j'ai d√ª tuer un perfectionniste en moi et refaire l'√©cran de contr√¥le de l'interphone d'origine √† un √©cran fonctionnant de mani√®re minimale:</font></font><br>
<br>
<img src="https://habrastorage.org/files/bd2/bec/a58/bd2beca5810346c5a99099e1ac046288.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En direct</font></font></h4><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/P6Iqh6SYVRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque l'assistance technique n'est pas disponible</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semblerait que sur tous ces hauts et bas, il serait possible de terminer, sinon pour un d√©tail: j'ai soudainement d√©couvert que l'interphone (et derri√®re lui le reste de l'automatisation) cessait d'√™tre contr√¥l√© lors de l'acc√®s √† partir de r√©seaux externes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, toutes les commandes fonctionnaient parfaitement lorsqu'elles √©taient connect√©es √† Internet via le r√©seau domestique et √† des adresses externes (et non selon le type interne 192.xxx.xxx.xxx), mais refusaient √©galement parfaitement d'√™tre ex√©cut√©es √† partir des r√©seaux d'autres op√©rateurs (j'en ai essay√© deux). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez imm√©diatement comprendre que les commandes sont transmises via une requ√™te HTTP √† un port externe sp√©cifique du routeur, et √† partir de l√†, elles sont d√©j√† redirig√©es vers l'IP et le port internes n√©cessaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ce sch√©ma a fonctionn√© sans le moindre probl√®me depuis son lancement en 2013 jusqu'√† ce que quelque chose se brise dans l'actuel. Et je suis toujours s√ªr que ce n'est pas de ma faute. Mais je ne sais pas comment v√©rifier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, au d√©but, je voulais jurer avec Beeline, car au d√©but, je pensais que le probl√®me √©tait dans l'Internet mobile. Mais ensuite, je me suis ressaisi, j'ai trouv√© un autre fournisseur, je l'ai essay√© et j'ai d√©couvert qu'√† travers lui le m√™me probl√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, j'ai appel√© Onlaym et, comme j'ai pu, expliqu√© l'essentiel des revendications. Et en r√©ponse, ils m'ont expliqu√© populairement que:</font></font><br>
<br>
<blockquote>               :<br>
TCP/25 ‚Äì  -;<br>
TCP/135-139, TCP/445  UDP/135-139 ‚Äì   ,    MS Windows;<br>
TCP/23, TCP/161, UDP/69  UDP/161‚Äì   .<br>
 <br>
  ,  ,  .</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä mon tour, j'ai insist√© pour que mon port a) ne tombe pas dans cette plage, b) ne fonctionne pas comme pr√©vu et c) je n'ai rien chang√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que diriez-vous d'un mur de pois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, que dois-je faire, alors j'ai poliment expliqu√© que bien que je comprenne que mes malheureux 450 roubles par mois ne feront pas le temps pour eux, je passerai d'un tel non-sens pour chercher le m√™me non-sens, mais au moins √ßa marche. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En r√©ponse, ils ont de nouveau murmur√© qu'ils me fournissaient la propri√©t√© intellectuelle, puis tous mes probl√®mes. Eh bien le mien, j'ai d√©cid√©, puis le mien. Et par une d√©cision volontaire, j'ai d'abord v√©rifi√© l'op√©rabilit√© du syst√®me sur un autre port (d√©plac√© vers une unit√©) - cela fonctionne. Et puis il a fait une configuration flexible du num√©ro de port dans Tasker, √† travers lequel, en fait, le volant est automatique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, √† ce que je d√©cris mes souffrances: je voulais vraiment objectivement comprendre qui avait tort dans une telle situation. </font><font style="vertical-align: inherit;">Parce que je me sens comme un idiot complet - j'ai red√©marr√© le routeur et v√©rifi√© les param√®tres (de plus, de ma propre initiative, et non √† l'invite de ¬´sp√©cialistes¬ª), et ils m'ont quand m√™me envoy√© en enfer, faisant allusion √† mes mains tordues.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hors √©cran</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusion, que j'ai utilis√© pour la construction du si√®cle: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTSDV-12-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Combin√© interphone num√©rique KM-2NO - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Optocoupleur 4N35 - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) C√¢ble plat 10 conducteurs (utilis√© six, mais mettez tout - juste au cas o√π) - 3 m. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Connecteurs au c√¢ble - 2 pcs. </font><font style="vertical-align: inherit;">papas et mamans </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affichage m√©t√©o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maison </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">avec √©cran tactile Nextion</font></a><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) √âmetteur 433 MHz (√† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partir d'un kit comme celui-ci</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) pour modifier l'affichage m√©t√©o - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8) R√©sistance 1 kŒ© pour optocoupleur - 1 pc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Options: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface mise √† jour pour Nextion</font></font></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code de test (avant l'int√©gration avec KTSDV-12-2 et un bouquet complet de fonctions de service, uniquement pour comprendre le cours de la pens√©e)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RCSwitch.h&gt; //   http://code.google.com/p/rc-switch/</span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringTimeOut 40000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       2094</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openTimeOut 300000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    allowOpen        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetPin A3 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    0</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openPin A4 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    (1)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin 7 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   (3)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringCode 360500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> doorBell 3395840 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openCode 255899 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openDelay 1500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetDelay 2500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> txPin 8</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ringTime, openTime; <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
boolean ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
boolean ringRepeat = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
boolean allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     </span></span><font></font>
<font></font>
RCSwitch mySwitch = RCSwitch();<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDoor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    <font></font>
    digitalWrite(handsetPin, LOW);<font></font>
    delay(handsetDelay);<font></font>
    digitalWrite(openPin, LOW);<font></font>
    delay(openDelay);<font></font>
    digitalWrite(openPin, HIGH);<font></font>
    digitalWrite(handsetPin, HIGH);<font></font>
    ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
    allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(37); //           </span></span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  mySwitch.enableTransmit(txPin); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  pinMode(handsetPin, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
  pinMode(openPin, OUTPUT);<font></font>
  pinMode(ringPin, INPUT_PULLUP  );<font></font>
  digitalWrite(handsetPin, HIGH); <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
  digitalWrite(openPin, HIGH);<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ready"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(ringPin) == LOW &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//            </span></span>
    ring = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
    ringTime = millis();<font></font>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(36); //     </span></span>
    mySwitch.send(ringCode, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Sent ringCode"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ringRepeat == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
      mySwitch.send(doorBell, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
      Serial.println(<span class="hljs-string"><span class="hljs-string">"DoorBell repeat"</span></span>);<font></font>
    }<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring-ring!"</span></span>);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - ringTime) &gt; ringTimeOut &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   40  (   )    </span></span>
  ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring reset"</span></span>);
  <span class="hljs-comment"><span class="hljs-comment">// sendMail(38); //      </span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
  openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via net"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  ""   </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - openTime) &gt; openTimeOut) { <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
   allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; 
   <span class="hljs-comment"><span class="hljs-comment">// sendMail(39); //     </span></span><font></font>
  }<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mySwitch.available()) { <span class="hljs-comment"><span class="hljs-comment">//</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = mySwitch.getReceivedValue();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-number"><span class="hljs-number">0</span></span>) {<font></font>
      Serial.println(mySwitch.getReceivedValue());<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mySwitch.getReceivedValue()) {<font></font>
        <font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> openCode: <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
            mySwitch.disableReceive();<font></font>
            openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
            Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via radio"</span></span>);<font></font>
            mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
          }<font></font>
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
    }<font></font>
    mySwitch.resetAvailable();<font></font>
  }<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
}<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai pris les photos de l'interface sur le merveilleux site Web de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pixabay</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr400367/">https://habr.com/ru/post/fr400367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr400357/index.html">Google montre un mod√®le de charit√© √† triple avantage</a></li>
<li><a href="../fr400359/index.html">Proprioception pour les non-sp√©cialistes. Partie 3. Assis dynamique sur une chaise</a></li>
<li><a href="../fr400361/index.html">Foreve Elon 2016/2017 (r√©veillon du Nouvel An en ligne)</a></li>
<li><a href="../fr400363/index.html">Plonger profond√©ment: du CSS au transistor</a></li>
<li><a href="../fr400365/index.html">Que promettent les utilisateurs de VKontakte en 2017</a></li>
<li><a href="../fr400371/index.html">2017 n'est pas seulement une prime ...</a></li>
<li><a href="../fr400377/index.html">Aper√ßu des mat√©riaux 3D actuels</a></li>
<li><a href="../fr400379/index.html">Comment nous avons organis√© la qu√™te dans Telegram, et ce qui en est ressorti. UPD: nous avons r√©sum√© les r√©sultats du concours</a></li>
<li><a href="../fr400381/index.html">Conception d'une alimentation √† d√©coupage avec KKM actif. √âpisode I</a></li>
<li><a href="../fr400383/index.html">R√©√©chantillonnage. Mur de briques num√©rique contre la th√©orie du complot. Conte de No√´l pour les amateurs de son clair</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>