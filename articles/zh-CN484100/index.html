<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ ğŸ… â˜¸ï¸ ä½¿ç”¨Androidç‰ˆGoogle Maps SDKä¸­çš„ç•Œé¢ ğŸ™‹ğŸ¾ ğŸƒ ğŸ–</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡å¯¹ä»¥å‰æœªä½¿ç”¨è¿‡Google Maps SDKçš„ç”¨æˆ·å¾ˆæœ‰ç”¨ã€‚ 

 åœ¨è£åˆ‡å™¨ä¸‹ï¼Œæè¿°äº†å¤„ç†åœ°å›¾çš„åŸºæœ¬æ–¹æ³•ï¼Œä¾‹å¦‚æ·»åŠ å’Œç®¡ç†æ ‡è®°ï¼Œå°†ç›¸æœºç§»åŠ¨åˆ°åœ°å›¾ä¸Šï¼Œæ§åˆ¶ç¼©æ”¾ï¼Œæ„å»ºè·¯çº¿å’Œè¿›è¡Œåœ°ç†ç¼–ç çš„æ–¹æ³•ã€‚ ä»¥åŠé™åˆ¶å’Œè§„é¿å®ƒä»¬çš„æ–¹æ³•ã€‚ 

 æ¥æº 

 å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œæˆ‘å—åˆ°äº†è‡ªå·±çš„ç»éªŒçš„å¯å‘ï¼Œè¿™æ˜¯æˆ‘åœ¨ä¸ºä½¿ç”¨å¿«é€’å…¬å¸çš„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Androidç‰ˆGoogle Maps SDKä¸­çš„ç•Œé¢</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484100/"> æœ¬æ–‡å¯¹ä»¥å‰æœªä½¿ç”¨è¿‡Google Maps SDKçš„ç”¨æˆ·å¾ˆæœ‰ç”¨ã€‚ <br><br> åœ¨è£åˆ‡å™¨ä¸‹ï¼Œæè¿°äº†å¤„ç†åœ°å›¾çš„åŸºæœ¬æ–¹æ³•ï¼Œä¾‹å¦‚æ·»åŠ å’Œç®¡ç†æ ‡è®°ï¼Œå°†ç›¸æœºç§»åŠ¨åˆ°åœ°å›¾ä¸Šï¼Œæ§åˆ¶ç¼©æ”¾ï¼Œæ„å»ºè·¯çº¿å’Œè¿›è¡Œåœ°ç†ç¼–ç çš„æ–¹æ³•ã€‚ ä»¥åŠé™åˆ¶å’Œè§„é¿å®ƒä»¬çš„æ–¹æ³•ã€‚ <br><br><div style="text-align:center;"><img width="70%" src="https://habrastorage.org/webt/z7/k_/wx/z7k_wx4u1gl4-usgjpfpbussyew.jpeg" alt="å›¾ç‰‡"></div>  <a href="https://www.nationalgeographic.com/" rel="nofollow"><i>æ¥æº</i></a> <br><a name="habracut"></a><br> å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œæˆ‘å—åˆ°äº†è‡ªå·±çš„ç»éªŒçš„å¯å‘ï¼Œè¿™æ˜¯æˆ‘åœ¨<a href="https://play.google.com/store/apps/details%3Fid%3Dcom.e.courierassistant" rel="nofollow">ä¸º</a>ä½¿ç”¨<a href="https://play.google.com/store/apps/details%3Fid%3Dcom.e.courierassistant" rel="nofollow">å¿«é€’å…¬å¸</a>çš„å·¥ä½œäººå‘˜ä½¿ç”¨Googleåœ°å›¾ç¼–å†™<a href="https://play.google.com/store/apps/details%3Fid%3Dcom.e.courierassistant" rel="nofollow">åº”ç”¨ç¨‹åº</a>æ—¶è·å¾—çš„ã€‚ å› æ­¤ï¼Œæ‰€æœ‰å±å¹•æˆªå›¾å’Œå¯èƒ½æåŠçš„ä¸šåŠ¡é€»è¾‘éƒ½å°†åœ¨æ„å»ºå¿«é€’å‘˜ç•Œé¢çš„æƒ…å†µä¸‹å‘ç”Ÿã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼ŒAndroidç‰ˆGoogle Maps SDKä¸å…è®¸æ‚¨æ›´æ”¹æ§åˆ¶æŒ‰é’®çš„ä½ç½®ï¼Œå³æ‰€è°“çš„  UIæ§ä»¶åŒ…æ‹¬ï¼šIndoorLevelPicker-æ˜¾ç¤ºå»ºç­‘ç‰©çš„å¹³é¢å›¾ï¼ŒCompass-æŒ‡å—é’ˆï¼Œæˆ‘çš„ä½ç½®æŒ‰é’®-è½¬åˆ°å½“å‰ä½ç½®çš„åœ°å›¾ï¼ŒMapå·¥å…·æ -ç”¨äºæ„å»ºè·¯çº¿å’Œæ‰“å¼€åœ°å›¾çš„æŒ‰é’®ï¼Œä»¥åŠZoomControls-å¢å¤§æˆ–å‡å°åœ°å›¾æ¯”ä¾‹ã€‚ <br><br> ä»¥â€œåœ°å›¾â€å·¥å…·æ å’Œâ€œç¼©æ”¾æ§ä»¶â€ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç”±äºæ— æ³•æ›´æ”¹æ§ä»¶çš„ä½ç½®ä»¥åŠå¦‚ä½•è§£å†³æ­¤é—®é¢˜è€Œå¯èƒ½ä¼šé‡åˆ°å“ªäº›å›°éš¾ã€‚ <br><br><img width="70%" src="https://habrastorage.org/webt/ep/7v/e-/ep7ve-bkgkw8lfu0dqhu62rd8li.png" alt="å›¾ç‰‡"><br>  <i>ä»SDKï¼ˆä»¥æ©™è‰²çªå‡ºæ˜¾ç¤ºï¼‰å’Œè‡ªå®šä¹‰å¯¹åº”é¡¹ï¼ˆä»¥ç»¿è‰²çªå‡ºæ˜¾ç¤ºï¼‰æ˜¾ç¤ºUIæ§ä»¶æ—¶å‡ºç°é—®é¢˜</i> <br><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨å³ä¸‹è§’æœ‰ä¸€ä¸ªæŒ‰é’®ï¼ˆæµ®åŠ¨æ“ä½œæŒ‰é’®ï¼‰ï¼Œç”¨äºè½¬åˆ°äº¤è´§å•çš„åœ°å€åˆ—è¡¨ï¼Œåœ¨å·¦å›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ZoomControlsåœ¨å…¶ä¸‹æ–¹ï¼Œå‡ ä¹æ— æ³•å•å‡»ã€‚ åœ¨å³ä¾§çš„å›¾ç‰‡ä¸­ï¼Œå½“æ‚¨å•å‡»æ ‡è®°æ—¶ï¼Œå°†æ˜¾ç¤ºâ€œåœ°å›¾â€å·¥å…·æ ä¸­çš„æŒ‰é’®ï¼Œè¿™äº›æŒ‰é’®ä¹Ÿå‡ºç°åœ¨æŒ‰é’®ä¸‹æ–¹ï¼Œä»¥è½¬åˆ°è®¢å•åˆ—è¡¨ã€‚ <br><br>  <b>è§£å†³æ–¹æ¡ˆ</b> <br><br> æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯éšè—åŸå§‹æŒ‰é’®çš„æ˜¾ç¤ºã€‚ æ‚¨å¯ä»¥é€šè¿‡é‡å†™onMapReadyæ–¹æ³•æ¥å®ç°æ­¤ç›®çš„ï¼Œè¯¥æ–¹æ³•åœ¨å¡ç‰‡å‡†å¤‡å°±ç»ªæ—¶å¯ä»¥è°ƒç”¨ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä¸æ˜¾ç¤ºæŒ‰é’®ç¼©æ”¾æ§ä»¶ï¼Œä¹Ÿä¸æ˜¾ç¤ºæŒ‰é’®ä»SDKæ„å»ºè·¯çº¿</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleMap mMap; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UiSettings uiSettings; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMapReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GoogleMap googleMap)</span></span></span><span class="hljs-function"> </span></span>{ mMap = googleMap; uiSettings = mMap.getUiSettings(); <span class="hljs-comment"><span class="hljs-comment">//   Zoom uiSettings.setZoomControlsEnabled(false); //         SDK uiSettings.setMapToolbarEnabled(false); }</span></span></code> </pre> <br></div></div><br> æˆ‘ä»¬åœ¨å¸ƒå±€ä¸­æ·»åŠ äº†å¿…è¦çš„æŒ‰é’®ï¼Œè¿™äº›æŒ‰é’®åº”ä¸æˆ‘ä»¬çš„è®¾è®¡ä¿æŒä¸€è‡´ï¼š <br><br><img width="80%" src="https://habrastorage.org/webt/ya/1f/1s/ya1f1s6himpftesuq8jcf1bfsco.png" alt="å›¾ç‰‡"><br>  <i>è‡ªå®šä¹‰åœ°å›¾æ§ä»¶æŒ‰é’®çš„ä½ç½®</i> <br><br> ç„¶åï¼Œåœ¨onCreateViewæ–¹æ³•ä¸­ï¼ŒæŒ‡å®šå•å‡»æˆ‘ä»¬çš„æŒ‰é’®æ—¶åº”è¯¥æ‰§è¡Œçš„æ“ä½œï¼š <br><br><div class="spoiler">  <b class="spoiler_title">ç”¨äºå¢åŠ å’Œå‡å°æ¯”ä¾‹ä»¥åŠæ„å»ºè·¯çº¿çš„æŒ‰é’®çš„å¤„ç†ç¨‹åº</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageButton imageButtonZoomIn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageButton imageButtonZoomOut; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageButton imageButtonRoute; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleMap mMap; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  imageButtonZoomIn = view.findViewById(R.id.imageButtonZoomIn); imageButtonZoomIn.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { mMap.animateCamera(CameraUpdateFactory.zoomIn()); } }); //  imageButtonZoomOut = view.findViewById(R.id.imageButtonZoomOut); imageButtonZoomOut.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { mMap.animateCamera(CameraUpdateFactory.zoomOut()); } }); //      imageButtonRoute = view.findViewById(R.id.imageButtonRoute); imageButtonRoute.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { String latitude = String.valueOf(activMarker.getPosition().latitude); String longitude = String.valueOf(activMarker.getPosition().longitude); Uri gmmIntentUri = Uri.parse("google.navigation:q=" + latitude + "," + longitude); Intent mapIntent = new Intent(Intent.ACTION_VIEW, gmmIntentUri); mapIntent.setPackage("com.google.android.apps.maps"); try{ if (mapIntent.resolveActivity(Objects.requireNonNull(getActivity()).getPackageManager()) != null) { startActivity(mapIntent); } }catch (NullPointerException e){ Log.e(TAG, "onClick: NullPointerException: Couldn't open map." + e.getMessage() ); Toast.makeText(getActivity(), "Couldn't open map", Toast.LENGTH_SHORT).show(); } } }); }</span></span></code> </pre><br></div></div><br>  <b>animateCamera</b>æ–¹æ³•çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºæ¯”ä¾‹å°ºå¹³æ»‘å˜åŒ–è€Œä¸æ˜¯ç«‹å³å˜åŒ–ï¼Œä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦åœ¨è¾¾åˆ°æœ€å¤§æˆ–æœ€å°æ¯”ä¾‹å°ºæ—¶å…³é—­ç‰¹å®šç¼©æ”¾æŒ‰é’®çš„åŠ¨ç”»ï¼Œåˆ™éœ€è¦é‡æ–°å®šä¹‰<b>onCameraIdle</b>æ–¹æ³•ï¼Œå½“åœ°å›¾æ¯”ä¾‹å°ºæ›´æ”¹æ—¶ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ¿€æ´»å’Œåœç”¨ç¼©æ”¾æŒ‰é’®</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCameraIdle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mMap.getCameraPosition().zoom == mMap.getMinZoomLevel()){ <span class="hljs-comment"><span class="hljs-comment">//  ,     imageButtonZoomOut.setEnabled(false); imageButtonZoomIn.setEnabled(true); }else if (mMap.getCameraPosition().zoom == mMap.getMaxZoomLevel()){ //  ,     imageButtonZoomOut.setEnabled(true); imageButtonZoomIn.setEnabled(false); }else { //       imageButtonZoomOut.setEnabled(true); imageButtonZoomIn.setEnabled(true); } }</span></span></code> </pre><br></div></div><br> è¦ä½¿ç”¨æ ‡è®°æ‰§è¡Œä»»ä½•æ“ä½œï¼ˆæ‹–æ”¾æ“ä½œé™¤å¤–ï¼‰ï¼Œä¾‹å¦‚ï¼Œåˆ›å»ºæ–°è®¢å•ï¼Œåˆ é™¤éšæœºæ”¾ç½®çš„æ ‡è®°ï¼Œè½¬åˆ°ç°æœ‰è®¢å•æˆ–æŒ‰è¯¥è®¢å•æŒ‡ç¤ºæ‹¨æ‰“ç”µè¯ï¼Œåœ¨å¸ƒå±€ä¸­æ·»åŠ é€‚å½“çš„æ§åˆ¶æŒ‰é’®å¹¶æ³¨å†Œå…¶å¤„ç†ç¨‹åºã€‚ <br><br><img width="40%" src="https://habrastorage.org/webt/eh/9v/yf/eh9vyfwdun36kqaqirzvhwudxsq.png" alt="å›¾ç‰‡"><br>  <i>æ ‡è®°æ§åˆ¶æŒ‰é’®</i> <br><br><div class="spoiler">  <b class="spoiler_title">å¤„ç†å¯¹åœ°å›¾çš„å•å‡»ä»¥æ·»åŠ æ ‡è®°å¹¶æ˜¾ç¤ºè‡ªå®šä¹‰æ§ä»¶æŒ‰é’®</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleMap mMap; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageButton imageButtonRoute; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMapReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GoogleMap googleMap)</span></span></span><span class="hljs-function"> </span></span>{ mMap = googleMap; mMap.setOnMapClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GoogleMap.OnMapClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMapClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LatLng latLng)</span></span></span><span class="hljs-function"> </span></span>{ imageButtonRoute.setVisibility(View.GONE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myMarker !=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-comment"><span class="hljs-comment">//   myMarker.remove(); } //    myMarker = mMap.addMarker(new MarkerOptions() .position(latLng) //   .title(Objects.requireNonNull(getContext()).getString(R.string.title_on_marker_to_new_order)) // true ,         .draggable(true)); myMarker.setTag(null); //    imageButtonAddMarker.setVisibility(View.VISIBLE); imageButtonRemoveMarker.setVisibility(View.VISIBLE); } }); }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">å½“æˆ‘ä»¬ç‚¹å‡»æ·»åŠ è®¢å•æŒ‰é’®æ—¶â€‹â€‹ï¼Œæˆ‘ä»¬ä¼šæŒ‡å‡ºæˆ‘ä»¬è¦å¯¹æ ‡è®°è¿›è¡Œçš„æ“ä½œ</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageButton imageButtonAddMarker; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Marker myMarker; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ imageButtonAddMarker = view.findViewById(R.id.imageButtonAddMarker); imageButtonAddMarker.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myMarker !=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; myMarker.getTag()==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    imageButtonAddMarker.setVisibility(View.GONE); imageButtonRemoveMarker.setVisibility(View.GONE); //  ,          listener.openOrderContentsFragmentFromMap(null, myMarker); //   ,     myMarker.remove(); } } }); }</span></span></code> </pre><br></div></div><br> å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼ŒSDKä¸­æ²¡æœ‰æŒ‰é’®å¯ä»¥åˆ é™¤å¡ä¸Šçš„æ ‡è®°ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¿˜åˆ¶ä½œäº†è‡ªå·±çš„æŒ‰é’®ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">å•å‡»â€œåˆ é™¤æ ‡è®°â€æŒ‰é’®æ—¶ï¼ŒæŒ‡å®šè¦å¯¹æ ‡è®°æ‰§è¡Œçš„æ“ä½œ</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageButton imageButtonRemoveMarker; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Marker myMarker; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ imageButtonRemoveMarker = view.findViewById(R.id.imageButtonRemoveMarker); imageButtonRemoveMarker.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myMarker !=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; myMarker.getTag()==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-comment"><span class="hljs-comment">//   imageButtonAddMarker.setVisibility(View.GONE); imageButtonRemoveMarker.setVisibility(View.GONE); //    myMarker.remove(); } } }); }</span></span></code> </pre><br></div></div><br> å•å‡»æ ‡è®°æ—¶ï¼Œå…¶æ ‡é¢˜å°†æ‰“å¼€ï¼Œå•å‡»è¯¥æ ‡è®°ä¹Ÿå¯ä»¥æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå½“æˆ‘å•å‡»æ–°æ ‡è®°çš„æ ‡é¢˜æ—¶ï¼Œæˆ‘ä¼šåˆ›å»ºä¸€ä¸ªæ–°è®¢å•å°†å…¶äº¤ä»˜ç»™å¿«é€’å‘˜ï¼Œå¹¶åœ¨ç°æœ‰è®¢å•çš„æ ‡è®°ä¸Šæ‰“å¼€è¯¦ç»†çš„äº¤è´§ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¸…å•è´§ç‰©ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å•å‡»æ ‡è®°ä¿¡æ¯çª—å£æ—¶è®¾ç½®æ“ä½œ</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleMap mMap; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMapReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GoogleMap googleMap)</span></span></span><span class="hljs-function"> </span></span>{ mMap = googleMap; mMap.setOnInfoWindowClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GoogleMap.OnInfoWindowClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInfoWindowClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Marker marker)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (marker.getTag()==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    : //      listener.openOrderContentsFragmentFromMap(null, marker); if (myMarker != null) { //   ,     myMarker.remove(); } } else { //     : //         listener.openOrderContentsFragment((Long) marker.getTag()); } } }); }</span></span></code> </pre><br></div></div><br> å°†å¤šä¸ªæ ‡è®°ï¼ˆè¯»å–è®¢å•åˆ—è¡¨ï¼‰è¾“å‡ºåˆ°å¡çš„è¿‡ç¨‹åœ¨åŸç†ä¸Šä¸è¾“å‡ºä¸€ä¸ªæ ‡è®°æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚ æ ‡è®°ç”±åæ ‡ï¼ˆä½ç½®ï¼‰ï¼Œæ ‡é¢˜ï¼ˆæ ‡é¢˜ï¼‰ï¼Œæ ‡é¢˜ä¸‹çš„å°æ–‡æœ¬ï¼ˆæ‘˜è¦ï¼‰å’Œæ ‡ç­¾ï¼ˆsetTagï¼‰ç»„æˆ-å¯ç”¨äºåœ¨åœ°å›¾ä¸Šæ ‡è¯†è®¸å¤šæ ‡è®°ã€‚ <br><br><img width="70%" src="https://habrastorage.org/webt/za/jk/6r/zajk6r8nidla3duqdwtkxzr2ht0.png" alt="å›¾ç‰‡"><br>  <i>å‡ ä¸ªåœ°å›¾æ ‡è®°</i> <br><br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨ç»™å®šåæ ‡ç»˜åˆ¶å¤šä¸ªæ ‡è®°</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawListMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;InfoMarker&gt; latLngList)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (latLngList == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || latLngList.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//    mMap.clear(); LatLngBounds.Builder builder = new LatLngBounds.Builder(); boolean fiarstGreean = true; int count = 1; for (InfoMarker latLng : latLngList) { BitmapDescriptor icon; if (fiarstGreean){ //      //..           icon = BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_GREEN); fiarstGreean = false; } else { icon = latLng.getIcon(); } //      mMap.addMarker(new MarkerOptions().position(latLng.getLatLng()).title(String.valueOf(count)).snippet(latLng.getTitle()).icon(icon)).setTag(latLng.getIdOrder()); builder.include(latLng.getLatLng()); count++; } //       CameraUpdate cameraUpdate; if (loaded) { cameraUpdate = CameraUpdateFactory .newLatLngBounds(builder.build(), 100); } else { cameraUpdate = CameraUpdateFactory.newLatLng(builder.build().getCenter()); } mMap.moveCamera(cameraUpdate); mMap.animateCamera(CameraUpdateFactory.zoomIn()); mMap.animateCamera(CameraUpdateFactory.zoomTo(10), 1000, null); }</span></span></code> </pre><br></div></div><br>  <b>å…³äºåœ°ç†ç¼–ç å™¨çš„å‡ å¥è¯</b> <br><br> åœ°ç†ç¼–ç å™¨ç”¨äºæ ¹æ®åæ ‡è·å–åœ°å€ã€‚ åœ¨åœ°å›¾ä¸Šæ”¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œç„¶åç‚¹å‡»æ·»åŠ è®¢å•æŒ‰é’®ï¼Œå³å¯è·å¾—æ‰€éœ€ç‚¹çš„åœ°ç†åæ ‡ï¼Œå³ çº¬åº¦å’Œç»åº¦ã€‚ ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼Œæœ€å¥½ä»¥äººç±»å¯è¯»çš„å½¢å¼æ˜¾ç¤ºåœ°å€ï¼Œä¾‹å¦‚å›½å®¶ï¼ŒåŸå¸‚ï¼Œè¡—é“ï¼Œæˆ¿å±‹ã€‚ <br><br>  Google Maps SDKåŒ…å«<b>Geocoder</b>ç±»ï¼Œé€šè¿‡è°ƒç”¨å…¶<b>getFromLocation</b>æ–¹æ³•ï¼Œ <b>æ‚¨</b>å¯ä»¥è·å–æŒ‡å®šåæ ‡å¤„çš„åœ°å€æ•°ç»„ã€‚ <br><br> ä¸ºäº†é¿å…é•¿æ—¶é—´é˜»å¡UIçº¿ç¨‹ï¼ˆå°¤å…¶æ˜¯åœ¨Interneté€Ÿåº¦è¾ƒæ…¢æˆ–æ— æ³•è®¿é—®æ—¶ï¼‰ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨RxJavaï¼š <br><br><img width="40%" src="https://habrastorage.org/webt/rq/4f/yx/rq4fyxaic3amyaksci8egy2tvzy.png" alt="å›¾ç‰‡"><br>  <i>æ ¹æ®åœ°ç†åæ ‡åœ¨åœ°å›¾ä¸Šç”Ÿæˆçš„ç‚¹åœ°å€</i> <br><br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨Java RXè®¿é—®Google Geocoder</b> <div class="spoiler_text"><pre> <code class="java hljs">LatLng position = myMarker.getPosition(); Location location = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Location(<span class="hljs-string"><span class="hljs-string">"new"</span></span>); location.setLatitude(position.latitude); location.setLongitude(position.longitude); LocationRepostiory locationRepostiory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocationRepostiory(context, location); locationRepostiory.getLastLocation(). observeOn(SchedulerProvider.getInstance().ui()). subscribeOn(SchedulerProvider.getInstance().computation()). subscribe(locationString -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(editTextAddress.length()==<span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-comment"><span class="hljs-comment">//       ,      editTextAddress.setText(locationString); } }, throwable -&gt; { });</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">å‘ç”Ÿåå‘åœ°ç†ç¼–ç çš„LocationRepostioryç±»çš„æ–‡æœ¬</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationRepostiory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Context context; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Location location; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LocationRepostiory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Location location)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.location = location; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Single&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Single.create(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::subscribeOnLocation); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subscribeOnLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SingleEmitter&lt;String&gt; e)</span></span></span><span class="hljs-function"> </span></span>{ Geocoder geocoder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Geocoder(context, Locale.getDefault()); String errorMessage = <span class="hljs-string"><span class="hljs-string">""</span></span>; List&lt;Address&gt; addresses = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     addresses = geocoder.getFromLocation( location.getLatitude(), location.getLongitude(), // In this sample, get just a single address. 1); } catch (IOException ioException) { //,      I/O. errorMessage = context.getString(R.string.service_not_available); Log.e(TAG, errorMessage, ioException); } catch (IllegalArgumentException illegalArgumentException) { // ,       errorMessage = context.getString(R.string.invalid_lat_long_used); Log.e(TAG, errorMessage + ". " + "Latitude = " + location.getLatitude() + ", Longitude = " + location.getLongitude(), illegalArgumentException); } //  ,     if (addresses == null || addresses.size() == 0) { if (errorMessage.isEmpty()) { errorMessage = context.getString(R.string.no_address_found); Log.e(TAG, errorMessage); } } else { Address address = addresses.get(0); ArrayList&lt;String&gt; addressFragments = new ArrayList&lt;String&gt;(); //      . for (int i = 0; i &lt;= address.getMaxAddressLineIndex(); i++) { e.onSuccess(address.getAddressLine(i)); } } } }</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484100/">https://habr.com/ru/post/zh-CN484100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484088/index.html">å¯†ç å‘½ä¸­å¤§æ¸¸è¡Œï¼ˆä»æ³„æ¼ä¸­åˆ†æçº¦50äº¿ä¸ªå¯†ç ï¼‰</a></li>
<li><a href="../zh-CN484090/index.html">ä¿„ç½—æ–¯é‚®æ”¿æ•°æ®ä¸­å¿ƒçš„æ–°ITåŸºç¡€æ¶æ„</a></li>
<li><a href="../zh-CN484092/index.html">ç‹å­å’Œè´µæ—ç©¿å¾—æœ‰äº›ä½“é¢</a></li>
<li><a href="../zh-CN484094/index.html">ä½¿ç”¨DOTSåˆ›å»ºç¬¬ä¸‰äººç§°åƒµå°¸å°„å‡»æ¸¸æˆ</a></li>
<li><a href="../zh-CN484096/index.html">ä¸¤ä¸ªYakozunä¹‹æˆ˜ï¼Œæˆ–Cassandraä¸HBaseã€‚ Sberbankå›¢é˜Ÿç»éªŒ</a></li>
<li><a href="../zh-CN484102/index.html">PHP vs Python vs Ruby on Railsï¼šè¯¦ç»†æ¯”è¾ƒ</a></li>
<li><a href="../zh-CN484106/index.html">PostgreSQL-6ä¸­çš„MVCCã€‚ çœŸç©ºåº¦</a></li>
<li><a href="../zh-CN484108/index.html">Etherblade.netå°è£…å™¨å’Œç½‘ç»œç»„ä»¶çš„å¯¼å…¥æ›¿ä»£ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN484112/index.html">æœ‰å¯èƒ½ç é£æœºå—</a></li>
<li><a href="../zh-CN484114/index.html">ä¿ç½—Â·æ ¼é›·å„å§†ï¼ˆPaul Grahamï¼‰çš„è®ºæ–‡çš„143ç§è¯‘æœ¬ï¼ˆä»184èµ·ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>