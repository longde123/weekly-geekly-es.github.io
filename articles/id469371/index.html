<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐂 👨🏼‍🌾 🧑🏼‍🤝‍🧑🏼 Deskripsi pendekatan untuk mengatur dan menguji kode menggunakan Redux Thunk 👁‍🗨 🚫 🧓🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! 


 Dalam posting ini, saya ingin berbagi pendekatan saya untuk mengatur dan menguji kode menggunakan Redux Thunk dalam proyek React . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Deskripsi pendekatan untuk mengatur dan menguji kode menggunakan Redux Thunk</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/469371/"><p>  Halo semuanya! </p><br><p>  Dalam posting ini, saya ingin berbagi pendekatan saya untuk mengatur dan menguji kode menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Redux Thunk</a> dalam proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">React</a> . </p><br><p>  Jalan menuju ke sana panjang dan berduri, jadi saya akan mencoba menunjukkan cara berpikir dan motivasi yang mengarah pada keputusan akhir. </p><a name="habracut"></a><br><h2 id="opisanie-prilozheniya-i-postanovka-problemy">  Deskripsi aplikasi dan pernyataan masalah </h2><br><p>  Pertama, sedikit konteks. </p><br><p>  Gambar di bawah ini menunjukkan tata letak halaman khas dalam proyek kami. </p><br><p><img src="https://habrastorage.org/webt/rk/je/ac/rkjeacwa1f4shulpc5ge5y4oi6q.jpeg"></p><br><p>  Dalam rangka: </p><br><ul><li>  Tabel (No. 1) berisi data yang bisa sangat berbeda (teks biasa, tautan, gambar, dll.). </li><li>  Panel sortir (No. 2) menetapkan pengaturan penyortiran data dalam tabel berdasarkan kolom. </li><li>  Panel filtering (No. 3) mengatur berbagai filter sesuai dengan kolom tabel. </li><li>  Panel kolom (No. 4) memungkinkan Anda untuk mengatur tampilan kolom tabel (tampilkan / sembunyikan). </li><li>  Panel template (No. 5) memungkinkan Anda memilih template pengaturan yang dibuat sebelumnya.  Template meliputi data dari panel No. 2, No. 3, No. 4, serta beberapa data lainnya, misalnya, posisi kolom, ukurannya, dll. </li></ul><br><p>  Panel dibuka dengan mengklik tombol yang sesuai. </p><br><p>  Data tentang kolom apa dalam tabel dapat secara umum, data apa yang ada di dalamnya, bagaimana seharusnya ditampilkan, nilai apa yang dapat disaring oleh filter, dan informasi lain terkandung dalam meta-data dari tabel, yang diminta secara terpisah dari data itu sendiri di awal pemuatan halaman. </p><br><p>  Ternyata kondisi tabel saat ini dan data di dalamnya tergantung pada tiga faktor: </p><br><ul><li>  Data dari meta data dari tabel. </li><li>  Pengaturan untuk template yang saat ini dipilih. </li><li>  Pengaturan pengguna (perubahan apa pun mengenai templat yang dipilih disimpan dalam semacam "konsep", yang dapat diubah menjadi templat baru, atau perbarui yang saat ini dengan pengaturan baru, atau hapus mereka dan kembalikan templat ke kondisi semula). </li></ul><br><p>  Seperti disebutkan di atas, halaman seperti itu adalah khas.  Untuk setiap halaman tersebut (dan lebih tepatnya, untuk tabel di dalamnya), entitas terpisah dibuat dalam repositori Redux untuk kenyamanan pengoperasian dengan data dan parameternya. </p><br><p>  Agar dapat menetapkan set pencipta dan tindakan yang homogen dan memperbarui data pada entitas tertentu, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pendekatan berikut digunakan</a> (semacam pabrik): </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* --- ACTIONS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error }; } <span class="hljs-comment"><span class="hljs-comment">/* --- THUNKS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> dispatch =&gt; { dispatch(fetchTotalCounterStart()); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { dispatch(fetchTotalCounterError(error)); } }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter, dispatch</span></span></span><span class="hljs-function">) </span></span>{ dispatch(fetchTotalCounter(filter)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> entityModel.fetchData(filter); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = getCurrentStore(store); <span class="hljs-comment"><span class="hljs-comment">// 'getFilter' comes from selectors. const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); dispatch(applyFilterSuccess(payload)); } catch (error) { dispatch(applyFilterError(error)); } }; } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, applyFilterSuccess, applyFilterError, fetchTotalCounter, fetchData, applyFilter, }; };</span></span></code> </pre> <br><p>  Dimana: </p><br><ul><li>  <code>prefix</code> - <code>prefix</code> entitas dalam repositori Redux.  Ini adalah string dari bentuk "CATS_", "MICE_", dll. </li><li>  <code>getCurrentStore</code> - pemilih yang mengembalikan data saat ini pada entitas dari repositori Redux. </li><li>  <code>entityModel</code> - Sebuah instance dari kelas model entitas.  Di satu sisi, api diakses melalui model untuk membuat permintaan ke server, di sisi lain, beberapa logika pemrosesan data yang kompleks (atau tidak begitu) dijelaskan. </li></ul><br><p>  Dengan demikian, pabrik ini memungkinkan Anda untuk secara fleksibel menggambarkan pengelolaan data dan parameter entitas tertentu dalam repositori Redux dan mengaitkannya dengan tabel yang sesuai dengan entitas ini. </p><br><p>  Karena ada banyak nuansa dalam pengelolaan sistem ini, thunk bisa menjadi rumit, banyak, membingungkan dan memiliki bagian berulang.  Untuk menyederhanakan mereka, serta untuk menggunakan kembali kode, thunks kompleks dipecah menjadi yang lebih sederhana dan digabungkan menjadi komposisi.  Sebagai akibatnya, sekarang mungkin salah satu pemanggil memanggil yang lain, yang sudah dapat mengirimkan <code>applyFilter</code> biasa (seperti bundle <code>fetchTotalCounter</code> - <code>fetchTotalCounter</code> dari contoh di atas).  Dan ketika semua poin utama diperhitungkan, dan semua pencetus tindakan dan tindakan yang diperlukan dijelaskan, file yang berisi fungsi <code>actionsCreator</code> memiliki ~ 1200 baris kode dan diuji dengan mencicit hebat.  File tes juga memiliki sekitar 1.200 baris, tetapi cakupan terbaik 40-50%. </p><br><p>  Di sini, contohnya, tentu saja, sangat disederhanakan, baik dalam hal jumlah thunk dan logika internal mereka, tetapi ini akan cukup untuk menunjukkan masalahnya. </p><br><p>  Perhatikan 2 jenis thunk pada contoh di atas: </p><br><ul><li>  <code>fetchTotalCounter</code> - tindakan pengiriman saja. </li><li>  <code>applyFilter</code> - di samping pengiriman <code>applyFilter</code> miliknya ( <code>applyFilterSuccess</code> , <code>applyFilterError</code> ), pengiriman-itu juga merupakan <code>fetchTotalCounter</code> lain ( <code>fetchTotalCounter</code> ). <br>  Kami akan kembali lagi nanti. </li></ul><br><p>  Semua ini diuji <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sebagai berikut</a> (kerangka kerja digunakan untuk menguji <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jest</a> ): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureMockStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-mock-store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> thunk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-thunk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { actionsCreator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'actionsCreator'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultState = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> middlewares = [thunk]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mockStore = configureMockStore(middlewares); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> defaultState; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: jest.fn(), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: jest.fn(), }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> actions; beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { actions = actionsCreator(prefix, getCurrentStore, entityModel); }); describe(<span class="hljs-string"><span class="hljs-string">'fetchTotalCounter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: counter }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ <span class="hljs-comment"><span class="hljs-comment">// fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); it('should dispatch correct actions on error', () =&gt; { const error = {}; const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockRejectedValueOnce(error); entityModel.fetchTotalCounter.mockResolvedValueOnce({ data: { payload: counter }, }); const expectedActions = [ // fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_ERROR`, error, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); }); });</span></span></code> </pre> <br><p>  Seperti yang Anda lihat, tidak ada masalah dengan pengujian tipe pertama thunk - Anda hanya perlu mengaitkan <code>entityModel</code> model entityModel, tetapi tipe kedua lebih rumit - Anda harus menghapus data untuk seluruh rantai yang disebut thunk dan metode model yang sesuai.  Kalau tidak, tes akan jatuh pada penghancuran data ( <strong>{data: {payload}}</strong> ), dan ini dapat terjadi baik secara eksplisit atau implisit (itu sedemikian rupa sehingga tes berhasil lulus, tetapi dengan penelitian yang cermat diketahui bahwa pada detik / ketiga Link rantai ini ada penurunan dalam tes karena kurangnya data yang terkunci).  Juga buruk bahwa unit test fungsi individu berubah menjadi semacam integrasi, dan menjadi terkait erat. </p><br><p>  Timbul pertanyaan: mengapa di fungsi <code>applyFilter</code> memeriksa bagaimana fungsi <code>fetchTotalCounter</code> jika tes rinci terpisah <strong>telah</strong> ditulis untuk itu?  Bagaimana saya bisa membuat pengujian tipe kedua thunk lebih mandiri?  Akan sangat bagus untuk mendapatkan kesempatan untuk menguji bahwa <strong>thunk</strong> (dalam hal ini <code>fetchTotalCounter</code> ) <strong>baru saja dipanggil dengan parameter yang tepat</strong> , dan tidak perlu mengurus maw agar dapat bekerja dengan benar. </p><br><p>  Tetapi bagaimana cara melakukannya?  Keputusan yang jelas terlintas dalam pikiran: untuk mengaitkan fungsi fetchData, yang disebut dalam <code>applyFilter</code> , atau untuk mengunci <code>fetchTotalCounter</code> (karena sering kali thunk lain dipanggil langsung, dan tidak melalui beberapa fungsi lain seperti <code>fetchData</code> ). </p><br><p>  Ayo kita coba.  Misalnya, kami hanya akan mengubah skrip yang berhasil. </p><br><ul><li>  Opsi nomor 1.  Fungsi tiruan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>fetchData</code></a> : </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); - entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchData = jest.spyOn(actions, 'fetchData'); + // or fetchData.mockImplementationOnce(Promise.resolve({ data: { payload } })); + fetchData.mockResolvedValueOnce({ data: { payload } }); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p>  Di sini, metode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>jest.spyOn</code></a> menggantikan kira-kira (dan mungkin persis) implementasi berikut: </p><br><pre> <code class="javascript hljs">actions.fetchData = jest.fn(actions.fetchData);</code> </pre> <br><p>  Ini memungkinkan kita untuk "memantau" fungsi dan memahami apakah itu dipanggil dan dengan parameter apa. </p><br><p>  Kami mendapatkan kesalahan berikut: </p><br><pre> <code class="diff hljs">Difference: - Expected + Received Array [ Object { - "payload": Object {}, - "type": "TEST_APPLY_FILTER_SUCCESS", + "type": "TEST_FETCH_TOTAL_COUNTER_START", }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_FETCH_TOTAL_COUNTER_ERROR", + }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_APPLY_FILTER_ERROR", + }, ]</code> </pre> <br><p>  Aneh, kami agak menyembunyikan fungsi fetchData, <code>fetchData</code> implementasi kami </p><br><pre> <code class="javascript hljs">fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } })</code> </pre> <br><p>  tetapi fungsinya sama persis seperti sebelumnya, yaitu, mock tidak berfungsi!  Mari kita coba secara berbeda. </p><br><ul><li>  Opsi nomor 2.  Fungsi tiruan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>fetchTotalCounter</code></a> : </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchTotalCounter = jest.spyOn(actions, 'fetchTotalCounter'; + fetchTotalCounter.mockImplementation(() =&gt; {}); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p>  Kami mendapatkan kesalahan yang persis sama.  Untuk beberapa alasan, moka kami tidak menggantikan implementasi fungsi yang asli. </p><br><p>  Setelah menjelajahi masalah ini sendiri dan menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">beberapa</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">informasi</a> di Internet, saya menyadari bahwa masalah ini tidak hanya ada pada diri saya, dan masalah ini diselesaikan (menurut saya) dengan sangat buruk.  Selain itu, contoh-contoh yang dijelaskan dalam sumber-sumber ini baik sampai mereka menjadi bagian dari sesuatu yang menghubungkan mereka ke dalam satu sistem tunggal (dalam kasus kami, ini adalah pabrik dengan parameter). </p><br><p>  Pada proyek kami di pipeline Jenkins ada pemeriksaan kode dari SonarQube, yang membutuhkan mencakup file yang dimodifikasi (yang ada dalam permintaan gabungan / tarik) <code>&gt; 60%</code> .  Karena cakupan pabrik ini, seperti yang dikatakan sebelumnya, tidak memuaskan, dan kebutuhan untuk menutupi file semacam itu hanya menyebabkan depresi, sesuatu harus dilakukan dengannya, jika tidak, pengiriman fungsionalitas baru dapat melambat seiring berjalannya waktu.  Hanya cakupan uji file lain (komponen, fungsi) dalam permintaan gabungan / tarik yang sama yang disimpan, untuk mencapai cakupan% ke tanda yang diinginkan, tetapi, pada kenyataannya, itu adalah solusi, bukan solusi untuk masalah tersebut.  Dan suatu saat yang baik, setelah mengalokasikan sedikit waktu dalam sprint, saya mulai berpikir bagaimana masalah ini dapat diselesaikan. </p><br><h2 id="popytka-resheniya-problemy-1-ya-chto-to-slyshal-pro-redux-saga">  Upaya untuk memecahkan masalah nomor 1.  Saya mendengar sesuatu tentang Redux-Saga ... </h2><br><p>  ... dan mereka mengatakan kepada saya bahwa pengujian sangat disederhanakan ketika menggunakan middleware ini. </p><br><p>  Memang, jika Anda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">melihat dokumentasi</a> , Anda akan terkejut betapa mudahnya kode diuji.  Jus itu sendiri terletak pada kenyataan bahwa dengan pendekatan ini tidak ada masalah sama sekali dengan fakta bahwa beberapa saga dapat memanggil saga lain - kita bisa basah dan "mendengarkan" fungsi yang disediakan oleh middleware ( <code>put</code> , <code>take</code> , dll.), Dan verifikasi bahwa mereka dipanggil (dan dipanggil dengan parameter yang benar).  Artinya, dalam hal ini, fungsi tersebut tidak mengakses fungsi lain secara langsung, tetapi merujuk ke fungsi dari perpustakaan, yang kemudian memanggil fungsi / sagas yang diperlukan lainnya. </p><br><p>  "Kenapa tidak mencoba middleware ini?"  Saya berpikir, dan mulai bekerja.  Dia memulai sejarah teknis di Jira, menciptakan beberapa tugas di dalamnya (dari penelitian hingga implementasi dan deskripsi arsitektur seluruh sistem ini), menerima "lampu hijau" dan mulai membuat salinan minimal dari sistem saat ini dengan pendekatan baru. </p><br><p>  Pada awalnya, semuanya berjalan dengan baik.  Atas saran salah satu pengembang, bahkan dimungkinkan untuk membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hikayat global untuk memuat data dan penanganan kesalahan</a> pada pendekatan baru.  Namun, pada beberapa titik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ada masalah dengan pengujian</a> (yang, kebetulan, belum terselesaikan sejauh ini).  Saya pikir ini dapat menghancurkan semua tes yang tersedia saat ini dan menghasilkan banyak bug, jadi saya memutuskan untuk menunda pekerjaan pada tugas ini sampai ada beberapa solusi untuk masalah ini, dan mulai mengerjakan tugas produk. </p><br><p>  Satu atau dua bulan berlalu, tidak ada solusi yang ditemukan, dan pada titik tertentu, setelah berdiskusi dengan mereka.  memimpin (tidak ada) kemajuan dalam tugas ini, mereka memutuskan untuk meninggalkan implementasi Redux-Saga dalam proyek, karena pada saat itu sudah terlalu mahal dalam hal biaya tenaga kerja dan kemungkinan jumlah bug.  Jadi kami akhirnya memutuskan untuk menggunakan Redux Thunk. </p><br><h2 id="popytka-resheniya-problemy-2-thunk-moduli">  Upaya untuk memecahkan masalah nomor 2.  Modul thunk </h2><br><p>  Anda dapat mengurutkan semua thunk ke dalam file yang berbeda, dan dalam file-file di mana satu thunk memanggil yang lain (diimpor), Anda dapat menghapus import ini baik menggunakan metode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>jest.mock</code></a> atau menggunakan <code>jest.spyOn</code> sama.  Dengan demikian, kita akan mencapai tugas di atas untuk memverifikasi bahwa beberapa pukulan eksternal <strong>dipanggil</strong> dengan parameter yang diperlukan, tanpa khawatir tentang masalah itu.  Selain itu, akan lebih baik untuk memecahkan semua pukulan sesuai dengan tujuan fungsionalnya, agar tidak menyimpan semuanya dalam satu tumpukan.  Jadi tiga spesies tersebut dibedakan: </p><br><ul><li>  Terkait dengan bekerja dengan templat - <code>templates</code> . </li><li>  Terkait dengan bekerja dengan filter (menyortir, menampilkan kolom) - <code>filter</code> . </li><li>  Terkait dengan bekerja dengan tabel (memuat data baru saat menggulir, karena tabel memiliki gulir virtual, memuat meta-data, memuat data dengan penghitung catatan dalam tabel, dll.) - <code>table</code> . </li></ul><br><p>  Folder dan struktur file berikut ini diusulkan: </p><br><pre> <code class="bash hljs">src/ |-- store/ | |-- filter/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- applyFilter.test.js | | | | |-- applyFilter.js | | | |-- actionCreators.js | | | |-- index.js | |-- table/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- fetchData.test.js | | | | | |-- fetchTotalCounter.test.js | | | | |-- fetchData.js | | | | |-- fetchTotalCounter.js | | | |-- actionCreators.js | | | |-- index.js (main file with actionsCreator)</code> </pre> <br><p>  Contoh arsitektur ini ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p><br><p>  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">file uji untuk applyFilter,</a> Anda dapat melihat bahwa kami telah mencapai tujuan yang kami perjuangkan - Anda tidak dapat menulis mokas untuk mempertahankan operasi <code>fetchData</code> / <code>fetchTotalCounter</code> .  Tetapi berapa biayanya ... </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>applyFilter.js</code></a> : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applyFilterSuccess, applyFilterError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fetchData } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../../table/actions'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export function applyFilter(prefix, getCurrentStore, entityModel) { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(prefix, entityModel)(filter, dispatch); dispatch(applyFilterSuccess(prefix)(payload)); } catch (error) { dispatch(applyFilterError(prefix)(error)); } }; }; }</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>actionsCreator</code></a> : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> filterActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tableActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterStart</span></span>: tableActions.fetchTotalCounterStart(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterSuccess</span></span>: tableActions.fetchTotalCounterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterError</span></span>: tableActions.fetchTotalCounterError(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterSuccess</span></span>: filterActions.applyFilterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterError</span></span>: filterActions.applyFilterError(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: tableActions.fetchTotalCounter(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: tableActions.fetchData(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">applyFilter</span></span>: filterActions.applyFilter(prefix, getCurrentStore, entityModel) }; };</code> </pre> <br><p>  Kami harus membayar modularitas tes dengan duplikasi kode dan ketergantungan yang sangat kuat pada satu sama lain.  Perubahan sekecil apa pun dalam rantai panggilan akan menyebabkan refactoring berat. </p><br><p>  Pada contoh di atas, contoh untuk <code>table</code> dan <code>filter</code> diperlihatkan untuk menjaga konsistensi dari contoh yang diberikan.  Bahkan, refactoring dimulai dengan <code>templates</code> (ternyata lebih sederhana), dan di sana, selain refactoring di atas, konsep bekerja dengan templat sedikit berubah.  Sebagai asumsi, dapat diterima bahwa hanya ada satu panel template pada halaman (seperti tabel).  Pada saat itu hanya itu, dan ini <del>  kelalaian </del>  asumsi memungkinkan kita untuk menyederhanakan kode sedikit dengan menghilangkan <code>prefix</code> . <br>  Setelah perubahan dituangkan ke cabang pengembangan utama dan diuji, saya pergi berlibur dengan jiwa yang tenang untuk melanjutkan mentransfer sisa kode ke pendekatan baru setelah kembali. </p><br><p>  Setelah kembali dari liburan, saya terkejut menemukan bahwa perubahan saya dibatalkan.  Ternyata sebuah halaman muncul di mana mungkin ada beberapa tabel independen, yaitu asumsi yang dibuat sebelumnya merusak segalanya.  Jadi semua pekerjaan dilakukan dengan sia-sia ... </p><br><p>  Yah, hampir.  Bahkan, akan mungkin untuk melakukan kembali semua tindakan yang sama (manfaat permintaan gabungan / tarik tidak hilang di mana pun, tetapi tetap dalam sejarah), membiarkan pendekatan ke arsitektur template tidak berubah, dan mengubah hanya pendekatan untuk mengatur thunk-s.  Tetapi pendekatan ini masih tidak menginspirasi kepercayaan karena koherensi dan kerumitannya.  Tidak ada keinginan untuk kembali ke sana, meskipun ini memecahkan masalah yang ditunjukkan dengan pengujian.  Itu perlu untuk menghasilkan sesuatu yang lain, lebih sederhana dan lebih dapat diandalkan. </p><br><h2 id="popytka-resheniya-problemy-3-kto-ischet-tot-naydyot">  Upaya untuk memecahkan masalah nomor 3.  Dia yang mencari akan menemukan </h2><br><p>  Melihat secara global bagaimana tes ditulis untuk thunk, saya perhatikan betapa mudah dan tanpa masalah metode (pada kenyataannya, bidang objek) dari <code>entityModel</code> . </p><br><p>  Kemudian muncul ide: mengapa tidak membuat kelas yang metodenya adalah pencipta aksi dan pukulan?  Parameter yang diteruskan ke pabrik akan diteruskan ke konstruktor kelas ini dan akan dapat diakses melalui <code>this</code> .  Anda dapat segera membuat optimasi kecil dengan membuat kelas terpisah untuk pembuat tindakan dan yang terpisah untuk pencuri, lalu mewarisi satu dari yang lain.  Dengan demikian, kelas-kelas ini akan berfungsi sebagai satu (saat membuat instance dari kelas pewaris), tetapi pada saat yang sama setiap kelas secara individual akan lebih mudah untuk dibaca, dipahami, dan diuji. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Berikut</a> adalah kode yang menunjukkan pendekatan ini. </p><br><p>  Mari kita pertimbangkan secara lebih rinci setiap file yang muncul dan diubah. </p><br><ul><li>  Dalam file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>FilterActionCreators.js</code></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>FilterActionCreators.js</code></a> mendeklarasikan kelas di mana metode ini adalah pembuat tindakan: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FilterActionCreators</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.prefix = config.prefix; } applyFilterSuccess = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload, }); applyFilterError = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error, }); }</code> </pre> <br><ul><li>  Dalam file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>FilterActions.js</code></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>FilterActions.js</code></a> mewarisi dari kelas <code>FilterActionCreators</code> dan mendefinisikan thunk <code>applyFilter</code> sebagai metode kelas ini.  Dalam hal ini, <code>applyFilterSuccess</code> tindakan <code>applyFilterSuccess</code> dan <code>applyFilterError</code> akan tersedia di dalamnya melalui <code>this</code> : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActionCreators } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'/FilterActionCreators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } applyFilter = ({ fetchData }) =&gt; { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = this.getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); // Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; }; }; }</span></span></code> </pre> <br><ul><li>  Di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">file utama</a> dengan semua <code>FilterActions</code> aksi dan <code>FilterActions</code> , kami membuat instance dari kelas <code>FilterActions</code> , meneruskannya objek konfigurasi yang diperlukan.  Saat mengekspor fungsi (di akhir fungsi <code>actionsCreator</code> ), jangan lupa untuk mengganti metode <code>applyFilter</code> untuk meneruskan ketergantungan <code>fetchData</code> ke <code>fetchData</code> : </li></ul><br><pre> <code class="diff hljs"><span class="hljs-addition"><span class="hljs-addition">+ import { FilterActions } from './filter/actions/FilterActions'; - // selector - const getFilter = store =&gt; store.filter; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + const config = { prefix, getCurrentStore, entityModel }; + const filterActions = new FilterActions(config); /* --- ACTIONS BLOCK --- */ function fetchTotalCounterStart() { return { type: `${prefix}FETCH_TOTAL_COUNTER_START` }; } function fetchTotalCounterSuccess(payload) { return { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload }; } function fetchTotalCounterError(error) { return { type: `${prefix}FETCH_TOTAL_COUNTER_ERROR`, error }; } - function applyFilterSuccess(payload) { - return { type: `${prefix}APPLY_FILTER_SUCCESS`, payload }; - } - - function applyFilterError(error) { - return { type: `${prefix}APPLY_FILTER_ERROR`, error }; - } /* --- THUNKS BLOCK --- */ function fetchTotalCounter(filter) { return async dispatch =&gt; { dispatch(fetchTotalCounterStart()); try { const { data: { payload } } = await entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } catch (error) { dispatch(fetchTotalCounterError(error)); } }; } function fetchData(filter, dispatch) { dispatch(fetchTotalCounter(filter)); return entityModel.fetchData(filter); } - function applyFilter(newFilter) { - return async (dispatch, getStore) =&gt; { - try { - const store = getStore(); - const currentStore = getCurrentStore(store); - // 'getFilter' comes from selectors. - const filter = newFilter || getFilter(currentStore); - const { data: { payload } } = await fetchData(filter, dispatch); - - dispatch(applyFilterSuccess(payload)); - } catch (error) { - dispatch(applyFilterError(error)); - } - }; - } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, - applyFilterSuccess, - applyFilterError, fetchTotalCounter, fetchData, - applyFilter + ...filterActions, + applyFilter: filterActions.applyFilter({ fetchData }), }; };</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tes</a> menjadi sedikit lebih mudah baik dalam implementasi maupun dalam membaca: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../FilterActions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'FilterActions'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> store; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dispatch = jest.fn(); beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch.mockClear(); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterSuccess = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterSuccess'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterError = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterError'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre><br><p>  Pada prinsipnya, dalam tes, Anda dapat mengganti cek terakhir dengan cara ini: </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">- expect(applyFilterSuccess).toBeCalledWith(payload); + expect(dispatch).toBeCalledWith(applyFilterSuccess(payload)); - expect(applyFilterError).toBeCalledWith(error); + expect(dispatch).toBeCalledWith(applyFilterError(error));</span></span></code> </pre> <br><p>  Maka tidak perlu mengoleskan mereka dengan <code>jest.spyOn</code> .    ,  ,            .        thunk,       .    ,    ... </p><br><p>    ,  ,    ,     -: ,  thunk-  action creator-      ,    ,   .        ,   .         <code>actionsCreator</code> -   ,   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions/FilterActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TemplatesActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./templates/actions/TemplatesActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TableActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions/TableActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TemplatesActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TableActions(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...filterActions, ...templatesActions, ...tableActions, }; };</code> </pre> <br><p>     .     <code>filterActions</code>          <code>templatesActions</code>  <code>tableActions</code> ,   ,   ,     <code>filterActions</code> ?           ,    .           .         - ,      ,    . </p><br><p>   .      ,     back-end  (  Java),      .   ,  Java/Spring      ,   .         - ? </p><br><p>      : </p><br><ul><li>    thunk-   <code>setDependencies</code> ,        — <code>dependencies</code> : </li></ul><br><pre> <code class="diff hljs">export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } + setDependencies = dependencies =&gt; { + this.dependencies = dependencies; + };</code> </pre> <br><ul><li>                     : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const actions = { + ...filterActions, + ...templatesActions, + ...tableActions, + }; + + filterActions.setDependencies(actions); + templatesActions.setDependencies(actions); + tableActions.setDependencies(actions); + return actions; - return { - ...filterActions, - ...templatesActions, - ...tableActions, - }; };</code> </pre> <br><ul><li>     <code>this.dependencies</code> : </li></ul><br><pre> <code class="javascript hljs">applyFilter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { fetchData } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore(store); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = newFilter || getFilter(currentStore); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetchData(filter, dispatch); <span class="hljs-comment"><span class="hljs-comment">// Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; };</span></span></code> </pre> <br><p>    ,        <code>applyFilter</code>   ,   -  <code>this.dependencies</code>    .         ,         . </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from '../FilterActions'; describe('FilterActions', () =&gt; { const prefix = 'TEST_'; const getCurrentStore = store =&gt; store; const entityModel = {}; + const dependencies = { + fetchData: jest.fn(), + }; const config = { prefix, getCurrentStore, entityModel }; const actions = new FilterActions(config); + actions.setDependencies(dependencies); const dispatch = jest.fn(); beforeEach(() =&gt; { dispatch.mockClear(); }); describe('applyFilter', () =&gt; { const getStore = () =&gt; ({}); const newFilter = {}; it('should dispatch correct actions on success', async () =&gt; { const payload = {}; - const fetchData = jest.fn().mockResolvedValueOnce({ data: { payload } }); + dependencies.fetchData.mockResolvedValueOnce({ data: { payload } }); const applyFilterSuccess = jest.spyOn(actions, 'applyFilterSuccess'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it('should dispatch correct actions on error', async () =&gt; { const error = {}; - const fetchData = jest.fn().mockRejectedValueOnce(error); + dependencies.fetchData.mockRejectedValueOnce(error); const applyFilterError = jest.spyOn(actions, 'applyFilterError'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre> <br><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a> . </p><br><p>       ,   ,            : </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; - export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + export const actionsCreator = (prefix, getCurrentStore, entityModel, ExtendedActions) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const extendedActions = ExtendedActions ? new ExtendedActions(config) : undefined; const actions = { ...filterActions, ...templatesActions, ...tableActions, + ...extendedActions, }; filterActions.setDependencies(actions); templatesActions.setDependencies(actions); tableActions.setDependencies(actions); + if (extendedActions) { + extendedActions.setDependencies(actions); + } return actions; };</code> </pre> <br><ul><li>   <code>ExtendedActions</code>    ,     : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendedActions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore = config.getCurrentStore; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityModel = config.entityModel; } setDependencies = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dependencies</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies = dependencies; }; <span class="hljs-comment"><span class="hljs-comment">// methods to re-define }</span></span></code> </pre> <br><p>  ,    ,   : </p><br><ul><li>    ,     . </li><li>      . </li><li>     ,   ,     thunk-         . </li><li>   ,      ,   thunk-/action creator-      99-100%. </li></ul><br><h2 id="bonus">  </h2><br><p>   action creator-     ( <code>filter</code> , <code>templates</code> , <code>table</code> ),   reducer-   -  ,        ,    <code>actionsCreator</code> - ,         reducer-  ~400-500  . </p><br><p>      : </p><br><ul><li>   reducer-: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> isNull <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash/isNull'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getDefaultState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../getDefaultState'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { templatesReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/templates/reducers/templatesReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { filterReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/filter/reducers/filterReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { tableReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/table/reducers/tableReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createTableReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> prefix, initialState = getDefaultState(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entityModel</span></span></span><span class="hljs-function">, ) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, initialState, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesReducer = templatesReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterReducer = filterReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducer = tableReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesState = templatesReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(templatesState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> templatesState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterState = filterReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(filterState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filterState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableState = tableReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(tableState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tableState; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }; };</code> </pre> <br><ul><li> <code>tableReducerConfigurator</code> ( ): </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducerConfigurator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ prefix, entityModel }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: action.payload, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.error, }; } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }; };</code> </pre> <br><p>  : </p><br><ol><li>   <code>reducerConfigurator</code> -    action type-,   «».  action type      case,    <em>null</em> (). </li><li>   <code>reducerConfigurator</code> -      ,  <em>null</em> ,     <code>reducerConfigurator</code> -  <em>!null</em> .    ,    <code>reducerConfigurator</code> -   case,      <code>reducerConfigurator</code> -. </li><li>   ,      <code>reducerConfigurator</code> -    case-   action type-,     (  reducer-). </li></ol><br><p>    ,    <code>actionsCreator</code> -,     ,      ,  ,  . </p><br><p>   ,   ! <br> ,             Redux Thunk. </p><br><p>   ,    Redux Thunk      .   ,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469371/">https://habr.com/ru/post/id469371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469355/index.html">Tutorial NumPy yang Membosankan</a></li>
<li><a href="../id469357/index.html">Lari, Gopher, lari! - apa yang akan kita bicarakan di GolangConf</a></li>
<li><a href="../id469361/index.html">Nyeri dan Air Mata di Svelte 3</a></li>
<li><a href="../id469367/index.html">Jalankan tes unit secara lokal di STM32CubeIDE di bawah Windows</a></li>
<li><a href="../id469369/index.html">Acara digital di Moskow dari 30 September hingga 06 Oktober</a></li>
<li><a href="../id469373/index.html">Hasil proyek untuk membuat antarmuka saraf untuk pasien yang lumpuh total dipertanyakan</a></li>
<li><a href="../id469375/index.html">Mengapa Mozilla, Coil, dan Creative Commons membagikan $ 100 juta untuk proyek sumber terbuka?</a></li>
<li><a href="../id469379/index.html">Penerapan metode validasi model formal untuk UI</a></li>
<li><a href="../id469381/index.html">Agones, buat server game multi-pengguna. Arsitektur dan Instalasi</a></li>
<li><a href="../id469383/index.html">Solusi Hyperconverged AERODISK vAIR. Dasar - Sistem File ARDFS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>