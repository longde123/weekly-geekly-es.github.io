<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¢ üë©üèª‚Äçü§ù‚Äçüë®üèæ ü§õüèª Wir pumpen die Gegensprechanlage mit dem MQTT-Protokoll, um sie vom Telefon aus zu steuern üëÄ üìâ üì≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo an alle. Ich erz√§hle Ihnen ein wenig √ºber meine letzte Zusammenarbeit - die Fertigstellung der Gegensprechanlage mit dem NodeMCU WiFi-Modul. Ich...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir pumpen die Gegensprechanlage mit dem MQTT-Protokoll, um sie vom Telefon aus zu steuern</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/406491/"><img src="https://habrastorage.org/web/4da/a19/2c9/4daa192c94284fc7b405761187ed7caa.JPG" align="left" width="350">  Hallo an alle.  Ich erz√§hle Ihnen ein wenig √ºber meine letzte Zusammenarbeit - die Fertigstellung der Gegensprechanlage mit dem NodeMCU WiFi-Modul.  Ich entschuldige mich im Voraus f√ºr die Wahl des Moduls - wahrscheinlich hat jeder bereits dieses ESP'shka ... <br><br>  Nat√ºrlich kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die</a> Arbeit von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ClusterM mit seinem Anrufbeantworter</a> von niemandem √ºbertroffen werden, aber ich halte diese Funktionalit√§t f√ºr unn√∂tig.  Bei der Geburt meiner Tochter musste ich die Gegensprechanlage nur stillschweigend f√ºr die G√§ste √∂ffnen, um nicht am Mobilteil zu stehen und nicht auf einen eingehenden Anruf zu warten, der wahrscheinlich einen kleinen Anruf wecken w√ºrde.  Ja, und manchmal ist es f√ºr Sie einfacher, die T√ºr vom Telefon aus zu √∂ffnen, als √ºber die Schl√ºssel zu klettern und das Tablet hin und her zu legen, damit es funktioniert (mein Panel im Eingang ist sehr langweilig).  Das Projekt erwies sich als klein, so dass der Artikel auch nicht viele Buchstaben enth√§lt, aber es gibt Fotos. <br><a name="habracut"></a><br>  <b>Eisen</b> <br><br>  Ich hatte mehrere NodeMCU-Module zur Verf√ºgung, und nachdem ich sie auf das Intercom-Mobilteil geschoben hatte, entschied ich, dass sie problemlos hineinpassen w√ºrde. Ich muss nur eine Erweiterungskarte erstellen.  Ich z√ºchte immer in EagleCad, ich bestelle Boards entweder beim Chinesen oder beim American OSH Park.  Im OSH Park ist es billiger, wenn der Boardbereich klein ist, aber Sie erhalten nur 3 Boards anstelle von 10 Chinesen, aber f√ºr ein St√ºckprojekt spielt es keine Rolle.  Die Relais PE014005 standen genau zwischen den NodeMCU-Pins perfekt auf der Platine. <br><br><img src="https://habrastorage.org/web/1bc/779/1cd/1bc7791cd723414f9c3251651962d14a.JPG"><br><br>  Nicht die billigste Option, aber ich hatte sie auf Lager.  Und so k√∂nnen Sie die billigsten Chinesen, zum Beispiel HUI KE, einsetzen (dies ist kein Fluch, dies ist die Firma - sie haben eine Reihe von Rollen HK4100F).  Ich habe auch zwei Optokoppler 4N35S verwendet, einen am Eingang - um einen eingehenden Anruf zu empfangen, den zweiten beim Schlie√üen der T√ºrtaste zum √ñffnen. <br><br>  Die resultierende Schaltung und Topologie der Karte hier (alles befindet sich im Repository, Link am Ende des Artikels): <br><br><img src="https://habrastorage.org/web/0c0/7e7/b71/0c07e7b711094570b5538256cda4ba58.jpg"><br><br><img src="https://habrastorage.org/web/e29/13c/344/e2913c3442c8411c89839bab96cb0112.jpg"><br><br>  Bretter aus der Produktion. <br><br><img src="https://habrastorage.org/web/3e2/b2d/370/3e2b2d370eac485182a3188201729774.JPG"><br><br>  <b>Einige Fotos</b> <br><br><img src="https://habrastorage.org/web/479/66c/b8d/47966cb8d69a4c7eb06314555cb4c60e.jpg"><br><br><img src="https://habrastorage.org/web/32e/d3f/b99/32ed3fb9947d479f8365dc963aacab27.JPG"><br><br><img src="https://habrastorage.org/web/356/569/5f5/3565695f54a54098993294df1df5ffc9.JPG"><br><br>  <b>Beschreibung der R√∂hre</b> <br><br>  Zun√§chst ein wenig zum Prinzip der R√∂hre selbst - ich habe eine digitale KL-2.  Hier ist ein Diagramm von der offiziellen Seite. <br><br><img src="https://habrastorage.org/web/7b1/fdd/96c/7b1fdd96c1394734b67b6e4df3b5ffc8.jpg"><br><br>  Auf dem Diagramm: <b>1,2</b> - Kontakte, die die Intercom-Leitung verbinden (hat Polarit√§t, wenn jemand es nicht wusste);  <b>SW2</b> - R√∂hrenschallschalter (unten - der Ton ist aus, oben - der Ton ist an);  <b>SW1</b> - der Hebel der Sprechr√∂hre (unten - der Empf√§nger h√§ngt, oben - der Empf√§nger ist abgehoben);  <b>SB1</b> - Taste zum √ñffnen der T√ºr;  <b>BA1</b> - Lautsprecherr√∂hre;  <b>BM1</b> - R√∂hrenmikrofon, <b>HL1</b> - LED. <br><br>  Wenn die Zugangsklappe einen Anruf t√§tigt, tritt eine M√§anderamplitude von <b>12 V</b> in die Leitung ein.  Der Widerstand in der Leitung sollte <b>50 Ohm betragen</b> . In jedem anderen Fall wird ein Fehler auf dem Bedienfeld angezeigt.  Wenn sich der Schalter <b>SW2</b> in der unteren Position befindet (der Ton am Mobilteil ist ausgeschaltet), ist ein <b>50-Ohm-</b> Widerstand an die Leitung angeschlossen - die LED blinkt, aber wir h√∂ren keinen Ton.  Wenn sich der Schalter <b>SW2</b> in der oberen Position befindet (der Ton ist eingeschaltet) und der Schalter <b>SW1</b> in der unteren Position ist (das Mobilteil h√§ngt), ist die Impedanz des <b>BA1-</b> Lautsprechers immer noch gleich <b>50 Ohm</b> , nur der M√§ander trifft ihn und wir h√∂ren den Ton.  Nach dem Abheben des Mobilteils schaltet <b>SW1</b> in die obere Position und ein Lautsprecherausgang wird vom Boden abgerissen. Jetzt wird ein analoges Sprachsignal und eine akzeptable Lautst√§rke f√ºr das Ohr ausgegeben, anstatt hundert Dezibel zu fordern.  Wenn Sie die T√ºr f√ºr einen Gast √∂ffnen <b>m√∂chten</b> , dr√ºcken Sie die Taste <b>SB1</b> , die den Transistor verriegelt und den Widerstand in der Leitung stark erh√∂ht. Das Bedienfeld versteht also, dass die T√ºr ge√∂ffnet werden muss. <br><br>  <b>Nun zu den Verbesserungen</b> <br><br><img src="https://habrastorage.org/webt/59/d4/a7/59d4a70ca4c6b561220490.jpeg"><br><br>  <b>Relais 1</b> - Wir √ºbernehmen die <b>Schallkontrolle</b> (wir gehen davon aus, dass sich der native Schalter der R√∂hre <b>SW2</b> in der oberen Position befindet, da sonst Haferbrei vorhanden ist).  <b>Eingang</b> - Optokoppler zuckt w√§hrend eines Anrufs (verbunden vor <b>Relais1</b> , um den Anruf im lautlosen Modus zu sehen);  <b>Relais 2</b> - simuliert das Entfernen eines Rohrs;  <b>√ñffnen</b> - Schlie√üt den Knopf zum √ñffnen der T√ºr.  Ich mache Sie darauf aufmerksam, dass die Rollen durch normalerweise geschlossene Kontakte in den Spalt eingel√∂tet werden.  Dies bedeutet, dass Sie die Gegensprechanlage jederzeit vom Netzwerk trennen k√∂nnen (wenn pl√∂tzlich das Licht ausgeht oder das Internet verschwindet) und sie betriebsbereit bleibt. Dies ist wichtig. <br><br>  <b>Firmware</b> <br><br>  Ich habe die Firmware in PlatformIO (einem Plug-In f√ºr den Atom-Editor) in die Arduino-Bibliotheken geschrieben.  Link zum Repository am Ende des Artikels.  Mit Ihrer Erlaubnis ist die IDE komfortabler als das native Arduino - wer es nicht ausprobiert hat, sollte es unbedingt versuchen.  Als MQTT-Client auf dem Telefon wurde IoTmanager verwendet (im Folgenden einfach ein Client).  Ich werde nicht viel √ºber das Programm erz√§hlen (diejenigen, die es w√ºnschen, werden den Code sehen), ich werde nur beschreiben, was sie wei√ü: <br><br><ul><li>  Stellen Sie eine Verbindung zum MQTT-Broker her </li><li>  Ver√∂ffentlichen Sie Themen mit Einstellungen f√ºr den Client </li><li>  Abonnieren Sie Themen, um auf das Wechseln im Client zu reagieren </li><li>  Senden Sie bei einem eingehenden Anruf eine Push-Benachrichtigung an das Telefon </li><li>  Ver√∂ffentlichen Sie ge√§nderte Einstellungen bei einem Anruf (um den Status im Client anzuzeigen). </li><li>  Schalten Sie die Gegensprechanlage auf Befehl des Clients stumm </li><li>  √∂ffne die T√ºr einmal </li><li>  unendlich oft √∂ffnen </li><li>  einfach auflegen </li></ul><br>  <b>Antragsbildschirme</b> (anklickbar) <br><br> <a href=""><img src="https://habrastorage.org/web/d4f/be6/958/d4fbe695884946f79b763df887f443fe.jpg"></a> <br><br>  Die Funktion des IoTmanager-Programms besteht darin, dass alle Einstellungen in Themen gespeichert werden und nur das angezeigt wird, was ver√∂ffentlicht wird.  Die Bedeutung des leichten MQTT-Protokolls ist etwas verloren, aber ich mag diese Implementierung.  Falls gew√ºnscht, k√∂nnen Sie es f√ºr einen anderen MQTT-Client wiederholen. <br><br>  Nat√ºrlich erfordert all dies (und sogar mit zwei elektromechanischen Relais) externe Stromversorgung, und ich w√ºrde √ºber die Zweckm√§√üigkeit des Fahrzeugs nachdenken, wenn ich 5-V-Strom aus der Steckdose ziehen m√ºsste ... Aber ich habe einen Z√§hler in der Wohnung und die Gegensprechanlage h√§ngt sehr nahe.  Ich habe gerade ein 220AC / 5VDC-Din-Rail-Modul bei Ali bestellt und die Gegensprechanlage von dort aus eingeschaltet.  Auf dem Foto ist es zur Erleichterung der internen Installation auf den Kopf gestellt. <br><br><img src="https://habrastorage.org/web/ffc/9ca/5d7/ffc9ca5d711048b7a0d27d6e9fa5c173.JPG"><br><br>  Vielen Dank f√ºr Ihre Aufmerksamkeit.  Ich lade Sie zu einem Kommentar ein. <br><br>  <b>Die zweite Version des Ger√§ts wird entwickelt, √ºber die ich hier spreche</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√Ñnderung der Gegensprechanlage mit dem MQTT-Protokoll zur Steuerung √ºber das Telefon (Version 2.0)</a> . <br><br>  <b>N√ºtzliche Links:</b> <br><br>  1. <a href="">Das Repository dieses Projekts auf GitHub</a> - es gibt ein Diagramm, eine Verkabelung und einen Quellcode. <br>  2. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das Erstellen einer intelligenten Gegensprechanlage mit einem Anrufbeantworter und einer Internetverbindung</a> ist ein Artikel von Genosse ClusterM, der eingangs erw√§hnt wurde. <br>  3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wie habe ich die Vizit-Gegensprechanlage mit mqtt verbunden</a> - der Gegensprechanlage mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Arduino-</a> und Ethernet-Abschirmung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">?</a> <br>  4. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Esp8266 Internetsteuerung √ºber das MQTT-Protokoll</a> - Artikel √ºber MQTT und ESP8266. <br>  5. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fernbedienung</a> - ein weiterer Artikel zum Thema. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de406491/">https://habr.com/ru/post/de406491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de406475/index.html">Wissenschaftler haben eine Architektur f√ºr einen fliegenden humanoiden Roboter entwickelt</a></li>
<li><a href="../de406481/index.html">Nahe der Mitte der Milchstra√üe fand ein supermassereiches Schwarzes Loch</a></li>
<li><a href="../de406483/index.html">China Today: Brillen sind nicht mehr nnnada</a></li>
<li><a href="../de406487/index.html">Ein unerwartetes Treffen. Kapitel 13</a></li>
<li><a href="../de406489/index.html">Halten Sie sich mit wenigen Ausnahmen vom Cloud Mining fern</a></li>
<li><a href="../de406493/index.html">Die Entwicklung der Uhren: Welche Technologie hat sie gelehrt?</a></li>
<li><a href="../de406495/index.html">[CASE] 3D-Druck in der Architektur am Beispiel von Setl City</a></li>
<li><a href="../de406497/index.html">MOBA</a></li>
<li><a href="../de406499/index.html">IFA 2017: Lenovo & Motorola News Guide</a></li>
<li><a href="../de406501/index.html">Durov sprach √ºber die Versuche des FBI, Zugang zu Telegrammbenutzern zu erhalten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>