<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💪🏻 🤰🏼 🙆🏿 WebComponents comme frameworks, interaction de composants 🤚🏽 ⚱️ 🌖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En ce qui concerne les composants Web, ils disent souvent: «Que voulez-vous sans frameworks? Tout y est prêt. » En fait, il existe des cadres créés su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WebComponents comme frameworks, interaction de composants</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461153/">  En ce qui concerne les composants Web, ils disent souvent: «Que voulez-vous sans frameworks?  Tout y est prêt. »  En fait, il existe des cadres créés sur la base de la mise en œuvre des normes incluses dans le groupe de composants Web.  Il en existe même de relativement bons comme le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">X-Tag</a> .  Mais aujourd'hui, nous comprendrons toujours à quel point l'API du navigateur est devenue simple, élégante et puissante pour résoudre les tâches de développement quotidiennes, notamment en organisant l'interaction des composants entre eux et avec d'autres objets dans le contexte de l'exécution du navigateur, et vous pouvez toujours utiliser des cadres avec des composants Web, même celles qui ont été développées à travers les normes, notamment à travers les mécanismes que nous analyserons aujourd'hui, au moins comme indiqué <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site</a> . <br><a name="habracut"></a><br>  Des décisions comme un réactif nous ont appris qu'il devrait y avoir un côté Big Data et les composants signés pour ses changements, et dans les composants Web, ils essaient également de discerner l'absence d'un tel sous-système, en fait, ce qui implique même un binning inversé inconsciemment et il existe déjà dans les composants Web. <br><br>  Chaque élément a des attributs dont nous pouvons changer la valeur.  Et si vous répertoriez les noms dans le crochet observéAttributes, puis quand ils changent, <b>attributeChangedCallback ()</b> sera automatiquement appelé dans lequel nous pouvons déterminer le comportement du composant lorsque l'attribut change.  En utilisant la magie getter, il est facile de faire une liaison inverse de la même manière. <br><br>  Nous avons déjà esquissé un projet dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">première partie</a> et aujourd'hui nous allons continuer à le couper davantage. <br><br>  Il convient de mentionner immédiatement une limitation, au moins dans l'implémentation actuelle, selon laquelle la valeur d'attribut ne peut être qu'une valeur primitive spécifiée par un littéral et réductible à une chaîne, mais en général, il est possible de transférer des «objecs» de cette manière en utilisant des guillemets simples de l'extérieur et des doubles pour définir valeurs et champs du projet. <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-component</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">my</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{"foo": "bar"}'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-component</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Pour utiliser cette valeur dans le code, vous pouvez implémenter un getter <b>magique automatique</b> qui appellera <b>JSON.parse () dessus</b> . <br><br>  Mais pour l'instant, la valeur numérique du compteur nous suffit. <br><br>  Nous ajoutons un nouvel attribut à notre élément, le spécifions comme observé, cliquez sur le gestionnaire de clics pour incrémenter ce compteur et ajoutons la mise à jour de la valeur affichée par lien direct au crochet de modification, dont la logique est implémentée dans une méthode <b>updateLabel () réutilisable distincte</b> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.importNode(myWebCompTemplate.content, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">'open'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.appendChild(html); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); } updateLabel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.querySelector(<span class="hljs-string"><span class="hljs-string">'#helloLabel'</span></span>).textContent = <span class="hljs-string"><span class="hljs-string">'Hello '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'greet-name'</span></span>) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> get observedAttributes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'count'</span></span>]; } attributeChangedCallback(name, oldValue, newValue) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name === <span class="hljs-string"><span class="hljs-string">'count'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); } } showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }</code> </pre><br><img src="https://habrastorage.org/webt/cp/zl/eu/cpzleupyc6rpa6qkrn30g4dh1n4.png"><br><br>  Chaque élément a reçu un compteur indépendant, mis à jour automatiquement. <br><br>  Devoirs: implémentez la conversion du compteur en nombre et utilisez-le via un auto-getter;) <br><br>  Bien sûr, des options plus avancées sont possibles.  Par exemple, si vous ne prenez pas en compte les rappels et événements simples, en utilisant le proxy natif et les mêmes getters et setters, vous pouvez implémenter la fonctionnalité de liaison inverse. <br><br>  Ajouter <b>le</b> fichier <b>my-counter.js</b> avec une classe de ce type <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count = <span class="hljs-number"><span class="hljs-number">0</span></span>; } increment() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); } }</code> </pre><br>  Nous avons hérité d'une classe de <b>EventTarget</b> afin que d'autres classes puissent s'abonner aux événements lancés par les objets de cette classe et définir une propriété count qui stockera la valeur du compteur. <br><br>  Ajoutez maintenant l'instance de cette classe en tant que propriété statique pour le composant. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { MyWebComp } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"./my-webcomp.js"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { MyCounter } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"./my-counter.js"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">let</span></span></span><span class="javascript"> counter = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> MyCounter(); </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Object</span></span></span><span class="javascript">.defineProperty(MyWebComp.prototype, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'counter'</span></span></span><span class="javascript">, { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">value</span></span></span><span class="javascript">: counter }); customElements.define(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'my-webcomp'</span></span></span><span class="javascript">, MyWebComp); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Et dans le code du composant, nous souscrirons à la valeur change la méthode de mise à jour des étiquettes <b>updateLabel ()</b> , à laquelle nous ajoutons l'affichage de la valeur du compteur partagé global.  Et dans le gestionnaire de clics, un appel direct à la méthode incrémentielle. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.importNode(myWebCompTemplate.content, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">'open'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.appendChild(html); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.addEventListener(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } updateLabel() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.querySelector(<span class="hljs-string"><span class="hljs-string">'#helloLabel'</span></span>).textContent = <span class="hljs-string"><span class="hljs-string">'Hello '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'greet-name'</span></span>) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>) + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.count; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> get observedAttributes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'count'</span></span>]; } attributeChangedCallback(name, oldValue, newValue) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name === <span class="hljs-string"><span class="hljs-string">'count'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); } } } showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.increment(); } }</code> </pre><br>  Malgré le fait que chaque élément a reçu deux compteurs, chacune de ses valeurs sera incrémentée indépendamment, mais la valeur du compteur partagé sera la même pour les deux éléments, et les valeurs individuelles seront déterminées par le nombre de clics uniquement sur eux. <br><br><img src="https://habrastorage.org/webt/pa/hs/kt/pahskt4tkdbbowmovchpejbdv3q.png"><br><br>  Ainsi, nous avons obtenu une liaison directe en liaison directe, et en raison de l'utilisation d'événements, cette valeur est faible lors de la mise à jour.  Bien sûr, rien n'empêche l'incrément d'être implémenté via des événements, en liant la méthode <b>increment () au</b> lyseur de l'événement: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increment.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } increment() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); } }</code> </pre><br>  et remplacer l'appel de méthode par un lancer d'événement: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ ... showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); } }</code> </pre><br>  Qu'est-ce que cela change?  Maintenant, si au cours du développement, la méthode <b>increment ()</b> est supprimée ou modifiée, l'exactitude de notre code sera violée, mais il n'y aura pas d'erreurs d'interprétation, c'est-à-dire  l'opérabilité restera.  Cette caractéristique est appelée faible connectivité. <br><br>  Dans le développement, une liaison directe et faible est nécessaire, généralement il est habituel d'implémenter une liaison directe dans la logique d'un module de composant, et un couplage faible entre différents modules et composants afin de fournir la flexibilité et l'extensibilité de l'ensemble du système.  La sémantique HTML implique un haut niveau de flexibilité, c'est-à-dire  préférence pour une connectivité faible, mais l'application fonctionnera de manière plus fiable si les connexions à l'intérieur des composants sont directes. <br><br>  Nous pouvons raccrocher les gestionnaires à l'ancienne et appeler des événements sur l'objet <b>document</b> global. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.importNode(myWebCompTemplate.content, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">'open'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.appendChild(html); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.addEventListener(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateLabel.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } disconnectedCallback() { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.removeEventListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.removeEventListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>)); } ... showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); } }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyCounter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventTarget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increment.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.increment.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } increment() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count++; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'countChanged'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count } })); } }</code> </pre><br>  Le comportement n'est pas différent, mais maintenant nous devons penser à supprimer le gestionnaire d'événements de l'objet global si l'élément lui-même est supprimé de l'arborescence.  Heureusement, les composants Web nous fournissent non seulement des crochets de conception, mais aussi une destruction, évitant les fuites de mémoire. <br><br>  Il y a aussi un autre point important: les événements des éléments arborescents peuvent interagir les uns avec les autres grâce à un mécanisme appelé «bouillonnement». <br><br>  Lorsque l'utilisateur clique sur notre élément, l'événement, ayant travaillé sur l'élément lui-même, commence à être appelé sur le parent comme des cercles sur l'eau, puis sur le parent de ce parent et ainsi de suite sur l'élément racine. <br><br>  À tout moment de cette chaîne d'appels, l'événement peut être intercepté et traité. <br><br>  Bien sûr, ce n'est pas tout à fait le même événement, et ses dérivés et contextes, bien qu'ils contiennent des liens les uns avec les autres, par exemple dans <b>event.path</b> , ne coïncideront pas complètement. <br><br>  Cependant, ce mécanisme vous permet d'associer des éléments enfants à leurs parents de telle manière que ce lien ne viole pas les modèles d'ingénierie, c'est-à-dire  sans liens directs, mais uniquement en raison de leur propre comportement. <br><br>  Dans les temps anciens, cela a également donné lieu à de nombreux problèmes, lorsque les événements de certains éléments ont provoqué des «cercles» ou des échos dans certaines sections du document qui n'étaient pas souhaitables pour les réactions. <br><br>  Pendant des années, les développeurs Web ont lutté avec la «propagande» (propagation ou surfaçage) des événements et les ont arrêtés et les ont transformés comme ils le pouvaient, mais pour leur utilisation confortable, comme dans le cas des identifiants, seule l'isolement de l'arbre fantôme faisait défaut. <br><br>  La magie ici est que les événements ne pillent pas en dehors de l'arbre des ombres.  Mais néanmoins, vous pouvez attraper l'événement déclenché par ses enfants dans le composant hôte et le remonter dans l'arborescence sous la forme d'une autre signification d'événement, eh bien, ou simplement le traiter. <br><br>  Pour comprendre comment tout cela fonctionne, nous <b>emballons</b> nos éléments <b>webcomp</b> dans un conteneur comme celui-ci: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcont</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">0</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myWebComp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">greet-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"John"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">0</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"this.showMessage(event)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myWebComp2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">greet-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Josh"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">0</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"this.showMessage(event)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcomp</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my-webcont</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Le conteneur aura ce code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebCont</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); } connectedCallback() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.updateCount.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } updateCount(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> get observedAttributes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'count'</span></span>]; } attributeChangedCallback(name, oldValue, newValue) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name === <span class="hljs-string"><span class="hljs-string">'count'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'my-webcomp'</span></span>).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el</span></span></span><span class="hljs-function">) =&gt;</span></span> { el.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, newValue); }); } } }</code> </pre><br>  Dans <b>connectedCallback (),</b> nous accrocherons le gestionnaire à l'événement d' <b>incrémentation</b> , qui lancera les enfants.  Le gestionnaire incrémentera le propre compteur de l'élément, et un rappel pour modifier sa valeur passera par tous les éléments enfants et incrémentera leurs compteurs, sur lesquels les gestionnaires précédemment développés par nous se bloquent. <br><br>  Le code des éléments enfants changera légèrement, en fait, tout ce dont nous avons besoin est que l'événement <b>incrémente</b> jette l'élément lui-même et non ses agrégats, et le fasse avec l'attribut <b>bubble: true</b> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWebComp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ ... showMessage(event) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">'count'</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.counter.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">bubbles</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> })); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">'increment'</span></span>)); } }</code> </pre><br><img src="https://habrastorage.org/webt/30/ez/z8/30ezz8bzyeaq2cpksbwn8wmzf2q.png"><br><br>  Maintenant, malgré un caractère aléatoire général, les premiers compteurs d'éléments afficheront toujours la valeur du parent.  Dans l'ensemble, ce que nous avons fait ici aujourd'hui n'est certainement pas un exemple à suivre, mais seulement un aperçu des possibilités et des techniques par lesquelles vous pouvez organiser une interaction vraiment modulaire entre les composants, en évitant un minimum d'outils. <br><br>  Vous pouvez trouver le code fini pour la référence dans le même référentiel, dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">brunch des événements</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461153/">https://habr.com/ru/post/fr461153/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461143/index.html">Sur les problèmes actuels de conception de jeux et les moyens de les résoudre. Vue de dessous</a></li>
<li><a href="../fr461145/index.html">Que doit diriger une équipe: rôles, responsabilités et compétences</a></li>
<li><a href="../fr461147/index.html">Comment économiser 64 heures en combinant des clés dans PowerPoint</a></li>
<li><a href="../fr461149/index.html">Migration sans entrave de MongoDB vers Kubernetes</a></li>
<li><a href="../fr461151/index.html">De l'idée à la production - Développement du projet IoT</a></li>
<li><a href="../fr461155/index.html">Charity Cloud: Guide de migration</a></li>
<li><a href="../fr461157/index.html">Ce que Feedback Assistant offrira - une plate-forme de développeur qui remplacera Bug Reporter</a></li>
<li><a href="../fr461159/index.html">Ivideon Bridge: comment connecter les anciens systèmes de vidéosurveillance au cloud</a></li>
<li><a href="../fr461161/index.html">Délégué aux préférences Android</a></li>
<li><a href="../fr461163/index.html">Qu'est-ce qui relie le paradoxe de l'anniversaire et la vulnérabilité des signatures électroniques?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>