<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßö üî∂ üê∫ Erstellen Sie die Azure DevOps-Erweiterung üë©üèº‚Äçüç≥ üßòüèº ü§≤üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir haben ein Projekt mit einem ma√ügeschneiderten CI / CD-Prozess. Wenn der Entwickler die Aufgabe beendet und seine √Ñnderungen in "Develop \ qa" einf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen Sie die Azure DevOps-Erweiterung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/461389/"> Wir haben ein Projekt mit einem ma√ügeschneiderten CI / CD-Prozess.  Wenn der Entwickler die Aufgabe beendet und seine √Ñnderungen in "Develop \ qa" einf√ºgt, wird der Build automatisch gestartet, wodurch die neue Version der Anwendung in die Testumgebung gestellt wird.  In einer idealen Welt erf√§hrt der Tester automatisch, welche Aufgaben erledigt wurden und in welcher Umgebung sie bereitgestellt werden.  In diesem Fall wird der Workflow kontinuierlich, ununterbrochen und erfordert weniger Kommunikation, was von konzentrierter Arbeit ablenkt.  In der Praxis ist nicht alles so rosig. <br><br>  Und dann fragte mich eines Morgens der Teamleiter: "K√∂nnen Sie so etwas f√ºr TFS machen, damit das an den Build angeh√§ngte Tag nach dem Aufh√§ngen dieses Builds das angegebene Tag h√§ngt?" <br><br>  Ich habe beschlossen, meine Build \ Release-Aufgabe f√ºr die Aufgabe zu implementieren.  Dar√ºber hinaus befinden sich die Quellen aller Build-Aufgaben auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> , und alle Informationen sind verf√ºgbar. <br><br>  Unsere Aufgabe markiert die Farbe der Aufgabe, die abgeschlossen, aber nicht getestet wurde.  Dank dessen wird der Entwickler sofort bemerken, wenn er vergessen hat, das gew√ºnschte Tag zu setzen, und die Qualit√§tssicherung sieht sofort, was √ºberpr√ºft werden muss.  Dies visualisiert den Status von Aufgaben und beschleunigt die Arbeit am Projekt. <br><br>  In diesem Artikel werde ich √ºber die Implementierung der notwendigen Logik sprechen, Verpackung in Erweiterung.  Wenn Sie also daran interessiert sind, wie Sie ein solches Plugin erstellen k√∂nnen, sind Sie bei cat willkommen. <br><br>  F√ºr die Ungeduldigsten: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> und eine fertige Erweiterung auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Markt</a> . <br><br><img src="https://habrastorage.org/webt/pk/id/hb/pkidhbjiwp_hxtyri2tmrixkgf4.png"><br><a name="habracut"></a><br>  Azure DevOps bietet die M√∂glichkeit, Filter zu erstellen, mit denen Sie die Masken auf der Platine in verschiedenen Farben einf√§rben k√∂nnen. <br><br><img src="https://habrastorage.org/webt/eh/nu/lj/ehnuljwjrqsqh862boczyproajc.png"><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/z8/pe/aiz8pewcypvkamnobuhpgiavhpo.png"></div><br><br>  Wir interessieren uns f√ºr Aufgaben, die: <br><br><ul><li>  abgeschlossen </li><li>  in die Testumgebung gegossen </li><li>  noch nicht verifizierte Qualit√§tssicherung </li></ul><br>  F√ºr Elemente sind die Tags b und c am besten geeignet, aber das manuelle Festlegen ist widerlich, und jeder vergisst, dies zu tun.  Wir werden also eine Erweiterung schreiben, die sie nach der Bereitstellung automatisch anbringt. <br><br>  Daher ben√∂tigen wir den benutzerdefinierten Build \ Release-Schritt, um den Faktor Mensch zu reduzieren (der Entwickler hat vergessen, ein Tag einzuf√ºgen) und um die Qualit√§tssicherung zu unterst√ºtzen (Sie k√∂nnen sofort sehen, was √ºberpr√ºft werden muss). <br><br><h4>  Voraussetzungen </h4><br>  Um die Erweiterung zu entwickeln, ben√∂tigen wir: <br><br><ol><li>  Lieblings-IDE </li><li>  installiertes TypeScript + node.js + npm (jetzt habe ich die Versionen 3.5.1 \ 12.4 \ 6.9.0 installiert) </li><li>  tfx-cli - Bibliothek zur Verpackungserweiterung'a (npm i -g tfx-cli). </li></ol><br>  Beachten Sie das Vorhandensein des Flags -g <br><br>  Microsoft hat eine gute <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation,</a> in der sie ganz oben stehen und erkl√§ren, wie man eine Art Erweiterung erstellt.  Auf die gleiche Weise gibt es auch ein Dock zum Erstellen einer Build \ Release-Aufgabe. <br><br>  Meiner Meinung nach gibt es in beiden Artikeln Nachteile im Hinblick auf die Detaillierung oder Erl√§uterung bestimmter Punkte, daher werde ich mich auf sie verlassen und mich auf die Punkte konzentrieren, die mir in Wirklichkeit nicht ganz offensichtlich erschienen. <br><br>  Im Allgemeinen k√∂nnen Sie den Schritt build \ release in einer relativ gro√üen Anzahl von Sprachen schreiben.  Ich werde ein Beispiel f√ºr TypeScript geben. <br><br><h4>  Warum TypeScript? </h4><br>  Die allererste Version von Build Step'a wurde in PowerShell'e geschrieben, nur unser Team und einige Leute wussten davon.  Fast sofort wurden wir mit der Tatsache konfrontiert, dass es keine PowerShell gibt, wenn Sie versuchen, dem Build, der auf dem Docker-Build-Agenten ausgef√ºhrt wird, eine Aufgabe hinzuzuf√ºgen, und die Aufgabe einfach nicht funktioniert.  Dar√ºber hinaus traten von Zeit zu Zeit verschiedene Arten von Fehlern bei Personen auf, die PowerShell Kooky zugeschrieben wurden.  Daher die Schlussfolgerung - die L√∂sung sollte plattform√ºbergreifend sein. <br><br><h4>  Projektstruktur </h4><br><pre><code class="plaintext hljs">|--- README.md |--- images |---extension-icon.png |--- TaskFolder (     build\release step'a) |--- vss-extension.json ( )</code> </pre> <br>  Als n√§chstes m√ºssen wir die Bibliothek f√ºr die Implementierung von Build Step'a installieren <br><br><ol><li>  cd TaskFolder </li><li>  npm init </li><li>  npm install azure-pipelines-task-lib --save &amp;&amp; npm install @ types / node --save-dev &amp;&amp; npm install @ types / q --save-dev </li><li>  tsc --init </li></ol><br><h4>  Entwicklungserweiterung </h4><br>  Zun√§chst m√ºssen wir im TaskFolder die Datei task.json erstellen - dies ist die Manifestdatei f√ºr den Erstellungsschritt selbst.  Es enth√§lt Serviceinformationen (Version, Ersteller, Beschreibung), eine Umgebung zum Starten und Konfigurieren aller Eingaben, die wir in Zukunft auf dem Formular sehen werden. <br><br>  Ich schlage vor, seine Struktur in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> genauer zu untersuchen. <br>  In unserem Fall enth√§lt das Formular zwei Eingaben: das Tag, das wir den Arbeitselementen hinzuf√ºgen, und die Auswahl des Pipeline-Typs (Build oder Release). <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"pipelineType"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"pickList"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify type of pipeline"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"helpMarkDown"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify whether task is used for build or release"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"Build"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"options"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"Build"</span></span>: <span class="hljs-string"><span class="hljs-string">"Build"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Release"</span></span>: <span class="hljs-string"><span class="hljs-string">"Release"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"tagToAdd"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag to add to work items"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"helpMarkDown"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify a tag that will be added to work items"</span></span> } ]</code> </pre><br>  Mit Namen beziehen wir uns im folgenden Code auf den Wert jeder der Eingaben. <br>  Erstellen Sie eine index.ts in TaskFolder und schreiben Sie den ersten Code <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'azure-pipelines-task-lib/task'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); } } run();</code> </pre><br>  Es ist erw√§hnenswert, dass TFS √ºber eine sehr umfangreiche Dokumentation zur vorhandenen REST-API verf√ºgt. Im Moment m√ºssen wir jedoch nur Arbeitselemente an den Build anh√§ngen. <br><br>  Installieren Sie eine Bibliothek f√ºr die einfache Ausf√ºhrung von Abfragen <br><br><pre> <code class="plaintext hljs">npm install request --save &amp;&amp; npm install request-promise-native --save</code> </pre><br>  F√ºgen Sie es zu index.ts hinzu <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"request-promise-native"</span></span>;</code> </pre><br>  Wir implementieren die Funktion, die aus dem aktuellen Build die angeh√§ngten Workitems erh√§lt <br><br><h4>  Ein bisschen √ºber Autorisierung </h4><br>  Um auf die REST-API zugreifen zu k√∂nnen, ben√∂tigen wir accessToken <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> accessToken = tl.getEndpointAuthorization(<span class="hljs-string"><span class="hljs-string">'SystemVssConnection'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).parameters.AccessToken;</code> </pre><br>  Setzen Sie als N√§chstes die Header-Berechtigung auf "Bearer $ {accessToken}". <br><br>  Wir kehren zum Empfang von Workitems zur√ºck, die an den Build gebunden sind. <br><br>  Der Name des Url Azure DevOps-Servers und des TeamProject kann wie folgt aus den Umgebungsvariablen abgerufen werden <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> collectionUrl = process.env[<span class="hljs-string"><span class="hljs-string">"SYSTEM_TEAMFOUNDATIONCOLLECTIONURI"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> teamProject = process.env[<span class="hljs-string"><span class="hljs-string">"SYSTEM_TEAMPROJECT"</span></span>];</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWorkItemsFromBuild</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildId = process.env[<span class="hljs-string"><span class="hljs-string">"BUILD_BUILDID"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> uri = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${collectionUrl}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${teamProject}</span></span></span><span class="hljs-string">/_apis/build/builds/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${buildId}</span></span></span><span class="hljs-string">/workitems`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = createGetRequestOptions(uri); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.get(options); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.value; }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createGetRequestOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uri: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">uri</span></span>: uri, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${accessToken}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">"content-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">json</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options; }</code> </pre><br>  Als Antwort auf eine GET-Anfrage per URL <br><br><pre> <code class="plaintext hljs">${collectionUrl}/${teamProject}/_apis/build/builds/${buildId}/workitems</code> </pre> <br>  Wir bekommen diese Art von JSON <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"count"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"55402"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"59777"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/59777"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"60199"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/60199"</span></span> } ] }</code> </pre><br>  F√ºr jede URL k√∂nnen Sie √ºber dieselbe REST-API Daten zum Arbeitselement abrufen. <br><br>  Im Moment ist unsere Ausf√ºhrungsmethode wie folgt. <br><br>  Die Methode zum Abrufen von Workitems aus der Version ist nahezu identisch mit der bereits beschriebenen. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workItemsData = pipelineType === <span class="hljs-string"><span class="hljs-string">"Build"</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromBuild() : <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromRelease(); <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); }</code> </pre><br>  Der n√§chste Schritt besteht darin, den aktuellen Satz von Tags f√ºr jedes der empfangenen Arbeitselemente abzurufen und das von uns angegebene hinzuzuf√ºgen. <br><br>  F√ºgen wir die Ausf√ºhrungsmethode hinzu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workItemsData = pipelineType === <span class="hljs-string"><span class="hljs-string">"Build"</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromBuild() : <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromRelease(); workItemsData.forEach(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (workItem: any) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> addTagToWorkItem(workItem); }); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); } }</code> </pre> <br>  Betrachten wir das Hinzuf√ºgen eines Tags zu Arbeitselementen. <br><br>  Zuerst m√ºssen wir das Tag erhalten, das wir auf dem Formular angegeben haben. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tagFromInput = tl.getInput(<span class="hljs-string"><span class="hljs-string">'tagToAdd'</span></span>);</code> </pre><br>  Weil  2 Schritte zur√ºck haben wir URLs zur API jedes Arbeitselements erhalten, und mit ihrer Hilfe k√∂nnen wir einfach eine Liste der aktuellen Tags anfordern: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> uri = workItem.url + <span class="hljs-string"><span class="hljs-string">"?fields=System.Tags&amp;api-version=2.0"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getOptions = createGetRequestOptions(uri) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.get(getOptions);</code> </pre><br>  Als Antwort erhalten wir diesen JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">55402</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rev"</span></span>: <span class="hljs-number"><span class="hljs-number">85</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fields"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"System.Tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"added-to-prod-package; test-tag"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"_links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemUpdates"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/updates"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemRevisions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/revisions"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemHistory"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/history"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"html"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://..../web/wi.aspx?pcguid=e3c978d9-6ea1-406f-987d-5b03e24973a1&amp;id=55402"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemType"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../602fd27d-4e0d-4aec-82a0-dcf55c8eef73/_apis/wit/workItemTypes"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"fields"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/fields"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }</code> </pre><br>  Wir nehmen alle alten Tags und f√ºgen ihnen ein neues hinzu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentTags = result.fields[<span class="hljs-string"><span class="hljs-string">'System.Tags'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newTags = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentTags !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { newTags = currentTags + <span class="hljs-string"><span class="hljs-string">";"</span></span> + tagFromInput; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newTags = tagFromInput; }</code> </pre> <br>  Wir senden eine Patch-Anfrage an die Workitem-API: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> patchOptions = getPatchRequestOptions(uri, newTags); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.patch(patchOptions) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPatchRequestOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uri: string, newTags: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">uri</span></span>: uri, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${accessToken}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">"content-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json-patch+json"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"op"</span></span>: <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/fields/System.Tags"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: newTags }], <span class="hljs-attr"><span class="hljs-attr">json</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options }</code> </pre><br><h4>  Montage- und Verpackungserweiterung'a </h4><br>  F√ºr die Sch√∂nheit von allem, was passiert, schlage ich vor, in tsconfig.json zu compilerOptions hinzuzuf√ºgen <pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"outDir"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist"</span></span></code> </pre>  .  Wenn wir nun den Befehl <code>tsc</code> im TaskFolder ausf√ºhren, erhalten wir den Ordner dist, in dem sich index.js befindet, der zum endg√ºltigen Paket wechselt. <br><br>  Weil  Unsere index.js befindet sich im dist-Ordner und dann werden wir sie auch in das endg√ºltige Paket kopieren. Wir m√ºssen task.json ein wenig reparieren: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"execution"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Node"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"target"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span> } }</code> </pre> <br>  In vss-extension.json im Abschnitt "Dateien" m√ºssen Sie explizit angeben, was in das endg√ºltige Paket kopiert werden soll. <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/dist"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/dist"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/node_modules"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/node_modules"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/icon.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/icon.png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/task.json"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/task.json"</span></span> } ]</code> </pre><br>  Letzter Schritt - wir m√ºssen unsere Erweiterung packen. <br><br>  F√ºhren Sie dazu den folgenden Befehl aus: <br><br><pre> <code class="plaintext hljs"> tfx extension create --manifest-globs ./vss-extension.json</code> </pre> <br>  Nach der Ausf√ºhrung erhalten wir eine * .vsix-Datei, die in TFS weiter installiert wird. <br><br>  Die PS * .vsix-Datei ist im Wesentlichen ein gew√∂hnliches Archiv. Sie k√∂nnen sie beispielsweise einfach √ºber 7-zip √∂ffnen und feststellen, dass sich alles, was Sie ben√∂tigen, wirklich darin befindet. <br><br><h4>  F√ºgen Sie etwas Sch√∂nheit hinzu </h4><br>  Wenn Sie ein Image haben m√∂chten, wenn Sie Ihren Erstellungsschritt ausw√§hlen, w√§hrend Sie ihn der Pipeline hinzuf√ºgen, sollte diese Datei neben task.json und mit dem Namen icon.png abgelegt werden.  Sie m√ºssen keine √Ñnderungen an task.json selbst vornehmen. <br><br>  Sie k√∂nnen vss-extension.json einen Abschnitt hinzuf√ºgen: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/logo.png"</span></span> }</code> </pre> <br>  Dieses Bild wird in der Galerie der lokalen Erweiterungen angezeigt. <br><br><h4>  Erweiterung installieren </h4><br><ol><li>  Gehen Sie zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tfs_server_url / _gallery / manage</a> </li><li>  Klicken Sie auf Erweiterung hochladen </li><li>  Geben Sie den Pfad oder Drag'n'Drop an, um die zuvor empfangene * .vsix-Datei zu werfen </li><li>  W√§hlen Sie nach Abschluss der √úberpr√ºfung im Kontextmen√º der Erweiterung die Option Ansichtserweiterung aus. W√§hlen Sie auf der sich √∂ffnenden Seite die Sammlung aus, in der Sie sie installieren m√∂chten </li><li>  Nach dieser Erweiterung k√∂nnen Sie sie verwenden. </li></ol><br><h4>  Mit build step'a </h4><br><ol><li>  √ñffnen Sie die Pipeline, die Sie ben√∂tigen </li><li>  Gehen Sie, um build step'a hinzuzuf√ºgen </li><li>  Wir suchen eine Erweiterung <br><br><img src="https://habrastorage.org/webt/rx/c0/zm/rxc0zmf88g5xv535rdwop4xfkkc.png"><br></li><li>  Wir geben alle notwendigen Einstellungen an <br><br><img src="https://habrastorage.org/webt/hu/iv/cs/huivcsdfsc357aqcx7eiwrtbjiw.png"></li><li>  Genie√üe das Leben :) </li></ol><br><h4>  Fazit </h4><br>  In diesem Artikel habe ich gezeigt, wie ein Plug-In f√ºr Azure DevOps erstellt wird, mit dem die Aufgaben f√ºr die Version automatisch mit dem richtigen Tag versehen werden.  Kollegen haben es in die Pipeline integriert, die sowohl unter Windows- als auch unter Linux-Build-Agenten ausgef√ºhrt wird. <br><br>  Dank dieses Plugins ist es f√ºr uns einfacher geworden, mit Aufgaben zu arbeiten und kontinuierlich am Projekt zu arbeiten.  Entwickler lassen sich nicht mehr von fremden Dingen ablenken, und die Qualit√§tssicherung lernt schnell neue Testaufgaben kennen. <br><br>  Ich erinnere mich noch einmal an den Download- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> <br><br>  Wir freuen uns auf Feedback und Vorschl√§ge zur √úberarbeitung :) <br><br><h5>  PS </h5><br>  Es gibt auch eine Idee, die M√∂glichkeit hinzuzuf√ºgen, die angegebenen Tags in das Plugin zu entfernen.  Wenn der Tester einen Fehler gefunden hat und Sie die Aufgabe erneut bereitstellen m√ºssen, k√∂nnen Sie die "Verified" -Tags entfernen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de461389/">https://habr.com/ru/post/de461389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de461373/index.html">GoLand 2019.2: Unterst√ºtzung f√ºr Funktionsaufrufe beim Debuggen, verbesserte Farbschemata, benutzerdefinierte Postfix-Vervollst√§ndigung</a></li>
<li><a href="../de461379/index.html">Museum DataArt. US Robotics Modems</a></li>
<li><a href="../de461381/index.html">Anonymit√§t ist eine Illusion. Anhand von Daten aus anonymisierten Datens√§tzen k√∂nnen Sie reale Personen identifizieren</a></li>
<li><a href="../de461385/index.html">Wein und Ratten: die Verwendung von Resveratrol zur Wiederherstellung der Muskeln unter der Schwerkraft des Mars</a></li>
<li><a href="../de461387/index.html">Von Klassik und Moderne bis hin zu Fantasy und Steampunk - was Systemadministratoren lesen</a></li>
<li><a href="../de461395/index.html">Element Fraktal</a></li>
<li><a href="../de461399/index.html">Eine unerwartete Reihenfolge zum Initialisieren geerbter Klassen in JavaScript</a></li>
<li><a href="../de461401/index.html">Was bist du, Event Loop? Oder wie die Ereignisschleife im Chrome-Browser funktioniert</a></li>
<li><a href="../de461403/index.html">Wie schreibe ich Musik mit OOP</a></li>
<li><a href="../de461405/index.html">Wie ich CFA Level 1 genommen habe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>