<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë£ üìè üå®Ô∏è C√≥mo migrar a la nube en dos horas gracias a Kubernetes y la automatizaci√≥n ‚ú°Ô∏è üßëüèæ‚Äçü§ù‚Äçüßëüèæ üì•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="URUS prob√≥ Kubernetes en diferentes formas: una implementaci√≥n independiente de metal desnudo en Google Cloud, y luego movi√≥ su plataforma a Mail.ru C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo migrar a la nube en dos horas gracias a Kubernetes y la automatizaci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/467163/"><img src="https://habrastorage.org/webt/ms/rd/xs/msrdxsvvp0ml1objxiaw2lfb1b4.jpeg"><br><br>  URUS prob√≥ Kubernetes en diferentes formas: una implementaci√≥n independiente de metal desnudo en Google Cloud, y luego movi√≥ su plataforma a Mail.ru Cloud Solutions (MCS).  Igor Shishkin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">t3ran</a> ), administrador s√©nior de sistemas de URUS, le dice a Igor Shishkin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">t3ran</a> ), administrador senior de sistemas de URUS, c√≥mo elegir un nuevo proveedor de la nube y c√≥mo lograr migrar a √©l en dos horas r√©cord <br><a name="habracut"></a><br><h2>  ¬øQu√© hace Urus? </h2><br>  Hay muchas formas de mejorar la calidad del medio ambiente urbano, y una de ellas es hacer que sea ecol√≥gico.  Esto es exactamente en lo que est√° trabajando la empresa URUS - Smart Digital Services.  Implementa soluciones que ayudan a las empresas a monitorear importantes indicadores ambientales y reducir los impactos ambientales negativos.  Los sensores recopilan datos sobre la composici√≥n del aire, el nivel de ruido y otros par√°metros, y luego los env√≠an a una √∫nica plataforma "Urus-Ekomon" para su an√°lisis y preparaci√≥n de recomendaciones. <br><br><h2>  ¬øC√≥mo es el trabajo de "Urus" dentro </h2><br>  Un cliente t√≠pico de URUS es una empresa ubicada en o cerca de un √°rea residencial.  Puede ser una f√°brica, puerto, dep√≥sito ferroviario o cualquier otra instalaci√≥n.  Si nuestro cliente ya recibi√≥ una advertencia, fue multado por contaminaci√≥n ambiental, o quiere hacer menos ruido, reducir la cantidad de emisiones nocivas, se dirige a nosotros y ya le ofrecemos una soluci√≥n llave en mano para el monitoreo ambiental. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3c/j3/-c/3cj3-cvukgqpsktqzuiehm_2ioo.jpeg"></div><br>  <i>Un gr√°fico de monitoreo de concentraci√≥n de H2S muestra las emisiones nocturnas regulares de una instalaci√≥n cercana</i> <br><br>  Los dispositivos que utilizamos en URUS contienen varios sensores que recopilan informaci√≥n sobre el contenido de ciertos gases, niveles de ruido y otros datos para evaluar la situaci√≥n ambiental.  El n√∫mero exacto de sensores siempre est√° determinado por una tarea espec√≠fica. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u1/um/w4/u1umw4ptjdkbc8zymwy2qimgwr0.jpeg"></div><br>  Dependiendo de la medida espec√≠fica, los dispositivos con sensores pueden ubicarse en las paredes de edificios, postes y otros lugares arbitrarios.  Cada uno de estos dispositivos recopila informaci√≥n, la agrega y la env√≠a a la puerta de enlace de recepci√≥n de datos.  All√≠ guardamos datos para almacenamiento a largo plazo y preprocesos para an√°lisis posteriores.  El ejemplo m√°s simple de lo que obtenemos despu√©s del an√°lisis es un √≠ndice de calidad del aire, tambi√©n conocido como AQI. <br><br>  Al mismo tiempo, muchos otros servicios funcionan en nuestra plataforma, pero b√°sicamente son de naturaleza de servicio.  Por ejemplo, el servicio de notificaci√≥n env√≠a notificaciones a los clientes si alguno de los par√°metros monitoreados (por ejemplo, el contenido de CO <sub>2</sub> ) ha excedido el valor permitido. <br><br><h2>  ¬øC√≥mo almacenamos los datos?  La historia de Kubernetes en metal desnudo </h2><br>  El proyecto de monitoreo ecol√≥gico URUS tiene varios almacenes de datos.  En una de ellas, tenemos los datos "en bruto": lo que recibimos directamente de los propios dispositivos.  Este almacenamiento es una cinta "magn√©tica", como en los casetes antiguos, con un historial de todos los indicadores.  El segundo tipo de almacenamiento se usa para datos preprocesados: datos de dispositivos enriquecidos con metadatos sobre conexiones de sensores y lecturas de dispositivos, afiliaci√≥n con organizaciones, ubicaciones, etc. Esta informaci√≥n le permite evaluar din√°micamente c√≥mo cambi√≥ un indicador en particular durante un cierto per√≠odo de tiempo .  Utilizamos el almacenamiento de datos en bruto, incluso como copia de seguridad y para restaurar datos preprocesados, en caso de necesidad. <br><br>  Cuando busc√°bamos formas de resolver el problema de almacenamiento hace varios a√±os, ten√≠amos dos opciones para elegir una plataforma: Kubernetes y OpenStack.  Pero dado que este √∫ltimo se ve bastante monstruoso (solo mira su arquitectura para ver esto), entonces nos decidimos por Kubernetes.  Otro argumento a su favor fue el control de software relativamente simple, la capacidad de cortar de manera m√°s flexible incluso los nodos de hierro en recursos. <br><br>  Paralelamente al desarrollo de Kubernetes, tambi√©n estudiamos formas de almacenar datos, mientras guardamos todos nuestros almacenamientos en Kubernetes en nuestro hardware, recibimos una excelente experiencia.  Todo lo que hab√≠amos vivido en Kubernetes: almacenamiento completo, sistema de monitoreo, CI / CD.  Kubernetes se ha convertido en nuestra plataforma todo en uno. <br><br>  Pero quer√≠amos trabajar con Kubernetes como un servicio y no involucrarnos en su apoyo y desarrollo.  Adem√°s, no nos gust√≥ cu√°nto nos cost√≥ su contenido en metal desnudo, ¬°y el desarrollo siempre fue necesario para nosotros!  Por ejemplo, una de las primeras tareas fue integrar los controladores Kubernetes Ingress en la infraestructura de red de nuestra organizaci√≥n.  Esta es una tarea engorrosa, especialmente si imagina que en ese momento no hab√≠a nada listo para la gesti√≥n program√°tica de recursos como registros DNS o asignaci√≥n de IP.  M√°s tarde comenzamos a experimentar con un almac√©n de datos externo.  No llegamos a la implementaci√≥n del controlador de PVC, pero incluso entonces qued√≥ claro que este era un gran campo de trabajo, para lo cual era necesario seleccionar especialistas individuales. <br><br><h2>  Migraci√≥n a la soluci√≥n temporal de Google Cloud Platform </h2><br>  Nos dimos cuenta de que esto no pod√≠a continuar m√°s y transferimos nuestros datos de metal desnudo a Google Cloud Platform.  De hecho, para la compa√±√≠a rusa no hab√≠a muchas opciones interesantes: adem√°s de Google Cloud Platform, solo Amazon ofrec√≠a un servicio similar, pero a√∫n as√≠ nos decidimos por una soluci√≥n de Google.  Entonces nos pareci√≥ econ√≥micamente m√°s rentable, m√°s cercano a Upstream, sin mencionar el hecho de que Google es una especie de PoC Kubernetes en producci√≥n. <br><br>  El primer problema grave apareci√≥ en el horizonte en paralelo con el crecimiento de nuestra base de clientes.  Cuando fue necesario para nosotros almacenar datos personales, nos enfrentamos a una elecci√≥n: o trabajamos con Google y violamos las leyes rusas, o estamos buscando una alternativa en la Federaci√≥n Rusa.  La elecci√≥n, en general, era predecible.  :) <br><br><h2>  C√≥mo vimos el servicio en la nube perfecto </h2><br>  Al comienzo de la b√∫squeda, ya sab√≠amos lo que quer√≠amos obtener del futuro proveedor de la nube.  Qu√© servicio buscamos: <br><br><ul><li>  <b>R√°pido y flexible</b> .  Para que podamos agregar r√°pidamente un nuevo nodo o implementar algo en cualquier momento. <br></li><li>  <b>Barato</b>  Est√°bamos muy preocupados por el problema financiero, ya que ten√≠amos recursos limitados.  Ya sab√≠amos que quer√≠amos trabajar con Kubernetes, y ahora la tarea era minimizar su costo para aumentar o al menos mantener la efectividad del uso de esta soluci√≥n. <br></li><li>  <b>Automatizado</b> .  Planeamos trabajar con el servicio a trav√©s de la API, sin gerentes y llamadas telef√≥nicas o situaciones en las que necesita levantar manualmente varias decenas de nodos en modo de emergencia.  Como la mayor√≠a de nuestros procesos est√°n automatizados, esper√°bamos lo mismo de un servicio en la nube. <br></li><li>  <b>Con servidores en la Federaci√≥n Rusa</b> .  Por supuesto, planeamos cumplir con la ley rusa y ese mismo 152-FZ. <br></li></ul><br>  En ese momento, los proveedores de Kubernetes aaS eran pocos en Rusia, mientras que elegir un proveedor, era importante para nosotros no comprometer nuestras prioridades.  El equipo de Mail.ru Cloud Solutions, con el que hemos comenzado a trabajar y seguimos trabajando, nos ha proporcionado un servicio totalmente automatizado con soporte API y un panel de control conveniente en el que est√° Horizon, con el que podr√≠amos aumentar r√°pidamente un n√∫mero arbitrario de nodos. <br><br><h2>  C√≥mo logramos migrar a MCS en dos horas </h2><br>  En tales reubicaciones, muchas empresas enfrentan dificultades y fracasos, pero en nuestro caso no lo fueron.  Tuvimos suerte: como ya est√°bamos trabajando en Kubernetes antes del inicio de la migraci√≥n, solo arreglamos tres archivos y lanzamos nuestros servicios en una nueva plataforma en la nube, en MCS.  Perm√≠tame recordarle que para ese momento finalmente hab√≠amos dejado el metal desnudo y viv√≠amos en Google Cloud Platform.  Debido a que el movimiento en s√≠ no tom√≥ m√°s de dos horas, m√°s un poco m√°s de tiempo (aproximadamente una hora) para copiar datos de nuestros dispositivos.  Luego, ya usamos Spinnaker (un servicio de CD de m√∫ltiples nubes para proporcionar Entrega Continua).  Tambi√©n lo agregamos r√°pidamente al nuevo cl√∫ster y continuamos trabajando como de costumbre. <br><br>  Gracias a la automatizaci√≥n de los procesos de desarrollo y CI / CD Kubernetes en URUS est√° ocupado por un especialista (y este soy yo).  En alg√∫n momento, otro administrador del sistema trabaj√≥ conmigo, pero luego result√≥ que ya hab√≠amos automatizado toda la rutina principal, y desde el lado de nuestro producto principal hab√≠a m√°s y m√°s tareas y ten√≠a sentido dirigir recursos a esto. <br><br>  Recibimos del proveedor de la nube lo que esper√°bamos, ya que comenzamos la cooperaci√≥n sin ilusiones.  Si hubo incidentes, en su mayor√≠a t√©cnicos, que pueden explicarse f√°cilmente por la relativa frescura del servicio.  Lo principal es que el equipo de MCS elimina r√°pidamente fallas y responde r√°pidamente a las preguntas en mensajer√≠a instant√°nea. <br><br>  Si comparamos la experiencia con Google Cloud Platform, en su caso ni siquiera sab√≠a d√≥nde est√° el bot√≥n de comentarios, ya que simplemente no era necesario.  Y si sucedi√≥ alg√∫n problema, Google mismo envi√≥ notificaciones unilateralmente.  Pero en el caso de MCS, una gran ventaja, creo que est√°n lo m√°s cerca posible de los clientes rusos, tanto geogr√°fica como mentalmente. <br><br><h2>  Como vemos trabajando con nubes en el futuro </h2><br>  Ahora nuestro trabajo est√° estrechamente relacionado con Kubernetes, y nos satisface completamente en t√©rminos de tareas de infraestructura.  Por lo tanto, no planeamos migrar desde alg√∫n lugar, aunque constantemente estamos introduciendo nuevas pr√°cticas y servicios para simplificar las tareas rutinarias y automatizar otras nuevas, aumentar la estabilidad y la confiabilidad de los servicios ... Ahora estamos lanzando el servicio Chaos Monkey (espec√≠ficamente, estamos usando chaoskube, pero esto no cambia el concepto: ), que se cre√≥ originalmente en Netflix.  Chaos Monkey hace una cosa simple: en un momento arbitrario elimina un bajo arbitrario en Kubernetes.  Esto es necesario para que nuestro servicio viva normalmente con el n√∫mero de instancias n - 1, por lo que nos acostumbramos a estar preparados para cualquier mal funcionamiento. <br><br>  Ahora veo el uso de soluciones de terceros, las mismas plataformas en la nube, como la √∫nica adecuada para empresas j√≥venes.  Por lo general, al comienzo del viaje tienen recursos limitados, tanto humanos como financieros, y construir y mantener su propia nube o centro de datos es demasiado costoso y requiere mucho tiempo.  Los proveedores de la nube pueden minimizar estos costos, pueden obtener r√°pidamente los recursos necesarios para que los servicios funcionen aqu√≠ y ahora, y pagar estos recursos de hecho.  En cuanto a la compa√±√≠a Urus, por ahora seguiremos siendo fieles a Kubernetes en la nube.  Pero qui√©n sabe, tal vez tendremos que expandirnos geogr√°ficamente o implementar soluciones basadas en algunos equipos espec√≠ficos.  O tal vez la cantidad de recursos consumidos justifique sus propios Kubernetes en metal desnudo, como en los viejos tiempos.  :) <br><br><h2>  Lo que aprendimos de nuestra experiencia con los servicios en la nube </h2><br>  Comenzamos a usar Kubernetes en metal desnudo, e incluso all√≠ fue bueno a su manera.  Pero sus puntos fuertes se revelaron precisamente como un componente aaS en la nube.  Si establece una meta y automatiza todo lo m√°s posible, podr√° evitar el bloqueo del proveedor y moverse entre los proveedores de la nube tomar√° un par de horas, y las c√©lulas nerviosas permanecer√°n con nosotros.  Podemos asesorar a otras empresas: si desea iniciar su servicio (en la nube), con recursos limitados y velocidad m√°xima para el desarrollo, comience ahora alquilando recursos en la nube y construya su centro de datos despu√©s de que Forbes escriba sobre usted. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467163/">https://habr.com/ru/post/467163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467149/index.html">Antig√ºedades: 1992 en la prensa inform√°tica</a></li>
<li><a href="../467151/index.html">Manejo de objeciones: el an√°lisis est√°tico ocupar√° parte del tiempo de trabajo</a></li>
<li><a href="../467153/index.html">Trabajar con objeciones: el an√°lisis est√°tico tomar√° parte del tiempo de trabajo</a></li>
<li><a href="../467155/index.html">Mejores pr√°cticas para contenedores de Kubernetes: controles de salud</a></li>
<li><a href="../467161/index.html">Aplicaci√≥n web en Kotlin + Spring Boot + Vue.js</a></li>
<li><a href="../467165/index.html">Siguiendo los pasos del movimiento ruso Scala. Parte 2</a></li>
<li><a href="../467169/index.html">Lecciones aprendidas de las pruebas M√°s de 200,000 l√≠neas de C√≥digo de Infraestructura</a></li>
<li><a href="../467171/index.html">Lo que aprend√≠ al probar 200,000 l√≠neas de c√≥digo de infraestructura</a></li>
<li><a href="../467173/index.html">Arquitecto implementaci√≥n segura de ERP</a></li>
<li><a href="../467175/index.html">Piensa dos veces antes de usar motores de juego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>