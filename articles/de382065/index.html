<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👰🏿 🎏 👩🏾‍🔬 Auslaufschutzsystem 💻 🤳🏻 🌛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich möchte meine Erfahrungen bei der Erstellung eines Geräts teilen, dessen Implementierung nicht nur interessant war, sondern auch von Vorteil sein k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Auslaufschutzsystem</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382065/"><img src="https://habrastorage.org/files/055/477/b38/055477b3811b49e2b9123bdccca872f1.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte meine Erfahrungen bei der Erstellung eines Geräts teilen, dessen Implementierung nicht nur interessant war, sondern auch von Vorteil sein könnte. </font><font style="vertical-align: inherit;">Vielleicht wird jemand sagen, dass es möglich war, etwas Einfacheres zu tun, aber das ist nicht unser Weg ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles begann damit, dass nach der Reparatur der Wohnung ein potenzielles Problem entdeckt wurde. </font><font style="vertical-align: inherit;">Im Falle eines Lecks irgendwo funktioniert es nicht, ohne bestimmte körperliche Anstrengung und Geschicklichkeit zu den Kränen zu gelangen, um die Wohnung zu betreten, da die Luke, die die Krane schließt, nicht sehr gut installiert ist. </font><font style="vertical-align: inherit;">Daher funktioniert es im dringenden Fall (Unfall) nicht, die Wasserhähne schnell abzuschalten. </font><font style="vertical-align: inherit;">Es war notwendig, etwas damit zu tun, und es erschien eine Lösung - um die Gelegenheit aus der Ferne zu realisieren, d.h. </font><font style="vertical-align: inherit;">Unterbrechen Sie die Wasserversorgung, ohne die Luke zu öffnen. </font><font style="vertical-align: inherit;">Und als Bonus, um alles andere zu implementieren, dem die Elektronik vertrauen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht das Gerät aus. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9fa/6a7/137/9fa6a713753a403ab27be8f6c4ffe0da.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hauptmerkmale:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie die Wasserversorgung bei Undichtigkeiten selbständig ab</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schalten Sie die Wasserversorgung "im manuellen" Modus aus - auf der Vorderseite befinden sich ein "roter Knopf" und ein Kippschalter mit zwei Positionen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zählerstände auf dem eigenen Display anzeigen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeigen Sie andere nützliche Informationen auf dem Display an</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es kann nicht, aber Pläne:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeiten Sie mit einer Backup-Stromquelle. </font><font style="vertical-align: inherit;">Jetzt im Falle eines Stromausfalls - das Gerät ist unbrauchbar</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeiten Sie mit drahtlosen Lecksensoren</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reinigen Sie die Wasserhähne selbst. </font><font style="vertical-align: inherit;">Um nicht „sauer“ zu werden, ist es ratsam, sie einmal im Monat zu öffnen / schließen</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benachrichtigen Sie über Ereignisse auf einem Smartphone und lassen Sie sich von "air" steuern.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es kann nicht (und egal wie sehr notwendig):</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Haben Sie mehrere Kanäle zum Lesen verschiedener verdrahteter Lecksensoren, jetzt sind alle Sensoren (5 Stk.) Parallel geschaltet</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Krane individuell verwalten. </font><font style="vertical-align: inherit;">Es gibt zwei davon (eine bei heißem, die zweite bei kaltem Wasser) und sie sind parallel geschaltet</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bruchkontrolle an Sensoren</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Folgende ist eine Beschreibung der Komponenten und ihres Zwecks (Preise ab Juli 2015).</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    1/2 " DN15 DC5V</a> ( CR02,  ,     ) — 3080   </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Maple Mini (  stm32f103c8t6)</a>    — 233 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SPI TFT LCD  ILI9341</a> — 302 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Ds3231 + AT24C32</a>   ,  ,   — 4  EEPROM — 38 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ULN2003 DIP-16</a> —    — 123 /10  ( )</li>
<li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> — 239 /10  (  )</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>     — 164 /5  ( )</li>
<li>  ,  : ,  (    ), ,  , </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich brauchte ich auch einen Programmierer / Emulator, ich benutzte diesen: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARM-Emulator, unterstützt ARM7, ARM9, ARM11, Cortex-M3-Kern, ADS, IAR, STM32, JTAG-Schnittstelle, doppelt gepufferte V8-Version</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Von den Merkmalen kann erwähnt werden, dass </font><font style="vertical-align: inherit;">ich </font><font style="vertical-align: inherit;">zusätzlich zu den Standarddrähten für die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SW-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Programmierung die Stromversorgungsspannung vom programmierbaren Chip anlegen musste, in meinem Fall 3,3 Volt. </font><font style="vertical-align: inherit;">Der Programmierer muss die Spannungspegel der logischen Werte verstehen. </font><font style="vertical-align: inherit;">Ohne dies wollte der programmierbare Chip nicht erkannt werden. </font><font style="vertical-align: inherit;">Dieser Programmierer kann auch ein programmierbares Gerät mit Strom versorgen. Hierfür ist ein Pin vorgesehen. Die Spannung wird vom Dienstprogramm JLink.exe ein- und ausgeschaltet.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mehr zu Eisen</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikrocontroller</font></font></h3><img src="https://habrastorage.org/files/73d/47b/3b3/73d47b3b3ca9476dafadf503b3162931.jpg" width="300" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gehirn des gesamten Systems ist ein 32-Bit-Mikrocontroller von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST, der</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von chinesischen Arbeitern in chinesischen Fabriken sauber auf eine Platine gelötet wurde, die mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaf Maple Mini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> „kompatibel“ ist </font><font style="vertical-align: inherit;">.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Über Blattahorn Mini</font></font></b><div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie bemerkt  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">eta4ever</a> <blockquote>  ,  </blockquote>        «»     ,    …<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hat 48 Schlussfolgerungen. </font><font style="vertical-align: inherit;">Der Kern läuft mit 72 MHz, hat SRAM - 20KB und Flash - 128KB integriert. </font><font style="vertical-align: inherit;">Weitere Details </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Solche Parameter fördern definitiv die Verwendung von Werkzeugen und Werkzeugen auf hoher Ebene, d.h. </font><font style="vertical-align: inherit;">Dies sind </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeRTOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , grafische Farbanzeige, C ++ usw. </font><font style="vertical-align: inherit;">(und nicht zwei LEDs und Assembler). </font><font style="vertical-align: inherit;">Verweigern Sie sich im Allgemeinen nichts ... außer C ++, aber dies ist kein Chipproblem.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum?</font></font></b><div class="spoiler_text">       C++ ,  ,     ,     . ,     C++      ,   ,  ,   , ..      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">STM32CubeMX</a>      ,   FreeRTOS.     ,      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unter Verwendung der Schlussfolgerungen des Mikrocontrollers. </font><font style="vertical-align: inherit;">Von hier aus können Sie erraten, womit verbunden ist.</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/173/70e/067/17370e0676c64b75b9ddf7ec11a1ae29.png"><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anzeige</font></font></h3><br>
<img src="https://habrastorage.org/files/c09/361/5b6/c093615b66774fb7969845db6584ee70.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Modul mit einem TFT-Display von 320 x 240 Pixel, das auf einem mit ILI9341 kompatiblen Controller aufgebaut ist, ist für die Anzeige von Informationen verantwortlich und arbeitet mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bei der maximal möglichen Frequenz für dieses Bundle (18 MHz). </font><font style="vertical-align: inherit;">SPI ist nur in einer Richtung mit dem Mikrocontroller verbunden, der Ausgang zum Lesen von Daten vom Anzeigemodul bleibt in der Luft hängen, weil </font><font style="vertical-align: inherit;">Ich habe mir diese Funktionalität nicht ausgedacht, sie aber auf den freien Beinen des Mikrocontrollers gespeichert. </font><font style="vertical-align: inherit;">Die Datenübertragung funktioniert mit </font></font><abbr title="DMA oder Direct Memory Access - Direktspeicherzugriffstechnologie unter Umgehung des Zentralprozessors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMA</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Anschluss zum Anschließen einer SD-Karte ist auf der Rückseite mit dem Modul verlötet. Ich habe die Arbeit mit einer SD-Karte nicht getestet und der Anschluss ist an diesem Projekt nicht beteiligt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTC- und EEPROM-Modul</font></font></h3><br>
<img src="https://habrastorage.org/files/527/406/51e/52740651ee344478a84c0a15f43c3c51.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Uhr auf dem Modul ist mit einem DS3231-Chip implementiert. Ich habe keine besonderen Probleme verursacht, die einzige Unannehmlichkeit war, dass alle Werte (Datum, Uhrzeit) in Registern im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCD-Format</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gespeichert sind </font><font style="vertical-align: inherit;">, wenn zwei Dezimalstellen in einem Byte wiedergegeben werden (in den oberen vier Bits - die höchstwertige Ziffer, in der unteren - der niedrigstwertigen Ziffer). . Beispielsweise wird der Wert "38 Minuten" als Dezimalwert 56 gespeichert (dies ist "38" in der hexadezimalen Notation). Es konnte nicht herausgefunden werden, ob es möglich ist, zum Binärformat zu wechseln.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Modul verfügt über eine eigene Batterie, sodass Sie bei jedem Stromausfall weder Uhrzeit noch Datum einstellen müssen. Außerdem ist die AT24C32-Mikroschaltung mit bis zu 32768 EEPROM-Bits auf die Modulplatine gelötet! Einfach ausgedrückt sind es 4 KB nichtflüchtiger Speicher. Sowohl die Uhr als auch der Speicher befinden sich auf demselben I2C-Bus. Im Moment wird der Speicher nur zum Speichern von Geräteeinstellungen, des aktuellen Werts der Zählerwerte und etwas anderem verwendet. schließlich belegt ... 25 Bytes. Später wird es verwendet, um Protokolle verschiedener Ereignisse und möglicherweise Verbrauchsstatistiken zu führen (ich weiß nicht warum, aber es wird Gelegenheit geben, die Anzeige von Grafiken zu programmieren).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusätzlich zu den I2C-Buskontakten und der Stromversorgung befinden sich zwei weitere auf der Platine. </font><font style="vertical-align: inherit;">"SQW" ist das Signal vom Wecker, das über die Register programmiert werden kann, und "32K" ist die vom DS3231 für andere Geräte erzeugte Frequenz. </font><font style="vertical-align: inherit;">Dieses Projekt gilt nicht.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modul mit Feuchtigkeitssensor</font></font></h3><br>
<img src="https://habrastorage.org/files/6a9/b19/bc1/6a9b19bc17f64a42bc008a3c5a3fe058.jpg" align="right" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird als Puffer zwischen der Außenwelt und dem Mikrocontroller verwendet. </font><font style="vertical-align: inherit;">Die Drähte zu den Sonden haben insgesamt eine Länge von etwa 10 Metern ohne Schirm. </font><font style="vertical-align: inherit;">Herkömmliche Zweidraht-Telefonkabel. </font><font style="vertical-align: inherit;">Im Falle eines statischen Treffers hoffe ich, dass nur dieses Modul stirbt, nicht aber der Mikrocontroller. </font><font style="vertical-align: inherit;">Es ist in der Lage, den Widerstand zwischen zwei Elektroden zu messen und diese Informationen in analoger Form (Spannung von 0 bis Versorgungsspannung) und in digitaler Form (0/1, das Modul verfügt über einen variablen Widerstand, der an die Betriebsgrenze angepasst werden kann) anzugeben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gab kleinere Probleme mit diesem Modul. Beim Anlegen und Entfernen der Versorgungsspannung signalisierte das Modul am Digitalausgang eine Auslösung. Dies konnte auch daran gesehen werden, dass die LED für den Bruchteil einer Sekunde blinkte (auf der Modulplatine ist parallel zum Digitalausgang eine LED installiert). Der Mikrocontroller konnte ein anormales Signal lesen, als die Systemstromversorgung angelegt / zurückgesetzt wurde (Problem Nr. 1). Die Lösung wurde implementiert, indem kurze Betriebsimpulse in Erwartung eines für eine Weile festgelegten Zustands übersprungen wurden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der variable Widerstand hat einen sehr kleinen Einstellwinkel, bei dem ich die Grenze zwischen dem Fehlen falsch positiver Ergebnisse und einer guten Empfindlichkeit nicht finden konnte (Problem Nr. 2). Es wurde später implementiert, das analoge Signal durch den ADC-Mikrocontroller zu lesen. Gleichzeitig wurde es möglich, das Antwortlimit in den Geräteeinstellungen als Parameter festzulegen. Die Möglichkeit, die Antwortstufe anzupassen, wird jetzt als überflüssig angesehen, und es ist wahrscheinlich besser, den Grenzwert fest zu codieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde festgestellt, dass das Modul nach einigen Minuten Betrieb (Aufwärmen?) Plötzlich einen spontanen Betrieb signalisierte (Problem Nummer 3, wie viele davon ?!).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An der Grenze abnormaler Reaktionen nahm die Intensität des LED-Glühens (auf dem Modul) allmählich zu oder ab, als ob es von einem PWM-Generator gesteuert würde. Es ist klar, dass dies Rauschen und Hochfrequenz ist, dasselbe könnte am „digitalen“ Ausgang des Moduls erwartet werden (Problem Nr. 4) ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde klarstellen, dass all diese Probleme behoben wurden, als das Lesen des analogen Signals vom Modul implementiert wurde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonden (Teile von Sensoren, die sich im Falle eines Unfalls direkt an Orten befinden, an denen sich Wasser ansammelt) werden aus improvisierten Mitteln hergestellt. Dies ist Zinn (Stahl) und eine kleine runde Anschlussdose, die mechanisch auf den gewünschten Typ modifiziert und mit Drähten eingelötet ist. Wenn Wasser zwischen die Elektrodenpaare eintritt, nimmt der Widerstand ab und wird von der Steuerung als „Leckage“ angesehen.</font></font><br>
<br>
<img src="https://habrastorage.org/files/bc7/366/3ad/bc73663ad6f048079b0ca835a353a0b6.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Labortests haben gezeigt, dass das Produkt seine Funktion gut erfüllt und kein schwaches Glied im System ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ernährung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das gesamte System funktioniert ab dem Aufladen des Telefons - 5 Volt, 2A (hier mit Rand). </font><font style="vertical-align: inherit;">Auf der Maple Mini-Platine ist ein Spannungsregler von 3,3 Volt installiert, die Eingangsspannung kann bis zu 12 Volt betragen, die Eigenschaften des Stabilisators erlauben es, aber eine so große Spannung ist nicht bequem zu verwenden, mehr dazu weiter unten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit einem Stabilisator werden 3,3 Volt auch an die Leistung der RTC-, TFT-Module und des Feuchtemessmoduls abgegeben. </font><font style="vertical-align: inherit;">Die Krane werden über die ULN2003AN-Leistungsschalterbaugruppe direkt von der Stromversorgung angeschlossen, d. H. </font><font style="vertical-align: inherit;">Arbeiten Sie ab 5 Volt abzüglich des Abfalls der Tasten. </font><font style="vertical-align: inherit;">ULN2003AN verwendet nur zwei der sieben Kanäle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich ist es ratsam, das Netzteil durch ein anderes mit einer etwas höheren Spannung zu ersetzen, weil Manchmal stoppt einer der Krane beim Schließen der Krane in einer fast extremen Position aufgrund des Betriebs seines eigenen Anhängers (zwei Teile sind im Ventilkörper installiert, um die extremen Positionen zu ermitteln) für den Bruchteil einer Sekunde, dann tritt ein „Rückprall“ auf (aufgrund des Spiels in den Zahnrädern des Getriebes) ), dann ein wiederholter Versuch, den Kugelhahn usw. festzuziehen, bis die Steuerung die Versorgungsspannung vom Servoantrieb entfernt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Verkäufer auf der Website hat Informationen, dass die Krane ab 5 Volt arbeiten sollen, in diesem Fall wird die Spannung weniger geliefert. </font><font style="vertical-align: inherit;">Die Software ist so konzipiert, dass zum Öffnen und Schließen der Abgriffe nur für eine bestimmte Zeit (6 Sekunden) Spannung zugeführt wird. Während dieser Zeit müssen die Abgriffe Zeit zum Öffnen oder Schließen haben. </font><font style="vertical-align: inherit;">Es ist anzumerken, dass dieser Effekt das unvollständige Schließen des Hahns nicht beeinflusst, da </font><font style="vertical-align: inherit;">Dieser Moment kommt, nachdem der Wasserhahn den Wasserfluss vollständig unterbrochen hat. </font><font style="vertical-align: inherit;">Es ist auch zu erwähnen, dass zu viel Spannung an den Servos (9 Volt für das Experiment angelegt) dazu führt, dass sie sich durch Trägheit weiter bewegen (nachdem der Endschalter ausgelöst wurde) und mit dem charakteristischen Geräusch eines Aufpralls gegen die Extremposition stoßen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servokugelhähne</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Absperrventile sehen zuverlässig aus, aber das elektronische Teil musste fertiggestellt werden. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b73/ca0/7bb/b73ca07bb94e48278a4de7c54d6056bb.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie sich den Kransteuerkreis ansehen, werden Sie feststellen, dass diese durch positive Spannung gesteuert werden. </font><font style="vertical-align: inherit;">Die allgemeinen "Minus" - und zwei Signalstrom "Plus" -Drähte, einer zum Schließen, der andere zum Öffnen. </font><font style="vertical-align: inherit;">ULN2003AN kann in diesem Modus jedoch nicht funktionieren. Wenn der Schlüssel geöffnet wird, wird der verwaltete Ausgang mit dem Minus verbunden. </font><font style="vertical-align: inherit;">Die Lösung besteht darin, die Steuerpolarität des Krans selbst zu ändern. </font><font style="vertical-align: inherit;">Dazu musste ich die Signale des "Trailers" austauschen, weil </font><font style="vertical-align: inherit;">Aufgrund einer Änderung der Polarität drehte sich der Elektromotor in die entgegengesetzte Richtung (im Vergleich zum Standardkreis), während die extremen Positionen jetzt in entgegengesetzte Richtungen weisen. </font><font style="vertical-align: inherit;">Als Ergebnis haben wir einen Kran mit einem gemeinsamen „Plus“ und zwei Kontroll- „Minuspunkten“. </font><font style="vertical-align: inherit;">Genau das, was benötigt wird!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kräne mit Servos unter "Kampf" -Bedingungen.</font></font><br>
<br>
<img src="https://habrastorage.org/files/7b0/9c1/7ae/7b09c17aebf74188a522f485fc6361fe.jpg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zählerstände</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich sind im Zähler selbst keine Daten gespeichert, die durch zwei von ihm entfernte Drähte gelesen werden könnten. </font><font style="vertical-align: inherit;">Dies ist nur eine Kette mit einem Reedschalter und einem Magneten, der sich auf einem rotierenden Laufrad befindet. </font><font style="vertical-align: inherit;">Messungen mit einem Multimeter zeigten keinen Widerstand oder keine elektrischen Kapazitäten im Stromkreis. </font><font style="vertical-align: inherit;">In meinen Zählern erfolgt der Kreislauf (mit anschließendem Öffnen) des Reedschalters mit einer Durchflussrate von einem Liter Wasser. </font><font style="vertical-align: inherit;">Irgendwo gab es Informationen über die Zähler, deren Signal alle 10 Liter gebildet wird. </font><font style="vertical-align: inherit;">Jene. </font><font style="vertical-align: inherit;">Sie sind anders. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Mikrocontroller muss diese Impulse lesen. </font><font style="vertical-align: inherit;">Die Benutzeroberfläche des Geräts liefert natürlich den Anfangswert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund bestehender Probleme: Ohne Strom wird der Wasserverbrauch nicht berücksichtigt. Es liegt ein Hardwarefehler vor, der behoben werden muss. Führen Sie eine Notstromversorgung der Batterien durch. Dies ist auch für die Hauptfunktionen des Geräts erforderlich, da das Gerät sonst die Wasserhähne bei Bedarf nicht ausschalten kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daraus ergeben sich folgende zwei Aufgaben:</font></font><br>
<ol>
<li>      . , ,    « »,     ,     () /     .      ,           (  ),       «»,   ,    (,        ),   ,      FreeRTOS.</li>
<li>        ,           ,          « ».<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wasserhähne abstellen?</font></font></b><div class="spoiler_text">,   , , ,       , 11  ,    ,  «» ,          ,      «»  , !<br>
</div></div></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kontrollen</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoder</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Befindet sich neben dem Display und dient zur Navigation im Menü. </font><font style="vertical-align: inherit;">Drehung - Gehen Sie zum nächsten / vorherigen Menüpunkt und drücken Sie - Wählen / Aktivieren eines Menüpunkts.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Roter Knopf"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der einfachste Weg, die Wasserhähne auszuschalten, ist das Drücken der roten Taste. </font><font style="vertical-align: inherit;">Obwohl es nicht nützlich sein sollte, weil </font><font style="vertical-align: inherit;">Einige Zeit zuvor musste das Gerät selbst alles tun. </font><font style="vertical-align: inherit;">Aber nur für den Fall, die Schaltfläche existiert. </font><font style="vertical-align: inherit;">Wiederholtes Drücken, langes Halten, Doppelklicken usw. </font><font style="vertical-align: inherit;">nicht gezählt, nur die erste Presse und das wars. </font><font style="vertical-align: inherit;">Der Notfallmodus ist aktiviert und kann nur über einen speziellen Menüpunkt deaktiviert werden.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein / Aus-Kippschalter</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können auch durch Tippen ausgeschaltet, aber natürlich auch geöffnet werden, wenn sich das System nicht im Crash-Modus befindet. </font><font style="vertical-align: inherit;">Dies kann nützlich sein, um die Wasserversorgung vorübergehend zu unterbrechen.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dreifarbige LED</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles hier ist auch einfach. </font><font style="vertical-align: inherit;">Um den aktuellen Modus anzuzeigen: Grün - alles ist in Ordnung, Rot - nicht alles ist in Ordnung, Blau - Tippen werden mit dem Kippschalter blockiert (siehe Absatz oben). </font><font style="vertical-align: inherit;">Das Mischen von Farben wird nicht verwendet, drei waren genug. </font><font style="vertical-align: inherit;">Aber hier trat ein Problem auf. </font><font style="vertical-align: inherit;">Das Leuchten ist so stark, dass es beim Betrachten des Displays blendet. </font><font style="vertical-align: inherit;">470 Ohm für jede Farbe waren nicht genug. </font><font style="vertical-align: inherit;">Programmatisch korrigiert. </font><font style="vertical-align: inherit;">Wenn sich das Display in einem aktiven Zustand befindet (und während Sie die Bedienelemente verwenden und für eine Weile aktiv sind), ist diese LED aus.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gerät funktioniert. Regelmäßige Tests zeigen, dass es ordnungsgemäß funktioniert. </font><font style="vertical-align: inherit;">Es friert nicht ein, es ist nicht fehlerhaft. </font><font style="vertical-align: inherit;">Obwohl ich weiß, wo potenzielle, aber unkritische Fehler im Code vorhanden sind, wird dies in diesem Artikel nicht behandelt. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellen, Keil uVision 5-Projekt, Projektdatei für STM32CubeMX</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de382065/">https://habr.com/ru/post/de382065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de382051/index.html">Warum das Paket pochta.fi beim finnischen Zoll anmelden?</a></li>
<li><a href="../de382053/index.html">Untersuchte verdrehte Hasen-DNA</a></li>
<li><a href="../de382057/index.html">Schlechter Rat an einen Anfänger-Copter-Guide. Teil 2</a></li>
<li><a href="../de382059/index.html">[Information post] Dateisysteme für USB-Laufwerke und Speicherkarten</a></li>
<li><a href="../de382063/index.html">Sinnesorgane des Autos</a></li>
<li><a href="../de382067/index.html">Die Handschrift eines neuronalen Netzwerks gibt vor, eine Handschrift einer Person zu sein</a></li>
<li><a href="../de382071/index.html">Zum ersten Mal kommt ein Programm besser als eine Person mit der Mustererkennung zurecht</a></li>
<li><a href="../de382073/index.html">Rettung des Ertrinkens - die Arbeit von Robotern</a></li>
<li><a href="../de382075/index.html">Die Geschichte, wie ich NAO nach Russland gebracht habe</a></li>
<li><a href="../de382077/index.html">Jimmy Wales startet soziales Netzwerk und Telefonanbieter, um Menschen zu helfen, für wohltätige Zwecke zu spenden</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>