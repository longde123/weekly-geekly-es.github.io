<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙁 😜 👥 Peretasan ATM NCR Tingkat Rendah ⛹🏼 🔮 🌥️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gambar: Sascha Kohlmann , CC BY-SA 2.0 

 Ada sistem yang tidak dapat diakses oleh manusia biasa secara default. Dan para pengembang sistem semacam it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Peretasan ATM NCR Tingkat Rendah</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/419839/"><img src="https://habrastorage.org/webt/tj/nt/2x/tjnt2xaabgktk2grtx0ihas90f0.jpeg"><br><br>  <i>Gambar: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sascha Kohlmann</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CC BY-SA 2.0</a></i> <br><br>  Ada sistem yang tidak dapat diakses oleh manusia biasa secara default.  Dan para pengembang sistem semacam itu secara naif percaya bahwa mereka dilindungi dari penetrasi dan pandangan tajam dari para peneliti. <br><br>  Ambil setidaknya ATM (ATM).  Ada kasus yang sering terjadi ketika orang tidak dikenal datang ke ATM, menghubungkan laptop, mengambil uang dan pergi tanpa meninggalkan log di sistem.  Dan cerita terbaru dengan " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cutlets</a> " (malware yang disebut <i>Cutlet Maker</i> ) mengonfirmasi bahwa tidak ada sistem yang kebal - ada yang kurang digarap. <br><a name="habracut"></a><br><h2>  Mulai belajar </h2><br>  Ada pendapat bahwa satu-satunya cara untuk mencuri uang dari ATM adalah dengan mengendarai truk sampah, mengambil kail ke ATM dan merobeknya, dan kemudian menggunakan penggiling, linggis dan mesin las gas.  Tetapi ada metode lain. <br><br>  Setelah pencarian singkat di <i>Ebay</i> , saya punya <b>Dispenser S1 USB NCR USB</b> dengan firmware di meja saya.  Tujuannya adalah sebagai berikut: <br><br><ul><li>  menemukan jalan pintas untuk mengenkripsi perintah yang dikirim komputer melalui USB ke dispenser itu sendiri, khususnya untuk mengeluarkan uang kertas; </li><li> Pelajari cara menyiasati kebutuhan akses fisik ke brankas untuk otentikasi (menyentak kaset) untuk menghasilkan kunci enkripsi untuk perintah dari paragraf sebelumnya. </li></ul><br><img src="https://habrastorage.org/webt/nk/qw/ri/nkqwri4xymfedse_tdd_mfqkwc8.png"><br><br><h2>  Firmware </h2><br>  Firmware adalah file <i>ELF</i> untuk <i>prosesor</i> <i>NXP ColdFire</i> ( <i>Motorola 68040</i> , prosesor favorit saya), berjalan pada <i>VxWorks v5.5.1</i> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zy/n2/01/zyn201rwrhyrwet6lawdgkcjmpm.png"></div><br><br>  Dalam file <i>ELF</i> , dua bagian utama menarik -. <i>Teks</i> dan. <i>Data</i> : <br><br><ul><li>  Salah satunya berisi kode yang berputar sepanjang waktu (sebut saja firmware utama) ketika dispenser terhubung ke unit sistem di bagian atas ATM. </li><li>  Yang kedua adalah kode bootloader yang dikemas dengan <b>zlib</b> (nama lokalnya adalah <b>USB Secure Bootloader</b> ), yang bertanggung jawab untuk mengunggah firmware dan meluncurkan kode utama. </li></ul><br>  Dan bagian terbaiknya adalah simbol-simbolnya tetap tidak dipotong di dalam file - ambil dan cari sesuatu yang menarik. <br><br><h2>  Perangkat internal dari firmware utama </h2><br>  Jika Anda membagi kode menjadi komponen utama, Anda mendapatkan skema berikut (dalam urutan pengiriman): <br><br><ol><li>  Aliran yang berhubungan dengan menerima paket USB dan mendistribusikannya di antara layanan. </li><li>  <b>Layanan</b> adalah unit pelaksana utama, masing-masing memiliki perannya sendiri dan masing-masing memiliki tugasnya sendiri (kelas). </li><li>  <b>Kelas</b> - ini adalah tugas-tugas yang dapat dilakukan oleh layanan tertentu dengan bantuan pengontrol. </li><li>  <b>Pengendali</b> sebenarnya adalah " <i>pekerja</i> " ( <i>pekerja</i> ) yang terlibat dalam memvalidasi tugas yang dikirim kepada mereka, pelaksanaannya, serta pembentukan paket respons. </li></ol><br><img src="https://habrastorage.org/webt/bb/x9/ds/bbx9dsyvocknltgx3sr8kubghv0.png"><br><br>  Karena ada banyak kode dalam firmware, diputuskan untuk memulai dengan mencari semua layanan yang mungkin, dan kemudian melihat di mana tugas-tugas ditransfer. <br><br>  Akibatnya, layanan berikut ditemukan yang seharusnya hanya melakukan apa yang saya cari: <br><br>  1) <b>DispTranService (Layanan Transaksi Dispenser)</b> : bekerja dengan perintah terenkripsi, pembentukan bundel uang kertas, otentikasi.  Bisa dibilang yang paling menarik ada di sini. <br><br><img src="https://habrastorage.org/webt/z4/j9/48/z4j948foksgqipdtpkpd4txwe2m.png"><br><br>  2) <b>securityService</b> : setelah otentikasi, kunci sesi dibuat di sisi dispenser, yang, atas permintaan komputer, dikirim kepadanya dalam bentuk terenkripsi.  Kunci ini akan mengenkripsi semua perintah penting - mengeluarkan, membentuk bundel uang kertas. <br><br><img src="https://habrastorage.org/webt/ak/wi/q2/akwiq2yyefxr1l_3d2iepme-qdo.png"><br><br>  Selanjutnya, layanan lain menarik perhatian saya: <b>UsbDownloadService</b> .  Tugasnya adalah, ketika dispenser terhubung ke komputer dan versi firmware dispenser tidak cocok dengan yang tersimpan di komputer ATM, alihkan ke <b>bootloader</b> untuk mengunggah firmware yang digunakan untuk menjalankan OS (terletak di folder dengan perangkat lunak vendor di komputer).  Layanan ini juga tahu bagaimana memberi informasi tentang versi firmware. <br><br><img src="https://habrastorage.org/webt/26/kc/yc/26kcycxcpiehexunrdlmpq4gjus.png"><br><br><h2>  Otentikasi fisik </h2><br>  Otentikasi fisik diimplementasikan pada tingkat tertinggi dan melindungi ATM dari hanya mengirim perintah melalui USB ke masalah tanpa otorisasi.  Dalam hal ini, itu terdiri dari fakta bahwa hanya dengan brankas terbuka dengan uang Anda perlu melakukan salah satu dari yang berikut: <br><br><ul><li>  lepaskan dan masukkan kaset yang lebih rendah, </li><li>  alihkan sakelar sakelar di bagian belakang rak dengan dispenser. </li></ul><br><img src="https://habrastorage.org/webt/wr/vg/jn/wrvgjn2ondfz-ar9eqratwm8fuy.png"><br><br>  Tetapi semua ini diperlukan hanya jika tingkat akses diatur ke maksimum, yaitu fisik.  Ada tiga di antaranya: <i>USB</i> (0), <i>logis</i> (1) dan <i>fisik</i> (2).  Dua sisanya digunakan oleh penyedia layanan dan pengembang untuk debug dan menguji firmware.  Ya, yang fisik sangat direkomendasikan oleh vendor untuk digunakan secara default. <br><br><h2>  Kerentanan </h2><br>  Berikut ini menjelaskan kerentanan kritis (sudah diperbaiki oleh vendor pada saat penerbitan artikel), yang memungkinkan untuk menjalankan perintah dispenser, termasuk penarikan tunai, jika ada akses ke area layanan, tetapi tanpa akses ke brankas (misalnya, melalui lubang yang dibuat di panel depan ATM). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yj/yp/n4/yjypn4wot4lpkggp6xunjrgr2va.png"></div><br><br>  Ternyata, <b>UsbDownloadService</b> menerima perintah yang tidak memerlukan enkripsi.  Kedengarannya menggoda.  Tapi tiba-tiba semuanya terlindungi lebih lanjut, dan nama <b>Secure Bootloader akan</b> terbayar? <br><br>  <i>(Spoiler: tidak dibenarkan!)</i> <br><br><h2>  Kita harus masuk lebih dalam </h2><br>  Seperti yang telah disebutkan, di bagian <i>data.</i> Ada kode loader yang dikemas, yang untuk waktu yang lama tidak membuat saya tertarik, dan rekan-rekan saya tidak memperhatikannya ketika mereka memeriksa firmware. <br><br><img src="https://habrastorage.org/webt/rd/bf/zt/rdbfztrajma7yrnq6kmrr7o5jcc.png"><br><br>  Sementara bootloader adalah sebuah misteri, pertanyaannya tetap terbuka: bagaimana perangkat lunak di komputer membanjiri firmware?  Memang, dalam firmware utama, tidak ada yang semacam itu ditemukan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tb/b0/uy/tbb0uy2d1bzgxpfbf1ies02kapg.png"></div><br><br>  Jadi, <b>bootloader</b> dibongkar, dimuat ke <i>IDA</i> pada offset <b>0x100000</b> - sekarang Anda dapat menyelidiki ... Hanya tidak ada karakter! <br><br>  Tidak masalah: membandingkan firmware utama dengan kode bootloader, membaca lembar data controller - dan gambar tertentu mulai muncul. <br><br><img src="https://habrastorage.org/webt/e-/xd/vv/e-xdvvhfkqldjbfbjrqybgdwua4.png"><br><br>  Ternyata mengunggah firmware, meskipun terlihat terlindungi, sebenarnya tidak seperti itu.  Yang perlu Anda ketahui adalah bagaimana mengisinya dengan benar. <br><br>  Banyak usaha dan waktu dihabiskan untuk memahami proses ini secara lengkap (untuk lebih jelasnya, lihat laporan " <b>Blackbox sudah mati - Hidupkan Blackbox!</b> " Di konferensi Black Hat 2018 di Las Vegas).  Mengapa layak menyolder memori NVRAM, mengunggah cadangan ke sana dengan tujuan "mengikis" seluruh pengontrol ... <i>Terima kasih kepada kolega Alexei atas kesabaran Anda!</i> <i><br></i> <br>  Hasilnya, kami mendapatkan algoritma berikut untuk mengunggah firmware ke dispenser: <br><br>  1) Hasilkan sepasang kunci RSA dan isi kunci publik ke dalam pengontrol. <br><br><img src="https://habrastorage.org/webt/6g/y4/1h/6gy41hu5hu_ivzg6lazlc5qbaaw.png"><br><br>  2) Tulis bagian <i>.data</i> dan <i>.text</i> berurutan dari <i>ELF</i> ke alamat fisiknya dari header bagian. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jj/yj/3t/jjyj3t71ptne_l7r4cpouwbi6iq.png"></div><br><br>  3) Hitung SHA-1 dari data yang direkam, enkripsi hash dengan kunci pribadi, kirim ke controller. <br><br><img src="https://habrastorage.org/webt/kr/9o/ld/kr9oldlexmlcav4iyl9hnxrs844.png"><br><br>  4) Hitung dan kirim jumlah semua kata yang direkam dari firmware. <br><br><img src="https://habrastorage.org/webt/54/e8/dl/54e8dl0gwyv3i0pxaqw-udgbmbu.png"><br><br>  Setelah itu, jika semuanya dihitung dan direkam dengan sukses, firmware utama akan dimuat. <br><br>  Ternyata saat menulis firmware hanya ada satu batasan: versi firmware tidak boleh lebih rendah dari yang sekarang.  Tetapi tidak ada yang menghentikan kita dari mengubah versi firmware dalam datanya sendiri. <br><br>  Akibatnya, firmware khusus saya dengan perbaikan <i>antisecurity</i> diunggah dan berhasil diluncurkan! <br><br>  Pada titik ini, kode firmware utama telah dipelajari dengan baik, perintah untuk mengeluarkan uang kertas ditemukan.  Sekarang mereka dapat dikirim tanpa enkripsi, dan dispenser akan dengan senang hati mengeksekusi mereka. <br><br><img src="https://habrastorage.org/webt/gu/bk/m1/gubkm1l2g0mdd_dfepxjy2n50sa.png"><br><br><h2>  Masalah </h2><br>  Setelah semuanya mengalami selama studi (misalnya, ATM nyata " <i>bricked</i> "), hasilnya sangat menyenangkan dan mengimbangi upaya yang saya ingin mengulangi algoritma dengan vendor besar lainnya. <br><br><img src="https://habrastorage.org/webt/yt/k1/wx/ytk1wxlqy9dotiuoqvwlvsc2g0o.png"><br><br>  ATM yang paling nyata mulai berdengung dengan keras dan penuh semangat berbagi dengan kami uang kertas segar yang renyah (dalam hal ini, penjual "pembungkus permen").  Tidak ada keajaiban yang diterapkan: hanya laptop, otak, dan kabel USB. <br><br><h2>  Kesimpulan </h2><br>  Sekali lagi, kami yakin bahwa, dipandu oleh prinsip <b>keamanan melalui ketidakjelasan</b> , tidak mungkin untuk memberikan perlindungan yang memadai.  Kepatutan kode atau firmware tidak berarti sama sekali bahwa pada satu titik baik penyerang tidak akan mendapatkan akses ke sana dan tidak akan mengambil keuntungan dari kerentanan yang ditemukan.  Segala sesuatu yang diperlukan untuk implementasi tujuan egois dapat diperoleh di hadapan sejumlah uang tertentu. <br><br>  Pengembang harus menangani kode, dan penjaga keamanan harus melindunginya.  Itulah sebabnya pendekatan yang paling produktif tampaknya adalah kerja sama dengan perusahaan keamanan informasi dengan pengalaman yang cukup dalam memastikan keamanan berbagai sistem yang akan membantu membangun perlindungan yang memadai dalam setiap kasus. <br><br>  Vendor PS mengkonfirmasi kerentanan (celah juga ditemukan di model lain - <b>S2</b> ), yang dinyatakan telah diperbaiki pada perbaikan Februari 2018. <br><br>  Daftar CVE: <br><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CVE-2017-17668</a></b> (NCR <b>S1</b> Dispenser), </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CVE-2018-5717</a></b> (Dispenser NCR <b>S2</b> ). </li></ul><br><h2>  Ucapan Terima Kasih </h2><br>  Sebelum saya, rekan-rekan saya - <i>Dima Sklyarov</i> dan <i>Misha Tsvetkov</i> - sudah bekerja pada firmware (meskipun tanpa papan dispenser).  Prestasi mereka banyak membantu saya dalam penelitian ini, yang banyak terima kasih kepada mereka!  Mengenai perangkat kerasnya, <i>Alexey Stennikov banyak</i> membantu saya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id419839/">https://habr.com/ru/post/id419839/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id419829/index.html">Enkripsi kunci default OpenSSH lebih buruk daripada tidak sama sekali</a></li>
<li><a href="../id419831/index.html">Cara Kerja JS: Elemen Kustom</a></li>
<li><a href="../id419833/index.html">Pekerjaan jarak jauh, cara kerjanya</a></li>
<li><a href="../id419835/index.html">Bagaimana memotivasi penulis, bernegosiasi dengan para ahli dan umumnya menulis artikel yang bagus</a></li>
<li><a href="../id419837/index.html">Saya, RoboLoyer, atau bagaimana mencari anomali dalam dokumen</a></li>
<li><a href="../id419843/index.html">GeekUniversity Membuka Pendaftaran di Fakultas Kecerdasan Buatan</a></li>
<li><a href="../id419845/index.html">Rilis 0.4.9: Implikasi</a></li>
<li><a href="../id419847/index.html">Dari 0,01 TFlops HPL ke Inovasi Aplikasi ASC'18</a></li>
<li><a href="../id419849/index.html">Investigasi motherboard: Bagaimana penjahat cyber mencuri nomor ponsel dengan bantuan perusahaan telekomunikasi</a></li>
<li><a href="../id419853/index.html">ITU Tidak Terdeteksi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>