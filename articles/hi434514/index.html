<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЫ╣я╕П ЁЯОО ЁЯФ║ "рд╕реАрдХреНрд░реЗрдЯ" DPAPI рдпрд╛ DPAPI рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП ЁЯТ╣ ЁЯПТ тЫУя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OFFZONE-2018 рдореЗрдВ рд╣рдорд╛рд░реА рдЯреАрдо рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рджреВрд╕рд░рд╛ рд▓реЗрдЦред рдЗрд╕ рдмрд╛рд░, рдореЗрдирдЯреНрд░реИрдХ "рд╡рд┐рдВрдбреЛрдЬ рдбреАрдкреАрдПрдкреАрдЖрдИ" рд╕реЗрдХреНрд░реЗрдЯрд┐рдХреА "рдпрд╛ рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдбреАрдкреАрдПрдкреАрдЖ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"рд╕реАрдХреНрд░реЗрдЯ" DPAPI рдпрд╛ DPAPI рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434514/">  OFFZONE-2018 рдореЗрдВ рд╣рдорд╛рд░реА рдЯреАрдо рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рджреВрд╕рд░рд╛ рд▓реЗрдЦред  рдЗрд╕ рдмрд╛рд░, рдореЗрдирдЯреНрд░реИрдХ "рд╡рд┐рдВрдбреЛрдЬ рдбреАрдкреАрдПрдкреАрдЖрдИ" рд╕реЗрдХреНрд░реЗрдЯрд┐рдХреА "рдпрд╛ рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдбреАрдкреАрдПрдкреАрдЖрдИ рдХреЗ рд╕рд╛рде рдПрдХ рдЪрд░реНрдЪрд╛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред" <br><br>  рдЪреЗрддрд╛рд╡рдиреА!  рдмрд╣реБрдд рд╕рд╛рд░реЗ рдордзреБрдордХреНрдЦреА! <br><br>  RedTeam рдЕрднрд┐рдпрд╛рдиреЛрдВ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░рддреЗ рд╕рдордп, рдореИрдВ BlueTeam рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдХрдо рдХрд╛рд░рдг рджреЗрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВ, рд▓реЗрдХрд┐рди рдХрдИ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП mimikatz рдЪрд▓рд╛рдирд╛ред  рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрдЧрд░ рд╣рдо Kaspersky рд╕реЗ рдЙрд╕реЗ "рдУрдЯрдорд╛рдЬрд╝реНрд╡реЗрдЯ" рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдереЗ, рддреЛ рдмреНрд▓реВрдЯреЗрдо рдореЗрдВ Sysmon, Microsoft ATA рдЖрджрд┐ рдЬреИрд╕реЗ рд╡рд┐рд╢реЗрд╖ рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИред  рдЙрд╕реА рд╕рдордп, рдореИрдВ рдПрдХ рд╕рдордЭреМрддрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╢реАрди рд╕реЗ рдЕрдзрд┐рдХрддрдо рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ред  RedTeam рджреНрд╡рд╛рд░рд╛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдмреНрд▓реВрдЯреЗрдо рдЯреАрдореЛрдВ рдХрд╛ рдореБрдХрд╛рдмрд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рд░-рдмрд╛рд░ рдХрд┐рдП рдЧрдП рдЕрднрд┐рдпрд╛рдиреЛрдВ рдХреЗ рджреМрд░рд╛рди, рд╣рдо рдЗрд╕ рдирд┐рд╖реНрдХрд░реНрд╖ рдкрд░ рдкрд╣реБрдВрдЪреЗ рдХрд┐ рдЙрди рдХрд╛рд░реНрдпреЛрдВ рд╕реЗ рдмрдЪрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рд╕рдордЭреМрддрд╛ рдХреЗ рд╕рдВрдХреЗрддрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдХрд╛рдиреВрдиреА рддрдВрддреНрд░ рдФрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╣ рд▓рдХреНрд╖реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред <br><br>  рдРрд╕реЗ рдХрд╛рдиреВрдиреА рдЙрдкрдХрд░рдгреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдбреАрдкреАрдПрдкреАрдЖрдИ (рд╡рд┐рдВрдбреЛрдЬ рдбреЗрдЯрд╛ рдкреНрд░реЛрдЯреЗрдХреНрд╢рди рдПрдкреАрдЖрдИ) рддрдВрддреНрд░ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ (рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб, рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рдХреБрдВрдЬрд┐рдпрд╛рдБ, рдЖрджрд┐) рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдбреАрдкреАрдПрдкреАрдЖрдИ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рд╣реИред : рдХреЗрд╡рд▓ 2 рдХрд╛рд░реНрдп рд╣реИрдВ - "рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ" рдФрд░ "рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдбреЗрдЯрд╛"ред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ рдЗрд╕ рдмрд╛рдд рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ рдХрд┐ RedTeam рдЕрднрд┐рдпрд╛рдиреЛрдВ рдХреЗ рджреМрд░рд╛рди рдЗрд╕ рддрд░рд╣ рдХрд╛ рдПрдХ рддрдВрддреНрд░ рдкрдВрдЪрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧреА рд╣реИред <br><a name="habracut"></a><br><h3>  DPAPI рдХреНрдпрд╛ рд╣реИ?  рдХреЗрд╡рд▓ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдФрд░ рд░реВрд╕реА рдореЗрдВ </h3><br>  2000 рдХреЗ рдмрд╛рдж рд╕реЗ, рд╕рднреА рд╡рд┐рдВрдбреЛрдЬ рдУрдПрд╕ рдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП DPAPI рдЗрдВрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ рд╣реИред <br><br>  рдпрджрд┐ рд╣рдо DPAPI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдордиреЗ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рдЬрд╛рдВрдЪ рдХреА рдЧрдИ рд╕рднреА рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝реА рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ SID, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢, рдФрд░ DPAPI рд╕реНрд╡рдпрдВ (рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб DPAPI рдбреЗрдЯрд╛)ред <br><br>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИ: <br><br><img src="https://habrastorage.org/webt/n1/ex/ah/n1exahepzml5ykake_tcy_qaj6i.jpeg"><br><br>  рд╣рдорд╛рд░реЗ "рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рд╣реИрдЯ" рдХреЗ рдЕрдВрджрд░ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреНрд░рд┐рдкреНрдЯреЛрдХрд░рдВрд╕реА рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдо рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдирд╣реАрдВ рдорд╛рдиреЗрдВрдЧреЗ, рддрд╛рдХрд┐ рдкрд╛рдардХ рдХреЛ рдЕрдзрд┐рднрд╛рд░ рди рдбрд╛рд▓реЗрдВред  рд╣рдо рдХреЗрд╡рд▓ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ DPAPI рдХрд╛ рдореБрдЦреНрдп рднрд╛рдЧ рддрдерд╛рдХрдерд┐рдд рдорд╛рд╕реНрдЯрд░рдХреА (рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА) рд╣реИред  рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА, рдкреНрд░реАрдХреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдбреЗрдЯрд╛ рдХрд╛ 64 рдмрд╛рдЗрдЯ рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдЙрд╕рдХреЗ SID рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред <br><img src="https://habrastorage.org/webt/dr/gu/b2/drgub2ccge4pjhkz1czilfleveg.jpeg"><br><br>  рдЕрддрд┐рд░рд┐рдХреНрдд рдкреИрд░рд╛рдореАрдЯрд░ рдкреНрд░реАрдХреА рдкреАрдврд╝реА рдореЗрдВ рднреА рднрд╛рдЧ рд▓реЗрддреЗ рд╣реИрдВ: рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ (IterN), рдирдордХ рдФрд░ HMAC рдХреА рд╕рдВрдЦреНрдпрд╛, рдЬреЛ рдПрдХ рдорд╛рдорд▓реЗ рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддреА рд╣реИред  рдЗрди рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб, рдЙрд╕рдХреЗ SID рдХреЛ рдЬрд╛рдирдиреЗ рдФрд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдлрд╝рд╛рдЗрд▓ (HMAC, Salt, InterN) рд╕реЗ рдкреАрдврд╝реА рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдПрдХ рдкреНрд░реАрдХреА рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рддред  рдмрд╣реБрдд рдмреЗрддрд░рддреАрдм 64 рдмрд╛рдЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ, рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдбреАрдкреАрдПрдкреАрдЖрдИ рдмреНрд▓реЙрдмреНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред <br><br><h3>  рдпрджрд┐ рдореИрдВ рдЕрдкрдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓реВрдВ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛? </h3><br>  рдЖрдорддреМрд░ рдкрд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдирд┐рдпрдорд┐рдд рдЕрдВрддрд░рд╛рд▓ рдкрд░ рдмрджрд▓рддреЗ рд░рд╣рддреЗ рд╣реИрдВред  рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рддрд╛ рд╣реИ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?  рдкрд┐рдЫрд▓рд╛ рдХрд╣рд╛рдВ рдЧрдпрд╛?  рджрд░рдЕрд╕рд▓, рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рд╣рд░ рдмрд╛рд░ рд╕рднреА рдорд╛рд╕реНрдЯрд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдлрд┐рд░ рд╕реЗ рдХреНрд░рд┐рдкреНрдЯреЛрдХрд░рдВрдЯ рдХрд░рдирд╛ рдмрд╣реБрдд рдорд╣рдВрдЧрд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡рд┐рдВрдбреЛрдЬ рдореЗрдВ рд╕рдм рдХреБрдЫ рд╕реЛрдЪрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рдПрдХ рд╡рд┐рд╢реЗрд╖ рдлрд╝рд╛рдЗрд▓ (CREDHIST) рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдХрд╛рд░реНрдп рдкрд┐рдЫрд▓реЗ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛ рд╣реИред  рдЗрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡рд░реНрддрдорд╛рди рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╕реНрдЯреИрдХ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдпрджрд┐ рд╕рд┐рд╕реНрдЯрдо рдЕрдЪрд╛рдирдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╡рд┐рдлрд▓ рд░рд╣рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдЖрдЧреЗ рдмрдврд╝рддрд╛ рд╣реИ: рд╡рд░реНрддрдорд╛рди рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдпрд╣ CREDHIST рдореЗрдВ рдкрд╣рд▓реЗ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИред  рдкрд╛рд╕рд╡рд░реНрдб рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдлрд┐рд░ рд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИ, рдФрд░ рдЗрд╕реА рддрд░рд╣ рдЬрдм рддрдХ рдЪреЗрди рдореЗрдВ рдореМрдЬреВрдж рдкрд╛рд╕рд╡рд░реНрдб рдмрд╛рд╣рд░ рдирд╣реАрдВ рдирд┐рдХрд▓рддреЗ рдпрд╛ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><h3>  рдПрдХ рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ </h3><br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдкрдиреЗ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдпрд╛ рд╣реЛрдЧрд╛, DPAPI рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕рд╣рд┐рдд рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред  рдХрд┐рд╕реА рдРрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд╛рд╕рд╡рд░реНрдб рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рдХреБрдЫ рд╢реБрдХреНрд░рд╡рд╛рд░ рдХреА рд░рд╛рдд рдХреА рдкрд╛рд░реНрдЯреА рдХреЗ рдмрд╛рдж рдЗрд╕реЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рднреВрд▓ рдЧрдпрд╛ рд╣реИ, рдЖрдкрдХреЛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреБрдВрдЬреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  Microsoft рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдРрд╕рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕реНрдерд╛рди рдПрдХ рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рд╣реИред <br><br>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрдВрддреНрд░ рдХрд╛ рд╕рд╛рд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: рдЖрд░рдПрд╕рдП рдХреБрдВрдЬреА рдХреА рдПрдХ рдЬреЛрдбрд╝реА - рдирд┐рдЬреА рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ - рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдкрд░ рдмрдирд╛рдИ рдЧрдИ рд╣реИред  рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЛ NTDS рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ BCKUPKEY_xxxx рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ (рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЖрдВрдХрдбрд╝рд╛ рджреЗрдЦреЗрдВ), рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЛ рд╕рднреА рдбреЛрдореЗрди рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рдкрд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреА рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдбреЛрдореЗрди рдорд╢реАрди рдкрд░ рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕рдХреА рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рднреА рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ (рдпрд╛ рдмрд▓реНрдХрд┐, рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЗрд╕рдХреА 64 рдмрд╛рдЗрдЯреНрд╕ рд╣реИ), рдЬрд┐рд╕реЗ рдПрдХ рдлрд╛рдЗрд▓ рдореЗрдВ рдореБрдЦреНрдп рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдбреЛрдореЗрди рдХреБрдВрдЬреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдореБрдЦреНрдп рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдЦреЛ рджреЗрддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рддред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░рддреЗ рд╕рдордп, рд╕рд┐рд╕реНрдЯрдо рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рдЗрд╕рдХреА рдПрдХ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддрд╛ рд╣реИред  рдирд┐рдпрдВрддреНрд░рдХ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рддрд╛ рд╣реИ, рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирдП рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдлрд┐рд░ рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЬрд╛рддреА рд╣реИред <br><br><img src="https://habrastorage.org/webt/jj/7h/zr/jj7hzrqypjkdjwiaooxks9wcbj0.jpeg"><br><br>  рдбреЛрдореЗрди рдореЗрдВ рдЙрдкрдпреБрдХреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ (рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ) рд╣реЛрдиреЗ рдкрд░, рдЖрдк рдЗрди рдирд┐рдЬреА RSA рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рд╕реЗ рдкреНрд░рддрд┐рдХреГрддрд┐ рддрдВрддреНрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреЛрдореЗрди рдорд╢реАрдиреЛрдВ рдкрд░ рдмрдирд╛рдП рдЧрдП рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рдЖрдЧреЗ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ mimikatz рдпрд╛ DSInternals рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ mimikatz wiki рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">DSInternals</a> рдмреНрд▓реЙрдЧ рдореЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред <br><br><h3>  рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╣рд╛рдБ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ рдФрд░ рд╡реЗ рдХреНрдпрд╛ рд╣реИрдВ? </h3><br>  рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдкреНрд░рдгрд╛рд▓реА рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЬреЛ рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ рдХрд┐ рдХрд┐рд╕рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br> <code>Users\%USER%\AppData\Roaming\Microsoft\Protect\%SID%\</code> <br> <br>  рдмрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рднреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред  рд╕рдм рдХреЗ рдмрд╛рдж, рд╡рд╣ рдкрд╣рд▓реЗ рд╕реЗ рдирд╣реАрдВ рдЬрд╛рдирддреА рд╣реИ рдХрд┐ рдХрд┐рд╕ рдорд╛рд╕реНрдЯрд░ рдХреЛ рдПрдХ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдХреБрдЫ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред  рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рд╡рд░реНрддрдорд╛рди рдХреБрдВрдЬреА рдХрд╛ GUID рдкрд╕рдВрджреАрджрд╛ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред <br><br><img src="https://habrastorage.org/webt/xf/vm/dr/xfvmdrhqgsspxyznypourrwceh8.jpeg"><br><br>  рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИрдВ: <br> <code>windows\system32\Microsoft\Protect\S-1-5-18\</code> <br> <br>  рдЗрд╕реА рддрд░рд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде - рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдирд╛рдо Preferred рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдХрднреА рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рд╕рднреА рдХреБрдВрдЬреА рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИрдВред <br><br><img src="https://habrastorage.org/webt/zt/xt/xj/ztxtxjcblhgk7ugrwxwgosbtmjw.jpeg"><br><br><h3>  рдЦреИрд░, рдпрд╣ рдбреАрдкреАрдПрдкреАрдЖрдИ рдкреЗрдВрдЯреЗрд╕реНрдЯрд░ рдХреЛ рдХреНрдпрд╛ рджреЗ рд╕рдХрддрд╛ рд╣реИ? </h3><br>  рдЪреВрдВрдХрд┐ DPAPI рдПрдХ рдХрд╛рдиреВрдиреА рдФрд░ рд╕рд░рд▓ рддрдВрддреНрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред  рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИред  рд╕рдордп рдХреЗ рд▓рд┐рдП, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗред <br><br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, DPAPI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА, WIFI рдЪрд╛рдмрд┐рдпрд╛рдБ, рдХреНрд░реЛрдо (рдХреБрдХреАрдЬрд╝, рдкрд╛рд╕рд╡рд░реНрдб), рдбреНрд░реЙрдкрдмреЙрдХреНрд╕, рд╕реНрдХрд╛рдЗрдк, RSA SecurID (рдПрдХ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЬреЛ рдПрдХ рдмрд╛рд░ рдХреА рдЪрд╛рдмрд┐рдпрд╛рдБ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ) рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдФрд░ рдпрд╣ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╕реВрдЪреА рдирд╣реАрдВ рд╣реИред <br><br>  рдкреЗрдВрдЯрд░ рдХрд╛ рдХрд╛рдо рдЖрд╡рд╢реНрдпрдХ рдмреНрд▓рдмреНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб, рдХреБрдХреАрдЬрд╝ рдЗрддреНрдпрд╛рджрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред <br><br>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВред  рдПрдХ рддрд░рд╣ рд╕реЗ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп, рд╡реЗ рд╕рднреА рджреЛ рдЯреЗрдкреЛрдВ рдХреЛ рдЙрдмрд╛рд▓рддреЗ рд╣реИрдВ - рдСрдирд▓рд╛рдЗрди рдФрд░ рдСрдлрд▓рд╛рдЗрдиред  рдСрдирд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╢реАрди рдкрд░ рд╣рдо рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрдирдкреБрдЯ рдореЗрдВ DPAPI рдмреВрдБрдж рдХреЛ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕реНрд╡рдпрдВ рд╕рдм рдХреБрдЫ рдХрд░рддрд╛ рд╣реИ - рдпрд╣ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдмреВрдБрдж рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ SID рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдПрд▓рдПрд╕рдПрдПрд╕рдПрд╕ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред <br><br>  рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЖрдВрдХрдбрд╝рд╛ DPAPI рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ, рдЬреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/webt/nj/h3/ko/njh3koyjpr5f1yft8o6zllkpjfw.jpeg"><br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЕрдкрдиреЗ рдЧреБрдкреНрдд (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╢рдмреНрдж "рдкрд╛рд╕рд╡рд░реНрдб") рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ [Security.Cryptography.ProtectedData] :: Protect () рдлрд╝рдВрдХреНрд╢рди рдХрд╣рддреЗ рд╣реИрдВред  рдФрд░ рд╣рдо рдпрд╣ рджреЛ рдмрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ - рдкрд╣рд▓реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА (рдкреИрд░рд╛рдореАрдЯрд░ рдХрд░рдВрдЯрд┐рдпрд░) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдФрд░ рджреВрд╕рд░реЗ рдореЗрдВ - рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА (рдкреИрд░рд╛рдореАрдЯрд░ рд▓реЛрдХрд▓ рдорд╛рдЪрд╛рдЗрди)ред  рдлрд┐рд░ рд╣рдо рдЙрд▓рдЯрд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдкрд░рд┐рдгрд╛рдореА рдмреВрдБрдж рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - [Security.Cryptography.ProtectedData] :: UnProtect ()ред <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, CurrentUser рдпрд╛ LocalMachine рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдорд╛рди рдорд╛рдпрдиреЗ рдирд╣реАрдВ рд░рдЦрддрд╛, рдХреНрдпреЛрдВрдХрд┐  рд╕рд┐рд╕реНрдЯрдо рдЦреБрдж рдХреЛ рдмреВрдБрдж рдХреЛ рдбрд┐рдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдкрд╛рддрд╛ рд╣реИ, рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд╕рдм рдХреБрдЫ рдХрд░рддрд╛ рд╣реИред  рджреЛрдиреЛрдВ рд╣реА рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рд╣рдореЗрдВ рдЕрдкрдирд╛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд░рд╣рд╕реНрдп рдорд┐рд▓рддрд╛ рд╣реИ - рд╢рдмреНрдж "рдкрд╛рд╕рд╡рд░реНрдб" (рдЗрд╕рдХреЗ рдмрд╛рдЗрдЯ-рдмрд╛рдп-рдмрд┐рдЯ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡)ред <br><br>  рдСрдирд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреЗ рд╕рдордп, рдпрд╣ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдЖрдк рдХрд┐рд╕ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЕрдирдкреНрд░реЛрдЯреЗрдХреНрдЯ () рдлрд╝рдВрдХреНрд╢рди рдХрд╣ рд░рд╣реЗ рд╣реИрдВред  рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рд╕рдлрд▓ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рддреНрд░ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ рдирдП рд╕рддреНрд░ рдХреЗ рддрд╣рдд рд▓реЙрдЧ рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдмрд╛рдд рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдХреА рд╣реИ, рдЬреЛ LSASS рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред  рдпрджрд┐ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рддреНрд░ рдХреЗ рдмрд╛рд╣рд░ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдкрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ psexec рдпрд╛ рдореАрдЯрд░рдкреНрд░реЗрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд┐рдпрд╛ рд╣реИ), рддреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИрд╢ рдирд╣реАрдВ рд╣реИред  рд╡рд╣ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЕрдЧрд▓реЗ рд╕рддреНрд░ рдореЗрдВ рд╣реИ, рд▓реЗрдХрд┐рди LSASS рдЖрдкрдХреЛ рдпрд╣ рдирд╣реАрдВ рджреЗрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐  рдпрд╣ рдПрдХ рдФрд░ рд╕рддреНрд░ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдЙрд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рддрд╣рдд рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рд╕рдлрд▓ рдСрдирд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпрд╛ рддреЛ GUI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧ рдЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╢реБрд░реВ рдХреА рдЧрдИ рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдорд╛рдЗрдЧреНрд░реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдпрд╛ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, RDP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред <br><br>  рдбреАрдкреАрдПрдкреАрдЖрдИ рдмреНрд▓реЙрдмреНрд╕ рдХреЗ рдСрдирд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП рдкреЙрд╡рд░рд╢реЗрд▓ рдХрд╛ рд╡рд┐рдХрд▓реНрдк mimiktaz рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: / рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдмреНрд▓реЙрдмред  рдЗрдирдкреБрдЯ рдкрд░, рдЙрд╕реЗ DPAPI рдмреВрдБрдж рдХреЗ рд╕рд╛рде рдПрдХ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓ рджреА рдЬрд╛рддреА рд╣реИ, рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рд╣рдореЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯреЗрдб рдбреЗрдЯрд╛ рдорд┐рд▓рддрд╛ рд╣реИред  Mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЕрдзрд┐рдХ рдорд╛рдорд▓реЛрдВ рдХрд╛ рд╡рд░реНрдгрди рд╣рд╛рд░реНрдордЬреЗ0 рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреНрд▓реЙрдЧ рдкрд░</a> рдХрд┐рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрдпрд╛ рд╣реИ</a> ред <br><br><h3>  рдХреНрдпреВ рдмреЙрд▓ рдЧрд┐рд░ рдЧрдИред  рд╡рд┐рджреНрдпрд╛рд╣реА рдХреЗ рд╕рд╛рде рдореЗрд░реЗ рдЦреЗрдд рдХрд╛ рдХреНрдпрд╛ рдХрд░реЗрдВ? </h3><br>  рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ DPAPI рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдкрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЖрдк рд░рд┐рд╡рд░реНрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдЕрдкрдиреЗ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдмрд╛рдзреНрдп рдХрд░реЗрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рднреЗрдЬреЗ рдЧрдП рдбреЙрдХреНрд╕ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╣рдорд╛рд░реЗ рдореИрдХреНрд░реЛ рдпрд╛ рдбреАрдбреАрдИ рд╕реЗ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рдХрдиреЗрдХреНрд╢рди рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖред  рд╣рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдФрд░ mimikatz рд▓реЙрдиреНрдЪ рдХреЗ рдмрд┐рдирд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдХреНрдпрд╛ рдореИрдВ рдкрд╛рд╕рд╡рд░реНрдб рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХреЗ рд▓рд┐рдП Hashcat рдпрд╛ JohnTheRipper рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?  рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдЬреЙрди рдХреА рд░рдЪрдирд╛ рд╕реЗ рдЙрдкрдпреБрдХреНрдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдЬрд╛рдирд╡рд░ рдмрд▓ рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="xml hljs">./DPAPImk2john.py тАУS <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sid</span></span></span><span class="hljs-tag">&gt;</span></span> -mk <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkey</span></span></span><span class="hljs-tag">&gt;</span></span> -c <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain|local</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  рддрдм рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡реАрдбрд┐рдпреЛ рдХрд╛рд░реНрдб рдХреЗ рд╕рд╛рде рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдЕрдкрдиреЗ рдЦреЗрдд рдореЗрдВ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрд╢рд╛ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдПрдХ рдХрдордЬреЛрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╣реИ, рдХреНрдпреЛрдВрдХрд┐  рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдмреНрд░реВрдЯ рдмрд▓ рдЧрддрд┐ рд▓рдЧрднрдЧ WPA2 рдЧрдгрдирд╛ рдЧрддрд┐ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рдЕрд░реНрдерд╛рдд  рдзреАрд░реЗ рдзреАрд░реЗред <br><br>  рдпрд╣рд╛рдВ рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдЬрдм рдбреЛрдореЗрди рд╡рд┐рдВрдбреЛрдЬ 10 рдкрд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ, рддреЛ рдкреНрд░реАрдХреЗ рдЬрдирд░реЗрд╢рди рдореЗрдВ PBKDF2 рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЗ рдПрдХ рдФрд░ 10,000 рд░рд╛рдЙрдВрдб рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рднреА рдмрджрддрд░, рди рддреЛ рд╣рд╛рд╕реНрдХреИрдЯ рдФрд░ рди рд╣реА рдЬреЙрдирд░рд┐рдкрд░ рдХреЛ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдкрддрд╛ рд╣реИ (рдХрдо рд╕реЗ рдХрдо рдЗрд╕ рд▓реЗрдЦрди рдХреЗ рд╕рдордп), рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╡реЗ рдЗрд╕ рддрд░рд╣ рдХреЗ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╣рдЯрд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред <br><br><h3>  "рдЬреЛ рдмреБрд░рд╛ рд╣реИ, рдЙрд╕реЗ рджреВрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдлрд┐рд░ рдЙрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП ..." </h3><br>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╢реАрди рдкрд░ рд╕рдВрджрд┐рдЧреНрдз рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди Blueteam рдЯреАрдо рд╕реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдмреНрдпрд╛рдЬ рдХреЛ рдЙрддреНрддреЗрдЬрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдпрд╣, рддрджрдиреБрд╕рд╛рд░, рдЗрд╕ рддрдереНрдп рд╕реЗ рднрд░рд╛ рд╣реБрдЖ рд╣реИ рдХрд┐ RedTeam рдХреЗ рд╕рднреА рд╡рд╣рд╛рдБ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред  рдПрдХ рдЙрджрд╛рд╣рд░рдг рдПрдХ рдПрдХрд╛рдЙрдВрдЯреЗрдВрдЯ рдпрд╛ рд╕рдЪрд┐рд╡ рдХреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд╢рдХреНрддрд┐рдпреЛрдВ рдХреЗ рдкреНрд░рдХреНрд╖реЗрдкрдг рдХрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдШрдЯрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рддреА рд╣реИред  рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╕рдВрджреЗрд╣ рдкреИрджрд╛ рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдбреАрдкреАрдПрдкреАрдЖрдИ рдмреНрд▓реЙрдмреНрд╕ рдХреЛ рдбреАрдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдлрд╝рд▓рд╛рдЗрди рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдорд╢реАрди рд╕реЗ рдЕрдкрдиреА рдЬрд░реВрд░рдд рдХрд╛ рд╣рд░ рд╕рд╛рдорд╛рди рд▓реЗрдирд╛ рд╣реЛрдЧрд╛, рдЕрд░реНрдерд╛рддреН: <br><br><ul><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА </li><li>  рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА </li><li>  CREDHIST рдлрд╝рд╛рдЗрд▓ (рдпрджрд┐ рдпрд╣ рдПрдХ рдбреЛрдореЗрди рдорд╢реАрди рдирд╣реАрдВ рд╣реИ); </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб (рдпрд╛ рдЙрд╕рдХреЗ sha1 / ntlm рд╣реИрд╢); </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдПрд╕рдЖрдИрдбреА; </li><li>  DPAPI рд╕реЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </li></ul><br>  рдСрдлрд╝рд▓рд╛рдЗрди рдореЛрдб рдореЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП, рд╣рдо рд╡рд┐рд╢реЗрд╖ рдЯреВрд▓ рдХреЗ рдмрд┐рдирд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред  рдРрд╕реЗ рдЙрдкрдХрд░рдг рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><ul><li>  Mimikatz; </li><li>  рдЗрдореНрдкреЗрдХреЗрдЯ (18 рд╡реЗрдВ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рд╢реБрд░реВ, рдЗрд╕рдХреА рдбреАрдкреАрдПрдкреАрдЖрдИ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╣реИ); </li><li>  Dpapick рдврд╛рдВрдЪрд╛ред </li></ul><br>  рдпрд╣ dpapick рдврд╛рдВрдЪреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ рдЬрд┐рд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣рдо рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред <br><br>  рдЕрдЬрдЧрд░ рдбрд╛рдкреНрдкрд┐рдХ рдврд╛рдВрдЪрд╛ 2014 рдореЗрдВ рд╢реЛрдзрдХрд░реНрддрд╛ рдЬреАрди-рдорд┐рд╢реЗрд▓ рдкрд┐рдХрдХреЛрдб рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдпрд╣ рдкрд╛рдпрдерди рдХреНрд░рд┐рдкреНрдЯреЛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдкрд░ DPAPI рддрдВрддреНрд░ рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИред  рдЕрдЬрдЧрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ, рд╕рд╛рде рд╣реА рд╕рд╛рде рдврд╛рдВрдЪреЗ рдХреА рд╕рдВрд░рдЪрдирд╛, рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рд╡рд┐рднрд┐рдиреНрди DPAPI рддрдВрддреНрд░ рдХреЗ рдЕрдиреБрдХреВрд▓ рд╣реЛрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЕрдкрдиреЗ рдореВрд▓ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ, dpapick рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди рдмреИрдХрдЕрдк рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рдерд╛, рдФрд░ рдЗрд╕рдореЗрдВ рдбреЛрдореЗрди рдорд╢реАрди рдореЛрдб рдореЗрдВ рд╡рд┐рдВрдбреЛрдЬ 10 рдкрд░ рдмрдирд╛рдИ рдЧрдИ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрдВрддреНрд░ рдХрд╛ рдЕрднрд╛рд╡ рдерд╛ред <br><br>  рдЗрди рдХрдорд┐рдпреЛрдВ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдФрд░ DPAPI рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, dpapick DPAPI рдХреЗ рдСрдлрд╝рд▓рд╛рдЗрди рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдЙрдкрдХрд░рдг рдмрди рдЧрдпрд╛ред  рдиреАрдЪреЗ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо DPAPI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдврд╛рдВрдЪреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦрд╛рдПрдВрдЧреЗред <br><br><h3>  рдХреНрд░реЛрдо - рдХреБрдХреАрдЬрд╝ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рд▓реЗ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ </h3><br>  рдХреНрд░реЛрдо <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> рдлрд╝рд╛рдЗрд▓ <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИрдВ <br>  рд▓реЙрдЧрд┐рди рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓ <code>%localappdata%\Google\Chrome\User Data\Default\Login Data</code> <br><br>  рджреЛрдиреЛрдВ рдлрд╛рдЗрд▓реЗрдВ sqlite3 рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ DPAPI рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  Dpapick рдХреЗ рдПрдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕ рдбреЗрдЯрд╛ (рдЙрджрд╛рд╣рд░рдг / chrome.py) рдХреЗ рд▓рд┐рдП рдПрдХ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╡рд┐рдЪреНрдЫреЗрджрдХ (рдкрд╛рд░реНрд╕рд░) рд╣реИред  рд╕рдлрд▓ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЗрдВ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкреИрд░, рдЙрдирдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рд╕реНрдерд╛рди, рд╕рд╛рде рд╣реА рдХреНрд░реЛрдо (рдХреБрдХреА рдпрд╛ рд▓реЙрдЧрд┐рди рдбреЗрдЯрд╛) рд╕реЗ sqlite3 рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдХреНрд░реЛрдо рдХреБрдХреА рдХреА рдСрдлрд╝рд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди <br><br><pre> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗ рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд░реЛрдо рдХреБрдХреА рдХрд╛ рдСрдлрд╝рд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди <br><br><pre> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --hash <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  рдХрд┐рд╕реА рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рд╕реЗ рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд░реЛрдо рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдСрдлрд╝рд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди <br><br><pre> <code class="xml hljs">./chrome.py --chrome <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">login</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд▓рд┐рдП DPAPI </h3><br>  рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд╣реБрдд рд╕реЗ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдУрдЯреАрдкреА, рдИрдПрдлрдПрд╕ рдпрд╛ рд╡реАрдкреАрдПрди, рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЖрджрд┐ рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдПред <br><br>  рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрд╡рдпрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ: <br> <code>%APPDATA%\Microsoft\SystemCertificates\My\Certificates\</code> <br>  рдФрд░ рдирд┐рдЬреА рдХреБрдВрдЬрд┐рдпрд╛рдБ, рдЬрд┐рдирдХреА рд╕рд╣рд╛рдпрддрд╛ рд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдпрд╛ рдЕрдиреНрдп рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рд╕рдВрдЪрд╛рд▓рди DPAPI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдкрде рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ рднреА рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">%APPDATA%\Roaming\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  рдирд┐рдЬреА рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдлрд┐рд░ рдЙрдкрд░реЛрдХреНрдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреАрдПрдлрдПрдХреНрд╕ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА, рд╕рд╛рде рд╣реА рдЙрд╕рдХреА рдПрд╕рдЖрдИрдбреА рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб (рдпрд╛ рдирд┐рдпрдВрддреНрд░рдХ рд╕реЗ рдПрдХ рдирд┐рдЬреА рдЖрд░рдПрд╕рдП рдХреБрдВрдЬреА) рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  Dpapick рдФрд░ рдпреВрдЬрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/tx/kf/bp/txkfbp91hcb6pg_rq7wgh8w7v5u.jpeg"><br><br>  рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рд╡реИрдХрд▓реНрдкрд┐рдХ rsaout рдкреИрд░рд╛рдореАрдЯрд░ рдЖрдкрдХреЛ PEM рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ RSA рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдмрд┐рдирд╛ рдПрдХ рдкреБрдирд░реНрдирд┐рд░реНрдорд┐рдд рдкреАрдПрдлрдПрдХреНрд╕ рдлрд╝рд╛рдЗрд▓ рд╣реИ, рдЬрд┐рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдЖрдпрд╛рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдкрдиреЗ рдЗрдЪреНрдЫрд┐рдд рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдпрджрд┐ рдЙрдкрд░реЛрдХреНрдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдХрдИ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдФрд░ рдирд┐рдЬреА рдХреБрдВрдЬреА рд╣реИрдВ, рддреЛ dpapick рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдХрдИ pxx рдлрд╛рдЗрд▓реЗрдВ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред <br><br>  рдЙрдЪрд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдбреЛрдореЗрди рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдорд╛рди рдХрд╛рд░реНрдп рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bkp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  рдбреЛрдореЗрди рдХреЗ "рдЪрд┐рдкреНрд╕" рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рдФрд░ </h3><br>  рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдбреЛрдореЗрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рддреЗ рд╣реБрдП, рдпрд╣ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд░реЛрдорд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕ рддрд░рд╣ рдХреА рдПрдХ рдЕрджреНрднреБрдд рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реИ - рдПрдХ рдбреЛрдореЗрди рдлрд╝рдВрдХреНрд╢рди рдЬрдм рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдбреЛрдореЗрди рдореЗрдВ "рдпрд╛рддреНрд░рд╛" рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ред  рд╡реЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдорд╢реАрди рд╕реЗ рдмрдВрдзреЗ рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рдЙрд╕ рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ "рдкрд╣реБрдВрдЪреЗрдВрдЧреЗ" рдЬрд┐рд╕ рдкрд░ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рдХрд░рддрд╛ рд╣реИред <br><br>  рдЬрдм рдпрд╣ "рд╕реБрд╡рд┐рдзрд╛" рдЪрд╛рд▓реВ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЖрдпрд╛рдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдкреНрд░рдорд╛рдгрдкрддреНрд░, рд╕рд╛рде рд╣реА рд╕рд╛рде рдЙрд╕рдХреА рд╕рднреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб, AD рдореЗрдВ рдЙрдбрд╝ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдЦрд╛рддрд╛ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: msPKIAccountCrdentailas рдФрд░ msPKIDIDAPIMasterKeysред <br><br>  рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ AD рдХреЗ рдЕрдВрджрд░ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, ldapsearch рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ: <br><br><pre> <code class="xml hljs">ldapsearch -x -h dc1.lab.local -D тАЬuser1@lab.local" -s sub "samAccountname=user1" ldapsearch -x -h dc1.lab.local -D "admin@lab.local" -s sub "samAccountname=anyuser"</code> </pre> <br><img src="https://habrastorage.org/webt/vl/sh/01/vlsh019lykontfubtr-g5rx__dc.jpeg"><br><br>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП DPAPI рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЙрдиреНрдирдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд┐рд╕реА рднреА рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХрдВрдкреНрдпреВрдЯрд░ рдЦрд╛рддрд╛ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред <br><br>  рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд░реЛрдорд┐рдВрдЧ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрдХрдиреАрдХ рд╣реИ рдЬреЛ рди рдХреЗрд╡рд▓ рдПрдбрдорд┐рдЯ рдХреЗ рд▓рд┐рдП рд╣реИ, рдмрд▓реНрдХрд┐ рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП рднреА рд╣реИред  рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ ldap рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк DPAPI (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдиреЗрдЯрд╡рд░реНрдХ рдбреНрд░рд╛рдЗрд╡ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░, рдЙрд╕рдХреЗ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдорд░реНрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдФрд░ dpapick рдореЗрдВ рдРрд╕реА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреНрдпреЛрдВ рдирд╣реАрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рд╣рдордиреЗ рд╕реЛрдЪрд╛ - рдФрд░ рдЙрд╕реЗ рд╕рд┐рдЦрд╛рдпрд╛ рдХрд┐ рдХреИрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ ldap рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рд╕реЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдирд┐рдХрд╛рд▓реЗрдВ, рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ рдФрд░ pfx рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред <br><br><pre> <code class="xml hljs">./efs.py тАУldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --password Password1 ./efs.py тАУldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><img src="https://habrastorage.org/webt/an/_p/bi/an_pbimm2jjr-iuapm945q43rzs.jpeg"><br><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рдПрдХ ldap рд╕рд░реНрд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЗрд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рд╡рд░рдг, рдЙрд╕ рдЦрд╛рддреЗ рдХрд╛ рдирд╛рдо рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА (рдирд┐рдпрдВрддреНрд░рдХ рдХреА рдПрдХ рдирд┐рдЬреА рдмреИрдХрдЕрдк рдХреБрдВрдЬреА) рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рд╣реЛрддрд╛ рд╣реИред <br><br><h3>  рдбреНрд░реЙрдкрдмреЙрдХреНрд╕ред  60 рд╕реЗрдХрдВрдб рдореЗрдВ рдЪрд▓рд╛ рдЧрдпрд╛ ... </h3><br>  рдбреНрд░реЙрдкрдмреЙрдХреНрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП DPAPI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг рд╣реИред  рдбреНрд░реЙрдкрдмреЙрдХреНрд╕ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЯреЛрдХрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ: <br><br><pre> <code class="bash hljs">c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance1\config.dbx c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  рдпреЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдпреБрдХреНрдд sqlite3 рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реИрдВред  рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП, рдПрдХ рд╕рдордорд┐рдд рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдмрджрд▓реЗ рдореЗрдВ DPAPI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br> <code>HKCU\SOFTWARE\Dropbox\ks <br> HKCU\SOFTWARE\Dropbox\ks1</code> <br> <br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдбреНрд░реЙрдкрдмреЙрдХреНрд╕ рдЕрдкрд╣рд░рдг рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рдХреНрд░рдо рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реИ: <br><br><ol><li>  рд╣рдо рдХрдВрдкреНрдпреВрдЯрд░ рд╕реЗ рджреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдлрд╛рдЗрд▓реЗрдВ рд▓реЗрддреЗ рд╣реИрдВ; </li><li>  рд╣рдореЗрдВ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗ рдЪрд╛рдмреА рдорд┐рд▓рддреА рд╣реИ рдФрд░ dpapick рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ; </li><li>  DPAPI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдЕрдкрдиреА рдорд╢реАрди рдкрд░ рдкреНрд░рд╛рдкреНрдд рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВ; </li><li>  рд╣рдорд╛рд░реА рдорд╢реАрди рдкрд░ рд╣рдо рдбреЗрдЯрд╛рдмреЗрд╕ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдбреНрд░реЙрдкрдмреЙрдХреНрд╕ рдЪрд▓рд╛рддреЗ рд╣реИрдВред </li></ol><br>  рдЖрдкрдХреЛ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЙрдкрд░реЛрдХреНрдд рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╢рд╛рдЦрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реИрдВред  рдЙрдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрдврд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рди рддреЛ рдкреНрд░рд╢рд╛рд╕рдХ рдФрд░ рди рд╣реА рд╕рд┐рд╕реНрдЯрдо рдЙрдиреНрд╣реЗрдВ рдкрдврд╝ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдПрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ) рдХреА рдУрд░ рд╕реЗ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рддрдХ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╢рд╛рдЦрд╛рдУрдВ рдкрд░ рдЙрдкрдпреБрдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдРрд╕рд╛ (рдкрд╛рд╡рд░рд╢реЗрд▓): <br><br><pre> <code class="xml hljs">$Sid="S-1-5-21-3463664321-2923530833-3546627382-1000"; $key=[Microsoft.Win32.Registry]::USERS.OpenSubKey("$sid\SOFTWARE\Dropbox\ks",[Microsoft.Win32.RegistryKeyPermissionCheck]::ReadWriteSubTree,[System.Security.AccessControl.RegistryRights]::ChangePermissions); $acl = $key.GetAccessControl(); $rule = New-Object System.Security.AccessControl.RegistryAccessRule ("administrator","FullControl","Allow"); $acl.SetAccessRule($rule); $key.SetAccessControl($acl); $key_path = "REGISTRY::HKEY_USERS\$Sid\SOFTWARE\Dropbox\ks"; (Get-ItemProperty -Path $key_path -Name Client).Client;</code> </pre> <br>  рдХреБрдВрдЬрд┐рдпрд╛рдБ ks рдФрд░ ks1 рдореЗрдВ DPAPI рдмреВрдБрдж рдФрд░ md5 HMAC DPAPI рдмреВрдБрдж (рдЕрдВрддрд┐рдо 16 рдмрд╛рдЗрдЯреНрд╕) рд╕реЗ рдкрд╣рд▓реЗ dbx рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╣реЗрдбрд░ (8 рдмрд╛рдЗрдЯреНрд╕) рд╣реЛрддреЗ рд╣реИрдВред  DPAPI рдмреВрдБрдж рдЕрдкрдиреЗ рдЖрдк 9 рд╡реАрдВ рдмрд╛рдЗрдЯ 0x01000000D0 рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ ... рдЗрди рдмрд╛рдЗрдЯреНрд╕ рдХреЛ рдмреЗрд╕ 64 рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ рдПрдХ рдлрд╛рдЗрд▓ рдореЗрдВ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ dpapick рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br><pre> <code class="xml hljs">./filegeneric.py --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --base64file <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  рдлрд┐рд░, рдЕрдкрдиреА рдорд╢реАрди рдкрд░, рдЖрдкрдХреЛ рд╣рдорд╛рд░реА рдорд╛рд╕реНрдЯрд░-рдХреА рдХреЗ рд╕рд╛рде рдЕрдВрддрд┐рдо рдЪрд░рдг рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдЙрдкрдпреБрдХреНрдд рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╢рд╛рдЦрд╛рдУрдВ рдореЗрдВ рдбрд╛рд▓рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП, рдкреЙрд╡рд░рд╢реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдмрд╕реЗ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ: <br><br><pre> <code class="xml hljs">$hdata="4efebbdf394d4003317fc5c357beac4b"; [Byte[]] $dv0_entropy = 0xd1,0x14,0xa5,0x52,0x12,0x65,0x5f,0x74,0xbd,0x77,0x2e,0x37,0xe6,0x4a,0xee,0x9b; $data = ($hdata -split "(?<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">=\G\w{2})(?=\w{2})"</span></span></span><span class="hljs-tag"> | %{ [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Convert</span></span></span><span class="hljs-tag">]</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">::ToByte</span></span></span><span class="hljs-tag">( $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">_</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">16</span></span></span><span class="hljs-tag"> ) }); </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Add-Type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-AssemblyName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security</span></span></span><span class="hljs-tag">; $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dk1</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[system.security.cryptography.protecteddata]::Protect($data,$dv0_entropy,[System.Security.Cryptography.DataProtectionScope]::CurrentUser);</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($dk1));$pr</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OBJ_hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">New-Object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security.Cryptography.HMACMD5</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">$OBJ_hmac.ComputeHash($dk1)</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($hmac));$pr</span></span></span></span></code> </pre> <br>  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, HData рд╡рд╣ рдХреБрдВрдЬреА рд╣реИ рдЬреЛ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдЪрд░рдг рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХреА рдЧрдИ рдереАред  DV0_entropy рдбреАрдкреАрдПрдкреАрдЖрдИ рдореЗрдВ рдбреАрдмреАрдУрдПрдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдПрдиреНрдЯреНрд░рд╛рдкреА рд╕реНрдерд┐рд░рд╛рдВрдХ рд╣реИред  рдкрд░рд┐рдгрд╛рдореА рдмреВрдБрдж рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕рд╛рдордиреЗ рд╕реЗ 8 рдмрд╛рдЗрдЯ рд╣реИрдбрд░ 0x00000000F6000000, рдФрд░ HMACMD5 + 0x00 рдХреЛ рдкреАрдЫреЗ рд╕реЗ рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ <br>  рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдЙрдЪрд┐рдд рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдбреЗрдЯрд╛ рд▓рд┐рдЦ тАЛтАЛрд╕рдХрддреЗ рд╣реИрдВред <br><br><h3>  DPAPI рдФрд░ RSA SecurID </h3><br>  RSA SecurID рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ RSA рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд рдПрдХ рдмрд╛рд░ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдЬрдирд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдпрд╣ рдмрдбрд╝реА рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рд▓реЛрдХрдкреНрд░рд┐рдп рдЪреАрдЬ рд╣реИ рдФрд░ рдХреЗрд╡рд▓ рдбреАрдкреАрдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ, рдХреЗрд╡рд▓ рдереЛрдбрд╝реА рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрд░рдПрд╕рдП рдЗрдВрдЬреАрдирд┐рдпрд░реЛрдВ рдиреЗ рднреНрд░рдорд┐рдд рд╣реЛрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ рдФрд░ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ DPAPI рдпреЛрдЬрдирд╛рдУрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ред <br><br>  рдЯреЛрдХрди рдбреЗрдЯрд╛ рдХреЛ рдлрд╝рд╛рдЗрд▓ <code>%LOCALAPPDATA%\RSA\SecurIDStorage</code> рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ sqlite3 рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдЯреЛрдХрди рдореЗрдВ рдЗрд╕рдХрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб EnTokenSid (рдХреЛрдб рдкреАрдврд╝реА рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЖрд░рдВрдн рдХреЗ рд▓рд┐рдП рдкреИрд░рд╛рдореАрдЯрд░) рд╣реЛрддрд╛ рд╣реИред  EnTokenSid DBKey, рдЯреЛрдХрди рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ SID рдХреЗ SID рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рдФрд░ DBKey рдкрд╣рд▓реЗ рд╕реЗ рд╣реА DPAPI рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди DBKeyEnc рджреНрд╡рд╛рд░рд╛ рдирд┐рдореНрди рдХреНрд░рдо рдореЗрдВ рдмрдирд╛рдИ рдЧрдИ рд╣реИ: <br> <code>DBKeyEnc = DPAPI(CurrenUser, DPAPI(LocalSystem(DBKey))</code> <br> <br>  рдпрд╛рдиреА  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, DB рдХреБрдВрдЬреА рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдкрд░рд┐рдгрд╛рдореА DPAPI рдмреВрдБрдж рдХреЛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рднреА CheckSum рд╕реЗ CryptoCheckSum рд╣реИ: <br>  CryptoCheckSum = DPAPI рдмреВрдБрдж (CurrenUser) <br><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЕрдкрдиреА рдорд╢реАрди рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд▓рдп рдХрд┐рдП рдЧрдП SecurIDStorage рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпрд╣ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: <br><br><ol><li>  рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ SID EncTokenSid рдХреЗ рдЧрдарди рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ, рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдкрд░ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ SID рдХреЛ рдЙрд╕реА рдорд╛рди рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЬрд┐рд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ SecurIDStorage рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  SysInternals рд╕реЗ рдиреНрдпреВрд╕рд┐рдб рдЙрдкрдпреЛрдЧрд┐рддрд╛ рд╣рдореЗрдВ рдЗрд╕рдореЗрдВ рдорджрдж рдХрд░реЗрдЧреА; </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рдбреЛрдореЗрди рдирд┐рдЬреА рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ DBKeyEnc рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ (рдпрджрд┐ рдорд╢реАрди рдПрдХ рдбреЛрдореЗрди рд╣реИ); </li><li>  рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдФрд░ DPAPI_SYSTEM рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд┐рдЫрд▓реЗ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ; </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CryptoCheckSum рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ </li><li>  рдЕрдкрдиреА рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд░рд┐рд╡рд░реНрд╕ рдСрд░реНрдбрд░ рдореЗрдВ рдкреНрд░рд╛рдкреНрдд DBKey рдФрд░ рдЪреЗрдХрд╕рдо рдорд╛рдиреЛрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ; </li><li>  SecurID рдХреЗ рдХреБрдЫ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ, рдЖрдкрдХреЛ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдХреЗ HDD рдЖрдХрд╛рд░ рдХреЛ рдЙрд╕реА рдЖрдХрд╛рд░ рдореЗрдВ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЬреИрд╕рд╛ рдХрд┐ рд╕реНрд░реЛрдд рдорд╢реАрди рдХреЗ HDD рдЖрдХрд╛рд░,  рдХрд╛рд░реНрдпрдХреНрд░рдо рдЗрд╕реЗ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкрд░ рдЬрд╛рдБрдЪрддрд╛ рд╣реИред </li></ol><br>  рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рдЕрд▓рд╛рд╡рд╛ DBKeyEnc рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рд╕рд╛рде рд╣реА рд╕рд╛рде DPAPI_SYSTEM, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВред  DAPPI_SYSTEM рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдЧрдард┐рдд рдПрдХ рдкреНрд░реАрдХреА рд╣реИ, рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рдЧрдарди рдореЗрдВ рднрд╛рдЧ рд▓реЗрддрд╛ рд╣реИред  рдЖрдк рдЗрд╕реЗ LSASS рдореЗрдореЛрд░реА (mimikatz рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдбрдВрдк рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдХреЗ) рдпрд╛ рд╕рдВрдмрдВрдзрд┐рдд рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╢рд╛рдЦрд╛рдУрдВ (HKLM \ SYSTEM, HKLM \ SECURITY) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рд╣реА Impacket рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдлрд┐рд░ рд╣рдо рдирд┐рдореНрди DPAPI_SYSTEM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ dpapick (parser рдЙрджрд╛рд╣рд░рдг / filegeneric.py) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╡рд╢реНрдпрдХ рдмреНрд▓рдмреНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><br>  1) mimikatz рдСрдлрд╝рд▓рд╛рдЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ DPAPI_SYSTEM рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ <br><br><img src="https://habrastorage.org/webt/ww/xi/ov/wwxiovhm-6gdcbn7tmmpr7-qsim.jpeg"><br><br>  2) Impacket рдСрдлрд╝рд▓рд╛рдЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ DPAPI_SYSTEM рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ <br><br><img src="https://habrastorage.org/webt/s7/9v/5g/s79v5gxvzjjccekaklg8gtefyfw.jpeg"><br><br>  3) рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде DPAPIck рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди <br><br><img src="https://habrastorage.org/webt/ip/th/qm/ipthqmqacvzvixntzgk_n1vsgvs.jpeg"><br><br><h3>  рдзреЛрдЦрд╛ рдХреА рдЪрд╛рджрд░ </h3><br>  рддрд╛рдХрд┐ рдЖрдк рд╡рд┐рд╢рд┐рд╖реНрдЯ рдбреЗрдЯрд╛ рдХреЗ рд╕реНрдерд╛рди рдХреЛ рди рднреВрд▓реЗрдВ, рд╣рдо рдЙрдиреНрд╣реЗрдВ рдПрдХ рдЕрд▓рдЧ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд░рдЦреЗрдВрдЧреЗ: <br><br>  <b>рдХрд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА</b> <br><br><pre> <code class="bash hljs">%APPDATA%\Microsoft\Protect\&lt;SID&gt;\*</code> </pre> <br>  <b>рд╕рд┐рд╕реНрдЯрдо рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА</b> <br><br><pre> <code class="bash hljs">Windows\System32\Microsoft\Protect\*</code> </pre> <br>  <b>DPAPI_SYSTEM</b> <br><br><pre> <code class="bash hljs">LSASecrets тАУ online SYSTEM, SECURITY (reg save тАж, system\backup, etc)</code> </pre> <br>  <b>рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░</b> <br><br><pre> <code class="bash hljs">%APPDATA%\Microsoft\SystemCertificates\My\Certificates\ %APPDATA%\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  <b>рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдорд╛рдг рдкрддреНрд░</b> <br><br><pre> <code class="bash hljs">HKLM:\SOFTWARE\Microsoft\SystemCertificates\MY\Certificates\* C:\Programdata\Microsoft\Crypto\RSA\MachineKeys\</code> </pre> <br>  <b>рдХреНрд░реЛрдо</b> <br><br><pre> <code class="bash hljs">%localappdata%\Google\Chrome\User Data\Default\Cookies %localappdata%\Google\Chrome\User Data\Default\Login Data</code> </pre> <br>  <b>рдбреНрд░реЙрдкрдмреЙрдХреНрд╕</b> <br><br><pre> <code class="bash hljs">HKCU\SOFTWARE\Dropbox\ks HKCU\SOFTWARE\Dropbox\ks1 %APPDATA%\Local\Dropbox\instance1\config.dbx %APPDATA%\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  <b>Rsa securid</b> <br><br><pre> <code class="bash hljs">%LOCALAPPDATA%\RSA\SecurIDStorage</code> </pre> <br><h3>  рдереЛрдбрд╝рд╛ рдирд┐рд╖реНрдХрд░реНрд╖ </h3><br>  DPAPI рдПрдХ рднрд╡реНрдп рдЪреАрдЬ рд╣реИ - рдореБрдЦреНрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреЗрдВрдЯреНрд╕ рдФрд░ рд░реЗрдбрдЯреИрдо рдЕрдзреНрдпрдпрди рдХрд░рддреЗ рд╕рдордп рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдордиреЗ рдХреЗрд╡рд▓ рдХреБрдЫ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдкрд░ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╣рд╛рдВ DPAPI рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рджрд╛рдпрд░рд╛ рдмрд╣реБрдд рд╡реНрдпрд╛рдкрдХ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ RDP (* .rdg), Icloud (pList рдлрд╝рд╛рдЗрд▓), Skype (*ред Xml), рд╡рд╛рдИ-рдлрд╛рдИ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдХреБрдВрдЬреА рдкрд░ рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ред  рд╣рд░ рдЬрдЧрд╣ DPAPI рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реА рдкрд╛рд░реНрд╕рд░ рдХреЛ dpapick рдврд╛рдВрдЪреЗ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд╣рдорд╛рд░реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitHub</a> рдкрд░ dpapick рдХрд╛ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдЙрдкрд▓рдмреНрдз <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред  рд╣рдо рдЖрдкрд╕реЗ DPAPI рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдЖрдЧреНрд░рд╣ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╣рдо dpapick рдХреЗ рдЖрдЧреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЖрднрд╛рд░реА рд╣реЛрдВрдЧреЗред <br><br>  рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреЗрд▓реАрдЧреНрд░рд╛рдо</a> рдореЗрдВ рд╣рдорд╛рд░реЗ рдЪреИрдирд▓ рдореЗрдВ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓ рд╕рдХрддреА рд╣реИред  рд╣рдо RedTeam рдХреА рдЖрдВрдЦреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдИрдмреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддреЗ рд╣реИрдВред <br><br>  PS рдПрдХ рд╢рд╛рдВрдд рд╕рдореНрдореЗрд▓рди рдХреЗ рд▓рд┐рдП OFFZONE-2018 рдХреЗ рдЖрдпреЛрдЬрдХреЛрдВ рдХреЛ рдзрдиреНрдпрд╡рд╛рдж! <br><br>  PPS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рд▓реЗрдЦ рдХрд╛ рджреВрд╕рд░рд╛ рднрд╛рдЧ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi434514/">https://habr.com/ru/post/hi434514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi434504/index.html">20 рд╕рд╛рд▓ рдХреА рдлрд╛рд╕реНрдЯ рд░рд┐рдкреЛрд░реНрдЯреНрд╕ "рдЙрддреНрдкрд╛рдж рдПрдХ рд╕рд╛рдВрд╕ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рдмрд╕ рдЙрдЪреНрдЪ ..."</a></li>
<li><a href="../hi434506/index.html">Microsoft Store рдореЗрдВ рдПрдХ рд╡реАрдбрд┐рдпреЛ рд╕рдВрдкрд╛рджрди рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдЕрдиреБрднрд╡ рдХрд░реЗрдВ</a></li>
<li><a href="../hi434508/index.html">рдбрд╛рд░реНрдХ рд╕рд╛рдЗрдб рдСрдлрд╝ рд╕рд░реНрдЪ рдЗрдВрдЬрди рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ: рдХреИрд╕реЗ рдФрд░ рдХреНрдпреЛрдВ Google рд╣рдорд╛рд░реА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi434510/index.html">рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдкрд╛рдпрдерди рд╕реЗ RabbitMQ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
<li><a href="../hi434512/index.html">рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдХреЙрд░реНрдкреЛрд░реЗрдЯ</a></li>
<li><a href="../hi434516/index.html">рдЕрдкрдиреЗ рдХреИрд░рд┐рдпрд░ рдХреА рдЖрдХрд╛рдВрдХреНрд╖рд╛рдУрдВ рд╕реЗ рдирд┐рдкрдЯрдиреЗ рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ред</a></li>
<li><a href="../hi434518/index.html">рддрд╛рд▓рд┐рдпрд╛рдБ рдФрд░ рдЬрдпрдХрд╛рд░: рдРрдкреНрдкрд▓ рд╕реНрдЯреЛрд░реНрд╕ рдореЗрдВ рдзреНрдпрд╛рди рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╛рдЯрдХ</a></li>
<li><a href="../hi434522/index.html">рдХрд╛рд░реНрдп рдФрдЪрд┐рддреНрдп рдкреИрдЯрд░реНрди рдФрд░ рдПрдВрдЯреАрдкреИрдЯрд░реНрди</a></li>
<li><a href="../hi434524/index.html">рдПрдХ рд╢реБрд░реБрдЖрдд рдХреА рдЖрдБрдЦреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Kubernetes Ingress</a></li>
<li><a href="../hi434528/index.html">рдкреЛрд╕реНрдЯрдХрд╛рд░реНрдб рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рд░реЗ рдЯреНрд░реЗрд╕рд░ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>