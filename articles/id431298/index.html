<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸˆ¹ â—¼ï¸ ğŸ“‚ Validasi keunikan sejati ğŸ”Š â—€ï¸ âœŠğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setiap peretas yang telah bekerja dengan Ruby On Rails terbiasa dengan ORM ActiveRecord . Kami akan membahas salah satu validasi yang diusulkan di lua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Validasi keunikan sejati</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431298/"> Setiap peretas yang telah bekerja dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ruby On Rails</a> terbiasa dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ORM</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ActiveRecord</a> .  Kami akan membahas salah satu validasi yang diusulkan di luar kotak, yaitu, validasi untuk keunikan, dan mengapa permata <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">database_validations</a> akan menyimpan konsistensi database Anda. <br><a name="habracut"></a><br>  Katakanlah Anda memiliki model pengguna dengan keunikan di bidang <i>email</i> , mis. <br><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; ApplicationRecord </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validates</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uniqueness</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  Anda mungkin sudah tahu bahwa validasi ini melakukan permintaan berikut <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> email = $<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  setiap kali kami mencoba menyimpan catatan dalam basis data. <br><br>  Pendekatan ini memiliki beberapa kelemahan: <br><br>  <b>Pertama</b> , eksekusi permintaan tambahan, dan jika beberapa validasi keunikan diinisialisasi dalam model, permintaan akan dieksekusi untuk masing-masing.  Ini tidak efisien, dan juga memerlukan indeks jika kita ingin query ini dieksekusi dengan cepat. <br><br>  <b>Kedua</b> , solusi ini tidak menjamin keunikan karena kemungkinan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">perlombaan untuk data</a> .  Beberapa operasi kompetitif dapat secara bersamaan belajar tentang tidak adanya catatan khusus, sebagai akibatnya, untuk menyimpan data yang sama. <br><br>  Tentu saja, kasus yang jarang terjadi dengan perlombaan data dapat diatasi dengan menambahkan kendala keunikan di tingkat basis data.  Tetapi dalam kasus ini, Anda tidak akan mendapatkan kesalahan validasi, kueri ke database hanya akan jatuh dan seluruh transaksi akan dibatalkan. <br><br>  Dalam situasi ini, gem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">database_validations</a> akan membantu, yang menyediakan kompatibilitas antara pembatasan dan validasi basis data. <br><br>  Arti utama permata disajikan dalam kode berikut: <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(options = {})</span></span></span></span> ActiveRecord::Base.connection.transaction(<span class="hljs-symbol"><span class="hljs-symbol">requires_new:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">rescue</span></span> ActiveRecord::RecordNotUnique =&gt; e Helpers.handle_unique_error!(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, e) <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  Jadi, kami mencoba untuk menyimpan data, jika semua validasi lain dilewatkan, jika transaksi jatuh dan gulung balik, kami mengurai kesalahan dan menetapkan nilai yang benar untuk <code>errors</code> objek kami. <br><br>  Setelah meninjau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tolok ukur</a> , kita dapat menyimpulkan bahwa permata ini akan mempercepat proses menyimpan catatan ke database setidaknya dua kali. <br><br>  Berkat dukungan database seperti <i>PostgreSQL</i> , <i>SQLite</i> , <i>MySQL</i> , dan kompatibilitas mundur dengan <code>validates_uniqueness_of</code> , proses penggantian dengan <code>validates_db_uniqueness_of</code> membutuhkan waktu beberapa menit. <br><br>  Pencocokan berguna untuk RSpec juga hadir di luar kotak: <br><br><pre> <code class="ruby hljs">specify <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> expect(described_class) .to validate_db_uniqueness_of(<span class="hljs-symbol"><span class="hljs-symbol">:field</span></span>) .with_message(<span class="hljs-string"><span class="hljs-string">'duplicate'</span></span>) .with_where(<span class="hljs-string"><span class="hljs-string">'(some_field IS NULL)'</span></span>) .scoped_to(<span class="hljs-symbol"><span class="hljs-symbol">:another_field</span></span>) .with_index(<span class="hljs-symbol"><span class="hljs-symbol">:unique_index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Saat beralih ke validasi baru, Anda harus memiliki batasan pada keunikan dalam database, tetapi jika belum ada, gem akan menunjukkan ini saat aplikasi dimulai. <br><br>  Permata diuji pada aplikasi dengan 100+ validasi untuk keunikan di antara 50+ model. <br><br>  Gunakan permata dan bagikan pendapat Anda.  Setiap kontribusi untuk pengembangan lebih lanjut dipersilahkan! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431298/">https://habr.com/ru/post/id431298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431288/index.html">Pertempuran untuk Pemeriksaan Konsumen: Ulasan Walmart dan Amazon</a></li>
<li><a href="../id431290/index.html">Madrobots 2 Black Friday Week: Tiga Hari</a></li>
<li><a href="../id431292/index.html">Implementasi sistem GTD berdasarkan fitur baru Google Keep and Calendar</a></li>
<li><a href="../id431294/index.html">Korespondensi antara batasan dan validasi basis data</a></li>
<li><a href="../id431296/index.html">Peran emosional dalam permainan. Narasi yang kompeten dan keterlibatan dalam arus</a></li>
<li><a href="../id431300/index.html">Tiga tahun sertifikasi tanpa pemimpin - penerbangan normal</a></li>
<li><a href="../id431302/index.html">Membuat antena sonar sederhana dari tempat sampah</a></li>
<li><a href="../id431304/index.html">Mencari bayangan yang menjanjikan untuk roguelike</a></li>
<li><a href="../id431306/index.html">Cara membangun piramida di trunk atau aplikasi Development-Driven Development di Spring Boot</a></li>
<li><a href="../id431308/index.html">Innotrans 2018: transportasi kereta seperti apa yang akan besok?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>