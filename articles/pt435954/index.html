<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèº üö° „Ä∞Ô∏è Desenvolvimento de m√≥dulos para bonecos com kit de desenvolvimento de bonecos ü¶ä ü§µüèª üåµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° cerca de um m√™s, tive uma escolha: escrever o m√≥dulo para o fantoche "na mesa" (ou seja, para a infraestrutura interna) ou torn√°-lo universal, abri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento de m√≥dulos para bonecos com kit de desenvolvimento de bonecos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435954/"><p>  H√° cerca de um m√™s, tive uma escolha: escrever o m√≥dulo para o fantoche "na mesa" (ou seja, para a infraestrutura interna) ou torn√°-lo universal, abrir o c√≥digo-fonte e public√°-lo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Puppet Forge</a> .  Obviamente, seria mais r√°pido e f√°cil desenhar rapidamente 2-3 aulas para voc√™ e se acalmar, mas a experi√™ncia adquirida no processo de publica√ß√£o do m√≥dulo √© valiosa e eu quero compartilh√°-lo.  No RuNet, n√£o h√° informa√ß√µes sobre o uso do kit de desenvolvimento de marionetes (doravante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PDK</a> ); portanto, voc√™ pode considerar esse tipo de tutorial. </p><br><h2 id="o-chyom-statya">  Sobre o que √© o artigo </h2><br><p>  No processo de desenvolvimento de um m√≥dulo (ou melhor, dois), descobri o PDK, que facilita muito o desenvolvimento e a manuten√ß√£o de m√≥dulos.  Ou seja: </p><br><ul><li> Formate automaticamente <code>metadata.json</code> ao atualizar pela √∫ltima vez </li><li>  Gera√ß√£o de configura√ß√£o para v√°rios sistemas de IC que podem fazer o seguinte: <br><ul><li>  Verificando o c√≥digo ruby ‚Äã‚Äãcom o rubocop linter </li><li>  Execu√ß√£o de testes de unidade </li><li>  Sob certas condi√ß√µes - preenchimento autom√°tico do c√≥digo de trabalho da forja de marionetes </li></ul></li><li>  Gerando documenta√ß√£o baseada em tags nos coment√°rios usando o yard </li><li>  Placa <code>[PDK]</code> para o m√≥dulo na forja de marionetes.  Um pouco, mas legal! </li></ul><br><p>  Todos os interessados <a name="habracut"></a>  Eu pe√ßo um gato! </p><br><h4 id="v-kachestve-primerov">  Como exemplos </h4><br><p>  Se voc√™ quiser ver e sentir o que se entende durante o processo de leitura, poder√° abrir um dos dois (ou ambos) m√≥dulos mencionados: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">clickhouse</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">xmlsimple</a> .  Ambos foram desenvolvidos usando o PDK e outras ferramentas descritas no artigo. </p><br><h2 id="soderzhanie">  Conte√∫do </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sobre o que √© o artigo</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como exemplos</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que √© PDK</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Instala√ß√£o</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conte√∫do PDK</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Crie um m√≥dulo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nova classe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">new defined_type</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">novo provedor e tarefa</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gerando documenta√ß√£o com strings de marionetes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Personaliza√ß√£o de modelo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Executando v√°rios IC</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">B√¥nus: escrevemos testes de unidade para classes, tipos e fun√ß√µes</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Em vez de sa√≠da</a> </li></ul><br><h1 id="chto-zhe-takoe-pdk">  O que √© PDK </h1><br><p>  A partir da documenta√ß√£o oficial: </p><br><blockquote>  Crie um m√≥dulo completo com classes, tipos definidos e tarefas, e teste e valide seu trabalho √† medida que avan√ßa.  O PDK fornece uma estrutura completa de m√≥dulos, modelos para classes, tipos e tarefas definidos e uma infraestrutura de teste.  Voc√™ pode validar e testar seu m√≥dulo em rela√ß√£o a v√°rios sistemas operacionais e v√°rias vers√µes do Puppet. </blockquote><p>  Na minha tradu√ß√£o gratuita: </p><br><blockquote>  Permite criar um m√≥dulo completo com classes, tipos, tarefas e testes para verificar a opera√ß√£o do m√≥dulo.  O PDK fornece uma estrutura completa e modelos para todos os itens acima.  Usando esta ferramenta, voc√™ pode verificar o funcionamento do m√≥dulo com v√°rias vers√µes do fantoche, bem como em v√°rios sistemas operacionais. </blockquote><p>  Parece bom?  Bem, √© assim que realmente √©.  At√© o momento em que comecei a trabalhar no m√≥dulo, que foi decidido escrever imediatamente para c√≥digo aberto, n√£o suspeitava dessa ferramenta e agora pretendo transferir toda a infraestrutura interna para usar o PDK. </p><br><p>  Descreverei como coloc√°-lo e quais ferramentas e comandos ele cont√©m. </p><br><h2 id="ustanovka">  Instala√ß√£o </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A p√°gina de instala√ß√£o oficial</a> .  Com esse link, voc√™ quase garante a maneira correta de instalar o PDK em seu host.  Se, por algum motivo, voc√™ n√£o tiver sorte e seu sistema operacional n√£o estiver l√°, sempre haver√° uma rotat√≥ria no formul√°rio: </p><br><pre> <code class="bash hljs">gem install pdk</code> </pre> <br><p>  De fato, o PDK √© apenas uma j√≥ia, e √© assim definido. </p><br><h2 id="soderzhimoe-pdk">  Conte√∫do PDK </h2><br><p>  Em geral, o PDK nada mais √© do que um conjunto de gemas para facilitar o desenvolvimento do m√≥dulo.  Ele cont√©m as seguintes ferramentas: </p><br><table><thead><tr><th>  Utilit√°rio </th><th>  Descri√ß√£o do produto </th></tr></thead><tbody><tr><td>  metadata-json-lint </td><td>  Verifica metadata.json para encontrar guias de estilo de fantoche correspondentes </td></tr><tr><td>  pdk </td><td>  Uma ferramenta para gerar e testar m√≥dulos e seu conte√∫do (classes, tipos, etc.) na linha de comando </td></tr><tr><td>  marionete </td><td>  Verifica o c√≥digo do fantoche para obter os guias de estilo do Puppet Language </td></tr><tr><td>  sintaxe do fantoche </td><td>  Verifique a sintaxe do manifesto </td></tr><tr><td>  puppetlabs_spec_helper </td><td>  Fornece classes, m√©todos e tarefas Rake para testes de especifica√ß√£o de c√≥digo fantoche </td></tr><tr><td>  rspec-puppet </td><td>  Testa o comportamento do fantoche ao compilar manifestos no diret√≥rio de recursos (?) </td></tr><tr><td>  fatos-fantoche-rspec </td><td>  Permite executar rspec-puppet com fatos de fantoche especificados pelo usu√°rio </td></tr></tbody></table><br><h2 id="sozdayom-modul">  Crie um m√≥dulo </h2><br><p>  PDK instalado, agora voc√™ pode brincar.  O comando mais simples da <code>pdk help</code> exibir√° os comandos dispon√≠veis.  Suponha que estamos na pasta onde voc√™ tem todos os outros m√≥dulos.  Ent√£o vamos criar um novo: </p><br><pre> <code class="plaintext hljs">$ pdk new module --template-url=https://github.com/puppetlabs/pdk-templates.git *** We need to create the metadata.json file for this module, so we're going to ask you 5 questions. *** [Q 1/5] If you have a name for your module, add it here. --&gt; dummy [Q 2/5] If you have a Puppet Forge username, add it here. --&gt; felixoid [Q 3/5] Who wrote this module? --&gt; Mikhail f. Shiryaev [Q 4/5] What license does this module code fall under? --&gt; MIT [Q 5/5] What operating systems does this module support? --&gt; RedHat based Linux, Debian based Linux, Windows Metadata will be generated based on this information, continue? Yes pdk (INFO): Module 'dummy' generated at path '/tmp/dummy', from template 'https://github.com/puppetlabs/pdk-templates.git'.</code> </pre> <br><p>  O utilit√°rio faz perguntas para preencher o arquivo metadata.json e, na sa√≠da, temos exatamente o que √© indicado: o m√≥dulo e os arquivos auxiliares compilados a partir de modelos do git. </p><br><p>  Uma pequena observa√ß√£o - os temlites mudam com bastante frequ√™ncia, incluindo alguns bugs cr√≠ticos que foram corrigidos recentemente.  Portanto, √© melhor usar n√£o os padr√µes do PDK instalado, mas a vers√£o mais recente.  √â verdade que h√° um outro lado: ao usar o argumento <code>--template-url</code> , o PDK adiciona esse par√¢metro ao <code>~.pdk/cache/answers.json</code> e, a julgar pelos atrasos na execu√ß√£o posterior de qualquer um dos comandos <code>pdk</code> , tenta baix√°-los.  Portanto, remova esse par√¢metro de <code>answers.json</code> ou n√£o o utilize ao criar um m√≥dulo e altere-o em <code>metadata.json</code> . </p><br><p>  Vamos seguir as etapas adicionais que podem ser executadas usando o PDK. </p><br><h3 id="new-class">  nova classe </h3><br><pre> <code class="plaintext hljs">$ pdk new class dummy::class pdk (INFO): Creating '/tmp/dummy/manifests/class.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/classes/class_spec.rb' from template. $ cat manifests/class.pp # A description of what this class does # # @summary A short summary of the purpose of this class # # @example # include dummy::class class dummy::class { } $ cat spec/classes/class_spec.rb require 'spec_helper' describe 'dummy::class' do on_supported_os.each do |os, os_facts| context "on #{os}" do let(:facts) { os_facts } it { is_expected.to compile } end end end</code> </pre> <br><p>  Este comando cria 2 arquivos: o pr√≥prio manifesto para a classe e o arquivo spec para test√°-lo.  Vou me debru√ßar sobre as tags para documenta√ß√£o mais tarde em mais detalhes. </p><br><h3 id="new-defined_type">  new defined_type </h3><br><pre> <code class="plaintext hljs">$ pdk new defined_type type pdk (INFO): Creating '/tmp/dummy/manifests/type.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/defines/type_spec.rb' from template.</code> </pre> <br><p>  Mesmo assim: manifesto para o tipo de recurso e o arquivo de especifica√ß√£o. </p><br><h4 id="new-provider--task">  novo provedor e tarefa </h4><br><p>  O PDK tamb√©m pode criar um novo provedor ou tarefa, mas eu n√£o trabalhei em estreita colabora√ß√£o com eles, por isso vou dizer honestamente que, se necess√°rio, √© melhor estudar esse t√≥pico mais profundamente por conta pr√≥pria. </p><br><h2 id="generaciya-dokumentacii-pri-pomoschi-puppet-strings">  Gerando documenta√ß√£o com strings de marionetes </h2><br><p>  Eu realmente n√£o entendo por que as <code>puppet strings</code> n√£o <code>puppet strings</code> parte do kit de ferramentas do PDK, mas isso √© a la vie.  Se, durante o desenvolvimento, voc√™ colocou corretamente as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tags</a> para o quintal, existem 2 maneiras principais de fornecer documenta√ß√£o ao usu√°rio: </p><br><ul><li>  Gere-o como HTML / Markdown / JSON e coloque-o ao lado do c√≥digo.  Isso √© feito com o comando <code>puppet string generate [--format FORMAT]</code> , onde o formato pode ser omitido ou definido como <code>json</code> / <code>markdown</code> . <br><ul><li>  √â habitual ter o arquivo <code>REFERENCE.md</code> na raiz do reposit√≥rio como o padr√£o de documenta√ß√£o, gerado pelas <code>puppet strings generate --format markdown</code> . </li></ul></li><li>  Publique no reposit√≥rio com o c√≥digo (desde que esteja no github) github-pages.  Isso √© bastante simples, voc√™ precisa de 3 comandos: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Gemfile.lock,    PDK rm -f Gemfile.lock #     Gemfile   bundle bundle install --path vendor/bundle #   gh-pages   rake-task bundle exec rake strings:gh_pages:update</span></span></code> </pre> </li></ul><br><p>  Parece n√£o haver m√°gica, mas na sa√≠da temos um m√≥dulo com instru√ß√µes.  A vantagem √© que, mesmo que voc√™ n√£o descreva, digamos, cada um dos par√¢metros usando a tag <code>@param</code> , a sa√≠da ainda ser√° uma classe / tipo / fun√ß√£o com uma descri√ß√£o m√≠nima dos par√¢metros com o tipo e o valor padr√£o.  Na minha humilde opini√£o, mesmo isso √© melhor que nada e tornar√° o m√≥dulo mais atraente para o uso. </p><br><p>  Obviamente, tudo isso pode ser automatizado e adicionado como um est√°gio de IC.  Isso seria perfeito.  Minhas m√£os ainda n√£o chegaram, mas est√£o acumulando poeira na lista de pend√™ncias.  Se de repente algu√©m tiver algo a dizer sobre esse assunto - ficarei grato.  Como pensamentos: pelo menos, adicione uma verifica√ß√£o para ver se REFERENCE.md muda ap√≥s executar as seq√º√™ncias de marionetes.  E, se assim for, considere que os testes falharam. </p><br><h2 id="nastroyka-shablonov">  Personaliza√ß√£o de modelos </h2><br><p>  A documenta√ß√£o para modelos est√° localizada no reposit√≥rio <a href="">pdk-templates</a> .  Em resumo, tudo √© configurado usando o arquivo <code>.sync.yml</code> no diret√≥rio raiz do m√≥dulo, e as altera√ß√µes s√£o aplicadas usando o comando <code>pdk update</code> .  Cada um dos par√¢metros deste arquivo √© o nome de outro arquivo no diret√≥rio do m√≥dulo, que deve ser alterado de uma maneira ou de outra.  A maioria dos par√¢metros para cada um dos modelos tive que selecionar "por toque", olhando o c√≥digo fonte, frequentemente - por tentativa e erro.  A documenta√ß√£o aqui √†s vezes fica muito atr√°s.  Infelizmente, n√£o h√° quase mais nada a dizer, exceto dar um link para <a href="">um exemplo</a> do seu pr√≥prio reposit√≥rio. </p><br><p>  Descreverei rapidamente alguns par√¢metros que foram alterados usando o <code>.sync.yml</code> do exemplo acima: </p><br><ul><li>  <code>Gemfile</code> : duas <code>Gemfile</code> foram adicionadas como depend√™ncias em diferentes grupos: pdk no grupo de desenvolvimento;  xml-simple no grupo de depend√™ncias.  Ao iniciar os testes, o grupo system_tests n√£o est√° instalado, ent√£o adiciono a depend√™ncia a outro grupo. </li><li>  <code>spec/spec_helper.rb</code> : o m√©todo moking foi alterado, o limite m√≠nimo de cobertura de teste foi adicionado, abaixo do qual os testes s√£o considerados falhos. </li><li>  <code>.travis.yml</code> : esse arquivo foi polido por um longo tempo, pois √© usado para verificar a base de c√≥digo e carregar o m√≥dulo finalizado no puppet-forge.  Altera√ß√µes: <br><ul><li>  Usu√°rio e senha criptografada para preencher o m√≥dulo na marionete-forja.  Voc√™ pode ler mais sobre como implantar marionetes com Travis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </li><li>  Uma sequ√™ncia de testes foi criada ‚Üí implanta√ß√£o com o lan√ßamento deste √∫ltimo apenas com testes bem-sucedidos. </li><li>  Adicionado o est√°gio de implanta√ß√£o do m√≥dulo no fantoche-forja, desde que o IC seja iniciado a partir da tag come√ßando com o caractere "v". </li></ul></li><li>  <code>Rakefile</code> : adicionadas algumas exce√ß√µes para o linter. </li></ul><br><h2 id="zapusk-razlichnyh-ci">  Executando v√°rios IC </h2><br><p>  Tudo √© bem simples aqui.  Imediatamente ap√≥s a gera√ß√£o do m√≥dulo usando o PDK, a valida√ß√£o inicia no appveyor, travis e gitlab-ci.  Para executar os testes, tudo est√° pronto imediatamente, para o ajuste, o mesmo <code>.sync.yml</code> .  N√£o tenho prefer√™ncias particulares, portanto n√£o recomendarei nada.  Basta usar o que for mais conveniente. </p><br><h2 id="bonus-pishem-yunit-testy-dlya-klassov-tipov-i-funkciy">  B√¥nus: escrevemos testes de unidade para classes, tipos e fun√ß√µes </h2><br><p>  Esse ponto vai um pouco al√©m do material b√°sico que planejei descrever, mas me parece muito √∫til. </p><br><p>  Portanto, temos um m√≥dulo com manifestos e uma biblioteca que, por sua vez, cont√©m classes, tipos e fun√ß√µes (tamb√©m n√£o esquecemos as tarefas e os provedores, mas n√£o tenho nenhum conhecimento nesta parte).  Como existe qualquer c√≥digo com o objetivo de alterar, seria bom, obviamente, cobri-lo com testes para garantir duas coisas: </p><br><ul><li>  As mudan√ßas n√£o quebram o comportamento atual (ou o comportamento muda com os testes) </li><li>  Seus manifestos fazem exatamente o que voc√™ espera e usam todos os recursos que voc√™ espera. </li></ul><br><p>  O Puppetlabs fornece uma extens√£o para a estrutura rspec chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">puppet-rspec</a> .  Links para a documenta√ß√£o para testar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classes</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipos</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√µes</a> .  N√£o tenha pregui√ßa de olhar de perto, existem outras se√ß√µes. </p><br><p>  Para come√ßar a us√°-lo, √© bastante simples, sem sequer conhecer o ruby.  Se classes ou tipos foram criados, como mostrado acima, usando <code>pdk new &lt;thing&gt;</code> , o arquivo <code>*_spec.rb</code> tamb√©m j√° existe.  Ent√£o, suponha que tenhamos uma <code>dummy::class</code> .  Para test√°-lo, um arquivo <code>spec/classes/class_spec.rb</code> deve ser criado com o seguinte conte√∫do: </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'spec_helper'</span></span> describe <span class="hljs-string"><span class="hljs-string">'dummy::class'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> on_supported_os.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|os, os_facts|</span></span> context <span class="hljs-string"><span class="hljs-string">"on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{os}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) { os_facts } it { is_expected.to compile } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Voc√™ pode verificar executando a <code>pdk test unit</code> no diret√≥rio raiz do m√≥dulo. </p><br><p>  Isso √© quase tudo o que precisamos.  Agora resta suplementar <code>class_spec.rb</code> <code>is_expected</code> necess√°rio com as condi√ß√µes apropriadas.  Por exemplo, para verificar se a classe cont√©m o recurso <code>file {'/file/path': }</code> com determinados par√¢metros, voc√™ pode fazer isso: </p><br><pre> <code class="ruby hljs">it <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> is_expected.to contain_file(<span class="hljs-string"><span class="hljs-string">'/file/path'</span></span>).with( <span class="hljs-string"><span class="hljs-string">'ensure'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'file'</span></span>, <span class="hljs-string"><span class="hljs-string">'mode'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0644'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Voc√™ pode definir par√¢metros de classe usando <code>let(:params) { {'param1' =&gt; 'value'} }</code> , √© poss√≠vel realizar testes sob v√°rias condi√ß√µes de entrada colocando cada <code>it</code> dentro das se√ß√µes selecionadas do <code>context 'some description' {}</code> .  √â poss√≠vel verificar ambas as depend√™ncias entre recursos e entre classes: se for assumido, por exemplo, que a declara√ß√£o de classe cont√©m <code>inherits</code> , voc√™ poder√° adicionar a verifica√ß√£o <code>is_expected.to contain_class('parent_class_name')</code> .  Precisa testar o comportamento em diferentes sistemas operacionais  Tamb√©m √© poss√≠vel: simplesmente indicamos em um contexto separado os fatos necess√°rios: </p><br><pre> <code class="ruby hljs">context <span class="hljs-string"><span class="hljs-string">'with Debian'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">os:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">architecture:</span></span> <span class="hljs-string"><span class="hljs-string">'amd64'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">distro:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">codename:</span></span> <span class="hljs-string"><span class="hljs-string">'stretch'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">family:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, <span class="hljs-symbol"><span class="hljs-symbol">selinux:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">enabled:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">osfamily:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> it { is_expected.to something } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Em geral, tanto quanto consegui notar no processo de escrever testes, a estrutura permite verificar quase tudo o que for necess√°rio.  E a presen√ßa de testes uma vez me ajudou quando alguns par√¢metros foram movidos das classes filho para a classe superior do m√≥dulo: eles mostraram que a refatora√ß√£o n√£o quebrou nada e o comportamento de todo o m√≥dulo n√£o mudou. </p><br><h1 id="vmesto-vyvoda">  Em vez de sa√≠da </h1><br><p>  Como j√° pode ser entendido a partir da entona√ß√£o geral do artigo, estou muito encorajado pelo quanto o Puppet facilitou o trabalho com os m√≥dulos e se manifesta gra√ßas ao PDK.  As a√ß√µes de rotina s√£o automatizadas, os modelos s√£o usados ‚Äã‚Äãsempre que poss√≠vel, as configura√ß√µes para o IC popular est√£o dispon√≠veis imediatamente.  Pode parecer uma esp√©cie de sobrecarga, e o uso pode n√£o trazer a fruta esperada, mas definitivamente vale a pena.  Se voc√™ comparar como desenvolver m√≥dulos sem e com PDK, ent√£o, para mim, ser√° assim: </p><br><table><thead><tr><th>  Desenvolvimento sem <del>  barbas </del>  PDK </th><th>  Desenvolvimento PDK </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/webt/hb/gg/xd/hbggxdj1znic1fgofyl-sb3oz0c.jpeg" width="300"></td><td><img src="https://habrastorage.org/webt/rw/4n/j-/rw4nj-vux8ricpk46hih5iu_3js.jpeg" width="300"></td></tr></tbody></table><br><p>  Tente, coloque, facilite a vida para voc√™ e seus colegas.  Ficarei feliz em responder a poss√≠veis perguntas. </p><br><p>  Que a atomatiza√ß√£o esteja conosco! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt435954/">https://habr.com/ru/post/pt435954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt435944/index.html">Food Design Digest, dezembro de 2018</a></li>
<li><a href="../pt435946/index.html">Termovisor DIY em Raspberry PI ou "Agora acho que sei o que farei neste ver√£o"</a></li>
<li><a href="../pt435948/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 23: Economia da Seguran√ßa, Parte 3</a></li>
<li><a href="../pt435950/index.html">Data center modular a servi√ßo do Large Hadron Collider</a></li>
<li><a href="../pt435952/index.html">Quem s√£o "hosters n√£o lavados"?</a></li>
<li><a href="../pt435956/index.html">PHP Digest No. 147 (1 a 14 de janeiro de 2019)</a></li>
<li><a href="../pt435958/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 347 (7 a 13 de janeiro de 2019)</a></li>
<li><a href="../pt435960/index.html">Experi√™ncia de pensamento: Flutter on Go</a></li>
<li><a href="../pt435962/index.html">25¬∫ anivers√°rio da Aeron: sensa√ß√µes e impress√µes da vers√£o atualizada do Aeron Remastered</a></li>
<li><a href="../pt435964/index.html">Ethereum planeja ser 99% mais econ√¥mico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>