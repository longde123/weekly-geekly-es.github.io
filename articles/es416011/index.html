<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñçÔ∏è üë©üèæ‚Äç‚úàÔ∏è ü§∞üèº Patr√≥n BIF: c√≥digo frontal limpio y trabajo conveniente con datos del servidor ü§ôüèΩ üé¶ ü§üüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El material, cuya traducci√≥n publicamos hoy, se centrar√° en qu√© hacer en una situaci√≥n en la que los datos recibidos del servidor no se parecen a las ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Patr√≥n BIF: c√≥digo frontal limpio y trabajo conveniente con datos del servidor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/416011/">  El material, cuya traducci√≥n publicamos hoy, se centrar√° en qu√© hacer en una situaci√≥n en la que los datos recibidos del servidor no se parecen a las necesidades del cliente.  Es decir, al principio consideraremos un problema t√≠pico de este tipo, y luego analizaremos varias formas de resolverlo. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/7dc/108/edd/7dc108edd1850ed1da6eb12f865f93a5.jpg" alt="imagen"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">El problema de la API del servidor fallida</font> </h2><br>  Consideremos un ejemplo condicional basado en varios proyectos reales.  Supongamos que estamos desarrollando un nuevo sitio web para una organizaci√≥n que existe desde hace alg√∫n tiempo.  Ella ya tiene puntos finales REST, pero no est√°n dise√±ados para lo que vamos a crear.  Aqu√≠ necesitamos acceder al servidor solo para autenticar al usuario, obtener informaci√≥n sobre √©l y descargar una lista de notificaciones no vistas de este usuario.  Como resultado, estamos interesados ‚Äã‚Äãen los siguientes puntos finales de la API del servidor: <br><br><ul><li> <code>/auth</code> : autoriza al usuario y devuelve un token de acceso. </li><li>  <code>/profile</code> : devuelve informaci√≥n b√°sica del usuario. </li><li>  <code>/notifications</code> : le permite recibir notificaciones de usuario no le√≠das. </li></ul><br>  Imagine que nuestra aplicaci√≥n siempre necesita recibir todos estos datos en una sola unidad, es decir, idealmente, ser√≠a bueno si en lugar de tres puntos finales tuvi√©ramos solo uno. <br>  Sin embargo, nos enfrentamos a muchos m√°s problemas que muchos puntos finales.  En particular, estamos hablando del hecho de que los datos que recibimos no se ven de la mejor manera. <br><br>  Por ejemplo, el punto final <code>/profile</code> se cre√≥ en la antig√ºedad, no estaba escrito en JavaScript, como resultado, los nombres de las propiedades en los datos devueltos parecen inusuales para una aplicaci√≥n JS: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Profiles"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"David"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Gilbertson"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [       {         <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,         <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [           <span class="hljs-string"><span class="hljs-string">"/images/david.png"</span></span>         ]       }     ],     <span class="hljs-attr"><span class="hljs-attr">"Last_Login"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-01-01"</span></span>   } ] }</code> </pre> <br>  En general, nada bueno. <br><br>  Es cierto que si observa lo que produce el punto final <code>/notifications</code> , los datos anteriores de <code>/profile</code> parecer√°n bastante agradables: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"msg-1234"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529739612"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Alice"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Guthbertson"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Enhanced"</span></span>: <span class="hljs-string"><span class="hljs-string">"True"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/alice.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it re"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it really goes nice with your eyes"</span></span>   },   <span class="hljs-attr"><span class="hljs-attr">"msg-5678"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529731234"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Smelthsen"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/smelth.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocu"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocurrency soon and many thanks for you to look at and talk about"</span></span>   } } }</code> </pre> <br>  Aqu√≠ la lista de mensajes es un objeto, no una matriz.  Adem√°s, aqu√≠ hay datos de usuario, que est√°n tan inc√≥modamente organizados como en el caso del punto final <code>/profile</code> .  Y, aqu√≠ hay una sorpresa, la propiedad de <code>timestamp</code> contiene la cantidad de segundos desde principios de 1970. <br><br>  Si tuviera que dibujar un diagrama de la arquitectura de ese sistema infernalmente inconveniente del que acabamos de hablar, se ver√≠a como el que se muestra en la figura a continuaci√≥n.  El color rojo se usa para aquellas partes de este circuito que corresponden a datos mal preparados para trabajos posteriores. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e1/6c4/42f/8e16c442f3af8ad8ca702875e25207e0.png"><br>  <i><font color="#999999">Diagrama del sistema</font></i> <br><br>  En estas circunstancias, es posible que no nos esforcemos por arreglar la arquitectura de este sistema.  Simplemente puede cargar datos de estas tres API y utilizar estos datos en la aplicaci√≥n.  Por ejemplo, si necesita mostrar el nombre de usuario completo en la p√°gina, tendremos que combinar las propiedades <code>Christian_Name</code> y <code>Surname</code> . <br><br>  Aqu√≠ me gustar√≠a hacer un comentario sobre los nombres.  La idea de dividir el nombre completo de una persona en un nombre y apellido personal es caracter√≠stica de los pa√≠ses occidentales.  Si est√° desarrollando algo dise√±ado para uso internacional, trate de considerar el nombre completo de la persona como una cadena indivisible, y no haga suposiciones sobre c√≥mo dividir esta cadena en partes m√°s peque√±as para usar lo que sucedi√≥ en lugares donde necesita brevedad o desea atraer al usuario en un estilo informal. <br><br>  De vuelta a nuestras estructuras de datos imperfectas.  El primer problema obvio que se puede ver aqu√≠ se expresa en la necesidad de combinar datos dispares en el c√≥digo de la interfaz de usuario.  Consiste en el hecho de que podemos necesitar repetir esta acci√≥n en varios lugares.  Si necesita hacer esto solo ocasionalmente, el problema no es tan grave, pero si lo necesita con frecuencia, es mucho peor.  Como resultado, hay fen√≥menos indeseables causados ‚Äã‚Äãpor la falta de coincidencia de c√≥mo se organizan los datos recibidos del servidor y c√≥mo se usan en la aplicaci√≥n. <br><br>  El segundo problema es la complejidad del c√≥digo utilizado para formar la interfaz de usuario.  Creo que dicho c√≥digo deber√≠a ser, en primer lugar, lo m√°s simple posible y, en segundo lugar, lo m√°s claro posible.  Cuantas m√°s transformaciones internas de datos tenga que hacer en el cliente, mayor ser√° su complejidad, y el c√≥digo complejo es el lugar donde generalmente se ocultan los errores. <br><br>  El tercer problema se refiere a los tipos de datos.  De los fragmentos de c√≥digo anteriores, puede ver que, por ejemplo, los identificadores de mensajes son cadenas y los identificadores de usuario son n√∫meros.  Desde un punto de vista t√©cnico, todo est√° bien, pero tales cosas pueden confundir al programador.  Adem√°s, mira la presentaci√≥n de fechas!  Pero, ¬øqu√© pasa con el desorden en la parte de los datos que se relaciona con la imagen de perfil?  Despu√©s de todo, todo lo que necesitamos es una URL que conduzca al archivo correspondiente, y no algo a partir del cual tendremos que crear esta URL nosotros mismos, vadeando la jungla de estructuras de datos anidados. <br><br>  Si procesamos estos datos, pas√°ndolos al c√≥digo de la interfaz de usuario, luego, analizando los m√≥dulos, no podemos entender inmediatamente exactamente con qu√© estamos trabajando all√≠.  La conversi√≥n de la estructura de datos interna y su tipo al trabajar con ellos crea una carga adicional para el programador.  Pero sin todas estas dificultades es muy posible hacerlo. <br><br>  De hecho, como opci√≥n, ser√≠a posible implementar un sistema de tipo est√°tico para resolver este problema, pero el tipeo estricto no es capaz, solo por el hecho de su presencia, de hacer que un c√≥digo incorrecto sea bueno. <br><br>  Ahora que puede ver la gravedad del problema al que nos enfrentamos, hablemos sobre las formas de resolverlo. <br><br><h2>  <font color="#3AC1EF">Soluci√≥n # 1: cambiar la API del servidor</font> </h2><br>  Si el dispositivo inconveniente de la API existente no est√° dictado por razones importantes, entonces nada le impide crear una nueva versi√≥n que se adapte mejor a las necesidades del proyecto y localizar esta nueva versi√≥n, por ejemplo, en <code>/v2</code> .  Quiz√°s este enfoque pueda llamarse la soluci√≥n m√°s exitosa para los problemas anteriores.  El esquema de dicho sistema se presenta en la figura siguiente, la estructura de datos que coincide perfectamente con las necesidades del cliente se resalta en verde. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c59/59d/c18/c5959dc18590ec9bce0368e4b9ba1967.png"><br>  <i><font color="#999999">La nueva API del servidor que produce exactamente lo que necesita el lado del cliente del sistema</font></i> <br><br>  Comenzando a desarrollar un nuevo proyecto, cuya API deja mucho que desear, siempre estoy interesado en la posibilidad de implementar el enfoque que acabo de describir.  Sin embargo, a veces el dispositivo API, aunque sea inconveniente, tiene algunos objetivos importantes, o simplemente no es posible cambiar la API del servidor.  En este caso, recurro al siguiente enfoque. <br><br><h2>  <font color="#3AC1EF">Soluci√≥n # 2: Patr√≥n BFF</font> </h2><br>  Este es un buen patr√≥n BFF ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Backend-For-the-Frontend</a> ).  Con este patr√≥n, puede abstraerse de los intrincados puntos finales REST universales y proporcionar al front-end exactamente lo que necesita.  Aqu√≠ hay una representaci√≥n esquem√°tica de tal soluci√≥n. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea5/484/437/ea5484437a08ed68db006b5194dd9a9b.png"><br>  <i><font color="#999999">Aplicando el patr√≥n BFF</font></i> <br><br>  El significado de la existencia de la capa BFF es satisfacer las necesidades de la interfaz.  Quiz√°s usar√° puntos finales REST adicionales, o servicios GraphQL, o sockets web, o cualquier otra cosa.  Su objetivo principal es hacer todo lo posible para la conveniencia del lado del cliente de la aplicaci√≥n. <br><br>  Mi arquitectura favorita es NodeJS BFF, que utiliza los desarrolladores front-end que pueden hacer lo que necesitan, creando excelentes API para las aplicaciones cliente que desarrollan.  Idealmente, el c√≥digo correspondiente est√° en el mismo repositorio que el c√≥digo del front-end, lo que simplifica el intercambio de c√≥digo, por ejemplo, para verificar los datos enviados, tanto en el cliente como en el servidor. <br><br>  Adem√°s, esto significa que las tareas que requieren cambios en la parte del cliente de la aplicaci√≥n y su API de servidor se realizan en un repositorio.  Un poco, como dicen, pero agradable. <br><br>  Sin embargo, BFF no siempre se puede usar.  Y este hecho nos lleva a otra soluci√≥n al problema del uso conveniente de las API de servidores defectuosos. <br><br><h2>  <font color="#3AC1EF">Soluci√≥n # 3: Patr√≥n BIF</font> </h2><br>  El patr√≥n BIF (Backend In the Frontend) usa la misma l√≥gica que se puede aplicar usando BFF (combinando m√∫ltiples API y limpieza de datos), pero esta l√≥gica se mueve hacia el lado del cliente.  En realidad, esta idea no es nueva, podr√≠a haberse visto hace veinte a√±os, pero este enfoque puede ayudar a trabajar con API de servidor mal organizadas, por eso estamos hablando de ello.  As√≠ es como se ve. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/185/102/d39/185102d39436b6119ead19f230eb8196.png"><br>  <i><font color="#999999">Aplicando el patr√≥n BIF</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç ¬øQu√© es un BIF?</font> </h3><br>  Como se puede ver en la secci√≥n anterior, BIF es un patr√≥n, es decir, un enfoque para comprender el c√≥digo y su organizaci√≥n.  Su uso no conduce a la necesidad de eliminar ninguna l√≥gica del proyecto.  Simplemente separa la l√≥gica de un tipo (modificaci√≥n de estructuras de datos) de la l√≥gica de otro tipo (la formaci√≥n de la interfaz de usuario).  Esto es similar a la idea de una "separaci√≥n de responsabilidades", que todos est√°n escuchando. <br><br>  Aqu√≠ me gustar√≠a se√±alar que, aunque esto no se puede llamar un desastre, a menudo tuve que ver implementaciones analfabetas de BIF.  Por lo tanto, me parece que muchos estar√°n interesados ‚Äã‚Äãen escuchar una historia sobre c√≥mo implementar correctamente este patr√≥n. <br><br>  El c√≥digo BIF debe considerarse como un c√≥digo que una vez puede tomarse y transferirse al servidor Node.js, despu√©s de lo cual todo funcionar√° de la misma manera que antes.  O incluso transfi√©ralo a un paquete privado de NPM, que se usar√° en varios proyectos front-end en el marco de una compa√±√≠a, lo cual es simplemente incre√≠ble. <br><br>  Recuerde que discutimos anteriormente los principales problemas que surgen cuando se trabaja con una API de servidor fallida.  Entre ellos se encuentra una llamada demasiado frecuente a la API y el hecho de que los datos devueltos por ellos no satisfacen las necesidades de la interfaz. <br><br>  Dividiremos la soluci√≥n a cada uno de estos problemas en bloques de c√≥digo separados, cada uno de los cuales se colocar√° en su propio archivo.  Como resultado, la capa BIF de la parte cliente de la aplicaci√≥n constar√° de dos archivos.  Adem√°s, se les adjuntar√° un archivo de prueba. <br><br><h3>  <font color="#3AC1EF">‚ñç Combinando llamadas API</font> </h3><br>  Hacer muchas llamadas a las API del servidor en nuestro c√≥digo de cliente no es un problema tan grave.  Sin embargo, me gustar√≠a resumirlo, para que sea posible cumplir con una sola "solicitud" (desde el c√≥digo de la aplicaci√≥n a la capa BIF), y obtener exactamente lo que se necesita en respuesta. <br><br>  Por supuesto, en nuestro caso, no hay escapatoria al hacer tres solicitudes HTTP al servidor, pero la aplicaci√≥n no necesita saberlo. <br><br>  La API de mi capa BIF se representa como funciones.  Por lo tanto, cuando la aplicaci√≥n necesita algunos datos sobre el usuario, llamar√° a la funci√≥n <code>getUser()</code> , que le devolver√° estos datos.  As√≠ es como se ve esta funci√≥n: <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; import fetchJson from <span class="hljs-string"><span class="hljs-string">'./fetchJson'</span></span>; export const getUser = async () =&gt; { const auth = await fetchJson(<span class="hljs-string"><span class="hljs-string">'/auth'</span></span>); const [ <span class="hljs-type"><span class="hljs-type">profile</span></span>, <span class="hljs-type"><span class="hljs-type">notifications</span></span> ] = await Promise.all([   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">profile</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>),   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">notifications</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>), ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parseUserData(auth, profile, notifications); };</code> </pre> <br>  Aqu√≠, primero, se realiza una solicitud al servicio de autenticaci√≥n para obtener un token, que se puede utilizar para autorizar al usuario (no hablaremos de los mecanismos de autenticaci√≥n aqu√≠, pero nuestro objetivo principal es BIF). <br><br>  Despu√©s de recibir el token, puede ejecutar simult√°neamente dos solicitudes que reciben datos de perfil de usuario e informaci√≥n sobre notificaciones no le√≠das. <br><br>  Por cierto, mire cu√°n hermosa se ve la construcci√≥n <code>async/await</code> al trabajar con ella usando <code>Promise.all</code> y usando la asignaci√≥n destructiva. <br><br>  Entonces, este fue el primer paso, aqu√≠ extrajimos el hecho de que el acceso al servidor incluye tres solicitudes.  Sin embargo, el caso a√∫n no se ha hecho.  Es decir, preste atenci√≥n a la llamada a la funci√≥n <code>parseUserData()</code> , que, como puede juzgar por su nombre, <code>parseUserData()</code> los datos recibidos del servidor.  Hablemos de ella. <br><br><h3>  <font color="#3AC1EF">‚ñç Limpieza de datos</font> </h3><br>  Quiero dar una recomendaci√≥n de inmediato, que, creo, puede afectar seriamente un proyecto que anteriormente no ten√≠a una capa BIF, en particular, un nuevo proyecto.  Intenta no pensar en lo que obtienes del servidor por un tiempo.  En cambio, conc√©ntrese en qu√© datos necesita su aplicaci√≥n. <br><br>  Adem√°s, es mejor no intentar, al dise√±ar la aplicaci√≥n, tener en cuenta sus posibles necesidades futuras, por ejemplo, relacionadas con 2021.  Solo trate de hacer que la aplicaci√≥n funcione exactamente como deber√≠a ser hoy.  El hecho es que el entusiasmo excesivo por la planificaci√≥n y los intentos de predecir el futuro es la raz√≥n principal de la complicaci√≥n injustificada de los proyectos de software. <br><br>  Entonces, volvamos a nuestro negocio.  Ahora sabemos c√≥mo se ven los datos recibidos de las tres API del servidor, y sabemos en qu√© deber√≠an convertirse despu√©s del an√°lisis. <br><br>  Parece que este es uno de esos casos raros cuando el uso de TDD realmente tiene sentido.  Por lo tanto, escribiremos una gran prueba larga para la funci√≥n <code>parseUserData()</code> : <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; it(<span class="hljs-string"><span class="hljs-string">'should parse the data'</span></span>, () =&gt; { const authApiData = {   userId: <span class="hljs-number"><span class="hljs-number">1234</span></span>,   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>, }; const profileApiData = {   Profiles: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,       <span class="hljs-type"><span class="hljs-type">Christian_Name</span></span>: <span class="hljs-string"><span class="hljs-string">'David'</span></span>,       <span class="hljs-type"><span class="hljs-type">Surname</span></span>: <span class="hljs-string"><span class="hljs-string">'Gilbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">Photographs</span></span>: [         {           <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,           <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [             <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,           ],         },       ],       <span class="hljs-type"><span class="hljs-type">Last_Login</span></span>: <span class="hljs-string"><span class="hljs-string">'2018-01-01'</span></span>     },   ], }; const notificationsApiData = {   <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: {     <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529739612'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Alice'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Guthbertson'</span></span>,         Enhanced: <span class="hljs-string"><span class="hljs-string">'True'</span></span>,         Photographs: [           {             <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,             <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [               <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>             ]           }         ]       },       message_summary: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it re'</span></span>,       message: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529731234'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Bob'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Smelthsen'</span></span>,       },       message_summary: <span class="hljs-string"><span class="hljs-string">'I\'</span></span>m launching my own cryptocu<span class="hljs-string"><span class="hljs-string">',       message: '</span></span>I\<span class="hljs-string"><span class="hljs-string">'m launching my own cryptocurrency soon and many thanks for you to look at and talk about'</span></span>     },   }, }; const parsedData = parseUserData(authApiData, profileApiData, notificationsApiData); expect(parsedData).toEqual({   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>,   id: <span class="hljs-string"><span class="hljs-string">'1234'</span></span>,   name: <span class="hljs-string"><span class="hljs-string">'David Gilbertson'</span></span>,   photoUrl: <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,   notifications: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Alice Guthbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">true</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Bob Smelthsen'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">false</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'I\'</span></span><span class="hljs-type"><span class="hljs-type">m</span></span> <span class="hljs-type"><span class="hljs-type">launching</span></span> <span class="hljs-type"><span class="hljs-type">my</span></span> <span class="hljs-type"><span class="hljs-type">own</span></span> <span class="hljs-type"><span class="hljs-type">cryptocurrency</span></span> <span class="hljs-type"><span class="hljs-type">soon</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">many</span></span> <span class="hljs-type"><span class="hljs-type">thanks</span></span> <span class="hljs-type"><span class="hljs-type">for</span></span> <span class="hljs-type"><span class="hljs-type">you</span></span> <span class="hljs-type"><span class="hljs-type">to</span></span> <span class="hljs-type"><span class="hljs-type">look</span></span> <span class="hljs-type"><span class="hljs-type">at</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">talk</span></span> <span class="hljs-type"><span class="hljs-type">about</span></span><span class="hljs-string"><span class="hljs-string">'     },   ], }); });</span></span></code> </pre> <br>  Y aqu√≠ est√° el c√≥digo de la funci√≥n en s√≠: <br><br><pre> <code class="hljs powershell">const getPhotoFromProfile = profile =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> profile.Photographs[<span class="hljs-number"><span class="hljs-number">0</span></span>].URLS[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>; //   } }; const getFullNameFromProfile = profile =&gt; `${profile.Christian_Name} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{profile.Surname}`; export default <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseUserData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(authApiData, profileApiData, notificationsApiData)</span></span></span></span> { const profile = profileApiData.Profiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const result = {   jwt: authApiData.jwt,   id: authApiData.userId.toString(), // ID        name: getFullNameFromProfile(profile),   photoUrl: getPhotoFromProfile(profile),   notifications: [], //      ,     }; Object.entries(notificationsApiData.data).forEach(([<span class="hljs-type"><span class="hljs-type">id</span></span>, <span class="hljs-type"><span class="hljs-type">notification</span></span>]) =&gt; {   result.notifications.push({     id,     dateTime: new Date(Number(notification.timestamp) * <span class="hljs-number"><span class="hljs-number">1000</span></span>), // ,   ,   ,     Unix,         name: getFullNameFromProfile(notification.user),     photoUrl: getPhotoFromProfile(notification.user),     message: notification.message,     premiumMember: notification.user.Enhanced === <span class="hljs-string"><span class="hljs-string">'True'</span></span>,   }) }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  Me gustar√≠a se√±alar que cuando es posible recopilar en un lugar doscientas l√≠neas de c√≥digo responsables de modificar los datos dispersos antes de esto en toda la aplicaci√≥n, causa una sensaci√≥n maravillosa.  Ahora todo esto est√° en un archivo, las pruebas unitarias se escriben para este c√≥digo, y todos los momentos ambiguos reciben comentarios. <br><br>  Dije anteriormente que BFF es mi enfoque favorito para combinar y borrar datos, pero hay un √°rea en la que BIF es superior a BFF.  A saber, los datos recibidos del servidor pueden incluir objetos de JavaScript que no son compatibles con JSON, como los objetos de <code>Date</code> o <code>Map</code> (tal vez esta es una de las caracter√≠sticas de JavaScript m√°s infrautilizadas).  Por ejemplo, en nuestro caso, tenemos que convertir la fecha que vino del servidor (expresada en segundos, no milisegundos) en un objeto JS de tipo <code>Date</code> . <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  Si cree que su proyecto tiene algo en com√∫n con el que examinamos los problemas de las API fallidas, analice su c√≥digo haci√©ndose las siguientes preguntas sobre el uso de datos del servidor en el cliente: <br><br><ul><li>  ¬øTiene que combinar propiedades que nunca se usan por separado (por ejemplo, el nombre y apellido del usuario)? </li><li>  ¬øEl c√≥digo JS tiene que funcionar con nombres de propiedad formados de una manera que no se acepta en JS (algo as√≠ como PascalCase)? </li><li>  ¬øCu√°les son los tipos de datos de los distintos identificadores?  Tal vez a veces estas son cadenas, a veces n√∫meros? </li><li>  ¬øC√≥mo se presentan las fechas en su proyecto?  ¬øQuiz√°s a veces se trata de objetos <code>Date</code> JS listos para usar en la interfaz y, a veces, n√∫meros o incluso cadenas? </li><li>  ¬øA menudo tiene que verificar las propiedades para su existencia, o verificar si una entidad es una matriz antes de comenzar a enumerar los elementos de esta entidad para formar alg√∫n fragmento de la interfaz de usuario sobre la base?  ¬øPodr√≠a ser que esta entidad no sea una matriz, incluso si est√° vac√≠a? </li><li>  ¬øTiene que ordenar o filtrar las matrices al formar la interfaz, que, idealmente, ya deber√≠a estar ordenada y filtrada correctamente? </li><li>  Si resulta que, cuando se verifican las propiedades para su existencia, no se buscan propiedades, ¬øtiene que cambiar a usar algunos valores predeterminados (por ejemplo, usar una imagen est√°ndar cuando no hay una foto de usuario en los datos recibidos del servidor)? </li><li>  ¬øLas propiedades tienen un nombre uniforme?  ¬øOcurre que la misma entidad puede tener diferentes nombres, lo que posiblemente sea causado por el uso conjunto de, relativamente hablando, API de servidor "antiguas" y "nuevas"? </li><li>  ¬øTiene que, junto con datos √∫tiles, transferir a alg√∫n lugar datos que nunca se utilizan, haciendo esto solo porque proviene de la API del servidor?  ¬øEstos datos no utilizados interfieren con la depuraci√≥n? </li></ul><br>  Si puede responder positivamente una o dos preguntas de esta lista, entonces quiz√°s no deber√≠a reparar algo que ya funciona correctamente. <br><br>  Sin embargo, si, al leer estas preguntas, descubre en cada una de ellas los problemas de su proyecto, si el dispositivo de su c√≥digo es innecesariamente complicado debido a todo esto, si es dif√≠cil de percibir y probar, si contiene errores que son dif√≠ciles de detectar, eche un vistazo al patr√≥n BIF. <br><br>  Al final, quiero decir que al introducir la capa BIF en las aplicaciones existentes, las cosas son m√°s f√°ciles debido al hecho de que esto se puede hacer en etapas, en peque√±os pasos.  Digamos que la primera versi√≥n de la funci√≥n para preparar datos, llam√©mosla <code>parseData()</code> , puede simplemente, sin cambios, devolver lo que viene a su entrada.  Luego, puede mover gradualmente la l√≥gica del c√≥digo responsable de crear la interfaz de usuario para esta funci√≥n. <br><br>  <b>Estimados lectores!</b>     ,          BIF? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416011/">https://habr.com/ru/post/es416011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416001/index.html">Mensajes de un sitio en VK - simple y efectivo - PHP + CUrl</a></li>
<li><a href="../es416003/index.html">Representaci√≥n de archivos HTML: un cap√≠tulo del libro ReactPHP para principiantes de Skyeng</a></li>
<li><a href="../es416005/index.html">16 herramientas de reacci√≥n para desarrolladores de interfaces</a></li>
<li><a href="../es416007/index.html">Casi complicado. El comienzo de la creaci√≥n de un "hogar inteligente" inal√°mbrico. Basado en tecnolog√≠a Linux, software Z-Wave y MajorDoMo</a></li>
<li><a href="../es416009/index.html">Pruebe los excrementos de conejo, es vigoroso, atrapar√° - extractos en farmacolog√≠a</a></li>
<li><a href="../es416013/index.html">C√≥mo comenzar a invertir y ahorrar dinero: los expertos de Dow Jones mencionaron los cinco errores principales de los operadores novatos</a></li>
<li><a href="../es416015/index.html">Jugando con hilos en Node.JS 10.5.0</a></li>
<li><a href="../es416017/index.html">Recopilamos an√°lisis de cohortes / an√°lisis de flujos en el ejemplo de Excel</a></li>
<li><a href="../es416019/index.html">¬øQu√© tan bueno es el ecosistema de c√≥digo abierto de R para resolver problemas comerciales?</a></li>
<li><a href="../es416021/index.html">Desarrollando su propio marco y crecimiento profesional de un programador JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>