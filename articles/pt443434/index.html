<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏽 👨🏾‍🏫 🤸 Notificações: ação necessária para obter lucros / perdas. Caso seu Broker não suporte esses pedidos 🈁 🤽🏾 🤛🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Existe um corretor russo - Tinkoff Bank. Agora, aqui está o problema: o corretor não suporta ordens de obter lucro e parar perdas. De todo. Se você qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notificações: ação necessária para obter lucros / perdas. Caso seu Broker não suporte esses pedidos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443434/">  Existe um corretor russo - Tinkoff Bank.  Agora, aqui está o problema: o corretor não suporta ordens de obter lucro e parar perdas.  De todo.  Se você quiser se sentir mais conveniente durante a negociação, precisará de alguma solução alternativa para essa situação, até que os desenvolvedores do Tinkoff Bank finalmente liberem essas ordens como o recurso matador.  No artigo, mostrarei minha solução alternativa. <br>  <b>update:</b> 2019-03-22, o Broker publicou a plataforma 3.0.0 (uma grande atualização) no Google Play.  Os recursos do changelog recebem ordens de lucro / stop loss <br><a name="habracut"></a><br>  Por que eu decidi postar o artigo aqui?  Eu suponho que o Tinkoff Bank e seus produtos são bastante populares entre a multidão de TI na Rússia e provavelmente alguns deles têm a mesma necessidade, mas não têm tempo ou disposição para desenvolver uma solução temporária própria.  É por isso que compartilho minha solução e o histórico da solução. <br><br>  Aqui, devo dizer algo sobre soluções alternativas, fornecidas pelo corretor.  Primeiro, o corretor tem pedidos limitados.  O recurso foi lançado em fevereiro de 2019 (e os clientes esperaram por quase dois anos).  Eles apresentam trabalho dentro de um dia útil.  Então, você precisa de todos os dias de negociação configurá-los novamente.  Mais uma falha: você não pode definir limites como desejar.  Existe alguma faixa de preço e você não pode fazer um pedido limite com o preço fora da faixa.  E esse intervalo é extremamente estreito.  Em um mercado volátil, isso faz você se sentir inconveniente.  Por fim, você não pode criar dois pedidos multidirecionais (no meu caso, mesmo o primeiro pedido limite causa uma falha instantânea do aplicativo móvel do broker e o site do broker não fornece esse recurso). <br><br>  Segundo, o aplicativo móvel do corretor fornece um recurso: você pode assinar a alteração de preço do ativo.  Se o limite (absoluto, em preço ou relativo, em porcentagem) for ultrapassado, você receberá uma notificação.  Mas, novamente, você não pode criar dois limites para o ativo. <br><br>  Minha solução alternativa é bastante simples: <br><br><ol><li> nós temos limites para um ativo.  Nós calculamos os limiares.  Se os limites forem ultrapassados, fazemos uma ação manual: vender ou comprar para obter, como resultado, lucro ou perda. </li><li>  devemos obter uma fonte de dados, para obter o preço real do ativo </li><li>  se o limite for ultrapassado, devemos enviar uma notificação. </li></ol><br>  Embora pareça bastante simples, há alguns detalhes em minha solução que desejo compartilhar e discutir. <br><br>  1. Embora minha carteira de valores mobiliários tivesse um ativo, os limites foram definidos no script e a pesquisa de ações foi feita de forma clara, simples e não configurável.  Foi uma solução ruim, mas rápida e mostrou que a idéia estava certa.  Quando recebo novos ativos no portfólio, carreguei nomes de ações, trocas e limites de um arquivo. <br><br>  2. Meu primeiro ativo foi uma ação estrangeira, e a ação estrangeira poderia ser comprada ou vendida apenas na bolsa de São Petersburgo.  Minha primeira pressa foi analisar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site da bolsa do SPb</a> . <br><br>  Há uma classificação descendente de volume, por isso foi fácil de analisar, porque meu ativo sempre estava na primeira página.  Mas 8 de março estava quebrado.  Não sei por que, mas o TSLA apareceu na 25ª página.  O paginador deles usa JavaScript para baixar os dados das páginas.  Existe uma solução direta: baixe e analise todas as páginas e encontre o ativo.  Mas é preciso muito tempo para baixar e analisar mais de 25 páginas em cada loop. <br><br>  Em vez disso, decidi adicionar como outra fonte de dados o site tradingview.com.  Não é necessário analisar muitas páginas para encontrar seu estoque, porque cada ativo tem sua própria página, como esta: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.tradingview.com/symbols/NASDAQ-TSLA</a> <br><br>  Presumi que agora meus problemas se foram, mas eu estava errado.  Os dados nas páginas são carregados e atualizados apenas com JS.  Portanto, as solicitações que eu costumava baixar páginas falharam. <br><br>  Para esse problema, conheço três soluções diferentes: <br><br>  PyQT, selênio (webdriver) e uma extensão Requests-HTML.  Como eu já tenho o módulo Requests no meu projeto, decidi usar o Requests-HTML. <br><br>  Para minha forte decepção, não foi muito estável, até que encontrei algumas pistas no StackOverFlow e tal. <br><br><pre><code class="python hljs">session = HTMLSession() r = session.get(url) my = r.html.render(timeout=<span class="hljs-number"><span class="hljs-number">30</span></span>) selector = <span class="hljs-string"><span class="hljs-string">'span.tv-symbol-header-quote__value.tv-symbol-header-quote__value--large.js-symbol-last'</span></span> price = r.html.find(selector)[<span class="hljs-number"><span class="hljs-number">0</span></span>].text r.close() session.close()</code> </pre> <br>  Preste atenção ao tempo limite, bem como às chamadas fechadas ().  A maioria dos exemplos não possui esses detalhes e isso pode causar alguns problemas. <br><br>  3. Agora, quando baixamos as páginas com dados JS, analisamos e decidimos se precisamos enviar uma notificação, existe apenas uma pergunta: 'Como enviamos uma notificação?'.  No meu caso, o sms.ru oferece uma API conveniente e 5 SMS grátis por dia.  Inscreva-se em um portão de SMS.  Crie uma chave de API.  A chave é algo como isto: <br><br><pre> <code class="plaintext hljs">24A41EA5-EEEE-CCCC-5555-094143C2EDDD</code> </pre> <br>  Enviando a função SMS de uma versão anterior da minha solução: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mymessage)</span></span></span><span class="hljs-function">:</span></span> sms_url = <span class="hljs-string"><span class="hljs-string">'https://sms.ru/sms/send?api_id=key&amp;to=number&amp;msg=message&amp;json=1'</span></span> sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'key'</span></span>, mykey) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'number'</span></span>, mynumber) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, mymessage) sms_response = requests.get(sms_url)</code> </pre> <br>  Isso funciona bem.  Eu me deparei com a pergunta: e se já enviámos um SMS.  A primeira versão não possui verificações, então envia um SMS dentro de cada loop.  Novamente e novamente. <br><br>  Eu adicionei o contador do SMS, que o script verifica antes de chamar send_message. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> sms_counter sms_counter = sms_counter + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Ok, entendemos.  Mas, à medida que o novo dia surge, surge um novo problema: como liberar o contador de SMS?  Ou, na verdade, quando?  Vejo três maneiras diferentes: armazenar o contador no DB (mas minha solução, por enquanto, é sem estado), analisar data / hora para liberar o contador entre dias úteis e reiniciar o script em algum momento entre dois dias úteis.  Por enquanto, implementei a variante mais recente, mas no futuro eu posso alterá-la. <br><br>  Minha solução está funcionando agora, você pode baixá-lo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . <br><br>  Para usuários que não sabem como lidar com scripts Python, ofereço uma <a href="">solução empacotada para Windows</a> (cortesia de PyInstaller). <br><br>  TODOs: <br><br><ol><li>  analisar data e hora para liberar os contadores de SMS em vez de reiniciar o script; </li><li>  por enquanto é o aplicativo sem estado, quero adicionar um banco de dados; </li><li>  após o nº 2, seria bom rastrear um grande aumento ou diminuir o preço do ativo (em relação ao preço de fechamento do dia anterior da operação); </li><li>  expandir caminhos de comunicação (Telegram, Viber, chamadas de voz) e provedores (por questões de confiabilidade, desejo adicionar smsc.ru SMS-gate, porque sms.ru fica preso às vezes e não retorna sms_response, embora o SMS seja enviado). </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt443434/">https://habr.com/ru/post/pt443434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt443424/index.html">Reescrevendo o caso de teste do front-end júnior para TypeScript e ganchos de reação</a></li>
<li><a href="../pt443426/index.html">Marca negra - como o OpenShift protege contra vulnerabilidades de contêiner com o SELinux</a></li>
<li><a href="../pt443428/index.html">Palmer Lucky, o "pai" de Oculus Rift, está desenvolvendo um sistema virtual de campos de batalha para o Pentágono</a></li>
<li><a href="../pt443430/index.html">Por que é ruim quando a Internet sabe tudo sobre você?</a></li>
<li><a href="../pt443432/index.html">Lançamento do Blazor 0.9.0</a></li>
<li><a href="../pt443436/index.html">Onde falar sobre o Apache Ignite, bancos de dados distribuídos e aprendizado de máquina distribuído na primavera</a></li>
<li><a href="../pt443438/index.html">7 extensões úteis do Firefox para aprender inglês</a></li>
<li><a href="../pt443440/index.html">Módulo PHP para trabalhar com dados hierárquicos no InterSystems IRIS</a></li>
<li><a href="../pt443450/index.html">Por que os pobres não podem ser saudáveis</a></li>
<li><a href="../pt443452/index.html">Militares russos criarão sua própria Internet fechada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>