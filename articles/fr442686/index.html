<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèø üìû üë©üèº‚Äçüè´ Tutoriel DataPower üíñ üêº üò∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mat√©riel co-√©crit par Wedmeed 


 En 2017, lorsque notre projet a commenc√© au Vietnam, nous avons rencontr√© la nouvelle b√™te IBM DataPower pour nous. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tutoriel DataPower</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neoflex/blog/442686/"><p>  Mat√©riel co-√©crit par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Wedmeed</a> </p><br><p> En 2017, lorsque notre projet a commenc√© au Vietnam, nous avons rencontr√© la nouvelle b√™te IBM DataPower pour nous.  IBM DataPower est un produit de passerelle entre les clients et les backends con√ßu pour le filtrage, le routage, l'enrichissement ou d'autres transformations des messages qui le traversent (ci-apr√®s d√©nomm√©es requ√™tes).  Il fallait apprendre rapidement, il n'y avait pas de temps pour l'accumulation, donc on nous a demand√© de nous familiariser avec, apr√®s quoi il y a eu de nombreuses heures de conf√©rence Skype avec notre coll√®gue de Moscou, qui nous a transmis ses connaissances et son exp√©rience avec ce produit. <br></p><br><p>  L'autoformation √©tait bas√©e sur l'√©tude de la documentation et le visionnage de vid√©os de formation sur Internet - et ici j'attendais une prise.  Je n'ai pratiquement pas pu trouver d'informations en russe.  Soit dit en passant, ma connaissance de la langue anglaise √† cette √©poque n'√©tait pas au plus haut niveau, d'ailleurs c'√©tait mon premier projet et, probablement, ces facteurs ont compliqu√© ma vie.  Cela m'a fait √©crire un article de formation en russe et de la mani√®re la plus simple possible pour les d√©veloppeurs d√©butants qui sont tomb√©s sur ce produit et essaient de comprendre rapidement ses bases.  L'article ne vous lib√©rera pas de la lecture de la documentation, mais il vous facilitera la vie dans les premiers stades de la compr√©hension de ¬´comment cela fonctionne¬ª. <br></p><br><p>  Il convient √©galement de noter que la structure donn√©e dans la pratique sera proche du projet r√©el, ce qui vous permettra de l'utiliser comme base, d'√©largir et de compl√©ter vos besoins.  En conclusion, quelques mots sur le projet d√©j√† mis en ≈ìuvre, ainsi que certaines fonctionnalit√©s qui m√©ritent une attention particuli√®re, seront donn√©s aux sections Th√©orie. </p><br><img src="https://habrastorage.org/webt/rm/at/lk/rmatlkcfuvcjxvgireijushp7yc.jpeg"><br><a name="habracut"></a><br><h2>  Partie 1. Installation de DataPower avec la bo√Æte √† outils Docker </h2><br><p>  Installez et ex√©cutez l'application Docker Toolbox.  Imm√©diatement apr√®s le d√©marrage, vous verrez l'adresse IP de la machine, √† travers laquelle DataPower sera disponible plus tard: <br></p><br><img src="https://habrastorage.org/webt/zs/qa/wn/zsqawn2jksqp8j8gfl5gwslnks4.png"><br><br><p>  Pour d√©marrer l'image, vous devez modifier certains param√®tres de la machine virtuelle (pertinents pour la version IDG.2018.4.1.0) et la red√©marrer: <br></p><br><ol><li>  Arr√™tez la machine docker avec la commande: <br><br><pre><code class="plaintext hljs">docker-machine stop</code> </pre> </li><li>  Syst√®me -&gt; Carte m√®re -&gt; M√©moire principale: minimum 4096 Mo; <br></li><li>  Syst√®me -&gt; Processeur: minimum 2; <br></li><li>  Affichage -&gt; √âcran -&gt; M√©moire vid√©o: au moins 128 Mo; <br></li><li>  Nous lan√ßons la machine docker avec la commande: <br><br><pre> <code class="plaintext hljs">docker-machine start</code> </pre> <br>  <i>Remarque</i>  <i>Si vous √™tes invit√© √† red√©marrer docker-machine env, ex√©cutez:</i> <br><br><pre> <code class="plaintext hljs">docker-machine env</code> </pre> </li><li>  Ensuite, vous devez d√©gonfler l'image IBM DataPower: <br><br><pre> <code class="plaintext hljs">docker pull ibmcom/datapower</code> </pre> </li><li>  Lancez ensuite le conteneur Docker avec la commande suivante: <br><br><pre> <code class="plaintext hljs">docker run -it \ -v $PWD/config:/drouter/config \ -v $PWD/local:/drouter/local \ -e DATAPOWER_ACCEPT_LICENSE=true \ -e DATAPOWER_INTERACTIVE=true \ -p 9090:9090 \ -p 3630:3630 \ -p 9022:22 \ -p 7170:7170 \ --name idg \ ibmcom/datapower</code> </pre></li><li>  Apr√®s avoir termin√© la commande, appuyez sur Entr√©e et entrez <b>admin / admin</b> comme nom d'utilisateur et mot de passe <br></li><li>  Pour d√©marrer l'interface de gestion Web, utilisez les commandes: <br><br><pre> <code class="plaintext hljs">co</code> </pre> <br>  et <br><br><pre> <code class="plaintext hljs">web-mgmt 0 9090</code> </pre> </li><li>  Apr√®s toutes ces √©tapes, ex√©cutez dans le navigateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://192.168.99.100:9090/</a> <br></li></ol><br><h2>  Partie 2. Domaines </h2><br><h3>  2.1.  Th√©orie </h3><br><p>  Les domaines dans DataPower vous permettent de s√©parer les outils d'administration et de d√©veloppement, ainsi que d'assurer la s√©curit√©. <br></p><br><p>  Apr√®s l'installation, il n'y a qu'un domaine par d√©faut √† partir duquel les domaines d'application peuvent √™tre cr√©√©s.  Chaque domaine a sa propre configuration de param√®tres. <br></p><br><p>  Certaines ressources et certains param√®tres communs ne peuvent √™tre d√©finis que dans le domaine par d√©faut, notamment les interfaces r√©seau, les utilisateurs et le contr√¥le d'acc√®s, les domaines d'application et autres. <br></p><br><p>  Un domaine d'application est une section de d√©veloppement pour les services de traitement des demandes.  Les services qui y sont d√©finis ne peuvent pas √™tre partag√©s avec un autre domaine d'application.  Les domaines d'application peuvent √™tre red√©marr√©s s√©par√©ment et ind√©pendamment, sans avoir besoin d'un red√©marrage complet de DataPower. <br></p><br><p>  Vous pouvez cr√©er, red√©marrer, r√©initialiser, suspendre, renouveler ou supprimer des domaines.  Vous pouvez trouver des informations plus d√©taill√©es sur toutes les fonctionnalit√©s d'administration dans la documentation officielle. <br></p><br><p>  Un peu sur le projet termin√©.  Nous avons utilis√© 3 domaines: <br></p><br><ul><li>  default - le domaine par d√©faut contenant les ressources et les param√®tres partag√©s; </li><li>  trunk - le domaine principal contenant tout le n√©cessaire pour le traitement des demandes; </li><li>  param√®tres - param√®tres et domaine de s√©curit√©, les fichiers locaux contiennent des informations sur les r√®gles de routage des services et les param√®tres de s√©curit√©. </li></ul><br><p>  La n√©cessit√© de transf√©rer tous les param√®tres vers un domaine distinct est apparue dans le cadre de la recherche d'un chemin de d√©ploiement plus simple.  Comme dans de nombreux projets, les environnements de d√©veloppement, de test et de production ont √©t√© s√©par√©s, et le transfert vers un domaine de param√®tres s√©par√© nous a permis d'installer tous les domaines principaux de l'environnement de d√©veloppement dans d'autres environnements via l'exportation / importation, sans risque de perdre les param√®tres d'environnement. <br></p><br><h3>  2.2.  Pratique </h3><br><ul><li>  Dans le champ de recherche, entrez ¬´domaine¬ª, s√©lectionnez ¬´Domaine d'application¬ª et cliquez sur ¬´Ajouter¬ª <br><img src="https://habrastorage.org/webt/uo/k_/gs/uok_gsaxjifcklt56rs9wmiujhm.png"></li><li>  Ici, vous devez sp√©cifier le nom de domaine, commenter (si vous le souhaitez) et activer l'audit et la journalisation.  Remplissez les champs et appliquez les modifications <br><img src="https://habrastorage.org/webt/3b/6w/ts/3b6wtsfrlvxcxgb7jgpkmm6u1rq.png"></li><li>  De m√™me, ajoutez un autre domaine "tronc" </li><li>  Allez √† Examiner les modifications <br><img src="https://habrastorage.org/webt/p-/nh/cp/p-nhcpeur45dhrzahmpffom9pq8.png"></li><li>  et enregistrez la configuration du domaine <br><img src="https://habrastorage.org/webt/1u/8n/si/1u8nsi-zblkkqdsrpa7lnqcgw8g.png"></li><li>  Vous pouvez v√©rifier l'√©tat des objets cr√©√©s en acc√©dant au domaine par d√©faut dans l'arborescence de navigation dans √âtat -&gt; Principal -&gt; √âtat de l'objet <br><img src="https://habrastorage.org/webt/uz/qo/q4/uzqoq4kek4qdgkfkhovrjmiridm.png"></li><li>  Choisissez <b><i>Afficher par: types</i></b> <br><img src="https://habrastorage.org/webt/fj/5_/6z/fj5_6zg-kidxhkt5as0omzfvsiw.png"></li><li>  Recherchez le domaine d'application dans la liste et v√©rifiez l'√©tat des objets: chacun d'eux doit √™tre enregistr√©, allum√© et √† l'√©tat haut.  Si c'est le cas, passez au chapitre suivant. </li></ul><br><img src="https://habrastorage.org/webt/xa/ii/kj/xaiikjxfdhsy19lez-rxo2xmeug.png"><br><br><h2>  Partie 3. Gestionnaires de files d'attente </h2><br><p>  Le gestionnaire de files d'attente n'est pas un composant obligatoire d'IBM DataPower, mais c'est √† travers l'exemple de MQ que vous pouvez montrer toute la puissance de ce produit.  Nous utiliserons MQ d'IBM.  Lors des tests d√©crits au chapitre 6, nous devrons envoyer un message au gestionnaire de files d'attente local.  Dans cet article, je vais le faire en utilisant l'utilitaire rfhutil, mais vous pouvez utiliser n'importe quelle m√©thode √† votre disposition.  Pour les tests, vous devrez cr√©er une connexion de DP √† votre gestionnaire de files d'attente local √† l'aide du gestionnaire de files d'attente MQ. </p><br><cut></cut><br><h3>  3.1.  Th√©orie </h3><br><p>  Le gestionnaire de files d'attente permet l'√©change de donn√©es entre la passerelle et les gestionnaires de files d'attente distantes. </p><br><p>  Vous pouvez √©galement configurer le groupe MQ Queue Manager, ce qui augmentera la tol√©rance aux pannes du syst√®me.  Cela peut √™tre utile, par exemple, si vous souhaitez connecter le client √† l'un des ensembles de gestionnaires de files d'attente de travail et, dans certains cas, que vous pouvez trouver dans la documentation officielle. </p><br><p>  D'apr√®s l'exp√©rience du projet, une seule caract√©ristique doit √™tre not√©e: √† un moment donn√©, nous voulions essayer d'impl√©menter l'√©quilibrage de charge en utilisant DataPower, en particulier en utilisant des groupes de gestionnaires de files d'attente, mais en pratique, nous n'avons pas trouv√© une telle opportunit√©.  Une autre solution consiste √† cr√©er un cluster de gestionnaires de files d'attente. </p><br><br><h3>  3.2.  Pratique </h3><br><h4>  3.2.1.  La pr√©paration </h4><br><ol><li>  Installez WebSphere MQ; </li><li>  Cr√©ez un gestionnaire de files d'attente LOCAL_DP_QM local, accessible sur le port 3630; </li><li>  Configurer le canal DP.SVRCONN; <br><br><p>  Lors de la cr√©ation d'une cha√Æne, les commandes suivantes peuvent vous √™tre utiles: </p><br><pre> <code class="plaintext hljs">strmqm LOCAL_DP_QM /*  mq*/ runmqsc LOCAL_DP_QM /*   mq*/ DEFINE CHANNEL (DP.SVRCONN) CHLTYPE(SVRCONN) MCAUSER('evlasenko') /* */ SET CHLAUTH('DP.SVRCONN') TYPE(USERMAP) CLNTUSER('evlasenko') USERSRC(channel) ADDRESS('*') ACTION(ADD) /*      */ SET CHLAUTH(DP.SVRCONN) TYPE(BLOCKUSER) USERLIST('nobody') /*   */ ALTER LISTENER (SYSTEM.DEFAULT.LISTENER.TCP) TRPTYPE(TCP) PORT(3630) control(QMGR) /*    3630*/ ALTER AUTHINFO (SYSTEM.DEFAULT.AUTHINFO.IDPWOS) AUTHTYPE(IDPWOS) CHCKCLNT(OPTIONAL) /* */ REFRESH SECURITY TYPE(CONNAUTH) /*  */ endmqm LOCAL_DP_QM /*  mq*/ strmqm LOCAL_DP_QM /*  mq*/ END</code> </pre><br></li><li>  Cr√©ez les files d'attente DP.IIB.REQIN et DP.IIB.RESIN </li><li>  Ex√©cutez rfhutil sous le nom de l'utilisateur pour lequel le canal a √©t√© cr√©√©.  Dans la ligne Nom du gestionnaire de files d'attente (pour vous connecter), √©crivez: <br><br><pre> <code class="plaintext hljs">DP.SVRCONN/TCT/127.0.0.1(3630)</code> </pre> <br></li><li>  Essayez de charger la liste des noms de file d'attente; il ne devrait pas y avoir d'erreurs dans la fen√™tre de message.  La connexion au canal a √©t√© v√©rifi√©e. <br></li></ol><br><h4>  3.2.2.  Cr√©er IBM MQ Queue Manager </h4><br><ol><li>  Acc√©dez au domaine de jonction. </li><li>  Dans la recherche, saisissez MQ, s√©lectionnez IBM MQ Queue Manager, puis cliquez sur Ajouter. </li><li>  Vous devez sp√©cifier le nom (TEST_QM), le nom d'h√¥te du gestionnaire de files d'attente, le nom du gestionnaire de files d'attente et le nom du canal, ainsi que le d√©lai d'expiration.  Configurez et enregistrez les modifications. <br><img src="https://habrastorage.org/webt/di/sg/x1/disgx1dt8szkq9uoicnlepcn9lg.png"><br></li></ol><br><p>  V√©rifiez l'√©tat de l'objet gestionnaire de files d'attente de la m√™me mani√®re que la v√©rification de l'√©tat des domaines.  Pour ce faire, s√©lectionnez √âtat de l'objet et le filtre Afficher par: types dans le domaine de jonction.  Dans la section "IBM MQ Queue Manager", recherchez l'objet appropri√© et v√©rifiez son √©tat. </p><br><h2>  Partie 4. Passerelles multiprotocoles </h2><br><h3>  4.1.  Th√©orie </h3><br><p>  La passerelle multiprotocole (MPG) est une passerelle multiprotocole qui vous permet de recevoir des demandes de clients √† l'aide de divers protocoles, puis de les transf√©rer vers diff√©rents serveurs √† l'aide de divers protocoles.  Le protocole utilis√© par le client peut ne pas correspondre au protocole utilis√© par le serveur d'acc√®s distant. </p><br>  Dans les principaux param√®tres MPG, vous pouvez d√©finir les composants suivants: <br><br><ul><li>  XML Manager - contr√¥le la compilation et la mise en cache des feuilles de style (xsl, xslt), la mise en cache des documents. </li><li>  Strat√©gie - se compose de r√®gles, chacune d√©finissant un ensemble d'actions appliqu√©es au message passant par la passerelle. </li><li>  Param√®tres avant et arri√®re (r√©glage de l'URL, types de messages entrants et sortants, d√©lais d'expiration et plus). </li></ul><br><p>  Quelques mots sur le projet: </p><br><p>  Le projet utilise 4 passerelles multiprotocoles (routage, 2 transformationnelles pour diff√©rents syst√®mes d'extr√©mit√© et une autre con√ßue pour recevoir des fichiers du domaine des param√®tres).  Le diagramme ci-dessous montre le sch√©ma d'interaction g√©n√©ral: </p><br><img src="https://habrastorage.org/webt/p9/ea/yb/p9eayb25jpeoiazqjd0sitssuf4.png"><br><p>  La quantit√© de MPG peut varier en fonction de l'architecture de la solution dans son ensemble.  Dans notre cas, DataPower fait face √† un bus d'int√©gration (IIB) et √† des microservices, qui pr√©sentent des diff√©rences d'interfaces importantes (json / http contre xml / mq), il a donc √©t√© d√©cid√© de cr√©er des MPG transformationnels pour chaque backend sp√©cifique et de le nommer en cons√©quence.  Pour tous les clients, nous travaillons sur json / http, donc le routage MPG en est un.  Les principaux MPG sont constitu√©s de 3 r√®gles de traitement des messages - demande, r√©ponse et erreurs.  Chaque r√®gle comprend les actions n√©cessaires, telles que la transformation, la journalisation, le routage et autres. </p><br><p>  √Ä partir des fonctionnalit√©s - si dans la politique, vous utilisez l'action ConvertQueryParamToXML, alors soyez attentif √† InputConversion.  Si vous d√©finissez le codage par d√©faut sur JSON et essayez d'envoyer une demande GET, vous serez surpris de constater que le message n'a subi aucune transformation que vous avez sp√©cifi√©e et vous n'en trouverez aucune trace.  Cette fonctionnalit√© aidera √† surmonter la cr√©ation d'une r√®gle distincte pour les demandes GET. </p><br><h3>  4.2.  Pratique </h3><br><h4>  4.2.1.  La pr√©paration </h4><br><p>  Vous pouvez trouver tous les fichiers n√©cessaires au travail sur le lien <a href="">https://github.com/EvgenyaVlasenko/IBM_DataPower.git</a> <br></p><h4>  4.2.1.1.  Tronc de domaine </h4><br><ol><li>  Acc√©dez au domaine de jonction. </li><li>  Dans le panneau de configuration, s√©lectionnez Gestion des fichiers. </li><li>  Dans le r√©pertoire local, cr√©ez la structure de r√©pertoires suivante et placez-y les fichiers correspondants (chaque fichier contient une br√®ve description des fonctions qu'il ex√©cute, ainsi qu'une discussion plus d√©taill√©e √† ce sujet plus loin dans l'article). <br><img src="https://habrastorage.org/webt/oj/am/i9/ojami90qdgg81ojuyr88pmeuzd0.png"><br></li></ol><br><h4>  4.2.1.2.  Param√®tres de domaine </h4><br><ol><li>  Acc√©dez au domaine des param√®tres. </li><li>  Dans le panneau de configuration, s√©lectionnez Gestion des fichiers. </li><li>  Dans le r√©pertoire local, cr√©ez la structure de r√©pertoires suivante et placez-y les fichiers appropri√©s (les fichiers en contiennent √©galement une br√®ve description). <br><img src="https://habrastorage.org/webt/mf/9r/ne/mf9rnemyu8mcb01ad_wi6__ozj0.png"><br></li></ol><br><h3>  4.2.2.  Cr√©er GetFileMPG </h3><br><p>  Tout d'abord, cr√©ez un MPG d'assistance simple qui retournera les fichiers du domaine des param√®tres. </p><br><ol><li>  Acc√©dez au domaine des param√®tres. </li><li>  Dans le panneau de configuration, s√©lectionnez Passerelle multiprotocole et cliquez sur Cr√©er. </li><li>  Sp√©cifiez le nom (GetFileMPG), la description (facultatif) et le type de backend (dynamique).  En fait, puisqu'il n'y aura aucun appel au backend, et seul le fichier sera retourn√© depuis le syst√®me local, dans cet exemple, vous pouvez sp√©cifier n'importe quel type de backend. <br><img src="https://habrastorage.org/webt/ds/g7/5g/dsg75gxvgo-7caldbmytubddg6i.png"><br></li><li>  Sp√©cifiez les types de demande et de r√©ponse.  La sp√©cification explicite des types r√©duira le nombre de v√©rifications en ligne.  La sp√©cification du type Pass through vous permet de ne pas cr√©er de r√®gle (dans ce cas, pour transformer la r√©ponse).  Si nous sp√©cifions que le type de demande est √©galement transmis, nous ne pourrons en aucun cas traiter le message.  Cette option ne nous convient pas, nous limitons donc le type de demande √† l'aide de Non-XML. <br><br><img src="https://habrastorage.org/webt/qx/nx/l_/qxnxl_j3ki9e8hcc215zropuix8.png"><br></li><li>  Cliquez sur + et s√©lectionnez le gestionnaire HTTP pour cr√©er un nouveau protocole frontal. <br><br><img src="https://habrastorage.org/webt/dc/gq/pq/dcgqpqgpx284pxkoqdqhivwjbku.png"><br></li><li>  Ici, vous devez sp√©cifier un nom, une adresse IP, un port et une liste des m√©thodes autoris√©es.  Faites attention √† l'adresse IP.  Si vous sp√©cifiez 0.0.0.0, tout le monde peut acc√©der √† cette passerelle.  Si 127.0.0.1 - uniquement d'autres passerelles √† l'int√©rieur du m√™me DataPower.  Puisqu'il y a des param√®tres de s√©curit√© parmi les param√®tres, nous utilisons la deuxi√®me option.  Remplissez les champs et cliquez sur "Appliquer", le protocole sera automatiquement ajout√© √† la passerelle. <br><br><img src="https://habrastorage.org/webt/xn/y5/-r/xny5-rfrolidwemexqwg25-tkec.png"><br></li><li>  Cliquez sur + pour ajouter une nouvelle politique. <br><br><img src="https://habrastorage.org/webt/ju/y0/q6/juy0q6_osmjfnwd2v5xev97wvta.png"><br></li><li>  Remplissez le nom de la politique ¬´GetFilePolicy¬ª. <br></li><li>  Cr√©ez une nouvelle r√®gle, indiquez le nom et la direction de la r√®gle.  Puisqu'il n'y a vraiment pas de backend et que seul le fichier souhait√© est retourn√©, il n'y aura qu'une seule r√®gle (client vers serveur). <br><br><img src="https://habrastorage.org/webt/cv/4c/z_/cv4cz_dfzc5sjxu4i7as6iluzne.png"><br></li><li>  Double-cliquez sur l'action Correspondance pour la configurer, s√©lectionnez une r√®gle existante et appliquez les modifications.  Il serait id√©ologiquement correct de d√©finir une restriction sur la capacit√© de recevoir uniquement des requ√™tes Get, mais dans le cadre de la t√¢che de formation, vous pouvez s√©lectionner celle existante. <br></li><li>  Ajoutez une autre action - GatewayScript en la faisant glisser sur la r√®gle et en la configurant.  En tant que transformation, nous utiliserons le fichier pr√©par√©, qui dans le syst√®me de fichiers local: /// trouvera le fichier par son nom √† partir de l'URI de la demande entrante et le placera dans le corps du message.  Le r√©sultat de l'op√©ration sera transf√©r√© directement dans le tampon de sortie de la r√®gle.  Enregistrez les modifications. <br><br><img src="https://habrastorage.org/webt/ai/pr/va/aiprvaljftoye2gr5tf1xjf4s_u.png"><br></li><li>  Le r√©sultat final de la politique devrait ressembler √† ceci: <br><br><img src="https://habrastorage.org/webt/rm/q0/on/rmq0onkkkvygnyevy574vsgz3ns.png"><br></li><li>  La cr√©ation de MPG est termin√©e, enregistrez les modifications. <br></li><li>  Vous pouvez v√©rifier le succ√®s de sa cr√©ation √† l'aide de l'√©tat de l'objet, comme pour v√©rifier l'√©tat des domaines et le gestionnaire de files d'attente.  Pour ce faire, s√©lectionnez √âtat de l'objet et le filtre Afficher par: services dans le domaine des param√®tres.  Dans la section ¬´Passerelle multiprotocole¬ª, recherchez l'objet correspondant et v√©rifiez son √©tat. <br></li><li>  Vous ne pouvez pas appeler ce MPG de l'ext√©rieur, car vous l'avez prot√©g√© avec ip.  Modifiez temporairement l'ip de 127.0.0.1 √† 0.0.0.0 et le port de 7171 √† 7170 et ex√©cutez la requ√™te suivante: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/trunk/route/routeRules.xml"</code> </pre><br></li><li>  Vous devriez obtenir la r√©ponse suivante: <br><br><img src="https://habrastorage.org/webt/e5/m8/3n/e5m83ngxz17e8lahsicaxs6lj5s.png"><br></li><li>  Encore une fois, changez l'ip et le port en 127.0.0.1:7171 d'origine. <br></li></ol><br><h4>  4.2.3.  Cr√©ation de routageMPG </h4><br><p>  Cr√©ez maintenant RoutingMPG.  En fonction de la demande d'entr√©e et des r√®gles de routage, il d√©terminera o√π et avec quels param√®tres la demande doit √™tre envoy√©e. </p><br><ol><li>  Acc√©dez au domaine de jonction. </li><li>  Cr√©ez une nouvelle passerelle multiprotocole conform√©ment aux clauses 2-10 de la section 4.2.2 en utilisant les valeurs suivantes: <br><ul><li>  3 - nom: RoutingMPG, type de backend: Dynamique (pour la possibilit√© d'acheminer les demandes vers diff√©rents MPG si n√©cessaire). </li><li>  4 - Rq: non xml, Rs: non xml. </li><li>  6 - nom: RoutingHTTP_FSH, ip: 0.0.0.0, port: 7170, + m√©thode Get. </li><li>  8 - nom: RoutingPolicy. </li><li>  9 - nom: RoutingPolicy_rule_req, direction: Client to Server. </li></ul><br></li><li>  Ajoutez une action suppl√©mentaire pour acheminer la demande. Pour ce faire, faites glisser l'action "Acheminer" sur la r√®gle, double-cliquez dessus pour la configurer, remplissez les champs et appliquez les modifications.  Le fichier route.xsl re√ßoit le fichier de param√®tres de routage du domaine de param√®tres via GetFileMPG cr√©√© pr√©c√©demment.  Apr√®s cela, en fonction de l'URI, les param√®tres n√©cessaires √† cette op√©ration sont d√©j√† s√©lectionn√©s dans le fichier.  Certains d'entre eux sont utilis√©s pour le routage, et certains sont ajout√©s aux en-t√™tes pour une utilisation dans d'autres MPG.  Les param√®tres d'entr√©e et de sortie d√©terminent la fa√ßon de travailler uniquement avec le corps du message et n'affectent en aucune fa√ßon les en-t√™tes et les variables.  Par cons√©quent: entr√©e de null - puisque les informations du corps du message ne sont pas utilis√©es pour le routage.  La sortie est nulle - car le r√©sultat de la transformation n'est qu'un changement dans les informations de service. <br><br><img src="https://habrastorage.org/webt/bb/q0/nh/bbq0nh2dtogav5pyfoeneb3t66m.png"><br></li><li>  De m√™me, cr√©ez 2 r√®gles suppl√©mentaires et enregistrez toutes les modifications: <br><ul><li>  Direction: Server-Client, nom: RoutingPolicy_rule_resp; <br>  Transformation: entr√©e INPUT, sortie NULL, fichier de transformation local: ///RoutingMPG/transform/resp.xslt.  Le fichier resp.xslt re√ßoit le statut http de la r√©ponse MPG de transformation et le d√©finit explicitement sur la r√©ponse RoutingMPG.  Si cela n'est pas fait, le code par d√©faut sera d√©fini sur 200, m√™me si une erreur s'est produite dans la transformation MPG. <br></li><li>  Direction: Erreur, nom: RoutingPolicy_rule_error; <br>  Transformation: Input INPUT, Output PIPE (selon la documentation, l'utilisation de PIPE entre deux n≈ìuds d'action adjacents comme INPUT et OUTPUT peut √©liminer le traitement suppl√©mentaire et r√©duire la quantit√© de m√©moire utilis√©e), le fichier de transformation est local: ///RoutingMPG/transform/errors.xsl.  Le fichier errors.xsl re√ßoit le code d'erreur et le texte de la r√©ponse de la transformation MPG et g√©n√®re un message d'erreur JSON au format attendu par le client. <br></li></ul><br></li><li>  Le r√©sultat final de la politique devrait ressembler √† ceci: <br><br><img src="https://habrastorage.org/webt/um/kx/x-/umkxx-3kwx3hi1dzmc1e80ko-wa.png"><br></li><li>  La cr√©ation de MPG est termin√©e, enregistrez les modifications. <br></li><li>  √Ä l'aide, par exemple, de l'utilitaire curl, ex√©cutez la requ√™te suivante: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage"</code> </pre> <br></li><li>  Si vous obtenez l'erreur suivante, alors tout est fait correctement.  Cette erreur signifie que le message a √©t√© re√ßu et trait√© avec succ√®s, mais la tentative d'appel du backend (dans ce cas IIBMPG) a √©chou√©.  Passez √† l'√©tape suivante. <br><br><img src="https://habrastorage.org/webt/8g/iq/tl/8giqtlzspsyix66vnl7mkcxnelk.png"><br></li></ol><br><h4>  4.2.4.  Cr√©ation de IIBMPG </h4><br><p>  L'√©tape suivante consiste √† cr√©er un MPG transformationnel.  Supposons que le syst√®me externe soit au format de requ√™te JSON et que le interne soit XML.  Nous devons transformer le message d'entr√©e afin que le syst√®me interne puisse le comprendre.  Il convient de noter qu'il ne s'agit pas toujours d'une simple conversion de l'ensemble du message.  Il est souvent n√©cessaire de transmettre un message tronqu√© ou augment√©, parfois avec une structure compl√®tement repens√©e. </p><br><ol><li>  Acc√©dez au domaine de jonction. </li><li>  Cr√©ez une nouvelle passerelle multiprotocole conform√©ment aux clauses 2-10 de la section 4.2.2 en utilisant les valeurs suivantes: <br><ul><li>  3 - nom: IIBMPG, type de backend: dynamique </li><li>  4 - Rq: JSON, Rs: XML </li><li>  6 - nom: IIBHTTP_FSH, ip: 127.0.0.1 (uniquement les requ√™tes du m√™me DataPower), port: 7172, + m√©thode Get </li><li>  8 - Nom: IIBPolicy </li><li>  9 - nom: IIBPolicy_rule_req, direction: Client to Server </li></ul><br></li><li>  Ajoutez une description.  En fonction du nom X-DP-Transform-Name dans les en-t√™tes de demande, le fichier IIBRuleRoute.xsl re√ßoit du fichier local: ///IIB/route/IIBRouteRules.xml les noms des fichiers de transformation de demande, de r√©ponse et d'erreur pour ce service et d√©finit leurs valeurs dans les variables de contexte correspondantes var: // context / IIB / reqTransform, var: // context / IIB / ansTransform, var: // context / IIB / errTransform.  D'autres valeurs des en-t√™tes (url, uri, expire, timeout) sont √©galement plac√©es dans des variables de contexte. <br><br><img src="https://habrastorage.org/webt/xo/6b/ek/xo6bekae8dsumpvosfe5xnbhneg.png"><br></li><li>  Ajoutez une autre action en faisant glisser Avanc√© vers votre r√®gle et en s√©lectionnant Convertir les param√®tres de requ√™te en XML dans la liste, configurez.  Vous devez ajouter une nouvelle mappe de conversion d'entr√©e, en lui donnant un nom (cmnJSONParseCNVM) et le type requis (JSON). <br><br><img src="https://habrastorage.org/webt/ir/az/gb/irazgbszkybdgjkor1otjvrllqc.png"><br><br><img src="https://habrastorage.org/webt/yd/tk/2x/ydtk2xhbveh4j6z1gsweidcyhak.png"><br></li><li>  Ajoutez la transformation apr√®s la conversion standard et configurez-la.  Dans ce cas, la variable d√©finie dans la transformation pr√©c√©dente est utilis√©e pour indiquer le fichier de transformation.  Cette op√©ration est effectu√©e de mani√®re √† ce que la transformation soit universelle et que le fichier lui-m√™me soit remplac√© "√† la vol√©e" en fonction du message d'entr√©e.  Le corps du message est pr√™t.  L'√©tape suivante consiste √† router le message, et le corps du message ne changera pas, nous cr√©ons donc la variable dpvar_1 et y enregistrons le r√©sultat.  C'est cette variable que nous d√©signons l'entr√©e de l'action R√©sultats.  Enregistrez les modifications. <br><br><img src="https://habrastorage.org/webt/yz/cf/do/yzcfdogrjturkuvvmqx7bio_ex4.png"><br></li><li>  Ajoutez une action de routage et d√©finissez les param√®tres suivants.  Le fichier IIBURLRoute.xsl re√ßoit les valeurs des variables de contexte, certaines d'entre elles sont d√©finies comme variables de demande de service, et √† partir du reste, il forme un URI pour la demande au syst√®me de destination, qui stocke √©galement dans la variable de service. <br><br><img src="https://habrastorage.org/webt/kl/vk/cf/klvkcfgcro60wznqwo0ibxdncys.png"><br></li><li>  De m√™me, cr√©ez 2 r√®gles suppl√©mentaires et enregistrez toutes les modifications: <br><ul><li>  Direction: Server-Client, nom: IIBPolicy_rule_resp; <br>  Transformation: Entr√©e INPUT, Sortie PIPE, fichier de transformation var: // context / IIB / ansTransform (variable de contexte pour substituer la transformation de la r√©ponse "√† la vol√©e"). </li><li>  Direction: Erreur, nom: IIBPolicy_rule_error; <br>  Transformation: entr√©e NULL, sortie PIPE, fichier de transformation var: // context / IIB / errTransform (variable de contexte pour remplacer la transformation d'erreur √† la vol√©e). </li></ul><br></li><li>  Le r√©sultat final de la politique devrait ressembler √† ceci: <br><img src="https://habrastorage.org/webt/qi/d9/7u/qid97ursvmwifemzxbfdtudjkjc.png"><br></li><li>  La cr√©ation de MPG est termin√©e, enregistrez les modifications. <br></li></ol><br><h2>  Partie 5. Test </h2><br><h3>  5.1.  La pr√©paration </h3><br><ol><li>  T√©l√©chargez, par exemple, l'utilitaire rfhutil pour lire et √©crire des messages dans la file d'attente; </li><li>  Les fichiers de test se trouvent dans le dossier tests du m√™me r√©pertoire que les fichiers de projet. </li></ol><br><h3>  5.2.  Bilan de sant√© </h3><br><ol><li>  Envoyez la demande √† l'aide de l'utilitaire curl (pour la demande ci-dessous, le r√©pertoire en cours doit √™tre le m√™me que example.json). <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage" -H "Content-Type: application/json" --data-binary @example.json</code> </pre> <br></li><li>  Ouvrez 2 instances de l'utilitaire rfhutil et soustrayez le message de la file d'attente DP.IIB.REQIN avec la premi√®re instance; <br></li><li>  Acc√©dez √† l'onglet MQMD et copiez le MessageID; <br></li><li>  Dans la deuxi√®me instance, ouvrez le fichier rs.xml, dans l'onglet MQMD, ins√©rez l'identifiant de message dans CorrelID et placez le message dans la file d'attente DP.IIB.RESIN; <br></li><li>  Vous devriez obtenir une r√©ponse similaire: <br><br><img src="https://habrastorage.org/webt/mn/kj/xj/mnkjxj0lyafkvo7hjgpyytuytee.png"><br></li><li>  R√©p√©tez les √©tapes 1 √† 3; <br></li><li>      rs_error.xml       correllId; <br></li><li>     <br><br><img src="https://habrastorage.org/webt/_y/i5/hb/_yi5hbw1lnrfwsuryyln9z3rdic.png"><br></li></ol><br><h2>  6.  </h2><br><h3> 6.1.  Th√©orie </h3><br><p> Log Targets   ,         . <br></p><br><p>     Log Targets    .     ,      4     1000Kb,      .              2-4    .       ,        .  , DataPower,  , ,   ,        ,      ,      -  MPG,     . <br></p><br><h3> 6.2.  </h3><br><ol><li>    trunk; </li><li>    Log Target   ; </li><li>      : <br><ul><li> (IIB_LOG); </li><li> (File); </li><li>  (Text); </li><li>  timestamp(zulu); </li><li>   (logtemp:///IIB.log ‚Äî  IIBMPG); </li><li>  (1000). <br><img src="https://habrastorage.org/webt/ev/sm/mj/evsmmjxy8m6suwkbaeojvgcudf8.png"><br></li></ul><br></li><li>   .        MPG   IIBMPG. <br><br><img src="https://habrastorage.org/webt/lq/vl/5l/lqvl5lvc_w8powdnufq6emgjgwc.png"><br></li><li>    ,     ,    (  ,        ). <br><br><img src="https://habrastorage.org/webt/ia/tu/98/iatu98v3l0fioelwktk8uwu-6fw.png"><br></li><li>         ; <br></li><li>    ; <br></li><li>          . <br></li><li>      Log Targets    MPG. <br></li><li>   : <br><ul><li>             , ,         . <br><br><img src="https://habrastorage.org/webt/z2/ix/vt/z2ixvtjk8eidxsfbbe6mmfcecnc.png"><br></li><li>        . <br><br><img src="https://habrastorage.org/webt/go/ik/wl/goikwl1pdvlzhiyd_d7gqpffzo8.png"><br></li></ul><br></li></ol><br><h2>  7.  -    </h2><br><ol><li>       ‚Äì  ,   .    ‚Äì  ,   ,     -    . <br></li><li>      .       View Logs.      ,  ¬´  ¬ª, ¬´   ¬ª     . <br></li><li>       .           .       MPG       Show Probe -&gt; Enable Probe.         .   ,        . <br><br><img src="https://habrastorage.org/webt/re/6s/mh/re6smhejkm-i8cdmmeky6ch6cmy.png"><br></li><li>   ,      . <br></li></ol><br><p>     ‚Äì    . <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442686/">https://habr.com/ru/post/fr442686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442674/index.html">Instances de s√©curit√© des informations sur la plateforme attackdefense.com</a></li>
<li><a href="../fr442676/index.html">O√π les r√™ves m√®nent: souterrain</a></li>
<li><a href="../fr442678/index.html">Plus grand projet en st√©r√©olithographie: squelette de mammouth imprim√© sur une imprimante 3D</a></li>
<li><a href="../fr442680/index.html">Les technologies de remplacement sensoriel vous permettront de voir le monde √† l'aide des sons: comment fonctionne la neuroplasticit√© du cerveau humain</a></li>
<li><a href="../fr442684/index.html">Performance du site √©quilibr√©e. Partie 3: Contenu</a></li>
<li><a href="../fr442688/index.html">L'analyse des donn√©es Scala - un besoin urgent ou une opportunit√© agr√©able?</a></li>
<li><a href="../fr442690/index.html">Mission lunaire "Bereshit" - selfie sur le fond de la Terre</a></li>
<li><a href="../fr442692/index.html">Blockchain sans interm√©diaires: comment nous avons envoy√© des titres √† un registre distribu√©</a></li>
<li><a href="../fr442694/index.html">L'un des g√©ants du streaming lanc√© en Inde et a attir√© un million d'utilisateurs en une semaine</a></li>
<li><a href="../fr442696/index.html">S for Security: Internet Security of Things and reports at InoThings ++ 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>