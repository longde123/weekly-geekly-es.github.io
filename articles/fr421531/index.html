<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë©‚Äçüë¶‚Äçüë¶ üöÇ üè¨ Comment int√©grer ReactJS dans 1C-Bitrix avec g√©n√©ration automatique de mod√®les sur le back-end en utilisant l'exemple du r√©seau Globus ‚ûó üßëüèæ ü•Ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette ann√©e, ReactJS a √©t√© lanc√© pour la premi√®re fois sur la boutique en ligne de la cha√Æne d'hypermarch√©s Globus. Le projet est int√©ressant en ce qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment int√©grer ReactJS dans 1C-Bitrix avec g√©n√©ration automatique de mod√®les sur le back-end en utilisant l'exemple du r√©seau Globus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421531/"> Cette ann√©e, ReactJS a √©t√© lanc√© pour la premi√®re fois sur la boutique en ligne de la cha√Æne d'hypermarch√©s Globus.  Le projet est int√©ressant en ce qu'il √©tend les capacit√©s de la plate-forme Bitrix et conserve en m√™me temps la capacit√© de g√©n√©rer des pages pour les moteurs de recherche et n'encombre pas avec la duplication de code et de mise en page.  Dans cet article, nous expliquons comment connecter des composants Bitrix aux composants ReactJS √† l'aide du module v8js pour php et enregistrer la partie avant principale du site. <br><a name="habracut"></a><br><h3>  Pourquoi √©tait-ce n√©cessaire? </h3><br>  Initialement, la logique du site Internet de la boutique en ligne s'est construite sur la biblioth√®que Marionette.js.  Il y a quelques ann√©es, cette logique a port√© ses fruits, mais au fil du temps, les exigences commerciales pour la fonctionnalit√© frontale ont tellement augment√© que chaque raffinement s'est accompagn√© de graves difficult√©s.  En raison de la charge √©lev√©e, la vitesse de la partie avant a diminu√© et a laiss√© beaucoup √† d√©sirer.  Pour r√©soudre ce probl√®me, nous avons choisi ReactJS, mais il y avait un probl√®me avec le rendu des pages vers le back-end, puis la liaison de parties des pages aux composants React.  Dans le m√™me temps, notre objectif √©tait une transition progressive vers ReactJS,  des changements spectaculaires pourraient conduire √† une refonte compl√®te du front. Par cons√©quent, le choix s'est port√© sur les √©l√©ments suivants: <br><br><ul><li>  Cartes de produits; </li><li>  Mini panier; </li><li>  Le menu </li></ul><br>  La principale difficult√© lors du transfert de mini-paniers et de cartes de produits vers ReactJS a √©t√© la synchronisation instantan√©e de la quantit√© de marchandises dans les deux composants, c'est-√†-dire  si 3 kg de carottes sont dans le panier, alors dans le bloc pour ajouter des marchandises au panier (cueilleur) 3 kg doivent √™tre affich√©s, et lorsque la quantit√© de marchandises dans le mini-panier change, le changement doit se produire dans le cueilleur et vice versa.  En outre, il √©tait n√©cessaire de niveler le d√©calage de la demande principale afin que l'interface fonctionne le plus rapidement possible. <br><br><img src="https://habrastorage.org/webt/zs/0-/4t/zs0-4tm2cptsxb_ertod4wohimm.png">  " <br><br>  Une complexit√© suppl√©mentaire √©tait la sp√©cificit√© du magasin (commerce alimentaire), o√π il y a le concept de marchandise √† la pi√®ce.  Il s'agit d'un produit qui est consid√©r√© en kg, mais l'utilisateur l'ach√®te en morceaux, par exemple une past√®que, que le client ne peut acheter en partie, que dans son int√©gralit√©.  Un tel produit pour l'utilisateur doit √™tre affich√© en nombre de pi√®ces, mais sur le back-end, il est consid√©r√© en kilogrammes. <br><br><h3>  Comment avez-vous r√©solu le probl√®me? </h3><br>  Afin de ne pas dupliquer la disposition des composants dans les mod√®les du syst√®me 1C-Bitrix et React, il a √©t√© d√©cid√© de le placer sur les composants React.  Le nom du composant dans React doit co√Øncider avec le mod√®le de composant syst√®me 1C-Bitrix.  Pour mettre en ≈ìuvre de telles id√©es, nous avons utilis√©: <br><br><ul><li>  Module V8js pour php; </li><li>  reactjs / react-php-v8js; </li><li>  webpack. </li></ul><br>  Le premier √©l√©ment est le module v8js, qui devrait convertir nos composants react en une disposition statique dans un environnement php. <br><br>  Ce qui suit est une petite biblioth√®que de React Community, qui est un wrapper pour une initialisation React plus facile dans l'environnement js du module v8js. <br><br>  Et bien s√ªr webpack, o√π sans lui.  En conjonction avec babel, il vous permet d'utiliser des mod√®les jsx et la norme es6 pour √©crire du code.  Tous les exemples seront pr√©sent√©s dans la syntaxe es6.  C'est assez simple, mais s'il n'est pas imm√©diatement compris, vous devez alors vous rafra√Æchir la m√©moire. <br><br>  <i>Module V8js pour php.</i> <br><br>  Ce module est une extension pour php, qui vous permet d'utiliser le moteur Javascript V8 pour ex√©cuter du code js en php.  S'installe tout simplement, comme une extension PECL standard.  L'essentiel est que vous ayez dans vos biblioth√®ques syst√®me et fichiers d'en-t√™te V8. <br><br>  <i>Webpack</i> <br><br>  Pour construire la biblioth√®que de composants react et react, nous utilisons webpack.  Les fichiers d'assemblage pour l'avant et l'arri√®re sont l√©g√®rement diff√©rents.  Nous allons √† 3 fichiers: <br><br><ul><li>  initialize.js -&gt; app.js - application pour le devant; </li><li>  reactServer.js -&gt; reactBuild.js - biblioth√®que react pour le c√¥t√© serveur; </li><li>  components.js -&gt; reactComponents.js - une collection de composants react. </li></ul><br>  La principale diff√©rence entre l'assemblage pour le rendu du serveur est que toutes les biblioth√®ques et les composants doivent √™tre plac√©s dans l'objet global et les biblioth√®ques sont connect√©es via la fonction require.  La directive d'importation pour une raison quelconque ne fonctionne pas. <br><br>  Tous les fichiers source se trouvent dans le r√©pertoire local / templates / &lt;nom du mod√®le&gt; / src / <br><br><img src="https://habrastorage.org/webt/gg/vz/ck/ggvzckbgtq4g4jl9ftrgkr5ipnu.png"><br><br>  √Ä la racine du projet se trouve webpack.config.js - settings. <br><br><img src="https://habrastorage.org/webt/fd/2j/yk/fd2jykgbdtcbpwfjn11goi5s8xq.png"><br><br>  Le contenu des fichiers d'assemblage se trouve √† la fin de l'article. <br><br>  Npm et les packages suivants doivent √™tre install√©s: <br><br><ul><li>  babel; </li><li>  babel-cli; </li><li>  webpack </li><li>  r√©agir </li><li>  react-dom; </li><li>  soulignement // facultatif. </li></ul><br>  L'assemblage se fait en ex√©cutant la commande: <br>  $ webpack. <br><br>  <i>Personnalisation du moteur de mod√®le bitrix</i> <br><br>  Pour enregistrer un moteur personnalis√© dans le syst√®me 1C-Bitrix, vous devez ajouter ses param√®tres √† la variable globale $ arCustomTemplateEngines.  Dans la cl√©, vous devez sp√©cifier le code de votre moteur.  Nous avons utilis√© ¬´JSX¬ª.  Dans les valeurs, vous devez sp√©cifier l'extension de fichier du mod√®le, la fonction de rendu du mod√®le.  Il est conseill√© de sp√©cifier un tri en dessous d'une valeur de 100, afin que la priorit√© de notre moteur soit sup√©rieure √† la norme. <br><br>  Cr√©ez une classe JSXEngine avec les m√©thodes suivantes: <br><br><ul><li>  setEngine - enregistre un mod√®le; </li><li>  init - initialisation de v8js via le wrapper de biblioth√®que reactjs / react-php-v8js; </li><li>  ex√©cuter - fonctionnalit√© de rendu de mod√®le </li></ul><br>  et une fonction wrapper pour le rendu du mod√®le _JSXEngineExecute, car  Le syst√®me 1C-Bitrix n√©cessite l'enregistrement d'une fonction particuli√®re. <br><br>  Afin de ne pas initialiser chaque fois une instance React, placez-la dans une variable statique et ajoutez une m√©thode d'initialisation. <br><br>  Une interface sp√©ciale est impl√©ment√©e dans la classe ReactJS de la biblioth√®que reactjs / react-php-v8js pour rendre le composant react.  Le constructeur de classe prend deux param√®tres en entr√©e, qui doivent contenir le code js du module react et tous les composants react utilis√©s dans le projet collect√©s via webpack.  Apr√®s l'initialisation, nous pouvons les rendre.  Pour ce faire, appelez la m√©thode setComponent d'installation du composant avec les param√®tres du nom du composant et du tableau d'accessoires.  Apr√®s cela, la m√©thode getMarkup affichera le contenu du composant et getJS affichera le code js pour lier le composant √† l'avant.  La m√©thode getJS n√©cessite l'identifiant du bloc html dans lequel se trouve le composant dans les param√®tres.  Pour ce faire, nous avons impl√©ment√© un mod√®le simple pour encapsuler un composant rendu dans un bloc html.  Les param√®tres du bloc lui-m√™me sont transf√©r√©s dans un fichier json, qui est plac√© dans le mod√®le de composant syst√®me 1C-Bitrix.  Les param√®tres sont stock√©s au format json. <br><br><img src="https://habrastorage.org/webt/t7/fd/r3/t7fdr30zlxslwvouggmryh6bvgu.png"><br><br><img src="https://habrastorage.org/webt/6g/ng/op/6gngopga5l-r10z4zfqzkjjgmbw.jpeg"><br><br>  <i>Transf√©rer un composant vers un nouveau mod√®le</i> <br><br>  Nous allons montrer la traduction du composant dans React en utilisant l'exemple d'un composant de menu standard.  La disposition du composant a d√©j√† √©t√© int√©gr√©e dans le moteur de mod√®le standard.  React recommande une strat√©gie pour diviser les fonctionnalit√©s en composants.  De plus, les composants peuvent √™tre tr√®s petits.  Jusqu'√† la balise hyperlien.  Nous ne d√©composerons pas notre menu √† de telles bagatelles, mais nous ferons n√©anmoins une petite d√©composition. <br><br>  Notre menu utilise l'imbrication jusqu'√† 3 niveaux.  Par cons√©quent, il sera logique de diviser la fonctionnalit√© du menu en 3 composants r√©actifs, chacun par niveau.  Si vous regardez attentivement, vous remarquerez que les √©l√©ments de menu du deuxi√®me niveau sont organis√©s en deux colonnes.  Cette fonctionnalit√© doit √™tre plac√©e dans un composant suppl√©mentaire. <br><br><img src="https://habrastorage.org/webt/y1/uy/fo/y1uyfohp9vilnly4xun9zkfe5pm.png"><br><br>  Ainsi, nous avons 4 composants.  Nous les placerons dans les fichiers TopMenu.js, SubMenuLevel2.js, SubMenuLevel3.js, TwoColumnItem.js dans le r√©pertoire src / components (voir le code pour les autres composants √† la fin): <br><br><img src="https://habrastorage.org/webt/nt/80/bj/nt80bjgwhznbqv9ckuiursphqyw.png"><br><br>  Pour que notre mod√®le fonctionne, vous devez cr√©er un mod√®le pour le composant de menu syst√®me 1C-Bitrix.  Le nom du mod√®le doit correspondre au nom du composant React.  √Ä l'int√©rieur du mod√®le, vous devez placer le fichier avec l'extension correspondant aux param√®tres de notre moteur.  Dans le fichier, vous devez sp√©cifier le n≈ìud html dans lequel notre composant react sera rendu. <br><br><h3>  R√©sultat </h3><br>  Cette solution vous permet d'utiliser des composants React sur le c√¥t√© back-end et sur le c√¥t√© front-end.  Ainsi, la logique d'affichage de la fonctionnalit√© est stock√©e en un seul endroit, ce qui facilite grandement l'accompagnement du projet. <br><br>  La vitesse de rendu de page initiale a augment√© de pr√®s de 1 s.  Parce que  Maintenant, vous n'avez pas besoin de redessiner l'√©l√©ment house dans lequel se trouve le composant.  ReactJs le prend √† la vol√©e.  De plus, le clignotement des √©l√©ments sur les appareils faibles a disparu. <br><br>  √Ä l'avenir, pr√©voit de passer au rendu des composants c√¥t√© serveur via un service bas√© sur node.js et de mettre en ≈ìuvre une application d'une seule page tout en conservant la possibilit√© de g√©n√©rer des pages pour le r√©f√©rencement. <br><br><h3>  App </h3><br>  initialize.js <br><br><img src="https://habrastorage.org/webt/s_/n2/mz/s_n2mz7lilpjjdadeg0ppctjlmk.png"><br><br>  components.js <br><br><img src="https://habrastorage.org/webt/gs/eo/m7/gseom7029c7ams6zdvaojkl894c.png"><br><br>  reactServer.js <br><br><img src="https://habrastorage.org/webt/bh/ne/ln/bhnelnigqxydigkiafpmoccwvwm.png"><br><br>  SubMenuLevel2.js <br><br><img src="https://habrastorage.org/webt/ep/7t/xa/ep7txacqkwh--ep9lealiucgves.png"><br><br>  SubMenuLevel3.js <br><br><img src="https://habrastorage.org/webt/8l/bo/oq/8lbooq9g6y2ivrt_sr7pti6eyzc.png"><br><br>  TwoColumnItems.js <br><br><img src="https://habrastorage.org/webt/lv/5s/bk/lv5sbkebar6j_yvdjwjv3s01nca.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421531/">https://habr.com/ru/post/fr421531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421521/index.html">Monstres apr√®s les vacances: AMD Threadripper 2990WX 32-Core et 2950X 16-Core (partie 3 - tests)</a></li>
<li><a href="../fr421523/index.html">Unity: apprendre √† conna√Ætre les objets scriptables</a></li>
<li><a href="../fr421525/index.html">Un peu sur les diff√©rences entre les h√©bergeurs russes et √©trangers</a></li>
<li><a href="../fr421527/index.html">Lancement de la diffusion du projet "Serveur dans les nuages"</a></li>
<li><a href="../fr421529/index.html">Netflix, Uber, Google et vous au MBLT DEV 2018</a></li>
<li><a href="../fr421533/index.html">Choisir un langage de programmation: 3 conseils d'un programmeur d'Apple</a></li>
<li><a href="../fr421535/index.html">Aventure - Electronique. Sur une balan√ßoire ail√©e dans le monde informatique</a></li>
<li><a href="../fr421537/index.html">Fonctions d'ordre sup√©rieur dans JS: cours pour jeunes combattants</a></li>
<li><a href="../fr421543/index.html">Clonez une carte sans contact √† l'aide d'une application mobile</a></li>
<li><a href="../fr421545/index.html">Examen du PocketBook 616 - le portefeuille le plus √©conomique 2018 avec fonction de r√©tro-√©clairage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>