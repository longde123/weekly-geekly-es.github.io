<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍⚕️ 🧤 🤜🏾 Tekton Pipeline - Pipelines natifs de Kubernetes 🥈 🌍 ⌛️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tekton Pipeline est un nouveau projet qui vous permet d'exécuter des pipelines CI / CD en utilisant l'approche native Kubernetes. Tekton Pipelines fai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tekton Pipeline - Pipelines natifs de Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/nixys/blog/481992/"><img src="https://habrastorage.org/webt/if/-m/ln/if-mlnjgcxunsts0i1urllbrp2m.png"><br><p>  <a href="https://github.com/tektoncd/pipeline">Tekton Pipeline</a> est un nouveau projet qui vous permet d'exécuter des pipelines CI / CD en utilisant l'approche native Kubernetes.  Tekton Pipelines faisait initialement partie du projet «Knative build».  Si vous voulez en savoir plus sur ce projet, je vous recommande fortement de visiter leur site Web, qui est disponible sur le lien <a href="https://knative.dev/">ici</a> . </p><a name="habracut"></a><br><p>  Avant de commencer à parler de ce que signifie «natif de Kubernetes» et du fonctionnement de Tekton Pipeline, je voudrais prendre un peu de recul et expliquer brièvement pourquoi l'exécution de pipelines dans des conteneurs plutôt que sur l'hôte est si importante et utile: il y a quelque temps nous avons commencé à transférer les applications avec lesquelles nous travaillons vers des conteneurs.  Nous l'avons fait en raison d'avantages tels que l'isolement, les dépendances transparentes, l'évolutivité et l'immuabilité.  Cela ne serait-il pas tout aussi utile pour les pipelines CI / CD?  Pensez aux «build-hosts», qui fourniraient les outils et les dépendances nécessaires pour une tâche de build spécifique.  À propos d'un environnement qui serait le même à chaque lancement et qui n'aurait pas de dépendances avec d'autres projets, ce qui pourrait causer des problèmes.  Et aussi, sur les pipelines de mise à l'échelle faciles.  C'est pourquoi nous pouvons et devons exploiter des pipelines conteneurisés! </p><br><p>  Maintenant que nous avons parlé brièvement de la conteneurisation des pipelines, voyons comment le projet Tekton Pipeline avec son approche native Kubernetes pourrait aider: </p><br><p>  Tekton Pipeline nous permet d'exécuter des pipelines conteneurisés dans nos clusters Kubernetes existants.  Cela signifie que nous n'avons pas besoin de machines supplémentaires pour faire fonctionner nos pipelines et, par conséquent, nous pouvons mieux utiliser les machines existantes. </p><br><p>  C'est génial, mais pour être honnête, cela ne rend pas le pipeline Tekton unique.  Par conséquent, Tekton Pipeline va plus loin et stocke tout ce qui concerne nos pipelines dans Kubernetes - en tant que ressource Kubernetes.  Cela nous permet de travailler avec nos convoyeurs, ainsi qu'avec toute autre ressource.  Pensez au déploiement ou au service, que vous pouvez créer et gérer à l'aide de fichiers kubectl et YAML. </p><br><p><img src="https://habrastorage.org/webt/0o/vq/od/0ovqodjpimsar9_s3-fmkw2b9nc.png" alt="image"></p><br><h2 id="s-chego-nachat">  Par où commencer </h2><br><p>  Comme mentionné ci-dessus, le pipeline Tekton est situé à l'intérieur du cluster Kubernetes.  Il est basé sur 5 définitions de ressources personnalisées (CRD), déploiements, cartes de configuration et services.  Vous pouvez exécuter la commande suivante pour démarrer: </p><br><pre><code class="plaintext hljs">kubectl apply -f https://storage.googleapis.com/tekton-releases/latest/release.yaml</code> </pre> <br><p>  En plus des ressources ci-dessus, il créera également un espace de noms, une politique de sécurité des pods, un compte de service et des rôles de cluster.  Tekton Pipeline est prêt à fonctionner dès que tous les pods du nouvel espace de noms (le nom par défaut est tekton-pipelines) sont prêts. </p><br><p>  Bien sûr, vous pouvez visualiser ce fichier YAML et le personnaliser selon vos besoins. </p><br><p>  Si vous devez partager des artefacts ou d'autres ressources de pipelines entre les tâches, vous devez configurer le stockage pour celles-ci.  Vous pouvez utiliser le PVC, qui vous sera demandé chaque fois que cela sera nécessaire (l'initialisation dynamique du volume est la clé!), Ou le stockage Blob.  Vous trouverez plus d'informations sur cette tâche <a href="">ici</a> . </p><br><h2 id="pervyy-pipeline">  Premier pipeline </h2><br><p>  Alors, comment fonctionne Tekton Pipelines?  Je vais expliquer la différence entre les définitions de ressources personnalisées Tekton Pipelines dans de petits exemples.  Pipeline créera (construira) une petite application sur Go, créera l'image requise puis la poussera dans le Registre.  Vous pouvez trouver tous les fichiers pertinents <a href="https://gitlab.com/nmeisenzahl/tekton-demo">ici</a> . </p><br><p>  Tout d'abord, nous créons deux définitions <a href="">PipelineResouce</a> que nous utiliserons pour définir le référentiel Git et le registre comme destination finale comme code source.  Les ressources de pipeline sont facultatives et donc très utiles pour utiliser les mêmes pipelines, mais avec des sources et des destinations différentes. </p><br><pre> <code class="plaintext hljs">apiVersion: tekton.dev/v1alpha1 kind: PipelineResource metadata: name: git-repo spec: type: git params: - name: revision value: master - name: url value: https://gitlab.com/nmeisenzahl/tekton-demo --- apiVersion: tekton.dev/v1alpha1 kind: PipelineResource metadata: name: image-registry spec: type: image params: - name: url value: registry.gitlab.com/nmeisenzahl/tekton-demo/demo:latest</code> </pre> <br><p>  Nous devons maintenant créer une ressource de <a href="">tâche</a> pour déterminer la séquence des étapes de notre pipeline.  Bien sûr, si nécessaire, vous pouvez créer plusieurs tâches.  Dans notre exemple, nous utiliserons <a href="https://github.com/GoogleContainerTools/kaniko">Kaniko</a> pour créer une image.  Ce Dockerfile, comme d'autres ressources pour l'application, se trouve dans le référentiel Git. </p><br><pre> <code class="plaintext hljs">apiVersion: tekton.dev/v1alpha1 kind: Task metadata: name: build-docker-image spec: inputs: resources: - name: git-repo type: git params: - name: pathToDockerFile description: Path to Dockerfile default: /workspace/git-repo/Dockerfile - name: pathToContext description: The build context used by Kaniko default: /workspace/git-repo outputs: resources: - name: image-registry type: image steps: - name: build-and-push image: gcr.io/kaniko-project/executor:v0.10.0 env: - name: "DOCKER_CONFIG" value: "/builder/home/.docker/" command: - /kaniko/executor args: - --dockerfile=${inputs.params.pathToDockerFile} - --destination=${outputs.resources.image-registry.url} - --context=${inputs.params.pathToContext}</code> </pre> <br><p>  Nous pouvons maintenant créer une ressource <a href="">TaskRun</a> pour lancer une instance de la tâche ci-dessus.  Cependant, dans cet exemple, nous utilisons <a href="">Pipeline</a> , que nous pouvons utiliser pour combiner plusieurs tâches (tâches) d'affilée: </p><br><pre> <code class="plaintext hljs">apiVersion: tekton.dev/v1alpha1 kind: Pipeline metadata: name: demo-pipeline spec: resources: - name: git-repo type: git - name: image-registry type: image tasks: - name: build-docker-image taskRef: name: build-docker-image params: - name: pathToDockerFile value: /workspace/git-repo/Dockerfile - name: pathToContext value: /workspace/git-repo resources: inputs: - name: git-repo resource: git-repo outputs: - name: image-registry resource: image-registry</code> </pre> <br><p>  Puisque nous avons mis l'image créée dans le registre, vous devez vous assurer que le pipeline peut s'authentifier en définissant <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">ImagePullSecrets</a> pour le compte de service souhaité (dans notre cas, il s'agit du compte de service - par défaut). </p><br><p>  Nous avons maintenant tout le nécessaire pour lancer le pipeline.  Pour ce faire, nous devons spécifier la dernière définition de la ressource <a href="">PipelineRun</a> : </p><br><pre> <code class="plaintext hljs">apiVersion: tekton.dev/v1alpha1 kind: PipelineRun metadata: name: demo-pipeline-run-1 spec: pipelineRef: name: demo-pipeline resources: - name: git-repo resourceRef: name: git-repo - name: image-registry resourceRef: name: image-registry</code> </pre> <br><p>  Vous pouvez utiliser <code>kubectl get pipelineruns -o yaml</code> pour vérifier l'état du pipeline. </p><br><h2 id="bolee-togo">  De plus </h2><br><p>  En plus du projet Tekton Pipeline lui-même, il existe également un projet pour la <a href="https://github.com/tektoncd/cli">CLI</a> qui facilite le travail avec les pipelines.  Vous pouvez également configurer un <a href="https://github.com/tektoncd/dashboard">tableau</a> de <a href="https://github.com/tektoncd/dashboard">bord Web</a> pour afficher et gérer vos pipelines à partir d'un navigateur. </p><br><p>  De plus, la même équipe travaille sur un autre projet appelé Tekton Triggers.  Ce projet est assez récent (le premier commit remonte à 4 semaines) et est toujours en développement.  Les déclencheurs Tekton vous permettent d'appeler Tekton Pipelines en fonction de «déclencheurs».  Il peut s'agir de git-commits, de git-issues ou de tout autre webhook (web hooks).  Plus d'informations sont disponibles <a href="https://github.com/tektoncd/triggers">ici</a> . </p><br><h2 id="takzhe-chitayte-drugie-stati-v-nashem-bloge">  Lisez également d'autres articles sur notre blog: </h2><br><ul><li>  <a href="https://habr.com/ru/company/nixys/blog/473578/">Création de modules dynamiques pour Nginx</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/473014/">Présentation de l'autorisation Kubernetes du consul Hashicorp</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/468779/">Quel a été le résultat de la migration de ClickHouse sans autorisation vers ClickHouse avec autorisation</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/470568/">Déploiement bleu-vert des applications Spring avec Nginx Web Server</a> </li><li>  <a href="https://habr.com/ru/company/nixys/blog/467107/">Comment exécuter plusieurs pipelines à l'aide de GitLab CI / CD</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481992/">https://habr.com/ru/post/fr481992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481974/index.html">Test du melon d'eau à l'aide de réseaux de neurones: Full Dev. Passez du prototypage à l'application. sur google play</a></li>
<li><a href="../fr481978/index.html">Comment organiser le travail efficace d'une équipe de mise en page distribuée</a></li>
<li><a href="../fr481980/index.html">Comment nous avons optimisé les scripts dans Unity</a></li>
<li><a href="../fr481988/index.html">Pourquoi Koji est la ressource parfaite pour les créateurs d'applications KaiOS novices</a></li>
<li><a href="../fr481990/index.html">Dix ans de malware: les plus gros botnets de 2010</a></li>
<li><a href="../fr481998/index.html">Machine de Turing, comme modèle de programmes d'automates</a></li>
<li><a href="../fr482000/index.html">Aimez-vous votre entreprise?</a></li>
<li><a href="../fr482002/index.html">Rédaction d'un blog sur les microservices - Partie 3 «Utilisateur»</a></li>
<li><a href="../fr482004/index.html">Nous testons 1C sur le serveur VPS</a></li>
<li><a href="../fr482008/index.html">Constructeur LEGO et zéro absolu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>