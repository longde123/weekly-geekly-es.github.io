<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🤝‍👨🏾 ➿ 🕟 Surfer sur Internet avec une manette de jeu (Javascript) 🤹 🤷🏾 🤩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Assis à la table, vous utilisez la souris et le clavier tout en étant assis sur le canapé - très probablement le pavé tactile d'un ordinateur portable...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surfer sur Internet avec une manette de jeu (Javascript)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485562/"><p><img src="https://habrastorage.org/webt/ep/vg/pu/epvgpuyawysxaiqnq7p0vkfv_9y.jpeg"></p><br><p>  Assis à la table, vous utilisez la souris et le clavier tout en étant assis sur le canapé - très probablement le pavé tactile d'un ordinateur portable ou l'écran tactile d'une tablette.  Vous pouvez même utiliser Leap Motion et contrôler votre ordinateur avec des gestes.  Comme vous l'avez déjà compris, il existe de nombreuses façons de surfer sur Internet et de gérer votre ordinateur.  Un gamepad peut être l'un d'entre eux. </p><br><p>  Dans cet article, je vais partager avec vous comment: </p><br><ul><li>  connecter la manette de jeu au navigateur </li><li>  écouter les événements de la manette de jeu </li><li>  contrôler la concentration sur les éléments de la page à l'aide d'une manette de jeu </li><li>  faire des commentaires sous forme de vibrations </li></ul><br><p> Connectez votre manette de jeu via USB ou Bluetooth et commençons. </p><a name="habracut"></a><br><h3 id="geympad-api">  API de la manette de jeu </h3><br><p>  <a href="https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API" rel="nofollow">Une manette de jeu API a</a> été ajoutée à la norme HTML 5. L'API permet l'utilisation de manettes de jeu dans un navigateur.  En combinaison avec un élément, cette API peut être utilisée pour créer des jeux qui prennent en charge une manette de jeu.  Par conséquent, les utilisateurs peuvent jouer à des jeux en utilisant la manette de jeu directement dans le navigateur, ce qui est très cool.  Mais l'API peut être utilisée non seulement pour les jeux.  Personne ne vous empêche de créer un périphérique d'entrée sous la forme d'une manette de jeu à des fins complètement différentes. <br></p><blockquote>  <a href="https://dev.caniuse.com/gamepad" rel="nofollow">L'API Gamepad est bien prise en charge</a> , mais toujours au stade de brouillon.  Peut-être que quelque chose va changer, être supprimé ou ajouté à l'avenir. </blockquote><br><h3 id="podklyuchaem-geympad">  Nous connectons une manette de jeu </h3><br><p>  Lorsque la manette de jeu se connecte à l'ordinateur via USB ou Bluetooth, nous pouvons utiliser deux événements afin de gérer les connexions et les déconnexions: </p><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'gamepadconnected'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// , -   console.log(event) }); window.addEventListener('gamepaddisconnected', function(event) { // , -   });</span></span></code> </pre> <br><p>  La manette de jeu ne commencera à fonctionner qu'après avoir appuyé sur le bouton (environ Traduire tout ou Démarrer).  Le fait est qu'il s'agit de la sécurité / confidentialité du navigateur.  Par conséquent, il est nécessaire de réfléchir à l'interface informant l'utilisateur de la nécessité d'appuyer sur un bouton pour commencer le travail. </p><br><p>  Les événements de la manette de jeu sont les suivants dans la console: </p><br><p><img src="https://habrastorage.org/webt/qy/yh/dh/qyyhdhijlimo1vb57vykhhamo1a.png"></p><br><h3 id="raskladka-geympada-knopki-i-osi">  Disposition de la manette de jeu: boutons et axes </h3><br><p>  Comme vous pouvez le voir, le journal des événements a un tas de boutons (0 - 16) et d'axes (axes 0 - 3).  Mais comment savez-vous comment les boutons se cachent derrière le numéro?  Les manettes de jeu ont des dispositions différentes selon la marque.  Par conséquent, vous devez rechercher des informations sur Internet.  Dans ce cas, nous connectons la manette de jeu Xbox One et elle a cette disposition: </p><br><p><img src="https://habrastorage.org/webt/ha/hr/hb/hahrhbrn2u26e-q6idtlyxbbbgy.png"></p><br><h3 id="slushaem-nazhatie-klavishi">  Écoutez la frappe </h3><br><p>  Lors du développement d'interfaces, vous pouvez utiliser <code>.addEventListener()</code> pour ajouter un événement sur une frappe de touche.  Dans ce cas, cela ne peut pas être fait, car les boutons du contrôleur ne créent pas d'événements.  Et comme vous pouvez le voir dans le journal ci-dessus, vous devez vérifier manuellement le champ <code>pressed</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> xBoxButtonB = gamepad.buttons[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xBoxButtonB.pressed) { doSomethingOnButtonPress(); }</code> </pre> <br><p>  Comme nous voulons faire la vérification tout le temps, nous devons tout boucler.  Par exemple, en utilisant <code>requestAnimationFrame</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rAF = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.mozRequestAnimationFrame || <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.requestAnimationFrame; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'gamepadconnected'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ updateLoop(); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateLoop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    rAF(updateLoop); }</span></span></code> </pre> <br><h3 id="navigaciya-mezhdu-elementami">  Navigation entre les éléments </h3><br><p>  Pour utiliser la manette de jeu pour naviguer sur la page Web, vous devez simuler le clavier.  Mais vous devez d'abord obtenir tous les éléments de la page qui peuvent être ciblés. <br>  En utilisant le sélecteur suivant, vous pouvez obtenir tous ces éléments: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> focusableElements = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll( <span class="hljs-string"><span class="hljs-string">'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'</span></span> );</code> </pre> <br><h3 id="dvigaem-fokus-programmno">  Déplacer le focus par programme </h3><br><p>  Pour nous concentrer sur l'élément, nous allons parcourir la <code>NodeList</code> et nous concentrer sur l'élément actuel en utilisant la méthode <code>NodeList</code> <code>element.focus()</code> . </p><br><p>  Cet exemple montre comment passer du focus d'un élément à l'autre: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> current; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateLoop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> gamepad = navigator.getGamepads()[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> gamepadBumperL = gamepad.buttons[<span class="hljs-number"><span class="hljs-number">4</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> gamepadBumperR = gamepad.buttons[<span class="hljs-number"><span class="hljs-number">5</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gamepadBumperL.pressed) { prevItem(current) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gamepadBumperR.pressed) { nextItem(current) } setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> rAF(updateLoop), <span class="hljs-number"><span class="hljs-number">100</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prevItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ current = (index - <span class="hljs-number"><span class="hljs-number">1</span></span>) % focusableElements.length focusableElements[current].focus() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ current = (index + <span class="hljs-number"><span class="hljs-number">1</span></span>) % focusableElements.length focusableElements[current].focus() }</code> </pre> <br><p>  Faites attention à l'utilisation de la fonction <code>setTimeout</code> .  Il est utilisé pour limiter <code>requestAnimationFrame</code> à 100 millisecondes.  Sans cela, un simple clic sur une touche peut générer plusieurs événements de manette de jeu, car il n'y a pas d'onClick familier, et il est physiquement impossible d'appuyer et de relâcher une touche en une milliseconde. </p><br><h3 id="klikaem-po-elementam">  Cliquez sur les éléments </h3><br><p>  Vous pouvez <code>click()</code> sur des éléments en utilisant la méthode <code>click()</code> : </p><br><pre> <code class="javascript hljs">clickItem(index) { focusableElements[index].click(); }</code> </pre> <br><h3 id="dobavlyaem-fidbek-ispolzuya-vibraciyu">  Ajouter des commentaires à l'aide de vibrations </h3><br><p>  Les manettes de jeu modernes peuvent vibrer.  Ces vibrations sont utilisées pour le retour d'informations à l'utilisateur, généralement dans les jeux.  Mais vous pouvez également essayer de faire des commentaires à partir des éléments Web sur la page. </p><br><p>  Les manettes de jeu sont souvent équipées de deux moteurs électriques, puissants et faibles: </p><br><p><img src="https://habrastorage.org/webt/iv/pz/el/ivpzel0b1cyoxyujsfqgofbqeve.png"></p><br><p>  Nous pouvons contrôler ces moteurs à partir d'un navigateur à l'aide de <code>vibrationActuator</code> . <br>  Pour créer des vibrations, nous pouvons utiliser la méthode <code>playEffect()</code> : </p><br><pre> <code class="javascript hljs">gamepad.vibrationActuator.playEffect(<span class="hljs-string"><span class="hljs-string">'dual-rumble'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">startDelay</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">// Add a delay in milliseconds duration: 1000, // Total duration in milliseconds weakMagnitude: 0.5, // intensity (0-1) of the small ERM strongMagnitude: 1 // intesity (0-1) of the bigger ERM });</span></span></code> </pre> <br><p>  Lorsque vous utilisez des moteurs pour les vibrations, n'oubliez pas qu'un gros moteur a besoin de plus de temps pour accélérer.  Par conséquent, pour des réponses à court terme, il est préférable d'utiliser un petit moteur. </p><br><p><img src="https://habrastorage.org/webt/td/hq/5n/tdhq5nmlxnfoqkeemtj4cf3yrkc.png"></p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  Dans cet exemple, nous avons examiné les fonctions de base de l'API Gamepad et comment elle peut être utilisée pour naviguer sur Internet. </p><br><p>  <a href="https://github.com/voorhoede/demo-navigate-with-gamepad" rel="nofollow">Le</a> code <a href="https://github.com/voorhoede/demo-navigate-with-gamepad" rel="nofollow">GitHub</a> et la démo peuvent être vus <a href="https://demo-navigate-with-gamepad.netlify.com/" rel="nofollow">ici</a> . </p><br><h3 id="poleznye-ssylki">  Liens utiles </h3><br><p>  <a href="https://html5gamepad.com/" rel="nofollow">html5gamepad.com</a> - outil de vérification de la manette de jeu <br>  <a href="https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API" rel="nofollow">API Gamepad sur MDN</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr485562/">https://habr.com/ru/post/fr485562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485550/index.html">Y a-t-il de la vie au-delà du périphérique de Moscou? Comment nous recherchons et préparons les développeurs</a></li>
<li><a href="../fr485552/index.html">Une autre façon de suivre le temps et le numéro de build pour Java</a></li>
<li><a href="../fr485554/index.html">Objectifs et résultats clés (OKR) - Notre expérience de mise en œuvre progressive</a></li>
<li><a href="../fr485556/index.html">Il a fallu 12 ans pour créer une section de la carte du cerveau de la drosophile, les efforts de 250 personnes et 40 millions de dollars</a></li>
<li><a href="../fr485558/index.html">Pas de moustiques! Aperçu des moustiques "phyto-munitions"</a></li>
<li><a href="../fr485564/index.html">Ingénierie inverse du protocole Ngrok v2</a></li>
<li><a href="../fr485570/index.html">Agrégation des routes pour les listes ILV et comment elle menace des services respectables</a></li>
<li><a href="../fr485576/index.html">Caractéristiques de l'établissement d'une connexion entre les participants à un jeu en réseau peer-to-peer</a></li>
<li><a href="../fr485578/index.html">Mahjong avec enfants: pour quoi, quand et comment</a></li>
<li><a href="../fr485582/index.html">Paul Graham: «Un investisseur comme un troupeau d'animaux» (2013)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>