<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¶ ‚úçüèΩ üßõüèø Personagens modulares de sprites e suas anima√ß√µes üõéÔ∏è ‚úñÔ∏è üíá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta postagem do blog √© inteiramente dedicada ao meu sistema de anima√ß√£o de personagens, √© preenchida com dicas √∫teis e trechos de c√≥digo. 

 Nos √∫lti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Personagens modulares de sprites e suas anima√ß√µes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468991/"> Esta postagem do blog √© inteiramente dedicada ao meu sistema de anima√ß√£o de personagens, √© preenchida com dicas √∫teis e trechos de c√≥digo. <br><br>  Nos √∫ltimos dois meses, eu criei at√© 9 novas a√ß√µes de jogadores (coisas engra√ßadas como bloquear com um escudo, esquivar-se de um salto e armas), 17 novos itens vest√≠veis, 3 conjuntos de armaduras (chapa, seda e couro) e 6 tipos de penteados.  Tamb√©m terminei de criar toda a automa√ß√£o e ferramentas, para que tudo j√° esteja em uso no jogo.  No artigo, vou contar como consegui isso! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ef/52a/188/2ef52a1887cdbe639fd35d9df414c38d.gif"></div><br>  <i>Espero que esta informa√ß√£o seja √∫til e prove que n√£o √© necess√°rio ser um g√™nio para criar independentemente essas ferramentas / automa√ß√£o.</i> <br><br><h2>  Breve descri√ß√£o </h2><br>  Inicialmente, eu queria verificar se √© poss√≠vel combinar sprites sobrepostos uns aos outros com animadores sincronizados para criar um personagem modular com penteados, equipamentos e itens de vestu√°rio substitu√≠veis.  √â poss√≠vel combinar anima√ß√£o pixel desenhada √† m√£o com um personagem verdadeiramente personaliz√°vel. <br><br>  √â claro que essas fun√ß√µes s√£o ativamente usadas em jogos 3D e 2D com sprites pr√©-renderizados ou em jogos 2D com anima√ß√£o esquel√©tica, mas at√© onde eu sei, n√£o existem muitos jogos que combinem anima√ß√£o criada manualmente e personagens modulares (geralmente porque o processo acaba sendo mon√≥tono demais). <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/412/7a9/d23/4127a9d23d4d84e28671deee781495cb.gif"></div><br>  <i>Eu descobri esse GIF antigo do meu primeiro m√™s com o Unity.</i>  <i>De fato, este sprite modular foi um dos meus primeiros experimentos em desenvolvimento de jogos!</i> <br><br>  Criei um prot√≥tipo usando o sistema de anima√ß√£o Unity e adicionei uma camisa, um par de cal√ßas, um penteado e tr√™s itens para testar o conceito.  Isso exigiu 26 anima√ß√µes separadas. <br><br>  Naquele momento, criei toda a minha anima√ß√£o no Photoshop e n√£o me incomodei com a automa√ß√£o do processo, por isso foi muito chato.  Ent√£o pensei: ‚ÄúEnt√£o, a id√©ia b√°sica funcionou, depois adicionarei novas anima√ß√µes e equipamentos.‚Äù  Descobriu-se que "mais tarde" √© alguns anos depois. <br><br>  Em mar√ßo deste ano, desenhei uma grande quantidade de armaduras (veja meu post anterior) e notei como esse processo pode ser mais conveniente.  Continuei a adiar a implementa√ß√£o, porque, mesmo com a automa√ß√£o, eu estava nervoso que nada funcionaria. <br><br>  Eu esperava ter que abandonar a personaliza√ß√£o do personagem e criar o √∫nico personagem principal, como na maioria dos jogos com anima√ß√£o manual.  Mas eu tinha um plano de a√ß√£o e estava na hora de verificar se eu poderia derrotar esse monstro! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88b/030/c5a/88b030c5a82c6cd801f7ce4d8b08ff6d.gif"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddd/55f/12c/ddd55f12cb35e4fa22093cdddecd63d4.gif" width="500"></div><br>  <i>Spoiler: Tudo ficou √≥timo.</i>  <i>Abaixo vou revelar meus segredos ***</i> <br><br><h2>  Sistema modular de sprite </h2><br><h4>  I. Conhe√ßa seus limites </h4><br>  Anteriormente, conduzi muitos testes de arte e controle de tempo para descobrir quanto tempo esse trabalho pode levar e se um n√≠vel semelhante de qualidade ser√° poss√≠vel para mim. <br><br>  Anotei todas as minhas id√©ias para anima√ß√£o, reuni-as em uma planilha e organizei-as de acordo com v√°rios crit√©rios, como utilidade, beleza e uso repetido.  Para minha surpresa, o primeiro desta lista foi a anima√ß√£o do item (po√ß√µes, bombas, facas, machados, bola). <br><br>  Eu criei uma pontua√ß√£o num√©rica para cada anima√ß√£o e abandonei tudo com baixo desempenho.  Inicialmente, planejei criar 6 conjuntos de armaduras, mas rapidamente percebi que era demais e joguei fora tr√™s tipos. <br><br>  O aspecto do controle do tempo acabou sendo muito importante, e eu recomendo us√°-lo para responder a perguntas como: "Quantos inimigos posso criar no jogo?".  Depois de apenas alguns testes, consegui extrapolar uma estimativa bastante precisa.  Com mais trabalho em anima√ß√µes, continuei acompanhando o tempo e revisando minhas expectativas. <br><br>  <i>Vou compartilhar uma c√≥pia do meu di√°rio de trabalho nos √∫ltimos dois meses.</i>  <i>Observe que esse tempo √© um acr√©scimo ao meu trabalho habitual, onde passo 30 horas por semana:</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://docs.google.com/spreadsheets/d/1Nbr7lujZTB4pWMsuedVcgBYS6n5V-rHrk1PxeGxr6Ck/edit?usp=sharing</a> <br><br><h4>  II  Alterando a paleta para um futuro melhor </h4><br>  Usando as cores no design do sprite com sabedoria, voc√™ pode desenhar um sprite e criar muitas varia√ß√µes diferentes alterando a paleta.  Voc√™ pode alterar n√£o apenas as cores, mas tamb√©m criar v√°rios elementos ativados e desativados (por exemplo, substituindo cores por transpar√™ncia). <br><br>  Cada conjunto de armadura tem 3 varia√ß√µes e, misturando as partes superior e inferior, voc√™ pode obter muitas combina√ß√µes.  Eu planejo implementar um sistema no qual voc√™ pode coletar um conjunto de armadura para a apar√™ncia do personagem e outro para as caracter√≠sticas dele (como em Terraria). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/873/80c/0b9/87380c0b99d150828af05b1a0cf33ef6.gif"></div><br>  <i>No processo, fiquei agradavelmente surpreendido pelas curiosas combina√ß√µes descobertas.</i>  <i>Se voc√™ conectar a parte superior da placa com um fundo de seda, poder√° obter algo no estilo de um mago de guerra.</i> <br><br>  √â melhor alterar as paletas usando as cores que codificam o valor no sprite, para que voc√™ possa us√°-las posteriormente para encontrar a cor real da paleta.  Sei que estou simplificando um pouco, ent√£o aqui est√° um v√≠deo para voc√™ come√ßar: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/u4Iz5AJa31Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  N√£o explicarei tudo em detalhes, mas, em vez disso, falarei sobre maneiras de implementar essa t√©cnica no Unity, e seus pr√≥s e contras. <br><br><h4>  1. Pesquise a textura para cada paleta </h4><br>  Esta √© a melhor estrat√©gia para criar varia√ß√µes de inimigos, planos de fundo e tudo o que muitos sprites t√™m na mesma paleta / material.  Diferentes materiais n√£o podem ser agrupados em lotes, mesmo que eles usem o mesmo sprite / atlas.  Trabalhar com texturas √© bastante doloroso, mas voc√™ pode alterar as paletas em tempo real, substituindo materiais usando SpriteRenderer.sharedMaterial.SetTexture ou MaterialPropertyBlock se precisar de paletas diferentes para cada inst√¢ncia do material.  Aqui est√° um exemplo de uma fun√ß√£o de fragmento de sombreador: <br><br><pre><code class="cpp hljs">sampler2D _MainTex; sampler2D _PaletteTex; float4 _PaletteTex_TexelSize; <span class="hljs-function"><span class="hljs-function">half4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v2f input)</span></span></span><span class="hljs-function"> : SV_TARGET </span></span>{ half4 lookup = tex2D(_MainTex, input.uv); half4 color = tex2D(_PaletteTex, half2(lookup.r * (_PaletteTex_TexelSize.x / <span class="hljs-number"><span class="hljs-number">0.00390625f</span></span>), <span class="hljs-number"><span class="hljs-number">0.5</span></span>)); color.a *= lookup.a; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color * input.color; }</code> </pre> <br><h4>  2. Matriz de cores </h4><br>  Decidi tomar essa decis√£o porque precisava substituir as paletas toda vez que a apar√™ncia do personagem mudar (por exemplo, ao colocar itens) e criar algumas paletas dinamicamente (para exibir as cores de cabelo e pele escolhidas pelo jogador).  Pareceu-me que em tempo de execu√ß√£o e no editor para esses fins, seria muito mais f√°cil trabalhar com matrizes. <br><br>  C√≥digo: <br><br><pre> <code class="cpp hljs">sampler2D _MainTex; half4 _Colors[<span class="hljs-number"><span class="hljs-number">32</span></span>]; <span class="hljs-function"><span class="hljs-function">half4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v2f input)</span></span></span><span class="hljs-function"> : SV_TARGET </span></span>{ half4 lookup = tex2D(_MainTex, input.uv); half4 color = _Colors[round(lookup.r * <span class="hljs-number"><span class="hljs-number">255</span></span>)]; color.a *= lookup.a; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color * input.color; }</code> </pre> <br>  Apresentei minhas paletas como um tipo ScriptableObject e usei a ferramenta MonoBehaviour para edit√°-las.  Tendo trabalhado por muito tempo na edi√ß√£o de paletas no processo de cria√ß√£o de anima√ß√µes no Aseprite, percebi as ferramentas necess√°rias e escrevi esses scripts de acordo.  Se voc√™ deseja escrever sua pr√≥pria ferramenta para editar paletas, aqui est√£o algumas fun√ß√µes que eu definitivamente recomendo implementar: <br><br>  - Atualizando paletas em v√°rios materiais ao editar cores para exibir altera√ß√µes em tempo real. <br><br>  - Atribuindo nomes e alterando a ordem das cores na paleta (use o campo para armazenar o √≠ndice de cores, n√£o sua ordem na matriz). <br><br>  - Selecione e edite v√°rias cores de cada vez.  (Dica: voc√™ pode copiar e colar os campos Cor no Unity: basta clicar em uma cor, copiar, clicar em outra cor, colar - agora eles s√£o os mesmos!) <br><br>  - Aplique cor de sobreposi√ß√£o em toda a paleta <br><br>  - Paleta de registros em textura <br><br><h4>  3. Uma √∫nica textura de pesquisa para todas as paletas </h4><br>  Se voc√™ deseja alternar paletas dinamicamente, mas ao mesmo tempo precisar fazer o lote para reduzir o n√∫mero de chamadas de empate, poder√° usar esta t√©cnica.  Pode ser √∫til para plataformas m√≥veis, mas us√°-lo √© bastante inconveniente. <br><br>  Em primeiro lugar, voc√™ precisar√° embalar todas as paletas em uma textura grande.  Em seguida, use a cor especificada no componente SpriteRenderer (cor do v√©rtice AKA) para determinar a linha a ser lida da textura da paleta no shader.  Ou seja, a paleta desse sprite √© controlada pelo SpriteRenderer.color.  A cor do v√©rtice √© a √∫nica propriedade SpriteRenderer que pode ser alterada sem quebrar a condi√ß√£o (desde que todos os materiais sejam iguais). <br><br>  Na maioria dos casos, √© melhor usar o canal alfa para controlar o √≠ndice, porque voc√™ provavelmente n√£o precisar√° de muitos sprites com transpar√™ncia diferente. <br><br>  C√≥digo: <br><br><pre> <code class="cpp hljs">sampler2D _MainTex; sampler2D _PaletteTex; float4 _PaletteTex_TexelSize; <span class="hljs-function"><span class="hljs-function">half4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v2f input)</span></span></span><span class="hljs-function"> : SV_TARGET </span></span>{ half4 lookup = tex2D(_MainTex, input.uv); half2 paletteUV = half2( lookup.r * _(PaletteTex_TexelSize.x / <span class="hljs-number"><span class="hljs-number">0.00390625f</span></span>), input.color.a * _(PaletteTex_TexelSize.y / <span class="hljs-number"><span class="hljs-number">0.00390625f</span></span>) ) half4 color = tex2D(_PaletteTex, paletteUV); color.a *= lookup.a; color.rgb *= input.color.rgb; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47c/f90/895/47cf908951a0ba9f8f65a57711a5c85c.gif"></div><br>  <i>As maravilhas de substituir paletas e camadas de sprite.</i>  <i>Tantas combina√ß√µes.</i> <br><br><h4>  III  Automatize tudo e use as ferramentas certas. </h4><br>  Para implementar essa fun√ß√£o, a automa√ß√£o era absolutamente necess√°ria, porque, como resultado, recebi cerca de 300 anima√ß√µes e milhares de sprites. <br><br>  Meu primeiro passo foi criar um exportador para o Aseprite para gerenciar meu esquema de camadas de sprite insano usando uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">interface de linha de comando</a> conveniente.  Este √© apenas um script perl que ignora todas as camadas e r√≥tulos no meu arquivo Aseprite e exporta imagens em um diret√≥rio espec√≠fico e estrutura de nomes para que eu possa l√™-las mais tarde. <br><br>  Ent√£o eu escrevi um importador para o Unity.  O Aseprite exibe um arquivo JSON conveniente com dados do quadro, para que voc√™ possa criar recursos de anima√ß√£o programaticamente.  Manipular o JSON Aseprite e escrever esse tipo de dados acabou sendo bastante tedioso, ent√£o eu os trago aqui.  Voc√™ pode carreg√°-los facilmente no Unity usando JsonUtility.FromJson &lt;AespriteData&gt;, lembre-se de executar o Aseprite com a op√ß√£o --format 'json-array'. <br><br>  C√≥digo: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">System.Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> AespriteData { [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Size { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h; } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Position { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h; } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Frame { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> filename; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Position frame; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> rotated; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> trimmed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Position spriteSourceSize; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Size sourceSize; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> duration; } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Metadata { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> app; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> version; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> format; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Size size; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> scale; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Frame[] frames; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Metadata meta; }</code> </pre> <br>  No lado da Unity, tive s√©rios problemas em dois lugares: carregar / fatiar uma folha de sprite e criar um clipe de anima√ß√£o.  Um exemplo claro me ajudaria muito, ent√£o aqui est√° um trecho de c√≥digo do meu importador para que voc√™ n√£o sofra tanto: <br><br>  C√≥digo: <br><br><pre> <code class="cs hljs">TextureImporter textureImporter = AssetImporter.GetAtPath(spritePath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TextureImporter; textureImporter.spriteImportMode = SpriteImportMode.Multiple; SpriteMetaData[] spriteMetaData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpriteMetaData[aespriteData.frames.Length]; <span class="hljs-comment"><span class="hljs-comment">// Slice the spritesheet according to the aesprite data. for (int i = 0; i &lt; aespriteData.frames.Length; i++) { AespriteData.Position spritePosition = aespriteData.frames[i].frame; spriteMetaData[i].name = aespriteData.frames[i].filename; spriteMetaData[i].rect = new Rect(spritePosition.x, spritePosition.y, spritePosition.w, spritePosition.h); spriteMetaData[i].alignment = (int)SpriteAlignment.Custom; // Same as "Pivot" in Sprite Editor. spriteMetaData[i].pivot = new Vector2(0.5f, 0f); // Same as "Custom Pivot" in Sprite Editor. Ignored if alignment isn't "Custom". } textureImporter.spritesheet = spriteMetaData; AssetDatabase.ImportAsset(spritePath, ImportAssetOptions.ForceUpdate); Object[] assets = AssetDatabase.LoadAllAssetsAtPath(spritePath); // The first element in this array is actually a Texture2D (ie the sheet itself). for (int i = 1; i &lt; assets.Length; i++) { sprites[i - 1] = assets[i] as Sprite; } // Create the animation. AnimationClip clip = new AnimationClip(); clip.frameRate = 40f; float frameLength = 1f / clip.frameRate; ObjectReferenceKeyframe[] keyframes = new ObjectReferenceKeyframe[aespriteData.frames.Length + 1]; // One extra keyframe is required at the end to express the last frame's duration. float time = 0f; for (int i = 0; i &lt; keyframes.Length; i++) { bool lastFrame = i == keyframes.Length - 1; ObjectReferenceKeyframe keyframe = new ObjectReferenceKeyframe(); keyframe.value = sprites[lastFrame ? i - 1 : i]; keyframe.time = time - (lastFrame ? frameLength : 0f); keyframes[i] = keyframe; time += lastFrame ? 0f : aespriteData.frames[i].duration / 1000f; } EditorCurveBinding binding = new EditorCurveBinding(); binding.type = typeof(SpriteRenderer); binding.path = ""; binding.propertyName = "m_Sprite"; AnimationUtility.SetObjectReferenceCurve(clip, binding, keyframes); AssetDatabase.CreateAsset(clip, "Assets/Animation/" + name + ".anim"); AssetDatabase.SaveAssets();</span></span></code> ; <code class="cs hljs">TextureImporter textureImporter = AssetImporter.GetAtPath(spritePath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TextureImporter; textureImporter.spriteImportMode = SpriteImportMode.Multiple; SpriteMetaData[] spriteMetaData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpriteMetaData[aespriteData.frames.Length]; <span class="hljs-comment"><span class="hljs-comment">// Slice the spritesheet according to the aesprite data. for (int i = 0; i &lt; aespriteData.frames.Length; i++) { AespriteData.Position spritePosition = aespriteData.frames[i].frame; spriteMetaData[i].name = aespriteData.frames[i].filename; spriteMetaData[i].rect = new Rect(spritePosition.x, spritePosition.y, spritePosition.w, spritePosition.h); spriteMetaData[i].alignment = (int)SpriteAlignment.Custom; // Same as "Pivot" in Sprite Editor. spriteMetaData[i].pivot = new Vector2(0.5f, 0f); // Same as "Custom Pivot" in Sprite Editor. Ignored if alignment isn't "Custom". } textureImporter.spritesheet = spriteMetaData; AssetDatabase.ImportAsset(spritePath, ImportAssetOptions.ForceUpdate); Object[] assets = AssetDatabase.LoadAllAssetsAtPath(spritePath); // The first element in this array is actually a Texture2D (ie the sheet itself). for (int i = 1; i &lt; assets.Length; i++) { sprites[i - 1] = assets[i] as Sprite; } // Create the animation. AnimationClip clip = new AnimationClip(); clip.frameRate = 40f; float frameLength = 1f / clip.frameRate; ObjectReferenceKeyframe[] keyframes = new ObjectReferenceKeyframe[aespriteData.frames.Length + 1]; // One extra keyframe is required at the end to express the last frame's duration. float time = 0f; for (int i = 0; i &lt; keyframes.Length; i++) { bool lastFrame = i == keyframes.Length - 1; ObjectReferenceKeyframe keyframe = new ObjectReferenceKeyframe(); keyframe.value = sprites[lastFrame ? i - 1 : i]; keyframe.time = time - (lastFrame ? frameLength : 0f); keyframes[i] = keyframe; time += lastFrame ? 0f : aespriteData.frames[i].duration / 1000f; } EditorCurveBinding binding = new EditorCurveBinding(); binding.type = typeof(SpriteRenderer); binding.path = ""; binding.propertyName = "m_Sprite"; AnimationUtility.SetObjectReferenceCurve(clip, binding, keyframes); AssetDatabase.CreateAsset(clip, "Assets/Animation/" + name + ".anim"); AssetDatabase.SaveAssets();</span></span></code> </pre> <br>  Se voc√™ ainda n√£o o fez, acredite: √© muito f√°cil come√ßar a criar suas pr√≥prias ferramentas.  O truque mais f√°cil √© colocar um GameObject em cena com o MonoBehaviour anexado a ele, que possui o atributo [ExecuteInEditMode].  Adicione um bot√£o e voc√™ est√° pronto para a batalha!  Lembre-se de que suas ferramentas pessoais n√£o precisam ter boa apar√™ncia, elas podem ser puramente utilit√°rias. <br><br>  C√≥digo: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ExecuteInEditMode</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyCoolTool</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> button; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button) { button = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; DoThing(); } } }</code> </pre> <br>  Ao trabalhar com sprites, √© bastante f√°cil automatizar tarefas padr√£o (por exemplo, criar texturas de paleta ou substituir cores em lotes em v√°rios arquivos de sprite).  Aqui est√° um exemplo do qual voc√™ pode come√ßar a aprender como alterar seus sprites. <br><br>  C√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"Assets/Whatever/Sprite.png"</span></span>; Texture2D texture = AssetDatabase.LoadAssetAtPath&lt;Texture2D&gt;(path); TextureImporter textureImporter = AssetImporter.GetAtPath(path) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TextureImporter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!textureImporter.isReadable) { textureImporter.isReadable = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; AssetDatabase.ImportAsset(path, ImportAssetOptions.ForceUpdate); } Color[] pixels = texture.GetPixels(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, texture.width, texture.height); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; pixels.Length; i++) { <span class="hljs-comment"><span class="hljs-comment">// Do something with the pixels, eg replace one color with another. } texture.SetPixels(pixels); texture.Apply(); textureImporter.isReadable = false; // Make sure textures are marked as un-readable when you're done. There's a performance cost to using readable textures in your project that you should avoid unless you plan to change a sprite at runtime. byte[] bytes = ImageConversion.EncodeToPNG(texture); File.WriteAllBytes(Application.dataPath + path.Substring(6), bytes); AssetDatabase.ImportAsset(path, ImportAssetOptions.ForceUpdate);</span></span></code> ); <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"Assets/Whatever/Sprite.png"</span></span>; Texture2D texture = AssetDatabase.LoadAssetAtPath&lt;Texture2D&gt;(path); TextureImporter textureImporter = AssetImporter.GetAtPath(path) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TextureImporter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!textureImporter.isReadable) { textureImporter.isReadable = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; AssetDatabase.ImportAsset(path, ImportAssetOptions.ForceUpdate); } Color[] pixels = texture.GetPixels(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, texture.width, texture.height); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; pixels.Length; i++) { <span class="hljs-comment"><span class="hljs-comment">// Do something with the pixels, eg replace one color with another. } texture.SetPixels(pixels); texture.Apply(); textureImporter.isReadable = false; // Make sure textures are marked as un-readable when you're done. There's a performance cost to using readable textures in your project that you should avoid unless you plan to change a sprite at runtime. byte[] bytes = ImageConversion.EncodeToPNG(texture); File.WriteAllBytes(Application.dataPath + path.Substring(6), bytes); AssetDatabase.ImportAsset(path, ImportAssetOptions.ForceUpdate);</span></span></code> </pre> <br><h4>  Como superei as oportunidades da Mecanim: Reclama√ß√£o </h4><br>  Com o tempo, o prot√≥tipo do sistema de sprite modular que eu criei usando o Mecanim se tornou o maior problema ao atualizar o Unity, porque a API estava constantemente mudando e era pouco documentada.  No caso de uma m√°quina de estado simples, seria aconselh√°vel consultar o status de cada clipe ou alterar clipes em tempo de execu√ß√£o.  Mas n√£o!  Por raz√µes de desempenho, o Unity cria clipes em seu estado e nos obriga a usar um sistema de redefini√ß√£o desajeitado para alter√°-los. <br><br>  O pr√≥prio Mecanim n√£o √© um sistema t√£o ruim, mas parece-me que ele n√£o consegue perceber sua principal caracter√≠stica declarada - a simplicidade.  A id√©ia dos desenvolvedores era substituir o que parecia complicado e doloroso (script) por algo simples (m√°quina de estado visual).  No entanto: <br><br>  - Qualquer m√°quina de estado finito n√£o trivial se transforma rapidamente em uma rede selvagem de n√≥s e conex√µes, cuja l√≥gica est√° espalhada por diferentes camadas. <br><br>  - Casos de uso simples s√£o prejudicados por requisitos generalizados do sistema.  Para reproduzir uma ou duas anima√ß√µes, voc√™ precisa criar um novo controlador e atribuir estados / transi√ß√µes.  Obviamente, h√° um desperd√≠cio excessivo de recursos. <br><br>  - √â engra√ßado que, como resultado, voc√™ ainda precise escrever um c√≥digo, porque, para que a m√°quina de estado fa√ßa algo interessante, voc√™ precisa de um script que chame Animator.SetBool e m√©todos similares. <br><br>  - Para uso m√∫ltiplo da m√°quina de estado com outros clipes, √© necess√°rio duplic√°-lo e substitu√≠-los manualmente.  No futuro, voc√™ ter√° que fazer altera√ß√µes em v√°rios lugares. <br><br>  - Se voc√™ deseja alterar o que est√° em um estado em tempo de execu√ß√£o, voc√™ tem problemas.  A solu√ß√£o √© uma API ruim ou um gr√°fico maluco com um n√≥ para cada anima√ß√£o poss√≠vel. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8VgQ5PpTqjc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>A hist√≥ria de como os desenvolvedores do Firewatch entraram no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inferno dos scripts visuais</a> .</i>  <i>O engra√ßado √© que, quando o palestrante mostra os exemplos mais simples, ele ainda parece louco.</i>  <i>Os espectadores literalmente gemem √†s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">12:41</a> .</i>  <i>Adicione enormes custos de manuten√ß√£o e voc√™ entender√° por que eu n√£o gosto muito desse sistema.</i> <br><br>  Muitos desses problemas n√£o s√£o culpa dos desenvolvedores do Mecanim, mas simplesmente o resultado natural de id√©ias incompat√≠veis: voc√™ n√£o pode criar um sistema comum e ao mesmo tempo simples, e descrever a l√≥gica usando imagens √© mais dif√≠cil do que apenas palavras / s√≠mbolos (algu√©m se lembra dos fluxogramas UML?) .  Lembrei-me de um fragmento do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zack McClendon na Practice NYC 2018</a> e, se tiver tempo, recomendo que assista ao v√≠deo inteiro! <br><br>  No entanto, eu descobri.  O script visual √© sempre censurado por nerds agressivos do tipo "escreva seu pr√≥prio mecanismo" que n√£o compreendem as necessidades do artista.  Al√©m disso, n√£o se pode negar que a maior parte do c√≥digo parece um jarg√£o t√©cnico incompreens√≠vel. <br><br>  Se voc√™ j√° √© um pouco programador e faz jogos com sprites, pode precisar pensar duas vezes.  Quando comecei, tinha certeza de que nunca poderia escrever algo relacionado ao mecanismo melhor do que os desenvolvedores do Unity. <br><br>  E voc√™ sabe o que?  Aconteceu que o animador do sprite √© apenas um script que altera o sprite ap√≥s um n√∫mero especificado de segundos.  Seja como for, eu ainda tinha que escrever o meu.  Desde ent√£o, adicionei eventos de anima√ß√£o e outras fun√ß√µes ao meu projeto espec√≠fico, mas a vers√£o b√°sica que escrevi em meio dia abrange 90% das minhas necessidades.  Consiste em apenas 120 linhas e pode ser baixado gratuitamente a partir daqui: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://pastebin.com/m9Lfmd94</a> .  Obrigado por ler meu artigo.  At√© breve! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468991/">https://habr.com/ru/post/pt468991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468967/index.html">"Tecnologia" de obten√ß√£o de equa√ß√µes de din√¢mica de TAU. E por que a Identifica√ß√£o do sistema √© p√©ssima e a "f√≠sica honesta" governa</a></li>
<li><a href="../pt468969/index.html">Crie usu√°rios do Google a partir do PowerShell via API</a></li>
<li><a href="../pt468971/index.html">Escrevendo em Java para Nintendo DS</a></li>
<li><a href="../pt468973/index.html">Rede neural para classifica√ß√£o de imagens de sat√©lite usando o Tensorflow em Python</a></li>
<li><a href="../pt468989/index.html">Mercado UEBA morre - vida longa UEBA</a></li>
<li><a href="../pt468993/index.html">Oculus Quest se conecta a um PC e v√™ as m√£os</a></li>
<li><a href="../pt468995/index.html">Pol√≠tica de abertura: como os usu√°rios influenciam o projeto</a></li>
<li><a href="../pt468997/index.html">Mentoring - um must-have ou um bom b√¥nus?</a></li>
<li><a href="../pt468999/index.html">Quais pa√≠ses t√™m a Internet ‚Äúmais lenta‚Äù e quem corrige a situa√ß√£o em regi√µes de dif√≠cil acesso</a></li>
<li><a href="../pt469001/index.html">Como cozinhar mingau a partir de microsservi√ßos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>