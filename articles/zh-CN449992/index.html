<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€âœˆï¸ ğŸ’´ âš—ï¸ NodeMCUç®€å•é©±åŠ¨ç¨‹åºæ¨¡å‹ï¼ˆSDMï¼‰å±•ç¤ºï¼šåŠ¨æ€ç”¨æˆ·ç•Œé¢ ğŸ“¥ ğŸ’ƒğŸ» ğŸ––ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="NodeMCUæ˜¯ä¸€ä¸ªäº¤äº’å¼å›ºä»¶ ï¼Œå®ƒå…è®¸åœ¨ESP8266å¾®æ§åˆ¶å™¨ä¸Šè¿è¡ŒLuaè§£é‡Šå™¨ï¼ˆæ­£åœ¨å¼€å‘ESP32æ”¯æŒï¼‰ã€‚ é™¤æ‰€æœ‰å¸¸è§„ç¡¬ä»¶æ¥å£å¤–ï¼Œå®ƒè¿˜å…·æœ‰WiFiæ¨¡å—å’ŒSPIFFSæ–‡ä»¶ç³»ç»Ÿã€‚ 


 æœ¬æ–‡ä»‹ç»äº†NodeMCUçš„æ–°æ¨¡å—-sdmã€‚ SDMä»£è¡¨ç®€å•çš„é©±åŠ¨ç¨‹åºæ¨¡å‹ï¼Œå®ƒä¸ºç³»ç»Ÿæä¾›è®¾å¤‡é©±åŠ¨ç¨‹åºæ¨¡å‹æŠ½è±¡ã€‚ åœ¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NodeMCUç®€å•é©±åŠ¨ç¨‹åºæ¨¡å‹ï¼ˆSDMï¼‰å±•ç¤ºï¼šåŠ¨æ€ç”¨æˆ·ç•Œé¢</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449992/"><p><img src="https://habrastorage.org/webt/45/dq/e8/45dqe8yvyxvpg_kcien-88xslei.jpeg" alt="å›¾ç‰‡"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NodeMCU</a>æ˜¯ä¸€ä¸ª<em>äº¤äº’å¼å›ºä»¶</em> ï¼Œå®ƒå…è®¸åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ESP8266</a>å¾®æ§åˆ¶å™¨ä¸Šè¿è¡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lua</a>è§£é‡Šå™¨ï¼ˆæ­£åœ¨å¼€å‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ESP32</a>æ”¯æŒï¼‰ã€‚ é™¤æ‰€æœ‰å¸¸è§„ç¡¬ä»¶æ¥å£å¤–ï¼Œå®ƒè¿˜å…·æœ‰WiFiæ¨¡å—å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SPIFFS</a>æ–‡ä»¶ç³»ç»Ÿã€‚ </p><br><p> æœ¬æ–‡ä»‹ç»äº†NodeMCUçš„æ–°æ¨¡å—-sdmã€‚  SDMä»£è¡¨ç®€å•çš„é©±åŠ¨ç¨‹åºæ¨¡å‹ï¼Œå®ƒä¸ºç³»ç»Ÿæä¾›è®¾å¤‡é©±åŠ¨ç¨‹åºæ¨¡å‹æŠ½è±¡ã€‚ åœ¨æœ¬æ–‡çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ¨¡å‹æœ¬èº«ï¼Œåœ¨ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œå°†å±•ç¤ºä½¿ç”¨sdmä»¥åŠä¸€äº›æ³¨é‡Šçš„åŠ¨æ€åˆ›å»ºçš„Webç”¨æˆ·ç•Œé¢ã€‚ </p><a name="habracut"></a><br><h1 id="driver-model-basics"> é©±åŠ¨ç¨‹åºæ¨¡å‹åŸºç¡€ </h1><br><p> è¯¥æ¨¡å‹çš„ä¸¤ä¸ªä¸»è¦ç»„ä»¶æ˜¯<em>è®¾å¤‡</em>å’Œ<em>é©±åŠ¨ç¨‹åº</em> ã€‚ è®¾å¤‡æ˜¯æŸäº›ç¡¬ä»¶æˆ–è™šæ‹Ÿè®¾å¤‡çš„æŠ½è±¡è¡¨ç¤ºã€‚ å°†è®¾å¤‡ç½®äºæ ‘çŠ¶ç»“æ„ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå…¶ä¸­å¾®æ§åˆ¶å™¨ä½äºé¡¶éƒ¨ï¼Œæ€»çº¿ä½äºä¸­é—´ï¼Œä¼ æ„Ÿå™¨ä½œä¸ºå¶å­ã€‚ </p><br><pre><code class="plaintext hljs">DEVICES + DRIVERS | +-----+ | +-----+ |1WIRE&lt;----------------------+1WIRE| ++-+-++ | +-----+ | | | | +---------+ | +--------+ | +------+ | | | +------+DS1820| +---v----+ +---v----+ +---v----+ | | +------+ |DS1820|0| |DS1820|1| |DS1822|0| | | +---^----+ +---^----+ +---^----+ | | +------+ | | +--------------+DS1822| | | | | +------+ +-----------+------------------+ +</code> </pre> <br><p> è®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯ä¸ç»™å®šè®¾å¤‡å…³è”çš„é€»è¾‘ã€‚ é©±åŠ¨ç¨‹åºæä¾›çš„åŠŸèƒ½ç§°ä¸º<em>æ–¹æ³•</em> ï¼Œä¸é©±åŠ¨ç¨‹åºå…³è”çš„æ•°æ®å®¹å™¨ç§°ä¸º<em>å±æ€§</em> ã€‚ æ–¹æ³•å’Œå±æ€§éƒ½ä½äºé©±åŠ¨ç¨‹åºå†…éƒ¨ã€‚ </p><br><p> å±æ€§å…·æœ‰ä¸¤ä¸ªä¸ä¹‹å…³è”çš„åŠŸèƒ½ï¼š <em>getter</em>å’Œ<em>setter</em>æŒ‚é’©ã€‚ å› æ­¤ï¼Œå±æ€§å…·æœ‰è¶…é›†æ–¹æ³•åŠŸèƒ½ï¼Œä½†å®ƒä»¬ä¹Ÿå ç”¨æ›´å¤šå†…å­˜ï¼ˆå¾®æ§åˆ¶å™¨å†…å­˜ç¨€å°‘ï¼Œè¿˜è®°å¾—å—ï¼Ÿï¼‰ã€‚ </p><br><pre> <code class="lua hljs">sdm.attr_add(drv, <span class="hljs-comment"><span class="hljs-comment">-- device handle "ref", -- attribute name "Reference voltage", -- attribute description 5, function(dev) -- this is a getter function return sdm.attr_data(sdm.attr_handle(dev, "ref")) end, function(dev, value) -- this is a setter function sdm.attr_set(sdm.attr_handle(dev, "ref"), value) end )</span></span></code> </pre> <br><h2 id="device-binding"> è®¾å¤‡ç»‘å®š </h2><br><p> é©±åŠ¨ç¨‹åºæ¨¡å‹çš„æ£˜æ‰‹éƒ¨åˆ†æ˜¯è®¾å¤‡é©±åŠ¨ç¨‹åºç»‘å®šã€‚ è¯¥è¿‡ç¨‹æœ¬èº«éå¸¸ç®€å•ï¼šæˆ‘ä»¬å°†è®¾å¤‡ä¸æ¯ä¸ªå¯ç”¨çš„é©±åŠ¨ç¨‹åºåŒ¹é…ï¼Œç›´åˆ°é€‚åˆä¸ºæ­¢ã€‚ ä»…ç¼ºå°‘ä¸¤ä¸ªéƒ¨åˆ†-åŒ¹é…é€»è¾‘å’Œä¸€äº›è¦åŒ¹é…çš„æ•°æ®ã€‚ </p><br><p> åœ¨sdmä¸­ï¼ŒåŒ¹é…é€»è¾‘ä»¥<code>_poll()</code>çš„åç§°å­˜åœ¨äºé©±åŠ¨ç¨‹åºä¸­ã€‚ è¿™æ˜¯ä¸€ä¸ªå¸¸è§„æ–¹æ³•ï¼Œä½¿ç”¨è®¾å¤‡å¥æŸ„ä½œä¸ºå‚æ•°è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¦‚æœè®¾å¤‡æ— æ³•è¿æ¥åˆ°é©±åŠ¨ç¨‹åºï¼Œåˆ™åˆ†åˆ«è¿”å›<code>true</code>æˆ–<code>false</code> ã€‚ </p><br><pre> <code class="lua hljs">sdm.method_add(drv, <span class="hljs-string"><span class="hljs-string">"_poll"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dev, drv, par)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> attr = sdm.attr_data(sdm.local_attr_handle(dev, <span class="hljs-string"><span class="hljs-string">"id"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">-- get device attribute "id" if attr == nil then return false end -- if it does not have one, driver does not match -- parent name must be "ESP8266_1W" and first byte of "id" must be "0x28" return (sdm.device_name(par) == "ESP8266_1W") and (attr:byte(1) == 0x28) end )</span></span></code> </pre> <br><p> å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œé©±åŠ¨ç¨‹åºä½¿ç”¨å±æ€§æ¥åŒ¹é…è®¾å¤‡ã€‚ ä½†æ˜¯å¦‚ä¸Šæ‰€è¿°ï¼Œå±æ€§ä»…ä¸é©±åŠ¨ç¨‹åºå…³è”ã€‚ é€šå¸¸ï¼Œè¿™æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æœ‰äº›å±æ€§æ— æ³•é€šè¿‡è½¯ä»¶æ£€ç´¢ã€‚ è¿™äº›æ˜¯èŠ¯ç‰‡IDï¼Œä½¿ç”¨çš„å¼•è„šç­‰ã€‚ å¯¹äºé‚£äº›ç‰¹æ®Šç±»å‹çš„å±æ€§å·²æ·»åŠ åˆ°sdm- <em>localå±æ€§</em> ã€‚ æ­¤å±æ€§ä¸è®¾å¤‡çš„ä¸€ä¸ªå®ä¾‹ç›¸å…³è”ï¼Œé€šå¸¸æ˜¯ä¸å¯å˜çš„ã€‚ </p><br><p> å…³äºé©±åŠ¨ç¨‹åºç»‘å®šï¼Œåªå‰©ä¸‹ä¸€å¥è¯è¦è¯´ã€‚ é€šå¸¸ï¼Œè®¾å¤‡åœ¨ä½¿ç”¨åéœ€è¦åœ¨å¯åŠ¨å’Œæ¸…é™¤æ—¶è¿›è¡ŒæŸç§åˆå§‹åŒ–ã€‚ ä¸ºæ­¤ï¼Œsdmä½¿ç”¨<code>_init()</code>å’Œ<code>_free()</code>æ–¹æ³•ã€‚ <br> å¦‚æœé©±åŠ¨ç¨‹åºå…·æœ‰<code>_init()</code>æ–¹æ³•ï¼Œåˆ™å°†åœ¨è®¾å¤‡ç»‘å®šåè‡ªåŠ¨è°ƒç”¨å®ƒã€‚ ä¸<code>_free()</code>ç›¸åŒã€‚ </p><br><pre> <code class="lua hljs">sdm.method_add(drv, <span class="hljs-string"><span class="hljs-string">"_init"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dev, drv, par)</span></span></span></span> sdm.device_rename(dev, sdm.request_name(<span class="hljs-string"><span class="hljs-string">"DS18B20"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">-- rename device sdm.attr_copy(dev, "temp") -- copy attribute sdm.attr_copy(dev, "precision") -- copy attribute local met = sdm.method_dev_handle(par, "setup") -- get 1Wire bus pin init function .. local func = sdm.method_func(met) -- .. and .. func(par, dev) -- .. call it end ) sdm.method_add(drv, "_free", nil, function(dev, drv, par) local met = sdm.method_dev_handle(par, "free") -- get 1Wire bus pin free function .. local func = sdm.method_func(met) -- .. and .. func(par, dev) -- .. call it end )</span></span></code> </pre> <br><p> ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šé—®ï¼šä¸Šä¾‹ä¸­çš„â€œå¤åˆ¶å±æ€§â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ ä»–æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºè¿™ä¸æˆ‘ä»¬å°šæœªè®¨è®ºçš„ç¬¬ä¸‰ç§å±æ€§<em>-privateå±æ€§æœ‰å…³</em> ã€‚ åœ¨æ‰€æœ‰è®¾å¤‡å®ä¾‹ä¹‹é—´å…±äº«æ‰€æœ‰å±æ€§æ•°æ®æ²¡æœ‰å¤ªå¤§æ„ä¹‰ã€‚ ä¸ºæ­¤ï¼Œsdmæä¾›äº†ä»é©±åŠ¨ç¨‹åºå¤åˆ¶å±æ€§å¹¶å°†å…¶ä¸è®¾å¤‡å…³è”çš„æœºåˆ¶ã€‚ è¿™ä½¿é©±åŠ¨ç¨‹åºå±æ€§æˆä¸ºåŸå‹æˆ–æ¨¡æ¿ã€‚ </p><br><p> å¿«é€Ÿæ€»ç»“ï¼š </p><br><ul><li>  <em>æœ¬åœ°å±æ€§</em>ç”¨äºæ— æ³•é€šè¿‡è½¯ä»¶æ£€ç´¢çš„æ•°æ®ã€‚ åƒè®¾å¤‡IDï¼Œè¿æ¥çš„å¼•è„šç­‰ã€‚ </li><li>  <em>é©±åŠ¨ç¨‹åºå±æ€§</em>ç”¨äºåœ¨è¿æ¥åˆ°è¯¥é©±åŠ¨ç¨‹åºçš„æ‰€æœ‰è®¾å¤‡å®ä¾‹ä¹‹é—´å…±äº«çš„æ•°æ®ã€‚ </li><li>  <em>ç§æœ‰å±æ€§</em>æ˜¯ä»é©±åŠ¨ç¨‹åº<em>å±æ€§</em>ä¸­å¤åˆ¶çš„ï¼Œå¹¶ä¸”ä»…ä¿ç•™ä¸ä¸€ä¸ªè®¾å¤‡å®ä¾‹å…³è”çš„æ•°æ®ã€‚ è¿™ç§ç±»å‹æ˜¯æœ€å¸¸è§çš„ã€‚ </li></ul><br><div class="scrollable-table"><table><thead><tr><th> ç‰©ä¸šèµ„æ–™ </th><th> æœ¬åœ°å±æ€§ </th><th> ç§äººå±æ€§ </th><th> é©±åŠ¨ç¨‹åºï¼ˆå…¬å…±ï¼‰å±æ€§ </th></tr></thead><tbody><tr><td> å­˜æ”¾äº </td><td> è£…ç½® </td><td> è£…ç½® </td><td> å¸æœº </td></tr><tr><td> ä½¿ç”¨é©±åŠ¨ç¨‹åºå¥æŸ„å¯è®¿é—® </td><td>  -- </td><td>  -- </td><td>  + </td></tr><tr><td> ä½¿ç”¨è®¾å¤‡æ‰‹æŸ„å¯è®¿é—® </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td> è®¾å¤‡ä¹‹é—´å…±äº« </td><td>  -- </td><td>  -- </td><td>  + </td></tr><tr><td> åšæŒé©¾é©¶å‘˜åˆ†ç¦» </td><td>  + </td><td>  -- </td><td>  + </td></tr></tbody></table></div><br><h1 id="web-user-interface-implementation">  Webç”¨æˆ·ç•Œé¢å®ç° </h1><br><h2 id="server-code"> æœåŠ¡å™¨ä»£ç  </h2><br><p> æœ‰ä¸€ä¸ªå¯çˆ±çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://github.com/marcoskirsch/nodemcu-">nodemcu-httpserver</a>é¡¹ç›®ï¼Œè¯¥é¡¹ç›®ä¸ºNudeMCUå®ç°æœåŠ¡å™¨ä»£ç ã€‚ å¯æ‚²çš„æ˜¯å®ƒä¼¼ä¹å·²ç»æ­»äº†ã€‚ å®ƒè¢«ç”¨ä½œæœåŠ¡å™¨çš„åŸºç¡€ã€‚ é¦–å…ˆï¼Œå°†æœåŠ¡å™¨åŠŸèƒ½<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://gitlab.com/matsievskiysv/nodemcu-">ç§»è‡³LFS</a> ï¼Œç„¶å<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://gitlab.com/matsievskiysv/nodemcu-pseudo">ç¨ä½œä¿®æ”¹</a>ä»¥ä¸ºæ¯ä¸ªè°ƒç”¨æä¾›ä¸€ä¸ªé™æ€é¡µé¢ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Vue.js</a>æ˜¯åŸºäºæ¨¡æ¿çš„ç½‘é¡µçš„ç†æƒ³é€‰æ‹©ã€‚ å› æ­¤å®ƒè¢«ç”¨äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‰ç«¯</a> ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒNodeMCUå¯èƒ½æœªè¿æ¥åˆ°Internetã€‚ å› æ­¤ï¼Œ <code>vue.js</code>åº“éœ€è¦åœ¨æœ¬åœ°å­˜åœ¨å¹¶ç”±NodeMCUæœåŠ¡å™¨æä¾›æœåŠ¡ã€‚ </p><br><p> ç”±äºæ‰€æœ‰è®¾å¤‡å‡ä»¥æ ‘ç»“æ„ç»„ç»‡ï¼Œå› æ­¤å¯ä»¥åƒè®¿é—®ç›®å½•ä¸€æ ·è®¿é—®å®ƒä»¬ï¼š <code>/ESP8266/ESP8266_1W/DS18S20-0</code> ã€‚ åœ¨è¿™é‡Œ<code>/ESP8266</code>æ˜¯NodeMCUé¡µé¢ï¼Œ <code>/ESP8266/ESP8266_1W</code>æ˜¯<em>1Wire</em>æ€»çº¿é¡µé¢ï¼Œæœ€å<code>/ESP8266/ESP8266_1W/DS18S20-0</code>æ˜¯æ¸©åº¦ä¼ æ„Ÿå™¨ã€‚ </p><br><p> å¦‚å‰æ‰€è¿°ï¼Œæ‰€æœ‰è®¾å¤‡é¡µé¢éƒ½æ˜¯ä»ä¸€ä¸ªæ¨¡æ¿é¡µé¢æ„å»ºçš„ï¼Œæ¯ä¸ªå‘¼å«éƒ½å¯ä»¥ä½¿ç”¨è¯¥æ¨¡æ¿é¡µé¢ã€‚ ç„¶åï¼Œæ­¤é¡µé¢å†…çš„<em>JS</em>ä»£ç ä¼šå‘<code>/api</code> URLå‰é¢çš„ç›¸åŒURLå‘å‡ºè¯·æ±‚ã€‚ å¯¹äºä¸Šé¢çš„ç¤ºä¾‹ï¼Œè°ƒç”¨URLä¸º<code>/api/ESP8266/ESP8266_1W/DS18S20-0</code> ã€‚ å¯¹äºæ­¤ç±»è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†ä½¿ç”¨<em>JSON</em>ç¼–ç çš„è®¾å¤‡ç‰¹å®šæ•°æ®è¿›è¡Œå“åº”ï¼Œè¯¥æ•°æ®å°†å¡«å……é¡µé¢ã€‚ å½“ç„¶ï¼Œå¦‚æœä»…éœ€è¦åŸå§‹æ•°æ®ï¼Œåˆ™å¯ä»¥è·³è¿‡<em>HTML</em>é¡µé¢è¯·æ±‚ã€‚ </p><br><h2 id="device-tree"> è®¾å¤‡æ ‘ </h2><br><p> åˆå§‹è®¾å¤‡é…ç½®ä½¿ç”¨<em>ç®€å•çš„è®¾å¤‡æ ‘</em>ç»“æ„å®Œæˆã€‚ å®ƒå°±åƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¾å¤‡æ ‘</a> ï¼Œä½†æ˜¯æ›´ç®€å•ã€‚ å®ƒæè¿°äº†åŒ…æ‹¬è®¾å¤‡æœ¬åœ°å±æ€§åœ¨å†…çš„ç¡¬ä»¶é…ç½®ã€‚ </p><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> root={ <span class="hljs-comment"><span class="hljs-comment">-- local_attributes={}, children={ { name="ESP8266_1W", -- local_attributes={}, children = { { name="DS18S20-0", -- static declaration alternative to 1Wire poll method local_attributes={ { name="id", desc=nil, -- empty description to save space data=string.char(16) .. string.char(221) .. string.char(109) .. string.char(104) .. string.char(3) .. string.char(8) .. string.char(0) .. string.char(150) -- ugly way to create byte array }, { datapin=2 } } }, } }, { name="ESP8266_SPI", -- local_attributes={}, children = { { name="MCP3208-0" }, } }, } }</span></span></code> </pre> <br><h2 id="hardware-setup"> ç¡¬ä»¶è®¾å®š </h2><br><p> ä»è¿™é‡Œå¼€å§‹å±•ç¤ºã€‚ ä¸ºæ­¤ï¼Œå°†ä¸€å †ä¼ æ„Ÿå™¨è¿æ¥åˆ°NodeMCUï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DS18B20</a>æ¸©åº¦ä¼ æ„Ÿå™¨ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DS18S20</a>æ¸©åº¦ä¼ æ„Ÿå™¨ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MCP3208</a> ADC </li></ul><br><p>  <em>1Wire</em>ä¼ æ„Ÿå™¨è¿æ¥åˆ°åŒä¸€å¼•è„šã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/fb/sw/zi/fbswzi7xav_pj4waz6g19hktrso.jpeg"></a> </p><br><h2 id="web-pages-and-drivers"> ç½‘é¡µå’Œé©±åŠ¨ç¨‹åº </h2><br><h3 id="root-device"> æ ¹è®¾å¤‡ </h3><br><p> æ ¹è®¾å¤‡ï¼ˆaka ESP8266ï¼‰çš„ä¸»è¦ç”¨é€”æ˜¯ä¸ºå…¶å­è®¾å¤‡æä¾›è¿æ¥çš„åœ°æ–¹ã€‚ ä½†æ˜¯ï¼Œä¸é™äºä¸ä¹‹å…³è”çš„æ–¹æ³•æˆ–å±æ€§ã€‚ </p><br><p> æ­¤ä»£ç æ®µæ¥è‡ª<a href="">æ­¤å¤„</a> ï¼š </p><br><pre> <code class="lua hljs">sdm.method_add(drv, <span class="hljs-string"><span class="hljs-string">"_init"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dev, drv, par)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> attr = sdm.attr_handle(dev, <span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- get device "id" attribute sdm.attr_set(attr, node.chipid()) -- set "id" value attr = sdm.attr_handle(dev, "float") -- get device "float" attribute sdm.attr_set(attr, 3 / 2 ~= 1) -- set to true if firmware supports floating point instructions end ) sdm.attr_add(drv, "float", "Floating point build", false, function(drv) -- attribute value is set inside "_init" function local attr = sdm.attr_drv_handle(drv, "float") return sdm.attr_data(attr) -- just return stored value end, nil )</span></span></code> </pre> <br><p> è¿™æ®µä»£ç æ·»åŠ äº†<code>float</code>å±æ€§ï¼Œè¯¥å±æ€§ç”¨äºä¿å­˜å›ºä»¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ„å»ºç±»å‹</a> ã€‚ å®ƒçš„å€¼åœ¨<code>_init()</code>æŒ‚é’©ä¸­åˆå§‹åŒ–ï¼Œè¯¥æŒ‚é’©æ˜¯ä¸€ä¸ªç‰¹æ®Šå‡½æ•°ï¼Œå½“é©±åŠ¨ç¨‹åºè¿æ¥åˆ°è®¾å¤‡æ—¶ï¼Œå®ƒå°†è¿è¡Œä¸€æ¬¡ã€‚ </p><br><p> è¿™æ˜¯æ ¹è®¾å¤‡çš„ç”Ÿæˆé¡µé¢ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/mg/5q/lo/mg5qlog3-nwjkl6itrfw6ynyvuo.png"></a> </p><br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ ¹è®¾å¤‡æœ‰ä¸€ä¸ªæ–¹æ³•<code>heap</code> ï¼Œä¸¤ä¸ªé©±åŠ¨ç¨‹åºå±æ€§<code>float</code>å’Œ<code>id</code> ã€‚ æœ€åï¼Œå®ƒè¿æ¥äº†ä¸¤ä¸ªè®¾å¤‡<em>-SPI</em>å’Œ<em>1Wire</em>æ€»çº¿ã€‚ </p><br><h3 id="spi">  SPI </h3><br><p>  <a href=""><em>SPI</em>é©±åŠ¨ç¨‹åº</a>ä¸æ˜¯å¾ˆæœ‰è¶£ã€‚ å®ƒä»…æ˜ å°„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NodeMCU SPI</a>åŠŸèƒ½ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/qx/mx/g8/qxmxg8mnkmnl5aglfq7q5zhpnv0.png"></a> </p><br><h3 id="mcp3208">  mcp3208 </h3><br><p>  <em>MCP3208</em>æ˜¯<em>ADC</em>èŠ¯ç‰‡ã€‚ å®ƒæµ‹é‡ä»é›¶åˆ°<em>å‚è€ƒ</em>ç”µå‹ï¼Œå¹¶è¿”å›12ä½ä»£ç ã€‚ æ­¤<a href="">é©±åŠ¨ç¨‹åº</a>å®ç°çš„æœ‰è¶£ä¹‹å¤„åœ¨äºï¼Œåªæœ‰åœ¨å›ºä»¶æ”¯æŒæµ®ç‚¹è¿ç®—çš„æƒ…å†µä¸‹ï¼Œå±æ€§<code>ref</code>æ‰ä¼šå‡ºç°ã€‚ å¦‚æœä¸æ”¯æŒï¼Œåˆ™ä½¿ç”¨ç»å¯¹å€¼å’Œ<code>differential</code>æ–¹æ³•è¿”å›ç”µå‹ä»£ç ï¼Œè€Œä¸æ˜¯ç»å¯¹ç”µå‹ã€‚ </p><br><pre> <code class="lua hljs">sdm.method_add(drv, <span class="hljs-string"><span class="hljs-string">"single"</span></span>, <span class="hljs-string"><span class="hljs-string">"Single ended measure 0|1|2|3|4|5|6|7"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dev, channel)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">-- ... if ref ~= nil then -- this part is executed only if floating point arithmetic is enabled rv = ref * rv / 4096 end return rv end ) if 3/2~=1 then -- other alternative is to access ESP8266 "float" method sdm.attr_add(drv, "ref", "Reference voltage", 5, function(dev) return sdm.attr_data(sdm.attr_handle(dev, "ref")) end, function(dev, value) sdm.attr_set(sdm.attr_handle(dev, "ref"), value) end ) end</span></span></code> </pre> <br><p> <a href=""><img src="https://habrastorage.org/webt/m_/_l/cc/m__lccntxwsrorrujvky3opbm0s.png"></a> </p><br><p> å¦è¯·æ³¨æ„ï¼Œè¯¥è®¾å¤‡çš„å±æ€§<code>ref</code>æ ‡è®°ä¸º<em>private</em> ã€‚ å®ƒæ˜¯æŒ‰è®¾å¤‡è®¾ç½®çš„ã€‚ </p><br><h3 id="1wire">  1çº¿ </h3><br><p>  <a href=""><em>1</em>é©±åŠ¨ç¨‹åºé©±åŠ¨ç¨‹åº</a>å®ç°<code>poll</code>æ–¹æ³•- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŠ¨æ€æœç´¢è®¾å¤‡</a> ã€‚ </p><br><p> å‘ç°è®¾å¤‡åï¼Œå…¶ç±»å‹ç«‹å³æœªçŸ¥ã€‚ å› æ­¤ï¼Œå…¶<em>1Wire</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å”¯ä¸€åœ°å€</a>ç”¨ä½œæ–°çš„è®¾å¤‡åç§°ï¼ˆå­—èŠ‚è¡¨ç¤ºä¸ºä»¥<code>_</code>å­—ç¬¦åˆ†éš”çš„æ•°å­—ï¼‰ã€‚ </p><br><pre> <code class="lua hljs">sdm.method_add(drv, <span class="hljs-string"><span class="hljs-string">"poll"</span></span>, <span class="hljs-string"><span class="hljs-string">"Poll for devices"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bus, pin)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> children = sdm.device_children(bus) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> {} <span class="hljs-comment"><span class="hljs-comment">-- already attached local ids = {} -- get IDs of attached devices for name, handle in pairs(children) do local dpin = sdm.attr_data(sdm.local_attr_handle(handle, "pin")) if dpin == pin then ids[sdm.attr_data(sdm.local_attr_handle(handle, "id"))] = true end end ow.reset_search(pin) -- reset previous search while true do -- for all found devices local id = ow.search(pin) if id == nil then break end if ids[id] == nil then -- if not already present local name = "" for i=1,#id do name = name .. tostring(id:byte(i)) .. "_" end name = name:sub(1,-2) -- add to system with their ID used as name local device = sdm.device_add(name, bus) -- add "pin" attribute local rv = sdm.local_attr_add(device, "datapin", nil, pin, nil, nil) -- add "id" attribute local rv = sdm.local_attr_add(device, "id", nil, id, nil, nil) -- poll for driver local rv = sdm.device_poll(device) end end end )</span></span></code> </pre> <br><p> è¿™æ˜¯<em>1Wire</em>é©±åŠ¨ç¨‹åºçš„åˆå§‹é¡µé¢ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/j2/uq/ax/j2uqaxkhqilv0k1fmwaq2hn0iwq.png"></a> </p><br><p> åœ¨å‘å‡ºå¸¦æœ‰å‚æ•°<code>2</code> <code>poll</code>å¹¶åˆ·æ–°é¡µé¢åï¼Œå‡ºç°å­éƒ¨åˆ†ã€‚ è¯·æ³¨æ„ï¼Œå­åç§°æ˜¯äººç±»å¯è¯»çš„ã€‚ è¿™æ˜¯å› ä¸º<code>device_rename()</code>å‡½æ•°åœ¨å…¶<code>_init</code>æœŸé—´è¢«è°ƒç”¨ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/_z/2x/na/_z2xnadqlt_qgyokfxomwivtwkq.png"></a> </p><br><h3 id="ds18s20">  DS18S20 </h3><br><p> åˆå§‹åŒ–åï¼Œ <a href="">DS18S20é©±åŠ¨ç¨‹åºå°†</a>æ£€æŸ¥è®¾å¤‡<em>ID</em>æ˜¯å¦ä»¥è®¾å¤‡å®¶æ—ä»£ç <code>0x10</code>å¼€å¤´ã€‚ å°†è®¾å¤‡è¿æ¥åˆ°é©±åŠ¨ç¨‹åºåï¼Œå®ƒå°†é‡å‘½åä¸º<code>DS18S20-X</code> ï¼Œå…¶ä¸­<code>DS18S20</code>æ˜¯åŸºæœ¬åç§°ï¼Œ <code>X</code>æ˜¯å®ä¾‹ç¼–å·ã€‚ </p><br><pre> <code class="lua hljs">sdm.method_add(drv, <span class="hljs-string"><span class="hljs-string">"_poll"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dev, drv, par)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> attr = sdm.attr_data(sdm.local_attr_handle(dev, <span class="hljs-string"><span class="hljs-string">"id"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attr == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (sdm.device_name(par) == <span class="hljs-string"><span class="hljs-string">"ESP8266_1W"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (attr:<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) == <span class="hljs-number"><span class="hljs-number">0x10</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- check family ID end ) sdm.method_add(drv, "_init", nil, function(dev, drv, par) sdm.device_rename(dev, sdm.request_name("DS18S20")) -- rename device sdm.attr_copy(dev, "temp") -- copy attribute to device local met = sdm.method_dev_handle(par, "setup") local func = sdm.method_func(met) -- use parent "setup" method on the device func(par, dev) end )</span></span></code> </pre> <br><p> <a href=""><img src="https://habrastorage.org/webt/bm/pk/41/bmpk419dphexm-xlvnxq7hw2jxc.png"></a> </p><br><p> æœ¬åœ°å±æ€§<code>id</code>å’Œ<code>datapin</code>æ²¡æœ‰<code>getter</code>å’Œ<code>setter</code>é’©å­ï¼Œå› æ­¤ä»…å¯è§å…¶åç§°ã€‚ </p><br><h3 id="ds18b20">  DS18B20 </h3><br><p>  <a href="">DS18B20é©±åŠ¨ç¨‹åº</a>ä¸<a href="">DS18S20é©±åŠ¨ç¨‹åº</a>å‡ ä¹ç›¸åŒã€‚ å”¯ä¸€çš„åŒºåˆ«æ˜¯<code>precision</code>æ–¹æ³•ã€‚ ä¸¤ä¸ª<em>DS18ï¼Ÿ20</em>é©±åŠ¨ç¨‹åºå‡å‡å®šä¸ºæ•´æ•°ç”Ÿæˆï¼Œå¹¶ä¸”ä¸ä½¿ç”¨æµ®ç‚¹é™¤æ³•ã€‚ </p><br><pre> <code class="lua hljs">sdm.attr_add(drv, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>, <span class="hljs-string"><span class="hljs-string">"Precision (9|10|11|12)"</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dev, precision)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> attr = sdm.attr_dev_handle(dev, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdm.attr_data(attr) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dev, precision)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> par = sdm.device_parent(dev) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> attr = sdm.attr_dev_handle(dev, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> ex = sdm.method_func(sdm.method_dev_handle(par, <span class="hljs-string"><span class="hljs-string">"exchange"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> modes = {[<span class="hljs-number"><span class="hljs-number">9</span></span>]=<span class="hljs-number"><span class="hljs-number">0x1f</span></span>, [<span class="hljs-number"><span class="hljs-number">10</span></span>]=<span class="hljs-number"><span class="hljs-number">0x3f</span></span>, [<span class="hljs-number"><span class="hljs-number">11</span></span>]=<span class="hljs-number"><span class="hljs-number">0x5f</span></span>, [<span class="hljs-number"><span class="hljs-number">12</span></span>]=<span class="hljs-number"><span class="hljs-number">0x7f</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> modes[precision] ~= <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ex(par, dev, {<span class="hljs-number"><span class="hljs-number">0x4e</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, modes[precision]}) sdm.attr_set(attr, precision) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> )</code> </pre> <br><p> <a href=""><img src="https://habrastorage.org/webt/er/lj/gb/erljgbs9zby8767izkmsunyhdd8.png"></a> </p><br><h2 id="memory-usage"> å†…å­˜ä½¿ç”¨é‡ </h2><br><p>  <em>ESP8266çš„</em>å¯ç”¨å†…å­˜çº¦ä¸º<em>40k</em> ã€‚ æœåŠ¡å™¨ä»£ç å·²ç§»è‡³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://gitlab.com/matsievskiysv/nodemcu-">LFS</a> ï¼Œå› æ­¤åœ¨åˆå§‹åŒ–æ—¶å®ƒä¸ä¼šå ç”¨ä»»ä½•RAMç©ºé—´ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://github.com/marcoskirsch/nodemcu-">åŸå§‹ä»£ç </a>å¤§çº¦éœ€è¦<em>10k</em> ï¼‰ã€‚ </p><br><p> å¯¹äº5ä¸ªè®¾å¤‡é©±åŠ¨ç¨‹åºå’Œ5ä¸ªè®¾å¤‡ï¼Œ <em>SDM</em>å¤§çº¦éœ€è¦1 <em>ä¸‡</em> ã€‚ éæµ®åŠ¨å›ºä»¶ç‰ˆæœ¬ç•¥å°ã€‚ å› æ­¤ï¼Œæœ€å¥½åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é©±åŠ¨ç¨‹åºæ¸…å•ä¸­</a>é€‰æ‹©ä»…æ‰‹å¤´ä»»åŠ¡æ‰€éœ€çš„é©±åŠ¨ç¨‹åºã€‚ æœ€æ¶ˆè€—å†…å­˜çš„ä»»åŠ¡æ˜¯æä¾›<code>vue.js</code>åº“ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/yy/u-/_i/yyu-_idkp2osapmg3-jy5z2r8ly.png"></a> </p><br><p> åœ¨è¯·æ±‚åŸå§‹<em>JSON</em>ç¼–ç çš„æ•°æ®ï¼ˆä½¿ç”¨<code>curl</code> ï¼‰çš„æƒ…å†µä¸‹ï¼Œå³°å€¼å†…å­˜æ¶ˆè€—å¯èƒ½ä¼šå¤§å¤§å‡å°‘ã€‚ </p><br><p> <a href=""><img src="https://habrastorage.org/webt/w_/hu/xx/w_huxxzt4w2wszdqq04bgbonbt0.png"></a> </p><br><h2 id="instead-of-an-epilogue"> è€Œä¸æ˜¯ç»“å°¾ </h2><br><p> æˆ‘ä½¿ç”¨sdmå®æ–½çš„ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç»‘å®š <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>node.restart()</code></a> ã€‚ <br> ä½¿ç”¨Webç”¨æˆ·ç•Œé¢è¿›è¡Œå°è¯•äº§ç”Ÿäº†ä¸€ä¸ªå¥‡æ€ªçš„ç»“æœã€‚  Webæµè§ˆå™¨å‘å‡ºè¯·æ±‚åï¼ŒèŠ¯ç‰‡ç«‹å³æŒ‰é¢„æœŸæ–¹å¼é‡æ–°å¯åŠ¨ã€‚ ä½†æ˜¯ç”±äºNodeMCUæ— æ³•æ­£ç¡®å“åº”HTTPè¯·æ±‚ï¼Œå› æ­¤Webæµè§ˆå™¨å†æ¬¡å°è¯•äº†ç›¸åŒçš„è¯·æ±‚ã€‚ å½“NodeMCUæœåŠ¡å™¨é‡æ–°å¯åŠ¨å¹¶å†æ¬¡å¯åŠ¨æ—¶ï¼Œæµè§ˆå™¨å·²è¿æ¥åˆ°å®ƒï¼Œé‡ç½®å†…éƒ¨é‡<em>è¯•</em>è®¡æ•°å™¨å¹¶è°ƒç”¨äº†<code>node.restart()</code>æ–¹æ³•ï¼Œä»è€Œå¼€å§‹äº†NodeMCUé‡æ–°å¯åŠ¨çš„æ— é™å¾ªç¯ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN449992/">https://habr.com/ru/post/zh-CN449992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN449976/index.html">C ++ä¸­çš„å¤šçº¿ç¨‹å…³è”å®¹å™¨ã€‚ YandexæŠ¥å‘Š</a></li>
<li><a href="../zh-CN449978/index.html">è«æ–¯ç§‘ç‰¹æ–¯æ‹‰ä¿±ä¹éƒ¨çš„ä¼Šæˆˆå°”Â·å®‰å¡”æ´›å¤«ï¼ˆIgor Antarovï¼‰æŒ£æ‰ç€å…³äºç‰¹æ–¯æ‹‰å’Œç”µåŠ¨æ±½è½¦çš„20ä¸ªç¥è¯</a></li>
<li><a href="../zh-CN449984/index.html">Googleæ–°é—»å’Œåˆ—å¤«Â·æ‰˜å°”æ–¯æ³°ï¼šä½¿ç”¨t-SNEå¯è§†åŒ–Word2Vecå•è¯åµŒå…¥</a></li>
<li><a href="../zh-CN449986/index.html">åŒºå—é“¾ï¼šæˆ‘ä»¬åº”è¯¥å»ºç«‹ä¸€ä¸ªæ¡ˆä¾‹ï¼Ÿ</a></li>
<li><a href="../zh-CN449990/index.html">å¦‚ä½•äº¤æœ‹å‹ä¹³èƒ¶ï¼Œé…æ–¹å’Œå“ˆä¼¯ï¼Ÿ</a></li>
<li><a href="../zh-CN449994/index.html">æ–½è€å¾·æ›¼çš„å…«ä¸ªé»„é‡‘æ³•åˆ™å°†å¸®åŠ©æ‚¨åˆ›å»ºæ›´å¥½çš„ç•Œé¢</a></li>
<li><a href="../zh-CN449996/index.html">äº†è§£FFTç®—æ³•</a></li>
<li><a href="../zh-CN449998/index.html">å¸¸è§é—®é¢˜è§£ç­”ï¼šæ—…è¡Œè€…æå®¢åœ¨æ—…è¡Œä¹‹å‰éœ€è¦äº†è§£å“ªäº›ç–«è‹—</a></li>
<li><a href="../zh-CN450000/index.html">ï¼ˆä»å³åˆ°å·¦ï¼ˆé€šè¿‡çª¥é•œ</a></li>
<li><a href="../zh-CN450002/index.html">ä½¿ç”¨PVS-StudioæŸ¥æ‰¾LLVM 8ä¸­çš„é”™è¯¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>