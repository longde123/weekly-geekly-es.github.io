<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↖️ ⚪️ 💛 Reverse Engineering des Austauschprotokolls in EOS-Geräten 👨🏽‍⚕️ 🤚🏿 🚩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich muss gleich sagen, die Überschrift ist vielleicht etwas laut. Ich musste wirklich nur einen Befehl aus dem Protokoll ziehen, um den Dimmer zu steu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reverse Engineering des Austauschprotokolls in EOS-Geräten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453234/"><img src="https://habrastorage.org/webt/pt/u1/jf/ptu1jfusfx89aspkcdsgcl2cfd8.jpeg"><br><br>  Ich muss gleich sagen, die Überschrift ist vielleicht etwas laut.  Ich musste wirklich nur einen Befehl aus dem Protokoll ziehen, um den Dimmer zu steuern.  Wie das gemacht wurde und was am Ende passiert ist, lesen Sie weiter im Artikel. <br><a name="habracut"></a><br>  Es gibt also eine solche deutsche Firma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EOS Premium SPA Technology</a> .  Es produziert eine breite Palette von Geräten für Saunen.  Sie haben sehr interessante Bedienfelder mit Touchscreens und einem hochwertigen Netzteil.  Sie sind zwar ziemlich teuer, aber sie scheinen sich zu rechtfertigen. <br><br>  Es gibt jedoch ein großes Minus in ihrer Ausrüstung.  Aggregate können Mehrkilowatt-Elektroöfen steuern, haben aber gleichzeitig einen sehr schwachen Lichtsteuerungskanal.  Nur bis zu 150 Watt!  Die Beleuchtung kann bequem direkt von der Fernbedienung aus gesteuert, ein- und ausgeschaltet und die Helligkeit angepasst werden.  Aber 150 W ist sehr klein!  Es gibt zusätzliche Einheiten für die Lichtsteuerung im Verkauf, aber der Preis dort ist sehr unmenschlich. <br>  In dieser Hinsicht schien die Aufgabe darin zu bestehen, einen Dimmer herzustellen, der die Last mit mehr Leistung und zusätzlich mit Niederspannungslast (LED-Streifen bei 12 / 24V oder Halogenlampen bei 24V) regelt. <br><br>  Halogene verbrauchen zwar mehr und sind anfällig für Burnout, aber meiner Meinung nach ist die Beleuchtung von ihnen angenehmer.  Obwohl dies Geschmackssache ist.  Im Allgemeinen ist eine solche Aufgabe gereift.  Warum eine solche Beleuchtung benötigt wird, ist in diesem Bild gut dargestellt: <br><br><img src="https://habrastorage.org/webt/hh/ll/df/hhlldfevv9dtynhk6u8pw4bxc8w.jpeg"><br><br>  EOS veröffentlicht viele Bedienfelder, am häufigsten sind jedoch Emotec und Emotouch III.  Wir werden uns um sie kümmern. <br><br><img src="https://habrastorage.org/webt/vm/jn/xg/vmjnxg9m9mddm-p-spev7s9zzzy.jpeg"><br><br><img src="https://habrastorage.org/webt/n7/cz/h4/n7czh4zcvsxxq32x7jba0jj8fc4.jpeg"><br><br>  Ich muss sagen, dass das Bedienfeld in der EOS-Ausrüstung über ein herkömmliches 4-poliges Telefonkabel mit dem Netzteil verbunden ist: <br><br><img src="https://habrastorage.org/webt/um/qy/fx/umqyfxidgautasltb4fecpve810.jpeg"><br><br>  Eine schnelle Überprüfung der Platine ergab, dass zwei Drähte für 24-V-Stromversorgung und die anderen beiden für die RS-485-Schnittstellenleitung vorgesehen waren.  Im Allgemeinen eine Standardimplementierung.  Die Zeilen A und B befinden sich in der Mitte: <br><br><img src="https://habrastorage.org/webt/9_/iv/8q/9_iv8qeyufqoi4hidaqr6ukpvls.png"><br><br>  Nachdem wir uns mit dem USB-RS-485-Konverter an die Leitung angeschlossen und die Geschwindigkeit von der Glatze auf 9600 Bit / s eingestellt hatten, sahen wir laufende Bytes, aber ihr Zweck war natürlich unbekannt.  Das Austauschprotokoll wurde nicht gemeinfrei gefunden, und der Hersteller selbst weigerte sich, es bereitzustellen, obwohl er eine entsprechende Anfrage gesendet hatte. <br>  Ich musste mich selbst dekodieren :-) <br><br>  Ja, ich werde sofort eine Nuance bemerken.  Die Dimmersteuerung funktioniert erst nach Inbetriebnahme des Netzteils.  Dies ist deutlich sichtbar, wenn die Lampe an den Ausgang des eingebauten Dimmers angeschlossen ist.  Es beginnt erst zu leuchten, nachdem sich die Sauna erwärmt hat. <br><br>  Zunächst begannen sie, die Geschwindigkeiten von 9600 bis 115200 Bit / s aus der Standardserie zu sortieren. <br>  Und bei einer Geschwindigkeit von 38400 fiel mir auf, dass die Befehle durch zwei Standardbytes 0x0A, 0x0D getrennt sind. <br><br>  Nun, das ist schon etwas.  Lass uns den nächsten Trick machen.  Suchen wir nach dem Befehl, den wir benötigen, anhand des Helligkeitswerts.  Plötzlich wird es im klaren übertragen. <br><br>  Wir stellen den Wert 73 (0x49) auf der Fernbedienung ein: <br><br><img src="https://habrastorage.org/webt/v6/nk/ye/v6nkye2sbd2i97veetujuehgjac.jpeg"><br><br>  Als nächstes entfernen wir das Protokoll und suchen dort dumm nach diesem Byte: <br><br><img src="https://habrastorage.org/webt/bp/hx/g4/bphxg4rbib00zdybzqdzvd5gn84.png"><br><br>  Voila!  Wir finden es, schauen nach links und rechts zu den Bytes 0x0A, 0x0D und versuchen, das benötigte Paket auszuwählen.  Und als Ergebnis erhalten wir diese Struktur: <br><br>  0x0E 0x04 0x04 0x49 0x49 0x00 0x00 0xD1 0x0A 0x0D <br><br>  Während der Experimente wurde festgestellt, dass 2 und 3 Bytes immer gleich 0x04 sind, 4 und 5 die Helligkeit in Prozent einstellen, 6 und 7 gleich 0, 8 sind - es ändert sich, was bedeutet, dass es nicht klar ist, 9 und 10 - 0x0A, 0xD. <br><br>  Wie Experimente gezeigt haben, ist das erste Byte die Adresse.  Es legt die sogenannte Zimmernummer fest.  Tatsache ist, dass EOS-Fernbedienungen mehrere Aggregate gleichzeitig steuern können.  Jeder hat seine eigene Adresse, die in diesem Byte übertragen wird. <br><br>  Die Adressen lauten wie folgt: <br>  Für Ofenbedienfelder: <br>  01 - erstes Zimmer <br>  21 - zweiter Raum <br>  41 - dritter Raum <br>  61 - vierter Raum <br>  81 - fünfter Raum <br>  A1 - sechster Raum <br>  C1 - siebter Raum <br>  E1 - achter Raum <br><br>  Für Dampferzeuger-Bedienfelder: <br>  0E - erster Raum <br>  2E - zweiter Raum <br>  4E - dritter Raum <br>  6E - vierter Raum <br>  8E - fünfter Raum <br>  AE - sechster Raum <br>  CE - siebter Raum <br>  EE - achter Raum <br><br>  Eigentlich ist das alles Dekodierung. <br><br>  Um dies sozusagen in der "Dynamik" zu überprüfen, haben wir das Programm schnell auf Delphi geworfen, um den Helligkeitswert anzuzeigen, und den Schieberegler gedreht.  Alles erfüllt klar. <br><br>  Danach haben wir in C ein einfaches Programm zum Decodieren dieser Pakete entwickelt und alles in Hardware gestartet.  Das Gerät selbst ist recht einfach.  Dort ist gewöhnliches PWM auf einem Netzschlüssel implementiert, aber wenn ich interessiert bin, kann ich einen separaten Artikel darüber schreiben. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453234/">https://habr.com/ru/post/de453234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453218/index.html">Die Hauptsache bei YaC 2019: Hundert Drohnen auf den Straßen, Yandex.Module, Essen, Smart Home</a></li>
<li><a href="../de453220/index.html">13 E-Mail-Marketing-Fehler, die für ein besseres Engagement vermieden werden sollten</a></li>
<li><a href="../de453222/index.html">SphinxSearch-Meetup SuperJob</a></li>
<li><a href="../de453228/index.html">Nixie Uhr an den Anzeigen IN-18</a></li>
<li><a href="../de453232/index.html">Schreiben von Milliarden Songs mit C # und Deep Learning</a></li>
<li><a href="../de453236/index.html">Prototyping eines Handyspiels, wo man anfängt und wie man es macht. Teil 2</a></li>
<li><a href="../de453238/index.html">Lauflicht am Relais</a></li>
<li><a href="../de453242/index.html">Spielplatz für Sommerveranstaltungen</a></li>
<li><a href="../de453246/index.html">ERP - Continuous Degradation System</a></li>
<li><a href="../de453248/index.html">Artemis Lunar Mission - Produktion des Hauptelements der Mondorbitalstation Lunar Gateway gestartet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>