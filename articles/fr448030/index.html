<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèæ üñêüèø üôÖüèæ Affichage et optimisation de la sortie du terminal sur le Web ‚è≥ ü§∂üèº üë©üèΩ‚Äçü§ù‚Äçüë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il n'y a pas si longtemps, je suis tomb√© sur une t√¢che assez simple et en m√™me temps int√©ressante: impl√©menter un terminal en lecture seule dans une a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Affichage et optimisation de la sortie du terminal sur le Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448030/"><p>  Il n'y a pas si longtemps, je suis tomb√© sur une t√¢che assez simple et en m√™me temps int√©ressante: impl√©menter un terminal en lecture seule dans une application Web.  L'int√©r√™t pour la t√¢che a √©t√© donn√© par trois aspects importants: </p><br><ul><li>  prise en charge des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©quences d'√©chappement ANSI de</a> base </li><li>  prise en charge d'au moins 50 000 lignes de donn√©es </li><li>  afficher les donn√©es d√®s qu'elles deviennent disponibles. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/fa/rk/kufarkakkmxskpfqqokeixh_ste.png"></div><br><p>  Dans cet article, je parlerai de la fa√ßon dont il a √©t√© mis en ≈ìuvre et comment il a ensuite optimis√© le tout. </p><a name="habracut"></a><br><p>  <em>Avertissement: Je ne suis pas un d√©veloppeur Web exp√©riment√©, donc certaines choses peuvent vous sembler √©videntes et les conclusions ou d√©cisions sont erron√©es.</em>  <em>Pour les corrections et clarifications, je vous en serai reconnaissant.</em> </p><br><h2 id="dlya-chego-eto-zatevalos">  Pourquoi √©tait-ce </h2><br><p>  Toute la t√¢che est la suivante: un script s'ex√©cute sur le serveur (bash, python, etc.) et √©crit quelque chose sur stdout.  Et cette conclusion doit √™tre affich√©e sur la page Web √† mesure qu'elle arrive.  En m√™me temps, il devrait ressembler au terminal (avec formatage, transferts de curseur, etc.) <br>  Je ne contr√¥le en aucune fa√ßon le script lui-m√™me et sa sortie et je ne l'affiche pas sous une forme pure. </p><br><p>  Bien s√ªr, entre l'interface Web et le script, il devrait y avoir un interm√©diaire - un serveur Web.  Et si ce n'est pas pour dissimuler - j'ai d√©j√† une application web et un serveur, et je travaille en quelque sorte.  Le sch√©ma ressemble √† ceci: <br><img src="https://habrastorage.org/webt/ww/kb/ei/wwkbei13_tv9n6w6vcw_6c4e5dm.png"></p><br><p>  Mais auparavant, le serveur √©tait responsable du traitement et du formatage.  Et je voulais l'am√©liorer pour un grand nombre de raisons: </p><br><ul><li>  double traitement des donn√©es - premi√®re analyse sur le serveur, puis transformation en composants html sur le client </li><li>  algorithme non optimal d√ª √† la pr√©paration des donn√©es pour le client </li><li>  forte charge sur le serveur - le traitement de la sortie d'un seul script peut charger compl√®tement un seul thread sur le serveur </li><li>  prise en charge incompl√®te des s√©quences d'√©chappement ANSI </li><li>  bogues subtils </li><li>  le client a tr√®s mal r√©ussi √† afficher m√™me des lignes au format 10k </li></ul><br><p>  Par cons√©quent, il a √©t√© d√©cid√© de transf√©rer l'int√©gralit√© de la logique d'analyse √† l'application Web et de ne laisser que le streaming des donn√©es brutes au serveur </p><br><h2 id="postanovka-zadachi">  √ânonc√© du probl√®me </h2><br><p>  Des parties du texte parviennent au client.  Le client doit les analyser en composants: texte brut, saut de ligne, retour chariot et commandes ANSI sp√©ciales.  Il n'y a aucune garantie quant √† l'int√©grit√© des pi√®ces - une commande ou un mot peut provenir de diff√©rents packages. </p><br><p>  Les commandes ANSI peuvent affecter le format du texte (couleur, arri√®re-plan, style), la position du curseur (d'o√π le texte suivant doit √™tre affich√©) ou pour effacer une partie de l'√©cran. <br>  Un exemple de ce √† quoi il ressemble: <br><img src="https://habrastorage.org/webt/5u/3c/tt/5u3cttwmep44kv8c9gysh5bn9ig.png"></p><br><p>  De plus, il peut y avoir des URL dans le texte qui doivent √©galement √™tre reconnues et mises en √©vidence. </p><br><h2 id="beryom-gotovuyu-biblioteku-i-">  Nous prenons la biblioth√®que termin√©e et ... </h2><br><p>  J'ai compris que le traitement correct et rapide de toutes les commandes n'est pas une t√¢che facile.  J'ai donc d√©cid√© de chercher une biblioth√®que toute faite.  Et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voil√†</a> , je suis imm√©diatement tomb√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xterm.js</a> .  Un composant pr√™t √† l'emploi du terminal, qui est d√©j√† utilis√© dans de nombreux endroits et, en plus, <em>"est vraiment rapide, il inclut m√™me un moteur de rendu acc√©l√©r√© par GPU"</em> .  Ce dernier √©tait le plus important pour moi, car  Je voulais enfin avoir un client tr√®s rapide. </p><br><p>  Malgr√© le fait que j'aime √©crire mes propres v√©los, j'√©tais extr√™mement heureux de pouvoir non seulement gagner du temps, mais √©galement obtenir un tas de fonctionnalit√©s utiles gratuitement. </p><br><p>  Il m'a fallu 14 heures pour essayer de connecter le terminal et je n'ai <strong>pas pu y</strong> faire face.  Absolument. <br>  Diff√©rentes hauteurs de ligne, s√©lection tordue, taille adaptative du terminal, une API tr√®s √©trange, manque de documentation saine ... </p><br><p>  Mais j'avais encore un peu d'inspiration et je pensais pouvoir faire face √† ces probl√®mes. <br>  Jusqu'√† ce que j'alimente mes 10 000 lignes de test au terminal ... Il est mort.  Et enterr√© avec moi les restes de mes espoirs. </p><br><h2 id="opisanie-itogovogo-algoritma">  Description de l'algorithme final </h2><br><p>  Tout d'abord, j'ai copi√© l'algorithme actuel impl√©ment√© en python et l'ai adapt√© pour javascript (en supprimant simplement les accolades et un autre pour la syntaxe). </p><br><p>  Je connaissais tous les principaux avantages et inconv√©nients de l'ancien algorithme, donc je n'avais qu'√† am√©liorer les endroits inefficaces. </p><br><p>  Apr√®s d√©lib√©ration, essais et erreurs, j'ai opt√© pour l'option suivante: on divise l'algorithme en 2 composantes: </p><br><ul><li>  mod√®le pour analyser le texte et stocker l'√©tat actuel du "terminal" </li><li>  mappage qui traduit le mod√®le en HTML </li></ul><br><h4 id="model-struktura-i-algoritm">  Mod√®le (structure et algorithme) </h4><br><ul><li>  Toutes les lignes sont stock√©es dans un tableau (num√©ro de ligne = index dans le tableau) </li><li>  Les styles de texte sont stock√©s dans un tableau s√©par√©. </li><li>  La position actuelle du curseur est stock√©e et peut √™tre modifi√©e par des commandes </li><li>  L'algorithme lui-m√™me v√©rifie les donn√©es d'entr√©e caract√®re par caract√®re: <br><ul><li>  Si ce n'est que du texte, ajoutez √† la ligne actuelle </li><li>  En cas de saut de ligne, augmentez l'index de ligne en cours </li><li>  S'il s'agit d'un des caract√®res de commande, nous le mettons dans le tampon de commande et attendons le caract√®re suivant </li><li>  Si le tampon de commande est correct, ex√©cutez cette commande, sinon nous √©crivons ce tampon sous forme de texte </li></ul></li><li>  Le mod√®le informe les auditeurs des lignes qui ont chang√© apr√®s le traitement du texte entrant </li></ul><br><p>  Dans mon impl√©mentation, la complexit√© de l'algorithme est O ( <em>n</em> log <em>n</em> ), o√π log <em>n</em> est la pr√©paration des lignes modifi√©es pour la notification (unicit√© et tri).  Au moment d'√©crire ces lignes, j'ai r√©alis√© que pour un cas particulier, vous pouvez vous d√©barrasser de log <em>n</em> , car les lignes sont le plus souvent ajout√©es √† la fin. </p><br><h4 id="otobrazhenie">  Affichage </h4><br><ul><li>  Affiche le texte sous forme d'√©l√©ments HTML </li><li>  Si la cha√Æne a chang√©, remplace compl√®tement tous les √©l√©ments de la cha√Æne </li><li>  Coupe chaque ligne en fonction des styles: chaque segment stylis√© a son propre √©l√©ment </li></ul><br><p>  Avec une telle structure, le test est une t√¢che assez simple - nous transf√©rons le texte vers le mod√®le (dans un seul package ou en parties) et v√©rifions simplement l'√©tat actuel de toutes les lignes et styles qu'il contient.  Et pour n'afficher que quelques tests, car  il redessine toujours les lignes modifi√©es. </p><br><p>  Un avantage important est √©galement une certaine paresse de l'affichage.  Si, dans un morceau de texte, nous rempla√ßons la m√™me ligne (par exemple, la barre de progression), apr√®s que le mod√®le fonctionne, pour l'affichage, il ressemblera √† une ligne modifi√©e. </p><br><h4 id="dom-vs-canvas">  DOM vs Canvas </h4><br><p>  Je voudrais insister un peu sur la raison pour laquelle j'ai choisi le DOM, bien que l'objectif soit la performance.  La r√©ponse est simple - la paresse.  Pour moi, le rendu de tout dans Canvas par moi-m√™me semble √™tre une t√¢che assez intimidante.  Tout en conservant la convivialit√©: mise en √©vidence, copie, redimensionnement de l'√©cran, apparence soign√©e, etc.  L'exemple xterm.js m'a clairement montr√© que ce n'est pas facile du tout.  Leur rendu sur toile √©tait loin d'√™tre id√©al. </p><br><p>  De plus, le d√©bogage de l'arborescence DOM dans le navigateur et la possibilit√© de couvrir les tests unitaires est un avantage important. </p><br><p>  Au final, mon objectif √©tait de 50k lignes, et je savais que le DOM devait y faire face, bas√© sur le travail de l'ancien algorithme. </p><br><h2 id="optimizacii">  Optimisations </h2><br><p>  L'algorithme √©tait pr√™t, d√©bogu√© et fonctionnait lentement mais s√ªrement.  Il √©tait temps d'ouvrir le profileur et d'optimiser.  Pour l'avenir, je dirai que la plupart des optimisations ont √©t√© une surprise pour moi (comme cela arrive g√©n√©ralement). </p><br><p>  Le profilage a √©t√© effectu√© sur 10 000 lignes, chacune contenant des √©l√©ments stylis√©s.  Le nombre total d'√©l√©ments DOM est d'environ 100k. </p><br><p>  Aucune approche et aucun outil sp√©cial n'ont √©t√© utilis√©s.  Seulement Chrome Dev Tools et quelques lancements pour chaque mesure.  En pratique, lors des lancements, seules les valeurs absolues des mesures (combien de secondes √† compl√©ter) diff√©raient, mais pas le rapport en pourcentage entre les m√©thodes.  Par cons√©quent, je consid√®re que cette technique est conditionnellement suffisante. </p><br><p>  Ci-dessous, je voudrais m'attarder plus en d√©tail sur les am√©liorations les plus int√©ressantes.  Et pour commencer, un graphique de ce qui √©tait: <br><img src="https://habrastorage.org/webt/me/xk/ot/mexkotdhezc4pwxhw4xczkzv9ie.png"></p><br><p>  <em>Tous les graphiques de profilage ont √©t√© cr√©√©s apr√®s la mise en ≈ìuvre, en d√©soptimisant le code de la m√©moire.</em> </p><br><h4 id="stringtrim">  string.trim </h4><br><p>  Tout d'abord, je suis tomb√© sur un string.trim incompr√©hensible qui consommait une quantit√© tr√®s importante de CPU (il me semble que c'√©tait environ 10-20%) <br><img src="https://habrastorage.org/webt/ue/nq/6b/uenq6brmlm8fxzxxjklulp7ccly.png"></p><br><p>  trim () est la fonction de base du langage.  Pourquoi utilise-t-il une sorte de biblioth√®que?  Et m√™me s'il s'agit d'une sorte de polyfill, pourquoi a-t-il activ√© la derni√®re version de Chrome? </p><br><p> Un peu sur Google et la r√©ponse se trouve: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://babeljs.io/docs/en/babel-preset-env</a> .  Par d√©faut, il active le polyfill pour un nombre assez important de navigateurs, et le fait au stade de la compilation.  La solution pour moi √©tait de sp√©cifier des <code>'targets': '&gt; 0.25%, not dead'</code> <br>  Mais √† la fin, j'ai supprim√© compl√®tement l'appel de trim, car inutile. </p><br><h4 id="vuejs">  Vue.js </h4><br><p>  L'ann√©e derni√®re, j'ai transf√©r√© le composant terminal vers Vue.js.  Maintenant, je devais le transf√©rer √† vanilla, la raison est dans la capture d'√©cran ci-dessous (voir le nombre de lignes impliquant Vue.js): </p><br><p><img src="https://habrastorage.org/webt/ll/oq/i8/lloqi8k2igkme2q616eooswyogg.png"></p><br><p>  Je n'ai laiss√© que le wrapper, les styles et le traitement de la souris dans le composant Vue.  Tout ce qui concerne la cr√©ation d'√©l√©ments DOM est entr√© dans JS pur, qui est connect√© au composant Vue comme un champ normal (qui n'est pas surveill√© par le framework). </p><br><pre> <code class="plaintext hljs">created() { this.terminalModel = new TerminalModel(); this.terminal = new Terminal(this.terminalModel); },</code> </pre> <br><p>  Je ne consid√®re pas cela comme un inconv√©nient ou un d√©faut dans Vue.js.  C'est juste que les frameworks et les performances eux-m√™mes ne se m√©langent pas bien.  Eh bien, lorsque vous d√©posez des dizaines et des centaines de milliers d'objets dans un cadre r√©actif, il est tr√®s difficile de s'attendre √† un traitement de celui-ci en quelques millisecondes.  Et pour √™tre honn√™te, je suis m√™me surpris que Vue.js se soit plut√¥t bien d√©brouill√©. </p><br><h4 id="dobavlenie-novyh-elementov">  Ajout de nouveaux √©l√©ments </h4><br><p>  Tout est simple ici - si vous avez plusieurs milliers de nouveaux √©l√©ments et que vous souhaitez les ajouter au composant parent, faire appendChild n'est pas une bonne id√©e.  Le navigateur doit effectuer le traitement un peu plus souvent et consacrer plus de temps au rendu.  L'un des effets secondaires de mon cas a √©t√© un ralentissement du d√©filement automatique,  il force un recomptage de tous les composants ajout√©s. </p><br><p><img src="https://habrastorage.org/webt/v_/5k/uj/v_5kujs_plen-j5zoxhq0ixv9um.png"></p><br><p>  Pour r√©soudre le probl√®me, il existe un DocumentFragment.  Tout d'abord, nous y ajoutons tous les √©l√©ments, puis nous l'ajoutons au composant parent.  Le navigateur s'occupera de l'inline des composants entrants. </p><br><p>  Cette approche r√©duit le temps que le navigateur passe √† rendre et √† organiser les √©l√©ments. <br>  J'ai √©galement essay√© d'autres fa√ßons d'acc√©l√©rer l'ajout d'√©l√©ments.  Aucun d'entre eux n'a pu ajouter quoi que ce soit au-dessus du DocumentFragment. </p><br><h4 id="span-vs-div">  span vs div </h4><br><p>  En fait, cela pourrait √™tre appel√© <code>display:inline</code> (span) vs <code>display:block</code> (div). </p><br><p>  Au d√©part, j'avais toutes les lignes de l'intervalle et je me suis termin√© avec un caract√®re de saut de ligne.  Cependant, en termes de performances, ce n'est pas tr√®s efficace: le navigateur doit d√©terminer o√π l'√©l√©ment commence et se termine.  Avec display: block, ces calculs sont beaucoup plus simples. </p><br><p>  Remplacer par un rendu acc√©l√©r√© par div de pr√®s de 2 fois. </p><br><p>  Malheureusement, dans le cas de l' <code>display:block</code> mise en surbrillance de plusieurs lignes de texte semble pire: </p><br><p><img src="https://habrastorage.org/webt/dm/kj/nq/dmkjnq9up61pc-ic0jalnfi3jw8.png"></p><br><p>  Pendant longtemps, je n'ai pas pu d√©cider ce qui est le mieux - 2 secondes suppl√©mentaires de rendu ou de s√©lection humaine.  En cons√©quence, l'aspect pratique a vaincu la beaut√©. </p><br><h4 id="master-css-10-go-urovnya">  Assistant CSS de niveau 10 </h4><br><p>  Un autre ~ 10% du temps de rendu a √©t√© coup√© par l '"optimisation" CSS, que j'utilise pour formater le texte. </p><br><p>  L'inexp√©rience dans le d√©veloppement Web et la compr√©hension des bases ont jou√© contre moi.  Je pensais que plus les s√©lecteurs √©taient pr√©cis, mieux c'√©tait, mais sp√©cifiquement dans mon cas, ce n'√©tait pas le cas. </p><br><p>  Pour formater le texte dans le terminal, j'ai utilis√© les s√©lecteurs suivants: </p><br><pre> <code class="plaintext hljs">#script-panel-container .log-content &gt; div &gt; span.text_color_green,</code> </pre> <br><p>  Mais (en chrome), l'option suivante est un peu plus rapide: </p><br><pre> <code class="plaintext hljs">span.text_color_green</code> </pre> <br><p>  Je n'aime pas vraiment ce s√©lecteur, car  trop global, mais les performances sont plus ch√®res. </p><br><h4 id="stringsplit">  string.split </h4><br><p>  Si vous avez un d√©j√†-vu d√ª √† l'un des points pr√©c√©dents, alors c'est faux.  Cette fois, il ne s'agit pas de polyfill, mais de l'impl√©mentation standard dans Chrome: </p><br><p><img src="https://habrastorage.org/webt/i8/jk/lh/i8jklht2lc0hhc9h6p1la3zuk6o.png"></p><br><p>  <em>(J'ai envelopp√© string.split dans defSplit pour que la fonction apparaisse dans le profileur)</em> </p><br><p>  1% sont des bagatelles.  Mais le cycliste id√©aliste en moi √©tait hant√©.  Dans mon cas, le split se fait toujours un caract√®re √† la fois et sans habitu√©s.  Par cons√©quent, j'ai impl√©ment√© une option simple.  Voici le r√©sultat: </p><br><p><img src="https://habrastorage.org/webt/hu/fd/_r/hufd_rbij0khcfqcudcnpfkjisa.png"></p><br><div class="spoiler">  <b class="spoiler_title">fastSplit</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">function fastSplit(str, separatorChar) { if (str === '') { return ['']; } let result = []; let lastIndex = 0; for (let i = 0; i &lt; str.length; i++) { const char = str[i]; if (char === separatorChar) { const chunk = str.substr(lastIndex, i - lastIndex); lastIndex = i + 1; result.push(chunk); } } if (lastIndex &lt; str.length) { const lastChunk = str.substr(lastIndex, str.length - lastIndex); result.push(lastChunk); } return result; }</code> </pre> </div></div><br><p>  Je pense qu'apr√®s cela, ils sont oblig√©s de m'emmener dans l'√©quipe Google Chrome sans entretien. </p><br><h4 id="optimizaciya-posleslovie">  Optimisation, postface </h4><br><p>  L'optimisation est un processus sans fin et quelque chose peut √™tre am√©lior√© ind√©finiment.  Surtout si l'on consid√®re que les diff√©rents cas d'utilisation n√©cessitent des optimisations diff√©rentes (et conflictuelles). </p><br><p>  Pour mon cas, j'ai choisi le cas d'utilisation principal et optimis√© son temps de fonctionnement de 15 secondes √† 5 secondes.  Sur ce, j'ai d√©cid√© d'arr√™ter. <br><img src="https://habrastorage.org/webt/ol/ri/j3/olrij3u8nfgpdrbm5-0db4vkpra.png"></p><br><p>  Il y a encore quelques endroits que je pr√©vois d'am√©liorer, mais c'est gr√¢ce √† l'exp√©rience acquise. </p><br><h2 id="bonus-mutacionnoe-testirovanie">  Bonus  Test de mutation. </h2><br><p>  Il est arriv√© qu'au cours des derniers mois, je suis souvent tomb√© sur le terme ¬´test mutationnel¬ª.  Et j'ai d√©cid√© que cette t√¢che √©tait un excellent moyen d'essayer cette b√™te.  Surtout apr√®s que je n'ai pas eu de couverture de code dans Webstorm, pour des tests sur le karma. </p><br><p>  Comme la technique et la biblioth√®que sont nouvelles pour moi, j'ai d√©cid√© de m'en sortir avec un peu de sang: pour tester un seul composant - le mod√®le.  Dans ce cas, vous pouvez clairement indiquer quel fichier nous testons et quelle suite de tests lui est destin√©e. </p><br><p>  Mais quoi qu'on en dise, j'ai d√ª beaucoup bricoler pour r√©ussir l'int√©gration avec le karma et le webpack. </p><br><p>  Finalement, tout a commenc√© et apr√®s une demi-heure, j'ai vu de tristes r√©sultats: environ la moiti√© des mutants ont surv√©cu.  J'ai tu√© une partie imm√©diatement, une partie laiss√©e pour l'avenir (lorsque j'ai impl√©ment√© les commandes ANSI manquantes). </p><br><p>  Apr√®s cela, la paresse a gagn√©, et pour le moment les r√©sultats sont les suivants (pour 128 tests): </p><br><pre> <code class="plaintext hljs">Ran 79.04 tests per mutant on average. ------------------|---------|----------|-----------|------------|---------| File | % score | # killed | # timeout | # survived | # error | ------------------|---------|----------|-----------|------------|---------| terminal_model.js | 73.10 | 312 | 25 | 124 | 1 | ------------------|---------|----------|-----------|------------|---------| 23:01:08 (18212) INFO Stryker Done in 26 minutes 32 seconds.</code> </pre> <br><p>  En g√©n√©ral, cette approche m'a sembl√© tr√®s utile (√©videmment meilleure que la couverture du code) et dr√¥le.  Le seul point n√©gatif est un temps terriblement long - 30 minutes par classe, c'est trop. </p><br><p>  Et surtout, cette approche m'a fait repenser √† 100% de couverture et √† savoir s'il vaut la peine de tout couvrir avec des tests: maintenant mon avis est encore plus proche de ¬´oui¬ª en r√©pondant √† cette question. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  L'optimisation des performances, √† mon avis, est un bon moyen d'apprendre plus profond√©ment.  C'est aussi un bon entra√Ænement pour le cerveau.  Et il est tr√®s regrettable que cela soit rarement vraiment n√©cessaire (au moins dans mes projets). </p><br><p>  Et comme toujours, l'approche ¬´premier profilage, puis optimisation¬ª fonctionne bien mieux que l'intuition. </p><br><h4 id="ssylki">  Les r√©f√©rences </h4><br><p>  Ancienne impl√©mentation: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">terminal_formatter.py</a> </li><li>  <a href="">log_panel.vue</a> </li></ul><br><p>  Nouvelle impl√©mentation: </p><br><ul><li>  <a href="">terminal_model.js</a> </li><li>  <a href="">terminal_view.js</a> </li></ul><br><p>  Malheureusement, il n'y a pas de d√©monstration de composant Web, vous ne pourrez donc pas le faire.  Je m'excuse donc √† l'avance </p><br><p>  Merci pour votre temps, je serai heureux de commentaires, suggestions et critiques raisonnables! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448030/">https://habr.com/ru/post/fr448030/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448016/index.html">Analyse clinique de l'urine √† domicile sur des bandelettes de test: avantages et inconv√©nients</a></li>
<li><a href="../fr448018/index.html">√âv√©nements num√©riques √† Moscou du 15 avril au 21 avril</a></li>
<li><a href="../fr448022/index.html">Compilateur angulaire 200 lignes</a></li>
<li><a href="../fr448024/index.html">Les r√©gulateurs europ√©ens s'opposent aux banni√®res de cookies</a></li>
<li><a href="../fr448026/index.html">Projet logiciel et OOP Evolution</a></li>
<li><a href="../fr448032/index.html">Plus de robots: Walmart pr√©sente des milliers de machines pour fonctionner dans ses magasins</a></li>
<li><a href="../fr448034/index.html">Recherche de t√¢ches dans JIRA (langage simple). Partie 1: Recherche rapide et basique</a></li>
<li><a href="../fr448036/index.html">Importer vers J. Connect √† partir du fichier de liste d'utilisateurs via l'API</a></li>
<li><a href="../fr448038/index.html">Nouvelles fonctionnalit√©s pour les auteurs d'extensions dans Visual Studio 2019 v.16.1</a></li>
<li><a href="../fr448040/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 294 (du 8 au 14 avril)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>