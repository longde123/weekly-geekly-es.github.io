<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👃🏿 👩🏿‍🤝‍👩🏻 🔤 Comment j'ai créé Recycle! VR 🎅🏾 👷🏻 🙇🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans l' article précédent, nous avons essayé de créer une scène de base dans A-Frame afin d'essayer les concepts de base du cadre dans la pratique. Da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai créé Recycle! VR</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443062/"><img src="https://habrastorage.org/webt/zw/1k/9x/zw1k9xfuttgxodgleuo-ksko4nq.png"><br><br>  Dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent,</a> nous avons essayé de créer une scène de base dans A-Frame afin d'essayer les concepts de base du cadre dans la pratique.  Dans cet article, je voudrais partager mon expérience dans la création d'un jeu sur A-Frame - Recycle!  VR  Le référentiel de projet est disponible sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien suivant</a> . <br><br><h2>  Recyclage!? </h2><br>  L'idée de créer un jeu est venue presque immédiatement dès que j'ai découvert le Web VR.  Bien qu'en général, je pense que les jeux sur le web seront en tout cas inférieurs aux bons projets même pour les appareils mobiles, sans parler des ordinateurs personnels et des consoles.  Mais il me semble que le jeu est le test le plus difficile.  J'ai commencé à penser exactement à ce que je pouvais faire.  J'ai regardé d'autres projets et j'ai été immédiatement frappé par l'opportunité de prendre quelque chose à l'aide du contrôleur.  Et depuis que je suis connecté à une organisation qui s'occupe de la collecte séparée des déchets depuis un certain temps, la réponse est venue d'elle-même.  Le recyclage.  Nous prenons la poubelle et la jetons à la poubelle.  Quoi de plus simple.  Mais tout s'est avéré pas si simple, et cela, en fait, sera discuté plus loin. <br><a name="habracut"></a><br><h2>  Sélection du cadre </h2><br>  Lors du démarrage des travaux sur le jeu, je ne connaissais que 2 frameworks plus ou moins sérieux: React 360, A-Frame.  De toute évidence, A-Frame était le plus approprié pour créer le jeu.  Oui, maintenant je sais qu'il existe toujours un moteur de jeu PlayCanvas qui prend également en charge la VR, mais il est trop tard.  De plus, il s'est avéré que A-Frame n'est pas non plus mauvais pour créer des jeux. <br><br><h2>  Par où commencer? </h2><br>  J'ai commencé par étudier des exemples de jeux officiels de développeurs A-Frame.  L'avantage de tant de choses.  A-Blast, A-Painter, Museum, Super Craft et maintenant aussi Gunters of Oasis.  De tous les projets présentés, j'ai le plus aimé A-Blast - un jeu de tir dans lequel vous devez vous battre avec les créatures les plus mignonnes de l'univers.  Par conséquent, je voulais prendre ce jeu comme modèle pour le mien.  Mais ça n'a pas marché.  Et la raison en était la structure du jeu.  Il me semblait qu'elle était trop encombrée et non réfléchie.  Il n'est peut-être pas nécessaire d'en faire plus, mais je voulais faire quelque chose de plus pratique et plus facile à comprendre. <br><br><h2>  La structure </h2><br>  La structure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">A-Blast</a> ne représente qu'un seul point d'entrée - le fichier index.html, qui contient une scène avec tous les actifs, les entités de jeu de base, les contrôles et tout en général. <br><br><img src="https://habrastorage.org/webt/_t/gy/cv/_tgycvogik29i2jemys2srlpuuy.png"><br><br>  Comme vous pouvez le voir sur la capture d'écran, en plus des composants et des systèmes nécessaires (A-Frame utilise le modèle Entity Component System), il y a aussi des balles et des ennemis - essentiellement les mêmes systèmes, mais pour une raison quelconque, ils ont leur propre wrapper.  Dites généralement que ce code n'est pas facile à comprendre.  J'ai donc décidé de réfléchir à la façon dont ce code peut être structuré.  La première idée est de décomposer la scène en ses parties constituantes.  Pourquoi un routeur et des modèles seraient-ils utiles, qui rendraient telle ou telle partie de la scène?  Après avoir recherché la première et la seconde (non, pas cinq minutes), je n'ai rien trouvé.  Même si je suis partisan de la règle, n'écrivez pas de vélos, mais cette fois j'ai dû écrire ma décision.  Cependant, quelque part en 2-3 semaines, je suis tombé sur des modèles de Kevin Ngo.  Mais c'était trop tard. <br><br><h2>  Routeur et modèles </h2><br><img src="https://habrastorage.org/webt/sp/bm/tn/spbmtnkznus5jjfffyvhjys6xvg.gif"><br><br>  Et donc, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un modèle de routeur de trame</a> entre en scène.  Que peut-il faire?  Comme mentionné ci-dessus, sa tâche principale est de rendre les parties nécessaires du jeu, par exemple, l'écran de titre, le terrain de jeu, l'écran de fin du jeu, etc.  Comment faire  En principe, vous pouvez trouver tout ce dont vous avez besoin dans la documentation du module sur github, mais en bref, nous avons les éléments suivants: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">router</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Routes --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start-screen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start-screen"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-field"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-field"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-over"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"game-over"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"how-to-play"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"how-to-play"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- End Routes --&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Templates --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"controls"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- End Templates --&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><ol><li>  Nous ajoutons le composant routeur à la scène. </li><li>  Ajoutez un itinéraire pour chaque partie de l'application (images de la scène).  Un itinéraire pour l'écran d'accueil, un autre pour le terrain de jeu, etc. </li><li>  Rendre les modèles directement via a-templates </li><li>  Si nécessaire, nous changeons d'itinéraire <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.el.systems.router.changeRoute(<span class="hljs-string"><span class="hljs-string">'game-field'</span></span>);</code> </pre> <br>  <b>Remarque</b> : cet exemple fait référence au code de scène, nous pouvons donc appeler directement le système de routeur. </li><li>  Nous définissons et connectons les modèles, quelque chose comme ceci: <br><br><pre> <code class="javascript hljs">AFRAME.registerTemplate(<span class="hljs-string"><span class="hljs-string">'game-field'</span></span>, <span class="hljs-string"><span class="hljs-string">` &lt;a-sub-assets&gt; &lt;a-asset-item id="glass" src="/assets/models/glass_bottle.gltf"&gt;&lt;/a-asset-item&gt; ... &lt;audio id="fail" src="/assets/sounds/fail.wav" preload&gt;&lt;/audio&gt; &lt;/a-sub-assets&gt; &lt;a-template name="button" options="text: EXIT; position: 0 1 4; rotation: 0 180 0; event: stop-game"&gt;&lt;/a-template&gt; &lt;a-entity id="indicator" indicator visible="false" position="0 1 -2" text="align: center; width: 4; color: #00A105; value: -1" &gt;&lt;/a-entity&gt; &lt;a-entity game-field-manager&gt;&lt;/a-entity&gt; `</span></span>);</code> </pre><br>  <b>Remarque: les</b> sous-actifs vous permettent de charger des actifs ainsi que des actifs, mais seulement avec la différence qu'il y a une vérification par défaut et si l'actif est déjà ajouté, il ne sera pas ajouté à nouveau lorsque l'itinéraire sera modifié. <br><br>  <b>Remarque 2:</b> Normalement, vous ne pouvez utiliser des modèles qu'avec la chaîne de modèle ES6.  Sinon, il peut se transformer en «chaîne» + var + «chaîne», pas cool.  Kevin, par exemple, prend en charge les moteurs de modèle.  Mais pourquoi le compliquer, non? <br></li></ol><br>  Ainsi, vous pouvez créer une structure d'application pratique qui contiendra les éléments suivants: <i>composants, systèmes, modèles, états, bibliothèques</i> .  Rien de plus et tout est sur les étagères. <br><br><h2>  Manipulation d'objets </h2><br><img src="https://habrastorage.org/webt/zm/m1/i3/zmm1i3r-m5no1cptxljmjcwr88u.gif"><br><br>  La toute première tâche à résoudre était la manipulation d'objets.  J'avais besoin d 'un lancer fonctionnel.  Au début, j'ai commencé à réfléchir à la façon de créer un tel composant à partir de zéro.  Purement au niveau philistin, une telle réflexion est admissible: nous avons un contrôleur (dans le cas d'un bureau c'est un curseur), il a une position.  Nous avons aussi certains objets, par exemple des cubes, ils ont aussi une position.  En changeant la position du contrôleur, nous devons changer la position de l'objet.  C'est simple?  Donc, en fait, oui, mais ça ne marchera pas.  Je mentionnerai quelques points d'une très longue liste pour vous en convaincre: <br><br><ul><li>  Le curseur dans A-Frame est un descendant d'une caméra et a des coordonnées relatives; </li><li>  La position du contrôleur ne suffit pas, vous devez toujours tenir compte de l'orientation, de la distance à l'objet, de la position de la caméra (joueur); </li><li>  Pour les objets avec un corps physique, cela ne fonctionnera pas du tout, car les coordonnées de la géométrie sont liées aux coordonnées du corps. </li></ul><br>  C'est bien que le bon M. Wil Murphy et ses amis aient fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un super-cadre</a> .  En substance, cette bibliothèque contient tous les composants nécessaires: <br><br><ul><li>  <b>hoverable</b> .  Orientation.  Pointez le contrôleur ou le curseur sur la zone de collision de l'objet (généralement l'objet entier) </li><li>  <b>saisissable</b> : capture.  Saisissez un objet à l'aide du bouton approprié et faites-le glisser </li><li>  <b>extensible</b> : saisir avec les deux mains et étirer \ presser </li><li>  <b>draggable \ dropable</b> : Essentiellement nécessaire pour déterminer l'événement «l'élément a été lancé à un emplacement spécifique» </li></ul><br>  Vous pouvez trouver tout ce dont vous avez besoin pour configurer et connecter des super-mains dans le référentiel mentionné ci-dessus.  Je veux juste attirer l'attention sur un certain nombre de nuances: <br><br><ul><li>  Créez des mixins séparés pour la main droite et la main gauche.  Séparez les composants par type de périphériques pris en charge.  Par exemple, la main droite, en plus des commandes oculus-touch, vive-controls, windows-motion-control, il peut également y avoir des commandes oculus-go et des commandes gear-vr.  La main gauche doit être cachée pour les casques mobiles BP.  Chaque contrôleur doit contenir à la fois des mains mixin et un composant super-mains.  <a href="">Un exemple</a> ; </li><li>  Si vous avez spécifié des objets: .clsname pour reycaster, n'oubliez pas de l'ajouter à chaque élément qui peut être pris à l'aide du contrôleur, sinon aucun événement pour les super-mains échouera.  Bien sûr, si <i>colliderEvent: raycaster-intersection</i> ; </li><li>  Faire glisser avec la souris projette les coordonnées 2D dans le monde 3D, il est donc préférable d'utiliser le curseur pour le bureau. </li></ul><br><h2>  Ajouter de la physique </h2><br>  Ajouter de la physique à un cadre est en fait très simple.  Il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">système spécial</a> pour cela.  Il est ajouté à la scène et le tour est joué, la physique est déjà dans votre poche. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">physics</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"debug: false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dynamic-body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">position</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 1 -2"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"floor"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">static-body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-box</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a-scene</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>Mark</b> : <i>debug: true</i> permet de visualiser les corps physiques liés à la géométrie.  Il est pratique lorsque vous devez «contourner» un objet. <br><br>  En fait, c'est un wrapper pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cannon.js</a> qui fait tout le sale boulot de comparer la géométrie et les corps physiques pour vous.  Encore une fois, sur le fonctionnement de ce système, vous pouvez le trouver dans la description du référentiel.  Et je voudrais m'attarder sur un seul point important pour mon jeu. <br><br>  Je devais m'assurer qu'en appuyant sur le bouton de la corbeille, une certaine force était définie (plus vous maintenez le bouton enfoncé, plus la force est grande).  Il s'est avéré que cette tâche n'est pas aussi simple qu'il y paraît à première vue.  Eh bien, qu'est-ce qui est si compliqué?  - vous dites, nous <i>appliquons Impluse</i> et le tour est joué.  Pas vraiment ... Il définit la rotation d'un objet le long d'un vecteur appliqué au centre du corps.  En utilisant cette méthode, nous ne pouvons qu'émuler un yule.  Cependant, si vous définissez un vecteur avec l'angle correct par rapport au plan, vous pouvez obtenir quelque chose de similaire à une poussée.  Mais ce n'est pas ce dont j'avais besoin. <br><br>  Il s'est avéré que j'avais besoin de vitesse lors du réglage de ce paramètre, l'objet commence son mouvement dans une direction donnée.  Cette direction est spécifiée par le vecteur.  Et ici, le plaisir commence.  Comment trouver ce vecteur?  J'ai trouvé deux options: <br><br><ol><li>  Obtenez le quaternion du contrôleur (ou de la caméra pour le bureau), qui décrit son orientation dans l'espace.  Créez un vecteur V1 = &lt;1,1,1&gt;, multipliez-le par la force de projection et appliquez l'orientation à tout cela. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> velocityVector = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Vector3(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); velocityVector.multiplyScalar(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force); velocityVector.applyQuaternion(controllerQuaternion); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grabbed.body.velocity.set(velocityVector.x, velocityVector.y, velocityVector.z);</code> </pre></li><li>  Trouvez la position du contrôleur (curseur) et la position de l'objet lancé.  Calculez le vecteur de direction pour deux points.  Normalisez le vecteur.  Et multipliez-le par la force. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> directionX = (trashPosition.x - zeroPosition.x); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> directionZ = (trashPosition.z - zeroPosition.z); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vectorsLength = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(directionX, <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(directionZ, <span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = (directionX / vectorsLength) * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> y = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> z = (directionZ / vectorsLength) * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.force; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.grabbed.body.velocity.set(x , y, z );</code> </pre></li></ol><br>  J'ai choisi la deuxième option car je ne peux y compter que x et z.  Et placez-vous vous-même, car j'avais besoin d'un lancer le long de l'arc pour que les déchets déversés tombent dans le panier, malgré que l'utilisateur tienne le contrôleur. <br><br><h2>  Quelques mots sur le modèle </h2><br><img src="https://habrastorage.org/webt/vt/fl/e9/vtfle9xqpvbpak4i2su4fusxplk.png"><br><br>  Dès le début, j'ai décidé de faire un jeu de style <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">low-poly</a> .  Bien que WebGL soit capable de rendre des scènes relativement complexes aujourd'hui, ses performances sont toujours inférieures aux bibliothèques avancées telles que DirectX, Vulkan, Mantle, etc. Tout dépend également des performances de l'appareil de l'utilisateur.  Comme je voudrais me concentrer sur les casques mobiles BP plus abordables (Oculus Go, Gear VR), je pense que le low-poly est l'une des rares solutions pour créer une application ou un jeu VR.  Bien sûr, tout dépend du volume. <br><br>  D'accord, le low-poly est tellement low-poly, mais comment faire tout cela?  Tout est très simple, il existe un bon outil open source - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blender</a> .  Croyez-moi, il est capable de beaucoup, mais pour des tâches simples, il ne convient pas tout à fait.  Il existe de nombreux supports de formation liés à la modélisation dans Blender et il ne sera pas difficile de les trouver.  Je voulais juste concentrer votre attention sur un certain nombre de points liés au développement web: <br><br><ol><li>  L'exportateur Three-js est obsolète.  Besoin de trouver et de fournir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un exportateur GLTF</a> .  GLTF est un format spécial conçu pour le Web.  Et oui, c'est JSON. </li><li>  GLTF ne prend pas en charge Cycles Renderer, vous devez donc utiliser Blender Renderer.  Et cela signifie qu'il n'y aura pas de nœuds frais, de transformations de couleurs, de reflets métalliques (cela peut être fait différemment). </li><li>  Vous devez exporter uniquement l'élément sélectionné.  Vous n'avez pas besoin de caméras et de lumières supplémentaires?  Fichier&gt; Exporter&gt; gltf 2.0.  Dans le menu de gauche, Exporter GLTF 2.0&gt; Exporter uniquement sélectionné. </li><li>  Nous commençons à exporter à partir de la position &lt;0, 0, 0&gt; dans Blender.  Il est préférable de mettre à l'échelle au même endroit, afin que plus tard vous n'utilisiez pas le composant d'échelle dans un cadre. </li><li>  Si vous dessinez un espace ouvert comme dans Recycle!  VR, vous devez ajouter des objets uniquement à l'endroit où le joueur peut théoriquement regarder.  Derrière, derrière les maisons, dans le Recycle!  il y a quelques arbres et seulement à l'endroit où l'utilisateur peut les voir.  Il n’est pas nécessaire de surcharger la scène. </li><li>  Si vous devez changer le matériau du modèle, vous devez attendre qu'il se charge, obtenir le modèle lui-même, en extraire tous les nœuds (GLTF contient des informations non seulement sur les maillages) <br><br><pre> <code class="javascript hljs">e.detail.model.traverse(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node.isMesh) { node.material.color = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> THREE.Color(someColor); } });</code> </pre></li></ol><br><h2>  En conclusion </h2><br>  Merci à tous pour votre attention!  Je vous rappelle encore une fois que le référentiel du projet est disponible sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien suivant</a> .  Quiconque veut apporter quelque chose de nouveau à ce jeu - bienvenue. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr443062/">https://habr.com/ru/post/fr443062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr443052/index.html">Belle montre précise d'un vieux smartphone</a></li>
<li><a href="../fr443054/index.html">Une sélection d'utilitaires pour un programmeur sous Linux</a></li>
<li><a href="../fr443056/index.html">Un deuxième patient atteint du VIH atteint une rémission</a></li>
<li><a href="../fr443058/index.html">Architecture épurée. Partie I - Introduction</a></li>
<li><a href="../fr443060/index.html">Est-ce que Starship atteindra Mars?</a></li>
<li><a href="../fr443064/index.html">Une sonde israélienne vole vers la lune</a></li>
<li><a href="../fr443066/index.html">Socrate amoureux: qui a jeté les bases de la philosophie occidentale</a></li>
<li><a href="../fr443070/index.html">Des idées prématurées et opportunes sur l'exemple des frères Gracchus</a></li>
<li><a href="../fr443080/index.html">Les disques durs des ordinateurs portables et des ordinateurs de bureau peuvent être une source d'écoute des conversations des personnes à proximité</a></li>
<li><a href="../fr443082/index.html">Pourquoi vous ne devriez pas regarder les autres lorsque vous apprenez une langue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>