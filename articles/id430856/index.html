<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤒 🗝️ 🛁 Seluruh kebenaran tentang RTOS. Artikel # 21. Kotak Surat: Pengantar dan Layanan Dasar 🤩 🤫 👼🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kotak surat disebutkan di salah satu artikel sebelumnya (# 5). Mereka adalah metode komunikasi antar-tugas sinyal-ke-sinyal termudah kedua yang diduku...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seluruh kebenaran tentang RTOS. Artikel # 21. Kotak Surat: Pengantar dan Layanan Dasar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430856/"><img src="https://habrastorage.org/webt/pj/yd/r0/pjydr0sj2zrtqop5hhxum0q2vki.jpeg"><br><br>  Kotak surat disebutkan di salah satu artikel sebelumnya (# 5).  Mereka adalah metode komunikasi antar-tugas sinyal-ke-sinyal termudah kedua yang didukung oleh Nucleus SE dan menyediakan cara yang murah dan fleksibel untuk mentransfer pesan-pesan sederhana antar tugas. <br><a name="habracut"></a><br>  Artikel sebelumnya dalam seri: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Semaphores: Layanan Tambahan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Semaphores: pengantar dan layanan dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Layanan Pembantu dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Pengantar dan Layanan Dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sinyal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Partisi Memori: Layanan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian memori: pengantar dan layanan dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Struktur data tugas dan panggilan API yang tidak didukung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan untuk bekerja dengan tugas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas: konfigurasi dan pengantar API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: fitur canggih dan pelestarian konteks</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: implementasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Desain dan Penyebaran Internal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Pendahuluan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan RTOS lainnya</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Interaksi tugas dan sinkronisasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas, pengalihan konteks, dan interupsi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas dan Perencanaan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: Struktur dan mode waktu-nyata</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: pengantar.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a> <br><h2>  Menggunakan Kotak Surat </h2><br>  Dalam Nucleus SE, kotak surat didefinisikan selama fase pembuatan.  Aplikasi dapat memiliki hingga 16 kotak surat.  Jika aplikasi tidak memiliki kotak surat, kode panggilan layanan dan struktur data yang terkait dengan kotak surat tidak akan dimasukkan dalam aplikasi. <br><br>  Kotak surat hanyalah tempat untuk menyimpan data, yang ukurannya cukup untuk menyimpan variabel jenis <b>ADDR</b> dan akses aman yang dikontrol sedemikian rupa sehingga beberapa tugas dapat menggunakannya.  Suatu tugas dapat mengirim data ke kotak surat.  Akibatnya, kotak surat akan penuh, dan tidak ada tugas yang dapat mengirim data ke sana sampai tugas melakukan operasi membaca kotak surat atau sampai kotak surat kosong.  Mencoba mengirim data ke kotak surat lengkap atau mencoba membaca kotak surat kosong akan menghasilkan kesalahan atau jeda tugas, tergantung pada pengaturan panggilan API yang dipilih dan konfigurasi Nucleus SE. <br><br><h2>  Kotak surat dan Antrian </h2><br>  Dalam beberapa implementasi OS, kotak surat tidak diimplementasikan, tetapi sebagai alternatif, diusulkan untuk menggunakan antrian.  Ini terdengar logis, karena antrian seperti itu akan menyediakan fungsi yang sama dengan kotak surat.  Namun, antrian adalah struktur data yang lebih kompleks dan membawa lebih banyak data tambahan, kode dan memiliki waktu layanan yang lebih lama. <br><br>  Dalam Nucleus SE, seperti pada Nucleus RTOS, Anda dapat memilih salah satu dari jenis objek ini. <br>  Jika aplikasi Anda memiliki beberapa antrian dan satu kotak surat, maka masuk akal untuk mempertimbangkan mengganti kotak surat dengan antrian.  Ini akan sedikit meningkatkan jumlah overhead, tetapi akan menghilangkan semua kode API yang terkait dengan kotak surat.  Atau, Anda dapat mengkonfigurasi aplikasi dengan kedua metode dan membandingkan jumlah data dan kinerja. <br><br>  Antrian akan dibahas dalam artikel mendatang. <br><br><h2>  Konfigurasikan Kotak Surat </h2><br><h3>  Jumlah Kotak Surat </h3><br>  Seperti kebanyakan objek Nucleus SE, konfigurasi kotak surat terutama ditentukan oleh arahan <b>#define</b> dalam file <b>nuse_config.h</b> .  Parameter utama adalah <b>NUSE_MAILBOX_NUMBER</b> , yang menentukan jumlah kotak surat dalam aplikasi.  Nilai default adalah nol (yaitu, tidak ada kotak surat) dan dapat mengambil nilai hingga 16. Nilai yang salah akan menyebabkan kesalahan selama kompilasi, yang akan dihasilkan dengan memeriksa <b>nuse_config_check.h</b> (ini termasuk dalam file <b>nuse_config.c</b> dan dikompilasi dengan itu ), yang akan memicu arahan <b>#error</b> . <br><br>  Memilih nilai bukan nol adalah aktivator utama untuk kotak surat.  Parameter ini digunakan ketika mendefinisikan struktur data dan ukurannya tergantung pada nilainya (lebih lanjut tentang ini di artikel berikutnya).  Selain itu, nilai bukan nol mengaktifkan pengaturan API. <br><br><h3>  Aktifkan Panggilan API </h3><br>  Setiap fungsi API (panggilan utilitas) di Nucleus SE diaktifkan oleh arahan <b>#define</b> dalam file <b>nuse_config.h</b> .  Untuk kotak surat, arahan ini adalah: <br><br><pre><code class="plaintext hljs">NUSE_MAILBOX_SEND NUSE_MAILBOX_RECEIVE NUSE_MAILBOX_RESET NUSE_MAILBOX_INFORMATION NUSE_MAILBOX_COUNT</code> </pre> <br>  Secara default, mereka diatur ke <b>FALSE</b> , sehingga menonaktifkan semua panggilan layanan dan memblokir masuknya kode yang mengimplementasikannya.  Untuk mengonfigurasi kotak surat di aplikasi, Anda harus memilih panggilan API yang diperlukan dan mengaturnya ke <b>TRUE</b> . <br><br>  Berikut ini adalah bagian kode dari file <b>nuse_config.h</b> . <br><br><pre> <code class="plaintext hljs">/* Number of mailboxes in the system - 0-16 */ #define NUSE_MAILBOX_NUMBER 0 /* Service call enablers: */ #define NUSE_MAILBOX_SEND FALSE #define NUSE_MAILBOX_RECEIVE FALSE #define NUSE_MAILBOX_RESET FALSE #define NUSE_MAILBOX_INFORMATION FALSE #define NUSE_MAILBOX_COUNT FALSE</code> </pre><br>  Jika fungsi API kotak surat diaktifkan dan tidak ada kotak surat di aplikasi (kecuali untuk <b>NUSE_Mailbox_Count ()</b> , yang selalu diaktifkan), kesalahan kompilasi terjadi.  Jika kode Anda menggunakan panggilan API yang belum diaktifkan, kesalahan tata letak akan terjadi karena kode implementasi tidak termasuk dalam aplikasi. <br><br><h2>  Panggilan layanan kotak surat </h2><br>  Nucleus RTOS mendukung sembilan panggilan layanan yang dikaitkan dengan kotak surat dan menyediakan fungsionalitas berikut: <br><br><ul><li>  Mengirim pesan ke kotak surat.  Nucleus SE diimplementasikan dalam fungsi <b>NUSE_Mailbox_Send ()</b> . </li><li>  Membaca pesan dari kotak surat.  Nucleus SE mengimplementasikan fungsi <b>NUSE_Mailbox_Receive ()</b> . </li><li>  Mengembalikan kotak surat ke status yang tidak digunakan dengan melepaskan semua tugas yang ditangguhkan (reset).  Di Nucleus SE, diterapkan di <b>NUSE_Mailbox_Reset ()</b> . </li><li>  Memberikan informasi tentang kotak surat tertentu.  Nucleus SE diimplementasikan dalam <b>NUSE_Mailbox_Information ()</b> . </li><li>  Mengembalikan jumlah kotak surat yang saat ini dikonfigurasi dalam aplikasi.  Di Nucleus SE, diterapkan di <b>NUSE_Mailbox_Count ()</b> . </li><li>  Menambahkan kotak surat baru (pembuatan).  Nucleus SE tidak diimplementasikan. </li><li>  Hapus kotak surat.  Nucleus SE tidak diimplementasikan. </li><li>  Kembalikan pointer ke semua kotak surat di aplikasi.  Nucleus SE tidak diimplementasikan. </li><li>  Mengirim pesan ke semua tugas yang ditangguhkan di kotak surat (disiarkan).  Nucleus SE tidak diimplementasikan. </li></ul><br>  Pertimbangkan secara rinci implementasi dari setiap panggilan layanan. <br><br><h2>  Kotak Surat Baca dan Tulis Panggilan Layanan </h2><br>  Operasi dasar yang dapat dilakukan pada kotak surat adalah menulis dan membaca data (mengirim dan menerima).  Nucleus RTOS dan Nucleus SE menyediakan dua panggilan API dasar untuk operasi ini, yang akan dijelaskan di bawah ini. <br><br><h3>  Menulis ke Kotak Surat </h3><br>  Memanggil Nucleus RTOS API untuk menulis ke kotak surat sangat fleksibel, yang memungkinkan Anda untuk menjeda tugas secara implisit atau dengan batas waktu jika operasi tidak dapat diselesaikan dengan segera (misalnya, ketika mencoba menulis ke kotak surat lengkap).  Nucleus SE menyediakan panggilan layanan serupa, hanya jeda tugas yang opsional, dan batas waktu tidak diterapkan. <br><br>  Nucleus RTOS juga menawarkan panggilan layanan untuk menyiarkan data ke kotak surat, panggilan ini tidak didukung di Nucleus SE dan akan dijelaskan di bagian "Panggilan API yang belum direalisasi" di artikel berikutnya. <br><br>  <b><i>Panggilan untuk menulis ke kotak surat di Nucleus RTOS</i></b> <br>  Prototipe panggilan layanan: <br>  <b>STATUS NU_Send_To_Mailbox (NU_MAILBOX * kotak surat, pesan VOID *, penangguhan yang tidak ditandatangani);</b> <br><br>  Parameter: <br>  <b>kotak surat</b> - penunjuk ke kotak surat; <br>  <b>message</b> - sebuah pointer ke pesan yang akan dikirim, terdiri dari empat elemen bertipe <b>unsigned</b> ; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NU_NO_SUSPEND</b> , <b>NU_SUSPEND</b> atau nilai batas waktu. <br><br>  Nilai pengembalian: <br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_MAILBOX</b> - pointer kotak surat tidak valid; <br>  <b>NU_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NU_INVALID_SUSPEND</b> - upaya untuk menangguhkan dari utas yang tidak terkait tugas; <br>  <b>NU_MAILBOX_FULL</b> - kotak surat penuh, tetapi jenis penangguhan tidak ditentukan; <br>  <b>NU_TIMEOUT</b> - kotak surat masih penuh, bahkan setelah penangguhan untuk periode yang ditentukan; <br>  <b>NU_MAILBOX_DELETED</b> - kotak surat dihapus saat tugas ditangguhkan; <br>  <b>NU_MAILBOX_WAS_RESET</b> - kotak surat diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Panggilan untuk menulis ke kotak surat di Nucleus SE</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br>  <b>STATUS NUSE_Mailbox_Send (NUSE_MAILBOX kotak surat, pesan ADDR *, U8 ditangguhkan);</b> <br><br>  Parameter: <br>  <b>kotak surat</b> - indeks <b>kotak surat</b> (ID); <br>  <b>message</b> - pointer ke pesan yang akan dikirim; itu adalah salah satu variabel dari jenis <b>ADDR</b> ; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NUSE_NO_SUSPEND</b> atau <b>NUSE_SUSPEND</b> . <br><br>  Nilai pengembalian: <br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_MAILBOX</b> - indeks kotak surat tidak valid; <br>  <b>NUSE_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NUSE_INVALID_SUSPEND</b> - upaya untuk menangguhkan dari utas yang tidak terkait atau ketika fungsionalitas pemblokiran panggilan API dinonaktifkan; <br>  <b>NUSE_MAILBOX_FULL</b> - kotak surat penuh, tetapi jenis penangguhan tidak ditentukan; <br>  <b>NUSE_MAILBOX_WAS_RESET</b> - kotak surat direset saat tugas ditangguhkan. <br><br>  <b><i>Menerapkan Entri Kotak Pesan di Nucleus SE</i></b> <br>  Versi kode fungsi API <b>NUSE_Mailbox_Send ()</b> (setelah memeriksa parameter) dipilih menggunakan kompilasi bersyarat, tergantung pada apakah dukungan untuk panggilan API diaktifkan untuk memblokir (menangguhkan tugas) atau tidak.  Pertimbangkan kedua opsi tersebut. <br><br>  Jika penguncian tugas dinonaktifkan, logika untuk panggilan API ini cukup sederhana, dan kode tidak memerlukan penjelasan: <br><br><pre> <code class="plaintext hljs">if (NUSE_Mailbox_Status[mailbox]) /* mailbox full */ { return_value = NUSE_MAILBOX_FULL; } else /* mailbox empty */ { NUSE_Mailbox_Data[mailbox] = *message; NUSE_Mailbox_Status[mailbox] = TRUE; return_value = NUSE_SUCCESS; }</code> </pre><br>  Pesan disimpan dalam elemen yang sesuai <b>NUSE_Mailbox_Data []</b> , dan kotak surat ditandai sebagai digunakan. <br><br>  Jika penguncian tugas diaktifkan, kode menjadi lebih kompleks: <br><br><pre> <code class="plaintext hljs">do { if (!NUSE_Mailbox_Status[mailbox]) /* mailbox empty */ { NUSE_Mailbox_Data[mailbox] = *message; NUSE_Mailbox_Status[mailbox] = TRUE; if (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; /* check whether a task is blocked */ /* on this mailbox */ NUSE_Mailbox_Blocking_Count[mailbox]--; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { NUSE_Task_Blocking_Return[index] = NUSE_SUCCESS; NUSE_Wake_Task(index); break; } } } return_value = NUSE_SUCCESS; suspend = NUSE_NO_SUSPEND; } else /* mailbox full */ { if (suspend == NUSE_NO_SUSPEND) { return_value = NUSE_MAILBOX_FULL; } else { /* block task */ NUSE_Mailbox_Blocking_Count[mailbox]++; NUSE_Suspend_Task(NUSE_Task_Active, (mailbox &lt;&lt; 4) | NUSE_MAILBOX_SUSPEND); return_value = NUSE_Task_Blocking_Return[NUSE_Task_Active]; if (return_value != NUSE_SUCCESS) { suspend = NUSE_NO_SUSPEND; } } } } while (suspend == NUSE_SUSPEND);</code> </pre><br>  Beberapa penjelasan mungkin bermanfaat. <br><br>  Kode terlampir dalam <b>loop do ... while</b> , yang berjalan saat parameter <b>menangguhkan</b> adalah <b>NUSE_SUSPEND</b> . <br><br>  Jika kotak surat kosong, pesan dicatat, dan status kotak surat berubah untuk menunjukkan bahwa sudah penuh.  Memeriksa tugas yang dijeda (yang menunggu untuk dibaca) di kotak surat ini.  Jika ada tugas seperti itu, yang pertama dilanjutkan.  Variabel penangguhan diatur ke <b>NUSE_NO_SUSPEND</b> , dan panggilan API berakhir dan mengembalikan <b>NUSE_SUCCESS</b> . <br><br>  Jika kotak surat penuh dan ditangguhkan adalah <b>NUSE_NO_SUSPEND</b> , panggilan API akan mengembalikan <b>NUSE_MAILBOX_FULL</b> .  Jika penangguhan adalah <b>NUSE_SUSPEND</b> , tugas akan dijeda.  Setelah fungsi selesai (misalnya, ketika tugas dilanjutkan), jika nilai kembali <b>NUSE_SUCCESS</b> (yang menunjukkan bahwa tugas dilanjutkan karena pesan sudah dibaca, dan bukan bahwa kotak surat diatur ulang), siklus dimulai dari awal. <br><br><h3>  Baca kotak surat </h3><br>  Panggilan utilitas Nucleus RTOS API untuk membaca kotak surat sangat fleksibel dan memungkinkan Anda untuk menjeda tugas secara implisit atau dengan batas waktu jika operasi tidak dapat diselesaikan segera (misalnya, ketika membaca dari kotak surat kosong).  Nucleus SE menyediakan layanan serupa, hanya penangguhan tugas opsional, dan batas waktu tidak diterapkan. <br><br>  <b><i>Panggilan untuk membaca kotak surat di Nucleus RTOS</i></b> <br>  Prototipe panggilan layanan: <br>  <b>STATUS NU_Receive_From_Mailbox (NU_MAILBOX * kotak surat, pesan VOID *, penangguhan yang tidak ditandatangani);</b> <br><br>  Parameter: <br>  <b>kotak surat</b> - penunjuk ke unit kontrol kotak surat yang disediakan oleh pengguna; <br>  <b>message</b> - pointer ke penyimpanan untuk pesan yang diterima, yang memiliki ukuran sama dengan empat variabel tipe <b>unsigned</b> ; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NUSE_NO_SUSPEND</b> , <b>NUSE_SUSPEND</b> atau nilai batas waktu. <br><br>  Nilai pengembalian: <br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_MAILBOX</b> - pointer kotak surat tidak valid; <br>  <b>NU_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NU_INVALID_SUSPEND</b> - upaya untuk menangguhkan dari aliran yang salah (tidak terkait dengan tugas aliran); <br>  <b>NU_MAILBOX_EMPTY</b> - kotak surat kosong, dan jenis penangguhan tidak ditentukan; <br>  <b>NU_TIMEOUT</b> - kotak surat masih kosong, bahkan setelah tugas dijeda untuk nilai batas waktu yang ditentukan; <br>  <b>NU_MAILBOX_DELETED</b> - kotak surat dihapus saat tugas ditangguhkan; <br>  <b>NU_MAILBOX_WAS_RESET</b> - kotak surat diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Panggilan untuk membaca kotak surat di Nucleus SE</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br>  <b>STATUS NUSE_Mailbox_Receive (NUSE_MAILBOX kotak surat, pesan ADDR *, U8 ditangguhkan);</b> <br><br>  Parameter: <br>  <b>kotak surat</b> - indeks <b>kotak surat</b> (ID); <br>  <b>message</b> - pointer ke penyimpanan pesan yang diterima, adalah salah satu variabel dari tipe <b>ADDR</b> ; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NUSE_NO_SUSPEND</b> atau <b>NUSE_SUSPEND</b> . <br><br>  Nilai pengembalian: <br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_MAILBOX</b> - indeks kotak surat tidak valid; <br>  <b>NUSE_INDALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NUSE_INVALID_SUSPEND</b> - upaya untuk menangguhkan dari aliran yang salah atau ketika panggilan API dinonaktifkan untuk memblokir tugas; <br>  <b>NUSE_MAILBOX_EMPTY</b> - kotak surat kosong, dan jenis penangguhan tugas tidak ditentukan; <br>  <b>NUSE_MAILBOX_WAS_RESET</b> - kotak surat direset saat tugas ditangguhkan. <br><br>  <b><i>Menerapkan Pembaca Kotak Pesan di Nucleus SE</i></b> <br>  Versi kode fungsi API <b>NUSE_Mailbox_Receive ()</b> (setelah memeriksa parameter) dipilih menggunakan kompilasi bersyarat, tergantung pada apakah panggilan API diaktifkan untuk memblokir (menunda tugas) atau tidak.  Kami akan mempertimbangkan kedua opsi tersebut. <br><br>  Jika penguncian tugas dinonaktifkan, logika untuk panggilan API ini cukup sederhana, dan kode tidak memerlukan penjelasan: <br><br><pre> <code class="plaintext hljs">if (!NUSE_Mailbox_Status[mailbox]) /* mailbox empty */ { return_value = NUSE_MAILBOX_EMPTY; } else { /* mailbox full */ *message = NUSE_Mailbox_Data[mailbox]; NUSE_Mailbox_Status[mailbox] = FALSE; return_value = NUSE_SUCCESS; }</code> </pre><br>  Pesan dibaca dari elemen <b>NUSE_Mailbox_Data [] yang</b> sesuai, dan kotak surat ditandai sebagai kosong. <br><br>  Jika penguncian tugas diaktifkan, kode menjadi lebih kompleks: <br><br><pre> <code class="plaintext hljs">do { if (NUSE_Mailbox_Status[mailbox]) /* mailbox full */ { *message = NUSE_Mailbox_Data[mailbox]; NUSE_Mailbox_Status[mailbox] = FALSE; if (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; /* check whether a task is blocked */ /* on this mailbox */ NUSE_Mailbox_Blocking_Count[mailbox]--; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { NUSE_Task_Blocking_Return[index] = NUSE_SUCCESS; NUSE_Wake_Task(index); break; } } } return_value = NUSE_SUCCESS; suspend = NUSE_NO_SUSPEND; } else /* mailbox empty */ { if (suspend == NUSE_NO_SUSPEND) { return_value = NUSE_MAILBOX_EMPTY; } else { /* block task */ NUSE_Mailbox_Blocking_Count[mailbox]++; NUSE_Suspend_Task(NUSE_Task_Active, (mailbox &lt;&lt; 4) | NUSE_MAILBOX_SUSPEND); return_value = NUSE_Task_Blocking_Return[NUSE_Task_Active]; if (return_value != NUSE_SUCCESS) { suspend = NUSE_NO_SUSPEND; } } } } while (suspend == NUSE_SUSPEND);</code> </pre><br>  Beberapa klarifikasi mungkin bermanfaat. <br><br>  Kode terlampir dalam <b>loop do ... while</b> , yang berjalan saat parameter <b>menangguhkan</b> adalah <b>NUSE_SUSPEND</b> . <br><br>  Jika kotak surat penuh, pesan yang disimpan dikembalikan, dan status kotak surat berubah untuk menunjukkan bahwa itu kosong.  Memeriksa tugas yang dijeda (yang menunggu untuk direkam) di kotak surat ini.  Jika ada tugas seperti itu, yang pertama dilanjutkan.  Variabel penangguhan diatur ke <b>NUSE_NO_SUSPEND</b> , dan panggilan API berakhir dan mengembalikan <b>NUSE_SUCCESS</b> . <br><br>  Jika kotak surat kosong dan parameter <b>penangguhan</b> adalah <b>NUSE_NO_SUSPEND</b> , panggilan API mengembalikan <b>NUSE_MAILBOX_EMPTY</b> .  Jika penangguhan adalah <b>NUSE_SUSPEND</b> , tugas akan dijeda.  Jika, pada akhir panggilan, nilai kembali adalah <b>NUSE_SUCCESS</b> , yang menunjukkan bahwa tugas dilanjutkan karena pesan dikirim (dan bukan bahwa kotak surat diatur ulang), siklus dimulai dari awal. <br><br>  Artikel berikut akan melihat panggilan API tambahan yang terkait dengan kotak surat, serta struktur data yang sesuai. <br><br>  <b>Tentang Pengarang:</b> Colin Walls telah bekerja di industri elektronik selama lebih dari tiga puluh tahun, mencurahkan sebagian besar waktunya untuk firmware.  Dia sekarang adalah seorang insinyur firmware di Mentor Embedded (sebuah divisi dari Mentor Graphics).  Colin Walls sering berbicara di konferensi dan seminar, penulis berbagai artikel teknis dan dua buku tentang firmware.  Tinggal di Inggris.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Blog</a> profesional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Colin</a> , email: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id430856/">https://habr.com/ru/post/id430856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id430844/index.html">Bagaimana memilih baterai untuk UPS</a></li>
<li><a href="../id430846/index.html">Apa yang baru: detail tentang implementasi arsitektur Zen 2 baru mulai dikenal</a></li>
<li><a href="../id430850/index.html">Apple Metal di MAPS.ME</a></li>
<li><a href="../id430852/index.html">Konsistensi dan jaminan ACID dalam sistem penyimpanan terdistribusi</a></li>
<li><a href="../id430854/index.html">"JS menjadi lebih dewasa": sebuah wawancara dengan komite program HolyJS 2018 Moskow</a></li>
<li><a href="../id430860/index.html">Unduh, simpan, dan lihat PDF dalam Swift</a></li>
<li><a href="../id430862/index.html">"Monster dalam game - cara membuat pemain membencimu"</a></li>
<li><a href="../id430864/index.html">Cocok bukan mainan?</a></li>
<li><a href="../id430866/index.html">Beijing akan memperkenalkan peringkat sosial bagi penduduk pada tahun 2020</a></li>
<li><a href="../id430868/index.html">Apa yang harus diingat saat membeli NGFW? Periksa daftar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>