<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐊 👩🏾‍🔬 🎱 MVP und Dolch 2 - Android Application Skeleton - Teil 2 🤰 🥜 🗼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel ist das Ergebnis von Recherchen, deren Nebenprodukt die Verkörperung einer langjährigen Idee in einer sehr nützlichen und einmal fehlen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MVP und Dolch 2 - Android Application Skeleton - Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434618/">  <i>Dieser Artikel ist das Ergebnis von Recherchen, deren Nebenprodukt die Verkörperung einer langjährigen Idee in einer sehr nützlichen und einmal fehlenden Android-Anwendung war - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">My Location Notifier</a> , mit der der Empfänger automatisch über die Ankunft eines Benutzers benachrichtigt werden soll (siehe detaillierte Beschreibung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ).</i> <br><br>  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten Teil haben</a> wir das Hauptskelett der Android-Anwendung gemäß der MVP-Architektur erstellt.  Jetzt fangen wir an, Dolch 2 daran zu schrauben. <br><a name="habracut"></a><br>  <b>2.1.</b>  <b>Voreinstellung</b> <br><br>  Wechseln Sie zunächst zur Datei build.gradle (Projekt: mymvcapp) und fügen Sie dem Buildscript-Abschnitt die folgende Zeile hinzu: <br><br><pre><code class="plaintext hljs">ext.dagger2_version = "2.8"</code> </pre> <br>  Zum Zeitpunkt dieses Schreibens ist dies die neueste Version von Dagger 2. Wechseln Sie als Nächstes zur Datei build.gradle (Modul: App) und fügen Sie die Zeile am Anfang hinzu: <br><br><pre> <code class="plaintext hljs">apply plugin: 'kotlin-kapt'</code> </pre> <br>  Dies ist notwendig, damit in Dolch 2 der Code beim Kompilieren generiert werden kann.  Später wirst du verstehen warum. <br><br>  Fügen Sie nun die erforderlichen Abhängigkeiten hinzu: <br><br><pre> <code class="plaintext hljs">implementation "com.google.dagger:dagger:$dagger2_version" kapt "com.google.dagger:dagger-compiler:$dagger2_version"</code> </pre><br>  <b>2.2.</b>  <b>Injektionsvorbereitung</b> <br><br>  Wir werden das Projekt synchronisieren und zur MainScreen-Komponente zurückkehren.  Erstellen Sie eine Klasse di.MainScreenModule im Backstage-Paket und markieren Sie sie mit der Modulanmerkung.  In der neuen Klasse deklarieren und implementieren wir die Methode adsPresenter (): MainScreenPresenter = MainScreenPresenter und markieren sie mit Annotationen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Provides</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Singleton</a> .  Nun wird unsere Klasse aussehen: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainScreenModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">providesPresenter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: MainScreenPresenter = MainScreenPresenter() }</code> </pre> <br>  Jetzt gehen wir zur MainScreenCompatActivity-Klasse und ersetzen die Modifikatoren der Presenter-Variablen durch lateinit var, löschen die Wertzuweisung und markieren sie mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Inject-</a> Annotation: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainScreen</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseCompatActivity</span></span></span></span>(), MainScreenContract.View { <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> presenter: MainScreenPresenter <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { setContentView(R.layout.activity_main_screen) presenter.attach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } }</code> </pre> <br>  Beachten Sie, dass wir jetzt beim Zugriff auf diese Variable kein Fragezeichen mehr benötigen. <br>  Es scheint, dass alles eingespritzt ist, die Aufgabe ist erledigt.  Aber nein.  Jetzt müssen wir Dagger dazu bringen, den notwendigen Code zu generieren, um unsere erste Abhängigkeit einzufügen.  Aus diesem Grund haben wir das Kotlin-Kapt-Plugin zum obigen Build-Skript hinzugefügt.  Erstellen Sie im Paket com.caesar84mx.mymvcapp das Paket di.config, in dem wir die AppDiComponent-Schnittstelle erstellen. <br><br><img src="https://habrastorage.org/webt/s8/ut/ni/s8utnixqihc3od6o0nv2qtum4wc.png"><br><br>  Jetzt deklarieren wir die Schnittstelle als Komponente und als Singleton <s>und als miserabel</s> , registrieren unser Modul darin und deklarieren die Inject-Methode (mainScreenActivity: MainScreen) innerhalb der Schnittstelle: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Component( modules = [ MainScreenModule::class ] )</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDiComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mainScreenActivity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MainScreen</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre> <br>  Und jetzt müssen Sie Dagger endlich dazu bringen, den gesamten erforderlichen Code zu generieren.  Dazu erstellen wir die MyMvpApp-Klasse im config.di-Paket, erben sie von der Application-Klasse und registrieren die Klasse in AndroidManifest.xml, indem wir die Zeile android: name = ". Config.di.MyMvpApp" in das Application-Tag schreiben.  Deklarieren Sie als Nächstes die Variable lateinit var injor: AppDiComponent, setzen Sie sie auf einen privaten Setter und definieren Sie die onCreate () -Methode neu.  Und starte die Magie: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyMvpApp</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> injector: AppDiComponent <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate() injector = DaggerAppDiComponent.builder() .mainScreenModule(MainScreenModule()) .build() } }</code> </pre> <br>  Wie Sie sehen können, ist die DaggerAppDiComponent-Klasse noch nicht vorhanden. Sie wird beim Erstellen der Anwendung generiert.  Sowie die Implementierung unserer Komponente.  Der Klassenname besteht aus dem Wort „Dolch“ + dem Namen der als Komponente gekennzeichneten Schnittstelle.  Die mainScreenModule () -Methode wird auch während der Erstellung des Projekts generiert. Der Name muss aus dem Klassennamen des injizierten Moduls in lowerCamelCase kompiliert werden. <br><br>  Wir bauen das Projekt zusammen (Build → Make Project).  Genießen Sie die automatische Codegenerierung und fahren Sie fort. <br><br>  <b>2.3.</b>  <b>Injektion</b> <br><br>  Achtung: Außerdem werden einige Tänze mit einem Tamburin mit Elementen des Pornos präsentiert.  Die Aufforderung, Kinder und nervöse Personen vom Bildschirm zu entfernen. <br><br>  Für erfolgreiche Injektionen benötigen wir einen Verweis auf die Injektorvariable.  Stimmen Sie zu, dass das Erstellen einer Instanz von MyMvpApp in jeder Klasse, in die wir injizieren, nicht die beste Lösung ist.  Daher werden wir Folgendes tun: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyMvpApp</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> injector: AppDiComponent <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate() INSTANCE = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> injector = DaggerAppDiComponent.builder() .mainScreenModule(MainScreenModule()) .build() } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> INSTANCE: MyMvpApp? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JvmStatic</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: MyMvpApp = INSTANCE!! } }</code> </pre> <br>  Ausgeatmet, kehrte zur MainScreen-Klasse zurück.  Fügen Sie nun unseren Präsentator in die init () -Methode ein.  Vergessen Sie nicht, dass diese Aktion vor dem ersten Zugriff auf die injizierte Variable ausgeführt werden muss.  Jetzt sieht unsere Klasse so aus: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainScreen</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseCompatActivity</span></span></span></span>(), MainScreenContract.View { <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> presenter: MainScreenPresenter <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { setContentView(R.layout.activity_main_screen) MyMvpApp.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>().injector.inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) presenter.attach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } }</code> </pre> <br>  Und hier ist die gesamte Grundstruktur unserer Anwendung: <br><br><img src="https://habrastorage.org/webt/bj/1g/9o/bj1g9opl1df6e_usfezbnv4ep6c.png"><br><br>  <b>2.4.</b>  <b>Fazit</b> <br><br>  Wir sind also bereit für die minimale Struktur der Anwendung, an der nur die Elemente hängen bleiben.  Benötigen Sie eine neue Aktivität?  Wir stellen es als eine Komponente dar, die die Benutzeroberfläche von Backstage trennt. Für jede Komponente bestimmen wir, welche Abhängigkeiten wir benötigen (Minimum, Präsentator in Aktivität oder möglicherweise in der Präsentator-API selbst für die Interaktion mit einem Remotedienst oder beispielsweise eine Repository-API für die Arbeit mit einer Datenbank). Registrieren Sie das Modul mit Abhängigkeiten, registrieren Sie das Modul in der Komponente, registrieren Sie sich im Builder, erstellen Sie das Projekt neu, fügen Sie bei Bedarf Abhängigkeiten ein und wiederholen Sie die Iteration für jede neue Komponente. <br><br>  Natürlich kann sich die Frage stellen: Warum brauchen wir Dolch?  Immerhin haben sie hervorragende Arbeit geleistet, oder?  Großartig, während die Anwendung klein ist.  Wenn es mit Dutzenden von Aktivitäten, Fragmenten, Adaptern, Serveranforderungen, Daten-Caching und anderen Wundern voll wird, gibt es viele Abhängigkeiten, die in einer großen Anwendung schwer zu verfolgen sind, wenn Sie Dependency Injection nicht verwenden.  Das Dagger DI-Framework vereinfacht die Implementierung und Nachverfolgung. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de434618/">https://habr.com/ru/post/de434618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de434594/index.html">Warum stiehlt Windows XP 2019 immer noch oder CTOD?</a></li>
<li><a href="../de434598/index.html">Ein Blick in die Zukunft oder welche Veränderungen im Bergbau bis 2050 kommen</a></li>
<li><a href="../de434602/index.html">Wie Google versuchte, China zu erobern - und verlor</a></li>
<li><a href="../de434604/index.html">Wie schreibe ich keine Vorlagen für Bootstrap?</a></li>
<li><a href="../de434616/index.html">Sowjetisches HI-FI und seine Schöpfer: Digitale Tonaufnahme in der UdSSR - ein Schritt vom Sieg entfernt</a></li>
<li><a href="../de434620/index.html">Erstellen Sie einen stilvollen Wasserfall aus RiME direkt in Unity oder UE4</a></li>
<li><a href="../de434622/index.html">Welche Welten können nach dem Tod der Sonne überleben?</a></li>
<li><a href="../de434624/index.html">Wie ich einen Fehler in GNU Tar gefunden habe</a></li>
<li><a href="../de434626/index.html">Neuer Buhtrap Downloader</a></li>
<li><a href="../de434628/index.html">bitContainer (für Lebensmittel) - hausgemachte Yandex.Station</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>