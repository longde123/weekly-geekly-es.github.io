<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé© üíå üéÖüèø Tutorial de DataPower üë®‚Äçüîß ü¶ñ ü§°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Material en coautor√≠a de wedmeed 


 En 2017, cuando nuestro proyecto comenz√≥ en Vietnam, nos encontramos con la nueva bestia IBM DataPower. IBM DataP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tutorial de DataPower</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neoflex/blog/442686/"><p>  Material en coautor√≠a de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">wedmeed</a> </p><br><p> En 2017, cuando nuestro proyecto comenz√≥ en Vietnam, nos encontramos con la nueva bestia IBM DataPower.  IBM DataPower es un producto de puerta de enlace entre clientes y backends dise√±ado para filtrar, enrutar, enriquecer u otras transformaciones de mensajes que lo atraviesan (en lo sucesivo, las solicitudes).  Era necesario aprender r√°pidamente, no hab√≠a tiempo para la acumulaci√≥n, por lo que nos invitaron a familiarizarnos con √©l, despu√©s de lo cual hubo muchas horas de conferencia de Skype con nuestro colega de Mosc√∫, quien nos transmiti√≥ su conocimiento y experiencia con este producto. <br></p><br><p>  El autoestudio se bas√≥ en estudiar la documentaci√≥n y mirar videos de capacitaci√≥n de Internet, y aqu√≠ estaba esperando una captura.  Pr√°cticamente no pude encontrar informaci√≥n en ruso.  Por cierto, mi conocimiento del idioma ingl√©s en ese momento no estaba en el nivel m√°s alto, adem√°s fue mi primer proyecto y, probablemente, estos factores complicaron mi vida.  Esto me hizo escribir un art√≠culo de capacitaci√≥n en ruso y de la manera m√°s simple posible para los desarrolladores principiantes que encontraron este producto y est√°n tratando de comprender r√°pidamente sus conceptos b√°sicos.  El art√≠culo no lo liberar√° de leer la documentaci√≥n, pero facilitar√° la vida en las primeras etapas de comprensi√≥n de "c√≥mo funciona". <br></p><br><p>  Tambi√©n vale la pena se√±alar que la estructura dada en la pr√°ctica estar√° cerca del proyecto real, lo que le permitir√° usarlo como base, expandiendo y complementando sus requisitos.  En conclusi√≥n, se dar√°n algunas palabras sobre el proyecto ya implementado, as√≠ como algunas caracter√≠sticas a las que vale la pena prestar atenci√≥n, en las secciones de Teor√≠a. </p><br><img src="https://habrastorage.org/webt/rm/at/lk/rmatlkcfuvcjxvgireijushp7yc.jpeg"><br><a name="habracut"></a><br><h2>  Parte 1. Instalaci√≥n de DataPower con Docker Toolbox </h2><br><p>  Instala y ejecuta la aplicaci√≥n Docker Toolbox.  Inmediatamente despu√©s de comenzar, ver√° la direcci√≥n IP de la m√°quina, a trav√©s de la cual DataPower estar√° disponible en el futuro: <br></p><br><img src="https://habrastorage.org/webt/zs/qa/wn/zsqawn2jksqp8j8gfl5gwslnks4.png"><br><br><p>  Para iniciar la imagen, debe cambiar algunas configuraciones de la m√°quina virtual (relevante para la versi√≥n IDG.2018.4.1.0) y reiniciarla: <br></p><br><ol><li>  Detenga la m√°quina acoplable con el comando: <br><br><pre><code class="plaintext hljs">docker-machine stop</code> </pre> </li><li>  Sistema -&gt; Placa base -&gt; Memoria principal: m√≠nimo 4096Mb; <br></li><li>  Sistema -&gt; Procesador: m√≠nimo 2; <br></li><li>  Pantalla -&gt; Pantalla -&gt; Memoria de video: al menos 128Mb; <br></li><li>  Lanzamos la m√°quina acoplable con el comando: <br><br><pre> <code class="plaintext hljs">docker-machine start</code> </pre> <br>  <i>Nota</i>  <i>Si se le solicita que reinicie la m√°quina docker env, ejecute:</i> <br><br><pre> <code class="plaintext hljs">docker-machine env</code> </pre> </li><li>  A continuaci√≥n, debe desinflar la imagen de IBM DataPower: <br><br><pre> <code class="plaintext hljs">docker pull ibmcom/datapower</code> </pre> </li><li>  Luego, inicie el contenedor docker con el siguiente comando: <br><br><pre> <code class="plaintext hljs">docker run -it \ -v $PWD/config:/drouter/config \ -v $PWD/local:/drouter/local \ -e DATAPOWER_ACCEPT_LICENSE=true \ -e DATAPOWER_INTERACTIVE=true \ -p 9090:9090 \ -p 3630:3630 \ -p 9022:22 \ -p 7170:7170 \ --name idg \ ibmcom/datapower</code> </pre></li><li>  Despu√©s de completar el comando, presione Entrar e ingrese <b>admin / admin</b> como nombre de usuario y contrase√±a <br></li><li>  Para iniciar la Interfaz de administraci√≥n web, use los comandos: <br><br><pre> <code class="plaintext hljs">co</code> </pre> <br>  y <br><br><pre> <code class="plaintext hljs">web-mgmt 0 9090</code> </pre> </li><li>  Despu√©s de todos estos pasos, ejecute en el navegador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://192.168.99.100:9090/</a> <br></li></ol><br><h2>  Parte 2. Dominios </h2><br><h3>  2.1.  Teor√≠a </h3><br><p>  Los dominios en DataPower le permiten separar las herramientas de administraci√≥n y desarrollo, as√≠ como proporcionar seguridad. <br></p><br><p>  Despu√©s de la instalaci√≥n, solo hay un dominio predeterminado desde el que se pueden crear dominios de aplicaci√≥n.  Cada dominio tiene su propia configuraci√≥n de par√°metros. <br></p><br><p>  Algunos recursos y par√°metros comunes solo se pueden definir en el dominio predeterminado, que incluyen interfaces de red, usuarios y control de acceso, dominios de aplicaci√≥n y otros. <br></p><br><p>  Un dominio de aplicaci√≥n es una secci√≥n de desarrollo para servicios de procesamiento de solicitudes.  Los servicios definidos en √©l no se pueden compartir con otro dominio de aplicaci√≥n.  Los dominios de aplicaci√≥n se pueden reiniciar por separado e independientemente, sin la necesidad de un reinicio completo de DataPower. <br></p><br><p>  Puede crear, reiniciar, restablecer, pausar, renovar o eliminar dominios.  Puede encontrar informaci√≥n m√°s detallada sobre todas las funciones de administraci√≥n en la documentaci√≥n oficial. <br></p><br><p>  Un poco sobre el proyecto completado.  Utilizamos 3 dominios: <br></p><br><ul><li>  default: el dominio predeterminado que contiene recursos y par√°metros compartidos; </li><li>  troncal: el dominio principal que contiene todo lo necesario para procesar solicitudes; </li><li>  configuraci√≥n: configuraci√≥n y dominio de seguridad, los archivos locales contienen informaci√≥n sobre las reglas de enrutamiento del servicio y la configuraci√≥n de seguridad. </li></ul><br><p>  La necesidad de transferir todas las configuraciones a un dominio separado surgi√≥ en relaci√≥n con la b√∫squeda de una ruta de implementaci√≥n m√°s simple.  Como en muchos proyectos, los entornos de desarrollo, prueba y producci√≥n se separaron, y la transferencia a un dominio de configuraci√≥n separado nos permiti√≥ instalar todos los dominios principales del entorno de desarrollo en otros entornos a trav√©s de la exportaci√≥n / importaci√≥n, sin el riesgo de perder la configuraci√≥n del entorno. <br></p><br><h3>  2.2.  Practica </h3><br><ul><li>  En el campo de b√∫squeda, ingrese "dominio", seleccione "Dominio de aplicaci√≥n" y haga clic en "Agregar" <br><img src="https://habrastorage.org/webt/uo/k_/gs/uok_gsaxjifcklt56rs9wmiujhm.png"></li><li>  Aqu√≠ debe especificar el nombre de dominio, comentar (si lo desea) y activar la auditor√≠a y el registro.  Complete los campos y aplique los cambios. <br><img src="https://habrastorage.org/webt/3b/6w/ts/3b6wtsfrlvxcxgb7jgpkmm6u1rq.png"></li><li>  Del mismo modo, agregue otro dominio "troncal" </li><li>  Ir a Revisar cambios <br><img src="https://habrastorage.org/webt/p-/nh/cp/p-nhcpeur45dhrzahmpffom9pq8.png"></li><li>  y guardar la configuraci√≥n del dominio <br><img src="https://habrastorage.org/webt/1u/8n/si/1u8nsi-zblkkqdsrpa7lnqcgw8g.png"></li><li>  Puede verificar el estado de los objetos creados yendo al dominio predeterminado en el √°rbol de navegaci√≥n en Estado -&gt; Principal -&gt; Estado del objeto <br><img src="https://habrastorage.org/webt/uz/qo/q4/uzqoq4kek4qdgkfkhovrjmiridm.png"></li><li>  Elija <b><i>Ver por: tipos</i></b> <br><img src="https://habrastorage.org/webt/fj/5_/6z/fj5_6zg-kidxhkt5as0omzfvsiw.png"></li><li>  Busque el dominio de aplicaci√≥n en la lista y verifique el estado de los objetos: cada uno de ellos debe guardarse, activarse y estar en estado activo.  Si es as√≠, contin√∫e con el pr√≥ximo cap√≠tulo. </li></ul><br><img src="https://habrastorage.org/webt/xa/ii/kj/xaiikjxfdhsy19lez-rxo2xmeug.png"><br><br><h2>  Parte 3. Administradores de colas </h2><br><p>  El gestor de colas no es un componente obligatorio de IBM DataPower, pero es a trav√©s del ejemplo de MQ que puede mostrar toda la potencia de este producto.  Utilizaremos MQ de IBM.  Durante las pruebas descritas en el Cap√≠tulo 6, necesitaremos enviar un mensaje al gestor de colas local.  En este art√≠culo, har√© esto usando la utilidad rfhutil, pero puedes usar cualquier m√©todo disponible para ti.  Para realizar pruebas, deber√° crear una conexi√≥n desde DP a su gestor de colas local utilizando el gestor de colas MQ. </p><br><cut></cut><br><h3>  3.1.  Teor√≠a </h3><br><p>  El gestor de colas proporciona intercambio de datos entre la puerta de enlace y los gestores de colas remotos. </p><br><p>  Tambi√©n puede configurar el Grupo MQ Queue Manager, lo que aumentar√° la tolerancia a fallas del sistema.  Esto puede ser √∫til, por ejemplo, si desea conectar el cliente a cualquiera de los gestores de colas de trabajo y, en algunos casos, lo puede encontrar en la documentaci√≥n oficial. </p><br><p>  Seg√∫n la experiencia del proyecto, solo se debe tener en cuenta una caracter√≠stica: en un momento quer√≠amos intentar implementar el equilibrio de carga utilizando DataPower, en particular, utilizando grupos de gestores de colas, pero en la pr√°ctica no encontramos esa posibilidad.  Una soluci√≥n alternativa es crear un grupo de gestores de colas. </p><br><br><h3>  3.2.  Practica </h3><br><h4>  3.2.1.  Preparaci√≥n </h4><br><ol><li>  Instalar WebSphere MQ; </li><li>  Cree un gestor de colas LOCAL_DP_QM local, accesible en el puerto 3630; </li><li>  Configurar el canal DP.SVRCONN; <br><br><p>  Al crear un canal, los siguientes comandos pueden serle √∫tiles: </p><br><pre> <code class="plaintext hljs">strmqm LOCAL_DP_QM /*  mq*/ runmqsc LOCAL_DP_QM /*   mq*/ DEFINE CHANNEL (DP.SVRCONN) CHLTYPE(SVRCONN) MCAUSER('evlasenko') /* */ SET CHLAUTH('DP.SVRCONN') TYPE(USERMAP) CLNTUSER('evlasenko') USERSRC(channel) ADDRESS('*') ACTION(ADD) /*      */ SET CHLAUTH(DP.SVRCONN) TYPE(BLOCKUSER) USERLIST('nobody') /*   */ ALTER LISTENER (SYSTEM.DEFAULT.LISTENER.TCP) TRPTYPE(TCP) PORT(3630) control(QMGR) /*    3630*/ ALTER AUTHINFO (SYSTEM.DEFAULT.AUTHINFO.IDPWOS) AUTHTYPE(IDPWOS) CHCKCLNT(OPTIONAL) /* */ REFRESH SECURITY TYPE(CONNAUTH) /*  */ endmqm LOCAL_DP_QM /*  mq*/ strmqm LOCAL_DP_QM /*  mq*/ END</code> </pre><br></li><li>  Crear las colas DP.IIB.REQIN y DP.IIB.RESIN </li><li>  Ejecute rfhutil con el nombre del usuario para el que se cre√≥ el canal.  En la l√≠nea Nombre del gestor de colas (para conectarse), escriba: <br><br><pre> <code class="plaintext hljs">DP.SVRCONN/TCT/127.0.0.1(3630)</code> </pre> <br></li><li>  Intente cargar la lista de nombres de la cola; no deber√≠a haber ning√∫n error en la ventana del mensaje.  La conexi√≥n al canal ha sido verificada. <br></li></ol><br><h4>  3.2.2.  Crear IBM MQ Queue Manager </h4><br><ol><li>  Vaya al dominio troncal. </li><li>  En la b√∫squeda, escriba MQ, seleccione IBM MQ Queue Manager y haga clic en Agregar. </li><li>  Debe especificar el nombre (TEST_QM), el nombre de host del gestor de colas, el nombre del gestor de colas y el nombre del canal, as√≠ como el tiempo de espera.  Configurar y guardar los cambios. <br><img src="https://habrastorage.org/webt/di/sg/x1/disgx1dt8szkq9uoicnlepcn9lg.png"><br></li></ol><br><p>  Compruebe el estado del objeto del gestor de colas de forma similar a la comprobaci√≥n del estado de los dominios.  Para hacer esto, seleccione Estado del objeto y el filtro Ver por: tipos del dominio troncal.  En la secci√≥n "IBM MQ Queue Manager", busque el objeto apropiado y verifique su estado. </p><br><h2>  Parte 4. Puertas de enlace multiprotocolo </h2><br><h3>  4.1.  Teor√≠a </h3><br><p>  La puerta de enlace multiprotocolo (MPG) es una puerta de enlace multiprotocolo que le permite recibir solicitudes de clientes que usan varios protocolos y luego transferirlas a diferentes servidores usando varios protocolos.  El protocolo utilizado por el cliente puede no coincidir con el protocolo utilizado por el servidor de acceso remoto. </p><br>  En la configuraci√≥n principal de MPG, puede definir los siguientes componentes: <br><br><ul><li>  Administrador XML: controla la compilaci√≥n y el almacenamiento en cach√© de hojas de estilo (xsl, xslt), el almacenamiento en cach√© de documentos. </li><li>  Pol√≠tica: consta de reglas, cada una de las cuales define un conjunto de acciones aplicadas al mensaje que pasa por la puerta de enlace. </li><li>  Configuraci√≥n de la parte frontal y posterior (configuraci√≥n de URL, tipos de mensajes entrantes y salientes, tiempos de espera y m√°s). </li></ul><br><p>  Algunas palabras sobre el proyecto: </p><br><p>  El proyecto utiliza 4 puertas de enlace multiprotocolo (enrutamiento, 2 transformadoras para diferentes sistemas finales y una adicional dise√±ada para recibir archivos del dominio de configuraci√≥n).  El siguiente diagrama muestra el esquema de interacci√≥n general: </p><br><img src="https://habrastorage.org/webt/p9/ea/yb/p9eayb25jpeoiazqjd0sitssuf4.png"><br><p>  La cantidad de MPG puede variar seg√∫n la arquitectura de la soluci√≥n en su conjunto.  En nuestro caso, DataPower enfrenta un bus de integraci√≥n (IIB) y microservicios, que tienen diferencias significativas en las interfaces (json / http versus xml / mq), por lo que se decidi√≥ hacer MPG transformacionales para cada backend espec√≠fico y nombrarlo en consecuencia.  Para todos los clientes, trabajamos en json / http, por lo que el enrutamiento MPG es uno.  Los MPG principales consisten en 3 reglas para procesar mensajes: solicitud, respuesta y errores.  Cada regla consta de las acciones necesarias, como la transformaci√≥n, el registro, el enrutamiento y otros. </p><br><p>  Desde las caracter√≠sticas: si en la pol√≠tica usa la acci√≥n ConvertQueryParamToXML, est√© atento a InputConversion.  Si configura la codificaci√≥n predeterminada en JSON e intenta enviar una solicitud GET, se sorprender√° al descubrir que el mensaje no ha sufrido ninguna transformaci√≥n que haya especificado y no encontrar√° ning√∫n rastro de √©l.  Esta caracter√≠stica ayudar√° a superar la creaci√≥n de una regla separada para las solicitudes GET. </p><br><h3>  4.2.  Practica </h3><br><h4>  4.2.1  Preparaci√≥n </h4><br><p>  Puede encontrar todos los archivos necesarios para trabajar en el enlace <a href="">https://github.com/EvgenyaVlasenko/IBM_DataPower.git</a> <br></p><h4>  4.2.1.1.  Tronco de dominio </h4><br><ol><li>  Vaya al dominio troncal. </li><li>  En el panel de control, seleccione Administraci√≥n de archivos. </li><li>  En el directorio local, cree la siguiente estructura de directorio y coloque los archivos correspondientes en √©l (cada archivo contiene una breve descripci√≥n de las funciones que realiza, as√≠ como una discusi√≥n m√°s detallada de esto m√°s adelante en el art√≠culo). <br><img src="https://habrastorage.org/webt/oj/am/i9/ojami90qdgg81ojuyr88pmeuzd0.png"><br></li></ol><br><h4>  4.2.1.2.  Configuraciones de dominio </h4><br><ol><li>  Vaya al dominio de configuraci√≥n. </li><li>  En el panel de control, seleccione Administraci√≥n de archivos. </li><li>  En el directorio local, cree la siguiente estructura de directorio y coloque los archivos apropiados en √©l (los archivos tambi√©n contienen una breve descripci√≥n de ellos). <br><img src="https://habrastorage.org/webt/mf/9r/ne/mf9rnemyu8mcb01ad_wi6__ozj0.png"><br></li></ol><br><h3>  4.2.2  Crear GetFileMPG </h3><br><p>  Primero, cree un MPG auxiliar simple que devolver√° archivos del dominio de configuraci√≥n. </p><br><ol><li>  Vaya al dominio de configuraci√≥n. </li><li>  En el panel de control, seleccione Puerta de enlace multiprotocolo y haga clic en Crear. </li><li>  Especifique el nombre (GetFileMPG), la descripci√≥n (opcional) y el tipo de back-end (din√°mico).  De hecho, dado que no habr√° llamadas al backend, y solo el archivo ser√° devuelto desde el sistema local, en este ejemplo puede especificar cualquier tipo de backend. <br><img src="https://habrastorage.org/webt/ds/g7/5g/dsg75gxvgo-7caldbmytubddg6i.png"><br></li><li>  Especifique los tipos de solicitud y respuesta.  Especificar expl√≠citamente los tipos reducir√° el n√∫mero de comprobaciones en l√≠nea.  La especificaci√≥n del tipo Pass through le permite no crear una regla (en este caso, para transformar la respuesta).  Si especificamos que el Tipo de solicitud tambi√©n se transfiere, no podremos procesar el mensaje de ninguna manera.  Esta opci√≥n no nos conviene, por lo que restringimos el tipo de solicitud que utiliza no XML. <br><br><img src="https://habrastorage.org/webt/qx/nx/l_/qxnxl_j3ki9e8hcc215zropuix8.png"><br></li><li>  Haga clic en + y seleccione el controlador HTTP para crear un nuevo protocolo frontal. <br><br><img src="https://habrastorage.org/webt/dc/gq/pq/dcgqpqgpx284pxkoqdqhivwjbku.png"><br></li><li>  Aqu√≠ debe especificar un nombre, direcci√≥n IP, puerto y una lista de m√©todos permitidos.  Presta atenci√≥n a la direcci√≥n IP.  Si especifica 0.0.0.0, todos pueden acceder a esta puerta de enlace.  Si 127.0.0.1: solo otras puertas de enlace dentro del mismo DataPower.  Como hay par√°metros de seguridad entre las configuraciones, utilizamos la segunda opci√≥n.  Complete los campos y haga clic en "Aplicar", el protocolo se agregar√° autom√°ticamente a la puerta de enlace. <br><br><img src="https://habrastorage.org/webt/xn/y5/-r/xny5-rfrolidwemexqwg25-tkec.png"><br></li><li>  Haga clic en + para agregar una nueva pol√≠tica. <br><br><img src="https://habrastorage.org/webt/ju/y0/q6/juy0q6_osmjfnwd2v5xev97wvta.png"><br></li><li>  Complete el nombre de la pol√≠tica "GetFilePolicy". <br></li><li>  Cree una nueva regla, complete el nombre y la direcci√≥n de la regla.  Como realmente no hay backend y solo se devuelve el archivo deseado, solo habr√° una regla (cliente a servidor). <br><br><img src="https://habrastorage.org/webt/cv/4c/z_/cv4cz_dfzc5sjxu4i7as6iluzne.png"><br></li><li>  Haga doble clic en la acci√≥n Coincidir para configurarla, seleccione una regla existente y aplique los cambios.  Ser√≠a ideol√≥gicamente correcto establecer una restricci√≥n en la capacidad de recibir solo solicitudes de obtenci√≥n, pero dentro del marco de la tarea de capacitaci√≥n, puede seleccionar la existente. <br></li><li>  Agregue otra acci√≥n: GatewayScript arrastr√°ndolo a la regla y config√∫relo.  Como transformaci√≥n, utilizaremos el archivo preparado, que en el sistema de archivos local: /// encontrar√° el archivo por nombre del URI de la solicitud entrante y lo colocar√° en el cuerpo del mensaje.  El resultado de la operaci√≥n se transferir√° directamente al b√∫fer de salida de la regla.  Guarda los cambios. <br><br><img src="https://habrastorage.org/webt/ai/pr/va/aiprvaljftoye2gr5tf1xjf4s_u.png"><br></li><li>  El resultado final de la pol√≠tica deber√≠a verse as√≠: <br><br><img src="https://habrastorage.org/webt/rm/q0/on/rmq0onkkkvygnyevy574vsgz3ns.png"><br></li><li>  La creaci√≥n de MPG est√° completa, guarde los cambios. <br></li><li>  Puede verificar el √©xito de su creaci√≥n utilizando Object Status, similar a verificar el estado de los dominios y el gestor de colas.  Para hacer esto, seleccione Estado del objeto y Ver por: filtro de servicios del dominio de configuraci√≥n.  En la secci√≥n "Puerta de enlace multiprotocolo", busque el objeto correspondiente y verifique su estado. <br></li><li>  No puede llamar a este MPG desde el exterior, ya que lo protegi√≥ con ip.  Cambie temporalmente la ip de 127.0.0.1 a 0.0.0.0 y el puerto de 7171 a 7170 y ejecute la siguiente consulta: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/trunk/route/routeRules.xml"</code> </pre><br></li><li>  Deber√≠a obtener la siguiente respuesta: <br><br><img src="https://habrastorage.org/webt/e5/m8/3n/e5m83ngxz17e8lahsicaxs6lj5s.png"><br></li><li>  Nuevamente, cambie la ip y el puerto al 127.0.0.1:7171 original. <br></li></ol><br><h4>  4.2.3  Creando EnrutamientoMPG </h4><br><p>  Ahora crea RoutingMPG.  Seg√∫n la solicitud de entrada y las reglas de enrutamiento, determinar√° d√≥nde y con qu√© par√°metros se debe enviar la solicitud. </p><br><ol><li>  Vaya al dominio troncal. </li><li>  Cree una nueva puerta de enlace multiprotocolo de acuerdo con las cl√°usulas 2-10 de la secci√≥n 4.2.2 utilizando los siguientes valores: <br><ul><li>  3 - nombre: RoutingMPG, tipo de back-end: Din√°mico (para la capacidad de enrutar solicitudes a diferentes MPG si es necesario). </li><li>  4 - Rq: no xml, Rs: no xml. </li><li>  6 - nombre: RoutingHTTP_FSH, ip: 0.0.0.0, puerto: 7170, + M√©todo de obtenci√≥n. </li><li>  8 - nombre: RoutingPolicy. </li><li>  9 - nombre: RoutingPolicy_rule_req, direcci√≥n: cliente a servidor. </li></ul><br></li><li>  Agregue una acci√≥n m√°s para enrutar la solicitud. Para hacer esto, arrastre la acci√≥n "Ruta" a la regla, haga doble clic en ella para configurarla, complete los campos y aplique los cambios.  El archivo route.xsl recibe el archivo de configuraci√≥n de enrutamiento del dominio de configuraci√≥n a trav√©s de GetFileMPG creado anteriormente.  Despu√©s de eso, seg√∫n el URI, la configuraci√≥n necesaria para esta operaci√≥n ya est√° seleccionada del archivo.  Algunos de ellos se utilizan para el enrutamiento, y otros se agregan a los encabezados para su uso en otros MPG.  Los par√°metros de entrada y salida determinan la forma de trabajar solo con el cuerpo del mensaje y de ninguna manera afectan los encabezados y las variables.  Por lo tanto: entrada de nulo, ya que la informaci√≥n del cuerpo del mensaje no se utiliza para el enrutamiento.  El resultado es nulo, ya que el resultado de la transformaci√≥n es solo un cambio en la informaci√≥n del servicio. <br><br><img src="https://habrastorage.org/webt/bb/q0/nh/bbq0nh2dtogav5pyfoeneb3t66m.png"><br></li><li>  Del mismo modo, cree 2 reglas m√°s y guarde todos los cambios: <br><ul><li>  Direcci√≥n: Servidor-Cliente, nombre: RoutingPolicy_rule_resp; <br>  Transformaci√≥n: Entrada INPUT, Salida NULL, archivo de transformaci√≥n local: ///RoutingMPG/transform/resp.xslt.  El archivo resp.xslt recibe el estado http de la respuesta MPG de transformaci√≥n y lo establece expl√≠citamente en la respuesta RoutingMPG.  Si esto no se hace, el c√≥digo predeterminado se establecer√° en 200, incluso si se produjo un error en la transformaci√≥n MPG. <br></li><li>  Direcci√≥n: error, nombre: RoutingPolicy_rule_error; <br>  Transformaci√≥n: entrada INPUT, salida PIPE (de acuerdo con la documentaci√≥n, el uso de PIPE entre dos nodos de acci√≥n adyacentes ya que INPUT y OUTPUT puede eliminar el procesamiento adicional y reducir la cantidad de memoria utilizada), el archivo de transformaci√≥n es local: ///RoutingMPG/transform/errors.xsl.  El archivo errors.xsl recibe el c√≥digo de error y el texto de la respuesta de la transformaci√≥n MPG y genera un mensaje de error JSON en el formato esperado por el cliente. <br></li></ul><br></li><li>  El resultado final de la pol√≠tica deber√≠a verse as√≠: <br><br><img src="https://habrastorage.org/webt/um/kx/x-/umkxx-3kwx3hi1dzmc1e80ko-wa.png"><br></li><li>  La creaci√≥n de MPG est√° completa, guarde los cambios. <br></li><li>  Usando, por ejemplo, la utilidad curl, ejecute la siguiente consulta: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage"</code> </pre> <br></li><li>  Si obtiene el siguiente error, todo se hace correctamente.  Este error significa que el mensaje se recibi√≥ y proces√≥ correctamente, pero el intento de llamar al backend (en este caso, IIBMPG) no tuvo √©xito.  Ve al siguiente paso. <br><br><img src="https://habrastorage.org/webt/8g/iq/tl/8giqtlzspsyix66vnl7mkcxnelk.png"><br></li></ol><br><h4>  4.2.4  Creaci√≥n de IIBMPG </h4><br><p>  El siguiente paso es crear un MPG transformacional.  Supongamos que el sistema externo est√° en el formato de solicitud JSON y el interno es XML.  Necesitamos transformar el mensaje de entrada para que el sistema interno pueda entenderlo.  Vale la pena se√±alar que esto no siempre es una simple conversi√≥n de todo el mensaje.  A menudo se requiere transmitir un mensaje truncado o aumentado, a veces con una estructura completamente redise√±ada. </p><br><ol><li>  Vaya al dominio troncal. </li><li>  Cree una nueva puerta de enlace multiprotocolo de acuerdo con las cl√°usulas 2-10 de la secci√≥n 4.2.2 utilizando los siguientes valores: <br><ul><li>  3 - nombre: IIBMPG, tipo de servidor: din√°mico </li><li>  4 - Rq: JSON, Rs: XML </li><li>  6 - nombre: IIBHTTP_FSH, ip: 127.0.0.1 (solo solicitudes del mismo DataPower), puerto: 7172, + m√©todo Get </li><li>  8 - Nombre: IIBPolicy </li><li>  9 - nombre: IIBPolicy_rule_req, direcci√≥n: cliente a servidor </li></ul><br></li><li>  Agrega una descripci√≥n.  Basado en el X-DP-Transform-Name en los encabezados de solicitud, el archivo IIBRuleRoute.xsl recibe del archivo local: ///IIB/route/IIBRouteRules.xml los nombres de los archivos de transformaci√≥n, respuesta y error de solicitud para este servicio y establece sus valores a las variables de contexto correspondientes var: // context / IIB / reqTransform, var: // context / IIB / ansTransform, var: // context / IIB / errTransform.  Otros valores de encabezados (url, uri, caducar, tiempo de espera) tambi√©n se colocan en variables de contexto. <br><br><img src="https://habrastorage.org/webt/xo/6b/ek/xo6bekae8dsumpvosfe5xnbhneg.png"><br></li><li>  Agregue otra acci√≥n arrastrando Avanzado a su regla y seleccionando Convertir par√°metros de consulta a XML de la lista, configurar.  Debe agregar un nuevo mapa de conversi√≥n de entrada, d√°ndole un nombre (cmnJSONParseCNVM) y el tipo requerido (JSON). <br><br><img src="https://habrastorage.org/webt/ir/az/gb/irazgbszkybdgjkor1otjvrllqc.png"><br><br><img src="https://habrastorage.org/webt/yd/tk/2x/ydtk2xhbveh4j6z1gsweidcyhak.png"><br></li><li>  Agregue la transformaci√≥n despu√©s de la conversi√≥n est√°ndar y config√∫rela.  En este caso, la variable establecida en la transformaci√≥n anterior se usa para indicar el archivo de transformaci√≥n.  Esto se hace para que la transformaci√≥n sea universal y el archivo en s√≠ mismo se sustituya "sobre la marcha" seg√∫n el mensaje de entrada.  El cuerpo del mensaje est√° listo.  El siguiente paso es enrutar el mensaje, y el cuerpo del mensaje no cambiar√°, por lo que creamos la variable dpvar_1 y guardamos el resultado en ella.  Es a esta variable a la que apuntamos la entrada a la acci√≥n Resultados.  Guarda los cambios. <br><br><img src="https://habrastorage.org/webt/yz/cf/do/yzcfdogrjturkuvvmqx7bio_ex4.png"><br></li><li>  Agregue una acci√≥n de enrutamiento y establezca los siguientes par√°metros.  El archivo IIBURLRoute.xsl recibe los valores de las variables de contexto, algunas de ellas se configuran como variables de solicitud de servicio, y del resto forma un URI para la solicitud al sistema de destino, que tambi√©n se almacena en la variable de servicio. <br><br><img src="https://habrastorage.org/webt/kl/vk/cf/klvkcfgcro60wznqwo0ibxdncys.png"><br></li><li>  Del mismo modo, cree 2 reglas m√°s y guarde todos los cambios: <br><ul><li>  Direcci√≥n: Servidor-Cliente, nombre: IIBPolicy_rule_resp; <br>  Transformaci√≥n: Entrada INPUT, Salida PIPE, archivo de transformaci√≥n var: // context / IIB / ansTransform (variable de contexto para sustituir la transformaci√≥n de la respuesta "sobre la marcha"). </li><li>  Direcci√≥n: Error, nombre: IIBPolicy_rule_error; <br>  Transformaci√≥n: entrada NULL, salida PIPE, archivo de transformaci√≥n var: // context / IIB / errTransform (variable de contexto para sustituir la transformaci√≥n de error sobre la marcha). </li></ul><br></li><li>  El resultado final de la pol√≠tica deber√≠a verse as√≠: <br><img src="https://habrastorage.org/webt/qi/d9/7u/qid97ursvmwifemzxbfdtudjkjc.png"><br></li><li>  La creaci√≥n de MPG est√° completa, guarde los cambios. <br></li></ol><br><h2>  Parte 5. Prueba </h2><br><h3>  5.1.  Preparaci√≥n </h3><br><ol><li>  Descargue, por ejemplo, la utilidad rfhutil para leer y escribir mensajes en la cola; </li><li>  Los archivos de prueba se encuentran en la carpeta de pruebas del mismo directorio que los archivos del proyecto. </li></ol><br><h3>  5.2.  Control de salud </h3><br><ol><li>  Env√≠e la solicitud utilizando la utilidad curl (para la solicitud a continuaci√≥n, el directorio actual debe ser el mismo que example.json). <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage" -H "Content-Type: application/json" --data-binary @example.json</code> </pre> <br></li><li>  Abra 2 instancias de la utilidad rfhutil y reste el mensaje de la cola DP.IIB.REQIN con la primera instancia; <br></li><li>  Vaya a la pesta√±a MQMD y copie el MessageID; <br></li><li>  En la segunda instancia, abra el archivo rs.xml, en la pesta√±a MQMD, inserte el identificador del mensaje en CorrelID y coloque el mensaje en la cola DP.IIB.RESIN; <br></li><li>  Deber√≠as obtener una respuesta similar: <br><br><img src="https://habrastorage.org/webt/mn/kj/xj/mnkjxj0lyafkvo7hjgpyytuytee.png"><br></li><li>  Repita los pasos 1-3; <br></li><li>      rs_error.xml       correllId; <br></li><li>     <br><br><img src="https://habrastorage.org/webt/_y/i5/hb/_yi5hbw1lnrfwsuryyln9z3rdic.png"><br></li></ol><br><h2>  6.  </h2><br><h3>  6.1.  Teor√≠a </h3><br><p> Log Targets   ,         . <br></p><br><p>     Log Targets    .     ,      4     1000Kb,      .              2-4    .       ,        .  , DataPower,  , ,   ,        ,      ,      -  MPG,     . <br></p><br><h3> 6.2.  </h3><br><ol><li>    trunk; </li><li>    Log Target   ; </li><li>      : <br><ul><li> (IIB_LOG); </li><li> (File); </li><li>  (Text); </li><li>  timestamp(zulu); </li><li>   (logtemp:///IIB.log ‚Äî  IIBMPG); </li><li>  (1000). <br><img src="https://habrastorage.org/webt/ev/sm/mj/evsmmjxy8m6suwkbaeojvgcudf8.png"><br></li></ul><br></li><li>   .        MPG   IIBMPG. <br><br><img src="https://habrastorage.org/webt/lq/vl/5l/lqvl5lvc_w8powdnufq6emgjgwc.png"><br></li><li>    ,     ,    (  ,        ). <br><br><img src="https://habrastorage.org/webt/ia/tu/98/iatu98v3l0fioelwktk8uwu-6fw.png"><br></li><li>         ; <br></li><li>    ; <br></li><li>          . <br></li><li>      Log Targets    MPG. <br></li><li>   : <br><ul><li>             , ,         . <br><br><img src="https://habrastorage.org/webt/z2/ix/vt/z2ixvtjk8eidxsfbbe6mmfcecnc.png"><br></li><li>        . <br><br><img src="https://habrastorage.org/webt/go/ik/wl/goikwl1pdvlzhiyd_d7gqpffzo8.png"><br></li></ul><br></li></ol><br><h2>  7.  -    </h2><br><ol><li>       ‚Äì  ,   .    ‚Äì  ,   ,     -    . <br></li><li>      .       View Logs.      ,  ¬´  ¬ª, ¬´   ¬ª     . <br></li><li>       .           .       MPG       Show Probe -&gt; Enable Probe.         .   ,        . <br><br><img src="https://habrastorage.org/webt/re/6s/mh/re6smhejkm-i8cdmmeky6ch6cmy.png"><br></li><li>   ,      . <br></li></ol><br><p>     ‚Äì    . <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442686/">https://habr.com/ru/post/442686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442676/index.html">Donde los sue√±os conducen: subterr√°neo</a></li>
<li><a href="../442678/index.html">El proyecto m√°s grande en litograf√≠a est√©reo: esqueleto de mamut impreso en una impresora 3D</a></li>
<li><a href="../442680/index.html">Las tecnolog√≠as de reemplazo sensorial le permitir√°n ver el mundo con la ayuda de los sonidos: c√≥mo funciona la neuroplasticidad del cerebro humano</a></li>
<li><a href="../442682/index.html">Qu√© escribir y c√≥mo ensamblar un proyecto C ++</a></li>
<li><a href="../442684/index.html">Rendimiento equilibrado del sitio. Parte 3: contenido</a></li>
<li><a href="../442688/index.html">An√°lisis de datos Scala: ¬øuna necesidad urgente o una oportunidad agradable?</a></li>
<li><a href="../442690/index.html">Misi√≥n lunar "Bereshit" - selfie en el fondo de la Tierra</a></li>
<li><a href="../442692/index.html">Blockchain sin intermediarios: c√≥mo enviamos valores a un registro distribuido</a></li>
<li><a href="../442694/index.html">Uno de los gigantes del streaming lanzado en India y atrajo a un mill√≥n de usuarios en una semana.</a></li>
<li><a href="../442696/index.html">S for Security: Internet Security of Things e informes en InoThings ++ 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>