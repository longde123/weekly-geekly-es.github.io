<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ปโ๐คโ๐จ๐ฝ ๐ง๐พ โ๏ธ ูู ุจุชุดุบูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูู PHP ุนุจุฑ php-fpm ุจุฏูู ุฎุงุฏู ููุจ. ุฃู ุนููู FastCGI (ุชุญุช ุงูุบุทุงุก) ๐ป ๐ง๐ฟโ๐คโ๐ง๐ฟ ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃุฑุญุจ ุจุฌููุน ูุฑุงุก "ูุจุฑ". 
 ุชูุตู 


 ุงุชุถุญ ุฃู ุงูููุงูุฉ ุทูููุฉ ุฌุฏูุง ููุฃููุฆู ุงูุฐูู ูุง ูุฑูุฏูู ูุฑุงุกุฉ ุงูุฎูููุฉ ุ ููููู ูุฑูุฏูู ุงูุงูุชูุงู ูุจุงุดุฑุฉ ุฅูู ูุฐู ุงูููุทุฉ ุ ุฃุทู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูู ุจุชุดุบูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูู PHP ุนุจุฑ php-fpm ุจุฏูู ุฎุงุฏู ููุจ. ุฃู ุนููู FastCGI (ุชุญุช ุงูุบุทุงุก)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472190/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุฃุฑุญุจ ุจุฌููุน ูุฑุงุก "ูุจุฑ". </p><br><h4 id="diskleymer" style=";text-align:right;direction:rtl">  ุชูุตู </h4><br><p style=";text-align:right;direction:rtl">  ุงุชุถุญ ุฃู ุงูููุงูุฉ ุทูููุฉ ุฌุฏูุง ููุฃููุฆู ุงูุฐูู ูุง ูุฑูุฏูู ูุฑุงุกุฉ ุงูุฎูููุฉ ุ ููููู ูุฑูุฏูู ุงูุงูุชูุงู ูุจุงุดุฑุฉ ุฅูู ูุฐู ุงูููุทุฉ ุ ุฃุทูุจ ููู ูุจุงุดุฑุฉ ุงููุตู "ุงูุญู". </p><br><h3 id="vstuplenie" style=";text-align:right;direction:rtl">  ุฏุฎูู </h3><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุฃูุฏ ุงูุชุญุฏุซ ุนู ุญู ูุดููุฉ ุบูุฑ ููุงุณูุฉ ุฅูู ุญุฏ ูุง ูุงู ุนูู ููุงุฌูุชูุง ุฃุซูุงุก ุนูููุฉ ุงูุนูู.  ููู ุฃููุง ูุญุชุงุฌ ุฅูู ุชุดุบูู ูุฌููุนุฉ ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ php ูู ุญููุฉ.  ูู ุฃูุงูุด ุฃุณุจุงุจ ูุฌุฏู ูุซู ูุฐุง ุงูุญู ุงููุนูุงุฑู ูู ูุฐู ุงูููุงูุฉ ุ ูุฃูู  ูู ุงููุงูุน ุ ูู ููู ุงูุฃูุฑ ูุชุนูู ุจูุง ุนูู ุงูุฅุทูุงู ุ ููุฏ ูุงู ูุฌุฑุฏ ูููุฉ ุ ูุงู ูุฌุจ ุญููุง ููุจุฏู ุฃู ุงูุญู ูุซูุฑ ููุงูุชูุงู ุจุฏุฑุฌุฉ ูุงููุฉ ูู ููุดุงุฑูุชูุง ูุนู ุ ุฎุงุตุฉ ูุฃููู ูู ุฃุฌุฏ ุฃู ูุงูุง ุนูู ุงูุฅูุชุฑูุช ุนูู ุงูุฅุทูุงู (ุฌูุฏูุง ุ ุจุงูุทุจุน ุ ุจุงุณุชุซูุงุก ุงูููุงุตูุงุช ุงูุฑุณููุฉ).  ุดุจูู ุ ุจุทุจูุนุฉ ุงูุญุงู ุ ุฌูุฏ ุ ูุจุงูุทุจุน ูู ุดูุก ููู ุ ููููู ุฃุนุชูุฏ ุฃูู ุณุชูุงูู ุนูู ุฃูู ุฅุฐุง ูู ุชูู ูุนุชุงุฏูุง ุจุดูู ุฎุงุต ุนูู ุงูููุถูุน ุ ูุญุชู ูู ุงูููุช ุงููุญุฏุฏ ุ ูุฅู ููููู ูุง ูุฒุงู ูู ุฏูุงุนู ุณุฑูุฑู. </p><a name="habracut"></a><br><h3 id="dlya-kogo-eta-statya" style=";text-align:right;direction:rtl">  ูู ูู ูุฐุง ุงูููุงู ูุ </h3><br><p style=";text-align:right;direction:rtl">  ููู ูู ูุนูู ูุน ุงูููุจ ูุจุฑูุชูููู <strong>FastCgi</strong> ูุนูู <strong>ููุท</strong> ุฃู ูุฐุง ูู ุงูุจุฑูุชูููู ุงูุฐู ูููู ุจููุฌุจู ุฎุงุฏู ุงูููุจ ุจุชุดุบูู ุงูุจุฑุงูุฌ ุงููุตูุฉ php ุ ูููู ูุฑูุฏ ุฏุฑุงุณุชูุง ุจูุฒูุฏ ูู ุงูุชูุงุตูู ูุงูุจุญุซ ุชุญุช ุงูุบุทุงุก. </p><br><h3 id="obosnovanie-zachem-eta-statya" style=";text-align:right;direction:rtl">  ุงูุชุจุฑูุฑ (ููุงุฐุง ูุฐุง ุงูููุงู) </h3><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ููุง ูุชุจุช ุฃุนูุงู ุนูุฏูุง ูุงุฌููุง ุงูุญุงุฌุฉ ุฅูู ุชุดุบูู ุงูุนุฏูุฏ ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ูู php ุฏูู ูุดุงุฑูุฉ ุฎุงุฏู ููุจ (ุชุญุฏุซ ุชูุฑูุจูุง ูู ุจุฑูุงูุฌ ูุตู php ุขุฎุฑ) ุ ูุฅู ุฃูู ูุง ูุชุจุงุฏุฑ ุฅูู ุงูุฐูู ูู ... </p><br><pre style=";text-align:right;direction:rtl"><code class="php hljs">shell_exec(<span class="hljs-string"><span class="hljs-string">'php \path\to\script.php'</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูู ุจุฏุงูุฉ ูู ุจุฑูุงูุฌ ูุตู ุ ุณูุชู ุฅูุดุงุก ุจูุฆุฉ ุ ูุณูุชู ุฅุทูุงู ุนูููุฉ ูููุตูุฉ ุ ุจุดูู ุนุงู ุ ูุจุฏู ุฃููุง ููููุฉ ุจุงููุณุจุฉ ููููุงุฑุฏ.  ุชู ุฑูุถ ูุฐุง ุงูุชุทุจูู.  ุงูุดูุก ุงูุซุงูู ุงูุฐู ูุชุจุงุฏุฑ ุฅูู ุงูุฐูู ูู ุจุงูุทุจุน <strong>php-fpm</strong> ุ ุฅูู ุฑุงุฆุน ููุบุงูุฉ ุ ููู ูุจุฏุฃ ุงูุจูุฆุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท ุ ููุฑุงูุจ ุงูุฐุงูุฑุฉ ุ ููุณุฌู ูู ุดูุก ููุงู ุจุดูู ุตุญูุญ ุ ููุจุฏุฃ ููุชููู ุนู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุ ุจุดูู ุนุงู ูู ุดูุก ุฑุงุฆุน ุ ูุจุงูุทุจุน ููุง ููุฏ ุจูุฐู ุงูุทุฑููุฉ ุฃูุซุฑ ูู ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ููู ูุฐุง ุณูุฆ ุงูุญุธ ุ ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ุนุฑููุง ููู ูุนูู ุ ุจุดูู ุนุงู (ููุง ุงุชุถุญ ุฃูู ุนุงู ุฌุฏูุง) ุ ููู ุชุจูู ุฃูู ูู ุงูุตุนุจ ุฌุฏูุง ุชูููุฐ ูุฐุง ุงูุจุฑูุชูููู ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุฏูู ูุดุงุฑูุฉ ุฎุงุฏู ููุจ.  ุฃุธูุฑุช ูุฑุงุกุฉ ุงูููุงุตูุงุช ูุณุงุนุชูู ูู ุงููุญุงููุงุช ุบูุฑ ุงููุงุฌุญุฉ ุฃู ุงูุฃูุฑ ุณูุณุชุบุฑู ุจุนุถ ุงูููุช ููุชูููุฐ ุ ููู ูุง ูู ููู ูุฏููุง ูู ุฐูู ุงูููุช.  ูุง ููุฌุฏ ูุงูุน ูุชูููุฐ ูุฐุง ุงููุดุฑูุน ุงูุฐู ูููู ููู ูุตู ูุฐุง ุงูุชูุงุนู ุจูู ุจุณุงุทุฉ ููุถูุญ ุ ูู ูุชููู ูู ุฃุฎุฐ ุฃู ูู ุงูููุงุตูุงุช ุฃูุถูุง ุ ูู ุงูุญููู ุงูุฌุงูุฒุฉ ุงูุชู ูุฌุฏูุงูุง ูู Python script ู Pykhov lib ุนูู github ุ ูุงูุชู ูู ุงูููุงูุฉ ูู ุชุฑุบุจ ูู ุฌุฑูุง ุฅูู ูุดุฑูุนู (ุฑุจูุง ูุฐุง ููุณ ุตุญูุญูุง ุ ูููู ููุณ ูู ุงูุญูููุฉ ุ ูุญู ูุญุจ ุฌููุน ุฃููุงุน ููุชุจุงุช ุงูุฌูุงุช ุงูุฎุงุฑุฌูุฉ ุ ูุญุชู ุชูู ุงูุชู ูุง ุชุญุธู ุจุดุนุจูุฉ ูุจูุฑุฉ ุ ูุจุงูุชุงูู ูู ูุชู ุงุฎุชุจุงุฑูุง).  ุจุดูู ุนุงู ุ ููุชูุฌุฉ ููุฐู ุงูููุฑุฉ ุ ุฑูุถูุง ููููุฐ ูู ูุฐุง ูู ุฎูุงู rabbitmq ุงููุฏูู ุงูุฌูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู ุงููุดููุฉ ูุฏ ุชู ุญููุง ุฃุฎูุฑูุง ุ ุฅูุง ุฃููู ูุฑุฑุช ุฃู ุฃููู FastCgi ุจุงูุชูุตูู ุ ูุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ูุฑุฑุช ุฃู ุฃูุชุจ ููุงููุง ุนููุง ุ ูุงูุฐู ุณูุตู ุจุจุณุงุทุฉ ูุจุงูุชูุตูู ููููุฉ ุงูุญุตูู ุนูู <strong>php-fpm</strong> ูุชุดุบูู ุจุฑูุงูุฌ ูุตู php ุจุฏูู ุฎุงุฏู ููุจ ุ ุฃู ุจุงูุฃุญุฑู ุ ููุง ุณูููู ูุฎุงุฏู ุงูููุจ ูุต ุจุฑูุฌู ูุฎุชูู ุ ูุณุฃุทูู ุนููู ุงุณู ุนููู Fcgi.  ุจุดูู ุนุงู ุ ุขูู ุฃู ูุณุงุนุฏ ูุฐุง ุงูููุงู ุฃููุฆู ุงูุฐูู ููุงุฌููู ููุณ ุงููููุฉ ุงูุชู ูููู ุจูุง ูุจุนุฏ ุงููุฑุงุกุฉ ุ ุณูููู ุจุฅููุงููู ูุชุงุจุฉ ูู ูุง ูุญุชุงุฌ ุฅููู ุจุณุฑุนุฉ. </p><br><h3 id="tvorcheskiy-poisk-lozhnyy-put" style=";text-align:right;direction:rtl">  ุงูุจุญุซ ุงูุฅุจุฏุงุนู (ูุณุงุฑ ุฎุงุทุฆ) </h3><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุชุชู ุงูุฅุดุงุฑุฉ ุฅูู ุงููุดููุฉ ุ ูุฌุจ ุฃู ููุชูู ุฅูู ุงูุญู.  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุซู ุฃู ูุจุฑูุฌ "ุนุงุฏู" ุ ูุญู ูุดููุฉ ูุง ุชุชู ูุชุงุจุชูุง ูู ุฃู ููุงู ูุง ูุฌุจ ุงูููุงู ุจู ููุง ูุฌุจ ุฅุฏุฎุงูู ูู ูุญุฏุฉ ุงูุชุญูู ุ ูู ุฃูุฑุฃ ุงูููุงุตูุงุช ููู ุจุชุฑุฌูุชูุง ุ ููููู ุชูุตูุช ุนูู ุงูููุฑ ุฅูู ุญู "ูุชุฃูู" ุฎุงุต ุจู.  ุฌููุฑูุง ูู ุนูู ุงููุญู ุงูุชุงูู ุ ูุฃูุง ุฃุนูู ุฃู <strong>nginx</strong> (ูุณุชุฎุฏู nginx ูุญุชู ูุง ููุชุจ <strong>ุฃุดูุงุก ุญููุงุก</strong> ุฃุฎุฑู - ุฎุงุฏู ููุจ ุ ุณุฃูุชุจ nginx ุ ูุฃูู ุฃูุซุฑ ุชุนุงุทููุง) ูููู ุดูุฆูุง ุฅูู <strong>php-fpm</strong> ุ <strong>ููุง</strong> ุฃูู ูุนุงูุฌ <strong>php-fpm</strong> ุฅูู ุฅูู ูููู ุจุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุนูู ุฃุณุงุณู ุ ุญุณููุง ุ ูุจุฏู ุฃู ูู ุดูุก ุจุณูุท ุ ูุณูู <strong>ุฃุนุชุจุฑู</strong> ูุฃุชุนูุฏ ูู ุจููู <strong>nginx ูุณุฃูุฑ</strong> ุจุงูุดูุก ููุณู. </p><br><p style=";text-align:right;direction:rtl">  ุณูู ูุณุงุนุฏ <strong>netcat</strong> ุงูุนุธูู ููุง (ุฃุฏุงุฉ UNIX ููุนูู ูุน ุญุฑูุฉ ูุฑูุฑ ุงูุดุจูุฉ ุ ูุงูุชู ูู ุฑุฃูู ูููููุง ูุนู ุฃู ุดูุก ุชูุฑูุจูุง)  ูุฐูู ูููุง ุจุชุนููู <strong>netcat</strong> ููุงุณุชูุงุน ุนูู ุงููููุฐ ุงููุญูู ุ ูุชูููู <strong>nginx</strong> ููุนูู ูุน ูููุงุช php ูู ุฎูุงู ุงูููุจุณ (ุจุงูุทุจุน ุ ุงูููุจุณ ุนูู ููุณ ุงููููุฐ ุงูุฐู ูุณุชูุน ุฅููู <strong>netcat</strong> ) </p><br><p style=";text-align:right;direction:rtl">  ุงูุงุณุชูุงุน ุฅูู 9000 ูููุฐ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">nc -l 9000</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุงูุชุญูู ูู ุฃู ูู ุดูุก ุนูู ูุง ูุฑุงู ุ ููููู ุงูุงุชุตุงู ุจุงูุนููุงู 127.0.0.1:9000 ูู ุฎูุงู ูุชุตูุญ ููุฌุจ ุฃู ุชููู ุงูุตูุฑุฉ ุงูุชุงููุฉ </p><br><img src="https://habrastorage.org/webt/ux/9s/_f/ux9s_fkir12e0yn3arj010nnezw.png"><br><p style=";text-align:right;direction:rtl">  ูู ุจุชูููู <strong>nginx</strong> ุจุญูุซ <strong>ูุชุนุงูู ูุน</strong> ุงูุจุฑุงูุฌ ุงููุตูุฉ php ูู ุฎูุงู ูุฃุฎุฐ ุชูุตูู ุนูู ุงููููุฐ 9000 (ูู ุงูุฅุนุฏุงุฏุงุช / etc / nginx / sites-available / default "ุ ุจุงูุทุจุน ุ ูุฏ ุชุฎุชูู) </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">location ~ \.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; }</code> </pre><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ูุฐู ุงูุชูุงุนุจ ุ ุณูู ูุชุญูู ููุง ุญุฏุซ ูู ุฎูุงู ุงูุงุชุตุงู ุจูุต php ูู ุฎูุงู ุงููุชุตูุญ </p><br><img src="https://habrastorage.org/webt/u_/hf/j1/u_hfj1xa4tnqyb35rdmfu5nf-na.png"><br><p style=";text-align:right;direction:rtl">  ูููู ููุงุญุธุฉ ุฃู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงููุฑุณูุฉ <strong>nginx</strong> ุงููุฑุณูุฉ ุ ููุฐูู ุงูุฃุญุฑู ุบูุฑ ุงููุงุจูุฉ ููุทุจุงุนุฉ ุ ุฃู ุชู ููู ุงูุจูุงูุงุช ุจุชุฑููุฒ ุซูุงุฆู ุ ููุง ูุนูู ุฃูู ูุง ูููู ูุณุฎูุง ูุฅุฑุณุงููุง ุจุณูููุฉ ุฅูู <strong>ูุฃุฎุฐ ุชูุตูู php-fpm</strong> .  ุฅุฐุง ููุช ุจุญูุธูุง ูู ููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุชู ุญูุธูุง ูู ุชุดููุฑ ุณุฏุงุณู ุนุดุฑู ุ ุณูุจุฏู ูุฐุง ููุทุจู </p><br><img src="https://habrastorage.org/webt/le/7e/9y/le7e9ycpkn8n3mezj7ksa9xhkki.png"><br><p style=";text-align:right;direction:rtl">  ููู ูุฐุง ุฃูุถูุง ูุง ูุนุทููุง ุงููุซูุฑ ุ ูุฑุจูุง ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุงูุจุญุชุฉ ูููู ุชุญููููุง ุฅูู ุชุดููุฑ ุซูุงุฆู ุ ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู (ูุง ุฃุณุชุทูุน ุญุชู ุฃู ุฃุชุฎูู ููู) ูุฅุฑุณุงููุง ุฅูู ููุจุณ fpm ุ ูููุงู ุญุชู ูุฑุตุฉ ูุฃู ุชุนูู ูุฐู ุงูุฏุฑุงุฌุฉ ุจุฃููููุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ูุญุชู ุชุจุฏุฃ ููุนูุง ูู ุณููุงุฑูู ุ ูููู ุจุทุฑููุฉ ูุง ูู ุดูุก ูุจูุญ ููุญุฑุฌ. </p><br><p style=";text-align:right;direction:rtl">  ุฃุตุจุญ ูู ุงููุงุถุญ ุฃู ูุฐุง ุงููุณุงุฑ ูุงู ุฎุงุทุฆูุง ุชูุงููุง ุ ููููู ุฃู ุชุฑู ุจููุณู ูุฏู ุจุคุณ ูู ูุฐุง ุ ูุญุชู ุฃูุซุฑ ูู ุฐูู ุ ูู ูุฐู ุงูุฅุฌุฑุงุกุงุช ูู ุชุณูุญ ููุง ุจุงูุชุญูู ูู ุงูุงุชุตุงู ุ ููู ุชูุฑุจูุง ูู ููู ุงูุชูุงุนู ุจูู <strong>php-fpm</strong> ู <strong>nginx</strong> . </p><br><p style=";text-align:right;direction:rtl">  ุฐูุจ ูู ุดูุก ุ ูุง ูููู ุชุฌูุจ ุงูููุงุตูุงุช! </p><br><h3 id="reshenie-tut-sobstvenno-nachinaetsya-vsya-sol-dannoy-stati" style=";text-align:right;direction:rtl">  ุงูุญู (ููุง ูุจุฏุฃ ูู ููุญ ูุฐู ุงูููุงูุฉ ุจุงููุนู) </h3><br><h4 id="teoreticheskaya-podgotovka" style=";text-align:right;direction:rtl">  ุงูุชุฏุฑูุจ ุงููุธุฑู </h4><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ุงูุขู ูููุฑ ูู ููููุฉ ูุฌูุฏ ุงุชุตุงู ูุชุจุงุฏู ููุจูุงูุงุช ุจูู <strong>nginx</strong> ู <strong>php-fpm</strong> .  ููุงู ุงููููู ูู ุงููุธุฑูุฉ ุ ุญูุซ ูุชู ุฅุฌุฑุงุก ุฌููุน ุงูุงุชุตุงูุงุช ููุง ูู ูุงุถุญ ุจุงููุนู ูู ุฎูุงู ูุขุฎุฐ ุงูุชูุตูู ุ ูุณูู ููุธุฑ ุจุดูู ุฎุงุต ูู ุงุชุตุงู ุนุจุฑ ูุฃุฎุฐ ุชูุตูู TCP. </p><br><p style=";text-align:right;direction:rtl">  ูุญุฏุฉ ุงููุนูููุงุช ูู ุจุฑูุชูููู <strong>FastCgi</strong> ูู <strong>ุณุฌู cgi</strong> .  ูุฑุณู ุงูุฎุงุฏู ูุซู ูุฐู ุงูุณุฌูุงุช ุฅูู ุงูุชุทุจูู ููุชููู ููุณ ุงูุณุฌูุงุช ุจุงูุถุจุท ุงุณุชุฌุงุจุฉ ูุฐูู. </p><br><h5 id="nemnogo-teorii-struktury" style=";text-align:right;direction:rtl">  ุงููููู ูู ุงููุธุฑูุฉ (ุงูุจููุฉ) </h5><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ููุฑ ูู ุจููุฉ ุงูุณุฌู.  ูููู ุงูุดูู ุงูุฐู ูุชููู ููู ุงูุณุฌู ุ ูุฌุจ ุฃู ุชููู ุดูู ุงูุจูุงูุงุช C ูููู ุชุณููุงุชูุง.  ุจุงููุณุจุฉ ูุฃููุฆู ุงูุฐูู ูุง ูุนุฑููู ุฃูุซุฑ ุ ูุณูุชู ูุตู ุฐูู ุจุฅูุฌุงุฒ (ูููู ูููู ููููู).  ุณุฃุญุงูู ุฃู ุฃุตู ุฐูู ุจุฃุจุณุท ูุง ูููู ุ ููุง ุฌุฏูู ูู ุงูุฎูุถ ูู ุงูุชูุงุตูู ููุง ุ ูุฃุฎุดู ุฃู ุฃููู ูุฑุชุจููุง ูู ุงูุชูุงุตูู ุ ุงูุดูุก ุงูุฑุฆูุณู ูู ุฃู ูููู ูุฏู ููู ูุดุชุฑู. </p><br><p style=";text-align:right;direction:rtl">  ุงูููุงูู ูู ุจุจุณุงุทุฉ ูุฌููุนุฉ ูู ูุญุฏุงุช ุงูุจุงูุช ุ ููุณูุญ ููุง ุชุฑููุฒ ููุง.  ุฃู ุฃู ูุฏูู ููุท ุณูุณูุฉ ูู ุงูุฃุตูุงุฑ ูุงูุฃุฎุฑู ุ ูุจุนุถ ุงูุจูุงูุงุช ูุดูุฑุฉ ูู ูุฐุง ุงูุชุณูุณู ุ ูููู ุญุชู ุงูุขู ููุณ ูุฏูู ุฃู ุชุนููู ุชูุถูุญู ููุฐุง ุงูุชุณูุณู ุ ูุฅู ูุฐู ุงูุจูุงูุงุช ูุง ุชูุซู ุฃู ูููุฉ ูู ุ ูุฃู  ูุง ููููู ุชูุณูุฑูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">//     1101111000000010010110000010011100010000</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ูู ูุฑุฆู ููุง ุ ูุฏููุง ุจุนุถ ุงูุจุชุงุช ุ ุฃู ููุน ูู ุงูุจุชุงุช ููุณ ูุฏููุง ุฃู ููุฑุฉ.  ุญุณููุง ุ ุฏุนูุง ูุญุงูู ุนูู ุณุจูู ุงููุซุงู ุชูุณูููุง ุฅูู ุจุงูุช ูุชูุซูููุง ูู ูุธุงู ุนุดุฑู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">//   5  11011110 00000010 01011000 00100111 00010000 //    222 2 88 39 16</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ููุฏ ูุณุฑูุงูุง ูุญุตููุง ุนูู ุจุนุถ ุงููุชุงุฆุฌ ุ ุฏุนูุง ูููู ุฃู ูุฐู ุงูุจูุงูุงุช ูู ุงููุณุคููุฉ ุนู ููุฏุงุฑ ูุง ุชุฏูู ุจู ุดูุฉ ูุนููุฉ ููููุฑุจุงุก.  ุงุชุถุญ ุฃูู ูู ุงูููุฒู 222 ุดูุฉ ุฑูู 2 ูุฌุจ ุฃู ุชุฏูุน 88 ุฑูุจู.  ููุงุฐุง ุนู ุฑูููู ุ ูุงุฐุง ุชูุนู ูุนูู ููุท ูุฅุณูุงุทุ  ุจุงูุทุจุน ูุง!  ุงูุญูููุฉ ูู ุฃูู ูู ููู ูุฏููุง ุชุฏููู (ุชูุณูู) ูู ุดุฃูู ุฃู ูุฎุจุฑูุง ุจููููุฉ ุชุฑุฌูุฉ ุงูุจูุงูุงุช ุ ูุชูุณูุฑูุง ุจุทุฑููุชูุง ุงูุฎุงุตุฉ ุ ูู ูุฐุง ุงูุตุฏุฏ ุ ูู ูุชูู ูุชุงุฆุฌ ุบูุฑ ูุฌุฏูุฉ ูุญุณุจ ุ ูููู ุฃูุถูุง ูุชุงุฆุฌ ุถุงุฑุฉ.  ูุชูุฌุฉ ูุฐูู ุ ุฏูุนุช ุดูุฉ 2 ุนูู ุงูุงุทูุงู ูููุณ ูุง ููุจุบู ุฃู ูููู.  (ูู ุงููุคูุฏ ุฃู ุงูุฃูุซูุฉ ุจุนูุฏุฉ ุงูููุงู ููุง ุชุฎุฏู ุฅูุง ูู ุดุฑุญ ุงููููู ุจุดูู ุฃูุถุญ) </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ููุฑู ููู ูุฌุจ ุนูููุง ุชูุณูุฑ ูุฐู ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ ุ ูุน ูุฌูุฏ ุชุฑููุฒ (ุชูุณูู).  ุนูุงูุฉ ุนูู ุฐูู ุ ุณุฃุชุตู ุจุฃุณูุงุฆูุง ุจุฃุณูุงุฆูุง ุงูุญููููุฉ ุ ุฃู ุงูุชุฏููู = ุงูุชูุณูู ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชูุณููุงุช ููุง</a> ). </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">//  "Cnn" //  //C -   (char) (8 ) //n -  short (16 ) //      11011110 0000001001011000 0010011100010000 //    222 600 10000</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ูู ุดูุก ูุชูุงุฑุจ ูู ุงูููุฒู ุฑูู 222 ุ ูุฌุจ ุฃู ุชููู ุงูุดูุฉ 600 ููููุฑุจุงุก 1000 ุฑูุจู ุ ูุฃุนุชูุฏ ุงูุขู ุฃู ุฃูููุฉ ุงูุชูุณูู ูุงุถุญุฉ ุ ูุงูุขู ุฃุตุจุญ ูู ุงููุงุถุญ ููู ุชุจุฏู ุจููุฉ ูุดุงุจูุฉ ุชูุฑูุจูุง.  (ูุฑุฌู ุงูุงูุชุจุงู ุ ูุงููุฏู ููุง ูู ุนุฏู ุชูุถูุญ ูุง ูู ูุฐู ุงูููุงูู ุจุงูุชูุตูู ุ ูููู ูุฅุนุทุงุก ููู ุนุงู ููุง ูู ูููู ุชุนูู) </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ุฑูุฒ ูุฐุง ุงููููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">struct { unsigned char houseNumber; unsigned char flatNumperA1; unsigned char flatNumperA2; unsigned char summB1; unsigned char summB2; }; // ,           // houseNumber -  // flatNumperA1 &amp;&amp; flatNumperA2 -  // summB1 &amp;&amp; summB2 -  </code> </pre> <br><h5 id="esche-nemnogo-teorii-fastcgi-zapisi" style=";text-align:right;direction:rtl">  ุจุนุถ ุงููุธุฑูุฉ (ุฅุฏุฎุงูุงุช FastCgi) </h5><br><p style=";text-align:right;direction:rtl">  ููุง ููุช ุฃุนูุงู ุ ูุฅู ูุญุฏุฉ ุงููุนูููุงุช ูู ุจุฑูุชูููู FastCgi ูู ุณุฌูุงุช.  ูุฑุณู ุงูุฎุงุฏู ุงูุณุฌูุงุช ุฅูู ุงูุชุทุจูู ููุชููู ููุณ ุงูุณุฌูุงุช ุงุณุชุฌุงุจุฉ ูุฐูู.  ูุชููู ุงูุณุฌู ูู ุฑุฃุณ ูุฌุณู ุจู ุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุฑุฃุณ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุชูููุฒ ุฅุตุฏุงุฑ ุงูุจุฑูุชูููู (ุฏุงุฆููุง 1) ุจููุฏุงุฑ 1 ุจุงูุช ('C') </li><li style=";text-align:right;direction:rtl">  ููุน ุงูุณุฌู.  ููุชุญ ุ ุฅุบูุงู ุงูุงุชุตุงู ุ ููุง ุฅูู ุฐูู. ูู ุฃููุฑ ูู ูู ุดูุก ุ ุซู ุณุฃุฏุฑุณ ููุท ูุง ูู ูุทููุจ ููููุฉ ูุญุฏุฏุฉ ุ ุฅุฐุง ูุงูุช ููุงู ุญุงุฌุฉ ุฅูู ุงูุขุฎุฑูู ุ ุฃุฑุญุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุงูููุงุตูุงุช</a> ููุง.  ูุดุงุฑ ุฅููู ุจูุงุณุทุฉ 1 ุจุงูุช ('C'). </li><li style=";text-align:right;direction:rtl">  ูุชู ุชุนุฑูู ูุนุฑู ุงูุทูุจ ุ ููู ุฑูู ุนุดูุงุฆู ุ ุจููุฏุงุฑ 2 ุจุงูุช ('n') </li><li style=";text-align:right;direction:rtl">  ุทูู ูุต ุงูุณุฌู (ุงูุจูุงูุงุช) ุ ุงููุดุงุฑ ุฅููู ุจูุงุณุทุฉ 2 ุจุงูุช ('n') </li><li style=";text-align:right;direction:rtl">  ุทูู ุจูุงูุงุช ุงููุญุงุฐุงุฉ ูุงูุจูุงูุงุช ุงููุญุฌูุฒุฉ ุ ุจุงูุช ูุงุญุฏ ููู ูููุง (ููุณุช ููุงู ุญุงุฌุฉ ุฅูู ุฅููุงุก ุงูุชูุงู ุฎุงุต ุญุชู ูุง ูุตุฑู ุงูุงูุชุจุงู ุนู ุงูุดูุก ุงูุฑุฆูุณู ูู ุญุงูุชูุง ุ ุณูููู ููุงู ุฏุงุฆููุง 0) </li></ol><br><p style=";text-align:right;direction:rtl">  ุงูุชุงูู ูู ูุต ุงูุณุฌู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ุฃู ุชููู ุงูุจูุงูุงุช ููุณูุง (ููุง ุจุงูุชุญุฏูุฏ ุงููุชุบูุฑุงุช ุงูุชู ูุชู ููููุง) ูุจูุฑุฉ ุฌุฏูุง (ุชุตู ุฅูู 65535 ุจุงูุช) </li></ol><br><p style=";text-align:right;direction:rtl">  ูููุง ููู ูุซุงู ุนูู ุฃุจุณุท ุณุฌู FastCgi ุซูุงุฆู ุจุงูุชูุณูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">struct { // unsigned char version; unsigned char type; unsigned char idA1; unsigned char idA2; unsigned char bodyLengthB1; unsigned char bodyLengthB2; unsigned char paddingLength; unsigned char reserved; //  unsigned char contentData; // 65535  unsigned char paddingData; };</code> </pre> <br><h4 id="praktika" style=";text-align:right;direction:rtl">  ููุงุฑุณุฉ </h4><br><h5 id="skript-klient-i-peredayuschiy-soket" style=";text-align:right;direction:rtl">  ุงููุตู ุงูุนููู ูููู ุงูููุจุณ </h5><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุจูุงูุงุช ุณูู ูุณุชุฎุฏู ุงูุชุฏุงุฏ ูุฃุฎุฐ ุชูุตูู php ุงูููุงุณู.  ูุฃูู ูุง ูุฌุจ ุงูููุงู ุจู ูู ุชูููู <strong>php-fpm</strong> ููุงุณุชูุงุน ุนูู ุงููููุฐ ุนูู ุงููุถูู ุงููุญูู ุ ุนูู ุณุจูู ุงููุซุงู 9000. ููุชู ุฐูู ูู ูุนุธู ุงูุญุงูุงุช ูู ุงูููู '/etc/php/7.3/fpm/pool.d/www.conf' ุ ูุณุงุฑ ุงูุฏูุฑุฉ ุงูุชุฏุฑูุจูุฉ ูุนุชูุฏ ุนูู ุฅุนุฏุงุฏุงุช ุงููุธุงู ุงูุฎุงุต ุจู.  ููุงู ุชุญุชุงุฌ ุฅูู ุชุณุฌูู ุดูุก ูุซู ุงูุชุงูู (ุฃุญูู ูุฌููุนุฉ ุงููุฏู ุจุงููุงูู ุจุญูุซ ููููู ุงูุชููู ุ ุงููุณู ุงูุฑุฆูุณู ูู ุงูุงุณุชูุงุน ููุง) </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">; The address on which to accept FastCGI requests. ; Valid syntaxes are: ; 'ip.add.re.ss:port' - to listen on a TCP socket to a specific IPv4 address on ; a specific port; ; '[ip:6:addr:ess]:port' - to listen on a TCP socket to a specific IPv6 address on ; a specific port; ; 'port' - to listen on a TCP socket to all addresses ; (IPv6 and IPv4-mapped) on a specific port; ; '/path/to/unix/socket' - to listen on a unix socket. ; Note: This value is mandatory. ;listen = /run/php/php7.3-fpm.sock listen = 127.0.0.1:9002</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฅุนุฏุงุฏ fpm ุ ุชููู ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุงูุงุชุตุงู ุจุงูููุจุณ </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$service_port = <span class="hljs-number"><span class="hljs-number">9000</span></span>; $address = <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>; $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP); $result = socket_connect($socket, $address, $service_port);</code> </pre> <br><h4 id="nachalo-zaprosa-fcgi_begin_request" style=";text-align:right;direction:rtl">  ุจุฏุงูุฉ ุทูุจ FCGI_BEGIN_REQUEST </h4><br><p style=";text-align:right;direction:rtl">  ููุชุญ ุงุชุตุงู ุ ูุฌุจ ุฃู ูุฑุณู ุฅุฏุฎุงููุง ุจููุน FCGI_BEGIN_REQUEST = 1 ุณูููู ุนููุงู ุงูุฅุฏุฎุงู ูุซู ูุฐุง (ูุชุญููู ุงูููู ุงูุฑูููุฉ ุฅูู ุณูุณูุฉ ุซูุงุฆูุฉ ุจุงูุชูุณูู ุงููุญุฏุฏ ุ ุณูุชู ุงุณุชุฎุฏุงู ุญุฒูุฉ ูุธุงุฆู php ()) </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">socket_write($socket, pack(<span class="hljs-string"><span class="hljs-string">'CCnnCx'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//  - 1 //  - 1 - FCGI_BEGIN_REQUEST //id - 1 //   - 8  // - 0</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูุญุชูู ูุต ุงูุชุณุฌูู ููุชุญ ุงูุงุชุตุงู ุนูู ุฏูุฑ ุชุณุฌูู ูุนูุงูุฉ ุชุชุญูู ูู ุงูุงุชุตุงู </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//      //struct { // unsigned char roleB1; // unsigned char roleB0; // unsigned char flags; // unsigned char reserved[5]; //}; //php  socket_write($socket, pack('nCxxxxx', 1, 0)); // - 1 -  // - 1 -    1   </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุชู ุฅุฑุณุงู ุณุฌู ูุชุญ ุงูุงุชุตุงู ุจูุฌุงุญ ุ ูุณููุจู <strong>php-fpm</strong> ุฐูู ูุณูุธู ูุชููุน ููุง ุณุฌููุง ุขุฎุฑ ูุญุชุงุฌ ููู ุฅูู ููู ุงูุจูุงูุงุช ููุดุฑ ุงูุจูุฆุฉ ูุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู. </p><br><h4 id="peredacha-parametrov-okruzheniya-fcgi_params" style=";text-align:right;direction:rtl">  ุชูุฑูุฑ ูุนููุงุช ุงูุจูุฆุฉ FCGI_PARAMS </h4><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงูุณุฌู ุ ุณููุฑุฑ ุฌููุน ุงููุนููุงุช ุงููุงุฒูุฉ ููุดุฑ ุงูุจูุฆุฉ ุ ููุฐูู ุงุณู ุงูุจุฑูุงูุฌ ุงููุตู ุงูุฐู ุณูุญุชุงุฌ ุฅูู ุชุดุบููู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุญุฏ ุงูุฃุฏูู ูู ุฅุนุฏุงุฏุงุช ุงูุจูุฆุฉ ุงููุทููุจุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$url = <span class="hljs-string"><span class="hljs-string">'/path/to/script.php'</span></span> $env = [ <span class="hljs-string"><span class="hljs-string">'REQUEST_METHOD'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'SCRIPT_FILENAME'</span></span> =&gt; $url, ];</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃูู ุดูุก ูุญุชุงุฌ ุฅูู ุงูููุงู ุจู ููุง ูู ุฅุนุฏุงุฏ ุงููุชุบูุฑุงุช ุงูุถุฑูุฑูุฉ ุ ุฃู ุงูุงุณู =&gt; ุฃุฒูุงุฌ ุงููููุฉ ุงูุชู ุณูููููุง ุฅูู ุงูุชุทุจูู. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ูููู ูููุฉ ุงุณู ุฃุฒูุงุฌ ูุซู ูุฐุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">//          128  typedef struct { unsigned char nameLength; unsigned char valueLength; unsigned char nameData unsigned char valueData; }; //    1 </code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู 1 ุจุงูุช ุฃููุงู - ุงูุงุณู ุทููู ุ ุซู 1 ุจุงูุช ูู ุงููููุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">//         128  typedef struct { unsigned char nameLengthA1; unsigned char nameLengthA2; unsigned char nameLengthA3; unsigned char nameLengthA4; unsigned char valueLengthB1; unsigned char valueLengthB2; unsigned char valueLengthB3; unsigned char valueLengthB4; unsigned char nameData unsigned char valueData; }; //    4 </code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุชูุง ุ ูููู ูู ูู ุงูุงุณู ูุงููุนุงูู ูุตูุฑูุง ูููุงุณุจ ุงูุฎูุงุฑ ุงูุฃูู ุ ูุฐูู ุณููุธุฑ ููู. </p><br><p style=";text-align:right;direction:rtl">  ุชุดููุฑ ุงููุชุบูุฑุงุช ูุฏููุง ูููุง ููุชูุณูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$keyValueFcgiString = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($env <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { <span class="hljs-comment"><span class="hljs-comment">//        //  128         $keyLen = strlen($key); $lenKeyChar = $keyLen &lt; 128 ? chr($keyLen) : pack('N', $keyLen); $valLen = strlen($value); $valLenChar = $valLen &lt; 128 ? chr($valLen) : pack('N', $valLen); $keyValueFcgiString .= $lenKeyChar . $valLenChar . $key . $value; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูุชู ุชุฑููุฒ ุงูููู ุงูุฃูู ูู 128 ุจุช ุจูุงุณุทุฉ ุงูุฏุงูุฉ <em>chr ($ keyLen)</em> ุ ุฃูุซุฑ ูู <em>pack ('N' ุ $ valLen)</em> ุ ุญูุซ ุชุดูุฑ N ุฅูู 4 ุจุงูุช.  ุซู ูุชู ุชุนููู ูู ูุฐุง ูุนูุง ูู ุณุทุฑ ูุงุญุฏ ููููุง ูุชูุณูู ุงููููู.  ุฌุณู ุงูุชุณุฌูู ุฌุงูุฒ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฑุฃุณ ุงูุณุฌู ุ ูููู ูู ุดูุก ููุง ูู ุงูุณุฌู ุงูุณุงุจู ุ ุจุงุณุชุซูุงุก ุงูููุน (ุณูููู FCGI_PARAMS = 4) ูุทูู ุงูุจูุงูุงุช (ุณูููู ูุณุงูููุง ูุทูู ุฃุฒูุงุฌ ูููุฉ name =&gt; ุฃู ุทูู ุงูุณูุณูุฉ $ keyValueFcgiString ุงูุชู ูููุง ุจุชูููููุง ูุณุจููุง). </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  socket_write($socket, pack('CCnnCx', 1, 4, 1, strlen($keyValueFcgiString), 0)); // body socket_write($socket, $keyValueFcgiString); //             //  body socket_write($socket, pack('CCnnCx', 1, 4, 1, 0, 0));</span></span></code> </pre> <br><h4 id="poluchenie-otveta-fcgi_params" style=";text-align:right;direction:rtl">  ุงูุญุตูู ุนูู ุงุณุชุฌุงุจุฉ ูู FCGI_PARAMS </h4><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ุจุนุฏ ุงูุงูุชูุงุก ูู ูู ูุง ุณุจู ุ ูุชู ุฅุฑุณุงู ูู ูุง ุชุชููุนู ุฅูู ุงูุชุทุจูู ุ ูุจุฏุฃ ุงูุนูู ููููููุง ุฃู ูุฃุฎุฐ ูุชูุฌุฉ ูุฐุง ุงูุนูู ููุท ูู ุงูููุจุณ. <br>  ุชุฐูุฑ ุฃูู ูู ุงูุฑุฏ ูุญุตู ุนูู ููุณ ุงูููุงุญุธุงุช ููุญุชุงุฌ ุฃูุถูุง ุฅูู ุชูุณูุฑูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุญุตู ุนูู ุงูุนููุงู ุ ููู ุฏุงุฆููุง 8 ุจุงูุช (ุณูู ูุณุชูู ุงูุจูุงูุงุช ุจุงูุจุงูุช) </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$buf = <span class="hljs-string"><span class="hljs-string">''</span></span>; $arrData = []; $len = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($len) { socket_recv($socket, $buf, <span class="hljs-number"><span class="hljs-number">1</span></span>, MSG_WAITALL); <span class="hljs-comment"><span class="hljs-comment">//   1       $arrData[] = $buf; $len--; } //      'CCnnCx' $protocol = unpack('C', $arrData[0]); $type = unpack('C', $arrData[1]); $id = unpack('n', $arrData[2] . $arrData[3]); $dataLen = unpack('n', $arrData[4] . $arrData[5])[1]; //   ,        (unpack  ,    ) $foo = unpack('C', $arrData[6]); var_dump($dataLen); //     </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ููููุง ูุทูู ุฌุณู ุงูุงุณุชุฌุงุจุฉ ุงููุณุชููุฉ ุ ุณููุนู ูุฑุงุกุฉ ุฃุฎุฑู ูู ุงูููุจุณ </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$buf2 = <span class="hljs-string"><span class="hljs-string">''</span></span>; $result = []; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($dataLen) { socket_recv($socket, $buf2, <span class="hljs-number"><span class="hljs-number">1</span></span>, MSG_WAITALL); $result[] = $buf2; $dataLen--; } var_dump(implode(<span class="hljs-string"><span class="hljs-string">''</span></span>, $result)); <span class="hljs-comment"><span class="hljs-comment">//       socket_close($socket);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุตูุญุฉ ุงููุง ุนููุช!  ูุฃุฎูุฑุง ูุฐุง! <br>  ูุงุฐุง ูุฏููุง ูู ุงูุฌูุงุจ ุ ุนูู ุณุจูู ุงููุซุงู ูู ูุฐุง ุงูููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$url = <span class="hljs-string"><span class="hljs-string">'/path/to/script.php'</span></span> <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูู ููุชุจ </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"My fcgi script"</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ูู ุงูุฌูุงุจ ูุญุตู ุนููู ูุชูุฌุฉ ูุฐูู </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/dq/pc/ox/dqpcox1zbmcutdzxxeh69i_hbsc.png" alt="ุตูุฑุฉ"></p><br><h3 id="itogi" style=";text-align:right;direction:rtl">  ุงููุชุงุฆุฌ </h3><br><p style=";text-align:right;direction:rtl">  ูู ุฃูุชุจ ุงููุซูุฑ ููุง ุ ูุฐุง ููุฏ ุฎุฑุฌ ุงูููุงู ุงูุทููู.  ุขูู ุฃููุง ุชุณุงุนุฏ ุดุฎุต ูุง.  ูุณุฃูุฏู ุงููุต ุงูููุงุฆู ููุณู ุ ุงุชุถุญ ุฃูู ุตุบูุฑ ุฌุฏูุง.  ุจุงูุทุจุน ุ ููููู ุงูููุงู ุจุจุนุถ ุงูุดูุก ูู ูุฐุง ุงููููุฐุฌ ุ ูููุณ ูุฏูู ุฎุทุฃ ูู ุงูุชุนุงูู ูุน ูู ูุฐุง ุ ูููู ูุง ูุญุชุงุฌ ุฅููู ุ ููู ุจุญุงุฌุฉ ุฅููู ููุซุงู ูุฅุธูุงุฑ ุงูุฃุณุงุณูุงุช. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุณุฎุฉ ุงููุงููุฉ ูู ุงูุจุฑูุงูุฌ ุงููุตู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $url = <span class="hljs-string"><span class="hljs-string">'/path/to/script.php'</span></span>; $env = [ <span class="hljs-string"><span class="hljs-string">'REQUEST_METHOD'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'SCRIPT_FILENAME'</span></span> =&gt; $url, ]; $service_port = <span class="hljs-number"><span class="hljs-number">9000</span></span>; $address = <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>; $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP); $result = socket_connect($socket, $address, $service_port); <span class="hljs-comment"><span class="hljs-comment">//  //     php-fpm //    ,   (    ), id ,   ,     socket_write($socket, pack('CCnnCx', 1, 1, 1, 8, 0)); //     // ,     socket_write($socket, pack('nCxxxxx', 1, 0)); $keyValueFcgiString = ''; foreach ($env as $key =&gt; $value) { //        //  128         $keyLen = strlen($key); $lenKeyChar = $keyLen &lt; 128 ? chr($keyLen) : pack('N', $keyLen); $valLen = strlen($value); $valLenChar = $valLen &lt; 128 ? chr($valLen) : pack('N', $valLen); $keyValueFcgiString .= $lenKeyChar . $valLenChar . $key . $value; } // ,      php-fpm           //      //1- ( ), 4-  (,    - FCGI_PARAMS), id  ( ),    (   -),     socket_write($socket, pack('CCnnCx', 1, 4, 1, strlen($keyValueFcgiString), 0)); //      socket_write($socket, $keyValueFcgiString); //  socket_write($socket, pack('CCnnCx', 1, 4, 1, 0, 0)); $buf = ''; $arrData = []; $len = 8; while ($len) { socket_recv($socket, $buf, 1, MSG_WAITALL); //   1       $arrData[] = $buf; $len--; } //      'CCnnCx' $protocol = unpack('C', $arrData[0]); $type = unpack('C', $arrData[1]); $id = unpack('n', $arrData[2] . $arrData[3]); $dataLen = unpack('n', $arrData[4] . $arrData[5])[1]; //   ,        (unpack  ,    ) $foo = unpack('C', $arrData[6]); $buf2 = ''; $result = []; while ($dataLen) { socket_recv($socket, $buf2, 1, MSG_WAITALL); $result[] = $buf2; $dataLen--; } var_dump(implode('', $result)); //       socket_close($socket);</span></span></code> </pre></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar472190/">https://habr.com/ru/post/ar472190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar472178/index.html">Holivar. ุชุงุฑูุฎ Runet. ุงูุฌุฒุก 7. ููุชููุจ: ุงูููููุฏููู ุ ุงูุตุฑูุฑ ููุงุฏู ุงูุณูููููู</a></li>
<li><a href="../ar472182/index.html">ุงูุฅุนูุงู ุนู .NET Core 3.1 Preview 1</a></li>
<li><a href="../ar472184/index.html">SSH ุนู ุจุนุฏ: ูุตุงุฆุญ ูุญูู</a></li>
<li><a href="../ar472186/index.html">ูุจุฏุฃ ููุชูุญ ูุบูู</a></li>
<li><a href="../ar472188/index.html">ูุง ุชุญุชุงุฌ ุฅูู ูุนุฑูุชู ุญูู ุงูุชุญูู ูู ูุชุฌุฑ ุงูุชุทุจููุงุช (ุฅูุตุงู ูุชุฌุฑ ุงูุชุทุจููุงุช)</a></li>
<li><a href="../ar472196/index.html">"ุณูุฑ" ูุญูู ุงูุตูุน ููุดุฑูุน ุฃูุฏุฑููุฏ ุฃู "ููู ูุง ููุนู ุฐูู"</a></li>
<li><a href="../ar472198/index.html">ุชูุทูู ุฑุณุงุฆู ุงูุฏูุน ูู ุชุทุจููุงุช ุงููุงุชู ุงููุญููู</a></li>
<li><a href="../ar472200/index.html">ุชุญุฏูุซ ูุฆุฉ ุนููู ุงูููุจููุชุฑ ูู ูุฏุฑุณุฉ ุฑูุณูุฉ ุจุชูุช ุงูุนููู: ุฑุฎูุต ููุจูุฌ</a></li>
<li><a href="../ar472202/index.html">Windows 10 + Python = VS Code + WSL</a></li>
<li><a href="../ar472204/index.html">ุชุฌุงุฑุจ ุจุณูุทุฉ ูุน ูุชุญูู STM32F103 (ุงูุฌูุงุฒ ุงูููุญู ุงูุฃุฒุฑู)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>