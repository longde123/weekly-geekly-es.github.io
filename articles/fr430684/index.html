<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æ üë∏ üçÇ Analyse des contrats Ethereum en direct pour une erreur d'envoi non contr√¥l√©. 2e partie üõ†Ô∏è üë®üèª‚Äçüî¨ üå∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suite de l'article ¬´Analyse des contrats Ethereum en direct pour l'erreur d'envoi non contr√¥l√©¬ª. Partie 1 " . 


 Il y a presque un an (alors qu'Ether...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analyse des contrats Ethereum en direct pour une erreur d'envoi non contr√¥l√©. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430684/"><h3></h3><p>  Suite de l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Analyse des contrats Ethereum en direct pour l'erreur d'envoi non contr√¥l√©¬ª.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1 "</a> . </p><br><p>  Il y a presque un an (alors qu'Ethereum √©tait dans sa version ¬´fronti√®re¬ª), le populaire contrat de loterie EtherPot <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[9] a</a> √©galement souffert de la m√™me erreur.  Une version ant√©rieure de BTCRelay a √©galement montr√© cette erreur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[7]</a> .  Bien qu'un danger ait √©t√© d√©tect√© lors d'un pr√©c√©dent audit de s√©curit√©, une correction incorrecte a d'abord √©t√© appliqu√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[8]</a> . </p><a name="habracut"></a><br><h3>  D√©tection d'erreur d'envoi non contr√¥l√© sur la blockhain en direct </h3><br><p> Quelle est la fr√©quence de ces erreurs?  √âcoutent-ils les avertissements?  Les meilleures pratiques sont-elles appliqu√©es?  Nous r√©pondons empiriquement √† ces questions en analysant les donn√©es de la cha√Æne de blocs Ethereum, ainsi que le r√©f√©rentiel de code Solidity trouv√© sur etherscrape.com.  Pour ce faire, nous d√©veloppons un outil d'analyse de programme simple qui v√©rifie le contrat de cha√Æne de blocs et utilise une heuristique pour v√©rifier si l'une des m√©thodes de protection les plus efficaces est utilis√©e.  Le listing 2 montre la premi√®re technique de s√©curit√©, comme recommand√© dans la documentation Ethereum, qui devrait v√©rifier la valeur de retour de <strong>send</strong> et lever une exception.  Pour d√©tecter l'utilisation de cette m√©thode, nous utilisons une approximation grossi√®re: il suffit de regarder si la valeur de retour de <strong>send est</strong> ignor√©e ou non. <br><br>  Le listing 4 illustre la deuxi√®me technique de s√©curit√© recommand√©e dans le manuel UMD, qui v√©rifie directement si la <strong>pile d'appels</strong> est <strong>pleine</strong> en envoyant un message de test.  Pour d√©couvrir cette technique, nous utilisons √† nouveau une approximation grossi√®re: nous v√©rifions simplement si un message est envoy√© en plus de la commande <strong>send</strong> . <br><br>  Si aucun de ces indicateurs heuristiques n'est pr√©sent, nous concluons qu'aucune des recommandations de meilleures pratiques n'est suivie.  Nous impl√©mentons ces heuristiques en utilisant une correspondance de mod√®le simple avec un bytecode EVM compil√©.  Plus de d√©tails sur la fa√ßon dont nous proc√©dons peuvent √™tre trouv√©s dans l'annexe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[12]</a> . </p><br><h3>  Combien de contrats sont vuln√©rables? </h3><br><p>  Commen√ßons par v√©rifier l'heuristique dans le r√©f√©rentiel Etherscrape du code source Solidity.  Au 20 mars 2016, le relais Etherscrape contenait 361 programmes de contrat Solidity, dont 56 contenaient une d√©claration d'envoi.  De ces programmes sous contrat, nous supposons que la plupart (au moins 36 sur 56) n'utilisent aucune des m√©thodes de programmation d√©fensive. <br><br>  M√™me si le contrat n'utilise aucune des technologies de protection, il peut ou non pr√©senter une r√©elle vuln√©rabilit√©.  Nous avons v√©rifi√© manuellement les contrats Solidity pour confirmer la vuln√©rabilit√©.  Pour nos besoins, nous consid√©rons un contrat vuln√©rable si son √©tat peut changer m√™me si la commande <strong>send</strong> ne fonctionne pas (nous allons donc regarder le code vuln√©rable dans le Listing 5).  Nous avons confirm√© que la grande majorit√© des vuln√©rabilit√©s sont pr√©sentes, 32 sur 36 de ces contrats. <br></p><br><p>  De m√™me, notre heuristique ne garantit pas l'application correcte de la programmation d√©fensive.  Prenons, par exemple, WeiFund, un DApp de crowdfunding open source d√©centralis√©.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://hackingdistributed.com/2016/06/16/scanning-live-ethereum-contracts-for-bugs/-%2520">Ce contrat</a> a deux fonctions: <strong>remboursement ()</strong> et <strong>paiement ()</strong> , ce qui trompe notre heuristique.  Ce qui suit est un extrait du <strong>remboursement</strong> . <br></p><br><p></p><pre><code class="plaintext hljs">function refund(uint _campaignID, uint contributionID) public { ... receiver.send(donation.amountContributed); donation.refunded = true; ... if(c.config != address(0)) WeiFundConfig(c.config).refund(_campaignID, donation.contributor, donation.amountContributed); }</code> </pre> <br><p>  Dans ce code, un message est envoy√© √† WeiFundConfig (c.config) pour invoquer la m√©thode de remboursement, mais uniquement sous certaines conditions.  Si c.config est une valeur nulle, le contrat est vraiment vuln√©rable √† une attaque par pile d'appels.  Lors de la v√©rification *, aucun des programmes Solidity qui ont r√©ussi nos tests heuristiques n'a appliqu√© directement la meilleure pratique de test de pile d'appels recommand√©e.  * <br><br>  Ensuite, nous tournons notre attention vers les projets de contrats sur la cha√Æne de blocs vivants Ethereum.  Nous avons regard√© l'image dat√©e du 20 mars 2016 (horodatage: 1184243).  Cet instantan√© contient un total de 13645 cha√Ænes de blocs, qui sont apparemment g√©n√©r√©es par le compilateur Solidity, dont seulement 1618 (11,8%) incluaient la commande d' <strong>envoi</strong> . <br><br>  Parmi ceux-ci, la grande majorit√© ne semble utiliser aucune des techniques de programmation d√©fensive. <br></p><br><p>  Qu'en est-il du probl√®me de course r√©cursive dans TheDAO?  Le contrat intelligent le plus excitant de nos jours, TheDAO <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[11]</a> , souffre d'une erreur compl√®tement distincte, √† savoir qu'il n'est pas ¬´s√ªr pour une r√©utilisation¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[13]</a> .  Il s'agit d'un autre type (connect√©, mais distinct) de programmation non s√©curis√©e, qui √©tait √©galement pr√©vu lors des pr√©c√©dents contr√¥les de s√©curit√© <a href="">[6]</a> , mais, comme auparavant, il est probable que de nombreux contrats ne sont pas s√ªrs aujourd'hui.  Les travaux futurs consistaient √† cr√©er un outil qui pourrait √©galement d√©tecter une telle erreur. <br></p><br><h3>  O√π tout s'est-il mal pass√©? </h3><br><p>  Nous ne nous attendons pas √† ce que la programmation sur les contrats intelligents soit compl√®tement simple, du moins pour l'instant.  Cependant, il est surprenant que cette forme particuli√®re d'erreur soit si r√©pandue, malgr√© le fait qu'elle ait √©t√© d√©crite il y a si longtemps lors du d√©veloppement de l'√©cosyst√®me Ethereum. <br><br>  Un rapport de 2015 <a href="">[6] a</a> fait cette recommandation aux d√©veloppeurs d'Ethereum: " <br><br>  Actuellement, les exemples de programmation pr√©sent√©s dans la documentation sont insuffisants pour diffuser les meilleures pratiques pour la r√©daction de contrats s√©curis√©s et la r√©solution du probl√®me du m√©canisme de gaz.  Les didacticiels d'introduction C ++ sautent souvent <br>  v√©rification des erreurs de lisibilit√©, qui a conduit √† de nombreuses erreurs de s√©curit√©.  Les exemples d'Ethereum devraient enseigner les meilleures habitudes.  Recommandation: fournir encore plus d'exemples de programmation minutieuse des contrats de s√©curit√©. " <br><br>  Nous ne connaissons qu'une seule r√©ponse officielle √† cette question, qui consiste √† ajouter un avertissement √† la documentation officielle de Solidity mentionn√©e pr√©c√©demment <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[3],</a> r√©p√©t√©e ci-dessous: 1024 (cela peut toujours √™tre appel√© par l'appelant), et √©choue √©galement si le destinataire manque de gaz, donc pour assurer une diffusion en toute s√©curit√©, v√©rifiez toujours la valeur de retour de l' <strong>envoi</strong> ou encore mieux: utilisez le mod√®le  dans lequel le destinataire retire de l'argent. " </p><br><p>  Nous pensons que cette observation n'est pas suffisante pour documenter le probl√®me.  Il n'offre qu'une att√©nuation incompl√®te et ne d√©crit qu'une seule version du danger, ce qui pourrait induire le lecteur en erreur quant √† son degr√©. </p><br><ul><li><p>  Mise √† jour: <br>  L'insuffisance de la documentation de Solidity a √©galement √©t√© illustr√©e en d√©tail par Peter Wesenes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[16]</a> </p><br></li></ul><p>  De plus, l'avertissement semble souvent ignor√©.  Par cons√©quent, nous pensons que des mesures pr√©ventives suppl√©mentaires sont n√©cessaires. </p><br><br><h3>  Comment Etherscrape peut-il aider? </h3><br><p>  Nous pensons que l'utilisation d'outils d'analyse statique, m√™me grossiers, tels que ceux d√©crits dans cet article, peut aider √† am√©liorer la qualit√© des contrats intelligents. Chez Etherscrape, nous int√©grons des outils d'analyse comme celui-ci dans notre service Web public, et nous ajoutons un lien vers la page de l'outil quand elle sera pr√™te.  Cela facilitera la visualisation du code de contrat intelligent en mettant en √©vidence les endroits o√π des erreurs peuvent se produire.  Nous supposons que les utilisateurs d'un tel contrat intelligent (par exemple, les investisseurs potentiels dans TheDAO ou ses offres) peuvent facilement utiliser des outils tels que la v√©rification de l'int√©grit√© avant de d√©poser leur argent.  M√™me les investisseurs non techniques peuvent tenir les d√©veloppeurs responsables pour expliquer comment ils ont r√©agi aux probl√®mes not√©s dans le code. <br><br>  Etherscrape aide √©galement en analysant la cha√Æne de blocs publique et en contr√¥lant la pr√©valence de cette erreur, ce qui peut aider √† d√©cider, par exemple, combien d'argent doit √™tre allou√© pour la recherche et le d√©veloppement d'outils d'analyse statique.  De plus, des compilateurs tels que <strong>solc</strong> peuvent int√©grer de telles analyses, pr√©venant le programmeur lorsqu'une erreur semble probable. <br></p><br><h3>  Lecture recommand√©e </h3><br><ul><li>  [1] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âtape par √©tape vers la cr√©ation d'un contrat intelligent et s√ªr</a> <br></li><li>  [2] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide du programmeur UMD sur Ethereum et Serpent (Section 5.14)</a> <br></li><li>  [3] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documents officiels de Solidarit√© Ethereum</a> <br></li><li>  [4] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Roi de l'√©ther: enqu√™te post-mortem</a> <br></li><li>  [5] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Swende sur la s√©curit√© des contrats</a> <br></li><li>  [6] <a href="">Audit de la moindre autorit√© d'Ethereum</a> <br></li><li>  [7] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Audit du relais BTC 1</a> <br></li><li>  [8] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Audit du relais BTC 2</a> <br></li><li>  [9] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rapport de bogue de s√©curit√© EtherPot</a> <br></li><li>  [10] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contrats r√©entrants</a> <br></li><li>  [11] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La DAO (Organisation Autonome D√©centralis√©e)</a> <br></li><li>  [12] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Annexe A: D√©tails sur la fa√ßon dont nous analysons la blockchain</a> <br></li><li>  [13] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un appel pour un moratoire temporaire sur le DAO</a> <br></li><li>  [14] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Annexe B: Contrats de solidit√© vuln√©rables</a> <br></li><li>  [15] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Annexe C: Contrats de blockchain vuln√©rables</a> <br></li><li>  [16] <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Deuil d'Ethereum</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Portefeuilles: envoyer avec lancer est dangereux</a> <br></li></ul><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430684/">https://habr.com/ru/post/fr430684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430674/index.html">La logique de construction d'horaires de travail universels</a></li>
<li><a href="../fr430676/index.html">Antiquit√©s: shshshsh, sssssss, VOIP, BBS et autres amis du modem</a></li>
<li><a href="../fr430678/index.html">Test de dix gradateurs avec lampes LED</a></li>
<li><a href="../fr430680/index.html">√âcrire un processeur et un environnement simples pour cela</a></li>
<li><a href="../fr430682/index.html">Trois ans du projet de microsatellites lunaires: √©tapes de la croissance</a></li>
<li><a href="../fr430686/index.html">Pr√©sentation: la premi√®re machine de d√©coupe au jet d'eau de WAZER</a></li>
<li><a href="../fr430688/index.html">Transfert de donn√©es via QR anim√© vers Gomobile et GopherJS</a></li>
<li><a href="../fr430690/index.html">Exceptions d√©terministes et gestion des erreurs dans le ¬´C ++ du futur¬ª</a></li>
<li><a href="../fr430692/index.html">Ing√©nierie sociale avec le logiciel Universal Windows Platform (APPX)</a></li>
<li><a href="../fr430694/index.html">Un petit guide pour apprendre le C ++: quoi, quand et sur quoi cr√©er</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>