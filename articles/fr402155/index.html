<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎳 🤶🏻 🧑 Variateur puissant à quatre canaux pour LED 🏪 🕴🏽 🗂️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je vais parler du projet d'un puissant gradateur à quatre canaux pour bandes et lampes LED (jusqu'à 200 watts de puissance totale, 5...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Variateur puissant à quatre canaux pour LED</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402155/">  Dans cet article, je vais parler du projet d'un puissant gradateur à quatre canaux pour bandes et lampes LED (jusqu'à 200 watts de puissance totale, 50..100 watts par canal) avec une fréquence élevée de régulation PWM (1 kilohertz avec une profondeur de couleur de 10 bits), pour un éclairage de haute qualité .  De plus, il possède une entrée pour le capteur de lumière, des fonctions de rétroaction (délivrant au contrôleur des informations sur la tension d'entrée, la tension aux entrées de mesure, etc.) et même une isolation galvanique du port de contrôle série. <br><br><img src="https://habrastorage.org/files/34a/40c/43c/34a40c43cea94d2c86d0a577633c5993.JPG"><br><a name="habracut"></a><br>  Il se trouve que j'ai décidé de changer de profil et de m'occuper des microcontrôleurs et de l'automatisation, et après quelques mois, j'ai reçu une offre tentante de faire une «maison intelligente» en République dominicaine, de sorte que presque tous les aspects de la vie d'une assez grande villa de trois grandes sont gérés et automatisés. bâtiments, de l'éclairage et du climat, aux robots de jardin et aux systèmes d'irrigation.  Comme j'étais fatigué de la neige et du gel pendant longtemps, il était impossible de rejeter une telle offre, d'autant plus qu'ils m'ont beaucoup aidé à bouger et à m'adapter. <br><br>  Bien sûr, l'une des tâches les plus cruciales consiste à contrôler l'éclairage, à la fois dans de nombreuses pièces et à l'extérieur.  Afin d'économiser l'énergie qui est chère ici, les bandes LED et les lampes 12 volts seront utilisées presque partout, qui doivent être contrôlées à l'aide de gradateurs.  Les modèles de gradateurs existants n'étaient pas très satisfaisants à tous égards (une fréquence de régulation suffisamment élevée, pour l'absence de scintillement; puissance, pour contrôler de longues bandes lumineuses ou des lampes / spots; protocoles d'échange fermés, etc.).  J'ai donc décidé de faire mon gradateur. <br><br>  Un point très sensible au stade de la conception a été le choix d'obtenir une alimentation basse tension à partir de 110 volts de courant alternatif.  Nous avons même envisagé une version exotique avec un abaisseur sans transformateur immédiatement jusqu'à 12 volts, mais pour des raisons de sécurité électrique et d'incendie, elle a été rejetée.  Les alimentations prêtes à l'emploi 110-&gt; 12 n'étaient pas si chères (20 $ pour 120 watts et 40 $ pour 200), bien que dans l'ensemble.  Mais, heureusement, il y avait beaucoup d'espace pour l'équipement, alors j'ai opté pour cette option. <br><br>  Le circuit s'est avéré relativement simple (à l'exception du nœud d'isolation galvanique du port série sur quatre optocoupleurs) - le microcontrôleur STM32F030F4P6, deux pilotes MOSFET ADP3624 et les transistors à clé IRLB8748, sélectionnés avec une grande marge (avec une charge de 100 watts par canal - ils étaient à peine chauds) , plus un module abaisseur pulsé chinois prêt à l'emploi à 3,3 volts.  Les pilotes sélectionnés vous permettent de contrôler à des fréquences allant jusqu'à mégahertz, ce qui donne la fréquence de la tension de sortie en kilohertz, avec un pas PWM d'une microseconde.  En pratique, même un mode avec une fréquence PWM de huit kilohertz et un pas de 125 nanosecondes a été testé, mais en pratique, une fréquence d'ajustement aussi élevée menace une certaine instabilité à la sortie - les transistors peuvent simplement ne pas avoir le temps de se fermer si rapidement et la qualité de l'ajustement «flottera». <br><br> <a href=""><img src="https://habrastorage.org/files/066/0b3/8bb/0660b38bbd6f408894a90839f6ce3407.png" width="900"></a> <br><br>  Le câblage de la carte pour des courants aussi élevés était un défi assez difficile pour moi, je n'avais jamais rencontré de telles tâches auparavant.  Il a été décidé de les rendre aussi larges que possible (un conducteur d'une largeur d'au moins 10 mm sur une couche de 70 microns de cuivre), et lorsque cela n'est pas possible, utiliser la deuxième couche, en les combinant avec un grand nombre de vias.  J'ai retiré le masque des conducteurs à haute charge afin que, si nécessaire, un bus en cuivre puisse être appliqué sur le dessus (mais cela n'était pas nécessaire, même avec une charge maximale de 200 watts - la carte chauffe jusqu'à à peine 40 degrés dans un boîtier fermé). <br><br>  Le protocole d'échange, faute de mémoire flash, a été choisi extrêmement simple, les commandes sont envoyées ligne par ligne, sous la forme du texte "0: 512" (canal zéro, PWM 512), les données de sortie sont transmises de la même manière (tension, données de la première photorésistance, données de la deuxième photorésistance, tension d'entrée à l'entrée ADC3, tension d'entrée à l'entrée ADC5, tension d'alimentation du contrôleur, température de la puce).  Il serait plus correct d'utiliser le protocole MQTT, mais j'avais peur qu'il ne rentre pas dans le flash (les kilo-octets d'espace libre restaient sur 16). <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code source sur github</a> <br><br>  Un variateur est flashé via le même port de contrôle (vous devez appliquer une unité à la 4e broche, puis une impulsion à la 5e, après quoi le microcontrôleur peut être chargé en utilisant le protocole série standard STM32. Pour contrôler un gradateur déjà flashé, trois fils suffisent, + 3,3 / + 5 V sur la première broche, les données sur la troisième, sur la sixième - la terre.Les paramètres du port de contrôle dans le firmware sont 38400 bauds, 8n1. <br><br>  Bien sûr, la première version du variateur n'était pas sans défauts.  Il s'est avéré qu'un condensateur de 470 microfarads par 12 volts ne suffit pas, il chauffe trop avec une charge lourde (surtout si les fils de l'alimentation sont minces pour de tels courants), nous devons en ajouter quelques-uns plus puissants (en fonction du courant maximal autorisé).  Le module d'alimentation chinois s'est également avéré être une solution infructueuse, l'un des modules a échoué pendant les tests sans aucune raison apparente, je le remplacerai par un convertisseur sur TPS62177, en plus j'ajouterai également un autre convertisseur optionnel sur AP1501 (24-&gt; 12), pour le cas de l'alimentation du variateur à partir de 24 volts.  Eh bien, vous aurez besoin d'un circuit de commande pour un ventilateur de 120 mm pour l'alimentation (dans les cas où la charge est proche du maximum), avec contrôle thermique et réglable en continu.  J'ai également décidé de remplacer l'isolement galvanique complexe du port de contrôle par la puce SI8641. <br><br>  Il y a des problèmes dans la partie logicielle - parfois la lecture depuis le port série se bloque, le contrôle du blocage (l'expérience avec STM32 n'est pas encore très grande pour moi), et le protocole s'est avéré trop idiot, j'essaierai peut-être de remplir un MQTT normal là-bas. <br><br>  Voici un exemple d'utilisation d'un gradateur sur un banc d'essai (ma porte d'entrée), avec un capteur de distance IR (la couleur et la luminosité de la bande RGBW sont réglables, en fonction de la distance, via openhab): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/knXuq3a6p4M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Dans le prochain article, je parlerai d'une unité de commutation à quatre canaux de charges CA de huit kilowatts avec des relais bistables (pour réduire l'énergie consommée en vain) en mesurant la consommation de courant sur chaque canal. <br><br>  Eh bien, je vais terminer sur une note positive.  Il s'est avéré qu'en République dominicaine, 99% d'alcool isopropylique ou éthylique ne peuvent pas être trouvés pour laver les circuits imprimés (et aussi l'essence pure).  Vous pouvez trouver 70% mélangé évidemment pas avec de l'eau distillée, laissant des taches.  Et vous pouvez toujours facilement trouver 99,6% de méthyle (je ne sais pas pourquoi ils le vendent du tout, c'est même effrayant de l'utiliser comme solvant - vous pouvez respirer par paires).  J'ai décidé d'essayer de rincer la première carte de gradateur avec de l'eau distillée, que j'ai achetée dans un magasin d'articles ménagers.  Heureusement, je n'ai pas réalisé l'idée de vérifier la qualité du distillat pour le goût.  Mais le circuit imprimé et l'évier galvanisé n'aimaient vraiment pas quand je les versais avec de l'électrolyte de batterie (des bouteilles d'eau se tenaient sur l'étagère avec, évidemment j'ai attrapé le mauvais quand je l'ai mis dans le panier) ... <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr402155/">https://habr.com/ru/post/fr402155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr402145/index.html">Poursuivant le thème «Cancer. Que faire avec ça ... "</a></li>
<li><a href="../fr402147/index.html">IBM a enregistré un seul bit d'information dans un atome</a></li>
<li><a href="../fr402149/index.html">Intel XMM 7560 - Gigabit Over the Air</a></li>
<li><a href="../fr402151/index.html">Notaire numérique Blockchain: Emercoin DPO Antifake</a></li>
<li><a href="../fr402153/index.html">"On trie" la maison imprimée</a></li>
<li><a href="../fr402157/index.html">Chris Kaspersky est décédé. En mémoire d'un vrai hacker</a></li>
<li><a href="../fr402159/index.html">Classement en février des développements scientifiques les plus médiatiques</a></li>
<li><a href="../fr402161/index.html">Les éditeurs de logiciels corrigent massivement les vulnérabilités utilisées par la CIA</a></li>
<li><a href="../fr402163/index.html">Mise à jour de l'histoire de Steve Jobs</a></li>
<li><a href="../fr402165/index.html">Le plus grand «dôme» de la science d'Istra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>