<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💠 🚋 🗡️ Comment voir rapidement les avertissements intéressants générés par l'analyseur PVS-Studio pour le code C et C ++? 🚫 💷 🦌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De temps en temps, les programmeurs qui commencent à se familiariser avec l'analyseur de code PVS-Studio demandent: "Existe-t-il une liste d'avertisse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment voir rapidement les avertissements intéressants générés par l'analyseur PVS-Studio pour le code C et C ++?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/457332/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df3/c29/8f2/df3c298f21cb71d0c7c699b7e27269d3.png"></div><br>  De temps en temps, les programmeurs qui commencent à se familiariser avec l'analyseur de code PVS-Studio demandent: "Existe-t-il une liste d'avertissements qui indiquent avec précision les erreurs?"  Il n'y a pas une telle liste pour la raison que des avertissements (faux) sans intérêt dans un projet et dans un autre s'avèrent très importants et utiles.  Cependant, commencer à se familiariser avec l'analyseur avec les avertissements les plus intéressants est tout à fait possible.  Examinons de plus près ce sujet. <br><a name="habracut"></a><br>  L'ennui, c'est que lors des premiers lancements, le programmeur reçoit en règle générale un grand nombre d'avertissements dans lesquels il «se noie».  Naturellement, il a envie de se familiariser avec les avertissements les plus intéressants afin de comprendre s'il doit passer tout ce temps.  Très bien, voici trois étapes simples qui vous permettront de vous familiariser avec les points positifs les plus intéressants. <br><br><h2>  Étape 1 </h2><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/648/436/d98/648436d98521380495f1c9f8ee384646.png"></div><br><br>  Désactivez tous les types d'alertes à l'exception de général (GA).  Une erreur courante: activez toutes sortes d'avertissements.  Pour les utilisateurs inexpérimentés, il semble que plus vous l'allumez, mieux c'est.  Ce n'est pas le cas!  Il existe des ensembles de diagnostics, tels que les contrôles 64 bits et les règles MISRA, qui ne doivent être utilisés qu'avec une idée claire de ce que c'est et de la façon de les utiliser.  Par exemple, en activant les diagnostics MISRA pour un programme d'application ordinaire, vous vous noyerez dans des dizaines, des milliers ou des centaines de milliers de messages comme: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V2506</a> .  Misra.  Une fonction doit avoir un seul point de sortie à la fin. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V2507</a> .  Misra.  Le corps d'une instruction loop \ conditional doit être placé entre accolades. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V2523</a> .  Misra.  Toutes les constantes entières de type non signé doivent avoir le suffixe «u» ou «U». </li></ul><br>  La plupart des avertissements MISRA n'indiquent pas d'erreurs, mais le code sent.  Naturellement, une personne commence à poser des questions.  Comment trouver quelque chose d'intéressant dans la masse de tous ces avertissements?  Diagnostics sous quels numéros doit-il regarder?  Ce ne sont pas les bonnes questions.  Il vous suffit de désactiver le kit MISRA.  Il s'agit de la norme pour écrire du code de qualité pour les appareils intégrés.  L'essence de la norme: rendre le code extrêmement simple et compréhensible.  N'essayez pas de l'appliquer là où il est inapproprié. <br><br>  Remarque  Oui, il existe des règles dans la norme MISRA visant à identifier les erreurs réelles.  Exemple: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V2538</a> - La valeur de la variable non initialisée ne doit pas être utilisée.  Mais n'ayez pas peur de désactiver la norme MISRA.  Vous ne perdrez rien.  De vraies erreurs seront toujours trouvées dans les diagnostics à usage général (GA).  Par exemple, une variable non initialisée sera trouvée grâce au diagnostic <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V614</a> . <br><br><h2>  Étape 2 </h2><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f30/9c1/d2f/f309c1d2fed7a2736170dad987cd4460.png"></div><br><br>  Tout analyseur statique génère des faux positifs lors des premiers démarrages et nécessite une certaine configuration.  Rien ne peut être fait avec cela, mais ce n'est pas aussi effrayant que cela puisse paraître.  Même une simple configuration rapide vous permet de supprimer la plupart des faux avertissements et de commencer à vous familiariser avec un rapport déjà tout à fait adéquat.  Nous n'en parlerons pas plus en détail, car j'en ai souvent parlé, par exemple, dans cet article: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Caractéristiques de l'analyseur PVS-Studio utilisant l'exemple EFL Core Libraries, 10 à 15% de faux positifs</a> ." <br><br>  Passez un peu de temps à désactiver les avertissements explicitement non pertinents et à combattre les faux positifs dus aux macros.  Les macros sont généralement la principale source de faux positifs, car un avertissement apparaît chaque fois qu'une macro défaillante est utilisée.  Pour supprimer les avertissements dans les macros, un type spécial de commentaires peut être placé à côté de leur déclaration.  Le format de rédaction des commentaires est décrit plus en détail dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . <br><br>  Oui, la configuration initiale prendra un peu de temps, mais améliorera considérablement la perception du rapport en éliminant le bruit gênant.  Prenez un peu de temps pour cela.  En cas de difficultés ou de questions, nous sommes toujours prêts à vous aider et à suggérer la meilleure façon de configurer l'analyseur.  N'hésitez pas à nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">écrire</a> et à nous poser des questions. <br><br><h2>  Étape 3 </h2><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f87/0ec/c49/f870ecc49989743ae8caea3c745e602e.png"></div><br><br>  Commencez à apprendre les avertissements à partir du niveau 1.  Et alors seulement, regardez 2 et 3. Les niveaux d'avertissement ne sont rien de plus que la fiabilité de l'avertissement.  Les avertissements de niveau 1 sont plus susceptibles d'indiquer une véritable erreur que 2. <br><br>  On peut dire qu'en choisissant «regarder niveau 1», vous appuyez sur le bouton «regarder les erreurs les plus intéressantes». <br><br>  La classification des alertes PVS-Studio par niveaux est décrite plus en détail dans l'article « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment et pourquoi les analyseurs statiques traitent les faux positifs</a> ». <br><br><h2>  Alors pourquoi n'y a-t-il toujours pas de liste? </h2><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df2/95f/70b/df295f70b19562c12916ec578022829f.png"></div><br><br>  Cependant, une idée avec une liste des avertissements les plus utiles peut encore sembler raisonnable.  Permettez-moi de montrer par un exemple pratique que l'utilité du diagnostic est relative et dépend du projet. <br><br>  Considérez l'avertissement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V550</a> .  Un avertissement révèle une erreur potentielle due au fait que l'opérateur == ou! = Est utilisé pour comparer les nombres à virgule flottante. <br><br>  La plupart des développeurs avec qui j'ai parlé croient que ce diagnostic est de peu d'utilité et le désactivent, car tous les points positifs de leur projet sont faux.  Et c'est pourquoi ce diagnostic est peu fiable et se situe au 3ème niveau. <br><br>  En effet, dans la plupart des applications, les types float / double sont utilisés dans des algorithmes très simples.  Et souvent, une comparaison avec une constante est utilisée uniquement pour vérifier si une valeur par défaut est définie ou si elle a changé.  Dans ce cas, une vérification précise est tout à fait appropriée.  Je vais expliquer cela avec un pseudo-code. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> value = <span class="hljs-number"><span class="hljs-number">1.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsUserInputNewValue()) value = GetUserValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value == <span class="hljs-number"><span class="hljs-number">1.0f</span></span>) DefaultBehavior(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Foo(value);</code> </pre> <br>  Ici, la comparaison <i>(valeur == 1.0f) est</i> correcte et sûre. <br><br>  Est-ce à dire que le V550 est un diagnostic sans intérêt?  Non.  Tout dépend du projet.  Je citerai un fragment de l'article " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment nous avons testé l'analyse statique sur notre projet de simulateur d'entraînement à la chirurgie endovasculaire</a> ", écrit par l'un de nos utilisateurs. <br><br>  Donc, ce que l'analyseur statique attire notre attention ici: <br><br>  V550 Une comparaison étrange et précise: t! = 0. Il est probablement préférable d'utiliser une comparaison avec une précision définie: fabs (A - B)&gt; Epsilon.  objectextractpart.cpp 3401 <br><br><pre> <code class="cpp hljs">D3DXVECTOR3 N = VectorMultiplication( VectorMultiplication(V-VP, VN), VN); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = Qsqrt(Scalar(N, N)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { N/=t; V = V - N * DistPointToSurface(V, VP, N); }</code> </pre> <br>  Des erreurs similaires sont répétées assez souvent dans cette bibliothèque.  Je ne dirai pas que cela m'a surpris.  Déjà auparavant, j'ai rencontré un travail incorrect avec des nombres à virgule flottante dans ce projet.  Cependant, il n'y avait pas de ressources pour vérifier systématiquement les sources pour cela.  Selon les résultats de la vérification, il est devenu clair que vous devez donner au développeur quelque chose à lire pour élargir ses horizons en termes de travail avec les nombres à virgule flottante.  Je lui ai jeté des liens vers quelques bons articles.  Regardons le résultat.  Il est difficile de dire sans ambiguïté si cette erreur provoque de véritables dysfonctionnements dans le programme.  La solution actuelle définit un certain nombre d'exigences pour le réseau polygonal initial des artères, le long desquelles la propagation d'une substance radio-opaque est simulée.  Si les exigences ne sont pas remplies, le programme peut se bloquer ou, de toute évidence, fonctionner incorrectement.  Certaines de ces exigences sont obtenues analytiquement et d'autres empiriquement.  Il est possible que cette deuxième partie des exigences se développe simplement à partir d'un travail incorrect avec des nombres à virgule flottante.  Il convient de noter que tous les cas trouvés d'utilisation d'une comparaison exacte des nombres à virgule flottante n'étaient pas une erreur. <br><br>  Comme vous pouvez le voir, ce qui n'est pas intéressant dans certains projets intéresse d'autres.  Il est donc impossible de créer une liste des "plus intéressants". <br><br>  Remarque  Il est possible de définir le niveau d'avertissement à l'aide des paramètres.  Par exemple, si vous pensez que les diagnostics du V550 méritent une attention particulière, vous pouvez le déplacer du troisième niveau au premier.  Ce type de paramètres est décrit dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> (voir "Comment définir votre niveau pour des diagnostics spécifiques"). <br><br><h2>  Conclusion </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/d9e/ecd/37dd9eecd44e33d66c2993ad552e11f7.png"></div><br><br>  Vous savez maintenant comment commencer à étudier les avertissements de l'analyseur, en considérant les plus intéressants d'entre eux.  Et n'oubliez pas de consulter la documentation pour vous familiariser avec la description détaillée des avertissements.  Parfois, il arrive que derrière un manque de préjugé, à première vue, l'avertissement est l'enfer.  Un exemple de tels diagnostics: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V597</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V1026</a> .  Merci de votre attention. <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br>  Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Andrey Karpov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment vérifier rapidement les avertissements intéressants donnés par l'analyseur PVS-Studio pour le code C et C ++?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457332/">https://habr.com/ru/post/fr457332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457316/index.html">Comment le jeu de rôle dans le monde réel est organisé pour les invités d'Arménie avec des voyages dans la moitié du pays</a></li>
<li><a href="../fr457324/index.html">Événements numériques à Moscou du 24 au 30 juin</a></li>
<li><a href="../fr457326/index.html">Cluster de basculement PostgreSQL + Patroni. Expérience de mise en œuvre</a></li>
<li><a href="../fr457328/index.html">Catégories au lieu de répertoires, ou le système de fichiers sémantique pour Linux</a></li>
<li><a href="../fr457330/index.html">Comment vérifier rapidement les avertissements intéressants donnés par l'analyseur PVS-Studio pour le code C et C ++?</a></li>
<li><a href="../fr457334/index.html">TacacsGUI, Configuration Manager</a></li>
<li><a href="../fr457336/index.html">Les conséquences du retrait prématuré des dents de sagesse</a></li>
<li><a href="../fr457338/index.html">Blitz avec Ilya Krasinsky: comment tirer les mauvaises hypothèses, pourquoi rejeter un produit et comment grandir pour un minimum d'action?</a></li>
<li><a href="../fr457340/index.html">10 plugins PostCSS qui vous feront gagner du temps de mise en page</a></li>
<li><a href="../fr457342/index.html">Signes d'en haut: comment nous avons sauvé les cartographes du travail inutile et des yeux rouges</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>