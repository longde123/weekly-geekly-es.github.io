<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧙🏻 👨🏾‍🎨 🥐 Otomasi dengan Pebble yang nyaman, Noolite yang stabil, dan esp8266 yang terjangkau ➖ 🏟️ 🧑🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sejak artikel terakhir ( tautannya berjalan hampir setahun. Dan selama tahun ini, saya memikirkan kembali beberapa hal, Internet dan ternyata sesuatu ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otomasi dengan Pebble yang nyaman, Noolite yang stabil, dan esp8266 yang terjangkau</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403273/">  Sejak artikel terakhir ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautannya</a> berjalan hampir setahun. Dan selama tahun ini, saya memikirkan kembali beberapa hal, Internet dan ternyata sesuatu seperti IoT :) → Internet of things). <br><br>  Saya akan mencoba merangkum bagian baru dari akumulasi pengetahuan, menjelaskan di mana saya berusaha dan apa yang ingin saya capai → Saya meminta Anda untuk membacanya. <br><a name="habracut"></a><br><h2>  Noolite F v2.0 </h2><br>  <b>Dalam tajuk utama, saya mendapatkan kata-kata: pebble &amp; noolite.</b>  <b>Mari kita beralih ke mereka!</b> <br>  Saya masih mengelola dengan kerikil, lampu, garasi, dan gerbang noolit saya.  Cukup banyak informasi bermanfaat yang telah ditulis tentang noolite, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pencarian</a> menunjukkan artikel baru. <br><br>  Selain unit generasi pertama dari sistem noolite, saya memiliki yang baru: unit daya SLF-1-200 (nooLite-F) dengan umpan balik ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dan enkripsi generasi baru</a> ). <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/312/be1/be5/312be1be5d922ebcc46d307015f01eb0.png" alt="gambar"><br><br>  blok daya SB-1-150 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/0a1/575/b81/0a1575b813bdd72fa22800bf8b33374d.png" alt="gambar"><br><br>  dan adaptor USB yang diperbarui MTRF-64 USB. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/61e/842/1de/61e8421deaa8155d33aba9f064002a3b.png" alt="gambar"><br><br>  Semua cahaya di rumah saya pada sistem noolite. <br><br>  Sampai baru-baru ini, saya memiliki adaptor USB generasi pertama dengan 16 perangkat dan sekarang 64 saluran (MTRF-64 USB) di "system home cramp", dan juga untuk perangkat generasi baru dengan umpan balik (noolite F).  Tetapi teknologi bergerak ke arah yang benar, menciptakan perangkat baru dan modern. <br><br>  <b>Ada 2 opsi paling penting untuk perangkat baru: umpan balik dan prinsip mengidentifikasi perangkat berdasarkan alamat: ID.</b>  Sekarang Anda tidak perlu menulis perangkat ke saluran 1 dan mengontrol saluran.  Sekarang Anda dapat mengakses perangkat tertentu dalam satu saluran dengan ID-nya dan mengirimkannya perintah eksekusi. <br><br>  Dokumentasi untuk blok generasi baru <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia</a> di situs web pabrikan. <br><br><div class="spoiler">  <b class="spoiler_title">Semuanya berfungsi melalui port serial menggunakan kode python.</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- #!/usr/bin/env python import serial import time class NooLiteCommand: def __init__(self, ch, cmd, mode=0, ctr=0, res=0, fmt=0, d0=0, d1=0, d2=0, d3=0, id0=0, id1=0, id2=0, id3=0): self.st = 171 self.mode = mode self.ctr = ctr self.res = res self.ch = ch self.cmd = cmd self.fmt = fmt self.d0 = d0 self.d1 = d1 self.d2 = d2 self.d3 = d3 self.id0 = id0 self.id1 = id1 self.id2 = id2 self.id3 = id3 self.sp = 172 @property def crc(self): crc = sum([ self.st, self.mode, self.ctr, self.res, self.ch, self.cmd, self.fmt, self.d0, self.d1, self.d2, self.d3, self.id0, self.id1, self.id2, self.id3, ]) return crc if crc &lt; 256 else divmod(crc, 256)[1] def to_bytes(self): return bytearray([ self.st, self.mode, self.ctr, self.res, self.ch, self.cmd, self.fmt, self.d0, self.d1, self.d2, self.d3, self.id0, self.id1, self.id2, self.id3, self.crc, self.sp ]) class NooliteSerial: def __init__(self, tty_name): self.tty = self._get_tty(tty_name) def on(self, ch): self.send_command(ch, 2, 2, 0) pass def off(self, ch): self.send_command(ch, 0, 2, 0) pass def status(self, ch): m = self.send_command(ch, 128, 2, 0) pass def send_command(self, ch, cmd, mode=0, ctr=0, res=0, fmt=0, d0=0, d1=0, d2=0, d3=0, id0=0, id1=0, id2=0, id3=0): command = NooLiteCommand(ch, cmd, mode, ctr, res, fmt, d0, d1, d2, d3, id0, id1, id2, id3) self.tty.write(command.to_bytes()) while True: bytes_response = list(self.tty.read(117)) if bytes_response: all_responses.append(bytes_response) if bytes_response[3] == 0: break else: break return all_responses @staticmethod def _get_tty(tty_name): serial_port = serial.Serial(tty_name, timeout=0.1) if not serial_port.is_open: serial_port.open() serial_port.flushInput() serial_port.flushOutput() return serial_port noo_serial = NooliteSerial('/dev/ttyUSB0') #ch, cmd, mode, ctr #noo_serial.send_command(1, 15, 2, 0) #    1 #noo_serial.send_command(0, 4, 2, 0) #switch #noo_serial.send_command(0, 2, 2, 0) #turn on #noo_serial.send_command(0, 3, 2, 0) #   #noo_serial.send_command(0, 0, 2, 0) #turn off #noo_serial.send_command(0, 15, 2, 0) #  #noo_serial.send_command(0, 128, 2, 0,0,1) #CMD_Read_State + fmt = 1 #noo_serial.on(0) #noo_serial.status(0) #noo_serial.off(0) #noo_serial.off(0) #noo_serial.status(0) #noo_serial.send_command(ch=0,ctr=8, cmd=4, id0=0,id1=0,id2=48,id3=114) #switch noolite ID 0.0.48.114</span></span></code> </pre> <br></div></div><br>  Menggunakan fungsi yang diperlukan pada waktu yang tepat, kita dapat mengontrol blok noolite dan menerima status dari yang baru.  Karena saya memiliki 99% dari blok lama ini, saya tetap menggunakan skema lama yaitu merekam 1 blok dalam 1 saluran, dengan mempertimbangkan fakta bahwa adaptor usb mendukung blok lama dan baru (terima kasih kepada pengembang untuk kompatibilitas tanpa menari rebana).  Dengan cepat, Anda dapat mengelola dan menerima status blok baru dan mengelola yang lama. <br><br>  Sampai saat ini, tidak ada saklar tombol tunggal di rumah.  Saya harus menambahkan cahaya ke garasi (saya baru saja sampai di sana untuk membereskan: D), dan juga sebuah saklar muncul di lampu latar cermin rias.  Mengetahui bahwa ada <b>unit daya SB-1-150</b> , saya mengatur saklar normal dan menghubungkan unit.  Lampu belakang cermin terbuat dari plat putih, bola lampu 3w 4000 K, cahaya putih.  SB-1-150 unik karena dapat ditempatkan di dalam kotak sakelar dinding (sakelar) dalam konteks sirkuit yang ada dan dengan menghubungkan sakelar tombol tekan ke unit itu sendiri. <br><br><div class="spoiler">  <b class="spoiler_title">Persis apa yang dibutuhkan gadis-gadisku untuk makeup :)</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/63d/97d/4ff/63d97d4ff9ed73ee3fe00abba6a94fed.png" alt="gambar"><br></div></div><br><h2>  Kerikil </h2><br>  Ketika saya mulai terlibat dalam otomatisasi, salah satu faktor utama adalah: manajemen yang kompeten dan nyaman. <br><br>  Tampaknya nyaman untuk dikendalikan dari smartphone, tetapi ... dan tidak nyaman memuat aplikasi setiap saat, di mana ada tombol kecil yang tidak nyaman, iklan tangan kiri, atau sampai Anda menekan tombol ... semua keinginan menghilang.  Kontrol suara menghilang, karena juga merepotkan dan aneh :) - biarkan tetap di plot film fiksi ilmiah. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5ea/226/ba7/5ea226ba78a2e6fb2e61a63458aa88af.png" alt="gambar"><br><br>  Dan saya memecahkan masalah dengan cara lain - melalui jam tangan, yang terus-menerus dengan saya, tidak memakan tempat dan menggabungkan semua fasilitas, mobilitas dan kecepatan kontrol.  Umumnya - Pebble masih hidup!  Tetapi yang paling penting adalah bahwa, untuk jam Anda masih dapat menulis aplikasi - aplikasi Anda sendiri, untuk mengelola sistem otomasi Anda.  Ini sebenarnya bom. <br><br><div class="spoiler">  <b class="spoiler_title">Pebble masih hidup!</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video kontrol gerbang</a> <br></div></div><br>  Tragedi menutup perusahaan pebble.com (Fitbit membeli semua pebble.com untuk paten) tidak memengaruhi kinerja dan kinerja mereka.  Baru-baru ini ada pembaruan ios, android - arloji dilepaskan dari layanan cloud kerikil (dalam hal penghentian dukungan) dan otorisasi. <br><br>  Secara visual - tidak ada yang berubah, tetapi layanan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tetap</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cloudpebble.net</a> - WTF?  Ini adalah hal yang sangat berguna.  Jika Anda dapat menulis kode dalam JS (dan tidak ada keinginan untuk menghabiskan banyak waktu di C ++) - silakan diterima di papan :) - cloud pebble memungkinkan Anda untuk "melempar" aplikasi dengan cepat.  Ya begitulah cara saya melakukannya.  Tentu saja, kinerja JS tidak boleh dibandingkan dengan C ++ (ini suci), macet.  ya! <br><br><div class="spoiler">  <b class="spoiler_title">Kode JS cloud kerikil untuk bekerja dengan API</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> UI = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ui'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ajax = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ajax'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> noolite = [ [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/mqtt/gate/slidegate'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/gate.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/mqtt/gate/garage'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/door.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'!'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/103'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/100'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/system2.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'1  '</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'2  '</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/101'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/102'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/system/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/system1.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> water = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/2'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/20'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/21'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 3 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/22'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 4 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/23'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 5 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/5'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 6 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/6'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 7 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/7'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 8 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/8'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 9 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/9'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light1 = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/6'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/0'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/7'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/8'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/2'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/3'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/4'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/5'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/9'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light2 = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/15'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/16'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/10'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/11'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/12'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/13'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/14'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;noolite.length; i++) { items[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: noolite[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: noolite[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items1 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;light1.length; i++) { items1[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: light1[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: light1[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items2 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;light2.length; i++) { items2[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: light2[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: light2[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items3 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;water.length; i++) { items3[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: water[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: water[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } menu.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items); menu1.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items1); menu2.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items2); menu3.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items3); menu.show(); menu.on(<span class="hljs-string"><span class="hljs-string">'select'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex == <span class="hljs-number"><span class="hljs-number">4</span></span>) { menu1.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex == <span class="hljs-number"><span class="hljs-number">5</span></span>) { menu2.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex ==<span class="hljs-number"><span class="hljs-number">8</span></span>) { menu3.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = noolite[e.itemIndex][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(url); ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'get'</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'switched OK'</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Failure! console.log('error'); } ); } }); menu1.on('select', function(e) { var url = light1[e.itemIndex][1]; console.log(url); ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); }); menu2.on('select', function(e) { var url = light2[e.itemIndex][1]; console.log(url); ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); }); menu3.on('select', function(e) { var url = water[e.itemIndex][1]; ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); });</span></span></code> </pre><br></div></div><br>  Kode ini ditulis, dikompilasi langsung di situs web cloud Pebble, dan melalui telepon, mengunduh aplikasi yang dikompilasi, dapat diinstal pada jam - dalam detik.  Semuanya sangat sederhana sehingga insinyur otomasi muda dapat menanganinya;) <br><br>  Sangat disayangkan ... Sayang sekali bahwa Pebble sudah tidak ada lagi dan saat ini saya tidak melihat alternatif.  Kerikil Waktu akan selalu ada di hati kita! <br><br><h2>  MQTT </h2><br>  Tahun lalu, saya bertemu dengan protokol yang luar biasa seperti MQTT (Sejarah: Versi pertama protokol dikembangkan oleh Dr. Andy Stanford-Clark (IBM) dan Arlene Nipper (Arcom) pada tahun 1999 dan diterbitkan di bawah lisensi bebas-royalti. Spesifikasi MQTT 3.1.1 adalah distandarisasi oleh konsorsium OASIS pada tahun 2014. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan</a> ). <br><br>  Ada banyak informasi tentang cara kerja protokol dan apa itu klien ... dan saya sangat kecewa karena tidak ada klien nyata untuk aplikasi seluler, hanya di android. <br><br>  Memahami bahwa kurangnya aplikasi seluler yang baik adalah masalah yang sangat besar (lubang) di bidang IoT (banyak orang mengatakan, tetapi mereka sangat sedikit ....) - Saya dan tim saya, di tempat kerja, memutuskan untuk membuat klien untuk android, ios, wp sehingga memenuhi semua kriteria dan nyaman.  Saya akan menulis tentang klien sedikit kemudian, serta bagaimana kami berteman ESP8266 + MTRF64 (Noolite) dan menyiapkan firmware Nodemcu.  Ini akan menjadi luar biasa, nyaman, murah dan indah!  Ikuti berita aplikasi di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/96c/60d/e63/96c60de63c38253cccee7ddb9aad0b4b.png" alt="gambar"><br><br>  <s>Sekarang Anda dapat mengontrol pencahayaan Noolite tanpa server rumah dan adaptor usb sebesar $ 50-100!</s> <br><br><h2>  Skema umum otomatisasi rumah </h2><br>  Skema berikut masih ada: <br><br><blockquote>  Video surveillance: pengawasan video xeoma [ip camera] <br>  Server pada unit sistem: nginx + gunicorn + python + broker mqtt <br>  Manajemen: Pebble watch + MQTT client <br>  Modul kontrol (node ​​sistem): ESP8266 + optocouplers \ ds18b20, sensor dht11 [22] </blockquote><br>  Karena kenyataan bahwa saya melihat banyak fasilitas dalam protokol MQTT, mulai dari arsitektur berlangganan dan komunikasi instan dengan perangkat IoT akhir, berakhir dengan fakta bahwa pesan MQTT dapat terbang melalui router tanpa "meneruskan" semua port di sana dan menari dengan rebana.  Dengan nyaman!  Selamat bersenang-senang!  Dengan sungguh-sungguh :) <br><br>  Semua ini mendorong saya untuk mendesentralisasikan sistem, yaitu menghindari satu "rumah korchvagen" dan beralih ke banyak yang disebut node dan menggunakan broker cloud MQTT (ada broker MQTT gratis, misalnya: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mqtt.ximxim.com</a> (di situs login dan lulus untuk akses )) - karena esp8266 menyelesaikan semua masalah, dan, pada gilirannya, bekerja melalui wifi menggunakan protokol MQTT. <br><br>  Mengingat MQTT Buddy akan menyediakan layanan skrip, saya tidak akan berpikir untuk menulis skrip apa pun di rumah, saya hanya akan membuatnya dalam solusi cloud dan ini akan menjadi IoT nyata dan ini akan berhasil!  Dari kata-kata hingga perbuatan! <br><br><h2>  ESP8266 </h2><br>  Ketika saya berkenalan dengan papan pengembangan ini, saya langsung terkesan oleh kenyataan bahwa papan itu kecil, ada dukungan untuk bahasa pemrograman LUA pada firmware Nodemcu.  Yang Anda butuhkan + modul MQTT.  Dalam otomatisasi, solusi sederhana dan andal adalah fondasinya.  Biaya dari $ 2 hingga $ 5 untuk biaya (untuk model ke-5 segera dengan adaptor usb di papan) memungkinkan Anda untuk menggunakan subsistem dengan cepat. <br><br>  Koneksi WiFi cepat, banyak kemungkinan.  Misalnya: gerbang / garasi \ penyiraman \ kontrol pencahayaan.  Saya memiliki 30% irigasi kebun yang ditenagai oleh sistem Noolite (blok kontak kering), 70% sisanya dari papan pengembangan esp8266 dikendalikan melalui bahasa LUA menggunakan protokol MQTT. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh kode LUA untuk esp8266, mendapatkan ip dan memanggil file kerja dengan MQTT</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--load credentials dofile("credentials.lua") function init(name, pass) wifi.setmode(wifi.STATION) wifi.sta.config(name, pass) wifi.sta.connect() tmr.alarm(0, 1000, 1, function() if wifi.sta.getip()== nil then print("IP unavaiable, Waiting...") else tmr.stop(0) print("Config done, IP is "..wifi.sta.getip()) print("mac : "..wifi.sta.getmac()) dofile("mqtt.lua") end end) end print("START!") init(SSID,PASSWORD)</span></span></code> </pre><br><br>  - file mqtt.lua <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> door = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-comment"><span class="hljs-comment">-- gpio13 local window = 6 -- gpio12 local cooler = 5 --gpio14 local led = 4 --GPIO2 board led! LOW == turn ON local light1 = 8 --gpio 15 local light2 = 1 --gpio 5 local light3 = 2 -- gpio 4 function register_myself() m:subscribe("mqtt_buddy/#",0,function(conn) print ("subscribed to Xim mqtt.ximxim.com server") end) end m = mqtt.Client("MQTT_BUDDY_SHOW_ROOM", 120, MQTT_USER, MQTT_PASS) m:on("connect", function(client) print ("connected to Xim mqtt.ximxim.com server") end) m:on("offline", function(client) reconnect_mqtt() end) m:on("message", function(client, topic, data) --print(topic.." data:"..data) if topic == "mqtt_buddy/window" and data == "1" then print "open-close window..." gpio.write(window, gpio.HIGH) gpio.write(led, gpio.LOW) tmr.alarm(1, 1000, tmr.ALARM_SINGLE, function() gpio.write(window, gpio.LOW) gpio.write(led, gpio.HIGH) print "command to close\open window is sent!" end) elseif topic == "mqtt_buddy/door" and data == "1" then print "open-close door..." gpio.write(door, gpio.HIGH) gpio.write(led, gpio.LOW) tmr.alarm(2, 1000, tmr.ALARM_SINGLE, function() gpio.write(door, gpio.LOW) gpio.write(led, gpio.HIGH) print "command to close\open door is sent!" end) elseif topic == "mqtt_buddy/cooler" then if data == "1" then print "switch on fan..." gpio.write(cooler, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch off fan..." gpio.write(cooler, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light1" then if data == "1" then print "switch light1 ON..." gpio.write(light1, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light1 off..." gpio.write(light1, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light2" then if data == "1" then print "switch light2 ON..." gpio.write(light2, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light2 off..." gpio.write(light2, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light3" then if data == "1" then print "switch light3 ON..." gpio.write(light3, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light3 off..." gpio.write(light3, gpio.LOW) gpio.write(led, gpio.HIGH) end end end) m:connect(MQTT_SERVER, MQTT_SERVER_PORT, 0, function(conn) register_myself() end)</span></span></code> </pre><br></div></div><br><h3>  Masalah </h3><br>  Beralih ke komunitas besar <b>orang-orang yang berpikir</b> , saya ingin menyentuh topik yang sangat penting, atau lebih tepatnya masalah yang ingin saya selesaikan, tetapi tidak ada cukup waktu untuk penelitian / pengetahuan yang lebih mendalam. <br><br>  Intinya: dengan desentralisasi, pengawasan video tetap, yang dengan satu atau lain cara memerlukan mesin host untuk (minimum) mentransfer gambar sumber ke server pengawasan video (mis. Ivideon) atau bahkan memproses video pada mesin rumah, seperti xeoma (walaupun mereka juga memiliki cloud) - satu atau lain cara - Anda perlu "FORWARD" video stream, gambar untuk daya komputasi akhir (solusi cloud) - atau sebaliknya - untuk membuat streaming menjadi sederhana. <br><br>  Ada pemikiran untuk menerima gambar sumber dari kamera (ada juga masalah di sini, tidak setiap kamera memiliki URL untuk menerima gambar dari kamera dan umumnya tidak jelas bagaimana orang lain akan mengenali URL ini ....) dan meneruskan ke saluran MQTT di mana data biner didukung (yang ada gambar yang dapat dengan mudah ditransmisikan melalui protokol mqtt dalam bentuk biner). <br><br>  Mungkin seseorang sudah mencoba mengimplementasikan hal-hal seperti itu = ESP8266 + IP web cam? <br>  Mohon jawab (bogdanovich.alex [@] gmail.com).  Saya akan sangat berterima kasih! <br><br>  Saat menerapkan probros, pertanyaan dari server rumah akan hilang.  Mengapa  Karena dia makan listrik dan memanaskan tungku saya :) <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/148/bfb/eab/148bfbeab6e37921aa198344af6564de.png" alt="gambar"><br><br>  Semua hari yang positif dan suasana hati yang baik! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id403273/">https://habr.com/ru/post/id403273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id403255/index.html">Pemblokir iklan "perceptual" pertama dibuat, yang tidak bergantung pada tata letak halaman</a></li>
<li><a href="../id403263/index.html">Bagaimana pekerjaan diatur di pusat layanan "NAG"</a></li>
<li><a href="../id403265/index.html">Industri hotel mengumumkan perang dengan Airbnb</a></li>
<li><a href="../id403267/index.html">Untuk sistem pada sebuah chip melalui FPGA: minggu mikroelektronika digital di Kiev - 24-29 April 2017</a></li>
<li><a href="../id403271/index.html">Tembakan Copter</a></li>
<li><a href="../id403275/index.html">Pencarian untuk antimateri yang hilang di alam semesta tetap dalam keadaan ketidakpastian yang menjengkelkan</a></li>
<li><a href="../id403277/index.html">Para ilmuwan wanita India ini mengirim roket ke Mars dengan jumlah kurang dari anggaran film "Mars"</a></li>
<li><a href="../id403279/index.html">Berita RFID: penjualan mantel bulu yang terkelupas telah menembus ... plafon</a></li>
<li><a href="../id403281/index.html">Windows 10 akan menekan aplikasi latar belakang</a></li>
<li><a href="../id403283/index.html">Printer 3D Funtastique EVO v1.0: pengantar pertama</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>