<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✌️ 🚁 👖 باختصار حول العمل مع RabbitMQ من بيثون 🦑 👠 👨‍👧‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="لقد حدث أنه أثناء عملية العمل في MegaFon ، يتعين على المرء أن يواجه نفس المهام عند العمل مع RabbitMQ. السؤال الذي يطرح نفسه بشكل طبيعي: "كيفية تبسيط و...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>باختصار حول العمل مع RabbitMQ من بيثون</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434510/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wj/xp/kf/wjxpkfeg45pxv_pbpaiyykpj9jg.png" alt="KDPV"></p><br><p style=";text-align:right;direction:rtl">  لقد حدث أنه أثناء عملية العمل في MegaFon ، يتعين على المرء أن يواجه نفس المهام عند العمل مع RabbitMQ.  السؤال الذي يطرح نفسه بشكل طبيعي: "كيفية تبسيط وأتمتة تنفيذ هذه المهام؟" </p><br><p style=";text-align:right;direction:rtl">  الحل الأول الذي يتبادر إلى الذهن هو استخدام واجهة HTTP ، وبطبيعة الحال ، من خارج منطقة الجزاء ، RabbitMQ لديه واجهة ويب جيدة و HTTP API.  ومع ذلك ، فإن استخدام HTTP API ليس ملائمًا دائمًا ، بل وأحيانًا مستحيل (لنفترض أنه ليس لديك حقوق وصول كافية ، لكنني أريد حقًا نشر رسالة) في مثل هذه الأوقات ، يصبح من الضروري العمل باستخدام بروتوكول AMQP </p><br><p style=";text-align:right;direction:rtl">  لعدم العثور على حلول جاهزة مناسبة لي في المساحات المفتوحة للشبكة ، فقد تقرر كتابة تطبيق صغير للعمل مع RabbitMQ باستخدام بروتوكول AMQP <a name="habracut"></a>  مع القدرة على نقل معلمات بدء التشغيل من خلال سطر الأوامر وتوفير الحد الأدنى الضروري من الميزات ، وهي: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  نشر </li><li style=";text-align:right;direction:rtl">  تدقيق الرسائل </li><li style=";text-align:right;direction:rtl">  إنشاء وتحرير عناصر المسار الأساسية </li></ul><br><p style=";text-align:right;direction:rtl">  تم اختيار Python كأبسط (وفي رأيي جميلة) أداة لتنفيذ هذه المهمة.  (يمكن للمرء أن يجادل هنا ، ولكن ما الذي سيتغير؟) </p><br><p style=";text-align:right;direction:rtl">  يتم تقديم ترجمات الأدلة الرسمية ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">واحد</a> أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">اثنين</a> ) بواسطة RabbitMQ على المحور ، ولكن في بعض الأحيان يكون مثال بسيط من الممارسة مفيدًا.  في المقالة ، سأحاول توضيح المشكلات الرئيسية التي تنشأ عند العمل مع الأرانب باستخدام قناة AMQP من Python باستخدام مثال لتطبيق صغير.  التطبيق نفسه متاح على <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">جيثب</a> . </p><br><h4 id="korotko-o-protokole-amqp-i-brokere-soobscheniy-rabbitmq" style=";text-align:right;direction:rtl">  باختصار حول بروتوكول AMQP ووسيط الرسائل RabbitMQ </h4><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><strong>AMQP</strong></a> هو أحد بروتوكولات المراسلة الأكثر شيوعًا بين مكونات النظام الموزع.  السمة المميزة الرئيسية لهذا البروتوكول هو مفهوم بناء مسار الرسالة ، والذي يحتوي على عنصرين هيكليين رئيسيين: <strong>قائمة الانتظار</strong> <strong>ونقطة التبادل</strong> .  قائمة الانتظار بتجميع الرسائل حتى يتم تلقيها.  نقطة التبادل هي موزع رسائل يوجهها إما إلى قائمة الانتظار المطلوبة أو إلى نقطة تبادل أخرى.  <strong>تعتمد قواعد التوزيع (الارتباطات)</strong> التي تحدد من خلالها نقطة التبادل مكان توجيه الرسالة ، على التحقق <strong>من مفتاح توجيه الرسالة</strong> للتأكد من توافقه مع القناع المحدد.  يمكنك قراءة المزيد حول كيفية عمل AMQP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . </p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><strong>RabbitMQ</strong></a> هو تطبيق مفتوح المصدر يدعم AMQP بالكامل ويقدم عددًا من الميزات الإضافية.  للعمل مع RabbitMQ ، تمت كتابة عدد كبير من المكتبات في مجموعة متنوعة من لغات البرمجة ، بما في ذلك Python. </p><br><h2 id="realizaciya-na-python" style=";text-align:right;direction:rtl">  تنفيذ بايثون </h2><br><p style=";text-align:right;direction:rtl">  يمكنك دائمًا رمي نصين للاستخدام الشخصي وعدم معرفة المشكلات التي تحدث معهم.  عندما يتعلق الأمر بنشرها بين الزملاء ، يصبح كل شيء أكثر تعقيدًا.  يحتاج الجميع إلى إظهار ومعرفة كيفية وما الذي يجب إطلاقه ، وماذا وأين يتغير ، وأين يمكن الحصول على أحدث إصدار ، وما الذي تغير فيه ... لقد توصلت إلى استنتاج مفاده أنه من السهل العمل على واجهة بسيطة مرة واحدة ، حتى لا تضيع الوقت في المستقبل.  لسهولة الاستخدام ، تقرر تقسيم التطبيق إلى 4 وحدات: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الوحدة المسؤولة عن النشر </li><li style=";text-align:right;direction:rtl">  الوحدة النمطية المسؤولة عن طرح الرسائل من قائمة الانتظار </li><li style=";text-align:right;direction:rtl">  وحدة نمطية مصممة لإجراء تغييرات على تكوين وسيط RabbitMQ </li><li style=";text-align:right;direction:rtl">  وحدة نمطية تحتوي على معلمات وطرق شائعة في الوحدات السابقة </li></ol><br><p style=";text-align:right;direction:rtl">  يبسط هذا النهج مجموعة معلمات بدء التشغيل.  لقد اخترنا الوحدة النمطية المطلوبة ، واخترنا أحد أوضاع التشغيل الخاصة بها واجتزنا المعلمات الضرورية (لمزيد من المعلومات حول أوضاع التشغيل والمعلمات في - المساعدة - المساعدة). </p><br><p style=";text-align:right;direction:rtl">  نظرًا لأن بنية "الأرانب" في MegaFon تتكون من عدد كبير بما فيه الكفاية من العقد ، <strong>لتسهيل</strong> الاستخدام ، يتم نقل البيانات للاتصال العقد إلى وحدة نمطية مع المعلمات العامة والأساليب <strong>rmq_common_tools.py</strong> </p><br><p style=";text-align:right;direction:rtl">  للعمل على AMQP في بيثون ، سوف نستخدم مكتبة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Pika</a> . </p><br><pre style=";text-align:right;direction:rtl"><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pika</code> </pre> <br><p style=";text-align:right;direction:rtl">  باستخدام هذه المكتبة ، سيتألف العمل مع RabbitMQ من ثلاث مراحل رئيسية: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  تأسيس اتصال </li><li style=";text-align:right;direction:rtl">  أداء العمليات المطلوبة </li><li style=";text-align:right;direction:rtl">  اتصال وثيق </li></ol><br><p style=";text-align:right;direction:rtl">  المرحلة الأولى والأخيرة هي نفسها لجميع الوحدات ويتم تنفيذها في <strong>rmq_common_tools.py</strong> </p><br><p style=";text-align:right;direction:rtl">  لتأسيس اتصال: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_parameters = pika.URLParameters(rmq_url_connection_str) rmq_connection = pika.BlockingConnection(rmq_parameters) rmq_channel = rmq_connection.channel()</code> </pre> <br><p style=";text-align:right;direction:rtl">  تتيح لك مكتبة Pika استخدام خيارات التصميم المختلفة للاتصال بـ RabbitMQ.  في هذه الحالة ، كان الخيار الأكثر ملاءمة هو تمرير المعلمات في شكل سلسلة URL بالتنسيق التالي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">'amqp://rabbit_user:rabbit_password@host:port/vhost'</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  لإغلاق اتصال: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_connection.close()</code> </pre> <br><h4 id="publikaciya-soobscheniy" style=";text-align:right;direction:rtl">  نشر </h4><br><p style=";text-align:right;direction:rtl">  من المحتمل أن يكون نشر رسالة هو الأسهل ، ولكن في نفس الوقت تكون العملية الأكثر شيوعًا عند العمل مع الأرانب. </p><br><p style=";text-align:right;direction:rtl">  نشر أدوات النشر المترجمة في <strong>rmq_publish.py</strong> </p><br><p style=";text-align:right;direction:rtl">  لنشر رسالة ، استخدم الطريقة </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_channel.basic_publish(exchange = params.exch, routing_key = params.r_key, body = text)</code> </pre> <br><p style=";text-align:right;direction:rtl">  حيث: <br>  <strong>التبادل</strong> - اسم نقطة التبادل التي سيتم نشر الرسالة <br>  <strong>routing_key</strong> - مفتاح التوجيه الذي سيتم نشر الرسالة به <br>  <strong>النص الأساسي</strong> للرسالة </p><br><p style=";text-align:right;direction:rtl">  يدعم <strong>rmq_publish.py</strong> وضعي إدخال الرسائل للنشر: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يتم إدخال الرسالة كمعلمة من خلال سطر الأوامر (from_console) </li><li style=";text-align:right;direction:rtl">  تتم قراءة الرسالة من الملف (from_file) </li></ol><br><p style=";text-align:right;direction:rtl">  الوضع الثاني ، في رأيي ، أكثر ملاءمة عند العمل مع الرسائل الكبيرة أو صفائف الرسائل.  الأول ، بدوره ، يسمح لك بإرسال رسالة بدون ملفات إضافية ، وهو مناسب عند دمج الوحدة النمطية في سيناريوهات أخرى. </p><br><h4 id="poluchenie-soobscheniy" style=";text-align:right;direction:rtl">  تلقي الرسائل </h4><br><p style=";text-align:right;direction:rtl">  مسألة تلقي الرسائل لم تعد تافهة مثل النشر.  عندما يتعلق الأمر بقراءة الرسائل ، فأنت بحاجة إلى فهم: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  بعد تأكيد استلام الرسالة ، ستتم إزالتها من قائمة الانتظار.  لذلك ، عند قراءة الرسائل من خط "المعركة" ، فإننا "نختارها" من المستهلك الرئيسي.  إذا كنا لا نريد أن نفقد تدفق الرسائل ، ولكننا نريد فقط أن نفهم ما هي الرسائل التي تتحرك في "الأرنب" ، فإن الخيار الأكثر منطقية هو إنشاء قائمة انتظار "تسجيل" منفصلة ، أو كما يطلق عليها أيضًا ، "قائمة انتظار الاعتراض". </li><li style=";text-align:right;direction:rtl">  تتطلب قراءة الرسائل ، كقاعدة عامة ، مزيدًا من المعالجة أو التحليل ، مما يعني أنه يجب حفظها في مكان ما إذا كانت المعالجة في الوقت الفعلي مستحيلة أو غير مطلوبة. </li></ul><br><p style=";text-align:right;direction:rtl">  قارئ الرسائل المطبق في ملف <strong>rmq_consume.py</strong> </p><br><p style=";text-align:right;direction:rtl">  يتم توفير وضعين التشغيل: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  قراءة الرسائل من قائمة انتظار موجودة </li><li style=";text-align:right;direction:rtl">  إنشاء قائمة انتظار وقت ومسار لقراءة الرسائل من قائمة الانتظار هذه </li></ol><br><p style=";text-align:right;direction:rtl">  سيتم النظر في مسألة إنشاء قائمة انتظار وطرق أدناه. </p><br><p style=";text-align:right;direction:rtl">  يتم تطبيق التدقيق اللغوي المباشر على النحو التالي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">channel.basic_consume(on_message, queue=params.queue) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: channel.start_consuming() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: channel.stop_consuming() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception: channel.stop_consuming() rmq_tools.console_log(<span class="hljs-string"><span class="hljs-string">":\n"</span></span>, traceback.format_exc())</code> </pre> <br><p style=";text-align:right;direction:rtl">  اين <br>  <strong>on_message</strong> - إجراء معالج الرسالة <br>  <strong>params.queue</strong> - اسم قائمة الانتظار التي سيتم إجراء <strong>الطرح</strong> منها </p><br><p style=";text-align:right;direction:rtl">  يجب أن يقوم معالج الرسالة بإجراء بعض العملية على رسالة القراءة وتأكيد (أو عدم تأكيد ، إذا لزم الأمر) تسليم الرسالة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(channel, method_frame, header_frame, body)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> all_cnt, lim <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> all_cnt &gt;= lim: rmq_tools.console_log(<span class="hljs-string"><span class="hljs-string">'   .'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> KeyboardInterrupt body_str = body.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>)[:<span class="hljs-number"><span class="hljs-number">4000</span></span>] rk = method_frame.routing_key rmq_params.file.write(rk + <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) rmq_params.file.write(body_str + <span class="hljs-string"><span class="hljs-string">'\n\n'</span></span>) all_cnt = all_cnt + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lim != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (rmq_params.file == sys.stdout): sys.stdout.write(<span class="hljs-string"><span class="hljs-string">f'[</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{rmq_tools.time_now()}</span></span></span><span class="hljs-string">] - </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{all_cnt}</span></span></span><span class="hljs-string"> of </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{lim}</span></span></span><span class="hljs-string"> messages consumed.\r'</span></span>) channel.basic_ack(delivery_tag=method_frame.delivery_tag)</code> </pre> <br><p style=";text-align:right;direction:rtl">  اين <br>  <strong>all_cnt</strong> - عداد عالمي <br>  <strong>ليم</strong> - عدد الرسائل المراد قراءتها </p><br><p style=";text-align:right;direction:rtl">  في مثل هذا التنفيذ للمعالج ، يتم طرح عدد معين من الرسائل وإخراج المعلومات حول تقدم الطرح إلى وحدة التحكم في حالة الكتابة إلى ملف. </p><br><p style=";text-align:right;direction:rtl">  من الممكن أيضًا كتابة الرسائل المقروءة في قاعدة البيانات.  في التنفيذ الحالي ، لم يتم تقديم مثل هذه الفرصة ، لكن ليس من الصعب إضافتها. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">سجل في قاعدة بيانات</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  سننظر في مثال على كتابة الرسائل إلى قاعدة البيانات لقاعدة بيانات Oracle ومكتبة <strong>cx_oracle</strong> . </p><br><p style=";text-align:right;direction:rtl">  الاتصال بقاعدة البيانات </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">ora_adress = <span class="hljs-string"><span class="hljs-string">'host:port/dbSID'</span></span> ora_creds = <span class="hljs-string"><span class="hljs-string">'user/pass'</span></span> connection_ora = cx_Oracle.connect(ora_creds + <span class="hljs-string"><span class="hljs-string">'@'</span></span> + ora_address) ora_cursor = connection_ora.cursor()</code> </pre> <br><p style=";text-align:right;direction:rtl">  أضف معالج <strong>on_message</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">global</span></span> cnt, commit_int insert_rec = <span class="hljs-string"><span class="hljs-string">'insert into '</span></span> + tab_name + <span class="hljs-string"><span class="hljs-string">'(routing_key, text) values (:rkey, :text)'</span></span> ora_cursor.execute(insert_rec, text = body_str, rkey = rk) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cnt &gt; commit_int : ora_cursor.execute(<span class="hljs-string"><span class="hljs-string">'commit'</span></span>) cnt = <span class="hljs-number"><span class="hljs-number">1</span></span> cnt = cnt + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  اين <br>  <strong>cnt</strong> هو عداد آخر <br>  <strong>الالتزام</strong> - عدد الإدخالات في قاعدة البيانات ، وبعد ذلك من الضروري القيام بـ "الالتزام".  يرجع وجود مثل هذه المعلمة إلى الرغبة في تقليل الحمل على قاعدة البيانات.  ومع ذلك ، تثبيته ليست كبيرة بشكل خاص ، ل  في حالة حدوث فشل ، هناك فرصة لفقدان الرسائل المقروءة بعد آخر التزام ناجح. </p><br><p style=";text-align:right;direction:rtl">  وكما هو متوقع ، في نهاية العمل ، نتعهد بالالتزام النهائي ونغلق الاتصال </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">ora_cursor.execute(<span class="hljs-string"><span class="hljs-string">'commit'</span></span>) connection_ora.close()</code> </pre> <br><p style=";text-align:right;direction:rtl">  شيء من هذا القبيل هو قراءة الرسائل.  إذا قمت بإزالة القيود المفروضة على عدد الرسائل المقروءة ، فيمكنك إجراء عملية خلفية للقراءة المستمرة للرسائل من "الأرنب". </p></div></div><br><h4 id="konfigurirovanie" style=";text-align:right;direction:rtl">  التكوين </h4><br><p style=";text-align:right;direction:rtl">  على الرغم من أن بروتوكول AMQP مخصص في المقام الأول لنشر الرسائل وقراءتها ، فإنه يسمح لك أيضًا بإجراء عمليات بسيطة من خلال تكوين المسارات (لا نتحدث عن تكوين اتصالات الشبكة وإعدادات RabbitMQ الأخرى كتطبيق). </p><br><p style=";text-align:right;direction:rtl">  عمليات التكوين الرئيسية هي: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إنشاء قائمة انتظار أو نقطة تبادل </li><li style=";text-align:right;direction:rtl">  إنشاء قاعدة توجيه (ملزمة) </li><li style=";text-align:right;direction:rtl">  حذف قائمة انتظار أو نقطة تبادل </li><li style=";text-align:right;direction:rtl">  إزالة قاعدة توجيه (ملزمة) </li><li style=";text-align:right;direction:rtl">  قائمة انتظار المقاصة </li></ol><br><p style=";text-align:right;direction:rtl">  نظرًا لوجود إجراء جاهز لكل منهم في مكتبة <strong>pika</strong> ، <strong>لتسهيل التشغيل</strong> ، يتم تجميعها ببساطة في ملف <strong>rmq_setup.py</strong> .  بعد ذلك ، ندرج الإجراءات من مكتبة pika مع بعض التعليقات حول المعلمات. </p><br><p style=";text-align:right;direction:rtl">  <strong>إنشاء قائمة انتظار</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_channel.queue_declare(queue=params.queue, durable = params.durable)</code> </pre> <br><p style=";text-align:right;direction:rtl">  كل شيء بسيط هنا <br>  <strong>قائمة الانتظار</strong> - اسم قائمة الانتظار لإنشاء <br>  <strong>دائم</strong> - معلمة منطقية ، تعني قيمة True أنه عند إعادة تشغيل الأرنب ، ستظل قائمة الانتظار موجودة.  إذا خطأ ، سيتم حذف قائمة الانتظار عند إعادة التشغيل.  عادةً ما يتم استخدام الخيار الثاني لقوائم الانتظار المؤقتة التي يتم ضمان عدم الحاجة إليها في المستقبل. </p><br><p style=";text-align:right;direction:rtl">  <strong>إنشاء نقطة تبادل (تبادل)</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_channel.exchange_declare(exchange=params.exch, exchange_type = params.type, durable = params.durable)</code> </pre> <br><p style=";text-align:right;direction:rtl">  هنا تنشأ معلمة جديدة <strong>exchange_type</strong> - نوع نقطة التبادل.  حول أنواع نقاط التبادل التي تتم قراءتها <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . <br>  <strong>التبادل</strong> - اسم نقطة التبادل المنشأة </p><br><p style=";text-align:right;direction:rtl">  <strong>حذف قائمة انتظار أو نقطة تبادل</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_channel.queue_delete(queue=params.queue) rmq_channel.exchange_delete(exchange=params.exch)</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>إنشاء قاعدة توجيه (ملزمة)</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_channel.queue_bind(exchange=params.exch, queue=params.queue, routing_key=params.r_key)</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>التبادل</strong> - اسم نقطة التبادل التي سيتم إجراء النقل منها <br>  <strong>قائمة الانتظار</strong> - اسم قائمة الانتظار المطلوب توجيهها إلى <br>  <strong>routing_key</strong> - قناع مفتاح التوجيه ، والذي سيتم استخدامه لإعادة التوجيه. </p><br><p style=";text-align:right;direction:rtl">  الإدخالات التالية صالحة: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>rk.my_key. *</strong> - في هذا القناع ، تعني العلامة النجمية مجموعة أحرف غير فارغة.  بمعنى آخر ، <strong>سيتخطى</strong> هذا القناع أي مفتاح من نوع <strong>rk.my_key.</strong>  + شيء آخر ، لكن لن يفوتك المفتاح <strong>rk.my_key</strong> </li><li style=";text-align:right;direction:rtl">  <strong>rk.my_key. #</strong> - <strong>سيتخطى</strong> هذا القناع كل شيء مثل مفتاح <strong>rk.my_key</strong> السابق </li></ul><br><p style=";text-align:right;direction:rtl">  <strong>إزالة قاعدة توجيه (ملزمة)</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_channel.queue_unbind(exchange=params.exch, queue=params.queue, routing_key=params.r_key)</code> </pre> <br><p style=";text-align:right;direction:rtl">  كل شيء مشابه لإنشاء قاعدة إعادة توجيه. </p><br><p style=";text-align:right;direction:rtl">  <strong>قائمة انتظار المقاصة</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">rmq_channel.queue_purge(queue=params.queue)</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>قائمة الانتظار</strong> - اسم قائمة الانتظار المراد مسحها </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">حول استخدام واجهة سطر الأوامر في تطبيقات Python</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  خيارات بدء التشغيل تجعل الحياة أسهل كثيرًا.  من أجل عدم تعديل الكود قبل كل عملية إطلاق ، من المنطقي توفير آلية لتمرير المعلمات عند بدء التشغيل.  تم اختيار مكتبة <strong>argparse</strong> لهذا <strong>الغرض</strong> .  لن أخوض في تفاصيل تعقيدات استخدامه ؛ فهناك أدلة كافية حول هذا الموضوع ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">واحد</a> ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">اثنان</a> ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ثلاثة</a> ).  لاحظت فقط أن هذه الأداة ساعدتني في تبسيط عملية استخدام التطبيق بشكل كبير (إذا كان يمكنك تسميته).  حتى بعد إلقاء تسلسل بسيط من الأوامر ولفها في واجهة مشابهة ، يمكنك الحصول على أداة كاملة وسهلة الاستخدام. </p></div></div><br><h2 id="primenenie-v-povsednevnoy-zhizni-chto-prigodilos-bolshe-vsego" style=";text-align:right;direction:rtl">  التطبيق في الحياة اليومية.  ما جاء في متناول يدي أكثر. </h2><br><p style=";text-align:right;direction:rtl">  حسنًا ، الانطباع قليلاً عن استخدام AMQP في الحياة اليومية. </p><br><p style=";text-align:right;direction:rtl">  الميزة الأكثر طلبًا هي نشر الرسالة.  لا تسمح حقوق الوصول لمستخدم معين دائمًا باستخدام واجهة ويب ، رغم أنه من الضروري في بعض الأحيان اختبار خدمة معينة.  هنا AMQP والتفويض نيابة عن الخدمة باستخدام هذه القناة تمر للمساعدة. </p><br><p style=";text-align:right;direction:rtl">  وكان الثاني الأكثر شعبية القدرة على قراءة الرسائل من قائمة انتظار الوقت.  هذه الميزة مفيدة في تكوين مسارات جديدة وتدفقات الرسائل ، وكذلك في منع الحوادث. </p><br><p style=";text-align:right;direction:rtl">  الاحتمالات الأخرى وجدت أيضا التطبيق في مختلف المهام. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar434510/">https://habr.com/ru/post/ar434510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar434500/index.html">المحتال يدعى جين أو شاهد آذانك</a></li>
<li><a href="../ar434502/index.html">كيف اكتشف "علماء الآثار الرقميون" نسخة مفقودة من SimCity لـ NES واستعادتها</a></li>
<li><a href="../ar434504/index.html">20 عامًا من التقارير السريعة "تم إنشاء المنتج في نفس واحد ، مرتفع جدًا ..."</a></li>
<li><a href="../ar434506/index.html">تجربة نشر تطبيق تحرير الفيديو في متجر Microsoft</a></li>
<li><a href="../ar434508/index.html">الجانب المظلم لتسويق محرك البحث: كيف ولماذا تجمع Google معلوماتنا الشخصية</a></li>
<li><a href="../ar434512/index.html">الشركات الشركات</a></li>
<li><a href="../ar434514/index.html">"الأسرار" DPAPI أو DPAPI لـ Pentesters</a></li>
<li><a href="../ar434516/index.html">طريقة سهلة للتعامل مع طموحاتك المهنية.</a></li>
<li><a href="../ar434518/index.html">التصفيق والهتافات: الدراما التي تسيطر عليها بعناية في متاجر أبل</a></li>
<li><a href="../ar434522/index.html">أنماط تبرير المهام و antipatterns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>