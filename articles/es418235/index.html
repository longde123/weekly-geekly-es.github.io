<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌖 👦🏾 🌙 Saga orquestada o cómo construir transacciones comerciales en servicios con la base de datos por patrón de servicio 📕 🚵🏾 🚹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Mi nombre es Konstantin Evteev, trabajo en Avito como líder de la unidad DBA. Nuestro equipo desarrolla sistemas de almacenamiento Avito, ayuda e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Saga orquestada o cómo construir transacciones comerciales en servicios con la base de datos por patrón de servicio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418235/"><p>  Hola  Mi nombre es Konstantin Evteev, trabajo en Avito como líder de la unidad DBA.  Nuestro equipo desarrolla sistemas de almacenamiento Avito, ayuda en la selección o emisión de bases de datos y la infraestructura relacionada, es compatible con el objetivo de nivel de servicio para servidores de bases de datos, y también somos responsables de la eficiencia y el monitoreo de los recursos, asesorar sobre el diseño y posiblemente desarrollar microservicios, vinculado a sistemas de almacenamiento o servicios para el desarrollo de la plataforma en el contexto del almacenamiento. </p><br><p>  Quiero contarles cómo resolvimos uno de los desafíos de la arquitectura de microservicios: realizar transacciones comerciales en la infraestructura de servicios creados utilizando la base de datos por patrón de servicio.  Hice una presentación sobre este tema en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conferencia Highload ++ Siberia 2018</a> . </p><br><img src="https://habrastorage.org/webt/r3/bz/ty/r3bztya5eso1a_fkh9laghkue9k.png" alt="imagen"><a name="habracut"></a><br><p><br></p><br><h2 id="teoriya-maksimalno-kratko">  Teoría  Lo más corto posible </h2><br><p>  No describiré en detalle la teoría de las sagas.  Te daré solo una breve introducción para que entiendas el contexto. </p><br><p>  Como era antes (desde el comienzo de Avito hasta 2015 - 2016): vivíamos en un monolito, con bases monolíticas y aplicaciones monolíticas.  En algún momento, estas condiciones comenzaron a impedirnos crecer.  Por un lado, nos encontramos con el rendimiento de un servidor con una base de datos principal, pero esta no es la razón principal, ya que el problema de rendimiento se puede resolver, por ejemplo, mediante el uso de fragmentos.  Por otro lado, el monolito tiene una lógica muy compleja, y en una determinada etapa de crecimiento, la entrega de cambios (lanzamientos) se vuelve muy larga e impredecible: hay muchas dependencias no obvias y complejas (todo está estrechamente conectado), también es difícil de probar, en general hay muchos problemas.  La solución es cambiar a la arquitectura de microservicios.  En esta etapa, teníamos una pregunta con las transacciones comerciales fuertemente ligadas a los ACID proporcionados por una base monolítica: no está claro cómo migrar esta lógica comercial.  Cuando se trabaja con Avito, hay muchos escenarios diferentes implementados por varios servicios, cuando la integridad y la consistencia de los datos es muy importante, por ejemplo, comprar una suscripción premium, debitar dinero, solicitar servicios a un usuario, comprar paquetes VAS; en caso de circunstancias imprevistas o accidentes, todo puede no ir inesperadamente De acuerdo al plan.  Encontramos la solución en las sagas. </p><br><p>  Me gusta la <a href="">descripción técnica de las</a> sagas en 1987 por Kenneth Salem y Héctor García Molina, uno de los miembros actuales de la junta directiva de Oracle.  Cómo se formuló el problema: hay un número relativamente pequeño de transacciones de larga duración que durante mucho tiempo impiden la ejecución de operaciones pequeñas, menos demandantes de recursos y más frecuentes.  Como resultado deseado, puede dar un ejemplo de la vida: seguramente, muchos de ustedes hicieron cola para copiar documentos, y el operador de la copiadora, si tenía la tarea de copiar un libro completo o solo muchas copias, hacía copias de otros miembros de la cola de vez en cuando.  Pero disponer de recursos es solo una parte del problema.  La situación se ve agravada por bloqueos a largo plazo cuando se realizan tareas intensivas en recursos, cuya cascada se construirá en su DBMS.  Además, pueden ocurrir errores durante una transacción larga: la transacción no se completará y comenzará la reversión.  Si la transacción fue larga, entonces la reversión también tomará mucho tiempo, y probablemente habrá un reintento desde la aplicación.  En general, "todo es bastante interesante".  La solución propuesta en la descripción técnica de SAGAS es dividir una transacción larga en partes. </p><br><p>  Me parece que muchos se acercaron a esto sin siquiera leer este documento.  Hemos hablado repetidamente sobre nuestro defproc (procedimientos diferidos implementados usando pgq).  Por ejemplo, cuando bloqueamos a un usuario por fraude, realizamos rápidamente una transacción corta y respondemos al cliente.  En esta breve transacción, que incluye, colocamos la tarea en una cola transaccional, y luego de forma asíncrona, en pequeños lotes, por ejemplo, diez anuncios bloquean sus anuncios.  Lo hicimos implementando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">colas transaccionales desde Skype</a> . </p><br><p>  Pero nuestra historia de hoy es un poco diferente.  Necesitamos ver estos problemas desde el otro lado: aserrando un monolito en microservicios creados usando la base de datos por patrón de servicio. </p><br><p>  Uno de los parámetros más importantes para nosotros es lograr la máxima velocidad de corte.  Por lo tanto, decidimos transferir la funcionalidad anterior y toda la lógica tal como es a los microservicios, sin cambiar nada en absoluto.  Requisitos adicionales que necesitábamos cumplir: </p><br><blockquote><ul><li>  Proporcionar cambios de datos dependientes para datos críticos del negocio. </li><li>  ser capaz de establecer un orden estricto; </li><li>  observar un cien por ciento de consistencia: coordinar los datos incluso en caso de accidentes; </li><li>  Garantizar el funcionamiento de las transacciones a todos los niveles. </li></ul><br></blockquote><p>  Según los requisitos anteriores, la solución en forma de saga orquestada es la más adecuada. </p><br><h2 id="realizaciya-orkestriruemoy-sagi-v-vide-servisa-pg-saga">  Implementación de una saga orquestada como un servicio PG Saga </h2><br><p>  Así es como se ve el servicio PG Saga. </p><br><p><img src="https://habrastorage.org/webt/mi/zm/0f/mizm0fidaxgpcv3wxoway4ksgoe.jpeg" alt="imagen"></p><br><p>  PG en el nombre, porque PostgreSQL síncrono se usa como un repositorio de servicios.  ¿Qué más hay dentro? </p><br><ul><li>  API </li><li>  albacea </li><li>  corrector </li><li>  chequeador de salud; </li><li>  compensador </li></ul><br><p>  El diagrama también muestra al propietario del servicio de las sagas, y a continuación se muestran los servicios que realizarán los pasos de la saga.  Pueden tener diferentes repositorios. </p><br><h4 id="kak-eto-rabotaet">  Como funciona </h4><br><p>  Considere el ejemplo de comprar paquetes VAS.  VAS (servicios de valores agregados): servicios pagados para la promoción de anuncios. </p><br><p>  Primero, el propietario del servicio de la saga debe registrar la creación de la saga en el servicio de saga </p><br><p><img src="https://habrastorage.org/webt/6d/yo/zs/6dyozsxy0_qfoqmrtlrbijfaxeu.jpeg" alt="imagen"></p><br><p>  Después de eso, genera una clase de saga ya con Payload. </p><br><p><img src="https://habrastorage.org/webt/ul/hr/ic/ulhric8ofs455lgaz4mozdhs2l8.jpeg" alt="imagen"></p><br><p>  Además, ya en el servicio de hundimiento, el ejecutor recoge la llamada de saga creada previamente de la tienda y comienza a ejecutarla en pasos.  El primer paso en nuestro caso es comprar una suscripción premium.  En este momento, el dinero está reservado en el servicio de facturación. </p><br><p><img src="https://habrastorage.org/webt/hf/re/yi/hfreyiq0vpgiojytn2gts5ws1ww.jpeg" alt="imagen"></p><br><p>  Luego, en el servicio del usuario, se aplican las operaciones VAS. </p><br><p><img src="https://habrastorage.org/webt/cy/lg/_m/cylg_mbibq4b6wfqvu_wz7ylcre.jpeg" alt="imagen"></p><br><p>  Luego, los servicios VAS ya están en su lugar y se crean sus paquetes.  Otros pasos son posibles aún más, pero no son tan importantes para nosotros. </p><br><p><img src="https://habrastorage.org/webt/h6/3r/r8/h63rr8iufd3m4tzovgonjywezhu.jpeg" alt="imagen"></p><br><h2 id="avarii">  Choques </h2><br><p>  Los accidentes pueden ocurrir en cualquier servicio, pero hay trucos bien conocidos sobre cómo prepararse para ellos.  En un sistema distribuido, es importante conocer estas técnicas.  Por ejemplo, una de las limitaciones más importantes es que la red no siempre es confiable.  Enfoques que resolverán los problemas de interacción en sistemas distribuidos: </p><br><blockquote><ol><li>  Intentamos nuevamente. </li><li>  Marcamos cada operación con una clave idempotente.  Esto es necesario para evitar la duplicación de operaciones.  Más información sobre las claves idempotentes se puede encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> artículo. </li><li>  Compensamos las transacciones, una acción característica de las sagas. </li></ol><br></blockquote><br><h4 id="kompensaciya-tranzakciy-kak-eto-rabotaet">  Compensación de transacciones: cómo funciona </h4><br><p>  Para cada transacción positiva, debemos describir las acciones inversas: un escenario comercial del paso en caso de que algo salga mal. </p><br><p>  En nuestra implementación, ofrecemos el siguiente escenario de compensación: </p><br><p>  Si algún paso de la saga no tuvo éxito, e hicimos muchos intentos, entonces existe la posibilidad de que la última repetición de la operación haya sido exitosa, pero simplemente no obtuvimos una respuesta.  Intentaremos compensar la transacción, aunque este paso no es necesario si el ejecutor del servicio del paso del problema realmente se ha averiado y es completamente inaccesible. </p><br><p>  En nuestro ejemplo, se verá así: </p><br><ol><li>  Apague los paquetes VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/rf/6s/94/rf6s943lzidqq_hfyuu-_fnbd_a.jpeg" alt="imagen"></p><br><ol><li>  Cancele la operación del usuario. </li></ol><br><p><img src="https://habrastorage.org/webt/qv/wl/tx/qvwltxbftjc_diwxtudv5ym0mde.jpeg" alt="imagen"></p><br><ol><li>  Cancelamos la reserva de fondos. </li></ol><br><p><img src="https://habrastorage.org/webt/0b/_r/t9/0b_rt9gobty3zu1xhz6uqjo2cf8.jpeg" alt="imagen"></p><br><h4 id="chto-delat-esli-i-kompensaciya-ne-rabotaet">  Qué hacer si la compensación no funciona </h4><br><p>  Obviamente, debemos actuar aproximadamente en el mismo escenario.  Nuevamente, vuelva a intentar, claves idempotentes para compensar las transacciones, pero si no sale nada esta vez, por ejemplo, el servicio no está disponible, debe comunicarse con el propietario del servicio de la saga, informándole que la saga ha fallado.  Además, acciones más serias: escalar el problema, por ejemplo, para una prueba manual o iniciar la automatización para resolver tales problemas. </p><br><p>  Lo que es más importante: imagine que algún paso del servicio de saga no está disponible.  Seguramente el iniciador de estas acciones volverá a intentarlo.  Y al final, su servicio de saga da el primer paso, el segundo paso, y su ejecutor no está disponible, cancela el segundo paso, cancela el primer paso y también puede haber anomalías asociadas con la falta de aislamiento.  En general, el servicio de saga en esta situación se dedica a un trabajo inútil, que aún genera una carga y errores. </p><br><p>  Como hacerlo  Healthchecker debe entrevistar los servicios que completan los pasos caídos y ver si funcionan.  Si el servicio no está disponible, entonces hay dos formas: para compensar las sagas que están en funcionamiento, y para evitar que nuevas sagas creen nuevas instancias (llamadas), o para crear sin llevarlas a trabajar como un ejecutante, para que el servicio no acciones innecesarias </p><br><h4 id="esche-odin-scenariy-s-avariey">  Otro escenario de accidente </h4><br><p>  Imagine que estamos haciendo la misma suscripción premium nuevamente. </p><br><ol><li>  Compramos paquetes VAS y reservamos dinero. </li></ol><br><p><img src="https://habrastorage.org/webt/tn/ms/7p/tnms7pcslyj_8f4hftsqtzzlspm.jpeg" alt="imagen"></p><br><ol><li>  Aplicamos servicios al usuario. </li></ol><br><p><img src="https://habrastorage.org/webt/by/ep/fe/byepfee_drperqqj2on1hg3gq-a.jpeg" alt="imagen"></p><br><ol><li>  Creamos paquetes VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/yq/l_/sf/yql_sf9gnlyolfstvyug4gwaday.jpeg" alt="imagen"></p><br><p>  Parece estar bien  Pero de repente, cuando se completó la transacción, resulta que la replicación asincrónica se utiliza en el servicio de usuario y se ha producido un accidente en la base maestra.  Puede haber varias razones para un retraso de la réplica: una carga específica en la réplica que ralentiza la velocidad de reproducción de la réplica o bloquea la reproducción de la réplica.  Además, la fuente (maestra) se puede sobrecargar y aparece un retraso en el envío de cambios en el lado de la fuente.  En general, por alguna razón, la réplica estaba retrasada y los cambios del paso completado con éxito después del accidente desaparecieron repentinamente (resultado / estado). </p><br><p><img src="https://habrastorage.org/webt/hu/nh/hu/hunhhuizvvxmajf0hukmvbhzpnu.jpeg" alt="imagen"></p><br><p>  Para hacer esto, implementamos otro componente en el sistema: utilizamos el verificador.  Checker pasa por todos los pasos de las sagas exitosas a través de un tiempo que se sabe que es mayor que todos los retrasos posibles (por ejemplo, después de 12 horas), y verifica si todavía se completaron con éxito.  Si el paso falla repentinamente, la saga retrocede. </p><br><p><img src="https://habrastorage.org/webt/kn/9n/cy/kn9ncyccg350yxl-orc9jamngbm.jpeg" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/hz/af/-m/hzaf-mwke2a8cvi8mdlb_uzquxy.jpeg" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/jg/ex/dc/jgexdcrgimsuugdqw27gay_i2kw.jpeg" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/xp/hv/mo/xphvmouowjv2tgln0-o1mf43rts.jpeg" alt="imagen"></p><br><p>  También puede haber situaciones en las que después de 12 horas ya no hay nada que cancelar: todo cambia y se mueve.  En este caso, en lugar del escenario de cancelación, la solución puede ser indicarle al servicio del propietario de la saga que esta operación no se ha completado.  Si la operación de cancelación no es posible, por ejemplo, debe realizar una cancelación después de cobrarle al usuario, y su saldo ya es cero, y el dinero no puede cancelarse.  Tenemos tales escenarios que siempre se resuelven en la dirección del usuario.  Es posible que tenga un principio diferente, esto es consistente con los representantes del producto. </p><br><p>  Como resultado, como habrás notado, en diferentes lugares para la integración con el servicio sag necesitas implementar mucha lógica diferente.  Por lo tanto, cuando los equipos de clientes quieran crear una saga, tendrán un conjunto muy grande de tareas muy obvias.  En primer lugar, creamos una saga para que la duplicación no funcione, para esto estamos trabajando con una operación idempotente de crear una saga y su seguimiento.  Además, en los servicios, se requiere darse cuenta de la capacidad de rastrear cada paso de cada saga, para no realizarla dos veces, por un lado, y, por otro lado, para poder responder si realmente se completó.  Y todos estos mecanismos deben ser atendidos de alguna manera para que los repositorios de servicios no se desborden.  Además, hay muchos idiomas en los que se pueden escribir los servicios y una gran selección de repositorios.  En cada etapa, debe comprender la teoría e implementar toda esta lógica en diferentes partes.  Si no lo hace, puede cometer muchos errores. </p><br><p>  Hay muchas formas correctas, pero no hay menos situaciones en las que puedas "dispararte una extremidad".  Para que las sagas funcionen correctamente, debe encapsular todos los mecanismos anteriores en las bibliotecas de clientes que los implementarán de forma transparente para sus clientes. </p><br><h4 id="primer-logiki-generacii-sagi-kotoruyu-mozhno-skryt-v-klientskoy-biblioteke">  Un ejemplo de lógica de generación de saga que puede ocultarse en la biblioteca del cliente </h4><br><p>  Se puede hacer de manera diferente, pero propongo el siguiente enfoque. </p><br><ol><li>  Obtenemos el ID de solicitud por el cual debemos crear la saga. </li><li>  Vamos al servicio de hundimiento, obtenemos su identificador único, lo guardamos en el almacenamiento local junto con el ID de solicitud del punto 1. </li><li>  Ejecute la saga con carga útil en el servicio de hundimiento.  Un matiz importante: propongo operaciones locales del servicio que crea la saga, para diseñar, como el primer paso de la saga. </li><li>  Hay una cierta carrera cuando el servicio de saga puede realizar este paso (punto 3), y nuestro backend, que inicia la creación de la saga, también lo realizará.  Para hacer esto, hacemos operaciones idempotentes en todas partes: una persona lo realiza, y la segunda llamada simplemente recibe "OK". </li><li>  Llamamos al primer paso (punto 4) y solo después de eso respondemos al cliente que inició esta acción. </li></ol><br><p>  En este ejemplo, trabajamos con la saga como una base de datos.  Puede enviar una solicitud y luego la conexión puede interrumpirse, pero la acción se realizará.  Este es el mismo enfoque. </p><br><h2 id="kak-eto-vse-proverit">  Cómo comprobarlo todo </h2><br><p>  Es necesario cubrir todo el servicio de pruebas de pandeo.  Lo más probable es que realice cambios, y las pruebas escritas al comienzo ayudarán a evitar sorpresas inesperadas.  Además, es necesario verificar las sagas por sí mismas.  Por ejemplo, cómo organizamos la prueba del servicio de hundimiento y la secuencia de hundimiento en una transacción.  Hay diferentes bloques de prueba.  Si hablamos del servicio de hundimiento, él sabe cómo realizar transacciones positivas y de compensación, si la compensación no funciona, informa al propietario del hundimiento del servicio.  Escribimos pruebas de manera general para trabajar con una saga abstracta. </p><br><p>  Por otro lado, las transacciones positivas y las transacciones de compensación en servicios que realizan pasos caídos son una API simple, y las pruebas de esta parte son responsabilidad del equipo propietario de este servicio. </p><br><p>  Y luego, el equipo propietario de la saga escribe pruebas de extremo a extremo, donde verifica que toda la lógica de negocios funcione correctamente cuando se ejecuta la saga.  La prueba de extremo a extremo se ejecuta en un entorno de desarrollo completo, se generan todas las instancias de servicio, incluido el servicio de hundimiento, y ya se está probando un escenario empresarial. </p><br><p><img src="https://habrastorage.org/webt/qb/j0/gn/qbj0gnyhcjvk2lz4djeip_qfaqe.png" alt="imagen" width="340" height="233" align="right"><br>  <strong>Total:</strong> </p><br><ul><li>  escribir más pruebas unitarias; </li><li>  escribir pruebas de integración; </li><li>  escribir pruebas de punta a punta. <br><br clear="right">  El siguiente paso es CDC.  La arquitectura de microservicios afecta los detalles de las pruebas.  En Avito, adoptamos el siguiente enfoque para probar la arquitectura de microservicios: contratos dirigidos por el consumidor.  Este enfoque ayuda, en primer lugar, a resaltar los problemas que pueden identificarse en las pruebas de punta a punta, pero la prueba de punta a punta es "muy costosa". </li></ul><br><p>  ¿Cuál es la esencia de los CDC?  Hay un servicio que proporciona un contrato.  Él tiene una API, este es un proveedor.  Y hay otro servicio que llama a la API, es decir, utiliza el contrato: consumidor. </p><br><p>  El servicio al consumidor escribe pruebas para el contrato del proveedor, y las pruebas que solo el contrato verificará no son pruebas funcionales.  Es importante para nosotros asegurarnos de que al cambiar la API, los pasos en este contexto no se rompan.  Después de que escribimos las pruebas, aparece otro elemento del agente de servicio: la información sobre las pruebas de los CDC se registra en él.  Cada vez que se cambia el servicio del proveedor, se generará un entorno aislado y se ejecutarán las pruebas que escribió el consumidor.  Cuál es el resultado final: el equipo que genera las sagas escribe pruebas para todos los pasos de la saga y las registra. </p><br><p><img src="https://habrastorage.org/webt/n1/i-/hm/n1i-hmjmyxs9iavcoxzoem2mcly.jpeg" alt="imagen"><br>  Acerca de cómo Avito implementó el enfoque CDC para probar microservicios Frol Kryuchkov habló en RIT ++.  Los resúmenes se pueden encontrar en el sitio web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Backend.conf</a> : le recomiendo que se familiarice. </p><br><h2 id="vidy-sag">  Tipos de sagas </h2><br><h4 id="po-poryadku-vyzova-funkciy">  En el orden de las llamadas a funciones </h4><br><p>  a) desordenada: las funciones de la saga se llaman en cualquier orden y no esperan que se completen entre sí; <br>  b) ordenado: las funciones de la saga se llaman en el orden dado, una tras otra, la siguiente no se llama hasta que se completa la anterior; <br>  c) mixto: para parte de las funciones se establece el orden, pero para la parte no, pero se establece antes o después de las etapas para realizarlas. </p><br><p>  Considere un escenario específico.  En el mismo escenario de compra de una suscripción premium, el primer paso es reservar dinero.  Ahora podemos hacer cambios al usuario y crear paquetes premium en paralelo, y notificaremos al usuario solo cuando estos dos pasos hayan terminado. <br><img src="https://habrastorage.org/webt/d8/a0/r7/d8a0r7wv7mq1a8gdphaq0aug1oe.png" alt="imagen"></p><br><h4 id="po-polucheniyu-rezultata-vyzova-funkciy">  Al obtener el resultado de la llamada a la función </h4><br><p>  a) síncrono: el resultado de la función se conoce de inmediato; <br>  b) asíncrono: la función devuelve "OK" inmediatamente y el resultado se devuelve más tarde, a través de una devolución de llamada a la API del servicio sag del servicio del cliente. </p><br><p>  Quiero advertirle contra un error: es mejor no hacer pasos sincrónicos de las sagas, especialmente al implementar una saga orquestada.  Si realiza pasos de caída sincrónica, el servicio de caída esperará a que se complete este paso.  Esta es una carga adicional, problemas adicionales en el servicio de sagas, ya que es uno, y hay muchos participantes en sagas. </p><br><h2 id="masshtabirovanie-sag">  Descamación </h2><br><p>  El escalado depende del tamaño del sistema que planifique.  Considere la opción con una sola instancia de almacenamiento: </p><br><blockquote><ul><li>  un controlador de paso de saga, procese los pasos con lotes; </li><li>  n manejadores, implementamos un "peine": tomamos medidas para el resto de la división: cuando cada ejecutor obtiene sus propios pasos. </li><li>  n controladores y saltos bloqueados: serán aún más eficientes y más flexibles. </li></ul><br></blockquote><p>  Y solo entonces, si sabe de antemano que se encontrará con el rendimiento de un servidor en un DBMS, necesitará particionar: n instancias de bases de datos que funcionarán con su conjunto de datos.  El fragmentación se puede ocultar detrás de la API del servicio de hundimiento. </p><br><h4 id="bolshe-gibkosti">  Mayor flexibilidad </h4><br><p>  Además, en este patrón, al menos en teoría, el servicio al cliente (realizar el paso de la saga) puede acceder y encajar en el servicio de sag, y la participación en la saga también puede ser opcional.  También puede haber otro escenario: si ya ha enviado un correo electrónico, es imposible compensar la acción; no puede devolver la carta.  Pero puede enviar una nueva carta que indique que la anterior estaba equivocada, y parece ser así.  Es mejor usar un escenario en el que la saga se juegue solo hacia adelante, sin compensación alguna.  Si no avanza, es necesario informar al servicio del propietario de la saga sobre el problema. </p><br><h4 id="kogda-nuzhen-lok">  ¿Cuándo necesitas un candado? </h4><br><p>  Una pequeña digresión sobre las sagas en general: si puedes hacer tu lógica sin la saga, entonces hazlo.  Las sagas son difíciles.  Con el bloqueo, es casi lo mismo: es mejor evitar siempre los bloqueos. </p><br><p>  Cuando vine al equipo de facturación para hablar sobre sagas, me dijeron que necesitaban un candado.  Logré explicarles por qué es mejor prescindir de él y cómo hacerlo.  Pero si aún necesita un candado, esto debe preverse con anticipación.  Antes del servicio de hundimiento, ya implementamos bloqueos dentro del marco de un DBMS.  Un ejemplo con defproc y un script para bloquear anuncios asincrónicamente y bloquear una cuenta sincrónicamente, cuando primero hacemos parte de la operación sincrónicamente y configuramos el bloqueo, y luego de forma asíncrona en segundo plano terminamos el resto del trabajo con lotes. </p><br><p>  Como hacerlo         ,       ,    ,           , ,  -      ,  .          .   .    :       ,       ,            . </p><br><p>   -,  ,    .   ,      ,    .   , ,    .        .       —    ,     ,        . </p><br><h2 id="acid--bez-izolyacii"> ACID —   </h2><br><p>    ,     ,  .            .   —       durability.    .         .  ,     .   - ,  -  - ,          </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mo stretchy=&quot;false&quot;>(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy=&quot;false&quot;>)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.618ex" height="2.66ex" viewBox="0 -832 25238.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="8396" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="9209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="9738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="10339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="10808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-63" x="11338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="11771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="12133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="12478" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="12964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="13564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="14732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="15078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="15439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="15906" y="0"></use><g transform="translate(16653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="18488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6A" x="19192" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-28" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="19994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="20480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-43" x="20931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="21692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-29" x="22037" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="22427" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="23143" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="23595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="23940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="24302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="24768" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mo stretchy="false">(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy="false">)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">Ti reads => other rtransaction writes => Tj (or Ci) writes</script></p><br><p>   <strong></strong>  —      - ,  - , , -    ,      .    , - ,  -   . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.989ex" height="2.057ex" viewBox="0 -780.1 21953.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="1766" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="2218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="2563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="2925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="3391" y="0"></use><g transform="translate(4138,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="5973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="6459" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-68" x="6820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="8676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="9128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="9657" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="10258" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="10727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-63" x="11257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="11690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="12052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="12397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="12883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="13483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="13935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="14401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="14931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-43" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="18797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="19142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="19859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="20310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="20656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="21017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="21484" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">Ti writes => other transaction reads => Ci writes</script></p><br><p>  <strong></strong>  —               . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.154ex" height="2.419ex" viewBox="0 -780.1 21594.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="8306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="9287" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="9887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="10357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-63" x="10886" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="11320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="11681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="12027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="12512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="13113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="13829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="14626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="14988" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6A" x="18741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="19153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="20071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="20601" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="21124" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">Ti reads =>other transaction writes =>Tj reads</script></p><br><p>   : </p><br><blockquote><ol><li>    ,   , ,  ,      . </li><li> ,        .     ,    ,  ,  ,        ,     . </li><li>           . </li><li>   payload        .    eventual consistency —       ,  ,      ,     .     ,  , ,       -. </li></ol><br></blockquote><br><h2 id="monitoring">  Monitoreo </h2><br><p>             .    ,            .           .       checker.           .   ,   . </p><br><p><img src="https://habrastorage.org/webt/vm/gv/_w/vmgv_wl16ngyd78b78ndyp4v1_4.png" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/fv/cz/2l/fvcz2luhdac4ixpzmlbbarex_se.png" alt="imagen"></p><br><p>       (50%, 75%, 95%, 99%),        ,  -   . </p><br><p>    ,    —    ,         .         .     ,  -   .  ,       —           . </p><br><p>   .  ,  -   (   )   .    healthchecker   endpoint' info (keep-alive)  . </p><br><p>    .      -.  -,   -  ,           -  .       ,    ,    ,    end-to-end.      - . ,    ,      —    . <br>      .           . </p><br><h2 id="na-chto-stoit-obratit-vnimanie">     : </h2><br><h4 id="izbegat-parazitnyh-nagruzok">    </h4><br><p>    ,    healthchecker,   -    ,     .     ,   .       . </p><br><h4 id="izbegat-slozhnoy-logiki-izbytochnoy-funkcionalnosti-v-servise-sag">         </h4><br><p>       ,        .   ,     ,      .         .  choreography     —       -   .   ,       choreography- ,      .    choreography  ,    .     ,           . ,      ,       ,      . </p><br><h4 id="integrirovatsya-s-klientami">    </h4><br><p>        .     ,      ,         . ,        +               . </p><br><h4 id="versionnost-api">  API </h4><br><p>   ,   -     -  (  API ),    ,      API.                 API   .     —         .           API  ,    ,   100%       . </p><br><p>   ,     ,     ,     ,     .    —    ,    ,    .        . </p><br><h4 id="kompensaciya-pri-avariyah">    </h4><br><p>    ,    ,    ,          .        ( )         . </p><br><h4 id="otsutstvie-izolyacii">   </h4><br><p>     ,            ,  ,      ,        . </p><br><h4 id="blokirovki">  </h4><br><p>   .  ,     ,    . </p><br><h4 id="treysing-po-saga-call-id">   saga call ID </h4><br><p>         .  API   ,          . </p><br><h2 id="itog--chto-vybirat">  —   </h2><br><p> -      legacy .         ,      (       «»                ).    « »?    -  ,     ,    ,   ,    - ,          .     ,  ,           ,         .    ,    « »,     ,         -.  .  —     .  ,          . </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estoy a favor de un enfoque pragmático para el desarrollo, por lo que para escribir un servicio de saga, una inversión en la escritura de dicho servicio debería estar justificada. </font><font style="vertical-align: inherit;">Además, lo más probable es que muchas personas necesiten solo una parte de lo que describí, y esta parte resolverá las necesidades actuales. </font><font style="vertical-align: inherit;">Lo principal es comprender de antemano qué se necesita exactamente de todo esto. </font><font style="vertical-align: inherit;">Y cuantos recursos tienes.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si tiene preguntas o está interesado en aprender más sobre las sagas, escriba los comentarios. </font><font style="vertical-align: inherit;">Estaré encantado de responder.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418235/">https://habr.com/ru/post/es418235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418223/index.html">Curso MIT "Seguridad de sistemas informáticos". Lección 7: El sandbox del cliente nativo, parte 1</a></li>
<li><a href="../es418225/index.html">Curso MIT "Seguridad de sistemas informáticos". Lección 7: Sandbox de Native Client Parte 2</a></li>
<li><a href="../es418227/index.html">Curso MIT "Seguridad de sistemas informáticos". Lección 7: El sandbox del cliente nativo, parte 3</a></li>
<li><a href="../es418229/index.html">Curso MIT "Seguridad de sistemas informáticos". Lección 8: Modelo de seguridad de red, parte 1</a></li>
<li><a href="../es418233/index.html">BMW mnemotecnia para encontrar valores límite</a></li>
<li><a href="../es418237/index.html">Desarrollo de aplicaciones multiinquilino en la plataforma SAP Cloud en Neo, Parte 2: Autorización y autenticación</a></li>
<li><a href="../es418239/index.html">48 megapíxeles para teléfono inteligente</a></li>
<li><a href="../es418241/index.html">¿Por qué gauss? (100 formas de resolver el sistema de ecuaciones)</a></li>
<li><a href="../es418243/index.html">La historia popular de la astronomía está equivocada</a></li>
<li><a href="../es418245/index.html">Cómo no desarrollar un proyecto en Bitrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>