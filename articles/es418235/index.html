<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåñ üë¶üèæ üåô Saga orquestada o c√≥mo construir transacciones comerciales en servicios con la base de datos por patr√≥n de servicio üìï üöµüèæ üöπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Mi nombre es Konstantin Evteev, trabajo en Avito como l√≠der de la unidad DBA. Nuestro equipo desarrolla sistemas de almacenamiento Avito, ayuda e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Saga orquestada o c√≥mo construir transacciones comerciales en servicios con la base de datos por patr√≥n de servicio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418235/"><p>  Hola  Mi nombre es Konstantin Evteev, trabajo en Avito como l√≠der de la unidad DBA.  Nuestro equipo desarrolla sistemas de almacenamiento Avito, ayuda en la selecci√≥n o emisi√≥n de bases de datos y la infraestructura relacionada, es compatible con el objetivo de nivel de servicio para servidores de bases de datos, y tambi√©n somos responsables de la eficiencia y el monitoreo de los recursos, asesorar sobre el dise√±o y posiblemente desarrollar microservicios, vinculado a sistemas de almacenamiento o servicios para el desarrollo de la plataforma en el contexto del almacenamiento. </p><br><p>  Quiero contarles c√≥mo resolvimos uno de los desaf√≠os de la arquitectura de microservicios: realizar transacciones comerciales en la infraestructura de servicios creados utilizando la base de datos por patr√≥n de servicio.  Hice una presentaci√≥n sobre este tema en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conferencia Highload ++ Siberia 2018</a> . </p><br><img src="https://habrastorage.org/webt/r3/bz/ty/r3bztya5eso1a_fkh9laghkue9k.png" alt="imagen"><a name="habracut"></a><br><p><br></p><br><h2 id="teoriya-maksimalno-kratko">  Teor√≠a  Lo m√°s corto posible </h2><br><p>  No describir√© en detalle la teor√≠a de las sagas.  Te dar√© solo una breve introducci√≥n para que entiendas el contexto. </p><br><p>  Como era antes (desde el comienzo de Avito hasta 2015 - 2016): viv√≠amos en un monolito, con bases monol√≠ticas y aplicaciones monol√≠ticas.  En alg√∫n momento, estas condiciones comenzaron a impedirnos crecer.  Por un lado, nos encontramos con el rendimiento de un servidor con una base de datos principal, pero esta no es la raz√≥n principal, ya que el problema de rendimiento se puede resolver, por ejemplo, mediante el uso de fragmentos.  Por otro lado, el monolito tiene una l√≥gica muy compleja, y en una determinada etapa de crecimiento, la entrega de cambios (lanzamientos) se vuelve muy larga e impredecible: hay muchas dependencias no obvias y complejas (todo est√° estrechamente conectado), tambi√©n es dif√≠cil de probar, en general hay muchos problemas.  La soluci√≥n es cambiar a la arquitectura de microservicios.  En esta etapa, ten√≠amos una pregunta con las transacciones comerciales fuertemente ligadas a los ACID proporcionados por una base monol√≠tica: no est√° claro c√≥mo migrar esta l√≥gica comercial.  Cuando se trabaja con Avito, hay muchos escenarios diferentes implementados por varios servicios, cuando la integridad y la consistencia de los datos es muy importante, por ejemplo, comprar una suscripci√≥n premium, debitar dinero, solicitar servicios a un usuario, comprar paquetes VAS; en caso de circunstancias imprevistas o accidentes, todo puede no ir inesperadamente De acuerdo al plan.  Encontramos la soluci√≥n en las sagas. </p><br><p>  Me gusta la <a href="">descripci√≥n t√©cnica de las</a> sagas en 1987 por Kenneth Salem y H√©ctor Garc√≠a Molina, uno de los miembros actuales de la junta directiva de Oracle.  C√≥mo se formul√≥ el problema: hay un n√∫mero relativamente peque√±o de transacciones de larga duraci√≥n que durante mucho tiempo impiden la ejecuci√≥n de operaciones peque√±as, menos demandantes de recursos y m√°s frecuentes.  Como resultado deseado, puede dar un ejemplo de la vida: seguramente, muchos de ustedes hicieron cola para copiar documentos, y el operador de la copiadora, si ten√≠a la tarea de copiar un libro completo o solo muchas copias, hac√≠a copias de otros miembros de la cola de vez en cuando.  Pero disponer de recursos es solo una parte del problema.  La situaci√≥n se ve agravada por bloqueos a largo plazo cuando se realizan tareas intensivas en recursos, cuya cascada se construir√° en su DBMS.  Adem√°s, pueden ocurrir errores durante una transacci√≥n larga: la transacci√≥n no se completar√° y comenzar√° la reversi√≥n.  Si la transacci√≥n fue larga, entonces la reversi√≥n tambi√©n tomar√° mucho tiempo, y probablemente habr√° un reintento desde la aplicaci√≥n.  En general, "todo es bastante interesante".  La soluci√≥n propuesta en la descripci√≥n t√©cnica de SAGAS es dividir una transacci√≥n larga en partes. </p><br><p>  Me parece que muchos se acercaron a esto sin siquiera leer este documento.  Hemos hablado repetidamente sobre nuestro defproc (procedimientos diferidos implementados usando pgq).  Por ejemplo, cuando bloqueamos a un usuario por fraude, realizamos r√°pidamente una transacci√≥n corta y respondemos al cliente.  En esta breve transacci√≥n, que incluye, colocamos la tarea en una cola transaccional, y luego de forma as√≠ncrona, en peque√±os lotes, por ejemplo, diez anuncios bloquean sus anuncios.  Lo hicimos implementando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">colas transaccionales desde Skype</a> . </p><br><p>  Pero nuestra historia de hoy es un poco diferente.  Necesitamos ver estos problemas desde el otro lado: aserrando un monolito en microservicios creados usando la base de datos por patr√≥n de servicio. </p><br><p>  Uno de los par√°metros m√°s importantes para nosotros es lograr la m√°xima velocidad de corte.  Por lo tanto, decidimos transferir la funcionalidad anterior y toda la l√≥gica tal como es a los microservicios, sin cambiar nada en absoluto.  Requisitos adicionales que necesit√°bamos cumplir: </p><br><blockquote><ul><li>  Proporcionar cambios de datos dependientes para datos cr√≠ticos del negocio. </li><li>  ser capaz de establecer un orden estricto; </li><li>  observar un cien por ciento de consistencia: coordinar los datos incluso en caso de accidentes; </li><li>  Garantizar el funcionamiento de las transacciones a todos los niveles. </li></ul><br></blockquote><p>  Seg√∫n los requisitos anteriores, la soluci√≥n en forma de saga orquestada es la m√°s adecuada. </p><br><h2 id="realizaciya-orkestriruemoy-sagi-v-vide-servisa-pg-saga">  Implementaci√≥n de una saga orquestada como un servicio PG Saga </h2><br><p>  As√≠ es como se ve el servicio PG Saga. </p><br><p><img src="https://habrastorage.org/webt/mi/zm/0f/mizm0fidaxgpcv3wxoway4ksgoe.jpeg" alt="imagen"></p><br><p>  PG en el nombre, porque PostgreSQL s√≠ncrono se usa como un repositorio de servicios.  ¬øQu√© m√°s hay dentro? </p><br><ul><li>  API </li><li>  albacea </li><li>  corrector </li><li>  chequeador de salud; </li><li>  compensador </li></ul><br><p>  El diagrama tambi√©n muestra al propietario del servicio de las sagas, y a continuaci√≥n se muestran los servicios que realizar√°n los pasos de la saga.  Pueden tener diferentes repositorios. </p><br><h4 id="kak-eto-rabotaet">  Como funciona </h4><br><p>  Considere el ejemplo de comprar paquetes VAS.  VAS (servicios de valores agregados): servicios pagados para la promoci√≥n de anuncios. </p><br><p>  Primero, el propietario del servicio de la saga debe registrar la creaci√≥n de la saga en el servicio de saga </p><br><p><img src="https://habrastorage.org/webt/6d/yo/zs/6dyozsxy0_qfoqmrtlrbijfaxeu.jpeg" alt="imagen"></p><br><p>  Despu√©s de eso, genera una clase de saga ya con Payload. </p><br><p><img src="https://habrastorage.org/webt/ul/hr/ic/ulhric8ofs455lgaz4mozdhs2l8.jpeg" alt="imagen"></p><br><p>  Adem√°s, ya en el servicio de hundimiento, el ejecutor recoge la llamada de saga creada previamente de la tienda y comienza a ejecutarla en pasos.  El primer paso en nuestro caso es comprar una suscripci√≥n premium.  En este momento, el dinero est√° reservado en el servicio de facturaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/hf/re/yi/hfreyiq0vpgiojytn2gts5ws1ww.jpeg" alt="imagen"></p><br><p>  Luego, en el servicio del usuario, se aplican las operaciones VAS. </p><br><p><img src="https://habrastorage.org/webt/cy/lg/_m/cylg_mbibq4b6wfqvu_wz7ylcre.jpeg" alt="imagen"></p><br><p>  Luego, los servicios VAS ya est√°n en su lugar y se crean sus paquetes.  Otros pasos son posibles a√∫n m√°s, pero no son tan importantes para nosotros. </p><br><p><img src="https://habrastorage.org/webt/h6/3r/r8/h63rr8iufd3m4tzovgonjywezhu.jpeg" alt="imagen"></p><br><h2 id="avarii">  Choques </h2><br><p>  Los accidentes pueden ocurrir en cualquier servicio, pero hay trucos bien conocidos sobre c√≥mo prepararse para ellos.  En un sistema distribuido, es importante conocer estas t√©cnicas.  Por ejemplo, una de las limitaciones m√°s importantes es que la red no siempre es confiable.  Enfoques que resolver√°n los problemas de interacci√≥n en sistemas distribuidos: </p><br><blockquote><ol><li>  Intentamos nuevamente. </li><li>  Marcamos cada operaci√≥n con una clave idempotente.  Esto es necesario para evitar la duplicaci√≥n de operaciones.  M√°s informaci√≥n sobre las claves idempotentes se puede encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> art√≠culo. </li><li>  Compensamos las transacciones, una acci√≥n caracter√≠stica de las sagas. </li></ol><br></blockquote><br><h4 id="kompensaciya-tranzakciy-kak-eto-rabotaet">  Compensaci√≥n de transacciones: c√≥mo funciona </h4><br><p>  Para cada transacci√≥n positiva, debemos describir las acciones inversas: un escenario comercial del paso en caso de que algo salga mal. </p><br><p>  En nuestra implementaci√≥n, ofrecemos el siguiente escenario de compensaci√≥n: </p><br><p>  Si alg√∫n paso de la saga no tuvo √©xito, e hicimos muchos intentos, entonces existe la posibilidad de que la √∫ltima repetici√≥n de la operaci√≥n haya sido exitosa, pero simplemente no obtuvimos una respuesta.  Intentaremos compensar la transacci√≥n, aunque este paso no es necesario si el ejecutor del servicio del paso del problema realmente se ha averiado y es completamente inaccesible. </p><br><p>  En nuestro ejemplo, se ver√° as√≠: </p><br><ol><li>  Apague los paquetes VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/rf/6s/94/rf6s943lzidqq_hfyuu-_fnbd_a.jpeg" alt="imagen"></p><br><ol><li>  Cancele la operaci√≥n del usuario. </li></ol><br><p><img src="https://habrastorage.org/webt/qv/wl/tx/qvwltxbftjc_diwxtudv5ym0mde.jpeg" alt="imagen"></p><br><ol><li>  Cancelamos la reserva de fondos. </li></ol><br><p><img src="https://habrastorage.org/webt/0b/_r/t9/0b_rt9gobty3zu1xhz6uqjo2cf8.jpeg" alt="imagen"></p><br><h4 id="chto-delat-esli-i-kompensaciya-ne-rabotaet">  Qu√© hacer si la compensaci√≥n no funciona </h4><br><p>  Obviamente, debemos actuar aproximadamente en el mismo escenario.  Nuevamente, vuelva a intentar, claves idempotentes para compensar las transacciones, pero si no sale nada esta vez, por ejemplo, el servicio no est√° disponible, debe comunicarse con el propietario del servicio de la saga, inform√°ndole que la saga ha fallado.  Adem√°s, acciones m√°s serias: escalar el problema, por ejemplo, para una prueba manual o iniciar la automatizaci√≥n para resolver tales problemas. </p><br><p>  Lo que es m√°s importante: imagine que alg√∫n paso del servicio de saga no est√° disponible.  Seguramente el iniciador de estas acciones volver√° a intentarlo.  Y al final, su servicio de saga da el primer paso, el segundo paso, y su ejecutor no est√° disponible, cancela el segundo paso, cancela el primer paso y tambi√©n puede haber anomal√≠as asociadas con la falta de aislamiento.  En general, el servicio de saga en esta situaci√≥n se dedica a un trabajo in√∫til, que a√∫n genera una carga y errores. </p><br><p>  Como hacerlo  Healthchecker debe entrevistar los servicios que completan los pasos ca√≠dos y ver si funcionan.  Si el servicio no est√° disponible, entonces hay dos formas: para compensar las sagas que est√°n en funcionamiento, y para evitar que nuevas sagas creen nuevas instancias (llamadas), o para crear sin llevarlas a trabajar como un ejecutante, para que el servicio no acciones innecesarias </p><br><h4 id="esche-odin-scenariy-s-avariey">  Otro escenario de accidente </h4><br><p>  Imagine que estamos haciendo la misma suscripci√≥n premium nuevamente. </p><br><ol><li>  Compramos paquetes VAS y reservamos dinero. </li></ol><br><p><img src="https://habrastorage.org/webt/tn/ms/7p/tnms7pcslyj_8f4hftsqtzzlspm.jpeg" alt="imagen"></p><br><ol><li>  Aplicamos servicios al usuario. </li></ol><br><p><img src="https://habrastorage.org/webt/by/ep/fe/byepfee_drperqqj2on1hg3gq-a.jpeg" alt="imagen"></p><br><ol><li>  Creamos paquetes VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/yq/l_/sf/yql_sf9gnlyolfstvyug4gwaday.jpeg" alt="imagen"></p><br><p>  Parece estar bien  Pero de repente, cuando se complet√≥ la transacci√≥n, resulta que la replicaci√≥n asincr√≥nica se utiliza en el servicio de usuario y se ha producido un accidente en la base maestra.  Puede haber varias razones para un retraso de la r√©plica: una carga espec√≠fica en la r√©plica que ralentiza la velocidad de reproducci√≥n de la r√©plica o bloquea la reproducci√≥n de la r√©plica.  Adem√°s, la fuente (maestra) se puede sobrecargar y aparece un retraso en el env√≠o de cambios en el lado de la fuente.  En general, por alguna raz√≥n, la r√©plica estaba retrasada y los cambios del paso completado con √©xito despu√©s del accidente desaparecieron repentinamente (resultado / estado). </p><br><p><img src="https://habrastorage.org/webt/hu/nh/hu/hunhhuizvvxmajf0hukmvbhzpnu.jpeg" alt="imagen"></p><br><p>  Para hacer esto, implementamos otro componente en el sistema: utilizamos el verificador.  Checker pasa por todos los pasos de las sagas exitosas a trav√©s de un tiempo que se sabe que es mayor que todos los retrasos posibles (por ejemplo, despu√©s de 12 horas), y verifica si todav√≠a se completaron con √©xito.  Si el paso falla repentinamente, la saga retrocede. </p><br><p><img src="https://habrastorage.org/webt/kn/9n/cy/kn9ncyccg350yxl-orc9jamngbm.jpeg" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/hz/af/-m/hzaf-mwke2a8cvi8mdlb_uzquxy.jpeg" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/jg/ex/dc/jgexdcrgimsuugdqw27gay_i2kw.jpeg" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/xp/hv/mo/xphvmouowjv2tgln0-o1mf43rts.jpeg" alt="imagen"></p><br><p>  Tambi√©n puede haber situaciones en las que despu√©s de 12 horas ya no hay nada que cancelar: todo cambia y se mueve.  En este caso, en lugar del escenario de cancelaci√≥n, la soluci√≥n puede ser indicarle al servicio del propietario de la saga que esta operaci√≥n no se ha completado.  Si la operaci√≥n de cancelaci√≥n no es posible, por ejemplo, debe realizar una cancelaci√≥n despu√©s de cobrarle al usuario, y su saldo ya es cero, y el dinero no puede cancelarse.  Tenemos tales escenarios que siempre se resuelven en la direcci√≥n del usuario.  Es posible que tenga un principio diferente, esto es consistente con los representantes del producto. </p><br><p>  Como resultado, como habr√°s notado, en diferentes lugares para la integraci√≥n con el servicio sag necesitas implementar mucha l√≥gica diferente.  Por lo tanto, cuando los equipos de clientes quieran crear una saga, tendr√°n un conjunto muy grande de tareas muy obvias.  En primer lugar, creamos una saga para que la duplicaci√≥n no funcione, para esto estamos trabajando con una operaci√≥n idempotente de crear una saga y su seguimiento.  Adem√°s, en los servicios, se requiere darse cuenta de la capacidad de rastrear cada paso de cada saga, para no realizarla dos veces, por un lado, y, por otro lado, para poder responder si realmente se complet√≥.  Y todos estos mecanismos deben ser atendidos de alguna manera para que los repositorios de servicios no se desborden.  Adem√°s, hay muchos idiomas en los que se pueden escribir los servicios y una gran selecci√≥n de repositorios.  En cada etapa, debe comprender la teor√≠a e implementar toda esta l√≥gica en diferentes partes.  Si no lo hace, puede cometer muchos errores. </p><br><p>  Hay muchas formas correctas, pero no hay menos situaciones en las que puedas "dispararte una extremidad".  Para que las sagas funcionen correctamente, debe encapsular todos los mecanismos anteriores en las bibliotecas de clientes que los implementar√°n de forma transparente para sus clientes. </p><br><h4 id="primer-logiki-generacii-sagi-kotoruyu-mozhno-skryt-v-klientskoy-biblioteke">  Un ejemplo de l√≥gica de generaci√≥n de saga que puede ocultarse en la biblioteca del cliente </h4><br><p>  Se puede hacer de manera diferente, pero propongo el siguiente enfoque. </p><br><ol><li>  Obtenemos el ID de solicitud por el cual debemos crear la saga. </li><li>  Vamos al servicio de hundimiento, obtenemos su identificador √∫nico, lo guardamos en el almacenamiento local junto con el ID de solicitud del punto 1. </li><li>  Ejecute la saga con carga √∫til en el servicio de hundimiento.  Un matiz importante: propongo operaciones locales del servicio que crea la saga, para dise√±ar, como el primer paso de la saga. </li><li>  Hay una cierta carrera cuando el servicio de saga puede realizar este paso (punto 3), y nuestro backend, que inicia la creaci√≥n de la saga, tambi√©n lo realizar√°.  Para hacer esto, hacemos operaciones idempotentes en todas partes: una persona lo realiza, y la segunda llamada simplemente recibe "OK". </li><li>  Llamamos al primer paso (punto 4) y solo despu√©s de eso respondemos al cliente que inici√≥ esta acci√≥n. </li></ol><br><p>  En este ejemplo, trabajamos con la saga como una base de datos.  Puede enviar una solicitud y luego la conexi√≥n puede interrumpirse, pero la acci√≥n se realizar√°.  Este es el mismo enfoque. </p><br><h2 id="kak-eto-vse-proverit">  C√≥mo comprobarlo todo </h2><br><p>  Es necesario cubrir todo el servicio de pruebas de pandeo.  Lo m√°s probable es que realice cambios, y las pruebas escritas al comienzo ayudar√°n a evitar sorpresas inesperadas.  Adem√°s, es necesario verificar las sagas por s√≠ mismas.  Por ejemplo, c√≥mo organizamos la prueba del servicio de hundimiento y la secuencia de hundimiento en una transacci√≥n.  Hay diferentes bloques de prueba.  Si hablamos del servicio de hundimiento, √©l sabe c√≥mo realizar transacciones positivas y de compensaci√≥n, si la compensaci√≥n no funciona, informa al propietario del hundimiento del servicio.  Escribimos pruebas de manera general para trabajar con una saga abstracta. </p><br><p>  Por otro lado, las transacciones positivas y las transacciones de compensaci√≥n en servicios que realizan pasos ca√≠dos son una API simple, y las pruebas de esta parte son responsabilidad del equipo propietario de este servicio. </p><br><p>  Y luego, el equipo propietario de la saga escribe pruebas de extremo a extremo, donde verifica que toda la l√≥gica de negocios funcione correctamente cuando se ejecuta la saga.  La prueba de extremo a extremo se ejecuta en un entorno de desarrollo completo, se generan todas las instancias de servicio, incluido el servicio de hundimiento, y ya se est√° probando un escenario empresarial. </p><br><p><img src="https://habrastorage.org/webt/qb/j0/gn/qbj0gnyhcjvk2lz4djeip_qfaqe.png" alt="imagen" width="340" height="233" align="right"><br>  <strong>Total:</strong> </p><br><ul><li>  escribir m√°s pruebas unitarias; </li><li>  escribir pruebas de integraci√≥n; </li><li>  escribir pruebas de punta a punta. <br><br clear="right">  El siguiente paso es CDC.  La arquitectura de microservicios afecta los detalles de las pruebas.  En Avito, adoptamos el siguiente enfoque para probar la arquitectura de microservicios: contratos dirigidos por el consumidor.  Este enfoque ayuda, en primer lugar, a resaltar los problemas que pueden identificarse en las pruebas de punta a punta, pero la prueba de punta a punta es "muy costosa". </li></ul><br><p>  ¬øCu√°l es la esencia de los CDC?  Hay un servicio que proporciona un contrato.  √âl tiene una API, este es un proveedor.  Y hay otro servicio que llama a la API, es decir, utiliza el contrato: consumidor. </p><br><p>  El servicio al consumidor escribe pruebas para el contrato del proveedor, y las pruebas que solo el contrato verificar√° no son pruebas funcionales.  Es importante para nosotros asegurarnos de que al cambiar la API, los pasos en este contexto no se rompan.  Despu√©s de que escribimos las pruebas, aparece otro elemento del agente de servicio: la informaci√≥n sobre las pruebas de los CDC se registra en √©l.  Cada vez que se cambia el servicio del proveedor, se generar√° un entorno aislado y se ejecutar√°n las pruebas que escribi√≥ el consumidor.  Cu√°l es el resultado final: el equipo que genera las sagas escribe pruebas para todos los pasos de la saga y las registra. </p><br><p><img src="https://habrastorage.org/webt/n1/i-/hm/n1i-hmjmyxs9iavcoxzoem2mcly.jpeg" alt="imagen"><br>  Acerca de c√≥mo Avito implement√≥ el enfoque CDC para probar microservicios Frol Kryuchkov habl√≥ en RIT ++.  Los res√∫menes se pueden encontrar en el sitio web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Backend.conf</a> : le recomiendo que se familiarice. </p><br><h2 id="vidy-sag">  Tipos de sagas </h2><br><h4 id="po-poryadku-vyzova-funkciy">  En el orden de las llamadas a funciones </h4><br><p>  a) desordenada: las funciones de la saga se llaman en cualquier orden y no esperan que se completen entre s√≠; <br>  b) ordenado: las funciones de la saga se llaman en el orden dado, una tras otra, la siguiente no se llama hasta que se completa la anterior; <br>  c) mixto: para parte de las funciones se establece el orden, pero para la parte no, pero se establece antes o despu√©s de las etapas para realizarlas. </p><br><p>  Considere un escenario espec√≠fico.  En el mismo escenario de compra de una suscripci√≥n premium, el primer paso es reservar dinero.  Ahora podemos hacer cambios al usuario y crear paquetes premium en paralelo, y notificaremos al usuario solo cuando estos dos pasos hayan terminado. <br><img src="https://habrastorage.org/webt/d8/a0/r7/d8a0r7wv7mq1a8gdphaq0aug1oe.png" alt="imagen"></p><br><h4 id="po-polucheniyu-rezultata-vyzova-funkciy">  Al obtener el resultado de la llamada a la funci√≥n </h4><br><p>  a) s√≠ncrono: el resultado de la funci√≥n se conoce de inmediato; <br>  b) as√≠ncrono: la funci√≥n devuelve "OK" inmediatamente y el resultado se devuelve m√°s tarde, a trav√©s de una devoluci√≥n de llamada a la API del servicio sag del servicio del cliente. </p><br><p>  Quiero advertirle contra un error: es mejor no hacer pasos sincr√≥nicos de las sagas, especialmente al implementar una saga orquestada.  Si realiza pasos de ca√≠da sincr√≥nica, el servicio de ca√≠da esperar√° a que se complete este paso.  Esta es una carga adicional, problemas adicionales en el servicio de sagas, ya que es uno, y hay muchos participantes en sagas. </p><br><h2 id="masshtabirovanie-sag">  Descamaci√≥n </h2><br><p>  El escalado depende del tama√±o del sistema que planifique.  Considere la opci√≥n con una sola instancia de almacenamiento: </p><br><blockquote><ul><li>  un controlador de paso de saga, procese los pasos con lotes; </li><li>  n manejadores, implementamos un "peine": tomamos medidas para el resto de la divisi√≥n: cuando cada ejecutor obtiene sus propios pasos. </li><li>  n controladores y saltos bloqueados: ser√°n a√∫n m√°s eficientes y m√°s flexibles. </li></ul><br></blockquote><p>  Y solo entonces, si sabe de antemano que se encontrar√° con el rendimiento de un servidor en un DBMS, necesitar√° particionar: n instancias de bases de datos que funcionar√°n con su conjunto de datos.  El fragmentaci√≥n se puede ocultar detr√°s de la API del servicio de hundimiento. </p><br><h4 id="bolshe-gibkosti">  Mayor flexibilidad </h4><br><p>  Adem√°s, en este patr√≥n, al menos en teor√≠a, el servicio al cliente (realizar el paso de la saga) puede acceder y encajar en el servicio de sag, y la participaci√≥n en la saga tambi√©n puede ser opcional.  Tambi√©n puede haber otro escenario: si ya ha enviado un correo electr√≥nico, es imposible compensar la acci√≥n; no puede devolver la carta.  Pero puede enviar una nueva carta que indique que la anterior estaba equivocada, y parece ser as√≠.  Es mejor usar un escenario en el que la saga se juegue solo hacia adelante, sin compensaci√≥n alguna.  Si no avanza, es necesario informar al servicio del propietario de la saga sobre el problema. </p><br><h4 id="kogda-nuzhen-lok">  ¬øCu√°ndo necesitas un candado? </h4><br><p>  Una peque√±a digresi√≥n sobre las sagas en general: si puedes hacer tu l√≥gica sin la saga, entonces hazlo.  Las sagas son dif√≠ciles.  Con el bloqueo, es casi lo mismo: es mejor evitar siempre los bloqueos. </p><br><p>  Cuando vine al equipo de facturaci√≥n para hablar sobre sagas, me dijeron que necesitaban un candado.  Logr√© explicarles por qu√© es mejor prescindir de √©l y c√≥mo hacerlo.  Pero si a√∫n necesita un candado, esto debe preverse con anticipaci√≥n.  Antes del servicio de hundimiento, ya implementamos bloqueos dentro del marco de un DBMS.  Un ejemplo con defproc y un script para bloquear anuncios asincr√≥nicamente y bloquear una cuenta sincr√≥nicamente, cuando primero hacemos parte de la operaci√≥n sincr√≥nicamente y configuramos el bloqueo, y luego de forma as√≠ncrona en segundo plano terminamos el resto del trabajo con lotes. </p><br><p>  Como hacerlo         ,       ,    ,           , ,  -      ,  .          .   .    :       ,       ,            . </p><br><p>   -,  ,    .   ,      ,    .   , ,    .        .       ‚Äî    ,     ,        . </p><br><h2 id="acid--bez-izolyacii"> ACID ‚Äî   </h2><br><p>    ,     ,  .            .   ‚Äî       durability.    .         .  ,     .   - ,  -  - ,          </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mo stretchy=&quot;false&quot;>(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy=&quot;false&quot;>)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.618ex" height="2.66ex" viewBox="0 -832 25238.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="8396" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="9209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="9738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="10339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="10808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-63" x="11338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="11771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="12133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="12478" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="12964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="13564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="14732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="15078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="15439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="15906" y="0"></use><g transform="translate(16653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="18488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6A" x="19192" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-28" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="19994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="20480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-43" x="20931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="21692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-29" x="22037" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="22427" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="23143" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="23595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="23940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="24302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="24768" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mo stretchy="false">(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy="false">)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">Ti reads => other rtransaction writes => Tj (or Ci) writes</script></p><br><p>   <strong></strong>  ‚Äî      - ,  - , , -    ,      .    , - ,  -   . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.989ex" height="2.057ex" viewBox="0 -780.1 21953.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="1766" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="2218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="2563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="2925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="3391" y="0"></use><g transform="translate(4138,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="5973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="6459" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-68" x="6820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="8676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="9128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="9657" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="10258" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="10727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-63" x="11257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="11690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="12052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="12397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="12883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="13483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="13935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="14401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="14931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-43" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="18797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="19142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="19859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="20310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="20656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="21017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="21484" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">Ti writes => other transaction reads => Ci writes</script></p><br><p>  <strong></strong>  ‚Äî               . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.154ex" height="2.419ex" viewBox="0 -780.1 21594.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="8306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="9287" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="9887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="10357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-63" x="10886" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="11320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="11681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6F" x="12027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6E" x="12512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-77" x="13113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="13829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-69" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-74" x="14626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="14988" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-54" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-6A" x="18741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-72" x="19153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-65" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-61" x="20071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-64" x="20601" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhjxzumfE6q6-UtfKlC2S_BvManZQA#MJMATHI-73" x="21124" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">Ti reads =>other transaction writes =>Tj reads</script></p><br><p>   : </p><br><blockquote><ol><li>    ,   , ,  ,      . </li><li> ,        .     ,    ,  ,  ,        ,     . </li><li>           . </li><li>   payload        .    eventual consistency ‚Äî       ,  ,      ,     .     ,  , ,       -. </li></ol><br></blockquote><br><h2 id="monitoring">  Monitoreo </h2><br><p>             .    ,            .           .       checker.           .   ,   . </p><br><p><img src="https://habrastorage.org/webt/vm/gv/_w/vmgv_wl16ngyd78b78ndyp4v1_4.png" alt="imagen"></p><br><p><img src="https://habrastorage.org/webt/fv/cz/2l/fvcz2luhdac4ixpzmlbbarex_se.png" alt="imagen"></p><br><p>       (50%, 75%, 95%, 99%),        ,  -   . </p><br><p>    ,    ‚Äî    ,         .         .     ,  -   .  ,       ‚Äî           . </p><br><p>   .  ,  -   (   )   .    healthchecker   endpoint' info (keep-alive)  . </p><br><p>    .      -.  -,   -  ,           -  .       ,    ,    ,    end-to-end.      - . ,    ,      ‚Äî    . <br>      .           . </p><br><h2 id="na-chto-stoit-obratit-vnimanie">     : </h2><br><h4 id="izbegat-parazitnyh-nagruzok">    </h4><br><p>    ,    healthchecker,   -    ,     .     ,   .       . </p><br><h4 id="izbegat-slozhnoy-logiki-izbytochnoy-funkcionalnosti-v-servise-sag">         </h4><br><p>       ,        .   ,     ,      .         .  choreography     ‚Äî       -   .   ,       choreography- ,      .    choreography  ,    .     ,           . ,      ,       ,      . </p><br><h4 id="integrirovatsya-s-klientami">    </h4><br><p>        .     ,      ,         . ,        +               . </p><br><h4 id="versionnost-api">  API </h4><br><p>   ,   -     -  (  API ),    ,      API.                 API   .     ‚Äî         .           API  ,    ,   100%       . </p><br><p>   ,     ,     ,     ,     .    ‚Äî    ,    ,    .        . </p><br><h4 id="kompensaciya-pri-avariyah">    </h4><br><p>    ,    ,    ,          .        ( )         . </p><br><h4 id="otsutstvie-izolyacii">   </h4><br><p>     ,            ,  ,      ,        . </p><br><h4 id="blokirovki">  </h4><br><p>   .  ,     ,    . </p><br><h4 id="treysing-po-saga-call-id">   saga call ID </h4><br><p>         .  API   ,          . </p><br><h2 id="itog--chto-vybirat">  ‚Äî   </h2><br><p> -      legacy .         ,      (       ¬´¬ª                ).    ¬´ ¬ª?    -  ,     ,    ,   ,    - ,          .     ,  ,           ,         .    ,    ¬´ ¬ª,     ,         -.  .  ‚Äî     .  ,          . </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estoy a favor de un enfoque pragm√°tico para el desarrollo, por lo que para escribir un servicio de saga, una inversi√≥n en la escritura de dicho servicio deber√≠a estar justificada. </font><font style="vertical-align: inherit;">Adem√°s, lo m√°s probable es que muchas personas necesiten solo una parte de lo que describ√≠, y esta parte resolver√° las necesidades actuales. </font><font style="vertical-align: inherit;">Lo principal es comprender de antemano qu√© se necesita exactamente de todo esto. </font><font style="vertical-align: inherit;">Y cuantos recursos tienes.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si tiene preguntas o est√° interesado en aprender m√°s sobre las sagas, escriba los comentarios. </font><font style="vertical-align: inherit;">Estar√© encantado de responder.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418235/">https://habr.com/ru/post/es418235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418223/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 7: El sandbox del cliente nativo, parte 1</a></li>
<li><a href="../es418225/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 7: Sandbox de Native Client Parte 2</a></li>
<li><a href="../es418227/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 7: El sandbox del cliente nativo, parte 3</a></li>
<li><a href="../es418229/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 8: Modelo de seguridad de red, parte 1</a></li>
<li><a href="../es418233/index.html">BMW mnemotecnia para encontrar valores l√≠mite</a></li>
<li><a href="../es418237/index.html">Desarrollo de aplicaciones multiinquilino en la plataforma SAP Cloud en Neo, Parte 2: Autorizaci√≥n y autenticaci√≥n</a></li>
<li><a href="../es418239/index.html">48 megap√≠xeles para tel√©fono inteligente</a></li>
<li><a href="../es418241/index.html">¬øPor qu√© gauss? (100 formas de resolver el sistema de ecuaciones)</a></li>
<li><a href="../es418243/index.html">La historia popular de la astronom√≠a est√° equivocada</a></li>
<li><a href="../es418245/index.html">C√≥mo no desarrollar un proyecto en Bitrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>