<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔍 🚀 🐷 Mengkompilasi silang Scala dalam proyek Gradle ➰ 🐍 🍸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sangat umum bagi proyek Scala untuk menyediakan artefak biner yang dikompilasi untuk beberapa versi dari kompiler Scala. Sebagai aturan, untuk tujuan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengkompilasi silang Scala dalam proyek Gradle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452552/"><p>  Sangat umum bagi proyek Scala untuk menyediakan artefak biner yang dikompilasi untuk beberapa versi dari kompiler Scala.  Sebagai aturan, untuk tujuan membuat beberapa versi dari satu artefak di sebuah komunitas, sudah lazim untuk menggunakan SBT, di mana fitur ini tepat di luar kotak dan dikonfigurasikan dalam beberapa baris.  Tetapi bagaimana jika kita ingin bingung dan membuat build untuk kompilasi silang tanpa menggunakan SBT? </p><br><p>  Untuk salah satu proyek Java saya, saya memutuskan untuk membuat fasad Scala.  Secara historis, seluruh proyek dirakit menggunakan Gradle, dan diputuskan untuk menambahkan fasad ke proyek yang sama dengan submodule.  Gradle secara keseluruhan dapat mengkompilasi modul Scala dengan peringatan bahwa tidak ada dukungan lintas-kompilasi yang telah dinyatakan.  Ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tiket terbuka di tahun</a> 2017 dan beberapa plugin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">2</a> ) yang berjanji untuk menambahkan fitur ini ke proyek Anda, tetapi ada masalah dengan mereka, biasanya terkait dengan publikasi artefak.  Dan tidak ada yang lebih umum.  Saya memutuskan untuk memeriksa betapa sulitnya untuk benar-benar mengkonfigurasi build untuk kompilasi silang tanpa plugin dan SMS khusus. </p><a name="habracut"></a><br><p> Pertama, kami menggambarkan hasil yang diinginkan.  Saya ingin kumpulan sumber yang sama dikompilasi oleh tiga versi kompiler Scala: 2.11, 2.12 dan 2.13 (saat ini 2.13.0-RC2 terbaru).  Dan karena ada banyak perubahan yang tidak kompatibel ke belakang dalam koleksi di Scala 2.13, saya ingin dapat menambahkan set sumber tambahan untuk kode khusus untuk setiap kompiler.  Sekali lagi, di SBT, ini semua ditambahkan ke beberapa baris konfigurasi.  Mari kita lihat apa yang bisa dilakukan di Gradle. </p><br><p><img src="https://habrastorage.org/webt/ik/3q/96/ik3q9640lbg_xlulrfur2-l1i5q.png" alt="Struktur proyek"></p><br><p>  Kesulitan pertama yang harus Anda hadapi adalah bahwa versi kompiler dihitung dari versi ketergantungan yang dideklarasikan pada scala-library.  Plus, semua dependensi yang memiliki awalan untuk versi Scala dari kompiler juga perlu diubah.  Yaitu  Untuk setiap versi kompiler, daftar ketergantungan harus berbeda.  Selain itu, set flag untuk versi yang berbeda dari kompiler sebenarnya berbeda.  Beberapa bendera diganti namanya di antara versi, sementara beberapa hanya ditandai sebagai usang atau dihapus sama sekali.  Saya memutuskan bahwa mencoba menangkap semua nuansa dari berbagai kompiler dalam satu file build sepertinya tugas yang terlalu sulit dan dukungan lebih lanjutnya bahkan lebih sulit.  Karena itu, saya memutuskan untuk mencari kemungkinan cara lain untuk menyelesaikan masalah ini.  Tetapi bagaimana jika kita membuat beberapa konfigurasi untuk struktur direktori proyek yang sama? </p><br><p>  Dalam deklarasi untuk menyertakan submodula dalam proyek Gradle, Anda dapat menentukan direktori tempat akar submodule dan nama file yang bertanggung jawab atas konfigurasinya akan ditemukan.  Mari tentukan direktori yang sama untuk beberapa impor dan buat beberapa salinan skrip build untuk setiap versi kompiler. </p><br><div class="spoiler">  <b class="spoiler_title">setting.gradle</b> <div class="spoiler_text"><pre><code class="plaintext hljs">rootProject.name = 'test' include 'java-library' include 'scala-facade_2.11' project(':scala-facade_2.11').with { projectDir = file('scala-facade') buildFileName = 'build-2.11.gradle' } include 'scala-facade_2.12' project(':scala-facade_2.12').with { projectDir = file('scala-facade') buildFileName = 'build-2.12.gradle' } include 'scala-facade_2.13' project(':scala-facade_2.13').with { projectDir = file('scala-facade') buildFileName = 'build-2.13.gradle' }</code> </pre> </div></div><br><p>  Tidak buruk, tetapi dari waktu ke waktu kita bisa mendapatkan kesalahan kompilasi aneh yang terkait dengan fakta bahwa ketiga skrip build menggunakan direktori build yang sama.  Kami dapat memperbaiki ini dengan mengaturnya untuk setiap bangunan: </p><br><div class="spoiler">  <b class="spoiler_title">build-2.12.gradle</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">plugins { id 'scala' } buildDir = 'build-2.12' clean { delete 'build-2.12' } // ...</code> </pre> </div></div><br><p>  Sekarang sangat indah.  Dengan hanya satu masalah, pembangunan seperti itu akan membuat gila IDE favorit Anda, dan kemungkinan besar pengeditan lebih lanjut dari proyek Anda harus dilakukan dengan menggunakan instrumen.  Saya pikir ini bukan masalah besar, karena  Anda selalu dapat mengomentari kelebihan impor submodul dan mengubah susunan silang menjadi susunan biasa, yang kemungkinan besar IDE Anda tahu cara kerjanya. </p><br><p>  Bagaimana dengan set sumber tambahan?  Sekali lagi, dengan file terpisah, ini ternyata cukup sederhana, buat direktori baru dan konfigurasikan sebagai set sumber. </p><br><div class="spoiler">  <b class="spoiler_title">build-2.12.gradle</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">// ... sourceSets { compat { scala { srcDir 'src/main/scala-2.12-' } } main { scala { compileClasspath += compat.output } } test { scala { compileClasspath += compat.output runtimeClasspath += compat.output } } } // ...</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">build-2.13.gradle</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">// ... sourceSets { compat { scala { srcDir 'src/main/scala-2.13+' } } main { scala { compileClasspath += compat.output } } test { scala { compileClasspath += compat.output runtimeClasspath += compat.output } } } // ...</code> </pre> </div></div><br><p>  Struktur akhir proyek terlihat seperti ini: </p><br><p><img src="https://habrastorage.org/webt/ey/yo/gc/eyyogcn83lfz7oe0vnalb4hzxcq.png" alt="Tugas akhir"></p><br><p>  Di sini Anda juga dapat memisahkan masing-masing bagian umum menjadi file konfigurasi eksternal dan mengimpornya ke dalam build untuk mengurangi jumlah pengulangan.  Tetapi bagi saya itu ternyata cukup baik, deklaratif, terisolasi, dan kompatibel dengan semua plugin Gradle yang mungkin. </p><br><p>  Secara total, masalahnya terpecahkan, fleksibilitas Gradle cukup untuk mengekspresikan pengaturan yang tidak sepele cukup elegan, dan membangun lintas Scala dimungkinkan tidak hanya menggunakan SBT, dan jika karena satu dan lain hal Anda menggunakan Gradle untuk membangun proyek Scala, kompilasi silang sebagai peluang untuk Anda juga tersedia.  Saya harap seseorang posting ini akan bermanfaat.  Terima kasih atas perhatian anda </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id452552/">https://habr.com/ru/post/id452552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id452542/index.html">Adaptasi program untuk ZX Spectrum ke TR-DOS dengan cara modern. Bagian 2</a></li>
<li><a href="../id452544/index.html">Bagaimana cara mencapai tujuan?</a></li>
<li><a href="../id452546/index.html">AirSelfie 2 Power Edition - Kamera Valik. Atau tidak?</a></li>
<li><a href="../id452548/index.html">Dan apa yang Anda siapkan untuk iPhone?</a></li>
<li><a href="../id452550/index.html">Frontend Weekly Digest (13 - 19 Mei 2019)</a></li>
<li><a href="../id452556/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 365 (13 - 19 Mei, 2019)</a></li>
<li><a href="../id452558/index.html">Bagaimana saya mengambil data dari termometer BLE dari Xiaomi</a></li>
<li><a href="../id452560/index.html">PHP Digest No. 156 (6 - 20 Mei 2019)</a></li>
<li><a href="../id452562/index.html">Menulis kode JavaScript yang bersih dan dapat diskalakan: 12 tips</a></li>
<li><a href="../id452564/index.html">Fitur Python 3 layak digunakan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>