<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêù ü§õ ü§¥ Dap en action. √âcrire TodoMVC. Partie 1 üë©‚Äçüè≠ üéª üë©‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le premier article sur le dap , √©videmment, n'est pas devenu mon succ√®s d'√©criture: la grande majorit√© des commentaires se r√©sumaient √† "niasilil" et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dap en action. √âcrire TodoMVC. Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480912/"> Le premier <a href="https://habr.com/ru/post/478330/">article</a> sur le <a href="https://dap.js.org/" rel="nofollow">dap</a> , √©videmment, n'est pas devenu mon succ√®s d'√©criture: la grande majorit√© des commentaires se r√©sumaient √† "niasilil" et "niasilil, mais je condamne".  Et le prix <s>du</s> seul commentaire constructif de haut niveau va √† <a href="https://habr.com/en/users/oldvitus/" class="user_link">OldVitus</a> , pour des conseils pour d√©montrer le dap en utilisant TodoMVC comme exemple, afin qu'il y ait quelque chose √† comparer.  Que vais-je faire dans cet article. <br><br>  <a href="http://todomvc.com/" rel="nofollow">TodoMVC</a> , si quelqu'un ne le sait pas, il s'agit d'un monde d'appel UI standard, qui vous permet de comparer des solutions au m√™me probl√®me - la "liste de <a href="http://todomvc.com/" rel="nofollow">t√¢ches</a> " conditionnelle - en utilisant diff√©rents cadres.  La t√¢che, avec toute sa simplicit√© (sa <a href="https://dap.js.org/samples/todo.html" rel="nofollow">solution sur les dap</a> breaks ¬´en un seul √©cran¬ª), est tr√®s illustrative.  Par cons√©quent, en utilisant son exemple, j'essaierai de montrer comment les t√¢ches typiques d'un frontal Web sont impl√©ment√©es √† l'aide de dap. <br><br>  Je n'ai pas cherch√© et √©tudi√© la description formelle du probl√®me, mais j'ai d√©cid√© de simplement inverser l'un des exemples.  Le backend de cet article ne nous int√©resse pas, nous ne l'√©crirons donc pas nous-m√™mes, mais utilisez l' <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">un des pr√™ts</a> sur le site <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> , et √† partir de l√†, nous prendrons <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">un exemple de client</a> et un <a href="" rel="nofollow">fichier CSS</a> standard. <br><br>  Pour utiliser dap, vous n'avez pas besoin de t√©l√©charger et d'installer quoi que ce soit.  Aucune <code>npm install</code> et c'est tout.  Il n'est pas n√©cessaire de cr√©er des projets avec une structure de r√©pertoires sp√©cifique, des manifestes et d'autres attributs de r√©ussite informatique.  √âditeur de texte et navigateur suffisants.  Pour d√©boguer les demandes XHR, vous pouvez √©galement avoir besoin d'un serveur Web - assez simple, comme cette <a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb" rel="nofollow">extension</a> pour Chrome.  L'ensemble de notre frontend consistera en un seul fichier .html (faisant bien s√ªr r√©f√©rence au script du moteur DAP et au fichier CSS TodoMVC standard) <br><br>  Donc, √† partir de z√©ro. <br><a name="habracut"></a><br><h2>  1. Cr√©ez un fichier .html </h2><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Todo -- dap sample<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.todobackend.com/client/css/vendor/todomvc-common.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://dap.js.org/0.4.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//   dap </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  La pr√©paration html habituelle dans laquelle nous incluons le fichier CSS, gracieusement fourni par le site <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> et le moteur dap, non moins gracieusement fourni par le site <a href="https://dap.js.org/" rel="nofollow">dap.js.org</a> <br><br><h2>  2. Copiez la structure DOM de l'exemple d'origine </h2><br>  Pour utiliser le fichier CSS standard sans modifications, nous respecterons la m√™me structure DOM que l' <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">exemple d'origine</a> .  Ouvrez-le dans le navigateur Chrome, appuyez sur Ctr + Maj + I, s√©lectionnez l'onglet √âl√©ments et voyez que l'application elle-m√™me est dans la <code>section id="todo-app"&gt;</code> √©l√©ment <code>section id="todo-app"&gt;</code> <br><br><img src="https://habrastorage.org/webt/3d/ks/mq/3dksmqoxzyif_tgnxfc3v-wf_us.png"><br><br>  En ouvrant ce sous-arbre un par un, nous r√©√©crivons sa structure dans notre fichier .html.  Maintenant, nous esquissons simplement d'une mani√®re rapide, et non pas en √©crivant du code, nous √©crivons donc simplement les signatures des √©l√©ments entre ¬´guillemets simples¬ª et entre parenth√®ses de leurs enfants.  S'il n'y a pas d'enfants, nous dessinons des crochets vides.  Nous surveillons les indices et l'√©quilibre des parenth√®ses. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   dap '#todoapp'( '#header'( 'H1'() 'INPUT#new-todo placeholder="What needs to be done?" autofocus'() ) '#main'( '#toggle-all type=checkbox'() 'UL#todo-list'( 'LI'( 'INPUT.toggle type=checkbox'() 'LABEL'() 'BUTTON.destroy'() ) ) ) '#footer'( '#todo-count'() 'UL#filters'( 'LI'() ) '#clear-completed'() ) )</span></span></code> </pre><br>  Remarque: les √©l√©ments r√©p√©titifs (par exemple, ici ce sont des √©l√©ments <code>LI</code> ) nous √©crivons une fois dans la structure, m√™me s'il y en a plusieurs dans l'original;  √©videmment, ce sont des tableaux du m√™me mod√®le. <br><br>  Le format de signature, je pense, est compr√©hensible pour tous ceux qui ont √©crit du HTML et du CSS avec leurs mains, donc je ne m'attarderai pas l√†-dessus en d√©tail pour l'instant.  Je peux seulement dire que les balises sont √©crites en majuscules, et l'absence d'une balise √©quivaut √† la pr√©sence d'une balise DIV.  L'abondance d'√©l√©ments # (avec id) ici est due aux sp√©cificit√©s du fichier CSS inclus, qui utilise principalement des s√©lecteurs id. <br><br><h2>  3. N'oubliez pas que le programme dap est Javascript </h2><br>  Pour nous √©viter des crochets inutiles dans le code, le moteur dap injecte plusieurs m√©thodes directement dans <code>String.prototype</code> (je suis conscient que l'impl√©mentation de vos m√©thodes dans des objets standard est ayahay, mais ... en bref, nous avons pass√©), qui convertit la cha√Æne de signature en dap mod√®le.  L'une de ces m√©thodes est <code>.d(rule, ...children)</code> .  Le premier argument qu'il prend est une r√®gle de g√©n√©ration (r√®gle <i>d</i> ), et le reste des arguments est un nombre arbitraire d'enfants. <br><br>  Sur la base de ces nouvelles connaissances, nous ajoutons notre code de sorte qu'au lieu de chaque accolade ouvrante, nous ayons la s√©quence <code>.d(""</code> , et avant chaque guillemet simple d'ouverture, sauf la toute premi√®re, il y a une virgule. Life hack: vous pouvez utiliser le remplacement automatique. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) )</code> </pre><br>  Voila!  Nous avons obtenu un arbre d'appels √† la m√©thode <code>.d</code> , qui est pr√™te √† se transformer en un mod√®le dap.  Les cha√Ænes vides <code>""</code> sont les germes des futures r√®gles d, et les enfants sont des arguments s√©par√©s par des virgules.  Formellement, il s'agit d'un programme dap valide, mais pas encore compl√®tement avec l'√©chappement dont nous avons besoin.  Mais il peut d√©j√† √™tre lanc√©!  Pour ce faire, apr√®s la fermeture du crochet racine, ajoutez la m√©thode <code>.RENDER()</code> .  Cette m√©thode, comme son nom l'indique, rend le mod√®le r√©sultant. <br><br>  Donc, √† ce stade, nous avons un fichier .html avec ce contenu: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Todo -- dap sample&lt;/title&gt; &lt;link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/&gt; &lt;script src="https://dap.js.org/0.4.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; '#todoapp'.d("" ,'#header'.d("" ,'H1'.d("") ,'INPUT#new-todo placeholder="What needs to be done?" autofocus'.d("") ) ,'#main'.d("" ,'#toggle-all type=checkbox'.d("") ,'UL#todo-list'.d("" ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("") ,'LABEL'.d("") ,'BUTTON.destroy'.d("") ) ) ) ,'#footer'.d("" ,'#todo-count'.d("") ,'UL#filters'.d("" ,'LI'.d("") ) ,'#clear-completed'.d("") ) ) .RENDER() //   dap   &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  Vous pouvez l' <a href="http://dap.js.org/samples/tutorial/3.html" rel="nofollow">ouvrir dans un navigateur</a> pour vous assurer que les √©l√©ments DOM sont g√©n√©r√©s, que les styles CSS sont appliqu√©s, il ne reste plus qu'√† remplir ce mod√®le de donn√©es. <br><br><h2>  4. Obtenez les donn√©es </h2><br>  Nous allons √† <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">la page d'origine</a> , ouvrons l'onglet R√©seau dans les outils, activons le filtre XHR et voyons d'o√π viennent les donn√©es et sous quelle forme. <br><br><img src="https://habrastorage.org/webt/vf/ff/4l/vfff4lreh7nhj6jpgb8re83wb-s.png"><br><br><img src="https://habrastorage.org/webt/qi/lh/ga/qilhganpuhmmtevpnyuytm1uadu.png"><br><br>  D'accord, d'accord.  La liste des <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">t√¢ches</a> est prise directement √† partir de <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">todo-backend-express.herokuapp.com en</a> tant que tableau d'objets json.  Super <br><br>  Pour recevoir des donn√©es, dap a un convertisseur int√©gr√© <code>:query</code> qui "convertit" de mani√®re asynchrone l'URL en donn√©es re√ßues de celle-ci.  Nous n'√©crirons pas l'URL elle-m√™me directement dans la r√®gle, mais nous la d√©signerons avec les <code>todos</code> constants;  alors toute la conception de l'exploration de donn√©es ressemblera √† ceci: <br><br><pre> <code class="javascript hljs">todos:query</code> </pre><br>  et √©crivez la constante <code>todos</code> elle-m√™me dans le dictionnaire - dans la section <code>.DICT</code> , juste avant <code>.RENDER()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ... ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"https://todo-backend-express.herokuapp.com/"</span></span> }) .RENDER()</code> </pre><br>  Apr√®s avoir re√ßu le tableau de <code>todos</code> , nous en construisons une liste de <code>.title</code> : pour chaque cas, nous prenons le nom du champ <code>.title</code> et l'√©crivons dans l'√©l√©ment <code>LABEL</code> , et du champ <code>.completed</code> prenons le signe de ¬´compl√©tude¬ª et √©crivons dans la propri√©t√© <code>checked</code> de l'√©l√©ment de <code>checked</code> <code>INPUT.toggle</code> .  C'est fait comme ceci: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  *       ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("#.checked=.completed") // #  " " ,'LABEL'.d("! .title") //  !      ,'BUTTON.destroy'.d("") ) )</span></span></code> </pre><br>  Nous mettons √† jour cette page √† nous dans le navigateur et ... si vous la d√©marrez √† partir du syst√®me de fichiers, alors rien ne se passe.  Le probl√®me est que les navigateurs modernes n'autorisent pas les demandes XHR interdomaines √† partir de documents locaux. <br><br><img src="https://habrastorage.org/webt/tm/fy/bi/tmfybiqw7s2geblqodepfg7k7lk.png"><br><br>  Il est temps de regarder notre page via http - en utilisant n'importe quel serveur Web local.  Eh bien, ou si vous n'√™tes pas pr√™t √† √©crire dap de vos propres mains, voir les versions s√©quentielles de la page en utilisant mes liens (n'oubliez pas de regarder la source - dans Chrome, cela se fait en utilisant Ctrl + U) <br><br>  Donc, nous <a href="http://dap.js.org/samples/tutorial/4.html" rel="nofollow">allons sur notre page √† http: //</a> et voyons que les donn√©es arrivent, la liste est en cours de construction.  Super!  Vous ma√Ætrisez d√©j√† les op√©rateurs <code>*</code> et <code>!</code>  , convertisseur <code>:query</code> , constantes et acc√®s aux champs de l'√©l√©ment de tableau courant.  Regardez √† nouveau le code r√©sultant.  Cela vous semble encore illisible? <br><br><h2>  5. Ajouter un √©tat </h2><br>  Vous avez peut-√™tre d√©j√† essay√© de cliquer sur les coches dans la liste des t√¢ches.  Les cases √† cocher elles-m√™mes changent de couleur, mais, contrairement √† l'original, l'√©l√©ment parent <code>LI</code> ne change pas de style (les ¬´affaires termin√©es¬ª devraient devenir grises et barr√©es, mais cela ne se produit pas) - les choses ne changent pas leur <i>√©tat</i> .  Mais ces √©l√©ments n'ont pas encore d'√©tat et ne peuvent donc pas le changer.  Maintenant, nous allons le r√©parer. <br><br>  Ajoutez un √©tat "d'ach√®vement" √† l'√©l√©ment <code>LI</code> .  Pour ce faire, d√©finissez la <i>variable d'√©tat</i> <code>$completed</code> dans sa r√®gle-d.  √Ä l' <code>INPUT.toggle</code> , qui peut changer cet √©tat, nous assignerons une r√®gle de r√©action appropri√©e (r√®gle <i>ui</i> ), qui d√©finira la variable <code>$completed</code> conform√©ment √† son propre indicateur <code>checked</code> (¬´daw est activ√©¬ª).  Selon l'√©tat de <code>$completed</code> √©l√©ment <code>LI</code> activera ou d√©sactivera la classe CSS "termin√©e". <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed"</span></span><span class="hljs-comment"><span class="hljs-comment">//  ,    .completed ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") //       .ui("$completed=#.checked") //    $completed ,'LABEL'.d("! .title") ,'BUTTON.destroy'.d("") ) .a("!? $completed") //     $completed,    css- completed )</span></span></code> </pre><br>  De telles manipulations avec des classes CSS sont une chose assez courante, donc il y a un op√©rateur sp√©cial dans dap pour elles!? <br>  Veuillez noter que nous le faisons dans la <i>r√®gle a</i> (√† partir du mot accumuler).  Pourquoi pas dans la r√®gle D?  La diff√©rence entre ces deux types de r√®gles est que lors de la mise √† jour, la r√®gle d reconstruit compl√®tement le contenu de l'√©l√©ment, supprimant √† nouveau l'ancien et le nouveau, tandis que la r√®gle a ne touche pas le contenu existant de l'√©l√©ment, mais ¬´ajoute¬ª le r√©sultat √† ce qui est d√©j√† l√†.  La modification d'un seul attribut d'un √©l√©ment <code>LI</code> ne n√©cessite pas de restructurer le reste de son contenu, il est donc plus rationnel de le faire dans la r√®gle a. <br><br>  Nous regardons le <a href="http://dap.js.org/samples/tutorial/5-1.html" rel="nofollow">r√©sultat</a> .  C'est d√©j√† mieux: en cliquant sur les cases √† cocher, vous modifiez l'√©tat de la t√¢che √† effectuer correspondante et, conform√©ment √† cet √©tat, le style visuel de l'√©l√©ment change √©galement.  Mais il y a toujours un probl√®me: si la liste des t√¢ches termin√©es √©tait initialement pr√©sente, elles ne seront pas grises, car par d√©faut la r√®gle a n'est pas ex√©cut√©e lors de la g√©n√©ration de l'√©l√©ment.  Pour l'ex√©cuter m√™me pendant la g√©n√©ration, nous ajoutons l'op√©rateur <code>a!</code> √Ä la r√®gle d de l'√©l√©ment <code>LI</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//      $completed    a-</span></span></code> </pre><br>  <a href="http://dap.js.org/samples/tutorial/5-2.html" rel="nofollow">Nous regardons</a> .  Ok  Avec le statut de <code>$completed</code> compris.  Les cas termin√©s sont stylis√©s correctement √† la fois au d√©marrage initial et lors de la commutation manuelle suivante. <br><br><h2>  6. Modification des noms de cas </h2><br>  Retour √† l' <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">original</a> .  En double-cliquant sur le nom du bo√Ætier, le mode d'√©dition est activ√©, dans lequel ce nom peut √™tre modifi√©.  L√†, il est impl√©ment√© de mani√®re √† ce que le mod√®le de mode de visualisation ¬´view¬ª (avec un daw, un titre et un bouton de suppression) soit compl√®tement masqu√©, et l'√©l√©ment <code>INPUT class="edit"</code> s'affiche.  Nous le ferons un peu diff√©remment - nous ne cacherons que l'√©l√©ment <code>LABEL</code> , car les deux autres √©l√©ments n'interf√®rent pas avec notre √©dition.  Ajoutez simplement la classe <code>view</code> √† l'√©l√©ment <code>LABEL</code> . <br><br>  Pour l'√©tat ¬´√©dition¬ª, d√©finissez la variable <code>$editing</code> dans l'√©l√©ment <code>LI</code> .  Initialement, il (√©tat) est r√©initialis√©, s'active par <code>dblclick</code> sur l'√©l√©ment <code>LABEL</code> et s'√©teint lorsque l'√©l√©ment <code>INPUT.edit</code> est flou.  Nous √©crivons donc: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$completed=#.checked") ,'LABEL.view' .d("? $editing:!; ! .title") //  $editing ,     .e("dblclick","$editing=`yes") //  dblclick  $editing ,'INPUT.edit' .d("? $editing; !! .title@value") //  $editing  .ui(".title=#.value") //  .title   change (ui     INPUT) .e("blur","$editing=") //  $editing   blur ,'BUTTON.destroy'.d("") ).a("!? $completed $editing") //   $completed  $editing  css-  'LI'</span></span></code> </pre><br>  Nous <a href="http://dap.js.org/samples/tutorial/6.html" rel="nofollow">pouvons</a> maintenant modifier les noms des cas. <br><br><h2>  7. Envoi de donn√©es au serveur </h2><br>  Ok, nous pouvons d√©j√† √©diter des choses dans le navigateur, mais ces changements doivent √©galement √™tre transf√©r√©s au serveur.  Nous regardons comment l'original le fait: <br><br><img src="https://habrastorage.org/webt/jd/r5/bw/jdr5bwsa8yi7wu4sbwxqr3bwcdi.png"><br><br>  Les modifications sont envoy√©es au serveur en utilisant la m√©thode PATCH avec une certaine URL de la forme <code>http://todo-backend-express.herokuapp.com/28185</code> , qui, √©videmment, est unique pour chaque cas.  Cette URL est indiqu√©e par le serveur dans le champ <code>.url</code> pour chaque cas de la liste.  Autrement dit, tout ce qui nous est demand√© pour mettre √† jour le cas sur le serveur est d'envoyer une demande PATCH √† l'adresse sp√©cifi√©e dans le champ <code>.url</code> , avec les donn√©es modifi√©es au format JSON: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>)</code> </pre><br>  Ici, nous utilisons le m√™me convertisseur <code>:query</code> , mais dans une version plus d√©taill√©e.  Lorsque <code>:query</code> est appliqu√©e √† une cha√Æne simple, cette cha√Æne est trait√©e comme une URL et une demande GET est ex√©cut√©e.  Si <code>:query</code> re√ßoit un objet complexe, comme dans ce cas, il le traite comme une description d√©taill√©e de la demande contenant les champs <code>.method</code> , <code>.headers</code> , <code>.headers</code> et <code>.body</code> , et ex√©cute la demande conform√©ment √† ceux-ci.  Ici, imm√©diatement apr√®s la mise √† jour du <code>.title</code> envoyons au serveur une demande PATCH avec ce <code>.title</code> mis √† jour <br><br>  Mais il y a une nuance.  Nous obtenons le champ <code>.url</code> du serveur, il ressemble √† ceci: <code>http://todo-backend-express.herokuapp.com/28185</code> , c'est-√†-dire que le protocole http: // est cod√© en dur si notre client est √©galement ouvert via http: // alors tout va bien.  Mais si le client est ouvert via https: //, alors un probl√®me se pose: pour des raisons de s√©curit√©, le navigateur bloque le trafic http depuis la source https. <br><br>  Il est r√©solu simplement: si vous supprimez le protocole de <code>.url</code> , la demande passera par le protocole de page.  Alors faisons-le: √©crivez le convertisseur appropri√© - <code>dehttp</code> , et nous passerons <code>.url</code> travers.  Les convertisseurs personnalis√©s (et autres fonctionnalit√©s) sont <code>.FUNC</code> dans la section <code>.FUNC</code> : <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-comment"><span class="hljs-comment">//  -         dehhtp: url=&gt;url.replace(/^https?\:/,'')//    URL } })</span></span></code> </pre><br>  Il est √©galement judicieux de placer l'objet headers dans le dictionnaire afin qu'il puisse √™tre utilis√© dans d'autres requ√™tes: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title):json.encode@body):query"</span></span>) ... .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} })</code> </pre><br>  Eh bien, pour le feng shui complet, nous utiliserons une autre propri√©t√© utile du convertisseur <code>:query</code> - encodage automatique du corps de la requ√™te dans json conform√©ment √† l'en <code>Content-type:application/json</code> t√™te <code>Content-type:application/json</code> .  Par cons√©quent, la r√®gle ressemblera √† ceci: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title)):query"</span></span>)</code> </pre><br>  Alors <a href="http://dap.js.org/samples/tutorial/7-2.html" rel="nofollow">regarde</a> .  D'accord, les noms de cas changent d√©sormais non seulement dans le navigateur, mais aussi sur le serveur.  Mais!  Non seulement le nom de l'affaire peut changer, mais aussi son √©tat d'avancement - <code>completed</code> .  Il doit donc √©galement √™tre envoy√© au serveur. <br>  Vous pouvez ajouter la m√™me demande PATCH √† l'√©l√©ment <code>INPUT.toggle</code> , envoyez simplement <code>(.completed)</code> au lieu de <code>(.completed)</code> : <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$completed=#.checked; (@method`PATCH .url:dehttp headers (.completed:?)):query"</span></span>)</code> </pre><br>  Et vous pouvez mettre cette demande PATCH ¬´hors des crochets¬ª: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">// $patch - ""   ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=($completed=#.checked)") //   $patch  completed ,'LABEL.view' .d("? $editing:!; ! .title") .e("dblclick","$editing=`yes") ,'INPUT.edit' .d("? $editing; !! .title@value") .ui("$patch=(.title=#.value)") //   $patch  title .e("blur","$editing=") ,'BUTTON.destroy'.d("") ) .a("!? $completed $editing") //  $patch  ,   ,   .u("? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch=")</span></span></code> </pre><br>  Voici le truc.  Les r√®gles de r√©action appartiennent au groupe ¬´up-rules¬ª, qui sont ex√©cut√©es ¬´de bas en haut¬ª - du descendant au parent, √† la racine elle-m√™me (cette s√©quence peut √™tre interrompue si n√©cessaire).  Cela ressemble un peu aux √©v√©nements contextuels dans le DOM.  Par cons√©quent, certains fragments de la r√©action communs √† plusieurs descendants peuvent √™tre attribu√©s √† un anc√™tre commun. <br><br>  Plus pr√©cis√©ment, dans notre cas, le gain d'une telle d√©l√©gation n'est pas particuli√®rement perceptible, mais s'il y avait des champs plus modifiables, alors mettre cette demande volumineuse (selon les normes DAP, bien s√ªr) dans une r√®gle g√©n√©rale aiderait grandement √† garder le code simple et lisible.  Je le recommande donc. <br><br>  <a href="http://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">Nous regardons</a> : Maintenant, les changements de nom et les changements d'√©tat sont envoy√©s au serveur. <br><br>  Dans le prochain article, si vous √™tes int√©ress√©, envisagez d'ajouter, de supprimer et de filtrer les cas.  En attendant, vous pouvez voir le <a href="https://dap.js.org/samples/todo.html" rel="nofollow">r√©sultat final</a> et d'autres exemples de code dap sur <a href="https://dap.js.org/docs/" rel="nofollow">dap.js.org/docs</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr480912/">https://habr.com/ru/post/fr480912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr480900/index.html">Ramenez mon b√©b√©! (Histoire N.-F.)</a></li>
<li><a href="../fr480902/index.html">Nouvelles fonctionnalit√©s de surveillance PostgreSQL PostgreSQL</a></li>
<li><a href="../fr480904/index.html">PHP Microservice Framework: environnement de d√©veloppement pour Swoft</a></li>
<li><a href="../fr480906/index.html">√âcrire un jeu de python simple</a></li>
<li><a href="../fr480910/index.html">Comment cr√©er une classe de test de base pour les tests Selenium et initialiser via JUnit RuleChain</a></li>
<li><a href="../fr480914/index.html">Microservices pour d√©butants</a></li>
<li><a href="../fr480918/index.html">Apache Hadoop Code Quality: Production VS Test</a></li>
<li><a href="../fr480920/index.html">Test des commutateurs TP-Link avec PoE longue port√©e. Et un peu sur les mises √† niveau des anciens mod√®les</a></li>
<li><a href="../fr480922/index.html">Evgeny Usvitsky: ¬´Tout le monde dans le monde sait o√π obtenir les g√©odonn√©es librement - uniquement dans OSM¬ª</a></li>
<li><a href="../fr480924/index.html">Comment et pourquoi les cr√©ateurs du remake de MediEvil ont repens√© le boss culte du jeu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>