<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐝 🤛 🤴 Dap en action. Écrire TodoMVC. Partie 1 👩‍🏭 🎻 👩‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le premier article sur le dap , évidemment, n'est pas devenu mon succès d'écriture: la grande majorité des commentaires se résumaient à "niasilil" et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dap en action. Écrire TodoMVC. Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480912/"> Le premier <a href="https://habr.com/ru/post/478330/">article</a> sur le <a href="https://dap.js.org/" rel="nofollow">dap</a> , évidemment, n'est pas devenu mon succès d'écriture: la grande majorité des commentaires se résumaient à "niasilil" et "niasilil, mais je condamne".  Et le prix <s>du</s> seul commentaire constructif de haut niveau va à <a href="https://habr.com/en/users/oldvitus/" class="user_link">OldVitus</a> , pour des conseils pour démontrer le dap en utilisant TodoMVC comme exemple, afin qu'il y ait quelque chose à comparer.  Que vais-je faire dans cet article. <br><br>  <a href="http://todomvc.com/" rel="nofollow">TodoMVC</a> , si quelqu'un ne le sait pas, il s'agit d'un monde d'appel UI standard, qui vous permet de comparer des solutions au même problème - la "liste de <a href="http://todomvc.com/" rel="nofollow">tâches</a> " conditionnelle - en utilisant différents cadres.  La tâche, avec toute sa simplicité (sa <a href="https://dap.js.org/samples/todo.html" rel="nofollow">solution sur les dap</a> breaks «en un seul écran»), est très illustrative.  Par conséquent, en utilisant son exemple, j'essaierai de montrer comment les tâches typiques d'un frontal Web sont implémentées à l'aide de dap. <br><br>  Je n'ai pas cherché et étudié la description formelle du problème, mais j'ai décidé de simplement inverser l'un des exemples.  Le backend de cet article ne nous intéresse pas, nous ne l'écrirons donc pas nous-mêmes, mais utilisez l' <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">un des prêts</a> sur le site <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> , et à partir de là, nous prendrons <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">un exemple de client</a> et un <a href="" rel="nofollow">fichier CSS</a> standard. <br><br>  Pour utiliser dap, vous n'avez pas besoin de télécharger et d'installer quoi que ce soit.  Aucune <code>npm install</code> et c'est tout.  Il n'est pas nécessaire de créer des projets avec une structure de répertoires spécifique, des manifestes et d'autres attributs de réussite informatique.  Éditeur de texte et navigateur suffisants.  Pour déboguer les demandes XHR, vous pouvez également avoir besoin d'un serveur Web - assez simple, comme cette <a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb" rel="nofollow">extension</a> pour Chrome.  L'ensemble de notre frontend consistera en un seul fichier .html (faisant bien sûr référence au script du moteur DAP et au fichier CSS TodoMVC standard) <br><br>  Donc, à partir de zéro. <br><a name="habracut"></a><br><h2>  1. Créez un fichier .html </h2><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Todo -- dap sample<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.todobackend.com/client/css/vendor/todomvc-common.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://dap.js.org/0.4.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//   dap </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  La préparation html habituelle dans laquelle nous incluons le fichier CSS, gracieusement fourni par le site <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> et le moteur dap, non moins gracieusement fourni par le site <a href="https://dap.js.org/" rel="nofollow">dap.js.org</a> <br><br><h2>  2. Copiez la structure DOM de l'exemple d'origine </h2><br>  Pour utiliser le fichier CSS standard sans modifications, nous respecterons la même structure DOM que l' <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">exemple d'origine</a> .  Ouvrez-le dans le navigateur Chrome, appuyez sur Ctr + Maj + I, sélectionnez l'onglet Éléments et voyez que l'application elle-même est dans la <code>section id="todo-app"&gt;</code> élément <code>section id="todo-app"&gt;</code> <br><br><img src="https://habrastorage.org/webt/3d/ks/mq/3dksmqoxzyif_tgnxfc3v-wf_us.png"><br><br>  En ouvrant ce sous-arbre un par un, nous réécrivons sa structure dans notre fichier .html.  Maintenant, nous esquissons simplement d'une manière rapide, et non pas en écrivant du code, nous écrivons donc simplement les signatures des éléments entre «guillemets simples» et entre parenthèses de leurs enfants.  S'il n'y a pas d'enfants, nous dessinons des crochets vides.  Nous surveillons les indices et l'équilibre des parenthèses. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   dap '#todoapp'( '#header'( 'H1'() 'INPUT#new-todo placeholder="What needs to be done?" autofocus'() ) '#main'( '#toggle-all type=checkbox'() 'UL#todo-list'( 'LI'( 'INPUT.toggle type=checkbox'() 'LABEL'() 'BUTTON.destroy'() ) ) ) '#footer'( '#todo-count'() 'UL#filters'( 'LI'() ) '#clear-completed'() ) )</span></span></code> </pre><br>  Remarque: les éléments répétitifs (par exemple, ici ce sont des éléments <code>LI</code> ) nous écrivons une fois dans la structure, même s'il y en a plusieurs dans l'original;  évidemment, ce sont des tableaux du même modèle. <br><br>  Le format de signature, je pense, est compréhensible pour tous ceux qui ont écrit du HTML et du CSS avec leurs mains, donc je ne m'attarderai pas là-dessus en détail pour l'instant.  Je peux seulement dire que les balises sont écrites en majuscules, et l'absence d'une balise équivaut à la présence d'une balise DIV.  L'abondance d'éléments # (avec id) ici est due aux spécificités du fichier CSS inclus, qui utilise principalement des sélecteurs id. <br><br><h2>  3. N'oubliez pas que le programme dap est Javascript </h2><br>  Pour nous éviter des crochets inutiles dans le code, le moteur dap injecte plusieurs méthodes directement dans <code>String.prototype</code> (je suis conscient que l'implémentation de vos méthodes dans des objets standard est ayahay, mais ... en bref, nous avons passé), qui convertit la chaîne de signature en dap modèle.  L'une de ces méthodes est <code>.d(rule, ...children)</code> .  Le premier argument qu'il prend est une règle de génération (règle <i>d</i> ), et le reste des arguments est un nombre arbitraire d'enfants. <br><br>  Sur la base de ces nouvelles connaissances, nous ajoutons notre code de sorte qu'au lieu de chaque accolade ouvrante, nous ayons la séquence <code>.d(""</code> , et avant chaque guillemet simple d'ouverture, sauf la toute première, il y a une virgule. Life hack: vous pouvez utiliser le remplacement automatique. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) )</code> </pre><br>  Voila!  Nous avons obtenu un arbre d'appels à la méthode <code>.d</code> , qui est prête à se transformer en un modèle dap.  Les chaînes vides <code>""</code> sont les germes des futures règles d, et les enfants sont des arguments séparés par des virgules.  Formellement, il s'agit d'un programme dap valide, mais pas encore complètement avec l'échappement dont nous avons besoin.  Mais il peut déjà être lancé!  Pour ce faire, après la fermeture du crochet racine, ajoutez la méthode <code>.RENDER()</code> .  Cette méthode, comme son nom l'indique, rend le modèle résultant. <br><br>  Donc, à ce stade, nous avons un fichier .html avec ce contenu: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Todo -- dap sample&lt;/title&gt; &lt;link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/&gt; &lt;script src="https://dap.js.org/0.4.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; '#todoapp'.d("" ,'#header'.d("" ,'H1'.d("") ,'INPUT#new-todo placeholder="What needs to be done?" autofocus'.d("") ) ,'#main'.d("" ,'#toggle-all type=checkbox'.d("") ,'UL#todo-list'.d("" ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("") ,'LABEL'.d("") ,'BUTTON.destroy'.d("") ) ) ) ,'#footer'.d("" ,'#todo-count'.d("") ,'UL#filters'.d("" ,'LI'.d("") ) ,'#clear-completed'.d("") ) ) .RENDER() //   dap   &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  Vous pouvez l' <a href="http://dap.js.org/samples/tutorial/3.html" rel="nofollow">ouvrir dans un navigateur</a> pour vous assurer que les éléments DOM sont générés, que les styles CSS sont appliqués, il ne reste plus qu'à remplir ce modèle de données. <br><br><h2>  4. Obtenez les données </h2><br>  Nous allons à <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">la page d'origine</a> , ouvrons l'onglet Réseau dans les outils, activons le filtre XHR et voyons d'où viennent les données et sous quelle forme. <br><br><img src="https://habrastorage.org/webt/vf/ff/4l/vfff4lreh7nhj6jpgb8re83wb-s.png"><br><br><img src="https://habrastorage.org/webt/qi/lh/ga/qilhganpuhmmtevpnyuytm1uadu.png"><br><br>  D'accord, d'accord.  La liste des <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">tâches</a> est prise directement à partir de <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">todo-backend-express.herokuapp.com en</a> tant que tableau d'objets json.  Super <br><br>  Pour recevoir des données, dap a un convertisseur intégré <code>:query</code> qui "convertit" de manière asynchrone l'URL en données reçues de celle-ci.  Nous n'écrirons pas l'URL elle-même directement dans la règle, mais nous la désignerons avec les <code>todos</code> constants;  alors toute la conception de l'exploration de données ressemblera à ceci: <br><br><pre> <code class="javascript hljs">todos:query</code> </pre><br>  et écrivez la constante <code>todos</code> elle-même dans le dictionnaire - dans la section <code>.DICT</code> , juste avant <code>.RENDER()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ... ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"https://todo-backend-express.herokuapp.com/"</span></span> }) .RENDER()</code> </pre><br>  Après avoir reçu le tableau de <code>todos</code> , nous en construisons une liste de <code>.title</code> : pour chaque cas, nous prenons le nom du champ <code>.title</code> et l'écrivons dans l'élément <code>LABEL</code> , et du champ <code>.completed</code> prenons le signe de «complétude» et écrivons dans la propriété <code>checked</code> de l'élément de <code>checked</code> <code>INPUT.toggle</code> .  C'est fait comme ceci: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  *       ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("#.checked=.completed") // #  " " ,'LABEL'.d("! .title") //  !      ,'BUTTON.destroy'.d("") ) )</span></span></code> </pre><br>  Nous mettons à jour cette page à nous dans le navigateur et ... si vous la démarrez à partir du système de fichiers, alors rien ne se passe.  Le problème est que les navigateurs modernes n'autorisent pas les demandes XHR interdomaines à partir de documents locaux. <br><br><img src="https://habrastorage.org/webt/tm/fy/bi/tmfybiqw7s2geblqodepfg7k7lk.png"><br><br>  Il est temps de regarder notre page via http - en utilisant n'importe quel serveur Web local.  Eh bien, ou si vous n'êtes pas prêt à écrire dap de vos propres mains, voir les versions séquentielles de la page en utilisant mes liens (n'oubliez pas de regarder la source - dans Chrome, cela se fait en utilisant Ctrl + U) <br><br>  Donc, nous <a href="http://dap.js.org/samples/tutorial/4.html" rel="nofollow">allons sur notre page à http: //</a> et voyons que les données arrivent, la liste est en cours de construction.  Super!  Vous maîtrisez déjà les opérateurs <code>*</code> et <code>!</code>  , convertisseur <code>:query</code> , constantes et accès aux champs de l'élément de tableau courant.  Regardez à nouveau le code résultant.  Cela vous semble encore illisible? <br><br><h2>  5. Ajouter un état </h2><br>  Vous avez peut-être déjà essayé de cliquer sur les coches dans la liste des tâches.  Les cases à cocher elles-mêmes changent de couleur, mais, contrairement à l'original, l'élément parent <code>LI</code> ne change pas de style (les «affaires terminées» devraient devenir grises et barrées, mais cela ne se produit pas) - les choses ne changent pas leur <i>état</i> .  Mais ces éléments n'ont pas encore d'état et ne peuvent donc pas le changer.  Maintenant, nous allons le réparer. <br><br>  Ajoutez un état "d'achèvement" à l'élément <code>LI</code> .  Pour ce faire, définissez la <i>variable d'état</i> <code>$completed</code> dans sa règle-d.  À l' <code>INPUT.toggle</code> , qui peut changer cet état, nous assignerons une règle de réaction appropriée (règle <i>ui</i> ), qui définira la variable <code>$completed</code> conformément à son propre indicateur <code>checked</code> («daw est activé»).  Selon l'état de <code>$completed</code> élément <code>LI</code> activera ou désactivera la classe CSS "terminée". <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed"</span></span><span class="hljs-comment"><span class="hljs-comment">//  ,    .completed ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") //       .ui("$completed=#.checked") //    $completed ,'LABEL'.d("! .title") ,'BUTTON.destroy'.d("") ) .a("!? $completed") //     $completed,    css- completed )</span></span></code> </pre><br>  De telles manipulations avec des classes CSS sont une chose assez courante, donc il y a un opérateur spécial dans dap pour elles!? <br>  Veuillez noter que nous le faisons dans la <i>règle a</i> (à partir du mot accumuler).  Pourquoi pas dans la règle D?  La différence entre ces deux types de règles est que lors de la mise à jour, la règle d reconstruit complètement le contenu de l'élément, supprimant à nouveau l'ancien et le nouveau, tandis que la règle a ne touche pas le contenu existant de l'élément, mais «ajoute» le résultat à ce qui est déjà là.  La modification d'un seul attribut d'un élément <code>LI</code> ne nécessite pas de restructurer le reste de son contenu, il est donc plus rationnel de le faire dans la règle a. <br><br>  Nous regardons le <a href="http://dap.js.org/samples/tutorial/5-1.html" rel="nofollow">résultat</a> .  C'est déjà mieux: en cliquant sur les cases à cocher, vous modifiez l'état de la tâche à effectuer correspondante et, conformément à cet état, le style visuel de l'élément change également.  Mais il y a toujours un problème: si la liste des tâches terminées était initialement présente, elles ne seront pas grises, car par défaut la règle a n'est pas exécutée lors de la génération de l'élément.  Pour l'exécuter même pendant la génération, nous ajoutons l'opérateur <code>a!</code> À la règle d de l'élément <code>LI</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//      $completed    a-</span></span></code> </pre><br>  <a href="http://dap.js.org/samples/tutorial/5-2.html" rel="nofollow">Nous regardons</a> .  Ok  Avec le statut de <code>$completed</code> compris.  Les cas terminés sont stylisés correctement à la fois au démarrage initial et lors de la commutation manuelle suivante. <br><br><h2>  6. Modification des noms de cas </h2><br>  Retour à l' <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">original</a> .  En double-cliquant sur le nom du boîtier, le mode d'édition est activé, dans lequel ce nom peut être modifié.  Là, il est implémenté de manière à ce que le modèle de mode de visualisation «view» (avec un daw, un titre et un bouton de suppression) soit complètement masqué, et l'élément <code>INPUT class="edit"</code> s'affiche.  Nous le ferons un peu différemment - nous ne cacherons que l'élément <code>LABEL</code> , car les deux autres éléments n'interfèrent pas avec notre édition.  Ajoutez simplement la classe <code>view</code> à l'élément <code>LABEL</code> . <br><br>  Pour l'état «édition», définissez la variable <code>$editing</code> dans l'élément <code>LI</code> .  Initialement, il (état) est réinitialisé, s'active par <code>dblclick</code> sur l'élément <code>LABEL</code> et s'éteint lorsque l'élément <code>INPUT.edit</code> est flou.  Nous écrivons donc: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$completed=#.checked") ,'LABEL.view' .d("? $editing:!; ! .title") //  $editing ,     .e("dblclick","$editing=`yes") //  dblclick  $editing ,'INPUT.edit' .d("? $editing; !! .title@value") //  $editing  .ui(".title=#.value") //  .title   change (ui     INPUT) .e("blur","$editing=") //  $editing   blur ,'BUTTON.destroy'.d("") ).a("!? $completed $editing") //   $completed  $editing  css-  'LI'</span></span></code> </pre><br>  Nous <a href="http://dap.js.org/samples/tutorial/6.html" rel="nofollow">pouvons</a> maintenant modifier les noms des cas. <br><br><h2>  7. Envoi de données au serveur </h2><br>  Ok, nous pouvons déjà éditer des choses dans le navigateur, mais ces changements doivent également être transférés au serveur.  Nous regardons comment l'original le fait: <br><br><img src="https://habrastorage.org/webt/jd/r5/bw/jdr5bwsa8yi7wu4sbwxqr3bwcdi.png"><br><br>  Les modifications sont envoyées au serveur en utilisant la méthode PATCH avec une certaine URL de la forme <code>http://todo-backend-express.herokuapp.com/28185</code> , qui, évidemment, est unique pour chaque cas.  Cette URL est indiquée par le serveur dans le champ <code>.url</code> pour chaque cas de la liste.  Autrement dit, tout ce qui nous est demandé pour mettre à jour le cas sur le serveur est d'envoyer une demande PATCH à l'adresse spécifiée dans le champ <code>.url</code> , avec les données modifiées au format JSON: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>)</code> </pre><br>  Ici, nous utilisons le même convertisseur <code>:query</code> , mais dans une version plus détaillée.  Lorsque <code>:query</code> est appliquée à une chaîne simple, cette chaîne est traitée comme une URL et une demande GET est exécutée.  Si <code>:query</code> reçoit un objet complexe, comme dans ce cas, il le traite comme une description détaillée de la demande contenant les champs <code>.method</code> , <code>.headers</code> , <code>.headers</code> et <code>.body</code> , et exécute la demande conformément à ceux-ci.  Ici, immédiatement après la mise à jour du <code>.title</code> envoyons au serveur une demande PATCH avec ce <code>.title</code> mis à jour <br><br>  Mais il y a une nuance.  Nous obtenons le champ <code>.url</code> du serveur, il ressemble à ceci: <code>http://todo-backend-express.herokuapp.com/28185</code> , c'est-à-dire que le protocole http: // est codé en dur si notre client est également ouvert via http: // alors tout va bien.  Mais si le client est ouvert via https: //, alors un problème se pose: pour des raisons de sécurité, le navigateur bloque le trafic http depuis la source https. <br><br>  Il est résolu simplement: si vous supprimez le protocole de <code>.url</code> , la demande passera par le protocole de page.  Alors faisons-le: écrivez le convertisseur approprié - <code>dehttp</code> , et nous passerons <code>.url</code> travers.  Les convertisseurs personnalisés (et autres fonctionnalités) sont <code>.FUNC</code> dans la section <code>.FUNC</code> : <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-comment"><span class="hljs-comment">//  -         dehhtp: url=&gt;url.replace(/^https?\:/,'')//    URL } })</span></span></code> </pre><br>  Il est également judicieux de placer l'objet headers dans le dictionnaire afin qu'il puisse être utilisé dans d'autres requêtes: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title):json.encode@body):query"</span></span>) ... .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} })</code> </pre><br>  Eh bien, pour le feng shui complet, nous utiliserons une autre propriété utile du convertisseur <code>:query</code> - encodage automatique du corps de la requête dans json conformément à l'en <code>Content-type:application/json</code> tête <code>Content-type:application/json</code> .  Par conséquent, la règle ressemblera à ceci: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title)):query"</span></span>)</code> </pre><br>  Alors <a href="http://dap.js.org/samples/tutorial/7-2.html" rel="nofollow">regarde</a> .  D'accord, les noms de cas changent désormais non seulement dans le navigateur, mais aussi sur le serveur.  Mais!  Non seulement le nom de l'affaire peut changer, mais aussi son état d'avancement - <code>completed</code> .  Il doit donc également être envoyé au serveur. <br>  Vous pouvez ajouter la même demande PATCH à l'élément <code>INPUT.toggle</code> , envoyez simplement <code>(.completed)</code> au lieu de <code>(.completed)</code> : <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$completed=#.checked; (@method`PATCH .url:dehttp headers (.completed:?)):query"</span></span>)</code> </pre><br>  Et vous pouvez mettre cette demande PATCH «hors des crochets»: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">// $patch - ""   ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=($completed=#.checked)") //   $patch  completed ,'LABEL.view' .d("? $editing:!; ! .title") .e("dblclick","$editing=`yes") ,'INPUT.edit' .d("? $editing; !! .title@value") .ui("$patch=(.title=#.value)") //   $patch  title .e("blur","$editing=") ,'BUTTON.destroy'.d("") ) .a("!? $completed $editing") //  $patch  ,   ,   .u("? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch=")</span></span></code> </pre><br>  Voici le truc.  Les règles de réaction appartiennent au groupe «up-rules», qui sont exécutées «de bas en haut» - du descendant au parent, à la racine elle-même (cette séquence peut être interrompue si nécessaire).  Cela ressemble un peu aux événements contextuels dans le DOM.  Par conséquent, certains fragments de la réaction communs à plusieurs descendants peuvent être attribués à un ancêtre commun. <br><br>  Plus précisément, dans notre cas, le gain d'une telle délégation n'est pas particulièrement perceptible, mais s'il y avait des champs plus modifiables, alors mettre cette demande volumineuse (selon les normes DAP, bien sûr) dans une règle générale aiderait grandement à garder le code simple et lisible.  Je le recommande donc. <br><br>  <a href="http://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">Nous regardons</a> : Maintenant, les changements de nom et les changements d'état sont envoyés au serveur. <br><br>  Dans le prochain article, si vous êtes intéressé, envisagez d'ajouter, de supprimer et de filtrer les cas.  En attendant, vous pouvez voir le <a href="https://dap.js.org/samples/todo.html" rel="nofollow">résultat final</a> et d'autres exemples de code dap sur <a href="https://dap.js.org/docs/" rel="nofollow">dap.js.org/docs</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr480912/">https://habr.com/ru/post/fr480912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr480900/index.html">Ramenez mon bébé! (Histoire N.-F.)</a></li>
<li><a href="../fr480902/index.html">Nouvelles fonctionnalités de surveillance PostgreSQL PostgreSQL</a></li>
<li><a href="../fr480904/index.html">PHP Microservice Framework: environnement de développement pour Swoft</a></li>
<li><a href="../fr480906/index.html">Écrire un jeu de python simple</a></li>
<li><a href="../fr480910/index.html">Comment créer une classe de test de base pour les tests Selenium et initialiser via JUnit RuleChain</a></li>
<li><a href="../fr480914/index.html">Microservices pour débutants</a></li>
<li><a href="../fr480918/index.html">Apache Hadoop Code Quality: Production VS Test</a></li>
<li><a href="../fr480920/index.html">Test des commutateurs TP-Link avec PoE longue portée. Et un peu sur les mises à niveau des anciens modèles</a></li>
<li><a href="../fr480922/index.html">Evgeny Usvitsky: «Tout le monde dans le monde sait où obtenir les géodonnées librement - uniquement dans OSM»</a></li>
<li><a href="../fr480924/index.html">Comment et pourquoi les créateurs du remake de MediEvil ont repensé le boss culte du jeu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>