<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüç≥ ‚úçüèø üë®‚Äç‚úàÔ∏è Como o batimento card√≠aco soa: convertendo o cardiograma de papel para o formato WAV üÉè üë©üèø‚Äçüéì ‚õèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitas vezes teve que lidar com um exame card√≠aco em institui√ß√µes m√©dicas usando um cardi√≥grafo. Esta unidade mede a atividade bioel√©trica do cora√ß√£o,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o batimento card√≠aco soa: convertendo o cardiograma de papel para o formato WAV</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419527/"><img src="https://habrastorage.org/webt/vd/8i/cs/vd8icsdtkcxv6x3i-djvtgs6hrs.jpeg"><br>  Muitas vezes teve que lidar com um exame card√≠aco em institui√ß√µes m√©dicas usando um cardi√≥grafo.  Esta unidade mede a atividade bioel√©trica do cora√ß√£o, registrando o resultado em uma fita de papel.  Os cardi√≥grafos modernos registram o resultado da medi√ß√£o n√£o no papel, mas na mem√≥ria digital.  No entanto, a fita de papel √© frequentemente usada como o meio final das informa√ß√µes gravadas.  Visualmente, √© um papel milim√©trico longo, de pequena largura, que √© torcido em um rolo.  No papel, al√©m da grade milim√©trica, um determinado gr√°fico √© desenhado em todo o comprimento, o que reflete a lei da altera√ß√£o do valor medido ao longo do tempo.  O valor medido, como eu o entendo, √© a diferen√ßa de potencial entre os leads.  Na maioria das vezes, v√°rios gr√°ficos s√£o apresentados em uma fita de uma vez, pois s√£o registradas diferen√ßas de potencial entre v√°rios leads.  No entanto, sem entrar em detalhes da medicina, no futuro consideraremos um dos primeiros hor√°rios principais.  Al√©m dos gr√°ficos, h√° informa√ß√µes adicionais em texto na fita: escala horizontal (mm / s), vertical (mm / mV), frequ√™ncia card√≠aca medida (bpm) e muito mais. <br><br>  Houve uma ideia de converter esse gr√°fico em um formato de som, reproduzir o resultado e ouvir como ele soa. <br><a name="habracut"></a><br>  De acordo com a an√°lise preliminar, podemos concluir que a composi√ß√£o de frequ√™ncia de uma onda desse tipo n√£o √© muito saturada.  De fato, essas s√£o frequ√™ncias baixas, incluindo o infra-som, que se acredita ser inaud√≠vel.  No entanto, ser√° poss√≠vel ver como o cone do woofer repetir√° vibra√ß√µes semelhantes √†s "vibra√ß√µes" do cora√ß√£o.  De fato, devido √† presen√ßa de circuitos de diferencia√ß√£o capacitiva no caminho de propaga√ß√£o do sinal da placa de som do PC para o amplificador de graves, as vibra√ß√µes da cabe√ßa din√¢mica n√£o repetem exatamente as vibra√ß√µes apresentadas no cardiograma.  E isso √© fornecido desde que os filtros que cortam frequ√™ncias ultra baixas n√£o sejam instalados em nenhum lugar.  Al√©m disso, distor√ß√µes n√£o lineares estar√£o presentes, acompanhadas por v√°rios harm√¥nicos de alta frequ√™ncia.  No entanto, sem levar em considera√ß√£o a an√°lise acima, colocamos o problema da seguinte forma: converta o gr√°fico em papel no formato WAV para que, quando voc√™ abrir esse arquivo em um editor de som, a forma de onda corresponda √† vers√£o em papel e, al√©m disso, corresponda √† escala de tempo. <br><br>  Primeiro, voc√™ precisa estimar a profundidade da quantiza√ß√£o (a resolu√ß√£o do √°udio digital verticalmente).  Estou considerando um dos padr√µes: 8 ou 16 bits.  A segunda op√ß√£o (16 bits) s√£o 65536 amostras verticais, que corresponder√£o a 65536 pixels da imagem, que √© uma digitaliza√ß√£o ou foto de um cardiograma.  Isso √© muito, e n√£o faz sentido.  Se voc√™ tirar 8 bits - s√£o 256 amostras ou 256 pixels da imagem.  Agora esta √© uma op√ß√£o mais adequada.  Nesse caso, a faixa din√¢mica do √°udio ser√° 6 * 8 = 48 dB.  N√£o sei qual o alcance din√¢mico do cardiograma, mas acho que n√£o mais.  O dispositivo em si √© naturalmente maior, mas √© inevit√°vel um erro ao exibir um cardiograma no papel, especialmente quando se trata de desenhar diretamente com uma caneta.  By the way, sobre o √∫ltimo.  N√£o levarei em conta padr√µes antigos desenhados com uma caneta "radial".  A fita milim√©trica de papel para tais cardiogramas √© espec√≠fica: arcos verticais em vez de linhas retas s√£o desenhados.  Quanto √† escala horizontal - a taxa de amostragem - ser√° calculada com base na escala do cardiograma e tamanho da imagem.  A velocidade de reprodu√ß√£o depender√° desse par√¢metro e deve corresponder √† real "velocidade do cardiograma". <br><br>  O papel do cardiograma deve ser digitalizado em preto e branco com tons de cinza em resolu√ß√£o suficiente.  √â necess√°rio redimensionar a imagem para que o cardiograma desejado caiba em uma faixa de 256 pixels de largura.  Encontrei muitas imagens com cardiogramas na Internet.  Como exemplo, considere dois deles. <br><br><img src="https://habrastorage.org/webt/6a/ao/ve/6aaoveakfnrluqr-m-hybxevcly.jpeg"><br><br>  A primeira imagem, pode-se dizer, est√° quase pronta.  Altura da imagem - 431. Largura - 1023. Uma onda atrav√©s da largura preenche completamente a imagem.  Mas voc√™ precisa deixar 256 de altura, cortando a imagem acima e abaixo, para que a onda esteja localizada aproximadamente no centro. <br><br><img src="https://habrastorage.org/webt/1y/pl/9b/1ypl9b8u33wmyo2xa6cdkhbx9n0.png"><br><br>  A segunda figura mostra v√°rios cardiogramas de uma s√≥ vez.  Pegue o primeiro.  Ap√≥s o corte, obtivemos uma imagem medindo 508 por 61. <br><br><img src="https://habrastorage.org/webt/od/sr/nc/odsrncybq1ghgyy1tmf-x7rxmh4.png"><br><br>  Sem esticar a imagem verticalmente, faremos uma imagem com 256 pixels de altura, preenchendo a √°rea criada com um vazio branco.  A onda tamb√©m deve estar localizada aproximadamente no centro.  Ao cortar, selecionei a largura 508 para deixar o maior n√∫mero poss√≠vel de c√©lulas milim√©tricas poss√≠veis, que tamb√©m s√£o vis√≠veis na imagem. <br><br>  Ambas as imagens precisam ser convertidas em uma visualiza√ß√£o na qual apenas um gr√°fico preto ser√° vis√≠vel em um fundo branco e nada mais.  Isso √© feito de maneira elementar.  Devido ao fato de o gr√°fico ser desenhado muito mais gordo que a grade milim√©trica, no editor de gr√°ficos usando os ajustes ‚Äúbrilho, contraste, satura√ß√£o‚Äù, voc√™ pode obter o resultado desejado.  Se a convers√£o perfeita falhar, o excesso de "lixo" restante acima do gr√°fico deve ser apagado com a ferramenta borracha.  Todas as imagens devem ser salvas no formato BMP monocrom√°tico.  Assim, apenas as cores branca e preta permanecer√£o definitivamente na imagem. <br><br>  Antes de come√ßar a descrever o algoritmo para converter imagens em WAV, vale a pena especificar algumas das nuances que simplificam a programa√ß√£o.  As fotos resultantes devem ser giradas 90 graus no sentido anti-hor√°rio (a largura e a altura da imagem mudam de lugar).  Isso √© necess√°rio para orientar o in√≠cio do cardiograma com o in√≠cio do arquivo BMP.  Sabe-se que os dados de cores de cada pixel em um arquivo BMP s√£o gravados no arquivo linha por linha, come√ßando no canto inferior esquerdo.  Ent√£o voc√™ precisa abrir as imagens no editor ‚ÄúMS Paint‚Äù (eu tenho o Windows XP) e salvar em BMP de 8 bits (256 cores).  Obviamente, haver√° uma "redefini√ß√£o de informa√ß√£o", mas com esse formato, cada pixel na imagem corresponde a um byte, o que √© muito conveniente na programa√ß√£o.  O byte "0" √© um pixel preto e o byte "255" √© branco.  O resultado deve ser algo como o seguinte (aqui duas fotos s√£o conectadas e cortadas pela metade). <br><br><img src="https://habrastorage.org/webt/vr/cc/nh/vrccnhi1qkyegtfpanecxls5c40.jpeg"><br><br>  Quanto ao formato de sa√≠da, n√≥s o enviaremos n√£o para um arquivo WAV padr√£o, mas para um arquivo de dados RAW (PCM).  Isso tamb√©m simplifica a programa√ß√£o, pois ao enviar para WAV, voc√™ ainda precisa cuidar do cabe√ßalho de 44 bytes.  No editor de √°udio comum Adobe Audition 1.5, o arquivo PCM √© aberto sem problemas.  Al√©m disso, voc√™ pode at√© gerar n√∫meros decimais de dados PCM para uma coluna em um arquivo de texto, tendo formado anteriormente um cabe√ßalho de texto espec√≠fico.  Estranhamente, mas esses arquivos tamb√©m s√£o abertos pelo Adobe Audition. <br><br>  N√≥s descrevemos o algoritmo de transforma√ß√£o.  E o algoritmo √© muito simples: voc√™ precisa analisar cada linha do arquivo BMP de baixo para cima.  A an√°lise consistir√° na contagem de pixels brancos da esquerda para a direita em uma linha at√© que o preto seja encontrado.  Os valores inteiros n√£o negativos obtidos devem ser gravados no arquivo PCM de sa√≠da em formato bin√°rio.  O tamanho do arquivo de sa√≠da corresponder√° exatamente √† altura da imagem processada.  A profundidade de quantiza√ß√£o de 8 bits do formato de dados de √°udio PCM implica a codifica√ß√£o de amostras de acordo com o mesmo princ√≠pio.  O valor "0" √© o valor m√°ximo negativo da amostra de √°udio, o valor "255" √© o m√°ximo positivo e "128" √© o valor zero (no meio).  Por exemplo, um arquivo PCM de dados de √°udio silenciosos conter√° os mesmos bytes com o valor "128".  Vale ressaltar que uma linha pode conter v√°rios pixels pretos consecutivos, dependendo da espessura da linha do cardiograma.  Mas o algoritmo descrito "pega" o envelope superior, o que ser√° suficiente.  Al√©m disso, os altos picos do cardiograma direcionados para cima ser√£o mais bem compreendidos dessa maneira. <br><br>  Agora voc√™ pode come√ßar a escrever o texto do programa.  O programa escrito em C √© muito simples e n√£o precisa de coment√°rios detalhados. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; // ,  ; int main(){ //  ; FILE *in,*out; //   ; unsigned long int h,i; //    ; unsigned char px,s; //     ; in=fopen("1.bmp","rb"); //   ; out=fopen("1.pcm","wb"); //   ; fseek(in,22,SEEK_SET); //    ,     fread(&amp;h,4,1,in); //   (4 ); for(i=0;i&lt;h;i++){ // -   ; fseek(in,0x436+i*256,SEEK_SET); //   i-  s=0; //  ( ); do{ //  ; fread(&amp;px,1,1,in); //  ; s+=1; //   ; }while(px); // ,     ; fwrite(&amp;s,1,1,out); //     ; } fclose(in); //  ; fclose(out); //  ; return 0; //  ; }</span></span></span></span></code> </pre> <br><br>  Ap√≥s a execu√ß√£o do programa no arquivo ‚Äú1.bmp‚Äù, o arquivo ‚Äú1.pcm‚Äù ser√° criado no mesmo diret√≥rio do programa.  Quando voc√™ tenta abrir um arquivo no Adobe Audition, a seguinte janela deve aparecer. <br><br><img src="https://habrastorage.org/webt/sw/lj/pg/swljpg5dphpocfdbnvsartz0k-8.png"><br><br>  Voc√™ precisa selecionar "Mono", "8 bits" e imprimir a frequ√™ncia de amostragem no campo de entrada com base no c√°lculo: f = h / (s / v), em que h √© a altura da imagem (tamb√©m √© o n√∫mero de amostras no √°udio), s - o comprimento do cardiograma em mil√≠metros, v √© a escala do cardiograma em mm / s.  O √∫ltimo par√¢metro est√° escrito no cardiograma.  No primeiro cardiograma, nada √© escrito, mas a escala, em regra, costuma ser de 25 mm / s.  O c√°lculo das taxas de amostra no Excel para nossos exemplos √© mostrado na figura abaixo. <br><br><img src="https://habrastorage.org/webt/tl/vw/jp/tlvwjpkgjgxsh2z5bwrgkmzjuy8.png"><br><br>  Como mencionado acima, inserimos os valores necess√°rios de frequ√™ncias de amostragem para cada um dos exemplos no campo correspondente.  Voc√™ pode at√© digitar decimais, de qualquer maneira, haver√° um arredondamento autom√°tico para o todo mais pr√≥ximo. <br><br><img src="https://habrastorage.org/webt/ha/tr/jt/hatrjtjokkoinjcox4ed9ushjiw.png"><br><br>  Ao clicar em "OK", concordamos que estamos trabalhando com amostras de "8 bits n√£o assinados" (haver√° outra janela), ap√≥s a qual a forma de onda do nosso arquivo ser√° expandida no campo principal do editor de som.  Observe que essa exibi√ß√£o ser√° apresentada ‚Äúde cabe√ßa para baixo‚Äù e, para total conformidade com a vers√£o em papel, voc√™ deve inverter a onda no menu correspondente.  Como resultado, ficar√° assim. <br><br><img src="https://habrastorage.org/webt/ru/pf/zj/rupfzjhna9czkxh3xifzjuzhubu.png"><br><br>  O segundo cardiograma parece "mais silencioso", uma vez que originalmente n√£o era muito grande em tamanho. <br><br><img src="https://habrastorage.org/webt/-u/fl/vz/-uflvzhf_iswthnmhrwsdd3xvl4.png"><br><br>  Infelizmente, nem todas as placas de som permitem reproduzir √°udio em uma frequ√™ncia de amostragem arbitr√°ria; mais precisamente, a grande maioria n√£o sabe como.  Para reproduzir corretamente o arquivo, voc√™ deve executar a fun√ß√£o "Converter tipo de amostra".  Converteremos para o valor padr√£o mais pr√≥ximo de 8000 Hz e, ao mesmo tempo, aumentaremos a resolu√ß√£o em amplitude para 16 bits.  Este √∫ltimo √© necess√°rio para a precis√£o no est√°gio de interpola√ß√£o durante a amostragem.  Se voc√™ deixar 8 bits, a regi√£o restante do espectro ser√° preenchida com ru√≠do de quantiza√ß√£o.  A prop√≥sito, esse procedimento pode ser realizado de forma program√°tica no est√°gio de convers√£o BMP-PCM, mesmo usando interpola√ß√£o.  Mas um dos objetivos era a simplicidade do c√≥digo do programa. <br><br>  Ap√≥s a opera√ß√£o de upsampling, voc√™ pode ouvir e apreciar o resultado.  Voc√™ pode salvar o resultado em um arquivo wav ou mp3 padr√£o.  Parece exatamente o mesmo que eu esperava inicialmente. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Este</a> link permite baixar o arquivo rar, que cont√©m dois arquivos WAV com o resultado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419527/">https://habr.com/ru/post/pt419527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419513/index.html">Configurar pol√≠tica de seguran√ßa de senha no Zimbra</a></li>
<li><a href="../pt419515/index.html">Como uma startup "sem marca" recebeu US $ 240 milh√µes para derrotar a Amazon</a></li>
<li><a href="../pt419519/index.html">Dicas para jogos para dispositivos m√≥veis: Parte 1, Lan√ßamento suave</a></li>
<li><a href="../pt419523/index.html">A equipe PVS-Studio √© imparcial ao escrever artigos</a></li>
<li><a href="../pt419525/index.html">Da API primeiro no Swagger ao contrato √∫nico no RAML</a></li>
<li><a href="../pt419531/index.html">Escolhendo o par perfeito para seus ouvidos: dez dicas pr√°ticas</a></li>
<li><a href="../pt419535/index.html">Atualiza√ß√£o na torradeira</a></li>
<li><a href="../pt419537/index.html">CyberDemons: Intelig√™ncia Artificial DOOM 2016</a></li>
<li><a href="../pt419539/index.html">Semin√°rio on-line aberto "Programa√ß√£o ass√≠ncrona em Python"</a></li>
<li><a href="../pt419547/index.html">Organizando um resumo regular de log com python e ansible usando asterisk como exemplo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>