<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤠 🔩 🦑 10 أفضل الممارسات لتأمين صور عامل الميناء. الجزء 1 🎵 🎅🏾 🤷🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="تم إعداد ترجمة للمقال خصيصًا لطلاب دورة Linux Security . 



 في هذه المقالة ، نود التركيز على Docker ومناقشة النصائح والحيل التي توفر عملية أكثر أمان...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>10 أفضل الممارسات لتأمين صور عامل الميناء. الجزء 1</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/480970/" style=";text-align:right;direction:rtl">  <i>تم إعداد ترجمة للمقال خصيصًا لطلاب <a href="https://otus.pw/wHGa/">دورة Linux Security</a> .</i> <br><br><img src="https://habrastorage.org/webt/46/6k/xf/466kxf-lmjpubtojmiocti9n_ea.png"><br><hr><br>  في هذه المقالة ، نود التركيز على Docker ومناقشة النصائح والحيل التي توفر عملية أكثر أمانًا وعالية الجودة لمعالجة صور Docker. <br><br>  لذلك ، لنبدأ بقائمتنا التي تتضمن أفضل 10 ممارسات لأمان صور Docker. <a name="habracut"></a><br><br><h3 style=";text-align:right;direction:rtl">  1. تفضل الحد الأدنى من الصور الأساسية </h3><br>  غالبًا ما يمكنك البدء في المشروعات باستخدام صورة حاوية Docker أساسية ، على سبيل المثال ، عن طريق كتابة <code>Dockerfile</code> مع <code>FROM node</code> "افتراضيًا".  ومع ذلك ، عند تحديد صورة العقدة ، ضع في اعتبارك أن توزيع Debian Stretch المثبت بالكامل هو الصورة الأساسية المستخدمة في بنائها.  إذا كان مشروعك لا يحتاج إلى أي مكتبات أو أدوات مساعدة للنظام ، فمن الأفضل تجنب استخدام نظام تشغيل كامل الوظائف (OS) كصورة أساسية. <br><br>  في <a href="https://snyk.io/blog/top-ten-most-popular-docker-images-each-contain-at-least-30-vulnerabilities/">تقرير حالة الأمان Snyk مفتوح المصدر لعام 2019 ،</a> وجدنا أن العديد من حاويات Docker الشهيرة الموجودة على موقع Docker Hub تحتوي على صور تحتوي على العديد من نقاط الضعف المعروفة.  على سبيل المثال ، عند استخدام صورة <code>docker pull node</code> العالمية المشهورة ، فأنت تدخل نظام التشغيل فعليًا في تطبيقك ، والذي ، كما تعلم ، لديه 580 نقطة ضعف في مكتبات نظامه. <br><br><img src="https://habrastorage.org/webt/ut/cd/0p/utcd0pgkakkcjnj_qehsuwziv2y.png"><br><br>  كما ترون من تقرير الأمان ، تحتوي كل صورة من صور Docker العشرة الأكثر شيوعًا التي اختبرناها في Docker Hub على ثغرات أمنية معروفة.  تفضل الحد الأدنى من الصور التي تجمع فقط بين أدوات النظام والمكتبات اللازمة لتشغيل مشروعك ، كما يمكنك تقليل المساحة للمهاجمين للهجوم والتأكد من توفير نظام تشغيل آمن. <br><br>  <b><a href="https://snyk.io/container-vulnerability-management/">تعلم المزيد عن سلامة صورك</a></b> <br><br><h3 style=";text-align:right;direction:rtl">  2. مستخدم متميز الأقل </h3><br>  عندما لا يحدد <code>Dockerfile</code> <code>USER</code> ، يتم تشغيل الحاوية افتراضيًا كمستخدم الجذر.  في الممارسة العملية ، هناك القليل من الأسباب التي تجعل الحاوية لها امتيازات الجذر.  Docker يبدأ حاويات بشكل افتراضي باستخدام المستخدم الجذر.  ثم ، عند تعيين مساحة الاسم هذه للمستخدم الجذر في حاوية جارية ، يترتب على ذلك أن الحاوية يمكن أن يكون لها وصول جذر على مضيف Docker.  يؤدي تشغيل التطبيق في حاوية مع مستخدم الجذر إلى توسيع مساحة الهجوم ويوفر طريقة سهلة لرفع الامتيازات إذا كان التطبيق نفسه عرضة للاستغلال. <br><br>  لتقليل التعرض ، قم بتمكين إنشاء مستخدم مخصص ومجموعة في صورة Docker للتطبيق ؛  استخدم توجيه <code>USER</code> في <code>Dockerfile</code> للتحقق من أن الحاوية تبدأ تشغيل التطبيق بوصول أقل امتياز. <br><br>  قد لا يوجد مستخدم مخصص في الصورة ؛  قم بإنشاء هذا المستخدم باستخدام الإرشادات الموجودة في <code>Dockerfile</code> . <br><br>  فيما يلي مثال كامل عن كيفية القيام بذلك لصورة Ubuntu عالمية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">FROM ubuntu RUN mkdir /app RUN groupadd -r lirantal &amp;&amp; useradd -r -s /bin/<span class="hljs-literal"><span class="hljs-literal">false</span></span> -g lirantal lirantal WORKDIR /app COPY . /app RUN chown -R lirantal:lirantal /app USER lirantal CMD node index.js</code> </pre> <br>  مثال أعلاه: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ينشئ مستخدم نظام (-r) بدون كلمة مرور ، دون تثبيت دليل رئيسي وبدون shell </li><li style=";text-align:right;direction:rtl">  يضيف المستخدم الذي أنشأناه إلى المجموعة الحالية التي أنشأناها مسبقًا (باستخدام groupadd) </li><li style=";text-align:right;direction:rtl">  يضيف الوسيطة الأخيرة إلى اسم المستخدم الذي نريد إنشاؤه ، بالاقتران مع المجموعة التي أنشأناها </li></ul><br>  Node.js والصور الألبية ، وتشمل بالفعل مستخدم عام يسمى <code>node</code> .  فيما يلي مثال Node.js باستخدام عقدة المستخدم العامة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">FROM node:<span class="hljs-number"><span class="hljs-number">10</span></span>-alpine RUN mkdir /app COPY . /app RUN chown -R node:node /app USER node CMD [“node”, “index.js”]</code> </pre> <br>  إذا كنت تقوم بتطوير تطبيقات Node.js ، فيمكنك الرجوع إلى <a href="">أفضل ممارسات Docker و Node.js</a> الرسمية. <br><br><h3 style=";text-align:right;direction:rtl">  3. التوقيع والتحقق من الصور لتجنب هجمات MITM </h3><br>  أصالة صور عامل الميناء هو مشكلة.  نعتمد على هذه الصور لأننا نستخدمها حرفيًا كحاوية تشغل الكود الخاص بنا في الإنتاج.  لذلك ، من المهم التأكد من أن الصورة التي نستخدمها هي بالضبط الصورة التي يقدمها الناشر ، وأنه لم يغيرها أي من الجانبين.  يمكن أن يحدث التزوير من خلال اتصال سلكي بين عميل Docker والسجل ، أو عن طريق اختراق سجل حساب المالك لاستبدال الصورة. <br><br><h4 style=";text-align:right;direction:rtl">  التحقق من صحة صورة عامل الميناء </h4><br>  تتيح لك إعدادات Docker الافتراضية استرداد صور Docker دون التحقق من صحتها ، مما قد يؤدي إلى استخدام صور Docker التي لم يتم التحقق من أصلها ومؤلفها. <br><br>  يوصى بالتحقق دائمًا من الصور قبل استخدامها ، بغض النظر عن السياسة.  لتجربة التحقق من الصحة ، قم بتمكين Docker Content Trust مؤقتًا باستخدام الأمر التالي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> DOCKER_CONTENT_TRUST=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  حاول الآن سحب الصورة التي تعرف أنها غير موقعة - سيتم رفض الطلب ولن يتم استلام الصورة. <br><br><h4 style=";text-align:right;direction:rtl">  توقيع عامل الميناء الصور </h4><br>  <a href="https://hub.docker.com/search/%3Fcertification_status%3Dcertified%26type%3Dimage">تفضيل</a> الصور <a href="https://hub.docker.com/search/%3Fcertification_status%3Dcertified%26type%3Dimage">المعتمدة من Docker</a> من الشركاء الموثوق بهم الذين تم التحقق منهم والإشراف عليهم من قِبل Docker Hub ، بدلاً من الصور التي لا يمكن التحقق من مصدرها وأصالتها. <br><br>  يتيح لك عامل الميناء توقيع الصور وبالتالي توفير مستوى آخر من الحماية.  لتوقيع الصور ، استخدم <a href="https://docs.docker.com/notary/getting_started/">Docker Notary</a> .  يقوم كاتب العدل بالتحقق من توقيع الصورة لك ويمنع بدء تشغيل الصورة إذا كان توقيع الصورة غير صالح. <br><br>  عند تمكين Docker Content Trust ، كما أوضحنا أعلاه ، فإن تجميع صورة Docker يوقع على الصورة.  عندما يتم تسجيل الصورة لأول مرة ، يقوم Docker بإنشاء وتخزين المفتاح الخاص في <code>~/docker/trust</code> للمستخدم الخاص بك.  ثم يتم استخدام هذا المفتاح الخاص لتوقيع أي صور إضافية عند إنشائها. <br><br>  للحصول على إرشادات مفصلة حول إعداد الصور الموقعة ، راجع <a href="https://docs.docker.com/engine/security/trust/content_trust/">وثائق Docker الرسمية</a> . <br><br><h3 style=";text-align:right;direction:rtl">  4. البحث عن وإصلاح وتتبع نقاط الضعف في مكونات مفتوحة المصدر </h3><br>  عندما نختار الصورة الأساسية لحاوية Docker الخاصة بنا ، فإننا نتحمل بشكل غير مباشر مخاطر جميع مشكلات الأمان المرتبطة بالصورة الأساسية.  يمكن تكوين هذه الإعدادات الافتراضية بشكل سيئ والتي لا تساهم في أمان نظام التشغيل ، وكذلك مكتبات النظام المرتبطة بالصورة الأساسية التي اخترناها. <br><br>  الخطوة الأولى الجيدة هي استخدام الصورة الأساسية الدنيا قدر الإمكان لتشغيل التطبيق دون مشاكل.  هذا يساعد في تقليل مساحة الهجوم عن طريق الحد من الضعف ؛  من ناحية أخرى ، لا تقوم بإجراء أي من عمليات الفحص الخاصة بها ولا تحميك من الثغرات المستقبلية التي قد يتم تحديدها للإصدار المستخدم من الصورة الأساسية. <br><br>  لذلك ، تتمثل إحدى طرق الحماية من الثغرات الأمنية في البرامج مفتوحة المصدر في استخدام أدوات مثل Snyk لإضافة مسح ضوئي مستمر وتتبع الثغرات الأمنية التي قد توجد في جميع طبقات صور Docker المستخدمة. <br><br><img src="https://habrastorage.org/webt/si/jk/ug/sijkugpbdopedhe1y1vuk4n3mcm.gif"><br><br>  يتم مسح صورة Docker بحثًا عن نقاط الضعف المعروفة باستخدام هذه الأوامر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># fetch the image to be tested so it exists locally $ docker pull node:10 # scan the image with snyk $ snyk test --docker node:10 --file=path/to/Dockerfile</span></span></code> </pre> <br>  تتم مراقبة صورة Docker بحثًا عن نقاط الضعف المعروفة ، بحيث بعد اكتشاف ثغرات جديدة في صورة Snyk ، يمكنها إخطار وتقديم توصيات بشأن كيفية إصلاحها ، على النحو التالي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ snyk monitor --docker node:10</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  استنادًا إلى الفحص الذي أجراه مستخدمو Snyk ، وجدنا أن 44٪ من عمليات مسح صور Docker كشفت عن نقاط ضعف معروفة وأي صور أساسية أحدث وأكثر أمانًا كانت متوفرة.  تعتبر استشارة الإصلاح هذه ، حيث يمكن للمطورين اتخاذ الإجراءات وتحديث صور Docker الخاصة بهم ، فريدة بالنسبة إلى Snyk. </blockquote>  وجد Snyk أيضًا أنه بالنسبة إلى 20٪ من جميع عمليات مسح صور Docker ، فإن إعادة إنشاء صورة Docker فقط كافية <a href="https://snyk.io/blog/top-ten-most-popular-docker-images-each-contain-at-least-30-vulnerabilities/">لتقليل نقاط الضعف</a> .  تعرف على المزيد حول عدد تقارير الأمان المفتوحة 2019 على مدونة Snyk. <br><br>  نهاية الجزء الاول. <br><br>  <i>تابع في <a href="https://habr.com/ru/company/otus/blog/482044/">الجزء الثاني</a> ، والآن ندعو الجميع لحضور ندوة عبر الإنترنت مجانًا حول هذا الموضوع: <a href="https://otus.pw/wHGa/">"نقاط ضعف Docker.</a></i>  <i><a href="https://otus.pw/wHGa/">الهروب من الحاوية إلى المضيف مع تصاعد الامتيازات "</a> .</i> <i><br><br></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar480970/">https://habr.com/ru/post/ar480970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar480956/index.html">كيف وجدت طريقة لتتبع جميع برامج تشغيل Citimobil</a></li>
<li><a href="../ar480958/index.html">اتصال القمر الصناعي. نظرة عامة على الشركات المشغلة وقليلا حول التصنيف</a></li>
<li><a href="../ar480960/index.html">البحث عن الملفات المفقودة في أهداف Xcode متعددة</a></li>
<li><a href="../ar480962/index.html">تطوير برنامج التحويل البرمجي C للمعالج العصبي متعدد الخلايا الجديد</a></li>
<li><a href="../ar480964/index.html">ما هي منطقة Fresnel و CCQ (جودة اتصال العميل) أو العوامل الأساسية لجسر لاسلكي عالي الجودة</a></li>
<li><a href="../ar480974/index.html">تطوير التطبيقات في التطبيقات المصغرة VK</a></li>
<li><a href="../ar480976/index.html">JSON-RPC API Library Library</a></li>
<li><a href="../ar480978/index.html">هل هناك حياة بعد Signora؟</a></li>
<li><a href="../ar480980/index.html">تقنيات التحليلات الحديثة في الأمن السيبراني</a></li>
<li><a href="../ar480982/index.html">3. Fortinet بدء التشغيل v6.0. إعداد تخطيط</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>