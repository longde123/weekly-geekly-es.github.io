<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游눛 游낖 游 PostgreSQL y configuraci칩n de consistencia de registro para cada conexi칩n particular 游눞 游꺗 游냔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La traducci칩n del art칤culo fue preparada especialmente para estudiantes del curso "Base de datos" . 쮼s interesante desarrollar en esta direcci칩n? Te ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PostgreSQL y configuraci칩n de consistencia de registro para cada conexi칩n particular</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/472364/"><p>  <em>La traducci칩n del art칤culo fue preparada especialmente para estudiantes del curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Base de datos"</a> .</em>  <em>쮼s interesante desarrollar en esta direcci칩n?</em>  <em>Te invitamos a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">jornada de puertas abiertas</a> , donde hablamos en detalle sobre el programa, las caracter칤sticas del formato en l칤nea, las competencias y las perspectivas profesionales que esperan a los graduados despu칠s de la capacitaci칩n.</em> </p><br><p><img src="https://habrastorage.org/webt/gf/iy/te/gfiyteycddmeefan9z5h1nxdgu0.png"></p><br><p>  PostgreSQL y configuraci칩n de consistencia de registro para cada conexi칩n particular <br>  En Compose, tenemos que lidiar con muchas bases de datos, que es lo que nos da la oportunidad de conocer m치s acerca de su funcionalidad y desventajas.  A medida que aprendemos a amar las caracter칤sticas funcionales de las nuevas bases de datos, a veces comenzamos a pensar en lo bueno que ser칤a si funciones similares estuvieran presentes en herramientas m치s maduras con las que hemos estado trabajando durante mucho tiempo.  Una de las nuevas caracter칤sticas que PostgreSQL quer칤a ver era su consistencia de escritura personalizada en todo el cl칰ster.  Y result칩 que ya lo tenemos, y hoy queremos compartir con usted informaci칩n sobre c칩mo puede usarlo. <a name="habracut"></a></p><br><h1 id="zachem-mne-eto">  쯇or qu칠 necesito esto? </h1><br><p>  El comportamiento de un cl칰ster depende de su aplicaci칩n.  Tomemos, por ejemplo, una solicitud para pagar facturas.  Necesitar치 una coherencia del 100% en el cl칰ster, por lo que deber치 habilitar las confirmaciones s칤ncronas para que su base de datos espere a que se realicen todos los cambios.  Sin embargo, si su aplicaci칩n es una red social de r치pido crecimiento, entonces probablemente preferir치 una coherencia del 100% con una respuesta r치pida.  Para lograr esto, puede usar confirmaciones asincr칩nicas en su cl칰ster. </p><br><h2 id="znakomtes-kompromiss">  Conoce el compromiso </h2><br><p>  Debe comprometer la consistencia de los datos y el rendimiento.  PostgreSQL pasa de la coherencia, porque la configuraci칩n predeterminada en este caso es predecible y sin sorpresas inesperadas.  Y ahora nos familiarizaremos con los compromisos. </p><br><h3 id="kompromiss-1-proizvoditelnost">  Compromiso 1: rendimiento </h3><br><p>  Si el cl칰ster PostgreSQL no requiere coherencia, puede funcionar de forma as칤ncrona.  La grabaci칩n se realiza al l칤der del cl칰ster y se enviar치n actualizaciones a sus r칠plicas despu칠s de unos pocos milisegundos.  Cuando se requiere coherencia para un cl칰ster PostgreSQL, deber칤a funcionar de forma sincr칩nica.  El registro se realizar치 en el l칤der del cl칰ster, que enviar치 actualizaciones a las r칠plicas y esperar치 la confirmaci칩n de que todos hicieron un registro antes de enviar la confirmaci칩n al cliente que inici칩 el registro de que fue exitoso.  La diferencia pr치ctica entre estos enfoques es que el m칠todo asincr칩nico requiere dos saltos de red, mientras que el m칠todo s칤ncrono requiere cuatro. </p><br><h3 id="kompromiss-2-soglasovannost">  Compromiso 2: Consistencia </h3><br><p>  El resultado en caso de mal funcionamiento de un l칤der en estos dos enfoques tambi칠n ser치 diferente.  Si el trabajo se realiza de forma as칤ncrona, cuando se produce dicho error, no todos los registros ser치n confirmados por las r칠plicas.  쮺u치nto se perder치?  Depende de la aplicaci칩n en s칤 y de la eficiencia de la replicaci칩n.  La replicaci칩n compuesta evitar치 que la r칠plica se convierta en un l칤der si la cantidad de informaci칩n que contiene es de 1 MB menos que en el l칤der, es decir, se pueden perder hasta 1 MB de registros durante la operaci칩n asincr칩nica. </p><br><p> En modo s칤ncrono, esto no sucede.  Si el l칤der falla, todas las r칠plicas se actualizan, ya que cualquier registro confirmado en el l칤der debe confirmarse en las r칠plicas.  Aqu칤 est치: coherencia. </p><br><p>  Tiene sentido utilizar un comportamiento sincr칩nico en una aplicaci칩n para pagar facturas, donde la coherencia tiene una clara ventaja al encontrar un compromiso entre la coherencia y el rendimiento.  Lo m치s importante para dicha aplicaci칩n son los datos v치lidos.  Ahora recuerde acerca de la red social, en la cual la tarea principal es mantener la atenci칩n del usuario, respondiendo a las solicitudes lo m치s r치pido posible.  En este caso, el rendimiento con menos saltos de red y menos confirmaciones de espera ser치 una prioridad.  Sin embargo, la compensaci칩n entre rendimiento y consistencia no es la 칰nica en la que pensar. </p><br><h3 id="kompromiss-3-sboi">  Compromiso 3: fallas </h3><br><p>  Es muy importante comprender c칩mo se comporta el cl칰ster durante una falla.  Considere una situaci칩n en la que una o m치s r칠plicas fallan.  Cuando las confirmaciones se procesan de forma as칤ncrona, el l칤der continuar치 funcionando, es decir, recibir치 y procesar치 registros sin esperar las r칠plicas faltantes.  Cuando las r칠plicas regresan al cl칰ster, se ponen al d칤a con el l칤der.  Con la replicaci칩n sincr칩nica, si las r칠plicas no responden, el l칤der no tendr치 otra opci칩n y continuar치 esperando la confirmaci칩n de la confirmaci칩n hasta que la r칠plica regrese al cl칰ster y pueda aceptar y confirmar el registro. </p><br><h2 id="po-odnomu-soedineniyu-na-tranzakciyu">  쯋na conexi칩n por transacci칩n? </h2><br><p>  Cada aplicaci칩n necesita un tipo especial de combinaci칩n de consistencia y rendimiento.  A menos, por supuesto, que sea nuestra aplicaci칩n de facturaci칩n, que creemos que es completamente consistente, o nuestra aplicaci칩n de red social casi ef칤mera.  En todos los dem치s casos, habr치 momentos en que algunas operaciones deben ser sincr칩nicas y otras asincr칩nicas.  Es posible que no desee que el sistema espere a que se cierre el mensaje enviado al chat, pero si el pago se realiza en la misma aplicaci칩n, tendr치 que esperar. </p><br><p>  Todas estas decisiones, por supuesto, son tomadas por el desarrollador de la aplicaci칩n.  Las decisiones correctas sobre cu치ndo aplicar este o aquel enfoque ayudar치n a aprovechar al m치ximo el cl칰ster.  Es importante que el desarrollador pueda cambiar entre ellos en el nivel SQL para conexiones y transacciones. </p><br><h2 id="obespechenie-kontrolya-na-praktike">  Proporcionando control en la pr치ctica </h2><br><p> Por defecto, PostgreSQL proporciona consistencia.  Esto es controlado por el par치metro del servidor <code>synchronous_commit</code> .  Por defecto est치 <code>remote_write</code> , pero tiene otras tres opciones: <code>local</code> , <code>remote_write</code> u <code>off</code> . </p><br><p>  Cuando el par치metro se <code>off</code> , todas las confirmaciones s칤ncronas se detienen, incluso en el sistema local.  El par치metro en local determina el modo s칤ncrono para el sistema local, pero las escrituras en las r칠plicas son as칤ncronas.  <code>Remote_write</code> va m치s all치: las escrituras en las r칠plicas se realizan de forma asincr칩nica, pero se devuelven cuando la r칠plica recibi칩 el registro pero no lo escribi칩 en el disco. </p><br><p>  Teniendo en cuenta la gama de opciones disponibles, elegimos el comportamiento y, recordando que hay registros sincr칩nicos, elegiremos <code>local</code> para confirmaciones as칤ncronas a trav칠s de la red, mientras que las confirmaciones locales son sincr칩nicas. </p><br><p>  Ahora, le diremos c칩mo configurar esto en un instante, pero imagine que configuramos <code>synchronous_commit</code> en <code>local</code> para el servidor.  Nos preguntamos si el par치metro <code>synchronous_commit</code> se puede cambiar sobre la marcha, y result칩 que no solo es posible, incluso hay dos formas de hacerlo.  El primero es configurar su sesi칩n de conexi칩n de la siguiente manera: </p><br><pre> <code class="plaintext hljs">SET SESSION synchronous_commit TO ON; // Your writes go here</code> </pre> <br><p>  Todos los registros posteriores en la sesi칩n confirmar치n las operaciones de escritura para las r칠plicas antes de devolver un resultado positivo al cliente conectado.  A menos que, por supuesto, cambie de nuevo la configuraci칩n <code>synchronous_commit</code> .  Puede omitir la parte <code>SESSION</code> del comando porque estar치 en el valor predeterminado. </p><br><p>  La segunda forma es buena cuando solo quiere asegurarse de obtener una replicaci칩n s칤ncrona para una sola transacci칩n.  En muchas bases de datos NoSQL, el concepto de transacciones no existe, pero existe en PostgreSQL.  En este caso, usted inicia la transacci칩n y luego establece <code>synchronous_commit</code> en <code>on</code> antes de escribir en la transacci칩n.  <code>COMMIT</code> la transacci칩n utilizando cualquier valor del par치metro <code>synchronous_commit</code> que se estableci칩 en ese momento, aunque es mejor establecer la variable de antemano para asegurarse de que otros desarrolladores entiendan que los registros no son as칤ncronos. </p><br><pre> <code class="plaintext hljs">BEGIN; SET LOCAL synchronous_commit TO ON; // Your writes go here COMMIT;</code> </pre> <br><p>  Todas las confirmaciones de transacciones ahora se confirmar치n como escritas en las r칠plicas antes de que la base de datos devuelva una respuesta positiva al cliente conectado. </p><br><h2 id="nastroyka-postgresql">  Configuraci칩n de PostgreSQL </h2><br><p>  Antes de eso, imaginamos un sistema PostgreSQL con <code>synchronous_commit</code> establecido en <code>local</code> .  Para que esto sea real en el lado del servidor, deber치 establecer dos par치metros de configuraci칩n del servidor.  Otro par치metro <code>synchronous_standby_names</code> se har치 cargo cuando <code>synchronous_commit</code> est치 <code>synchronous_commit</code> .  Determina qu칠 r칠plicas son elegibles para confirmaciones s칤ncronas, y lo configuraremos en <code>*</code> , lo que significar치 que todas las r칠plicas est치n habilitadas.  Estos valores generalmente se configuran en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo de configuraci칩n</a> agregando: </p><br><pre> <code class="plaintext hljs">synchronous_commit = local synchronous_standby_names='*'</code> </pre> <br><p>  Al establecer el par치metro <code>synchronous_commit</code> en <code>local</code> , creamos un sistema en el que las unidades locales permanecen sincr칩nicas, pero las confirmaciones de r칠plica de red son as칤ncronas de manera predeterminada.  A menos, por supuesto, que decidamos hacer estas confirmaciones sincr칩nicas, como se muestra arriba. </p><br><p>  Si sigui칩 el desarrollo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">del proyecto Governor</a> , es posible que haya notado algunos cambios recientes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2</a> ), que permitieron a los usuarios de Governor probar estos par치metros y controlar su coherencia. </p><br><h2 id="esche-para-slov">  Unas pocas palabras m치s ... </h2><br><p>  Hace apenas una semana, les dir칤a que no es posible ajustar PostgreSQL tan finamente.  Fue entonces cuando Kurt, un miembro del equipo de la plataforma Compose, insisti칩 en que exist칤a esa oportunidad.  Pacific칩 mis objeciones y encontr칩 lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siguiente</a> en la documentaci칩n de PostgreSQL: </p><br><p><img src="https://habrastorage.org/webt/yu/-p/qn/yu-pqnp2g5_ipnofxejmnmkc_uq.png"></p><br><p>  <em>Este par치metro se puede cambiar en cualquier momento.</em>  <em>El comportamiento de cualquier transacci칩n est치 determinado por la configuraci칩n vigente al confirmar.</em>  <em>Por lo tanto, es posible y 칰til que las confirmaciones se confirmen sincr칩nicamente para algunas transacciones y asincr칩nicamente para otras.</em>  <em>Por ejemplo, para forzar que una sola transacci칩n de <code>multistatement</code> declaraciones se confirme de forma as칤ncrona cuando el valor predeterminado del par치metro es el opuesto, establezca</em> <code>SET LOCAL synchronous_commit TO OFF</code> <em>en la transacci칩n.</em> </p><br><p>  Con esta peque침a modificaci칩n en el archivo de configuraci칩n, les dimos a los usuarios la capacidad de controlar su consistencia y rendimiento. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472364/">https://habr.com/ru/post/472364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472354/index.html">Entre la silla y el monitor se encuentra la principal vulnerabilidad en el sistema: VAP-person</a></li>
<li><a href="../472356/index.html">Microsoft vs IBM: cambios importantes en el soporte de Java</a></li>
<li><a href="../472358/index.html">30 de octubre a las 17:00 seminario web "Implemente el cl칰ster de Kubernetes en una hora en la nube CROC"</a></li>
<li><a href="../472360/index.html">Escaneando el c칩digo de Orchard CMS en busca de errores</a></li>
<li><a href="../472362/index.html">Buscamos y analizamos errores en el c칩digo Orchard CMS</a></li>
<li><a href="../472366/index.html">Nuevo algoritmo de Path Finder en Factorio</a></li>
<li><a href="../472368/index.html">Speech fishing: analizamos los m칠todos de ataque y los m칠todos de protecci칩n contra ellos.</a></li>
<li><a href="../472372/index.html">Automatizaci칩n de Android Gu칤a s칰per f치cil para crear tu primera prueba de Espresso</a></li>
<li><a href="../472374/index.html">쯇or qu칠 mudamos servidores a Islandia?</a></li>
<li><a href="../472378/index.html">Fiabilidad de flash: esperada e inesperada. Parte 2. XIV conferencia de la asociaci칩n USENIX. Tecnolog칤as de almacenamiento de archivos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>