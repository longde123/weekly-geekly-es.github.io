<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游놊游 游녿游낕 游낶 Sinopsis del informe "Monolito para cientos de versiones de clientes" (HL2018, Badoo, Vladimir Yants) 游뱝游 游녧游낖 游댏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuando una serie de res칰menes con HL2018. Los muchachos de Badoo (Vladimir Yants vyants y Nikolay Krapivny) me ayudaron a revisar este resumen, p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sinopsis del informe "Monolito para cientos de versiones de clientes" (HL2018, Badoo, Vladimir Yants)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429776/">  Continuando una serie de res칰menes con HL2018.  Los muchachos de Badoo (Vladimir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Yants vyants</a> y Nikolay Krapivny) me ayudaron a revisar este resumen, por lo que les agradezco mucho.  Espero que esto tenga un efecto positivo en la calidad del mensaje del informe. <br><br><img src="https://habrastorage.org/webt/8w/zh/nr/8wzhnrc5cvcugbedz9xrxkx8jm8.jpeg" alt="imagen"><br><a name="habracut"></a><br><h3>  Caracter칤sticas del proceso de desarrollo: </h3><br>  La responsabilidad del desarrollador no termina con el lanzamiento del backend.  Es responsable antes de la implementaci칩n en plataformas. <br><br><img src="https://habrastorage.org/webt/je/gx/03/jegx038nczykw6kld4fu1ynaalq.jpeg" alt="imagen"><br><br>  Hay pruebas manuales, pero el cliente no est치 listo en el momento del lanzamiento y se libera con un retraso (impredecible).  A menudo no sabemos cu치ndo los clientes comenzar치n a implementarlo.  Algunas veces (no con frecuencia) las caracter칤sticas comienzan a hacerse despu칠s de un largo tiempo.  Por lo tanto, probar con las manos es dif칤cil y no todo es posible.  Por lo tanto, se necesitan pruebas autom치ticas. <br><br><h2>  Pruebas </h2><br><h3>  Pruebas unitarias </h3><br>  Escrito en phpunit. <br><br>  Prueba una peque침a unidad.  No van a la base de datos ni a los servicios (no deben interactuar con nada). <br><br>  Legacy todav칤a tiene y complica el proceso de prueba. <br><br>  Desarrollaron la biblioteca softMocks: engancha todo incluir / requerir y lo reemplaza con el modificado. <br><br>  Puede liquidar cualquier m칠todo: est치tico, privado, final. <br>  La biblioteca est치 disponible en c칩digo abierto. <br><br>  Problema: las softmocks se relajan y le permiten escribir c칩digo no probado (y cubrirlo con pruebas). <br><br>  Acept칩 las reglas: <br><br><ul><li>  El nuevo c칩digo deber칤a ser f치cil de probar phpunit </li><li>  SoftMocks - caso extremo (c칩digo antiguo / largo / costoso / complicado) </li></ul><br>  Observamos la revisi칩n del c칩digo para estas reglas. <br><br><h2>  Prueba de calidad </h2><br><h3>  Prueba de mutaci칩n </h3><br><ul><li>  Toma el c칩digo </li><li>  Tomar cobertura de c칩digo </li><li>  Analizamos el c칩digo y aplicamos mutaciones (cambio + =&gt; -; verdadero =&gt; falso, etc.) </li><li>  Para cada mutaci칩n, ejecutamos un conjunto (conjunto) de pruebas. </li><li>  Si las pruebas fallan, entonces aprox.  Si no, no son lo suficientemente efectivos.  Entendemos, cambiar / agregar pruebas. </li></ul><br>  Existen soluciones listas para usar (Humbug, Infecci칩n), pero no encajan (no son compatibles con las softmocks, existen dificultades con la cobertura del c칩digo).  Por lo tanto, escribieron los suyos. <br><br>  La prueba de mutaci칩n a칰n no est치 disponible para la prueba manual.  Disponible para ejecutarse manualmente, desde la consola.  Ahora lo estamos implementando en la tuber칤a de CI, estamos construyendo el proceso.  El resultado estar치 en Habr. <br><br><h3>  Pruebas de integraci칩n </h3><br>  Probar el funcionamiento de varios componentes en conjunto;  Verificamos el trabajo con la base y / o servicios. <br><br>  Enfoque est치ndar para pruebas de bases de datos (DBUnit): <br><br><ol><li>  Levantar la base de datos de prueba </li><li>  Llenarlo </li><li>  Ejecute la prueba </li><li>  Limpiamos la base de datos </li></ol><br>  Los problemas: <br><br><ul><li>  Es necesario admitir tablas de datos y conjuntos de datos (relevancia de los contenidos de la base de datos) </li><li>  Lleva tiempo preparar la base de datos </li><li>  Los lanzamientos paralelos hacen que las pruebas sean inestables y provoquen puntos muertos </li></ul><br>  Soluci칩n: biblioteca DBMocks (soluci칩n propia) <br><br>  Principio de funcionamiento: <br><br><ul><li>  M칠todos de controlador de base de datos interceptados utilizando SoftMocks en la prueba de configuraci칩n </li><li>  De la solicitud parsim db + table </li><li>  Tmpfs crea tablas temporales con el mismo esquema </li><li>  Todas las consultas van solo a tablas temporales </li><li>  En TearDown, se eliminan. </li></ul><br>  La biblioteca es peque침a, pero a칰n no est치 abierta en c칩digo abierto. <br><br>  Resultados: <br><br><ul><li>  Las pruebas no pueden da침ar los datos en las tablas originales </li><li>  Las pruebas est치n aisladas unas de otras (se pueden ejecutar en paralelo) </li><li>  Prueba de compatibilidad de consultas con la versi칩n MySQL </li></ul><br><h3>  Pruebas de API </h3><br><ul><li>  Imita una sesi칩n de cliente </li><li>  Capaz de enviar solicitudes de backend </li><li>  El backend responde casi como un cliente real </li></ul><br>  T칤picamente, tales pruebas requieren un usuario autorizado.  Debe crearse antes de la prueba y eliminarse despu칠s.  Esto introduce riesgos adicionales (replicaci칩n, tareas en segundo plano). <br><br>  Soluci칩n: Creamos un grupo de usuarios de prueba.  Aprend칤 a limpiarlos. <br><br><img src="https://habrastorage.org/webt/yh/ny/jk/yhnyjk6mfogisbdjyro_g-egtwm.jpeg" alt="imagen"><br><br>  Los usuarios de prueba est치n en el mismo entorno que los reales, porque devel! = Prod.  Es necesario aislar a los usuarios de prueba y en vivo. <br><br>  Para el aislamiento, se agreg칩 el indicador is_test_user para el usuario.  Y estos usuarios tambi칠n est치n excluidos del an치lisis y los resultados de las pruebas a / b. <br><br>  Puede hacerse m치s barato enviando usuarios de prueba "a la Ant치rtida", donde nadie los ver치 (excepto los ping칲inos). <br><br><h3>  API de control de calidad </h3><br>  Una herramienta para preparar el entorno en pruebas de API, de hecho, una puerta trasera en el servidor para cambiar r치pidamente la configuraci칩n del usuario / entorno. <br><br><ul><li>  M칠todos de API bien documentados </li><li>  Administre datos de forma r치pida y sencilla. </li><li>  Los desarrolladores escriben backend </li><li>  Solo se puede aplicar a usuarios de prueba. </li></ul><br>  Permite al usuario cambiar datos inmutables (por ejemplo, fecha de registro). <br><br>  Protecci칩n requerida: <br><br><ul><li>  A nivel de red (disponible solo desde la red de la oficina) </li><li>  Se pasa un secreto con cada solicitud, cuya validez se verifica </li><li>  Los m칠todos solo funcionan con usuarios de prueba. </li></ul><br>  Hay un programa BugsBounty en HackerOne.  Pagan por las vulnerabilidades encontradas.  Uno no puede encontrarlo con la API de control de calidad. <br><br><h3>  Simulacros remotos </h3><br>  Moki para el backend remoto. <br><br>  Trabaja sobre la base de simulacros suaves.  La prueba le pide al backend que se inicialice para la sesi칩n simulada.  Al recibir la solicitud, el backend verifica la lista de mox para la sesi칩n y los aplica usando SoftMocks. <br><br>  Ejemplo de prueba: <br><br><img src="https://habrastorage.org/webt/gh/uk/7y/ghuk7yxvowxd5x3gqxald-3wrnm.jpeg" alt="imagen"><br><br>  Las pruebas de API son demasiado convenientes.  Es tentador escribirlos en lugar de Unit.  Pero las pruebas de API son mucho m치s lentas. <br><br>  Adopt칩 un conjunto de reglas: <br><br><ul><li>  El prop칩sito de las pruebas API es probar el protocolo y la integraci칩n. </li><li>  Comprobaci칩n v치lida de flujo complejo </li><li>  La variabilidad peque침a no se puede probar. </li><li>  En la revisi칩n de c칩digo, tambi칠n probamos las pruebas. </li></ul><br><h3>  Pruebas de Ui </h3><br>  El comando backend no escribe. <br><br>  La caracter칤stica est치 cubierta por las pruebas de Ui cuando se estabiliza. <br>  Usado por selenium para la web.  Para calabaza m칩vil. <br><br><h2>  Prueba de funcionamiento </h2><br>  100.000 pruebas unitarias.  6,000 integraci칩n, 14,000 pruebas de API. <br>  En 1 flujo, el tiempo es de 40 min / 90 min / 10 horas. <br><br>  Made TestCloud: una nube para ejecutar pruebas. <br><br><img src="https://habrastorage.org/webt/lh/bn/yx/lhbnyxws1gdtptpwew0rnwwk58i.jpeg" alt="imagen"><br><br>  La distribuci칩n de la prueba entre hilos: <br><br><ul><li>  Puede igualmente (mal, todas las pruebas son diferentes, resulta desigual en partes de tiempo) </li><li>  Ejecute m칰ltiples subprocesos y alimente las pruebas de phpunit de una en una (sobrecarga de inicializaci칩n. 춰Largo!) </li></ul><br>  Soluci칩n: <br><br><ul><li>  Recopilaci칩n de estad칤sticas sobre el tiempo de ejecuci칩n. </li><li>  Dise침o de pruebas para que el fragmento no se ejecute m치s de 30 segundos </li></ul><br>  El problema con las pruebas de API es mucho tiempo, muchos recursos y no permiten que otros se ejecuten. <br><br>  Para resolverlo, dividimos la nube en 2 partes: <br><br><ol><li>  Ejecuta solo pruebas r치pidas. </li><li>  Ejecuta ambos tipos de pruebas. </li></ol><br>  El resultado es una aceleraci칩n del tiempo para: <br><br><ul><li>  Unidad - 1 min </li><li>  Integraci칩n - 5 min </li><li>  API - 15 minutos. </li></ul><br><h2>  Ejecuci칩n de cobertura de c칩digo </h2><br>  쯈u칠 pruebas realizar?  Mostrar치 la cobertura del c칩digo. <br><br><ol><li>  Obtenemos rama diff </li><li>  Crea una lista de archivos modificados </li><li>  Obtenga una lista de pruebas para estos archivos. </li><li>  ejecutamos la suite solo desde estas pruebas. </li></ol><br>  La cobertura se forma una vez al d칤a, por la noche, para la rama maestra.  Los resultados (diff) se agregan a la base de datos. <br><br>  Pros: <br><br><ul><li>  Realizamos menos pruebas: menos carga de hardware y comentarios de prueba m치s r치pidos </li><li>  Puede ejecutar pruebas para parches.  Esto le permite implementar r치pidamente la revisi칩n.  En parches, la velocidad es lo m치s importante. </li></ul><br>  Contras: <br><br><ul><li>  Lanzamiento de backend 2 veces al d칤a.  Despu칠s del almuerzo, la cobertura es menos relevante (pero al desplegar un ritmo, siempre manejamos una suite completa). </li><li>  Las pruebas de api generan una amplia cobertura.  Para ellos, este enfoque no proporciona muchos ahorros. </li></ul><br>  Si el desarrollador necesita ver de inmediato la cobertura del c칩digo, es decir, una herramienta que se puede iniciar en la consola e inmediatamente obtener una nueva m칠trica para la cobertura de un archivo / componente en particular. <br>  Se considera complicado: se toman los datos del maestro de cobertura, se agregan todas las pruebas modificadas, resulta un peque침o conjunto en el que ya se considera la cobertura. <br><br><h2>  Resumen </h2><br><ul><li>  Necesita todos los niveles de prueba </li><li>  Cantidad! = Calidad.  Hacer revisi칩n de c칩digo y pruebas de mutaci칩n </li><li>  A칤sle a los usuarios de prueba de los reales. </li><li>  Los backends en el backend simplifican y aceleran las pruebas de escritura </li><li>  Recopilar estad칤sticas sobre las pruebas. </li></ul><br><h2>  Referencias </h2><br><ul><li>  Diapositivas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bit.ly/yants-HL18</a> </li><li>  Nuestro protocolo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"C칩mo admitimos 100 versiones diferentes de clientes en Badoo" / Yaroslav Golub</a> </li><li>  SoftMocks: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"SoftMocks: nuestro kit de ejecuci칩n de reemplazo para PHP 7" / Yuri Nasretdinov</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/badoo/soft-mocks</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Badoo bugsbounty</a> </li><li>  Pruebas de IU: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Automatizaci칩n de pruebas m칩viles multiplataforma y entrega continua" / Sathish Gogineni</a> </li><li>  TestCloud: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Paralelizaci칩n 칩ptima de pruebas unitarias o 17000 pruebas en 4 minutos" / Ilya Kudinov</a> </li><li>  QAAPI: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una mirada a las pruebas desde el otro lado de las barricadas.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">/ Informe de Dmitry Marushchenko en LoveQA</a> </li><li>  Backend: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Badoo.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Todo sobre el backend de la aplicaci칩n m칩vil Badoo</a> / Nikolay Krapivny </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429776/">https://habr.com/ru/post/es429776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429766/index.html">.NET gur칰 Dino Esposito: "No seas un pasajero en un tren que va cuesta abajo"</a></li>
<li><a href="../es429768/index.html">"DNS sobre HTTPS" se emite en RFC 8484, pero no todos est치n contentos con 칠l</a></li>
<li><a href="../es429770/index.html">C칩mo la proliferaci칩n de dispositivos de Internet est치 cambiando los h치bitos de pago</a></li>
<li><a href="../es429772/index.html">Distribuir y conquistar: herramientas para crear y probar boletines</a></li>
<li><a href="../es429774/index.html">Crea tu propia paleta de colores</a></li>
<li><a href="../es429778/index.html">Concepto de interfaz de voz del sistema inform치tico para ayudar a las personas con impedimentos del habla</a></li>
<li><a href="../es429780/index.html">Modern C ++! = (La mayor칤a) Nuevo est치ndar</a></li>
<li><a href="../es429782/index.html">La historia de c칩mo aceleramos las pruebas 12 veces</a></li>
<li><a href="../es429786/index.html">Fast Sin y Cos en ASM integrado para Delphi</a></li>
<li><a href="../es429788/index.html">Otra raz칩n por la que los contenedores Docker se ralentizan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>