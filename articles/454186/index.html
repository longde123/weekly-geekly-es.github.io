<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üàöÔ∏è üë©üèæ‚Äçüé§ üó£Ô∏è Cree una tuber√≠a para el procesamiento de datos de transmisi√≥n. Parte 1 ‚ùî üë¶üèΩ ü•°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos Amigos, estamos compartiendo con ustedes una traducci√≥n de un art√≠culo preparado especialmente para estudiantes del curso de Ingeniero de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cree una tuber√≠a para el procesamiento de datos de transmisi√≥n. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/454186/">  Hola a todos  Amigos, estamos compartiendo con ustedes una traducci√≥n de un art√≠culo preparado especialmente para estudiantes del curso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ingeniero de Datos</a> .  Vamos! <br><br><img src="https://habrastorage.org/webt/fv/mo/wz/fvmowz46naiimojhlq03dhxm38w.png"><br><br><h2>  Apache Beam y DataFlow para canalizaciones en tiempo real </h2><br>  La publicaci√≥n de hoy se basa en una tarea en la que trabaj√© recientemente en el trabajo.  Estaba realmente feliz de implementarlo y describir el trabajo realizado en el formato de una publicaci√≥n de blog, porque me dio la oportunidad de trabajar en ingenier√≠a de datos, as√≠ como de hacer algo que ser√≠a muy √∫til para mi equipo.  No hace mucho tiempo, descubr√≠ que nuestros sistemas almacenan una cantidad bastante grande de registros de usuarios relacionados con uno de nuestros productos para trabajar con datos.  Result√≥ que nadie hab√≠a usado estos datos, por lo que inmediatamente me interes√© en lo que podr√≠amos descubrir si comenz√°ramos a analizarlos regularmente.  Sin embargo, hubo varios problemas en el camino.  El primer problema fue que los datos se almacenaron en muchos archivos de texto diferentes que no estaban disponibles para el an√°lisis instant√°neo.  El segundo problema era que estaban almacenados en un sistema cerrado, por lo que no pod√≠a usar ninguna de mis herramientas de an√°lisis de datos favoritas. <a name="habracut"></a><br><br>  Ten√≠a que decidir c√≥mo hacer que el acceso sea m√°s f√°cil para nosotros y agregar al menos algo de valor al incorporar esta fuente de datos en algunas de nuestras soluciones de interacci√≥n con el usuario.  Despu√©s de pensar por un tiempo, decid√≠ construir una tuber√≠a para transferir estos datos a la base de datos en la nube para que yo y el equipo pudi√©ramos acceder a ellos y comenzar a generar conclusiones.  Despu√©s de completar mi especializaci√≥n en Ingenier√≠a de Datos en Coursera hace alg√∫n tiempo, estaba ansioso por usar algunas de las herramientas del curso en el proyecto. <br><br>  As√≠ que poner datos en una base de datos en la nube parec√≠a una forma inteligente de resolver mi primer problema, pero ¬øqu√© podr√≠a hacer con el problema n√∫mero 2?  Afortunadamente, hab√≠a una manera de transferir estos datos a un entorno donde pod√≠a acceder a herramientas como Python y Google Cloud Platform (GCP).  Sin embargo, fue un proceso largo, por lo que necesitaba hacer algo que me permitiera continuar el desarrollo mientras esperaba el final de la transferencia de datos.  La soluci√≥n que se me ocurri√≥ fue crear datos falsos utilizando la biblioteca <b>Faker</b> en Python.  Nunca antes hab√≠a usado esta biblioteca, pero r√°pidamente me di cuenta de lo √∫til que era.  El uso de este enfoque me permiti√≥ comenzar a escribir c√≥digo y probar la tuber√≠a sin datos reales. <br><br>  Con base en lo anterior, en esta publicaci√≥n le contar√© c√≥mo constru√≠ la tuber√≠a descrita anteriormente utilizando algunas de las tecnolog√≠as disponibles en GCP.  En particular, <b>usar√© Apache Beam (versi√≥n para Python), Dataflow, Pub / Sub y Big Query</b> para recopilar registros de usuarios, convertir datos y transferirlos a una base de datos para su posterior an√°lisis.  En mi caso, solo necesitaba la funcionalidad por lotes de Beam, ya que mis datos no llegaron en tiempo real, por lo que no se requiri√≥ Pub / Sub.  Sin embargo, me centrar√© en la versi√≥n de transmisi√≥n, ya que esto es lo que puede encontrar en la pr√°ctica. <br><br><h2>  Introducci√≥n a GCP y Apache Beam </h2><br>  Google Cloud Platform proporciona un conjunto de herramientas realmente √∫tiles para procesar big data.  Estas son algunas de las herramientas que usar√©: <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pub / Sub</a> es un servicio de mensajer√≠a que utiliza la plantilla Publisher-Subscriber que nos permite recibir datos en tiempo real. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DataFlow</a> es un servicio que simplifica la creaci√≥n de canalizaciones de datos y resuelve autom√°ticamente tareas como escalar la infraestructura, lo que significa que solo podemos centrarnos en escribir c√≥digo para nuestra canalizaci√≥n. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BigQuery</a> es un almac√©n de datos basado en la nube.  Si est√° familiarizado con otras bases de datos SQL, no tendr√° que lidiar con BigQuery por mucho tiempo. </li><li>  Y finalmente, usaremos Apache Beam, es decir, nos centraremos en la versi√≥n de Python para crear nuestra tuber√≠a.  Esta herramienta nos permitir√° crear una tuber√≠a para la transmisi√≥n o el procesamiento por lotes que se integra con GCP.  Es especialmente √∫til para el procesamiento en paralelo y es adecuado para tareas como extracci√≥n, transformaci√≥n y carga (ETL), por lo que si necesitamos mover datos de un lugar a otro con transformaciones o c√°lculos, Beam es una buena opci√≥n. </li></ul><br><br>  Hay una gran cantidad de herramientas disponibles en GCP, por lo que puede ser dif√≠cil abarcarlas todas, incluido su prop√≥sito, pero, sin embargo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ hay un</a> breve resumen de referencia. <br><br><h2>  Visualizaci√≥n de nuestro transportador. </h2><br>  Visualicemos los componentes de nuestra tuber√≠a en la <i>Figura 1</i> .  A un alto nivel, queremos recopilar datos de usuarios en tiempo real, procesarlos y transferirlos a BigQuery.  Los registros se crean cuando los usuarios interact√∫an con el producto enviando solicitudes al servidor, que luego se registran.  Estos datos pueden ser especialmente √∫tiles para comprender c√≥mo interact√∫an los usuarios con nuestro producto y si funcionan correctamente.  En general, el transportador contendr√° los siguientes pasos: <br><br><ol><li>  Los datos de registro de nuestros usuarios se publican en la secci√≥n Pub / Sub. </li><li>  Nos conectaremos a Pub / Sub y convertiremos los datos al formato apropiado usando Python y Beam (pasos 3 y 4 en la Figura 1). </li><li>  Despu√©s de convertir los datos, Beam se conectar√° a BigQuery y los agregar√° a nuestra tabla (pasos 4 y 5 en la Figura 1). </li><li>  Para el an√°lisis, podemos conectarnos a BigQuery usando varias herramientas como Tableau y Python. </li></ol><br>  Beam hace que este proceso sea muy simple, independientemente de si tenemos una fuente de transmisi√≥n de datos o un archivo CSV, y si queremos hacer un procesamiento por lotes.  M√°s adelante ver√° que el c√≥digo contiene solo los cambios m√≠nimos necesarios para cambiar entre ellos.  Este es uno de los beneficios de usar Beam. <br><br><img src="https://habrastorage.org/webt/2s/nv/kc/2snvkcz6-jwybsxr2kyz3awipaw.png"><br>  <i>Figura 1: La tuber√≠a de datos principal</i> <br><br><h2>  Crear pseudodatos utilizando Faker </h2><br>  Como mencion√© anteriormente, debido al acceso limitado a los datos, decid√≠ crear pseudodatos en el mismo formato que los reales.  Este fue un ejercicio realmente √∫til, ya que pod√≠a escribir c√≥digo y probar la tuber√≠a mientras esperaba datos.  Sugiero que eche un vistazo a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n de</a> Faker si desea saber qu√© m√°s tiene para ofrecer esta biblioteca.  Nuestros datos de usuario generalmente ser√°n similares al ejemplo a continuaci√≥n.  En base a este formato, podemos generar datos l√≠nea por l√≠nea para simular datos en tiempo real.  Estos registros nos brindan informaci√≥n como la fecha, el tipo de solicitud, la respuesta del servidor, la direcci√≥n IP, etc. <br><br> <code>192.52.197.161 - - [30/Apr/2019:21:11:42] "PUT /tag/category/tag HTTP/1.1" [401] 155 "https://harris-lopez.com/categories/about/" "Mozilla/5.0 (Macintosh; PPC Mac OS X 10_11_2) AppleWebKit/5312 (KHTML, like Gecko) Chrome/34.0.855.0 Safari/5312"</code> <br> <br>  Con base en la l√≠nea anterior, queremos crear nuestra variable <b>LINE</b> usando 7 variables entre llaves a continuaci√≥n.  Tambi√©n los usaremos como nombres de variables en nuestro esquema de tabla un poco m√°s tarde. <br><br> <code>LINE = """\ <br> {remote_addr} - - [{time_local}] "{request_type} {request_path} HTTP/1.1" [{status}] {body_bytes_sent} "{http_referer}" "{http_user_agent}"\ <br> """</code> <br> <br>  Si realiz√°ramos el procesamiento por lotes, el c√≥digo ser√≠a muy similar, aunque necesitar√≠amos crear un conjunto de muestras en un cierto rango de tiempo.  Para usar un falsificador, simplemente creamos un objeto y llamamos a los m√©todos que necesitamos.  En particular, Faker fue √∫til para crear direcciones IP y sitios web.  Us√© los siguientes m√©todos: <br><br> <code>fake.ipv4() <br> fake.uri_path() <br> fake.uri() <br> fake.user_agent() <br></code> <br><br><pre> <code class="php hljs">from faker import Faker import time import random import os import numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np from datetime import datetime, timedelta LINE = <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"\ {remote_addr} - - [{time_local}] "</span></span>{request_type} {request_path} HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-string"><span class="hljs-string">" [{status}] {body_bytes_sent} "</span></span>{http_referer}<span class="hljs-string"><span class="hljs-string">" "</span></span>{http_user_agent}<span class="hljs-string"><span class="hljs-string">"\ "</span></span><span class="hljs-string"><span class="hljs-string">""</span></span> def generate_log_line(): fake = Faker() now = datetime.now() remote_addr = fake.ipv4() time_local = now.strftime(<span class="hljs-string"><span class="hljs-string">'%d/%b/%Y:%H:%M:%S'</span></span>) request_type = random.choice([<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-string"><span class="hljs-string">"PUT"</span></span>]) request_path = <span class="hljs-string"><span class="hljs-string">"/"</span></span> + fake.uri_path() status = np.random.choice([<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">401</span></span>, <span class="hljs-number"><span class="hljs-number">404</span></span>], p = [<span class="hljs-number"><span class="hljs-number">0.9</span></span>, <span class="hljs-number"><span class="hljs-number">0.05</span></span>, <span class="hljs-number"><span class="hljs-number">0.05</span></span>]) body_bytes_sent = random.choice(range(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) http_referer = fake.uri() http_user_agent = fake.user_agent() log_line = LINE.format( remote_addr=remote_addr, time_local=time_local, request_type=request_type, request_path=request_path, status=status, body_bytes_sent=body_bytes_sent, http_referer=http_referer, http_user_agent=http_user_agent ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> log_line</code> </pre> <br><br>  El final de la primera parte. <br><br>  En los pr√≥ximos d√≠as, compartiremos con ustedes la continuaci√≥n del art√≠culo, pero ahora estamos tradicionalmente esperando comentarios ;-). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Segunda parte</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454186/">https://habr.com/ru/post/454186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454176/index.html">Uibook: una herramienta de prueba visual para reaccionar componentes con consultas de medios</a></li>
<li><a href="../454178/index.html">Un ejemplo de c√°lculo de la pensi√≥n de un empleado de TI de Mosc√∫</a></li>
<li><a href="../454180/index.html">Schr√∂dinger Cloud Backup</a></li>
<li><a href="../454182/index.html">Una entrevista completa con el Decano del Departamento de Python en GeekBrains: c√≥mo y por qu√© los principiantes aprenden el idioma</a></li>
<li><a href="../454184/index.html">KubeCon Europe 2019: c√≥mo visitamos por primera vez el evento principal de Kubernetes</a></li>
<li><a href="../454188/index.html">Canales alternativos de reclutamiento</a></li>
<li><a href="../454190/index.html">Lo que no necesita hacer si le roban su tel√©fono</a></li>
<li><a href="../454196/index.html">Impresi√≥n 3D de electr√≥nica utilizando un ejemplo de dron: ya no se necesitan cables ni tableros</a></li>
<li><a href="../454198/index.html">Creaci√≥n de un proyecto angular de varios m√≥dulos Gradle SpringBoot + en IDEA</a></li>
<li><a href="../454204/index.html">El rastreo conductual no es una panacea?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>