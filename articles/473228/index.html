<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüíº üôèüèΩ üîõ Poniendo a Perl directamente desde 1987 üë®‚Äçüåæ üçë üöè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despu√©s de leer la noticia " C√≥digo de int√©rprete de Perl portado oficialmente a GitHub " en LINUX.ORG.RU, decid√≠ echar un vistazo al repositorio de P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Poniendo a Perl directamente desde 1987</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473228/"> Despu√©s de leer la noticia " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="C√≥digo de int√©rprete de Perl portado oficialmente a GitHub, noticias sobre el recurso LINUX.ORG.RU">C√≥digo de int√©rprete de Perl portado oficialmente a GitHub</a> " en LINUX.ORG.RU, decid√≠ echar un vistazo al repositorio de Perl 5, que ahora ya est√° en GitHub. <br><br>  Es sorprendente cu√°n tremendamente y cualitativamente lo transfirieron, preservando no solo absolutamente toda la historia de 32 a√±os del proyecto, sino tambi√©n informes de errores (se metieron en problemas), parches (se metieron en relaciones p√∫blicas), lanzamientos y sucursales.  La inscripci√≥n "hace <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Hace 32 a√±os en archivos fuente de Perl, repositorio oficial de Perl 5 GitHub.">32 a√±os</a> " al lado de los archivos provoca una sonrisa involuntaria. <br><br>  ¬øQu√© m√°s hacer en este aburrido viernes por la noche, cuando la lluvia y la nieve est√°n lloviznando desagradablemente en la calle, y todos los caminos de la calle est√°n sumidos en el aguanieve del oto√±o?  As√≠ es, ojos rojos!  Entonces, en aras de la experimentaci√≥n y el inter√©s, decid√≠ tomar y ensamblar el antiguo Perl en una m√°quina moderna x86_64 con la √∫ltima versi√≥n de <strong>GCC 9.2.0</strong> como compilador.  ¬øPuede un c√≥digo tan antiguo pasar la prueba del tiempo? <br><br><div style="text-align:center;"><img title="Demostraci√≥n de twm, uno de los primeros gestores de ventanas para el sistema X Window, en una distribuci√≥n moderna de Arch Linux." src="https://habrastorage.org/webt/-0/d5/wt/-0d5wtkg6ylqdd-h5g1hbtdiypi.png"></div><br>  <i>Demostraci√≥n de <strong>twm</strong> , uno de los primeros gestores de ventanas para el sistema X Window, en una distribuci√≥n moderna de Arch Linux.</i> <br><br>  Para ser completamente aut√©ntico y nekromantnenko, implement√© una m√°quina virtual con X desnudo y administrador de ventanas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="twm, p√°gina de Wikipedia.">twm</a> , que tambi√©n proviene de 1987.  Qui√©n sabe, tal vez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Larry Wall, p√°gina de Wikipedia.">Larry Wall</a> escribi√≥ su Perl usando exactamente <strong>twm</strong> , por as√≠ decirlo <em>, tecnolog√≠a punta de</em> la √©poca.  La distribuci√≥n utilizada es Arch Linux.  Solo porque hay algunas cosas √∫tiles en su repositorio que fueron √∫tiles m√°s adelante.  ¬°Entonces vamos! <br><a name="habracut"></a><br><a name="article-content"></a><h2>  Contenido: </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1. Preparaci√≥n del medio ambiente.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2. Configurando el c√≥digo fuente</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3. Errores de archivo de gram√°tica Yacc</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4. Errores de compilaci√≥n de c√≥digo en "C"</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">5. Correcci√≥n de algunos errores Fallo de segmentaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">6. Para resumir</a> <br><br><a name="environment"></a><h2>  1. Preparaci√≥n del medio ambiente. </h2><br>  Primero, instalamos en un sistema operativo desplegado en una m√°quina virtual todo el conjunto caballeroso de utilidades y compiladores necesarios para ensamblar y editar el c√≥digo fuente: <strong>gcc</strong> , <strong>make</strong> , <strong>vim</strong> , <strong>git</strong> , <strong>gdb</strong> , etc. Algunos de ellos ya est√°n instalados, mientras que otros est√°n disponibles en el metapaquete <strong>base-devel</strong> , debe instalarse si no est√° instalado.  Una vez que el entorno est√° listo para la acci√≥n, ¬°obtenemos una copia del c√≥digo fuente de Perl de 32 a√±os! <br><br><pre><code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/Perl/perl5/ --depth=1 -b perl-1.0</code> </pre> <br>  Gracias a las caracter√≠sticas de Git, no necesitamos arrastrar un mont√≥n de archivos para llegar a la primera versi√≥n del proyecto: <br><br><pre> <code class="plaintext hljs">* commit 8d063cd8450e59ea1c611a2f4f5a21059a2804f1 (grafted, HEAD, tag: perl-1.0) Commit: Larry Wall &lt;lwall@jpl-devvax.jpl.nasa.gov&gt; CommitDate: Fri Dec 18 00:00:00 1987 +0000 a "replacement" for awk and sed</code> </pre><br>  Solo descargamos una peque√±a cantidad de datos y, como resultado, el repositorio con el c√≥digo fuente de la primera versi√≥n de Perl toma solo 150 KB. <br><br>  En ese tiempo oscuro y denso no exist√≠an elementos tan elementales como los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="GNU Autotools, p√°gina de Wikipedia.">autotools</a> (¬° <em>qu√© bendici√≥n!</em> ). Sin embargo, hay un script <strong>Configure</strong> en la ra√≠z del repositorio.  Cual es el problema  Pero el hecho es que Larry Wall es el inventor de dichos scripts que permitieron generar Makefiles para las m√°quinas UNIX m√°s abigarradas de la √©poca.  Como dice el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Configurar script, Historia, p√°gina de Wikipedia.">art√≠culo de</a> Wikipedia sobre los guiones del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Configurar script, Historia, p√°gina de Wikipedia.">mismo nombre</a> , Larry Wall suministr√≥ el archivo de <strong>configuraci√≥n</strong> con algunos de sus programas, por ejemplo, un lector de noticias, tres a√±os m√°s antes de escribir Perl.  Posteriormente, Perl no fue la excepci√≥n, y se utiliz√≥ un script que ya se ejecutaba en muchas m√°quinas para construirlo.  M√°s tarde, otros desarrolladores, por ejemplo, programadores de Trolltech, tambi√©n recogieron esta idea.  Utilizaron un script similar para configurar la compilaci√≥n de su marco Qt, que muchas personas confunden con la <strong>configuraci√≥n</strong> de las <strong>herramientas autom√°ticas</strong> .  Fue el zool√≥gico de tales scripts de diferentes desarrolladores que sirvi√≥ como √≠mpetu para crear herramientas para su generaci√≥n simplificada y autom√°tica. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>&lt;&lt; Saltar al contenido</em></a> <br><br><a name="configure"></a><h2>  2. Configurando el c√≥digo fuente </h2><br>  El script de <strong>configuraci√≥n</strong> de la "vieja escuela", que ya es evidente por su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Shebang, Unix, p√°gina de Wikipedia.">Shebang</a> ', que tiene un espacio: <br><br><pre> <code class="bash hljs">$ cat Configure | head -5 <span class="hljs-comment"><span class="hljs-comment">#! /bin/sh # # If these # comments don't work, trim them. Don't worry about any other # shell scripts, Configure will trim # comments from them for you. #</span></span></code> </pre><br>  ¬°Seg√∫n el comentario, resulta que hab√≠a guiones en los guiones de los cuales no era posible dejar comentarios!  La situaci√≥n espacial parece inusual, pero una vez que esto era la norma, vea el enlace para obtener m√°s informaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="¬øSe permite espacio entre #! y / bin / bash en shebang? - Unix y Linux Stack Exchange.">aqu√≠</a> .  Lo m√°s importante, no hay diferencia para los int√©rpretes de shell modernos si hay un espacio o no. <br><br>  Basta de letras, ¬°vamos al grano!  Comenzamos el script y vemos una suposici√≥n interesante, que resulta no ser del todo cierto: <br><br><pre> <code class="plaintext hljs">$ ./Configure (I see you are using the Korn shell. Some ksh's blow up on Configure, especially on exotic machines. If yours does, try the Bourne shell instead.) Beginning of configuration questions for perl kit. Checking echo to see how to suppress newlines... ...using -n. Type carriage return to continue. Your cursor should be here--&gt;</code> </pre><br>  Sorprendentemente, el script es interactivo y contiene una gran cantidad de informaci√≥n de fondo variada.  El modelo de interacci√≥n del usuario se basa en di√°logos, analizando las respuestas a las cuales el script cambia sus par√°metros, de acuerdo con lo cual generar√° posteriormente Makefiles.  ¬øEstaba personalmente interesado en verificar si todos los comandos de shell est√°n en su lugar? <br><br><pre> <code class="plaintext hljs">Locating common programs... expr is in /bin/expr. sed is in /bin/sed. echo is in /bin/echo. cat is in /bin/cat. rm is in /bin/rm. mv is in /bin/mv. cp is in /bin/cp. tr is in /bin/tr. mkdir is in /bin/mkdir. sort is in /bin/sort. uniq is in /bin/uniq. grep is in /bin/grep. Don't worry if any of the following aren't found... test is in /bin/test. egrep is in /bin/egrep. I don't see Mcc out there, offhand.</code> </pre><br>  Aparentemente antes de esto estaba lejos del caso.  Me pregunto de qu√© es responsable la utilidad <strong>Mcc</strong> , que no se pudo encontrar.  Lo curioso es que este gui√≥n en las mejores tradiciones hacker de la √©poca est√° lleno de humor amistoso.  Ahora apenas ver√°s esto: <br><br><pre> <code class="plaintext hljs">Is your "test" built into sh? [n] (OK to guess) OK Checking compatibility between /bin/echo and builtin echo (if any)... They are compatible. In fact, they may be identical. Your C library is in /lib/libc.a. You're normal. Extracting names from /lib/libc.a for later perusal...done Hmm... Looks kind of like a USG system, but we'll see... Congratulations. You aren't running Eunice. It's not Xenix... Nor is it Venix... Checking your sh to see if it knows about # comments... Your sh handles # comments correctly. Okay, let's see if #! works on this system... It does. Checking out how to guarantee sh startup... Let's see if '#!/bin/sh' works... Yup, it does.</code> </pre><br>  Respond√≠ la mayor√≠a de las preguntas con el valor predeterminado o con lo que me ofreci√≥ el script.  Particularmente complacido y sorprendido fue la solicitud de banderas para el compilador y el enlazador: <br><br><pre> <code class="plaintext hljs">Any additional cc flags? [none] Any additional ld flags? [none]</code> </pre><br>  All√≠ puede escribir algo interesante, por ejemplo, <strong>-m32</strong> para construir un archivo ejecutable de 32 bits o una biblioteca, que se requiere durante el enlace.  A la √∫ltima pregunta del gui√≥n: <br><br><pre> <code class="plaintext hljs">Now you need to generate make dependencies by running "make depend". You might prefer to run it in background: "make depend &gt; makedepend.out &amp;" It can take a while, so you might not want to run it right now. Run make depend now? [n] y</code> </pre><br>  Le respond√≠ positivamente.  A juzgar por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="makedepend, Historia, p√°gina de Wikipedia.">su p√°gina de</a> Wikipedia, la antigua utilidad <strong>makedepend</strong> se cre√≥ al comienzo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Proyecto Atenea, p√°gina de Wikipedia.">la</a> vida del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Proyecto Atenea, p√°gina de Wikipedia.">proyecto Athena</a> para facilitar el trabajo con Makefiles.  Este proyecto nos dio el sistema X Window, Kerberos, Zephyr e influy√≥ en muchas otras cosas que hoy nos son familiares.  Todo esto es maravilloso, pero ¬øde d√≥nde viene esta utilidad en un entorno Linux moderno?  Durante mucho tiempo ha sido utilizado por nadie y en cualquier lugar.  Pero si observa de cerca la ra√≠z del repositorio, resulta que Larry Wall escribi√≥ su versi√≥n de script sustituto, que desempacamos cuidadosamente y ejecutamos el script de configuraci√≥n. <br><br>  <strong>Makedepend</strong> completado con algunos errores extra√±os: <br><br><pre> <code class="bash hljs">./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 82: unexpected EOF <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> looking <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> matching `<span class="hljs-string"><span class="hljs-string">''</span></span> ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 83: syntax error: unexpected end of file ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 82: unexpected EOF <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> looking <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> matching `<span class="hljs-string"><span class="hljs-string">''</span></span> ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 83: syntax error: unexpected end of file</code> </pre><br>  Quiz√°s fueron ellos quienes causaron el problema debido a que los Makefiles generados se masticaron un poco: <br><br><pre> <code class="bash hljs">$ make make: *** No rule to make target <span class="hljs-string"><span class="hljs-string">'&lt;built-in&gt;'</span></span>, needed by <span class="hljs-string"><span class="hljs-string">'arg.o'</span></span>. Stop.</code> </pre><br>  Definitivamente no quer√≠a entrar en la jungla de los intrincados fideos de concha de la utilidad <strong>makedepend</strong> y decid√≠ mirar cuidadosamente los Makefiles, en los que surgi√≥ un patr√≥n extra√±o: <br><br><pre> <code class="plaintext hljs">arg.o: arg.c arg.o: arg.h arg.o: array.h arg.o: &lt;built-in&gt; arg.o: cmd.h arg.o: &lt;command-line&gt; arg.o: config.h arg.o: EXTERN.h ... array.o: arg.h array.o: array.c array.o: array.h array.o: &lt;built-in&gt; array.o: cmd.h array.o: &lt;command-line&gt; array.o: config.h array.o: EXTERN.h ...</code> </pre><br>  Aparentemente, alguna utilidad insert√≥ incorrectamente sus argumentos en el escape.  Al recoger la utilidad del <s>hacha</s> <strong>sed,</strong> decid√≠ arreglar ligeramente esto: <br><br><pre> <code class="bash hljs">$ sed -i <span class="hljs-string"><span class="hljs-string">'/built-in/d'</span></span> Makefile $ sed -i <span class="hljs-string"><span class="hljs-string">'/command-line/d'</span></span> Makefile</code> </pre><br>  Sorprendentemente, el truco funcion√≥ y los Makefiles funcionaron como deber√≠an. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>&lt;&lt; Saltar al contenido</em></a> <br><br><a name="yacc"></a><h2>  3. Errores de archivo de gram√°tica Yacc </h2><br>  Ser√≠a incre√≠ble si el c√≥digo de 32 a√±os tomara y ensamblara sin ning√∫n problema.  Lamentablemente, los milagros no suceden.  Al estudiar el √°rbol de origen, me encontr√© con un archivo <strong>perl.y</strong> , que es una descripci√≥n gramatical de la utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="yacc, p√°gina de Wikipedia.">yacc</a> , que ha sido reemplazada por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="GNU Bison, p√°gina de Wikipedia.">bison</a> en las distribuciones modernas.  El script ubicado en la ruta <strong>/ usr / bin / yacc</strong> simplemente llama a <strong>bison</strong> en modo de compatibilidad con <strong>yacc</strong> .  Es solo que esta compatibilidad no est√° completa y cuando procesamos este archivo se est√° acumulando una gran cantidad de errores, que no s√© c√≥mo corregir y realmente no quiero, porque hay una soluci√≥n alternativa que aprend√≠ recientemente. <br><br>  Hace solo un a√±o o dos, Helio Chissini de Castro, desarrollador de KDE, realiz√≥ un trabajo similar y adapt√≥ KDE 1, 2 y Qt 1, 2 a entornos y compiladores modernos.  Me interes√© por su trabajo, descargu√© los c√≥digos fuente de los proyectos, pero durante el ensamblaje me encontr√© con una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Adaptaci√≥n moderna de Qt 2 por Helio Castro, Issues, repositorio de GitHub.">trampa</a> similar debido a la incompatibilidad de <strong>yacc</strong> y <strong>bison</strong> , que se utilizaron para construir la versi√≥n antigua del metacompilador <strong>moc</strong> .  Posteriormente, logr√© encontrar una soluci√≥n a este problema en forma de reemplazar <strong>bison</strong> con la utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Berkeley Yacc, p√°gina oficial.">byacc</a> (Berkeley Yacc), que result√≥ ser compatible con las viejas gram√°ticas para <strong>yacc</strong> y estaba disponible en muchas distribuciones de Linux. <br><br>  Un reemplazo simple de <strong>yacc</strong> con <strong>byacc</strong> en el sistema de compilaci√≥n me ayud√≥ entonces, aunque no por mucho tiempo, porque un poco m√°s tarde en las nuevas versiones de <strong>byacc</strong> todav√≠a rompieron la compatibilidad con <strong>yacc</strong> , interrumpiendo la depuraci√≥n asociada con la entidad <strong>yydebug</strong> .  Por lo tanto, tuve que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Se corrigi√≥ un error de referencia indefinido, solicitudes de extracci√≥n, adaptaci√≥n moderna de Qt 2 por Helio Castro, repositorio de GitHub.">corregir</a> ligeramente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Se corrigi√≥ un error de referencia indefinido, solicitudes de extracci√≥n, adaptaci√≥n moderna de Qt 2 por Helio Castro, repositorio de GitHub.">la gram√°tica de la</a> utilidad. <br><br>  Entonces, la estrategia para corregir errores de construcci√≥n en el archivo <strong>perl.y</strong> fue predicha por experiencia previa: instale la utilidad <strong>byacc</strong> , cambie <strong>yacc</strong> a <strong>byacc</strong> en todos los Makefiles, luego corte <strong>yydebug</strong> de todas partes.  Estas acciones resolvieron todos los problemas con este archivo, los errores desaparecieron y la compilaci√≥n continu√≥. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>&lt;&lt; Saltar al contenido</em></a> <br><br><a name="c-errors"></a><h2>  4. Errores de compilaci√≥n de c√≥digo en "C" </h2><br>  El antiguo c√≥digo de Perl estaba lleno de horrores, como la notaci√≥n obsoleta y olvidada de las definiciones de funciones del tipo K&amp;R: <br><br><pre> <code class="cpp hljs">format(orec,fcmd) <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">outrec</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orec</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> FCMD *fcmd; { ... } <span class="hljs-function"><span class="hljs-function">STR * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hfetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tb,key)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">register</span></span></span><span class="hljs-function"> HASH *tb</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *key; { ... } <span class="hljs-comment"><span class="hljs-comment">/*VARARGS1*/</span></span> fatal(pat,a1,a2,a3,a4) <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *pat; { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>,pat,a1,a2,a3,a4); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br>  Se encontraron caracter√≠sticas similares, por ejemplo, en el c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Entretenida arqueolog√≠a. O PVS-Studio verifica Microsoft Word 1.1a, Art√≠culo sobre el recurso Habr.">Microsoft Word 1.1a</a> , que tambi√©n es bastante antiguo.  El primer est√°ndar del lenguaje de programaci√≥n "C", llamado "C89", aparecer√° solo en dos a√±os.  Los compiladores modernos pueden trabajar con dicho c√≥digo, pero algunos IDE no facilitan el an√°lisis de dichas definiciones y las resaltan como errores de sintaxis, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Qt Creator IDE, p√°gina de Wikipedia.">Qt Creator</a> pec√≥ antes de analizar el c√≥digo en la biblioteca <strong>libclang</strong> . <br><br>  El compilador GCC 9.2.0, arrojando una gran cantidad de advertencias, se comprometi√≥ a compilar el c√≥digo antiguo de la primera versi√≥n de Perl.  Las hojas de las advertencias eran tan grandes que para llegar al error, tuvimos que desplazar varias p√°ginas del escape hacia arriba.  Para mi sorpresa, la mayor√≠a de los errores de compilaci√≥n fueron t√≠picos y se relacionaron principalmente con definiciones predefinidas, que desempe√±aron el papel de banderas para el ensamblaje. <br><br><div style="text-align:center;"><img title="El trabajo del moderno compilador GCC 9.2.0 y el depurador GDB 8.3.1 en el administrador de ventanas twm y el emulador de terminal xterm." src="https://habrastorage.org/getpro/habr/post_images/3a9/b3c/004/3a9b3c0041c48a06e6805bd39883c6a4.png"></div><br>  <i>El trabajo del moderno compilador GCC 9.2.0 y el depurador GDB 8.3.1 en el administrador de ventanas <strong>twm</strong> y el emulador de terminal <strong>xterm</strong> .</i> <br><br>  Bajo STDSTDIO <strong>,</strong> Larry Wall experiment√≥ con una biblioteca de lenguaje de programaci√≥n antigua y no est√°ndar "C", y bajo DEPURACI√ìN <strong>hubo</strong> informaci√≥n de depuraci√≥n con el notorio <strong>yydebug</strong> , que mencion√© anteriormente.  Por defecto, estas casillas de verificaci√≥n estaban habilitadas.  Al desactivarlos en el archivo <strong>perl.h</strong> y agregar algunas definiciones olvidadas, pude reducir significativamente la cantidad de errores. <br><br>  Otro tipo de error es anular las funciones ahora estandarizadas de la biblioteca est√°ndar y la capa POSIX.  El proyecto tiene su propio <strong>malloc ()</strong> , <strong>setenv ()</strong> y otras entidades que crearon conflictos. <br><br>  Un par de lugares definieron funciones est√°ticas sin declaraciones.  Con el tiempo, los compiladores comenzaron a adoptar un enfoque m√°s estricto para este problema y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="¬øC√≥mo resolver la declaraci√≥n est√°tica despu√©s de la declaraci√≥n no est√°tica en el c√≥digo GCC C? - Desbordamiento de pila.">convirtieron la advertencia en un error</a> .  Y finalmente, un par de encabezados olvidados, ¬øa d√≥nde ir√≠as sin ellos? <br><br>  Para mi sorpresa, el parche para el c√≥digo de 32 a√±os result√≥ ser tan peque√±o que puede citarse completamente aqu√≠: <br><br><pre> <code class="diff hljs">diff --git a/malloc.cb/malloc.c index 17c3b27..a1dfe9c 100644 --- a/malloc.c +++ b/malloc.c @@ -79,6 +79,9 @@ static u_int nmalloc[NBUCKETS]; #include &lt;stdio.h&gt; #endif +static findbucket(union overhead *freep, int srchlen); +static morecore(register bucket); + #ifdef debug #define ASSERT(p) if (!(p)) botch("p"); else static diff --git a/perl.hb/perl.h index 3ccff10..e98ded5 100644 --- a/perl.h +++ b/perl.h @@ -6,16 +6,16 @@ * */ -#define DEBUGGING -#define STDSTDIO /* eventually should be in config.h */ +//#define DEBUGGING +//#define STDSTDIO /* eventually should be in config.h */ #define VOIDUSED 1 #include "config.h" -#ifndef BCOPY -# define bcopy(s1,s2,l) memcpy(s2,s1,l); -# define bzero(s,l) memset(s,0,l); -#endif +//#ifndef BCOPY +//# define bcopy(s1,s2,l) memcpy(s2,s1,l); +//# define bzero(s,l) memset(s,0,l); +//#endif #include &lt;stdio.h&gt; #include &lt;ctype.h&gt; @@ -183,11 +183,11 @@ double atof(); long time(); struct tm *gmtime(), *localtime(); -#ifdef CHARSPRINTF - char *sprintf(); -#else - int sprintf(); -#endif +//#ifdef CHARSPRINTF +// char *sprintf(); +//#else +// int sprintf(); +//#endif #ifdef EUNICE #define UNLINK(f) while (unlink(f) &gt;= 0) diff --git a/perl.yb/perl.y index 16f8a9a..1ab769f 100644 --- a/perl.y +++ b/perl.y @@ -7,6 +7,7 @@ */ %{ +#include &lt;stdlib.h&gt; #include "handy.h" #include "EXTERN.h" #include "search.h" diff --git a/perly.cb/perly.c index bc32318..fe945eb 100644 --- a/perly.c +++ b/perly.c @@ -246,12 +246,14 @@ yylex() static bool firstline = TRUE; retry: +#ifdef DEBUGGING #ifdef YYDEBUG if (yydebug) if (index(s,'\n')) fprintf(stderr,"Tokener at %s",s); else fprintf(stderr,"Tokener at %s\n",s); +#endif #endif switch (*s) { default: diff --git a/stab.cb/stab.c index b9ef533..9757cfe 100644 --- a/stab.c +++ b/stab.c @@ -7,6 +7,7 @@ */ #include &lt;signal.h&gt; +#include &lt;errno.h&gt; #include "handy.h" #include "EXTERN.h" #include "search.h" diff --git a/util.hb/util.h index 4f92eeb..95cb9bf 100644 --- a/util.h +++ b/util.h @@ -28,7 +28,7 @@ void prexit(); char *get_a_line(); char *savestr(); int makedir(); -void setenv(); +//void setenv(); int envix(); void notincl(); char *getval();</code> </pre><br>  ¬°Gran resultado para el c√≥digo de 32 a√±os!  La <strong>referencia indefinida al</strong> error de enlace <strong>'crypt'</strong> se corrigi√≥ agregando la directiva <em>-lcrypt</em> al Makefile con la biblioteca <strong>libcrypt</strong> apropiada, despu√©s de lo cual finalmente obtuve el ejecutable del int√©rprete Perl deseado: <br><br><pre> <code class="bash hljs">$ file perl perl: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=fd952ceae424613568530b3a2ca88ebd6477e0ae, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GNU/Linux 3.2.0, not stripped</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>&lt;&lt; Saltar al contenido</em></a> <br><br><a name="segfaults"></a><h2>  5. Correcci√≥n de algunos errores Fallo de segmentaci√≥n </h2><br>  Despu√©s de una compilaci√≥n casi sin problemas, la suerte me dio la espalda.  Inmediatamente despu√©s de iniciar el int√©rprete de Perl ensamblado, obtuve algunos errores extra√±os y una falla de segmentaci√≥n al final: <br><br><pre> <code class="bash hljs">$ ./perl -e <span class="hljs-string"><span class="hljs-string">'print "Hello World!\n";'</span></span> Corrupt malloc ptr 0x2db36040 at 0x2db36000 Corrupt malloc ptr 0x2db36880 at 0x2db36800 Corrupt malloc ptr 0x2db36080 at 0x2db36040 Corrupt malloc ptr 0x2db37020 at 0x2db37000 Segmentation fault (core dumped)</code> </pre><br>  Habiendo ro√≠do el texto fuente de la frase <em>Corrupt malloc</em> , result√≥ que en lugar del sistema <strong>malloc ()</strong> se llam√≥ a alg√∫n tipo de asignador personalizado desde 1982.  Curiosamente, <strong>Berkeley est√°</strong> escrito en uno de los literales de cadena en su c√≥digo fuente, y <strong>Caltech</strong> en un comentario al lado.  La colaboraci√≥n entre estas universidades fue evidente entonces muy fuerte.  En general, coment√© este asignador de piratas inform√°ticos y reconstru√≠ el c√≥digo fuente.  Los errores de corrupci√≥n de memoria desaparecieron, pero el error de segmentaci√≥n permaneci√≥.  Entonces ese no era el punto, y ahora necesitamos descubrir el depurador. <br><br>  Al ejecutar el programa bajo <strong>gdb,</strong> descubr√≠ que el bloqueo ocurre cuando la funci√≥n para crear un archivo temporal <strong>mktemp ()</strong> desde libc se llama: <br><br><pre> <code class="plaintext hljs">$ gdb --args ./perl -e 'print "Hello, World!\n";' (gdb) r Starting program: /home/exl/perl5/perl -e print\ \"Hello\ World\!\\n\"\; Program received signal SIGSEGV, Segmentation fault. 0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6 (gdb) bt #0 0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6 #1 0x00007ffff7d71577 in mktemp () from /usr/lib/libc.so.6 #2 0x000055555556bb08 in main ()</code> </pre><br>  Por cierto, el vinculador jur√≥ previamente sobre esta funci√≥n.  No es un compilador, sino un enlazador, lo que me sorprendi√≥: <br><br><pre> <code class="plaintext hljs">/usr/bin/ld: perl.o: in function `main': perl.c:(.text+0x978c): warning: the use of `mktemp' is dangerous, better use `mkstemp' or `mkdtemp'</code> </pre><br>  El primer pensamiento que probablemente se te ocurri√≥ tambi√©n fue reemplazar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="La biblioteca GNU C, archivos temporales, documentaci√≥n oficial de GNU.">funci√≥n insegura</a> <strong>mktemp ()</strong> con <strong>mkstemp ()</strong> , lo cual hice.  La advertencia del enlazador desapareci√≥, pero la falla de segmentaci√≥n permaneci√≥ en este lugar de todos modos, solo que ahora estaba en la funci√≥n <strong>mkstemp ()</strong> . <br><br>  Por lo tanto, ahora debe mirar con mucho cuidado el fragmento de c√≥digo asociado con esta funci√≥n.  All√≠ descubr√≠ una cosa bastante extra√±a que se destaca en este fragmento: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *e_tmpname = <span class="hljs-string"><span class="hljs-string">"/tmp/perl-eXXXXXX"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ mktemp(e_tmpname); e_fp = f_open(e_tmpname, <span class="hljs-string"><span class="hljs-string">"w"</span></span>); ... }</code> </pre><br>  Resulta que <strong>mktemp () est√°</strong> tratando de cambiar el literal de la m√°scara, que se encuentra en la secci√≥n <strong>.rodata</strong> , que obviamente est√° condenada al fracaso.  ¬øO, despu√©s de todo, hace 32 a√±os, esto era aceptable, se cumpl√≠a en el c√≥digo e incluso funcionaba de alguna manera? <br><br>  Por supuesto, al reemplazar <strong>char * e_tmpname</strong> con <strong>char e_tmpname [] se</strong> solucion√≥ este error de segmentaci√≥n y pude obtener lo que mat√© durante toda la noche: <br><br><pre> <code class="bash hljs">$ ./perl -e <span class="hljs-string"><span class="hljs-string">'print "Hello World!\n";'</span></span> $ Hello, World! $ ./perl -e <span class="hljs-string"><span class="hljs-string">'$a = 5; $b = 6.3; $c = $a+$b; print $c."\n";'</span></span> $ 11.3000000000000007 $ ./perl -v <span class="hljs-variable"><span class="hljs-variable">$Header</span></span>: perly.c,v 1.0 87/12/18 15:53:31 root Exp $ Patch level: 0</code> </pre><br>  Verificamos la ejecuci√≥n desde la l√≠nea de comando, pero ¬øqu√© pasa con el archivo?  Descargu√© el primer "Hello World" para el lenguaje de programaci√≥n Perl de Internet: <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">################# test.pl #!/usr/bin/perl # # The traditional first program. # Strict and warnings are recommended. use strict; use warnings; # Print a message. print "Hello, World!\n";</span></span></code> </pre><br>  Luego trat√© de ejecutarlo, pero, por desgracia, la falla de segmentaci√≥n me estaba esperando nuevamente.  Esta vez en un lugar completamente diferente: <br><br><pre> <code class="plaintext hljs">$ gdb --args ./perl test.pl (gdb) r Starting program: /home/exl/perl5/perl test.pl Program received signal SIGSEGV, Segmentation fault. 0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6 (gdb) bt #0 0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6 #1 0x00005555555629ea in yyerror () #2 0x0000555555568dd6 in yyparse () #3 0x000055555556bd4f in main ()</code> </pre><br>  El siguiente punto interesante se encontr√≥ en la funci√≥n <strong>yyerror ()</strong> , cito el fragmento original: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// perl.y char *tokename[] = { "256", "word", "append", ... // perl.c yyerror(s) char *s; { char tmpbuf[128]; char *tname = tmpbuf; if (yychar &gt; 256) { tname = tokename[yychar-256]; // ??? if (strEQ(tname,"word")) strcpy(tname,tokenbuf); // Oops! else if (strEQ(tname,"register")) sprintf(tname,"$%s",tokenbuf); // Oops! ...</span></span></code> </pre><br>  Nuevamente, la situaci√≥n es similar a la que escrib√≠ anteriormente.  Los datos en la secci√≥n <strong>.rodata</strong> se <strong>modifican nuevamente</strong> .  ¬øTal vez son solo errores tipogr√°ficos debido a Copy-Paste y en lugar de <strong>tname</strong> quer√≠an escribir <strong>tmpbuf</strong> ?  ¬øO hay realmente alg√∫n tipo de significado oculto detr√°s de esto?  En cualquier caso, al reemplazar <strong>char * tokename []</strong> por <strong>char tokename [] [32] se</strong> elimina el error de segmentaci√≥n y Perl nos dice lo siguiente: <br><br><pre> <code class="bash hljs">$ ./perl test.pl syntax error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> file test.pl at line 7, next token <span class="hljs-string"><span class="hljs-string">"strict"</span></span> Execution aborted due to compilation errors.</code> </pre><br>  Resulta que no le gusta todo tipo de <strong>uso</strong> novedoso <strong>estricto</strong> , ¬°eso es lo que est√° tratando de decirnos!  Si elimina o comenta estas l√≠neas en el archivo, el programa comienza: <br><br><pre> <code class="bash hljs">$ ./perl test.pl Hello, World!</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em>&lt;&lt; Saltar al contenido</em></a> <br><br><a name="theend"></a><h2>  6. Para resumir </h2><br>  De hecho, logr√© mi objetivo e hice que el antiguo c√≥digo de 1987 no solo se compilara, sino que tambi√©n funcionara en un entorno Linux moderno.  Sin lugar a dudas, todav√≠a queda una gran pila de varios errores de fallas de segmentaci√≥n, posiblemente relacionados con el tama√±o del puntero en una arquitectura de 64 bits.  Todo esto se puede limpiar despu√©s de pasar algunas tardes con el depurador listo.  Pero esta no es una tarea muy agradable y bastante tediosa.  Despu√©s de todo, inicialmente este experimento fue planeado como entretenimiento para una noche aburrida, y no como un trabajo completo, que se pondr√° fin.  ¬øHay alg√∫n beneficio pr√°ctico de las acciones tomadas?  Tal vez alg√∫n d√≠a alg√∫n arque√≥logo digital se encuentre con este art√≠culo y le sea √∫til.  Pero en el mundo real, incluso la experiencia obtenida de tal investigaci√≥n, en mi opini√≥n, no es demasiado valiosa. <br><br>  Si alguien est√° interesado, publico un conjunto de dos parches.  El primero corrige errores de compilaci√≥n, y el segundo corrige algunos errores de falla de segmentaci√≥n. <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Correcci√≥n de parches de errores de compilaci√≥n, repositorio EXLMOTODEV GitHub."><strong>Perl1987-Fix-compilation-errors.patch</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Repara algunos parches de Fallas de segmentaci√≥n, repositorio EXLMOTODEV GitHub."><strong>Perl1987-Fix-some-Segmentation-Faults.patch</strong></a> </li></ul><br>  PD: me apresuro a molestar a los fan√°ticos de los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Programa Perl Single Line, art√≠culo de Lurkmore.">destructivos jugadores de una sola l√≠nea</a> , esto no funciona aqu√≠.  Quiz√°s la versi√≥n de Perl es demasiado antigua para tal entretenimiento. <br>  PPS Todo bien y que tengas un buen fin de semana.  Gracias a <strong>kawaii_neko</strong> por una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Perl directamente desde 1987, comentario sobre el recurso LINUX.ORG.RU">peque√±a soluci√≥n</a> . <br><br>  <em>Actualizaci√≥n 28-oct-2019: un</em> usuario del foro LINUX.ORG.RU, utilizando el apodo <strong>utf8nowhere</strong> , proporcion√≥ enlaces bastante interesantes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Perl directamente desde 1987, comentario sobre el recurso LINUX.ORG.RU">en su comentario</a> sobre este art√≠culo, cuya informaci√≥n no solo aclara la situaci√≥n con literales de cadena mutable, sino que incluso considera el problema de uso descrito anteriormente Funciones <strong>mktemp ()</strong> !  Perm√≠tanme citar estas fuentes, que describen diversas incompatibilidades entre K&amp;R C no estandarizado y GNU C: <br><blockquote>  <strong>Incompatibilidades de GCC</strong> <br>  Existen varias incompatibilidades notables entre las versiones C de GNU C y K&amp;R (no ISO). <br><br>  GCC normalmente hace que las constantes de cadena sean de solo lectura.  Si se usan varias constantes de cadena de aspecto id√©ntico, GCC almacena solo una copia de la cadena. <br>  Una consecuencia es que no puede llamar a <strong>mktemp</strong> con un argumento de cadena constante.  La funci√≥n <strong>mktemp</strong> siempre altera la cadena a la que apunta su argumento. <br><br>  Otra consecuencia es que <strong>sscanf</strong> no funciona en algunos sistemas cuando se pasa una constante de cadena como entrada o cadena de control de formato.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto se debe a que </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sscanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intenta escribir incorrectamente en la cadena constante. </font><font style="vertical-align: inherit;">Del mismo modo </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fscanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soluci√≥n a: El mejor de ellos para la vista Problemas es cambiar el programa para su uso </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Char</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -array con variables Un cadenas de inicializaci√≥n para A estos efectos de una en su lugar: las constantes de cadena. </font><font style="vertical-align: inherit;">Pero si esto no es posible, puede usar el </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicador -fwritable-strings</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que dirige a GCC a manejar las constantes de cadena de la misma manera que lo hacen la mayor√≠a de los compiladores de C. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuente: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Uso del Manual oficial de la Colecci√≥n del compilador GNU (GCC 3.3)."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso del Manual oficial de la Colecci√≥n del compilador GNU (GCC 3.3)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicador del</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compilador </font><strong><font style="vertical-align: inherit;">-fwritable-strings</font></strong><font style="vertical-align: inherit;"> qued√≥ en desuso en GCC 3.4 y se elimin√≥ permanentemente en GCC 4.0.</font></font><br><blockquote> <strong>ANSI C rationale | String literals</strong> <br> String literals are specified to be unmodifiable. This specification allows implementations to share copies of strings with identical text, to place string literals in read-only memory, and perform certain optimizations. However, string literals do not have the type array of const char, in order to avoid the problems of pointer type checking, particularly with library functions, since assigning a pointer to const char to a plain pointer to char is not valid. Those members of the Committee who insisted that string literals should be modifiable were content to have this practice designated a common extension (see F.5.5). <br><br> Existing code which modifies string literals can be made strictly conforming by replacing the string literal with an initialized static character array. For instance, <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *p, *make_temp(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> p = make_temp(<span class="hljs-string"><span class="hljs-string">"tempXXX"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* make_temp overwrites the literal */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* with a unique name */</span></span></code> </pre><br> can be changed to: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *p, *make_temp(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>[ ] = <span class="hljs-string"><span class="hljs-string">"tempXXX"</span></span>; p = make_temp( <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> ); }</code> </pre><br> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Justificaci√≥n del est√°ndar nacional estadounidense para sistemas de informaci√≥n, lenguaje de programaci√≥n C, literales de cadena.">Rationale for American National Standard for Information Systems, Programming Language C</a> . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El usuario </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VarfolomeyKote4ka</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propuso un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Perl directamente desde 1987, comentario sobre el recurso LINUX.ORG.RU"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">truco sucio interesante</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que le permite evitar errores de fallas de segmentaci√≥n al intentar cambiar los datos en la secci√≥n </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.rodata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> convirti√©ndolo en la secci√≥n </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.rwdata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No hace mucho tiempo, apareci√≥ un art√≠culo muy interesante en Internet, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="De .rodata a .rwdata: introducci√≥n al mapeo de memoria y scripts LD, Guy en BITS."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"De .rodata a .rwdata: introducci√≥n al mapeo de memoria y scripts LD"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por el programador </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guye1296</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que explica c√≥mo hacer este truco. Para facilitar la obtenci√≥n del resultado deseado, el autor del art√≠culo prepar√≥ un script bastante voluminoso para el enlazador est√°ndar </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="" title="Script rwdata.ld para ld linker, guye1296, repositorio de GitHub."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rwdata.ld</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es suficiente descargar este script, ponerlo en la ra√≠z del directorio fuente de Perl, corregir el indicador </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDFLAGS de la</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> siguiente manera: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDFLAGS = -T rwdata.ld</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , luego reconstruir el proyecto. </font><font style="vertical-align: inherit;">Como resultado, tenemos lo siguiente:</font></font><br><br><pre> <code class="bash hljs">$ make clean &amp;&amp; make -j1 $ mv perl perl_rodata $ curl -LOJ https://raw.githubusercontent.com/guye1296/ld_script_elf_blog_post/master/rwdata.ld $ sed -i <span class="hljs-string"><span class="hljs-string">'s/LDFLAGS =/LDFLAGS = -T rwdata.ld/'</span></span> Makefile $ make clean &amp;&amp; make -j1 $ mv perl perl_rwdata $ objdump -s -j .rodata perl_rodata | grep tmp -2 19da0 21233f5e 7e3d2d25 30313233 34353637 !<span class="hljs-comment"><span class="hljs-comment">#?^~=-%01234567 19db0 38392e2b 262a2829 2c5c2f5b 7c002400 89.+&amp;*(),\/[|.$. 19dc0 73746465 7272002f 746d702f 7065726c stderr./tmp/perl 19dd0 2d655858 58585858 00323536 00617070 -eXXXXXX.256.app 19de0 656e6400 6c6f6f70 63746c00 66756e63 end.loopctl.func $ objdump -s -j .rwdata perl_rodata | grep tmp -2 objdump: section '.rwdata' mentioned in a -j option, but not found in any input file $ objdump -s -j .rwdata perl_rwdata | grep tmp -2 41d9c0 21233f5e 7e3d2d25 30313233 34353637 !#?^~=-%01234567 41d9d0 38392e2b 262a2829 2c5c2f5b 7c002400 89.+&amp;*(),\/[|.$. 41d9e0 73746465 7272002f 746d702f 7065726c stderr./tmp/perl 41d9f0 2d655858 58585858 00323536 00617070 -eXXXXXX.256.app 41da00 656e6400 6c6f6f70 63746c00 66756e63 end.loopctl.func $ objdump -s -j .rodata perl_rwdata | grep tmp -2 objdump: section '.rodata' mentioned in a -j option, but not found in any input file $ ./perl_rodata -e 'print "Hello, World!\n";' Segmentation fault (core dumped) $ ./perl_rwdata -e 'print "Hello, World!\n";' Hello, World!</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resulta que gracias a este truco, ¬°casi todos los cambios desde el segundo parche pueden simplemente omitirse! </font><font style="vertical-align: inherit;">Aunque, por supuesto, es preferible llevar el c√≥digo a una vista que no viole los est√°ndares. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt; Saltar al contenido</font></font></em></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473228/">https://habr.com/ru/post/473228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473214/index.html">Yaga: cuentos eslavos en el entorno m√≥vil</a></li>
<li><a href="../473218/index.html">Entrevista con Ivan Kruglov, desarrollador principal: Service Mesh y herramientas "no est√°ndar" de Booking.com</a></li>
<li><a href="../473220/index.html">Las piedras angulares de la lenta destrucci√≥n del c√≥digo en Wolfram Language: acelerar el c√≥digo decenas, cientos y miles de veces</a></li>
<li><a href="../473222/index.html">Reglas personalizadas de iptables para docker usando zabbix como ejemplo</a></li>
<li><a href="../473224/index.html">Educaci√≥n superior vs competencia. Opini√≥n separada de un juez del Tribunal Constitucional de la Federaci√≥n de Rusia sobre el estado de la educaci√≥n superior</a></li>
<li><a href="../473230/index.html">¬øEs Internet satelital una nueva carrera espacial?</a></li>
<li><a href="../473232/index.html">¬øQu√© sistema de control de versiones utiliza (en el trabajo real, la mayor√≠a)?</a></li>
<li><a href="../473234/index.html">Crear una API REST con Node.js y una base de datos Oracle</a></li>
<li><a href="../473236/index.html">Trabajo en TI, gesti√≥n de proyectos, regulaci√≥n de PD y desarrollo en la nube: megadigest de 1cloud.ru</a></li>
<li><a href="../473238/index.html">C√≥mo funciona Netflix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>