<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍟 👩🏿‍🤝‍👩🏽 😓 Verwenden der Paging-Bibliothek mit Realm 👩🏿‍🎨 👨‍🎤 🖥️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bei einem der Meetings der Android-Abteilung habe ich mitbekommen, wie einer unserer Entwickler eine kleine Bibliothek erstellt hat, mit deren Hilfe b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verwenden der Paging-Bibliothek mit Realm</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467097/">  Bei einem der Meetings der Android-Abteilung habe ich mitbekommen, wie einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unserer</a> Entwickler eine kleine Bibliothek erstellt hat, mit deren Hilfe bei der Verwendung von Realm eine „endlose“ Liste erstellt werden kann, wobei das „verzögerte Laden“ und die Benachrichtigungen erhalten bleiben. <br><br>  Ich habe einen Artikelentwurf gemacht und geschrieben, der fast unverändert ist und den ich mit Ihnen teile.  Er seinerseits versprach, Aufgaben zu übernehmen und Kommentare abzugeben, wenn Fragen auftauchen. <br><a name="habracut"></a><br><h2>  Endlose Listen- und schlüsselfertige Lösungen </h2><br>  Eine der Aufgaben, mit denen wir konfrontiert sind, besteht darin, Informationen in einer Liste anzuzeigen, durch die beim Scrollen die Daten geladen und unsichtbar für den Benutzer eingefügt werden.  Für den Benutzer sieht es so aus, als würde er eine endlose Liste scrollen. <br><br>  Der Algorithmus ist ungefähr der folgende: <br><br><ul><li>  Wir erhalten Daten aus dem Cache für die erste Seite. </li><li>  Wenn der Cache leer ist, erhalten wir die Serverdaten, zeigen sie in der Liste an und schreiben in die Datenbank. </li><li>  Wenn ein Cache vorhanden ist, laden Sie ihn in die Liste. </li><li>  Wenn wir das Ende der Datenbank erreichen, fordern wir Daten vom Server an, zeigen sie in der Liste an und schreiben in die Datenbank. </li></ul><br>  Vereinfacht: Um die Liste anzuzeigen, wird zuerst der Cache abgefragt, und das Signal zum Laden neuer Daten ist das Ende des Caches. <br><br>  Um endloses Scrollen zu implementieren, können Sie vorgefertigte Lösungen verwenden: <br><br><ul><li>  Implementierung von RecyclerView.OnScrollListener oder Suche nach etwas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bereitem</a> auf Github, wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EndlessRecyclerViewScrollListener</a> ; </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">reaktiver Ansatz</a> mit RxJava zur Steuerung des Datenladens; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fertige Umsetzung der Liste</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Paging-Bibliothek von Jetpack</a> . </li></ul><br>  Wir verwenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Realm</a> als mobile Datenbank. Nachdem wir alle oben genannten Ansätze ausprobiert haben, haben wir die Verwendung der Paging-Bibliothek eingestellt. <br><br>  Auf den ersten Blick ist die Android Paging Library eine hervorragende Lösung zum Herunterladen von Daten. Wenn Sie SQLite in Verbindung mit Room verwenden, eignet es sich hervorragend als Datenbank.  Wenn wir jedoch Realm als Datenbank verwenden, verlieren wir alles, was wir so gewohnt sind - verzögertes Laden und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Benachrichtigungen über Datenänderungen</a> .  Wir wollten nicht auf all diese Dinge verzichten, sondern gleichzeitig die Paging-Bibliothek nutzen. <br><br><h2>  Vielleicht sind wir nicht die Ersten, die es brauchen </h2><br>  Eine schnelle Suche ergab sofort eine Lösung - die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Realm Monarchy</a> Library.  Nach einer kurzen Studie stellte sich heraus, dass diese Lösung nicht zu uns passt - die Bibliothek unterstützt weder verzögertes Laden noch Benachrichtigungen.  Ich musste meine eigenen erstellen. <br><br>  Die Anforderungen sind also: <br><br><ol><li>  Verwenden Sie Realm weiterhin. </li><li>  Speichern Sie das verzögerte Laden für Realm. </li><li>  Benachrichtigungen speichern; </li><li>  Verwenden Sie die Paging-Bibliothek, um Daten aus der Datenbank zu laden und Daten vom Server zu paginieren, wie es die Paging-Bibliothek vorschlägt. </li></ol><br>  Versuchen wir von Anfang an herauszufinden, wie die Paging-Bibliothek funktioniert und was zu tun ist, damit wir uns gut fühlen. <br><br>  Kurz gesagt - die Bibliothek besteht aus folgenden Komponenten: <br><br>  <b>DataSource</b> - die Basisklasse zum <b>seitlichen</b> Laden von Daten. <br>  Es hat Implementierungen: PageKeyedDataSource, PositionalDataSource und ItemKeyedDataSource, aber ihr Zweck ist für uns jetzt nicht wichtig. <br><br>  <b>PagedList</b> - Eine Liste, die Daten in <b>Blöcken</b> aus einer DataSource lädt.  Da wir jedoch Realm verwenden, ist das Laden von Daten in Stapeln für uns nicht relevant. <br>  PagedListAdapter - Die Klasse, die für die Anzeige der von der PagedList geladenen Daten verantwortlich ist. <br><br>  Im Quellcode der Referenzimplementierung werden wir sehen, wie die Schaltung funktioniert. <br><br>  1. Der PagedListAdapter in der Methode getItem (int index) ruft die Methode loadAround (int index) für die PagedList auf: <br><br><pre><code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Get the item from the current PagedList at the specified index. * &lt;p&gt; * Note that this operates on both loaded items and null padding within the PagedList. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> index Index of item to get, must be &gt;= 0, and &lt; {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> #getItemCount()}. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> The item, or null, if a null placeholder is at the specified position. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"WeakerAccess"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T getItem(int index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mPagedList == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mSnapshot == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> new IndexOutOfBoundsException( <span class="hljs-string"><span class="hljs-string">"Item count is zero, getItem() call is invalid"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mSnapshot.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(index); } } mPagedList.loadAround(index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mPagedList.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(index); }</code> </pre> <br>  2. PagedList führt Überprüfungen durch und ruft die void-Methode tryDispatchBoundaryCallbacks (boolescher Beitrag) auf: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Load adjacent items to passed index. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> index Index at which to load. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> void loadAround(int index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || index &gt;= size()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> new IndexOutOfBoundsException(<span class="hljs-string"><span class="hljs-string">"Index: "</span></span> + index + <span class="hljs-string"><span class="hljs-string">", Size: "</span></span> + size()); } mLastLoad = index + getPositionOffset(); loadAroundInternal(index); mLowestIndexAccessed = Math.min(mLowestIndexAccessed, index); mHighestIndexAccessed = Math.max(mHighestIndexAccessed, index); <span class="hljs-comment"><span class="hljs-comment">/* * mLowestIndexAccessed / mHighestIndexAccessed have been updated, so check if we need to * dispatch boundary callbacks. Boundary callbacks are deferred until last items are loaded, * and accesses happen near the boundaries. * * Note: we post here, since RecyclerView may want to add items in response, and this * call occurs in PagedListAdapter bind. */</span></span> tryDispatchBoundaryCallbacks(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre><br>  3. Bei dieser Methode wird überprüft, ob der folgende Teil der Daten heruntergeladen werden muss, und es erfolgt eine Downloadanforderung: <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Call this when mLowest/HighestIndexAccessed are changed, or * mBoundaryCallbackBegin/EndDeferred is set. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"WeakerAccess"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-comment"><span class="hljs-comment">/* synthetic access */</span></span> void tryDispatchBoundaryCallbacks(boolean post) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> boolean dispatchBegin = mBoundaryCallbackBeginDeferred &amp;&amp; mLowestIndexAccessed &lt;= mConfig.prefetchDistance; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> boolean dispatchEnd = mBoundaryCallbackEndDeferred &amp;&amp; mHighestIndexAccessed &gt;= size() - <span class="hljs-number"><span class="hljs-number">1</span></span> - mConfig.prefetchDistance; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dispatchBegin &amp;&amp; !dispatchEnd) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dispatchBegin) { mBoundaryCallbackBeginDeferred = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dispatchEnd) { mBoundaryCallbackEndDeferred = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (post) { mMainThreadExecutor.execute(new Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> void run() { dispatchBoundaryCallbacks(dispatchBegin, dispatchEnd); } }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { dispatchBoundaryCallbacks(dispatchBegin, dispatchEnd); } }</code> </pre><br>  4. Infolgedessen fallen alle Aufrufe in die DataSource, wo die Daten aus der Datenbank oder aus anderen Quellen heruntergeladen werden: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"WeakerAccess"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-comment"><span class="hljs-comment">/* synthetic access */</span></span> void dispatchBoundaryCallbacks(boolean begin, boolean end) { <span class="hljs-comment"><span class="hljs-comment">// safe to deref mBoundaryCallback here, since we only defer if mBoundaryCallback present if (begin) { //noinspection ConstantConditions mBoundaryCallback.onItemAtFrontLoaded(mStorage.getFirstLoadedItem()); } if (end) { //noinspection ConstantConditions mBoundaryCallback.onItemAtEndLoaded(mStorage.getLastLoadedItem()); } }</span></span></code> </pre><br>  Während alles einfach aussieht - nimm es einfach und mach es.  Nur Geschäft: <br><br><ol><li>  Erstellen Sie Ihre eigene Implementierung von PagedList (RealmPagedList), die mit RealmModel funktioniert. </li><li>  Erstellen Sie Ihre eigene Implementierung von PagedStorage (RealmPagedStorage), die mit OrderedRealmCollection funktioniert. </li><li>  Erstellen Sie Ihre eigene Implementierung von DataSource (RealmDataSource), die mit RealmModel funktioniert. </li><li>  Erstellen Sie Ihren eigenen Adapter für die Arbeit mit RealmList. </li><li>  Entfernen Sie unnötige, fügen Sie die notwendigen hinzu; </li><li>  Fertig. </li></ol><br>  Wir lassen die kleinen technischen Details <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">weg</a> und hier ist das Ergebnis - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RealmPagination-Bibliothek</a> .  Versuchen wir, eine Anwendung zu erstellen, die eine Liste der Benutzer anzeigt. <br><br>  0. Fügen Sie die Bibliothek zum Projekt hinzu: <br><br><pre> <code class="kotlin hljs">allprojects { repositories { maven { url <span class="hljs-string"><span class="hljs-string">"https://jitpack.io"</span></span> } } } implementation <span class="hljs-string"><span class="hljs-string">'com.github.magora-android:realmpagination:1.0.0'</span></span></code> </pre> <br><br>  1. Erstellen Sie die Benutzerklasse: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Serializable</span></span> <span class="hljs-meta"><span class="hljs-meta">@RealmClass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RealmModel { @PrimaryKey @SerialName</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-meta"><span class="hljs-meta">@SerialName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"login"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> login: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@SerialName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"avatar_url"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> avatarUrl: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@SerialName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"url"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@SerialName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"html_url"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> htmlUrl: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@SerialName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"repos_url"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reposUrl: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre> <br>  2. Erstellen Sie eine DataSource: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersListDataSourceFactory</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> getUsersUseCase: GetUserListUseCase, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> localStorage: UserDataStorage ) : RealmDataSource.Factory&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, User&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: RealmDataSource&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, User&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : RealmPageKeyedDataSource&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, User&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadInitial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoadInitialParams</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, callback: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoadInitialCallback</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, User&gt;)</span></span></span></span> {...} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadBefore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoadParams</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, callback: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoadCallback</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, User&gt;)</span></span></span></span> { ... } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadAfter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoadParams</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, callback: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoadCallback</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, User&gt;)</span></span></span></span> { ... } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { } }</code> </pre> <br>  3. Erstellen Sie einen Adapter: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdapterUserList</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: RealmPagedList&lt;*, User&gt;, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onClick: (<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) : BaseRealmListenableAdapter&lt;User, RecyclerView.ViewHolder&gt;(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">, viewType: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: RecyclerView.ViewHolder { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = LayoutInflater.from(parent.context).inflate(R.layout.item_user, parent, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UserViewHolder(view) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RecyclerView</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ... } }</code> </pre> <br>  4. Erstellen Sie ein ViewModel: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> INITIAL_PAGE_SIZE = <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> PAGE_SIZE = <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> PREFETCH_DISTANCE = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VmUsersList</span></span></span></span>( app: Application, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dsFactory: UsersListDataSourceFactory, ) : AndroidViewModel(app), KoinComponent { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> contentData: RealmPagedList&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, User&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> config = RealmPagedList.Config.Builder() .setInitialLoadSizeHint(INITIAL_PAGE_SIZE) .setPageSize(PAGE_SIZE) .setPrefetchDistance(PREFETCH_DISTANCE) .build() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RealmPagedListBuilder(dsFactory, config) .setInitialLoadKey(<span class="hljs-number"><span class="hljs-number">0</span></span>) .setRealmData(localStorage.getUsers().users) .build() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retryAfterPaginationError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ... } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCleared</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCleared() dsFactory.destroy() } }</code> </pre> <br>  5. Initialisieren Sie die Liste: <br><br><pre> <code class="kotlin hljs">recyclerView.layoutManager = LinearLayoutManager(context) recyclerView.adapter = AdapterUserList(viewModel.contentData) { user, position -&gt; <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br>  6. Erstellen Sie ein Fragment mit einer Liste: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FragmentUserList</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseFragment</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onViewCreated(view, savedInstanceState) recyclerView.layoutManager = LinearLayoutManager(context) recyclerView.adapter = AdapterUserList(viewModel.contentData) { user, position -&gt; ... } }</code> </pre> <br>  7. Fertig. <br><br>  Es stellte sich heraus, dass die Verwendung von Realm so einfach ist wie Room.  Sergey veröffentlichte den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellcode der Bibliothek und ein Anwendungsbeispiel</a> .  Sie müssen kein anderes Fahrrad schneiden, wenn Sie in eine ähnliche Situation geraten. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467097/">https://habr.com/ru/post/de467097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467087/index.html">Wie ich mich auf die Oracle Database SQL-Zertifizierung (1Z0-071) vorbereitet und diese bestanden habe</a></li>
<li><a href="../de467089/index.html">Patched Exim - Patch erneut. Neue Remote-Befehlsausführung in Exim 4.92 in einer Anforderung</a></li>
<li><a href="../de467091/index.html">Eine kurze Einführung in Svelte aus der Perspektive eines Angular-Entwicklers</a></li>
<li><a href="../de467093/index.html">Spionieren Sie Ihre Programme mit Strace aus</a></li>
<li><a href="../de467095/index.html">Einfacher als es klingt. 20</a></li>
<li><a href="../de467099/index.html">Hapi für die Kleinen</a></li>
<li><a href="../de467101/index.html">Das Epos, einen Roboter mit dem Duft eines Hundes zu erschaffen</a></li>
<li><a href="../de467105/index.html">Podman und Buildah für Docker-Benutzer</a></li>
<li><a href="../de467107/index.html">Ausführen mehrerer Pipelines mit GitLab CI / CD</a></li>
<li><a href="../de467109/index.html">Wie die Qualitätssicherung die Testautomatisierung für ein Projekt organisiert. Ein praktischer Weg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>