<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ö ü•ê üí£ Consejos pr√°cticos, ejemplos y t√∫neles SSH üë®üèº‚ÄçüöÄ üéá üé∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ejemplos pr√°cticos de SSH que llevar√°n sus habilidades de administrador de sistema remoto al siguiente nivel. Los comandos y sugerencias ayudar√°n no s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Consejos pr√°cticos, ejemplos y t√∫neles SSH</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435546/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/oz/pn/4x/ozpn4xuna3odpakxmdgnlwqxwto.jpeg"></div><br>  Ejemplos pr√°cticos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SSH</a> que llevar√°n sus habilidades de administrador de sistema remoto al siguiente nivel.  Los comandos y sugerencias ayudar√°n no solo a usar <code>SSH</code> , sino tambi√©n a navegar de manera m√°s competente en la red. <br><br>  Conocer algunos trucos <code>ssh</code> es √∫til para cualquier administrador de sistemas, ingeniero de redes o especialista en seguridad. <br><a name="habracut"></a><br><h3>  Ejemplos pr√°cticos de SSH </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Calcetines SSH proxy</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">T√∫nel SSH (reenv√≠o de puertos)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">T√∫nel SSH al tercer host</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SSH t√∫nel inverso</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proxy inverso SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instalar VPN sobre SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Copiar clave SSH (ssh-copy-id)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ejecuci√≥n remota de comandos (no interactiva)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Captura y visualizaci√≥n remota de paquetes en Wireshark</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Copiar una carpeta local a un servidor remoto a trav√©s de SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aplicaciones remotas de la GUI de reenv√≠o SSH X11</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Copia remota de archivos usando rsync y SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SSH sobre la red Tor</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instancia de SSH a EC2</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Edici√≥n de archivos de texto usando VIM a trav√©s de ssh / scp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Montaje de SSH remoto como una carpeta local con SSHFS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Multiplexaci√≥n SSH con ControlPath</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Transmisi√≥n de video SSH usando VLC y SFTP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Autenticaci√≥n de dos factores</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Host Jumping con SSH y -J</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bloqueo de intentos de fuerza bruta SSH con iptables</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SSH Escape para cambiar el reenv√≠o de puertos</a> </li></ol><br><h1>  Lo b√°sico primero </h1><br><h4>  An√°lisis de l√≠nea de comando SSH </h4><br>  El siguiente ejemplo utiliza los par√°metros habituales que a menudo se encuentran al conectarse a un servidor <code>SSH</code> remoto. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -p 22 -C neo@remoteserver</code> </pre> <br><ul><li>  <code>-v</code> : la salida de depuraci√≥n es especialmente √∫til al analizar problemas de autenticaci√≥n.  Puede usarlo varias veces para mostrar informaci√≥n adicional. </li><li>  <code>- p 22</code> : <b>puerto para conectarse</b> a un servidor SSH remoto.  22 no es necesario especificar, porque este es el valor predeterminado, pero si el protocolo est√° en alg√∫n otro puerto, lo especificamos utilizando el par√°metro <code>-p</code> .  El puerto de escucha se especifica en el archivo <code>sshd_config</code> en el formato <code>Port 2222</code> . </li><li>  <code>-C</code> : compresi√≥n para la conexi√≥n.  Si tiene una alimentaci√≥n lenta o est√° viendo mucho texto, esto puede acelerar la conexi√≥n. </li><li>  <code>neo@</code> : la l√≠nea antes del s√≠mbolo @ indica el nombre de usuario para la autenticaci√≥n en el servidor remoto.  Si no lo especifica, se usar√° de manera predeterminada el nombre de usuario de la cuenta en la que est√° conectado actualmente (~ $ whoami).  El usuario tambi√©n se puede especificar con la opci√≥n <code>-l</code> . </li><li>  <code>remoteserver</code> : el nombre de host al que se conecta <code>ssh</code> , puede ser un nombre de dominio totalmente calificado, una direcci√≥n IP o cualquier host en el archivo de hosts locales.  Para conectarse a un host que admita IPv4 e IPv6, puede agregar la opci√≥n <code>-4</code> o <code>-6</code> a la l√≠nea de comando para obtener la resoluci√≥n adecuada. </li></ul><br>  Todas las opciones anteriores son opcionales, excepto el <code>remoteserver</code> . <br><br><h4>  Usando el archivo de configuraci√≥n </h4><br>  Aunque muchos est√°n familiarizados con el archivo <code>sshd_config</code> , tambi√©n hay un archivo de configuraci√≥n del cliente para el comando <code>ssh</code> .  El valor predeterminado es <code>~/.ssh/config</code> , pero se puede definir como un par√°metro para la opci√≥n <code>-F</code> . <br><br><pre> <code class="bash hljs">Host * Port 2222 Host remoteserver HostName remoteserver.thematrix.io User neo Port 2112 IdentityFile /home/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/.ssh/remoteserver.private_key</code> </pre> <br>  El archivo de configuraci√≥n ssh de ejemplo anterior tiene dos entradas de host.  El primero significa todos los hosts, el par√°metro de configuraci√≥n del Puerto 2222 se usa para todos. El segundo dice que para el host del <b>servidor remoto</b> debe usar un nombre de usuario, puerto, FQDN e IdentityFile diferentes. <br><br>  Un archivo de configuraci√≥n puede ahorrar mucho tiempo escribiendo caracteres, lo que le permite aplicar autom√°ticamente la configuraci√≥n avanzada al conectarse a hosts espec√≠ficos. <br><br><h4>  Copie archivos sobre SSH usando SCP </h4><br>  El cliente SSH viene con otras dos herramientas muy convenientes para copiar archivos a trav√©s de una <b>conexi√≥n ssh encriptada</b> .  Vea a continuaci√≥n un ejemplo del uso est√°ndar de los comandos scp y sftp.  Tenga en cuenta que muchas de las opciones para ssh tambi√©n se aplican a estos comandos. <br><br><pre> <code class="bash hljs">localhost:~$ scp mypic.png neo@remoteserver:/media/data/mypic_2.png</code> </pre> <br>  En este ejemplo, el archivo <b>mypic.png se</b> copia al <b>servidor remoto</b> en la carpeta <b>/ media / data</b> y se renombra a <b>mypic_2.png</b> . <br><br>  No te olvides de la diferencia en el par√°metro del puerto.  Esto se encuentra con muchos que ejecutan <code>scp</code> desde la l√≠nea de comando.  ¬°Aqu√≠ el par√°metro del puerto es <code>-P</code> , no <code>-p</code> , como en el cliente ssh!  Lo olvidar√°s, pero no te preocupes, todos lo olvidar√°n. <br><br>  Para aquellos familiarizados con la consola <code>ftp</code> , muchos de los comandos son similares en <code>sftp</code> .  Puedes hacer <b>push</b> , <b>put</b> y <b>ls</b> como tu coraz√≥n lo desee. <br><br><pre> <code class="bash hljs">sftp neo@remoteserver</code> </pre> <br><h1>  Ejemplos pr√°cticos </h1><br>  En muchos de estos ejemplos, el resultado puede lograrse mediante varios m√©todos.  Al igual que con todos nuestros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">libros de texto</a> y ejemplos, se da preferencia a ejemplos pr√°cticos que simplemente hacen su trabajo. <br><br><a name="1"></a><h3>  1. proxy de calcetines SSH </h3><br>  Proxy SSH en el n√∫mero 1 por una buena raz√≥n.  Es m√°s potente de lo que muchos suponen, y le da acceso a cualquier sistema al que un servidor remoto tenga acceso utilizando casi cualquier aplicaci√≥n.  El cliente ssh puede hacer un t√∫nel del tr√°fico a trav√©s del proxy SOCKS con un simple comando.  Es importante comprender que el tr√°fico a los sistemas remotos provendr√° de un servidor remoto, como se indicar√° en los registros del servidor web. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 8888 user@remoteserver localhost:~$ netstat -pan | grep 8888 tcp 0 0 127.0.0.1:8888 0.0.0.0:* LISTEN 23880/ssh</code> </pre> <br>  Aqu√≠ ejecutamos el proxy de calcetines en el puerto TCP 8888, el segundo comando verifica que el puerto est√© activo en modo de escucha.  127.0.0.1 indica que el servicio se ejecuta solo en localhost.  Podemos usar un comando ligeramente diferente para escuchar todas las interfaces, incluyendo ethernet o wifi, esto permitir√° que otras aplicaciones (navegadores, etc.) en nuestra red se conecten al servicio de proxy a trav√©s de ssh socks proxy. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 0.0.0.0:8888 user@remoteserver</code> </pre> <br>  Ahora podemos configurar el navegador para conectarse al proxy de calcetines.  En Firefox, seleccione <b>Configuraci√≥n |</b>  <b>Destacados |</b>  <b>Configuraciones de red</b>  Especifique la direcci√≥n IP y el puerto para conectarse. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daa/f8b/545/daaf8b54515ce6eee864c8416d41eef9.png"><br><br>  Preste atenci√≥n a la opci√≥n en la parte inferior del formulario para que las consultas DNS del navegador tambi√©n pasen por servidores proxy SOCKS.  Si usa un servidor proxy para cifrar el tr√°fico web en la red local, entonces probablemente desee seleccionar esta opci√≥n para que las consultas DNS se tunelen a trav√©s de una conexi√≥n SSH. <br><br><h4>  Activaci√≥n de proxy de calcetines en Chrome </h4><br>  La ejecuci√≥n de Chrome con ciertas opciones de l√≠nea de comandos activa los proxy de calcetines, as√≠ como tambi√©n las consultas de DNS del t√∫nel desde el navegador.  Conf√≠a, pero verifica.  Use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tcpdump</a> para verificar que las consultas DNS ya no sean visibles. <br><br><pre> <code class="bash hljs">localhost:~$ google-chrome --proxy-server=<span class="hljs-string"><span class="hljs-string">"socks5://192.168.1.10:8888"</span></span></code> </pre> <br><h4>  Usar otras aplicaciones proxy </h4><br>  Tenga en cuenta que muchas otras aplicaciones tambi√©n pueden usar proxies de calcetines.  Un navegador web es simplemente el m√°s popular de ellos.  Algunas aplicaciones tienen opciones de configuraci√≥n para activar un servidor proxy.  Otros necesitan un poco de ayuda con el programa de ayuda.  Por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proxychains le</a> permite ejecutar Microsoft RDP, etc. a trav√©s de socks-proxies. <br><br><pre> <code class="bash hljs">localhost:~$ proxychains rdesktop <span class="hljs-variable"><span class="hljs-variable">$RemoteWindowsServer</span></span></code> </pre> <br>  Los par√°metros de configuraci√≥n de proxy de calcetines se establecen en el archivo de configuraci√≥n de proxychains. <br><br><blockquote>  Sugerencia: si usa un escritorio remoto desde Linux en Windows?  Prueba el cliente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FreeRDP</a> .  Esta es una implementaci√≥n m√°s moderna que <code>rdesktop</code> , con una interacci√≥n mucho m√°s fluida. </blockquote><br><h4>  Opci√≥n SSH a trav√©s de proxy de calcetines </h4><br>  Est√°s sentado en una cafeter√≠a u hotel, y est√°s obligado a usar WiFi poco confiable.  Desde la computadora port√°til, inicie localmente el proxy ssh e instale el t√∫nel ssh en la red dom√©stica en el Rasberry Pi local.  Usando un navegador u otras aplicaciones configuradas para servidores proxy de calcetines, podemos acceder a cualquier servicio de red en nuestra red dom√©stica o acceder a Internet a trav√©s de una conexi√≥n dom√©stica.  Todo entre su computadora port√°til y el servidor de su hogar (a trav√©s de Wi-Fi e Internet a su hogar) est√° encriptado en el t√∫nel SSH. <br><br><a name="2"></a><h3>  2. T√∫nel SSH (reenv√≠o de puertos) </h3><br>  En su forma m√°s simple, un t√∫nel SSH simplemente abre un puerto en su sistema local que se conecta a otro puerto en el otro extremo del t√∫nel. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 9999:127.0.0.1:80 user@remoteserver</code> </pre> <br>  Examinemos la opci√≥n <code>-L</code> .  Se puede representar como el lado local de la escucha.  Por lo tanto, en el ejemplo anterior, el puerto 9999 se escucha en el lado del host local y se reenv√≠a a trav√©s del puerto 80 al servidor remoto.  ¬°Tenga en cuenta que 127.0.0.1 se refiere a localhost en el servidor remoto! <br><br>  Subamos un paso.  En el siguiente ejemplo, los puertos de escucha se comunican con otros nodos en la red local. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:127.0.0.1:80 user@remoteserver</code> </pre> <br>  En estos ejemplos, nos conectamos al puerto en el servidor web, pero puede ser un servidor proxy o cualquier otro servicio TCP. <br><br><a name="3"></a><h3>  3. T√∫nel SSH a un host de terceros </h3><br>  Podemos usar los mismos par√°metros para conectar un t√∫nel desde un servidor remoto a otro servicio que se ejecuta en un tercer sistema. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:10.10.10.10:80 user@remoteserver</code> </pre> <br>  En este ejemplo, estamos redirigiendo el t√∫nel desde el servidor remoto a un servidor web que se ejecuta en 10.10.10.10.  El tr√°fico con servidor remoto antes del 10.10.10.10 <b>ya no est√° en el t√∫nel SSH</b> .  El 10.10.10.10, el servidor web considerar√° el servidor remoto como la fuente de las solicitudes web. <br><br><a name="4"></a><h3>  4. T√∫nel SSH inverso </h3><br>  Aqu√≠ configuramos el puerto de escucha en el servidor remoto, que se conectar√° nuevamente al puerto local en nuestro host local (u otro sistema). <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999:127.0.0.1:902 192.168.1.100 user@remoteserver</code> </pre> <br>  En esta sesi√≥n SSH, se establece una conexi√≥n desde el puerto 1999 en el servidor remoto al puerto 902 en nuestro cliente local. <br><br><a name="5"></a><h3>  5. Proxy SSH inverso </h3><br>  En este caso, instalamos el proxy de calcetines en nuestra conexi√≥n ssh, sin embargo, el proxy escucha en el extremo remoto del servidor.  Las conexiones a este proxy remoto ahora aparecen desde el t√∫nel como tr√°fico desde nuestro host local. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999 192.168.1.100 user@remoteserver</code> </pre> <br><h4>  Soluci√≥n de problemas de t√∫neles remotos SSH </h4><br>  Si tiene problemas con las opciones SSH remotas, verifique con <code>netstat</code> qu√© otras interfaces est√° conectado el puerto de escucha.  Aunque especificamos 0.0.0.0 en los ejemplos, pero si el valor de <b>GatewayPorts</b> en <b>sshd_config se</b> establece en <b>no</b> , entonces el oyente solo estar√° vinculado a localhost (127.0.0.1). <br><br><blockquote><h4>  Advertencia de seguridad </h4><br>  Tenga en cuenta que al abrir t√∫neles y proxies de calcetines, los recursos de la red interna pueden estar disponibles para redes no confiables (por ejemplo, Internet).  Esto puede ser un grave riesgo de seguridad, as√≠ que aseg√∫rese de comprender qu√© es el oyente y a qu√© tiene acceso. </blockquote><br><a name="6"></a><h3>  6. Instalar VPN sobre SSH </h3><br>  El t√©rmino general entre los especialistas en m√©todos de ataque (pentesters, etc.) es "el punto de apoyo de la red".  Despu√©s de establecer una conexi√≥n en un sistema, este sistema se convierte en una puerta de enlace para un mayor acceso a la red.  El punto de apoyo que te permite moverte en amplitud. <br><br>  Para tal punto de apoyo, podemos usar proxies SSH y <b>proxychains</b> , sin embargo, hay algunas limitaciones.  Por ejemplo, no podr√° trabajar directamente con sockets, por lo que no podremos escanear puertos dentro de la red a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nmap</a> <code>SYN</code> . <br><br>  Usando esta opci√≥n VPN m√°s avanzada, la conexi√≥n cae al <b>nivel 3</b> .  Entonces podemos simplemente enrutar el tr√°fico a trav√©s del t√∫nel utilizando el enrutamiento de red est√°ndar. <br><br>  El m√©todo utiliza <code>ssh</code> , <code>iptables</code> , <code>tun interfaces</code> y enrutamiento. <br><br>  Primero debe establecer estos par√°metros en <code>sshd_config</code> .  Dado que estamos realizando cambios en las interfaces de los sistemas remotos y del cliente, <b>necesitamos privilegios de root en ambos lados</b> . <br><br><pre> <code class="bash hljs">PermitRootLogin yes PermitTunnel yes</code> </pre> <br>  Luego establezca una conexi√≥n ssh utilizando un par√°metro que solicite la inicializaci√≥n de los dispositivos tun. <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ssh -v -w any root@remoteserver</span></span></code> </pre> <br>  Ahora deber√≠amos tener un dispositivo tun al mostrar las interfaces ( <code># ip a</code> ).  El siguiente paso agregar√° direcciones IP a las interfaces del t√∫nel. <br><br>  Lado del cliente SSH: <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.2/32 peer 10.10.10.10 dev tun0 localhost:~# ip tun0 up</span></span></code> </pre> <br>  Lado del servidor SSH: <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.10/32 peer 10.10.10.2 dev tun0 remoteserver:~# ip tun0 up</span></span></code> </pre> <br>  Ahora tenemos una ruta directa a otro host ( <code>route -n</code> y <code>ping 10.10.10.10</code> ). <br><br>  Puede enrutar cualquier subred a trav√©s del host del otro lado. <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># route add -net 10.10.10.0 netmask 255.255.255.0 dev tun0</span></span></code> </pre> <br>  En el lado remoto, debe habilitar <code>ip_forward</code> e <code>iptables</code> . <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward remoteserver:~# iptables -t nat -A POSTROUTING -s 10.10.10.2 -o enp7s0 -j MASQUERADE</span></span></code> </pre> <br>  Boom!  <b>VPN sobre t√∫nel SSH en la capa de red 3</b> .  Esto ya es una victoria. <br><br>  Si encuentra alg√∫n problema, use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tcpdump</a> y <code>ping</code> para determinar la causa.  Como jugamos en el nivel 3, nuestros paquetes icmp pasar√°n por este t√∫nel. <br><br><a name="7"></a><h3>  7. Copiando la clave SSH (ssh-copy-id) </h3><br>  Hay varias formas, pero este comando ahorra tiempo para no copiar archivos manualmente.  Simplemente copia ~ / .ssh / id_rsa.pub (o la clave predeterminada) de su sistema a <code>~/.ssh/authorized_keys</code> en el servidor remoto. <br><br><pre> <code class="bash hljs">localhost:~$ ssh-copy-id user@remoteserver</code> </pre> <br><a name="8"></a><h3>  8. Ejecuci√≥n remota de comandos (no interactiva) </h3><br>  El comando <code>ssh</code> se puede asociar con otros comandos para la interfaz f√°cil de usar habitual.  Simplemente agregue el comando que desea ejecutar en el host remoto como el √∫ltimo par√°metro entre comillas. <br><br><pre> <code class="bash hljs">localhost:~$ ssh remoteserver <span class="hljs-string"><span class="hljs-string">"cat /var/log/nginx/access.log"</span></span> | grep badstuff.php</code> </pre> <br>  En este ejemplo, <code>grep</code> ejecuta en el sistema local despu√©s de que el registro se haya descargado a trav√©s del canal ssh.  Si el archivo es grande, es m√°s conveniente ejecutar <code>grep</code> en el lado remoto, simplemente encerrando ambos comandos entre comillas dobles. <br><br>  Otro ejemplo realiza la misma funci√≥n que <code>ssh-copy-id</code> del ejemplo 7. <br><br><pre> <code class="bash hljs">localhost:~$ cat ~/.ssh/id_rsa.pub | ssh remoteserver <span class="hljs-string"><span class="hljs-string">'cat &gt;&gt; .ssh/authorized_keys'</span></span></code> </pre> <br><a name="9"></a><h3>  9. Captura y visualizaci√≥n remota de paquetes en Wireshark </h3><br>  Tom√© uno de nuestros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplos de tcpdump</a> .  √öselo para interceptar paquetes de forma remota con el resultado directamente en la GUI del Wireshark local. <br><br><pre> <code class="bash hljs">:~$ ssh root@remoteserver <span class="hljs-string"><span class="hljs-string">'tcpdump -c 1000 -nn -w - not port 22'</span></span> | wireshark -k -i -</code> </pre> <br><a name="10"></a><h3>  10. Copiando una carpeta local a un servidor remoto a trav√©s de SSH </h3><br>  Un hermoso truco que comprime una carpeta usando <code>bzip2</code> (esta es la opci√≥n -j en el comando <code>tar</code> ) y luego extrae la secuencia <code>bzip2</code> en el otro lado, creando un duplicado de la carpeta en el servidor remoto. <br><br><pre> <code class="bash hljs">localhost:~$ tar -cvj /datafolder | ssh remoteserver <span class="hljs-string"><span class="hljs-string">"tar -xj -C /datafolder"</span></span></code> </pre> <br><a name="11"></a><h3>  11. Aplicaciones remotas de la GUI de reenv√≠o SSH X11 </h3><br>  Si el cliente y el servidor remoto tienen X instalado, puede ejecutar remotamente el comando GUI, con una ventana en su escritorio local.  Esta caracter√≠stica existe hace mucho tiempo, pero sigue siendo muy √∫til.  Inicie un navegador web remoto o incluso la consola VMWawre Workstation, como hago en este ejemplo. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -X remoteserver vmware</code> </pre> <br>  Requiere la l√≠nea <code>X11Forwarding yes</code> en el archivo <code>sshd_config</code> . <br><br><a name="12"></a><h3>  12. Copia remota de archivos usando rsync y SSH </h3><br>  <code>rsync</code> es mucho m√°s conveniente que <code>scp</code> si necesita hacer una copia de seguridad peri√≥dica de un directorio, una gran cantidad de archivos o archivos muy grandes.  Hay una funci√≥n para recuperarse de una falla de transmisi√≥n y copiar solo archivos modificados, lo que ahorra tr√°fico y tiempo. <br><br>  Este ejemplo utiliza la compresi√≥n <code>gzip</code> (-z) y el modo de archivo (-a), que permite la copia recursiva. <br><br><pre> <code class="bash hljs">:~$ rsync -az /home/testuser/data remoteserver:backup/</code> </pre> <br><a name="13"></a><h3>  13. SSH sobre la red Tor </h3><br>  Una red Tor an√≥nima puede tunelizar el tr√°fico SSH usando el <code>torsocks</code> .  El siguiente comando lanzar√° un proxy ssh a trav√©s de Tor. <br><br><pre> <code class="bash hljs">localhost:~$ torsocks ssh myuntracableuser@remoteserver</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Torsocks</a> usar√° el puerto 9050 para proxy en localhost.  Como siempre, al usar Tor, debe verificar seriamente qu√© tr√°fico se est√° tunelizando y otros problemas de seguridad operacional (opsec).  <b>¬øA d√≥nde van tus consultas DNS?</b> <br><br><a name="14"></a><h3>  14. Instancia SSH a EC2 </h3><br>  Se requiere una clave privada para conectarse a una instancia EC2.  Desc√°rguelo (extensi√≥n .pem) desde el panel de control de Amazon EC2 y cambie los permisos ( <code>chmod 400 my-ec2-ssh-key.pem</code> ).  Guarde la clave en un lugar seguro o <code>~/.ssh/</code> en su carpeta <code>~/.ssh/</code> . <br><br><pre> <code class="bash hljs">localhost:~$ ssh -i ~/.ssh/my-ec2-key.pem ubuntu@my-ec2-public</code> </pre> <br>  La <b>opci√≥n -i</b> simplemente le dice al cliente ssh que use este modificador.  El archivo <code>~/.ssh/config</code> es ideal para configurar autom√°ticamente el uso de la clave cuando se conecta al host ec2. <br><br><pre> <code class="bash hljs">Host my-ec2-public Hostname ec2???.compute-1.amazonaws.com User ubuntu IdentityFile ~/.ssh/my-ec2-key.pem</code> </pre> <br><a name="15"></a><h3>  15. Edici√≥n de archivos de texto usando VIM a trav√©s de ssh / scp </h3><br>  Para todos los amantes de <code>vim</code> , este consejo les ahorrar√° un poco de tiempo.  Usando <code>vim</code> archivos se editan usando scp con un solo comando.  Este m√©todo simplemente crea el archivo localmente en <code>/tmp</code> y luego lo copia de nuevo una vez que lo guardamos de <code>vim</code> . <br><br><pre> <code class="bash hljs">localhost:~$ vim scp://user@remoteserver//etc/hosts</code> </pre> <br>  Nota: el formato es ligeramente diferente del <code>scp</code> normal.  Despu√©s del host, tenemos doble <code>//</code> .  Este es un enlace a la ruta absoluta.  Una barra oblicua significar√° la ruta relativa a la carpeta de inicio de los <code>users</code> . <br><br><pre> <code class="bash hljs">**warning** (netrw) cannot determine method (format: protocol://[user@]hostname[:port]/[path])</code> </pre> <br>  Si ve este error, verifique dos veces el formato del comando.  Esto generalmente significa un error de sintaxis. <br><br><a name="16"></a><h3>  16. Montaje de SSH remoto como una carpeta local con SSHFS </h3><br>  Usando <code>sshfs</code> , el cliente del sistema de archivos <code>ssh</code> , podemos conectar el directorio local a una ubicaci√≥n remota con todas las interacciones de archivos en una sesi√≥n <code>ssh</code> encriptada. <br><br><pre> <code class="bash hljs">localhost:~$ apt install sshfs</code> </pre> <br>  Instalamos el paquete <code>sshfs</code> en Ubuntu y Debian, y luego simplemente montamos la ubicaci√≥n remota en nuestro sistema. <br><br><pre> <code class="bash hljs">localhost:~$ sshfs user@remoteserver:/media/data ~/data/</code> </pre> <br><a name="17"></a><h3>  17. Multiplexaci√≥n SSH con ControlPath </h3><br>  De manera predeterminada, si tiene una conexi√≥n existente al servidor remoto mediante <code>ssh</code> segunda conexi√≥n mediante <code>ssh</code> o <code>scp</code> establece una nueva sesi√≥n con autenticaci√≥n adicional.  La opci√≥n <code>ControlPath</code> permite usar una sesi√≥n existente para todas las conexiones posteriores.  Esto acelerar√° significativamente el proceso: el efecto es notable incluso en la red local, y a√∫n m√°s cuando est√° conectado a recursos remotos. <br><br><pre> <code class="bash hljs">Host remoteserver HostName remoteserver.example.org ControlMaster auto ControlPath ~/.ssh/control/%r@%h:%p ControlPersist 10m</code> </pre> <br>  ControlPath le dice al socket que busque nuevas conexiones para una sesi√≥n <code>ssh</code> activa.  La √∫ltima opci√≥n significa que incluso despu√©s de salir de la consola, la sesi√≥n existente permanecer√° abierta durante 10 minutos, por lo que durante este tiempo puede volver a conectarse al socket existente.  Consulte la ayuda de <code>ssh_config man</code> para obtener m√°s informaci√≥n. <br><br><a name="18"></a><h3>  18. Transmisi√≥n de video a trav√©s de SSH usando VLC y SFTP </h3><br>  Incluso los usuarios antiguos de <code>ssh</code> y <code>vlc</code> (Video Lan Client) no siempre conocen esta conveniente opci√≥n cuando realmente necesitan ver videos en la red.  En la configuraci√≥n <b>Archivo |</b>  <b>El programa Open Network Stream</b> <code>vlc</code> puede ingresar la ubicaci√≥n como <code>sftp://</code> .  Si se requiere una contrase√±a, aparece un mensaje. <br><br><pre> <code class="bash hljs">sftp://remoteserver//media/uploads/myvideo.mkv</code> </pre> <br><a name="19"></a><h3>  19. Autenticaci√≥n de dos factores </h3><br>  La misma autenticaci√≥n de dos factores que su cuenta bancaria o cuenta de Google se aplica al servicio SSH. <br><br>  Por supuesto, <code>ssh</code> inicialmente tiene una funci√≥n de autenticaci√≥n de dos factores, lo que significa la contrase√±a y la clave SSH.  La ventaja de un token de hardware o una aplicaci√≥n Google Authenticator es que generalmente es un dispositivo f√≠sico diferente. <br><br>  Consulte nuestra gu√≠a de 8 minutos sobre el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uso de Google Authenticator y SSH</a> . <br><br><a name="20"></a><h3>  20. Host saltando con ssh y -J </h3><br>  Si, debido a la segmentaci√≥n de la red, tiene que cruzar varios hosts ssh para llegar a la red de destino final, el acceso directo -J le ahorrar√° tiempo. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -J host1,host2,host3 user@host4.internal</code> </pre> <br>  Lo principal que hay que entender aqu√≠ es que esto no es an√°logo al <code>ssh host1</code> , luego <code>user@host1:~$ ssh host2</code> , etc. El par√°metro -J usa inteligentemente el reenv√≠o para que localhost establezca una sesi√≥n con el siguiente host en la cadena.  Por lo tanto, en el ejemplo anterior, nuestro localhost se autentica en host4.  Es decir, se utilizan nuestras claves de localhost, y la sesi√≥n de localhost a host4 est√° totalmente encriptada. <br><br>  Para hacer esto, especifique la opci√≥n de configuraci√≥n <b>proxyJump</b> en <b>ssh_config</b> .  Si regularmente tiene que pasar por varios hosts, la automatizaci√≥n a trav√©s de la configuraci√≥n le ahorrar√° mucho tiempo. <br><br><a name="21"></a><h3>  21. Bloqueo de intentos de fuerza bruta SSH usando iptables </h3><br>  Cualquiera que haya ejecutado el servicio SSH y haya revisado los registros sabe sobre la cantidad de intentos de fuerza bruta que ocurren cada hora todos los d√≠as.  Una forma r√°pida de reducir el ruido en los registros es migrar SSH a un puerto no est√°ndar.  Realice cambios en el archivo <code>sshd_config</code> utilizando el par√°metro de configuraci√≥n <b>Port ##</b> . <br><br>  Usando <code>iptables</code> , tambi√©n puede bloquear f√°cilmente los intentos de conectarse a un puerto despu√©s de alcanzar un cierto umbral.     ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OSSEC</a> ,      SSH,             (HIDS). <br><br><a name="22"></a><h3> 22. SSH Escape     </h3><br>     <code>ssh</code>            <code>ssh</code> .   .    ; ,            ,    Microsoft SMB   Windows 2003 (-  ms08-67?). <br><br>  <code>enter</code> ,     <code>~C</code> .     ,      . <br><br><pre> <code class="bash hljs">localhost:~$ ~C ssh&gt; -h Commands: -L[bind_address:]port:host:hostport Request <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -R[bind_address:]port:host:hostport Request remote forward -D[bind_address:]port Request dynamic forward -KL[bind_address:]port Cancel <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -KR[bind_address:]port Cancel remote forward -KD[bind_address:]port Cancel dynamic forward ssh&gt; -L 1445:remote-win2k3:445 Forwarding port.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠ puede ver que redirigimos nuestro puerto local 1445 al host de Windows 2003 que encontramos en la red interna. </font><font style="vertical-align: inherit;">Ahora solo ejec√∫telo </font></font><code>msfconsole</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y puede continuar (suponiendo que planea usar este host).</font></font><br><br><h1>  Finalizaci√≥n </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estos ejemplos, consejos y comandos </font></font><code>ssh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deber√≠an proporcionar un punto de partida; </font><font style="vertical-align: inherit;">M√°s informaci√≥n acerca de cada uno de los comandos y funciones disponibles en las p√°ginas de ayuda ( </font></font><code>man ssh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>man ssh_config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>man sshd_config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Siempre me ha fascinado la capacidad de acceder a los sistemas y ejecutar comandos en cualquier parte del mundo. </font><font style="vertical-align: inherit;">Desarrollar tus habilidades para trabajar con herramientas como </font></font><code>ssh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√∫ ser√° m√°s efectivo en cualquier juego que juegues.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435546/">https://habr.com/ru/post/es435546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435536/index.html">Robots humanoides: beneficios y problemas de los mecanismos antropom√≥rficos.</a></li>
<li><a href="../es435538/index.html">En 2018, se recibi√≥ m√°s energ√≠a "verde" en Alemania que la electricidad de la combusti√≥n de carb√≥n</a></li>
<li><a href="../es435540/index.html">Nuevas palabras clave en Java</a></li>
<li><a href="../es435542/index.html">Desarrollo del juego y defensa de un diploma o "C√≥mo mat√© a dos p√°jaros con un primer panqueque de piedra"</a></li>
<li><a href="../es435544/index.html">Empleado de la Universidad de Innopolis recibi√≥ una beca de Facebook</a></li>
<li><a href="../es435548/index.html">Hackear servicios p√∫blicos: posible, si es realmente necesario</a></li>
<li><a href="../es435550/index.html">GitLab 11.6 lanzado con funciones sin servidor y cl√∫steres de Kubernetes para grupos</a></li>
<li><a href="../es435552/index.html">Sustituci√≥n de importaciones: epitafio de la digitalizaci√≥n</a></li>
<li><a href="../es435556/index.html">Mudarse al centro de datos: c√≥mo fue</a></li>
<li><a href="../es435558/index.html">Prueba de PostgreSQL con HugePages en Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>