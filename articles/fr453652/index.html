<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍💼 🧔🏾 👩🏿‍🍳 LogRock: test via la journalisation 🛕 🧙🏻 👩🏾‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="LogRock: test via la journalisation 
 Depuis plus de 2 ans, nous travaillons sur notre projet Cleverbrush . Il s'agit d'un logiciel pour travailler av...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LogRock: test via la journalisation</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453652/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a0/8fe/e87/0a08fee87984969110aef2080f4687ae.png" alt="Logrock"></div><br><h2>  LogRock: test via la journalisation </h2><br>  Depuis plus de 2 ans, nous travaillons sur notre projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cleverbrush</a> .  Il s'agit d'un logiciel pour travailler avec des graphiques vectoriels.  Travailler avec un éditeur graphique implique un grand nombre de cas d'utilisation d'application.  Nous essayons de gagner du temps et de l'argent, nous optimisons donc tout, y compris les tests.  Couvrir les cas de test avec chaque option est trop cher et irrationnel, d'autant plus qu'il est impossible de couvrir toutes les options. <br><br>  Pendant le développement, un module pour les applications React JS a été créé - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LogRock (github)</a> . <br><br>  Ce module vous permet d'organiser des applications de journalisation modernes.  Sur la base des journaux, nous effectuons des tests.  Dans cet article, je vais vous expliquer les subtilités de l'utilisation de ce module et comment organiser les tests via la journalisation. <br><a name="habracut"></a><br><h2>  Quel est le problème? </h2><br>  Si vous comparez le programme avec un organisme vivant, un bogue est une maladie.  La cause de cette "maladie" peut être un certain nombre de facteurs, y compris l'environnement d'un utilisateur particulier.  Cela est particulièrement vrai si nous envisageons une plate-forme Web.  Parfois, une relation causale est très complexe et le bogue détecté lors des tests est le résultat d'un certain nombre d'événements. <br><br>  Comme pour les maladies humaines, personne n'expliquera mieux ses symptômes que le patient, aucun testeur ne pourra dire ce qui s'est passé, mieux que le programme lui-même. <br><br><h2>  Que faire? </h2><br>  Pour comprendre ce qui se passe, nous avons besoin d'une liste d'actions que l'utilisateur a effectuées dans notre application. <br><br>  Pour que notre programme lui-même puisse nous dire ce qu'il «fait mal», nous prendrons le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LogRock (github)</a> et l'associerons à ElasticSearch, LogStash et Kibana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d4/1d6/7ea/6d41d67ea5bd247827fd03948fc8b0dd.png" alt="image"></div><br>  <b>ElasticSearch</b> est un puissant moteur de recherche en texte intégral.  Vous pouvez regarder le didacticiel ElasticSearch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  <b>LogStash</b> est un système de collecte de journaux provenant de diverses sources, qui peut envoyer des journaux, y compris à ElasticSearch. <br>  <b>Kibana</b> est une interface Web pour ElasticSearch avec de nombreux modules complémentaires. <br><br><h2>  Comment ça marche? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dcf/06e/706/dcf06e706a5ae052a2f15eaf09e45c93.png" alt="image"></div><br>  En cas d'erreur (ou juste sur demande), l'application envoie des journaux au serveur où ils sont enregistrés dans un fichier.  Logstash enregistre de manière incrémentielle les données dans ElasticSearch - dans la base de données.  L'utilisateur se connecte à Kibana et voit les journaux enregistrés. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e19/0b0/244/e190b0244b22db314385b5156e5c56cd.png" alt="image"></div><br>  Il ressemble à un Kibana bien réglé.  Il affiche les données d'ElasticSearch.  Kibana peut afficher des données sous forme de tableaux, graphiques, cartes, etc., ce qui est très pratique pour analyser et comprendre ce qui se passe avec notre application. <br><br>  <b><u>Dans cet article, je ne discuterai PAS de la configuration d'ElasticStack!</u></b> <br><br><h2>  Création d'un système de journalisation </h2><br>  Par exemple, nous allons intégrer le système de journalisation dans une application JS d'une page écrite en React.  Peu importe le cadre sur lequel votre application sera écrite.  Je vais essayer de décrire l'approche de la construction d'un système de journal lui-même. <br><br><h3>  1. Client </h3><br><h4>  1.0 LogRock.  L'installation </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers LogRock</a> <br><br>  Pour installer, vous devez effectuer: <br><br><pre><code class="bash hljs">npm install logrock  yarn add logrock</code> </pre> <br><h4>  1.1 LogRock.  Configuration de l'application </h4><br>  Pour commencer, encapsulez notre application dans un composant <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { LoggerContainer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"logrock"</span></span>; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LoggerContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LoggerContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  LoggerContainer est un composant qui répond à vos erreurs d'application et forme une pile. <br><br>  Une pile est un objet contenant des informations sur le système d'exploitation de l'utilisateur, le navigateur, le bouton de la souris ou du clavier sur lequel vous avez appuyé et, bien sûr, le sous-tableau des actions, où toutes les actions de l'utilisateur qu'il a effectuées dans notre système sont enregistrées. <br><br>  LoggerContainer a un certain nombre de paramètres, considérez certains d'entre eux <br><br><pre> <code class="javascript hljs">&lt;LoggerContainer active={<span class="hljs-literal"><span class="hljs-literal">true</span></span>|<span class="hljs-literal"><span class="hljs-literal">false</span></span>} limit={<span class="hljs-number"><span class="hljs-number">20</span></span>} onError={stack =&gt; { sendToServer(stack); }} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LoggerContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  actif - activer ou désactiver l'enregistreur <br><br>  limit - définit une limite sur le nombre d'actions récentes enregistrées par l'utilisateur.  Si l'utilisateur effectue 21 actions, la première de ce tableau sera automatiquement supprimée.  Ainsi, nous aurons les 20 dernières actions qui ont précédé l'erreur. <br><br>  onError - le rappel qui est appelé lorsqu'une erreur se produit.  L'objet Stack y entre, dans lequel sont stockées toutes les informations sur l'environnement, les actions de l'utilisateur, etc.  C'est à partir de ce rappel que nous devons envoyer ces données à ElasticSearch ou au backend, ou les enregistrer dans un fichier pour une analyse et une surveillance supplémentaires. <br><br><h4>  1.2 LogRock.  Journalisation </h4><br>  Afin d'effectuer une journalisation de haute qualité des actions des utilisateurs, nous devrons couvrir notre code avec des appels de journal. <br><br>  Le module LogRock est livré avec un enregistreur associé à un LoggerContainer <br><br>  Supposons que nous ayons un composant <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [toggleState, setToggleState] = useState(<span class="hljs-string"><span class="hljs-string">"off"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setToggleState(toggleState === <span class="hljs-string"><span class="hljs-string">"off"</span></span> ? <span class="hljs-string"><span class="hljs-string">"on"</span></span> : <span class="hljs-string"><span class="hljs-string">"off"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">switch</span></span></span></span><span class="xml"><span class="hljs-tag"> ${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">toggleState</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{toggle}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; }</span></span></code> </pre> <br>  Afin de le couvrir correctement avec un journal, nous devons modifier la méthode de basculement <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = toggleState === <span class="hljs-string"><span class="hljs-string">"off"</span></span> ? <span class="hljs-string"><span class="hljs-string">"on"</span></span> : <span class="hljs-string"><span class="hljs-string">"off"</span></span>; logger.info(<span class="hljs-string"><span class="hljs-string">`React.Toggle|Toggle component changed state </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${state}</span></span></span><span class="hljs-string">`</span></span>); setToggleState(state); }</code> </pre> <br>  Nous avons ajouté un enregistreur dans lequel les informations sont divisées en 2 parties.  React.Toggle nous montre que cette action s'est produite au niveau de React, le composant Toggle, puis nous avons une explication verbale de l'action et de l'état actuel qui est entré dans ce composant.  Une telle séparation en niveaux n'est pas nécessaire, mais avec cette approche, il sera plus clair où exactement notre code a été exécuté. <br><br>  On peut également utiliser la méthode «componentDidCatch», introduite dans React version 16, en cas d'erreur. <br><br><h4>  2. Interaction avec le serveur </h4><br>  Prenons l'exemple suivant. <br><br>  Supposons que nous ayons une méthode qui collecte des données utilisateur à partir d'un backend.  La méthode est asynchrone, une partie de la logique est cachée dans le backend.  Comment enregistrer correctement ce code? <br><br>  Tout d'abord, comme nous avons une application cliente, toutes les requêtes envoyées au serveur passeront par une seule session utilisateur, sans recharger la page.  Afin d'associer des actions sur le client à des actions sur le serveur, nous devons créer un SessionID global et l'ajouter à l'en-tête de chaque demande au serveur.  Sur le serveur, nous pouvons utiliser n'importe quel enregistreur qui couvrira notre logique comme un exemple du frontend, et en cas d'erreur envoyer ces données avec le sessionID attaché à Elastic vers la plaque Backend. <br><br>  1. Nous générons SessionID sur le client <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.SESSION_ID = <span class="hljs-string"><span class="hljs-string">`sessionid-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">Math</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.random().toString(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">36</span></span></span></span><span class="hljs-string"><span class="hljs-subst">).substr(</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">3</span></span></span></span><span class="hljs-string"><span class="hljs-subst">, </span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">9</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">`</span></span>;</code> </pre> <br>  2. Nous devons définir le SessionID pour toutes les demandes au serveur.  Si nous utilisons des bibliothèques pour les requêtes, c'est très simple en déclarant un SessionID pour toutes les requêtes. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fetch = axios.create({...}); fetch.defaults.headers.common.sessionId = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.SESSION_ID;</code> </pre> <br>  3. Dans LoggerContainer, il y a un champ spécial pour SessionID <br><br><pre> <code class="javascript hljs">&lt;LoggerContainer active={<span class="hljs-literal"><span class="hljs-literal">true</span></span>|<span class="hljs-literal"><span class="hljs-literal">false</span></span>} sessionID={<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.SESSION_ID} limit={<span class="hljs-number"><span class="hljs-number">20</span></span>} onError={stack =&gt; { sendToServer(stack); }} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LoggerContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  4. La demande elle-même (sur le client) ressemblera à ceci: <br><br><pre> <code class="javascript hljs">logger.info(<span class="hljs-string"><span class="hljs-string">`store.getData|User is ready for loading... User ID is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">`</span></span>); getData(<span class="hljs-string"><span class="hljs-string">'/api/v1/user'</span></span>, { id }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userData</span></span></span><span class="hljs-function"> =&gt;</span></span> { logger.info(<span class="hljs-string"><span class="hljs-string">`store.getData|User have already loaded. User count is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">JSON</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.stringify(userData)}</span></span></span><span class="hljs-string">`</span></span>); }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function"> =&gt;</span></span> { logger.error(<span class="hljs-string"><span class="hljs-string">`store.getData|User loaded fail </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${err.message}</span></span></span><span class="hljs-string">`</span></span>); });</code> </pre> <br>  Comment tout cela fonctionnera: nous enregistrons un journal, avant la demande sur le client.  Selon notre code, nous voyons que le chargement des données depuis le serveur va maintenant commencer.  Nous avons joint un SessionID à la demande.  Si notre backend est couvert de journaux avec l'ajout de ce SessionID et que la demande échoue, nous pouvons voir ce qui s'est passé sur le backend. <br><br>  Ainsi, nous surveillons l'ensemble du cycle de notre application, non seulement sur le client, mais aussi sur le backend. <br><br><h4>  3. Le testeur </h4><br>  Travailler avec un testeur mérite une description séparée du processus. <br><br>  Puisque nous avons une startup, nous n'avons pas d'exigences formelles et parfois tout n'est pas logique au travail. <br><br>  Si le testeur ne comprend pas le comportement, c'est un cas qui doit au moins être pris en considération.  De plus, souvent, un testeur ne peut tout simplement pas répéter deux fois une situation.  Étant donné que les étapes conduisant à un comportement incorrect peuvent être nombreuses et non triviales.  De plus, toutes les erreurs n'entraînent pas des conséquences critiques, telles que l'exception.  Certains d'entre eux ne peuvent que modifier le comportement de l'application, mais ne peuvent pas être interprétés par le système comme une erreur.  À ces fins, lors du transfert, vous pouvez ajouter un bouton dans l'en-tête de l'application pour forcer l'envoi de journaux.  Le testeur constate que quelque chose ne fonctionne pas correctement, clique sur le bouton et envoie la pile avec des actions à ElasticSearch. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/553/154/7f0/5531547f03a044eda98449e829d67839.png" alt="image"></div><br><br>  Si, néanmoins, une erreur critique s'est produite, il faut bloquer l'interface pour que le testeur ne clique plus et n'atteigne pas une impasse. <br><br>  À ces fins, nous affichons l'écran bleu de la mort. <br><br>  Nous voyons en haut le texte avec Pile de cette erreur critique, et ci-dessous - les actions qui l'ont précédé.  Nous obtenons également l'ID d'erreur, il suffit que le testeur le sélectionne et le joigne au ticket.  Plus tard, cette erreur peut être facilement trouvée dans Kibana par cet ID. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f3/5b8/4b7/7f35b84b746e584111ce64e6416e1f36.png" alt="image"></div><br>  À ces fins, LoggerContainer a ses propres propriétés. <br><br><pre> <code class="javascript hljs">&lt;LoggerContainer active={<span class="hljs-literal"><span class="hljs-literal">true</span></span>|<span class="hljs-literal"><span class="hljs-literal">false</span></span>} limit={<span class="hljs-number"><span class="hljs-number">20</span></span>} bsodActive={<span class="hljs-literal"><span class="hljs-literal">true</span></span>} bsod={BSOD} onError={stack =&gt; { sendToServer(stack); }} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LoggerContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  bsodActive - active / désactive BSOD (la désactivation de BSOD s'applique au code de production) <br><br>  bsod est un composant.  Par défaut, cela ressemble à la capture d'écran ci-dessus. <br><br>  Pour afficher un bouton dans un UI LoggerContainer, nous pouvons utiliser en contexte <br><br><pre> <code class="javascript hljs">context.logger.onError(context.logger.getStackData());</code> </pre> <br><h4>  4. LogRock.  Interaction utilisateur </h4><br>  Vous pouvez générer des journaux sur la console ou les montrer à l'utilisateur, pour cela, vous devez utiliser la méthode stdout: <br><br><pre> <code class="javascript hljs">&lt;LoggerContainer active={<span class="hljs-literal"><span class="hljs-literal">true</span></span>|<span class="hljs-literal"><span class="hljs-literal">false</span></span>} limit={<span class="hljs-number"><span class="hljs-number">20</span></span>} bsodActive={<span class="hljs-literal"><span class="hljs-literal">true</span></span>} bsod={BSOD} onError={stack =&gt; { sendToServer(stack); }} stdout={(level, message, important) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>[level](message); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (important) { alert(message); } }} &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LoggerContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  stdout est une méthode chargée d'afficher les messages. <br><br>  Pour que le message devienne important, il suffit de transmettre le deuxième paramètre vrai à l'enregistreur.  Ainsi, ce message peut être affiché à l'utilisateur dans une fenêtre pop-up, par exemple, si le chargement des données a échoué, nous pouvons afficher un message d'erreur. <br><br><pre> <code class="javascript hljs">logger.log(<span class="hljs-string"><span class="hljs-string">'Something was wrong'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre> <br><h3>  Journalisation avancée </h3><br>  Si vous utilisez Redux, ou des solutions similaires avec un magasin, vous pouvez mettre l'enregistreur dans le middleware pour traiter vos actions, ainsi, toutes les actions importantes passeront par notre système. <br><br>  Pour une journalisation efficace, vous pouvez encapsuler vos données dans un objet proxy et placer des enregistreurs sur toutes les actions avec l'objet. <br><br>  Pour couvrir les méthodes tierces avec la journalisation (méthodes de bibliothèque, méthodes de code héritées), vous pouvez utiliser des décorateurs - «@». <br><br><h3>  Astuces </h3><br>  Connectez les applications, y compris en production, car mieux que les vrais utilisateurs, aucun testeur ne trouvera de goulots d'étranglement. <br><br>  N'oubliez pas d'indiquer la collecte des journaux dans le contrat de licence. <br><br>  <b>NE PAS enregistrer les mots de passe, les coordonnées bancaires et autres informations personnelles!</b> <br><br>  La redondance des journaux est également mauvaise, rendez les signatures aussi claires que possible. <br><br><h3>  Alternatives </h3><br>  Comme approches alternatives, je souligne: <br><br><ul><li>  Rollbar est hautement personnalisable.  Vous permet d'enregistrer 500 000 erreurs pour 150 $ par mois.  Je recommande de l'utiliser si vous développez une application à partir de zéro. </li><li>  Sentry est plus facile à intégrer, mais moins personnalisable.  Vous permet d'enregistrer 1 million d'événements pour 200 $ par mois. </li></ul><br>  Les deux services vous permettent de faire presque la même chose et de vous intégrer dans le backend. <br><br><h3>  Et ensuite </h3><br>  La journalisation n'est pas seulement la recherche d'erreurs, elle surveille également les actions des utilisateurs, la collecte de données.  La journalisation peut être un bon complément aux tests de Google Analytics et de l'expérience utilisateur. <br><br><h3>  Conclusions </h3><br>  Lorsque vous sortez l'application, la vie ne fait que commencer pour lui.  Soyez responsable de votre idée, obtenez des commentaires, surveillez les journaux et améliorez-les.  Écrivez des logiciels de haute qualité et prospérez :) <br><br>  PS Si vous souhaitez aider au développement de modules pour Angular, Vue, etc.  Je serai heureux de tirer des demandes - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453652/">https://habr.com/ru/post/fr453652/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453634/index.html">École d'analyse système d'Alfa Bank</a></li>
<li><a href="../fr453642/index.html">Analyseur intelligent pour un nombre écrit en mots</a></li>
<li><a href="../fr453644/index.html">Interview - 10 questions sur Swift. 3e partie</a></li>
<li><a href="../fr453646/index.html">Normalisation des données dans une base de données distribuée, des microservices et un ERP</a></li>
<li><a href="../fr453650/index.html">Noyau logiciel de la cyber-infrastructure embarquée du chasseur d'attaque unifié F-35</a></li>
<li><a href="../fr453656/index.html">Web statique: retour aux sources?</a></li>
<li><a href="../fr453660/index.html">Intel dévoile son nouveau processeur i9-9900KS avec une fréquence Turbo de 5 GHz par cœur</a></li>
<li><a href="../fr453662/index.html">Mars - encore plus de glace au pôle Nord, mais profonde</a></li>
<li><a href="../fr453664/index.html">Spring Boot - OAuth2 et JWT</a></li>
<li><a href="../fr453666/index.html">Comment je conduisais un taxi sans pilote</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>