<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïã ü•• ‚ò£Ô∏è Como funciona o p√¢nico em Rust ü§µ üíï ü¶Å</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como funciona o Rust Panic 


 O que exatamente acontece quando voc√™ chama panic!() ? 
 Recentemente, passei muito tempo estudando as partes da biblio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como funciona o p√¢nico em Rust</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482358/"><h1 id="kak-rabotaet-panika-v-rust">  Como funciona o Rust Panic </h1><br><p> O que exatamente acontece quando voc√™ chama <code>panic!()</code> ? <br>  Recentemente, passei muito tempo estudando as partes da biblioteca padr√£o associadas a isso, e a resposta √© bastante complicada! </p><br><p>  N√£o consegui encontrar documentos explicando a imagem geral do p√¢nico no Rust, ent√£o vale a pena anotar. </p><a name="habracut"></a><br><p>  (Artigo vergonhoso: O motivo pelo qual me interessei neste t√≥pico √© que o <code>@Aaron1011</code> implementou o suporte para desenrolamento de pilha no Miri. </p><br><p>  Eu queria ver isso em Miri desde tempos imemoriais, e nunca tive tempo para implement√°-lo, ent√£o foi realmente √≥timo ver como algu√©m simplesmente envia <code>PR</code> para apoiar isso do nada. </p><br><p>  Ap√≥s v√°rias rodadas de verifica√ß√£o do c√≥digo, ele foi injetado recentemente. </p><br><p>  Ainda existem <a href="https://github.com/rust-lang/miri/issues%3Fq%3Dis%253Aissue%2Bis%253Aopen%2Blabel%253AA-panics">algumas arestas</a> , mas o b√°sico est√° bem definido.) </p><br><p>  O objetivo deste artigo √© documentar a estrutura de alto n√≠vel e as interfaces relacionadas que entram em jogo no lado do Rust. </p><br><p>  O mecanismo real de desenrolamento de pilhas √© uma quest√£o completamente diferente (da qual n√£o estou autorizado a falar). </p><br><p>  <em>Nota:</em> este artigo descreve o p√¢nico <a href="https://github.com/rust-lang/rust/commit/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8">desse commit</a> . </p><br><p>  Muitas das interfaces descritas aqui s√£o internas inst√°veis ‚Äã‚Äãdo libstd e podem mudar a qualquer momento. </p><br><h2 id="vysokourovnevaya-struktura">  Estrutura de alto n√≠vel </h2><br><p>  Tentando entender como o p√¢nico funciona enquanto l√™ o c√≥digo no libstd, voc√™ pode facilmente se perder no labirinto. <br>  Existem v√°rios n√≠veis de indire√ß√£o que s√£o conectados apenas pelo vinculador, <br>  existe <a href="https://doc.rust-lang.org/nomicon/panic-handler.html"><code> #[panic_handler]</code></a> e um <a href="">"runtime panic handler"</a> (controlado pela <em>estrat√©gia de</em> p√¢nico definida por <code>-C panic</code> ) e <a href="https://doc.rust-lang.org/std/panic/fn.set_hook.html">"panic traps"</a> , e acontece que o p√¢nico no contexto de <code>#[no_std]</code> exige um caminho de c√≥digo completamente diferente ... muito muita coisa acontecendo. </p><br><p>  Pior ainda, a <a href="">RFC que descreve armadilhas de p√¢nico os</a> chama de "manipulador de p√¢nico", mas o termo foi redefinido desde ent√£o. </p><br><p>  Eu acho que o melhor lugar para come√ßar √© com interfaces que controlam duas dire√ß√µes: </p><br><ul><li><p>  <em>O manipulador de p√¢nico de tempo de execu√ß√£o √©</em> usado pelo libstd para controlar o que acontece depois que as informa√ß√µes de p√¢nico s√£o impressas no stderr. <br>  Isso √© determinado pela <em>estrat√©gia de</em> p√¢nico: ou interrompemos ( <code>-C panic=abort</code> ) ou iniciamos o desenrolamento da pilha ( <code>-C panic=unwind</code> ). <br>  (A manipula√ß√£o do p√¢nico em tempo de execu√ß√£o tamb√©m fornece uma implementa√ß√£o para <a href="https://doc.rust-lang.org/std/panic/fn.catch_unwind.html"><code>catch_unwind</code></a> , mas n√£o falaremos sobre isso aqui.) </p><br></li><li><p>  <em>O manipulador de p√¢nico √©</em> usado pelo libcore para implementar (a) o p√¢nico inserido pela gera√ß√£o de c√≥digo (como p√¢nico causado por estouro aritm√©tico ou indexa√ß√£o de array / fatia fora dos limites) e (b) <code>core::panic!</code>  macro (esta √© uma macro de <code>panic!</code> na pr√≥pria libcore e no contexto <code>#[no_std]</code> ). </p><br></li></ul><br><p>  Ambas as interfaces s√£o implementadas atrav√©s de blocos <code>extern</code> : listd / libcore, respectivamente, simplesmente importam algumas fun√ß√µes que eles delegam e, em algum outro lugar na √°rvore de caixas, essa fun√ß√£o √© implementada. </p><br><p>  A importa√ß√£o √© permitida apenas durante a liga√ß√£o;  Observando localmente o c√≥digo, n√£o se pode dizer onde mora a implementa√ß√£o real da interface correspondente. <br>  N√£o √© de surpreender que eu tenha me perdido v√°rias vezes ao longo do caminho. </p><br><p>  No futuro, essas duas interfaces ser√£o muito √∫teis;  quando voc√™ erra.  A primeira coisa a verificar √© se voc√™ confundiu <em>o</em> manipulador de p√¢nico e o manipulador de p√¢nico em <em>tempo de execu√ß√£o</em> . <br>  (E lembre-se de que tamb√©m existem <em>interceptadores de</em> p√¢nico, chegaremos a eles.) <br>  Isso acontece comigo o tempo todo. </p><br><p>  Al√©m disso, <code>core::panic!</code>  e <code>std::panic!</code>  <em>n√£o √© o</em> mesmo;  como veremos, eles usam caminhos de c√≥digo completamente diferentes. </p><br><p>  libcore e libstd implementam sua pr√≥pria maneira de causar p√¢nico: </p><br><ul><li><p> <code>core::panic!</code>  O libcore √© muito pequeno: delega imediatamente o p√¢nico ao <em>manipulador</em> . </p><br></li><li><p>  libstd <code>std::panic!</code>  (O <code>panic!</code> "normal" <code>panic!</code> in Rust) lan√ßa um mecanismo de p√¢nico totalmente funcional que fornece uma <a href="https://doc.rust-lang.org/std/panic/fn.set_hook.html"><em>intercepta√ß√£o de</em> p√¢nico</a> controlada pelo usu√°rio. <br>  O gancho padr√£o exibir√° uma mensagem de p√¢nico no stderr. <br>  Ap√≥s a conclus√£o da fun√ß√£o de intercepta√ß√£o, a libstd a delega ao manipulador de p√¢nico em <em>tempo de execu√ß√£o</em> . </p><br><p>  A libstd tamb√©m fornece <em>um manipulador de</em> p√¢nico que chama o mesmo mecanismo, ent√£o <code>core::panic!</code>  tamb√©m termina aqui. </p><br></li></ul><br><p>  Vamos agora examinar essas partes com mais detalhes. </p><br><h2 id="obrabotka-paniki-vo-vremya-vypolneniya-programmy">  Lidar com p√¢nico durante a execu√ß√£o do programa </h2><br><p>  <a href="">A interface para o panic runtime</a> (representado por <a href="">este RFC</a> ) √© a fun√ß√£o <code>__rust_start_panic(payload: usize) -&gt; u32</code> que √© importada pelo libstd e posteriormente resolvida pelo vinculador. </p><br><p>  O argumento <code>usize</code> aqui √© realmente <code>*mut &amp;mut dyn core::panic::BoxMeUp</code> - √© aqui que <code>*mut &amp;mut dyn core::panic::BoxMeUp</code> ‚Äúdados √∫teis‚Äù do p√¢nico (informa√ß√µes dispon√≠veis quando s√£o detectadas). </p><br><p>  <code>BoxMeUp</code> √© um detalhe inst√°vel da implementa√ß√£o interna, mas, <a href="">olhando para esse tipo,</a> vemos que tudo o que realmente faz √© quebrar o <code>dyn Any + Send</code> , que √© o <a href="https://doc.rust-lang.org/std/thread/type.Result.html">tipo de dados de p√¢nico √∫teis</a> retornados por <code>catch_unwind</code> e <code>thread::spawn</code> . </p><br><p>  <code>BoxMeUp::box_me_up</code> retorna <code>Box&lt;dyn Any + Send&gt;</code> , mas como um ponteiro bruto (j√° que <code>Box</code> n√£o <code>Box</code> dispon√≠vel no contexto em que esse tipo est√° definido);  <code>BoxMeUp::get</code> apenas empresta o conte√∫do. </p><br><p>  Duas implementa√ß√µes dessa interface s√£o fornecidas em <a href="https://github.com/rust-lang/rust/tree/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8/src/libpanic_unwind"><code>libpanic_unwind</code></a> : <a href="https://github.com/rust-lang/rust/tree/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8/src/libpanic_unwind"><code>libpanic_unwind</code></a> para <code>-C panic=unwind</code> (padr√£o na maioria das plataformas) e <a href="https://github.com/rust-lang/rust/tree/7d761fe0462ba0f671a237d0bb35e3579b8ba0e8/src/libpanic_abort"><code>libpanic_abort</code></a> para <code>-C panic=abort</code> . </p><br><h2 id="makros-stdpanic"> <code> std::panic!</code> </h2> <br><p>  No topo da interface do panic <em>runtime</em> , o libstd implementa o mecanismo padr√£o do Rust panic no m√≥dulo interno <a href=""><code>std::panicking</code></a> . </p><br><h4 id="rust_panic_with_hook"> <code>rust_panic_with_hook</code> </h4> <br><p>  A principal fun√ß√£o atrav√©s da qual quase tudo acontece √© <a href=""><code>rust_panic_with_hook</code></a> : </p><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rust_panic_with_hook</span></span></span></span>( payload: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> dyn BoxMeUp, message: <span class="hljs-built_in"><span class="hljs-built_in">Option</span></span>&lt;&amp;fmt::Arguments&lt;<span class="hljs-symbol"><span class="hljs-symbol">'_</span></span>&gt;&gt;, file_line_col: &amp;(&amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">u32</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">u32</span></span>), ) -&gt; !</code> </pre> <br><p>  Esta fun√ß√£o aceita a localiza√ß√£o da origem do p√¢nico, uma mensagem n√£o formatada opcional (consulte a documenta√ß√£o <a href="https://doc.rust-lang.org/std/fmt/struct.Arguments.html"><code>fmt::Arguments</code></a> ) e dados √∫teis. </p><br><p>  Sua principal tarefa √© desencadear o que √© o atual interceptor de p√¢nico. <br>  Os interceptores de p√¢nico t√™m o argumento <a href="https://doc.rust-lang.org/core/panic/struct.PanicInfo.html"><code>PanicInfo</code></a> , por isso precisamos da localiza√ß√£o da fonte de p√¢nico, das informa√ß√µes de formato da mensagem de p√¢nico e de dados √∫teis. <br>  Isso corresponde muito bem ao argumento <code>rust_panic_with_hook</code> ! <br>  <code>file_line_col</code> e <code>message</code> podem ser usados ‚Äã‚Äãdiretamente para os dois primeiros elementos;  <code>payload</code> transforma em <code>&amp;(dyn Any + Send)</code> atrav√©s da interface <code>BoxMeUp</code> . </p><br><p>  Curiosamente, o interceptor de p√¢nico <em>padr√£o</em> ignora completamente a <code>message</code> ;  o que voc√™ v√™ √© converter a carga √∫til para <a href=""><code>&amp;str</code> ou <code>String</code></a> (n√£o importa o que funcione). <br>  Presumivelmente, o chamador deve se certificar de que a formata√ß√£o da <code>message</code> , se presente, produz o mesmo resultado. <br>  (E os que discutimos abaixo garantem isso.) </p><br><p>  Por fim, <code>rust_panic_with_hook</code> enviado para o manipulador de p√¢nico do <em>tempo de execu√ß√£o</em> atual. </p><br><p>  No momento, apenas a <code>payload</code> ainda √© relevante - e o que √© importante: <code>message</code> (com vida √∫til de <code>'_</code> indica que links de curta dura√ß√£o podem estar contidos, mas dados √∫teis de p√¢nico se propagam pela pilha e, portanto, com vida √∫til <code>'static</code> ). </p><br><p>  A <code>'static</code> restri√ß√£o <code>'static</code> est√° bem escondida, mas depois de um tempo percebi que <a href="https://doc.rust-lang.org/std/any/trait.Any.html"><code>Any</code></a> significa <code>'static</code> (e lembre-se de que o <code>dyn BoxMeUp</code> usado apenas para obter o <code>Box&lt;dyn Any + Send&gt;</code> ). </p><br><h4 id="tochki-vhoda-v-libstd">  Pontos de entrada Libstd </h4><br><p>  <code>rust_panic_with_hook</code> √© uma fun√ß√£o privada para <code>std::panicking</code> ;  o m√≥dulo fornece tr√™s pontos de entrada no topo dessa fun√ß√£o central e um que a ignora: </p><br><ul><li><p>  <a href="">A implementa√ß√£o padr√£o do manipulador de p√¢nico</a> que suporta (como veremos) o p√¢nico do <code>core::panic!</code>  e p√¢nico interno (de estouro aritm√©tico ou indexa√ß√£o de array / fatia). <br>  Obt√©m <a href="https://doc.rust-lang.org/core/panic/struct.PanicInfo.html"><code>PanicInfo</code></a> como entrada, e deve transformar isso em argumentos para <code>rust_panic_with_hook</code> . <br>  Curiosamente, embora os componentes <code>PanicInfo</code> e os argumentos <code>rust_panic_with_hook</code> bastante semelhantes, e parece que eles podem ser simplesmente encaminhados, n√£o √©. <br>  Em vez disso, libstd <em>ignora</em> completamente o componente de <code>payload</code> do <code>PanicInfo</code> e define a <code>payload</code> real (passada para <code>rust_panic_with_hook</code> ) para que ele contenha uma <a href=""><code> message</code></a> . </p><br><p>  Em particular, isso significa que o manipulador de p√¢nico em tempo de <em>execu√ß√£o</em> n√£o importa para aplicativos <code>no_std</code> . <br>  Ele s√≥ entra em jogo quando a implementa√ß√£o do manipulador de p√¢nico no libstd √© usada. <br>  ( <em>A estrat√©gia de</em> p√¢nico escolhida por meio do <code>-C panic</code> ainda √© importante, pois tamb√©m afeta a gera√ß√£o de c√≥digo. <br>  Por exemplo, com <code>-C panic=abort</code> c√≥digo pode se tornar mais simples, pois voc√™ n√£o precisa suportar o desenrolamento da pilha). </p><br></li><li><p>  <a href=""><code>begin_panic_fmt</code></a> , suportando a vers√£o do <a href=""><code>  std::panic!</code></a>  (ou seja, isso √© usado quando voc√™ passa v√°rios argumentos para uma macro). <br>  Basicamente, basta <code>PanicInfo</code> argumentos da string de formato no <code>PanicInfo</code> (com <a href="">cargas √∫teis</a> ) e chamar os manipuladores de p√¢nico padr√£o que acabamos de discutir. </p><br></li><li><p>  <a href=""><code>begin_panic</code></a> suportando a <a href=""><code> std::panic!</code></a>  com <a href=""><code>  std::panic!</code></a>  . <br>  Curiosamente, isso usa um caminho de c√≥digo completamente diferente dos outros dois pontos de entrada! <br>  Em particular, este √© o √∫nico ponto de entrada que permite transferir <em>dados √∫teis arbitr√°rios</em> . <br>  Essa carga √∫til √© simplesmente <a href=""><code>  Box&lt;dyn Any + Send&gt;</code></a> para que possa ser passada para <code>rust_panic_with_hook</code> , e √© isso. </p><br><p>  Em particular, um interceptador de p√¢nico que analisa o campo de <code>message</code> de <code>PanicData</code> <em>n√£o</em> poder√° ver a mensagem em <code>std::panic!("do panic")</code> , mas <em>pode</em> ver a mensagem em <code>std::panic!("panic with data: {}", data)</code> pois o √∫ltimo passa por <code>begin_panic_fmt</code> . <br>  Isso parece incr√≠vel.  (Mas observe tamb√©m que <code>PanicData::message()</code> ainda n√£o est√° est√°vel.) </p><br></li><li><p>  <a href=""><code>update_count_then_panic</code></a> acabou sendo estranho: esse ponto de entrada suporta <a href="https://doc.rust-lang.org/nightly/std/panic/fn.resume_unwind.html"><code>resume_unwind</code></a> e, na verdade, <em>n√£o</em> causa intercepta√ß√£o de p√¢nico. <br>  Em vez disso, ele √© imediatamente enviado ao manipulador de p√¢nico. <br>  Por exemplo, <code>begin_panic</code> permite ao chamador selecionar dados √∫teis arbitr√°rios. <br>  Diferentemente do <code>begin_panic</code> , a fun√ß√£o de chamada √© respons√°vel por compactar e dimensionar a carga √∫til;  A fun√ß√£o <code>update_count_then_panic</code> simplesmente encaminha seus argumentos quase literalmente para o manipulador de p√¢nico em tempo de execu√ß√£o. </p><br></li></ul><br><h2 id="obrabotchik-paniki">  Manipulador de p√¢nico </h2><br><p> <code>std::panic!</code>  O mecanismo √© realmente √∫til, mas requer colocar dados no heap atrav√©s do <code>Box</code> , que nem sempre est√° dispon√≠vel. <br>  Para dar √† libcore uma maneira de causar p√¢nico, os <a href="">manipuladores de</a> p√¢nico foram introduzidos. <br>  Como vimos, se o libstd estiver dispon√≠vel, ele fornecer√° uma implementa√ß√£o dessa interface <code>core::panic!</code>  entre em p√¢nico nas visualiza√ß√µes libstd. </p><br><p>  <a href="">A interface para o manipulador de p√¢nico</a> √© a fun√ß√£o <code>fn panic(info: &amp;core::panic::PanicInfo) -&gt; !</code>  importa√ß√µes libcore, e isso √© resolvido posteriormente pelo vinculador. <br>  O tipo <a href="https://doc.rust-lang.org/core/panic/struct.PanicInfo.html"><code>PanicInfo</code></a> √© o mesmo dos interceptadores de p√¢nico: cont√©m o local da fonte de p√¢nico, uma mensagem de p√¢nico e dados √∫teis ( <code>dyn Any + Send</code> ). <br>  A mensagem de p√¢nico √© apresentada no formato <a href="https://doc.rust-lang.org/std/fmt/struct.Arguments.html"><code>fmt::Arguments</code></a> , ou seja, uma string de formato com argumentos que ainda n√£o foram formatados. </p><br><h2 id="makros-corepanic"> <code> core::panic!</code> </h2> <br><p>  Al√©m da interface do processador de p√¢nico, a libcore fornece uma <a href="">API de p√¢nico m√≠nima</a> . <br> <a href=""><code>core::panic!</code></a>  a macro cria <code>fmt::Arguments</code> que √© <a href="">passada ao manipulador de p√¢nico</a> . <br>  A formata√ß√£o n√£o ocorre aqui, pois isso exigir√° aloca√ß√£o de mem√≥ria no heap;  √â por isso que <code>PanicInfo</code> cont√©m uma string de formato " <code>PanicInfo</code> " com seus argumentos. </p><br><p>  Curiosamente, o campo de <code>payload</code> do <code>PanicInfo</code> passado para o manipulador de p√¢nico, sempre definido como um <a href="">valor fict√≠cio</a> . <br>  Isso explica por que o manipulador de p√¢nico da libstd ignora os dados da carga √∫til (e cria novos dados de carga √∫til a partir da <code>message</code> ), mas me faz pensar por que esse campo faz parte da API do manipulador de p√¢nico. <br>  Outra conseq√º√™ncia disso √© que <a href=""><code>core::panic!("message")</code></a> e <a href=""><code>std::panic!("message")</code></a> (op√ß√µes sem formata√ß√£o) realmente levam a p√¢nico muito diferente: a primeira se transforma em <code>fmt::Arguments</code> , passados ‚Äã‚Äãpela interface do manipulador de p√¢nico e libstd cria dados <code>String</code> √∫teis, formatando-os. <br>  Este √∫ltimo, no entanto, usa diretamente <code>&amp;str</code> como dados √∫teis, e o campo de <code>message</code> permanece <code>None</code> (como j√° mencionado). </p><br><p>  Alguns elementos da API de p√¢nico no libcore s√£o elementos de linguagem porque o compilador insere chamadas para essas fun√ß√µes durante a gera√ß√£o de c√≥digo: </p><br><ul><li>  Um elemento <a href=""><code> panic</code></a> √© chamado quando o compilador precisa causar um p√¢nico que n√£o requer formata√ß√£o (por exemplo, estouro aritm√©tico);  esta √© a mesma fun√ß√£o que tamb√©m suporta <a href=""><code>core::panic!</code></a>  com um argumento <a href=""><code>core::panic!</code></a>  . </li><li>  <a href=""><code>  panic_bounds_check</code></a> √© chamado quando uma verifica√ß√£o de limite de matriz / fatia falha; chama o mesmo m√©todo que <a href=""><code>core::panic!</code></a>  <a href="">com formata√ß√£o</a> . </li></ul><br><h2 id="vyvody">  Conclus√µes </h2><br><p>  Passamos por quatro n√≠veis de API, dois dos quais foram redirecionados por meio de chamadas de fun√ß√£o importadas e resolvidos pelo vinculador. <br>  Que jornada! <br>  Mas chegamos ao fim. <br>  Espero que voc√™ <a href="https://en.wikipedia.org/wiki/Phrases_from_The_Hitchhiker%2527s_Guide_to_the_Galaxy">n√£o tenha entrado</a> em <a href="https://en.wikipedia.org/wiki/Phrases_from_The_Hitchhiker%2527s_Guide_to_the_Galaxy">p√¢nico</a> ao longo do caminho.  ;) </p><br><p>  Mencionei algumas coisas como surpreendentes. <br>  Acontece que todos eles est√£o conectados ao fato de que interceptores e processadores de p√¢nico compartilham a estrutura <code>PanicInfo</code> em sua interface, que cont√©m <em>uma</em> <code>message</code> e <code>payload</code> formatada opcionalmente com um tipo apagado: </p><br><ul><li>  <em>Um interceptador de</em> p√¢nico sempre pode encontrar uma mensagem j√° formatada na <code>payload</code> , de modo que a <code>message</code> parece in√∫til para os interceptadores.De fato, a <code>message</code> pode n√£o estar presente mesmo que a <code>payload</code> contenha uma mensagem (por exemplo, para <code>std::panic!("message")</code> ). </li><li>  <em>O manipulador de</em> p√¢nico nunca receber√° <code>payload</code> , portanto o campo parece in√∫til para os manipuladores. </li></ul><br><p>  Lendo o <a href="">RFC a partir da descri√ß√£o do manipulador de p√¢nico</a> , parece que o plano era para o <code>core::panic!</code>  tamb√©m suportam dados √∫teis arbitr√°rios, mas at√© agora isso n√£o se materializou. <br>  No entanto, mesmo com essa extens√£o futura, acho que temos uma invari√¢ncia de que quando a <code>message</code> √© <code>Some</code> , ent√£o a <code>payload == &amp;NoPayload</code> (portanto, dados √∫teis s√£o redundantes) ou a <code>payload</code> √© uma mensagem formatada (portanto, a mensagem √© redundante). </p><br><p>  Gostaria de saber se existe um caso em que <em>ambos os</em> campos ser√£o √∫teis e, se n√£o, podemos codificar isso, tornando-os duas variantes de <code>enum</code> ? </p><br><p>  Provavelmente, existem boas raz√µes contra essa proposta para o design atual;  seria √≥timo coloc√°-los em algum lugar no formato de documenta√ß√£o.  :) </p><br><p>  H√° muito mais a dizer, mas neste momento eu convido voc√™ a seguir os links para o c√≥digo-fonte que inclu√≠ acima. </p><br><p>  Com uma estrutura de alto n√≠vel em mente, voc√™ deve conseguir seguir este c√≥digo. <br>  Se as pessoas pensassem que essa revis√£o deveria ser colocada em algum lugar para sempre, eu ficaria feliz em transformar este artigo em um blog em algum tipo de documenta√ß√£o - embora eu n√£o tenha certeza se esse seria um bom lugar. </p><br><p>  E se voc√™ encontrar algum erro no que escrevi, entre em contato! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt482358/">https://habr.com/ru/post/pt482358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt482344/index.html">Prepare-se para a introdu√ß√£o de uma classifica√ß√£o social na R√∫ssia</a></li>
<li><a href="../pt482346/index.html">ASP.NET MVC - trabalhando com o MySQL atrav√©s do ADO.NET</a></li>
<li><a href="../pt482348/index.html">Topologia e an√°lise abrangente para um desenvolvedor de jogos desavisado: compactando vetores 3D √∫nicos</a></li>
<li><a href="../pt482352/index.html">Como eu quase joguei 150k no vento ou na hist√≥ria da instala√ß√£o de ventila√ß√£o for√ßada no apartamento</a></li>
<li><a href="../pt482354/index.html">ConfigureAwait: perguntas freq√ºentes</a></li>
<li><a href="../pt482360/index.html">Detetive Habra: eles s√£o amigos dos OVNIs</a></li>
<li><a href="../pt482362/index.html">Quase anarquia: uma breve hist√≥ria da Fidonet, um projeto que n√£o se importa com a vit√≥ria na Internet</a></li>
<li><a href="../pt482364/index.html">Coisas que voc√™ [talvez] n√£o sabia sobre Java</a></li>
<li><a href="../pt482366/index.html">O que os especialistas em autom√≥veis rob√≥ticos pensam sobre o Tesla Autopilot</a></li>
<li><a href="../pt482372/index.html">Habilitar o Modo de Sess√£o Aprimorado para Convidados do Arch Linux no Hyper-V</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>