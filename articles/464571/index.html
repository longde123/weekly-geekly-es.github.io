<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍿 🈲 🐺 Cerebro + VPS por 30 rublos =? 🙅🏼 👋🏻 🧗🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es agradable tener a mano todas las pequeñas cosas necesarias: un bolígrafo y un cuaderno bien escritos, un lápiz afilado, un mouse cómodo, un par de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cerebro + VPS por 30 rublos =?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/464571/">  Es agradable tener a mano todas las pequeñas cosas necesarias: un bolígrafo y un cuaderno bien escritos, un lápiz afilado, un mouse cómodo, un par de alambres adicionales, etc.  Estas cosas discretas no llaman la atención, pero agregan una vida de comodidad.  La misma historia con varias aplicaciones móviles y de escritorio: para capturas de pantalla largas, para reducir el tamaño de la imagen, para calcular las finanzas personales, diccionarios, traductores, convertidores, etc.  ¿Tiene un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VPS de este tipo</a> , que es económico, siempre a mano y ofrece muchos beneficios?  No, no el que tienes en tu empresa, sino el tuyo, "bolsillo".  Pensamos que sin un VPS pequeño en 2019 fue de alguna manera triste, al igual que sin la pluma estilográfica habitual en una conferencia.  ¿Por qué estar triste?  El verano es  Bueno, como el verano.  Verano de TI: siéntate en casa, corta los proyectos favoritos sin ningún remordimiento.  En general, pensado y hecho. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/61a/831/55f/61a83155fc8e66df2adb244c3e528b70.jpg"></a> <br>  <i><font color="#999999">El comunismo ha llegado, camaradas</font></i> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Él es suyo: nuestro VPS por treinta</font> </h2><br>  Leemos artículos de competidores y usuarios que escribieron hace 3-4 años acerca de por qué no se necesita un VPS económico.  Bueno, claro, entonces VPS "por un centavo" era pura comercialización y no podía ofrecer oportunidades de trabajo normales.  Pero los tiempos están cambiando, el costo de los recursos virtuales se está reduciendo y por 30 rublos al mes estamos listos para ofrecer esto: <br><br><ul><li>  Procesador: Intel Xeon 2 GHz (1 núcleo) </li><li>  Sistema Linux (Debian, Ubuntu, CentOS para elegir) </li><li>  1 dirección IPv4 dedicada </li><li>  10 GB para el almacenamiento de datos en SSD rápidos de clase empresarial </li><li>  RAM: 512 MB </li><li>  Facturación por segundo </li><li>  Tráfico ilimitado </li></ul><br>  La tarifa está sujeta a restricciones técnicas adicionales, detalles en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">página de</a> nuestra oferta genial - VPS por 30 rublos. <br><br>  ¿Quién debería usar un servidor virtual de este tipo?  Sí, casi todos: principiantes, entusiastas, desarrolladores experimentados, fanáticos del bricolaje e incluso algunas empresas. <br><br><h2>  <font color="#3AC1EF">¿Para qué es adecuado este VPS?</font> </h2><br>  Creemos que los lectores de Habr definitivamente encontrarán su propia forma de aplicar dicha configuración, pero decidieron armar su propia selección de ideas, si de repente alguien la necesita, pero los hombres no lo saben. <br><br><ul><li>  Publique su sitio simple, cartera, currículum con código, etc.  Por supuesto, su propio sitio web diseñado causa una impresión positiva en el empleador.  Colóquelo en su VPS y sea responsable de la seguridad y la estabilidad del sitio por su cuenta, y no del personal del alojamiento compartido. </li><li>  Use VPS con fines educativos: publique su proyecto, estudie las características del servidor y el sistema operativo del servidor, experimente con DNS, busque un pequeño sitio de capacitación. </li><li>  Para telefonía  A veces, un empresario individual, un profesional independiente o una empresa muy pequeña necesita desesperadamente la telefonía IP, y los operadores de esta telefonía son muy codiciosos.  Es simple: tomamos nuestro servidor, compramos un número del operador de telefonía IP, configuramos una PBX virtual y creamos números internos (si es necesario).  Los ahorros son colosales. </li><li>  Use un servidor para probar sus aplicaciones. </li><li>  Use el servidor para experimentos de bricolaje, incluso para administrar y recopilar datos de los sensores de un sistema doméstico inteligente. </li><li> Un método inusual de aplicación es colocar en el servidor un asistente virtual de intercambio comercial, un robot comercial.  Usted será totalmente responsable de la estabilidad y seguridad del servidor, lo que significa que obtendrá un instrumento controlado para operar en los mercados bursátiles.  Bueno, de repente alguien le gusta o planea :-) </li></ul><br>  Existe una aplicación de VPS en el campo corporativo.  Además del servicio telefónico ya mencionado, puede implementar varias piezas interesantes.  Por ejemplo: <br><br><ul><li>  Para colocar pequeñas bases de datos e información que estará disponible para los empleados que viajan a distancia, por ejemplo, utilizando ftp.  Esto le permitirá intercambiar rápidamente análisis nuevos, configuraciones actualizadas para vendedores, presentaciones, etc. </li><li>  Otorgue acceso temporal a usuarios o clientes para demostrar software o multimedia. </li></ul><br><h2>  <font color="#3AC1EF">Prueba de manejo de VPS por 30 rublos - hecho para usted</font> </h2><br>  30 rublos es tan pequeño que incluso la renuencia a obtener una tarjeta para pagar y probar.  A veces también somos muy flojos, pero esta vez hicimos todo por ti.  Antes de iniciar los servidores en la batalla, realizamos una prueba para verificar todos los detalles y mostrar de qué son capaces los servidores a esta tarifa.  Para hacerlo más interesante, agregamos deportes extremos y verificamos cómo se comporta esta configuración si la densidad y la carga exceden los valores establecidos por nosotros. <br><br>  El host estaba bajo carga de varias máquinas virtuales que realizaban diversas tareas en el procesador y utilizaban activamente el subsistema de disco.  El objetivo es simular una alta densidad de colocación y una carga comparable o mayor que la de combate. <br><br>  Además de la carga constante, instalamos 3 máquinas virtuales que recopilan métricas sintéticas utilizando sysbench, cuyos resultados promedio se detallan a continuación, y 50 máquinas virtuales que crearon una carga adicional.  Todas las máquinas virtuales de prueba tenían la misma configuración (1 núcleo, 512 GB de RAM, 10 GB de SSD), la imagen estándar de Debian 9.6, que se ofrece a los usuarios en RUVDS, fue elegida como sistema operativo. <br><br>  <b>La carga fue simulada en naturaleza y tamaño comparable al combate:</b> <br><br><ul><li>  Algunas de las máquinas virtuales se iniciaron con poca carga. </li><li>  Algunas máquinas "retorcieron" un escenario de prueba que simula la carga en el procesador (usando la utilidad de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estrés</a> ) </li><li>  En el resto de las máquinas virtuales, ejecutamos un script que usa dd para copiar datos de datos preparados previamente en el disco con un conjunto de restricciones usando pv (se pueden encontrar ejemplos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> ). </li></ul><br>  <b>Además, como recordarán, teníamos tres autos que recopilaban métricas sintéticas.</b> <br><br>  Se ejecutó una secuencia de comandos en cada máquina de forma cíclica cada 15 minutos, que ejecuta pruebas estándar de sysbench para el procesador, la memoria y el disco. <br><br><div class="spoiler">  <b class="spoiler_title">Script sysbench.sh</b> <div class="spoiler_text"><pre><code class="plaintext hljs">#!/bin/bash
date +"%Y-%m-%d %H:%M:%S" &gt;&gt; /root/sysbench/results.txt
sysbench --test=cpu run &gt;&gt; /root/sysbench/results.txt
sysbench --test=memory run &gt;&gt; /root/sysbench/results.txt
sysbench --test=fileio --file-test-mode=seqwr run &gt;&gt; /root/sysbench/results.txt
sysbench --test=fileio --file-test-mode=seqrd run &gt;&gt; /root/sysbench/results.txt
sysbench --test=fileio --file-test-mode=rndrw run &gt;&gt; /root/sysbench/results.txt</code></pre><br>
</div></div><br>
      sysbench',           ,    : <br>
<br>
<div class="spoiler"><b class="spoiler_title">Sysbanch-avg.txt</b><div class="spoiler_text"><code>sysbench 0.4.12: multi-threaded system evaluation benchmark<br>
<br>
Running the test with following options:<br>
Number of threads: 1<br>
<br>
Doing CPU performance benchmark<br>
<br>
Threads started!<br>
Done.<br>
<br>
Maximum prime number checked in CPU test: 10000<br>
<br>
Test execution summary:<br>
 total time: 19.2244s<br>
 total number of events: 10000<br>
 total time taken by event execution: 19.2104<br>
 per-request statistics:<br>
 min: 1.43ms<br>
 avg: 1.92ms<br>
 max: 47.00ms<br>
 approx. 95 percentile: 3.02ms<br>
<br>
Threads fairness:<br>
 events (avg/stddev): 10000.0000/0.00<br>
 execution time (avg/stddev): 19.2104/0.00<br>
<br>
sysbench 0.4.12: multi-threaded system evaluation benchmark<br>
<br>
Running the test with following options:<br>
Number of threads: 1<br>
<br>
Doing memory operations speed test<br>
Memory block size: 1K<br>
<br>
Memory transfer size: 102400M<br>
<br>
Memory operations type: write<br>
Memory scope type: global<br>
Threads started!<br>
Done.<br>
<br>
Operations performed: 104857600 (328001.79 ops/sec)<br>
<br>
102400.00 MB transferred (320.32 MB/sec)<br>
<br>
Test execution summary:<br>
 total time: 320.9155s<br>
 total number of events: 104857600<br>
 total time taken by event execution: 244.8399<br>
 per-request statistics:<br>
 min: 0.00ms<br>
 avg: 0.00ms<br>
 max: 139.41ms<br>
 approx. 95 percentile: 0.00ms<br>
<br>
Threads fairness:<br>
 events (avg/stddev): 104857600.0000/0.00<br>
 execution time (avg/stddev): 244.8399/0.00<br>
<br>
sysbench 0.4.12: multi-threaded system evaluation benchmark<br>
<br>
Running the test with following options:<br>
Number of threads: 1<br>
<br>
Extra file open flags: 0<br>
128 files, 16Mb each<br>
2Gb total file size<br>
Block size 16Kb<br>
Periodic FSYNC enabled, calling fsync() each 100 requests.<br>
Calling fsync() at the end of test, Enabled.<br>
Using synchronous I/O mode<br>
Doing sequential write (creation) test<br>
Threads started!<br>
Done.<br>
<br>
Operations performed: 0 Read, 131072 Write, 128 Other = 131200 Total<br>
Read 0b Written 2Gb Total transferred 2Gb (320.1Mb/sec)<br>
20251.32 Requests/sec executed<br>
<br>
Test execution summary:<br>
 total time: 6.9972s<br>
 total number of events: 131072<br>
 total time taken by event execution: 5.2246<br>
 per-request statistics:<br>
 min: 0.01ms<br>
 avg: 0.04ms<br>
 max: 96.76ms<br>
 approx. 95 percentile: 0.03ms<br>
<br>
Threads fairness:<br>
 events (avg/stddev): 131072.0000/0.00<br>
 execution time (avg/stddev): 5.2246/0.00<br>
<br>
sysbench 0.4.12: multi-threaded system evaluation benchmark<br>
<br>
Running the test with following options:<br>
Number of threads: 1<br>
<br>
Extra file open flags: 0<br>
128 files, 16Mb each<br>
2Gb total file size<br>
Block size 16Kb<br>
Periodic FSYNC enabled, calling fsync() each 100 requests.<br>
Calling fsync() at the end of test, Enabled.<br>
Using synchronous I/O mode<br>
Doing sequential read test<br>
Threads started!<br>
Done.<br>
<br>
Operations performed: 131072 Read, 0 Write, 0 Other = 131072 Total<br>
Read 2Gb Written 0b Total transferred 2Gb (91.32Mb/sec)<br>
 5844.8 Requests/sec executed<br>
<br>
Test execution summary:<br>
 total time: 23.1054s<br>
 total number of events: 131072<br>
 total time taken by event execution: 22.9933<br>
 per-request statistics:<br>
 min: 0.00ms<br>
 avg: 0.18ms<br>
 max: 295.75ms<br>
 approx. 95 percentile: 0.77ms<br>
<br>
Threads fairness:<br>
 events (avg/stddev): 131072.0000/0.00<br>
 execution time (avg/stddev): 22.9933/0.00<br>
<br>
sysbench 0.4.12: multi-threaded system evaluation benchmark<br>
<br>
Running the test with following options:<br>
Number of threads: 1<br>
<br>
Extra file open flags: 0<br>
128 files, 16Mb each<br>
2Gb total file size<br>
Block size 16Kb<br>
Number of random requests for random IO: 10000<br>
Read/Write ratio for combined random IO test: 1.50<br>
Periodic FSYNC enabled, calling fsync() each 100 requests.<br>
Calling fsync() at the end of test, Enabled.<br>
Using synchronous I/O mode<br>
Doing random r/w test<br>
Threads started!<br>
Done.<br>
<br>
Operations performed: 6000 Read, 4000 Write, 12800 Other = 22800 Total<br>
Read 93.75Mb Written 62.5Mb Total transferred 156.25Mb (1341.5Kb/sec)<br>
 85.61 Requests/sec executed<br>
<br>
Test execution summary:<br>
 total time: 152.9786s<br>
 total number of events: 10000<br>
 total time taken by event execution: 14.1879<br>
 per-request statistics:<br>
 min: 0.01ms<br>
 avg: 1.41ms<br>
 max: 210.22ms<br>
 approx. 95 percentile: 4.95ms<br>
<br>
Threads fairness:<br>
 events (avg/stddev): 10000.0000/0.00<br>
 execution time (avg/stddev): 14.1879/0.00</code></div></div><br>
 ,         QoS.&nbsp;<br>
<br>
<b>   </b><br>
<br>
:<br>
<br>
<ul>
<li>apt-get update</li>
<li>apt-get upgrade</li>
<li>apt-get install python-pip</li>
<li>pip install mysql-connector-python-rf</li>
</ul><br>
 MariaDB,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>:<br>
<br>
<pre><code class="plaintext hljs">apt-get install libmariadbclient-dev
mysql -e "INSTALL PLUGIN blackhole SONAME 'ha_blackhole.so';" --   test_employees_sha</code></pre><br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>:<br>
<br>
    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>:<br>
<br>
<pre><code class="plaintext hljs">mysql -t &lt; employees.sql
mysql -t &lt; test_employees_sha.sql</code></pre><br>
   :<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Table&nbsp;<br>
</th>
<th>RowsCount&nbsp;<br>
</th>
<th> Data size (MB)<br>
</th>
<th>Index size (KB)<br>
</th>
</tr>
<tr>
<td>departments&nbsp;<br>
</td>
<td>9<br>
</td>
<td>0.02<br>
</td>
<td>16.00<br>
</td>
</tr>
<tr>
<td>dept_emp&nbsp;<br>
</td>
<td>331143&nbsp;<br>
</td>
<td>11.52<br>
</td>
<td>5648.00<br>
</td>
</tr>
<tr>
<td>dept_manager&nbsp;<br>
</td>
<td>24&nbsp;<br>
</td>
<td>0.02<br>
</td>
<td>16.00<br>
</td>
</tr>
<tr>
<td>employees&nbsp;<br>
</td>
<td>299379&nbsp;<br>
</td>
<td>14.52<br>
</td>
<td>0.00<br>
</td>
</tr>
<tr>
<td>salaries&nbsp;<br>
</td>
<td>2838426&nbsp;<br>
</td>
<td>95.63<br>
</td>
<td>0.00&nbsp;<br>
</td>
</tr>
<tr>
<td>titles&nbsp;<br>
</td>
<td>442783&nbsp;<br>
</td>
<td>19.56<br>
</td>
<td>0.00<br>
</td>
</tr>
</tbody></table></div><br>
       ,    :<br>
<br>
<ol>
<li>getState:  </li>
<li>getEmployee:    employee (+salaries, +titles)</li>
<li>patchEmployee:   employee</li>
<li>insertSalary:   salary</li>
</ol><br>
<div class="spoiler"><b class="spoiler_title">  (dbtest.py)</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mysql.connector <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> mariadb
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask, json, request, abort
<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mysql.connector.constants <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ClientFlag

app = Flask(__name__)

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cursor)</span></span></span><span class="hljs-function">:</span></span>
    results = {}
    column = <span class="hljs-number"><span class="hljs-number">0</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cursor.description:
        results[d[<span class="hljs-number"><span class="hljs-number">0</span></span>]] = column
        column = column + <span class="hljs-number"><span class="hljs-number">1</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> results

PAGE_SIZE = <span class="hljs-number"><span class="hljs-number">30</span></span>

<span class="hljs-meta"><span class="hljs-meta">@app.route("/")</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>

<span class="hljs-meta"><span class="hljs-meta">@app.route("/employees/&lt;page&gt;", methods=['GET'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEmployees</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(page)</span></span></span><span class="hljs-function">:</span></span>
    offset = (int(page) - <span class="hljs-number"><span class="hljs-number">1</span></span>) * PAGE_SIZE
    connection = mariadb.connect(user=<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'q5XpRomdSr'</span></span>, database=<span class="hljs-string"><span class="hljs-string">'employees'</span></span>)
    cursor = connection.cursor()
    cursor.execute(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM employees LIMIT {} OFFSET {}"</span></span>.format(PAGE_SIZE, offset))
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">'employees'</span></span>: [i[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cursor.fetchall()]}

<span class="hljs-meta"><span class="hljs-meta">@app.route("/employee/&lt;id&gt;", methods=['GET'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id)</span></span></span><span class="hljs-function">:</span></span>
    id = int(id)
    connection = mariadb.connect(user=<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'q5XpRomdSr'</span></span>, database=<span class="hljs-string"><span class="hljs-string">'employees'</span></span>)
    cursor = connection.cursor()
    cursor.execute(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM employees WHERE emp_no = {}"</span></span>.format(id))
    fields = getFields(cursor)
    employee = {}
    found = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cursor.fetchall():
        found = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>
        employee = {
            <span class="hljs-string"><span class="hljs-string">"birth_date"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"birth_date"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"first_name"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"first_name"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"last_name"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"last_name"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"gender"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"gender"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"hire_date"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"hire_date"</span></span>]]
        }
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found:
        abort(<span class="hljs-number"><span class="hljs-number">404</span></span>)
    cursor.execute(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM salaries WHERE emp_no = {}"</span></span>.format(id))
    fields = getFields(cursor)
    salaries = []
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cursor.fetchall():
        salary = {
            <span class="hljs-string"><span class="hljs-string">"salary"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"salary"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"from_date"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"from_date"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"to_date"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"to_date"</span></span>]]
        }
        salaries.append(salary)
    employee[<span class="hljs-string"><span class="hljs-string">"salaries"</span></span>] = salaries
    cursor.execute(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM titles WHERE emp_no = {}"</span></span>.format(id))
    fields = getFields(cursor)
    titles = []
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cursor.fetchall():
        title = {
            <span class="hljs-string"><span class="hljs-string">"title"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"title"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"from_date"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"from_date"</span></span>]],
            <span class="hljs-string"><span class="hljs-string">"to_date"</span></span>: row[fields[<span class="hljs-string"><span class="hljs-string">"to_date"</span></span>]]
        }
        titles.append(title)
    employee[<span class="hljs-string"><span class="hljs-string">"titles"</span></span>] = titles
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.dumps({
        <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"success"</span></span>,
        <span class="hljs-string"><span class="hljs-string">"employee"</span></span>: employee
    })

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isFieldValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t, v)</span></span></span><span class="hljs-function">:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> t == <span class="hljs-string"><span class="hljs-string">"employee"</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">"birdth_date"</span></span>, <span class="hljs-string"><span class="hljs-string">"first_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"last_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"hire_date"</span></span>]
    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> false

<span class="hljs-meta"><span class="hljs-meta">@app.route("/employee/&lt;id&gt;", methods=['PATCH'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id)</span></span></span><span class="hljs-function">:</span></span>
    id = int(id)
    content = request.json
    print(content)
    setList = <span class="hljs-string"><span class="hljs-string">""</span></span>
    data = []
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> content.iteritems():
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isFieldValid(<span class="hljs-string"><span class="hljs-string">"employee"</span></span>, k):
            <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> setList != <span class="hljs-string"><span class="hljs-string">""</span></span>:
            setList = setList + <span class="hljs-string"><span class="hljs-string">", "</span></span>
        setList = setList + k + <span class="hljs-string"><span class="hljs-string">"=%s"</span></span>
        data.append(v)
    data.append(id)
    print(setList)
    print(data)
    connection = mariadb.connect(user=<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'q5XpRomdSr'</span></span>, database=<span class="hljs-string"><span class="hljs-string">'employees'</span></span>, client_flags=[ClientFlag.FOUND_ROWS])
    cursor = connection.cursor()
    cursor.execute(<span class="hljs-string"><span class="hljs-string">"UPDATE employees SET {} WHERE emp_no = %s"</span></span>.format(setList), data)
    connection.commit()
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cursor.rowcount &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>:
        abort(<span class="hljs-number"><span class="hljs-number">404</span></span>)
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.dumps({
        <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"success"</span></span>
    })

<span class="hljs-meta"><span class="hljs-meta">@app.route("/salary", methods=['PUT'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putSalary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    content = request.json
    print(content)
    connection = mariadb.connect(user=<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'q5XpRomdSr'</span></span>, database=<span class="hljs-string"><span class="hljs-string">'employees'</span></span>, client_flags=[ClientFlag.FOUND_ROWS])
    cursor = connection.cursor()
    data = [content[<span class="hljs-string"><span class="hljs-string">"emp_no"</span></span>], content[<span class="hljs-string"><span class="hljs-string">"salary"</span></span>], content[<span class="hljs-string"><span class="hljs-string">"from_date"</span></span>], content[<span class="hljs-string"><span class="hljs-string">"to_date"</span></span>]]
    cursor.execute(<span class="hljs-string"><span class="hljs-string">"INSERT INTO salaries (emp_no, salary, from_date, to_date) VALUES (%s, %s, %s, %s)"</span></span>, data)
    connection.commit()
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.dumps({
        <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"success"</span></span>
    })


<span class="hljs-meta"><span class="hljs-meta">@app.route("/state", methods=['GET'])</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.dumps({
        <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"success"</span></span>,
        <span class="hljs-string"><span class="hljs-string">"state"</span></span>: <span class="hljs-string"><span class="hljs-string">"working"</span></span>
    })

<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>:
    app.run(host=<span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>,port=<span class="hljs-string"><span class="hljs-string">'5002'</span></span>)
</code></pre></div></div><br>
<b>!</b>             !<br>
<br>
      JMeter.       15   2 ,  ,    ,     300  600   .    50  500.<br>
<br>
  ,     , :<br>
<br>
<pre><code class="plaintext hljs">mysql -e "SHOW ENGINE INNODB STATUS"</code></pre><br>
 :<br>
<br>
<pre><code class="plaintext hljs">Buffer pool hit rate 923 / 1000, young-making rate 29 / 1000 not 32 / 1000</code></pre><br>
       :<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>Label<br>
</th>
<th>Average<br>
</th>
<th>Median<br>
</th>
<th>90% Line<br>
</th>
<th>95% Line<br>
</th>
<th>99% Line<br>
</th>
<th>Min<br>
</th>
<th>Max<br>
</th>
</tr>
<tr>
<td>getEmployee<br>
</td>
<td>37.64<br>
</td>
<td>12.57<br>
</td>
<td>62.28<br>
</td>
<td>128.5<br>
</td>
<td>497.57<br>
</td>
<td>5<br>
</td>
<td>4151.78<br>
</td>
</tr>
<tr>
<td>getState<br>
</td>
<td>17<br>
</td>
<td>7.57<br>
</td>
<td>30.14<br>
</td>
<td>58.71<br>
</td>
<td>193<br>
</td>
<td>3<br>
</td>
<td>2814.71<br>
</td>
</tr>
<tr>
<td>patchEmployee<br>
</td>
<td>161.42<br>
</td>
<td>83.29<br>
</td>
<td>308<br>
</td>
<td>492.57<br>
</td>
<td>1845.14<br>
</td>
<td>5<br>
</td>
<td>6639.4<br>
</td>
</tr>
<tr>
<td>putSalary<br>
</td>
<td>167.21<br>
</td>
<td>86.93<br>
</td>
<td>315.34<br>
</td>
<td>501.07<br>
</td>
<td>1927.12<br>
</td>
<td>7<br>
</td>
<td>6722.44<br>
</td>
</tr>
</tbody></table></div><br>
          ,    VPS       ,     ,          .      .          30                .</div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464571/">https://habr.com/ru/post/464571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464557/index.html">XD Design Bobby Pro: la nueva versión que hemos estado esperando</a></li>
<li><a href="../464559/index.html">Características del transporte Universiada y un Alex muy entusiasta</a></li>
<li><a href="../464561/index.html">Escribir aplicaciones iOS usando el patrón Redux</a></li>
<li><a href="../464563/index.html">Seguridad de la información: ¿qué necesita saber y poder ser considerado un buen especialista en seguridad de la información?</a></li>
<li><a href="../464565/index.html">IP-KVM a través de QEMU</a></li>
<li><a href="../464579/index.html">Computer Vision Summer Camp - Escuela de verano Intel Computer Vision</a></li>
<li><a href="../464581/index.html">25 tipos de "César" y palabras en inglés</a></li>
<li><a href="../464583/index.html">El conjunto de datos 3D masivo ayuda a los robots a comprender las cosas</a></li>
<li><a href="../464591/index.html">Química del pollo frito. Análisis detallado</a></li>
<li><a href="../464593/index.html">Nube de puntos Cómo desarrollamos la tecnología digital en la construcción.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>