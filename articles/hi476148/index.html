<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯУ╜я╕П ЁЯУР ЁЯжФ FreeBSD рдкрд░ рдкреЛрд╕реНрдЯрдлрд┐рдХреНрд╕ + dovecot + mysql ЁЯзЦЁЯП┐ ЁЯЩОЁЯП┐ ЁЯУн</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкрд░рд┐рдЪрдп 
 рдореИрдВ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдореЗрд▓ рд╕рд░реНрд╡рд░ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдореЗрд░реЗ рд╣рд╛рде рдЕрдм рддрдХ рд╣реА рдкрд╣реБрдВрдЪреЗ, рдФрд░ рдореБрдЭреЗ рдмрд╣реБрдд рд╕рд╣реА рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рдорд┐рд▓реА, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдпрдерд╛рд╕рдВрднрд╡ рдПрдХ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>FreeBSD рдкрд░ рдкреЛрд╕реНрдЯрдлрд┐рдХреНрд╕ + dovecot + mysql</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476148/"><h2>  рдкрд░рд┐рдЪрдп </h2><br>  рдореИрдВ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдореЗрд▓ рд╕рд░реНрд╡рд░ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдореЗрд░реЗ рд╣рд╛рде рдЕрдм рддрдХ рд╣реА рдкрд╣реБрдВрдЪреЗ, рдФрд░ рдореБрдЭреЗ рдмрд╣реБрдд рд╕рд╣реА рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рдорд┐рд▓реА, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдпрдерд╛рд╕рдВрднрд╡ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рдкреНрд░рдХрд╛рд╢рди рд▓рд┐рдЦрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред  рдЗрд╕ рдкреНрд░рдХрд╛рд╢рди рдореЗрдВ рди рдХреЗрд╡рд▓ рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕, рдбреЙрд╡рдХреЛрдЯ, рдорд╛рдпрд╕реНрдХрд▓, рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕рдбрдорд┐рди, рдмрд▓реНрдХрд┐ рд╕реНрдкреИрдорд╕реИрд╕рд┐рди, рдХреНрд▓реИрдорд╡-рдорд┐рд▓реНрдЯрд░ (рдореЗрд▓ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдХреНрд▓реИрдорд╡ рдХрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╕рдВрд╕реНрдХрд░рдг), рдкреЛрд╕реНрдЯрдЧреНрд░реЗ, рд╕рд╛рде рд╣реА рд╕реНрдкреИрдо рдлрд╝реЛрд▓реНрдбрд░ (рдбреЙрд╡реЗрдХреЛрдЯ) рдкрд░ рд╕реНрдкреИрдо рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкрд░ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреАред рдбрдмреНрдмреЛрдВ рдореЗрдВ)ред <br><a name="habracut"></a><br><h3>  рдЯреНрд░реЗрдирд┐рдВрдЧ </h3><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЙрди рдкреИрдХреЗрдЬреЛрдВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдкрдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕, рдбрд╡рдХреЛрдЯ рдФрд░ рдбрд╡рдХреЛрдЯ-рдкрд┐рдЬрдирд╣реЛрд▓ рдХреЛ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдбрд╡рдХреЛрдЯ-рдЫрд▓рдиреА рдХреЛ рд╕рдВрдХреБрд▓ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдореЗрдВ рдирдП рд╕рдВрд╕реНрдХрд░рдг рд╣реИрдВ рдФрд░ рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ dovecot рдФрд░ dovecot рдХреЗ рдмреАрдЪ рдЕрд╕рдВрдЧрддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИ) рдЪрд▓рдиреА)ред  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ: <br><br><pre><code class="plaintext hljs">pkg install apache24 php73 mod_php73 php73-extensions php73-mysqli php73-mbstring php73-openssl clamav-milter postgrey spamassassin mysql57-server openssl wget</code> </pre> <br>  рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж, рд╣рдо рдЖрд╡рд╢реНрдпрдХ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдСрдЯреЛрд░рди рдореЗрдВ рдбрд╛рд▓реЗрдВрдЧреЗ: <br><br><pre> <code class="plaintext hljs">#postfix  dovecot  ,       sysrc postfix_enable="YES" sysrc dovecot_enable="YES" sysrc mysql_enable="YES" sysrc apache24_enable="YES" sysrc spamd_flags="-u spamd -H /var/spool/spamd" sysrc spamd_enable="YES" sysrc postgrey_enable="YES" sysrc clamav_clamd_enable="YES" sysrc clamav_milter_enable="YES" sysrc clamav_freshclam_enable="YES" #freshclam        12  sysrc clamav_freshclam_flags="--daemon --checks=12"</code> </pre><br>  рд╕реЗрд╡рд╛рдПрдВ рдЪрд▓рд╛рдПрдБ: <br><br><pre> <code class="plaintext hljs">service apache24 start service mysql-server start #  spamassassin       sa-update sa-compile service sa-spamd start #   clamav   freshclam service clamav-clamd start service clamav-freshclam start service clamav-milter start #  postgrey    (/usr/local/etc/rc.d/postgrey),       ""   4-   ,    : ${postgrey_flags:=--inet=10023}     : : ${postgrey_flags:=--inet=10023 --auto-whitelist-clients=4} service postgrey start</code> </pre><br>  Httpd.conf рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛ред рдПрдкрд╛рдЪреЗ рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП php рдФрд░ рдкреЛрд╕реНрдЯрдлреИрдбрдорд┐рди рдХреЗ рд▓рд┐рдП рд╕рд╣реА рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд▓рд╛рдЗрдиреЗрдВ: <br><br><pre> <code class="plaintext hljs">&lt;FilesMatch "\.php$"&gt; SetHandler application/x-httpd-php &lt;/FilesMatch&gt; &lt;FilesMatch "\.phps$"&gt; SetHandler application/x-httpd-php-source &lt;/FilesMatch&gt; &lt;IfModule dir_module&gt; DirectoryIndex index.php &lt;/IfModule&gt; #         postfixadmin DocumentRoot "/usr/local/www/apache24/data/postfixadmin-3.2/public"</code> </pre><br>  рдЗрд╕рдХреЗ рдмрд╛рдж, рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдЬрд╛рдПрдВ рдФрд░ рдкреЛрд╕реНрдЯрдлрд┐рдХреНрд╕рдбрдорд┐рди рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ <br><br><pre> <code class="plaintext hljs">cd /usr/local/www/apache24/data</code> </pre><br>  Postfixadmin рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ (рд▓реЗрдЦрди рдХреЗ рд╕рдордп, рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдг 3.2 рдерд╛) <br><br><pre> <code class="plaintext hljs">wget --no-check-certificate https://sourceforge.net/projects/postfixadmin/files/postfixadmin/postfixadmin-3.2/postfixadmin-3.2.tar.gz</code> </pre><br>  рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣ рдХреЛ рдЕрдирдЬрд╝рд┐рдк рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдорд╛рд▓рд┐рдХ рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛: <br><br><pre> <code class="plaintext hljs">gzip -d postfixadmin-3.2.tar.gz tar -xvf postfixadmin-3.2.tar chown -R www:www /usr/local/www/apache24/data service apache24 restart</code> </pre><br>  рдЕрдЧрд▓рд╛, рдкреЛрд╕реНрдЯрдлреИрдбрдорд┐рди рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛рдмреЗрд╕ рддреИрдпрд╛рд░ рдХрд░реЗрдВ, mysql-Secure-рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЪрд▓рд╛рдПрдВ (рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдЬреЛ рдкрд╛рд╕рд╡рд░реНрдб рдЖрдк рдмрдирд╛рддреЗ рд╣реИрдВ, рдЙрд╕реЗ рдмрджрд▓рдиреЗ рд╡рд╛рд▓реЗ рдпреВрдЬрд░ рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде mysql рдореЗрдВ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛), mysql рдХреЗ рд╢реБрд░реБрдЖрддреА рд╕реЗрдЯрдЕрдк рдХреЗ рд▓рд┐рдП, рдлрд┐рд░ mysql рджрд░реНрдЬ рдХрд░реЗрдВ, рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рдЕрдзрд┐рдХрд╛рд░ рдмрдирд╛рдПрдВред рдЙрд╕рдХреЗ рд▓рд┐рдП: <br><br><pre> <code class="plaintext hljs">mysql -p -r alter user 'root'@'localhost' identified by 'password123'; create database postfix; grant all privileges on postfix.* to 'postfix'@'localhost' identified by 'password123'; exit</code> </pre><br>  рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ config.inc.php рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдпрд╣ рдлрд╝рд╛рдЗрд▓ /usr/local/www/apache24/data/postfixadmin-3.2/ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╣реИ, рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЖрдкрдХреЛ рдХрдИ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдорди, рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рдЕрдкрд╛рдЪреЗ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВ, рдЖрдкрдХреЛ /usr/local/www/apache24/data/postfixadmin-3.2 рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕_c рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдиреЗ рдФрд░ www рдорд╛рд▓рд┐рдХ рдХреЛ рдЗрд╕реЗ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">mkdir /usr/local/www/apache24/data/postfixadmin-3.2/templates_c chown -R www:www /usr/local/www/apache24/data/postfixadmin-3.2/templates_c $CONF['configured'] = true #       postfixadmin     . $CONF['setup_password'] = 'dd28fb2139a3bca426f02f60e6877fd5:13d2703c477b0ab85858e3ac5e076a0a7a477315'; $CONF['default_language'] = 'ru' $CONF['database_type'] = 'mysqli'; $CONF['database_host'] = 'localhost'; $CONF['database_user'] = 'postfix'; #           $CONF['database_password'] = 'password123'; $CONF['database_name'] = 'postfix'; service apache24 restart</code> </pre><br><h4>  рдПрд╕рдПрд╕рдПрд▓ </h4><br>  рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо postfix.org рдкрд░ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд╕рд╛рде, рд╣рдореЗрдВ / etc / ssl рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЬрд╛рдиреЗ рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">cd /etc/ssl /usr/local/openssl/misc/CA.pl -newca</code> </pre><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди, рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд╛рдо рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдХреБрдЫ рднреА рджрд░реНрдЬ рди рдХрд░реЗрдВ, Enter рджрдмрд╛рдПрдВ, рдлрд┐рд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЖрдкрдХреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдЧреА, рдлрд┐рд░ рдПрдХ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рдкреНрд░рд╢реНрди рд╣реЛрдВрдЧреЗред <br><br>  рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рдПрдХ рдЧреБрдкреНрдд рдХреБрдВрдЬреА (рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдмрд┐рдирд╛) рдФрд░ рдПрдХ рдЧреИрд░-рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдкреНрд░рдорд╛рдгрдкрддреНрд░ (рд╕рдВрдЧрдардирд╛рддреНрдордХ рдЗрдХрд╛рдИ рдХрд╛ рдирд╛рдо (рдЬреИрд╕реЗ, рдЕрдиреБрднрд╛рдЧ) [] рдКрдкрд░ рдмрдирд╛рдП рдЧрдП рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реЗ рдЕрд▓рдЧ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП) рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">openssl req -new -newkey rsa:4096 -nodes -keyout foo-key.pem -out foo-req.pem</code> </pre><br>  рд╣рдо рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдкрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░реЗрдВрдЧреЗ (рджрд┐рдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ рдЬрд┐рддрдиреА рдЖрдкрдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ): <br><br><pre> <code class="plaintext hljs">openssl ca -out foo-cert.pem -days 365 -infiles foo-req.pem</code> </pre><br>  рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдмрдирд╛рдП рдЧрдП рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВ, рдпрд╛ рдЙрдиреНрд╣реЗрдВ рдЙрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ, "рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕" рдФрд░ "рдбрд╡рдХреЛрдЯ" рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдЗрд╕ рддрдереНрдп рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХрд┐ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╣реЛрдВрдЧреЗред <br><br><h4>  Vmail рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ </h4><br>  рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕, рдбрд╡рдХреЛрдЯ рдФрд░ рдбрд╡рдХреЛрдЯ-рдкрд┐рдЬрдирд╣реЛрд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдПрдХ рд╕рдореВрд╣ (рдПрдХ рд╕рдореВрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛) vmail, рд╕рд╛рде рд╣реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЬрд╣рд╛рдВ рдореЗрд▓ рд╕реНрдерд┐рдд рд╣реЛрдЧрд╛ред <br><br><pre> <code class="plaintext hljs">pw useradd -n vmail -s /usr/sbin/nologin -u 1000 -d /var/vmail</code> </pre><br>  рдореЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдПрдВ рдФрд░ vmail рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд╕реНрд╡рд╛рдореА рд╕реЗрдЯ рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">mkdir /var/vmail chown -R vmail:vmail /var/vmail chmod -R 744 /var/vmail</code> </pre><br><h2>  рдЙрдкрд╕рд░реНрдЧ, рдХрдмреВрддрд░, рдХрдмреВрддрд░-рдХрдмреВрддрд░ </h2><br>  рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд▓рд┐рдЦрд╛ рдерд╛, рд╣рдо рдкреЛрд░реНрдЯ рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдбреЗрдЯрд╛ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдВрдЧреЗ, рдкреЛрд░реНрдЯ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдВрдЧреЗ: <br><br><pre> <code class="plaintext hljs">portsnap fetch extract</code> </pre><br>  рдкреЛрд░реНрдЯ рдХреЛ рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, dovecot рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкрд░ рдЬрд╛рдПрдВ, рдкреЛрд░реНрдЯ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ (mysql рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ) рдФрд░ рдмрд┐рд▓реНрдб рдХреЛ рдЪрд▓рд╛рдПрдВ (BATCH = yes рдмрддрд╛рдПрдЧрд╛ рдХрд┐ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рд╕рд╡рд╛рд▓ рдирд╣реАрдВ рдкреВрдЫреЗрдВ): <br><br><pre> <code class="plaintext hljs">cd /usr/ports/mail/dovecot make config make BATCH=yes install clean</code> </pre><br>  рдкреЛрд╕реНрдЯрдлрд┐рдХреНрд╕ рдФрд░ рдХрдмреВрддрд░-рдХрдмреВрддрд░ рдХреЗ рд╕рд╛рде рднреА рдРрд╕рд╛ рд╣реА рдХрд░реЗрдВ <br><br>  Dovecot-рдХрдмреВрддрд░ рдХрд╛ рдШреЛрдВрд╕рд▓рд╛: <br><br><pre> <code class="plaintext hljs">cd /usr/ports/mail/dovecot-pigeonhole make BATCH=yes install clean</code> </pre><br>  рдкреЛрд╕реНрдЯрдлрд┐рдХреНрд╕: рдкреЛрд░реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ mysql рд╕рдкреЛрд░реНрдЯ рдХреА рднреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ <br><br><pre> <code class="plaintext hljs">cd /usr/ports/mail/postfix-sasl make config make BATCH=yes install clean</code> </pre><br>  Dovecot рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, "рдХреЙрдиреНрдлрд╝рд┐рдЧрд░" рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдБ: <br><br><pre> <code class="plaintext hljs"> cp -R /usr/local/etc/dovecot/example-config/* /usr/local/etc/dovecot</code> </pre><br>  рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕ рдФрд░ рдХрдмреВрддрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╕реЗрд╡рд╛рдПрдВ рд╢реБрд░реВ рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">service postfix start service dovecot start</code> </pre><br>  рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕реНрдкреИрдо рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдкреИрдо рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдореЙрдбреНрдпреВрд▓ рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ /usr/local/etc/dovecot/conf.d рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ, рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рдирд╛рдо рдбреАрдлрд╝ рд╣реИ, рдЗрд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдмрдирд╛рдПрдВ рдФрд░ рд╕рдВрдХрд▓рди рдХреЗ рд▓рд┐рдП рдХреЛрдб рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ рдФрд░ рджрд┐рдП рдЧрдП vmail рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рд╕реНрд╡рд╛рдореА рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">mkdir /usr/local/etc/dovecot/conf.d/def touch /usr/local/etc/dovecot/conf.d/def/default.sieve chown -R vmail:vmail /usr/local/etc/dovecot/conf.d/def chmod -R 744 /usr/local/etc/dovecot/conf.d/def</code> </pre><br>  рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд╛рдЗрдиреЗрдВ рд░рдЦреЗрдВ: <br><br><pre> <code class="plaintext hljs">require "fileinto"; if header :contains "X-Spam-Flag" "YES" { fileinto "Junk"; }</code> </pre><br><h3>  "рдХреЙрдиреНрдлрд╝рд┐рдЧ" </h3><br>  рдЗрд╕ рдЦрдВрдб рдореЗрдВ рдореИрдВ рдЙрдирдореЗрдВ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде "рдХреЙрдиреНрдлрд┐рдЧ" рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджреВрдВрдЧрд╛, рдореБрдЭреЗ рд╕реНрдкреИрдорд╕реИрд╕ рдХреЗ рдХреЗрд╡рд▓ "рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди" рдкрд░ рд╕рдВрджреЗрд╣ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдореБрдЭреЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╕рд╣реА рд╡рд┐рд╡рд░рдг рдирд╣реАрдВ рдорд┐рд▓рд╛ (рдореИрдВрдиреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ "рдХреЙрдиреНрдлрд┐рдЧрд░" рдЫреЛрдбрд╝ рджрд┐рдпрд╛), рдХреГрдкрдпрд╛ рдЯрд┐рдкреНрдкрдгреА рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ рдХрд┐ рдХреИрд╕реЗ рд╕реНрдкреИрдорд╕реИрд╕ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИред <br><br><h4>  рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕ </h4><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ, рдбреЛрдореЗрди, рдХреЛрдЯрд╛ рдЦреАрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╛рдЗрд▓реЗрдВ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдбреЗрдЯрд╛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдПрдВ: <br><br><pre> <code class="plaintext hljs">mkdir /usr/local/etc/postfix/mysql touch /usr/local/etc/postfix/mysql/relay_domains.cf touch /usr/local/etc/postfix/mysql/virtual_alias_maps.cf touch /usr/local/etc/postfix/mysql/virtual_alias_domain_maps.cf touch /usr/local/etc/postfix/mysql/virtual_mailbox_maps.cf</code> </pre><br>  рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрдЧреА: <br>  relay_domains.cf <br><br><pre> <code class="plaintext hljs">hosts = 127.0.0.1 user = postfix password = password123 dbname = postfix query = SELECT domain FROM domain WHERE domain='%s' and backupmx = '1'</code> </pre><br>  virtual_alias_maps.cf <br><br><pre> <code class="plaintext hljs">hosts = 127.0.0.1 user = postfix password = password123 dbname = postfix query = SELECT goto FROM alias WHERE address='%s' AND active ='1'</code> </pre><br>  virtual_alias_domain_maps.cf <br><br><pre> <code class="plaintext hljs">hosts = 127.0.0.1 user = postfix password = password123 dbname = postfix query = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = '%d' and alias.address = CONCAT('%u', '@', alias_domain.target_domain) AND alias.active = '1'</code> </pre><br>  virtual_mailbox_maps.cf <br><br><pre> <code class="plaintext hljs">hosts = 127.0.0.1 user = postfix password = password123 dbname = postfix query = SELECT maildir FROM mailbox WHERE username='%s' AND active = '1'</code> </pre><br>  master.cf <br><br><pre> <code class="plaintext hljs"># postfix  ,    dovecot    dovecot unix - nn - - pipe flags=DRhu user=vmail:vmail argv=/usr/local/libexec/dovecot/deliver -f ${sender} -d ${recipient} #  smtpd     sasl,    ,  spamassassin    smtp inet n - n - - smtpd -o content_filter=spamassassin -o smtpd_sasl_auth_enable=yes #  587     sasl submission inet n - n - - smtpd -o smtpd_sasl_auth_enable=yes #  smtp    SASL smtps inet n - n - - smtpd -o smtpd_sasl_auth_enable=yes -o smtpd_tls_wrappermode=yes # Spamassassin spamassassin unix - nn - - pipe flags=DROhu user=vmail:vmail argv=/usr/local/bin/spamc -f -e /usr/local/libexec/dovecot/deliver -f ${sender} -d ${user}@${nexthop} #628 inet n - n - - qmqpd pickup unix n - n 60 1 pickup cleanup unix n - n - 0 cleanup qmgr unix n - n 300 1 qmgr #qmgr unix n - n 300 1 oqmgr tlsmgr unix - - n 1000? 1 tlsmgr rewrite unix - - n - - trivial-rewrite bounce unix - - n - 0 bounce defer unix - - n - 0 bounce trace unix - - n - 0 bounce verify unix - - n - 1 verify flush unix n - n 1000? 0 flush proxymap unix - - n - - proxymap proxywrite unix - - n - 1 proxymap smtp unix - - n - - smtp relay unix - - n - - smtp -o syslog_name=postfix/$service_name # -o smtp_helo_timeout=5 -o smtp_connect_timeout=5 showq unix n - n - - showq error unix - - n - - error retry unix - - n - - error discard unix - - n - - discard local unix - nn - - local virtual unix - nn - - virtual lmtp unix - - n - - lmtp anvil unix - - n - 1 anvil scache unix - - n - 1 scache postlog unix-dgram n - n - 1 postlogd</code> </pre><br>  main.cf <br><br><pre> <code class="plaintext hljs">#       dovecot,       local_transport = dovecot #      ,  SMTP-      EHLO  SMTP  smtpd_discard_ehlo_keywords = CONNECT GET POST #            smtpd_delay_reject = yes #     smtpd_helo_required = yes #     ,   disable_vrfy_command = yes #       broken_sasl_auth_clients = yes #   smtpd_sasl_security_options = noanonymous noactive nodictionary smtp_sasl_security_options = noanonymous noactive nodictionary # dovecot  (  cyrus) smtpd_sasl_type = dovecot smtp_sasl_type = dovecot #    smtpd_sasl_path = private/auth #   local_recipient_maps = $virtual_mailbox_maps $virtual_alias_maps #   ,    smtpd_reject_unlisted_recipient = yes #   message_size_limit = 10485760 #     spamassassin spamassassin_destination_recipient_limit = 1 # milter_default_action = accept milter_protocol = 2 #   clamav smtpd_milters = unix:/var/run/clamav/clmilter.sock non_smtpd_milters = unix:/var/run/clamav/clmilter.sock #MYSQL relay_domains = mysql:/usr/local/etc/postfix/mysql/relay_domains.cf virtual_alias_maps = mysql:/usr/local/etc/postfix/mysql/virtual_alias_maps.cf, mysql:/usr/local/etc/postfix/mysql/virtual_alias_domain_maps.cf virtual_mailbox_maps = mysql:/usr/local/etc/postfix/mysql/virtual_mailbox_maps.cf # HELO smtpd_helo_restrictions = permit_sasl_authenticated, reject_non_fqdn_helo_hostname, reject_invalid_hostname #    smtpd_data_restrictions = permit_sasl_authenticated reject_unauth_pipelining, reject_multi_recipient_bounce #   smtpd_sender_restrictions = permit_sasl_authenticated reject_sender_login_mismatch,reject_unauthenticated_sender_login_mismatch, reject_non_fqdn_sender, reject_unknown_sender_domain #  (check_policy_service inet:127.0.0.1:10023  postgrey -      ) smtpd_recipient_restrictions = permit_sasl_authenticated reject_non_fqdn_recipient, reject_unknown_recipient_domain, reject_multi_recipient_bounce, reject_unknown_client_hostname, reject_unauth_destination, check_policy_service inet:127.0.0.1:10023 #   virtual_mailbox_base = /var/vmail #uid  gid vmail virtual_minimum_uid = 1000 virtual_uid_maps = static:1000 virtual_gid_maps = static:1000 #   virtual_transport = devecot dovecot_destination_recipient_limit = 1 #  smtp_use_tls=yes smtp_tls_note_starttls_offer=yes # smtp_tls_security_level=encrypt       ssl,        ssl,    smtp_tls_security_level=may(    ssl,     ) smtp_tls_security_level=encrypt smtp_tls_session_cache_database=btree:$data_directory/smtp_tls_session_cache smtp_tls_CAfile=/etc/ssl/demoCA/cacert.pem smtp_tls_key_file=/etc/ssl/foo-key.pem smtp_tls_cert_file=/etc/ssl/foo-cert.pem smtp_tls_session_cache_timeout=3600s smtp_tls_protocols=!TLSv1.2 smtp_tls_loglevel=1 # smtpd_tls_security_level=encrypt       ssl,        ssl,    smtpd_tls_security_level=may(    ssl,     ) smtpd_tls_security_level=encrypt smtpd_use_tls=yes smtpd_tls_auth_only=yes smtpd_tls_loglevel=1 smtpd_tls_received_header=yes smtpd_tls_session_cache_timeout=3600s smtpd_tls_session_cache_database=btree:$data_directory/smtpd_tls_session_cache smtpd_tls_key_file=/etc/ssl/foo-key.pem smtpd_tls_cert_file=/etc/ssl/foo-cert.pem smtpd_tls_CAfile= /etc/ssl/demoCA/cacert.pem smtpd_tls_protocols=!TLSv1.2 #      tls_random_source=dev:/dev/urandom #  compatibility_level = 2 #   ,    ,      ,    soft_bounce = no #   UNIX       postfix mail_owner = postfix #     postfix(        ) myhostname = $mydomain #       mydomain = virusslayer.su myorigin = $myhostname #    inet_interfaces = all #        mydestination = $mydomain, localhost, localhost.$mydomain #   550         unknown_local_recipient_reject_code = 550 #    localhost mynetworks_style = host #       , -         mynetworks = #  ip inet_protocols = ipv4 #  (   ) alias_maps = hash:/etc/mail/aliases alias_database = dbm:/etc/mail/aliases.db #          smtpd_banner = $myhostname ESMTP $mail_name #       debug_peer_level = 2 #      (   ,    yandex.ru gmail.ru mail.ru  ..) debug_peer_list = 127.0.0.1 #   debugger_command = PATH=/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin ddd $daemon_directory/$process_name $process_id &amp; sleep 5 #  sendmail sendmail_path = /usr/local/sbin/sendmail mailq_path = /usr/local/bin/mailq setgid_group = maildrop #    html_directory = /usr/local/share/doc/postfix manpage_directory = /usr/local/man sample_directory = /usr/local/etc/postfix readme_directory = /usr/local/share/doc/postfix meta_directory = /usr/local/libexec/postfix shlib_directory = /usr/local/lib/postfix queue_directory = /var/spool/postfix command_directory = /usr/local/sbin daemon_directory = /usr/local/libexec/postfix data_directory = /var/db/postfix</code> </pre><br><h4>  рджрд░рдмрд╛ </h4><br>  dovecot.conf <br><br><pre> <code class="plaintext hljs">#     dovecot protocols = imap pop3 #    listen = *, :: #        mysql dict { quota = mysql:/usr/local/etc/dovecot/dovecot-dict-sql.conf.ext } #   !include conf.d/*.conf !include_try local.conf</code> </pre><br>  Dovecot-dict-sql.conf.ext <br><br><pre> <code class="plaintext hljs">connect = host=127.0.0.1 dbname=postfix user=postfix password=password123 map { pattern = priv/quota/storage table = quota2 username_field = username value_field = bytes } map { pattern = priv/quota/messages table = quota2 username_field = username value_field = messages }</code> </pre><br>  Dovecot-sql.conf.ext <br><br><pre> <code class="plaintext hljs">#    MYSQL driver = mysql connect = host=127.0.0.1 dbname=postfix user=postfix password=password123 #     default_pass_scheme = MD5 #  ,    user_query = SELECT '/var/mail/%d/%n/' AS home, 'maildir:/var/vmail/%d/%n' AS mail, 1000 AS uid, 1000 AS gid, concat('*:bytes=',quota) as quota_rule FROM mailbox \ WHERE username ='%u' AND active = '1' password_query = SELECT username as user, password, '/var/vmail/%d/%n' as userdb_home, 'maildir:/var/vmail/%d/%n' as userdb_mail, 1000 as userdb_uid, \ 1000 as userdb_gid, concat('*:bytes=',quota) AS userdb_quota_rule FROM mailbox WHERE username ='%u' AND active ='1'</code> </pre><br>  10-auth.conf <br><br><pre> <code class="plaintext hljs">#   SSL disable_plaintext_auth = yes #   auth_realms = virusslayer.su auth_default_realm = virusslayer.su #    ( ,         ssl) auth_mechanisms = plain login #   ,  !include auth-sql.conf.ext,        mysql #!include auth-deny.conf.ext #!include auth-master.conf.ext #!include auth-system.conf.ext !include auth-sql.conf.ext #!include auth-ldap.conf.ext #!include auth-passwdfile.conf.ext #!include auth-checkpassword.conf.ext #!include auth-vpopmail.conf.ext #!include auth-static.conf.ext</code> </pre><br>  10-mail.conf <br><br><pre> <code class="plaintext hljs">#    mail_location = maildir:/var/vmail/%d/%n #       namespace inbox { inbox = yes } #uid  gid vmail mail_uid = 1000 mail_gid = 1000 # ,    quota mail_plugins = quota</code> </pre><br>  10-master.conf <br><br><pre> <code class="plaintext hljs">#     ssl service imap-login { inet_listener imap { port = 143 } inet_listener imaps { port = 993 ssl = yes } } service pop3-login { inet_listener pop3 { port = 110 } inet_listener pop3s { port = 995 ssl = yes } } service submission-login { inet_listener submission { port = 587 } } #           (   ,       ) service auth { unix_listener auth-userdb { mode = 0600 user = vmail group = vmail } # Postfix smtp-auth unix_listener /var/spool/postfix/private/auth { mode = 0666 user = postfix group = postfix } } #  vmail   service dict { unix_listener dict { mode = 0660 user = vmail group = vmail } }</code> </pre><br>  10-ssl.conf <br><br><pre> <code class="plaintext hljs"># ssl  (    sll  ) ssl = required #   ssl_cert = &lt;/etc/ssl/foo-cert.pem ssl_key = &lt;/etc/ssl/foo-key.pem ssl_ca = &lt;/etc/ssl/demoCA/cacert.pem #    ssl_min_protocol = TLSv1.2</code> </pre><br>  15-lda.conf <br><br><pre> <code class="plaintext hljs">quota_full_tempfail = no lda_mailbox_autosubscribe = yes protocol lda { #      sieve,        mail_plugins = $mail_plugins sieve quota }</code> </pre><br>  90-plugin.conf <br><br><pre> <code class="plaintext hljs">#             "",       chown -R vmail:vmail #          "" plugin { #setting_name = value sieve = /usr/local/etc/dovecot/conf.d/def/default.sieve }</code> </pre><br>  Auth-sql.conf.ext <br><br><pre> <code class="plaintext hljs">#      MYSQL passdb { driver = sql # Path for SQL configuration file, see example-config/dovecot-sql.conf.ext args = /usr/local/etc/dovecot/dovecot-sql.conf.ext } userdb { driver = sql args = /usr/local/etc/dovecot/dovecot-sql.conf.ext }</code> </pre><br><h3>  SpamAssassin рдХреЗ </h3><br>  "рдХреЙрдиреНрдлрд┐рдЧ" рд╕реНрдкреИрдорд╛рдЯрд╛рд╕рди рдРрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреБрдЫ рдореБрдЭреЗ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдбреЗрдЯрд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ, рдХреГрдкрдпрд╛ "рдХреЙрдиреНрдлрд┐рдЧрд░" рдореЗрдВ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдорджрдж рдХрд░реЗрдВ: <br><br>  local.cf <br><br><pre> <code class="plaintext hljs">rewrite_header Subject *****SPAM***** report_safe 0 required_score 5.0 use_bayes 1 bayes_auto_learn 1 ifplugin Mail::SpamAssassin::Plugin::Shortcircuit endif # Mail::SpamAssassin::Plugin::Shortcircuit</code> </pre><br>  рд╕реНрдкреИрдо рдХреЗ рд╕рд╛рде рдФрд░ рдЗрд╕рдХреЗ рдмрд┐рдирд╛ рдЕрдХреНрд╖рд░реЛрдВ рдкрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХрд░рдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ: <br><br><pre> <code class="plaintext hljs">sa-learn --spam /path/spam/folder sa-learn --ham /path/ham/folder</code> </pre><br><h2>  рдЗрд╕рдХреЗ рд╕рд╛рде рд╣реА </h2><br>  рдЗрд╕ рдЦрдВрдб рдореЗрдВ, рдореИрдВ pf рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реВрдБрдЧрд╛, autorun рдореЗрдВ pf рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдирд┐рдпрдореЛрдВ рдХреЗ рд╕рд╛рде рдлрд╝рд╛рдЗрд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">sysrc pf_enable="YES" sysrc pf_rules="/etc/0.pf"</code> </pre><br>  рдирд┐рдпрдореЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ: <br><br><pre> <code class="plaintext hljs">ee /etc/0.pf</code> </pre><br>  рдФрд░ рдЗрд╕рдореЗрдВ рдирд┐рдпрдо рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="plaintext hljs"># (   lo0)    ,     set skip on lo0 #      deovecot, postfix, root pass in quick proto { tcp, udp } from any to any port {53,25,465,587,110,143,993,995} user {dovecot,postfix,root} flags S/SA modulate state pass out quick proto { tcp, udp } from any to any port {53,25,465,587,110,143,993,995} user {dovecot,postfix,root} #      root pass out quick proto {tcp,udp} from any to any user root #     pass in quick proto tcp from any to any port 80 flags S/SA modulate state #SSH pass in quick proto tcp from any to any port 22 flags S/SA modulate state #     clamav  spamd pass out quick proto {tcp,udp} from any to any user {clamav,spamd} #DNS  ICMP pass out quick proto {tcp,udp} from any to any port=53 keep state pass out quick proto icmp from any to any block from any to any fragment block from any to any block all</code> </pre><br>  рдЖрдк рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде pf рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs">service pf start</code> </pre><br><h2>  рдкрд░реАрдХреНрд╖рдг </h2><br>  рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рдХрдиреЗрдХреНрд╢рди (STARTTLS, SLL) рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдореЛрдмрд╛рдЗрд▓ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП MyOffice рдореЗрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ (ios рдХреЗ рд▓рд┐рдП рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдореЗрд▓ рд╕рд░реНрд╡рд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВред <br><br>  Spaassasin рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо GTUBE рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рд╕рдВрджреЗрд╢ рдореЗрдВ рд▓рд╛рдЗрди рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="plaintext hljs">XJS*C4JDBQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X</code> </pre><br>  рдпрджрд┐ рд╕рдм рдХреБрдЫ рд╕рд╣реА рд╣реИ, рддреЛ рд╕рдВрджреЗрд╢ рд╕реНрдкреИрдо рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рддрджрдиреБрд╕рд╛рд░ рд╕реНрдкреИрдо рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рдЯреЗрдХреНрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдПрдХ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ EICAR рдЕрдиреБрдХреНрд░рдо рд╣реЛрдЧрд╛: <br><br><pre> <code class="plaintext hljs">X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*</code> </pre><br>  рдкрддреНрд░ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ рдмрд╛рд╣рд░реА рдореЗрд▓рдмреЙрдХреНрд╕ рд╕реЗ рднреЗрдЬреЗ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br>  рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдореЗрдВ рд▓реЙрдЧ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рджреМрдбрд╝реЗрдВ: <br><br><pre> <code class="plaintext hljs">tail -f /var/log/maillog</code> </pre><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдмрд╛рд╣рд░реА рдореЗрд▓рдмреЙрдХреНрд╕реЛрдВ рдХреЛ рдореЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд╕рд╣реА рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, yandex.ru, mail.ru, gmail.com, рдЖрджрд┐), рдЖрдкрдХреЛ рд░рд┐рд╡рд░реНрд╕ DNS рдЬрд╝реЛрди (PTR рд░рд┐рдХреЙрд░реНрдб) рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЖрдк рдЕрдкрдиреЗ рдкреНрд░рджрд╛рддрд╛ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдХреЗ рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХрд╛ рд╕реНрд╡рдпрдВ рдХрд╛ DNS рд╕рд░реНрд╡рд░ рдирд╣реАрдВ рд╣реИ)ред <br><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br>  рдпрд╣ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдореЗрд▓ рд╕рд░реНрд╡рд░ рдПрдХ рдЬрдЯрд┐рд▓ рдЪреАрдЬрд╝ рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рдЗрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддреЗ рд╣реИрдВ, рддреЛ рдРрд╕рд╛ рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВ рд╣реИ, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░ рдереЛрдбрд╝рд╛ рд╕рдордп рдмрд┐рддрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рд╕реНрдкреИрдо рдФрд░ рд╡рд╛рдпрд░рд╕ рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд╕рд╛рде, рдмрд▓реНрдХрд┐ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдореЗрд▓ рд╕рд░реНрд╡рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  PS рдпрджрд┐ рдЖрдк рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде "рдХреЙрдкреА-рдкреЗрд╕реНрдЯ" рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рд░реВрд╕реА рд╡рд░реНрдЧ рд▓реЙрдЧ рдореЗрдВ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ (рдФрд░ рдЬрд┐рдиреНрд╣реЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ) рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛: <br><br><pre> <code class="plaintext hljs">pw usermod root -L russian</code> </pre><br>  рдЗрди рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдмрд╛рдж, рд░реВрд╕реА рд╡рд░реНрдгреЛрдВ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi476148/">https://habr.com/ru/post/hi476148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi476138/index.html">рдЦрдЧреЛрд▓рд╡рд┐рджреЛрдВ рдХрд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рд╕рдВрдЪрд╛рд░ рдЙрдкрдЧреНрд░рд╣ рд╕реНрдкреЗрд╕рдПрдХреНрд╕, рд╡рдирд╡реЗрдм рдФрд░ рдЕрдиреНрдп рдХрдВрдкрдирд┐рдпрд╛рдВ рдЦрдЧреЛрд▓ рд╡рд┐рдЬреНрдЮрд╛рди рдХреЗ рднрд╡рд┐рд╖реНрдп рдХреЗ рд▓рд┐рдП рдЦрддрд░рд╛ рд╣реИрдВ</a></li>
<li><a href="../hi476140/index.html">рдпрджрд┐ рдЖрдк 7000 рд╢рдмреНрджреЛрдВ рдХреЛ рдЬрд╛рдирддреЗ рд╣реИрдВ рддреЛ рд╕реБрдирдиреЗ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреИрд╕реЗ рдХрд░реЗрдВ рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдХрд╛рди рд╕реЗ рди рд╕рдордЭреЗрдВ?</a></li>
<li><a href="../hi476142/index.html">рдЬрд╛рд╡рд╛ рдореЗрдВ рдЕрдкрдиреЗ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрд╡рд╛рджреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдмрдЪреЗрдВ</a></li>
<li><a href="../hi476144/index.html">рд╕реАрдХреНрд░реЗрдЯ рд╕рд╛рдВрддрд╛ рдЦреЗрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрд░реЗ рдмреЙрдЯ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдкрдХреЛ рдмреЙрдЯ рдХреЗ рд▓рд┐рдП рдЪреИрдЯ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ</a></li>
<li><a href="../hi476146/index.html">рдбреЗрдЯрд╛ рдХреЗрдВрджреНрд░реЛрдВ рдХреЛ рдХреИрд╕реЗ рдкреИрдорд╛рдирд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рдПред рдпреИрдВрдбреЗрдХреНрд╕ рд░рд┐рдкреЛрд░реНрдЯ</a></li>
<li><a href="../hi476156/index.html">Apache Kafka рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдЕрдиреБрд░реЛрдз-рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛</a></li>
<li><a href="../hi476160/index.html">рд╢реИрдХреНрд╖рд┐рдХ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХрд╛ рдЬрдиреНрдо рдФрд░ рдЗрд╕рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕: рдпрд╛рдВрддреНрд░рд┐рдХ рдорд╢реАрдиреЛрдВ рд╕реЗ рдкрд╣рд▓реЗ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рддрдХ</a></li>
<li><a href="../hi476162/index.html">рд╣рдо рдПрдХ рдЖрдзреБрдирд┐рдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рддреЗ рд╣реИрдВред рдкрд░рд┐рдпреЛрдЬрдирд╛ рдФрд░ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░реА рдХреЗ рд╕рд╛рде рдкрд░рд┐рдЪрд┐рддред рднрд╛рдЧ 1</a></li>
<li><a href="../hi476164/index.html">"рдпрд╣ рдбреЗрдЯрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рднреА рд╣реИред" рдорд┐рдЦрд╛рдЗрд▓ рдЧреЗрд▓рдлреИрдВрдб рдХреЗ рд╕рд╛рде рдЬреИрд╡ рд╕реВрдЪрдирд╛ рд╡рд┐рдЬреНрдЮрд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВ</a></li>
<li><a href="../hi476166/index.html">"рд░рд┐рдпрд▓ рдЖрдпрд░рди рдореИрди" рдиреЗ рдЙрдбрд╝рд╛рди рдХреА рдЧрддрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рд░рд┐рдХреЙрд░реНрдб рддреЛрдбрд╝ рджрд┐рдпрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>