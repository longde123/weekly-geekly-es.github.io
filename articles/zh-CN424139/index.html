<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦇 🖤 👩🏿‍🎨 配置DFSR时最常见的错误和误解 🙍🏻 🚶🏿 👻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[注意 翻译者。 本文适用于Windows Server 2003 / 2003R2 / 2008 / 2008R2，但以上大部分内容适用于更高版本的操作系统] 

 大家好！ 沃伦（Warren ）又来了，这篇博客文章是我在过去几年中遇到的最常见的DFSR问题的汇编。 这篇文章的目的是列出导致这些...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>配置DFSR时最常见的错误和误解</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424139/"> <i>[注意</i>  <i>翻译者。</i>  <i>本文适用于Windows Server 2003 / 2003R2 / 2008 / 2008R2，但以上大部分内容适用于更高版本的操作系统]</i> <br><br> 大家好！  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">沃伦（Warren</a> ）又来了，这篇博客文章是我在过去几年中遇到的最常见的DFSR问题的汇编。 这篇文章的目的是列出导致这些问题的DFSR配置中的常见错误，并防止您犯类似的错误。 知道不应该做什么与​​知道<i>要做什么</i>一样重要。 所描述的许多项目都与其他主题相关，因此提供了相应的链接来深入研究该问题。 <br><a name="habracut"></a><br><h2> 配额大小太小，无法暂存文件夹 </h2><br> 您在杂志中看到代码为4202和4204的很多事件吗？ 在这种情况下，临时文件夹的大小设置不正确。 登台文件夹的大小设置不正确的不愉快后果是复制性能的降低，因为该服务将花费时间清理登台文件夹，而不是复制文件。 <br> 至少有两个原因，配置有足够的登台文件夹大小的DFSR服务器会更有效率： <br><br><ol><li> 与将文件创建，复制并删除每个主机伙伴的副本相比，将文件放入中间文件夹一次，然后将其发送给所有主机复制伙伴，效率要高得多。 </li><li> 如果操作系统的企业版至少安装在一个成员上，则服务器可以使用跨文件RDC技术<i>。</i>  <i>转换器：从Windows Server 2012开始，此技术在标准版中也<a href="">可用</a> ]</i> </li></ol><br> 临时文件夹的大小配置不正确也会导致复制循环。 如果已将复制的文件复制到接收服务器上的中间文件夹，但是中间文件夹清理机制先删除了该文件，然后再将其移动到目标文件夹，则会发生这种情况。 删除的文件将再次复制到服务器，并将再次被该服务器从中间文件夹中删除，因此服务器将永远无法接收该文件。 重复此过程，直到服务器接受该文件。 <br><br> 不要忽略登台文件夹的日志事件。 <br><br> 查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这篇文章</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">该文章</a>描述了如何使用方法来确定中间文件夹的最小大小。 <br><br> 请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处的</a> “增加临时配额”部分。 <br><br> 有关跨文件RDC的信息，您可以阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>发布的文章“有关远程差分压缩的信息”。 <br><br><h2> 预播程序不正确或未经测试 </h2><br> 预先准备的过程是将要复制的数据复制到新的复制成员服务器上，然后再添加到该服务器的目标文件夹中，以减少完成主复制所需的时间。 我遇到的预播过程的大多数失败是由三个原因引起的。 <br><br><ol><li> 源和目标的ACL不匹配。 </li><li> 复制到新的复制成员后，对文件进行了更改。 </li><li> 没有进行任何预测试来验证所使用的预播程序是否按预期工作。 </li></ol><br> 简而言之，必须以某种方式复制文件，并且在将它们复制到中间文件夹后就无法更改它们，并且整个过程必须由您进行预测试。 <br><br> 单击<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a> ，阅读堆先生的博客，了解如何正确组织DFSR服务器的预播过程。 <br><br><h2> 随着时间的流逝，复制队列较大 </h2><br> 除了存在较长时间的大型复制队列这一事实之外，这还意味着您的数据不同步，当包含旧内容的文件在冲突解决脚本中获胜时，这可能导致不良的冲突解决。 我遇到此行为的最常见情况是大量添加了新的复制文件夹。 一些管理员没有分阶段进行部署，而是一次添加了20个新文件夹，以便从20个不同分支进行复制，从而使主机服务器超载。 分阶段部署，以便主复制在合理的时间内完成。 <br><br><h2>  DFSR用作备份解决方案 </h2><br> 信不信由你，有些管理员部署DFSR时没有脱机复制数据的备份。  DFSR并非设计为备份解决方案。  DFSR开发的目标之一是成为企业备份策略的一部分，因为DFSR允许您在集中式站点上收集地理分布的数据，以供以后备份，恢复和归档。 多个复制成员提供了防止服务器故障的保护，但这并不能保护您免遭意外删除。 为了得到完全保护，您需要备份数据。 <br><br><h2> 单向复制：其使用和不正确的修复方法 </h2><br> 为了防止不必要的更新出现在永远不会更改数据的服务器上（或者如果他们希望防止对其进行更改），许多客户通过删除复制成员的传出连接来设置单向复制。  Windows Server 2008 R2之前的任何版本的DFSR不支持单向复制。  Windows 2008 R2支持单向复制，使您可以为复制的文件夹配置只读文件夹。 <br><br> 使用只读复制成员可以实现单向复制的目标，这可以防止正在复制的数据发生不必要的更改。 如果要通过DFSR使用单向复制，请使用Windows 2008 R2，对于那些不应更改的成员，请选择只读模式。 <br><br> 单击<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>以了解DFSR只读复制。 <br><br> 当管理员发现不支持单向复制并尝试纠正这种情况，但是以错误的方式进行操作时，会发生另一个常见问题。 简单地启用双向复制会产生不良结果。 <br><br> 单击<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>以了解如何解决单向复制。 <br><br><h2> 节点服务器是单点故障，节点服务器过载 </h2><br> 我已经看到许多使用单节点服务器的部署。 如果此节点服务器发生故障，则整个部署将处于危险之中。 如果使用Windows Server 2003或2008，则必须至少有两台主机服务器，并且其中一台崩溃了，另一台必须处理第一个主机的恢复时间，而对最终用户的影响却很小。 从Windows Server 2008 R2开始，DFSR可以部署在Windows故障转移群集上，在提供高可用性的同时将存储需求减半。 <br><br> 管理员迟早会遇到这样的情况，分支中的服务器太多，被配置为与单个节点服务器进行复制。 这可能导致复制延迟。 要了解单个节点服务器可以服务多少服务器办公室服务器，可以使用复制队列的跟踪。 没有神奇的公式，因为每个环境都是唯一的，并且存在许多依赖性。 <br><br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>阅读“拓扑配置”部分<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，</a>以了解有关部署主机服务器的信息。 <br> 单击<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>了解如何在Windows Server 2008故障转移群集上配置DFSR。 <br><br><h2> 太多文件夹无法复制到单个Jet数据库 </h2><br>  DFSR在卷上使用一个Jet数据库。 结果，将所有复制的文件夹放在同一卷上会导致它们都在同一个Jet数据库中。 如果此数据库中出现需要修复或还原的问题，则该数据库将影响此磁盘上的所有复制文件夹。  <i>[注意</i>  <i>翻译者。</i>  <i>显然，这不是磁盘，而是卷。]</i>使用尽可能多的磁盘并在其中分配复制的文件夹，从而确保最大的数据可用性时间，是更正确的选择。 <br><br><h2> 基于预算iSCSI解决方案的部署 </h2><br> 我经常看到使用最便宜的iSCSI硬件进行DFSR部署。 通常，如果使用DFSR，则这样做是为了达到关键目标，例如数据冗余，备份合并，应用程序的预定交付和操作系统更新。 让自己依赖没有常规供应商支持的低质量设备不是一个好主意。 如果数据对您的业务很重要，那么运行OS和复制机制的设备对此就很重要。 <br><br><h2>  DFSR服务未安装当前补丁 </h2><br>  DFSR得到Microsoft的积极支持，并根据需要进行更新。 如果在下一个更新安装周期时有新版本发布，请更新DFSR。 确保根据下面列出的知识库文章更新服务器。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Windows 2003 R2的DFSR修补程序</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Windows 2008和Windows 2008 R2的DFSR修补程序</a> <br><br> 请注意，除了DFSR.EXE / DFSRS.EXE，列出的更新还适用于NTFS.SYS和其他文件。 为了使复制正常工作，请始终确保至少为DFSR和NTFS安装了最新的修补程序。 列表中的其他更正主要涉及用户界面问题，因此您至少需要在执行DFSR配置任务的系统上安装它们。 <br><br> 即使一切正常，也建议提前在DFSR服务器上安装补丁，因为稍后这将帮助您避免出现已知问题。 <br><br><h2> 最新不支持网络适配器驱动程序 </h2><br>  DFSR仅在您为其提供的网络也可以正常工作的情况下才能正常运行。  5年前使用驱动程序不是最明智的解决方案。 我曾与几位客户进行交流，这些客户通过更新过时的NIC驱动程序解决了DFSR复制问题。 <br><br><h2> 缺少DFSR监控 </h2><br> 尽管事实上DFSR通常用于移动关键数据，但是许多管理员直到遇到问题才知道DFSR在做什么。 那些资源更丰富的人可以创建自己的脚本来监视服务器上的复制队列，但大多数情况下只是依靠它。  DFSR的管理包已于大约一年前发布（其他版本更早出现）。 安装并使用它-然后，您可以在问题变成噩梦之前检测出问题并做出响应。 如果无法使用Operations Management Management Pack for DFSR，则至少要编写一个脚本来每天监视复制队列，以了解DFSR文件是否正在复制。 <br><br> 单击<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a> ，获取有关DFSR的Operations Management管理包的信息。 <br><br>  <b>2011年1月19日更新：</b> <br><h2> 无需先存档数据即可更改磁盘存储 </h2><br> 如果DFSR服务器需要更换硬盘驱动器或添加新的硬盘驱动器以增加存储空间，则在发生问题时进行最新的数据备份非常重要。 一切都可能出错，最常见的冲突事件是由于父文件夹中的意外更改或意外删除了父文件夹（复制到所有伙伴）而发生的。 您必须先备份数据，然后再进行更改并保留到项目完成。 <br><br><h2> 停止DFSR服务以暂时停止复制 </h2><br> 有时您需要暂时停止复制。 正确的方法是使用计划为所需的组禁用复制。  DFSR服务必须正在运行，以便能够读取USN日志中的更新。 请勿长时间（几天，几周）停止DFSR服务，因为这可能导致日志溢出（如果在此期间更改，添加或删除了许多文件）。  DFSR将从日志溢出中恢复，但是在大型部署中，它将花费很长时间，并且复制将无法进行或在日志恢复期间非常缓慢。 另外，在日志恢复完成之前，您可能会观察到非常大的复制队列。 <br><br> 希望这份清单对您有所帮助。 复制好！ <br><br> 沃伦·“宽网”威廉姆斯 <br><br>  <i>[注意</i>  <i>翻译者。</i>  <i>如果读者感兴趣，我将在稍后尝试翻译发布在文本中所示链接上的文章以及原始作者的其他文章]。</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424139/">https://habr.com/ru/post/zh-CN424139/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424129/index.html">Android开发。 有关快速使用列表的一些知识</a></li>
<li><a href="../zh-CN424131/index.html">智能系统开发人员宣言：15条原则</a></li>
<li><a href="../zh-CN424133/index.html">通过人文视角虚拟化建筑局的工作</a></li>
<li><a href="../zh-CN424135/index.html">欧盟批准新的版权指令-它将如何影响互联网</a></li>
<li><a href="../zh-CN424137/index.html">您如何庆祝程序员的一天？</a></li>
<li><a href="../zh-CN424141/index.html">游戏设计栩栩如生。 游戏的经济学（第一部分）</a></li>
<li><a href="../zh-CN424143/index.html">＃271移动开发人员的有趣材料摘要（9月17日至23日）</a></li>
<li><a href="../zh-CN424147/index.html">Telltale就是一切。 可惜</a></li>
<li><a href="../zh-CN424149/index.html">96 fps水彩频率：电影摄影中的革命或格式暴动</a></li>
<li><a href="../zh-CN424151/index.html">唇形标签贴标机-以编程方式扩大圆柱变形</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>