<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÑ ‚úãüèª üíÆ Mi direcci√≥n no es una casa o calle, mi direcci√≥n es la Uni√≥n Sovi√©tica. üë®üèª‚Äçüî¨ ü§πüèæ üçµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="microBIGDATA o FIAS en tu bolsillo 


 Peter Brueghel el Joven, pago de impuestos , 1640 

 La √∫ltima entrada en la afeitadora en los objetos fue. Con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mi direcci√≥n no es una casa o calle, mi direcci√≥n es la Uni√≥n Sovi√©tica.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438062/"> <b>microBIGDATA o FIAS en tu bolsillo</b> <br><br><img src="https://habrastorage.org/webt/gq/le/vh/gqlevhij14f0jkubb4pmbjwvb5u.jpeg"><br>  <i>Peter Brueghel el Joven, <b>pago de impuestos</b> , 1640</i> <br><br>  La √∫ltima entrada en la afeitadora <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en los objetos</a> fue.  Continuaremos el reconocimiento en la batalla.  Hoy hablaremos de lo dif√≠cil.  Todav√≠a no se trata de GRANDES DATOS, pero ya es un inconveniente trabajar: grandes cantidades de datos.  No todos caben en toda la RAM, pero algunos ni siquiera caben en el disco (no hay suficiente espacio, pero mucha basura).  El nombre de nuestra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">base de datos FIAS de</a> confianza es la base de datos del sistema de informaci√≥n de direcciones federales.  Archivo de 5,5 GB.  Y est√° comprimido en un archivo XML.  Despu√©s de desempacar, habr√° 53 GB completos (almacena 110 GB para desempacar).  Y cuando comience a analizarlo y convertirlo, entonces 110 GB no ser√°n suficientes.  Acerca de la cantidad requerida de RAM tambi√©n ser√°. <br><a name="habracut"></a><br>  Todo estar√≠a bien, pero puedes cavar m√°s.  Existe un proyecto internacional de sistematizaci√≥n y recopilaci√≥n de datos de c√≥digo abierto: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenAddresses</a> .  Entonces habr√° m√°s bases de datos.  La cobertura actual del planeta tiene muchos puntos blancos, por ejemplo, Rusia est√° casi ausente.  El tama√±o del archivo es de 10 GB. <br><br>  O una base de datos de un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyecto OpenStreetMaps</a> bastante conocido.  Est√° construido por voluntarios sobre la base de Wikipedia.  Bastante detallado y multiling√ºe.  Ahora un archivo completo de XML comprimido con un tama√±o de 74 GB. <br><blockquote>  Si comenzaron a hablar de direcciones, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">llegaron noticias</a> inesperadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">a tiempo de DuckDuckGo</a> , el mejor motor de b√∫squeda seguro para hoy, sobre su transici√≥n a las tarjetas de Apple.  M√°s precisamente en Apple MapKit JS.  La caracter√≠stica m√°s interesante en nuestro contexto es la "b√∫squeda mejorada de direcciones".  ¬øEs Apple el mejor que recopila y protege minuciosamente nuestros datos?  Ser√° necesario rastrear ... </blockquote>  Entonces el desaf√≠o.  C√≥mo poner toda esta riqueza de direcciones en un repositorio agradable para su uso, para permitirle so√±ar con una API gratuita (en Python, por supuesto) y no dejar que su querido hierro se atragante con una carga no le√≠da.  Llam√©moslo MicroBigData - mcBD o ŒºBG en ingl√©s :-) <br><br>  En la econom√≠a de cada segundo (o incluso el primero) desarrollador, esto es un directorio de direcciones, tambi√©n es un directorio de top√≥nimos, algo muy necesario.  Y cuando tambi√©n es normativo, preparado, limpio y bien documentado por el cuerpo correcto, es solo un cuento de hadas.  Debemos rendir homenaje, el servicio fiscal ruso est√° haciendo bien su producci√≥n digital.  En la medida de lo posible.  Probablemente hay algunos defectos en el interior y la limpieza de datos contin√∫a.  C√≥mo resolver este problema, deje que los jefes de estado piensen.  Ellos deciden por nosotros mismos y para el beneficio de todos nosotros.  Por cierto, se encontr√≥ un error tipogr√°fico de FIAS en el siguiente ejemplo.  El resultado no se ve afectado.  No lo arregl√©.  Vas a encontrar? <br><br>  No s√© cu√°n espec√≠ficos son relevantes los datos de la direcci√≥n en sus proyectos: todas estas regiones, ciudades, calles.  Pero parece que ni un solo proyecto para personas puede prescindir de ellos.  Esa es la direcci√≥n donde buscar a una persona o d√≥nde enviarle paquetes.  Se deben guardar los detalles del pasaporte o cualquier otro documento.  O tal vez es la direcci√≥n de la oficina de trabajo o las atracciones que se recomiendan visitar.  Y que hacer  Donde conseguir <br><br>  La soluci√≥n m√°s simple, sin tener en cuenta los errores y los duplicados, son los objetos primitivos que contienen literales de cadena simples (son constantes de cadena, tambi√©n son cadenas).  Permita que los usuarios ingresen las siguientes entradas recibidas en ellos.  Y los objetos saben c√≥mo salvarse a s√≠ mismos; ya hemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pasado esto</a> . <br><br>  Tales objetos son, por ejemplo, como se describe en la clase a continuaci√≥n.  <a href="">Directamente del libro de texto</a> , aunque estadounidense, pero ajustado a nuestra realidad rusa; en lugar de su c√≥digo postal, estar√° nuestro c√≥digo postal.  Tambi√©n reemplazar√≠a el c√≥digo postal con un n√∫mero, pero en aras de la monoton√≠a, dejo una cadena.  Cualquiera que reconozca inmediatamente un lenguaje, y este es ObjectScript, tiene derecho a un me gusta alentador. <br><br><pre><code class="plaintext hljs">Class Soviet.Address Extends %Persistent { Property streetName As %String; Property cityName As %String; Property areaName As %String; Property postalCode As %String; }</code> </pre> <br>  Por supuesto, muchos se indignar√°n, dicen que todo sobresale de los bolsillos del objeto (literales).  ¬øD√≥nde se ha visto, para que el objeto brille sus campos p√∫blicamente?  Dej√©moslo as√≠, duele tambi√©n un ejemplo elocuente y es comprensible para cualquier estudiante. <br><br>  Esto es en realidad todo lo que se necesita.  Lleno en los campos.  Poner en almacenamiento.  Transferido a otros objetos para el trabajo.  Heredado m√°s all√° de alguien.  Todo funciona  Y almacenado! <br><blockquote>  Pero hay que decir algunas palabras de por qu√© no vale la pena hacerlo.  ¬øCu√°l es nuestra direcci√≥n de objeto?  ¬øPor qu√© no puede ser solo un grupo de cadenas de texto?  Las objeciones m√°s obvias que vienen a la mente provienen del contexto: ¬øqui√©n usa esta direcci√≥n, de qu√© forma y con qu√© prop√≥sito?  Trate de dejar a un lado su pensamiento de programaci√≥n e imagine c√≥mo piensa un "turista extranjero", "historiador", "inspector de impuestos", "abogado", etc. <br><br>  Creo que de inmediato surgen una serie de preguntas y aclaraciones adicionales: ¬øqu√© idioma usar, en qu√© codificaci√≥n almacenar y dar, en qu√© √©poca clasificar, qu√© documentos se aplican, legales o postales?  ¬øEs una ciudad un asentamiento con nombre o qu√©?  Incluso una calle puede convertirse en un bulevar, una calle lateral, una avenida u otra cosa.  ¬øQu√© hacer con todos estos detalles importantes de implementaci√≥n? <br><br>  Toma un ejemplo vivo.  Google ahora est√° dirigido por Sundar Pichai.  √âl mismo es de la India.  Nacido en la ciudad de Chennai (tambi√©n conocido como Chennai).  ¬øO en Madras?  En 1996, los indios decidieron que el nombre de la ciudad era muy portugu√©s y cambiaron el nombre de la capital de Tamil Nadu de Madras a Chennai.  ¬øY qu√© deber√≠an escribir Sundar y 72 millones de sus compatriotas en sus documentos electr√≥nicos? <br><br>  En general, toda la ciencia se ocupa de esto: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la toponimia aplicada</a> . </blockquote>  Entonces las preguntas ruegan.  ¬øC√≥mo lidiar con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hora y la fecha</a> ?  ¬øEs tan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">obvio el dinero</a> ?  ¬øLas coordenadas geogr√°ficas son tan simples?  ¬øY c√≥mo se implementa esto en su c√≥digo?  ¬øSe puede transferir al DBMS seleccionado sin disminuir el nivel de abstracci√≥n?  ¬øC√≥mo no deslizarse en tipos at√≥micos de datos de m√°quinas y pensar constantemente en su reconstrucci√≥n?  Aqu√≠ vale la pena buscar la fuente de una API primitiva o, por el contrario, s√≥lida.  Pi√©nsalo a tu gusto. <br><br>  En resumen, el contexto es lo m√°s importante.  Y el modelo de objetos nos permite usarlo directamente a trav√©s de la encapsulaci√≥n de "datos de la m√°quina" y la implementaci√≥n de un comportamiento "en vivo" sensible al contexto.  Para nada las tuplas de bajo nivel presentadas en las tablas ;-) <br><br>  Mientras tanto, volvamos a la implementaci√≥n "primitiva" y compliquemos nuestras vidas.  Para comenzar, elimine errores y duplicados.  Es decir, buscaremos una forma de escribir direcciones de inmediato.  Al mismo tiempo, ayudaremos a los desarrolladores de la interfaz de usuario a organizar sugerencias para los usuarios al completar los campos de entrada de datos. <br><blockquote>  Cuando dos personas se re√∫nen en un solo lugar: mensajes de texto y la plataforma de datos IRIS de InterSystems, el desarrollador tiene una oportunidad real de desplegarse al m√°ximo sin salir de la m√°quina.  Por ejemplo, usando los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">componentes de objetos integrados iKnow e iFind</a> .  Estos son componentes para trabajar con datos no estructurados y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">b√∫squeda de texto completo</a> , respectivamente.  El ruso es compatible "fuera de la caja". </blockquote>  Lo primero es lo primero, le ense√±aremos a la Direcci√≥n a leer los datos necesarios de la fuente original.  Afortunadamente, el conjunto de datos del servicio de impuestos federales tiene descripciones preparadas de la estructura de los documentos XML.  De acuerdo con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descripci√≥n</a> adjunta a los datos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">del sitio web de FIAS</a> , necesitamos el conjunto de datos ADDROBJ, que, en mi caso, corresponde al archivo AS_ADDROBJ_2_250_01_04_01_01.xsd <br><br>  A continuaci√≥n, utilizaremos el convertidor de sistema de la plantilla XSD a la estructura de campo correspondiente de la clase% XML.Adaptor, amablemente preparada por los desarrolladores de IRIS.  El signo de porcentaje al principio solo significa que esta es una clase de la biblioteca del sistema.  <a href="">Los detalles de uso se encuentran en la documentaci√≥n</a> .  Realizaremos operaciones en la terminal. <br><br><pre> <code class="plaintext hljs">set xmlScheme = ##class(%XML.Utils.SchemaReader).%New() do xmlScheme.Process("http://localhost/AS_ADDROBJ_2_250_01_04_01_01.xsd")</code> </pre> <br>  Lo mismo se puede obtener en el <a href="">Atelier IDE</a> (en el men√∫ Herramientas&gt; Complementos&gt; Asistente de esquema XML) o mediante solicitudes similares a objetos directamente desde el c√≥digo del programa. <br><br><img src="https://habrastorage.org/webt/ed/3k/8c/ed3k8cfd9t_jc8gklg_euthhihy.png"><br><br>  Como utilizamos el constructor sin especificar los par√°metros, es decir, el nombre del paquete para colocar las clases resultantes, terminaron en el paquete Prueba.  Como puede ver en el segundo comando, le di el archivo de esquema a trav√©s de mi servidor web local en Python: <br><br><pre> <code class="bash hljs">python3 -m http.server 80</code> </pre> <br>  Puede usar cualquier otro servidor http que desee.  O suba el archivo a su servidor IRIS e indique la ruta directa al mismo. <br><br>  Como resultado, tenemos dos clases que reflejan completamente la estructura de nuestro XML direccionable: <br><br><div class="spoiler">  <b class="spoiler_title">Test.AddressObjects</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///            Class Test.AddressObjects Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "AddressObjects"; Parameter XMLSEQUENCE = 1; ///    Relationship Object As Test.Object(XMLNAME = "Object", XMLPROJECTION = "ELEMENT") [ Cardinality = many, Inverse = AddressObjects ]; }</code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">Test.object</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///  : http://localhost:28869/AS_ADDROBJ_2_250_01_04_01_01.xsd Class Test.Object Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property FORMALNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "FORMALNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property REGIONCODE As %String(MAXLEN = 2, MINLEN = 2, XMLNAME = "REGIONCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AUTOCODE As %String(MAXLEN = 1, MINLEN = 1, XMLNAME = "AUTOCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AREACODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "AREACODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property CITYCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CITYCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property CTARCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CTARCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property PLACECODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "PLACECODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property PLANCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "PLANCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property STREETCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "STREETCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property EXTRCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "EXTRCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property SEXTCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "SEXTCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSUL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// OKATO Property OKATO As %String(MAXLEN = 11, MINLEN = 11, XMLNAME = "OKATO", XMLPROJECTION = "ATTRIBUTE"); /// OKTMO Property OKTMO As %String(MAXLEN = 11, MINLEN = 8, XMLNAME = "OKTMO", XMLPROJECTION = "ATTRIBUTE"); ///    Property UPDATEDATE As %Date(XMLNAME = "UPDATEDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///        Property PREVID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PREVID", XMLPROJECTION = "ATTRIBUTE"); ///        Property NEXTID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NEXTID", XMLPROJECTION = "ATTRIBUTE"); ///           4.0. Property CODE As %String(MAXLEN = 17, MINLEN = 0, XMLNAME = "CODE", XMLPROJECTION = "ATTRIBUTE"); ///      4.0      (  ) Property PLAINCODE As %String(MAXLEN = 15, MINLEN = 0, XMLNAME = "PLAINCODE", XMLPROJECTION = "ATTRIBUTE"); ///     .     .      . /// 0 ‚Äì   /// 1 -  Property ACTSTATUS As %Integer(XMLNAME = "ACTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///   Property CENTSTATUS As %Integer(XMLNAME = "CENTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     ‚Äì    (.   OperationStatus): /// 01 ‚Äì ; /// 10 ‚Äì ; /// 20 ‚Äì ; /// 21 ‚Äì  ; /// 30 ‚Äì ; /// 31 -     ; /// 40 ‚Äì    (); /// 41 ‚Äì     ; /// 42 -        ; /// 43 -         ; /// 50 ‚Äì ; /// 51 ‚Äì     ; /// 60 ‚Äì    ; /// 61 ‚Äì        Property OPERSTATUS As %Integer(XMLNAME = "OPERSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    4 (    ) Property CURRSTATUS As %Integer(XMLNAME = "CURRSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    Property STARTDATE As %Date(XMLNAME = "STARTDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property ENDDATE As %Date(XMLNAME = "ENDDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property NORMDOC As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NORMDOC", XMLPROJECTION = "ATTRIBUTE"); ///     Property LIVESTATUS As %xsd.byte(VALUELIST = ",0,1", XMLNAME = "LIVESTATUS", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///  : /// 0 -   /// 1 - ; /// 2 - - Property DIVTYPE As %xsd.int(VALUELIST = ",0,1,2", XMLNAME = "DIVTYPE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; Relationship AddressObjects As Test.AddressObjects(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = Object ]; }</code> </pre> <br></div></div><br>  De la lista completa de archivos xml en FIAS, utilizaremos solo un archivo con los nombres de regiones, ciudades y calles.  Al momento de preparar la publicaci√≥n, ten√≠a esto: <br>  AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML <br><br>  El tama√±o del archivo no es grande ni peque√±o, sino casi 3 GB.  No lo abrir√° con herramientas de texto normales: no resumen este tama√±o. <br><blockquote>  Por cierto, la longitud m√°xima de un literal de cadena (tipo de cadena) en InterSystems IRIS no es m√°s de 3,641,144 caracteres.  Es decir, descargar el archivo directamente o la URL en √©l fallar√°.  Otras restricciones se pueden encontrar <a href="">en la documentaci√≥n</a> .  Para trabajar con grandes vol√∫menes de datos, puede usar flujos de datos (flujos) que no tengan dicho l√≠mite de longitud. </blockquote>  ¬øA ver qu√© tenemos? <br><br>  Cocinar pimientos rellenos FIAS.  Esto es solo una preparaci√≥n para un futuro maravilloso.  Primero obtenemos el conjunto m√≠nimo inicial.  Solo necesitamos estos ingredientes: <br><br><pre> <code class="plaintext hljs">Class FIAS.AddressObject Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ];</code> </pre><br>  Luego, <a href="https://docs.intersystems.com/irislatest/csp/docbook/DocBook.UI.Page.cls?KEY=GXML_import#GXML_import_">escribe</a> .  Creamos un objeto que entiende XML como nativo: utilizamos una clase de la biblioteca del sistema% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre> <br>  Y le damos instrucciones, a qui√©n tomar, e ignoramos el resto.  Tomaremos una porci√≥n: <br><br><pre> <code class="plaintext hljs">do reader.Correlate("Object","FIAS.AddressObject")</code> </pre> <br>  Luego hay variaciones sobre c√≥mo obtener el archivo microbd original.  Si es conveniente, puede colocarlo junto al repositorio, localmente en el sistema de archivos del servidor IRIS.  O, como en mi ejemplo, pida enviar a trav√©s de HTTP.  Hay una opci√≥n a√∫n m√°s universal, sobre la cual habr√° un par de palabras a continuaci√≥n. <br><br><pre> <code class="plaintext hljs">set url="http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML" write reader.OpenUrl(url)</code> </pre> <br><blockquote>  Importante!  En este momento, la mayor√≠a que pasar√° este ejemplo sobre s√≠ mismos tendr√° algo terrible.  El sistema regresar√° en lugar del alegre "1" (todo est√° en orden), algo que comienza con "0 ¬∏ STORE ...".  Y no lo har√° por favor.  Es decir, el archivo con una microbase aparentemente no es del todo micro y no cabe en nuestro objeto.  La memoria asignada para √©l no fue suficiente.  Soluble?  Por supuesto  La plataforma de datos IRIS le permite crear objetos de hasta 4 TB en RAM.  Entonces, ¬øqu√© sali√≥ mal?  De manera predeterminada, la configuraci√≥n del sistema est√° establecida en 256 MB por objeto.  Y necesitar√≠amos mucho m√°s.  Y recuerde, estos son requisitos de RAM.  ¬øHay suficiente stock en su computadora / servidor? </blockquote>  ¬øQu√© tama√±o de memoria necesitamos para instalar este gigante que hemos instalado emp√≠ricamente? Casi 10 GB.  Lo que necesita especificar en la configuraci√≥n (Men√∫&gt; Configurar memoria&gt; Memoria m√°xima por proceso (KB)) o mediante la <a href="">variable del sistema $ ZSTORAGE</a> (en kilobytes): <br><br><pre> <code class="plaintext hljs">set $ZSTORAGE=10000000</code> </pre> <br>  ¬øLanz√≥ un nuevo proceso con la configuraci√≥n de memoria necesaria?  Entonces todo es m√°s simple: leemos y guardamos. <br><br>  Hay una opci√≥n alternativa (y probablemente preferida): <a href="">use la propiedad UsePPGHandler</a> de la clase% XML.Reader que le permite no almacenar XML en la memoria y funciona con configuraciones de memoria est√°ndar. <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New() set reader.UsePPGHandler = 1</code> </pre> <br>  m√°s ... Correlacionar / Leer, etc.  ... <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre> <br>  Y as√≠ 3.722.548 veces por cada operaci√≥n :-) <br><br>  Esto es agotador  Por lo tanto, complementamos nuestra clase FIAS.AddressObject con un m√©todo para importar, basado en los comandos que se acaban de mostrar: <br><br><pre> <code class="plaintext hljs">ClassMethod Import() { //     XML Set reader = ##class(%XML.Reader).%New() //   XML   Set status = reader.OpenURL("http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML") If $$$ISERR(status) {Do $System.Status.DisplayError(status)} //       Do reader.Correlate("Object","FIAS.AddressObject") //       While (reader.Next(.object,.status)) { Set status = object.%Save() If $$$ISERR(status) {do $System.Status.DisplayError(status)} } //      ,   If $$$ISERR(status) {Do $System.Status.DisplayError(status)} }</code> </pre> <br>  Usemos el poder de nuestra computadora exocortex, solo un comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(FIAS.AddressObject).Import()</code> </pre> <br><img src="https://habrastorage.org/webt/bd/mh/t7/bdmht7k0urpyo07qcdcmkj5_nym.gif"><br><br>  Pido a todos a la mesa.  Hubo MCD, y ahora el plato terminado en forma de global con los nombres verificados de ciudades y pesos rusos est√° listo. <br><br><img src="https://habrastorage.org/webt/1u/he/a6/1uhea6bdexgrpwlfpmtn2b2gdyy.png"><br><br>  Y finalmente un par de palabras sobre cu√°ndo 4 TB no es suficiente.  En este caso, <a href="">seguimos las transmisiones</a> (o transmisiones si lo desea).  La documentaci√≥n se presenta en estanter√≠as.  Puedes binario, puedes simb√≥lico.  La tienda en el mundo tampoco est√° prohibida.  La receta es esta: tomamos una corriente, la cortamos en partes y se la damos a los objetos que necesitamos para el consumo. <br><br>  Adem√°s, los hermosos objetos ObjectScript y API direccionables en Python no encajaban.  Habr√° una historia separada. <br><blockquote>  Agradable: Gartner acaba de completar la colecci√≥n anual de valoraciones y rese√±as de usuarios reales en la categor√≠a DBMS y, sobre esta base, ha publicado su calificaci√≥n del mejor DBMS de 2019.  Los productos InterSystems Cach√© e InterSystems IRIS Data Platform han recibido la calificaci√≥n m√°s alta de elecci√≥n del consumidor.  De qui√©n eligi√≥ y c√≥mo calific√≥, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puede echar un vistazo usted mismo</a> . </blockquote>  El mejor software de sistemas operativos de gesti√≥n de bases de datos de 2019 seg√∫n lo revisado por los clientes <br><br><img src="https://habrastorage.org/webt/gw/jg/dd/gwjgdd1segqlvnnpfzgo9buww4y.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438062/">https://habr.com/ru/post/438062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438034/index.html">Android, Rx y Kotlin, o c√≥mo hacer que una garra de Lego se encoja. Parte 1</a></li>
<li><a href="../438036/index.html">3blue1brown y MIT en ruso</a></li>
<li><a href="../438038/index.html">Carrera de esteroides. Historias reales</a></li>
<li><a href="../438058/index.html">"An√°lisis de datos en Python" en dos partes</a></li>
<li><a href="../438060/index.html">Estimaci√≥n de la orientaci√≥n espacial, o C√≥mo no temer a los filtros de Mahoney y Majwik</a></li>
<li><a href="../438064/index.html">Lista de verificaci√≥n: lo que hab√≠a que hacer antes de iniciar microservicios en prod</a></li>
<li><a href="../438066/index.html">10 canales educativos de YouTube en ingl√©s de los que nunca has o√≠do hablar</a></li>
<li><a href="../438070/index.html">¬øC√≥mo se convirti√≥ la generaci√≥n Y en una generaci√≥n quemada?</a></li>
<li><a href="../438074/index.html">[Anuncio para Ekaterimburgo, Novosibirsk, San Petersburgo] Sesi√≥n de prueba de automatizaci√≥n: Cubriremos todo, desde Neva hasta Ob con pruebas</a></li>
<li><a href="../438078/index.html">Facebook paga $ 20 por mes por configurar su pseudo-VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>