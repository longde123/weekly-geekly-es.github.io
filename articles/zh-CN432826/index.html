<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😣 🕳️ 👜 Kotlin上的现代Android开发。 第二部分 🧑🏾‍🤝‍🧑🏾 🕦 👰🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="哈Ha！ 我向您介绍Mladen Rakonjac撰写的文章“ 用Kotlin进行现代Android开发（第2部分） ”的翻译。 

 注意事项 本文是Mladen Rakonjac撰写的系列文章的翻译，文章日期：09/23/2017。 Github 开始阅读SemperPeritus的第一部分时，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kotlin上的现代Android开发。 第二部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432826/"> 哈Ha！ 我向您介绍Mladen Rakonjac撰写的文章“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">用Kotlin进行现代Android开发（第2部分）</a> ”的翻译。 <br><br>  <i>注意事项</i>  <i>本文是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mladen Rakonjac</a>撰写的系列文章的翻译，文章日期：09/23/2017。</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a></i>  <i>开始阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">SemperPeritus</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第一</a>部分时<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">，我</a>发现该部分的其余部分由于某种原因未进行翻译。</i>  <i>因此，我提请您注意第二部分。</i>  <i>原来，这篇文章篇幅很大。</i> <br><br><img src="https://pbs.twimg.com/media/DIIHg0eV0AAl0u5.jpg" alt="图片"><br><br>  “在Android Studio 3.0中很难找到一个涵盖Android开发中所有新事物的项目，所以我决定编写它。” <br><a name="habracut"></a><br> 在本文中，我们将分析以下内容： <br><br><ol><li>  Android Studio 3 beta 1 <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1部分</a></b> </li><li>  Kotlin编程语言<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1部分</a></b> </li><li> 构建选项<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1部分</a></b> </li><li>  ConstraintLayout <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1部分</a></b> </li><li> 数据绑定库<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第1部分</a></b> </li><li>  <b>MVVM体系结构+存储库+ Android Manager Wrappers模式</b> </li><li>  RxJava2及其在<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第3部分</a></b>架构中如何帮助我们 </li><li>  Dagger 2.11，什么是依赖注入，为什么要使用此<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第4部分</a></b> </li><li> 改造（使用Rx Java2） </li><li> 会议室（带有Rx Java2） </li></ol><br><h2>  MVVM体系结构+存储库+ Android Manager Wrappers模式 </h2><br><h3> 关于Android世界中的体系结构的几句话 </h3><br> 相当长一段时间以来，Android开发人员在其项目中未使用任何架构。 在过去的三年中，她在Android开发人员社区中引起了很多炒作。  God Activity的时代已经过去，Google已发布了<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android Architecture Blueprints</a></b>存储库，其中包含有关各种体系结构方法的许多示例和说明。 最后，在Google IO '17上，他们引入了<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android Architecture Components</a></b> ，这是一个库集合，旨在帮助我们创建更简洁的代码并改进应用程序。  <b>Component</b>说您可以使用所有这些，也可以只使用其中之一。 但是，我发现它们都非常有用。 在正文和后续部分中，我们将继续使用它们。 首先，我将解决代码中的问题，然后使用这些组件和库进行重构，以查看它们应解决的问题。 <br><br> 有两种共享GUI代码的主要<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">架构模式</a> ： <br><br><ul><li> 最有价值球员 </li><li>  MVVM </li></ul><br> 很难说哪个更好。 您必须同时尝试并决定。 我更喜欢<b>使用生命周期感知组件的MVVM</b> ，我将对此进行介绍。 如果您从未尝试使用MVP，那么在Medium上会有很多关于此的好文章。 <br><br><h3> 什么是MVVM模式？ </h3><br>  MVVM是一种可扩展为Model-View-ViewModel的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">体系结构模式</a> 。 我认为这个名称使开发人员感到困惑。 如果我是提出他名字的人，我将其称为View-ViewModel-Model，因为<b>ViewModel</b>位于中间，将<b>View</b>和<b>Model</b>连接起来。 <br><br>  <b>视图</b>是<b>Activity</b> ， <b>Fragment</b>或任何其他自定义视图（ <b>Android自定义视图</b> ）的抽象。 请注意，请勿将此<b>视图</b>与Android视图混淆。  <b>视图</b>应该是愚蠢的，我们不应该为其编写任何逻辑。  <b>视图</b>不应包含数据。 它应该存储对<b>ViewModel</b>实例的引用，并且<b>View</b>需要的所有数据都应来自该实例。 另外，当<b>ViewModel中</b>的数据更改时， <b>View</b>应该观察到此数据，并且布局也应更改。 总而言之， <b>View</b>负责以下工作：各种数据和状态的布局视图。 <br><br>  <b>ViewModel</b>是包含数据和逻辑的类的抽象名称，应在何时接收此数据以及何时显示该数据。  <b>ViewModel</b>存储当前<b>状态</b> 。  <b>ViewModel</b>还存储一个或多个<b>Model</b>的链接，并从中接收所有数据。 例如，她不应该知道数据来自哪里，来自数据库还是来自服务器。 另外， <b>ViewModel</b>不需要了解有关<b>View的</b>任何信息。 而且， <u><b>ViewModel</b>应该完全不了解Android框架。</u> <br><br>  <b>Model</b>是为<b>ViewModel</b>准备数据的层的抽象名称。 这是我们将从服务器接收数据并将其缓存或存储在本地数据库中的类。 请注意，这些类别与User，Car，Square和其他仅存储数据的模型类别不同。 通常，这是存储库模板的实现，我们将在以后考虑。  <b>模型</b>不应该对<b>ViewModel</b>一无所知。 <br><br> 如果正确实施， <b>MVVM</b>是破坏代码并使其更具可测试性的好方法。 这有助于我们遵循<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SOLID</a></b>原则，因此我们的代码更易于维护。 <br><br><h3> 代码示例 </h3><br> 现在，我将编写一个简单的示例来说明其工作原理。 <br><br> 首先，让我们创建一个返回一行的简单<b>模型</b> ： <br><br><div class="spoiler">  <b class="spoiler_title">RepoModel.kt</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepoModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : String </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Some new data"</span></span> } }</code> </pre> <br></div></div><br> 通常，接收数据是<b>异步</b>调用，因此我们必须等待它。 为了模拟这一点，我将类更改为以下内容： <br><br><div class="spoiler">  <b class="spoiler_title">RepoModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepoModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onDataReadyCallback: OnDataReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ Handler().postDelayed({ onDataReadyCallback.onDataReady(<span class="hljs-string"><span class="hljs-string">"new data"</span></span>) },<span class="hljs-number"><span class="hljs-number">2000</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnDataReadyCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data : String)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br></div></div><br> 我使用<code><b>onDataReady</b></code>方法创建了<code><b>OnDataReadyCallback</b></code>接口。 现在<code><b>refreshData</b></code>方法实现（实现） <code><b>OnDataReadyCallback</b></code> 。 为了模拟等待，我使用<code><b>Handler</b></code> 。  <code><b>onDataReady</b></code> 2秒一次，将在实现<code><b>OnDataReadyCallback</b></code>接口的类上调用<code><b>onDataReady</b></code>方法。 <br><br> 让我们创建一个<b>ViewModel</b> ： <br><br><div class="spoiler">  <b class="spoiler_title">MainViewModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repoModel: RepoModel = RepoModel() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isLoading: Boolean = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }</code> </pre> <br></div></div><br> 如您所见，有一个<code><b>RepoModel</b></code>实例， <code><b>text</b></code>实例（将显示）和一个<code><b>isLoading</b></code>变量来存储当前状态。 让我们创建一个负责检索数据的<code><b>refresh</b></code>方法： <br><br><div class="spoiler">  <b class="spoiler_title">MainViewModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> </span></span>{ ... val onDataReadyCallback = object : OnDataReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: String)</span></span></span><span class="hljs-function"> </span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) text.set(data) } } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) repoModel.refreshData(onDataReadyCallback) } }</code> </pre> <br></div></div><br>  <code><b>refresh</b></code>方法在<code><b>refreshData</b></code>上调用<code><b>refreshData</b></code> ，它在参数中采用<code>OnDataReadyCallback</code>实现。 好的，但是什么是<code><b>object</b></code> ？ 每当您要实现接口或继承扩展类而不进行子类化时，都将使用<b>对象声明</b> 。 如果要将此作为匿名类使用？ 在这种情况下，您正在使用<b>对象表达式</b> ： <br><br><div class="spoiler">  <b class="spoiler_title">MainViewModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repoModel: RepoModel = RepoModel() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isLoading: Boolean = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ repoModel.refreshData( object : OnDataReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: String)</span></span></span><span class="hljs-function"> </span></span>{ text = data }) } }</code> </pre> <br></div></div><br> 调用<code>refresh</code> ，必须将视图更改为<b>加载</b>状态，并在数据到达时将<code><b>isLoading</b></code>设置为<code>false</code> 。 <br><br> 我们还必须将<code><b>text</b></code>替换为 <pre> <code class="hljs xml"><b>ObservableField<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">String</span></span></span><span class="hljs-tag">&gt;</span></span></b></code> </pre>  ，并且<code><b>isLoading</b></code> <pre> <code class="hljs pgsql"><b>ObservableField&lt;<span class="hljs-type"><span class="hljs-type">Boolean</span></span>&gt;</b></code> </pre>  。  <code><b>ObservableField</b></code>是数据绑定库中的一个类，我们可以使用它代替创建Observable对象，它包装了我们要观察的对象。 <br><br><div class="spoiler">  <b class="spoiler_title">MainViewModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repoModel: RepoModel = RepoModel() val text = ObservableField&lt;String&gt;() val isLoading = ObservableField&lt;Boolean&gt;() <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) repoModel.refreshData(object : OnDataReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: String)</span></span></span><span class="hljs-function"> </span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) text.set(data) } }) } }</code> </pre> <br></div></div><br> 请注意，我使用<b>val</b>而不是<b>var</b> ，因为我们将仅更改字段中的值，而不更改字段本身。 如果要初始化它，请使用以下命令： <br><br><div class="spoiler">  <b class="spoiler_title">initobserv.kt</b> <div class="spoiler_text"><pre> <code class="java hljs">val text = ObservableField(<span class="hljs-string"><span class="hljs-string">"old data"</span></span>) val isLoading = ObservableField(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)</code> </pre> <br></div></div><br><br> 让我们更改布局，使其可以观察<b>文本</b>和<b>isLoading</b> 。 首先，绑定<b>MainViewModel</b>而不是<b>Repository</b> ： <br><br><div class="spoiler">  <b class="spoiler_title">activity_main.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewModel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"me.mladenrakonjac.modernandroidapp.MainViewModel"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br> 然后： <br><br><ul><li> 更改TextView以观察<b>MainViewModel中的</b> <b>文本</b> </li><li> 添加一个ProgressBar，只有在<b>isLoading为</b> true时才可见 </li><li> 添加按钮，单击后将从<b>MainViewModel</b>调用<b>refresh</b>方法，并且仅当<b>isLoading为</b> false时才可单击 </li></ul><br><div class="spoiler">  <b class="spoiler_title">main_activity.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{viewModel.text}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProgressBar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/loading"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{viewModel.isLoading ? View.VISIBLE : View.GONE}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/refresh_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{() -&gt; viewModel.refresh()}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:clickable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{viewModel.isLoading ? false : true}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ...</code> </pre> <br></div></div><br> 如果现在运行， <code>View.VISIBLE and View.GONE cannot be used if View is not imported</code> ，将出现<code>View.VISIBLE and View.GONE cannot be used if View is not imported</code> 。 好吧，让我们导入： <br><br><div class="spoiler">  <b class="spoiler_title">main_activity.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.view.View"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewModel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"me.fleka.modernandroidapp.MainViewModel"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br> 好的，完成布局。 现在完成绑定。 就像我说的， <code><b>View</b></code>必须具有<code><b>ViewModel</b></code>的实例： <br><br><div class="spoiler">  <b class="spoiler_title">MainActivity.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class">() </span></span>{ lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binding: ActivityMainBinding <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mainViewModel = MainViewModel() <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) binding = DataBindingUtil.setContentView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.layout.activity_main) binding.viewModel = mainViewModel binding.executePendingBindings() } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">最后，我们可以运行</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br> 您可以看到<b>旧数据已</b>替换为<b>新数据</b> 。 <br><br> 这是一个简单的MVVM示例。 <br><br><div class="spoiler">  <b class="spoiler_title">但是有一个问题，让我们打开屏幕</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  <b>旧数据</b>代替<b>新数据</b> 。 这怎么可能？ 看一下Activity的生命周期： <br><br><div class="spoiler">  <b class="spoiler_title">活动生命周期</b> <div class="spoiler_text"><img src="https://cdn-images-1.medium.com/max/1600/1*CGGROXWhl8dTko1GdDeFsA.png" alt="图片"><br></div></div><br> 当您打开手机时，将创建一个新的Activity实例，并调用<code><b>onCreate()</b></code>方法。 看一下我们的活动： <br><br><div class="spoiler">  <b class="spoiler_title">MainActivity.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class">() </span></span>{ lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binding: ActivityMainBinding <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mainViewModel = MainViewModel() <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) binding = DataBindingUtil.setContentView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.layout.activity_main) binding.viewModel = mainViewModel binding.executePendingBindings() } }</code> </pre> <br></div></div><br> 如您所见，创建Activity实例时，也会创建<b>MainViewModel</b>实例。 如果以某种方式我们为每个重新创建的<b>MainActivity</b>具有相同的<b>MainViewModel</b>实例，那会很好吗？ <br><br><h3> 生命周期感知组件简介 </h3><br> 因为 许多开发人员都面临这个问题，Android框架团队的开发人员决定创建一个旨在帮助解决此问题的库。  <b>ViewModel</b>类就是其中之一。 这是我们所有ViewModel都应继承的类。 <br><br> 让我们从支持生命周期的组件的<b>ViewModel</b>继承<b>MainViewModel</b> 。 首先，我们需要将<b>生命周期感知组件</b>库添加到我们的<b>build.gradle</b>文件中： <br><br><div class="spoiler">  <b class="spoiler_title">build.gradle</b> <div class="spoiler_text"><pre> <code class="xml hljs">dependencies { ... implementation "android.arch.lifecycle:runtime:1.0.0-alpha9" implementation "android.arch.lifecycle:extensions:1.0.0-alpha9" kapt "android.arch.lifecycle:compiler:1.0.0-alpha9"</code> </pre> <br></div></div><br> 使<b>MainViewModel成为</b> <b>ViewModel</b> <b>的</b>继承者： <br><br><div class="spoiler">  <b class="spoiler_title">MainViewModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> me.mladenrakonjac.modernandroidapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.arch.lifecycle.ViewModel <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span><span class="hljs-class">() </span></span>{ ... }</code> </pre> <br></div></div><br> 我们的MainActivity的<b>onCreate（）</b>方法将如下所示： <br><br><div class="spoiler">  <b class="spoiler_title">MainActivity.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class">() </span></span>{ lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binding: <span class="hljs-function"><span class="hljs-function">ActivityMainBinding override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) binding = DataBindingUtil.setContentView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.layout.activity_main) binding.viewModel = ViewModelProviders.of(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).get(MainViewModel::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binding</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">executePendingBindings</span></span></span><span class="hljs-class">() } }</span></span></code> </pre> <br></div></div><br> 请注意，我们没有创建<b>MainViewModel</b>的新实例。 我们将使用<b>ViewModelProviders</b>获得它。  <b>ViewModelProviders</b>是一个Utility类，具有用于获取<b>ViewModelProvider</b>的方法。 这一切都与<b>范围</b>有关。 如果您在Activity中调用<b>ViewModelProviders.of（此方法）</b> ，则只要该Activity处于活动状态（直到它被销毁而不重新创建）， <b>ViewModel</b>将一直存在。 因此，如果您在片段中调用此函数，则您的<b>ViewModel</b>将在Fragment处于活动状态时仍然存在，等等。 看一下该图： <br><br><div class="spoiler">  <b class="spoiler_title">范围生命周期</b> <div class="spoiler_text"><img src="https://cdn-images-1.medium.com/max/1600/1*BSzxfYGPAEvHoIs5v2ThKA.png" alt="图片"><br></div></div><br>  <b>ViewModelProvider</b>负责在第一次调用中创建一个新实例，或者如果重新创建了Activity或Fragment则返回旧的实例。 <br><br> 不要混淆 <br><br><pre> <code class="java hljs">MainViewModel::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span></span></code> </pre> <br> 在科特林，如果您关注 <br><br><pre> <code class="java hljs">MainViewModel::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span></code> </pre> <br> 这将返回<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">KClass</a> ，这与Java中的Class不同。 因此，如果我们编写<b>.java</b> ，那么根据文档，它是： <br><blockquote> 将返回与此KClass实例相对应的Java <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">类</a>实例 </blockquote><div class="spoiler">  <b class="spoiler_title">让我们看看旋转屏幕时会发生什么</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br> 我们拥有与屏幕旋转之前相同的数据。 <br><br> 在上一篇文章中，我说过我们的应用程序将获取Github存储库的列表并显示它们。 为此，我们必须添加<b>getRepositories</b>函数，该函数将返回假的存储库列表： <br><br><div class="spoiler">  <b class="spoiler_title">RepoModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepoModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onDataReadyCallback: OnDataReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ Handler().postDelayed({ onDataReadyCallback.onDataReady(<span class="hljs-string"><span class="hljs-string">"new data"</span></span>) },<span class="hljs-number"><span class="hljs-number">2000</span></span>) } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onRepositoryReadyCallback: OnRepositoryReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arrayList = ArrayList&lt;Repository&gt;() arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"First"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 1"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Second"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 2"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Third"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 3"</span></span>, <span class="hljs-number"><span class="hljs-number">430</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) Handler().postDelayed({ onRepositoryReadyCallback.onDataReady(arrayList) },<span class="hljs-number"><span class="hljs-number">2000</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnDataReadyCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data : String)</span></span></span><span class="hljs-function"> } interface OnRepositoryReadyCallback </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data : ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br></div></div><br> 我们还需要在<b>MainViewModel</b>中有一个从<b>RepoModel</b>调用<b>getRepositories</b>的方法： <br><br><div class="spoiler">  <b class="spoiler_title">MainViewModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span><span class="hljs-class">() </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repositories = ArrayList&lt;Repository&gt;() <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ... } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) repoModel.getRepositories(object : OnRepositoryReadyCallback{ <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> </span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) repositories = data } }) } }</code> </pre> <br></div></div><br> 最后，我们需要在RecyclerView中显示这些存储库。 为此，我们必须： <br><br><ul><li> 创建布局<b>rv_item_repository.xml</b> </li><li> 将<b>RecyclerView</b>添加到布局<b>activity_main.xml</b> </li><li> 创建RepositoryRecyclerViewAdapter </li><li> 在recyclerview安装适配器 </li></ul><br> 为了创建<b>rv_item_repository.xml，</b>我使用了CardView库，因此我们需要将其添加到build.gradle（应用程序）中： <br><br><pre> <code class="xml hljs">implementation 'com.android.support:cardview-v7:26.0.1'</code> </pre> <br> 看起来是这样的： <br><br><div class="spoiler">  <b class="spoiler_title">rv_item_repository.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.view.View"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"repository"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"me.mladenrakonjac.modernandroidapp.uimodels.Repository"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.CardView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"96dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{repository.repositoryName}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20sp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintHorizontal_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintRight_toRightOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintVertical_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.083"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Modern Android App"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_has_issues"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/has_issues"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textStyle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bold"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{repository.hasIssues ? View.VISIBLE : View.GONE}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintEnd_toEndOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintHorizontal_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toEndOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintVertical_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_owner"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{repository.repositoryOwner}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintEnd_toEndOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toBottomOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintVertical_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Mladen Rakonjac"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/number_of_starts"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{String.valueOf(repository.numberOfStars)}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintEnd_toEndOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintHorizontal_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toBottomOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_owner"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintVertical_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 stars"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.CardView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br> 下一步是将RecyclerView添加到<b>activity_main.xml中</b> 。 在执行此操作之前，请确保添加RecyclerView库： <br><br><pre> <code class="xml hljs">implementation 'com.android.support:recyclerview-v7:26.0.1'</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">activity_main.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.view.View"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">variable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewModel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"me.fleka.modernandroidapp.MainViewModel"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"me.fleka.modernandroidapp.MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProgressBar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/loading"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:indeterminate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{viewModel.isLoading ? View.VISIBLE : View.GONE}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/refresh_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintEnd_toEndOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.RecyclerView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/repository_rv"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:indeterminate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{viewModel.isLoading ? View.GONE : View.VISIBLE}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/refresh_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintEnd_toEndOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:listitem</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/rv_item_repository"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/refresh_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"160dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"40dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginEnd</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{() -&gt; viewModel.loadRepositories()}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:clickable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{viewModel.isLoading ? false : true}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Refresh"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintEnd_toEndOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintVertical_bias</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br><br> 请注意，我们删除了一些TextView元素，现在该按钮启动<b>loadRepositories</b>而不是<b>refresh</b> ： <br><br><div class="spoiler">  <b class="spoiler_title">button.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/refresh_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@{() -&gt; viewModel.loadRepositories()}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br></div></div><br> 让我们在不需要时从MainViewModel中删除<b>refresh</b>方法，从RepoModel中删除refreshData。 <br><br> 现在，您需要为RecyclerView创建一个适配器： <br><br><div class="spoiler">  <b class="spoiler_title">RepositoryRecyclerViewAdapter.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepositoryRecyclerViewAdapter</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">items</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">listener</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnItemClickListener</span></span></span><span class="hljs-class">) : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepositoryRecyclerViewAdapter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt;() </span></span>{ <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: ViewGroup?, viewType: Int)</span></span></span><span class="hljs-function">: ViewHolder </span></span>{ val layoutInflater = LayoutInflater.from(parent?.context) val binding = RvItemRepositoryBinding.inflate(layoutInflater, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewHolder(binding) } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: ViewHolder, position: Int)</span></span></span><span class="hljs-function"> </span></span>= holder.bind(items[position], listener) <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: Int </span></span>= items.size <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnItemClickListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onItemClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: Int)</span></span></span><span class="hljs-function"> } class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">private</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> binding: RvItemRepositoryBinding)</span></span></span><span class="hljs-function"> : RecyclerView.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(binding.root)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(repo: Repository, listener: OnItemClickListener?)</span></span></span><span class="hljs-function"> </span></span>{ binding.repository = <span class="hljs-function"><span class="hljs-function">repo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(listener != </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">null</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ binding.root.setOnClickListener({ _ -&gt; listener.onItemClick(layoutPosition) }) } binding.executePendingBindings() } } }</code> </pre> <br></div></div><br> 请注意，ViewHolder采用的是RvItemRepositoryBinding类型的实例，而不是<b>View</b> ，因此我们可以在ViewHolder中为每个元素实现数据绑定。 不要为单行功能（oneline）感到尴尬： <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: ViewHolder, position: Int)</span></span></span><span class="hljs-function"> </span></span>= holder.bind(items[position], listener)</code> </pre> <br> 这只是以下内容的简短条目： <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: ViewHolder, position: Int)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holder.bind(items[position], listener) }</code> </pre> <br>  <b>项目[position]</b>是索引运算符的实现。 它类似于<b>items.get（position）</b> 。 <br><br> 另一行可能会使您感到困惑： <br><br><pre> <code class="java hljs">binding.root.setOnClickListener({ _ -&gt; listener.onItemClick(layoutPosition) })</code> </pre> <br> 如果不使用_，则可以将其替换为_。 好吧 <br><br> 我们创建了适配器，但仍未将其应用于<b>MainActivity中</b>的<b>recyclerView</b> ： <br><br><div class="spoiler">  <b class="spoiler_title">MainActivity.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class">(), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepositoryRecyclerViewAdapter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnItemClickListener</span></span></span><span class="hljs-class"> </span></span>{ lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binding: <span class="hljs-function"><span class="hljs-function">ActivityMainBinding override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) binding = DataBindingUtil.setContentView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.layout.activity_main) val viewModel = ViewModelProviders.of(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).get(MainViewModel::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binding</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewModel</span></span></span><span class="hljs-class"> </span></span>= viewModel binding.executePendingBindings() binding.repositoryRv.layoutManager = LinearLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) binding.repositoryRv.adapter = RepositoryRecyclerViewAdapter(viewModel.repositories, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onItemClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: Int)</span></span></span><span class="hljs-function"> </span></span>{ TODO(<span class="hljs-string"><span class="hljs-string">"not implemented"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//To change body of created functions use File | Settings | File Templates. } }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">运行应用程序</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br> 真奇怪 怎么了 <br><br><ul><li> 活动已创建，因此还创建了一个新适配器，其中的<b>存储库</b>实际上是空的 </li><li> 我们按下按钮 </li><li> 称为loadRepositories，显示进度 </li><li>  2秒钟后，我们得到了存储库，进度被隐藏了，但是没有出现。 这是因为<b>适配器</b>中未调用<b>notifyDataSetChanged</b> </li><li> 当我们旋转屏幕时，将创建一个新的Activity，因此将使用带有一些数据的<b>repositories</b>参数创建一个新的适配器 </li></ul><br> 因此，由于<b>MainViewModel</b>应该通知<b>MainActivity</b>新项目，我们可以调用<b>notifyDataSetChanged</b>吗？ <br><br> 我们不能。 <br><br> 这真的很重要， <b>MainViewModel</b>根本不应该了解<b>MainActivity</b> 。 <br><br>  <b>MainActivity</b>是拥有<b>MainViewModel</b>实例的实例，因此它应该侦听更改并将更改通知<b>Adapter</b> 。 <br><br> 但是怎么做呢？ <br><br> 我们可以观察<b>存储库</b> ，因此在更改数据之后，我们可以更改适配器。 <br><br> 这个决定有什么问题？ <br><br> 让我们看一下以下情况： <br><br><ul><li> 在<b>MainActivity中，</b>我们观察存储库：发生更改时，我们执行<b>notifyDataSetChanged</b> </li><li> 我们按下按钮 </li><li> 在我们等待数据更改时，由于<b>配置更改</b> ，可能会重新创建<b>MainActivity</b> <b>。</b> </li><li> 我们的<b>MainViewModel</b>仍然存在 </li><li>  2秒后，“ <b>存储库”</b>字段将接收新项目，并通知观察者数据已更改 </li><li> 观察者尝试在不再存在的<b>适配器</b>上执行<b>notifyDataSetChanged</b> ，因为  <b>MainActivity</b>已重新创建 </li></ul><br> 好吧，我们的决定还不够好。 <br><br><h3>  LiveData简介 </h3><br>  <b>LiveData</b>是另一个<b>了解生命周期的组件，</b>它基于可了解View生命周期的可观察对象。 因此，当Activity由于<b>配置更改</b>而被销毁时， <b>LiveData会</b>知道它，因此它也将从被销毁的Activity中删除观察者。 <br><br> 我们在<b>MainViewModel中</b>实现： <br><br><div class="spoiler">  <b class="spoiler_title">MainViewModel.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewModel</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repoModel: RepoModel = RepoModel() val text = ObservableField(<span class="hljs-string"><span class="hljs-string">"old data"</span></span>) val isLoading = ObservableField(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repositories = MutableLiveData&lt;ArrayList&lt;Repository&gt;&gt;() <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) repoModel.getRepositories(object : OnRepositoryReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> </span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) repositories.value = data } }) } }</code> </pre> <br></div></div><br> 并开始观察MainActivity： <br><br><div class="spoiler">  <b class="spoiler_title">MainActivity.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LifecycleActivity</span></span></span><span class="hljs-class">(), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepositoryRecyclerViewAdapter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnItemClickListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binding: ActivityMainBinding <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> val repositoryRecyclerViewAdapter = RepositoryRecyclerViewAdapter(arrayListOf(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) binding = DataBindingUtil.setContentView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.layout.activity_main) val viewModel = ViewModelProviders.of(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).get(MainViewModel::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binding</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewModel</span></span></span><span class="hljs-class"> </span></span>= viewModel binding.executePendingBindings() binding.repositoryRv.layoutManager = LinearLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) binding.repositoryRv.adapter = repositoryRecyclerViewAdapter viewModel.repositories.observe(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Observer&lt;ArrayList&lt;Repository&gt;&gt; { it?.let{ repositoryRecyclerViewAdapter.replaceData(it)} }) } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onItemClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: Int)</span></span></span><span class="hljs-function"> </span></span>{ TODO(<span class="hljs-string"><span class="hljs-string">"not implemented"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//To change body of created functions use File | Settings | File Templates. } }</span></span></code> </pre> <br></div></div><br> 这个词是<b>什么</b>意思？ 如果一个函数只有一个参数，则可以使用it关键字访问此参数。 因此，假设我们有一个lambda表达式要乘以2： <br><br><pre> <code class="java hljs">((a) -&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> * a)</code> </pre> <br> 可以替换为： <br><br><pre> <code class="java hljs">(it * <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">如果立即启动该应用程序，则可以确保一切正常</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  ... <br><br><h3> 为什么比MVP更喜欢MVVM？ </h3><br><br><ul><li>  View没有无聊的界面，因为  ViewModel没有引用View </li><li>  Presenter没有无聊的界面，这是没有必要的 </li><li> 处理配置更改要容易得多 </li><li> 使用MVVM，我们可以减少活动，片段等的代码。 </li></ul><br>  ... <br><br><h3> 储存库模式 </h3><br><div class="spoiler">  <b class="spoiler_title">方案</b> <div class="spoiler_text"><img src="https://cdn-images-1.medium.com/max/1600/1*UDzzNYwInvHg25V_OtWejg.jpeg" alt="图片"><br></div></div><br> 如前所述， <b>Model</b>只是我们准备数据的层的抽象名称。 它通常包含存储库和数据类。 每个实体（数据）类都有一个对应的<b>存储库</b>类。 例如，如果我们具有<b>User</b>和<b>Post</b>类，则还必须具有<b>UserRepository</b>和<b>PostRepository</b> 。 所有数据都来自那里。 我们绝不应该从View或ViewModel调用共享首选项或数据库的实例。 <br><br> 因此，我们可以将RepoModel重命名为<b>GitRepoRepository</b> ，其中<b>GitRepo</b>将来自Github存储库，而<b>Repository</b>将来自存储库模式。 <br><br><div class="spoiler">  <b class="spoiler_title">RepoRepositories.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GitRepoRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getGitRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onRepositoryReadyCallback: OnRepositoryReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arrayList = ArrayList&lt;Repository&gt;() arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"First"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 1"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Second"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 2"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Third"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 3"</span></span>, <span class="hljs-number"><span class="hljs-number">430</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) Handler().postDelayed({ onRepositoryReadyCallback.onDataReady(arrayList) }, <span class="hljs-number"><span class="hljs-number">2000</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRepositoryReadyCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br></div></div><br> 好的， <b>MainViewModel</b>从<b>GitRepoRepsitories</b>获取存储库的Github列表，但是从哪里获取<b>GitRepoRepositories</b>呢？ <br><br> 您可以从实例直接在存储库上调用<b>客户端</b>或<b>数据库</b> ，但这仍然不是最佳做法。 您的应用程序应尽可能模块化。 如果您决定使用其他客户用Retrofit代替Volley怎么办？ 如果您内部有某种逻辑，将很难进行重构。 您的存储库不需要知道您要使用哪个客户端来检索远程数据。 <br><br><ul><li> 存储库唯一需要知道的是数据是远程还是本地到达。 无需知道我们如何获取此远程或本地数据。 </li><li> 唯一需要的<b>视图模型</b>是数据 </li><li>  <b>View</b>唯一要做的就是显示此数据。 </li></ul><br> 当我刚开始在Android上进行开发时，我想知道应用程序如何脱机工作以及数据同步如何工作。 好的应用程序体系结构使我们可以轻松做到这一点。 例如，如果存在Internet连接，则在<b>ViewModel</b>中调用<b>loadRepositories</b>时， <b>GitRepoRepositories</b>可以从远程数据源接收数据并将其保存到本地数据源。 当电话离线时， <b>GitRepoRepository</b>可以从本地存储接收数据。 因此， <b>存储库</b>必须具有<b>RemoteDataSource</b>和<b>LocalDataSource的</b>实例以及该数据应来自的逻辑处理。 <br><br> 添加<b>本地数据源</b> ： <br><br><div class="spoiler">  <b class="spoiler_title">GitRepoLocalDataSource.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GitRepoLocalDataSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onRepositoryReadyCallback: OnRepoLocalReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arrayList = ArrayList&lt;Repository&gt;() arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"First From Local"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 1"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Second From Local"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 2"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Third From Local"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 3"</span></span>, <span class="hljs-number"><span class="hljs-number">430</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) Handler().postDelayed({ onRepositoryReadyCallback.onLocalDataReady(arrayList) }, <span class="hljs-number"><span class="hljs-number">2000</span></span>) } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arrayList: ArrayList&lt;Repository&gt;)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//todo save repositories in DB } } interface OnRepoLocalReadyCallback { fun onLocalDataReady(data: ArrayList&lt;Repository&gt;) }</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们有两种方法：第一种返回虚假的本地数据，第二种用于虚拟数据存储。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程数据源</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitRepoRemoteDataSource.kt</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GitRepoRemoteDataSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onRepositoryReadyCallback: OnRepoRemoteReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arrayList = ArrayList&lt;Repository&gt;() arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"First from remote"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 1"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Second from remote"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 2"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)) arrayList.add(Repository(<span class="hljs-string"><span class="hljs-string">"Third from remote"</span></span>, <span class="hljs-string"><span class="hljs-string">"Owner 3"</span></span>, <span class="hljs-number"><span class="hljs-number">430</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) Handler().postDelayed({ onRepositoryReadyCallback.onRemoteDataReady(arrayList) }, <span class="hljs-number"><span class="hljs-number">2000</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRepoRemoteReadyCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRemoteDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有一种方法可以返回伪造的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以向存储库添加一些逻辑：</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitRepoRepository.kt</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GitRepoRepository</span></span></span><span class="hljs-class"> </span></span>{ val localDataSource = GitRepoLocalDataSource() val remoteDataSource = GitRepoRemoteDataSource() <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onRepositoryReadyCallback: OnRepositoryReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ remoteDataSource.getRepositories( object : OnRepoRemoteReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> </span></span>{ localDataSource.saveRepositories(data) onRepositoryReadyCallback.onDataReady(data) } }) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRepositoryReadyCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，通过共享源，我们可以轻松地在本地保存数据。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您只需要网络数据，还需要使用存储库模板怎么办？</font></font>是的<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 这使代码测试更加容易，其他开发人员可以更好地理解您的代码，并且可以更快地支持它！ </font></font><br><br>  ... <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Android Manager包装器 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您想在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitRepoRepository中</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查您的Internet连接</font><font style="vertical-align: inherit;">以了解从何处请求数据，该怎么办？</font><font style="vertical-align: inherit;">我们已经说过，我们不应在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ViewModel和Model中</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放置任何与Android相关的代码</font><font style="vertical-align: inherit;">，那么该如何处理呢？</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们为互联网连接编写一个包装器：</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetManager.kt（类似的解决方案适用于其他管理器，例如，适用于NfcManager）</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetManager</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">applicationContext</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Context</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> status: Boolean? = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> val isConnectedToInternet: Boolean? get() { val conManager = applicationContext.getSystemService(Context.CONNECTIVITY_SERVICE) as ConnectivityManager val ni = conManager.activeNetworkInfo <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ni != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; ni.isConnected } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 仅当我们添加清单权限时，此代码才有效： </font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.INTERNET"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如何在资源库中创建一个实例，如果我们没有上下文（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）？</font><font style="vertical-align: inherit;">我们可以在构造函数中请求它：</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitRepoRepository.kt</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GitRepoRepository</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Context</span></span></span><span class="hljs-class">)</span></span>{ val localDataSource = GitRepoLocalDataSource() val remoteDataSource = GitRepoRemoteDataSource() val netManager = NetManager(context) <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onRepositoryReadyCallback: OnRepositoryReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ remoteDataSource.getRepositories(object : OnRepoRemoteReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> </span></span>{ localDataSource.saveRepositories(data) onRepositoryReadyCallback.onDataReady(data) } }) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRepositoryReadyCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在ViewModel中的新GitRepoRepository实例之前创建。</font><font style="vertical-align: inherit;">正如我们现在可以</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在视图模型，当</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为NetManager必要的条件</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">您可以从具有</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的Lifecycle-aware组件库中使用AndroidViewModel </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是应用程序的上下文，而不是活动。</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MainViewModel.kt</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AndroidViewModel</span></span></span><span class="hljs-class"> </span></span>{ constructor(application: Application) : <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(application) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gitRepoRepository: GitRepoRepository = GitRepoRepository(NetManager(getApplication())) val text = ObservableField(<span class="hljs-string"><span class="hljs-string">"old data"</span></span>) val isLoading = ObservableField(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repositories = MutableLiveData&lt;ArrayList&lt;Repository&gt;&gt;() <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) gitRepoRepository.getRepositories(object : OnRepositoryReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> </span></span>{ isLoading.set(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) repositories.value = data } }) } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在这条线 </font></font><br><br><pre> <code class="java hljs">constructor(application: Application) : <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(application)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MainViewModel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了一个构造函数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是必需的，因为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AndroidViewModel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其构造函数中</font><font style="vertical-align: inherit;">请求</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，在我们的构造函数中，我们调用super方法，该方法调用</font><font style="vertical-align: inherit;">我们继承</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AndroidViewModel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：如果这样做，我们可以摆脱一行：</font></font><br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class">) : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AndroidViewModel</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class">) </span></span>{ ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitRepoRepository中</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了NetManager实例</font><font style="vertical-align: inherit;">，我们可以检查Internet连接了：</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitRepoRepository.kt</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GitRepoRepository</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">netManager</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetManager</span></span></span><span class="hljs-class">) </span></span>{ val localDataSource = GitRepoLocalDataSource() val remoteDataSource = GitRepoRemoteDataSource() <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(onRepositoryReadyCallback: OnRepositoryReadyCallback)</span></span></span><span class="hljs-function"> </span></span>{ netManager.isConnectedToInternet?.let { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it) { remoteDataSource.getRepositories(object : OnRepoRemoteReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRemoteDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> </span></span>{ localDataSource.saveRepositories(data) onRepositoryReadyCallback.onDataReady(data) } }) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { localDataSource.getRepositories(object : OnRepoLocalReadyCallback { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLocalDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> </span></span>{ onRepositoryReadyCallback.onDataReady(data) } }) } } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnRepositoryReadyCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDataReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: ArrayList&lt;Repository&gt;)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，如果我们有Internet连接，我们将收到已删除的数据并将其保存在本地。如果没有Internet连接，我们将获取本地数据。</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意在科特林</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：运营商</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为null检查并在返回值</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下文章之一中，我将介绍依赖项注入，在ViewModel中创建存储库实例有多糟，以及如何避免使用AndroidViewModel。我还将写一些代码中现在存在的许多问题。我离开它们是有原因的... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我试图向您展示问题，以便您可以理解为什么所有这些库都很流行以及为什么要使用它们。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS我改变了主意，映射器（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射器</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">我决定在以下文章中对此进行介绍。</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN432826/">https://habr.com/ru/post/zh-CN432826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN432816/index.html">AXIS M3046-V与IDIS DC-D3212X：比较CCTV摄像机</a></li>
<li><a href="../zh-CN432818/index.html">自制绘图仪：使用grbl-firmware的初学者提示</a></li>
<li><a href="../zh-CN432820/index.html">动态测试Android应用程序</a></li>
<li><a href="../zh-CN432822/index.html">我为开发人员破坏了我的一生的代码，我不再想要这样做了</a></li>
<li><a href="../zh-CN432824/index.html">加快ConcurrentReferenceHashMap的创建</a></li>
<li><a href="../zh-CN432828/index.html">测试和调试MapReduce</a></li>
<li><a href="../zh-CN432830/index.html">自动化系统对废弃垃圾处以罚款</a></li>
<li><a href="../zh-CN432832/index.html">如何“粘合”基于英特尔的服务器并克服8个处理器的扩展上限</a></li>
<li><a href="../zh-CN432834/index.html">C ++中的内部和外部链接</a></li>
<li><a href="../zh-CN432836/index.html">Aliexpress的第一个优质灯泡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>