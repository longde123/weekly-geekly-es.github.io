<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻 🏇🏻 👱🏿 Erstellen Sie Caffe in Google Colaboratory: Kostenlose Grafikkarte in der Cloud 🤲🏽 😦 🧝🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google Colaboratory ist ein kürzlich eingeführter Cloud-Dienst, der die Forschung im Bereich maschinelles Lernen und Deep Learning vereinfachen soll. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen Sie Caffe in Google Colaboratory: Kostenlose Grafikkarte in der Cloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413229/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Colaboratory</a> ist ein kürzlich eingeführter Cloud-Dienst, der die Forschung im Bereich maschinelles Lernen und Deep Learning vereinfachen soll.  Mit dem Colaboratory können Sie mit einer angeschlossenen Grafikkarte per Fernzugriff auf ein Gerät zugreifen. Es ist völlig kostenlos. Dies vereinfacht das Leben erheblich, wenn Sie tiefe neuronale Netze trainieren müssen.  Wir können sagen, dass es sich um ein Analogon zu Google-Dokumenten für das Jupyter-Notizbuch handelt. <br><br>  In Colaboratory ist Tensorflow <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorinstalliert</a> und fast alle Python-Bibliotheken sind für die Arbeit erforderlich.  Wenn ein Paket fehlt, kann es einfach unterwegs durch <code>pip</code> oder <code>apt-get</code> installiert werden.  Aber was ist, wenn Sie ein Projekt aus dem Quellcode erstellen und eine Verbindung zur GPU herstellen müssen?  Es stellt sich heraus, dass dies möglicherweise nicht so einfach ist, wie ich beim Aufbau von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SSD-Caffe herausgefunden habe</a> .  In dieser Veröffentlichung werde ich eine kurze Beschreibung des Labors geben, die aufgetretenen Schwierigkeiten und deren Lösung beschreiben sowie einige nützliche Tricks bereitstellen. <br><br>  Der gesamte Code ist in meinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://vk.com/away.php%3Futf%3D1%26to%3D">Colaboratory Notebook</a> verfügbar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b0/fv/v8/b0fvv8egfxlwczpdifnoyazgfng.png"></div><a name="habracut"></a><br><h2>  Kurz über Colaboratory </h2><br>  Grob gesagt können Sie mit Colaboratory Jupyter Notebook auf einem Remotecomputer ausführen.  Labordateien sind normale .ipynb-Laptops und werden auf der Google-Festplatte gespeichert.  Es gibt auch eine Reihe von Funktionen, mit denen Sie Dateien von einem Remotecomputer auf die Google-Festplatte hochladen können und umgekehrt.  Sie können diese Dateien auch für andere freigeben und Kommentare dazu schreiben, wie in Google-Dokumenten. <br><br>  Im Labor können Sie die GPU verwenden, nämlich den Tesla K80.  Verbinden Sie dies dazu in den Einstellungen: Laufzeit <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.845ex" height="2.419ex" viewBox="0 -780.1 5100 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-72" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-69" x="701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-67" x="1047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-68" x="1527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-74" x="2104" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-61" x="2465" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-72" x="2995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-72" x="3446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-6F" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-77" x="4383" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> \ rightarrow </script>  Laufzeittyp ändern <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.845ex" height="2.419ex" viewBox="0 -780.1 5100 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-72" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-69" x="701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-67" x="1047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-68" x="1527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-74" x="2104" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-61" x="2465" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-72" x="2995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-72" x="3446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-6F" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhgSsHgTMUS6dF1jCdJIb6ppnoqGZA#MJMATHI-77" x="4383" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ rightarrow </script>  Hardwarebeschleuniger.  Es ist erwähnenswert, dass GPUs nicht immer verfügbar sind, und dann bietet das Labor an, die Maschine ohne sie zu starten. <br><br>  Es scheint, dass nichts außer dem Jupyter Notebook selbst gestartet werden kann, aber es gibt einen indirekten Zugriff auf das Terminal: Dazu müssen Sie vor dem Terminalbefehl ein Ausrufezeichen <code>!mkdir images</code> , zum Beispiel <code>!mkdir images</code> .  Im Allgemeinen können wir davon ausgehen, dass es sich um einen perfekten normalen Computer handelt, auf dem Ubuntu 17.10 (zum Zeitpunkt des Schreibens) installiert, aber remote verbunden ist.  Daraus folgt, dass alles, was über das Terminal (nicht interaktiv) ausgeführt werden kann, auf dem Terminal ausgeführt werden kann, einschließlich: <br><br><ul><li>  Klon-Repositorys mit <code>git clone</code> , </li><li>  Daten mit <code>wget</code> laden (übrigens werden auch große Dateien fast sofort von einer Google-Festplatte geladen), </li><li>  benutze <code>make</code> (und höchstwahrscheinlich <code>cmake</code> ) </li><li>  Installieren Sie Tools und Bibliotheken mit <code>apt-get</code> und <code>pip</code> </li></ul><br>  Noch ein paar Kommentare zum Colaboratory: <br><br><ul><li>  Es scheint, dass der Benutzer uneingeschränkten Zugriff auf alle Dateien im System hat (alle Befehle müssen ohne <code>sudo</code> geschrieben werden); </li><li>  Der Terminalstatus wird nicht zwischen Teams übertragen, selbst wenn sie sich in derselben Zelle befinden (z. B. <code>cd dir</code> falls erforderlich, müssen Sie zu Beginn jedes Befehls schreiben). </li><li>  Wenn Sie die Verbindung zum Labor für längere Zeit trennen, werden alle Änderungen in der virtuellen Maschine gelöscht, einschließlich aller installierten Pakete und heruntergeladenen Dateien. Daher wird empfohlen, die Installation von Paketen in das Jupyter-Notizbuch aufzunehmen. </li><li>  Nach 12 Stunden Dauerbetrieb schaltet sich das Gerät automatisch aus, kann dann aber neu gestartet werden (theoretisch ist die GPU in der Praxis möglicherweise nicht verfügbar). </li></ul><br><h2>  SSD-Caffe Build </h2><br>  Ich wollte den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Single Shot Detector (SSD)</a> ausprobieren, nämlich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Caffe-Implementierung</a> in Google Colaboratory, aber dafür musste das Projekt aus dem Quellcode zusammengestellt werden. <br><br>  Übrigens, wenn eine Version von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Caffe</a> für Sie geeignet ist, gibt es einen viel einfacheren Weg (es funktioniert sogar, obwohl ich nicht versucht habe, etwas auszuführen): <br><br><pre> <code class="bash hljs">!apt install caffe-cuda</code> </pre> <br>  Das Zusammenbauen von SSD-Caffe aus der Quelle ist eine ziemlich lange Aufgabe in mehreren Schritten, die nur mit Krücken durchgeführt werden kann. <br><br>  <b>Schritt 1: Installieren von Abhängigkeiten</b> <br><br>  Hier müssen wir alle Abhängigkeiten für Caffe mit <code>apt</code> herunterladen.  Zuvor müssen Sie jedoch zulassen, dass <code>apt</code> den Abhängigkeitsquellcode herunterlädt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Im Caffe-Installationshandbuch</a> heißt es, dass hierfür eine "deb-src-Zeile in der Datei sources.list" erforderlich ist.  Leider gibt es dort keine Details, so dass ich nur alle <code>deb-src</code> Zeilen in der Datei <code>/etc/apt/sources.list</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/etc/apt/sources.list'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: txt = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/etc/apt/sources.list'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(txt.replace(<span class="hljs-string"><span class="hljs-string">'# deb-src'</span></span>,<span class="hljs-string"><span class="hljs-string">'deb-src'</span></span>))</code> </pre><br>  Und es hat funktioniert.  Es bleiben nur die Abhängigkeiten herunterzuladen: <br><br><pre> <code class="bash hljs">!apt update !apt build-dep caffe-cuda</code> </pre><br>  <b>Schritt 2: Benötigen Sie einen anderen Compiler</b> <br><br>  Hier ist das Problem das folgende: <code>g++-7</code> , das standardmäßig die Standardeinstellung ist, ist aus irgendeinem Grund nicht mit dem <code>nvcc</code> CUDA-Compiler kompatibel, sodass Sie etwas anderes verwenden müssen.  Ich habe <code>g++-5</code> heruntergeladen und es zum Standard-Compiler gemacht: <br><br><pre> <code class="bash hljs">!apt install g++-5 !update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 20 !update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-5 20</code> </pre><br>  <b>Schritt 3: Boost bauen müssen</b> <br><br>  Wenn Sie zu diesem Zeitpunkt versuchen, Caffe zu erstellen, treten beim Versuch, Boost zu verbinden, Probleme auf, da es von einem anderen Compiler erstellt wurde. Sie müssen daher seine Quellen herunterladen und auch mit <code>g++-5</code> erstellen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mehr auf der Boost-Website</a> ): <br><br><pre> <code class="bash hljs">!wget https://dl.bintray.com/boostorg/release/1.67.0/<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>/boost_1_67_0.tar.bz2 !tar --bzip2 -xf boost_1_67_0.tar.bz2 !<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> boost_1_67_0 &amp;&amp; ./bootstrap.sh --<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>-prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> --with-libraries=system,filesystem,regex,thread,python --with-python-version=2.7 --with-python-root=/usr !<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> boost_1_67_0 &amp;&amp; ./b2 install</code> </pre><br>  <b>Schritt 4: Konfigurieren Sie das Makefile</b> <br><br>  Caffe mit GitHub klonen: <br><br><pre> <code class="bash hljs">!git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/weiliu89/caffe.git &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> caffe &amp;&amp; git checkout ssd</code> </pre><br>  Und wir ändern die erforderlichen Felder in Makefile.config - Ich habe den Pfad zu CUDA geändert, die BLAS-Option geändert, die Version von OpenCV in eine dritte geändert, eine Python-Ebene hinzugefügt und auch alle Pfade zu den Bibliotheken hinzugefügt, die installiert wurden, aber aus irgendeinem Grund nicht gefunden wurden (all dies ist praktisch) fertig mit Python): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile.config.example'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: config = f.read() comment = [<span class="hljs-string"><span class="hljs-string">'CUDA_DIR := /usr/local/cuda'</span></span>, <span class="hljs-string"><span class="hljs-string">'BLAS := open'</span></span>] uncomment = [<span class="hljs-string"><span class="hljs-string">'# CUDA_DIR := /usr'</span></span>, <span class="hljs-string"><span class="hljs-string">'# BLAS := atlas'</span></span>, <span class="hljs-string"><span class="hljs-string">'# OPENCV_VERSION := 3'</span></span>, <span class="hljs-string"><span class="hljs-string">'# WITH_PYTHON_LAYER := 1'</span></span>] <span class="hljs-comment"><span class="hljs-comment"># replace = [('INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include', 'INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial /usr/local/lib/python2.7/dist-packages/numpy/core/include/'), ('LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib', 'LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu/hdf5/serial')] for c in uncomment: config = config.replace(c, c[2:]) for c in comment: config = config.replace(c, '# '+c) for c1,c2 in replace: config = config.replace(c1, c2) with open('caffe/Makefile.config', 'w') as f: f.write(config)</span></span></code> </pre><br>  Außerdem musste ich im Makefile selbst alle <code>-isystem</code> Tags durch <code>-I</code> ersetzen: Beide sind für das Auffinden der Header verantwortlich, werden jedoch etwas anders verarbeitet, und ohne dieses Problem traten bereits beim Verbinden von stdlib Probleme auf ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">weitere Details hier</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: mfile = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(mfile.replace(<span class="hljs-string"><span class="hljs-string">'-isystem'</span></span>,<span class="hljs-string"><span class="hljs-string">'-I'</span></span>))</code> </pre><br>  <b>Schritt 5: Erstellen</b> <br><br>  Es war noch eine letzte Krücke übrig - um die <code>c++config.h</code> zu korrigieren, andernfalls gibt es Probleme mit Nan-Typen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mehr</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/usr/include/x86_64-linux-gnu/c++/5/bits/c++config.h'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: txt = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/usr/include/x86_64-linux-gnu/c++/5/bits/c++config.h'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(txt.replace(<span class="hljs-string"><span class="hljs-string">'/* #undef _GLIBCXX_USE_C99_MATH */'</span></span>, <span class="hljs-string"><span class="hljs-string">'/* #undef _GLIBCXX_USE_C99_MATH */\n#define _GLIBCXX_USE_C99_MATH 1'</span></span>))</code> </pre><br>  Jetzt können Sie tatsächlich Caffe bauen: <br><br><pre> <code class="bash hljs">!<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> caffe &amp;&amp; make -j8 &amp;&amp; make pycaffe &amp;&amp; make <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -j8 &amp;&amp; make distribute !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> /content/caffe/distribute/lib &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig</code> </pre><br>  In den letzten beiden Zeilen werden die Bibliothekspfade Boost und Caffe hinzugefügt. <br><br>  Jetzt kann Caffe verwendet werden (Sie müssen nur den Pfad dazu in PYTHONPATH angeben): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys caffe_path = !cd caffe/python &amp;&amp; pwd sys.path.insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, caffe_path[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> caffe</code> </pre><br>  Um es zu testen, habe ich das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mobilenet-SSD-</a> Projekt getestet: Der Code befindet sich auch in meinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://vk.com/away.php%3Futf%3D1%26to%3D">Colaboratory Notebook</a> . <br><br>  Insbesondere habe ich die Vorhersagezeit für ein Bild gemessen und die Beschleunigung auf der GPU betrug etwa 3,8. <br><br><h2>  Bonus: einige nützliche Tricks </h2><br>  Es gibt ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">großartiges Tutorial</a> zu Medium in Google Colaboratory.  Auch im Labor selbst gibt es Dateien mit Beispielen für fast alles, was benötigt wird. <br><br>  Hängen Sie eine Google-Festplatte in das Dateisystem einer virtuellen Maschine ein: <br><br><pre> <code class="bash hljs">!apt-get install -y -qq software-properties-common python-software-properties module-init-tools !add-apt-repository -y ppa:alessandro-strada/ppa 2&gt;&amp;1 &gt; /dev/null !apt-get update -qq 2&gt;&amp;1 &gt; /dev/null !apt-get -y install -qq google-drive-ocamlfuse fuse from google.colab import auth auth.authenticate_user() from oauth2client.client import GoogleCredentials creds = GoogleCredentials.get_application_default() import getpass !google-drive-ocamlfuse -headless -id={creds.client_id} -secret={creds.client_secret} &lt; /dev/null 2&gt;&amp;1 | grep URL vcode = getpass.getpass() !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> {vcode} | google-drive-ocamlfuse -headless -id={creds.client_id} -secret={creds.client_secret}</code> </pre><br>  Dieser Code gibt den Link zurück und gibt ein Eingabefenster.  Sie müssen dem Link folgen, den Code kopieren und in das Fenster eingeben.  Aus irgendeinem Grund muss ich das zweimal machen.  Weiter: <br><br><pre> <code class="bash hljs">!mkdir -p drive !google-drive-ocamlfuse drive</code> </pre><br>  Danach können Sie Ihre Google-Festplatte als reguläres Verzeichnis verwenden.  Außerdem werden alle Änderungen in diesem Verzeichnis automatisch mit Google-Drive synchronisiert. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Keras-</a> Installation: <br><br><pre> <code class="python hljs">!pip install -q keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras</code> </pre><br>  Installieren Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PyTorch</a> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> path <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wheel.pep425tags <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_abbr_impl, get_impl_ver, get_abi_tag platform = <span class="hljs-string"><span class="hljs-string">'{}{}-{}'</span></span>.format(get_abbr_impl(), get_impl_ver(), get_abi_tag()) accelerator = <span class="hljs-string"><span class="hljs-string">'cu80'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path.exists(<span class="hljs-string"><span class="hljs-string">'/opt/bin/nvidia-smi'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span> !pip install -q http://download.pytorch.org/whl/{accelerator}/torch<span class="hljs-number"><span class="hljs-number">-0.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.post4-{platform}-linux_x86_64.whl torchvision <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch</code> </pre><br>  Arbeitsverzeichnis ändern: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os os.chdir(<span class="hljs-string"><span class="hljs-string">"/path/to/wdir"</span></span>)</code> </pre><br>  Löschen Sie alle Änderungen und starten Sie den Computer neu: <br><br><pre> <code class="bash hljs">!<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -9 -1</code> </pre> <br>  Laden Sie die Datei auf den lokalen Computer hoch: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> files files.download(<span class="hljs-string"><span class="hljs-string">'file.ext'</span></span>)</code> </pre><br>  Holen Sie sich das Wörterbuch aus Dateien, die auf die Google-Festplatte hochgeladen wurden: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> files uploaded = files.upload()</code> </pre><br>  Ausgabe des Terminalbefehls stummschalten (zur Variablen umleiten): <br><br><pre> <code class="python hljs">lines_list = !pwd</code> </pre><br>  Im Allgemeinen bietet Google Colaboratory eine gute Möglichkeit, neuronale Netze in der Cloud zu trainieren.  Dies ist möglicherweise nicht ausreichend für sehr große Gitter.  Ein weiteres Plus ist die Möglichkeit, Code unabhängig vom lokalen Betriebssystem auszuführen (was für die Reproduzierbarkeit gut ist) und auch an demselben Projekt zusammenzuarbeiten.  Als Haken ist die GPU möglicherweise auch für längere Zeit nicht verfügbar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413229/">https://habr.com/ru/post/de413229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413219/index.html">Willkommen zum QA-Meetup SuperJob</a></li>
<li><a href="../de413221/index.html">Bakterien überleben in einem "Reinraum" während der Montage von Raumfahrzeugen und fressen Reinigungsprodukte</a></li>
<li><a href="../de413223/index.html">Habra Wörterbuch. Teil 1</a></li>
<li><a href="../de413225/index.html">Sicherheitswoche 20: Nichttriviale Cyber-Angriffe</a></li>
<li><a href="../de413227/index.html">Was ist Gott unter Kleidern?</a></li>
<li><a href="../de413231/index.html">Einführung in Smart Contracts</a></li>
<li><a href="../de413233/index.html">Der uLogin-Dienst sendet Daten von Formularen (E-Mail, Telefon) an eine Website eines Drittanbieters und schweigt darüber</a></li>
<li><a href="../de413235/index.html">Wetten auf bessere Vorhersagen: Neue Mathematik der Wettervorhersage</a></li>
<li><a href="../de413237/index.html">Facebook bestreitet, dass Gerätehersteller dieselben Daten wie Entwickler Alexander Kogan senden</a></li>
<li><a href="../de413239/index.html">Wie man ein Smartphone etwas dümmer macht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>