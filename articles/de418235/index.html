<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛷 👩🏼‍🍳 👸🏼 Orchestrierte Saga oder Erstellen von Geschäftstransaktionen in Diensten mit der Datenbank nach Dienstmuster 👎🏿 🎊 🎠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Mein Name ist Konstantin Evteev, ich arbeite in Avito als Leiter der DBA-Einheit. Unser Team entwickelt Avito-Speichersysteme, hilft bei der Au...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Orchestrierte Saga oder Erstellen von Geschäftstransaktionen in Diensten mit der Datenbank nach Dienstmuster</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418235/"><p>  Hallo!  Mein Name ist Konstantin Evteev, ich arbeite in Avito als Leiter der DBA-Einheit.  Unser Team entwickelt Avito-Speichersysteme, hilft bei der Auswahl oder Ausgabe von Datenbanken und der zugehörigen Infrastruktur, unterstützt das Service Level Objective für Datenbankserver und ist auch für die Ressourceneffizienz und -überwachung verantwortlich, berät beim Design und entwickelt möglicherweise Microservices. gebunden an Speichersysteme oder Dienste für die Entwicklung der Plattform im Kontext der Speicherung. </p><br><p>  Ich möchte erläutern, wie wir eine der Herausforderungen der Microservice-Architektur gelöst haben - die Durchführung von Geschäftstransaktionen in der Infrastruktur von Diensten, die mithilfe der Datenbank pro Dienstmuster erstellt wurden.  Ich habe auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Highload ++ Siberia 2018-</a> Konferenz eine Präsentation zu diesem Thema gehalten. </p><br><img src="https://habrastorage.org/webt/r3/bz/ty/r3bztya5eso1a_fkh9laghkue9k.png" alt="Bild"><a name="habracut"></a><br><p><br></p><br><h2 id="teoriya-maksimalno-kratko">  Theorie  So kurz wie möglich </h2><br><p>  Ich werde die Theorie der Sagen nicht im Detail beschreiben.  Ich werde Ihnen nur eine kurze Einführung geben, damit Sie den Kontext verstehen. </p><br><p>  Wie zuvor (von Beginn von Avito bis 2015 - 2016): Wir lebten in einem Monolithen mit monolithischen Basen und monolithischen Anwendungen.  Irgendwann hinderten uns diese Bedingungen daran zu wachsen.  Einerseits sind wir auf die Leistung eines Servers mit einer Hauptdatenbank gestoßen, aber dies ist nicht der Hauptgrund, da das Leistungsproblem beispielsweise durch Sharding gelöst werden kann.  Auf der anderen Seite hat der Monolith eine sehr komplexe Logik, und in einem bestimmten Wachstumsstadium wird die Bereitstellung von Änderungen (Releases) sehr lang und unvorhersehbar: Es gibt viele nicht offensichtliche und komplexe Abhängigkeiten (alles ist eng miteinander verbunden), es ist auch schwierig zu testen, im Allgemeinen gibt es viele Probleme.  Die Lösung besteht darin, auf die Microservice-Architektur umzusteigen.  Zu diesem Zeitpunkt hatten wir eine Frage zu Geschäftstransaktionen, die stark an ACIDs gebunden waren, die von einer monolithischen Basis bereitgestellt wurden: Es ist nicht klar, wie diese Geschäftslogik migriert werden soll.  Bei der Arbeit mit Avito gibt es viele verschiedene Szenarien, die von mehreren Diensten implementiert werden. Wenn die Integrität und Konsistenz der Daten sehr wichtig ist, z. B. Kauf eines Premium-Abonnements, Abbuchung von Geld, Anwendung von Diensten auf einen Benutzer, Kauf von VAS-Paketen - bei unvorhergesehenen Umständen oder Unfällen kann es sein, dass nicht alles unerwartet verläuft nach Plan.  Wir haben die Lösung in den Sagen gefunden. </p><br><p>  Ich mag die <a href="">technische Beschreibung der</a> Sagen im Jahr 1987 von Kenneth Salem und Hector Garcia-Molina, einem der derzeitigen Mitglieder des Oracle Board of Directors.  Wie das Problem formuliert wurde: Es gibt eine relativ kleine Anzahl langlebiger Transaktionen, die lange Zeit die Ausführung kleiner, weniger ressourcenintensiver und häufigerer Vorgänge verhindern.  Als gewünschtes Ergebnis können Sie ein Beispiel aus dem Leben geben: Sicherlich standen viele von Ihnen in der Schlange, um Dokumente zu kopieren, und der Kopierer, wenn er die Aufgabe hatte, ein ganzes Buch oder nur viele Kopien zu kopieren, machte von Zeit zu Zeit Kopien von anderen Mitgliedern der Warteschlange.  Die Entsorgung von Ressourcen ist jedoch nur ein Teil des Problems.  Die Situation wird durch langfristige Sperren bei der Ausführung ressourcenintensiver Aufgaben verschärft, deren Kaskade in Ihrem DBMS erstellt wird.  Darüber hinaus können während einer langen Transaktion Fehler auftreten: Die Transaktion wird nicht abgeschlossen und der Rollback beginnt.  Wenn die Transaktion lang war, dauert der Rollback ebenfalls lange, und die Anwendung wird wahrscheinlich erneut versucht.  Im Allgemeinen "ist alles sehr interessant."  Die in der technischen Beschreibung von SAGAS vorgeschlagene Lösung besteht darin, eine lange Transaktion in Teile aufzuteilen. </p><br><p>  Es scheint mir, dass viele sich dem näherten, ohne dieses Dokument überhaupt zu lesen.  Wir haben wiederholt über unseren Defproc gesprochen (verzögerte Prozeduren, die mit pgq implementiert wurden).  Wenn wir beispielsweise einen Benutzer wegen Betrugs blockieren, führen wir schnell eine kurze Transaktion durch und antworten dem Kunden.  In dieser kurzen Transaktion, einschließlich, stellen wir die Aufgabe in eine Transaktionswarteschlange und dann asynchron in kleinen Stapeln, z. B. blockieren zehn Anzeigen ihre Anzeigen.  Dazu haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Transaktionswarteschlangen von Skype</a> implementiert. </p><br><p>  Aber unsere heutige Geschichte ist etwas anders.  Wir müssen diese Probleme von der anderen Seite betrachten: Einen Monolithen in Mikrodienste sägen, die unter Verwendung der Datenbank pro Dienstmuster erstellt wurden. </p><br><p>  Einer der wichtigsten Parameter für uns ist das Erreichen der maximalen Schnittgeschwindigkeit.  Aus diesem Grund haben wir uns entschlossen, die alte Funktionalität und die gesamte Logik auf Microservices zu übertragen, ohne etwas zu ändern.  Zusätzliche Anforderungen, die wir erfüllen mussten: </p><br><blockquote><ul><li>  Stellen Sie abhängige Datenänderungen für geschäftskritische Daten bereit </li><li>  in der Lage sein, eine strenge Reihenfolge festzulegen; </li><li>  hundertprozentige Konsistenz einhalten - Daten auch bei Unfällen koordinieren; </li><li>  garantieren den Betrieb von Transaktionen auf allen Ebenen. </li></ul><br></blockquote><p>  Unter den oben genannten Anforderungen ist die Lösung in Form einer orchestrierten Saga am besten geeignet. </p><br><h2 id="realizaciya-orkestriruemoy-sagi-v-vide-servisa-pg-saga">  Implementierung einer orchestrierten Saga als PG Saga-Dienst </h2><br><p>  So sieht der PG Saga-Service aus. </p><br><p><img src="https://habrastorage.org/webt/mi/zm/0f/mizm0fidaxgpcv3wxoway4ksgoe.jpeg" alt="Bild"></p><br><p>  PG im Namen, da synchrones PostgreSQL als Service-Repository verwendet wird.  Was ist noch drin: </p><br><ul><li>  API </li><li>  Testamentsvollstrecker; </li><li>  checker; </li><li>  Gesundheitsprüfer; </li><li>  Kompensator. </li></ul><br><p>  Das Diagramm zeigt auch den Dienstbesitzer der Sagen. Nachfolgend sind die Dienste aufgeführt, die die Schritte der Saga ausführen.  Sie können unterschiedliche Repositorys haben. </p><br><h4 id="kak-eto-rabotaet">  Wie funktioniert es? </h4><br><p>  Betrachten Sie das Beispiel des Kaufs von VAS-Paketen.  VAS (Values-Added Services) - kostenpflichtige Services für die Anzeigenwerbung. </p><br><p>  Zunächst muss der Servicebesitzer der Saga die Erstellung der Saga im Saga-Service registrieren </p><br><p><img src="https://habrastorage.org/webt/6d/yo/zs/6dyozsxy0_qfoqmrtlrbijfaxeu.jpeg" alt="Bild"></p><br><p>  Danach wird bereits mit Payload eine Saga-Klasse generiert. </p><br><p><img src="https://habrastorage.org/webt/ul/hr/ic/ulhric8ofs455lgaz4mozdhs2l8.jpeg" alt="Bild"></p><br><p>  Darüber hinaus nimmt der Executor bereits im Sag-Service den zuvor erstellten Saga-Aufruf aus dem Store entgegen und beginnt mit der schrittweisen Ausführung.  Der erste Schritt in unserem Fall ist der Kauf eines Premium-Abonnements.  In diesem Moment ist Geld im Abrechnungsservice reserviert. </p><br><p><img src="https://habrastorage.org/webt/hf/re/yi/hfreyiq0vpgiojytn2gts5ws1ww.jpeg" alt="Bild"></p><br><p>  Dann werden im Dienst des Benutzers VAS-Operationen angewendet. </p><br><p><img src="https://habrastorage.org/webt/cy/lg/_m/cylg_mbibq4b6wfqvu_wz7ylcre.jpeg" alt="Bild"></p><br><p>  Dann sind die VAS-Dienste bereits vorhanden und Ihre Pakete werden erstellt.  Weitere Schritte sind weiter möglich, aber für uns nicht so wichtig. </p><br><p><img src="https://habrastorage.org/webt/h6/3r/r8/h63rr8iufd3m4tzovgonjywezhu.jpeg" alt="Bild"></p><br><h2 id="avarii">  Abstürze </h2><br><p>  Unfälle können in jedem Dienst auftreten, aber es gibt bekannte Tricks, wie man sich darauf vorbereitet.  In einem verteilten System ist es wichtig, diese Techniken zu kennen.  Eine der wichtigsten Einschränkungen ist beispielsweise, dass das Netzwerk nicht immer zuverlässig ist.  Ansätze, die die Interaktionsprobleme in verteilten Systemen lösen: </p><br><blockquote><ol><li>  Wir versuchen es erneut. </li><li>  Wir markieren jede Operation mit einem idempotenten Schlüssel.  Dies ist erforderlich, um Doppelarbeit zu vermeiden.  Weitere Informationen zu idempotenten Schlüsseln finden Sie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem</a> Artikel. </li><li>  Wir kompensieren Transaktionen - eine für Sagen charakteristische Aktion. </li></ol><br></blockquote><br><h4 id="kompensaciya-tranzakciy-kak-eto-rabotaet">  Transaktionskompensation: Wie es funktioniert </h4><br><p>  Für jede positive Transaktion müssen wir die umgekehrten Aktionen beschreiben: ein Geschäftsszenario des Schritts für den Fall, dass etwas schief geht. </p><br><p>  In unserer Implementierung bieten wir folgendes Vergütungsszenario an: </p><br><p>  Wenn ein Schritt der Saga erfolglos war und wir viele Wiederholungsversuche unternommen haben, besteht die Möglichkeit, dass die letzte Wiederholung der Operation erfolgreich war, aber wir haben einfach keine Antwort erhalten.  Wir werden versuchen, die Transaktion zu kompensieren, obwohl dieser Schritt nicht erforderlich ist, wenn der Service Executor des Problemschritts wirklich zusammengebrochen ist und vollständig unzugänglich ist. </p><br><p>  In unserem Beispiel sieht es so aus: </p><br><ol><li>  Schalten Sie VAS-Pakete aus. </li></ol><br><p><img src="https://habrastorage.org/webt/rf/6s/94/rf6s943lzidqq_hfyuu-_fnbd_a.jpeg" alt="Bild"></p><br><ol><li>  Brechen Sie den Benutzervorgang ab. </li></ol><br><p><img src="https://habrastorage.org/webt/qv/wl/tx/qvwltxbftjc_diwxtudv5ym0mde.jpeg" alt="Bild"></p><br><ol><li>  Wir stornieren die Reservierung von Geldern. </li></ol><br><p><img src="https://habrastorage.org/webt/0b/_r/t9/0b_rt9gobty3zu1xhz6uqjo2cf8.jpeg" alt="Bild"></p><br><h4 id="chto-delat-esli-i-kompensaciya-ne-rabotaet">  Was tun, wenn die Entschädigung nicht funktioniert? </h4><br><p>  Offensichtlich müssen wir ungefähr das gleiche Szenario anwenden.  Wenden Sie erneut idempotente Wiederholungsschlüssel an, um Transaktionen zu kompensieren. Wenn diesmal jedoch nichts herauskommt, z. B. der Dienst nicht verfügbar ist, müssen Sie sich an den Dienstbesitzer der Saga wenden und Sie darüber informieren, dass die Saga fehlgeschlagen ist.  Weitere schwerwiegendere Maßnahmen: Eskalieren Sie das Problem, z. B. für einen manuellen Test oder starten Sie die Automatisierung, um solche Probleme zu lösen. </p><br><p>  Was wichtiger ist: Stellen Sie sich vor, dass ein Schritt des Saga-Dienstes nicht verfügbar ist.  Sicher wird der Initiator dieser Aktionen einige Wiederholungsversuche durchführen.  Und am Ende macht Ihr Saga-Service den ersten Schritt, den zweiten Schritt, und sein Executor ist nicht verfügbar. Sie brechen den zweiten Schritt ab, brechen den ersten Schritt ab, und es kann auch Anomalien geben, die mit dem Mangel an Isolation verbunden sind.  Im Allgemeinen ist der Saga-Dienst in dieser Situation mit nutzloser Arbeit beschäftigt, die immer noch eine Last und Fehler erzeugt. </p><br><p>  Wie geht das?  Healthchecker sollte die Dienste befragen, die die Durchhangschritte ausführen, und prüfen, ob sie funktionieren.  Wenn der Dienst nicht mehr verfügbar ist, gibt es zwei Möglichkeiten: Sie können die in Betrieb befindlichen Sagen kompensieren und verhindern, dass neue Sagen neue Instanzen (Aufrufe) erstellen, oder sie erstellen, ohne sie als Executer zu verwenden, damit der Dienst dies nicht tut unnötige Aktionen. </p><br><h4 id="esche-odin-scenariy-s-avariey">  Ein weiteres Unfallszenario </h4><br><p>  Stellen Sie sich vor, wir machen wieder das gleiche Premium-Abonnement. </p><br><ol><li>  Wir kaufen VAS-Pakete und reservieren Geld. </li></ol><br><p><img src="https://habrastorage.org/webt/tn/ms/7p/tnms7pcslyj_8f4hftsqtzzlspm.jpeg" alt="Bild"></p><br><ol><li>  Wir wenden Dienstleistungen auf den Benutzer an. </li></ol><br><p><img src="https://habrastorage.org/webt/by/ep/fe/byepfee_drperqqj2on1hg3gq-a.jpeg" alt="Bild"></p><br><ol><li>  Wir erstellen VAS-Pakete. </li></ol><br><p><img src="https://habrastorage.org/webt/yq/l_/sf/yql_sf9gnlyolfstvyug4gwaday.jpeg" alt="Bild"></p><br><p>  Es scheint gut zu sein.  Nach Abschluss der Transaktion stellt sich jedoch plötzlich heraus, dass im Benutzerdienst eine asynchrone Replikation verwendet wird und auf der Master-Basis ein Unfall aufgetreten ist.  Es kann mehrere Gründe für eine Verzögerung des Replikats geben: Eine bestimmte Belastung des Replikats, die entweder die Geschwindigkeit der Replikationswiedergabe verlangsamt oder die Replikationswiedergabe blockiert.  Außerdem kann die Quelle (Master) überlastet werden, und auf der Quellseite tritt eine Verzögerung beim Senden von Änderungen auf.  Im Allgemeinen blieb die Replik aus irgendeinem Grund zurück, und die Änderungen des erfolgreich abgeschlossenen Schritts nach dem Unfall verschwanden plötzlich (Ergebnis / Zustand). </p><br><p><img src="https://habrastorage.org/webt/hu/nh/hu/hunhhuizvvxmajf0hukmvbhzpnu.jpeg" alt="Bild"></p><br><p>  Dazu implementieren wir eine weitere Komponente im System - wir verwenden Checker.  Checker durchläuft alle Schritte erfolgreicher Sagen in einer Zeit, die bekanntermaßen größer ist als alle möglichen Verzögerungen (z. B. nach 12 Stunden), und prüft, ob sie noch erfolgreich abgeschlossen wurden.  Wenn der Schritt plötzlich fehlschlägt, rollt die Saga zurück. </p><br><p><img src="https://habrastorage.org/webt/kn/9n/cy/kn9ncyccg350yxl-orc9jamngbm.jpeg" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/hz/af/-m/hzaf-mwke2a8cvi8mdlb_uzquxy.jpeg" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/jg/ex/dc/jgexdcrgimsuugdqw27gay_i2kw.jpeg" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/xp/hv/mo/xphvmouowjv2tgln0-o1mf43rts.jpeg" alt="Bild"></p><br><p>  Es kann auch Situationen geben, in denen nach 12 Stunden bereits nichts mehr abzubrechen ist - alles ändert sich und bewegt sich.  In diesem Fall kann die Lösung anstelle des Stornierungsszenarios darin bestehen, dem Service des Saga-Besitzers zu signalisieren, dass dieser Vorgang nicht abgeschlossen wurde.  Wenn der Stornierungsvorgang beispielsweise nicht möglich ist, müssen Sie nach dem Aufladen des Benutzers eine Stornierung vornehmen, und sein Guthaben ist bereits Null, und das Geld kann nicht abgeschrieben werden.  Wir haben solche Szenarien immer in Richtung des Benutzers gelöst.  Möglicherweise haben Sie ein anderes Prinzip, das mit den Vertretern des Produkts übereinstimmt. </p><br><p>  Wie Sie vielleicht bemerkt haben, müssen Sie daher an verschiedenen Stellen für die Integration in den Sag-Service viele verschiedene Logikfunktionen implementieren.  Wenn Kundenteams eine Saga erstellen möchten, haben sie daher eine sehr große Anzahl von nicht offensichtlichen Aufgaben.  Zunächst erstellen wir eine Saga, damit die Duplizierung nicht funktioniert. Dazu arbeiten wir mit einer idempotenten Operation zum Erstellen einer Saga und ihrer Verfolgung.  In Diensten ist es auch erforderlich, die Fähigkeit zu realisieren, jeden Schritt jeder Saga zu verfolgen, um sie einerseits nicht zweimal auszuführen und andererseits zu beantworten, ob sie tatsächlich abgeschlossen wurde.  Und all diese Mechanismen müssen irgendwie gewartet werden, damit die Service-Repositorys nicht überlaufen.  Darüber hinaus gibt es viele Sprachen, in denen Dienste geschrieben werden können, und eine große Auswahl an Repositorys.  In jeder Phase müssen Sie die Theorie verstehen und all diese Logik in verschiedenen Teilen implementieren.  Wenn Sie dies nicht tun, können Sie eine ganze Reihe von Fehlern machen. </p><br><p>  Es gibt viele richtige Wege, aber es gibt nicht weniger Situationen, in denen Sie sich selbst ein Glied schießen können.  Damit die Sagen korrekt funktionieren, müssen Sie alle oben genannten Mechanismen in Client-Bibliotheken kapseln, die sie für Ihre Clients transparent implementieren. </p><br><h4 id="primer-logiki-generacii-sagi-kotoruyu-mozhno-skryt-v-klientskoy-biblioteke">  Ein Beispiel für die Logik zur Saga-Generierung, die in der Client-Bibliothek ausgeblendet werden kann </h4><br><p>  Es kann anders gemacht werden, aber ich schlage den folgenden Ansatz vor. </p><br><ol><li>  Wir erhalten die Anforderungs-ID, mit der wir die Saga erstellen müssen. </li><li>  Wir gehen zum Durchhangdienst, erhalten seine eindeutige Kennung und speichern ihn im lokalen Speicher in Verbindung mit der Anforderungs-ID von Punkt 1. </li><li>  Führen Sie die Saga mit Nutzlast im Durchhangdienst aus.  Eine wichtige Nuance: Ich schlage vor, lokale Operationen des Dienstes, der die Saga erstellt, als ersten Schritt der Saga zu entwerfen. </li><li>  Es gibt eine bestimmte Rasse, in der der Saga-Dienst diesen Schritt ausführen kann (Punkt 3), und unser Backend, das die Erstellung der Saga initiiert, wird ihn ebenfalls ausführen.  Dazu führen wir überall idempotente Operationen durch: Eine Person führt sie aus, und der zweite Anruf erhält einfach „OK“. </li><li>  Wir rufen den ersten Schritt (Punkt 4) auf und antworten erst danach dem Kunden, der diese Aktion initiiert hat. </li></ol><br><p>  In diesem Beispiel arbeiten wir mit der Saga als Datenbank.  Sie können eine Anfrage senden, und dann wird die Verbindung möglicherweise unterbrochen, aber die Aktion wird ausgeführt.  Dies ist ungefähr der gleiche Ansatz. </p><br><h2 id="kak-eto-vse-proverit">  Wie man alles überprüft </h2><br><p>  Es ist notwendig, den gesamten Service von Durchhangtests abzudecken.  Höchstwahrscheinlich werden Sie Änderungen vornehmen, und die zu Beginn geschriebenen Tests helfen, unerwartete Überraschungen zu vermeiden.  Außerdem müssen die Sagen selbst überprüft werden.  Zum Beispiel, wie wir das Testen des Durchhangdienstes und das Testen der Durchhangsequenz in einer Transaktion arrangieren.  Es gibt verschiedene Testblöcke.  Wenn wir über den Durchhangdienst sprechen, weiß er, wie man positive Transaktionen und Vergütungstransaktionen durchführt. Wenn die Vergütung nicht funktioniert, informiert er den Durchhangbesitzer des Dienstes.  Wir schreiben allgemein Tests für die Arbeit mit einer abstrakten Saga. </p><br><p>  Auf der anderen Seite sind positive Transaktionen und Vergütungstransaktionen für Services, die Durchhangschritte ausführen, eine einfache API, und die Tests dieses Teils liegen in der Verantwortung des Teams, dem dieser Service gehört. </p><br><p>  Und dann schreibt das Team der Saga-Besitzer End-to-End-Tests, bei denen überprüft wird, ob die gesamte Geschäftslogik bei der Ausführung der Saga ordnungsgemäß funktioniert.  Der End-to-End-Test wird in einer vollständigen Entwicklungsumgebung ausgeführt, alle Dienstinstanzen, einschließlich des Sag-Dienstes, werden ausgelöst, und dort wird bereits ein Geschäftsszenario getestet. </p><br><p><img src="https://habrastorage.org/webt/qb/j0/gn/qbj0gnyhcjvk2lz4djeip_qfaqe.png" alt="Bild" width="340" height="233" align="right"><br>  <strong>Gesamt:</strong> </p><br><ul><li>  schreibe mehr Unit-Tests; </li><li>  Integrationstests schreiben; </li><li>  Schreiben Sie End-to-End-Tests. <br><br clear="right">  Der nächste Schritt ist CDC.  Die Microservice-Architektur wirkt sich auf die Besonderheiten von Tests aus.  In Avito haben wir den folgenden Ansatz zum Testen der Microservice-Architektur gewählt: Consumer-Driven Contracts.  Dieser Ansatz hilft zunächst, Probleme hervorzuheben, die in End-to-End-Tests identifiziert werden können, aber der End-to-End-Test ist „sehr teuer“. </li></ul><br><p>  Was ist die Essenz von CDC?  Es gibt einen Dienst, der einen Vertrag bereitstellt.  Er hat eine API - dies ist ein Anbieter.  Und es gibt einen anderen Dienst, der die API aufruft, dh den Vertrag verwendet - Consumer. </p><br><p>  Der Verbraucherservice schreibt Tests für den Vertrag des Anbieters, und Tests, die nur vom Vertrag überprüft werden, sind keine Funktionstests.  Es ist wichtig, dass wir sicherstellen, dass beim Ändern der API die Schritte in diesem Kontext nicht unterbrochen werden.  Nachdem wir die Tests geschrieben haben, wird ein weiteres Element des Service Brokers angezeigt - Informationen zu CDC-Tests werden darin aufgezeichnet.  Jedes Mal, wenn der Provider-Dienst geändert wird, wird eine isolierte Umgebung erstellt und die vom Verbraucher geschriebenen Tests ausgeführt.  Was ist das Endergebnis: Das Team, das die Sagen erstellt, schreibt Tests für alle Schritte der Geschichte und registriert sie. </p><br><p><img src="https://habrastorage.org/webt/n1/i-/hm/n1i-hmjmyxs9iavcoxzoem2mcly.jpeg" alt="Bild"><br>  Über die Implementierung des CDC-Ansatzes durch Avito zum Testen von Mikrodiensten sprach Frol Kryuchkov auf der RIT ++.  Abstracts finden Sie auf der Website <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Backend.conf</a> - Ich empfehle Ihnen, sich vertraut zu machen. </p><br><h2 id="vidy-sag">  Arten von Sagen </h2><br><h4 id="po-poryadku-vyzova-funkciy">  In der Reihenfolge der Funktionsaufrufe </h4><br><p>  a) ungeordnet - die Funktionen der Saga werden in beliebiger Reihenfolge aufgerufen und warten nicht darauf, dass sie sich gegenseitig abschließen; <br>  b) geordnet - die Funktionen der Saga werden in der angegebenen Reihenfolge nacheinander aufgerufen, die nächste wird erst aufgerufen, wenn die vorherige abgeschlossen ist; <br>  c) gemischt - für einen Teil der Funktionen wird die Reihenfolge festgelegt, für den Teil jedoch nicht, sondern vor oder nach den Stufen, in denen sie ausgeführt werden sollen. </p><br><p>  Stellen Sie sich ein bestimmtes Szenario vor.  Im gleichen Szenario wie beim Kauf eines Premium-Abonnements besteht der erste Schritt darin, Geld zu reservieren.  Jetzt können wir Änderungen am Benutzer vornehmen und parallel Premium-Pakete erstellen. Wir werden den Benutzer erst benachrichtigen, wenn diese beiden Schritte abgeschlossen sind. <br><img src="https://habrastorage.org/webt/d8/a0/r7/d8a0r7wv7mq1a8gdphaq0aug1oe.png" alt="Bild"></p><br><h4 id="po-polucheniyu-rezultata-vyzova-funkciy">  Indem Sie das Ergebnis des Funktionsaufrufs erhalten </h4><br><p>  a) synchron - das Ergebnis der Funktion ist sofort bekannt; <br>  b) asynchron - Die Funktion gibt sofort "OK" zurück und das Ergebnis wird später durch einen Rückruf an die Sag-Service-API vom Client-Service zurückgegeben. </p><br><p>  Ich möchte Sie vor einem Fehler warnen: Es ist besser, keine synchronen Schritte der Sagen auszuführen, insbesondere wenn Sie eine orchestrierte Saga implementieren.  Wenn Sie synchrone Durchhangschritte ausführen, wartet der Durchhangdienst, bis dieser Schritt abgeschlossen ist.  Dies ist eine zusätzliche Belastung, zusätzliche Probleme im Dienst von Sagen, da es eines ist und es viele Teilnehmer an Sagen gibt. </p><br><h2 id="masshtabirovanie-sag">  Durchhangskalierung </h2><br><p>  Die Skalierung hängt von der Größe des von Ihnen geplanten Systems ab.  Betrachten Sie die Option mit einer einzelnen Speicherinstanz: </p><br><blockquote><ul><li>  Ein Saga-Step-Handler verarbeitet die Schritte mit Chargen. </li><li>  In Handlern implementieren wir einen „Kamm“ - wir unternehmen Schritte für den Rest der Division: Wenn jeder Executor seine eigenen Schritte erhält. </li><li>  n Handler und Skip Locked - werden noch effizienter und flexibler. </li></ul><br></blockquote><p>  Und nur dann, wenn Sie im Voraus wissen, dass Sie auf die Leistung eines Servers in einem DBMS stoßen, müssen Sie Sharding-n-Datenbankinstanzen ausführen, die mit ihrem Datensatz funktionieren.  Sharding kann hinter der Sag-Service-API versteckt werden. </p><br><h4 id="bolshe-gibkosti">  Mehr Flexibilität </h4><br><p>  Darüber hinaus kann in diesem Muster zumindest theoretisch der Client-Service (der den Saga-Schritt ausführt) auf den Sag-Service zugreifen und in diesen passen, und die Teilnahme an der Saga kann ebenfalls optional sein.  Möglicherweise gibt es auch ein anderes Szenario: Wenn Sie bereits eine E-Mail gesendet haben, kann die Aktion nicht kompensiert werden. Sie können den Brief nicht zurücksenden.  Aber Sie können einen neuen Brief senden, dass der vorherige falsch war, und es sieht so aus.  Es ist besser, ein Szenario zu verwenden, in dem die Saga nur vorwärts ohne Kompensation gespielt wird.  Wenn es nicht vorwärts abgespielt wird, muss der Service des Saga-Besitzers über das Problem informiert werden. </p><br><h4 id="kogda-nuzhen-lok">  Wann brauchen Sie ein Schloss </h4><br><p>  Ein kleiner Exkurs über die Sagen im Allgemeinen: Wenn Sie Ihre Logik ohne die Saga machen können, dann tun Sie es.  Sagen sind schwer.  Bei der Sperre ist es ungefähr dasselbe: Es ist besser, Sperren immer zu vermeiden. </p><br><p>  Als ich zum Abrechnungsteam kam, um über Sagen zu sprechen, sagten sie, dass sie ein Schloss brauchten.  Ich konnte ihnen erklären, warum es besser ist, darauf zu verzichten und wie man es macht.  Wenn Sie jedoch noch ein Schloss benötigen, sollte dies im Voraus vorgesehen werden.  Vor dem Sag-Service haben wir bereits Sperren im Rahmen eines DBMS implementiert.  Ein Beispiel mit defproc und einem Skript zum asynchronen Blockieren von Anzeigen und zum synchronen Blockieren eines Kontos, wenn wir zuerst einen Teil des Vorgangs synchron ausführen und die Sperre setzen und dann den Rest der Arbeit mit Stapeln asynchron beenden. </p><br><p>  Wie kann man das machen?         ,       ,    ,           , ,  -      ,  .          .   .    :       ,       ,            . </p><br><p>   -,  ,    .   ,      ,    .   , ,    .        .       —    ,     ,        . </p><br><h2 id="acid--bez-izolyacii"> ACID —   </h2><br><p>    ,     ,  .            .   —       durability.    .         .  ,     .   - ,  -  - ,          </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mo stretchy=&quot;false&quot;>(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy=&quot;false&quot;>)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.618ex" height="2.66ex" viewBox="0 -832 25238.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="8396" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="9209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6E" x="9738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="10339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="10808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-63" x="11338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="11771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="12133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6F" x="12478" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6E" x="12964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-77" x="13564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="14732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="15078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="15439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="15906" y="0"></use><g transform="translate(16653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-54" x="18488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6A" x="19192" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-28" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6F" x="19994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="20480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-43" x="20931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="21692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-29" x="22037" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-77" x="22427" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="23143" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="23595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="23940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="24302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="24768" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mo stretchy="false">(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy="false">)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">Ti reads => other rtransaction writes => Tj (or Ci) writes</script></p><br><p>   <strong></strong>  —      - ,  - , , -    ,      .    , - ,  -   . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.989ex" height="2.057ex" viewBox="0 -780.1 21953.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-77" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="1766" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="2218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="2563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="2925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="3391" y="0"></use><g transform="translate(4138,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6F" x="5973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="6459" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-68" x="6820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="7863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="8676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="9128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6E" x="9657" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="10258" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="10727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-63" x="11257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="11690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="12052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6F" x="12397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6E" x="12883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="13483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="13935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="14401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-64" x="14931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-43" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="18797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-77" x="19142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="19859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="20310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="20656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="21017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="21484" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">Ti writes => other transaction reads => Ci writes</script></p><br><p>  <strong></strong>  —               . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.154ex" height="2.419ex" viewBox="0 -780.1 21594.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="8306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6E" x="9287" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="9887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="10357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-63" x="10886" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="11320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="11681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6F" x="12027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6E" x="12512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-77" x="13113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="13829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-69" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-74" x="14626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="14988" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-54" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-6A" x="18741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-72" x="19153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-65" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-61" x="20071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-64" x="20601" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhg8taqe69_-Hr3SsW4yjwkXoLx5aQ#MJMATHI-73" x="21124" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">Ti reads =>other transaction writes =>Tj reads</script></p><br><p>   : </p><br><blockquote><ol><li>    ,   , ,  ,      . </li><li> ,        .     ,    ,  ,  ,        ,     . </li><li>           . </li><li>   payload        .    eventual consistency —       ,  ,      ,     .     ,  , ,       -. </li></ol><br></blockquote><br><h2 id="monitoring">  Überwachung </h2><br><p>             .    ,            .           .       checker.           .   ,   . </p><br><p><img src="https://habrastorage.org/webt/vm/gv/_w/vmgv_wl16ngyd78b78ndyp4v1_4.png" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/fv/cz/2l/fvcz2luhdac4ixpzmlbbarex_se.png" alt="Bild"></p><br><p>       (50%, 75%, 95%, 99%),        ,  -   . </p><br><p>    ,    —    ,         .         .     ,  -   .  ,       —           . </p><br><p>   .  ,  -   (   )   .    healthchecker   endpoint' info (keep-alive)  . </p><br><p>    .      -.  -,   -  ,           -  .       ,    ,    ,    end-to-end.      - . ,    ,      —    . <br>      .           . </p><br><h2 id="na-chto-stoit-obratit-vnimanie">     : </h2><br><h4 id="izbegat-parazitnyh-nagruzok">    </h4><br><p>    ,    healthchecker,   -    ,     .     ,   .       . </p><br><h4 id="izbegat-slozhnoy-logiki-izbytochnoy-funkcionalnosti-v-servise-sag">         </h4><br><p>       ,        .   ,     ,      .         .  choreography     —       -   .   ,       choreography- ,      .    choreography  ,    .     ,           . ,      ,       ,      . </p><br><h4 id="integrirovatsya-s-klientami">    </h4><br><p>        .     ,      ,         . ,        +               . </p><br><h4 id="versionnost-api">  API </h4><br><p>   ,   -     -  (  API ),    ,      API.                 API   .     —         .           API  ,    ,   100%       . </p><br><p>   ,     ,     ,     ,     .    —    ,    ,    .        . </p><br><h4 id="kompensaciya-pri-avariyah">    </h4><br><p>    ,    ,    ,          .        ( )         . </p><br><h4 id="otsutstvie-izolyacii">   </h4><br><p>     ,            ,  ,      ,        . </p><br><h4 id="blokirovki">  </h4><br><p>   .  ,     ,    . </p><br><h4 id="treysing-po-saga-call-id">   saga call ID </h4><br><p>         .  API   ,          . </p><br><h2 id="itog--chto-vybirat">  —   </h2><br><p> -      legacy .         ,      (       «»                ).    « »?    -  ,     ,    ,   ,    - ,          .     ,  ,           ,         .    ,    « »,     ,         -.  .  —     .  ,          . </p><br><p>      ,     ,        .  ,  ,      ,   ,      . ,  ,      .       . </p><br><p>            ,   .   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418235/">https://habr.com/ru/post/de418235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418223/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 7: Die Native Client Sandbox, Teil 1</a></li>
<li><a href="../de418225/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 7: Native Client Sandbox Teil 2</a></li>
<li><a href="../de418227/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 7: Die Native Client Sandbox, Teil 3</a></li>
<li><a href="../de418229/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 8: Netzwerksicherheitsmodell, Teil 1</a></li>
<li><a href="../de418233/index.html">BMW Mnemonik zum Finden von Grenzwerten</a></li>
<li><a href="../de418237/index.html">Entwicklung mandantenfähiger Anwendungen auf der SAP Cloud Platform in Neo, Teil 2: Autorisierung und Authentifizierung</a></li>
<li><a href="../de418239/index.html">48 Megapixel für Smartphone</a></li>
<li><a href="../de418241/index.html">Warum Gauß? (100 Möglichkeiten, das Gleichungssystem zu lösen)</a></li>
<li><a href="../de418243/index.html">Die populäre Geschichte der Astronomie ist falsch</a></li>
<li><a href="../de418245/index.html">Wie man kein Projekt auf Bitrix entwickelt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>