<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“ ğŸš ğŸ¦” Le support technique de 3CX rÃ©pond: capturez le trafic SIP sur le serveur PBX ğŸ© ğŸ¦– ğŸ‘©â€ğŸ‘©â€ğŸ‘§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, nous parlerons des bases de la capture et de l'analyse du trafic SIP gÃ©nÃ©rÃ© par les PBX 3CX. L'article s'adresse aux administrateurs...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le support technique de 3CX rÃ©pond: capturez le trafic SIP sur le serveur PBX</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/3cx/blog/455381/">  Dans cet article, nous parlerons des bases de la capture et de l'analyse du trafic SIP gÃ©nÃ©rÃ© par les PBX 3CX.  L'article s'adresse aux administrateurs systÃ¨me dÃ©butants ou aux utilisateurs ordinaires dont les responsabilitÃ©s incluent la maintenance de la tÃ©lÃ©phonie.  Pour une Ã©tude approfondie du sujet, nous vous recommandons de suivre le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours de formation avancÃ©e 3CX</a> . <br><br>  3CX V16 vous permet de capturer le trafic SIP directement via l'interface Web du serveur et de l'enregistrer au format PCAP Wireshark standard.  Vous pouvez joindre le fichier de capture lorsque vous contactez le support technique ou tÃ©lÃ©chargez pour une auto-analyse. <a name="habracut"></a><br><br>  Si 3CX fonctionne sous Windows, vous devez installer Wireshark sur le serveur 3CX vous-mÃªme.  Sinon, lorsque vous essayez de capturer, le message suivant apparaÃ®t. <br><img src="https://habrastorage.org/getpro/habr/post_images/170/ed9/40b/170ed940b2159d489164e56fd1ed5d61.png"><br><br>  Sur les systÃ¨mes Linux, tcpdump est installÃ© automatiquement lorsque vous installez ou mettez Ã  niveau 3CX. <br><br><h2>  Capture du trafic </h2><br>  Pour commencer la capture, accÃ©dez Ã  la section interface Accueil&gt; Ã‰vÃ©nements SIP et sÃ©lectionnez l'interface sur laquelle vous souhaitez capturer.  Vous pouvez Ã©galement capturer le trafic sur toutes les interfaces simultanÃ©ment, Ã  l'exception des interfaces de tunneling IPv6. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3be/f3b/1b7/3bef3b1b7e78206b60788a3f593a07bc.png"><br><br>  Dans 3CX pour Linux, vous pouvez capturer le trafic pour l'hÃ´te local (lo).  Cette capture est utilisÃ©e pour analyser les connexions client SIP Ã  l'aide de la technologie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3CX Tunnel et du Session Border Controller</a> . <br><br>  Le bouton Traffic Capture lance Wireshark sous Windows ou tcpdump sous Linux.  Ã€ ce stade, vous devez reproduire rapidement le problÃ¨me, car  Capture charge le processeur et occupe suffisamment d'espace disque. <br><img src="https://habrastorage.org/getpro/habr/post_images/1c3/b4e/dba/1c3b4edba3ec938ba5eec5b7d13667a1.png"><br><br>  Faites attention aux paramÃ¨tres d'appel suivants: <br><br><ul><li>  Le numÃ©ro qui a Ã©tÃ© appelÃ©, qui a Ã©tÃ© appelÃ© par d'autres numÃ©ros / participants de l'appel. <br></li><li>  Heure exacte Ã  laquelle le problÃ¨me s'est produit sur l'horloge du serveur 3CX. <br></li><li>  L'itinÃ©raire de l'appel. <br></li></ul><br>  Essayez de ne pas cliquer Ã  d'autres endroits de l'interface, Ã  l'exception du bouton Â«ArrÃªterÂ».  Ne cliquez pas non plus sur d'autres liens dans cette fenÃªtre de navigateur.  Sinon, la capture du trafic se poursuivra en arriÃ¨re-plan et entraÃ®nera une charge supplÃ©mentaire sur le serveur. <br><br><h2>  Obtenir un fichier de capture </h2><br>  Le bouton ArrÃªter arrÃªte la capture et enregistre le fichier de capture.  Vous pouvez tÃ©lÃ©charger le fichier sur votre ordinateur pour analyse dans l'utilitaire Wireshark ou gÃ©nÃ©rer un fichier de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">support technique</a> spÃ©cial qui inclura cette capture et d'autres informations de dÃ©bogage.  AprÃ¨s tÃ©lÃ©chargement ou inclusion dans le package de support technique, le fichier de capture est automatiquement supprimÃ© du serveur 3CX pour des raisons de sÃ©curitÃ©. <br><br>  Sur le serveur 3CX, le fichier se trouve Ã  l'emplacement suivant: <br><br><ul><li>  Windows: C: \ ProgramData \ 3CX \ Instance1 \ Data \ Logs \ dump.pcap <br></li><li>  Linux: /var/lib/3cxpbx/Instance/Data/Logs/dump.pcap <br></li></ul><br>  Pour Ã©viter une charge accrue du serveur ou une perte de paquets pendant la capture, la pÃ©riode de capture est limitÃ©e Ã  2 millions de paquets.  AprÃ¨s cela, la capture s'arrÃªte automatiquement.  Si vous avez besoin d'une capture plus longue, utilisez l'utilitaire Wireshark sÃ©parÃ©, comme dÃ©crit ci-dessous. <br><br>
<h2>  Capture du trafic Wireshark </h2><br>  Si vous Ãªtes intÃ©ressÃ© par une analyse plus approfondie du trafic rÃ©seau, capturez-la manuellement.  TÃ©lÃ©chargez ici l'utilitaire Wireshark pour votre systÃ¨me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'</a> exploitation.  AprÃ¨s avoir installÃ© l'utilitaire sur le serveur 3CX, accÃ©dez Ã  Capture&gt; Interfaces.  Toutes les interfaces rÃ©seau de l'OS seront affichÃ©es ici.  Les adresses IP de l'interface peuvent Ãªtre affichÃ©es dans IPv6.  Pour voir l'adresse IPv4, cliquez sur l'adresse IPv6. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa8/011/f70/aa8011f7006210f391cf07fea10dcdc9.png"><br><br>  SÃ©lectionnez l'interface Ã  capturer et cliquez sur le bouton Options.  DÃ©cochez Capture Traffic en mode promiscuous et laissez le reste des paramÃ¨tres inchangÃ©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14b/dc7/fbf/14bdc7fbfad0be3a6785e578c989f01c.png"><br><br>  Vous devez maintenant reproduire le problÃ¨me.  Lorsque le problÃ¨me est reproduit, arrÃªtez la capture (menu Capture&gt; ArrÃªter).  Vous pouvez sÃ©lectionner des messages SIP dans le menu TÃ©lÃ©phonie&gt; Flux SIP. <br><br><h2>  Notions de base sur l'analyse du trafic - Message SIP INVITE </h2><br>  ConsidÃ©rez les principaux champs du message INVITE SIP qui est envoyÃ© pour Ã©tablir un appel VoIP, c'est-Ã -dire  est le point de dÃ©part de l'analyse.  En rÃ¨gle gÃ©nÃ©rale, SIP INVITE comprend de 4 Ã  6 champs contenant des informations utilisÃ©es par les terminaux SIP (tÃ©lÃ©phones, passerelles) et les opÃ©rateurs de tÃ©lÃ©communications.  La comprÃ©hension du contenu d'INVITE et des messages qui le suivent permet souvent de dÃ©terminer la source du problÃ¨me.  De plus, la connaissance des champs INVITE aide Ã  connecter des opÃ©rateurs SIP Ã  3CX ou Ã  combiner 3CX avec d'autres Ã©changes SIP. <br><br>  Dans un message INVITE, les utilisateurs (ou appareils SIP) sont identifiÃ©s par l'URI.  En rÃ¨gle gÃ©nÃ©rale, un URI SIP est le numÃ©ro de tÃ©lÃ©phone de l'utilisateur + l'adresse du serveur SIP.  L'URI SIP est trÃ¨s similaire Ã  une adresse e-mail et est Ã©crit comme sip: x @ y: Port. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9f/81a/c5a/d9f81ac5a0cc88303b7ea2178bf3212d.png"><br><br><h3>  URI de ligne de demande: </h3><br>  Request-Line-URI - le champ contient le destinataire de l'appel.  Il contient les mÃªmes informations que dans le champ Ã€, mais sans nom d'affichage. <br><br><h3>  Via: </h3><br>  Via - chaque serveur SIP (proxy) via lequel la demande INVITE passe, ajoute en haut de la liste Via son adresse IP et le port auquel le message a Ã©tÃ© reÃ§u.  Ensuite, le message est transmis plus loin le long de l'itinÃ©raire.  Lorsque le destinataire final rÃ©pond Ã  la demande INVITE, tous les nÅ“uds de transit Â«parcourentÂ» l'en-tÃªte Via et renvoient un message Ã  l'expÃ©diteur le long du mÃªme itinÃ©raire.  Dans ce cas, le proxy de transit SIP supprime ses donnÃ©es de l'en-tÃªte. <br><br><h3>  De: </h3><br>  De - l'en-tÃªte indique l'initiateur de la demande du point de vue du serveur SIP.  L'en-tÃªte est formÃ© de la mÃªme maniÃ¨re qu'une adresse de messagerie (utilisateur @ domaine, oÃ¹ utilisateur est le numÃ©ro de poste de l'utilisateur 3CX et domaine est l'adresse IP locale ou le domaine SIP du serveur 3CX).  Comme l'en-tÃªte To, l'en-tÃªte From contient un URI et, Ã©ventuellement, un nom d'utilisateur Nom d'affichage.  Ã€ partir de l'en-tÃªte De, vous pouvez comprendre exactement comment cette demande SIP doit Ãªtre traitÃ©e. <br><br>  La norme SIP RFC 3261 prÃ©voit que si le nom d'affichage n'est pas transmis, le tÃ©lÃ©phone IP ou la passerelle VoIP (UAC) doit utiliser le nom d'affichage Â«AnonymousÂ», par exemple, de: Â«AnonymousÂ» &lt;sip: 10000@10.172.0.2&gt;. <br><br><h3>  Ã€: </h3><br>  Ã€ - cet en-tÃªte indique le destinataire de la demande.  Il peut s'agir soit du destinataire final de l'appel, soit d'un lien intermÃ©diaire.  En gÃ©nÃ©ral, l'en-tÃªte contient un URI SIP, mais d'autres schÃ©mas sont possibles (voir RFC 2806 [9]).  Cependant, les URI SIP doivent Ãªtre pris en charge dans toutes les implÃ©mentations SIP, quel que soit le fabricant de l'Ã©quipement.  L'en-tÃªte To peut Ã©galement contenir un nom d'affichage Nom d'affichage, par exemple, To: Â«First Name Last NameÂ» &lt;sip: 101@10.172.0.2&gt;). <br><br>  En rÃ¨gle gÃ©nÃ©rale, le champ Ã€ contient un URI SIP indiquant le premier (suivant) proxy SIP qui traitera la demande.  Il n'est pas nÃ©cessaire que ce soit le destinataire final de la demande. <br><br><h3>  Contact: </h3><br>  Contact - l'en-tÃªte contient l'URI SIP, par lequel vous pouvez contacter l'expÃ©diteur de la demande INVITE.  Il s'agit d'un en-tÃªte obligatoire et ne doit contenir qu'un seul URI SIP.  Il fait partie d'une communication bidirectionnelle correspondant Ã  la demande SIP INVITE initiale.  Il est trÃ¨s important que l'en-tÃªte Contact contienne les informations correctes (y compris l'adresse IP) auxquelles l'expÃ©diteur de la demande attend une rÃ©ponse.  URI Contact est Ã©galement utilisÃ© dans d'autres communications, aprÃ¨s l'Ã©tablissement d'une session de communication. <br><br><h3>  Autoriser: </h3><br>  Autoriser - le champ contient une liste de paramÃ¨tres (mÃ©thodes SIP), sÃ©parÃ©s par une virgule.  Ils dÃ©crivent les fonctionnalitÃ©s du protocole SIP prises en charge par cet expÃ©diteur (pÃ©riphÃ©rique).  Liste complÃ¨te des mÃ©thodes: ACK, BYE, CANCEL, INFO, INVITE, NOTIFY, OPTIONS, PRACK, REFER, REFER, REGISTER, SUBSCRIBE, UPDATE.  D'autres mÃ©thodes SIP sont dÃ©crites <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455381/">https://habr.com/ru/post/fr455381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455371/index.html">Source de courant stable de 5 Î¼A Ã  20 mA</a></li>
<li><a href="../fr455373/index.html">Comment ajuster la loi du printemps pour qu'elle devienne porteuse pour les petits prestataires? L'annuler</a></li>
<li><a href="../fr455375/index.html">Ecrire UDR en Pascal</a></li>
<li><a href="../fr455377/index.html">Architecture IoT</a></li>
<li><a href="../fr455379/index.html">(Statique) SÃ©lection de conteneurs optimaux dans les programmes C ++</a></li>
<li><a href="../fr455387/index.html">Comprendre l'apprentissage automatique dans Elastic Stack (aka Elasticsearch, aka ELK)</a></li>
<li><a href="../fr455389/index.html">Haxe 4: Quoi de neuf?</a></li>
<li><a href="../fr455391/index.html">Partie 1: RISC-V / RocketChip dans un habitat non naturel</a></li>
<li><a href="../fr455393/index.html">Sur l'utilisation des mÃ©thodes paramÃ©triques d'estimation spectrale en radar - la mÃ©thode MUSIC. Ajout Ã  l'article</a></li>
<li><a href="../fr455397/index.html">Comment nous avons conÃ§u et mis en Å“uvre le nouveau rÃ©seau sur Huawei dans le bureau de Moscou, partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>