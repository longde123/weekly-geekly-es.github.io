<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏢 ✊🏿 🐤 Aktualisierungstoken hinzufügen 🚽 🐲 🧕🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In einem früheren Artikel habe ich über die Grundlagen von JWT . Wenn Sie an Ihren Fingern sind, dann ist dies nur der Schlüssel, mit dem wir die Tür ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aktualisierungstoken hinzufügen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466929/"><p><img src="https://habrastorage.org/webt/ri/mn/p_/rimnp_slilvwggqus7dvmlbnepu.jpeg"></p><br><p> In einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">früheren Artikel habe</a> ich über die Grundlagen von <code>JWT</code> .  Wenn Sie an Ihren Fingern sind, dann ist dies nur der Schlüssel, mit dem wir die Tür zu privaten Ressourcen öffnen.  Aber was ist, wenn dieser Schlüssel gestohlen wird (genauer gesagt, sie machen ein Duplikat).  Dann kann sich jemand anderes unter Ihrem Namen beim Server anmelden, und wir wissen möglicherweise nicht einmal davon.  Wir wollen ein solches Szenario nicht zulassen.  Aber was tun? </p><a name="habracut"></a><br><h2 id="povyshaem-bezopasnost">  Erhöhen Sie die Sicherheit </h2><br><p>  Ich empfehle den Lesern, bevor sie unabhängig weitermachen, darüber nachzudenken, was wir mit Sicherheit tun können. </p><br><p>  Hier sind einige Ansätze, die die Sicherheit verbessern können.  Sie können in den Kommentaren schreiben, welche anderen Ansätze existieren - ich werde sie hinzufügen. </p><br><ol><li>  Verwendung des <code>https</code> Protokolls, das den Datenkanal über das Internet schützt.  Tatsächlich ist dies ein Wrapper über <code>http</code> , der zusätzliche kryptografische Protokolle auferlegt - <code>SSL</code> und <code>TLS</code> </li><li>  Hinzufügen von <code>IP</code> Informationen zur <code>payload</code> .  Dann besteht das Token von anderen <code>IP</code> die Überprüfung nicht.  <code>IP</code> kann jedoch gefälscht werden und was mit dynamischen <code>IP</code> Adressen zu tun ist oder wenn ein Benutzer eine Verbindung von einem Telefon in einem Café oder einer U-Bahn herstellt.  Daher werden wir diesen Ansatz nicht verwenden. </li><li>  Verwenden Sie <code>RS256</code> .  Dies gewährleistet die Sicherheit des privaten Schlüssels.  Aber mit Token bleibt alles absolut so wie es war.  Wir benötigen <code>RS256</code> wenn wir Angst haben, den geheimen Schlüssel an andere Server weiterzugeben, was möglicherweise unzuverlässig ist.  Wir geben ihnen nur ein Token-Authentifizierungstool, das für einen Angreifer absolut nutzlos ist. </li><li>  Verwenden Sie kurzlebige Token.  Dann muss sich der Benutzer jedes Mal neu anmelden, wenn er abläuft.  Der Benutzer wird sich früher oder später langweilen und unsere Ressource verlassen. </li><li>  Aber was ist, wenn Sie ohnehin kurzlebige Token verwenden, aber einen anderen Token geben, dessen Zweck nur darin besteht, einen neuen kurzlebigen Token ohne neue Berechtigung zu erhalten?  Ein solches Token wird als Aktualisierungstoken bezeichnet und kann nur einmal verwendet werden.  Dies wird mein Artikel sein. </li></ol><br><h2 id="vspomnim-chto-takoe-jwt">  Erinnern Sie sich, was JWT ist </h2><br><p>  <code>JWT</code> nutzt die Codierungsansätze <code>JWS</code> (Signatur) und <code>JWE</code> (Verschlüsselung).  Die Signatur erlaubt es niemandem, ein Token ohne Informationen über den geheimen Schlüssel zu fälschen, und die Codierung schützt vor dem Lesen von Daten durch Dritte. </p><br><p>  Mal sehen, wie sie uns helfen können, den Benutzer auf der Site zu authentifizieren und zu autorisieren. </p><br><blockquote>  <strong>Authentifizierung</strong> (englische Authentifizierung; aus dem Griechischen. Αὐθεντικός [authentikos] - echt, authentisch; aus αὐθέντης [authentes] - der Autor) - Authentifizierungsverfahren.  In unserem Fall überprüfen wir das Login + Passwort auf Übereinstimmung mit dem Eintrag in der Datenbank der Benutzerdaten. <br><br>  <strong>Autorisierung</strong> (englische Autorisierung - Erlaubnis, Autorisierung) - dem Benutzer das Recht zu geben, bestimmte Aktionen auszuführen;  und auch das Überprüfen (Bestätigen) dieser Rechte beim Versuch, diese Aktionen auszuführen. <br><br>  Mit anderen Worten, die Authentifizierung überprüft die Rechtmäßigkeit des Benutzers. Wenn alles in Ordnung ist, wird der Benutzer autorisiert, dh er kann zulässige Aktionen mit der Datenbank ausführen.  Normalerweise werden diese beiden Prozesse kombiniert, und daher besteht eine bekannte Verwirrung. </blockquote><br><h2 id="vidy-tokenov">  Arten von Token </h2><br><ul><li>  <strong>Access Tokens (JWTs)</strong> sind Token, mit denen auf geschützte Ressourcen <strong>zugegriffen</strong> werden kann.  Sie sind <strong>kurzlebig</strong> , aber <strong>wiederverwendbar</strong> .  Sie können zusätzliche Informationen enthalten, z. B. die Lebensdauer oder die <code>IP</code> Adresse, von der die Anforderung stammt.  Es hängt alles vom Wunsch des Entwicklers ab. </li><li>  <strong>Refresh Token (RT)</strong> - Diese Token führen nur eine bestimmte Aufgabe aus und erhalten ein neues Zugriffstoken.  Und diesmal können Sie nicht auf einen Autorisierungsserver verzichten.  Sie sind <strong>langlebig</strong> , aber <strong>wegwerfbar</strong> . </li></ul><br><p>  Der Hauptanwendungsfall ist folgender: Sobald das alte <code>JWT</code> abläuft, können wir keine privaten Daten mehr damit empfangen, dann senden wir <code>RT</code> und wir erhalten ein neues Paar <code>JWT+RT</code> .  Mit dem neuen <code>JWT</code> wir uns wieder privaten Ressourcen zuwenden.  Natürlich kann ein Aktualisierungstoken auch schlecht werden, aber es wird nicht bald passieren, da er viel länger lebt als sein Bruder. </p><br><p><img src="https://habrastorage.org/webt/s7/q4/sm/s7q4smfprz_ktx6odq-vnqcb_pm.jpeg"></p><br><p>  Die Schlüsselidee der Token-Trennung besteht darin, dass Autorisierungstoken es uns <strong>einerseits</strong> ermöglichen, einen Benutzer ohne Autorisierungsserver einfach durch Vergleichen von Signaturen zu verifizieren. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> validateToken = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [ header, payload, signature ] = token.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> signature === HS256(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${header}</span></span></span><span class="hljs-string">.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${payload}</span></span></span><span class="hljs-string">`</span></span>, SECRET_KEY); }</code> </pre> <br><p>  <strong>Auf der anderen Seite</strong> haben wir eine <code></code> , mit der wir das Zugriffstoken aktualisieren können, ohne ein Kennwort vom Benutzer einzugeben. In diesem Fall müssen wir jedoch noch einen teuren Vorgang für den Zugriff auf den Autorisierungsserver ausführen. </p><br><h2 id="v-zaklyuchenie">  Abschließend </h2><br><p>  Dank dieses Ansatzes reduzieren wir die Zeitverzögerung für den Zugriff auf den <code>latency</code> und die Serverlogik selbst wird viel einfacher.  Und aus Sicherheitsgründen kann ein Zugriffstoken, das uns gestohlen wurde, nur von einer begrenzten Zeit verwendet werden - nicht mehr als seine Lebensdauer.  Damit ein Angreifer länger verwenden kann, muss er auch eine Aktualisierung stehlen, aber dann weiß der echte Benutzer, dass er gehackt wurde, weil er aus dem System geworfen wird.  Und sobald sich ein solcher Benutzer erneut anmeldet, erhält er ein aktualisiertes Paar <code>JWT+RT</code> , und die gestohlenen verwandeln sich in einen Kürbis. </p><br><h2 id="poleznye-ssylki">  Nützliche Links </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warum brauche ich ein Aktualisierungstoken, wenn ich ein Zugriffstoken habe?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Token aktualisieren: Wann werden sie verwendet und wie interagieren sie mit JWTs?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weitere OAuth 2.0-Überraschungen: Das Aktualisierungstoken</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466929/">https://habr.com/ru/post/de466929/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466915/index.html">So machen Sie SFINAE schlank und zuverlässig</a></li>
<li><a href="../de466917/index.html">Wenn der HTTP-Standard nicht ausreicht. Mikronaut begehen</a></li>
<li><a href="../de466921/index.html">5 Probleme eines Serviceunternehmens und deren Lösung mithilfe der Automatisierungsplattform</a></li>
<li><a href="../de466923/index.html">Wie IT-Profis in einer ausländischen Bank die Herkunft von Geldern nachweisen können</a></li>
<li><a href="../de466925/index.html">Wie man Hi-CPU VDS für Bitrix ausführt, Papageien zerstreut und nicht pleite geht</a></li>
<li><a href="../de466931/index.html">Leistungsoptimierung für .NET (C #) -Anwendungen</a></li>
<li><a href="../de466933/index.html">Wie man Freunde Industrie und Big Data macht</a></li>
<li><a href="../de466937/index.html">Wie wir die Allrussische Online-Olympiade in Englisch, Mathematik und Informatik durchführen</a></li>
<li><a href="../de466941/index.html">Warum liest Windows eine Datei hunderttausend Mal, um ein Menü zu öffnen?</a></li>
<li><a href="../de466949/index.html">Perspektiven für Quantennetzwerke: Wer engagiert sich dafür und warum?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>