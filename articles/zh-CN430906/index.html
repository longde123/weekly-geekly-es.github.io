<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘†ğŸ¿ ğŸ’¬ ğŸš¡ å¦ˆå¦ˆæ™šä¸Šå¹³é™åœ°å…¥ç¡-æˆ‘ä»¬ä¸ºRaspbian'aæ”¶é›†OpenCV ğŸ‘©ğŸ½â€ğŸ’» ğŸš´ğŸ¿ ãŠ™ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ€è¿‘å‡ å‘¨å¯¹æˆ‘ä»¬çš„å›¢é˜Ÿæ¥è¯´å¾ˆè‰°éš¾ã€‚ OpenCV 4å·²å‘å¸ƒ ï¼Œå¹¶ä¸ä¹‹ä¸€èµ·ä¸ºIntelçš„OpenVINOå·¥å…·åŒ… R4ï¼ˆåŒ…æ‹¬OpenCVï¼‰åšå‡†å¤‡ã€‚ æ‚¨å¯èƒ½è®¤ä¸ºï¼Œæˆ‘å·²ç»åˆ†æ•£äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä¼šåƒå¾€å¸¸ä¸€æ ·å…³æ³¨OpenCVè®ºå›å’Œç”¨æˆ·è¯„è®ºï¼Œåœ¨è¿™é‡Œæ‚¨å¯ä»¥è¯´OpenCVä¸æ˜¯ç‰©è”ç½‘ï¼Œåœ¨Raspberry Piä¸‹å®ƒè¶³ä»¥ç»„è£…-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦ˆå¦ˆæ™šä¸Šå¹³é™åœ°å…¥ç¡-æˆ‘ä»¬ä¸ºRaspbian'aæ”¶é›†OpenCV</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430906/"><p>æœ€è¿‘å‡ å‘¨å¯¹æˆ‘ä»¬çš„å›¢é˜Ÿæ¥è¯´å¾ˆè‰°éš¾ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenCV 4å·²å‘å¸ƒ</a> ï¼Œå¹¶ä¸ä¹‹ä¸€èµ·ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Intelçš„OpenVINOå·¥å…·åŒ…</a> R4ï¼ˆåŒ…æ‹¬OpenCVï¼‰åšå‡†å¤‡ã€‚ æ‚¨å¯èƒ½è®¤ä¸ºï¼Œæˆ‘å·²ç»åˆ†æ•£äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä¼šåƒå¾€å¸¸ä¸€æ ·å…³æ³¨OpenCVè®ºå›å’Œç”¨æˆ·è¯„è®ºï¼Œåœ¨è¿™é‡Œæ‚¨å¯ä»¥è¯´OpenCVä¸æ˜¯ç‰©è”ç½‘ï¼Œåœ¨Raspberry Piä¸‹å®ƒè¶³ä»¥ç»„è£…-æ²¡æœ‰è¶³å¤Ÿçš„ç„Šæ–™å¯ä¸€<code>make -j2</code>åœ°æŠ•å…¥<code>make -j2</code>å¦‚æœæ‚¨å¹¸è¿çš„è¯ï¼Œæ—©æ™¨å°†å‡†å¤‡å°±ç»ªã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘å»ºè®®æºæ‰‹åˆä½œï¼Œçœ‹çœ‹å¦‚ä½•ä¸ºä¸€ä¸ªè¿è¡Œåœ¨ARMå¤„ç†å™¨ä¸Šçš„32ä½æ“ä½œç³»ç»Ÿç»„è£…OpenCVåº“ï¼Œå¦‚ä½•ä½¿ç”¨å…·æœ‰å‡ºè‰²CPUæ¶æ„çš„64ä½OSè®¡ç®—æœºèµ„æºã€‚ <del> å·«æœ¯ </del> äº¤å‰ç¼–è¯‘ï¼Œå¦åˆ™ä¸ä¼šï¼ </p><a name="habracut"></a><br><h2 id="postanovka-zadachi"> é—®é¢˜é™ˆè¿° </h2><br><p> ç›´æ¥åœ¨æ¿ä¸Šè¿›è¡Œç¼–è¯‘ï¼ˆé€šå¸¸ç§°ä¸ºæœ¬åœ°ç¼–è¯‘ï¼‰ç¡®å®å¾ˆè´¹åŠ›ï¼Œå› æ­¤åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸€ç§æ„å»ºé¡¹ç›®çš„æ–¹æ³•ï¼Œè¯¥é¡¹ç›®å¯ä»¥ä½¿åŠŸèƒ½æ›´å¼ºå¤§çš„è®¡ç®—è®¾å¤‡ï¼ˆç§°ä¸ºä¸»æœºï¼‰ä¸ºå°äº²æˆšå‡†å¤‡äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è€Œä¸”ï¼Œä¸¤å°æœºå™¨å¯ä»¥å…·æœ‰ä¸åŒçš„CPUæ¶æ„ã€‚ è¿™æ˜¯äº¤å‰ç¼–è¯‘ã€‚ </p><br><p> å› æ­¤ï¼Œè¦å‡†å¤‡å¡æ»¡OpenCVçš„æ ‘è“æ´¾ï¼Œæˆ‘ä»¬éœ€è¦ï¼š </p><br><ul><li>  Ubuntu 16.04é•œåƒdockerå°¸ä½“ </li><li> ä¸»æœºæ¯”Raspberry Piæ›´å¼ºå¤§ï¼ˆå¦åˆ™ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œä¸æ˜¯å—ï¼Ÿï¼‰ </li><li> ç”¨äºARMhfçš„äº¤å‰ç¼–è¯‘å™¨ä»¥åŠç›¸åº”ä½“ç³»ç»“æ„çš„åº“ </li></ul><br><p> æ„å»ºOpenCVçš„æ•´ä¸ªè¿‡ç¨‹å°†åœ¨ä¸»æœºä¸Šè¿›è¡Œã€‚ æˆ‘åœ¨å®¶ä½¿ç”¨Ubuntuã€‚ ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„Linuxï¼Œåº”è¯¥ä¸ä¼šå‡ºç°æ’­æ”¾é—®é¢˜ã€‚ å¯¹äºWindowsç”¨æˆ·-æˆ‘è¡·å¿ƒå¸Œæœ›ä¸è¦æ”¾å¼ƒå¹¶å°è¯•è‡ªå·±è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ </p><br><h2 id="ustanovka-docker"> å®‰è£…Docker </h2><br><p> å¤§çº¦ä¸€å‘¨å‰ï¼Œæˆ‘å¼€å§‹ä¸dockerç»“è¯†ï¼Œå› æ­¤æ·»åŠ ç¾å‘³çš„é£Ÿç›å’Œè¯­æ³•ç³–ã€‚ å¯¹æ‚¨æˆ‘æ¥è¯´ï¼Œä¸‰ä¸ªè¦ç´ å°±è¶³å¤Ÿäº†-Dockerfileï¼Œæ˜ åƒå’Œå®¹å™¨çš„æ¦‚å¿µã€‚ </p><br><p>  Dockeræœ¬èº«æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå’Œå¤åˆ¶å…·æœ‰å¿…éœ€ç»„ä»¶é›†çš„ä»»ä½•æ“ä½œç³»ç»Ÿçš„é…ç½®çš„å·¥å…·ã€‚  Dockerfileæ˜¯é€šå¸¸åœ¨ä¸»æœºä¸Šä½¿ç”¨çš„ä¸€ç»„shellå‘½ä»¤ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½é€‚ç”¨äºæ‰€è°“çš„<code>docker</code>æ˜ åƒã€‚ </p><br><p> ä¸ºäº†å®‰è£…dockerï¼Œè¯·è€ƒè™‘æœ€ç®€å•çš„æ–¹æ³•ï¼šé€šè¿‡<code>apt-get</code>äº¤ä»˜æœåŠ¡è®¢è´­è½¯ä»¶åŒ…ï¼š </p><br><pre> <code class="bash hljs">sudo apt-get install -y docker.io</code> </pre> <br><p> æˆ‘ä»¬å°†ä¸ºdockerå®ˆæŠ¤ç¨‹åºæä¾›å®ƒæ‰€è¦æ±‚çš„ä¸€åˆ‡ï¼Œå¹¶ä»ç³»ç»Ÿæ³¨é”€ï¼ˆæ³¨æ„ç›¸åº”åœ°ç™»å½•ï¼‰ã€‚ </p><br><pre> <code class="bash hljs">sudo usermod -a -G docker <span class="hljs-variable"><span class="hljs-variable">$USER</span></span></code> </pre> <br><h2 id="podgotavlivaem-rabochee-prostranstvo"> å‡†å¤‡å·¥ä½œåŒº </h2><br><p> æœ€å¸¸è§çš„å‡†å¤‡å·¥ä½œæ˜¯Raspberry Piï¼ˆåœ¨æˆ‘çš„æƒ…å†µä¸‹ä¸ºRPI 2 Model Bï¼‰æ˜¯å¸¦æœ‰Raspbianï¼ˆåŸºäºDebianï¼‰æ“ä½œç³»ç»Ÿçš„ARMv7 CPUã€‚ æˆ‘ä»¬å°†åŸºäºUbuntu 16.04åˆ›å»ºä¸€ä¸ª<code>docker</code>æ˜ åƒï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬å°†æŠ¥å‘Šäº¤å‰ç¼–è¯‘å™¨ï¼Œå†›é˜Ÿåº“å¹¶åœ¨åŒä¸€ä½ç½®æ”¶é›†OpenCVã€‚ </p><br><p> åœ¨æˆ‘ä»¬çš„<code>Dockerfile</code>æ‰€åœ¨çš„ä½ç½®åˆ›å»ºä¸€ä¸ªçˆ¸çˆ¸ï¼š </p><br><pre> <code class="bash hljs">mkdir ubuntu16_armhf_opencv &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ubuntu16_armhf_opencv touch Dockerfile</code> </pre> <br><p> æ·»åŠ æœ‰å…³<code>apt-get</code>è½¯ä»¶åŒ…å®‰è£…ç¨‹åºçš„åŸºæœ¬æ“ä½œç³»ç»Ÿå’Œ<code>armhf</code>ä½“ç³»ç»“æ„çš„ä¿¡æ¯ï¼š </p><br><pre> <code class="plaintext hljs">FROM ubuntu:16.04 USER root RUN dpkg --add-architecture armhf RUN apt-get update</code> </pre> <br><p> è¯·æ³¨æ„ï¼Œè¯¸å¦‚<code>FROM ...</code> ï¼Œ <code>RUN ...</code>ç±»çš„å‘½ä»¤æ˜¯<code>Dockerfile</code>è¯­æ³•ï¼Œå¹¶å†™å…¥åˆ›å»ºçš„<code>Dockerfile</code>æµ‹è¯•æ–‡ä»¶ä¸­ã€‚ </p><br><p> è®©æˆ‘ä»¬å›åˆ°çˆ¶ç›®å½•<code>ubuntu16_armhf_opencv</code>å¹¶å°è¯•åˆ›å»ºæˆ‘ä»¬çš„<code>ubuntu16_armhf_opencv</code>é•œåƒï¼š </p><br><pre> <code class="bash hljs">docker image build ubuntu16_armhf_opencv</code> </pre> <br><p> åœ¨æ‰§è¡Œ<code>apt-get update</code>å‘½ä»¤æœŸé—´ï¼Œåº”å¯¼è‡´æ‚¨çœ‹åˆ°ä»¥ä¸‹ç±»å‹çš„<code>Err:[] [url] xenial[-] armhf Packages</code> </p><br><pre> <code class="bash hljs">Ign:30 http://archive.ubuntu.com/ubuntu xenial-backports/main armhf Packages Ign:32 http://archive.ubuntu.com/ubuntu xenial-backports/universe armhf Packages Err:7 http://archive.ubuntu.com/ubuntu xenial/main armhf Packages 404 Not Found Ign:9 http://archive.ubuntu.com/ubuntu xenial/restricted armhf Packages Ign:18 http://archive.ubuntu.com/ubuntu xenial/universe armhf Packages Ign:20 http://archive.ubuntu.com/ubuntu xenial/multiverse armhf Packages Err:22 http://archive.ubuntu.com/ubuntu xenial-updates/main armhf Packages 404 Not Found Ign:24 http://archive.ubuntu.com/ubuntu xenial-updates/restricted armhf Packages Ign:26 http://archive.ubuntu.com/ubuntu xenial-updates/universe armhf Packages Ign:28 http://archive.ubuntu.com/ubuntu xenial-updates/multiverse armhf Packages Err:30 http://archive.ubuntu.com/ubuntu xenial-backports/main armhf Packages 404 Not Found Ign:32 http://archive.ubuntu.com/ubuntu xenial-backports/universe armhf Packages</code> </pre> <br><p> å¦‚æœæŸ¥çœ‹æ–‡ä»¶<code>/etc/apt/sources.list</code>é‚£ä¹ˆæ¯ä¸ªè¿™æ ·çš„é”™è¯¯éƒ½å¯¹åº”<code>/etc/apt/sources.list</code>è¡Œï¼Œä¾‹å¦‚ï¼š </p><br><p>  <strong>å¤±è¯¯</strong> </p><br><pre> <code class="plaintext hljs">Err:22 http://archive.ubuntu.com/ubuntu xenial-updates/main armhf Packages 404 Not Found</code> </pre> <br><p>  <strong>åœ¨/etc/apt/sources.listä¸­çš„è¡Œ</strong> ï¼š </p><br><pre> <code class="plaintext hljs">deb http://archive.ubuntu.com/ubuntu/ xenial-updates main restricted</code> </pre> <br><p>  <strong>è§£å†³æ–¹æ¡ˆ</strong> ï¼š <br> åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š </p><br><pre> <code class="plaintext hljs">deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ xenial-updates main restricted deb [arch=armhf] http://ports.ubuntu.com/ubuntu-ports/ xenial-updates main restricted</code> </pre> <br><p> å› æ­¤ï¼Œæ‚¨å¿…é¡»æ›¿æ¢å‡ ä¸ªè½¯ä»¶åŒ…æºã€‚ åœ¨æˆ‘ä»¬çš„æ³Šåçª—ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ä¸€ä¸ªå‘½ä»¤å°†å®ƒä»¬å…¨éƒ¨æ›¿æ¢ï¼š </p><br><pre> <code class="plaintext hljs">RUN sed -i -E 's|^deb ([^ ]+) (.*)$|deb [arch=amd64] \1 \2\ndeb [arch=armhf] http://ports.ubuntu.com/ubuntu-ports/ \2|' /etc/apt/sources.list</code> </pre> <br><p> ç°åœ¨ï¼Œ <code>apt-get update</code>åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚ </p><br><h2 id="stavim-neobhodimye-pakety"> æˆ‘ä»¬æŠŠå¿…è¦çš„åŒ…è£¹ </h2><br><p> æˆ‘ä»¬éœ€è¦æä¾›ä¸»æœºåŒ…ï¼Œä¾‹å¦‚<code>git</code> ï¼Œ <code>python-pip</code> ï¼Œ <code>cmake</code>å’Œ<code>pkg-config</code>ä»¥åŠ<code>crossbuild-essential-armhf</code> ï¼Œè¿™æ˜¯ä¸€ç»„gcc / g ++äº¤å‰ç¼–è¯‘å™¨ï¼ˆ <code>arm-linux-gnueabihf-gcc</code>å’Œ<code>arm-linux-gnueabihf-g++</code> ï¼‰å’Œç›¸åº”æ¶æ„çš„ç³»ç»Ÿåº“ï¼š </p><br><pre> <code class="plaintext hljs">RUN apt-get install -y git python-pip cmake pkg-config crossbuild-essential-armhf</code> </pre> <br><p> ä»ä¸åŒå¯»å¸¸çš„åœ°æ–¹-æˆ‘ä»¬è¿˜ä¸‹è½½äº†GTKï¼ˆç”¨äºåœ¨highguiæ¨¡å—ä¸­ç»˜åˆ¶çª—å£ï¼‰ï¼ŒGStreamerå’ŒPythonï¼Œä½†æ˜ç¡®æŒ‡å‡ºäº†å¤–éƒ¨ä½“ç³»ç»“æ„ï¼š </p><br><pre> <code class="plaintext hljs">RUN apt-get install -y --no-install-recommends \ libgtk2.0-dev:armhf \ libpython-dev:armhf \ libgstreamer1.0-dev:armhf \ libgstreamer-plugins-base1.0-dev:armhf \ libgstreamer-plugins-good1.0-dev:armhf \ libgstreamer-plugins-bad1.0-dev:armhf</code> </pre> <br><p> ç„¶åæˆ‘ä»¬å…‹éš†å¹¶æ”¶é›†ï¼ŒæŒ‡ç¤ºå¿…è¦çš„æ ‡å¿—ï¼š </p><br><pre> <code class="plaintext hljs">RUN git clone https://github.com/opencv/opencv --depth 1 RUN mkdir opencv/build &amp;&amp; cd opencv/build &amp;&amp; \ export PKG_CONFIG_PATH=/usr/lib/arm-linux-gnueabihf/pkgconfig &amp;&amp; \ cmake -DCMAKE_BUILD_TYPE=Release \ -DOPENCV_CONFIG_INSTALL_PATH="cmake" \ -DCMAKE_TOOLCHAIN_FILE="../opencv/platforms/linux/arm-gnueabi.toolchain.cmake" \ -DWITH_IPP=OFF \ -DBUILD_TESTS=OFF \ -DBUILD_PERF_TESTS=OFF \ -DOPENCV_ENABLE_PKG_CONFIG=ON \ -DPYTHON2_INCLUDE_PATH="/usr/include/python2.7" \ -DPYTHON2_NUMPY_INCLUDE_DIRS="/usr/local/lib/python2.7/dist-packages/numpy/core/include" \ -DENABLE_NEON=ON \ -DCPU_BASELINE="NEON" ..</code> </pre> <br><p> åœ¨å“ªé‡Œ </p><br><ul><li><p>  <code>CMAKE_TOOLCHAIN_FILE</code>å®šä¹‰äº¤å‰ç¼–è¯‘è¿‡ç¨‹çš„cmakeæ–‡ä»¶çš„è·¯å¾„ï¼ˆè®¾ç½®æ‰€éœ€çš„ç¼–è¯‘å™¨ï¼Œé™åˆ¶ä½¿ç”¨ä¸»æœºåº“ã€‚ </p><br></li><li><p>  <code>WITH_IPP=OFF</code> ï¼Œ-ç¦ç”¨å¤§é‡ä¾èµ–ã€‚ </p><br></li><li><p>  <code>BUILD_TESTS=OFF</code> ï¼Œ <code>BUILD_PERF_TESTS=OFF</code> ï¼Œç¦ç”¨æµ‹è¯•ç‰ˆæœ¬ã€‚ </p><br></li><li><p>  <code>OPENCV_ENABLE_PKG_CONFIG=ON</code>è¿™æ ·pkg-configå¯ä»¥æ‰¾åˆ°ç±»ä¼¼GTKçš„ä¾èµ–é¡¹ã€‚  <code>PKG_CONFIG_PATH</code>æ˜¯<code>pkg-config</code>å°†åœ¨å…¶ä¸­æŸ¥æ‰¾åº“çš„æ­£ç¡®è·¯å¾„ã€‚ </p><br></li><li><p>  <code>PYTHON2_INCLUDE_PATH</code> ï¼Œ <code>PYTHON2_NUMPY_INCLUDE_DIRS</code>äº¤å‰ç¼–è¯‘python2åŒ…è£…å™¨æ‰€éœ€çš„è·¯å¾„ã€‚ </p><br></li><li><p>  <code>ENABLE_NEON=ON</code> ï¼Œ <code>CPU_BASELINE="NEON"</code> -å¯ç”¨NEONä¼˜åŒ–ã€‚ </p><br></li><li><p>  <code>OPENCV_CONFIG_INSTALL_PATH</code>è°ƒæ•´æ–‡ä»¶åœ¨<code>install</code>ç›®å½•ä¸­çš„ä½ç½®ã€‚ </p><br></li></ul><br><p>  <code>cmake</code>æ‰§è¡Œåï¼Œæ‚¨åº”æ³¨æ„çš„ä¸»è¦äº‹æƒ…æ˜¯æ‰€æœ‰å¿…éœ€çš„æ¨¡å—éƒ½å·²ç»„è£…ï¼ˆä¾‹å¦‚python2ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">-- OpenCV modules: -- To be built: calib3d core dnn features2d flann gapi highgui imgcodecs imgproc java_bindings_generator ml objdetect photo python2 python_bindings_generator stitching ts video videoio -- Disabled: world -- Disabled by dependency: - -- Unavailable: java js python3 -- Applications: tests perf_tests apps -- Documentation: NO -- Non-free algorithms: NO</code> </pre> <br><p> å¹¶æ‰¾åˆ°äº†å¿…è¦çš„ä¾èµ–é¡¹ï¼Œä¾‹å¦‚GTKï¼š </p><br><pre> <code class="plaintext hljs">-- GUI: -- GTK+: YES (ver 2.24.30) -- GThread : YES (ver 2.48.2) -- GtkGlExt: NO -- -- Video I/O: -- GStreamer: -- base: YES (ver 1.8.3) -- video: YES (ver 1.8.3) -- app: YES (ver 1.8.3) -- riff: YES (ver 1.8.3) -- pbutils: YES (ver 1.8.3) -- v4l/v4l2: linux/videodev2.h</code> </pre> <br><p> å‰©ä¸‹çš„å°±æ˜¯è°ƒç”¨<code>make</code> ï¼Œ <code>make install</code>å¹¶ç­‰å¾…æ„å»ºå®Œæˆï¼š </p><br><pre> <code class="plaintext hljs">Successfully built 4dae6b1a7d32</code> </pre> <br><p> ä½¿ç”¨æ­¤å›¾åƒ<code>id</code>æ ‡è®°å¹¶åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼š </p><br><pre> <code class="plaintext hljs">docker tag 4dae6b1a7d32 ubuntu16_armhf_opencv:latest docker run ubuntu16_armhf_opencv</code> </pre> <br><p> æˆ‘ä»¬åªéœ€è¦ä»å®¹å™¨ä¸­æŠ½å‡ºç»„è£…å¥½çš„OpenCVã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åˆ›å»ºçš„å®¹å™¨çš„æ ‡è¯†ç¬¦ï¼š </p><br><pre> <code class="plaintext hljs">$ docker container ls --all CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES e94667fe60d2 ubuntu16_armhf_opencv "/bin/bash" 6 seconds ago Exited (0) 5 seconds ago clever_yalow</code> </pre> <br><p> å¹¶å¤åˆ¶å·²å®‰è£…OpenCVçš„å®‰è£…ç›®å½•ï¼š </p><br><pre> <code class="plaintext hljs">docker cp e94667fe60d2:/opencv/build/install/ ./ mv install ocv_install</code> </pre> <br><h2 id="nakryvaem-na-stol"> æ‘†æ¡Œå­ </h2><br><p> å°†<code>ocv_install</code>å¤åˆ¶åˆ°Raspberry Piï¼Œè®¾ç½®è·¯å¾„å¹¶å°è¯•ä»pythonè¿è¡ŒOpenCVã€‚ </p><br><pre> <code class="plaintext hljs">export LD_LIBRARY_PATH=/path/to/ocv_install/lib/:$LD_LIBRARY_PATH export PYTHONPATH=/path/to/ocv_install/python/:$PYTHONPATH</code> </pre> <br><p> ä½¿ç”¨æ¥è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/chuanqi305/MobileNet-SSD</a>çš„MobileNet-SSDç¥ç»ç½‘ç»œè¿è¡Œæ£€æµ‹ç¤ºä¾‹ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cv <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> cv.__file__ classes = [<span class="hljs-string"><span class="hljs-string">'backgroud'</span></span>, <span class="hljs-string"><span class="hljs-string">'aeroplane'</span></span>, <span class="hljs-string"><span class="hljs-string">'bicycle'</span></span>, <span class="hljs-string"><span class="hljs-string">'bird'</span></span>, <span class="hljs-string"><span class="hljs-string">'boat'</span></span>, <span class="hljs-string"><span class="hljs-string">'bottle'</span></span>, <span class="hljs-string"><span class="hljs-string">'bus'</span></span>, <span class="hljs-string"><span class="hljs-string">'car'</span></span>, <span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-string"><span class="hljs-string">'chair'</span></span>, <span class="hljs-string"><span class="hljs-string">'cow'</span></span>, <span class="hljs-string"><span class="hljs-string">'diningtable'</span></span>, <span class="hljs-string"><span class="hljs-string">'dog'</span></span>, <span class="hljs-string"><span class="hljs-string">'horse'</span></span>, <span class="hljs-string"><span class="hljs-string">'motorbike'</span></span>, <span class="hljs-string"><span class="hljs-string">'person'</span></span>, <span class="hljs-string"><span class="hljs-string">'pottedplant'</span></span>, <span class="hljs-string"><span class="hljs-string">'sheep'</span></span>, <span class="hljs-string"><span class="hljs-string">'sofa'</span></span>, <span class="hljs-string"><span class="hljs-string">'train'</span></span>, <span class="hljs-string"><span class="hljs-string">'tvmonitor'</span></span>] cap = cv.VideoCapture(<span class="hljs-number"><span class="hljs-number">0</span></span>) net = cv.dnn.readNet(<span class="hljs-string"><span class="hljs-string">'MobileNetSSD_deploy.caffemodel'</span></span>, <span class="hljs-string"><span class="hljs-string">'MobileNetSSD_deploy.prototxt'</span></span>) cv.namedWindow(<span class="hljs-string"><span class="hljs-string">'Object detection'</span></span>, cv.WINDOW_NORMAL) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> cv.waitKey(<span class="hljs-number"><span class="hljs-number">1</span></span>) != <span class="hljs-number"><span class="hljs-number">27</span></span>: hasFrame, frame = cap.read() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> hasFrame: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> frame_height, frame_width = frame.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], frame.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>] blob = cv.dnn.blobFromImage(frame, scalefactor=<span class="hljs-number"><span class="hljs-number">0.007843</span></span>, size=(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>), mean=(<span class="hljs-number"><span class="hljs-number">127.5</span></span>, <span class="hljs-number"><span class="hljs-number">127.5</span></span>, <span class="hljs-number"><span class="hljs-number">127.5</span></span>)) net.setInput(blob) out = net.forward() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> detection <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> out.reshape(<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>): classId = int(detection[<span class="hljs-number"><span class="hljs-number">1</span></span>]) confidence = float(detection[<span class="hljs-number"><span class="hljs-number">2</span></span>]) xmin = int(detection[<span class="hljs-number"><span class="hljs-number">3</span></span>] * frame_width) ymin = int(detection[<span class="hljs-number"><span class="hljs-number">4</span></span>] * frame_height) xmax = int(detection[<span class="hljs-number"><span class="hljs-number">5</span></span>] * frame_width) ymax = int(detection[<span class="hljs-number"><span class="hljs-number">6</span></span>] * frame_height) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidence &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span>: cv.rectangle(frame, (xmin, ymin), (xmax, ymax), color=(<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>), thickness=<span class="hljs-number"><span class="hljs-number">3</span></span>) label = <span class="hljs-string"><span class="hljs-string">'%s: %.2f'</span></span> % (classes[classId], confidence) labelSize, baseLine = cv.getTextSize(label, cv.FONT_HERSHEY_SIMPLEX, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) ymin = max(ymin, labelSize[<span class="hljs-number"><span class="hljs-number">1</span></span>]) cv.rectangle(frame, (xmin, ymin - labelSize[<span class="hljs-number"><span class="hljs-number">1</span></span>]), (xmin + labelSize[<span class="hljs-number"><span class="hljs-number">0</span></span>], ymin + baseLine), (<span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>), cv.FILLED) cv.putText(frame, label, (xmin, ymin), cv.FONT_HERSHEY_SIMPLEX, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) cv.imshow(<span class="hljs-string"><span class="hljs-string">'Object detection'</span></span>, frame)</code> </pre> <br><p><img src="https://habrastorage.org/webt/1h/sd/0m/1hsd0mmmse6gslxx169tw4lc2wu.png"></p><br><p> å¦‚æ­¤ä¸€æ¥ï¼Œä¸€æ¬¡å®Œæ•´çš„ç»„è£…å°±ä¸ä¼šè¶…è¿‡20åˆ†é’Ÿã€‚ æˆ‘å°†<code>Dockerfile</code>çš„æœ€ç»ˆç‰ˆæœ¬<code>Dockerfile</code>ä¸‹é¢ï¼Œå¹¶å€Ÿæ­¤æœºä¼šï¼Œæˆ‘å»ºè®®å¯¹æ›¾ç»ä½¿ç”¨è¯¥åº“çš„äººè¿›è¡ŒOpenCVå›¢é˜Ÿçš„ç®€çŸ­è°ƒæŸ¥ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//opencv.org/survey-2018.html</a> ã€‚ </p><br><p> æ˜¯çš„ï¼Œæ­å–œæ‚¨ä½¿ç”¨OpenCV 4ï¼ è¿™ä¸ä»…æ˜¯ä¸€ä¸ªå•ç‹¬å›¢é˜Ÿçš„å·¥ä½œï¼Œè€Œä¸”æ˜¯æ•´ä¸ªç¤¾åŒºçš„å·¥ä½œ-OpenCV 4æ‚¨ã€‚ </p><br><pre> <code class="plaintext hljs">FROM ubuntu:16.04 USER root RUN dpkg --add-architecture armhf RUN sed -i -E 's|^deb ([^ ]+) (.*)$|deb [arch=amd64] \1 \2\ndeb [arch=armhf] http://ports.ubuntu.com/ubuntu-ports/ \2|' /etc/apt/sources.list RUN apt-get update &amp;&amp; \ apt-get install -y --no-install-recommends \ cmake \ pkg-config \ crossbuild-essential-armhf \ git \ python-pip \ libgtk2.0-dev:armhf \ libpython-dev:armhf \ libgstreamer1.0-dev:armhf \ libgstreamer-plugins-base1.0-dev:armhf \ libgstreamer-plugins-good1.0-dev:armhf \ libgstreamer-plugins-bad1.0-dev:armhf RUN pip install numpy==1.12.1 RUN git clone https://github.com/opencv/opencv --depth 1 RUN mkdir opencv/build &amp;&amp; cd opencv/build &amp;&amp; \ export PKG_CONFIG_PATH=/usr/lib/arm-linux-gnueabihf/pkgconfig &amp;&amp; \ cmake -DCMAKE_BUILD_TYPE=Release \ -DOPENCV_CONFIG_INSTALL_PATH="cmake" \ -DCMAKE_TOOLCHAIN_FILE="../opencv/platforms/linux/arm-gnueabi.toolchain.cmake" \ -DWITH_IPP=OFF \ -DBUILD_TESTS=OFF \ -DBUILD_PERF_TESTS=OFF \ -DOPENCV_ENABLE_PKG_CONFIG=ON \ -DPYTHON2_INCLUDE_PATH="/usr/include/python2.7" \ -DPYTHON2_NUMPY_INCLUDE_DIRS="/usr/local/lib/python2.7/dist-packages/numpy/core/include" \ -DENABLE_NEON=ON \ -DCPU_BASELINE="NEON" .. &amp;&amp; make -j4 &amp;&amp; make install</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN430906/">https://habr.com/ru/post/zh-CN430906/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN430892/index.html">è·¨å¹³å°å’Œæœ¬æœºæ–¹æ³•åœ¨ç§»åŠ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­çš„ç»“åˆ</a></li>
<li><a href="../zh-CN430894/index.html">æƒ…å†µï¼šå“ç‰Œåœ¨æ’­å®¢å¹¿å‘Šä¸ŠèŠ±è´¹è¶Šæ¥è¶Šå¤šçš„é’±-æˆ‘ä»¬ç†è§£ä¸ºä»€ä¹ˆ</a></li>
<li><a href="../zh-CN430896/index.html">Linux Foundationå·²ä¸ºGraphQLå’ŒCephå»ºç«‹äº†èµ„é‡‘-ä¸ºä»€ä¹ˆéœ€è¦å®ƒä»¬ï¼Œä»¥åŠå¯¹å®ƒä»¬çš„æœŸæœ›</a></li>
<li><a href="../zh-CN430900/index.html">å†å²ä¸Šçš„ç¬¬ä¸€å°æ¿€å…‰ï¼šé‚£æ˜¯ä»€ä¹ˆ</a></li>
<li><a href="../zh-CN430902/index.html">ç²¾çµåœ¨è®°å¿†ä¸­ã€‚ åœ¨Linux RAMä¸­è¿è¡ŒELF</a></li>
<li><a href="../zh-CN430908/index.html">åŠŸç‡è½¬æ¢å™¨æ§åˆ¶æ¨¡å—ï¼šå¼€å‘å’Œç»„è£…</a></li>
<li><a href="../zh-CN430910/index.html">å¯Œå¸ƒèµ–ç‰¹å¥–å­¦é‡‘ï¼šå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN430912/index.html">æˆ‘ä»¬ç»™éª—å­å¸¦æ¥å¹²å‡€çš„æ°´ï¼šé¢è¯•ä¸æ˜¯é›‡ä½£å…³ç³»ã€‚ è‡ªç„¶åœ°</a></li>
<li><a href="../zh-CN430914/index.html">é»‘å¸‚ä»·æ ¼åˆ†æçš„ä¸ªäººæ•°æ®å’Œçªç ´</a></li>
<li><a href="../zh-CN430916/index.html">äºŒæ°§åŒ–ç¢³æ£€æµ‹ä»ªMT8057Sã€‚ ç”±éä»¿çœŸè€…å‚ä¸çš„éå®¡æŸ¥</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>