<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš ğŸï¸ ğŸ”¡ 7 hari, 15 insinyur dan 600 server: Yandex.Money pindah ke pusat data baru ğŸ–•ğŸ½ ğŸ‘ ğŸ‘ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini, sebuah peristiwa penting terjadi di Departemen Operasi Yandex.Money. Perusahaan kami berkembang pesat, dan ternyata bukan hanya hati ka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>7 hari, 15 insinyur dan 600 server: Yandex.Money pindah ke pusat data baru</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/481340/"><img src="https://habrastorage.org/webt/_d/ye/aq/_dyeaqhvhl5sh0awhpgw7t70b38.jpeg"><br><br>  Baru-baru ini, sebuah peristiwa penting terjadi di Departemen Operasi Yandex.Money.  Perusahaan kami berkembang pesat, dan ternyata bukan hanya hati kami, tetapi juga permintaan pusat data berubah.  Lebih tepatnya, lokasi perlu diubah.  Dan sekarang selama tiga bulan, karena salah satu pusat data tinggal di tempat baru. <br><br>  Tentang bagaimana Yandex.Money pindah ke pusat data baru, saya akan memberitahu Anda, kepala departemen operasi, dan Ivan, kepala infrastruktur TI dan departemen sistem internal. <br><br>  Di bawah cut - kronologi peristiwa, tonggak penting dari langkah ini, belokan tak terduga dan tanya jawab.  Kami berbagi bagaimana kami selamat dari ini. <br><a name="habracut"></a><br><h2>  Prasyarat untuk relokasi </h2><br>  Sebelumnya, salah satu pusat data Yandex.Money terletak di pinggiran kota Moskow.  Kenyataannya adalah bahwa di luar kota, tidak semua penyedia saluran komunikasi optik memiliki kemampuan untuk secara mandiri meletakkan rute kabel - harganya mahal.  Dan alasan pertama keputusan kami untuk pindah adalah karena fakta bahwa di pusat data lama saluran komunikasi melewati rute yang sama, dan ini membawa risiko tambahan. <br><blockquote> Di dalam Ring Road Moskow ada banyak penyedia, dan sistem kabel berkembang dengan baik.  Anda dapat membeli saluran dari penyedia yang berbeda dengan cara yang berbeda dan tidak tumpang tindih.  Ada peningkatan risiko di wilayah tersebut - misalnya, ekskavator akan datang dan menggali semua lintasan sekaligus. </blockquote><br>  Kedua, pusat data sebelumnya memiliki keterbatasan teknologi, termasuk secara berkala kami mengalami masalah pasokan daya. <br><br>  Tetapi alasan utama (= rasa sakit) adalah ketidakmampuan untuk berkembang.  Ini berarti bahwa bangunan kehabisan ruang untuk rak tambahan, di mana dimungkinkan untuk menempatkan peralatan baru.  Ini berhubungan langsung dengan lingkungan produktif kita, karena Yandex.Money memiliki dua pusat data dan mereka harus simetris dalam hal kapasitas. <br><br><h2>  Perencanaan </h2><br>  Persiapan untuk langkah ini dibagi menjadi beberapa tahap: <br><br><ul><li>  Kompetisi: DC, saluran, jaringan, rak, PDU, kabel; </li><li>  Mentransfer aplikasi dan basis data ke DC ke-2; </li><li>  Ajaran - menonaktifkan DC; </li><li>  Arsitektur baru jaringan inti, IX; </li><li>  Menyiapkan inti jaringan baru di DC. </li></ul><br><br><h4>  Seleksi Pemasok </h4><br>  Pusat data Yandex.Money pertama terletak di Moskow.  Dan untuk menghindari keterlambatan jaringan yang besar, kami memutuskan untuk menempatkan pusat data kedua di dekat yang pertama. <br><blockquote>  Dalam MKAD untuk meminimalkan penundaan jaringan dan tidak lebih dekat dari 20 km ke fasilitas pertama untuk memastikan independensi kedua pusat data dari infrastruktur perkotaan yang sama dan kemungkinan bencana teknologi atau bencana alam. </blockquote><br>  Saat menganalisis pasar, kami dipandu oleh kriteria penting seperti sertifikasi pusat data dalam hal ketersediaan dan keandalan.  Standar paling umum di Rusia dan dunia adalah standar yang dikembangkan oleh Uptime Institute, yang mengaudit pusat data di seluruh dunia.  Perlu dicatat bahwa ada banyak pusat data yang hanya mensertifikasi dokumentasi proyek, tetapi ini tidak berarti bahwa pusat data itu sendiri dibangun, diuji, dan dioperasikan sesuai dengan standar. <br><blockquote>  Sebuah contoh dari praktik kami: satu penyedia layanan pusat data di Moskow mengumumkan kepada kami bahwa proyek pusat data memenuhi standar Tier III dan menawarkan untuk menyimpulkan perjanjian dengan janji ketersediaan 100%, yaitu, 0 menit downtime per tahun!  Setelah secara pribadi mengunjungi situs, kami menyadari bahwa tidak ada sertifikasi resmi yang menjamin tingkat kualitas, dan infrastruktur jelas tidak mengacu pada Tier III.  Pusat data terletak di lantai dasar sebuah bangunan tempat tinggal, dan satu-satunya trailer-generator berdiri di jalan tanpa perlindungan fisik. </blockquote><br>  Oleh karena itu, dalam persyaratan untuk kompetisi, kami memasukkan tidak hanya sertifikasi proyek, tetapi juga sertifikasi proses implementasi dan manajemen. <br><br>  Selanjutnya, kami menentukan dengan pemasok saluran komunikasi optik antara DC kami dan saluran ke titik pertukaran lalu lintas (IX) di mana kami mengatur antarmuka dengan penyedia atau mitra kami.  Kriteria utama adalah bahwa saluran komunikasi optik harus independen, mengikuti rute yang berbeda. <br><br>  Dan, tentu saja, ada pembelian lain - terutama peralatan jaringan, rak (lemari khusus untuk memasang server), unit distribusi daya (unit distribusi daya cerdas), serta kabel dan kabel patch. <br><br>  Perlu dicatat bahwa kami secara khusus memilih pemasok yang akan mengangkut peralatan.  Penting bahwa perusahaan memiliki pengalaman dalam mengangkut server, dan pemindah mengerti bahwa ini bukan furnitur dan beban, dan Anda juga harus sangat berhati-hati saat mengemudi.  Selain itu, kami mengasuransikan peralatan yang diangkut jika terjadi kerusakan selama transportasi. <br><br><h4>  Peningkatan Infrastruktur Jaringan </h4><br>  Mengenai infrastruktur jaringan, kami memiliki dua opsi.  Yang pertama adalah untuk mengangkut peralatan jaringan lama "apa adanya".  Yang kedua adalah pertama membangun infrastruktur jaringan baru di pusat data baru dan hanya kemudian mengangkut peralatan server. <br><br>  Karena kami memahami bahwa kami telah "beristirahat" pada bandwidth jaringan di pusat data lama dan kami membutuhkan cadangan dan kemampuan untuk menskalakan setidaknya 3-5 tahun ke depan, diputuskan untuk membangun infrastruktur jaringan di pusat data baru dari awal dan meningkatkan ke generasi baru peralatan . <br><br>  Kami berpegang pada model klasik ketika membangun jaringan di pusat data baru.  Di setiap rak, server terhubung ke dua sakelar akses, yang, pada gilirannya, terhubung ke sakelar agregasi pusat (mereka juga merupakan inti dari jaringan). <br><br><img src="https://habrastorage.org/webt/wt/hw/mq/wthwmq0qnhd8bajvhxsu8fhzode.png"><br><br><h4>  Ajaran </h4><br>  Saat bergerak, kami memutuskan untuk benar-benar mematikan pusat data, pada suatu waktu untuk mengangkut semuanya dan menyalakannya di tempat baru.  Untuk ini, perusahaan harus belajar bagaimana melakukannya tanpa salah satu dari dua pusat data.  Untuk itu diperlukan partisipasi dari hampir semua administrator kami agar sistem informasi pada platform yang berbeda, pada sistem operasi yang berbeda, dengan basis data yang berbeda untuk bekerja tanpa gangguan di situs yang tersisa. <br><blockquote>  Untuk layanan paling kritis, disediakan cadangan yang tetap tersedia meskipun satu pusat data dimatikan. </blockquote><br>  Setelah melakukan pekerjaan reservasi, latihan dimulai.  Pertama, kami memutuskan jaringan individual, segmen, dan hanya kemudian pusat data sepenuhnya.  Pada tahun 2019, kami melakukan uji penutupan pusat data 10 kali - kami mengamati bagaimana 300 sistem informasi kami berperilaku.  Berkali-kali memeriksa otonomi, kami yakin bahwa kami dapat dengan mudah memutus hubungan. <br><br>  Dan kemudian ... <br><br><h2>  Minggu X </h2><br>  Salah satu hari Jumat dijadwalkan untuk mematikan semua peralatan di pusat data - rilis terbaru diluncurkan di pagi hari, dan kemudian moratorium diumumkan pada mereka. <br><blockquote>  Yandex.Money dapat memiliki 60 atau lebih rilis per hari, dan semuanya dilakukan di kedua pusat data. </blockquote><br>  Kami menghentikan rilis, memastikan bahwa sistem bekerja dengan stabil dan tidak ada perbaikan yang diperlukan dalam komponen kami.  Mulai dari 15:00, mereka mulai secara bertahap memadamkan semua aplikasi, database, dan server.  Pada malam hari dari Jumat hingga Sabtu, kami menunggu waktu, kami yakin bahwa tidak ada hal buruk yang terjadi, yang berarti kami dapat pergi.  Pada Sabtu pagi, tim yang terdiri dari 15 orang mulai membongkar peralatan dan mengangkutnya ke pusat data baru. <br><br><img src="https://habrastorage.org/webt/aw/hb/oe/awhboefkhxui5klua789j7ec3nm.png"><br><br>  Kami butuh sepanjang hari Sabtu untuk membongkar dan mengangkut peralatan.  Selanjutnya, proses pemasangan peralatan, switching, menghubungkannya ke catu daya dimulai. <br><br><img src="https://habrastorage.org/webt/ry/uz/h4/ryuzh4vxihy3vqokvj_ex2_-oam.png"><br><br>  Pada Sabtu malam, kami memasang dan menghubungkan batch server pertama.  Pekerjaan utama dimulai pada hari Minggu - menjelang malam akhir pekan hampir semua peralatan dipasang.  Dan kami menyelesaikan pergantian hanya pada hari Senin malam. <br><br><img src="https://habrastorage.org/webt/bp/hz/ci/bphzci1xww3exwjgcnddnyhxvku.png"><br><br>  Pada hari Selasa pagi, kami melakukan pengujian akhir jaringan, saluran komunikasi dan siap untuk meningkatkan sistem kami.  Mereka mulai meningkatkan batch server pertama, tetapi ada yang salah ... <br><br>  Kami mulai menerima keluhan massal dari administrator bahwa jaringan tidak berfungsi di server: baik sepenuhnya, atau salah satu dari dua antarmuka.  Mereka mulai mencari masalah di sisi peralatan jaringan, dalam sistem operasi, dalam pengaturan sistem operasi. <br><br>  Gejalanya mirip - mereka mulai melihat apa yang bisa menjadi alasannya.  Kami perhatikan bahwa lebih baik memindahkan tali tambalan di sebelah port sakelar lebih keras dan beberapa tautan yang berfungsi keluar. <br><br><img src="https://habrastorage.org/webt/r-/l8/mx/r-l8mxy3b8vndwvgcxu_572lfny.gif"><br><br>  Setelah menemukan ini, kami menyadari bahwa sebagian besar dari kabel patch ini (sekitar 40% dari 2.000 keping) rusak.  Kami memindahkan semua kabel patch yang tersedia dari pabrikan tepercaya lainnya ke pusat data baru dan segera mulai menyambung kembali server yang paling kritis.  Butuh satu hari lagi. <br><br>  Dari Rabu malam pada Kamis pagi, tim mulai mengangkat blok utama sistem informasi. <br><br>  Setelah kami meningkatkan layanan kritis dan meluncurkan cadangan sistem pembayaran, kami memasukkan bagian dari tribun uji pusat data baru dan cadangan sistem backoffice sehingga semua sistem internal kami bekerja dengan dua pusat data.  Pada akhir minggu, hampir seluruh infrastruktur TI dari pusat data yang diangkut diluncurkan. <br><br>  Awalnya, ada rencana selama 5 hari, tetapi dengan situasi darurat terkait dengan kabel patch yang rusak, ternyata menjadi seminggu.  Di bawah ini kami telah dengan jelas menggambarkan garis waktu tindakan kami. <br><br>  <b>Rencana Relokasi - Tertunda:</b> <br><br><ul><li>  Jumat - kami memadamkan jaringan dan aplikasi; </li><li>  Sabtu - kami membawa dan memulai perakitan; </li><li>  Minggu - instalasi server, peluncuran jaringan; </li><li>  Senin - kami menyelesaikan jaringan, meluncurkan aplikasi; </li><li>  Selasa - nyalakan semuanya. </li></ul><br><br>  <b>Realitas:</b> <br><br><ul><li>  Jumat - kami memadamkan jaringan dan aplikasi; </li><li>  Sabtu - kami membawa dan memulai perakitan; </li><li>  Minggu - instalasi server, peluncuran jaringan; </li><li>  <font color="red">Senin - pemasangan kabel, peluncuran jaringan;</font> </li><li>  Selasa - nyalakan server, <font color="red">100+ tidak berfungsi;</font> </li><li>  Rabu - <font color="red">perkawinan kabel, penggantian</font> , peluncuran Aplikasi dan DB; </li><li>  Kamis - selesai penggantian untuk PS, luncurkan Aplikasi. </li></ul><br><br><h2>  Kehidupan setelah bergerak </h2><br>  <b>Apa yang kita dapat dari bergerak?</b> <br>  Pertama-tama, kedua pusat data kami sekarang adalah tingkat Lembaga Uptime Tier III.  Pemasok pusat data menjamin tingkat ketersediaan Waktu Kerja 99.982%, yang berarti 1,6 jam waktu henti per tahun.  Kami yakin dengan keandalan saluran komunikasi antara situs kami.  Juga sekarang tidak ada batasan untuk memperluas infrastruktur IT kami. <br><br>  Gagasan untuk pindah memberi kami peluang besar untuk meningkatkan peralatan jaringan dalam hal bandwidth.  Kami juga refactored catu daya di rak - diinstal "smart PDUs", server daya cadangan. <br><br>  Dan ketika kami bergerak, kami dapat "menyisir" switching, dan sekarang terlihat lebih rapi. <br><br><img src="https://habrastorage.org/webt/si/er/bg/sierbgikqjvev60m0geubzlxjr0.png"><br><br>  Oleh karena itu, secara umum, sistem mulai bekerja lebih stabil, dan pelanggan kami menerima layanan yang lebih baik. <br><br>  <b>Kesimpulan apa yang telah Anda buat untuk diri Anda sendiri?</b> <br>  Saat melakukan proyek besar, Anda perlu memikirkan risiko, bayangkan jebakan apa yang bisa terjadi.  Contoh kami dengan kabel Ethernet menunjukkan bahwa tidak cukup untuk melakukan tes pembelian dan menguji produk kabel dari produsen yang dipilih.  Untuk mengurangi risiko, perlu dilakukan pengujian acak terhadap 2.000 kabel. <br><br>  Perlu juga dipertimbangkan bahwa beberapa server mungkin tidak dapat bertahan dan hanya tidak aktif karena berbagai alasan.  Dengan satu atau lain cara, jalannya bergetar dan tekanan mekanis.  Dari 600 unit peralatan yang diangkut, 6 blok rusak.  Dari jumlah server yang cukup besar, hanya 1% yang menderita, tidak satu disk pun mengalami crash - kami percaya ini adalah hasil yang sangat baik. <br><br><hr><br>  Begitulah pusat data Yandex.Money pindah ke tempat baru.  Kami berharap pengalaman kami akan membantu Anda menghindari kemungkinan kesalahan dan, mungkin, akan mengarahkan Anda ke solusi menarik lainnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481340/">https://habr.com/ru/post/id481340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481330/index.html">Yang ketiga tidak berlebihan: bagaimana kami mengurangi rantai daftar produk dengan menambahkan tautan lain ke dalamnya</a></li>
<li><a href="../id481332/index.html">Pengumuman buku "Pembelajaran Mesin Tanpa Kata-Kata Tambahan"</a></li>
<li><a href="../id481334/index.html">Tugas nomor 2. Penentuan struktur populasi</a></li>
<li><a href="../id481336/index.html">Bagaimana orang dilacak oleh kumpulan data "anonim"</a></li>
<li><a href="../id481338/index.html">Memanfaatkan kerentanan xss</a></li>
<li><a href="../id481342/index.html">Polling Jumat: Berbicara Tentang Bahasa</a></li>
<li><a href="../id481344/index.html">Rencana Tim Platform IntelliJ untuk 2020</a></li>
<li><a href="../id481346/index.html">5 perubahan besar dalam industri otomotif</a></li>
<li><a href="../id481348/index.html">Direktori Aktif Pentest. Bagian 1</a></li>
<li><a href="../id481350/index.html">Siapa yang bekerja di kosmodrom Plesetsk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>