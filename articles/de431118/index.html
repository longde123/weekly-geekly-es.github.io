<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽 📑 ♏️ Die ganze Wahrheit über RTOS. Artikel 22. Postfächer: Nebendienstleistungen und Datenstrukturen 🌧️ 🧘🏾 👌🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel setzt die Überprüfung der Postfächer fort, die im vorherigen Artikel in der Reihe „Die Wahrheit über RTOS“ begonnen haben. 

 Frühere A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die ganze Wahrheit über RTOS. Artikel 22. Postfächer: Nebendienstleistungen und Datenstrukturen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431118/"><img src="https://habrastorage.org/webt/j-/7m/ne/j-7mne20kyhq0wia5-mxp4lotsq.jpeg"><br><br>  Dieser Artikel setzt die Überprüfung der Postfächer fort, die im vorherigen Artikel in der Reihe „Die Wahrheit über RTOS“ begonnen haben. <br><a name="habracut"></a><br>  Frühere Artikel in der Reihe: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Postfächer: Einführung und Basisdienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Semaphoren: Nebendienstleistungen und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Semaphoren: Einführung und Grundversorgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ereignisflag-Gruppen: Hilfsdienste und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ereignisflag-Gruppen: Einführung und Basisdienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Signale</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherpartitionen: Dienste und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherbereiche: Einführung und Grundversorgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgabendatenstrukturen und nicht unterstützte API-Aufrufe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienstleistungen für die Arbeit mit Aufgaben</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben: Konfiguration und Einführung in die API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scheduler: Erweiterte Funktionen und Kontexterhaltung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scheduler: Implementierung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nucleus SE: Internes Design und Bereitstellung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nucleus SE: Einführung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Andere RTOS-Dienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgabeninteraktion und Synchronisation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben, Kontextwechsel und Interrupts</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben und Planung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTOS: Struktur und Echtzeitmodus</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTOS: Einführung.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a> <br><br><h2>  Zusätzliche Postfachdienste </h2><br>  Nucleus RTOS verfügt über vier API-Aufrufe, die Zusatzfunktionen für Postfächer bereitstellen: Speichern eines Postfachs, Abrufen von Informationen zu einem Postfach, Abrufen der Anzahl von Postfächern in einer Anwendung und Abrufen von Zeigern auf alle Postfächer in einer Anwendung.  Die ersten drei dieser Funktionen sind in Nucleus SE implementiert. <br><br><h3>  Mailbox zurückgesetzt </h3><br>  Dieser API-Serviceaufruf setzt das Postfach auf seinen ursprünglichen, nicht verwendeten Status zurück.  Die in der Mailbox gespeicherte Nachricht geht verloren.  Alle an der Mailbox angehaltenen Aufgaben werden mit dem Rückkehrcode <b>NUSE_MAILBOX_WAS_RESET fortgesetzt</b> . <br><br>  <b><i>Rufen Sie an, um eine Mailbox in Nucleus RTOS zurückzusetzen</i></b> <br>  Prototyp eines Serviceabrufs: <br>  <b>STATUS NU_Reset_Mailbox (NU_MAILBOX * Mailbox);</b> <br><br>  Parameter: <br>  <b>Mailbox</b> - Ein Zeiger auf die Mailbox-Steuereinheit. <br><br>  Rückgabewert: <br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_MAILBOX</b> - ungültiger Postfachzeiger. <br><br>  <b><i>Rufen Sie an, um eine Mailbox in Nucleus SE zurückzusetzen</i></b> <br>  Dieser API-Serviceaufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br>  <b>STATUS NUSE_Mailbox_Reset (NUSE_MAILBOX-Postfach);</b> <br><br>  Parameter: <br>  <b>Postfach</b> - Index (ID) des ausgegebenen Postfachs. <br><br>  <b>Rückgabewert:</b> <br>  <b>NUSE_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NUSE_INVALID_MAILBOX</b> - Ungültiger Postfachindex. <br><br>  <b><i>Implementieren Sie das Zurücksetzen der Mailbox in Nucleus SE</i></b> <br>  Die Variante des Funktionscodes <b>NUSE_Mailbox_Reset</b> (nach Überprüfung der Parameter) wird mithilfe der bedingten Kompilierung ausgewählt, je nachdem, ob die Unterstützung für das Blockieren (Anhalten) von Aufgaben aktiviert ist oder nicht.  Wir werden beide Optionen in Betracht ziehen. <br><br>  Wenn die Sperre nicht aktiviert ist, ist der Code für diese API-Funktion ziemlich einfach.  Das Postfach wird als nicht verwendet markiert, indem der Parameter <b>NUSE_Mailbox_Status []</b> auf <b>FALSE gesetzt wird</b> . <br><br>  Wenn die Sperre aktiviert ist, wird der Code komplexer: <br><br><pre><code class="plaintext hljs">while (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; /* check whether any tasks are blocked */ /* on this mailbox */ for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { NUSE_Task_Blocking_Return[index] = NUSE_MAILBOX_WAS_RESET; NUSE_Task_Status[index] = NUSE_READY; break; } } NUSE_Mailbox_Blocking_Count[mailbox]--; } #if NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER NUSE_Reschedule(NUSE_NO_TASK); #endif</code> </pre> <br>  Das Postfach wird auf den Status "Leer" zurückgesetzt. <br><br>  Jeder angehaltenen Aufgabe in der Mailbox wird der Status "Bereit" mit dem Rückkehrcode <b>NUSE_MAILBOX_WAS_RESET zugewiesen</b> .  Wenn nach Abschluss dieses Vorgangs der Prioritätsplaner verwendet wird, wird der <b>Dienstaufruf NUSE_Reschedule () ausgeführt</b> , da eine oder mehrere Aufgaben mit einer höheren Priorität bereit sein und auf die Ausführung der Berechtigung warten können. <br><br><h3>  Mailbox-Informationen abrufen </h3><br>  Dieser Serviceabruf enthält eine Reihe von Postfachinformationen.  Die Implementierung dieses Aufrufs in Nucleus SE unterscheidet sich von Nucleus RTOS darin, dass weniger Informationen zurückgegeben werden, da die Objektbenennung und die Pausenreihenfolge nicht unterstützt werden und die Aufgabenpause deaktiviert werden kann. <br><br>  <b><i>Rufen Sie an, um Informationen zur Nucleus RTOS-Mailbox zu erhalten</i></b> <br>  Dieser API-Aufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br>  <b>STATUS NU_Mailbox_Information (NU_MAILBOX * Mailbox, CHAR * Name, OPTION * Suspend_Type, DATA_ELEMENT * Message_present, UNSIGNED * Tasks_waiting, NU_TASK ** first_task);</b> <br><br>  Parameter: <br><br>  <b>Mailbox</b> - Zeiger auf die Mailbox-Steuereinheit; <br>  <b>name</b> - ein 8-stelliger Zeiger auf den Postfachnamen.  Das abschließende Nullbyte ist ebenfalls in diesem Bereich enthalten. <br>  <b>suspend_type</b> - Zeiger auf die Variable, in der der Suspensionstyp der Aufgabe gespeichert ist.  Es kann die Werte <b>NU_FIFO</b> und <b>NU_PRIORITY annehmen</b> . <br>  <b>message_present</b> - ein Zeiger auf eine Variable, die den Wert <b>NU_TRUE</b> oder <b>NU_FALSE annimmt</b> , je nachdem, ob das Postfach voll ist oder nicht; <br>  <b>task_waiting</b> - ein Zeiger auf eine Variable, die die Anzahl der in diesem Postfach angehaltenen Aufgaben übernimmt; <br>  <b>first_task</b> - Ein Zeiger auf einen Aufgabenzeiger, der einen Zeiger auf die erste angehaltene Aufgabe nimmt. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_MAILBOX</b> - ungültiger Postfachzeiger. <br><br>  <b><i>Rufen Sie an, um Informationen zur Nucleus SE-Mailbox zu erhalten</i></b> <br>  Dieser API-Serviceaufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NUSE_Mailbox_Information (Postfach NUSE_MAILBOX, U8 * message_present, U8 *asks_waiting, NUSE_TASK * first_task);</b> <br><br>  Parameter: <br><br>  <b>Postfach</b> - Index des Postfachs, über das Informationen angefordert werden; <br>  <b>message_present</b> - ein Zeiger auf eine Variable, die den Wert <b>TRUE</b> oder <b>FALSE</b> annimmt, je nachdem, ob das Postfach voll ist oder nicht; <br>  <b>task_waiting</b> - ein Zeiger auf eine Variable, die die Anzahl der in diesem Postfach angehaltenen Aufgaben übernimmt (bei deaktivierter Aufgabenaussetzung wird nichts zurückgegeben); <br>  <b>first_task</b> - Ein Zeiger auf eine Variable vom Typ <b>NUSE_TASK</b> , die den Index der ersten angehaltenen Aufgabe übernimmt (nichts wird zurückgegeben, wenn die Aufgabe angehalten ist). <br><br>  Rückgabewert: <br><br>  <b>NUSE_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NUSE_INVALID_MAILBOX</b> - ungültiger Postfachindex; <br>  <b>NUSE_INVALID_POINTER</b> - Ein oder mehrere <b>Zeigerparameter</b> sind falsch. <br><br>  <b><i>Implementieren von Postfachinformationen in Nucleus SE</i></b> <br><br>  Die Implementierung dieses API-Aufrufs ist recht einfach: <br><br><pre> <code class="plaintext hljs">*message_present = NUSE_Mailbox_Status[mailbox]; #if NUSE_BLOCKING_ENABLE *tasks_waiting = NUSE_Mailbox_Blocking_Count[mailbox]; if (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { *first_task = index; break; } } } else { *first_task = 0; } #else *tasks_waiting = 0; *first_task = 0; #endif return NUSE_SUCCESS;</code> </pre><br>  Die Funktion gibt den Status der Mailbox zurück.  Wenn dann Dienstaufrufe zum Blockieren von Aufgaben aktiviert werden, werden die Anzahl der angehaltenen Aufgaben und der Index der ersten zurückgegeben (andernfalls werden diese Parameter auf 0 gesetzt). <br><br><h3>  Abrufen der Anzahl der Postfächer </h3><br>  Dieser Dienstprogrammaufruf gibt die Anzahl der Postfächer in der Anwendung zurück.  Während sich in Nucleus RTOS die Anzahl im Laufe der Zeit ändern kann und der Rückgabewert die aktuelle Anzahl der Postfächer anzeigt, wird in Nucleus SE die Anzahl der Postfächer in der Erstellungsphase festgelegt und kann nicht geändert werden. <br><br>  <b><i>Aufrufen eines Postfachzählers in Nucleus RTOS</i></b> <br>  Dieser API-Aufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br>  <b>UNSIGNED NU_Established_Mailboxes (VOID);</b> <br><br>  Parameter: <br>  Sind abwesend. <br><br>  Rückgabewert: <br>  Die Anzahl der in der Anwendung erstellten Postfächer. <br><br>  <b><i>Aufrufen eines Postfachzählers in Nucleus SE</i></b> <br>  Dieser API-Aufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br>  <b>U8 NUSE_Mailbox_Count (void);</b> <br><br>  Parameter: <br>  Sind abwesend. <br><br>  Rückgabewert: <br>  Die Anzahl der konfigurierten Postfächer in der Anwendung. <br><br>  <b><i>Implementieren eines Postfachzählers in Nucleus SE</i></b> <br>  Die Implementierung dieses API-Aufrufs ist äußerst einfach: Der Wert der Direktive <b>#define</b> <b>NUSE_MAILBOX_NUMBER</b> wird <b>zurückgegeben</b> . <br><br><h2>  Datenstrukturen </h2><br>  Postfächer verwenden zwei oder drei Arrays von Datenstrukturen (die sich alle im RAM befinden), die wie andere Nucleus SE-Objekte eine Reihe von Tabellen sind, deren Größe von der Anzahl der konfigurierten Postfächer und ihren Parametern abhängt. <br><br>  Ich empfehle dringend, dass der Anwendungscode keinen direkten Zugriff auf diese Datenstrukturen verwendet, sondern über die bereitgestellten API-Funktionen auf sie verweist.  Dies vermeidet Inkompatibilität mit zukünftigen Versionen von Nucleus SE und unerwünschte Nebenwirkungen und vereinfacht auch die Portierung der Anwendung auf Nucleus RTOS.  Im Folgenden finden Sie eine detaillierte Übersicht über Datenstrukturen, um die Funktionsweise des Serviceabrufcodes und das Debuggen besser zu verstehen. <br><br><h3>  RAM-Daten </h3><br>  Diese Daten haben folgende Struktur: <br><br>  <b>NUSE_Mailbox_Data []</b> - Ein Array vom Typ <b>ADDR</b> , das einen Eintrag für jedes konfigurierte Postfach enthält und Postfachdaten speichert. <br>  <b>NUSE_Mailbox_Status []</b> ist ein <b>U8-</b> Array mit einem Eintrag für jedes konfigurierte Postfach. Es überwacht die Verwendung von Postfächern.  Ein Wert ungleich Null ( <b>TRUE</b> ) zeigt an, dass das Postfach voll ist. <br>  <b>NUSE_Mailbox_Blocking_Count []</b> - Ein Array vom Typ <b>U8</b> , das einen Zähler für blockierte Aufgaben für jedes Postfach enthält.  Dieses Array wird nur erstellt, wenn die API-Aufrufblockierungsfunktion aktiviert ist. <br><br>  Diese Datenstrukturen werden beim <b>Start von</b> Nucleus SE in der Funktion <b>NUSE_Init_Mailbox ()</b> mit Nullen initialisiert.  Dies ist logisch, da jedes Postfach leer (nicht verwendet) erstellt wird. <br><br>  Im Folgenden finden Sie die Definitionen dieser Datenstrukturen aus der Datei <b>nuse_init.c</b> . <br><br><pre> <code class="plaintext hljs">RAM ADDR NUSE_Mailbox_Data[NUSE_MAILBOX_NUMBER]; RAM U8 NUSE_Mailbox_Status[NUSE_MAILBOX_NUMBER]; #if NUSE_BLOCKING_ENABLE RAM U8 NUSE_Mailbox_Blocking_Count[NUSE_MAILBOX_NUMBER]; #endif</code> </pre><br><h3>  ROM-Daten </h3><br>  Für die Implementierung von Postfächern werden keine Daten im ROM verwendet. <br><br><h3>  Die Speichermenge für Postfächer </h3><br>  Wie bei allen Nucleus SE-Kernelobjekten ist die für Postfächer erforderliche Speichermenge im Voraus bekannt. <br><br>  Der Speicherplatz für Daten im ROM für alle Postfächer in der Anwendung beträgt 0. <br><br>  Die Datenmenge im RAM für alle Postfächer in der Anwendung (in Byte) mit aktivierten API-Aufrufen zum Blockieren von Aufgaben kann wie folgt berechnet werden: <br>  <b>NUSE_MAILBOX_NUMBER * (Größe von (ADDR) +2)</b> <br><br>  Sonst: <br>  <b>NUSE_MAILBOX_NUMBER * (Größe von (ADDR) +1)</b> <br><br><h2>  Nicht realisierte API-Aufrufe </h2><br>  Die vier Dienstprogrammaufrufe in Nucleus RTOS sind in Nucleus SE nicht implementiert. <br><br><h3>  Mailbox erstellen </h3><br>  Dieser API-Serviceaufruf erstellt ein Postfach.  Nucleus SE benötigt es nicht, da Postfächer statisch erstellt werden. <br><br>  Prototyp eines Serviceabrufs: <br>  <b>STATUS NU_Create_Mailbox (NU_MAILBOX * Mailbox, CHAR * Name, UNSIGNED OPTION suspend_type);</b> <br><br>  Parameter: <br><br>  <b>Postfach</b> - ein Zeiger auf die vom Benutzer bereitgestellte Postfachsteuereinheit;  Wird zum Verwalten von Postfächern in anderen API-Aufrufen verwendet <br>  <b>name</b> - Zeiger auf den 7-stelligen Namen der Mailbox mit null Abschlussbyte; <br>  <b>suspend_type</b> - Gibt das Prinzip an, eine Aufgabe in einem Postfach <b>anzuhalten</b> .  Es kann die Werte <b>NU_FIFO</b> und <b>NU_PRIORITY annehmen</b> , die das Prinzip des FIFO (First-In-First-Out) bzw. das Prinzip der Priorität der Aussetzung von Aufgaben bedeuten. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_MAILBOX</b> - Nullzeiger auf die Postfachsteuereinheit ( <b>NULL</b> ) oder der Zeiger wird bereits verwendet; <br>  <b>NU_INVALID_SUSPEND</b> - ungültiger <b>suspend_type-</b> Parameter. <br><br><h3>  Löschen Sie eine Mailbox </h3><br>  Dieser API-Serviceaufruf löscht ein zuvor erstelltes Postfach.  Nucleus SE benötigt dies nicht, da Postfächer statisch erstellt werden und nicht gelöscht werden können. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NU_Delete_Mailbox (NU_MAILBOX * Mailbox);</b> <br><br>  Parameter: <br><br>  <b>Mailbox</b> - Ein Zeiger auf die Mailbox-Steuereinheit. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_MAILBOX</b> - ungültiger Postfachzeiger. <br><br><h3>  Mailbox-Zeiger </h3><br>  Dieser API-Aufruf erstellt eine sequentielle Liste von Zeigern auf alle Postfächer im System.  Nucleus SE benötigt es nicht, da Postfächer durch einen einfachen Index und nicht durch einen Zeiger identifiziert werden. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>UNSIGNED NU_Mailbox_Pointers (NU_MAILBOX ** Zeigerliste, UNSIGNED Maximum_Pointers);</b> <br><br>  Parameter: <br><br>  <b>pointer_list</b> - Zeiger auf ein Array von Zeigern <b>NU_MAILBOX</b> ;  Dieses Array wird mit Zeigern auf Postfächer gefüllt, die im System erstellt wurden. <br>  <b>Maximum_Pointers</b> - Die maximale Anzahl von Zeigern im Array. <br><br>  Rückgabewert: <br><br>  Die Anzahl der <b>NU_MAILBOX-</b> Zeiger im Array. <br><br><h3>  Notieren Sie eine Nachricht in der Mailbox zur Zustellung an alle Empfänger </h3><br>  Dieser Serviceabruf sendet eine Nachricht an alle Aufgaben, die auf Nachrichten aus einem bestimmten Postfach warten.  In Nucleus SE ist dieser Dienstprogrammaufruf nicht implementiert, da dies zu unnötiger Komplexität führen würde. <br><br>  Prototyp eines Serviceabrufs: <br><br>  <b>STATUS NU_Broadcast_To_Mailbox (NU_MAILBOX * Mailbox, VOID * Nachricht, UNSIGNED Suspend);</b> <br><br>  Parameter: <br><br>  <b>Mailbox</b> - Zeiger auf die Mailbox-Steuereinheit; <br>  <b>Nachricht</b> - Zeiger auf die übertragene Nachricht; <br>  <b>suspend</b> - Gibt an, ob die aufrufende Aufgabe angehalten werden soll, wenn das Postfach bereits eine Nachricht enthält.  kann <b>NU_NO_SUSPEND</b> , <b>NU_SUSPEND</b> oder ein Timeout-Wert sein. <br><br>  Rückgabewert: <br><br>  <b>NU_SUCCESS</b> - Der Anruf wurde erfolgreich abgeschlossen. <br>  <b>NU_INVALID_MAILBOX</b> - ungültiger Postfachzeiger; <br>  <b>NU_INVALID_POINTER</b> - Nullzeiger auf eine Nachricht ( <b>NULL</b> ); <br>  <b>NU_INVALID_SUSPEND</b> - Versuch, einen nicht aufgabenbezogenen Thread auszusetzen; <br>  <b>NU_MAILBOX_FULL</b> - Das Postfach enthält bereits eine Nachricht. <br>  <b>NU_TIMEOUT</b> - Nach Ablauf des Zeitlimits ist das Postfach noch voll. <br>  <b>NU_MAILBOX_DELETED</b> - Das Postfach wurde gelöscht, während die Aufgabe angehalten wurde. <br>  <b>NU_MAILBOX_RESET</b> - Das Postfach wurde zurückgesetzt, während die Aufgabe angehalten wurde. <br><br><h2>  Nucleus RTOS-kompatibel </h2><br>  Wie bei allen anderen Nucleus SE-Objekten war es mein Ziel, die Kompatibilität des Anwendungscodes mit Nucleus RTOS zu maximieren.  Postfächer sind keine Ausnahme und werden aus Anwendersicht auf die gleiche Weise wie in Nucleus RTOS implementiert.  Es gibt auch eine gewisse Inkompatibilität, die ich als akzeptabel angesehen habe, da der Code dadurch verständlicher und effizienter in Bezug auf den erforderlichen Speicher wird.  Andernfalls können Nucleus RTOS-API-Aufrufe direkt auf Nucleus SE portiert werden. <br><br><h3>  Objektkennungen </h3><br>  In Nucleus RTOS werden alle Objekte durch Datenstrukturen (Steuereinheiten) eines bestimmten Typs beschrieben.  Ein Zeiger auf diese Steuereinheit dient als Kennung für die Mailbox.  Ich entschied, dass in Nucleus SE ein anderer Ansatz für die effiziente Nutzung des Speichers erforderlich ist: Alle Kernelobjekte werden durch eine Reihe von Tabellen im RAM und / oder ROM beschrieben.  Die Größe dieser Tabellen wird durch die Anzahl der konfigurierten Objekte jedes Typs bestimmt.  Die Kennung eines bestimmten Objekts ist der Index in dieser Tabelle.  Also habe ich <b>NUSE_MAILBOX</b> als das Äquivalent von <b>U8 definiert</b> . Eine Variable (kein Zeiger) dieses Typs dient als Kennung des Postfachs.  Diese leichte Inkompatibilität ist leicht zu handhaben, wenn der Code von Nucleus SE nach Nucleus RTOS und umgekehrt portiert wird.  In der Regel werden keine anderen Operationen an Objektkennungen als Verschieben und Speichern ausgeführt. <br><br>  Nucleus RTOS unterstützt auch die Benennung von Postfächern.  Diese Namen werden nur zum Debuggen verwendet.  Ich habe sie von Nucleus SE ausgeschlossen, um Speicherplatz zu sparen. <br><br><h3>  Nachrichtengröße und -typ </h3><br>  In Nucleus RTOS besteht eine Postfachnachricht aus vier 32-Bit-Wörtern.  In Nucleus SE habe ich beschlossen, diesen Wert auf eine Variable vom Typ <b>ADDR</b> zu reduzieren.  Diese Änderung führt zu erheblichen Speichereinsparungen und einer kürzeren Ausführungszeit für Aufgaben.  Es wird auch vorgeschlagen, dass die übliche Verwendung eines Postfachs darin besteht, Informationen von einer Aufgabe an eine andere weiterzuleiten.  Diese Inkompatibilität verursacht keine großen Probleme beim Portieren von Anwendungen auf Nucleus RTOS.  Nucleus SE kann geändert werden, wenn ein anderes Nachrichtenformat benötigt wird. <br><br><h3>  Nicht realisierte API-Aufrufe </h3><br>  Nucleus RTOS unterstützt neun Postfachanrufe.  Von diesen sind vier nicht in Nucleus SE implementiert.  Die Details dieser Herausforderungen sowie die Gründe, warum sie von Nucleus SE ausgeschlossen wurden, sind oben beschrieben. <br><br>  Der nächste Artikel befasst sich mit Warteschlangen. <br><br>  <b>Über den Autor:</b> Colin Walls ist seit über dreißig Jahren in der Elektronikindustrie tätig und widmet sich die meiste Zeit der Firmware.  Heute ist er Firmware-Ingenieur bei Mentor Embedded (einer Abteilung von Mentor Graphics).  Colin Walls spricht häufig auf Konferenzen und Seminaren, Autor zahlreicher technischer Artikel und zweier Bücher über Firmware.  Lebt in Großbritannien.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Colins</a> professioneller <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blog</a> , E-Mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431118/">https://habr.com/ru/post/de431118/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431106/index.html">Wie viel Geld haben die Amerikaner an diesem schwarzen Freitag ausgegeben und was haben Smartphones damit zu tun?</a></li>
<li><a href="../de431108/index.html">So verwandeln Sie Satellitenbilder in Karten. Computer Vision in Yandex</a></li>
<li><a href="../de431110/index.html">Hören Sie auf, Verlage zu füttern. Die EU entwickelt Regeln für den obligatorischen freien Zugang zu Forschung</a></li>
<li><a href="../de431112/index.html">Verwendung der Methode der kleinsten Quadrate zum Bewerten von Ressourcen und Überwachen von Oracle-Datenbanken</a></li>
<li><a href="../de431116/index.html">Willst du seltsam: Rückblick auf die bevorstehende DartUP-Konferenz in St. Petersburg</a></li>
<li><a href="../de431120/index.html">Leiden bei der Arbeit ist nicht notwendig</a></li>
<li><a href="../de431122/index.html">Grafana als weiteres Werkzeug zur technischen Überwachung unserer Softwareprodukte</a></li>
<li><a href="../de431124/index.html">"Data Science ist wie Mathematik und Physik eine weitere Möglichkeit, die Welt um Sie herum zu erkunden."</a></li>
<li><a href="../de431126/index.html">Warum Sie nicht auf professionelle PM sparen sollten</a></li>
<li><a href="../de431128/index.html">Hacking DDR3 SPD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>