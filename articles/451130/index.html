<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüî¨ ü§≤üèø üßóüèº Swift: ARC y gesti√≥n de memoria üêÖ ‚§¥Ô∏è üîò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Al ser un lenguaje moderno de alto nivel, Swift b√°sicamente se encarga de la administraci√≥n de la memoria en sus aplicaciones, asignando y liberando m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Swift: ARC y gesti√≥n de memoria</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451130/">  Al ser un lenguaje moderno de alto nivel, <b>Swift</b> b√°sicamente se encarga de la administraci√≥n de la memoria en sus aplicaciones, asignando y liberando memoria.  Esto se debe a un mecanismo llamado <b>Conteo de referencia autom√°tico</b> , o <b>ARC para</b> abreviar.  En esta gu√≠a, aprender√° c√≥mo funciona ARC y c√≥mo administrar adecuadamente la memoria en Swift.  Al comprender este mecanismo, puede influir en la vida √∫til de los objetos ubicados en el mont√≥n ( <b>mont√≥n</b> ). <br><br>  En esta gu√≠a, desarrollar√° su conocimiento de Swift y ARC al aprender lo siguiente: <br><br><ul><li>  c√≥mo funciona ARC </li><li>  ¬øQu√© son los <b>ciclos de referencia</b> y c√≥mo solucionarlos correctamente? </li><li>  c√≥mo crear un bucle de enlace de ejemplo </li><li>  C√≥mo encontrar bucles de enlace usando las herramientas visuales que ofrece Xcode </li><li>  c√≥mo manejar tipos de referencia y tipos de valor </li></ul><a name="habracut"></a><br><h2>  Empezando </h2><br>  Descargue los <a href="" rel="nofollow">materiales de origen.</a>  Abra el proyecto en la carpeta <b>Ciclos / Inicio</b> .  En la primera parte de nuestra gu√≠a, que comprende los conceptos clave, trataremos exclusivamente con el archivo <b>MainViewController.swif</b> t. <br><br>  Agregue esta clase en la parte inferior de MainViewController.swift: <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = name <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"User \(name) was initialized"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Deallocating user named: \(name)"</span></span>) } }</code> </pre> <br>  La clase de <b>usuario</b> se define aqu√≠, que, con la ayuda de <b>las</b> declaraciones de <b>impresi√≥n</b> , nos indica acerca de la inicializaci√≥n y liberaci√≥n de la instancia de clase. <br><br>  Ahora cree una instancia de la clase Usuario en la parte superior de MainViewController. <br><br>  Coloque este c√≥digo antes del m√©todo <b>viewDidLoad ()</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user = <span class="hljs-type"><span class="hljs-type">User</span></span>(name: <span class="hljs-string"><span class="hljs-string">"John"</span></span>)</code> </pre> <br>  Inicia la aplicaci√≥n.  Haga que la consola Xcode sea visible con <b>Command-Shift-Y</b> para ver el resultado de las declaraciones de impresi√≥n. <br><br>  Observe que el <b>Usuario John se inicializ√≥</b> apareci√≥ en la consola, pero la declaraci√≥n de impresi√≥n dentro de <b>deinit</b> no se ejecut√≥.  Esto significa que este objeto no se lanz√≥, ya que no sali√≥ del <b>alcance</b> . <br><br>  En otras palabras, hasta que el controlador de vista que contiene este objeto se salga del alcance, el objeto nunca se liberar√°. <br><br><h2>  ¬øEst√° en alcance? </h2><br>  Al envolver una instancia de la clase Usuario en un m√©todo, permitiremos que salga del alcance, permitiendo as√≠ que ARC la libere. <br><br>  Vamos a crear el m√©todo <b>runScenario ()</b> dentro de la clase MainViewController y mover la inicializaci√≥n de la instancia de la clase Usuario dentro de ella. <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runScenario</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user = <span class="hljs-type"><span class="hljs-type">User</span></span>(name: <span class="hljs-string"><span class="hljs-string">"John"</span></span>) }</code> </pre><br>  runScenario () define el alcance de la instancia de usuario.  Al salir de esta zona, el <b>usuario</b> debe ser liberado. <br><br>  Ahora llame a runScenario () agregando esto al final de viewDidLoad (): <br><br><pre> <code class="swift hljs">runScenario()</code> </pre> <br>  Inicia la aplicaci√≥n.  La salida de la consola ahora se ve as√≠: <br><br>  El usuario John fue inicializado <br>  Usuario desasignante llamado: John <br><br>  Esto significa que ha liberado un objeto que ha abandonado el campo de visi√≥n. <br><br><h2>  Vida √∫til del objeto </h2><br><br>  La existencia del objeto se divide en cinco etapas: <br><br><ul><li>  asignaci√≥n de memoria: de la pila o del mont√≥n </li><li>  Inicializaci√≥n: el c√≥digo se ejecuta dentro de init </li><li>  uso de </li><li>  Desinicializaci√≥n: el c√≥digo se ejecuta dentro de Deinit </li><li>  memoria libre: la memoria asignada se devuelve a la pila o al mont√≥n </li></ul><br>  No hay una forma directa de rastrear los pasos de asignaci√≥n y liberaci√≥n de memoria, pero puede usar el c√≥digo dentro de init y deinit. <br><br>  <b>Los recuentos de referencia</b> , tambi√©n conocidos como <b>recuentos de uso</b> , determinan cu√°ndo ya no se necesita un objeto.  Este contador muestra el n√∫mero de quienes "usan" este objeto.  Un objeto se vuelve innecesario cuando el contador de uso es cero.  Luego, el objeto se inicializa y se libera. <br><br><img src="https://habrastorage.org/webt/b5/oo/78/b5oo78ealf173ey0ayz7rngnszk.png"><br><br>  Cuando se inicializa el objeto Usuario, su recuento de referencia es 1, porque la constante del <b>usuario</b> se refiere a este objeto. <br><br>  Al final de runScenario (), el usuario sale del alcance y el recuento de referencias se reduce a 0. Como resultado, el usuario no se inicializa y luego se libera. <br><br><h2>  Ciclos de referencia </h2><br>  En la mayor√≠a de los casos, ARC funciona como deber√≠a.  El desarrollador generalmente no necesita preocuparse por las p√©rdidas de memoria cuando los objetos no utilizados permanecen sin asignar indefinidamente. <br><br>  ¬°Pero no siempre!  Posibles fugas de memoria. <br><br>  ¬øC√≥mo puede pasar esto?  Imagine una situaci√≥n en la que dos objetos ya no se usan, pero cada uno de ellos se refiere al otro.  Como cada recuento de referencia no es 0, ninguno de ellos se liberar√°. <br><br><img src="https://habrastorage.org/webt/hd/zp/ff/hdzpffk1eh3rug0fgmgnlghnb3q.png"><br><br>  Este es un <b>ciclo de referencia fuerte</b> .  Esta situaci√≥n confunde el ARC y no le permite borrar la memoria. <br><br>  Como puede ver, el recuento de referencias al final no es 0, y aunque ya no se necesitan objetos, object1 y object2 no se liberar√°n. <br><br><h2>  Mira nuestros enlaces </h2><br>  Para probar todo esto en acci√≥n, agregue este c√≥digo despu√©s de la clase Usuario en MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phone</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> model: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner: <span class="hljs-type"><span class="hljs-type">User?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(model: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.model = model <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Phone \(model) was initialized"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Deallocating phone named: \(model)"</span></span>) } }</code> </pre> <br>  Este c√≥digo agrega una nueva clase de <b>tel√©fono</b> con dos propiedades, una para el modelo y otra para el propietario, as√≠ como los m√©todos init y deinit.  La propiedad del propietario es opcional, ya que el tel√©fono puede no tener un propietario. <br><br>  Ahora agregue esta l√≠nea a runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> iPhone = <span class="hljs-type"><span class="hljs-type">Phone</span></span>(model: <span class="hljs-string"><span class="hljs-string">"iPhone Xs"</span></span>)</code> </pre><br>  Esto crear√° una instancia de la clase Phone. <br><br><h2>  Sostener el m√≥vil </h2><br>  Ahora agregue este c√≥digo a la clase Usuario, inmediatamente despu√©s de la propiedad de nombre: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phones: [<span class="hljs-type"><span class="hljs-type">Phone</span></span>] = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phone: Phone)</span></span></span></span> { phones.append(phone) phone.owner = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> }</code> </pre><br>  Agregue una variedad de tel√©fonos propiedad del usuario.  El setter est√° marcado como privado, por lo que se debe agregar add (phone :). <br><br>  Inicia la aplicaci√≥n.  Como puede ver, las instancias de las clases de objetos Tel√©fono y Usuario se liberan seg√∫n sea necesario. <br><br>  El usuario John fue inicializado <br>  El tel√©fono iPhone XS se inicializ√≥ <br>  Tel√©fono deslocalizador llamado: iPhone Xs <br>  Usuario desasignante llamado: John <br><br>  Ahora agregue esto al final de runScenario (): <br><pre> <code class="swift hljs">user.add(phone: iPhone)</code> </pre> <br><br>  Aqu√≠ agregamos nuestro iPhone a la lista de tel√©fonos propiedad del <b>usuario</b> , y tambi√©n establecemos la propiedad del <b>propietario</b> del tel√©fono como ' <b>usuario</b> '. <br><br>  Ejecute la aplicaci√≥n nuevamente.  Ver√° que los objetos de usuario y iPhone no se liberan.  El ciclo de fuertes v√≠nculos entre ellos impide que el ARC los libere. <br><br><img src="https://habrastorage.org/webt/lo/az/mu/loazmuamyoww2ttr7wnwcd8_n4w.png"><br><br><h2>  Enlaces d√©biles </h2><br>  Para romper el ciclo de enlaces fuertes, puede designar la relaci√≥n entre objetos como d√©bil. <br><br>  Por defecto, todos los enlaces son fuertes y la asignaci√≥n lleva a un aumento en el recuento de referencias.  Cuando se usan referencias d√©biles, el recuento de referencias no aumenta. <br><br>  En otras palabras, los <b>enlaces d√©biles no afectan la gesti√≥n de la vida de un objeto</b> .  Los enlaces d√©biles siempre se declaran <b>opcionales</b> .  De esa manera, cuando el recuento de enlaces se convierte en 0, el enlace se puede establecer en nulo. <br><br><img src="https://habrastorage.org/webt/ti/qd/kc/tiqdkcyfstrndd8xswpf8zfebfo.png"><br><br>  En esta ilustraci√≥n, las l√≠neas discontinuas indican enlaces d√©biles.  Tenga en cuenta que el recuento de referencia de object1 es 1, ya que variable1 se refiere a √©l.  El recuento de referencia de object2 es 2, porque es referenciado por variable2 y object1. <br><br>  object2 tambi√©n hace referencia a object1, pero <b>WEAK</b> , lo que significa que no afecta el recuento de referencias de object1. <br><br>  Cuando variable1 y variable2 se liberan, object1 tiene un recuento de referencia de 0, que lo libera.  Esto, a su vez, libera una fuerte referencia a object2, que ya conduce a su lanzamiento. <br><br>  En la clase Tel√©fono, cambie la declaraci√≥n de propiedad del propietario de la siguiente manera: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner: <span class="hljs-type"><span class="hljs-type">User?</span></span></code> </pre> <br>  Al declarar la referencia de propiedad del propietario como 'd√©bil', rompemos el ciclo de enlaces fuertes entre las clases Usuario y Tel√©fono. <br><br><img src="https://habrastorage.org/webt/ym/ax/_m/ymax_mv9cvlpi8xqwnxmb14vr2g.png"><br><br>  Inicia la aplicaci√≥n.  Ahora el usuario y el tel√©fono est√°n liberados correctamente. <br><br><h2>  Enlaces no propios </h2><br>  Tambi√©n hay otro modificador de enlace que no aumenta el recuento de referencias: <b>sin propietario</b> . <br><br>  ¬øCu√°l es la diferencia entre <b>no propietario</b> y <b>d√©bil</b> ?  Una referencia d√©bil siempre es opcional y autom√°ticamente se vuelve nula cuando se libera el objeto referenciado. <br><br>  Es por eso que debemos declarar propiedades d√©biles como una variable de tipo opcional: esta propiedad debe cambiar. <br><br>  Los enlaces no propios, en contraste, nunca son opcionales.  Si intenta acceder a una propiedad no propietaria que se refiere a un objeto liberado, obtendr√° un error que parece un desenvolvimiento forzado que contiene una variable nula (desenvolvimiento forzado). <br><br><img src="https://habrastorage.org/webt/i9/hf/bc/i9hfbcizzk2eg38s_hidjq3evju.png"><br><br>  Intentemos aplicar <b>sin propietario</b> . <br><br>  Agregue una nueva clase <b>CarrierSubscription</b> al final de MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CarrierSubscription</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> countryCode: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> number: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user: <span class="hljs-type"><span class="hljs-type">User</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>, countryCode: <span class="hljs-type"><span class="hljs-type">String</span></span>, number: <span class="hljs-type"><span class="hljs-type">String</span></span>, user: <span class="hljs-type"><span class="hljs-type">User</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = name <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.countryCode = countryCode <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.number = number <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.user = user <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"CarrierSubscription \(name) is initialized"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Deallocating CarrierSubscription named: \(name)"</span></span>) } }</code> </pre> <br>  CarrierSubscription tiene cuatro propiedades: <br><br>  Nombre: nombre del proveedor. <br>  CountryCode: c√≥digo de pa√≠s. <br>  N√∫mero: n√∫mero de tel√©fono. <br>  Usuario: enlace al usuario. <br><br><h2>  ¬øQui√©n es tu proveedor? </h2><br>  Ahora agregue esto a la clase Usuario despu√©s de la propiedad de nombre: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> subscriptions: [<span class="hljs-type"><span class="hljs-type">CarrierSubscription</span></span>] = []</code> </pre> <br>  Aqu√≠ mantenemos una variedad de proveedores de usuarios. <br><br>  Ahora agregue esto a la clase Phone, despu√©s de la propiedad del propietario: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carrierSubscription: <span class="hljs-type"><span class="hljs-type">CarrierSubscription?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provision</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(carrierSubscription: CarrierSubscription)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.carrierSubscription = carrierSubscription } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decommission</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { carrierSubscription = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  Esto agrega la propiedad opcional CarrierSubscription y dos m√©todos para registrar y cancelar el registro del tel√©fono con el proveedor. <br><br>  Ahora agregue la clase CarrierSubscription dentro del m√©todo init, justo antes de la declaraci√≥n de impresi√≥n: <br><br><pre> <code class="swift hljs">user.subscriptions.append(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)</code> </pre> <br>  Agregamos CarrierSubscription a la gama de proveedores de usuarios. <br><br>  Finalmente, agregue esto al final del m√©todo runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> subscription = <span class="hljs-type"><span class="hljs-type">CarrierSubscription</span></span>( name: <span class="hljs-string"><span class="hljs-string">"TelBel"</span></span>, countryCode: <span class="hljs-string"><span class="hljs-string">"0032"</span></span>, number: <span class="hljs-string"><span class="hljs-string">"31415926"</span></span>, user: user) iPhone.provision(carrierSubscription: subscription)</code> </pre> <br>  Creamos una suscripci√≥n al proveedor para el usuario y le conectamos el tel√©fono. <br><br>  Inicia la aplicaci√≥n.  En la consola ver√°s: <br><br>  El usuario John fue inicializado <br>  El tel√©fono iPhone Xs se inicializ√≥ <br>  CarrierSubscription TelBel se inicializa <br><br>  Y de nuevo un ciclo de enlaces!  usuario, iPhone y suscripci√≥n no se liberaron al final. <br><br>  ¬øPuedes encontrar un problema? <br><br><img src="https://habrastorage.org/webt/uu/fg/eq/uufgeqkvqa31jwwlsnlikc-iob8.png"><br><br><h2>  Rompiendo la cadena </h2><br>  O bien el enlace del usuario a la suscripci√≥n o el enlace de la suscripci√≥n al usuario no deben ser propietarios para romper el ciclo.  La pregunta es qu√© opci√≥n elegir.  Veamos las estructuras. <br><br>  Un usuario posee una suscripci√≥n a un proveedor, pero viceversa, no, una suscripci√≥n a un proveedor no posee un usuario. <br><br>  Adem√°s, no tiene sentido la existencia de CarrierSubscription sin referencia al usuario que lo posee. <br><br>  Por lo tanto, el enlace del usuario no debe ser propietario. <br><br>  Cambie la declaraci√≥n del usuario en CarrierSubscription: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user: <span class="hljs-type"><span class="hljs-type">User</span></span></code> </pre><br>  Ahora el usuario no posee, lo que rompe el ciclo de enlaces y le permite liberar todos los objetos. <br><br><img src="https://habrastorage.org/webt/en/vx/cu/envxcuihbevfcfqv1cyg-kc3lo4.png"><br><br><h2>  Enlaces de bucle en cierres </h2><br>  Los ciclos de enlace para los objetos ocurren cuando los objetos tienen propiedades que se refieren entre s√≠.  Al igual que los objetos, los cierres son un tipo de referencia y pueden conducir a bucles de referencia.  Los cierres capturan los objetos que usan. <br><br>  Por ejemplo, si asigna un cierre a una propiedad de una clase, y este cierre utiliza propiedades de la misma clase, obtenemos un bucle de enlaces.  En otras palabras, el objeto mantiene un enlace al cierre a trav√©s de la propiedad.  El cierre contiene una referencia al objeto a trav√©s del valor capturado de uno mismo. <br><br><img src="https://habrastorage.org/webt/z-/lh/ow/z-lhowlkfyvy4ycusafxhygjisw.png"><br><br>  Agregue este c√≥digo a CarrierSubscription inmediatamente despu√©s de la propiedad del usuario: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completePhoneNumber: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.countryCode + <span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.number }</code> </pre><br>  Este cierre calcula y devuelve el n√∫mero de tel√©fono completo.  La propiedad se declara <b>perezosa</b> , se asignar√° al primer uso. <br><br>  Esto es necesario porque usa self.countryCode y self.number, que no estar√° disponible hasta que se ejecute el c√≥digo inicializador. <br><br>  Agregue runScenario () al final: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(subscription.completePhoneNumber())</code> </pre> <br>  Llamar a completePhoneNumber () ejecutar√° el cierre. <br><br>  Inicie la aplicaci√≥n y ver√° que el usuario y el iPhone se liberan, pero CarrierSubscription no lo es, debido a un ciclo de fuertes v√≠nculos entre el objeto y el cierre. <br><br><img src="https://habrastorage.org/webt/7t/rb/ax/7trbaxtrrhtadtm29-dvqwehzo4.png"><br><br><h2>  Listas de captura </h2><br>  Swift proporciona una manera simple y elegante de romper el lazo de los enlaces fuertes en los cierres.  Declara una lista de captura en la que define la relaci√≥n entre el cierre y los objetos que captura. <br><br>  Para demostrar la lista de captura, considere el siguiente c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> someClosure = { [x] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(x), \(y)"</span></span>) } x = <span class="hljs-number"><span class="hljs-number">6</span></span> y = <span class="hljs-number"><span class="hljs-number">6</span></span> someClosure() <span class="hljs-comment"><span class="hljs-comment">// Prints 5, 6 print("\(x), \(y)") // Prints 6, 6</span></span></code> </pre> <br>  x est√° en la lista de captura de cierre, por lo que el valor de x se copia a la definici√≥n de cierre.  Se captura por valor. <br><br>  y no est√° en la lista de captura, se captura por referencia.  Esto significa que el valor de y ser√° lo que era en el momento en que se llam√≥ al circuito. <br><br>  Las listas de bloqueo ayudan a identificar interacciones d√©biles o no propias con respecto a los objetos capturados dentro del bucle.  En nuestro caso, la elecci√≥n adecuada no es propiedad, ya que no puede existir un cierre si se libera la instancia de CarrierSubscription. <br><br><h2>  Aprovechate </h2><br>  Reemplace la definici√≥n completePhoneNumber con CarrierSubscription :: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completePhoneNumber: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.countryCode + <span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.number }</code> </pre> <br>  <b>Agregamos [self propio]</b> a la lista de captura de cierre.  Esto significa que nos capturamos a nosotros <b>mismos</b> como un enlace no <b>propiedad en</b> lugar de uno fuerte. <br><br>  Inicie la aplicaci√≥n y ver√° que CarrierSubscription ya est√° disponible. <br><br>  De hecho, la sintaxis anterior es una forma corta de una m√°s larga y m√°s completa en la que aparece una nueva variable: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closure = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> newID = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-comment"><span class="hljs-comment">// Use unowned newID here... }</span></span></code> </pre> <br>  Aqu√≠ newID es una copia de uno mismo sin due√±o.  M√°s all√° del cierre, el yo permanece como s√≠ mismo.  En la forma corta dada anteriormente, <b>creamos una nueva auto variable</b> que oscurece el yo existente dentro del cierre. <br><br><h2>  Usar sin propiedad con cuidado </h2><br>  En su c√≥digo, la relaci√≥n entre self y completePhoneNumber se designa como no propietaria. <br><br>  Si est√° seguro de que el objeto utilizado en el cierre no se liberar√°, puede usarlo sin propietario.  Si lo hace, ¬°est√°s en problemas! <br><br>  Agregue este c√≥digo al final de MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WWDCGreeting</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> who: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(who: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.who = who } <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello \(self.who)."</span></span> } }</code> </pre><br>  Ahora aqu√≠ est√° el final de runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mermaid = <span class="hljs-type"><span class="hljs-type">WWDCGreeting</span></span>(who: <span class="hljs-string"><span class="hljs-string">"caffeinated mermaid"</span></span>) greetingMaker = mermaid.greetingMaker } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(greetingMaker()) <span class="hljs-comment"><span class="hljs-comment">// !</span></span></code> </pre> <br>  Inicie la aplicaci√≥n y ver√° un bloqueo y algo as√≠ en la consola: <br><br>  El usuario John fue inicializado <br>  El tel√©fono iPhone XS se inicializ√≥ <br>  CarrierSubscription TelBel se inicializa <br>  0032 31415926 <br>  Error fatal: intento de leer una referencia no propiedad pero el objeto 0x600000f0de30 ya fue desasignado2019-02-24 12: 29: 40.744248-0600 Ciclos [33489: 5926466] Error fatal: intento de leer una referencia no propiedad pero el objeto 0x600000f0de30 ya fue desasignado <br><br>  Se produjo una excepci√≥n porque el cierre espera a que exista quien existe, pero se liber√≥ tan pronto como la sirena sali√≥ del alcance al final del bloque do. <br><br>  Este ejemplo puede parecer succionado por un dedo, pero tales cosas suceden.  Por ejemplo, cuando usamos cierres para comenzar algo mucho m√°s tarde, digamos, despu√©s de que la llamada asincr√≥nica en la red ha finalizado. <br><br><h2>  Desactiva la trampa </h2><br>  Reemplace greetingMaker en la clase WWDCGreeting con esto: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello \(self?.who)."</span></span> }</code> </pre> <br>  Hicimos dos cosas: primero, reemplazamos sin due√±o por d√©bil.  En segundo lugar, dado que el yo se ha debilitado, accedemos a la propiedad de qui√©n a trav√©s del yo.  Ignore la advertencia de Xcode, lo arreglaremos pronto. <br><br>  La aplicaci√≥n ya no se bloquea, pero si la ejecuta, obtenemos un resultado divertido: "Hola, nada". <br><br>  Quiz√°s el resultado sea bastante aceptable, pero a menudo necesitamos hacer algo si el objeto fue liberado.  Esto se puede hacer usando la declaraci√≥n de guardia. <br><br>  Reemplace el texto de cierre con esto: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"No greeting available."</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello \(self.who)."</span></span> }</code> </pre><br>  La declaraci√≥n de guardia se asigna a uno mismo tomado del ser d√©bil.  Si self es nulo, el cierre devuelve "No hay saludo disponible".  De lo contrario, self se convierte en una referencia fuerte, por lo que se garantiza que el objeto vivir√° hasta el final del cierre. <br><br><h2>  Buscando bucles de enlace en Xcode 10 </h2><br>  Ahora que comprende c√≥mo funciona ARC, qu√© son los bucles de enlace y c√≥mo romperlos, es hora de ver un ejemplo de una aplicaci√≥n real. <br><br>  Abra el proyecto Starter ubicado en la carpeta Contactos. <br><br>  Inicia la aplicaci√≥n. <br><br><img src="https://habrastorage.org/webt/a8/ce/l1/a8cel1rgbdkm_fel_d880f2swf4.png"><br><br>  Este es el administrador de contactos m√°s simple.  Intente hacer clic en un contacto, agregue un par de nuevos. <br><br>  Asignaci√≥n de archivo: <br><br>  ContactsTableViewController: muestra todos los contactos. <br>  DetailViewController: muestra la informaci√≥n detallada del contacto seleccionado. <br>  NewContactViewController: le permite agregar un nuevo contacto. <br>  ContactTableViewCell: celda de la tabla que muestra los detalles de contacto. <br>  Contacto: modelo de contacto. <br>  N√∫mero: modelo de n√∫mero de tel√©fono. <br><br>  Sin embargo, con este proyecto, todo est√° mal: hay un ciclo de enlaces.  Al principio, los usuarios no notar√°n problemas debido al peque√±o tama√±o de la p√©rdida de memoria, por la misma raz√≥n es dif√≠cil encontrar la p√©rdida. <br><br>  Afortunadamente, Xcode 10 tiene herramientas integradas para encontrar la p√©rdida de memoria m√°s peque√±a. <br><br>  Inicie la aplicaci√≥n nuevamente.  Elimine 3-4 contactos usando el deslizamiento hacia la izquierda y el bot√≥n Eliminar.  Parece que desaparecen por completo, ¬øverdad? <br><br><img src="https://habrastorage.org/webt/xu/d9/qf/xud9qf3rcyaf5ot_08l8vauizto.png"><br><br><h2>  Donde fluye </h2><br>  Cuando la aplicaci√≥n se est√© ejecutando, haga clic en el bot√≥n Debug Memory Graph: <br><br><img src="https://habrastorage.org/webt/la/na/km/lanakmzc0d2ousrcf5jwkpu-ova.png"><br><br>  Observe los problemas de tiempo de ejecuci√≥n en el navegador de depuraci√≥n.  Est√°n marcados con cuadrados morados con un signo de exclamaci√≥n blanco dentro: <br><br><img src="https://habrastorage.org/webt/uc/ko/vj/uckovjp_eqoplopih79xuz1jl7e.png"><br><br>  Seleccione uno de los objetos de contacto problem√°ticos en el navegador.  El ciclo es claramente visible: los objetos Contacto y N√∫mero, que se refieren entre s√≠, se mantienen. <br><br><img src="https://habrastorage.org/webt/7f/wi/os/7fwios8n7zdk4ww7bj81p4kvgle.png"><br><br>  Parece que deber√≠as mirar el c√≥digo.  Tenga en cuenta que un contacto puede existir sin un n√∫mero, pero no al rev√©s. <br><br>  ¬øC√≥mo resolver√≠as este bucle?  ¬øEnlace de contacto a n√∫mero o de n√∫mero a contacto?  d√©bil o sin due√±o?  Pru√©balo t√∫ mismo primero! <br><br><div class="spoiler">  <b class="spoiler_title">Si necesitabas ayuda ...</b> <div class="spoiler_text">  Hay 2 posibles soluciones: hacer un enlace de Contacto a N√∫mero d√©bil, o de N√∫mero a Contacto sin propiedad. <br><br>  La documentaci√≥n de Apple recomienda que el objeto padre tenga una fuerte referencia a "hijo", y no al rev√©s.  Esto significa que le damos a Contact una fuerte referencia a Number, y Number, un enlace no propietario a Contact: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Number</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contact: <span class="hljs-type"><span class="hljs-type">Contact</span></span> <span class="hljs-comment"><span class="hljs-comment">// Other code... } class Contact { var number: Number? // Other code... }</span></span></code> </pre> <br></div></div><br><h2>  Bonificaci√≥n: bucles con tipos de referencia y tipos de valor. </h2><br>  Swift tiene tipos de referencia (clases y cierres) y tipos de valores (estructuras, enumeraciones).  El tipo de valor se copia cuando se pasa, y los tipos de referencia comparten el mismo valor utilizando el enlace. <br><br>  Esto significa que en el caso de los tipos de valor, no puede haber ciclos.  Para que se produzca un bucle, necesitamos al menos 2 tipos de referencia. <br><br>  Volvamos al proyecto Cycles y agreguemos este c√≥digo al final de MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Error var payload = 0 var next: Node? }</span></span></code> </pre><br>  No va a funcionar!  La estructura es un tipo de valor y no puede tener recursividad en una instancia de s√≠ misma.  De lo contrario, dicha estructura tendr√≠a un tama√±o infinito. <br><br>  Cambia la estructura a una clase. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next: <span class="hljs-type"><span class="hljs-type">Node?</span></span> }</code> </pre> <br>  La referencia a s√≠ mismo es bastante aceptable para las clases (tipo de referencia), por lo que el compilador no tiene problemas. <br><br>  Ahora agregue esto al final de MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friends: [<span class="hljs-type"><span class="hljs-type">Person</span></span>] = [] <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = name <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"New person instance: \(name)"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Person instance \(name) is being deallocated"</span></span>) } }</code> </pre> <br>  Y esto est√° al final de runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ernie = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Ernie"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bert = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Bert"</span></span>) ernie.friends.append(bert) <span class="hljs-comment"><span class="hljs-comment">// Not deallocated bert.friends.append(ernie) // Not deallocated }</span></span></code> </pre><br>  Inicia la aplicaci√≥n.  Tenga en cuenta: ni ernie ni bert son liberados. <br><br><h2>  Enlace y significado </h2><br>  Este es un ejemplo de una combinaci√≥n de un tipo de referencia y un tipo de valor que ha llevado a un bucle de enlaces. <br><br>  ernie y bert permanecen in√©ditos, manteni√©ndose mutuamente en las matrices de sus amigos, aunque las matrices mismas son tipos de valor. <br><br>  Intente hacer que los amigos archiven como no propiedad, y Xcode mostrar√° un error: no propiedad solo se aplica a las clases. <br><br>  Para arreglar este bucle, tenemos que crear un objeto contenedor y usarlo para agregar instancias a la matriz. <br><br>  Agregue la siguiente definici√≥n antes de la clase Persona: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unowned</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnyObject</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> (<span class="hljs-number"><span class="hljs-number">_</span></span> value: <span class="hljs-type"><span class="hljs-type">T</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.value = value } }</code> </pre><br>  Luego cambie la definici√≥n de amigos en la clase Persona: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friends: [<span class="hljs-type"><span class="hljs-type">Unowned</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Person</span></span>&gt;] = []</code> </pre> <br>  Finalmente, reemplace el contenido del bloque do en runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ernie = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Ernie"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bert = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Bert"</span></span>) ernie.friends.append(<span class="hljs-type"><span class="hljs-type">Unowned</span></span>(bert)) bert.friends.append(<span class="hljs-type"><span class="hljs-type">Unowned</span></span>(ernie)) }</code> </pre> <br>  Inicie la aplicaci√≥n, ahora ernie y bert se han lanzado correctamente. <br><br>  La matriz de amigos ya no es una colecci√≥n de objetos Persona.  Esta es ahora una <b>colecci√≥n de objetos sin propietario</b> que sirven como envoltorios para instancias de Persona. <br><br>  Para obtener objetos Person de Unowned, use la propiedad value: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstFriend = bert.friends.first?.value <span class="hljs-comment"><span class="hljs-comment">// get ernie</span></span></code> </pre> <br><h2>  Conclusi√≥n </h2><br>  Ahora tiene una buena comprensi√≥n de la administraci√≥n de memoria en Swift y sabe c√≥mo funciona ARC.  Espero que la publicaci√≥n te haya sido √∫til. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Apple: conteo autom√°tico de referencias</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451130/">https://habr.com/ru/post/451130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451116/index.html">C√≥mo luch√© con la Transici√≥n de elementos compartidos y escrib√≠ mi primera biblioteca de c√≥digo abierto</a></li>
<li><a href="../451118/index.html">Las pruebas no son para principiantes</a></li>
<li><a href="../451120/index.html">Sobre los desaf√≠os de portar Dead Cells a plataformas m√≥viles</a></li>
<li><a href="../451124/index.html">Desarrollo de prote√≠nas en la nube usando Python y Transcriptic o C√≥mo crear cualquier prote√≠na por $ 360</a></li>
<li><a href="../451126/index.html">Caja de herramientas para investigadores - N√∫mero uno: autoorganizaci√≥n y visualizaci√≥n de datos</a></li>
<li><a href="../451132/index.html">Consumer Driven Contracts o Gitlab CI-eyed QA test automation</a></li>
<li><a href="../451138/index.html">Symfony CLI - Nueva herramienta de desarrollo local</a></li>
<li><a href="../451140/index.html">¬øCu√°nto cuesta crear una soluci√≥n de IoT?</a></li>
<li><a href="../451144/index.html">Antig√ºedades: t√©cnica en publicidad televisiva</a></li>
<li><a href="../451146/index.html">Acelerar las compilaciones de aplicaciones web con webpack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>