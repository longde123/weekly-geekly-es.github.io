<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ûüèæ ü§ΩüèΩ ü§üüèº Un onduleur avec un sinus pur en 15 minutes ou "l'√©lectronique de puissance - pour tout le monde" üì¨ ü§æ üéè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Qu'est-ce que l'√©lectronique de puissance? Sans aucun doute - c'est le monde entier! Moderne et plein de confort. Beaucoup de gens imaginent l'√©lectro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un onduleur avec un sinus pur en 15 minutes ou "l'√©lectronique de puissance - pour tout le monde"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428550/">  Qu'est-ce que l'√©lectronique de puissance?  Sans aucun doute - c'est le monde entier!  Moderne et plein de confort.  Beaucoup de gens imaginent l'√©lectronique de puissance comme quelque chose de ¬´magique¬ª et distant, mais regardez autour de vous - presque tout ce qui nous entoure contient un convertisseur de puissance: une alimentation pour ordinateur portable, une lampe LED, un onduleur, divers r√©gulateurs, des stabilisateurs de tension et des fr√©quencem√®tres (IF) ) dans la ventilation ou l'ascenseur et bien plus encore.  La plupart de ces √©quipements rendent notre vie confortable et s√ªre. <br><br>  Pour plusieurs raisons, le d√©veloppement de l'√©lectronique de puissance est l'un des domaines les plus difficiles de l'√©lectronique - le prix d'erreur est tr√®s √©lev√©, tandis que le d√©veloppement des convertisseurs de puissance a toujours attir√© les amateurs, les bricoleurs et pas seulement.  Vous vouliez s√ªrement construire une alimentation puissante pour votre projet?  Ou peut-√™tre UPS en ligne pour quelques kW et ne pas faire faillite?  Ou peut-√™tre un chastotnik dans l'atelier? <br><br>  Aujourd'hui, je vais parler de mon petit projet ouvert, ou plut√¥t de sa partie, qui permettra √† quiconque veut entrer dans le monde du d√©veloppement de l'√©lectronique de puissance et en m√™me temps rester en vie.  Comme d√©monstration des possibilit√©s, je montrerai comment assembler un onduleur de tension de 12V DC √† 230V AC avec une sortie sinuso√Ødale en 15 minutes.  Intrigu√©?  C'est parti! <br><br><img src="https://habrastorage.org/webt/na/rx/gk/narxgkn5e_6tiuqmfysesuukoug.jpeg"><br><a name="habracut"></a><br><br><h2>  Raisons du projet </h2><br>  Au cours des deux derni√®res ann√©es, le d√©veloppement de convertisseurs de puissance a repr√©sent√© environ 90% de mes commandes, les principaux co√ªts de main-d'≈ìuvre vont principalement au d√©veloppement de logiciels et au prototypage, √† la conception de circuits + au tra√ßage final de la carte du co√ªt total ne d√©passant g√©n√©ralement pas 10-15%.  Voici la compr√©hension que le processus de prototypage, qui comprend le d√©veloppement de logiciels, doit √™tre en quelque sorte r√©duit et optimis√©. <br><br>  Il y a au moins deux solutions comme toujours: acheter un d√©bogage pr√™t √† l'emploi, par exemple, aupr√®s de Texas Instrumets ou Infineon, mais ils sont g√©n√©ralement adapt√©s √† une t√¢che sp√©cifique et co√ªtent de 500 $ √† 5000 $, il n'y a aucune garantie qu'il y aura une commande similaire et cet investissement avec une forte probabilit√© est facile ne paiera pas. <br>  La deuxi√®me option est de le faire vous-m√™me, mais le faire √† fond est presque la m√™me chose que de lancer "+1 r√©vision de fer", ce qui entra√Ænera des d√©penses suppl√©mentaires pour le client.  Si ce n'est pas fait √† fond, alors comme d'habitude, tout sera √† la morve et quelque part quelque chose tombera et jusqu'√† la disposition, les composants et le calendrier. <br>  Apr√®s un certain temps, j'ai attir√© l'attention sur la solution la plus √©vidente.  C'est tellement simple et √©vident que pendant longtemps je me suis demand√© pourquoi le m√™me TI ou Infineon n'avait pas encore fait √ßa.  Maintenant, je vais parler de mon "illumination". <br><br>  Examinons certaines des topologies de convertisseurs de puissance les plus populaires: <br><br><img src="https://habrastorage.org/webt/d8/_c/0v/d8_c0v8ih8ydkihocalqkrqc2xw.png"><br><img src="https://habrastorage.org/webt/gt/hy/fn/gthyfnx_nnsjohhak7ls4xjszny.png"><br><img src="https://habrastorage.org/webt/bk/ag/qq/bkagqqyzbrqjntnfuxsrrvuxpyy.png"><br><img src="https://habrastorage.org/webt/0y/w0/xp/0yw0xpwofk5jjf47usbdrwglyfy.png"><br><img src="https://habrastorage.org/webt/-c/mz/z_/-cmzz_9skvlq8ux30pjluy0zkvi.png"><br><br>  Maintenant, regardez de nouveau attentivement.  J'ai peint sp√©cifiquement sans cerclage, seuls les composants cl√©s pour le rendre plus clair.  Qu'est-ce que ces topologies ont en commun?  La premi√®re chose qui attire votre attention est une s√©rie de points communs: <br><ul><li>  Toutes les topologies incluent les composants principaux - condensateurs, transistors et inductance (inductance ou transformateur).  Ce sont 3 baleines d'√©lectronique de puissance; </li><li>  Les transistors sont allum√©s partout de la m√™me mani√®re et forment ce que l'on appelle le "demi-pont".  Presque toutes les topologies de convertisseur sont construites √† partir de celui-ci; </li><li>  L'option d'activation du demi-pont + coupleur de condensateur ne change pas sur toutes les topologies.  Le type d'inductance et les options pour inclure des demi-ponts changent. </li></ul><br><br>  De cela, nous pouvons conclure que, ayant un certain module standard sous la forme d'un demi-pont + condensateur coupl√©, vous pouvez construire n'importe quel convertisseur en ajoutant uniquement l'inductance ou le transformateur n√©cessaire.  Par cons√©quent, la solution √©vidente pour simplifier le prototypage √©tait la cr√©ation d'un tel module: <br><img src="https://habrastorage.org/webt/vx/d6/ec/vxd6ec8swnwqef7v6uhkljsysek.png"><br><br><h2>  La lutte entre le bien et le mal </h2><br>  Malheureusement, un nombre limit√© d'heures par jour et une paresse banale dictent leurs conditions.  Je suis venu √† la n√©cessit√© de faire ce module il y a un an, mais la mise en ≈ìuvre a √©t√© constamment transf√©r√©e sous le slogan - <i>"Je le ferai certainement le week-end prochain!"</i>  . <br><br>  Peut-√™tre que l'id√©e serait rest√©e sur l'√©tag√®re, sinon pour 2 √©v√©nements.  Tout d'abord, 2 clients sont venus me voir en un mois et tout le monde voulait un convertisseur complexe et int√©ressant √† mettre en ≈ìuvre, et surtout, ils √©taient pr√™ts √† payer tr√®s bien.  Bien qu'il consid√®re qu'il vient d'Europe, cela peut avoir √©t√© bon march√© pour eux)) Les deux projets √©taient int√©ressants pour moi, par exemple, l'un d'eux √©tait un ¬´r√©gulateur de tension triphas√© avec isolation galvanique (sic!)¬ª, C'est-√†-dire un triphas√© PFC + 3 convertisseurs de pont (d√©phas√©s) + redresseur synchrone + onduleur triphas√©.  Tout cela sur SiC et tr√®s compact.  En g√©n√©ral, j'ai pris 2 grosses commandes, chacune d'entre elles ~ 800 heures-homme et une p√©riode de 6 mois.  En cons√©quence, j'ai √©t√© ¬´forc√©¬ª de chercher des moyens d'optimiser. <br><br>  Deuxi√®mement, des gars de la soci√©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PCBway m'ont</a> √©crit de mani√®re inattendue, beaucoup d'entre eux leur ont probablement command√© des planches et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m'ont</a> propos√© de coop√©rer.  Ils soutiennent tr√®s activement les projets de mat√©riel ouvert, c'est-√†-dire l'initiative m√™me du CERN - Mat√©riel open source.  La coop√©ration est simple, compr√©hensible pour les deux parties - ils me fournissent des tableaux gratuits pour mes projets, je les ouvre et les met sur leur site Web, dans d'autres endroits d√©j√† sur demande.  Pour moi, c'est devenu une motivation suppl√©mentaire, et surtout, ma conscience est claire, car  Depuis plusieurs ann√©es, je commande des planches pour leurs prototypes, et pour la production de masse, j'en parle √† mes amis et partenaires.  Maintenant, pour cela, j'ai aussi un chignon sous forme de tableaux gratuits pour les petits projets, vous pouvez souvent √©crire sur le hub)) <br><br>  Et puis la glace a √©clat√©, il a √©t√© d√©cid√© de cr√©er non seulement le module d√©crit pr√©c√©demment, mais tout un ensemble du d√©veloppeur d'√©lectronique de puissance et de le rendre ouvert et accessible √† tous. <br><br><h2>  Structure du projet </h2><br>  Au d√©but de l'article, j'ai mentionn√© que je ne vous parlerai que d'une partie aujourd'hui - c'est le <b>module de puissance du demi-pont</b> .  √Ä lui seul, il vous permet de cr√©er un convertisseur en vissant simplement un circuit de contr√¥le, par exemple, en d√©boguant STM32-Discovery, Arduino, TMS320, TL494 ou tout ce que vous poss√©dez l√†-bas.  Il n'y a aucune liaison avec aucune plate-forme ou MK. <br><br>  Seulement ce n'est pas tout le projet, mais une partie)) En quoi consiste le convertisseur de puissance fini?  Tout d'abord, le bloc d'alimentation a besoin d'un certain module de contr√¥le pour fonctionner, afin de comprendre ce qui se passe, une indication est n√©cessaire et pour comprendre ce qui se passe √† une distance de s√©curit√©, il existe √©galement une interface, par exemple, Modbus RTU ou CAN. <br><br>  En cons√©quence, la structure g√©n√©rale du projet ressemble √† ceci: <br><br> <a href=""><img src="https://habrastorage.org/webt/oh/tj/ix/ohtjixc8dimubg0tr7mbjym_aqc.png"></a> <br><br>  √Ä l'avenir, j'√©crirai probablement un programme de calcul de transformateurs et de selfs, conventionnels et plans.  Jusqu'√† pr√©sent.  Les diff√©rentes parties du sch√©ma sous forme de projet ont d√©j√† √©t√© impl√©ment√©es et ex√©cut√©es dans deux projets, apr√®s des modifications mineures, des articles seront √©galement √©crits dessus et le code source sera disponible. <br><br><h2>  Module d'alimentation demi-pont </h2><br>  Il est maintenant temps de regarder de plus pr√®s le h√©ros d'aujourd'hui.  Le module est universel et vous permet de travailler avec des transistors Mosfet et IGBT, des commutateurs basse tension et haute tension jusqu'√† 1200V. <br><br>  <u>Caract√©ristiques du module:</u> <br><ul><li>  Isolation galvanique du c√¥t√© commande (num√©rique) de l'alimentation.  Tension de claquage de l'isolant 3 kV; </li><li>  Les touches sup√©rieure et inf√©rieure sont ind√©pendantes, chacune a son propre pilote √† isolation galvanique et un courant continu / continu isol√© galvaniquement; </li><li>  Le pilote moderne d'Infineon - 1EDC60I12AHXUMA1 est appliqu√©.  Le courant d'impulsion d'ouverture / fermeture est de 6A / 10A.  Fr√©quence maximale - 1 MHz (test√© jusqu'√† 1,5 MHz de mani√®re stable); </li><li>  Protection du courant mat√©riel: shunt + ampli-op + comparateur + optocoupleur; </li><li>  Le courant maximum est de 20A.  Il n'est pas limit√© par les cl√©s, mais par la taille du radiateur et l'√©paisseur des polygones de cuivre. </li></ul><br><br>  La premi√®re r√©vision du module appara√Æt dans l'article, il est enti√®rement op√©rationnel, mais il y aura une deuxi√®me r√©vision, dans laquelle les d√©fauts purement de conception seront √©limin√©s et les connecteurs seront remplac√©s par des connecteurs plus pratiques.  Apr√®s avoir termin√© la documentation, il a jet√© le gerber dans PCBway et apr√®s 6 jours, le courrier a frapp√© √† ma porte et m'a tendu un tel charme: <br><br> <a href=""><img src="https://habrastorage.org/webt/bj/dw/lt/bjdwlt-ijg3_gdxfx0wfkwggk18.jpeg"></a> <br><br>  Une semaine plus tard, les <s>chiens ont</s> finalement apport√© des composants d'un beau magasin domestique.  En cons√©quence, tout a √©t√© mont√©: <br><br> <a href=""><img src="https://habrastorage.org/webt/kw/mv/cg/kwmvcghxvdiimkk9ili2zqfnorg.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ea/dg/cz/eadgczqqlkscl5n89r7ynnvyivm.jpeg"></a> <br><br>  Avant de continuer, regardons le sch√©ma du circuit du module.  Vous pouvez le t√©l√©charger ici - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PDF</a> . <br><br>  Il n'y a rien de compliqu√© ni de magique.  Le demi-pont habituel: 2 touches en bas, 2 en haut, vous pouvez souder une √† la fois.  Le conducteur, comme √©crit ci-dessus de la famille 1ED, est tr√®s diabolique et immortel.  Partout sur l'alimentation, il y a une indication, y compris + 12V √† la sortie cc / cc.  La protection est mise en ≈ìuvre sur l'√©l√©ment logique ET, si le courant est d√©pass√©, le comparateur produira + 3,3 V, il illuminera l'optocoupleur et il attirera l'une des entr√©es ET √† la terre, ce qui signifie l'√©tablissement de log.0 et le signal PWM des pilotes dispara√Ætra.  ET avec 3 entr√©es a √©t√© utilis√© sp√©cifiquement, dans la prochaine r√©vision, je pr√©vois de faire une protection contre la surchauffe par le radiateur et de d√©marrer le signal d'erreur l√† aussi.  Toutes les sources seront √† la fin de l'article. <br><br><h2>  Nous assemblons la disposition de l'onduleur </h2><br>  J'ai longuement r√©fl√©chi √† la fa√ßon de d√©montrer le fonctionnement du module, afin qu'il ne soit pas tr√®s ennuyeux, utile et pas tr√®s difficile, afin que n'importe qui puisse le r√©p√©ter.  Par cons√©quent, je me suis arr√™t√© sur un onduleur, ils sont utilis√©s pour travailler avec des panneaux solaires, si quelque chose sent du c√¥t√© basse tension, ce n'est pas effrayant, mais du c√¥t√© haute tension, juste au moment o√π vous l'allumez, ne mettez pas les mains dedans. <br><br>  L'onduleur lui-m√™me est tr√®s simple, au fait, MAP Energy est riv√© comme √ßa, voici un exemple de la mise en ≈ìuvre commerciale de cette id√©e.  Le travail de l'onduleur est de former une variable sinuso√Ødale avec une fr√©quence de 50 Hz √† partir d'une tension 12V DC, car c'est avec cela qu'un transformateur conventionnel √† 50 Hz est habitu√© √† fonctionner.  J'utilise une sorte de sovi√©tique, comme l'OSM, un enroulement d'usine 220V et est utilis√© comme secondaire, et le ~ 8V primaire est enroul√© avec un bus en cuivre.  Cela ressemble √† ceci: <br><br> <a href=""><img src="https://habrastorage.org/webt/xf/6c/js/xf6cjsweiig-ter1invjtnfslci.jpeg"></a> <br><br>  Et ce monstre ne fait que 400 watts!  Le poids du transformateur est d'environ 5-7 kg, selon les sensations, si vous le laissez tomber sur votre jambe, ils ne seront certainement pas emmen√©s dans l'arm√©e.  En fait, c'est le moins des onduleurs avec des transformateurs "en fer", ils sont √©normes et lourds.  Leur avantage est que ces onduleurs sont tellement simples, ne n√©cessitent aucune exp√©rience de cr√©ation et bien s√ªr ils sont bon march√©. <br><br>  Connectons maintenant les modules et le transformateur.  En fait, le module pour le d√©veloppeur doit √™tre pr√©sent√© simplement comme une ¬´bo√Æte noire¬ª qui a une entr√©e de 2 PWM et 3 sorties de puissance: VCC, GND et la sortie demi-pont elle-m√™me. <br><br><img src="https://habrastorage.org/webt/yt/4f/l5/yt4fl55ueuuzkxi2ytlanqt_z58.png"><br><br>  Maintenant, √† partir de ces "bo√Ætes noires", dessinons notre onduleur: <br><br><img src="https://habrastorage.org/webt/ht/ar/pu/htarpuz2ma1w3bduxmbpculsxia.png"><br><br>  Oui, il n'a fallu que 3 √©l√©ments externes: un transformateur + un filtre LC.  Pour ce dernier, j'ai fait un starter simplement en enroulant le fil du module au transformateur sur un anneau en mat√©riau Kool Mu, de taille R32 avec une perm√©abilit√© de 60, et une inductance d'environ 10 ŒºH.  Bien s√ªr, l'acc√©l√©rateur doit √™tre calcul√©, mais nous avons besoin de 15 minutes)) En g√©n√©ral, si vous conduisez quelque chose comme √ßa √† 400 W, vous avez besoin d'un anneau de taille R46 (c'est le diam√®tre ext√©rieur).  Capacit√© - film 1-10 uF, cela suffit.  En fait, vous ne pouvez pas d√©finir le condensateur comme une √©conomie, car la capacit√© d'enroulement du transformateur est saine ... en g√©n√©ral, les Chinois et le MAP l'ont fait)) L'inductance ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/b0/wl/zy/b0wlzyrj0gxbmarg2rz5kuppdoc.jpeg"><br><br>  Reste √† lancer une charge de test sur la sortie, j'ai quelques ampoules LED 20 W (rien d'autre n'√©tait √† port√©e de main), elles mangent elles-m√™mes 24 W, cependant, l'efficacit√©.  De plus, le courant en circuit ouvert du transformateur est d'environ 1A.  Avec la batterie va manger environ 5A.  En cons√©quence, nous avons un tel stand: <br><br> <a href=""><img src="https://habrastorage.org/webt/3s/w2/q2/3sw2q2qvocpryrps6vj4ynvwavo.jpeg"></a> <br><br>  De plus, la disposition utilise la batterie Delta HR12-17, respectivement, √† 12V et avec une capacit√© de 17 A * h.  Nous contr√¥lerons le convertisseur √† partir de la carte de d√©bogage STM32F469-Discovery. <br><br><h2>  Code </h2><br>  Initialement, il √©tait pr√©vu d'utiliser mon STM32VL-Disco, qui a √©t√© re√ßu √† l'exposition en 2010, pour le contr√¥le, mais il se trouve que c'est sur cette mise en page qu'elle √©tait destin√©e √† mourir lorsque tout le code a √©t√© √©crit et que la mise en page a √©t√© lanc√©e.  J'ai oubli√© les sondes de l'oscilloscope et combin√© 2 terres, amen.  Du coup, tout a √©t√© r√©√©crit sur STM32F469NIH6, c'est ce d√©bogage qui √©tait √† port√©e de main, donc il y aura 2 projets: pour le F100 et pour le F469, les deux sont v√©rifi√©s.  Le projet est con√ßu pour TrueSTUDIO, la version √©clipse de ST. <br><br><div class="spoiler">  <b class="spoiler_title">Code du chausson</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/********************************************* Sinus table **********************************************************/</span></span></span><span class="hljs-meta"> uint16_t sinData[240] = {0,13,26,39,52,65,78,91,104,117,130,143,156,169,182,195,207,220,233,246,258,271,284,296,309,321,333,346,358,370, 382,394,406,418,430,442,453,465,477,488,500,511,522,533,544,555,566,577,587,598,608,619,629,639,649,659,669,678,688,697, 707,716,725,734,743,751,760,768,777,785,793,801,809,816,824,831,838,845,852,859,866,872,878,884,891,896,902,908,913,918, 923,928,933,938,942,946,951,955,958,962,965,969,972,975,978,980,983,985,987,989,991,993,994,995,996,997,998,999,999,999, 999,999,999,998,997,996,995,994,993,991,989,987,985,983,980,978,975,972,969,965,962,958,955,951,946,942,938,933,928,923, 918,913,908,902,896,891,884,878,872,866,859,852,845,838,831,824,816,809,801,793,785,777,768,760,751,743,734,725,716,707, 697,688,678,669,659,649,639,629,619,608,598,587,577,566,555,544,533,522,511,500,488,477,465,453,442,430,418,406,394,382, 370,358,346,333,321,309,296,284,271,258,246,233,220,207,195,182,169,156,143,130,117,104,91,78,65,52,39,26,13,0}; uint16_t sinStep; uint8_t sinStatus; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/******************************************** Used functions ********************************************************/</span></span></span><span class="hljs-meta"> void StartInitClock (void) { RCC-&gt;CR |= RCC_CR_HSEON; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Enable HSE while (!(RCC-&gt;CR &amp; RCC_CR_HSERDY)); FLASH-&gt;ACR |= FLASH_ACR_LATENCY_5WS; RCC-&gt;PLLCFGR = 0x00; RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLM_3; // Div for HSE = 8 RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLN_4 | RCC_PLLCFGR_PLLN_5 | RCC_PLLCFGR_PLLN_6 | RCC_PLLCFGR_PLLN_7; // PLL mult x240 RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLSRC; // Source HSE RCC-&gt;CR |= RCC_CR_PLLON; while((RCC-&gt;CR &amp; RCC_CR_PLLRDY) == 0){} RCC-&gt;CFGR &amp;= ~RCC_CFGR_SW; RCC-&gt;CFGR |= RCC_CFGR_SW_PLL; // Select source SYSCLK = PLL while((RCC-&gt;CFGR &amp; RCC_CFGR_SWS) != RCC_CFGR_SWS_1) {} // Wait till PLL is used RCC-&gt;CR |= RCC_CR_PLLSAION; while ((RCC-&gt;CR &amp; RCC_CR_PLLSAIRDY) == 0) {} } void EnableOutputMCO (void) { RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOAEN; // Enable clock port A GPIOA-&gt;MODER &amp;= ~GPIO_MODER_MODER8; GPIOA-&gt;MODER |= GPIO_MODER_MODER8_1; // Alternative PP GPIOA-&gt;OSPEEDR |= GPIO_OSPEEDER_OSPEEDR8; // Very high speed RCC-&gt;CFGR |= RCC_CFGR_MCO1; // Source PLL RCC-&gt;CFGR &amp;= ~RCC_CFGR_MCO1PRE; // Div = 1 } void InitIndicatorLED (void) { /* * LED1 - PG6 * LED2 - PD4 * LED3 - PD5 * LED4 - PK3 */ RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOGEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIODEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOKEN; GPIOG-&gt;MODER &amp;= ~GPIO_MODER_MODER6; GPIOG-&gt;MODER |= GPIO_MODER_MODER6_0; // Output PP GPIOD-&gt;MODER &amp;= ~GPIO_MODER_MODER4; GPIOD-&gt;MODER |= GPIO_MODER_MODER4_0; // Output PP GPIOD-&gt;MODER &amp;= ~GPIO_MODER_MODER5; GPIOD-&gt;MODER |= GPIO_MODER_MODER5_0; // Output PP GPIOK-&gt;MODER &amp;= ~GPIO_MODER_MODER3; GPIOK-&gt;MODER |= GPIO_MODER_MODER3_0; // Output PP } void EnableIndicatorLED (void) { GPIOG-&gt;BSRR |= GPIO_BSRR_BR_6; GPIOD-&gt;BSRR |= GPIO_BSRR_BR_4; GPIOD-&gt;BSRR |= GPIO_BSRR_BR_5; GPIOK-&gt;BSRR |= GPIO_BSRR_BR_3; } void InitLowPWM (void) { /* * TIM1-CH1 - PA8 * TIM1-CH1N - PB13 */ RCC-&gt;APB2ENR |= RCC_APB2ENR_TIM1EN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOAEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOBEN; /*********** GPIO **********/ GPIOA-&gt;MODER &amp;= ~GPIO_MODER_MODER8; GPIOA-&gt;MODER |= GPIO_MODER_MODER8_1; // Alternative output PP GPIOA-&gt;AFR[1] |= GPIO_AFRH_AFRH0_0; // Select TIM1-CH1 GPIOB-&gt;MODER &amp;= ~GPIO_MODER_MODER13; GPIOB-&gt;MODER |= GPIO_MODER_MODER13_1; // Alternative output PP GPIOB-&gt;AFR[1] |= GPIO_AFRH_AFRH5_0; // Select TIM1-CH1N /*********** Timer *********/ TIM1-&gt;PSC = 2400-1; // div for clock: F = SYSCLK / [PSC + 1] TIM1-&gt;ARR = 1000; // count to 1000 TIM1-&gt;CR1 &amp;= ~TIM_CR1_CKD; // div for dead-time: Tdts = 1/Fosc = 41.6 ns TIM1-&gt;CCR1 = 500; // duty cycle 50% TIM1-&gt;CCER |= TIM_CCER_CC1E | TIM_CCER_CC1NE; // enable PWM complementary out to PB15 and to PA10 TIM1-&gt;CCER &amp;= ~TIM_CCER_CC1NP; // active high level: 0 - high, 1 - low TIM1-&gt;CCMR1 &amp;= ~TIM_CCMR1_OC1M; TIM1-&gt;CCMR1 |= TIM_CCMR1_OC1M_2 | TIM_CCMR1_OC1M_1; // positiv PWM1_CH3 and PWM1_CH3N TIM1-&gt;BDTR &amp;= ~TIM_BDTR_DTG; // clear register TIM1-&gt;BDTR |= TIM_BDTR_DTG_2 | TIM_BDTR_DTG_1 | TIM_BDTR_DTG_0; // value dead-time: = 31*Tdts = 32*41,6ns = 1.29us TIM1-&gt;BDTR |= TIM_BDTR_MOE | TIM_BDTR_AOE; // enable generation output and dead-time TIM1-&gt;CR1 &amp;= ~TIM_CR1_DIR; // count up: 0 - up, 1 - down TIM1-&gt;CR1 &amp;= ~TIM_CR1_CMS; // aligned on the front signal: 00 - front; 01, 10, 11 - center TIM1-&gt;CR1 |= TIM_CR1_CEN; // start count } void InitSinusPWM (void) { /* * TIM3-CH1 - PB4 * TIM3-CH2 - PC7 */ RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM3EN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOBEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOCEN; /*********** GPIO **********/ GPIOB-&gt;MODER &amp;= ~GPIO_MODER_MODER4; GPIOB-&gt;MODER |= GPIO_MODER_MODER4_1; // Alternative output PP GPIOB-&gt;AFR[0] |= GPIO_AFRL_AFRL4_1; // Select TIM3-CH1 GPIOC-&gt;MODER &amp;= ~GPIO_MODER_MODER7; GPIOC-&gt;MODER |= GPIO_MODER_MODER7_1; // Alternative output PP GPIOC-&gt;AFR[0] |= GPIO_AFRL_AFRL7_1; // Select TIM3-CH2 /*********** Timer *********/ TIM3-&gt;PSC = 5-1; // div for clock: F = SYSCLK / [PSC + 1] TIM3-&gt;ARR = 1000; // count to 1000 TIM3-&gt;CCR1 = 0; // duty cycle 0% TIM3-&gt;CCR2 = 0; // duty cycle 0% TIM3-&gt;CCER |= TIM_CCER_CC1E; // enable PWM out to PA8 TIM3-&gt;CCER &amp;= ~TIM_CCER_CC1P; // active high level: 0 - high, 1 - low TIM3-&gt;CCER |= TIM_CCER_CC2E; // enable PWM complementary out to PA9 TIM3-&gt;CCER &amp;= ~TIM_CCER_CC1P; // active high level: 0 - high, 1 - low TIM3-&gt;CCMR1 &amp;= ~(TIM_CCMR1_OC1M | TIM_CCMR1_OC2M); TIM3-&gt;CCMR1 |= TIM_CCMR1_OC1M_2 | TIM_CCMR1_OC1M_1 | TIM_CCMR1_OC2M_2 | TIM_CCMR1_OC2M_1; // positiv PWM1_CH1 and PWM1_CH2 TIM3-&gt;CR1 &amp;= ~TIM_CR1_DIR; // count up: 0 - up, 1 - down TIM3-&gt;CR1 &amp;= ~TIM_CR1_CMS; // aligned on the front signal: 00 - front; 01, 10, 11 - center TIM3-&gt;CR1 |= TIM_CR1_CEN; // start count } void InitStepSinus (void) { RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM6EN; // enable clock for basic TIM6 TIM6-&gt;PSC = 5-1; // div, frequency 24 kHz TIM6-&gt;ARR = 1000; // count to 1000 TIM6-&gt;DIER |= TIM_DIER_UIE; // enable interrupt for timer TIM6-&gt;CR1 |= TIM_CR1_CEN; // start count NVIC_EnableIRQ(TIM6_DAC_IRQn); // enable interrupt TIM6_DAC_IRQn } /************************************* Main code *********************************************/ int main (void) { StartInitClock(); // EnableOutputMCO(); InitIndicatorLED(); InitLowPWM(); InitSinusPWM(); InitStepSinus(); EnableIndicatorLED(); while(1) { } } /****************************** Interrupts ******************************************************/ void TIM6_DAC_IRQHandler (void) { TIM6-&gt;SR &amp;= ~TIM_SR_UIF; if (sinStatus == 0) {TIM3-&gt;CCR1 = sinData[sinStep];} if (sinStatus == 1) {TIM3-&gt;CCR2 = sinData[sinStep];} sinStep++; if (sinStep &gt;= 240) { sinStep = 0; sinStatus = sinStatus ? 0 : 1; } }</span></span></span></span></code> </pre> <br></div></div><br>  En g√©n√©ral, dans un autre article, il a d√©crit en d√©tail et clairement comment g√©n√©rer un signal sinuso√Ødal, comment √©crire du code, etc.  Vous pouvez le lire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  As-tu lu?  Envie de collectionner?  Gardez le projet: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Projet pour F469</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Projet pour F100</a> </li></ul><br>  Nous ex√©cutons le code, nous armons d'un oscilloscope et passons √† autre chose.  Tout d'abord, on v√©rifie la pr√©sence d'un signal √† l'entr√©e des drivers, √ßa devrait √™tre comme √ßa: <br><br><img src="https://habrastorage.org/webt/nd/gc/5f/ndgc5fcjhtwnxk_oxdwnanbwtkq.png"><br><br>  Il est √† noter que je donne 2 signaux dessinant un sinus sur un demi-pont (module), et 50 Hz sur 2 signaux.  De plus, une diagonale est ¬´rouge + jaune¬ª et l'autre ¬´bleu + vert¬ª.  Dans l'article que j'ai donn√© ci-dessus, cela est √©crit en d√©tail, si vous ne comprenez pas soudainement.  Maintenant, comme les signaux sont arriv√©s, nous avons mis √† la fois un demi-pont + 12V et GND √† partir de l'alimentation du laboratoire.  Imm√©diatement, la batterie ne le conseille pas, si vous faites une erreur quelque part, alors quelque chose peut br√ªler.  La protection sur la carte √©vite les surintensit√©s, mais pas les jambages √©vidents, lorsque le plus et le moins sont m√©lang√©s, mais le technicien de laboratoire √©conomise.  12V et 1A suffisent pour les tests.  Nous prenons la sonde de l'oscilloscope, son fil de terre √† la sortie du premier demi-pont, et la sonde elle-m√™me √† la sortie de l'autre demi-pont, et il devrait y avoir une telle image: <br><br><img src="https://habrastorage.org/webt/px/6j/fk/px6jfknnkrrf4y_l09t-_h9csfk.png"><br><br>  O√π est le sinus que vous demandez?  Le fait est que la r√©sistance d'entr√©e de l'oscilloscope est grande et qu'elle ne constitue pas une charge, donc le courant ne circule pas et il n'y a pas d'o√π obtenir le sinus.  Ajoutez une charge, j'ai fait une charge de 90 ohms √† partir de r√©sistances de 10 ohms en allumant simplement 9 pi√®ces en s√©rie.  Nous accrochons la charge aux sorties des demi-ponts et voyons l'image suivante: <br><br><img src="https://habrastorage.org/webt/a1/ro/7b/a1ro7ba6mmxhagnpiyau1mjstqo.png"><br><br>  Avez-vous la m√™me chose?  Il est donc temps de connecter l'inductance, le transformateur, la charge et d'essayer de d√©marrer.  <b>Achtung!</b>  <b>Vous ne pouvez pas allumer ce mod√®le sans charge, car au ralenti, la sortie peut aller jusqu'√† 350 ... 380V.</b>  <b>Pour que cela ne n√©cessite pas de charge ou de syst√®me d'exploitation.</b>  Nous n'aurons pas le dernier, c'est le sujet d'un article s√©par√©, vous pouvez, en option, attacher le P-contr√¥leur le plus simple, vous avez d√©j√† un mod√®le de projet. <br><br><h2>  Inclusion </h2><br>  Apr√®s la mise sous tension, nous obtenons environ 230 V en sortie, la sortie n'est certainement pas stabilis√©e et flottera de 230 V + -30 V, pour les tests √ßa ira, dans un autre article nous finaliserons la disposition alors que je d√©cide de parler des contr√¥leurs P et PI et de leur impl√©mentation. <br><br>  Maintenant, vous pouvez profiter du r√©sultat du travail et, si n√©cessaire, tout mettre dans une bo√Æte et m√™me l'appliquer √† la ferme ou √† la campagne pour vous fournir de la lumi√®re et d'autres commodit√©s. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Te0OhTMt0Tk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Vous avez probablement remarqu√© un d√©lai entre le ¬´clic¬ª, c'est-√†-dire la mise sous tension du Discovery et l'allumage des lampes - c'est le temps que le MK a consacr√© √† l'initialisation.  Ce d√©lai peut √™tre r√©duit en √©crivant un seul chiffre dans le registre √† la fois, plut√¥t qu'en divisant l'entr√©e de registre en un tas de lignes.  Je l'ai √©cras√© √† des fins d'illustration uniquement.  Bien que cela ne soit pas effrayant, avec le code HAL, le d√©lai est 3 fois plus long et les gens vivent avec lui en quelque sorte)) <br><br>  Jusqu'√† ce que j'oublie, la source du projet: <br><br><ul><li>  Sch√©ma de principe - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PDF</a> </li><li>  BOM - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Excel</a> </li><li>  Fichiers Gerber - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RAR</a> </li></ul><br><br>  Reste √† voir comment √ßa se passe avec les temp√©ratures sur la planche, s'il y a des points particuli√®rement chauds.  5-6A n'est certainement pas suffisant, mais s'il y a un courant traversant ou une erreur grave, cela suffit pour transformer la carte en bouilloire: <br><br><img src="https://habrastorage.org/webt/xz/fp/ln/xzfplnlxfklygc-vjabjtpws1em.png"><br><br>  Comme vous pouvez le voir, l'√©l√©ment le plus chaud est le module cc / cc pour l'isolation galvanique, qui est de 2 watts, il chauffe jusqu'√† 34 degr√©s, eh bien, √©galement un shunt.  Les transistors et le radiateur eux-m√™mes ont une temp√©rature ambiante apr√®s 30 minutes de fonctionnement du convertisseur)) <br><br><h2>  Merci et plans </h2><br>  Dans un avenir proche, je pr√©vois d'√©crire sur la carte DSP et de la g√©rer non pas √† partir de la d√©couverte de d√©bogage, mais √† partir du module ¬´sp√©cialis√©¬ª.  Les cartes de la 2√®me r√©vision lui sont venues du m√™me PCBway, j'attends les composants et √©cris imm√©diatement. <br><br>  J'esp√®re que vous avez appr√©ci√© l'article et l'id√©e elle-m√™me.  √Ä l'avenir, sur les m√™mes modules, je montrerai comment assembler un chastotnik, un contr√¥leur mppt ou peut-√™tre autre chose d'int√©ressant.  Si vous avez des questions, n'h√©sitez pas √† les poser dans les commentaires ou en PM, si tout √† coup vous n'avez pas de compte complet, je vais essayer de r√©pondre √† toutes les questions. <br><br>  Maintenant, gr√¢ce √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PCBway</a> , c'est vraiment tr√®s bien qu'ils prennent en charge le moteur open source.  Bient√¥t, les fabricants de mat√©riel pourraient m√™me rattraper les auteurs de logiciels en termes de nombre et de qualit√© des projets open source. <br><br><img src="https://habrastorage.org/webt/hm/pu/px/hmpupxkj9ov6-oum1vvnqmi0oqu.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428550/">https://habr.com/ru/post/fr428550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428540/index.html">Les essais cliniques ont montr√© une diminution de plus de la moiti√© de la progression de la maladie d'Alzheimer</a></li>
<li><a href="../fr428542/index.html">Les touristes dans l'Union europ√©enne seront contr√¥l√©s √† l'aide de l'IA</a></li>
<li><a href="../fr428544/index.html">Une vuln√©rabilit√© dans Bluetooth ouvre des possibilit√©s d'attaques contre les points d'acc√®s sans fil</a></li>
<li><a href="../fr428546/index.html">Trois ans de technologie. soutien, 152 √©tablissements de sant√©, 3740 pcs</a></li>
<li><a href="../fr428548/index.html">Programmation orient√©e aspect, Spring AOP</a></li>
<li><a href="../fr428552/index.html">Algorithme: comment trouver la prochaine permutation lexicographique</a></li>
<li><a href="../fr428556/index.html">¬´L'environnement de production est hors de votre contr√¥le¬ª: Rian Lewis sur les tests de projets de blockchain</a></li>
<li><a href="../fr428558/index.html">Comment j'ai cr√©√© un assistant pour WordPress √† partir de ma profonde paresse</a></li>
<li><a href="../fr428560/index.html">Annonce impr√©vue de vendredi</a></li>
<li><a href="../fr428562/index.html">Droidcon Londres. Comment c'√©tait</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>