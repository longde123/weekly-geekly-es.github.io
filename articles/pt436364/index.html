<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👧‍👦 🚳 👈🏾 O Liveprof mostrará quando e por que o desempenho do seu aplicativo PHP mudou 🆚 👩🏿‍🤝‍👨🏻 👩🏽‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá Habr! Meu nome é Timur Shagiakhmetov, sou desenvolvedor de PHP no Badoo . 

 O desempenho do aplicativo é um dos critérios mais importantes para a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O Liveprof mostrará quando e por que o desempenho do seu aplicativo PHP mudou</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/436364/"><img src="https://habrastorage.org/webt/sm/5p/or/sm5porzvybv5m_8ngvmgicgmeui.jpeg"><br><br>  Olá Habr!  Meu nome é Timur Shagiakhmetov, sou desenvolvedor de PHP no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Badoo</a> . <br><br>  O desempenho do aplicativo é um dos critérios mais importantes para a qualidade do trabalho de um programador.  Em questões de otimização de aplicativos PHP, o assistente é o criador de perfil. <br><br>  Recentemente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conversamos</a> sobre quais ferramentas usamos para criar perfis.  Deixe-me lembrá-lo: uma das ferramentas para análise de desempenho, quando não está claro quais partes do código influenciaram o aumento no tempo de geração de resposta, é o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XHProf</a> .  Essa é uma extensão do PHP que permite criar um perfil do código em um servidor de combate e melhorá-lo posteriormente. <br><br>  Mas eu também gostaria de ter um histórico de alterações no desempenho para que você possa acompanhar o que e quando afetou sua deterioração, certo?  Para fazer isso, há cerca de um ano, desenvolvemos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Liveprof</a> , uma ferramenta para a criação automática de perfil de todas as solicitações com uma interface para analisar as alterações no desempenho do aplicativo. <br><br>  Nossa ferramenta permite que você analise a alteração de desempenho de qualquer parte do código, encontre os locais onde mais caiu.  Ao mesmo tempo, ele não precisa ser ativado especificamente e aguardar a acumulação de estatísticas - ele está sempre ativo e coleta dados para uma determinada fração de todas as solicitações. <br><br>  Neste artigo, falarei sobre os detalhes da implementação e os recursos do uso desta ferramenta. <br><a name="habracut"></a><br><h2>  Um pouco sobre o XHProf </h2><br>  Primeiro, algumas palavras sobre os recursos do próprio XHProf.  Este é um criador de perfil para PHP escrito em C como uma extensão.  Foi desenvolvido no Facebook e publicado em domínio público.  Possui vários garfos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uprofiler</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tideways</a> ), totalmente compatíveis no nível do formato dos dados de saída. <br><br>  XHProf define temporizadores em todas as chamadas de função / método.  Seu uso envolve alguma sobrecarga.  Mas eles não são tão grandes e permitem usá-lo na produção. <br><br>  O resultado de XHProf é uma matriz de elementos no seguinte formato: <br><br><pre><code class="php hljs">$data = [ <span class="hljs-string"><span class="hljs-string">'parentMethodName==&gt;childMethodName'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'ct'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">'wt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-string"><span class="hljs-string">'mu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">528</span></span> <span class="hljs-string"><span class="hljs-string">'pmu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ] ];</code> </pre> <br>  onde <br><br>  <code><b>parentMethodName</b></code> e <code><b>childMethodName</b></code> são os métodos pai e filho, respectivamente; <br>  <code><b>ct</b></code> - o número de chamadas no contexto da solicitação; <br>  <code><b>wt</b></code> - tempo de execução da solicitação (consiste no tempo gasto pelo processador e no tempo de espera pela E / S ou pela resposta de outro serviço); <br>  <code><b>cpu</b></code> - tempo gasto pelo processador no processamento da solicitação; <br>  <code><b>mu</b></code> - alteração no consumo de memória após uma chamada de método; <br>  <code><b>pmu</b></code> - alteração no consumo máximo de memória após uma chamada de método. <br><br>  Algumas outras opções também são possíveis. <br><br>  O XHProf também contém ferramentas para visualizar os resultados assim obtidos.  Para cada operação de criação de perfil, obtemos uma tabela com um conjunto de parâmetros para cada método. <br><br>  Por exemplo <br><br><div class="spoiler">  <b class="spoiler_title">resultado de classificação de bolhas</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $count)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $array = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $count; $i++) { $array[] = rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $array; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BubbleSorter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len ; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; $len - $i - <span class="hljs-number"><span class="hljs-number">1</span></span>; $j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$j] &gt; $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;swap($array[$j], $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]); } } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$a, &amp;$b)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $tmp = $a; $a = $b; $b = $tmp; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSorted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len - <span class="hljs-number"><span class="hljs-number">1</span></span>; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$i] &gt; $array[$i + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayPrinter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array, string $delimiter = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">' '</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> implode($delimiter, $array) . PHP_EOL; } } xhprof_enable(); $n = <span class="hljs-number"><span class="hljs-number">10</span></span>; $arrayGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayGenerator(); $array = $arrayGenerator-&gt;getRandomArray($n); $sorter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BubbleSorter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$sorter-&gt;isSorted($array)) { $sorter-&gt;sort($array); } $printer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayPrinter(); $printer-&gt;print($array); $xhprof_data = xhprof_disable();</code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/ip/cw/vi/ipcwviocimg7kjon1memwwziho8.png"><br><br>  Você pode entrar em cada método para descobrir quais métodos utilizaram quantos recursos. <br><br>  Você também pode ver o gráfico de chamadas destacando os métodos que mais consomem recursos: <br><br><img src="https://habrastorage.org/webt/zq/yw/pl/zqywplc0eibbdxdotsr3f0bed_o.png"><br><br>  XHProf é útil para analisar manualmente o desempenho de cada solicitação.  Mas também é importante vermos o quadro geral.  Você precisa entender como o desempenho mudou ao longo do tempo.  Para isso, foi desenvolvida uma ferramenta que perfila as consultas no modo automático e permite analisá-las na interface da web. <br><br><h2>  Liveprof: agregue resultados e mantenha o histórico </h2><br>  Como obter o histórico de criação de perfil? <br><br>  Primeiro, você precisa configurar o início automático do criador de perfil e salvar os resultados.  O desempenho não é constante e varia de um lançamento para o outro.  Para evitar a influência de tais flutuações, usamos os dados médios de várias consultas.  Como resultado, obtemos resultados agregados para cada consulta, por exemplo, mínimo, máximo, média e percentil 95.  Isso ajuda a encontrar coisas difíceis que podem não ser necessárias para cada solicitação. <br><br>  Nossa ferramenta tem vantagens e algumas limitações. <br><br><h3>  O que o agregador pode fazer: </h3><br><ol><li>  Perfil automático de cada enésima solicitação. <br></li><li>  Agregação diária de perfis coletados. <br></li><li>  A capacidade de ver gráficos de alterações em cada parâmetro medido pelo criador de perfil.  Por exemplo, wt, cpu, mu, pmu descritos acima. <br></li><li>  Veja a alteração no desempenho de qualquer método por um determinado intervalo. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gráfico de chama com</a> base nos dados agregados mais recentes. <br></li><li>  Encontre consultas que chamam um método específico <br></li></ol><br><h3>  Limitações: </h3><br><ol><li>  Como nossa ferramenta é agregada, não é possível descobrir o desempenho de uma consulta (por exemplo, a mais lenta) - obtemos a média dos resultados no último dia.  Mas isso é suficiente para avaliar a dinâmica geral do desempenho.  Se alguma solicitação caiu na velocidade de execução, o valor médio, o percentil 95 e o tempo máximo de execução serão alterados. <br></li><li>  Você não pode restaurar inequivocamente a pilha de chamadas completa, pois XHProf retorna apenas pares pai-filho exclusivos com a soma dos valores dos recursos gastos. <br></li><li>  Solicite um erro de tempo de execução relacionado à sobrecarga do XHProf.  A diferença não é tão grande, mas deve ser levada em consideração ao medir o tempo de execução da consulta. <br></li></ol><br><h3>  Como usar o profiler </h3><br><ol><li>  Primeiro, o criador de perfil precisa estar conectado ao site ou script.  A maneira mais conveniente de usar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramenta é iniciar automaticamente o criador de perfil</a> : <br><br><pre> <code class="plaintext hljs">php composer.phar require badoo/liveprof # Run a script to configure database LIVE_PROFILER_CONNECTION_URL=mysql://db_user:db_password@db_mysql:3306/Profiler?charset=utf8 php vendor/badoo/liveprof/bin/install.php</code> </pre><br>  Ele suporta versões do PHP a partir da 5.4, e seu uso é repleto de sobrecarga mínima, o que permite usá-lo em um ambiente de combate.  A ferramenta detecta automaticamente a extensão do criador de perfil usada: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">XHProf</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uprofiler</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tideways</a> .  Na inicialização, você precisa especificar parâmetros para conectar-se ao banco de dados e às configurações de perfil. <br><br>  Exemplo de uso no código com configurações padrão: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'vendor/autoload.php'</span></span>; \Badoo\LiveProfiler\LiveProfiler::getInstance()-&gt;start(); <span class="hljs-comment"><span class="hljs-comment">// Code is here</span></span></code> </pre> <br>  Os resultados da criação de perfil são salvos no banco de dados.  Uma vez por dia, ocorre um processo de agregação.  Para fazer isso, selecione todos os registros para uma solicitação específica por dia e calcule as funções agregadas para cada um dos parâmetros.  As funções de agregação podem ser expandidas ou redefinidas. <br><br>  Agora estão disponíveis os seguintes: <br><br><ul><li>  pelo menos por dia; </li><li>  máximo por dia; </li><li>  média diária </li><li>  Percentil 95 do dia. </li></ul><br></li><li>  O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">web client</a> agregador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">é</a> usado para configurar a agregação e visualizar os resultados.  A maneira mais fácil de instalá-lo em um contêiner de docker: <br><br><pre> <code class="php hljs">git <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> https:<span class="hljs-comment"><span class="hljs-comment">//github.com/badoo/liveprof-ui.git cd liveprof-ui docker-compose up web</span></span></code> </pre> </li><li>  Antes do primeiro início, você precisa configurar os parâmetros de conexão com o banco de dados, uma lista de campos e funções agregadas usadas no arquivo de configuração src / config / services.yaml.  Em seguida, execute o script de instalação: <br><br><pre> <code class="php hljs">docker-compose exec web bash install.sh</code> </pre> </li><li>  É necessário registrar automaticamente scripts de agregação e limpeza de dados antigos em coroas: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># script aggregates all profiles for previous day, add it if you don't use a queue for aggregation jobs (parameter aggregator.use_jobs_in_aggregation=false) 0 2 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:aggregate-all-profiles' web # script removes old aggregated data, by default &gt; 200 days 0 1 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:remove-old-profiles' web 200</span></span></code> </pre> <br></li><li>  Para preencher com dados de teste, você pode executar o script: <br><br><pre> <code class="php hljs">docker-compose exec web php /app/bin/cli.php example:a-week-degradation</code> </pre> </li></ol><br><h2>  Descrição da interface </h2><br>  A interface da web está disponível em: 127.0.0.1:8000. <br><br>  Por padrão, uma página com uma lista de consultas agregadas é aberta.  Torna mais fácil encontrar uma consulta de interesse, classificar todas as consultas por qualquer um dos parâmetros e também agregar novamente uma consulta específica para ver os resultados mais recentes: <br><br><img src="https://habrastorage.org/webt/qj/-d/6b/qj-d6bj1095huwhvqmzdwim1g6k.png"><br><br>  Uma página com uma lista de métodos e gráficos de alterações de desempenho é a mais usada ao trabalhar com a ferramenta.  Ele permite que você percorra a pilha de chamadas, observe o consumo de cada parâmetro, bem como gráficos de alterações de desempenho por um determinado intervalo: <br><br><img src="https://habrastorage.org/webt/-6/ag/u4/-6agu45zuu1qs77tckpkngabjwq.png"><br><br>  <i>Uma página com uma lista completa dos métodos chamados permite encontrar rapidamente o método de interesse e ver os gráficos, indo para a página de gráficos:</i> <br><br><img src="https://habrastorage.org/webt/nj/g-/f_/njg-f_48jsuo8mcmlxuq1ukxj_4.png"><br>  <i>A página com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gráfico de chama da</a> última consulta agregada permite identificar visualmente as partes mais pesadas.</i> <br><br>  O uso do XHProf impõe algumas limitações na precisão do resultado.  Isso ocorre porque o criador de perfil não retorna uma árvore de chamadas completa, mas apenas os pares pai-filho.  Além disso, se algum par de métodos foi chamado de diferentes locais do aplicativo, como resultado, obtemos a quantidade de tempo gasto.  Para um gráfico de chama, você precisa ter uma árvore de chamadas completa.  Ao restaurar essa árvore, os valores dos parâmetros são normalizados, levando em consideração o tempo gasto pelos pais. <br><br><img src="https://habrastorage.org/webt/vp/lp/xr/vplpxry-gjd-lq774gg3ji9cooo.png"><br>  <i>Uma página com uma lista de métodos que se tornaram mais lentos durante o intervalo selecionado.</i> <br><br>  Além disso, para cada método, você pode ver quais chamadas secundárias afetaram mais o desempenho.  Por exemplo, na captura de tela abaixo, você pode ver que o método <code>ServiceApi::getAvailableServices()</code> começou a executar 116 ms mais lentamente.  O motivo disso foi a adição de uma chamada ao <code>ServiceApi::getGifts()</code> (alteração de 56 ms) e um aumento no número de chamadas para o método <code>ServiceApi::getConfigForList()</code> de 1 para 5 (outros 50 ms): <br><br> <a href=""><img src="https://habrastorage.org/webt/rv/mc/dd/rvmcddru-ay4x9cb45xsvey_tka.png"></a> <br><br>  Se não for conhecido antecipadamente qual consulta o desempenho mudou mais visivelmente, uma página com uma lista de métodos que se tornou mais lenta sem referência a uma consulta específica ajudará: <br><br><img src="https://habrastorage.org/webt/-6/0b/3s/-60b3svwq_rg9z7wbzmzmpriapc.png"><br>  <i>Uma página que pesquisa consultas que invocam um método específico.</i> <br><br>  Permite comparar o tempo de execução em diferentes solicitações.  Também é útil para encontrar código não utilizado: <br><br><img src="https://habrastorage.org/webt/hq/du/lv/hqdulvav1asbj9nczgowuk1mvak.png"><br><br><h3>  Recursos de personalização </h3><br>  A ferramenta possui amplas oportunidades para personalização: <br><br><ul><li>  você pode adicionar suas próprias funções agregadas que calculam um determinado valor com base na matriz passada de valores de parâmetros; <br></li><li>  Você pode alterar o banco de dados para armazenar perfis e resultados agregados (SQLite, MySQL e PostgreSQL agora são suportados, mas você pode usar outros da lista disponível para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Doctrine DBAL</a> ); <br></li><li>  Você pode substituir o gerenciador de conexões do banco de dados e implementar seus métodos para obter dados; <br></li><li>  Você pode usar a interface da web como um projeto independente e dentro de qualquer estrutura (por exemplo, um painel de controle do site).  Um exemplo: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profileListAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{      &lt;i&gt;<span class="hljs-comment"><span class="hljs-comment">//Some custom logic before&lt;/i&gt;   $this-&gt;checkPermissions();   $App = new \Badoo\LiveProfilerUI\LiveProfilerUI();   $Page = $App-&gt;getPage('profile_method_list_page');   return $Page-&gt;setData($data)-&gt;render(); }</span></span></code> </pre> </li></ul><br><h2>  Conclusão </h2><br>  Espero que nossa ferramenta seja útil para outros desenvolvedores.  Isso permitirá verificar a alteração de desempenho de qualquer parte do código sem o uso de temporizadores adicionais.  Isso também facilitará o processo de otimização, pois agora você pode ver o que afetou a degradação do desempenho do aplicativo ao longo do tempo. <br><br>  Está disponível no GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/badoo/liveprof</a> , a interface da web é <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/badoo/liveprof-ui</a> . <br><br>  A ferramenta está em desenvolvimento ativo e pode conter alguns erros.  Espero que com a participação da comunidade, fique ainda melhor.  Os planos incluem adicionar suporte a outros criadores de perfil além do XHProf, além de expandir a lista de bancos de dados suportados. <br><br>  Envie-nos comentários e perguntas sobre o uso no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Telegram</a> , bugs e solicitações pull - diretamente para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> .  Agradecemos comentários e sugestões! <br><br>  Agradecimentos especiais a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gregory</a> pela idéia e primeira implementação. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436364/">https://habr.com/ru/post/pt436364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436352/index.html">Resumo de notícias do PostgreSQL. Edição 14</a></li>
<li><a href="../pt436354/index.html">Militares dos EUA negligenciam questões de segurança cibernética</a></li>
<li><a href="../pt436356/index.html">[Interessante por trás da colina] Como paramos a dependência tecnológica?</a></li>
<li><a href="../pt436358/index.html">Por que os desenvolvedores seniores ensinam os alunos</a></li>
<li><a href="../pt436360/index.html">Preciso ir rápido: Criando velocidade no iOS. Parte 1</a></li>
<li><a href="../pt436370/index.html">Infraestrutura de chave pública Cadeia de certificados raiz X509 v.3</a></li>
<li><a href="../pt436372/index.html">Plug-in isométrico para Unity3D</a></li>
<li><a href="../pt436374/index.html">Tendências de design da interface do usuário e do UX 2019</a></li>
<li><a href="../pt436376/index.html">Visão geral do robô todo-o-terreno EZ-Robot Roli Rover</a></li>
<li><a href="../pt436378/index.html">bobaos.pub - KNX TP / UART, Raspberry Pi e Redis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>