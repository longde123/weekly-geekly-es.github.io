<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ฟโโ๏ธ ๐จ๐ผโ๐ป ๐ฉ๐พโ๐คโ๐ฉ๐ฝ System.IO - ุฎุทูุท ุงูุฃูุงุจูุจ - ุฃุฏุงุฉ ุบูุฑ ูุนุฑููุฉ ููุญุจู ุงูุฃุฏุงุก ุงูุนุงูู ๐ธ ๐ง๐ผ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ุงููุงุฑุฆ. ููุฏ ูุฑ ุงููุซูุฑ ูู ุงูููุช ููุฐ ุฅุตุฏุงุฑ .NET Core 2.1. ููุฐู ุงูุงุจุชูุงุฑุงุช ุงูุฑุงุฆุนุฉ ูุซู Span and Memory ูุนุฑููุฉ ุจุงููุนู ุนูู ูุทุงู ูุงุณุน ุ ููููู ูุฑุงุกุชูุง ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>System.IO - ุฎุทูุท ุงูุฃูุงุจูุจ - ุฃุฏุงุฉ ุบูุฑ ูุนุฑููุฉ ููุญุจู ุงูุฃุฏุงุก ุงูุนุงูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466137/" style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุงููุงุฑุฆ.  ููุฏ ูุฑ ุงููุซูุฑ ูู ุงูููุช ููุฐ ุฅุตุฏุงุฑ .NET Core 2.1.  ููุฐู ุงูุงุจุชูุงุฑุงุช ุงูุฑุงุฆุนุฉ ูุซู Span and Memory ูุนุฑููุฉ ุจุงููุนู ุนูู ูุทุงู ูุงุณุน ุ ููููู ูุฑุงุกุชูุง ูุฑุคูุชูุง ูุณูุงุน ุงููุซูุฑ ุนููุง.  ููุน ุฐูู ุ ููุฃุณู ุ ููุชุจุฉ ุชุณูู System.IO. ูู ุชุญุตู Pipeslines ุนูู ููุณ ุงูุงูุชูุงู.  ูู ูุง ููุฌุฏ ุชูุฑูุจูุง ุญูู ูุฐุง ุงูููุถูุน ูู ุงูููุดูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุญูุฏ</a> ุงูุฐู ุชูุช ุชุฑุฌูุชู ููุณุฎู ุนูู ุงูุนุฏูุฏ ูู ุงูููุงุฑุฏ.  ูุฌุจ ุฃู ูููู ููุงู ูุฒูุฏ ูู ุงููุนูููุงุช ุญูู ูุฐู ุงูุชูููููุฌูุง ูููุธุฑ ุฅูููุง ูู ุฒูุงูุง ูุฎุชููุฉ. <br><br><img src="https://habrastorage.org/webt/fe/ff/_q/feff_q0xj_lqisaxmeji-eomyne.jpeg"><br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ููุฏูุฉ </h2><br>  ูุฐูู ุ ุชูุฏู ูุฐู ุงูููุชุจุฉ ุฅูู ุชุณุฑูุน ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุชุฏููุฉ.  ุชู ุฅูุดุงุคู ูุงุณุชุฎุฏุงูู ูู ุงูุฃุตู ุจูุงุณุทุฉ ูุฑูู ุงูุชุทููุฑ ุงูุชุงุจุน ูู Kestrel (ุฎุงุฏู ููุจ ูุดุชุฑู ุนุจุฑ ุงููุธุงู ุงูุฃุณุงุณู ูู ASP.NET Core) ุ ููููู ูุชููุฑ ุญุงูููุง ููุจุดุฑ ูู ุฎูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุฒูุฉ nuget</a> . <br><br>  ูุจู ุงูุฎูุถ ูู ุงูููุถูุน ุ ูููููุง ุฃู ูุชุฎูู ุขููุฉ ุงูููุชุจุฉ ูุชูุงุซู ูุญุณูู ูู MemoryStream.  ุงููุดููุฉ ูู MemoryStream ุงูุฃุตูู ูู ุนุฏุฏ ูุจูุฑ ูู ุงููุณุฎ ุ ููู ุฃูุฑ ูุงุถุญ ุฅุฐุง ููุช ุชุชุฐูุฑ ุฃูู ูุชู ุงุณุชุฎุฏุงู ุตููู ุจุงูุช ุฎุงุต ุฏุงุฎู MemoryStream ููุฎุฒู ูุคูุช.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฃุณุงููุจ <a href="">ุงููุฑุงุกุฉ</a> <a href="">ูุงููุชุงุจุฉ</a> ุ ููููู ุฑุคูุฉ ูุณุฎ ุงูุจูุงูุงุช ุจูุถูุญ.  ูุจุงูุชุงูู ุ ุจุงููุณุจุฉ ูููุงุฆู ุงูุฐู ูุฑูุฏ ุงููุชุงุจุฉ ุฅููู ุ ุณูุชู ุฅูุดุงุก ูุณุฎุฉ ูู ุงููุฎุฒู ุงููุคูุช ุงูุฏุงุฎูู ุ ูุฎูุงู ุงููุฑุงุกุฉ ุ ุณูุชู ุฅุฑุฌุงุน ูุณุฎุฉ ูู ุงููุณุฎุฉ ุงูุฏุงุฎููุฉ ุฅูู ุงููุณุชููู.  ูุจุฏู ุฃูู ููุณ ุงูุงุณุชุฎุฏุงู ุงูุฃูุซุฑ ุนููุงููุฉ ููุฐุงูุฑุฉ. <br><br>  ูุง ุชูุฏู System.IO.Pipelines ุฅูู ุงุณุชุจุฏุงู ูุงูุฉ ุงูุชุฏููุงุช ุ ุจู ูู ุฃุฏุงุฉ ุฅุถุงููุฉ ูู ุชุฑุณุงูุฉ ูุทูุฑ ูููู ุจูุชุงุจุฉ ููุฏ ุนุงูู ุงูุฃุฏุงุก.  ุฃูุชุฑุญ ุนููู ุฃู ุชุชุนุฑู ุนูู ุงูุฃุณุงููุจ ูุงููุตูู ุงูุฃุณุงุณูุฉ ุ ูุฃู ุชุฑู ุชูุงุตูู ุชูููุฐูุง ูุชุญูู ุงูุฃูุซูุฉ ุงูุฃุณุงุณูุฉ. <br><br>  ููุจุฏุฃ ูุน ุงูุชูุงุตูู ุงูุฏุงุฎููุฉ ูุงูุชูููุฐ ุ ูู ููุณ ุงูููุช ููุธุฑ ุฅูู ุฃุฌุฒุงุก ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุจุณูุทุฉ.  ุจุนุฏ ุฐูู ุ ุณูู ูุตุจุญ ูู ุงููุงุถุญ ููู ูุนูู ูููู ูุฌุจ ุงุณุชุฎุฏุงูู.  ุนูุฏ ุงูุนูู ูุน System.IO.Pipelines ุ ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุงูููููู ุงูุฃุณุงุณู ูู ุฃู ุฌููุน ุนูููุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ูุฌุจ ุฃู ุชุชู ุฏูู ุชุฎุตูุตุงุช ุฅุถุงููุฉ.  ููู ุจุนุถ ุงูุฃุณุงููุจ ุงูุฌุฐุงุจุฉ ูููููุฉ ุงูุฃููู ุชุชูุงูุถ ูุน ูุฐู ุงููุงุนุฏุฉ.  ููููุง ูุฐูู ุ ุชุจุฏุฃ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชู ุชุญุงูู ุชุณุฑูุนูุง ุจุดุฏุฉ ูู ุชุฎุตูุต ุฐุงูุฑุฉ ููุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูุงูุฌุฏูุฏุฉ ุ ูุชุญููู ุฃุฏุงุฉ ุชุฌููุน ูุฌูุนู ุงูุจูุงูุงุช ุงูููููุฉ. <br><br>  ุชุณุชุฎุฏู ุงูุฃุฌุฒุงุก ุงูุฏุงุฎููุฉ ููููุชุจุฉ ุฃูุจุฑ ุฅููุงููุงุช ูุฃุญุฏุซ ุฅุตุฏุงุฑุงุช ุงููุบุฉ ูููุช ุงูุชุดุบูู - Span ุ Memory ุ ุชุฌูุนุงุช ุงููุงุฆูุงุช ุ ValueTask ููุง ุฅูู ุฐูู.  ูุฌุฏุฑ ุงูุจุญุซ ููุงู ุนูู ุงูุฃูู ููุญุตูู ุนูู ูุซุงู ุฑุงุฆุน ูุงุณุชุฎุฏุงู ูุฐู ุงูููุฒุงุช ูู ุงูุฅูุชุงุฌ. <br><br>  ูู ููุช ูุงุญุฏ ุ ูู ููู ุจุนุถ ุงููุทูุฑูู ุฑุงุถูู ุนู ุชุทุจูู ุงูุชุฏููุงุช ูู C # ุ ูุฃูู ุชู ุงุณุชุฎุฏุงู ูุตู ูุงุญุฏ ูููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ููู ููุง ูููููู ุ ูุง ููููู ุฑูู ุงูุฃุณุงููุจ ุฎุงุฑุฌ ุงููุตู.  ุญุชู ุฅุฐุง ูุงู ุงูุฏูู ูุง ูุฏุนู ุงููุฑุงุกุฉ / ุงููุชุงุจุฉ / ุงูุจุญุซ ุ ูุชู ุงุณุชุฎุฏุงู ุฎุตุงุฆุต CanRead ู CanWrite ู CanSeek.  ูุจุฏู ููุฃูู ุนูุงุฒ ุตุบูุฑ.  ูููู ุงูุขู ุฃุตุจุญุช ุงูุฃููุฑ ูุฎุชููุฉ. <br><br>  ููุนูู ูุน ุฎุทูุท ุงูุฃูุงุจูุจ ุ ูุชู ุงุณุชุฎุฏุงู <a href="">ูุฆุชูู</a> : <a href="">PipeWriter</a> ู <a href="">PipeReader</a> .  ุชุญุชูู ูุฐู ุงููุฆุงุช ุนูู ูุง ููุฑุจ ูู 50 ุณุทุฑูุง ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ููู ูุงุฌูุงุช ุฒุงุฆูุฉ (ููุณุช ุงูุฃูุซุฑ ุชูููุฏูุฉ ูู ุชุฌุณูุฏูุง ุ ุญูุซ ุฅููุง ุชุฎูู ูุฆุฉ ูุงุญุฏุฉ ุ ูููุณ ุงููุซูุฑ) ููุฆุฉ <a href="">ุงูุฃูุงุจูุจ</a> ุ ูุงูุชู ุชุญุชูู ุนูู ูู ุงูููุทู ุงูุฃุณุงุณู ููุนูู ูุน ุงูุจูุงูุงุช.  ุชุญุชูู ูุฐู ุงููุฆุฉ ุนูู 5 ุฃุนุถุงุก ุนูููููู: ูููุดุฆุงู ุ ูุฎุงุตูุชุงู ููุท ููุญุตูู ุนูู - ุงููุงุฑุฆ ูุงููุงุชุจ ุ ุทุฑููุฉ ุฅุนุงุฏุฉ ุงูุชุนููู () ุ ุงูุชู ุชุนูุฏ ุชุนููู ุงูุญููู ุงูุฏุงุฎููุฉ ุฅูู ุญุงูุชูุง ุงูุฃูููุฉ ุจุญูุซ ูููู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงููุฆุฉ.  ุฃุณุงููุจ ุงูุนูู ุงููุชุจููุฉ ุฏุงุฎููุฉ ูุชุณูู ุจุงุณุชุฎุฏุงู ูุงุฌูุงุช ุฒุงุฆูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุฏุนูุง ูุจุฏุฃ ูุน ูุฆุฉ ุงูุฃูุงุจูุจ </h2><br>  ูุดุบู ูุซูู ุงููุฆุฉ 320 ุจุงูุช ุ ููู ูุซูุฑ ุฌุฏูุง (ุซูุซ ููููุจุงูุช ุชูุฑูุจูุง ุ ูุง ูููู ุงุญุชูุงุก 2 ูู ูุฐู ุงููุงุฆูุงุช ูู ุฐุงูุฑุฉ Manchester Mark I).  ูุฐูู ุชุฎุตูุต ูููุฉ ูุจูุฑุฉ ูู ุงูุญุงูุงุช ูู ููุฑุฉ ุณูุฆุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅู ุงูุบุฑุถ ูู ูุฐุง ุงูุบุฑุถ ูู ุงูุงุณุชุฎุฏุงู ุทููู ุงูุฃุฌู.  ุงุณุชุฎุฏุงู ุชุฌูุนุงุช ูุฌุนู ุญุฌุฉ ููุฐุง ุงูุจูุงู ุฃูุถุง.  ุณุชุนูุด ุงููุงุฆูุงุช ุงููุณุชุฎุฏูุฉ ูู ุงูุชุฌูุน ุฅูู ุงูุฃุจุฏ (ูุชุทุจูู ุงูุชุฌูุน ุงูุงูุชุฑุงุถู). <br>  ูุงุญุธ ุฃูู ุชู ูุถุน ุนูุงูุฉ ุนูู ุงููุตู ุนูู ุฃูู ูุฎุชูู ูุฃูู ุขูู ููุฎูุท - ูุงููุซูุฑ ูู ุฃูุณุงู ุงูููุฏ ูู ูุณู ุญุฑุฌ ููุชู ูููุง ุจุฃููุงู. <br><br>  ูุจุฏุก ุงุณุชุฎุฏุงู ูุฐู ุงููุฆุฉ ุ ูุฌุจ ุนููู ุฅูุดุงุก ูุซูู ููุฆุฉ Pipe ูุงูุญุตูู ุนูู ูุงุฆูุงุช PipeReader ู PipeWriter ุจุงุณุชุฎุฏุงู ุงูุฎุตุงุฆุต ุงููุฐููุฑุฉ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชููุฆุฉ ุจุณูุทุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pipe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipe(); PipeWriter pipeWriter = pipe.Writer; PipeReader pipeReader = pipe.Reader;</code> </pre> <br></div></div><br>  ุงููุธุฑ ูู ุฃุณุงููุจ ุงูุนูู ูุน ุงูุฃูุงุจูุจ: <br>  ุงููุชุงุจุฉ ุจุงุณุชุฎุฏุงู PipeWriter - WriteAsync ู GetMemory / GetSpan ู Advance ู FlushAsync ู Complete ู CancelPendingFlush ู OnReaderCompleted. <br><br>  ุงููุฑุงุกุฉ ุจุงุณุชุฎุฏุงู PipeReader - AdvanceTo ู ReadAsync ู TryRead ู Complete ู CancelPendingRead ู OnWriterCompleted. <br><br>  ููุง ูู ูุฐููุฑ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุดูุฑ ุงููุฐููุฑ</a> ุ ูุณุชุฎุฏู ุงููุตู ูุงุฆูุฉ ูููุฑุฏุฉ ูุฑุชุจุทุฉ ูู ุงููุฎุงุฒู ุงููุคูุชุฉ.  ูููู ุ ูู ุงููุงุถุญ ุ ูุง ูุชู ููููุง ุจูู PipeReader ู PipeWriter - ูู ุงูููุทู ูู ูุฆุฉ ูุงุญุฏุฉ.  ุชุณุชุฎุฏู ูุฐู ุงููุงุฆูุฉ ูู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุชู ุชู ุฅุฑุฌุงุนูุง ูู ูุฐู ุงููุงุฆูุฉ (ูุฐูู ูู ูุชู ุฅุฌุฑุงุก ูุณุฎ). <br><br>  ุฃูุถูุง ุ ููุงู ูุงุฆูุงุช ุชุดูุฑ ุฅูู ุจุฏุงูุฉ ุงูุจูุงูุงุช ุงููุฑุงุฏ ูุฑุงุกุชูุง (ReadHead ูุงูููุฑุณ) ุ ูููุงูุฉ ุงูุจูุงูุงุช ุงููุฑุงุฏ ูุฑุงุกุชูุง (ReadTail ูุงูููุฑุณ) ูุจุฏุงูุฉ ุงููุณุงุญุฉ ุงููุฑุงุฏ ูุชุงุจุชูุง (WriteHead ูุนุฏุฏ ุงูุจุงูุชุงุช ุงููุฎุฒูุฉ ูุคูุชูุง ุงูููุชูุจุฉ).  ูุนุฏ ReadHead ู ReadTail ู WriteHead ุฃุนุถุงุก (ุดุฑุงุฆุญ) ูุญุฏุฏุฉ ูู ุงููุงุฆูุฉ ุงูุฏุงุฎููุฉ ูููุทุงุนุงุช ุ ููุดูุฑ ุงูููุฑุณ ุฅูู ููุถุน ูุนูู ุฏุงุฎู ุงููุทุงุน.  ูุจุงูุชุงูู ุ ูููู ุฃู ูุจุฏุฃ ุงูุชุณุฌูู ูู ููุชุตู ููุทุน ูุง ุ ุซู ููุชูุท ููุทุนูุง ูุงููุงู ูุงุญุฏูุง ูููุชูู ูู ููุชุตู ุงูุฌุฒุก ุงูุซุงูุซ.  ูุชู ููู ูุฐู ุงููุคุดุฑุงุช ุจุทุฑู ูุฎุชููุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุดุฑูุน ูู ุงุณุชุฎุฏุงู ุฃุณุงููุจ PipeWriter </h2><br><h3 style=";text-align:right;direction:rtl">  # 1 <a href="">ValueTask &lt;FlushResult&gt; WriteAsync (ReadOnlyMemory &lt;byte&gt; sourceุ CancellationToken cancellationToken)</a> </h3><br>  ุงููุฐููุฑุฉ ุฌุฐุงุจุฉ ูุฃูู ูููุฉ ุงูุทุฑููุฉ.  ูุฏููุง ุชูููุน ููุงุณุจ ูุนุตุฑู ููุบุงูุฉ - ููุจู ReadOnlyMemory ุ ุบูุฑ ูุชุฒุงูู.  ููุฏ ูุชู ุฅุบุฑุงุก ุงููุซูุฑ ูููู ุ ุฎุงุตุฉู ุชุฐูุฑ ุฃู Span and Memory ุณุฑูุนุงู ูุจุงุฑุฏุงู.  ูููู ูุง ุชููู ููุณู.  ูู ูุง ุชูุนูู ูุฐู ุงูุทุฑููุฉ ูู ูุณุฎ ReadOnlyMemory ุงูุฐู ุชู ุชูุฑูุฑู ุฅูููุง ูู ุงููุงุฆูุฉ ุงูุฏุงุฎููุฉ.  ูุจุนุจุงุฑุฉ "copy" ุชุนูู ุงุณุชุฏุนุงุก ุงูุฃุณููุจ CopyTo () ุ ูููุณ ููุท ูุณุฎ ุงููุงุฆู ููุณู.  ุณูุชู ูุณุฎ ุฌููุน ุงูุจูุงูุงุช ุงูุชู ูุฑูุฏ ุชุณุฌูููุง ุ ูุจุงูุชุงูู ุชุญููู ุงูุฐุงูุฑุฉ.  ูุฌุจ ุฐูุฑ ูุฐู ุงูุทุฑููุฉ ููุท ููุชุฃูุฏ ูู ุฃูู ูู ุงูุฃูุถู ุนุฏู ุงุณุชุฎุฏุงููุง.  ุญุณููุง ุ ูุฑุจูุง ูููู ูุฐุง ุงูุณููู ููุงุณุจูุง ูุจุนุถ ุงูููุงูู ุงููุงุฏุฑุฉ. <br>  ุฌุณู ูุฐู ุงูุทุฑููุฉ ูู ูุณู ุญุฑุฌ ุ ุชุชู ูุฒุงููุฉ ุงููุตูู ุฅูููุง ูู ุฎูุงู ุดุงุดุฉ. <br><br>  ุซู ูุฏ ูุทุฑุญ ุงูุณุคุงู ุ ููู ุชูุชุจ ุดูุฆูุง ูุง ุ ุฅู ูู ููู ูู ุฎูุงู ุงูุทุฑููุฉ ุงูุฃูุซุฑ ูุถูุญูุง ูุงูุฃูุซุฑ ููุงุฆูุฉ <br><br><h3 style=";text-align:right;direction:rtl">  # 2 <a href="">ุงูุฐุงูุฑุฉ &lt;ุจุงูุช&gt; GetMemory (int sizeHint)</a> </h3><br>  ุชุฃุฎุฐ ุงูุทุฑููุฉ ูุนููุฉ ูุงุญุฏุฉ ูู ููุน ุตุญูุญ.  ูู ุฐูู ุ ูุฌุจ ุฃู ูุดูุฑ ุฅูู ุนุฏุฏ ุงูุจุงูุชุงุช ุงูุชู ูุฑุบุจ ูู ูุชุงุจุชูุง ุฅูู ุฎุท ุงูุฃูุงุจูุจ (ูุง ุญุฌู ุงููุฎุฒู ุงููุคูุช ุงูุฐู ูุฑูุฏู).  ูุชุญูู ูุฐุง ุงูุฃุณููุจ ููุง ุฅุฐุง ูุงูุช ููุงู ูุณุงุญุฉ ูุงููุฉ ูููุชุงุจุฉ ูู ุฌุฒุก ุงูุฐุงูุฑุฉ ุงูุญุงูู ุงููุฎุฒู ูู _writingHeadMemory.  ุฅุฐุง ูุงูุช ูุงููุฉ ุ ูุชู ุฅุฑุฌุงุน _writingHeadMemory ูุฐุงูุฑุฉ.  ุฎูุงู ุฐูู ุ ุจุงููุณุจุฉ ููุจูุงูุงุช ุงูููุชูุจุฉ ุฅูู ุงููุฎุฒู ุงููุคูุช ุ ูููู ูู ูุชู ุงุณุชุฏุนุงุก ุทุฑููุฉ FlushAsync ููุง ุ ูุชู ุงุณุชุฏุนุงุคูุง ููุชู ุชุฎุตูุต BufferSegment ุขุฎุฑ ุ ููู ูุฑุชุจุท ุจุงูุจูุงูุงุช ุงูุณุงุจูุฉ (ูููุง ููู ูุงุฆูุชูุง ุงูุฏุงุฎููุฉ).  ุฅุฐุง ูุงูุช _writingHeadMemory ุฎุงููุฉ ุ ูุณุชุชู ุชููุฆุชูุง ุจุงุณุชุฎุฏุงู BufferSegment ุฌุฏูุฏ.  ูุชุฎุตูุต ุงููุฎุฒู ุงููุคูุช ูู ูุณู ุญุงุณู ููุชู ุชุญุช ุงูููู. <br><br>  ุฃูุชุฑุญ ุฃู ููุธุฑ ุฅูู ูุฐุง ุงููุซุงู.  ูููููุฉ ุงูุฃููู ุ ูุฏ ูุจุฏู ุฃู ุงููุชุฑุฌู (ุฃู ููุช ุงูุชุดุบูู) ุฃูุณุฏ ุงูุดูุทุงู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุญุดูุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pipeNoOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipe(); Memory&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>&gt; memoryOne = pipeNoOptions.Writer.GetMemory(<span class="hljs-number"><span class="hljs-number">2</span></span>); Console.WriteLine(memoryOne.Length); <span class="hljs-comment"><span class="hljs-comment">//2048 or 4096 var pipeWithOptions = new Pipe(new PipeOptions(minimumSegmentSize: 5)); Memory&lt;byte&gt; memoryTwo = pipeWithOptions.Writer.GetMemory(2); Console.WriteLine(memoryTwo.Length); //16</span></span></code> </pre><br></div></div><br>  ููู ูู ุดูุก ูู ูุฐุง ุงููุซุงู ููููู ูุจุณูุท. <br>  ุฃุซูุงุก ุฅูุดุงุก ูุซูู Pipe ุ ูููููุง ุชูุฑูุฑ ูุงุฆู <a href="">PipeOptions</a> ุฅููู ูู ุงููููุดุฆ ูุน ุฎูุงุฑุงุช ุงูุฅูุดุงุก. <br><br>  ูุญุชูู PipeOptions ุนูู ุญูู ุญุฌู ูุทุนุฉ ุงูุญุฏ ุงูุฃุฏูู ุงูุงูุชุฑุงุถู.  ููุฐ ููุช ููุณ ุจุจุนูุฏ ุ ูุงู ุนุงู 2048 ุ ูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง ุงูุงูุชุฒุงู</a> ูุงู ุจุชุญุฏูุซ ูุฐู ุงููููุฉ ุฅูู 4096. ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูููุงู ุ ูุงู ุงูุฅุตุฏุงุฑ 4096 ูู ุญุฒูุฉ nuget ุงูุชุฌุฑูุจูุฉ ุ ููุงู ุฅุตุฏุงุฑ ุงูุฅุตุฏุงุฑ ุงูุฃุฎูุฑ ุจูููุฉ 2048. ููุฐุง ูุง ููุณุฑ ุณููู ุงููุซุงู ุงูุฃูู.  ุฅุฐุง ููุช ุชูุชูุฏ ุงุณุชุฎุฏุงู ุญุฌู ุฃุตุบุฑ ูููุฎุฒู ุงููุคูุช ุงูุงูุชุฑุงุถู ุ ููููู ุชุญุฏูุฏู ูู ูุซูู ููุน PipeOptions. <br><br>  ูููู ูู ุงููุซุงู ุงูุซุงูู ุ ุญูุซ ูุชู ุชุญุฏูุฏ ุงูุญุฏ ุงูุฃุฏูู ููุญุฌู ุ ูุฅู ุงูุทูู ูุง ูุทุงุจูู ุนูู ุฃู ุญุงู.  ููุฐุง ูุญุฏุซ ูุฃู ุฅูุดุงุก BufferSegment ุฌุฏูุฏ ูุญุฏุซ ุจุงุณุชุฎุฏุงู ุชุฌูุนุงุช.  ุฃุญุฏ ุงูุฎูุงุฑุงุช ูู PipeOptions ูู ุชุฌูุน ุงูุฐุงูุฑุฉ.  ุจุนุฏ ุฐูู ุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุชุฌูุน ุงููุญุฏุฏ ูุฅูุดุงุก ุดุฑูุญุฉ ุฌุฏูุฏุฉ.  ุฅุฐุง ูู ุชุญุฏุฏ ุชุฌูุน ุงูุฐุงูุฑุฉ ุ ูุณูุชู ุงุณุชุฎุฏุงู ArrayPool ุงูุงูุชุฑุงุถู ุ ูุงูุฐู ุ ููุง ุชุนูู ุ ูุญุชูู ุนูู ุนุฏุฉ ูุฌููุนุงุช ูุฃุญุฌุงู ูุฎุชููุฉ ูู ุงููุตูููุงุช (ูู ูุงุญุฏุฉ ุชุงููุฉ ุฃูุจุฑ ูุฑุชูู ูู ุงูุณุงุจูุฉ) ูุนูุฏูุง ูุชู ุทูุจูุง ูุจุนุถ ุงูููุช ุงูุญุฌู ุ ูุจุญุซ ุนู ุฏูู ูุน ุตูุงุฆู ูู ุงูุญุฌู ุงูููุงุณุจ (ุฃู ุฃูุฑุจ ุฃู ุฃูุจุฑ).  ููููุง ูุฐูู ุ ุณูููู ุงููุฎุฒู ุงููุคูุช ุงูุฌุฏูุฏ ุฃูุจุฑ ุชูุฑูุจูุง ููุง ุทูุจุช.  ุงูุญุฏ ุงูุฃุฏูู ูุญุฌู ุงูุตููู ูู ArrayPool ุงูุงูุชุฑุงุถู (System.Buffers.TlsOverPerCoreLockedStacksArrayPool) ูู 16. ููู ูุง ุชููู ุ ููุฐู ูุฌููุนุฉ ูู ุงูุตูุงุฆู.  ููููุง ูุฐูู ุ ูู ุงูุบุงูุจูุฉ ุงูุนุธูู ูู ุงูุญุงูุงุช ุ ูุง ุชูุงุฑุณ ุงููุฌููุนุฉ ุถุบุทูุง ุนูู ุฌุงูุน ุงูุจูุงูุงุช ุงูููููุฉ ูุณูุชู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงููุง ูุงุญููุง. <br><br><h3 style=";text-align:right;direction:rtl">  # 2.5 <a href="">Span &lt;byte&gt; GetSpan (int sizeHint)</a> </h3><br>  ูุนูู ุจุดูู ูุดุงุจู ุ ูุน ุฅุนุทุงุก ุณุจุงู ูู ุงูุฐุงูุฑุฉ. <br><br>  ูุจุงูุชุงูู GetMemory () ุฃู GetSpan () ูู ุงูุทุฑู ุงูุฑุฆูุณูุฉ ูููุชุงุจุฉ.  ูุนุทูููุง ูุงุฆููุง ูููููุง ุงููุชุงุจุฉ ุฅููู.  ููููุงู ุจุฐูู ุ ูุง ูุญุชุงุฌ ุฅูู ุชุฎุตูุต ุฐุงูุฑุฉ ููุตูููุงุช ุฌุฏูุฏุฉ ูู ุงูููู ุ ูููููุง ุงููุชุงุจุฉ ูุจุงุดุฑุฉ ูู ุงูุฃูุจูุจ.  ุฃู ูุงุญุฏ ูุงุณุชุฎุฏุงูู ูุนุชูุฏ ุจุดูู ุฃุณุงุณู ุนูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุชู ุชุณุชุฎุฏููุง ูุทุฑููุฉ ุนุฏู ุงูุชุฒุงูู.  ููุน ุฐูู ุ ูู ุถูุก ูุง ุณุจู ุ ูุทุฑุญ ุณุคุงู.  ููู ุณูุนุฑู ุงููุงุฑุฆ ูู ูุชุจูุงุ  ุฅุฐุง ุงุณุชุฎุฏููุง ุฏุงุฆููุง ุชุทุจูููุง ูุญุฏุฏูุง ููุชุฌูุน ุ ูุงูุฐู ูุนุทู ุตููููุง ุจููุณ ุงูุญุฌู ุงููุทููุจ ุชูุงููุง ุ ุนูุฏุฆุฐู ูููู ูููุงุฑุฆ ูุฑุงุกุฉ ุงููุฎุฒู ุงููุคูุช ุจุงููุงูู ูุฑุฉ ูุงุญุฏุฉ.  ููุน ุฐูู ุ ููุง ูููุง ุจุงููุนู ุ ูุชู ุชุฎุตูุต ูุฎุฒู ูุคูุช ูุฏููุง ูุน ูุฌูุฏ ุงุญุชูุงู ูุจูุฑ ุจุญุฌู ุฃูุจุฑ.  ูุฐุง ูุคุฏู ุฅูู ุงูุทุฑููุฉ ุงูุชุงููุฉ ุงููุทููุจุฉ ููุชุดุบูู. <br><br><h3 style=";text-align:right;direction:rtl">  # 3 <a href="">void Advance (int bytes)</a> </h3><br>  ุทุฑููุฉ ุจุณูุทุฉ ุจุดูู ุฑููุจ.  ูุณุชุบุฑู ุนุฏุฏ ุงูุจุงูุชุงุช ุงูููุชูุจุฉ ููุณูุทุฉ.  ูููููู ุจุฒูุงุฏุฉ ุงูุนุฏุงุฏุงุช ุงูุฏุงุฎููุฉ - _unflushedBytes ู _writingHeadBytesBuffered ุ ุงูุฐูู ุชุชุญุฏุซ ุฃุณูุงุคูู ุนู ุฃููุณูู.  ูููู ุฃูุถูุง ุจุงูุชุทุงุน (ูุชุงุจุฉ ุงูุดุฑุงุฆุญ) _writingHeadMemory ุชูุงููุง ุฅูู ุนุฏุฏ ูุญุฏุงุช ุงูุจุงูุช ุงูููุชูุจุฉ (ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ุงูุดุฑูุญุฉ).  ูุฐูู ุ ุจุนุฏ ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑููุฉ ุ ุชุญุชุงุฌ ุฅูู ุทูุจ ูุชูุฉ ุฐุงูุฑุฉ ุฌุฏูุฏุฉ ูู ุดูู Memory ุฃู Span ุ ูุง ููููู ุงููุชุงุจุฉ ุฅูู ุงูุณุงุจูุฉ.  ูุงูุฌุณู ููู ูู ุงูุทุฑููุฉ ูู ูุณู ุญุงุณู ููุนูู ุชุญุช ููู. <br><br>  ูุจุฏู ุฃูู ุจุนุฏ ูุฐุง ูููู ูููุงุฑุฆ ุชููู ุงูุจูุงูุงุช.  ูููู ููุงู ุญุงุฌุฉ ุฅูู ุฎุทูุฉ ุฃุฎุฑู. <br><br><h3 style=";text-align:right;direction:rtl">  # 4 <a href="">ValueTask &lt;FlushResult&gt; FlushAsync (CancellationToken cancellationToken)</a> </h3><br>  ุชุณูู ูุฐู ุงูุทุฑููุฉ ุจุนุฏ ุฃู ููุชุจ ุงูุจูุงูุงุช ุงููุงุฒูุฉ ุฅูู ุงูุฐุงูุฑุฉ ุงููุณุชููุฉ (GetMemory) ูุชุดูุฑ ุฅูู ููุฏุงุฑ ูุง ูุชุจูุง ููุงู (Advance).  ุชููู ุงูุทุฑููุฉ ุจุฅุฑุฌุงุน ValueTask ุ ููุน ุฐูู ููู ุบูุฑ ูุชุฒุงููุฉ (ุนูู ุนูุณ StreamPipeWriter ุงูุฎุงุต ุจู).  ุชุนุฏ ValueTask ููุนูุง ุฎุงุตูุง (ุจููุฉ ูููุฑุงุกุฉ ููุท) ูุณุชุฎุฏู ูู ุงูุญุงูุฉ ุงูุชู ุชููู ูููุง ูุนุธู ุงูููุงููุงุช ุบูุฑ ูุชุฒุงููุฉ ุ ููุฐุง ูู ูู ุงูุจูุงูุงุช ุงููุงุฒูุฉ ุณุชููู ูุชุงุญุฉ ูู ููุช ุฏุนูุชูุง ูุณุชูุชูู ุงูุทุฑููุฉ ุจุดูู ูุชุฒุงูู.  ูู ุงูุฏุงุฎู ููุณู ูุญุชูู ุฅูุง ุนูู ุจูุงูุงุช ุฃู ูููุฉ (ูู ุญุงู ูู ููุฌุญ ุงูุฃูุฑ ุจุดูู ูุชุฒุงูู).  ุฐูู ูุนุชูุฏ ุนูู ุฎุงุตูุฉ _writerAwaitable.IsCompleted.  ุฅุฐุง ุจุญุซูุง ุนู ุงูุชุบููุฑุงุช ุงูุชู ุทุฑุฃุช ุนูู ุญุงูุฉ ูุฐุง _writerAwaitable ุ ูุณูุฑู ุฃู ูุฐุง ูุญุฏุซ ุฅุฐุง ุชุฌุงูุฒุช ูููุฉ ุงูุจูุงูุงุช ุบูุฑ ุงููุณุชูููุฉ (ูุฐู ููุณุช ุจุงูุถุจุท ููุณ ุงูุจูุงูุงุช ุงูุชู ูู ูุชู ูุญุตูุง ูุงุญููุง) ุญุฏูุง ูุนูููุง (_pauseWriterThreshold).  ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู 16 ูุทุนุฉ ุงูุฃุญุฌุงู.  ุฅุฐุง ุฑุบุจุช ูู ุฐูู ุ ูููู ุชุบููุฑ ุงููููุฉ ูู PipeOptions.  ุฃูุถูุง ุ ุชุจุฏุฃ ูุฐู ุงูุทุฑููุฉ ูู ูุชุงุจุนุฉ ุฃุณููุจ ReadAsync ุ ุฅุฐุง ุชู ุญุธุฑู. <br><br>  ุฅุฑุฌุงุน FlushResult ูุญุชูู ุนูู 2 ุฎุตุงุฆุต - IsCanceled ู IsCompleted.  ูุดูุฑ IsCanceled ุฅูู ูุง ุฅุฐุง ูุงู Flush ูุฏ ุชู ุฅูุบุงุคู (ุงุณุชุฏุนุงุก CancelPendingFlush ()).  ูุดูุฑ IsCompleted ุฅูู ูุง ุฅุฐุง ูุงู PipeReader ูุฏ ุฃููู (ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุฃุณุงููุจ Complete () ุฃู CompleteAsync ()). <br>  ูุชู ุชูููุฐ ุงูุฌุฒุก ุงูุฑุฆูุณู ูู ุงูุฃุณููุจ ุชุญุช ุงูููู. <br><br>  ุงูุทุฑู ุงูุฃุฎุฑู ูู PipeWriter ููุณุช ูุซูุฑุฉ ููุงูุชูุงู ูู ูุฌูุฉ ูุธุฑ ุงูุชูููุฐ ููุชู ุงุณุชุฎุฏุงููุง ุจุดูู ุฃูู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ูุจุงูุชุงูู ุณูุชู ุชูุฏูู ูุตู ููุฌุฒ ููุท. <br><br><h3 style=";text-align:right;direction:rtl">  # 5 ุจุงุทูุฉ ูุงููุฉ (ุงุณุชุซูุงุก ุงุณุชุซูุงุก = ุฎุงููุฉ) ุฃู ValueTask CompleteAsync (ุงุณุชุซูุงุก ุงุณุชุซูุงุก = ูุงุฑุบ) </h3><br>  ุนูุงูุงุช ุฃูุจูุจ ูุบููุฉ ูููุชุงุจุฉ.  ุณูุชู ุทุฑุญ ุงุณุชุซูุงุก ุนูุฏ ูุญุงููุฉ ุงุณุชุฎุฏุงู ุฃุณุงููุจ ุงููุชุงุจุฉ ุจุนุฏ ุงูุงูุชูุงุก.  ุฅุฐุง ุชู ุฅููุงู PipeReader ุจุงููุนู ุ ูุณูุชู ุฃูุถูุง ุฅููุงู ูุซูู ุชูุฌูู ุงูุฅุฎุฑุงุฌ ุจุงููุงูู.  ูุชู ูุนุธู ุงูุนูู ุชุญุช ุงูููู. <br><br><h3 style=";text-align:right;direction:rtl">  # 6 ุจุงุทูุฉ CancelPendingFlush () </h3><br>  ููุง ููุญู ุงูุงุณู ุ ูุฅูู ููุบู ุนูููุฉ FlushAsync () ุงูุญุงููุฉ.  ููุงู ููู. <br><br><h3 style=";text-align:right;direction:rtl">  # 7 void OnReaderCompleted (ุฑุฏ ุงููุนู &lt;ุงูุงุณุชุซูุงุก ุ ุงููุงุฆู&gt; ุฑุฏ ุงูุงุชุตุงู ุ ุญุงูุฉ ุงููุงุฆู) </h3><br>  ูููุฐ ุงููููุถ ุงูุฐู ุชู ุชูุฑูุฑู ุนูุฏ ุงูุชูุงู ุงููุงุฑุฆ.  ููุงู ุฃูุถุง ููู. <br>  ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> ุงูููุชูุจุฉ ุญุงูููุง ุ ูุฏ ูุง ูุชู ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑููุฉ ูู ุจุนุถ ุชุทุจููุงุช PipeWriter ูุณูุชู ุฅุฒุงูุชูุง ูู ุงููุณุชูุจู.  ูุฐูู ุ ูุฌุจ ุฃู ูุง ุชุฑุจุท ุงูููุทู ุจูุฐู ุงูุทุฑู. <br><br><h2 style=";text-align:right;direction:rtl">  ุญุงู ุงูููุช ู PipeReader </h2><br><h3 style=";text-align:right;direction:rtl">  # 1 <a href="">ValueTask &lt;ReadResult&gt; ReadAsync (ุฅูุบุงุก ุฑูุฒ ูููุฒ)</a> </h3><br>  ููุง ุ ููุง ูู FlushAsync () ุ ูุชู ุฅุฑุฌุงุน ValueTask ุ ููุง ูุดูุฑ ุฅูู ุฃู ุงูุทุฑููุฉ ูุชุฒุงููุฉ ูู ุงูุบุงูุจ ุ ูููู ููุณ ุฏุงุฆููุง.  ูุนุชูุฏ ุนูู ุญุงูุฉ _readerAwaitable.  ููุง ูู ุงูุญุงู ูุน FlushAsync ุ ุชุญุชุงุฌ ุฅูู ุงูุจุญุซ ุนู ููุช ุถุจุท _readerAwaitable ุนูู ุนุฏู ุงูุชูุงูู.  ูุญุฏุซ ูุฐุง ุนูุฏูุง ููุฑุฃ PipeReader ูู ุดูุก ูู ุงููุงุฆูุฉ ุงูุฏุงุฎููุฉ (ุฃู ูุญุชูู ุนูู ุจูุงูุงุช ุชู ุชุนููููุง ุนูู ุฃููุง ุชู ูุญุตูุง ูุชุญุชุงุฌ ุฅูู ูุฒูุฏ ูู ุงูุจูุงูุงุช ูููุชุงุจุนุฉ).  ุงูุฐู ุ ูู ุงููุงูุน ุ ูู ูุงุถุญ.  ููููุง ูุฐูู ุ ูููููุง ุฃู ูุณุชูุชุฌ ุฃูู ูู ุงููุณุชุญุณู ุถุจุท ุชูุฌููุงุช ุงูุฅุฎุฑุงุฌ ุฅูู ุนููู ุ ูุชุนููู ุฌููุน ุฎูุงุฑุงุชู ุจุนูุงูุฉ ุ ุงุณุชูุงุฏูุง ุฅูู ุฅุญุตุงุฆูุงุช ูุญุฏุฏุฉ ุชุฌุฑูุจูุงู.  ุณูู ูููู ุงูุชูููู ุงูุตุญูุญ ูู ูุฑุตุฉ ุชูููุฐ ูุฑุน ุบูุฑ ูุชุฒุงูู ูุณูุณูุญ ุจูุนุงูุฌุฉ ุฃูุซุฑ ููุงุกุฉ ููุจูุงูุงุช.  ุชูุฑูุจุง ูู ุฑูุฒ ูู ุงูุฃุณููุจ ุจุฃูููู ูุญุงุท ุจููู. <br><br>  ุฅุฑุฌุงุน ุจุนุถ <a href="">ุงููุฑุงุกุฉ</a> ุงูุบุงูุถุฉ.  ูู ุงูุญูููุฉ ุ ุฅููุง ูุฌุฑุฏ ุนูุงูุฉ + ุนุงุฒูุฉ ุชูุถุญ ุญุงูุฉ ุงูุนูููุฉ (IsCanceled - ูุง ุฅุฐุง ูุงู ReadAsync ูุฏ ุชู ุฅูุบุงุคู ู IsCompleted ูุดูุฑ ุฅูู ูุง ุฅุฐุง ูุงู PipeWriter ูุบูููุง).  IsCompleted ูู ูููุฉ ุชุดูุฑ ุฅูู ูุง ุฅุฐุง ูุงู ุชู ุงุณุชุฏุนุงุก ุฃุณุงููุจ PipeWriter Complete () ุฃู CompleteAsync ().  ุฅุฐุง ุชู ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑู ูุน ุงุณุชุซูุงุก ูุฌุญ ุ ูุณูุชู ุทุฑุญูุง ุนูุฏ ูุญุงููุฉ ุงููุฑุงุกุฉ. <br><br>  ููุฑุฉ ุฃุฎุฑู ุ ูุญุชูู ุงููุฎุฒู ุงููุคูุช ุนูู ููุน ุบุงูุถ - <a href="">ReadOnlySequence</a> .  ูุฐุง ุ ุจุฏูุฑู ุ ูู ูุงุฆู ูุญุชููุงุช ุงูุดุฑุงุฆุญ <a href="">(ReadOnlySequenceSegment)</a> ูุจุฏุงูุฉ ูููุงูุฉ + ููุงุฑุณ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ ุฏุงุฎู ุงูุฃุฌุฒุงุก ุงูููุงุจูุฉ.  ุงูุฐู ูุดุจู ูู ุงููุงูุน ูููู ูุฆุฉ ุงูุฃูุงุจูุจ ููุณูุง.  ุจุงูููุงุณุจุฉ ุ ูุชู ูุฑุงุซุฉ BufferSegment ูู ReadOnlySequenceSegment ุ ููุง ูุดูุฑ ุฅูู ุฃู BufferSegment ููุณุชุฎุฏู ูู ูุฐุง ุงูุชุณูุณู.  ุจูุถู ูุฐุง ุ ููููู ููุท ุงูุชุฎูุต ูู ุชุฎุตูุตุงุช ุงูุฐุงูุฑุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ ูููู ุงูุจูุงูุงุช ูู ูุงุชุจ ุฅูู ูุงุฑุฆ. <br>  ูููู ุงูุญุตูู ุนูู ReadOnlySpan ูู ุงููุฎุฒู ุงููุคูุช ููุฒูุฏ ูู ุงููุนุงูุฌุฉ.  ูุฅููุงู ุงูุตูุฑุฉ ุ ููููู ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงููุฎุฒู ุงููุคูุช ูุญุชูู ุนูู ReadOnlySpan ูุงุญุฏ.  ุฅุฐุง ูุงูุช ุชุญุชูู ุนูู ุ ููู ูุญุชุงุฌ ุฅูู ุงูุชูุฑุงุฑ ุนูู ุงููุฌููุนุฉ ูู ุนูุตุฑ ูุงุญุฏ ููููููุง ุงูุญุตูู ุนูููุง ุจุงุณุชุฎุฏุงู ุงูุฎุงุตูุฉ ุงูุฃููู.  ุฎูุงู ุฐูู ุ ูู ุงูุถุฑูุฑู ุชุฌุงูุฒ ุฌููุน ุงููุทุงุนุงุช ูู ุงููุฎุฒู ุงููุคูุช ููุนุงูุฌุฉ ReadOnlySpan ููู ูููุง. <br><br>  ููุถูุน ุงูููุงูุดุฉ - ูู ูุฆุฉ ReadOnlySequence ุ ูุชู ุงุณุชุฎุฏุงู ุฃููุงุน ุงููุฑุงุฌุน ุงููุงุฑุบุฉ ุจุดูู ูุดุท ูููุงู goto (ูููุณ ููุชุฏุงุฎู ุงูุนููู ููุญููุฉ ูููุณ ูู ุงูุชุนูููุฉ ุงูุจุฑูุฌูุฉ ุงูููุดุฃุฉ) - ุนูู ูุฌู ุงูุฎุตูุต ุ <a href="">ููุง</a> . <br><br>  ุจุนุฏ ุงููุนุงูุฌุฉ ุ ุชุญุชุงุฌ ุฅูู ุงูุฅุดุงุฑุฉ ุฅูู ูุซูู ุชูุฌูู ุงูุฅุฎุฑุงุฌ ุงูุฐู ููุฑุฃ ููู ุงูุจูุงูุงุช. <br><br><h3 style=";text-align:right;direction:rtl">  # 2 <a href="">bool TryRead (ุฎุงุฑุฌ ูุชูุฌุฉ ReadResult)</a> </h3><br>  ุฅุตุฏุงุฑ ูุชุฒุงูู.  ูุชูุญ ูู ุงูุญุตูู ุนูู ุงููุชูุฌุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ.  ุฎูุงู ุฐูู ุ ุจุฎูุงู ReadAsync ุ ูุฅูู ูุง ูุญุธุฑ ููุนูุฏ ุฎุทุฃ.  ุฃูุถุง ุฑูุฒ ูุฐู ุงูุทุฑููุฉ ูู ุงูููู. <br><br><h3 style=";text-align:right;direction:rtl">  # 3 <a href="">ุจุงุทูุฉ AdvanceTo (SequencePosition ุงููุณุชูููุฉ ุ SequencePosition ูุญุต)</a> </h3><br>  ูู ูุฐู ุงูุทุฑููุฉ ุ ููููู ุชุญุฏูุฏ ุนุฏุฏ ุงูุจุงูุชุงุช ุงูุชู ููุญุตูุง ููุณุชููููุง.  ุณูุชู ุฅุฑุฌุงุน ุงูุจูุงูุงุช ุงูุชู ุชู ูุญุตูุง ูููู ูู ูุชู ุงุณุชููุงููุง ูู ุงููุฑุฉ ุงูุชุงููุฉ ุงูุชู ูุชู ูููุง ูุฑุงุกุชูุง.  ูุฏ ุชุจุฏู ูุฐู ุงูููุฒุฉ ุบุฑูุจุฉ ูููููุฉ ุงูุฃููู ุ ูููู ุนูุฏ ูุนุงูุฌุฉ ุฏูู ูู ุงูุจุงูุชุงุช ุ ูุงุฏุฑุงู ูุง ูููู ูู ุงูุถุฑูุฑู ูุนุงูุฌุฉ ูู ุจุงูุช ุนูู ุญุฏุฉ.  ุนุงุฏุฉ ูุชู ุชุจุงุฏู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูุฑุณุงุฆู.  ูุฏ ููุดุฃ ูููู ุฃู ุงููุงุฑุฆ ุ ุนูุฏ ุงููุฑุงุกุฉ ุ ุชููู ุฑุณุงูุฉ ูุงุญุฏุฉ ูุงููุฉ ูุฌุฒุกูุง ูู ุงูุซุงููุฉ.  ูุฌุจ ูุนุงูุฌุฉ ุงููู ุ ููุฌุจ ุชุฑู ุฌุฒุก ูู ุงูุซุงูู ูููุณุชูุจู ุญุชู ูุฃุชู ูุน ุงูุฌุฒุก ุงููุชุจูู.  ุชุฃุฎุฐ ุทุฑููุฉ AdvanceTo SequencePosition ุ ููู ูู ุงููุงูุน ููุฑุณ + ูุทุนุฉ.  ุนูุฏ ูุนุงูุฌุฉ ูู ูุง ูุฑุฃู ReadAsync ุ ููููู ุชุญุฏูุฏ ุงููุฎุฒู ุงููุคูุช.  ุจุฎูุงู ุฐูู ุ ูุฌุจ ุนููู ุฅูุดุงุก ููุถุน ุจุดูู ุตุฑูุญ ุ ูุน ุงูุฅุดุงุฑุฉ ุฅูู ุงููุทุงุน ูุงูููุฑุณ ุงููุฐูู ุชูููุช ุนูุฏููุง ุงููุนุงูุฌุฉ.  ููู ุชุญุช ุบุทุงุก ูุญุฑู ุงูุณูุงุฑุฉ. <br>  ุฃูุถูุง ุ ุฅุฐุง ูุงู ููุฏุงุฑ ุงููุนูููุงุช ุบูุฑ ุงููุณุชูููุฉ ุฃูู ูู ุงูุญุฏ ุงููุญุฏุฏ (_resumeWriterThreshold) ุ ูุณูุจุฏุฃ ุงุณุชูุฑุงุฑูุฉ PipeWriter ุฅุฐุง ุชู ุญุธุฑู.  ุจุดูู ุงูุชุฑุงุถู ุ ุชููู ูุฐู ุงูุนุชุจุฉ ุนุจุงุฑุฉ ุนู 8 ูุฌูุฏุงุช ูุทุนุฉ (ูุตู ุนุชุจุฉ ุงูุญุธุฑ). <br><br><h3 style=";text-align:right;direction:rtl">  # 4 ุงููุฑุงุบ ููุชูู (ุงุณุชุซูุงุก ุงุณุชุซูุงุก = ูุงุฑุบ) </h3><br>  ูููู PipeReader.  ุฅุฐุง ุชู ุฅููุงู PipeWriter ูู ูุฐู ุงููุฑุญูุฉ ุ ูุณูุชู ุฅููุงู ูุซูู Pipe ุงููุงูู.  ููู ูู ุงูุฏุงุฎู. <br><br><h3 style=";text-align:right;direction:rtl">  # 5 ุจุงุทูุฉ CancelPendingRead () </h3><br>  ูุณูุญ ูู ุจุฅูุบุงุก ุงููุฑุงุกุฉ ุงูููุฌูุฏุฉ ุญุงูููุง ูู ุญุงูุฉ ุงูุงูุชุธุงุฑ.  ุงูููู. <br><br><h3 style=";text-align:right;direction:rtl">  # 6 ุจุงุทู OnWriterCompleted (ุฑุฏ ุงููุนู &lt;ุงูุงุณุชุซูุงุก ุ ุงููุงุฆู&gt; ุฑุฏ ุงูุงุชุตุงู ุ ุญุงูุฉ ุงููุงุฆู) </h3><br>  ูุณูุญ ูู ุจุชุญุฏูุฏ ุงููููุถ ููุชูููุฐ ุนูุฏ ุงูุงูุชูุงุก ูู PipeWriter. <br>  ูุซู ุงูุทุฑููุฉ ุงูููุงุซูุฉ ูู PipeWriter ุ ููุฌุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> ููุณ ุงูุนูุงูุฉ ุงูุชู ุณูุชู ุฅุฒุงูุชูุง.  ููู ุชุญุช ุบุทุงุก ูุญุฑู ุงูุณูุงุฑุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูุซุงู </h2><br>  ุชูุถุญ ุงููุงุฆูุฉ ุฃุฏูุงู ูุซุงููุง ุนูู ุงูุนูู ูุน ุงูุฃูุงุจูุจ. <br>  ููุฐ ุฅุฏุฎุงู .NET Core Span ู Memory ุ ุชู ุงุณุชููุงู ุงูุนุฏูุฏ ูู ุงููุฆุงุช ููุนูู ูุน ุงูุจูุงูุงุช ุจูุงุณุทุฉ ุงูุฃุญูุงู ุงูุฒุงุฆุฏุฉ ุจุงุณุชุฎุฏุงู ูุฐู ุงูุฃููุงุน.  ูุจุงูุชุงูู ูุฅู ูุฎุทุท ุงูุชูุงุนู ุงูุนุงู ุณูููู ูู ููุณู ุชูุฑูุจุง.  ูู ุงููุซุงู ุงูุฎุงุต ุจู ุ ุงุณุชุฎุฏูุช ุฎุทูุท ุงูุฃูุงุจูุจ ููุนูู ูุน ุงูุฃูุงุจูุจ (ุฃุญุจ ุงููููุงุช ุงููุชุดุงุจูุฉ) - ูุงุฆูุงุช ูุธุงู ุงูุชุดุบูู ููุงุชุตุงู ุจูู ุงูุนูููุงุช.  ุชู ุชูุณูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงูุฃูุงุจูุจ ููููุง ูุฐูู ููุฑุงุกุฉ ุงูุจูุงูุงุช ูู Span ู Memory.  ุชุณุชุฎุฏู ุงููุณุฎุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุงูุฐุงูุฑุฉ ุ ูุธุฑูุง ูุฃู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุณูุชู ุชุญููููุง ุฅูู ุทุฑููุฉ ุงููุงูุจ ุจุงุณุชุฎุฏุงู ุขูุฉ ุงูุญุงูุฉ ุงููุญุฏูุฏุฉ ุงูุชู ูุชู ุฅูุดุงุคูุง ุชููุงุฆููุง ุ ูุงูุชู ูุชู ูููุง ุชุฎุฒูู ุฌููุน ุงููุชุบูุฑุงุช ุงููุญููุฉ ููุนููุงุช ุงูุทุฑููุฉ ุ ูุจูุง ุฃู Span ูููู refonly ุ ูุง ูููู ูุถุนูุง ูู ุงููููุฉ ุ ุนูู ุงูุชูุงูู ุ ุจุงุณุชุฎุฏุงู Span ุจุทุฑููุฉ ุบูุฑ ูุชุฒุงููุฉ ุฃูุฑ ูุณุชุญูู.  ูููู ููุงู ุฃูุถูุง ุฅุตุฏุงุฑ ูุชุฒุงูู ููุทุฑููุฉ ุงูุชู ุชุณูุญ ูู ุจุงุณุชุฎุฏุงู Span.  ูู ุงููุซุงู ุงูุฎุงุต ุจู ุ ุฌุฑุจุช ูููููุง ูุงุชุถุญ ุฃู ุงูุฅุตุฏุงุฑ ุงููุชุฒุงูู ูู ูุฐุง ุงููููู ูุธูุฑ ููุณู ุจุดูู ุฃูุถู.  ุนูุฏ ุงุณุชุฎุฏุงูู ุ ูุญุฏุซ ุชุฌููุน ุฃูู ููููุงูุฉ ุ ูุชููู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุฃุณุฑุน.  ูููู ูุฐุง ูุงู ููุท ุจุณุจุจ ูุฌูุฏ ุงููุซูุฑ ูู ุงูุจูุงูุงุช ูู ุงูุฃูุงุจูุจ (ูุงูุช ุงูุจูุงูุงุช ูุชููุฑุฉ ุฏุงุฆููุง).  ูู ุงูุญุงูุฉ ุงูุชู ูููู ูู ุงููุญุชูู ูููุง ุนุฏู ูุฌูุฏ ุจูุงูุงุช ูู ููุช ุงูุชูุฏูู ููุฏููุนุฉ ุงูุชุงููุฉ ุ ูุฌุจ ุนููู ุงุณุชุฎุฏุงู ุงูุฅุตุฏุงุฑ ุบูุฑ ุงููุชุฒุงูู ุญุชู ูุง ุชุฌูุฏ ุฎููู ุงููุนุงูุฌ. <br>  ุงููุซุงู ูู ุชุนูููุงุช ุชุดุฑุญ ุจุนุถ ุงูููุงุท.  ุฃูุฏ ุฃู ุฃููุช ุงูุชุจุงููู ุฅูู ุญูููุฉ ุฃูู ุนูู ุงูุฑุบู ูู ุฃู ุดุธุงูุง ุงูุจุฑูุงูุฌ ุงููุณุคูู ุนู ุงููุฑุงุกุฉ ูู ุงูุฃูุจูุจ ูุงููุนุงูุฌุฉ ููุตููุฉ ุ ุนูุฏ ุงููุชุงุจุฉ ุฅูู ููู ุ ุชุชู ูุฑุงุกุฉ ุงูุจูุงูุงุช ุจุงูุถุจุท ูู ุงูููุงู ุงูุฐู ุชุชู ูุชุงุจุชู ููู ุนูุฏ ุงููุฑุงุกุฉ ูู ุงูุฃูุงุจูุจ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุณููุงุช ูู ุงูุชุทูุฑ ูู ุฃุฌู ููุฒุฉ ูููุฉ - ุงูุฑุฆูุณูุฉ ุบูุฑ ูุชุฒุงูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pipe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pipe(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataWriter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PipeDataWriter(pipe.Writer, <span class="hljs-string"><span class="hljs-string">"testpipe"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataProcessor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataProcessor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConsoleBytesProcessor(), pipe.Reader); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CancellationTokenSource(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.WhenAll(dataWriter.ReadFromPipeAsync(cts.Token), dataProcessor.StartProcessingDataAsync(cts.Token)); } }</code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">PipeDataWriter</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PipeDataWriter</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> NamedPipeClientStream _namedPipe; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PipeWriter _pipeWriter; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Servername = <span class="hljs-string"><span class="hljs-string">"."</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PipeDataWriter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PipeWriter pipeWriter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pipeName</span></span></span><span class="hljs-function">)</span></span> { _pipeWriter = pipeWriter ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(pipeWriter)); _namedPipe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NamedPipeClientStream(Servername, pipeName, PipeDirection.In); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadFromPipeAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CancellationToken token</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _namedPipe.ConnectAsync(token); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { token.ThrowIfCancellationRequested(); <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/ when working with the asynchronous method, use Memory </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> //Memory</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;byte&gt;</span></span></span><span class="hljs-comment"> buffer = _pipeWriter.GetMemory(); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/ asynchronous reading from a named pipe in Memory </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/ there can be any operation to obtain data - from reading from a file to random generation. //int readBytes = await _namedPipe.ReadAsync(buffer, token); // synchronous reading from the named pipe to the requested from PipeWriter Span // there can be any operation to obtain data - from reading from a file to random generation. int readBytes = _namedPipe.Read(_pipeWriter.GetSpan()); // if there was nothing in the channel, release the thread for half a second and try again // in other cases we can break the loop, it's just example if (readBytes == 0) { await Task.Delay(500, token); continue; } // specify the amount of bytes read from the pipe _pipeWriter.Advance(readBytes); // flush data to make them available PipeReader FlushResult result = await _pipeWriter.FlushAsync(token); // if PipeReader has been completed, it no longer needs to write data // PS this behavior was chosen by me as an example, it depends on business logic if (result.IsCompleted) { break; } } // complete _pipeWriter to complete the entire instance of pipe _pipeWriter.Complete(); } }</span></span></code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">DataProcessor</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataProcessor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IBytesProcessor _bytesProcessor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PipeReader _pipeReader; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IBytesProcessor bytesProcessor, PipeReader pipeReader</span></span></span><span class="hljs-function">)</span></span> { _bytesProcessor = bytesProcessor ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(bytesProcessor)); _pipeReader = pipeReader ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(pipeReader)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartProcessingDataAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CancellationToken token</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { token.ThrowIfCancellationRequested(); <span class="hljs-comment"><span class="hljs-comment">// reading data from a pipe instance ReadResult result = await _pipeReader.ReadAsync(token); ReadOnlySequence&lt;byte&gt; buffer = result.Buffer; // We perform calculations with the data obtained. await _bytesProcessor.ProcessBytesAsync(buffer, token); // indicate to which position the data was processed. In this case, everything is written to the file. // in situations where not all data has been processed, you need to create a position manually using the buffer and index // in this situation, IBytesProcessor.ProcessBytesAsync can be supplemented by returning this position _pipeReader.AdvanceTo(buffer.End); // if PipeWriter has been completed, reading is no longer necessary // this behavior was chosen by me as an example, it depends on business logic if (result.IsCompleted) { break; } } // complete _pipeReader to complete the entire instance of pipe _pipeReader.Complete(); } }</span></span></code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">BytesProcessor</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IBytesProcessor</span></span> { <span class="hljs-function"><span class="hljs-function">Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessBytesAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReadOnlySequence&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; bytesSequence, CancellationToken token</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConsoleBytesProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">IBytesProcessor</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Let's imagine that in this class there is a normal constructor and IDisposable readonly FileStream _fileStream = new FileStream("buffer", FileMode.Create); public Task ProcessBytesAsync(ReadOnlySequence&lt;byte&gt; bytesSequence, CancellationToken token) { if (bytesSequence.IsSingleSegment) { ProcessSingle(bytesSequence.First.Span); } else { foreach (var segment in bytesSequence) { ProcessSingle(segment.Span); } } return Task.CompletedTask; } private void ProcessSingle(ReadOnlySpan&lt;byte&gt; span) { _fileStream.Write(span); } }</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar466137/">https://habr.com/ru/post/ar466137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar466121/index.html">ุชูููุฏ ุงูุตูุช ุนูู ูููุฑูููุชุฑููุฑ AVR ุจุงุณุชุฎุฏุงู ุทุฑููุฉ wavetable ูุน ุฏุนู polyphony</a></li>
<li><a href="../ar466123/index.html">ุงูููู. ุงููุฒู. ุซูุงุซุฉ ุฌูุฑุงู</a></li>
<li><a href="../ar466127/index.html">ูููุง NPP ุฃู ุงููููู ูู ุงูููุงุนู</a></li>
<li><a href="../ar466129/index.html">ููุงุกุฉ ุงูููู ุนูู ุงูุจูุฒูู ูุงูุจุทุงุฑูุงุช ูุงูููุฏุฑูุฌูู</a></li>
<li><a href="../ar466135/index.html">Megapack: ููู ุชููู ูุทูุฑู Factorio ูู ุญู ุงููุดููุฉ ูุน 200 ูุงุนุจ ูุชุนุฏุฏ ุงููุงุนุจูู</a></li>
<li><a href="../ar466139/index.html">ุชุทุจูู ุงูุชูููููุฌูุง ุนูู ุฃููุงุถ ุญูู blockchain ุฃู ุงูููุงุฆุฏ ุงูุนูููุฉ ูุชุฎุตูุต ุงูููุงุฑุฏ</a></li>
<li><a href="../ar466143/index.html">ููู ูุตูุน ุฑูุฒ ูู ุงููุฑู ุงููููู ุฃู ุฅุตุฏุงุฑ ุณูุฑุงุชุด ูู ูุนุจุฉ ููุญ Golem Battle</a></li>
<li><a href="../ar466147/index.html">ุฑุฏ ุงููุนู ูุฏูุฑ ุนุฑุถ ุงูุจูุงูุงุช. ููุฏูุฉ</a></li>
<li><a href="../ar466149/index.html">ุฅูุดุงุก ุฑูุฒ ููุตู ูุน ุงููุต "ุงูุฏููุงูููู" ูู OrCAD</a></li>
<li><a href="../ar466151/index.html">ุงูุชุญููู: ุจุฑุงูุฌ ุบุฑูุจุฉ ูู ุณุฌู ุงูุจุฑุงูุฌ ุงููุญููุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>