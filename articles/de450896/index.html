<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüíª ü•â ü§≥üèº Lab: Konfiguration von lvm, RAID unter Linux üíè üçâ üë®üèæ‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ein kleiner Exkurs: Dieser l \ r ist synthetisch. 


 Einige der hier beschriebenen Aufgaben k√∂nnen viel einfacher erledigt werden, aber da die Aufgab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lab: Konfiguration von lvm, RAID unter Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450896/"><p>  Ein kleiner Exkurs: Dieser l \ r ist synthetisch. </p><br><p>  Einige der hier beschriebenen Aufgaben k√∂nnen viel einfacher erledigt werden, aber da die Aufgabe von l / r darin besteht, sich mit der Raid-lvm-Funktionalit√§t vertraut zu machen, sind einige Operationen k√ºnstlich kompliziert. </p><br><h2 id="trebovaniya-k-instrumentam-dlya-vypolneniya-lr">  Anforderungen an Werkzeuge zur Ausf√ºhrung von l \ r: </h2><br><ul><li>  Virtualisierungstools wie Virtualbox </li><li>  Linux-Installationsimage wie <a href="">Debian9</a> </li><li>  Internetverf√ºgbarkeit zum Herunterladen mehrerer Pakete </li><li>  Verbindung √ºber ssh zur installierten VM (optional) </li></ul><br><h2 id="vnimanie">  ACHTUNG </h2><br><p>  Diese Laborarbeit ist mit so heiklen Themen wie Datensicherheit verbunden - dies ist ein Bereich, in dem Sie alle Ihre Daten aufgrund des kleinsten Fehlers verlieren k√∂nnen - einen zus√§tzlichen Buchstaben oder eine zus√§tzliche Zahl. </p><br><p>  Da Sie Laborarbeiten ausf√ºhren, sind Sie nicht in Gefahr, es sei denn, Sie m√ºssen erneut damit beginnen. </p><br><p>  Im wirklichen Leben ist alles viel ernster, daher sollten Sie die Namen der Datentr√§ger sehr sorgf√§ltig eingeben und verstehen, was genau Sie mit dem aktuellen Befehl ausf√ºhren und mit welchen Datentr√§gern Sie arbeiten. </p><a name="habracut"></a><br><p>  Der zweite wichtige Punkt ist die Benennung von Datentr√§gern und Partitionen: Je nach Situation k√∂nnen die Datentr√§gernummern von den Werten abweichen, die in den Befehlen im Labor angegeben sind. <br>  Wenn Sie beispielsweise das sda-Laufwerk aus dem Array entfernen und dann ein neues Laufwerk hinzuf√ºgen, wird das neue Laufwerk auf dem System mit dem Namen sda angezeigt.  Wenn Sie vor dem Hinzuf√ºgen einer neuen Festplatte neu starten, wird die neue Festplatte sdb und die alte sda ‚Äã‚Äãgenannt </p><br><p>  Laborarbeiten sollten unter Superuser (root) durchgef√ºhrt werden, da die meisten Befehle erh√∂hte Berechtigungen erfordern und es nicht sinnvoll ist, die Berechtigungen durch sudo st√§ndig zu erh√∂hen. </p><br><h2 id="materialy-dlya-izucheniya">  Lernmaterialien </h2><br><ul><li>  RAID </li><li>  LVM </li><li>  Linux-Datentr√§gerbenennung </li><li>  Was ist ein Abschnitt </li><li>  Was ist eine Partitionstabelle und wo wird sie gespeichert? </li><li>  Was ist Maden? </li></ul><br><h2 id="ispolzuemye-utility">  Verwendete Dienstprogramme </h2><br><ol><li>  Festplatteninformationen anzeigen: <br><ul><li>  lsblk -o NAME, GR√ñSSE, FSTYP, TYP, MONTAGEPUNKT </li><li>  fdisk -l </li></ul></li><li>  Informationen anzeigen und mit LVM arbeiten <br><ul><li>  pvs </li><li>  pvextend </li><li>  pvcreate </li><li>  pvresize </li><li>  vgs </li><li>  vgreduce </li><li>  lvs </li><li>  lvextend </li></ul></li><li>  Informationen anzeigen und mit RAID arbeiten: <br><ul><li>  cat / proc / mdstat </li><li>  mdadm </li></ul></li><li>  Montagepunkte: <br><ul><li>  montieren </li><li>  umount </li><li>  cat / etc / fstab </li><li>  cat / etc / mtab </li></ul></li><li>  Neu partitionieren der Festplatte: <br><ul><li>  fdisk / dev / XXX </li></ul></li><li>  Abschnitte kopieren: <br><ul><li>  TT wenn = / dev / xxx von = / dev / yyy </li></ul></li><li>  Arbeiten Sie mit der Partitionstabelle: <br><ul><li>  partx </li><li>  sfdisk </li><li>  mkfs.ext4 </li></ul></li><li>  Arbeiten Sie mit dem Bootloader: <br><ul><li>  grub-install / dev / XXX </li><li>  Update-Grub </li></ul></li><li>  Sonstiges <br><ul><li>  lsof </li><li>  apt </li><li>  rsync </li></ul></li></ol><br><h2 id="laboratornaya-rabota-sostoit-iz-3-h-chastey">  Die Laborarbeit besteht aus 3 Teilen: </h2><br><ul><li>  Konfigurieren eines gesunden Systems mit lvm, raid. </li><li>  Emulation des Ausfalls eines der Laufwerke. </li><li>  Ersetzen von Festplatten im laufenden Betrieb durch Hinzuf√ºgen neuer Festplatten und Partitions√ºbertragung. </li></ul><br><h2 id="zadanie-1-ustanovka-os-i-nastroyka-lvm-raid">  Aufgabe 1 (Installieren des Betriebssystems und Konfigurieren von LVM, RAID) </h2><br><ol><li><p>  Erstellen Sie eine neue virtuelle Maschine mit den folgenden Funktionen: </p><br><ul><li>  1 GB RAM </li><li>  1 CPU </li><li>  2 hdd (nennen Sie sie ssd1, ssd2 und weisen Sie die gleiche Gr√∂√üe zu, aktivieren Sie die Kontrollk√§stchen Hot Swap und ssd) </li><li>  SATA-Controller an 4 Ports konfiguriert: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/18f/6f5/be6/18f6f5be6afbc13138abc3dfe960813b.png" alt="W√§hlen Sie SSD-Festplatten"></li></ul><br></li><li><p>  Starten Sie die Installation von Linux und w√§hlen Sie die folgenden Festplatten aus: </p><br><ul><li>  Partitionierungsmethode: manuell, danach sollten Sie das folgende Bild sehen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77a/eb5/3a1/77aeb53a1de2bc7b91d1396dc9b4148e.png" alt="Partitionsdatentr√§ger"></li><li>  Einrichten einer separaten Partition unter / boot: W√§hlen Sie die erste Festplatte aus und erstellen Sie eine neue Partitionstabelle darauf: <br><ul><li>  Partitionsgr√∂√üe: 512M </li><li>  Einh√§ngepunkt: / boot </li></ul></li><li>  Wiederholen Sie die Einstellung f√ºr die zweite Festplatte. Da Sie jedoch nicht zweimal gleichzeitig mounten / booten k√∂nnen, w√§hlen Sie den Mountenpunkt: Keine und erhalten Sie schlie√ülich Folgendes (Bild mit einem Pfosten, Wiederherstellen der Faulheit): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3db/2f0/e48/3db2f0e48423f182016bde06c39dfb8d.png" alt="Partitionsdatentr√§ger"></li><li>  RAID-Setup: </li><li>  W√§hlen Sie den freien Speicherplatz auf der ersten Festplatte aus und konfigurieren Sie das physische Volume f√ºr RAID als Partitionstyp. </li><li>  W√§hlen Sie "Fertig, Partition einrichten" </li><li>  Wiederholen Sie genau die gleiche Einstellung f√ºr die zweite Festplatte, was zu Folgendem f√ºhrt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/93f/37c/ec3/93f37cec319d628a3267f94d138145e7.png" alt="Partitionsdatentr√§ger"></li><li>  W√§hlen Sie "Software-RAID konfigurieren". <br><ul><li>  Erstellen Sie ein MD-Ger√§t </li><li>  Software-RAID-Ger√§tetyp: W√§hlen Sie ein gespiegeltes Array aus </li><li>  Aktive Ger√§te f√ºr das RAID XXXX-Array: W√§hlen Sie beide Laufwerke aus </li><li>  Ersatzger√§te: Belassen Sie 0 als Standard </li><li>  Aktive Ger√§te f√ºr das RAID XX-Array: W√§hlen Sie Partitionen aus, die Sie unter RAID erstellt haben </li><li>  Beenden Sie </li></ul></li><li>  Am Ende sollten Sie dieses Bild bekommen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a7/9b0/3f5/7a79b03f556925d1fd53ccc4ca77b494.png" alt="Partitionsdatentr√§ger"></li><li>  LVM-Setup: W√§hlen Sie Configure the Logical Volume Manager </li><li>  Behalten Sie das aktuelle Partitionslayout bei und konfigurieren Sie LVM: Ja </li><li>  Erstellen Sie eine Volume-Gruppe </li><li>  Name der Datentr√§gergruppe: System </li><li>  Ger√§te f√ºr die neue Datentr√§gergruppe: W√§hlen Sie Ihr erstelltes RAID aus </li><li>  Erstellen Sie ein logisches Volume <br><ul><li>  Name des logischen Datentr√§gers: root </li><li>  logische Datentr√§gergr√∂√üe: 2 \ 5 der Gr√∂√üe Ihrer Festplatte </li></ul></li><li>  Erstellen Sie ein logisches Volume <br><ul><li>  logischer Datentr√§gername: var </li><li>  logische Datentr√§gergr√∂√üe: 2 \ 5 der Gr√∂√üe Ihrer Festplatte </li></ul></li><li>  Erstellen Sie ein logisches Volume <br><ul><li>  logischer Datentr√§gername: log </li><li>  logische Datentr√§gergr√∂√üe: 1 \ 5 der Gr√∂√üe Ihrer Festplatte </li></ul></li><li>  Wenn Sie Konfigurationsdetails anzeigen ausw√§hlen, sollte das folgende Bild angezeigt werden: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b8/8dd/11f/0b88dd11f9372dbf8e53a6727fc69b27.png" alt="Partitionsdatentr√§ger"></li><li>  Nach Abschluss der LVM-Konfiguration sollte Folgendes angezeigt werden: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/72b/9d4/00d/72b9d400d9b83392c759b7aeb3e9d573.png" alt="Partitionsdatentr√§ger"></li><li>  Partitionierung: W√§hlen Sie wiederum jedes in LVM erstellte Volume aus und partitionieren Sie es beispielsweise f√ºr root wie folgt: <br><ul><li>  Verwendung als: ext4 </li><li>  Einh√§ngepunkt: / </li></ul></li><li>  Das Ergebnis der Markierung der Root-Partition sollte wie folgt sein: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/225/61e/0be/22561e0be2cd905e0948a63ae3460461.png" alt="Partitionsdatentr√§ger"></li><li>  Wiederholen Sie den Markup-Vorgang f√ºr var und log, indem Sie die entsprechenden Einh√§ngepunkte ausw√§hlen (/ var und / var / log manuell eingeben), um das folgende Ergebnis zu erhalten: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5da/58c/756/5da58c756fd8d205a93ebfd49acc396f.png" alt="Partitionsdatentr√§ger"></li><li>  W√§hlen Sie Partitionierung beenden </li><li>  Sie werden ein paar Fragen dazu gestellt, ob Sie noch eine nicht gemountete Partition haben und Swap nicht konfiguriert ist.  Beide Fragen sollten verneint werden. </li><li>  Das Endergebnis sollte folgenderma√üen aussehen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/117/381/a61/117381a61b766df3c89d2646baa2b33d.png" alt="Partitionsdatentr√§ger"></li></ul><br></li><li><p>  Beenden Sie die Betriebssysteminstallation, indem Sie grub auf dem ersten Ger√§t (sda) installieren und das System starten. </p><br></li><li><p>  Kopieren Sie den Inhalt der Partition / boot vom Laufwerk sda (ssd1) auf das Laufwerk sdb (ssd2) </p><br><pre><code class="plaintext hljs">dd if=/dev/sda1 of=/dev/sdb1</code> </pre> <br></li><li><p>  Installieren Sie grub auf dem zweiten Ger√§t: </p><br><ul><li><p>  Laufwerke im System anzeigen: </p><br><pre> <code class="plaintext hljs">fdisk -l lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br></li><li>  Listen Sie alle Datentr√§ger auf, die der vorherige Befehl an Sie ausgegeben hat, und beschreiben Sie, um welchen Datentr√§gertyp es sich handelt. </li><li><p>  Suchen Sie das Laufwerk, auf dem grub nicht installiert wurde, und schlie√üen Sie diese Installation ab: </p><br><pre> <code class="plaintext hljs">grub-install /dev/sdb</code> </pre> <br></li><li>  Sehen Sie sich den aktuellen √úberfall mit cat / proc / mdstat an und schreiben Sie auf, was Sie gesehen haben. </li><li>  Schauen Sie sich die Ausgabe der Befehle an: pvs, vgs, lvs, mount und schreiben Sie auf, was genau Sie gesehen haben. </li></ul><br></li></ol><br><p>  Beschreiben Sie in eigenen Worten, was Sie getan haben und welches Ergebnis Sie als Ergebnis der abgeschlossenen Aufgabe erzielt haben. </p><br><p>  Nach Abschluss dieser Aufgabe wird empfohlen, den Ordner mit der virtuellen Maschine zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sichern</a> oder eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vagabundbox zu erstellen</a> . </p><br><p>  Ergebnis: Eine virtuelle Maschine mit ssd1-, ssd2-Festplatten. </p><br><h2 id="zadanie-2-emulyaciya-otkaza-odnogo-iz-diskov">  Aufgabe 2 (Emulieren des Ausfalls eines der Laufwerke) </h2><br><ol><li>  Wenn Sie das Kontrollk√§stchen Hot-Swap aktiviert haben, k√∂nnen Sie Datentr√§ger im laufenden Betrieb l√∂schen: <br><ul><li>  L√∂schen Sie das Laufwerk ssd1 in den Maschineneigenschaften. </li><li>  Suchen Sie das Verzeichnis, in dem die Dateien Ihrer virtuellen Maschine gespeichert sind, und l√∂schen Sie ssd1.vmdk. </li></ul></li><li>  Stellen Sie sicher, dass Ihre virtuelle Maschine noch ausgef√ºhrt wird. </li><li>  Starten Sie die virtuelle Maschine neu und stellen Sie sicher, dass sie noch funktioniert </li><li>  √úberpr√ºfen Sie den Status des RAID-Arrays: <code>cat /proc/mdstat</code> </li><li>  F√ºgen Sie der VM-Schnittstelle eine neue Festplatte derselben Gr√∂√üe hinzu und nennen Sie sie ssd3. </li><li>  Operationen ausf√ºhren: <br><ul><li>  Sehen Sie sich die neue Festplatte an, die mit dem <code>fdisk -l</code> auf das System kommt </li><li>  Kopieren Sie die Partitionstabelle von der alten Festplatte auf die neue: <code>sfdisk -d /dev/XXXX | sfdisk /dev/YYY</code> <code>sfdisk -d /dev/XXXX | sfdisk /dev/YYY</code> </li><li>  Zeigen Sie das Ergebnis mit <code>fdisk -l</code> </li><li>  F√ºgen Sie dem RAID-Array eine neue Festplatte hinzu: <code>mdadm --manage /dev/md0 --add /dev/YYY</code> </li><li>  Siehe das Ergebnis: <code>cat /proc/mdstat</code> .  Sie sollten sehen, dass die Synchronisation gestartet wurde. </li></ul></li><li><p>  Jetzt m√ºssen Sie Partitionen, die nicht Teil des RAID sind, manuell synchronisieren.  Dazu verwenden wir das Dienstprogramm dd und kopieren von der "Live" -Diskette auf die neue, die Sie k√ºrzlich installiert haben: </p><br><pre> <code class="plaintext hljs">dd if=/dev/XXX of=/dev/YYY</code> </pre> <br></li><li>  Installieren Sie nach Abschluss der Synchronisierung grub auf der neuen Festplatte. </li><li>  Starten Sie die VM neu, um sicherzustellen, dass alles funktioniert. </li></ol><br><p>  Beschreiben Sie in eigenen Worten, was Sie getan haben und welches Ergebnis Sie als Ergebnis der abgeschlossenen Aufgabe erzielt haben. </p><br><p>  <strong>Ergebnis:</strong> ssd1-Laufwerk entfernt, ssd2-Laufwerk gespeichert, ssd3-Laufwerk hinzugef√ºgt. </p><br><h2 id="zadanie-3-dobavlenie-novyh-diskov-i-perenos-razdela">  Aufgabe 3 (Hinzuf√ºgen neuer Festplatten und Partitionieren) </h2><br><p>  Dies ist die schwierigste und umfangreichste Aufgabe aller vorgestellten.  √úberpr√ºfen Sie sorgf√§ltig, was Sie tun und mit welchen Festplatten und Partitionen.  Es wird empfohlen, vor dem Ausf√ºhren eine Kopie zu erstellen.  Diese Aufgabe kann unabh√§ngig von Aufgabe 2 nach Aufgabe 1 ausgef√ºhrt werden, angepasst an die Datentr√§gernamen. </p><br><p>  Der zweite Teil der Aufgabe dieses Labors sollte zu genau demselben Zustand f√ºhren wie nach dem ersten Teil. </p><br><p>  Um Ihnen die Arbeit zu erleichtern, empfehle ich, Festplatten nicht physisch vom Host-Computer zu l√∂schen, sondern nur in den Eigenschaften des Computers zu trennen.  Aus Sicht des Betriebssystems in der VM sieht dies genauso aus. In diesem Fall k√∂nnen Sie das Laufwerk wieder verbinden und weiterarbeiten, indem Sie einige Punkte zur√ºcksetzen, falls Sie Probleme haben.  M√∂glicherweise haben Sie eine fehlerhafte Ausf√ºhrung vorgenommen oder vergessen, die / boot-Partition auf eine neue Festplatte zu kopieren.  Ich kann Ihnen nur raten, mehrmals zu √ºberpr√ºfen, mit welchen Datentr√§gern und Partitionen Sie arbeiten, und noch besser, die Entsprechung von Datentr√§gern, Partitionen und der "physischen" Datentr√§gernummer auf ein Blatt Papier zu schreiben.  Der Befehl <code>lsblk</code> zeichnet einen sch√∂nen und verst√§ndlichen Baum. Verwenden Sie ihn so oft wie m√∂glich, um zu analysieren, was Sie getan haben und was getan werden muss. </p><br><p>  Zur Geschichte ... </p><br><p>  Stellen Sie sich vor, Ihr Server hat lange auf 2 SSD-Festplatten gearbeitet, als pl√∂tzlich ... </p><br><ol><li><p>  Simulieren Sie einen SSD2-Festplattenfehler, indem Sie die Festplatte aus den VM-Eigenschaften entfernen und neu starten. </p><br></li><li><p>  Zeigen Sie den aktuellen Status von Festplatten und RAID an: </p><br><pre> <code class="plaintext hljs">cat /proc/mdstat fdisk -l lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br></li><li><p>  Sie haben Gl√ºck - die Beh√∂rden d√ºrfen mehrere neue Discs kaufen: </p><br><p>  2 Gro√üe SATA-Volumes f√ºr die l√§ngst √ºberf√§llige Aufgabe, den Protokollabschnitt auf eine separate Festplatte zu verschieben.  2 SSDs als Ersatz f√ºr den Verstorbenen sowie als Ersatz f√ºr den noch funktionierenden. </p><br><p>  Beachten Sie, dass der Serverkorb die Installation von nur 4 Laufwerken unterst√ºtzt.  Sie k√∂nnen also nicht alle Festplatten gleichzeitig hinzuf√ºgen. </p><br><p>  Die Lautst√§rke der Festplatte ist doppelt so hoch wie die der SSD. <br>  Das SSD-Volumen entspricht dem 1,25-fachen der Gr√∂√üe der fr√ºheren SSD. </p><br></li><li><p>  F√ºgen Sie ein neues ssd-Laufwerk hinzu, nennen Sie es ssd4, und √ºberpr√ºfen Sie nach dem Hinzuf√ºgen, was passiert ist: </p><br><pre> <code class="plaintext hljs">fdisk -l lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br></li><li><p>  Zun√§chst sollten Sie sich um die Datensicherheit der alten Festplatte k√ºmmern.  Dieses Mal werden wir Daten mit LVM √ºbertragen: </p><br><ul><li><p>  Zun√§chst m√ºssen Sie die Dateitabelle von der alten Festplatte auf die neue kopieren: </p><br><pre> <code class="plaintext hljs">sfdisk -d /dev/XXX | sfdisk /dev/YYY</code> </pre> <br><p>  Ersetzen Sie die richtigen Datentr√§ger anstelle von x, y und finden Sie heraus, was dieser Befehl bewirkt. </p><br></li><li>  F√ºhren Sie lsblk -o NAME, SIZE, FSTYPE, TYPE, MOUNTPOINT aus und vergleichen Sie die Ausgabe mit dem vorherigen Aufruf.  Was hat sich ge√§ndert? </li><li><p>  Verwenden Sie den Befehl dd, um die / boot-Daten auf die neue Festplatte zu kopieren: </p><br><pre> <code class="plaintext hljs">dd if=/dev/XXX of=/dev/YYY</code> </pre> <br></li><li><p>  Wenn / boot auf dem alten Laufwerk bereitgestellt bleibt, sollte es auf einem aktiven Laufwerk bereitgestellt werden: </p><br><pre> <code class="bash hljs">mount | grep boot <span class="hljs-comment"><span class="hljs-comment">#     lsblk #           ,     umount /boot #  /boot mount -a #      /etc/fstab. #      /dev/sda,        </span></span></code> </pre> <br></li><li><p>  Installieren Sie den Bootloader auf dem neuen SSD-Laufwerk: </p><br><pre> <code class="plaintext hljs">grub-install /dev/YYY</code> </pre> <br><p>  Warum machen wir diese Operation? </p><br></li><li><p>  Erstellen Sie ein neues RAID-Array mit nur einem neuen SSD-Laufwerk: </p><br><pre> <code class="plaintext hljs">mdadm --create --verbose /dev/md63 --level=1 --raid-devices=1 /dev/YYY</code> </pre> <br><p>  Der obige Befehl funktioniert nicht ohne Angabe eines speziellen Schl√ºssels. Lesen Sie die Hilfe und f√ºgen Sie diesen Schl√ºssel dem Befehl hinzu. </p><br></li><li>  Verwenden Sie den Befehl cat / proc / mdstat, um das Ergebnis Ihrer Operation zu √ºberpr√ºfen.  Was hat sich ge√§ndert? </li><li>  F√ºhren Sie lsblk -o NAME, SIZE, FSTYPE, TYPE, MOUNTPOINT aus und vergleichen Sie die Ausgabe mit dem vorherigen Aufruf.  Was hat sich ge√§ndert? </li></ul><br></li><li><p>  Der n√§chste Schritt ist die Konfiguration von LVM </p><br><ul><li>  F√ºhren Sie den Befehl pvs aus, um Informationen zu aktuellen physischen Volumes anzuzeigen. </li><li><p>  Erstellen Sie ein neues physisches Volume, indem Sie das zuvor erstellte RAID-Array hinzuf√ºgen: </p><br><pre> <code class="plaintext hljs">pvcreate /dev/md63</code> </pre> <br></li><li>  F√ºhren Sie lsblk -o NAME, SIZE, FSTYPE, TYPE, MOUNTPOINT aus und vergleichen Sie die Ausgabe mit dem vorherigen Aufruf.  Was hat sich ge√§ndert? </li><li>  F√ºhren Sie den Befehl pvs erneut aus.  Was hat sich ge√§ndert? </li><li><p>  Erh√∂hen Sie die Gr√∂√üe des Volume Group-Systems mit dem folgenden Befehl: </p><br><pre> <code class="plaintext hljs">vgextend system /dev/md63</code> </pre> <br></li><li><p>  F√ºhren Sie die Befehle aus und notieren Sie, was Sie gesehen und was sich ge√§ndert hat. </p><br><pre> <code class="plaintext hljs">vgdisplay system -v pvs vgs lvs -a -o+devices</code> </pre> <br><p>  Auf welcher physischen Festplatte befinden sich LV var, log, root jetzt? </p><br></li><li><p>  Verschieben Sie Daten vom alten Laufwerk auf das neue, indem Sie die richtigen Ger√§tenamen ersetzen. </p><br><pre> <code class="plaintext hljs">pvmove -i 10 -n /dev/system/root /dev/md0 /dev/md63</code> </pre> <br><p>  Wiederholen Sie den Vorgang f√ºr alle logischen Volumes. </p><br></li><li><p>  F√ºhren Sie die Befehle aus und notieren Sie, was Sie gesehen und was sich ge√§ndert hat. </p><br><pre> <code class="plaintext hljs">vgdisplay system -v pvs vgs lvs -a -o+devices lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br></li><li><p>  √Ñndern Sie unsere VG, indem Sie den alten √úberfall entfernen.  Ersetzen Sie den richtigen Schlachtzugsnamen. </p><br><pre> <code class="plaintext hljs">vgreduce system /dev/md0</code> </pre> <br></li><li><p>  F√ºhren Sie die Befehle aus und notieren Sie, was Sie gesehen und was sich ge√§ndert hat. </p><br><pre> <code class="plaintext hljs">lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT pvs vgs</code> </pre> <br></li><li>  F√ºr die Sch√∂nheit des Bildes mounten / booten Sie erneut auf dem zweiten ssd-Laufwerk (ssd4) und f√ºhren Sie lsblk aus.  Daher sollte nichts auf der ssd3-Festplatte gemountet werden.  √úberpr√ºfen Sie sorgf√§ltig, ob die Partition / boot nicht leer ist!  <code>ls /boot</code> sollte mehrere Dateien und Ordner anzeigen.  Untersuchen Sie, was in diesem Abschnitt gespeichert ist, und notieren Sie, welche Datei / welches Verzeichnis f√ºr was verantwortlich ist. </li></ul><br></li><li><p>  Entfernen Sie die ssd3-Festplatte und f√ºgen Sie ssd5, hdd1, hdd2 gem√§√ü der obigen TK hinzu. </p><br><ul><li>  ssd4 - erste neue ssd </li><li>  ssd5 - zweite neue ssd </li><li>  hdd1 - die erste neue hdd </li><li>  hdd2 - zweite neue hdd </li></ul><br></li><li><p>  √úberpr√ºfen Sie, was nach dem Hinzuf√ºgen von Datentr√§gern passiert ist: </p><br><pre> <code class="plaintext hljs">fdisk -l lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br></li><li><p>  Lassen Sie uns das Haupt-Raid-Array wiederherstellen: </p><br><ul><li><p>  Kopieren Sie die Partitionstabelle und ersetzen Sie die richtigen Datentr√§ger: </p><br><pre> <code class="plaintext hljs">sfdisk -d /dev/XXX | sfdisk /dev/YYY</code> </pre> <br></li><li><p>  Beachten Sie, dass sich beim Kopieren der Partitionstabelle von der alten Festplatte herausstellte, dass die neue Gr√∂√üe nicht den gesamten Festplattenspeicher belegt.  Daher m√ºssen wir bald die Gr√∂√üe dieses Abschnitts √§ndern und den RAID erweitern.  √úberzeugen Sie sich selbst, indem Sie den folgenden Befehl eingeben: </p><br><pre> <code class="plaintext hljs">lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br></li></ul><br></li><li><p>  Kopieren Sie die Boot-Partition / boot von ssd4 nach ssd5: </p><br><pre> <code class="plaintext hljs">dd if=/dev/XXX of=/dev/YYY</code> </pre> <br></li><li><p>  Installieren Sie grub auf der neuen Festplatte (ssd5). </p><br></li><li><p>  √Ñndern Sie die Gr√∂√üe der zweiten Partition des ssd5-Laufwerks. </p><br><ul><li><p>  F√ºhren Sie das Dienstprogramm zum Arbeiten mit dem Festplattenlayout aus: </p><br><pre> <code class="plaintext hljs">fdisk /dev/XXX</code> </pre> <br></li><li>  Geben Sie die Taste d ein, um die vorhandene Partition zu l√∂schen (w√§hlen Sie 2). </li><li>  Geben Sie die Taste n ein, um eine neue Partition zu erstellen. </li><li>  Geben Sie den Schl√ºssel p ein, um den Typ der prim√§ren Partition anzugeben. </li><li>  Geben Sie Schl√ºssel 2 ein, damit die neue Partition eine zweite Nummer hat. </li><li>  Erster Sektor: Dr√ºcken Sie die Eingabetaste, um die automatisch berechnete Startgr√∂√üe des Abschnitts zu akzeptieren. </li><li>  Letzter Sektor: Dr√ºcken Sie die Eingabetaste, um die automatisch berechnete Gr√∂√üe des Endabschnitts zu akzeptieren. </li><li>  Geben Sie die Taste l ein, um eine Liste aller m√∂glichen Partitionstypen anzuzeigen und Linux raid auto darin zu finden. </li><li>  Geben Sie den Schl√ºssel t ein, um den Typ der erstellten Partition (2) zu √§ndern, und geben Sie die im vorherigen Schritt gefundene Nummer ein. </li><li>  Geben Sie die Taste w ein, um die √Ñnderung auf die Festplatte zu schreiben. </li></ul><br></li><li><p>  Lesen Sie die Partitionstabelle erneut und √ºberpr√ºfen Sie das Ergebnis: </p><br><pre> <code class="plaintext hljs">partx -u /dev/XXX lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br><ul><li><p>  F√ºgen Sie dem aktuellen RAID-Array eine neue Festplatte hinzu (vergessen Sie nicht, die richtigen Festplatten zu ersetzen): </p><br><pre> <code class="plaintext hljs">mdadm --manage /dev/md63 --add /dev/sda2</code> </pre> <br></li><li><p>  Wir erweitern die Anzahl der Festplatten in unserem Array auf 2 Teile: </p><br><pre> <code class="plaintext hljs">mdadm --grow /dev/md63 --raid-devices=2</code> </pre> <br></li><li><p>  Schauen Sie sich das Ergebnis an: Wir haben 2 Arrays markiert, aber beide Abschnitte in diesem Array haben unterschiedliche Gr√∂√üen: </p><br><pre> <code class="plaintext hljs">lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br></li></ul><br></li><li><p>  Erh√∂hen Sie die Gr√∂√üe der Partition auf der ssd4-Festplatte </p><br><ul><li><p>  F√ºhren Sie das Dienstprogramm zum Arbeiten mit dem Festplattenlayout aus: </p><br><pre> <code class="plaintext hljs">fdisk /dev/XXX</code> </pre> <br></li><li>  Geben Sie die Taste d ein, um die vorhandene Partition zu l√∂schen (w√§hlen Sie 2). </li><li>  Geben Sie die Taste n ein, um eine neue Partition zu erstellen. </li><li>  Geben Sie den Schl√ºssel p ein, um den Typ der prim√§ren Partition anzugeben. </li><li>  Geben Sie Schl√ºssel 2 ein, damit die neue Partition eine zweite Nummer hat. </li><li>  Erster Sektor: Dr√ºcken Sie die Eingabetaste, um die automatisch berechnete Startgr√∂√üe des Abschnitts zu akzeptieren. </li><li>  Letzter Sektor: Dr√ºcken Sie die Eingabetaste, um die automatisch berechnete Gr√∂√üe des Endabschnitts zu akzeptieren. </li><li>  W√§hlen Sie am Ende des Markups Nein aus, um die Signatur zu hinterlassen, dass der Abschnitt zum Array geh√∂rt. </li><li>  Geben Sie die Taste w ein, um die √Ñnderung auf die Festplatte zu schreiben. </li></ul><br></li><li><p>  Wir lesen die Partitionstabelle erneut und √ºberpr√ºfen das Ergebnis. </p><br><pre> <code class="plaintext hljs">partx -u /dev/XXX lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> </pre> <br><p>  Bitte beachten Sie, dass jetzt sda2- und sdc2-Partitionen gr√∂√üer sind als das RAID-Ger√§t. </p><br></li><li><p>  Zu diesem Zeitpunkt kann die Schlachtzugsgr√∂√üe jetzt erweitert werden: </p><br><pre> <code class="bash hljs">mdadm --grow /dev/md63 --size=max lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT <span class="hljs-comment"><span class="hljs-comment"># check result</span></span></code> </pre> <br><p>  Durchsuchen Sie lsblk und notieren Sie, was sich ge√§ndert hat. </p><br></li><li><p>  Obwohl wir die RAID-Gr√∂√üe ge√§ndert haben, haben sich die Gr√∂√üen von vg root, var, log selbst nicht ge√§ndert. </p><br><ul><li><p>  Schauen Sie sich an, wie gro√ü PV ist: </p><br><pre> <code class="bash hljs">pvs</code> </pre> <br></li><li><p>  Erweitern Sie die Gr√∂√üe unserer PV: </p><br><pre> <code class="bash hljs">pvresize /dev/md63</code> </pre> <br></li><li><p>  Schauen Sie sich an, wie gro√ü PV ist: </p><br><pre> <code class="bash hljs">pvs</code> </pre> <br></li></ul><br></li><li><p>  F√ºgen Sie den neu erscheinenden Ort VG var, root hinzu: </p><br><pre> <code class="bash hljs">lvs <span class="hljs-comment"><span class="hljs-comment">#     lvextend -l +50%FREE /dev/system/root lvextend -l +100%FREE /dev/system/var lvs #   </span></span></code> </pre> <br><p>  Zu diesem Zeitpunkt haben Sie die Migration des Hauptarrays auf neue Festplatten abgeschlossen.  Arbeit mit ssd1, ssd2 ist beendet. </p><br></li><li><p>  Unsere n√§chste Aufgabe ist es, / var / log auf neue Laufwerke zu verschieben. Dazu erstellen wir ein neues Array und lvm auf Festplattenlaufwerken. </p><br><ul><li><p>  Mal sehen, welche Namen die neuen Festplattenlaufwerke haben: </p><br><pre> <code class="bash hljs">fdisk -l</code> </pre> <br></li><li><p>  Erstellen Sie ein Raid-Array: </p><br><pre> <code class="bash hljs">mdadm --create /dev/md127 --level=1 --raid-devices=2 /dev/sdc /dev/sdd</code> </pre> <br></li><li><p>  Erstellen Sie im Raid eine neue PV aus gro√üen Festplatten: </p><br><pre> <code class="bash hljs">pvcreate data /dev/md127</code> </pre> <br></li><li><p>  Erstellen Sie in dieser PV eine Gruppe mit dem Namen data: </p><br><pre> <code class="bash hljs">vgcreate data /dev/md127</code> </pre> <br></li><li><p>  Erstellen Sie ein logisches Volume mit der Gr√∂√üe des gesamten freien Speicherplatzes und nennen Sie es val_log: </p><br><pre> <code class="bash hljs">lvcreate -l 100%FREE -n var_log data <span class="hljs-comment"><span class="hljs-comment"># lvs #  </span></span></code> </pre> <br></li><li><p>  Formatieren Sie die erstellte Partition in ext4: </p><br><pre> <code class="bash hljs">mkfs.ext4 /dev/mapper/data-var_log</code> </pre> <br></li><li><p>  Mal sehen, das Ergebnis: </p><br><pre> <code class="bash hljs">lsblk</code> </pre> <br></li></ul><br></li><li><p>  √úbertragen Sie die Protokolldaten vom alten in den neuen Abschnitt </p><br><ul><li><p>  Wir werden einen tempor√§ren neuen Protokollspeicher bereitstellen: </p><br><pre> <code class="plaintext hljs">mount /dev/mapper/data-var_log /mnt</code> </pre> <br></li><li><p>  Lassen Sie uns die Abschnitte synchronisieren: </p><br><pre> <code class="bash hljs">apt install rsync rsync -avzr /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/ /mnt/</code> </pre> <br></li><li><p>  Finden Sie heraus, welche Prozesse jetzt mit / var / log ausgef√ºhrt werden: </p><br><pre> <code class="bash hljs">apt install lsof lsof | grep <span class="hljs-string"><span class="hljs-string">'/var/log'</span></span></code> </pre> <br></li><li><p>  Wir stoppen diese Prozesse: </p><br><pre> <code class="bash hljs">systemctl stop rsyslog.service syslog.socket</code> </pre> <br></li><li><p>  Wir werden die endg√ºltige Synchronisation der Partitionen durchf√ºhren (der Daten, die sich seit der letzten Synchronisation ge√§ndert haben k√∂nnten): </p><br><pre> <code class="bash hljs">rsync -avzr /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/ /mnt/</code> </pre> <br></li><li><p>  Tauschen Sie die Abschnitte aus: </p><br><pre> <code class="bash hljs">umount /mnt umount /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> mount /dev/mapper/data-var_log /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br></li><li><p>  √úberpr√ºfen Sie, was passiert ist: </p><br><pre> <code class="bash hljs">lsblk</code> </pre> <br></li></ul><br></li><li><p>  Bearbeiten Sie / etc / fstab </p><br><p>  fstab - Eine Datei, in die die Regeln geschrieben werden, nach denen Partitionen beim Booten bereitgestellt werden.  Unsere Aufgabe ist es, die Zeile zu finden, in der / var / log gemountet ist, und das <code>system-log</code> auf <code>data-var_log</code> . </p><br></li><li><p>  Das Wichtigste in dieser Phase ist, sich daran zu erinnern, die Partitionstabelle zu √§ndern (z. B. ext4).  Da wir alle Arten von RAIDs √§ndern, lvm - bis der FS auf der Partition benachrichtigt wird, dass sich die Partitionsgr√∂√üe jetzt ge√§ndert hat, k√∂nnen wir den neuen Speicherplatz nicht verwenden.  Verwenden Sie den Befehl <code>resize2fs</code> , um den FS zu √§ndern. </p><br></li><li><p>  Schlussakkord </p><br><ul><li>  Lassen Sie uns neu starten.  Wenn Sie alles richtig gemacht haben, befinden Sie sich wieder in Ihrem Betriebssystem (dies ist erforderlich, um sicherzustellen, dass alles funktioniert. Dieser Schritt hat keine Bedeutung au√üer dem Selbsttest). </li><li><p>  √úberpr√ºfen Sie, ob alles, was wir tun wollten, wirklich getan wurde: </p><br><pre> <code class="bash hljs">pvs lvs vgs lsblk cat /proc/mdstat</code> </pre> <br></li></ul><br></li><li><p>  [OPTIONAL] Befolgen Sie die Schritte </p><br><ul><li>  Starten Sie den Computer neu, indem Sie F12 dr√ºcken, um beim Booten verschiedene Datentr√§ger anzuzeigen, um sicherzustellen, dass Sie von jedem der SSD-Datentr√§ger booten k√∂nnen, damit wir keine Angst haben, dass einer von ihnen ausf√§llt. </li><li><p>  Sie haben jetzt das unn√∂tige LV-Protokoll im VG-System.  Verteilen Sie diesen Abstand zwischen root oder var. Geben Sie jedoch anstelle des 100% FREE-Konstrukts die Gr√∂√üe mit den H√§nden mit dem Schalter -L an: </p><br><pre> <code class="bash hljs">-L 500M</code> </pre> <br></li><li>  Beheben Sie das Problem mit der Tatsache, dass sich / boot ohne Synchronisierung auf zwei Partitionen befindet. Sie m√ºssen dies nicht richtig tun. Hier wird es als Beispiel hinzugef√ºgt.  Vergessen Sie nicht, den Inhalt von / boot irgendwo hin zu kopieren. </li><li>  Erstellen Sie einen neuen Schlachtzug und f√ºgen Sie sda1, sda2 hinzu. </li><li>  Nehmen Sie diese Partitionen in Ihren vorhandenen RAID auf und stellen Sie den RAID im Grunde wieder her, ohne ihn jedoch weiter zu mounten. </li></ul><br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450896/">https://habr.com/ru/post/de450896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450886/index.html">Hintergrund: Wie Wasserstoffautos funktionieren und wann sie auf den Stra√üen erscheinen</a></li>
<li><a href="../de450888/index.html">Swift: Sieb von Eratosthenes</a></li>
<li><a href="../de450890/index.html">Google I / O News 2019: Pixel 3a, Android Q, Kotlin und mehr</a></li>
<li><a href="../de450892/index.html">Ist die Speichergeschwindigkeit f√ºr etcd geeignet? Fragen Sie fio</a></li>
<li><a href="../de450894/index.html">√úber Antennen f√ºr die Kleinsten</a></li>
<li><a href="../de450898/index.html">Schnittstellenentwicklung auf mehreren Bildschirmen. Schritt zur Verwendung von AI</a></li>
<li><a href="../de450902/index.html">Willst du treue Mitarbeiter - fang mit dir selbst an</a></li>
<li><a href="../de450904/index.html">Praktische Informationen zum Bereitstellen einer dockerisierten ASP.NET Core-Anwendung auf Heroku</a></li>
<li><a href="../de450906/index.html">Wie man anf√§ngt, Salat zu leben und anzubauen</a></li>
<li><a href="../de450908/index.html">Blacklist-Netzwerke f√ºr Asterisk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>