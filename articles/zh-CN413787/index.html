<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ğŸŠ ğŸ† è§’åº¦ï¼šngx-translateã€‚ ä½¿ç”¨Webpackæ”¹å–„åŸºç¡€æ¶æ„ ğŸ“Œ ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ½ ğŸ¤˜ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ 


 ç°åœ¨æ˜¯æ—¶å€™è¿›è¡Œngxè½¬æ¢ç”Ÿæ´»æŠ€å·§äº†ã€‚ æœ€åˆï¼Œæˆ‘è®¡åˆ’äº†3ä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯ç”±äºç¬¬äºŒéƒ¨åˆ†å®é™…ä¸Šä¸æ˜¯éå¸¸æœ‰ç”¨-åœ¨æ­¤ï¼Œæˆ‘å°†å°è¯•å°½å¯èƒ½ç®€è¦åœ°æ€»ç»“ç¬¬äºŒéƒ¨åˆ†ã€‚ 


 ç¬¬ä¸€éƒ¨åˆ† 


è€ƒè™‘ç”¨AppTranslateLoaderä»£æ›¿TranslateHttpLoader ã€‚ æˆ‘ä»¬çš„AppTranslate...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è§’åº¦ï¼šngx-translateã€‚ ä½¿ç”¨Webpackæ”¹å–„åŸºç¡€æ¶æ„</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413787/"><p> å¤§å®¶å¥½ </p><br><p> ç°åœ¨æ˜¯æ—¶å€™è¿›è¡Œngxè½¬æ¢ç”Ÿæ´»æŠ€å·§äº†ã€‚ æœ€åˆï¼Œæˆ‘è®¡åˆ’äº†3ä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯ç”±äºç¬¬äºŒéƒ¨åˆ†å®é™…ä¸Šä¸æ˜¯éå¸¸æœ‰ç”¨-åœ¨æ­¤ï¼Œæˆ‘å°†å°è¯•å°½å¯èƒ½ç®€è¦åœ°æ€»ç»“ç¬¬äºŒéƒ¨åˆ†ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> </p><br><p>è€ƒè™‘ç”¨<code>AppTranslateLoader</code>ä»£æ›¿<code>TranslateHttpLoader</code> ã€‚ æˆ‘ä»¬çš„<code>AppTranslateLoader</code>é¦–å…ˆä¼šæ³¨æ„æµè§ˆå™¨è¯­è¨€ï¼Œå¹¶åŒ…å«å›é€€é€»è¾‘ï¼Œå¯¼å…¥MomentJsæœ¬åœ°åŒ–å¹¶é€šè¿‡APP_INITIALIZERè¿›è¡ŒåŠ è½½ã€‚ æ­¤å¤–ï¼Œç”±äºç»“åˆäº†ç”Ÿæ´»ä¸­çš„ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶åœ¨é¡¹ç›®ä¸­åˆ›å»ºæ–¹ä¾¿ä¸”çµæ´»çš„æœ¬åœ°åŒ–åŸºç¡€ç»“æ„ã€‚ </p><br><p> ä¸»è¦ç›®æ ‡ä¸æ˜¯<code>AppTranslateLoader</code> ï¼ˆå› ä¸ºå®ƒå¾ˆç®€å•ï¼Œè€Œä¸”åˆ¶ä½œèµ·æ¥å¹¶ä¸å›°éš¾ï¼‰ï¼Œè€Œæ˜¯åˆ›å»ºåŸºç¡€ç»“æ„ã€‚ </p><br><p> æˆ‘è¯•å›¾å†™å°½å¯èƒ½å®¹æ˜“è®¿é—®çš„ä¸œè¥¿ï¼Œä½†æ˜¯å› ä¸ºæœ¬æ–‡æœ‰å¾ˆå¤šå†…å®¹å¯ä»¥æ›´è¯¦ç»†åœ°æè¿°-è¿™å°†èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå¹¶ä¸”å¯¹äºé‚£äº›å·²ç»çŸ¥é“å¦‚ä½•åšçš„äººæ¥è¯´ä¸ä¼šå¾ˆæœ‰è¶£ã€‚ å› æ­¤ï¼Œæœ¬æ–‡å¯¹åˆå­¦è€…ä¸æ˜¯å¾ˆå‹å¥½ã€‚ å¦ä¸€æ–¹é¢ï¼Œæœ€åæœ‰ä¸€ä¸ªæŒ‡å‘ç¤ºä¾‹äº§å“çš„é“¾æ¥ã€‚ </p><a name="habracut"></a><br><p> åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œé™¤äº†é€šè¿‡httpä¸‹è½½è¯­è¨€ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç¼–å†™ä¸€ç§åŠ è½½å™¨ï¼Œä»¥ä¾¿åœ¨ç»„è£…é˜¶æ®µå°†å¿…è¦çš„è¯­è¨€åŠ è½½åˆ°æˆ‘ä»¬çš„æ†ç»‘è½¯ä»¶ä¸­ã€‚ å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦é€šè¿‡httpæ·»åŠ ä»»ä½•åŠ è½½å™¨ï¼Œä½†æ˜¯ï¼Œå¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¯æ¬¡æˆ‘ä»¬ä½¿ç”¨æœ¬åœ°åŒ–æ›´æ”¹æ–‡ä»¶æ—¶ï¼Œéƒ½å°†éœ€è¦é‡æ–°æ„å»ºåº”ç”¨ç¨‹åºï¼Œè€Œä¸”ï¼Œè¿™ä¼šå¤§å¤§å¢åŠ .jsåŒ…çš„å¤§å°ã€‚ </p><br><pre> <code class="hljs pgsql">// webpack-translate-loader.ts <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TranslateLoader } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@ngx-translate/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/Observable'</span></span>; export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> WebpackTranslateLoader implements TranslateLoader { getTranslation(lang: string): Observable&lt;<span class="hljs-keyword"><span class="hljs-keyword">any</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.fromPromise(<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(`../assets/i18n/${lang}.json`)); } }</code> </pre> <br><p> å¦‚æœIDEåœ¨<code>System</code>å‘èª“<code>System</code>éœ€è¦å°†å…¶æ·»åŠ åˆ°types.d.tsä¸­ï¼š </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; interface <span class="hljs-keyword"><span class="hljs-keyword">System</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(request: string): Promise&lt;<span class="hljs-keyword"><span class="hljs-keyword">any</span></span>&gt;; }</code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨app.moduleä¸­ä½¿ç”¨WebpackTranslateLoaderï¼š </p><br><pre> <code class="hljs powershell">@NgModule({ bootstrap: [<span class="hljs-type"><span class="hljs-type">AppComponent</span></span>], imports: [ <span class="hljs-type"><span class="hljs-type">TranslateModule.forRoot</span></span>({ <span class="hljs-type"><span class="hljs-type">loader</span></span>: { <span class="hljs-type"><span class="hljs-type">provide</span></span>: <span class="hljs-type"><span class="hljs-type">TranslateLoader</span></span>, <span class="hljs-type"><span class="hljs-type">useClass</span></span>: <span class="hljs-type"><span class="hljs-type">WebpackTranslateLoader</span></span> } }) ] }) export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppModule</span></span></span></span> { }</code> </pre> <cut></cut><br><h4 id="apptranslateloader">  AppTranslateLoader </h4><br><p> å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹ç¼–å†™<code>AppTranslateLoader</code> ã€‚ é¦–å…ˆï¼Œæˆ‘æƒ³ç¡®å®šä½¿ç”¨æ ‡å‡†<code>TranslateHttpLoader</code>å¿…é¡»é‡åˆ°çš„å‡ ä¸ªé—®é¢˜ï¼š </p><br><ul><li><p>  <strong>ç¿»è¯‘é—ªçƒã€‚</strong>  <code>TranslateHttpLoader</code>ä¸çŸ¥é“å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºåˆå§‹åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”å½“åˆå§‹åŒ–åæˆ‘ä»¬å‘ç°æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­æ‹¥æœ‰æ­£ç¡®æ ‡ç­¾çš„ä½ç½®æ—¶-æŒ‰é”®ï¼ˆMY_BUTTON_KEYæ˜¯æˆ‘çš„æŒ‰é’®çš„ä½ç½®ï¼‰ï¼Œç¨åä¼šå˜ä¸ºæ­£ç¡®çš„æ–‡æœ¬ã€‚ </p><br></li><li><p>  <strong>æ—¥æœŸ</strong> æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥åˆ‡æ¢æ—¥æœŸæœ¬åœ°åŒ–çš„æœåŠ¡ä¼šå¾ˆå¥½ã€‚ åœ¨æœ¬åœ°åŒ–æ–‡æœ¬æ—¶ï¼Œæœ€æœ‰å¯èƒ½éœ€è¦ç…§é¡¾æœ¬åœ°åŒ–æ—¥æœŸï¼Œæ—¶é—´ç­‰ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨momentJsæˆ–Angularå†…ç½®çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">i18n</a>è§£å†³æ–¹æ¡ˆã€‚ ä¸¤ç§è§£å†³æ–¹æ¡ˆéƒ½ä¸é”™ï¼Œå¹¶ä¸”å…·æœ‰ç”¨äºè§†å›¾æ ¼å¼çš„Angular 2+ç®¡é“ã€‚ </p><br></li><li>  <strong>æ­£åœ¨ç¼“å­˜ã€‚</strong> ä½¿ç”¨<code>TranslateHttpLoader</code> ï¼Œæ‚¨å¿…é¡»é…ç½®FEæœåŠ¡å™¨ä»¥æ­£ç¡®åœ°ç¼“å­˜jsonåŒ…ã€‚ å¦åˆ™ï¼Œç”¨æˆ·å°†çœ‹åˆ°æ—§ç‰ˆæœ¬çš„æœ¬åœ°åŒ–ï¼Œæ›´ç³Ÿçš„æ˜¯ï¼Œä»–ä»¬å°†çœ‹åˆ°æœ¬åœ°åŒ–å¯†é’¥ï¼ˆå¦‚æœç”¨æˆ·ç¼“å­˜åæ·»åŠ äº†æ–°çš„æœ¬åœ°åŒ–å¯†é’¥ï¼‰ã€‚ æˆ‘ä¸æƒ³åœ¨æ¯æ¬¡è®¾ç½®æ–°æœåŠ¡å™¨æ—¶éƒ½åœ¨è®¾ç½®ç¼“å­˜çš„æ—¶å€™æ‰“æ‰°ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿Webpackåƒå¤„ç†.jsæ†ç»‘åŒ…ä¸€æ ·ä¸ºæˆ‘ä»¬åšæ‰€æœ‰äº‹æƒ…ã€‚ </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AppTranslateLoaderè‰æ¡ˆ</a> </p><cut></cut><br><h5 id="resheniya-problem"> è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼š </h5><br><h6 id="1-problema-translate-flickering---ispolzovat-apptranslateloaderv-ramkah-app_initializer">  1.ç¿»è¯‘é—ªçƒé—®é¢˜-å°†<code>AppTranslateLoader</code>ç”¨ä½œ<code>AppTranslateLoader</code>ä¸€éƒ¨åˆ† </h6><br><p>  APP_INITIALIZERè¿˜ç§¯æå‚ä¸äº†æœ‰å…³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ·æ–°ä»¤ç‰Œ</a>çš„æ–‡ç« ï¼Œå³ä½¿å¯¹åˆå§‹åŒ–å™¨æ²¡æœ‰å“å‘³ï¼Œæˆ‘ä»ç„¶å»ºè®®æ‚¨é˜…è¯»è¯¥æ–‡ç« ï¼Œå°½ç®¡å®ƒä¸åˆ·æ–°ä»¤ç‰Œæœ‰å…³ã€‚ å®é™…ä¸Šï¼Œå¯¹äºæ‹¥æœ‰åˆå§‹åŒ–å™¨çš„äººæ¥è¯´ï¼Œä½¿ç”¨åˆå§‹åŒ–å™¨çš„å†³å®šéå¸¸æ˜æ˜¾ï¼Œä½†æˆ‘ä»ç„¶å¸Œæœ›æœ‰äººèƒ½æ´¾ä¸Šç”¨åœºï¼š </p><br><pre> <code class="hljs powershell">//app.module.ts export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translationLoader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(loader: AppTranslateLoader)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> () =&gt; loader.loadTranslation(); } @NgModule({ bootstrap: [<span class="hljs-type"><span class="hljs-type">AppComponent</span></span>], providers: [ { <span class="hljs-type"><span class="hljs-type">provide</span></span>: <span class="hljs-type"><span class="hljs-type">APP_INITIALIZER</span></span>, <span class="hljs-type"><span class="hljs-type">useFactory</span></span>: <span class="hljs-type"><span class="hljs-type">translationLoader</span></span>, <span class="hljs-type"><span class="hljs-type">deps</span></span>: [<span class="hljs-type"><span class="hljs-type">AppTranslateLoader</span></span>], <span class="hljs-type"><span class="hljs-type">multi</span></span>: <span class="hljs-type"><span class="hljs-type">true</span></span> } ] }) export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppModule</span></span></span></span> { }</code> </pre> <br><h6 id="2-problema-dat-prosto-budem-pereklyuchat-yazyk-v-momentjs-vmeste-c-ngx-tranlate">  2.æ—¥æœŸé—®é¢˜ã€‚ æˆ‘ä»¬åªéœ€è¦åœ¨ç¬é—´ä¸ngx-tranlateä¸€èµ·åˆ‡æ¢è¯­è¨€å³å¯ã€‚ </h6><br><p> è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•-åŠ è½½å…·æœ‰æœ¬åœ°åŒ–çš„jsonåï¼Œæˆ‘ä»¬åªéœ€å°†æœ¬åœ°åŒ–åˆ‡æ¢ä¸ºmomentJsï¼ˆæˆ–i18nï¼‰å³å¯ã€‚ </p><br><p> è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒmomentJså¯ä»¥åƒi18nä¸€æ ·åˆ†åˆ«å¯¼å…¥æœ¬åœ°åŒ–ï¼ŒmomentJsä¹Ÿå¯ä»¥å¯¼å…¥æ†ç»‘åŒ…ï¼Œä½†æ˜¯æ•´ä¸ªæ†ç»‘åŒ…å¤§çº¦éœ€è¦260KBï¼Œæ‚¨åªéœ€è¦å…¶ä¸­ä¸¤ä¸ªå³å¯ã€‚ </p><br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åªèƒ½ç›´æ¥åœ¨å£°æ˜<code>AppTranslateLoader</code>çš„æ–‡ä»¶ä¸­å¯¼å…¥å…¶ä¸­çš„2ä¸ªã€‚ </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'moment/locale/en-gb'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'moment/locale/ru'</span></span>;</code> </pre> <br><p> ç°åœ¨ï¼Œen-gbå’Œruæœ¬åœ°åŒ–å°†åœ¨jsåº”ç”¨ç¨‹åºåŒ…ä¸­ã€‚ åœ¨<code>AppTranslateLoader</code>æ‚¨å¯ä»¥æ·»åŠ æ–°åŠ è½½çš„è¯­è¨€å¤„ç†ç¨‹åºï¼š </p><br><pre> <code class="hljs coffeescript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> Class AppTranslateLoader { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> .... private onLangLoaded(newLang: string) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang !== newLang) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.translate.resetLang(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang = newLang; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.selectedLang = newLang; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> TODO:       <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     ,       <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  en  ru,  momentJs   en. moment().locale(newLang); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  .  momentJs localStorage.setItem(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.storageKey, newLang); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ls <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadSubj.complete(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   -      . }</code> </pre> <br><p>  !!! æ­¤å¤„ç†ç¨‹åºæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šå¦‚æœåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­åªä¸ºngx-translateæä¾›äº†enæœ¬åœ°åŒ–ï¼Œä½†æ˜¯ä¾‹å¦‚åœ¨ç¬é—´æˆ–éœ€è¦ä½¿ç”¨enæˆ–en-gbæ—¶ï¼Œåˆ™å¿…é¡»æ‰©å±•å¤„ç†ç¨‹åºçš„é€»è¾‘ï¼Œæˆ–è€…è¿˜åº”åœ¨å†…éƒ¨æä¾›en-gbçš„en-localization ngx-translateã€‚ </p><br><p>  !!!  // TODOï¼šç›®å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªwebpackæ’ä»¶ï¼Œç¨åæˆ‘ä»¬å°†è€ƒè™‘å‡ ä¸ªæ’ä»¶ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰ã€‚ </p><br><p> æ‚¨é—®ï¼Œä¸ºä»€ä¹ˆä¸å¯èƒ½åœ¨æ¥å£ä¸­åŠ è½½æ—¥æœŸå’Œæ—¶é—´çš„æœ¬åœ°åŒ–ä»¥åŠæ–‡æœ¬çš„æœ¬åœ°åŒ–ï¼ˆé€šè¿‡HTTPåŠ¨æ€ï¼‰ï¼Ÿ è¿™æ˜¯å› ä¸ºæ—¥æœŸæœ¬åœ°åŒ–åŒ…å«å…¶è‡ªèº«çš„é€»è¾‘ï¼Œå› æ­¤ä»¥<a href="">javascript</a>ä»£ç å½¢å¼æ˜¾ç¤ºã€‚ </p><br><p> ä½†æ˜¯å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æ˜¯æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥é€šè¿‡ç¼–å†™ä¸€äº›â€œè„â€ä»£ç æ¥åŠ è½½è¿™æ ·çš„æœ¬åœ°åŒ–ã€‚ æˆ‘æ²¡æœ‰åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨æ­¤ä»£ç ï¼Œä½†æ˜¯æ†ç»‘åŒ…å†…çš„ç¬¬äºŒä¸ªæœ¬åœ°åŒ–ç‰ˆæœ¬å¹¶ä¸å›°æ‰°æˆ‘ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æœ‰è®¸å¤šæœ¬åœ°åŒ–ï¼Œåˆ™è¦åŠ¨æ€åœ°è€Œä¸æ˜¯éå¸¸å®‰å…¨åœ°åŠ è½½å®ƒä»¬ï¼Œè¯·è®°ä½ï¼š </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadAngularCulture</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">locale</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> angularLocaleText = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.httpClient.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(`assets/angular-locales/${locale}.js`).toPromise(); <span class="hljs-comment"><span class="hljs-comment">// extracting the part of the js code before the data, // and i didn't need the plural so i just replace plural by null. const startPos = angularLocaleText.indexOf('export default '); angularLocaleText = 'return ' + angularLocaleText.substring(startPos + 15).replace('plural', null); // The trick is here : to read cldr data, i use a function const f = new Function(angularLocaleText); const angularLocale = f(); // console.log(angularLocale); // And now, just registrer the object you just created with the function registerLocaleData(angularLocale); }</span></span></code> </pre> <br><p> ä¸Šæ¬¡æˆ‘åœ¨Angular 4ä¸­æµ‹è¯•äº†æ­¤æ–¹æ³•ã€‚å¾ˆå¯èƒ½å®ƒç°åœ¨æ­£åœ¨å·¥ä½œã€‚ </p><br><p> ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§è‚®è„çš„ç”Ÿæ´»æŠ€å·§åœ¨c momentJsï¼ˆä»…Angularæœ¬åœ°åŒ–ï¼‰çš„æƒ…å†µä¸‹ä¸èµ·ä½œç”¨ã€‚ è‡³å°‘æˆ‘æ‰¾ä¸åˆ°è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœæ‚¨æ˜¯ä¸€ä¸ªéå¸¸èƒ¡å­çš„é»‘å®¢ç¨‹åºå‘˜ï¼Œæˆ‘å°†å¾ˆé«˜å…´çœ‹åˆ°æ³¨é‡Šä¸­çš„è§£å†³æ–¹æ¡ˆã€‚ </p><br><h6 id="3-keshirovanie-podobno-sborke-js-bandla-mozhno-dobavit-k-imeni-json-bandla-hesh">  3.ç¼“å­˜ã€‚ ä¸æ„å»º.jsæ†ç»‘åŒ…ç±»ä¼¼ï¼Œæ‚¨å¯ä»¥åœ¨.jsonæ†ç»‘åŒ…åç§°ä¸­æ·»åŠ å“ˆå¸Œå€¼ã€‚ </h6><br><p> è¿™å®Œå…¨å–å†³äºæ‚¨å¦‚ä½•å°†æ‰€æœ‰jsonå‡†ç¡®åœ°æ”¶é›†åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¹Ÿè®¸æ‚¨åªæ˜¯å°†æ‰€æœ‰å†…å®¹éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ åœ¨Internetä¸Šï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°è®¸å¤šå¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ”¶é›†å°å‹jsonçš„npmæ¨¡å—ã€‚ æˆ‘æ²¡æœ‰æ‰¾åˆ°å¯ä»¥é™„åŠ åˆ°å“ˆå¸Œè¡¨å¹¶å°†æ‰€æœ‰å†…å®¹æ”¶é›†åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­çš„æ–‡ä»¶ã€‚  Webpackæœ¬èº«ä¹Ÿæ— æ³•æŒ‰ç…§ngx-translateè§„èŒƒçš„è¦æ±‚å¤„ç†jsonã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†ç¼–å†™æˆ‘ä»¬çš„webpackæ’ä»¶ã€‚ </p><br><p> ç®€è€Œè¨€ä¹‹ï¼šæˆ‘ä»¬éœ€è¦æ ¹æ®ç‰¹å®šæ¨¡å¼æ”¶é›†é¡¹ç›®ä¸­çš„æ‰€æœ‰jsonï¼Œè€Œæˆ‘ä»¬éœ€è¦æŒ‰åç§°ï¼ˆenï¼Œruï¼Œdeç­‰ï¼‰å°†å®ƒä»¬åˆ†ç»„ï¼Œå› ä¸ºä¾‹å¦‚en.jsonå¯ä»¥ä½äºä¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚ ç„¶åï¼Œå¯¹äºæ¯ä¸ªæ”¶é›†çš„æ–‡ä»¶ï¼Œæ‚¨éƒ½éœ€è¦é™„åŠ ä¸€ä¸ªå“ˆå¸Œã€‚ </p><br><p> è¿™é‡Œæœ‰é—®é¢˜ã€‚ å¦‚æœæ¯ä¸ªæœ¬åœ°åŒ–éƒ½æœ‰è‡ªå·±çš„åç§°ï¼Œ <code>AppTranslateLoader</code>å¦‚ä½•è¯†åˆ«æ–‡ä»¶åï¼Ÿ ä¾‹å¦‚ï¼Œå°†æ†ç»‘è½¯ä»¶åŒ…å«åœ¨index.htmlä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒ…æ‹¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HtmlWebpackPluginï¼Œ</a>å¹¶è¦æ±‚å®ƒæ·»åŠ ä¸€ä¸ªå¸¦æœ‰æ†ç»‘è½¯ä»¶åç§°çš„è„šæœ¬æ ‡ç­¾ã€‚ </p><br><p> ä¸ºäº†è§£å†³.jsonæœ¬åœ°åŒ–çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„webpackæ’ä»¶å°†åˆ›å»ºconfig.jsonï¼Œå…¶ä¸­å°†åŒ…å«è¯­è¨€ä»£ç ä¸å“ˆå¸Œæ–‡ä»¶åçš„å…³è”ï¼š </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"en"</span></span>: <span class="hljs-string"><span class="hljs-string">"en.some_hash.json"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ru"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru.some_hash.json"</span></span> }</code> </pre> <br><p>  config.jsonä¹Ÿå°†ç”±æµè§ˆå™¨ç¼“å­˜ï¼Œä½†æ˜¯ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨GETæ‰©å±•æ­¤æ–‡ä»¶æ—¶ç®€å•åœ°æŒ‡å®šä¸€ä¸ªéšæœºçš„queryStringå‚æ•°ï¼ˆä»è€Œä¸æ–­é‡æ–°åŠ è½½å®ƒï¼‰ã€‚ æˆ–ä¸ºconfig.jsonåˆ†é…ä¸€ä¸ªéšæœºIDï¼ˆæˆ‘å°†æè¿°æ­¤æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªæ–¹æ³•å¯ä»¥åœ¨Googleä¸­æ‰¾åˆ°ï¼‰ã€‚ </p><br><p> æˆ‘è¿˜æƒ³ç®€åŒ–æœ¬åœ°åŒ–çš„åŸºç¡€æ¶æ„å’ŒåŸå­æ€§ã€‚ å…·æœ‰æœ¬åœ°åŒ–åŠŸèƒ½çš„jsonå°†ä½äºåŒ…å«å…¶ç»„ä»¶çš„æ–‡ä»¶å¤¹ä¸­ã€‚ å¹¶ä¸”ä¸ºäº†é¿å…é‡å¤çš„å¯†é’¥ï¼Œå°†åŸºäºç‰¹å®šjsonæ–‡ä»¶çš„è·¯å¾„æ„å»ºjsonåŒ…çš„ç»“æ„ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªen.jsonï¼Œä¸€ä¸ªä½äºè·¯å¾„<code>src/app/article-component</code> ï¼Œå¦ä¸€ä¸ªä½äº<code>src/app/comment-component</code> ã€‚ æˆ‘æƒ³åœ¨è¾“å‡ºä¸­è·å–ä»¥ä¸‹jsonï¼š </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"article-component"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"TITLE"</span></span>: <span class="hljs-string"><span class="hljs-string">"Article title"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"comment-component"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"TITLE"</span></span>: <span class="hljs-string"><span class="hljs-string">"Comment title"</span></span> } }</code> </pre> <br><p> æˆ‘ä»¬å¯ä»¥ä¸¢å¼ƒä¸éœ€è¦çš„è·¯å¾„éƒ¨åˆ†ï¼Œä»¥ä½¿é”®åœ¨è§†å›¾ä¸­å°½å¯èƒ½çŸ­ã€‚ </p><br><p>  !!! æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šå½“æ‚¨å°†ç»„ä»¶æ”¾ç½®åœ¨å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­æ—¶ï¼Œæœ¬åœ°åŒ–å¯†é’¥å°†ä¼šæ›´æ”¹ã€‚ </p><br><p> ç¨åï¼Œæˆ‘ä»¬å°†è€ƒè™‘å¦ä¸€ä¸ªç”Ÿæ´»æŠ€å·§ï¼Œæ— è®ºæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­çš„ä½ç½®å’Œæ·±åº¦å¦‚ä½•ï¼Œéƒ½å¯ä»¥åœ¨ç»„ä»¶ä¸­ä»…æŒ‡ç¤ºæœ€åä¸€ä¸ªå…³é”®å­—æ®µï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¼ è¾“å¹¶æ ¹æ®éœ€è¦è¿›è¡Œé‡å‘½åã€‚ </p><br><p> åŸºæœ¬ä¸Šï¼Œæˆ‘æƒ³å®ç°å°è£…ï¼Œç”šè‡³å®ç°ngx-translateæœ¬åœ°åŒ–çš„å¤šæ€æ€§æç¤ºã€‚ æˆ‘å–œæ¬¢ç”¨Angular- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Angular View Encapsulation</a>æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Shadow DOM</a>å°è£…è§†å›¾çš„æ¦‚å¿µã€‚ æ˜¯çš„ï¼Œè¿™å¢åŠ äº†æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å¤§å°ï¼Œä½†æ˜¯æˆ‘å…ˆè¦è¯´ï¼Œåœ¨ngx-translateè¢«æ›´åŠ å°è£…ä¹‹åï¼Œä½¿ç”¨æœ¬åœ°åŒ–æ–‡ä»¶å˜å¾—æ›´åŠ æ„‰å¿«ã€‚ ç»„ä»¶å¼€å§‹åªå…³å¿ƒå®ƒä»¬çš„æœ¬åœ°åŒ–ï¼Œæ­¤å¤–ï¼Œæœ‰å¯èƒ½æ ¹æ®çˆ¶ç»„ä»¶ä¸­çš„æœ¬åœ°åŒ–é‡æ–°å®šä¹‰å­ç»„ä»¶ä¸­çš„æœ¬åœ°åŒ–ã€‚ å¦å¤–ï¼Œç°åœ¨æ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¹‹é—´è½¬ç§»ç»„ä»¶ï¼Œå¹¶ä¸”å®ƒä»¬å·²ç»æœ¬åœ°åŒ–ã€‚ ä½†æ˜¯ä¸å…¶ä»–åœ°æ–¹ä¸€æ ·ï¼Œåœ¨ä»¥åä¼šæœ‰æ›´å¤šç»†å¾®å·®åˆ«ã€‚ </p><br><p> å› æ­¤ï¼Œè®©æˆ‘ä»¬ç»§ç»­æˆ‘ä»¬çš„æ’ä»¶ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•</a> ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆå¹¶æœ¬åœ°åŒ–æ’ä»¶</a> ã€‚ <br> åŠ è½½ç¨‹åºå’Œæ’ä»¶çš„æºä»£ç å¯ä»¥åœ¨æ–‡ç« åº•éƒ¨çš„ç¤ºä¾‹é“¾æ¥ï¼ˆæ–‡ä»¶å¤¹./build-utilsï¼‰ä¸­æ‰¾åˆ°ã€‚ </p><br><p> è¯¥æ’ä»¶å®Œæˆä¸Šè¿°æ‰€æœ‰æ“ä½œï¼Œå¹¶æ¥å—ä»¥ä¸‹é€‰é¡¹ï¼š </p><br><ul><li> çœç•¥ã€‚ æœ¬åœ°åŒ–è·¯å¾„ä¸­çš„åç§°éœ€è¦å¿½ç•¥ï¼ˆè¿™æ­£æ˜¯æˆ‘è¦åˆ é™¤æ–‡ä»¶è·¯å¾„å¤šä½™éƒ¨åˆ†çš„é‚£ä¸€åˆ»ï¼‰ </li><li>  fileInputã€‚ å®šæœŸè·å–äº§å“ä¸­çš„æœ¬åœ°åŒ–æ–‡ä»¶ï¼ˆä¾‹å¦‚Webpackä¸­çš„æµ‹è¯•ï¼‰ </li><li>  rootDirã€‚ ä»å“ªé‡Œå¼€å§‹é€šè¿‡fileInputæ¨¡å¼æŸ¥æ‰¾æ–‡ä»¶ </li><li>  outputDirã€‚ é…ç½®æ–‡ä»¶å’Œæœ¬åœ°åŒ–å°†åœ¨distæ–‡ä»¶å¤¹ä¸­åˆ›å»ºçš„ä½ç½® </li><li>  configNameã€‚ å°†ä»¥ä»€ä¹ˆåç§°åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚ </li></ul><br><p> åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œæ’ä»¶é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿æ¥ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// build-utils.js // part of METADATA { // ... translationsOutputDir: 'langs/', translationsFolder: '@translations', translationsConfig: `config.${Math.random().toString(36).substr(2, 9)}.json`, } //webpack.common.js new MergeLocalizationPlugin({ fileInput: [`**/${METADATA.translationsFolder}/*.json`, 'app-translations/**/*.json'], rootDir: 'src', omit: new RegExp(`app-translations|${METADATA.translationsFolder}|^app`, 'g'), outputDir: METADATA.translationsOutputDir, configName: METADATA.translationsConfig }),</span></span></code> </pre> <br><p> åœ¨éœ€è¦æœ¬åœ°åŒ–çš„ç»„ä»¶å†…éƒ¨ï¼Œæœ‰ä¸€ä¸ª<code>@translations</code>æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«en.jsonï¼Œruç­‰ã€‚ </p><br><p> ç»“æœï¼Œç¿»è½¬æ—¶ï¼Œè€ƒè™‘åˆ°<code>@translations</code>æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œæ‰€æœ‰å†…å®¹éƒ½å°†æ”¶é›†åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ æœ¬åœ°åŒ–åŒ…å°†ä½äºdist / langs /ä¸­ï¼Œå¹¶ä¸”é…ç½®å°†è¢«å‘½åä¸ºconfigã€‚$ {Some-random} .jsonã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç¡®ä¿æ‰€éœ€çš„æœ¬åœ°åŒ–è½¯ä»¶åŒ…å·²åŠ è½½åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ è¿™æ˜¯ä¸€ä¸ªè„†å¼±çš„æ—¶åˆ»-åªæœ‰webpackçŸ¥é“æœ¬åœ°åŒ–çš„è·¯å¾„å’Œé…ç½®æ–‡ä»¶çš„åç§°ï¼Œè®©æˆ‘ä»¬è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œä»¥ä¾¿æœ€æ–°æ•°æ®è¿›å…¥AppTranslateLoaderï¼Œå¹¶ä¸”æ— éœ€åœ¨ä¸¤ä¸ªä½ç½®æ›´æ”¹åç§°ã€‚ </p><br><pre> <code class="hljs powershell">// some inmports // ... // momentJs import * as moment from <span class="hljs-string"><span class="hljs-string">'moment'</span></span>; import <span class="hljs-string"><span class="hljs-string">'moment/locale/en-gb'</span></span>; import <span class="hljs-string"><span class="hljs-string">'moment/locale/ru'</span></span>; @Injectable() export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppTranslateLoader</span></span></span></span> { //            public additionalStorageKey: string = <span class="hljs-string"><span class="hljs-string">''</span></span>; private translationsDir: string; private translationsConfig: string; private selectedLang: string; private fallbackLang: string; private loadedLang: string; private config: { [<span class="hljs-type"><span class="hljs-type">key</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>]: string; } = null; private loadSubs = new Subscription(); private configSubs = new Subscription(); private loadSubj = new Subject(); private get storageKey(): string { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.additionalStorageKey ? `APP_LANG_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{this.additionalStorageKey}` : <span class="hljs-string"><span class="hljs-string">'APP_LANG'</span></span>; } constructor(private http: HttpClient, private translate: TranslateService) { //   webpack       //     . this.translationsDir = `${process.env.TRANSLATE_OUTPUT}`; this.translationsConfig = `${process.env.TRANSLATE_CONFIG}`; this.fallbackLang = <span class="hljs-string"><span class="hljs-string">'en'</span></span>; const storedLang = this.getUsedLanguage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (storedLang) { this.selectedLang = storedLang; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { this.selectedLang = translate.getBrowserLang() || this.fallbackLang; } } }</code> </pre> <br><p>  <code>process.env.TRANSLATE_OUTPUT</code>ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦åœ¨webpackä¸­å£°æ˜å¦ä¸€ä¸ªæ’ä»¶ï¼ˆDefinePluginæˆ–EnvironmentPluginï¼‰ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// METADATA declaration const METADATA = { translationsOutputDir: 'langs/', translationsFolder: '@translations', translationsConfig: `config. ${Math.random().toString(36).substr(2, 9)}.json`, }; // complex webpack config... // webpack plugins... new DefinePlugin({ 'process.env.TRANSLATE_OUTPUT': JSON.stringify(METADATA.translationsOutputDir), 'process.env.TRANSLATE_CONFIG': JSON.stringify(METADATA.translationsConfig), }),</span></span></code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬åªèƒ½åœ¨ä¸€ä¸ªåœ°æ–¹æ›´æ”¹æœ¬åœ°åŒ–è·¯å¾„å’Œé…ç½®åç§°ã€‚ <br> é»˜è®¤æƒ…å†µä¸‹ï¼Œä»Webpackç¨‹åºé›†ï¼ˆngjectï¼‰ä¸­ç”Ÿæˆçš„é»˜è®¤Angularé”€å”®ä¸­ï¼Œæ‚¨æ— æ³•ä»ä»£ç ä¸­æŒ‡å®š<code>process.env.someValue</code> ï¼ˆå³ä½¿æ‚¨ä½¿ç”¨DefinePluginï¼‰ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šå‘èª“ã€‚ ä¸ºäº†ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦æ»¡è¶³2aæ¡æ¡ä»¶ï¼š </p><br><ul><li> åœ¨main.tsä¸­æ·»åŠ ç¬¬ä¸€è¡Œ<code>/// &lt;reference types="node"/&gt;</code> </li><li>  package.jsonå¿…é¡»å…·æœ‰<code>@types/node</code> <code>npm install --save-dev @types/node</code> ã€‚ </li></ul><br><p> æˆ‘ä»¬ç›´æ¥è¿›è¡Œå¼•å¯¼è¿‡ç¨‹ã€‚ <br> å¦‚æœæ‰“ç®—ä½¿ç”¨APP_INITIALIZERï¼Œè¯·ç¡®ä¿è¿”å›Promiseï¼Œè€Œä¸æ˜¯Observableã€‚ æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢é“¾ï¼š </p><br><ul><li> é¦–å…ˆï¼Œæ‚¨éœ€è¦ä¸‹è½½config.jsonï¼ˆä»…åœ¨æœªåŠ è½½çš„æƒ…å†µä¸‹ï¼‰ã€‚ </li><li> å°è¯•åŠ è½½è¯­è¨€ï¼Œè¿™æ˜¯ç”¨æˆ·æµè§ˆå™¨çš„è¯­è¨€ </li><li> æä¾›å…·æœ‰é»˜è®¤ä¸‹è½½è¯­è¨€çš„åå¤‡é€»è¾‘ã€‚ </li></ul><br><pre> <code class="hljs coffeescript"><span class="hljs-regexp"><span class="hljs-regexp">//</span></span> imports @Injectable() AppTranslateLoader { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> fields ... <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ,         <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      ,   <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Subscription    unsubscribe    <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   private loadSubs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Subscription(); private configSubs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Subscription(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       -   <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Subject       private loadSubj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Subject(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> constructor ... <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  Promise! public loadTranslation(lang: string = <span class="hljs-string"><span class="hljs-string">''</span></span>): Promise&lt;any&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!lang) { lang = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.selectedLang; } <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lang === <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.configSubs.unsubscribe(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.configSubs = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http.get&lt;Response&gt;(`<span class="javascript"><span class="javascript">${</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.translationsDir}${</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.translationsConfig}</span></span>`) .subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config: any)</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config = config; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadAndUseLang(lang); }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadAndUseLang(lang); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadSubj.asObservable().toPromise(); } private loadAndUseLang(lang: string) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadSubs.unsubscribe(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadSubs = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http.get&lt;Response&gt;(`<span class="javascript"><span class="javascript">${</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.translationsDir}${</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.config[lang] || </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.config[</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.fallbackLang]}</span></span>`) .subscribe(res =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.translate.setTranslation(lang, res); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.translate.use(lang).subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onLangLoaded(lang); }, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> fallback  ngx-translate   (err) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onLoadLangError(lang, err)); }, <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> fallback  http   (err) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onLoadLangError(lang, err)); } private onLangLoaded(newLang: string) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang !== newLang) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.translate.resetLang(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang = newLang; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.selectedLang = newLang; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> TODO:       <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     ,       <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  en  ru,  momentJs   en. moment().locale(newLang); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  .  momentJs localStorage.setItem(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.storageKey, newLang); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ls <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadSubj.complete(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   -      . } private onLoadLangError(langKey: string, error: any) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ,      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.translate.use(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang) .subscribe( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onLangLoaded(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadedLang), <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err)</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadSubj.error(err)); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (langKey !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fallbackLang) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      fallback  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadAndUseLang(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fallbackLang); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadSubj.error(error); } }</code> </pre> <br><p> åšå®Œäº† </p><br><p> ç°åœ¨å›åˆ°å°†ç»„ä»¶ç§»åŠ¨åˆ°å…¶ä»–æ–‡ä»¶å¤¹çš„é—®é¢˜ï¼Œå°è£…å’Œå¤šæ€æ€§çš„ç›¸ä¼¼æ€§ã€‚ </p><br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†æŸç§å°è£…ã€‚ æœ¬åœ°åŒ–è¢«æ¨é€åˆ°ç»„ä»¶æ—è¾¹çš„æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰€æœ‰é”®è·¯å¾„éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥å°†some-component1ç»„ä»¶çš„é”®æœ¬åœ°åŒ–åœ¨some-component2å†…ï¼Œå¹¶ä¸”å¾ˆéš¾è·Ÿè¸ªæ‰€æœ‰å†…å®¹ï¼Œç¨åæˆ‘ä»¬å°†å¼„æ¸…æ¥šã€‚ </p><br><pre> <code class="hljs powershell">&lt;some<span class="hljs-literal"><span class="hljs-literal">-component1</span></span> [<span class="hljs-type"><span class="hljs-type">someLabel</span></span>]=<span class="hljs-string"><span class="hljs-string">"'components.some-component2.some_key' | tanslate"</span></span>&gt;&lt;/some<span class="hljs-literal"><span class="hljs-literal">-component1</span></span>&gt; // components.some<span class="hljs-literal"><span class="hljs-literal">-component2</span></span> -    </code> </pre> <br><p> å…³äºç»„ä»¶çš„ç§»åŠ¨ï¼š <br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨è§†å›¾ä¸­ä½¿ç”¨çš„é”®å·²ç‰¢å›ºåœ°ç»‘å®šåˆ°æœ¬åœ°åŒ–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œå¹¶å–å†³äºé¡¹ç›®çš„ç‰¹å®šåŸºç¡€ç»“æ„ã€‚ </p><br><p> å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘å°†ç»™å‡ºä¸€ä¸ªä»¤äººé—æ†¾çš„æ¡ˆä¾‹ï¼š </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"+lazy-module.components.article-component.article_title"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘å°†ç»„ä»¶æ–‡ä»¶å¤¹çš„åç§°æ›´æ”¹ä¸ºpost-componentæ€ä¹ˆåŠï¼Ÿ <br> åœ¨æ‰€æœ‰å¿…è¦çš„ä½ç½®éƒ½å¾ˆéš¾è¾“å…¥æ­¤å¯†é’¥ã€‚ å½“ç„¶ï¼Œæ²¡æœ‰äººå–æ¶ˆå¤åˆ¶ç²˜è´´å’ŒæŸ¥æ‰¾æ›¿æ¢ï¼Œä½†æ˜¯åœ¨æ²¡æœ‰IDEæç¤ºçš„æƒ…å†µä¸‹ç¼–å†™å®ƒä¹Ÿå¾ˆéº»çƒ¦ã€‚ </p><br><p> ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œè®©æˆ‘ä»¬æ³¨æ„webpackæ­£åœ¨åšä»€ä¹ˆå‘¢ï¼Ÿ  Webpackå…·æœ‰è¯¸å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">loaderä¹‹</a>ç±»çš„ä¸œè¥¿ï¼Œæœ‰è®¸å¤šå¯ç”¨äºæ–‡ä»¶è·¯å¾„çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŠ è½½å™¨</a> ï¼šä¾‹å¦‚ï¼Œcssä¸­çš„èµ„æºè·¯å¾„-å€ŸåŠ©webpackï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šç›¸å¯¹çš„èƒŒæ™¯å›¾åƒè·¯å¾„ï¼šurlï¼ˆ../ relative.pngï¼‰ï¼Œç­‰ç­‰é¡¹ç›®ä¸­å…¶ä½™æ–‡ä»¶è·¯å¾„æ— å¤„ä¸åœ¨ï¼ </p><br><p> è¿›è¡Œwebpackæ„å»ºçš„äººéƒ½çŸ¥é“ï¼ŒåŠ è½½ç¨‹åºä¼šåœ¨è¾“å…¥ä¸­æ¥æ”¶åˆ°ä¸ç‰¹å®šæ¨¡å¼åŒ¹é…çš„æ–‡ä»¶ã€‚ åŠ è½½ç¨‹åºæœ¬èº«çš„ä»»åŠ¡æ˜¯ä»¥æŸç§æ–¹å¼è½¬æ¢æ­¤è¾“å…¥æ–‡ä»¶å¹¶è¿”å›å®ƒï¼Œä»¥ä¾›å…¶ä»–åŠ è½½ç¨‹åºè¿›è¡Œè¿›ä¸€æ­¥æ›´æ”¹ã€‚ </p><br><p> å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™æˆ‘ä»¬çš„åŠ è½½å™¨ã€‚ é—®é¢˜æ˜¯æˆ‘ä»¬å°†æ›´æ”¹å“ªç§æ–‡ä»¶ï¼šè§†å›¾æˆ–ç»„ä»¶ï¼Ÿ ä¸€æ–¹é¢ï¼Œè§†å›¾å¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ†åˆ«åœ¨ç»„ä»¶ä¸­ã€‚ è§†å›¾å¯èƒ½è¶³å¤Ÿå¤§ä¸”éš¾ä»¥è§£æï¼Œè¯·æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè§†å›¾ï¼Œå…¶ä¸­åŒ…å«100ä¸ªç¿»è¯‘æŒ‡ä»¤ï¼ˆä¸åœ¨å¾ªç¯ä¸­ï¼‰ï¼š </p><br><pre> <code class="hljs axapta">&lt;<span class="hljs-keyword"><span class="hljs-keyword">div</span></span> id=<span class="hljs-string"><span class="hljs-string">"1"</span></span>&gt;{{<span class="hljs-string"><span class="hljs-string">'./some_key_1'</span></span> | translate}}&lt;/<span class="hljs-keyword"><span class="hljs-keyword">div</span></span>&gt; ... &lt;<span class="hljs-keyword"><span class="hljs-keyword">div</span></span> id=<span class="hljs-string"><span class="hljs-string">"100"</span></span>&gt;{{<span class="hljs-string"><span class="hljs-string">'../another_key_!'</span></span> | translate}}&lt;/<span class="hljs-keyword"><span class="hljs-keyword">div</span></span>&gt;</code> </pre><br><p> é€šè¿‡åŠ è½½ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥å°†å…³é”®è·¯å¾„æ›¿æ¢ä¸ºæ¯ä¸ªç®¡é“æˆ–æŒ‡ä»¤é™„è¿‘çš„ç»„ä»¶æœ¬åœ°åŒ–ã€‚ </p><br><pre> <code class="hljs axapta">&lt;<span class="hljs-keyword"><span class="hljs-keyword">div</span></span> id=<span class="hljs-string"><span class="hljs-string">"1"</span></span>&gt;{{<span class="hljs-string"><span class="hljs-string">'app.some-component.some_key_1'</span></span> | translate}}&lt;/<span class="hljs-keyword"><span class="hljs-keyword">div</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment">// app.some-component. -   loader'</span></span></code> </pre> <br><p> æˆ‘ä»¬å¯ä»¥å°†å­—æ®µæ·»åŠ åˆ°æä¾›æœ¬åœ°åŒ–çš„ç»„ä»¶ä¸­ï¼š </p><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Component({ selector: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'app-some'</span></span></span><span class="hljs-meta">, template: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'&lt;div&gt;{{(localization + '</span></span></span><span class="hljs-meta">key</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">') | tanslate}}&lt;/div&gt;'</span></span></span><span class="hljs-meta"> })</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeComponent</span></span></span><span class="hljs-class"> </span></span>{ localization = <span class="hljs-string"><span class="hljs-string">'./'</span></span> }</code> </pre> <br><p> è¿™ä¹Ÿå¾ˆç³Ÿç³•-æ‚¨å¿…é¡»åœ¨ä»»ä½•åœ°æ–¹ç¼–å†™ä¸€ä¸ªæœ¬åœ°åŒ–å¯†é’¥ã€‚ </p><br><p> ç”±äºæœ€æ˜æ˜¾çš„é€‰é¡¹çœ‹èµ·æ¥å¾ˆç³Ÿç³•ï¼Œå› æ­¤è¯·å°è¯•ä½¿ç”¨è£…é¥°å™¨ï¼Œå¹¶å°†ä¸€äº›å…ƒæ•°æ®ä¿å­˜åœ¨ç»„ä»¶çš„åŸå‹ä¸­ï¼ˆå°±åƒAngularä¸€æ ·ï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/gu/_4/vp/gu_4vpfjn_3ujxoh3tragj7wi2s.png" alt="å›¾ç‰‡"></p><br><p>  <strong>æ³¨é‡Š</strong> -Angularè£…é¥°å™¨çš„å…ƒæ•°æ® <br>  __app_annotations__-æˆ‘ä»¬å°†ä¸ºè‡ªå·±å­˜å‚¨çš„å…ƒæ•°æ® </p><br><p> å¯ä»¥å°†ç›¸å¯¹äºç»„ä»¶çš„æœ¬åœ°åŒ–æ–‡ä»¶å¤¹çš„è·¯å¾„å†™å…¥è£…é¥°å™¨ï¼Œå¯ä»¥ä½¿ç”¨é™¤è·¯å¾„ä»¥å¤–çš„å…¶ä»–é€‰é¡¹æ¥æ‰©å±•åŒä¸€è£…é¥°å™¨ã€‚ </p><br><pre> <code class="hljs powershell">//translate.service.ts const app_annotations_key = <span class="hljs-string"><span class="hljs-string">'__app_annotations__'</span></span>; export <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Localization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path: string)</span></span></span></span> { // tslint:<span class="hljs-built_in"><span class="hljs-built_in">disable-next</span></span><span class="hljs-literal"><span class="hljs-literal">-line</span></span>:only<span class="hljs-literal"><span class="hljs-literal">-arrow</span></span><span class="hljs-literal"><span class="hljs-literal">-functions</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target: Function)</span></span></span></span> { const metaKey = app_annotations_key; Object.defineProperty(target, metaKey, { value: { //         path. path, name: <span class="hljs-string"><span class="hljs-string">'Translate'</span></span> } } as PropertyDescriptor); }; } //some.component.ts @Component({...}) @Localization({ path: <span class="hljs-string"><span class="hljs-string">'./'</span></span>, otherOptions: {...} }); export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeComponent</span></span></span></span> { }</code> </pre> <br><p>      webpack,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">loader</a>           ,      -    .          ,     (      styleUrls)      . loader,     npm .    . </p><br><p>        ,   -.       ,          -. </p><br><pre> <code class="hljs axapta">&lt;<span class="hljs-keyword"><span class="hljs-keyword">div</span></span>&gt;{{<span class="hljs-string"><span class="hljs-string">'just_key'</span></span> | translate}}&lt;/<span class="hljs-keyword"><span class="hljs-keyword">div</span></span>&gt;</code> </pre> <br><p>          .    ,      ,      ,           .    â€” Injector, .   ,       Injector,     ''  ,  translate       .      Injector,       (    ),         'get'. </p><br><p><img src="https://habrastorage.org/webt/jl/vw/0x/jlvw0xsep9o3valmkhc3uxblvdm.png" alt="å›¾ç‰‡"></p><br><p>  ,  parent  ,     ,    Injector'a  ,      ,     ,   ,   ,        . </p><br><p>  ,     API,   forwarRef() (    Angular reactive forms,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">control</a> ).  ,      .         . </p><br><pre> <code class="hljs powershell">// translate.service.ts export const TRANSLATE_TOKEN = new InjectionToken(<span class="hljs-string"><span class="hljs-string">'MyTranslateToken'</span></span>); // app.component.ts @Component({ selector: <span class="hljs-string"><span class="hljs-string">'app-root'</span></span>, templateUrl: <span class="hljs-string"><span class="hljs-string">'./app.component.html'</span></span>, styleUrls: [<span class="hljs-string"><span class="hljs-string">'./app.component.css'</span></span>], providers: [{<span class="hljs-type"><span class="hljs-type">provide</span></span>: <span class="hljs-type"><span class="hljs-type">TRANSLATE_TOKEN</span></span>, <span class="hljs-type"><span class="hljs-type">useExisting</span></span>: <span class="hljs-type"><span class="hljs-type">forwardRef</span></span>(() =&gt; <span class="hljs-type"><span class="hljs-type">AppComponent</span></span>)}] }) @Localization(<span class="hljs-string"><span class="hljs-string">'./'</span></span>) export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span></span> { title = <span class="hljs-string"><span class="hljs-string">'app'</span></span>; }</code> </pre> <br><p>        , ,         ,   forwardRef(). </p><br><p>  ,     Injector     forwardRef()        ,             .       ,        '' .     ,   ,   . </p><br><pre> <code class="hljs pgsql">// my-translate.directive.ts @Directive({ // tslint:<span class="hljs-keyword"><span class="hljs-keyword">disable</span></span>-next-<span class="hljs-type"><span class="hljs-type">line</span></span>:directive-selector selector: <span class="hljs-string"><span class="hljs-string">'[myTranslate]'</span></span> }) export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MyTranslateDirective extends TranslateDirective { @<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>() <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> myTranslate(e: string) { this.translate = e; } private keyPath: string; constructor(private _translateService: TranslateService, private _element: ElementRef, _chRef: ChangeDetectorRef, //    forwardRef() @Inject(TRANSLATE_TOKEN) @Optional() protected cmp: <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>) { super(_translateService, _element, _chRef); //    const prototype = <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.getPrototypeOf(cmp || {}).constructor; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prototype[app_annotations_key]) { //      this.keyPath = prototype[app_annotations_key].path; } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> updateValue(key: string, node: <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>, translations: <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.keyPath) { //     ,   //   key = `${this.keyPath.replace(/\//, <span class="hljs-string"><span class="hljs-string">'.'</span></span>)}.${key}`; } super.updateValue(key, node, translations); } }</code> </pre> <br><p>      . </p><br><p>  -      : </p><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{'just_this_component_key' | myTranslate}}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> //  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">myTranslate</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"just_this_component_key"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>    translate , .      ,       ,          -    : </p><br><pre> <code class="hljs pgsql">//en.bundle.json { "global_key": "Global key" "app-component": { "just_key": "Just key" } } //<span class="hljs-keyword"><span class="hljs-keyword">some</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.html &lt;div translate="global_key"&gt;&lt;/div&gt;</code> </pre> <br><p> Research and improve! </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">full example</a> </p><br><p>       : </p><br><ol><li>     FE     node.js   stacktrace.js. </li><li>  Jest  Angular . </li><li> Web worker )      , ,  Angular  . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN413787/">https://habr.com/ru/post/zh-CN413787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN413775/index.html">Machines Can See 2018çš„å¯¹æŠ—æ”»å‡»</a></li>
<li><a href="../zh-CN413777/index.html">å‘¨æœ«é˜…è¯»ï¼šIaaSå…¥é—¨èµ„æ–™ï¼Œä¿¡æ¯å®‰å…¨å’ŒITç›‘ç®¡æ´»åŠ¨</a></li>
<li><a href="../zh-CN413779/index.html">Arduinoä¸Šçš„è®¡æ—¶å™¨å’Œå¤šä»»åŠ¡</a></li>
<li><a href="../zh-CN413781/index.html">å¹¿å‘ŠçŒçŠ¬å¦‚ä½•åœ¨äº’è”ç½‘ä¸Šæ­¥å±¥ç»´è‰°</a></li>
<li><a href="../zh-CN413783/index.html">æœ€å¤§è´¨é‡çš„æ’æ˜Ÿå¦‚ä½•æ­»äº¡ï¼šè¶…æ–°æ˜Ÿï¼Œè¶…æ–°æ˜Ÿæˆ–ç›´æ¥åç¼©ï¼Ÿ</a></li>
<li><a href="../zh-CN413789/index.html">åœ¨ä½›ç½—é‡Œè¾¾å·ï¼Œç”±äºå¿˜è®°äº†å¯†ç ï¼Œä»–ä»¬ä¸€å¹´æ²¡æœ‰åœ¨FBIåŸºåœ°æ£€æŸ¥æ­¦å™¨è´­ä¹°è€…</a></li>
<li><a href="../zh-CN413791/index.html">JSä¸­çš„è®¡ç®—é‡å­åŠ›å­¦</a></li>
<li><a href="../zh-CN413793/index.html">æµè¡Œæ–‡åŒ–ä¸­çš„å½•éŸ³å¸¦ï¼šä¸ºä»€ä¹ˆè¿‡æ—¶çš„å½•éŸ³æ ¼å¼åˆè¢«è®¤ä¸ºå¾ˆæµè¡Œ</a></li>
<li><a href="../zh-CN413795/index.html">å¨±ä¹ä¸šä¸ºä½•è½¬å‘IaaSï¼šæ¡ˆä¾‹ç ”ç©¶</a></li>
<li><a href="../zh-CN413797/index.html">EAåœ¨E3ä¸Šä»‹ç»äº†Cï¼†Cçš„æ–°éƒ¨åˆ†ã€‚ çœ‹ç€å®ƒå®åœ¨æ˜¯ç—›è‹¦çš„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>