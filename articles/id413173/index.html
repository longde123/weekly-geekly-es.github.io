<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÑπÔ∏è üéÇ üõèÔ∏è Memantau kesalahan JavaScript dengan window.onerror üë©üèΩ‚Äçüç≥ ‚öúÔ∏è üíÉüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bahan, terjemahan yang kami terbitkan hari ini, didedikasikan untuk menangani kesalahan JS menggunakan window.onerror . Ini adalah acara browser khusu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memantau kesalahan JavaScript dengan window.onerror</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/413173/"> Bahan, terjemahan yang kami terbitkan hari ini, didedikasikan untuk menangani kesalahan JS menggunakan <code>window.onerror</code> .  Ini adalah acara browser khusus yang dipicu ketika terjadi kesalahan yang tidak tertangkap.  Di sini kita akan berbicara tentang cara untuk menangkap kesalahan menggunakan <code>onerror</code> peristiwa <code>onerror</code> , dan cara mengirim informasi tentang mereka ke server pengembang situs web.  Handler ini dapat digunakan sebagai dasar sistem Anda sendiri untuk mengumpulkan dan menganalisis informasi kesalahan.  Selain itu, ini adalah salah satu mekanisme paling penting yang digunakan dalam perpustakaan berorientasi kesalahan, seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gagak</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/11f/1b9/ddc/11f1b9ddcfdd735951758c0f56d57a03.jpg" alt="gambar"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Mendengarkan acara window.onerror</font> </h2><br>  Anda dapat mendengarkan acara <code>onerror</code> dengan menetapkan <code>window.onerror</code> fungsi yang memainkan peran penangan kesalahan: <br><br><pre> <code class="hljs lua">window.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg, url, lineNo, columnNo, error)</span></span></span></span> { // ...   ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Fungsi ini dipanggil ketika kesalahan terjadi, argumen berikut diteruskan ke sana: <br><br><ul><li>  <code>msg</code> - pesan kesalahan.  Sebagai contoh, <code>Uncaught ReferenceError: foo is not defined</code> . </li><li>  <code>url</code> - alamat skrip atau dokumen tempat kesalahan terjadi.  Misalnya, <code>/dist/app.js</code> . </li><li>  <code>lineNo</code> - nomor baris tempat kesalahan terjadi (jika didukung). </li><li>  <code>columnNo</code> - nomor kolom baris (jika didukung). </li><li>  <code>error</code> - objek <code>error</code> (jika didukung). </li></ul><br>  Empat argumen pertama memberi tahu pengembang skrip mana, di baris mana, dan di kolom mana baris ini terjadi kesalahan.  Argumen terakhir, objek bertipe <code>Error</code> , mungkin adalah argumen yang paling penting.  Mari kita bicarakan. <br><br><h2>  <font color="#3AC1EF">Objek kesalahan dan properti Error.prototype.stack</font> </h2><br>  Pada pandangan pertama, objek <code>Error</code> tidak ada yang istimewa.  Ini berisi tiga properti standar - <code>message</code> , <code>fileName</code> , dan <code>lineNumber</code> .  Data ini, mengingat informasi yang diteruskan ke <code>window.onerror</code> event handler, dapat dianggap berlebihan. <br><br>  Nilai sebenarnya dalam kasus ini adalah properti <code>Error.prototype.stack</code> non-standar.  Properti ini memberikan akses ke tumpukan panggilan (tumpukan kesalahan), memungkinkan Anda untuk mengetahui apa yang terjadi dalam program pada saat kesalahan terjadi, yang mana panggilan fungsi mendahului kemunculannya.  Pelacakan tumpukan panggilan dapat menjadi bagian penting dari proses debugging.  Dan, terlepas dari kenyataan bahwa properti <code>stack</code> tidak standar, itu tersedia di semua browser modern. <br><br>  Inilah yang terlihat seperti properti <code>stack</code> objek kesalahan di Chrome 46. <br><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:250</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:251</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:267</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:239</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:240</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span>    <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span>.\_<span class="hljs-selector-tag"><span class="hljs-selector-tag">evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)"</span></span></code> </pre> <br>  Di depan kami adalah string yang tidak diformat.  Ketika konten properti ini disajikan dalam bentuk ini, tidak nyaman untuk bekerja dengannya.  Begini cara yang sama akan terlihat setelah pemformatan. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">foobar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:241</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:11)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:245</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callFunction</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:229</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:33)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateOn</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:875</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140)</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">at</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.InjectedScript</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">._evaluateAndWrap</span></span> (&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">anonymous</span></span>&gt;<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:808</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34)</span></span></code> </pre> <br>  Sekarang, setelah memformat, tumpukan kesalahan terlihat jauh lebih jelas, segera menjadi jelas mengapa properti <code>stack</code> sangat penting ketika men-debug kesalahan. <br><br>  Namun, di sini semuanya tidak berjalan lancar.  Properti <code>stack</code> tidak distandarisasi, tetapi diimplementasikan secara berbeda di browser yang berbeda.  Di sini, misalnya, adalah seperti apa tumpukan kesalahan terlihat di Internet Explorer 11. <br><br><pre> <code class="hljs powershell">Error: foobar at bar (Unknown script code:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at foo (Unknown script code:<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>) at Anonymous <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:11:5)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:10:2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Anonymous</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unknown script code:1:73)</span></span></span></span></code> </pre> <br>  Anda dapat melihat, dibandingkan dengan contoh sebelumnya, bahwa di sini tidak hanya format yang berbeda untuk mewakili bingkai tumpukan digunakan, tetapi juga bahwa ada lebih sedikit data untuk setiap bingkai.  Misalnya, Chrome mengidentifikasi contoh penggunaan kata kunci <code>new</code> dan memberikan informasi lebih rinci tentang acara lain (khususnya, tentang panggilan fungsi. <code>_evaluateOn</code> dan. <code>_evaluateAndWrap</code> ).  Pada saat yang sama, di sini kami membandingkan hanya apa yang diberikan IE dan Chrome.  Browser lain menggunakan pendekatan mereka sendiri untuk menampilkan data tentang stack dan untuk memilih informasi yang termasuk dalam data ini. <br><br>  Agar semua ini terlihat seragam, Anda dapat menggunakan alat pihak ketiga.  Sebagai contoh, gagak-js menggunakan TraceKit untuk ini.  Stacktrace.js dan beberapa proyek lainnya memiliki tujuan yang sama. <br><br><h2>  <font color="#3AC1EF">Fitur window.onerror didukung oleh berbagai browser</font> </h2><br>  Peristiwa <code>windows.onerror</code> telah ada di browser selama beberapa waktu.  Secara khusus, dapat ditemukan di IE6 dan Firefox 2. Masalahnya di sini adalah bahwa semua browser menerapkan <code>windows.onerror</code> dengan cara yang berbeda.  Misalnya, ini menyangkut jumlah dan struktur argumen yang diteruskan ke penangan acara ini. <br><br>  Berikut adalah tabel yang <code>onerror</code> argumen yang diteruskan ke penangan <code>onerror</code> di peramban utama. <br><table><tbody><tr><td>  Browser <br></td><td>  pesan <br></td><td>  url <br></td><td>  lineTidak <br></td><td>  colNo <br></td><td>  errorObj <br></td></tr><tr><td>  Firefox <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td></tr><tr><td>  Chrome <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td></tr><tr><td>  Edge <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td></tr><tr><td>  IE 11 <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td></tr><tr><td>  IE10 <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Tidak <br></td></tr><tr><td>  IE 9.8 <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Tidak <br></td><td>  Tidak <br></td></tr><tr><td>  Safari 10 ke atas <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td></tr><tr><td>  Safari 9 <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Tidak <br></td></tr><tr><td>  Browser Android 4.4 <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Ada <br></td><td>  Tidak <br></td></tr></tbody></table><br>  Mungkin tidak mengherankan, Internet Explorer 8, 9, dan 10 memiliki dukungan terbatas untuk satu <code>onerror</code> .  Namun, mungkin tampak tidak biasa bahwa dukungan browser Safari untuk objek kesalahan hanya muncul di versi 10, dirilis pada 2016.  Selain itu, ada perangkat seluler lawas yang menggunakan browser Android standar, yang juga tidak mendukung objek kesalahan.  Dalam versi modern Android, browser ini telah digantikan oleh Chrome Mobile. <br><br>  Jika tidak ada objek kesalahan yang kami miliki, maka tidak ada data tentang jejak stack.  Ini berarti bahwa browser yang tidak mendukung objek kesalahan tidak memberikan informasi tumpukan dalam skrip standar untuk menggunakan penangan <code>onerror</code> .  Dan ini, seperti yang telah kami katakan, sangat penting. <br><br><h2>  <font color="#3AC1EF">Pengembangan polyfill untuk window.onerror menggunakan try / catch construct</font> </h2><br>  Untuk mendapatkan informasi tentang tumpukan di browser yang tidak mendukung melewatkan objek <code>onerror</code> ke penangan <code>onerror</code> , Anda dapat menggunakan trik berikut.  Anda bisa membungkus kode dalam konstruk <code>try/catch</code> - <code>try/catch</code> dan tangkap sendiri kesalahannya.  Objek kesalahan yang dihasilkan akan berisi, di semua browser modern, yang kita butuhkan adalah properti <code>stack</code> . <br>  Lihatlah kode metode helper <code>invoke()</code> , yang memanggil metode yang diberikan objek, memberikan array argumen. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }</code> </pre> <br>  Inilah cara menggunakannya. <br><br><pre> <code class="hljs lisp">invoke(<span class="hljs-name"><span class="hljs-name">Math</span></span>, 'max', [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>])<span class="hljs-comment"><span class="hljs-comment">; //  2</span></span></code> </pre> <br>  Berikut ini adalah <code>invoke()</code> sama <code>invoke()</code> , tetapi sekarang pemanggilan metode dibungkus <code>try/catch</code> , yang memungkinkan Anda untuk menangkap kemungkinan kesalahan. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj, method, args)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) {   captureError(e);//      <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//      } } invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]); //  ,     Math.highest</code> </pre> <br>  Tentu saja, sangat mahal untuk menambahkan struktur seperti itu secara manual ke semua tempat yang mungkin membutuhkannya.  Tugas ini dapat disederhanakan dengan membuat fungsi penolong universal. <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapErrors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fn)</span></span></span></span> { //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!fn.__wrapped__) {   fn.__wrapped__ = function() {     <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.apply(this,arguments);     }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e){       captureError(e);//          <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e;//          }   }; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn.__wrapped__; } var invoke = wrapErrors(function(obj, method, args) { returnobj[<span class="hljs-type"><span class="hljs-type">method</span></span>].apply(this,args); }); invoke(Math,<span class="hljs-string"><span class="hljs-string">'highest'</span></span>,[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]);//,   Math.highest</code> </pre> <br>  Karena JavaScript menggunakan model eksekusi kode berulir tunggal, pembungkus ini harus digunakan hanya dengan pemanggilan fungsi yang ada di awal tumpukan baru.  Tidak perlu membungkus semua panggilan fungsi di dalamnya. <br><br>  Akibatnya, ternyata fungsi ini harus digunakan di tempat-tempat berikut: <br><br><ul><li>  Di mana aplikasi dimulai (misalnya, saat menggunakan jQuery, dalam fungsi <code>$(document).ready</code> ) </li><li>  Dalam penangan acara (misalnya, di <code>addEventListener</code> atau dalam konstruksi formulir <code>$.fn.click</code> ) </li><li>  Dalam panggilan balik yang dipanggil oleh acara penghitung waktu (misalnya, <code>setTimeout</code> atau <code>requestAnimationFrame</code> ) </li></ul><br>  Berikut adalah contoh menggunakan fungsi <code>wrapErrors</code> . <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span>(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {//    doSynchronousStuff1();//     setTimeout(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff2();//      })); <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'.foo'</span></span>).click(wrapErrors(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   doSynchronousStuff3();//     })); }));</code> </pre> <br>  Konstruksi seperti itu dapat ditambahkan ke kode sendiri, tetapi ini tugas yang terlalu memakan waktu.  Sebagai alternatif yang nyaman dalam situasi seperti itu, Anda dapat mempertimbangkan perpustakaan untuk bekerja dengan kesalahan, yang, misalnya, memiliki mekanisme yang <code>addEventListener</code> dan <code>setTimeout</code> alat untuk <code>addEventListener</code> kesalahan. <br><br><h2>  <font color="#3AC1EF">Kesalahan transfer ke server</font> </h2><br>  Jadi, sekarang kami memiliki sarana yang kami miliki untuk mencegat informasi kesalahan baik menggunakan <code>windows.onerror</code> atau menggunakan fungsi tambahan berdasarkan <code>try/catch</code> .  Kesalahan ini terjadi di sisi klien, dan, setelah intersepsi mereka, kami ingin mengatasinya dan mengambil langkah-langkah untuk menghilangkannya.  Untuk melakukan ini, mereka harus ditransfer ke server kami.  Untuk melakukan ini, Anda perlu menyiapkan layanan web yang akan menerima informasi tentang kesalahan melalui HTTP, dan kemudian menyimpannya untuk diproses lebih lanjut, misalnya - akan menulis ke file log atau database. <br><br>  Jika layanan web ini terletak pada domain yang sama dengan aplikasi web, <code>XMLHttpRequest</code> akan cukup.  Contoh berikut menunjukkan cara menggunakan fungsi untuk menjalankan kueri AJAX dari jQuery untuk mentransfer data ke server. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> captureError(ex){ var errorData = {   <span class="hljs-type"><span class="hljs-type">name</span></span>:ex.name,// : ReferenceError   message:ex.line,// : x <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> undefined   url:document.<span class="hljs-keyword"><span class="hljs-keyword">location</span></span>.href,   stack:ex.stack//   ; ,     ! }; $.post(<span class="hljs-string"><span class="hljs-string">'/logger/js/'</span></span>,{   data:errorData }); }</code> </pre> <br>  Perlu diingat bahwa jika Anda perlu mengirim permintaan lintas-domain untuk mengirim informasi tentang kesalahan ke server, Anda harus berhati-hati mendukung permintaan tersebut. <br><br><h2>  <font color="#3AC1EF">Ringkasan</font> </h2><br>  Anda telah mempelajari dasar-dasar membuat layanan untuk menangkap kesalahan dan mengirim informasi tentangnya ke server.  Secara khusus, di sini kami memeriksa masalah berikut: <br><br><ul><li>  Fitur acara <code>onerror</code> dan dukungannya di berbagai browser. </li><li>  Menggunakan mekanisme <code>try/catch</code> untuk mendapatkan informasi tentang tumpukan panggilan dalam kasus-kasus di mana <code>onerror</code> tidak mendukung bekerja dengan objek kesalahan. </li><li>  Transfer data kesalahan ke server pengembang. </li></ul><br>  Setelah mempelajari tentang bagaimana mekanisme di atas bekerja, Anda telah memperoleh pengetahuan dasar yang akan memungkinkan Anda untuk mulai membuat sistem Anda sendiri untuk bekerja dengan kesalahan, mengklarifikasi detail tambahan selama bekerja.  Mungkin skenario ini sangat relevan untuk kasus-kasus ketika datang ke aplikasi tertentu di mana, katakanlah, untuk alasan keamanan, itu tidak direncanakan untuk menggunakan perpustakaan pihak ketiga.  Jika aplikasi Anda memungkinkan penggunaan kode pihak ketiga, Anda dapat menemukan alat yang tepat untuk memonitor kesalahan JS.  Di antara alat-alat tersebut adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sentry</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Rollbar</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TrackJS</a> dan proyek serupa lainnya. <br><br>  <b>Pembaca yang budiman!</b>  Alat apa untuk memantau kesalahan JS yang Anda gunakan? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id413173/">https://habr.com/ru/post/id413173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id413163/index.html">Kelemahan HTTPS. Bagian 2</a></li>
<li><a href="../id413165/index.html">Penjelasan SRTP</a></li>
<li><a href="../id413167/index.html">Bagaimana cara mengintegrasikan Zimbra dengan sistem DLP?</a></li>
<li><a href="../id413169/index.html">Array dan Metode Objek yang Berguna dalam JavaScript</a></li>
<li><a href="../id413171/index.html">Tokamak JET Meluncurkan Kampanye Deuterium Tritium Baru</a></li>
<li><a href="../id413175/index.html">Analisis statis di Go: bagaimana kita menghemat waktu saat memeriksa kode</a></li>
<li><a href="../id413177/index.html">Acara digital di Moskow dari 4 hingga 10 Juni</a></li>
<li><a href="../id413181/index.html">Ketika panggilan fungsi eksternal lebih cepat dari panggilan C asli</a></li>
<li><a href="../id413183/index.html">Optane DC Persistent Memory - Optane dalam format DIMM</a></li>
<li><a href="../id413185/index.html">Bermain curang, atau bagaimana penyelenggara undian menipu kita</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>