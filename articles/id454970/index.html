<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüéì üë®üèø‚Äçüé® üö¶ Basis Data Integrasi dengan Spring Boot dan Testcontainers ‚úä üöµüèø üïµüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Ikhtisar 


 Dengan Spring Data JPA, Anda dapat dengan mudah membuat kueri basis data dan mengujinya menggunakan basis data H2 bawaan. 


 Tetapi k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Basis Data Integrasi dengan Spring Boot dan Testcontainers</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/454970/"><h2 id="1-obzor">  1. Ikhtisar </h2><br><p>  Dengan Spring Data JPA, Anda dapat dengan mudah membuat kueri basis data dan mengujinya menggunakan basis data H2 bawaan. </p><br><p>  Tetapi kadang-kadang <em>pengujian pada basis data nyata jauh lebih berguna</em> , terutama jika kita menggunakan kueri yang terkait dengan implementasi basis data tertentu. </p><br><p>  Dalam tutorial ini, kami akan menunjukkan cara menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Testcontainers</a> untuk pengujian integrasi dengan Spring Data JPA dan database PostgreSQL. </p><a name="habracut"></a><br><p>  Pada artikel sebelumnya, kami membuat beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kueri basis data, terutama menggunakan penjelasan <em>@Query</em></a> , yang kami uji sekarang. </p><br><h2 id="2-konfiguraciya">  2. Konfigurasi </h2><br><p>  Untuk menggunakan database PostgreSQL dalam pengujian kami, kami harus menambahkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ketergantungan Testcontainers</a> hanya tes dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">driver PostgreSQL</a> ke file <em>pom.xml</em> kami: </p><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.testcontainers<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>postgresql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.10.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.postgresql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>postgresql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>42.2.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Kami juga akan membuat file <em>application.properties</em> di direktori sumber daya pengujian, di mana kami akan mengatur penggunaan kelas driver yang diperlukan untuk Spring, serta membuat dan menghapus skema database setiap kali tes berjalan: </p><br><pre> <code class="plaintext hljs">spring.datasource.driver-class-name=org.postgresql.Driver spring.jpa.hibernate.ddl-auto=create-drop</code> </pre> <br><h2 id="3-edinichnyy-test">  3. Tes unit </h2><br><p>  Untuk mulai menggunakan instance PostgreSQL dalam satu kelas uji, Anda perlu membuat definisi kontainer, dan kemudian menggunakan parameternya untuk membuat koneksi: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-meta"><span class="hljs-meta">@ContextConfiguration</span></span>(initializers = {UserRepositoryTCIntegrationTest.Initializer.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepositoryTCIntegrationTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepositoryCommonIntegrationTests</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ClassRule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> PostgreSQLContainer postgreSQLContainer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostgreSQLContainer(<span class="hljs-string"><span class="hljs-string">"postgres:11.1"</span></span>) .withDatabaseName(<span class="hljs-string"><span class="hljs-string">"integration-tests-db"</span></span>) .withUsername(<span class="hljs-string"><span class="hljs-string">"sa"</span></span>) .withPassword(<span class="hljs-string"><span class="hljs-string">"sa"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Initializer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationContextInitializer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConfigurableApplicationContext</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConfigurableApplicationContext configurableApplicationContext)</span></span></span><span class="hljs-function"> </span></span>{ TestPropertyValues.of( <span class="hljs-string"><span class="hljs-string">"spring.datasource.url="</span></span> + postgreSQLContainer.getJdbcUrl(), <span class="hljs-string"><span class="hljs-string">"spring.datasource.username="</span></span> + postgreSQLContainer.getUsername(), <span class="hljs-string"><span class="hljs-string">"spring.datasource.password="</span></span> + postgreSQLContainer.getPassword() ).applyTo(configurableApplicationContext.getEnvironment()); } } }</code> </pre> <br><p>  Dalam contoh di atas, kami menggunakan <code>@ClassRule</code> dari JUnit untuk mengonfigurasi wadah basis data <em>sebelum menjalankan metode pengujian</em> .  Kami juga membuat kelas dalam statis yang mengimplementasikan <em>ApplicationContextInitializer</em> .  Akhirnya, kami menerapkan penjelasan <code>@ContextConfiguration</code> ke kelas pengujian kami dengan kelas inisialisasi sebagai parameter. </p><br><p>  <em>Setelah menyelesaikan tiga langkah ini, kita dapat mengatur parameter koneksi sebelum menerbitkan konteks Spring.</em> </p><br><p>  Sekarang kami menggunakan dua permintaan UPDATE dari artikel sebelumnya: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Modifying</span></span> <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"update User u set u.status = :status where u.name = :name"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateUserSetStatusForName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Param(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"status"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Integer status, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Param</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"name"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String name)</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Modifying</span></span> <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(value = <span class="hljs-string"><span class="hljs-string">"UPDATE Users u SET u.status = ? WHERE u.name = ?"</span></span>, nativeQuery = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateUserSetStatusForNameNative</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer status, String name)</span></span></span></span>;</code> </pre> <br><p>  Dan uji dalam lingkungan runtime yang disetel: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">givenUsersInDB_WhenUpdateStatusForNameModifyingQueryAnnotationJPQL_ThenModifyMatchingUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ insertUsers(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> updatedUsersSize = userRepository.updateUserSetStatusForName(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"SAMPLE"</span></span>); assertThat(updatedUsersSize).isEqualTo(<span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">givenUsersInDB_WhenUpdateStatusForNameModifyingQueryAnnotationNative_ThenModifyMatchingUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ insertUsers(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> updatedUsersSize = userRepository.updateUserSetStatusForNameNative(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"SAMPLE"</span></span>); assertThat(updatedUsersSize).isEqualTo(<span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insertUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ userRepository.save(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(<span class="hljs-string"><span class="hljs-string">"SAMPLE"</span></span>, <span class="hljs-string"><span class="hljs-string">"email@example.com"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); userRepository.save(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(<span class="hljs-string"><span class="hljs-string">"SAMPLE1"</span></span>, <span class="hljs-string"><span class="hljs-string">"email2@example.com"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); userRepository.save(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(<span class="hljs-string"><span class="hljs-string">"SAMPLE"</span></span>, <span class="hljs-string"><span class="hljs-string">"email3@example.com"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); userRepository.save(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User(<span class="hljs-string"><span class="hljs-string">"SAMPLE3"</span></span>, <span class="hljs-string"><span class="hljs-string">"email4@example.com"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); userRepository.flush(); }</code> </pre> <br><p>  Dalam skenario di atas, tes pertama berhasil, dan yang kedua melempar <em>InvalidDataAccessResourceUsageException</em> dengan pesan: </p><br><pre> <code class="plaintext hljs">Caused by: org.postgresql.util.PSQLException: ERROR: column "u" of relation "users" does not exist</code> </pre> <br><p>  Jika kami menjalankan tes yang sama menggunakan database H2 bawaan, keduanya akan berhasil, tetapi PostgreSQL tidak menerima alias dalam pernyataan SET.  Kami dapat dengan cepat memperbaiki permintaan dengan menghapus alias yang bermasalah: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Modifying</span></span> <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(value = <span class="hljs-string"><span class="hljs-string">"UPDATE Users u SET status = ? WHERE u.name = ?"</span></span>, nativeQuery = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateUserSetStatusForNameNative</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer status, String name)</span></span></span></span>;</code> </pre> <br><p>  Kali ini kedua tes berhasil lulus.  Dalam contoh ini, <em>kami menggunakan Testcontainers untuk mengidentifikasi masalah dengan kueri asli yang kalau tidak akan terdeteksi hanya setelah pergi ke database produksi</em> .  Juga harus dicatat bahwa menggunakan query <em>JPQL</em> umumnya lebih aman, karena Spring menerjemahkannya dengan benar tergantung pada penyedia database yang digunakan. </p><br><h2 id="4-obschiy-ekzemplyar-bazy-dannyh">  4. Contoh database bersama </h2><br><p>  Di bagian sebelumnya, kami menjelaskan cara menggunakan Testcontainers dalam satu tes.  Dalam kasus nyata, saya ingin menggunakan wadah database yang sama dalam beberapa tes karena waktu peluncuran yang relatif lama. </p><br><p>  Mari kita membuat kelas umum untuk membuat wadah database dengan mewarisi <em>PostgreSQLContainer</em> dan mengganti metode <em>start ()</em> dan <em>stop ()</em> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaeldungPostgresqlContainer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostgreSQLContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaeldungPostgresqlContainer</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String IMAGE_VERSION = <span class="hljs-string"><span class="hljs-string">"postgres:11.1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> BaeldungPostgresqlContainer container; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaeldungPostgresqlContainer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(IMAGE_VERSION); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BaeldungPostgresqlContainer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (container == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaeldungPostgresqlContainer(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> container; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.start(); System.setProperty(<span class="hljs-string"><span class="hljs-string">"DB_URL"</span></span>, container.getJdbcUrl()); System.setProperty(<span class="hljs-string"><span class="hljs-string">"DB_USERNAME"</span></span>, container.getUsername()); System.setProperty(<span class="hljs-string"><span class="hljs-string">"DB_PASSWORD"</span></span>, container.getPassword()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//do nothing, JVM handles shut down } }</span></span></code> </pre> <br><p>  Membiarkan metode <em>stop ()</em> kosong, kami mengaktifkan JVM untuk menangani penyelesaian kontainer sendiri.  Kami juga menerapkan singleton sederhana, di mana hanya tes pertama yang memulai wadah, dan setiap tes berikutnya menggunakan contoh yang ada.  Pada metode <em>start ()</em> , kami menggunakan <em>System # setProperty</em> untuk menyimpan parameter koneksi ke variabel lingkungan. </p><br><p>  Sekarang kita dapat menulisnya ke file <em>application.properties</em> : </p><br><pre> <code class="plaintext hljs">spring.datasource.url=${DB_URL} spring.datasource.username=${DB_USERNAME} spring.datasource.password=${DB_PASSWORD}</code> </pre> <br><p>  Sekarang kita menggunakan kelas utilitas kita dalam definisi tes: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepositoryTCAutoIntegrationTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ClassRule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> PostgreSQLContainer postgreSQLContainer = BaeldungPostgresqlContainer.getInstance(); <span class="hljs-comment"><span class="hljs-comment">// tests }</span></span></code> </pre> <br><p>  Seperti dalam contoh sebelumnya, kami menerapkan penjelasan <em>@ClassRule</em> ke bidang dengan definisi wadah.  Dengan demikian, parameter koneksi DataSource diisi dengan nilai yang benar sebelum membuat konteks Spring. </p><br><p>  Sekarang kita dapat mengimplementasikan beberapa tes menggunakan instance database yang sama dengan hanya mengatur bidang dengan penjelasan <em>@ClassRule yang</em> dibuat menggunakan kelas utilitas kami <em>BaeldungPostgresqlContainer</em> . </p><br><h2 id="5-zaklyuchenie">  5. Kesimpulan </h2><br><p>  Dalam artikel ini, kami menunjukkan metode pengujian pada basis data produksi menggunakan Testcontainers. </p><br><p>  Kami juga memeriksa contoh menggunakan uji tunggal menggunakan mekanisme <em>ApplicationContextInitializer</em> dari Spring, serta menerapkan kelas untuk menggunakan kembali contoh database. </p><br><p>  Kami juga menunjukkan bagaimana Testcontainers dapat membantu mengidentifikasi masalah kompatibilitas antara beberapa penyedia basis data, terutama untuk kueri asli. </p><br><p>  Seperti biasa, kode lengkap yang digunakan dalam artikel ini tersedia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di GitHub</a> . </p><cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id454970/">https://habr.com/ru/post/id454970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id454960/index.html">Mikrobiota. Bagaimana obat memengaruhi bakteri usus</a></li>
<li><a href="../id454962/index.html">Bagaimana perusahaan IT di dunia melindungi diri mereka dari pesaing di hadapan mantan karyawan?</a></li>
<li><a href="../id454964/index.html">Penggunaan visi komputer dalam penelitian kelautan atau 12 orang di dada orang mati</a></li>
<li><a href="../id454966/index.html">Buat game instan di Unity di Google Play Instant</a></li>
<li><a href="../id454968/index.html">Vladimir Vorobyov: "Mikhail Botvinnik senang bahwa mesin tidak menemukan solusi yang dia temukan di papan tulis"</a></li>
<li><a href="../id454972/index.html">Bagaimana LANIT membawa kucing ke Google dan belajar tentang bekerja dengan startup</a></li>
<li><a href="../id454974/index.html">Lockheed Martin mematenkan pencetakan 3D dengan berlian</a></li>
<li><a href="../id454976/index.html">Max Patrol 8. Ikhtisar Alat Manajemen Kerentanan</a></li>
<li><a href="../id454978/index.html">Bug di Linux 5.1 menyebabkan hilangnya data - tambalan koreksi telah dirilis</a></li>
<li><a href="../id454980/index.html">Apa yang ada di iPod pertama: dua puluh album yang dipilih Steve Jobs pada tahun 2001</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>