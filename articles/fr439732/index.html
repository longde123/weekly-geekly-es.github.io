<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍⚖️ 🌅 🛌🏼 Lazarus - animation simple utilisant le composant TImageFragment 🏝️ 🏛️ 🥑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au lieu de l'avant-propos 
 Dans mon récent article Lazarus - écrivant un composant pour l'animation de sprite, j'ai décrit le processus de création d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lazarus - animation simple utilisant le composant TImageFragment</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439732/"><h6>  Au lieu de l'avant-propos </h6><br>  Dans mon récent article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lazarus - écrivant un composant pour l'animation de sprite,</a> j'ai décrit le processus de création d'un simple composant <b>TImageFragment</b> qui vous permet d'afficher un fragment donné d'une image. <br><br>  Poursuivant le sujet sélectionné, dans cet article, je veux montrer à quel point il est facile de faire de l'animation de sprites dans l'environnement de développement <b>Lazarus</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> ) en utilisant ce composant. <br><br>  Avec cette approche, des images d'animation individuelles dans différentes projections sont placées sur la même image, et le composant pour afficher l'image-objet n'affiche qu'un seul fragment sélectionné de cette image en utilisant les propriétés <b>OffsetX</b> et <b>OffsetY</b> (décalage du coin supérieur gauche du fragment d'image horizontalement et verticalement). <br><br>  Beaucoup de ces images toutes faites peuvent être trouvées sur le Web - par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici sur ce site</a> . <a name="habracut"></a><br><br><h6>  Sélectionnez (et préparez) l'image </h6><br>  Pour mon exemple, j'ai choisi cette image: <br><img src="https://habrastorage.org/getpro/habr/post_images/909/e6e/661/909e6e661a0a47541735e88ce1adcb00.png"><br>  - très expressivement cet oiseau Phoenix bat des ailes. <br><br>  Comme vous pouvez le voir, chaque ligne contient 4 images pour chacune des 4 projections.  En changeant uniquement <b>OffsetX</b> , vous pouvez faire <b>battre l'aile de</b> l'oiseau, et pour changer la projection, il suffit de changer <b>OffsetY</b> .  Cette séparation des images par des lignes simplifie considérablement la programmation de l'animation. <br><br>  La taille de cette image est de 384x384 et la taille de chaque image est de 96x96.  Malheureusement, l'utilisation directe de cette image nous a dérangé avec des artefacts: certaines images de l'image sont placées de sorte que leurs bords tombent sur des images adjacentes, et pendant l'animation, des traits jaunes clignotent sur les bords de l'image-objet. <br><br>  Pour corriger ces défauts, j'ai utilisé l'éditeur graphique multiplateforme gratuit <b>GIMP</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> ).  Tout ce qui devait être fait était de supprimer les pixels saillants des images aux endroits où ils tombaient sur le cadre adjacent. <br><br>  Le fichier corrigé ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/vw/_a/44/vw_a44kabb9dlcz4ituzz2zumdi.png"><br><br>  - À l'œil nu, les différences sont invisibles, mais la deuxième option fonctionne sans artefacts. <br><br><h6>  Créer un nouveau projet </h6><br>  1. Créez un nouveau projet de type «Application». <br><br>  Par défaut, l'EDI crée un projet appelé «project1», qui crée immédiatement un module de programme appelé «unit1», qui décrit une classe appelée «« TForm1 »et déclare une instance avec le nom« Form1 ». <br><br>  En général, lors de la création de nouveaux objets, l'EDI leur attribue des noms similaires, composés du nom du type d'objet et du numéro de série.  Je considère que c'est un bon style de renommer tous ces objets, en leur donnant des noms significatifs qui reflètent le rôle ou le but de l'objet. <br><br>  Ainsi, notre projet ne sera pas appelé «project1», mais «Phoenix» - par le nom du sprite sélectionné. <br><br>  2. Enregistrez notre nouveau projet. <br><br>  Il est conseillé de sauvegarder chaque projet dans un répertoire séparé avec un nom qui correspond au nom du projet.  Pendant le processus de sauvegarde, nous spécifions le répertoire à sauvegarder (si nécessaire, nous le créons juste là), puis le nom du fichier projet et le nom du fichier du module programme.  J'ai créé le dossier «Phoenix» et y ai enregistré le fichier de projet («Phoenix.lpi» au lieu du «project1.lpi» proposé) et le fichier de module de programme («UnitMain.pas» au lieu du «unit1.pas» proposé). <br><br><div class="spoiler">  <b class="spoiler_title">Nuance de casse de caractère</b> <div class="spoiler_text">  La version Lazarus pour Windows conduit le nom de fichier du module de programme en minuscules: "unitmain.pas", mais le nom de programme du module conserve la casse d'origine des caractères: "unit UnitMain;".  Cela ne se produit pas avec le fichier de projet; le nom du fichier conserve la casse d'origine des caractères. </div></div><br>  3. Renommez le formulaire et changez son titre. <br><br>  Le formulaire nouvellement créé, appelé «Form1» (propriété <b>Name</b> ), est une instance de la classe «TForm1» et contient le titre «Form1» (propriété <b>Caption</b> ).  Modifiez la propriété <b>Name</b> du formulaire en «FormMain» et le nom de la classe changera en «TFormMain». <br><br>  Remplacez la propriété <b>Caption</b> par «Phoenix» afin que le titre du projet s'affiche dans le titre de la fenêtre. <br><br>  4. En conséquence, j'ai obtenu le texte suivant du module unitmain.pas: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br><br>  5. Compilez, exécutez le projet (touche &lt;F9&gt;): <br><br><img src="https://habrastorage.org/webt/v_/el/0s/v_el0s_ntalmovtpfkso3j-gqau.png"><br><br><h6>  Mettez le sprite sur le formulaire </h6><br>  En supposant que vous avez déjà installé le composant <b>TImageFragment</b> décrit dans mon précédent article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lazarus - nous écrivons un composant pour l'animation de sprite</a> , sélectionnez l'onglet «Jeu» sur la palette de composants et ajoutons le composant «TImageFragment» au formulaire. <br><br>  À l'aide de la propriété <b>Picture</b> , chargez une image (une version fixe de l'oiseau Phoenix) dans le composant.  De plus, nous modifions également les propriétés suivantes du nouvel objet: <br><br><ul><li>  définissez les propriétés <b>Height</b> et <b>Width</b> sur 96 </li><li>  définir les propriétés <b>Left</b> et <b>Top</b> sur 0 (pratique pour faire correspondre mes captures d'écran) </li><li>  <b>La</b> propriété de <b>nom</b> est changée de l'incommode "ImageFragment1" à un "Sprite" simple et compréhensible </li></ul><br>  Si tout est fait correctement, le composant affichera la première image de l'image: <br><img src="https://habrastorage.org/webt/br/zp/g2/brzpg25qbgjlrsoy20akjhdeox4.png"><br><br>  Le texte du module <b>UnitMain subira</b> des modifications mineures: <br>  - le module <b>ImageFragment</b> est ajouté à la section <b>utilisations</b> <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ImageFragment;</code> </pre><br>  - un nouvel objet apparaîtra dans la déclaration de classe <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br><h6>  Ajouter une animation - volets d'aile </h6><br>  1. Ajoutez un nouveau composant de la classe <b>TTimer</b> au <b>formulaire</b> . <br><br>  Ce composant est situé sur l'onglet «Système» de la palette de composants.  Vous pouvez le placer à n'importe quel endroit pratique du formulaire, car il ne s'affiche pas dans une application en cours d'exécution. <br><br>  2. Renommez l'objet ajouté. <br><br>  Le nouvel objet prend automatiquement le nom «Timer1», mais nous le renommons «TimerLive».  Il est souvent commode de donner aux objets de tels noms, composés de deux parties: la première reflète la classe de l'objet et la seconde reflète son objectif. <br><br>  3. Modifiez la propriété <b>Intervalle</b> de 1000 à 100. <br><br>  Laissez les images de cette animation se remplacer toutes les 100 millisecondes, c'est-à-dire 10 fois par seconde.  À l'avenir, cette propriété peut être modifiée pour ralentir ou accélérer l'envergure - à la discrétion du programmeur. <br><br>  4. Ajoutez un gestionnaire d'événements OnTimer. <br><br>  La façon la plus simple de le faire est de double-cliquer sur l'icône d'un nouvel objet <b>TimerLive</b> .  À la suite de cette action, l'EDI lui-même ajoutera une nouvelle procédure à la déclaration de classe de formulaire, un lien vers cette procédure vers les propriétés de l'objet et le corps de la nouvelle procédure sera ajouté à la section d' <b>implémentation</b> (et le curseur sera placé à l'intérieur de cette nouvelle procédure, entre les <b>mots-clés de</b> <b>début</b> et de <b>fin</b> ). <br><br>  5. Ajoutez une ligne de code à la nouvelle procédure. <br><br><pre> <code class="delphi hljs"> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>;</code> </pre><br>  À la suite de ces actions, la déclaration de classe devrait ressembler à ceci: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Et la nouvelle procédure - le <b>gestionnaire d'</b> événements <b>OnTimer</b> devrait ressembler à ceci: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Après avoir compilé et exécuté l'application, vous pouvez regarder l'oiseau Phoenix battre des ailes. <br><br>  Cela se produit car le gestionnaire d'événements du minuteur change toutes les 100 millisecondes de manière cyclique le décalage du fragment affiché et la trame sélectionnée est décalée horizontalement, affichant séquentiellement 4 trames de la ligne supérieure de l'image chargée.  L'opération de <b>mod</b> - obtenir le reste de la division - empêche le décalage d'aller au-delà de la taille de l'image, et par conséquent, la 4ème image est à nouveau suivie par la 1ère. <br><br><h6>  Ajoutez un mouvement de sprite autour de la fenêtre </h6><br>  1. Ajoutez le module <b>Math</b> à la section <b>uses</b> <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math;</code> </pre><br>  2. Ajoutez une nouvelle variable et constante à la déclaration de classe. <br><br>  Pour enregistrer le vecteur de déplacement du sprite autour de la fenêtre, ajoutez une variable de type <b>TPoint</b> <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint;</code> </pre><br>  Au même endroit, on déclare une constante pour définir le module de vitesse <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  3. Ajoutez un autre composant de la classe <b>TTimer</b> au <b>formulaire</b> . <br><br>  Je vous rappelle: ce composant est dans l'onglet «Système» de la palette des composants. <br><br>  Le nouvel objet obtient de nouveau automatiquement le nom «Timer1», et nous le renommons - cette fois en «TimerMove».  Le second temporisateur a pour but de contrôler le mouvement du sprite.  Je n'ai pas lié les deux processus (animation et mouvement) à la même minuterie afin que chacun des temporisateurs puisse être réglé séparément - par exemple, pour ralentir la fréquence des oscillations des ailes sans ralentir le mouvement, etc. <br><br>  4. Modifiez la propriété <b>Intervalle</b> de 1000 à 100. <br><br>  Laissez cette minuterie se déclencher également toutes les 100 millisecondes, c'est-à-dire 10 fois par seconde.  À l'avenir, cette propriété peut également être modifiée pour ralentir ou accélérer la fréquence de rendu du fait que le sprite se déplace. <br><br>  5. Ajoutez un <b>gestionnaire d'</b> événements <b>OnTimer</b> . <br><br>  Pour changer, cette fois, je propose de le faire en double-cliquant en face de l'événement <b>OnTimer</b> sur l'onglet "Evénements" du nouvel objet <b>TimerMove</b> .  Comme la dernière fois, à la suite de cette action, l'EDI lui-même ajoutera une nouvelle procédure à la déclaration de classe de formulaire, un lien vers cette procédure vers les propriétés de l'objet et le corps de la nouvelle procédure sera ajouté à la section d' <b>implémentation</b> (et le curseur sera placé à l'intérieur de cette nouvelle procédure, entre la clé les mots <b>commencent</b> et se <b>terminent</b> ). <br><br>  6. Ajoutez deux lignes de code à la nouvelle procédure. <br><br><pre> <code class="delphi hljs"> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y));</code> </pre><br>  L'utilisation des fonctions Max () et Min () empêche le sprite de quitter le formulaire (la fenêtre principale de l'application). <br>  C'est pour utiliser ces fonctions que nous avons connecté le module <b>Math</b> à la section <b>uses</b> . <br><br>  7. Ajoutez un <b>gestionnaire d'</b> événements <b>OnKeyPress</b> . <br><br>  Sélectionnez le formulaire (cliquez sur le rectangle gris de la disposition de la fenêtre en dehors de tous les composants ajoutés) et sur l'onglet Événements, nous trouvons l'événement <b>OnKeyPress</b> .  En double-cliquant sur la valeur vide du gestionnaire d'événements, nous créons et attribuons une nouvelle procédure - le gestionnaire d'événements. <br><br>  8. Ajoutez quelques lignes de code à la nouvelle procédure. <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  À la suite de ces actions, la déclaration de classe devrait ressembler à ceci: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Et les nouvelles procédures - les gestionnaires d'événements <b>OnTimer</b> et <b>OnKeyPress</b> devraient ressembler à ceci: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Après avoir compilé et exécuté l'application, vous pouvez déplacer l'oiseau Phoenix sur l'écran à l'aide des touches «a», «w», «s», «d» et l'arrêter avec la barre d'espace. <br><br><h6>  Nous utilisons différentes projections du sprite </h6><br>  Ajoutez le code suivant à la fin de la procédure <b>TFormMain.FormKeyPress</b> <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  La modification de la propriété <b>OffsetY en</b> fonction du vecteur de déplacement entraîne la rotation de l'image dans le sens du mouvement. <br><br><div class="spoiler">  <b class="spoiler_title">Tout le texte du module UnitMain</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre></div></div><br><h6>  Au lieu d'une postface </h6><br>  Cet exemple simple ne revendique pas des cotes élevées de vitesse ou de convivialité.  Si quelqu'un, comme dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent</a> , veut dire dans les commentaires que l'animation doit être mal faite - bienvenue, écrivez votre article.  Et le sujet de cet article est de savoir comment créer une animation sur plusieurs lignes de code, sans utiliser de bibliothèques spéciales, pratiquement "à genoux".  Cette méthode a été testée dans la pratique, elle fonctionne vraiment, donc avant de critiquer et de «moins», veuillez relire en quoi consiste cet article et pourquoi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439732/">https://habr.com/ru/post/fr439732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439722/index.html">Effets des filtres SVG. Partie 2. Décrire le texte avec feMorphology</a></li>
<li><a href="../fr439724/index.html">Aperçu des solutions AI et ML en 2018 et prévisions pour 2019: Partie 2 - Outils et bibliothèques, AutoML, RL, éthique en IA</a></li>
<li><a href="../fr439726/index.html">Lock-in: vrai ou fiction?</a></li>
<li><a href="../fr439728/index.html">Configurer la sauvegarde et la restauration Zimbra OSE complètes et séparées sans utiliser Zextras</a></li>
<li><a href="../fr439730/index.html">Organisation du réducteur à travers une classe standard</a></li>
<li><a href="../fr439734/index.html">Déployer Kubernetes sur le bureau en quelques minutes avec MicroK8s</a></li>
<li><a href="../fr439736/index.html">Connexion VPN IPSec entre MikroTik et Kerio Control</a></li>
<li><a href="../fr439738/index.html">A la recherche du bouton "Bien faire". Zyxel dans le réseau des petites et moyennes entreprises</a></li>
<li><a href="../fr439742/index.html">Admission au programme Master JetBrains à l'Université ITMO</a></li>
<li><a href="../fr439744/index.html">Des chercheurs du MIT ont conçu une «rectenne» qui convertit les signaux Wi-Fi en électricité</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>