<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì´ ü§úüèΩ üòè Consecuencias de reescribir los componentes de Firefox en Rust ü§≤ üöµüèæ üë®‚Äçüë©‚Äçüëß‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En art√≠culos anteriores de la serie, discutimos la seguridad de la memoria y la seguridad de los hilos en Rust. En este √∫ltimo art√≠culo, veremos las i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Consecuencias de reescribir los componentes de Firefox en Rust</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445670/">  <i>En art√≠culos anteriores de la serie, discutimos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">seguridad de la</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">memoria</a> y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">seguridad de los hilos</a> en Rust.</i>  <i>En este √∫ltimo art√≠culo, veremos las implicaciones de una aplicaci√≥n Rust real usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el proyecto Quantum CSS</a> .</i> <br><br>  El motor CSS aplica reglas CSS a la p√°gina.  Este es un proceso descendente que desciende el √°rbol DOM, despu√©s de calcular el CSS principal, los estilos secundarios se pueden calcular de forma independiente: ideal para la computaci√≥n paralela.  Para 2017, Mozilla hizo dos intentos de paralelizar el sistema de estilo usando C ++.  Ambos fallaron. <br><br>  El desarrollo cu√°ntico de CSS ha comenzado a aumentar la productividad.  Mejorar la seguridad es solo un buen efecto secundario. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb1/391/190/fb139119031a0bf7077a9b5dd8381b77.jpg"></div><a name="habracut"></a><br>  Existe una cierta conexi√≥n entre la protecci√≥n de la memoria y los errores de seguridad de la informaci√≥n.  Por lo tanto, esper√°bamos que el uso de Rust redujera la superficie de ataque en Firefox.  Este art√≠culo analizar√° las vulnerabilidades potenciales que se han identificado en el motor CSS desde el lanzamiento inicial de Firefox en 2002.  Luego mira lo que podr√≠a y no pudo haberse evitado con Rust. <br><br>  Para siempre, se han detectado 69 errores de seguridad en el componente CSS de Firefox.  Si tuvi√©ramos una m√°quina del tiempo y pudi√©ramos escribir Rust desde el principio, entonces 51 (73.9%) errores ser√≠an imposibles.  Aunque Rust facilita la escritura de un buen c√≥digo, tampoco ofrece protecci√≥n absoluta. <br><br><h1>  Herrumbre </h1><br>  Rust es un lenguaje de programaci√≥n de sistema moderno que es seguro para los tipos y la memoria.  Como efecto secundario de estas garant√≠as de seguridad, los programas Rust tambi√©n son seguros para subprocesos en tiempo de compilaci√≥n.  Por lo tanto, Rust es particularmente adecuado para: <br><br><ul><li>  procesamiento seguro de datos entrantes poco confiables; <br></li><li>  concurrencia para mejorar el rendimiento; <br></li><li>  integraci√≥n de componentes individuales en la base de c√≥digo existente. </li></ul><br>  Sin embargo, Rust no corrige expl√≠citamente algunas clases de error, especialmente los errores de correcci√≥n.  De hecho, cuando nuestros ingenieros reescribieron Quantum CSS, repitieron accidentalmente un error de seguridad cr√≠tico, que anteriormente se solucion√≥ en c√≥digo C ++, eliminaron accidentalmente la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">correcci√≥n de errores 641731</a> , que permite la filtraci√≥n de la historia global a trav√©s de SVG.  El error se volvi√≥ a registrar como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">error 1420001</a> .  Una fuga en el historial se considera una vulnerabilidad de seguridad cr√≠tica.  La soluci√≥n inicial fue una verificaci√≥n adicional para ver si el documento SVG es una imagen.  Desafortunadamente, esta verificaci√≥n se perdi√≥ al reescribir el c√≥digo. <br><br>  Aunque las pruebas automatizadas deber√≠an encontrar violaciones de la regla <code>:visited</code> esta manera, en la pr√°ctica no encontraron este error.  Para acelerar las pruebas autom√°ticas, deshabilitamos temporalmente el mecanismo que prob√≥ esta caracter√≠stica; las pruebas no son particularmente √∫tiles si no se realizan.  El riesgo de volver a implementar errores l√≥gicos se puede reducir con una buena cobertura de prueba.  Pero todav√≠a existe el peligro de nuevos errores l√≥gicos. <br><br>  A medida que un desarrollador se familiariza con Rust, su c√≥digo se vuelve a√∫n m√°s seguro.  Aunque Rust no previene todas las vulnerabilidades posibles, corrige toda una clase de los errores m√°s graves. <br><br><h1>  Errores de seguridad CSS cu√°nticos </h1><br>  En general, de forma predeterminada, Rust evita errores relacionados con la memoria, l√≠mites, variables nulas / no inicializadas y desbordamientos de enteros.  El error no est√°ndar mencionado anteriormente sigue siendo posible: se produce un bloqueo debido a una asignaci√≥n de memoria fallida. <br><br><h3>  Errores de seguridad por categor√≠a </h3><br><blockquote><ul><li>  Memoria: 32 <br></li><li>  Fronteras: 12 <br></li><li>  Implementaci√≥n: 12 <br></li><li>  Nulo: 7 <br></li><li>  Desbordamiento de pila: 3 <br></li><li>  Desbordamiento de enteros: 2 <br></li><li>  Otro: 1 </li></ul></blockquote>  En nuestro an√°lisis, todos los errores est√°n relacionados con la seguridad, pero solo 43 recibieron una calificaci√≥n oficial (es asignada por los ingenieros de seguridad de Mozilla con base en suposiciones calificadas sobre "explotabilidad").  Los errores comunes pueden indicar funciones faltantes o alg√∫n tipo de mal funcionamiento, lo que no necesariamente conduce a la fuga de datos o al cambio de comportamiento.  Los errores de seguridad oficiales var√≠an desde baja importancia (si hay una fuerte restricci√≥n en la superficie de ataque) hasta vulnerabilidad cr√≠tica (puede permitir que un atacante ejecute c√≥digo arbitrario en la plataforma del usuario). <br><br>  Las vulnerabilidades de memoria a menudo se clasifican como problemas de seguridad graves.  De los 34 problemas cr√≠ticos / graves, 32 estaban relacionados con la memoria. <br><br><h3>  Distribuci√≥n de gravedad de errores de seguridad. </h3><br><blockquote><ul><li>  Total: 70 <br></li><li>  Errores de seguridad: 43 <br></li><li>  Cr√≠tico / grave: 34 <br></li><li>  √ìxido fijo: 32 </li></ul></blockquote><h1>  Comparaci√≥n de √≥xido y C ++ </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Error 955913</a> : desbordamiento del b√∫fer de almacenamiento din√°mico en la funci√≥n <code>GetCustomPropertyNameAt</code> .  El c√≥digo utiliz√≥ la variable incorrecta para la indexaci√≥n, lo que condujo a la interpretaci√≥n de la memoria despu√©s del final de la matriz.  Esto puede provocar un bloqueo al acceder a un puntero incorrecto o al copiar memoria en una cadena que se pasa a otro componente. <br><br>  El orden de todas las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">propiedades CSS</a> (incluidas las personalizadas, es decir, personalizadas) se almacena en la matriz <code>mOrder</code> .  Cada elemento est√° representado por un valor de propiedad CSS o, en el caso de propiedades personalizadas, un valor que comienza con <code>eCSSProperty_COUNT</code> (n√∫mero total de propiedades CSS no personalizadas).  Para obtener el nombre de las propiedades personalizadas, primero debe obtener el valor de <code>mOrder</code> y luego acceder al nombre en el √≠ndice correspondiente de la matriz <code>mVariableOrder</code> , que almacena los nombres de las propiedades personalizadas en orden. <br><br><h3>  C√≥digo vulnerable de C ++: </h3><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCustomPropertyNameAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aIndex, nsAString&amp; aResult)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ MOZ_ASSERT(mOrder[aIndex] &gt;= eCSSProperty_COUNT); aResult.Truncate(); aResult.AppendLiteral(<span class="hljs-string"><span class="hljs-string">"var-"</span></span>); aResult.Append(mVariableOrder[aIndex]);</code> </pre> <br>  El problema ocurre en la l√≠nea 6 cuando se usa <code>aIndex</code> para acceder al elemento de la matriz <code>mVariableOrder</code> .  El hecho es que <code>aIndex</code> debe usarse con la matriz <code>mOrder</code> , no con la <code>mVariableOrder</code> .  El elemento correspondiente para la propiedad personalizada representada por <code>aIndex</code> en <code>mOrder</code> es en realidad <code>mOrder[aIndex] - eCSSProperty_COUNT</code> . <br><br><h3>  C√≥digo C ++ corregido: </h3><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> Get </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomPropertyNameAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aIndex, nsAString&amp; aResult)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ MOZ_ASSERT(mOrder[aIndex] &gt;= eCSSProperty_COUNT); <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> variableIndex = mOrder[aIndex] - eCSSProperty_COUNT; aResult.Truncate(); aResult.AppendLiteral(<span class="hljs-string"><span class="hljs-string">"var-"</span></span>); aResult.Append(mVariableOrder[variableIndex]); }</code> </pre> <br><h3>  C√≥digo de √≥xido correspondiente </h3><br>  Aunque Rust es algo similar a C ++, utiliza otras abstracciones y estructuras de datos.  El c√≥digo de √≥xido ser√° muy diferente de C ++ (ver m√°s abajo para m√°s detalles).  Primero, veamos qu√© sucede si el c√≥digo vulnerable se traduce lo m√°s literalmente posible: <br><br><pre> <code class="rust hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCustomPropertyNameAt</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, aIndex: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mOrder[aIndex] &gt;= <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.eCSSProperty_COUNT); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> result = <span class="hljs-string"><span class="hljs-string">"var-"</span></span>.to_string(); result += &amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mVariableOrder[aIndex]; result }</code> </pre> <br>  El compilador de Rust aceptar√° este c√≥digo porque la longitud de los vectores no se puede determinar antes de la ejecuci√≥n.  A diferencia de las matrices, cuya longitud debe conocerse, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tipo Vec</a> en Rust tiene un tama√±o din√°mico.  Sin embargo, la verificaci√≥n de l√≠mites est√° integrada en la implementaci√≥n del vector de biblioteca est√°ndar.  Si aparece un √≠ndice no v√°lido, el programa termina inmediatamente de manera controlada, evitando cualquier acceso no autorizado. <br><br>  El <a href="">c√≥digo real de</a> Quantum CSS utiliza estructuras de datos muy diferentes, por lo que no hay un equivalente exacto.  Por ejemplo, utilizamos las poderosas estructuras de datos integradas de Rust para unificar la disposici√≥n y los nombres de propiedad.  Esto elimina la necesidad de mantener dos matrices independientes.  Las estructuras de datos de √≥xido tambi√©n mejoran la encapsulaci√≥n de datos y reducen la probabilidad de tales errores l√≥gicos.  Dado que el c√≥digo debe interactuar con el c√≥digo C ++ en otras partes del navegador, la nueva funci√≥n <code>GetCustomPropertyNameAt</code> se parece al c√≥digo idiom√°tico de Rust.  Pero a√∫n ofrece todas las garant√≠as de seguridad, al tiempo que proporciona una abstracci√≥n m√°s comprensible de los datos subyacentes. <br><br><h1>  tl; dr </h1><br>  Debido a que las vulnerabilidades a menudo se asocian con infracciones de seguridad de la memoria, el c√≥digo Rust deber√≠a reducir significativamente la cantidad de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE</a> cr√≠ticos.  Pero incluso Rust no es perfecto.  Los desarrolladores a√∫n necesitan rastrear los errores de correcci√≥n y los ataques de fuga de datos.  El soporte para bibliotecas seguras a√∫n requiere revisiones de c√≥digo, pruebas y fuzzing. <br><br>  Los compiladores no pueden detectar todos los errores de programador.  Sin embargo, Rust nos quita la carga de seguridad de la memoria, lo que nos permite centrarnos en la correcci√≥n l√≥gica del c√≥digo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445670/">https://habr.com/ru/post/445670/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445652/index.html">Responsabilidades de los motores de b√∫squeda: c√≥mo "editar" una b√∫squeda en Rusia</a></li>
<li><a href="../445658/index.html">Historia de STAX: electrost√°ticos versus condiciones del mercado</a></li>
<li><a href="../445662/index.html">Tick-tock: se acab√≥ el tiempo del reloj inteligente, pero ahora fingen ser pulseras</a></li>
<li><a href="../445666/index.html">Necesitamos un junio listo: ens√©√±alo usted mismo o c√≥mo lanzamos un curso de seminarios para estudiantes</a></li>
<li><a href="../445668/index.html">Neoquest 2019: conexi√≥n con el cielo</a></li>
<li><a href="../445672/index.html">Cat√°lisis de muones en t√©rminos de qu√≠mica cu√°ntica. Parte II: electr√≥nica vs. enlace qu√≠mico mu√≥n</a></li>
<li><a href="../445674/index.html">PVS-Studio para Java sale a la carretera. La siguiente parada es Elasticsearch</a></li>
<li><a href="../445676/index.html">Nuevo en Git 3: cierres</a></li>
<li><a href="../445678/index.html">4. Check Point Getting Started R80.20. Instalaci√≥n e inicializaci√≥n</a></li>
<li><a href="../445680/index.html">Nueva caracter√≠stica en Git 3: cierres</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>