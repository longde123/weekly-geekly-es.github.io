<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüöí üë®‚Äçüë¶‚Äçüë¶ üî™ Citymobil - un guide pour les startups pour augmenter la stabilit√© en pleine croissance. Partie 2. Quels sont les types d'accidents? ‚òùüèº üî∑ ü§πüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ceci est le deuxi√®me article d'une s√©rie sur la fa√ßon dont nous, chez Citymobil, avons augment√© la stabilit√© du service (vous pouvez lire le premier i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Citymobil - un guide pour les startups pour augmenter la stabilit√© en pleine croissance. Partie 2. Quels sont les types d'accidents?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/445704/"><img src="https://habrastorage.org/getpro/habr/post_images/61f/db5/50d/61fdb550d3b183fa7f134339397e276f.png"><br><br>  Ceci est le deuxi√®me article d'une s√©rie sur la fa√ßon dont nous, chez Citymobil, avons augment√© la stabilit√© du service (vous pouvez lire le premier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ).  Dans cet article, je vais approfondir les sp√©cificit√©s de l'analyse des accidents.  Mais avant cela, je vais couvrir un point que je devais penser √† l'avance et couvrir dans le premier article, mais je n'y ai pas pens√©.  Et dont j'ai appris des retours des lecteurs.  Le deuxi√®me article me donne une chance d'√©liminer ce d√©faut g√™nant. <br><a name="habracut"></a><br><h2>  0. Prologue </h2><br>  Un des lecteurs a pos√© une question tr√®s juste: "Qu'est-ce qui est difficile dans le backend d'un service de taxi?"  La question est bonne.  Je me suis pos√© la question l'√©t√© dernier avant de commencer √† travailler chez Citymobil.  J'ai alors pens√© "pensez, un taxi, une application √† trois boutons".  Qu'est-ce qui pourrait √™tre compliqu√©?  Mais il s'est av√©r√© qu'il s'agit d'un service de tr√®s haute technologie et d'un produit complexe.  Afin au moins de pr√©ciser de quoi il s'agit et de ce qu'il s'agit vraiment d'un grand colosse technologique, je vais vous parler de plusieurs domaines d'activit√©s de Citymobil: <br><br><ul><li>  Tarification.  L'√©quipe de tarification traite les probl√®mes de prix √† tout moment et √† tout moment.  Le prix est d√©termin√© en pr√©disant l'√©quilibre de l'offre et de la demande sur la base de statistiques et d'autres donn√©es.  Tout cela fait un service vaste, complexe et en constante √©volution bas√© sur l'apprentissage automatique. </li><li>  Tarification.  La mise en place de diff√©rents modes de paiement, la logique des surtaxes apr√®s le voyage, la retenue des fonds sur les cartes bancaires, la facturation, l'interaction avec les partenaires et les chauffeurs. </li><li>  Distribution des commandes.  √Ä quelle machine distribuer la commande client?  Par exemple, l'option de distribution pour la plus proche n'est pas la meilleure en termes d'augmentation du nombre de voyages.  Une option plus correcte consiste √† comparer les clients et les voitures de mani√®re √† maximiser le nombre de voyages, compte tenu de la probabilit√© d'annulation par ce client particulier dans ces conditions (car cela prend beaucoup de temps) et d'annulation ou de sabotage de la commande par ce conducteur (car cela prend trop de temps ou trop peu de temps). v√©rifier). </li><li>  Geo.  Tout ce qui concerne la recherche et la plus grande adresse, les points d'atterrissage, l'ajustement des d√©lais de livraison (nos partenaires, fournisseurs de cartes et embouteillages ne donnent pas toujours des informations pr√©cises sur l'ETA en tenant compte des embouteillages), l'am√©lioration de la pr√©cision du g√©ocodage direct et inverse, l'am√©lioration de la pr√©cision de la machine.  Il y a beaucoup de travail avec les donn√©es, beaucoup d'analyses, beaucoup de services bas√©s sur l'apprentissage automatique. </li><li>  Antifraud.  La diff√©rence de prix d'un voyage pour un passager et pour un chauffeur (par exemple, pour de courts trajets) cr√©e une incitation √©conomique pour les fraudeurs qui tentent de voler notre argent.  La lutte contre la fraude est quelque peu similaire √† la lutte contre le spam dans le service de messagerie - l'exhaustivit√© et l'exactitude sont importantes.  Il est n√©cessaire de bloquer le nombre maximum de fraudeurs (exhaustivit√©), mais les bons utilisateurs ne doivent pas √™tre confondus avec des fraudeurs (pr√©cision). </li><li>  Motivation des chauffeurs.  L'√©quipe de motivation des conducteurs est engag√©e dans le d√©veloppement de tout ce qui concerne l'augmentation de l'utilisation de notre plateforme par les conducteurs et la fid√©lisation des conducteurs en raison de diff√©rents types de motivation.  Par exemple, faites X voyages et obtenez un Y roubles suppl√©mentaires pour cela.  Ou achetez un poste pour Z roubles et roulez sans commission. </li><li> Application de pilote backend.  Une liste de commandes, une carte de la demande (une indication o√π aller au chauffeur pour maximiser vos revenus), les changements de statut de Prokidyvaniya, un syst√®me de communication avec les chauffeurs et bien plus encore. </li><li>  Application client backend (c'est probablement la partie la plus √©vidente, et ce qui est g√©n√©ralement compris comme un backend de taxi): passer des commandes, faire d√©filer les statuts pour changer le statut de la commande, assurer le mouvement des voitures sur la carte sur la commande et √† la livraison, des conseils sur le backend et etc. </li></ul><br>  Ce n'est l√† que la pointe de l'iceberg.  La fonctionnalit√© est bien plus.  L'interface conviviale cache une √©norme partie sous-marine de l'iceberg. <br><br>  Et maintenant, revenons aux accidents.  Au cours des six mois de l'histoire des accidents, nous avons compil√© la cat√©gorisation suivante: <br><br><ul><li>  mauvaise version, 500e erreurs; </li><li>  mauvaise version, code sous-optimal, charge sur la base; </li><li>  intervention manuelle infructueuse dans le syst√®me; </li><li>  ≈ìuf de P√¢ques; </li><li>  causes externes; </li><li>  mauvaise version, fonctionnalit√© cass√©e. </li></ul><br>  Ci-dessous, je noterai les conclusions que nous avons tir√©es sur les types d'accidents les plus courants. <br><br><h2>  1. Mauvaise version, 500e erreurs </h2><br>  Presque tout notre backend est √©crit en PHP, un langage interpr√©t√© avec un typage faible.  Il arrive que vous d√©ployiez le code et qu'il se bloque en raison d'une erreur dans le nom de la classe ou de la fonction.  Et ce n'est qu'un exemple lorsque la 500e erreur appara√Æt.  Il peut √©galement appara√Ætre en cas d'erreur logique dans le code;  l√©ch√© la mauvaise branche;  accidentellement supprim√© le dossier avec le code;  laiss√© dans le code des artefacts temporaires n√©cessaires pour les tests;  n'a pas modifi√© la structure des tableaux conform√©ment au nouveau code;  n'a pas red√©marr√© ni arr√™t√© les scripts cron n√©cessaires. <br><br>  Nous avons lutt√© avec ce probl√®me s√©quentiellement en plusieurs √©tapes.  Les d√©placements perdus en raison d'une mauvaise lib√©ration sont √©videmment proportionnels √† la dur√©e d'utilisation.  C'est-√†-dire que nous devons faire de notre mieux pour nous assurer qu'une lib√©ration m√©diocre fonctionne le moins possible.  Tout changement dans le processus de d√©veloppement qui r√©duit le temps moyen n√©cessaire √† la mise en service d'une mauvaise version d'au moins 1 seconde est positif pour l'entreprise et doit √™tre mis en ≈ìuvre. <br><br>  Une mauvaise version ou tout accident de production passe g√©n√©ralement par deux √©tats, que nous avons appel√©s ¬´stade passif¬ª et ¬´stade actif¬ª.  La phase passive est celle o√π nous ne sommes pas encore au courant de l'accident.  La phase active est lorsque nous sommes d√©j√† au courant.  L'accident commence au stade passif, et au fil du temps, lorsque nous le d√©couvrons, l'accident passe au stade actif - nous commen√ßons √† le combattre: nous le diagnostiquons d'abord, puis le r√©parons. <br><br>  Pour r√©duire la dur√©e de tout accident de production, il est n√©cessaire de r√©duire la dur√©e moyenne des phases passive et active.  Il en va de m√™me pour une mauvaise version, car c'est en soi une sorte d'accident. <br><br>  Nous avons commenc√© √† analyser notre processus actuel de r√©paration des accidents.  Les mauvaises rejets que nous avons rencontr√©s au moment du d√©but de l'analyse ont entra√Æn√© une moyenne (totale ou partielle) inactive de 20 √† 25 minutes.  La phase passive prenait g√©n√©ralement 15 minutes, la phase active 10 minutes.  Pendant la phase passive, les plaintes des utilisateurs ont commenc√© √† √™tre trait√©es par le centre de contact, et apr√®s un certain seuil, le centre de contact s'est plaint des conversations g√©n√©rales dans Slack.  Parfois, l'un des employ√©s se plaignait de ne pas pouvoir commander un taxi.  Une plainte des employ√©s nous a signal√© un probl√®me grave.  Apr√®s la transition d'une mauvaise version √† la phase active, nous avons commenc√© √† diagnostiquer le probl√®me, analys√© les derni√®res versions, divers graphiques et journaux pour d√©terminer la cause de l'accident.  Apr√®s avoir d√©couvert la raison, nous avons annul√© le code si la mauvaise version a √©t√© pomp√©e en dernier, ou avons effectu√© une nouvelle restauration avec un reverse commit de mauvaise version. <br><br>  Voici un processus pour g√©rer les mauvaises versions, nous avons d√ª nous am√©liorer. <br><br><h3>  1.1.  R√©duction du stade passif </h3><br>  Tout d'abord, nous avons remarqu√© que si une mauvaise version s'accompagne de 500 erreurs, nous pouvons comprendre sans se plaindre qu'un probl√®me est survenu.  Heureusement, toutes les 500e erreurs ont √©t√© enregistr√©es dans New Relic (c'est l'un des syst√®mes de surveillance que nous utilisons), et il ne restait plus qu'√† visser les notifications SMS et IVR sur le d√©passement d'une certaine fr√©quence de ¬´cinq cents¬ª (au fil du temps, le seuil a √©t√© constamment r√©duit). <br><br>  Cela a conduit au fait que la phase active de l'accident telle que "Mauvaise lib√©ration, 500√®me erreur" a commenc√© presque imm√©diatement apr√®s la lib√©ration.  Le processus en cas d'accident a commenc√© √† ressembler √† ceci: <br><br><ol><li>  Le programmeur d√©ploie le code. </li><li>  La lib√©ration conduit √† un accident (500s massives). </li><li>  SMS arrive. </li><li>  Les programmeurs et les administrateurs commencent √† comprendre (parfois pas imm√©diatement, mais apr√®s 2-3 minutes: les SMS peuvent √™tre retard√©s, le son du t√©l√©phone peut √™tre d√©sactiv√© et la culture des actions imm√©diates apr√®s les SMS ne peut pas appara√Ætre en une journ√©e). </li><li>  La phase active de l'accident commence, qui dure les m√™mes 10 minutes qu'avant. </li></ol><br>  Ainsi, la phase passive est pass√©e de 15 minutes √† 3. <br><br><h3>  1.2.  R√©duction suppl√©mentaire de la phase passive </h3><br>  Malgr√© la r√©duction de la phase passive √† 3 minutes, m√™me une phase passive aussi courte nous d√©rangeait plus que la phase active, car pendant la phase active, nous faisons d√©j√† quelque chose pour r√©soudre le probl√®me, et pendant la phase passive, le service ne fonctionne pas en tout ou en partie, mais ¬´ les hommes ne savent pas. " <br><br>  Pour r√©duire davantage la phase passive, nous avons d√©cid√© de sacrifier trois minutes de temps de d√©veloppement apr√®s chaque version.  L'id√©e √©tait tr√®s simple: vous d√©ployez le code et regardez New Relic, Sentry, Kibana pendant trois minutes pour voir s'il y a 500 erreurs.  D√®s que vous y voyez un probl√®me, vous supposez a priori qu'il est li√© √† votre code et vous commencez √† comprendre. <br><br>  Nous avons choisi trois minutes sur la base des statistiques: parfois des probl√®mes sont apparus sur les cartes avec un retard de 1-2 minutes, mais il n'y a jamais eu plus de trois minutes. <br><br>  Cette r√®gle a √©t√© enregistr√©e dans les choses √† faire et √† ne pas faire.  Au d√©but, cela n'a pas toujours √©t√© ex√©cut√©, mais progressivement les d√©veloppeurs se sont habitu√©s √† la r√®gle de l'hygi√®ne √©l√©mentaire: se brosser les dents le matin est √©galement une perte de temps, mais vous devez le faire. <br><br>  En cons√©quence, la phase passive a √©t√© r√©duite √† 1 minute (les horaires √©taient parfois encore en retard).  Comme une agr√©able surprise, cela a simultan√©ment r√©duit la phase active.  Apr√®s tout, le d√©veloppeur rencontre un probl√®me en bon √©tat et est pr√™t √† restaurer imm√©diatement son code.  Bien que cela n'aide pas toujours, car  le probl√®me aurait pu survenir en raison du code de quelqu'un d'autre qui √©tait d√©ploy√© en parall√®le.  Mais, n√©anmoins, la sc√®ne active a √©t√© r√©duite en moyenne √† 5 minutes. <br><br><h3>  1.3.  R√©duction suppl√©mentaire de la phase active </h3><br>  Plus ou moins satisfaits d'une minute de la phase passive, nous avons commenc√© √† penser √† une nouvelle r√©duction de la phase active.  Tout d'abord, nous avons pr√™t√© attention √† l'historique des probl√®mes (c'est la pierre angulaire de la construction de notre stabilit√©!) Et nous avons constat√© que dans de nombreux cas, nous ne r√©trogradons pas imm√©diatement parce que nous ne comprenons pas √† quelle version revenir, car il existe de nombreuses versions parall√®les.  Pour r√©soudre ce probl√®me, nous avons introduit la r√®gle suivante (et l'avons enregistr√©e dans les choses √† faire et √† ne pas faire): avant la sortie, vous √©crivez dans le chat dans Slack, ce pour quoi vous roulez et quoi, et en cas d'accident, vous √©crivez dans le chat "accident, ne roule pas!".  De plus, nous avons commenc√© √† signaler automatiquement par SMS les faits concernant la publication pour informer ceux qui n'entrent pas dans le chat. <br><br>  Cette r√®gle simple a fortement r√©duit le nombre de rejets d√©j√† lors d'accidents et r√©duit la phase active - de 5 minutes √† 3. <br><br><h3>  1.4.  Une r√©duction encore plus importante de la phase active </h3><br>  Malgr√© le fait que nous ayons averti dans le chat de toutes les versions et plantages, parfois des conditions de concurrence apparaissaient - l'une a √©crit sur la sortie, et l'autre d√©j√† d√©ploy√©e √† ce moment;  ou l'accident a commenc√©, ils ont √©crit √† ce sujet dans le chat, et quelqu'un vient de d√©ployer un nouveau code.  Ces circonstances ont allong√© le diagnostic.  Pour r√©soudre ce probl√®me, nous avons impl√©ment√© une interdiction automatique des versions parall√®les.  L'id√©e est tr√®s simple: apr√®s chaque version, le syst√®me CI / CD interdit √† tout le monde de se d√©ployer pendant les 5 prochaines minutes, √† l'exception de l'auteur de la derni√®re version (afin qu'il puisse rouler ou rouler le correctif si n√©cessaire) et plusieurs d√©veloppeurs particuli√®rement exp√©riment√©s (en cas d'urgence).  De plus, le syst√®me CI / CD interdit le d√©ploiement lors d'un accident (c'est-√†-dire du moment de la r√©ception de la notification du d√©but de l'accident au moment de la r√©ception de la notification de son ach√®vement). <br><br>  Ainsi, le processus est devenu comme ceci: le d√©veloppeur d√©ploie, surveille les graphiques pendant trois minutes, et ensuite pendant deux minutes de plus, personne ne peut rien d√©ployer.  En cas de probl√®me, le d√©veloppeur annule la version.  Cette r√®gle a radicalement simplifi√© le diagnostic et la dur√©e totale des stades actif et passif est pass√©e de 3 + 1 = 4 minutes √† 1 + 1 = 2 minutes. <br><br>  Mais deux minutes de l'accident, c'est beaucoup.  Par cons√©quent, nous avons continu√© d'optimiser le processus. <br><br><h3>  1.5.  D√©tection et restauration automatiques des collisions </h3><br>  Nous r√©fl√©chissons depuis longtemps √† la fa√ßon de r√©duire la dur√©e de l'accident d√ª √† de mauvaises rejets.  Ils ont m√™me essay√© de se forcer √† regarder dans <code>tail -f error_log | grep 500</code>  <code>tail -f error_log | grep 500</code> .  Mais finalement, ils se sont tous mis d'accord sur une solution automatique cardinale. <br><br>  En bref, il s'agit d'une restauration automatique.  Nous avons configur√© un serveur Web distinct, sur lequel nous avons charg√© 10 fois moins de charge de l'√©quilibreur que sur d'autres serveurs Web.  Chaque version a √©t√© automatiquement d√©ploy√©e par le syst√®me CI / CD sur ce serveur s√©par√© (nous l'avons appel√© pr√©prod, bien que, malgr√© son nom, la charge r√©elle des utilisateurs r√©els y soit all√©e).  Et puis l'automatisation a fait <code>tail -f error_log | grep 500</code>  <code>tail -f error_log | grep 500</code> .  Si aucune 500e erreur ne s'est produite en une minute, le CI / CD a d√©ploy√© le nouveau code en production.  Si des erreurs sont apparues, le syst√®me a imm√©diatement tout annul√©.  Dans le m√™me temps, au niveau de l'√©quilibreur, toutes les demandes trait√©es avec 500 erreurs sur le pr√©prod ont √©t√© dupliqu√©es sur l'un des serveurs de production. <br><br>  Cette mesure a r√©duit √† z√©ro l'effet des cinq centi√®mes rejets.  Dans le m√™me temps, en cas de bugs dans l'automatisation, nous n'avons pas annul√© la r√®gle pendant trois minutes pour surveiller les graphiques.  C'est tout sur les mauvaises versions et le 500e bogue.  Nous proc√©dons au prochain type d'accident. <br><br><h2>  2. Mauvaise version, code sous-optimal, charge de base </h2><br>  Je vais commencer tout de suite par un exemple concret d'un accident de ce type.  Nous avons d√©ploy√© l'optimisation: nous avons ajout√© <code>USE INDEX</code> √† la requ√™te SQL, lors du test de ces requ√™tes courtes acc√©l√©r√©es, comme en production, mais les requ√™tes longues ont ralenti.  Le ralentissement des longues requ√™tes n'a √©t√© observ√© qu'en production.  En cons√©quence, le flux de longues demandes a mis toute la base principale pendant une heure.  Nous avons bien compris comment fonctionne <code>USE INDEX</code> , l'avons d√©crit dans le fichier des choses √† faire et √† ne pas faire et avons mis les d√©veloppeurs en garde contre toute utilisation abusive.  Nous avons √©galement analys√© la requ√™te et r√©alis√© qu'elle renvoie principalement des donn√©es historiques, ce qui signifie qu'elle peut √™tre ex√©cut√©e sur une r√©plique distincte pour les requ√™tes historiques.  M√™me si cette r√©plique est sous charge, l'entreprise ne s'arr√™tera pas. <br><br>  Apr√®s cet incident, nous avons toujours rencontr√© des probl√®mes similaires et, √† un moment donn√©, nous avons d√©cid√© d'aborder le probl√®me de mani√®re syst√©matique.  Nous avons scann√© l'int√©gralit√© du code avec un peigne fr√©quent et effectu√© sur la r√©plique toutes les demandes qui peuvent y √™tre faites sans compromettre la qualit√© du service.  Dans le m√™me temps, nous avons divis√© les r√©pliques elles-m√™mes en fonction des niveaux de criticit√© afin que la chute de l'une d'entre elles n'arr√™te pas le service.  En cons√©quence, nous sommes arriv√©s √† une architecture qui a les bases suivantes: <br><br><ul><li>  base principale (pour les op√©rations d'√©criture et pour les requ√™tes qui sont supercritiques √† la fra√Æcheur des donn√©es); </li><li>  r√©plique de production (pour les requ√™tes courtes qui sont un peu moins critiques pour la fra√Æcheur des donn√©es); </li><li>  r√©plique pour le calcul des ratios de prix, le soi-disant prix de surtension.  Cette r√©plique peut accuser un retard de 30 √† 60 secondes - ce n'est pas critique, les coefficients ne changent pas si souvent, et si cette r√©plique tombe, le service ne s'arr√™tera pas, juste les prix ne correspondront pas tout √† fait √† l'√©quilibre entre l'offre et la demande; </li><li>  r√©plique pour le panneau d'administration des utilisateurs professionnels et le centre de contact (si elle tombe, l'activit√© principale ne augmentera pas, mais le support ne fonctionnera pas et nous ne pourrons pas afficher et modifier temporairement les param√®tres); </li><li>  de nombreuses r√©pliques pour l'analyse; </li><li>  Base de donn√©es MPP pour l'analyse lourde avec des tranches compl√®tes selon les donn√©es historiques. </li></ul><br>  Cette architecture nous a donn√© plus d'espace pour la croissance et a r√©duit le nombre de plantages d'un ordre de grandeur en raison de requ√™tes SQL sous-optimales.  Mais elle est encore loin d'√™tre id√©ale.  Pr√©voit de faire du sharding afin que vous puissiez mettre √† jour les mises √† jour et les suppressions, ainsi que de courtes requ√™tes supercritiques √† la fra√Æcheur de ces donn√©es.  La marge de s√©curit√© de MySQL n'est pas infinie.  Bient√¥t, nous aurons besoin d'artillerie lourde sous la forme d'un Tarantool.  √Ä ce sujet sera n√©cessaire dans les articles suivants! <br><br>  Au cours de l'essai avec du code et des requ√™tes non optimaux, nous avons r√©alis√© ce qui suit: il est pr√©f√©rable d'√©liminer toute non-optimalit√© avant la publication, et non apr√®s.  Cela r√©duit le risque d'accident et r√©duit le temps consacr√© par les d√©veloppeurs √† l'optimisation.  Parce que si le code a d√©j√† √©t√© t√©l√©charg√© et qu'il y a de nouvelles versions, il est beaucoup plus difficile √† optimiser.  En cons√©quence, nous avons introduit une v√©rification de code obligatoire pour l'optimalit√©.  Elle est men√©e par les d√©veloppeurs les plus exp√©riment√©s, en fait, nos forces sp√©ciales. <br><br>  De plus, nous avons commenc√© √† collecter chez do's &amp; don't's les meilleures m√©thodes d'optimisation de code qui fonctionnent dans nos r√©alit√©s, elles sont list√©es ci-dessous.  Veuillez ne pas percevoir ces pratiques comme une v√©rit√© absolue et n'essayez pas de les r√©p√©ter aveugl√©ment en vous-m√™mes.  Chaque m√©thode n'a de sens que pour une situation sp√©cifique et une entreprise sp√©cifique.  Ils sont donn√©s ici √† titre d'exemple, de sorte que les d√©tails soient clairs: <br><br><ul><li>  Si la requ√™te SQL ne d√©pend pas de l'utilisateur actuel (par exemple, une carte de demande pour les conducteurs indiquant les taux de trajets minimum et les coefficients pour les polygones), alors cette requ√™te doit √™tre effectu√©e par cron avec une certaine fr√©quence (dans notre cas, une fois par minute suffit).  √âcrivez le r√©sultat dans le cache (Memcached ou Redis), qui est d√©j√† utilis√© dans le code de production. </li><li>  Si la requ√™te SQL fonctionne avec des donn√©es dont le backlog n'est pas critique pour l'entreprise, son r√©sultat doit √™tre mis en cache avec du TTL (par exemple, 30 secondes).  Et puis dans les requ√™tes suivantes lues dans le cache. </li><li>  Si dans le cadre du traitement d'une requ√™te sur le web (dans notre cas, dans le cadre de l'impl√©mentation d'une m√©thode serveur sp√©cifique en PHP) vous souhaitez effectuer une requ√™te SQL, vous devez vous assurer que ces donn√©es ne sont pas ¬´arriv√©es¬ª avec une autre requ√™te SQL (et s'ils viendront plus loin par code).  La m√™me chose s'applique √† l'acc√®s au cache: il peut √©galement √™tre inond√© de demandes si vous le souhaitez, donc si les donn√©es sont d√©j√† "arriv√©es" du cache, alors vous n'avez pas besoin d'aller dans le cache comme chez vous et d'en prendre, qui est d√©j√† emport√©. </li><li>  Si, dans le contexte du traitement des requ√™tes sur le Web, vous souhaitez appeler n'importe quelle fonction, vous devez vous assurer qu'aucune requ√™te SQL suppl√©mentaire ou acc√®s au cache ne sera effectu√©e dans ses abats.  Si l'appel d'une telle fonction est in√©vitable, vous devez vous assurer qu'elle ne peut pas √™tre modifi√©e ou sa logique rompue afin de ne pas faire de requ√™tes inutiles aux bases de donn√©es / caches. </li><li>  Si vous devez toujours entrer dans SQL, vous devez vous assurer que vous ne pouvez pas ajouter les champs n√©cessaires plus haut ou plus bas dans le code aux requ√™tes qui existent d√©j√† dans le code. </li></ul><br><h2>  3. Intervention manuelle infructueuse dans le syst√®me </h2><br>  Exemples de tels accidents: un ALTER infructueux (qui a surcharg√© la base de donn√©es ou provoqu√© un d√©calage de r√©plique) ou DROP infructueux (a rencontr√© un bogue dans MySQL, a bloqu√© la base de donn√©es lorsqu'une nouvelle table a √©t√© supprim√©e);  lourde demande de ma√Ætre faite par erreur √† la main;  Nous avons effectu√© un travail sur le serveur sous charge, bien que nous pensions qu'il √©tait sans travail. <br><br>  Pour minimiser les chutes pour ces raisons, il est malheureusement n√©cessaire de comprendre √† chaque fois la nature de l'accident.  Nous n'avons pas encore trouv√© la r√®gle g√©n√©rale.  Encore une fois, essayez les exemples.  Disons qu'√† un moment donn√©, les coefficients de surtension ont cess√© de fonctionner (ils multiplient le prix du voyage au lieu et au moment de l'augmentation de la demande).  La raison en √©tait que sur la r√©plique de la base de donn√©es, d'o√π provenaient les donn√©es de calcul des coefficients, le script Python fonctionnait, qui consommait toute la m√©moire, et la r√©plique √©tait en panne.  Le script fonctionne depuis longtemps, il a fonctionn√© sur une r√©plique juste pour plus de commodit√©.  Le probl√®me a √©t√© r√©solu en red√©marrant le script.  Les conclusions √©taient les suivantes: ne pas ex√©cuter de scripts tiers sur une machine avec une base de donn√©es (enregistr√©s dans les choses √† faire et √† ne pas faire, sinon c'est un plan vierge!), Surveiller la fin de la m√©moire sur une machine avec une r√©plique et alerter par SMS si la m√©moire est bient√¥t √©puis√©e. <br><br>  Il est tr√®s important de toujours tirer des conclusions et de ne pas se glisser dans une situation confortable "ils ont vu un probl√®me, l'ont corrig√© et l'ont oubli√©".  Un service de qualit√© ne peut √™tre construit que si des conclusions sont tir√©es.  De plus, les alertes SMS sont tr√®s importantes - elles placent la qualit√© de service √† un niveau sup√©rieur √† ce qu'elle a fait, l'emp√™chent de chuter et am√©liorent encore la fiabilit√©.  En tant que grimpeur de chaque √©tat stable, il se redresse et est fix√© dans un autre √©tat stable, mais √† une altitude plus √©lev√©e. <br><br>  La surveillance et l'alerte avec des crochets en fer invisibles mais rigides taillent dans la roche de l'incertitude et ne nous laissent jamais tomber en dessous du niveau de stabilit√© que nous avons fix√©, que nous √©levons constamment. <br><br><h2>  4. Oeuf de P√¢ques </h2><br>  Ce que nous appelons "l'≈ìuf de P√¢ques" est une bombe √† retardement qui existe depuis longtemps, mais que nous n'avons pas rencontr√©e.  En dehors de cet article, ce terme fait r√©f√©rence √† une fonctionnalit√© non document√©e faite expr√®s.  Dans notre cas, ce n'est pas du tout une fonctionnalit√©, mais plut√¥t un bug, mais qui fonctionne comme une bombe √† retardement et qui est un effet secondaire de bonnes intentions. <br><br>  Par exemple: d√©bordement 32 bits <code>auto_increment</code> ;  non-optimalit√© dans le code / configuration, "tir" en raison de la charge;  r√©plique en retard (g√©n√©ralement soit en raison d'une demande sous-optimale pour une r√©plique d√©clench√©e par un nouveau mod√®le d'utilisation, soit d'une charge plus √©lev√©e, soit en raison d'une mise √† jour sous-optimale sur le ma√Ætre qui a √©t√© appel√©e par un nouveau mod√®le de charge et a charg√© la r√©plique). <br><br>  Un autre type populaire d'oeuf de P√¢ques est le code non optimal, et plus pr√©cis√©ment, la requ√™te SQL non optimale.  Auparavant, la table √©tait plus petite et la charge moins importante - la requ√™te fonctionnait bien.  Et avec l'augmentation du tableau, lin√©aire dans le temps et la croissance de la charge, lin√©aire dans le temps, la consommation de ressources du SGBD a augment√© de fa√ßon quadratique.  Habituellement, cela conduit √† un effet n√©gatif marqu√©: tout √©tait ¬´ok¬ª et bang. <br><br>  Des sc√©narios plus rares sont une combinaison d'oeufs de bogue et de P√¢ques.  Une version avec un bogue a entra√Æn√© une augmentation de la taille de la table ou une augmentation du nombre d'enregistrements dans une table d'un certain type, et un ≈ìuf de P√¢ques d√©j√† existant a provoqu√© une charge excessive sur la base de donn√©es en raison de requ√™tes plus lentes sur cette table envahie. <br><br>  Cependant, nous avons √©galement eu des ≈ìufs de P√¢ques, sans rapport avec la charge.  Par exemple, <code>auto increment</code> 32 bits: apr√®s deux et quelques milliards d'enregistrements dans le tableau, les insertions cessent d'√™tre effectu√©es.  Le domaine de <code>auto increment</code> dans le monde moderne doit donc √™tre rendu 64 bits.  Nous avons bien appris cette le√ßon. <br><br>  Comment g√©rer les ≈ìufs de P√¢ques?  La r√©ponse est simple: a) recherchez les anciens "≈ìufs", et b) emp√™chez les nouveaux d'appara√Ætre.  Nous essayons de remplir les deux points.  La recherche d'anciens ¬´≈ìufs¬ª dans notre pays est associ√©e √† une optimisation constante du code.  Nous avons identifi√© deux des d√©veloppeurs les plus exp√©riment√©s pour l'optimisation presque √† plein temps.  Ils trouvent dans les requ√™tes slow.log qui consomment le plus de ressources de base de donn√©es, optimisent ces requ√™tes et le code qui les entoure.  Nous r√©duisons la probabilit√© de nouveaux ≈ìufs en v√©rifiant le code d'optimalit√© de chaque commit par le sensei rezrabotchiki susmentionn√©.  Leur t√¢che consiste √† signaler les erreurs qui affectent les performances;  vous dire comment faire mieux et transf√©rer les connaissances √† d'autres d√©veloppeurs. <br><br>  √Ä un certain moment apr√®s le prochain ≈ìuf de P√¢ques que nous avons trouv√©, nous avons r√©alis√© que la recherche de requ√™tes lentes est bonne, mais il serait utile de rechercher en outre des requ√™tes qui ressemblent √† lentes mais fonctionnent rapidement.  Ce ne sont que les prochains candidats pour tout mettre en cas de croissance explosive de la prochaine table. <br><br><h2>  5. Causes externes </h2><br>  Ce sont des raisons que nous pensons √™tre mal contr√¥l√©es par nous.  Par exemple: <br><br><ul><li>  Trot par Google Maps.  Vous pouvez le contourner en surveillant l'utilisation de ce service, en observant un certain niveau de charge sur celui-ci, en planifiant √† l'avance la croissance de la charge et en achetant l'extension du service. </li><li>  La chute du r√©seau dans le centre de donn√©es.  Vous pouvez vous d√©placer en pla√ßant une copie du service dans le centre de donn√©es de sauvegarde. </li><li>  Accident de service de paiement.  Vous pouvez contourner la r√©servation des services de paiement. </li><li>  Blocage du trafic erron√© par le service de protection DDoS.  Vous pouvez vous d√©placer en d√©sactivant le service de protection DDoS par d√©faut et en l'activant uniquement en cas d'attaque DDoS. </li></ul><br>  √âtant donn√© que l'√©limination d'une cause externe est une entreprise longue et co√ªteuse (par d√©finition), nous venons de commencer √† collecter des statistiques sur les accidents dus √† des causes externes et √† attendre l'accumulation de masse critique.  Il n'y a pas de recette pour d√©terminer la masse critique.  Cela fonctionne simplement par intuition.  Par exemple, si nous √©tions 5 fois en temps d'arr√™t complet en raison de probl√®mes, par exemple, du service de contr√¥le DDoS, √† chaque nouvelle baisse, cela deviendra de plus en plus aigu pour poser la question d'une alternative. <br><br>  D'un autre c√¥t√©, si vous pouvez en quelque sorte le faire fonctionner avec un service externe inaccessible, nous le faisons d√©finitivement.  Et cela nous aide √† effectuer une analyse post mortem de chaque chute.  Il doit toujours y avoir une conclusion.  Cela signifie que vous voulez toujours ne pas vouloir, mais vous pouvez trouver une solution de contournement. <br><br><h2>  6. Mauvaise version, fonctionnalit√© cass√©e </h2><br>  Il s'agit du type d'accident le plus d√©sagr√©able.  Le seul type d'accident qui n'est visible pour aucun sympt√¥me autre que les plaintes des utilisateurs / entreprises.  Par cons√©quent, un tel accident, surtout s'il n'est pas important, peut durer longtemps sans √™tre remarqu√©. <br><br>  Tous les autres types d'accidents s'apparentent plus ou moins √† ¬´mauvaise lib√©ration, 500e erreur¬ª.  C'est juste que le d√©clencheur n'est pas une version, mais une charge, une op√©ration manuelle ou un probl√®me du c√¥t√© d'un service externe. <br><br>  Pour d√©crire la m√©thode de traitement de ce type d'accident, rappelez-vous simplement la blague barbu: <br><br><blockquote>  Les math√©matiques et la physique se sont vu proposer la m√™me t√¢che: faire bouillir une bouilloire.  Des outils auxiliaires sont fournis: cuisini√®re, bouilloire, robinet d'eau avec de l'eau, allumettes.  Les deux versent de l'eau en alternance dans la bouilloire, ouvrent le gaz, l'allument et mettent le feu √† la bouilloire.  Ensuite, la t√¢che a √©t√© simplifi√©e: une bouilloire remplie d'eau et un po√™le √† gaz ont √©t√© propos√©s.  Le but est le m√™me - faire bouillir de l'eau.  Le physicien met le feu √† la bouilloire.  Le math√©maticien verse de l'eau de la bouilloire, coupe le gaz et dit: "La t√¢che a √©t√© r√©duite √† la pr√©c√©dente."  anekdotov.net </blockquote><br>  Ce type d'accident doit √™tre r√©duit par tous les moyens √† une ¬´mauvaise lib√©ration, 500e erreur¬ª.  Id√©alement, si des bogues dans le code √©taient enregistr√©s dans le journal comme une erreur.  Eh bien, ou du moins laiss√© des traces dans la base de donn√©es.  √Ä partir de ces traces, vous pouvez comprendre qu'un bogue s'est produit et alerter imm√©diatement.  Comment y contribuer?  Nous avons commenc√© √† analyser chaque bug majeur et √† proposer des solutions, quel type de surveillance / alerte SMS peut √™tre fait pour que ce bug se manifeste imm√©diatement de la m√™me mani√®re que la 500√®me erreur. <br><br><h3>  6.1.  Exemple </h3><br>  Les plaintes ont √©t√© massives: les commandes pay√©es via Apple Pay ne se ferment pas.  Ils ont commenc√© √† comprendre, le probl√®me s'est r√©p√©t√©.  Nous avons trouv√© la raison: nous avons am√©lior√© le format de <code>expire date</code> des cartes bancaires lors de l'interaction avec l'acquisition, √† la suite de quoi ils ont commenc√© √† le transf√©rer sp√©cifiquement pour les paiements via Apple Pay dans le format attendu du service de traitement des paiements (en fait, l'un est traitable, mutiler quelque chose d'autre), donc tous les paiements via Apple Pay ont commenc√© √† d√©cliner.  Rapidement corrig√©, d√©ploy√©, le probl√®me a disparu.  Mais ils "ont v√©cu" le probl√®me pendant 45 minutes. <br><br>  Suite aux traces de ce probl√®me, nous avons surveill√© le nombre de paiements √©chou√©s via Apple Pay, et √©galement effectu√© une alerte SMS / IVR avec un seuil non nul (car les paiements √©chou√©s sont la norme du point de vue du service, par exemple, le client n'a pas d'argent sur la carte ou la carte est bloqu√©e) .  A partir de ce moment, lorsque le seuil est d√©pass√©, nous apprenons instantan√©ment le probl√®me.  Si la nouvelle version introduit un probl√®me dans le traitement d'Apple Pay, ce qui entra√Ænera une inop√©rabilit√© du service, m√™me partielle, nous en apprendrons imm√©diatement la surveillance et annulons la version dans les trois minutes (il est d√©crit ci-dessus comment fonctionne le processus de roulement manuel).  C'√©tait 45 minutes de temps d'arr√™t partiel, c'est devenu 3 minutes.  B√©n√©fice <br><br><h3>  6.2.  Autres exemples </h3><br>  Nous avons d√©ploy√© l'optimisation de la liste des commandes propos√©es aux conducteurs.  Un bug s'est gliss√© dans le code.  En cons√©quence, les conducteurs dans certains cas n'ont pas vu la liste des commandes (elle √©tait vide).  Ils ont d√©couvert le bogue par accident - l'un des employ√©s a examin√© la demande du conducteur.  Recul rapidement.  En conclusion de l'accident, nous avons fait un graphique du nombre moyen de commandes dans la liste des pilotes selon la base de donn√©es, regard√© le graphique r√©troactivement pendant un mois, y avons vu un √©chec et fait une alerte SMS pour la requ√™te SQL, qui forme ce graphique lorsque le nombre moyen de commandes dans la liste sous le seuil s√©lectionn√© en fonction du minimum historique pour le mois. <br><br>  Modification de la logique de remboursement aux utilisateurs pour les voyages.  Y compris distribu√© au mauvais groupe d'utilisateurs.  Nous avons r√©solu le probl√®me, √©tabli un calendrier des remises en argent distribu√©es, y avons vu une forte augmentation, avons √©galement constat√© qu'il n'y avait jamais eu une telle croissance, avons lanc√© une alerte SMS. <br><br>  Avec la publication, la fonctionnalit√© de cl√¥ture des commandes a √©t√© rompue (la commande a √©t√© ferm√©e pour toujours, le paiement par carte n'a pas fonctionn√©, les chauffeurs ont exig√© le paiement en esp√®ces des clients).  Le probl√®me √©tait de 1,5 heure (total des √©tapes passives et actives).  Nous avons appris le probl√®me du centre de contact des plaintes.  Ils ont fait une correction, fait un suivi et des alertes sur l'heure de cl√¥ture des commandes avec des seuils trouv√©s √† partir de l'√©tude des graphiques historiques. <br><br>  Comme vous pouvez le constater, l'approche de ce type d'accident est toujours la m√™me: <br><br><ol><li>  D√©ployez la version. </li><li>  D√©couvrez le probl√®me. </li><li>  R√©parez-le. </li><li>  Nous d√©terminons par quelles traces (dans la base de donn√©es, les journaux, Kiban) vous pouvez trouver les signes du probl√®me. </li><li>  Nous tra√ßons ces signes. </li><li>  Nous le rembobinons dans le pass√© et regardons les explosions / chutes. </li><li>  Nous s√©lectionnons le seuil correct pour l'alerte. </li><li>  Lorsqu'un probl√®me survient √† nouveau, nous en prenons imm√©diatement connaissance gr√¢ce √† une alerte. </li></ol><br>  Ce qui est bien avec cette m√©thode: une √©norme classe de probl√®mes est ferm√©e imm√©diatement avec un graphique et une alerte (exemples de classes de probl√®mes: non-cl√¥ture des commandes, bonus suppl√©mentaires, non-paiement via Apple Pay, etc.). <br><br>  Au fil du temps, nous avons int√©gr√© les alertes de construction et la surveillance de chaque bug majeur dans la culture de d√©veloppement.  Pour √©viter que cette culture ne se perde, nous l'avons un peu formalis√©e.  Pour chaque accident, ils ont commenc√© √† exiger d'eux un rapport.  Un rapport est un formulaire rempli avec des r√©ponses aux questions suivantes: cause profonde, m√©thode d'√©limination, impact sur l'entreprise, conclusions.  Tous les articles sont obligatoires.  Par cons√©quent, si vous le souhaitez ou non, vous √©crirez les conclusions.  Ce changement de processus, bien s√ªr, a √©t√© √©crit par les choses √† faire et √† ne pas faire. <br><br><h2>  7. Kotan </h2><br>    ,     ,    -,        .  - (  ,  )   ¬´¬ª.   ¬´¬ª.  :-) <br><br>  ¬´¬ª   : <br><br>  .          ‚Äî ,      .       ,   (  ),    (     )     ,        .      ( ,      ). <br><br>  .  ,    .   ,     :  ‚Äî   ,   ‚Äî   . , ¬´ 500-  1 %¬ª ‚Äî  .  ¬´ 500-  1 %,   - , - ,  - ¬ª ‚Äî  .         ,      .          (     ).         ,     :  ,   ¬´¬ª,   ,   ,    ,  .     ‚Äî     .      (  ,      ).      . <br><br> .      .        ,     (   ,     ,       ),   ,       :  ,  ,   , . <br><br>  .    ,   ,       ( ,   ). <br><br><h2> 8.      ? </h2><br>       ‚Äî  .    .  :   ,    .          ,    ,   .      ,  ,      , ..    ‚Äî  ,      ‚Äî !      ,     .           ,    ,  ?    ,       , .. ,    ,  . <br><br>           .      .     (    ,   ),    ,           :  ,  ,     ,   .     ,    ,        .          .           .       -,      ,    .    ,   ,      ,     ‚Äî   :          . <br><br><h2> 9.   </h2><br>      ,           . <br><br><table><tbody><tr><th>  ? </th><th>  ? </th></tr><tr><td>    . <br></td><td>        . <br></td></tr><tr><td>    (    )   post-mortem. <br></td><td>       . <br></td></tr><tr><td>    do's &amp; dont's. <br></td><td>     ,       ,   . <br></td></tr><tr><td>   ,    5 . <br></td><td>      . <br></td></tr><tr><td>        ,    . <br></td><td>      . <br></td></tr><tr><td>    . <br></td><td>      . <br></td></tr><tr><td>      <br></td><td>   . <br></td></tr><tr><td>       . <br></td><td>   . <br></td></tr><tr><td>        . <br></td><td>    . <br></td></tr><tr><td> SMS/IVR-  . <br></td><td>    . <br></td></tr><tr><td>   ( )    . <br></td><td>    . <br></td></tr><tr><td>    . <br></td><td>     -   . <br></td></tr><tr><td>    (   ‚Äî slow.log). <br></td><td>     - ¬´ ¬ª. <br></td></tr><tr><td>     . <br></td><td>       . <br></td></tr><tr><td>     . <br></td><td>        . <br></td></tr><tr><td>          . <br></td><td>   ,      ,         . <br></td></tr><tr><td> ¬´¬ª ‚Äî     . <br></td><td>   ,   . <br></td></tr><tr><td>  . <br></td><td>    . <br></td></tr></tbody></table><br>  ,    !       , , ,   ,    ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445704/">https://habr.com/ru/post/fr445704/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445692/index.html">Pr√©sentation des fonctionnalit√©s de PlayCanvas pour la cr√©ation d'applications Web VR</a></li>
<li><a href="../fr445696/index.html">Comment sont cr√©√©s les robots qui peuvent aller o√π nous sommes</a></li>
<li><a href="../fr445698/index.html">Licence NanoCAD</a></li>
<li><a href="../fr445700/index.html">¬´33 mots sur le design¬ª: qui et pourquoi fait un film sur le design en Russie</a></li>
<li><a href="../fr445702/index.html">SlowPochta - messager de la livraison injustifi√©e de messages avec un temps de transmission ind√©fini</a></li>
<li><a href="../fr445706/index.html">Intel GPU SGX - Stockez vos donn√©es sur la carte graphique. Avec une garantie</a></li>
<li><a href="../fr445708/index.html">UICollectionView Around the Head: Changer les vues √† la vol√©e</a></li>
<li><a href="../fr445710/index.html">Gestion du climat en √©quipe</a></li>
<li><a href="../fr445712/index.html">Six r√®gles pour vous aider √† atteindre vos objectifs.</a></li>
<li><a href="../fr445714/index.html">Le programme final de DUMP-2019 est pr√™t. Nous nous rencontrons le 19 avril √† Iekaterinbourg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>