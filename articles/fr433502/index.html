<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïØÔ∏è üôèüèø üë®üèæ‚Äçüè´ Technologie audio sans fil Bluetooth: quelle est la meilleure? üòÇ üë®üèø‚Äçüöí üñïüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec le d√©veloppement de la technologie, les √©couteurs analogiques ¬´√† tube¬ª si familiers entrent dans l'histoire - ils sont de plus en plus supplant√©s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Technologie audio sans fil Bluetooth: quelle est la meilleure?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433502/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/_p/or/uz_por_7qlk9snfb7v_jg2x5iae.jpeg"></div><br>  Avec le d√©veloppement de la technologie, les √©couteurs analogiques ¬´√† tube¬ª si familiers entrent dans l'histoire - ils sont de plus en plus supplant√©s par leurs homologues sans fil Bluetooth. <br><br>  Les smartphones modernes sont priv√©s du connecteur habituel dans un souci de protection contre l'humidit√© et la poussi√®re. <br><br>  Les d√©veloppeurs publient toutes les nouvelles versions du protocole Bluetooth et toutes les nouvelles versions des codecs, promettant "plus vite, plus haut, plus fort" - moins de retards de lecture et une meilleure qualit√©. <br><br>  Est-ce que tout est si bon?  Voyons voir. <br><a name="habracut"></a><br><h2>  Pr√©sentation </h2><br>  Je ne m'√©tendrai pas sur la mise en ≈ìuvre technique des protocoles, ainsi que sur les sp√©cifications ennuyeuses.  Cher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS</a> , qui dans une large mesure a √©t√© une source d'inspiration et m√™me un consultant scientifique dans cet article, pr√©pare un mat√©riel complet sur les codecs - et tout y sera pr√©sent√© de mani√®re beaucoup plus d√©taill√©e et techniquement correcte. <br><br>  Je veux en dire plus sur l'exp√©rience personnelle.  Eh bien, un peu de pratique divertissante (ennuyeuse?). <br><br>  Il y a un an et demi, je me suis enthousiasm√© √† l'id√©e d'aptX.  Oui, j'ai lu beaucoup de critiques comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celle-ci</a> et j'ai cru √† tous ces rebondissements techniques.  Un enfant est n√© - et je voulais vraiment regarder des √©missions avec des √©couteurs la nuit avec ma femme, sans faire de bruit et sans r√©veiller personne dans la maison. <br><br>  Qu'est-ce que cela a donn√©? <br><br><h2>  La qualit√© </h2><br>  Commen√ßons par les chiffres et les faits (bonjour, Wikipedia!) <br><br>  <b>SBC</b> est un bon vieux codec, conforme √† la norme A2DP.  Le codec est le r√©sultat des travaux de Frans de Bont <i>(F. de Bont, M. Groenewegen et W. Oomen, ¬´A High Quality Audio-Coding System at 128 kb / s¬ª, 98th AES Convention, 25-28 f√©vrier 1995)</i> et de son utilisation les algorithmes d√©crits dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">brevet EP-0400755B1</a> .  Il est √† noter que les auteurs du brevet autorisent l'utilisation gratuite de SBC uniquement dans l'application Bluetooth, cependant, le brevet a expir√© le 2 juin 2010.  √âtant donn√© que la norme A2DP est tr√®s courante, il est extr√™mement difficile de trouver des √©couteurs ou des haut-parleurs qui ne prennent pas en charge SBC. <br><br>  Le codec fournit une fr√©quence d'√©chantillonnage de 16, 32, 44,1, 48 kHz avec un d√©bit de 10 √† 1500 kbit / s.  Oui, vous avez bien entendu.  Jusqu'√† 1500 kbps.  Il n'y a tout simplement pas de limite de d√©bit binaire dans le codec.  Mais plus √† ce sujet plus tard. <br><br>  Le codec <b>aptX a √©t√©</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©velopp√© en 1988 √† l'Universit√© Queen's de Belfast</a> .  Oui, avant Bluetooth, il y avait encore une douzaine d'ann√©es, donc le codec √©tait utilis√© dans les √©quipements audio professionnels.  Qualcomm d√©tient actuellement les droits, et donc l'utilisation n√©cessite des licences et des redevances.  En 2014, le co√ªt √©tait approximativement le suivant: un paiement unique de 6 000 $ et 1 $ each pour chaque appareil lib√©r√© pour les parties comptant jusqu'√† 10 000 appareils.  Pour cette raison, de nombreux appareils avec Snapdragon 835, 845, 821, 820, 810, 805, 801, 800, 650, 615, 410 sont tout √† fait possibles et prennent en charge aptX, mais il n'y est pas activ√©, car la licence n'a pas √©t√© achet√©e.  √Ä ce sujet - √©galement ci-dessous. <br><br>  Avec une profondeur de bits de 16 bits et une fr√©quence d'√©chantillonnage de 48 kHz, le codec peut fournir un d√©bit binaire de 384 kbit / s (double canal). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste des produits supportant officiellement aptX</a> .  Vous pouvez trouver beaucoup de syst√®mes inconnus avec le support aptX sur Aliexpress, mais soyez pr√™t pour le fait qu'il y aura en fait le m√™me bon vieux SBC - et pas plus. <br><br>  <b>aptX HD</b> - le m√™me codec, mais avec un profil d'encodage diff√©rent, a une vitesse de flux de 576 kbit / s, un support pour des fr√©quences d'√©chantillonnage jusqu'√† 48 kHz et une profondeur de bits jusqu'√† 24 bits.  Certaines personnes appellent ce codec aptX Lossless - mais cela n'a aucun sens, ne serait-ce que parce qu'il est impossible pour le moment d'obtenir la valeur d'un flux qui pourrait transporter des donn√©es sans perte.  Un avantage particulier de ce codec est un retard de codage r√©glable, qui peut √™tre r√©duit √† 1 ms √† une fr√©quence d'√©chantillonnage de 48 kHz.  En outre, le codec est extr√™mement avantageux du point de vue du chargement du processeur, ce qui exprime un avantage par rapport aux MP3 et AAS. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste des produits supportant officiellement aptX HD</a> .  Il est assez petit. <br><br>  <b>aptX Low latency</b> (ou LL) est une version sp√©ciale du codec qui vous permet de r√©duire le temps de retard du son √† moins de 40 ms.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste des produits supportant officiellement aptX LL</a> . <br><br><img src="https://habrastorage.org/webt/oz/nd/5q/oznd5qcoovjbj8f4xdtfydbl_ym.png" alt="image"><br><br>  Elle est l√†.  C'est cette photo qui √† un moment donn√© m'a achet√© avec des abats.  Retards!  Apr√®s tout, qui veut entendre le bruit d'une explosion dans un film d'action, le cri d'un monstre dans un film d'horreur ou le rugissement d'une foule lors d'un match de football quand tout est fini? <br><br>  Mais est-ce vraiment vrai? <br><br>  H√©las, non. <br><br>  Comme pour tout mat√©riel marketing, les chiffres sont farfelus.  Le retard d√©pend en grande partie de la mise en m√©moire tampon dans le syst√®me et la mise en ≈ìuvre du codec.  Ainsi, le retard avec SBC pourrait bien √™tre inf√©rieur √† 40 ms, ce qui, compte tenu des normes de diffusion t√©l√©visuelle (+40 ms ... -60 ms), est parfaitement acceptable. <br><br>  <u>En r√©sum√©:</u> <br><br><ol><li>  Aucun codec existant ne peut √™tre meilleur que la technologie filaire, car aucun codec ne peut atteindre une v√©ritable compression sans perte. </li><li>  Le codec le plus populaire est SBC.  Il est le plus flexible dans les param√®tres.  Et malgr√© le fait qu'aptX soit sorti plus t√¥t, il ne pouvait pas battre la popularit√© de SBC, apparemment parce que ce dernier √©tait gratuit. </li><li>  La qualit√© sonore d√©pend extr√™mement de la mise en ≈ìuvre du codec, ainsi que des performances mat√©rielles des √©couteurs / haut-parleurs en g√©n√©ral - si le haut-parleur lui-m√™me est faible, la qualit√© ne peut √™tre am√©lior√©e par aucun codec.  Par cons√©quent, √† l'avenir, en comparant la qualit√©, nous parlerons de la lecture du m√™me contenu √† partir de la m√™me source sur les m√™mes haut-parleurs / √©couteurs, mais avec des codecs diff√©rents. </li></ol><br><h2>  R√©sultats pratiques et tr√®s subjectifs </h2><br><img src="https://habrastorage.org/webt/fj/uf/kj/fjufkjmv-sxcezemnqcz3ztyue4.jpeg"><br><br>  Les informations sont bas√©es sur l'exp√©rience d'un an et demi d√©j√† mentionn√©e dans l'exploitation, la comparaison et l'attraction d'auditeurs ext√©rieurs. <br><br>  L'exp√©rience est bas√©e sur l'√©coute sans perte sur le lecteur SONY Walkman NWZ-A17, o√π le codec peut √™tre s√©lectionn√©, ainsi que sur la visualisation de divers programmes avec sortie audio via Avantree Priva III. <br><br>  Il y avait trois √©couteurs: Sennheiser PMX 60, Koss Porta Pro et Koss UR-20. <br><br>  Jabra BT3030 (SBC) et Avantree Clipper Pro (aptX) ont √©t√© utilis√©s comme r√©cepteurs de signaux sans fil. <br><br>  Un haut-parleur Voombox Outdoor (SBC) et un casque √† conduction osseuse Aftershokz Trekz Titanium (aptX) ont √©galement √©t√© utilis√©s. <br><br>  Tous les √©galiseurs et amplificateurs ont √©t√© d√©sactiv√©s - et c'est important. <br><br>  <u>Total:</u> <br><br><ol><li>  La qualit√© du son jou√© avec une connexion filaire est toujours meilleure.  C'est sans aucun doute. </li><li>  La diff√©rence entre SBC et aptX est extr√™mement difficile √† entendre - et seulement dans le cas de certains types de musique.  Par exemple, l'auteur de l'article a clairement entendu la diff√©rence dans les solos de violoncelle dans les compositions classiques, tandis que pour le violon et les instruments √† basse fr√©quence, la diff√©rence √©tait moins perceptible.  Dans les genres modernes - pop, musique √©lectronique et rock - la diff√©rence n'est pas entendue.  Dans certains cas, il semblait subjectivement que SBC transmet le son mieux qu'aptX. </li><li>  Le d√©lai entre SBC et aptX ne peut √™tre vu que si vous vous connectez √† la m√™me source et ins√©rez diff√©rents r√©cepteurs dans diff√©rentes oreilles (enfin, le canal gauche est SBC, et le droit est aptX, par exemple).  Il est presque impossible de voir le retard avec l'image, mais parce que l'histoire selon laquelle aptX est destin√© aux sc√®nes et au contenu dynamiques est un mythe. </li><li>  La surprise a √©t√© caus√©e par la qualit√© sonore de la Voombox Outdoor plut√¥t bon march√© et "peu c√©l√®bre".  Apparemment, c'est la mise en ≈ìuvre r√©ussie de SBC, qui a √©t√© mentionn√©e ci-dessus. </li><li>  La mise en ≈ìuvre d'aptX dans les √©couteurs √† conduction osseuse est totalement incompr√©hensible - la technologie est tr√®s sp√©cifique, et donc la perte de qualit√© est importante en raison de la technologie elle-m√™me.  Compte tenu de la petite plage de la ¬´plage¬ª de fonctionnement de l'appareil, de la mise en ≈ìuvre extr√™mement m√©diocre du couplage avec deux appareils, je peux dire qu'Aftershokz est une entreprise qui investit plus dans le marketing que dans le d√©veloppement. </li></ol><br><br>  Je ne dis pas que si vous connectez toutes sortes d‚Äôanalyseurs spectraux et ainsi de suite, vous pouvez et devez voir la diff√©rence.  Mais l'oreille humaine, et pire encore - l'oreille humaine moyenne - n'est pas un appareil spectral, et n'entend donc pas toutes ces nuances. <br><br><h2>  Pratique: fixer ce qui peut √™tre r√©par√© </h2><br><h3>  Partie 1. Activez aptX </h3><br>  Comme d√©j√† mentionn√©, dans certains appareils, l'utilisation d'aptX est d√©sactiv√©e, probablement afin d'√©viter les poursuites en mati√®re de brevets. <br><br>  Ce probl√®me peut √™tre r√©solu tout simplement en glissant le p√©riph√©rique de biblioth√®que pour impl√©menter le codec et en √©crivant la possibilit√© de travailler avec ce codec dans build.prop. <br><br>  Sur Internet, il existe un grand nombre de solutions de cette nature.  J'ai pris la libert√© de les combiner en un tout en le r√©alisant comme module pour Magisk.  Oui, j'aime vraiment ce projet et je pense que la mise en ≈ìuvre de modifications du syst√®me sous la forme de modules Magisk est une solution meilleure et plus s√ªre avec la possibilit√© de sauvegarder le syst√®me dans sa forme originale et de mani√®re simple √† restaurer. <br><br>  Le module peut √™tre t√©l√©charg√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Oui, je connais github.  Et non, jusqu'√† ce que j'aie le temps de le mettre l√†. <br><br>  Les entr√©es dans build.prop, y compris aptX et, si possible, aptX HD, seront √©mul√©es automatiquement par le module. <br><br><img src="https://habrastorage.org/webt/vg/lc/gu/vglcguyqsbbyxptonmhdw-5ta3y.png"><br><br><h3>  Partie 2. Augmentez le d√©bit binaire SBC </h3><br>  Comme indiqu√© pr√©c√©demment, le codec SBC n'a fondamentalement aucune restriction de d√©bit binaire.  Cependant, les fabricants fixent g√©n√©ralement une limite de 342 kbit / s pour le mono et de 345 kbit / s pour la st√©r√©o afin d'assurer un fonctionnement fiable avec tous les types d'appareils r√©cepteurs. <br><br>  Dans le m√™me temps, la sp√©cification A2DP v1.2, qui √©tait active de 2007 √† 2015, exige que tous les dispositifs de d√©codage fonctionnent correctement avec des d√©bits allant jusqu'√† 320 kbit / s en mono et 512 kbit / s dans le cas d'un signal st√©r√©o. <br><br>  Dans la nouvelle version de la sp√©cification, il n'y a aucune limite de d√©bit binaire.  Il est suppos√© que les √©couteurs modernes sortis apr√®s 2015 et prenant en charge EDR peuvent prendre en charge des d√©bits allant jusqu'√† 730 kbps. <br><br>  En fait, ce n'est certainement pas le cas.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans une √©tude approfondie</a> men√©e par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS</a> , il a √©t√© constat√© que presque tous les appareils r√©cepteurs fonctionnent de mani√®re fiable avec des d√©bits binaires de 454 kbit / s, et un nombre assez important avec un d√©bit binaire de 507 kbit / s. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans ses recherches,</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS a</a> √©galement montr√© que, contrairement √† la croyance populaire sur la qualit√© du codec aptX, il peut produire des r√©sultats pires sur certains fichiers que SBC avec un d√©bit binaire standard de 328 kbps, et le passage √† un SBC √† haut d√©bit produira un son qui d√©passe souvent aptX, sur n'importe quel casque. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Sur la base</a> de ces donn√©es, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS a</a> envoy√© des commentaires aux d√©veloppeurs de Lineage OS et de Google, mais jusqu'√† pr√©sent, il n'y a eu aucune r√©action. <br><br>  Ainsi, nous ne pouvons apporter que manuellement des modifications √† la pile Bluetooth. <br><br>  Nous avons besoin d'un IDA Pro avec la possibilit√© de d√©compiler ARM, n'importe quel √©diteur HEX (j'ai utilis√© WinHEX) et le fichier bluetooth.default.so de notre appareil.  Habituellement, il se trouve sur le chemin / system / lib / hw et moins souvent - √©galement sur le chemin / system / lib64 / hw (un acc√®s root est d√©finitivement n√©cessaire). <br><br>  Ouvrez donc le fichier bluetooth.default.so. Les op√©rations et modifications d√©crites ci-dessous s'appliquent uniquement √† la pile Android d'origine (bluedroid).  Si vous voyez la ligne ¬´Needed Library 'com.qualcomm.qti.bluetooth_audio@1.0.so'¬ª ou similaire dans IDA Pro, il est fort probable que cette instruction ne vous aidera pas. <br><br><img src="https://habrastorage.org/webt/cf/3l/jb/cf3ljbjgckew4pd9tbutsy-tyaw.png"><br><br>  Notre premi√®re t√¢che consiste √† remplacer Joint Stereo par Dual Channel dans une configuration standard. <br><br>  Nous travaillerons avec la <a href="">fonction bta_av_build_src_cfg</a> . <br><br>  Pour trouver cette proc√©dure dans l'IDA, nous allons utiliser la recherche de <a href="">ligne pour un message caract√©ristique dans le journal de d√©bogage "Cant parse src cap ret =% d"</a> : <br><br><img src="https://habrastorage.org/webt/wh/dk/ex/whdkexvibrxijvj7pqb-buzb0z8.png"><br><br><img src="https://habrastorage.org/webt/ea/2h/nh/ea2hnhbszbtyieokldywuch2qvi.png"><br><br>  En cons√©quence, nous trouvons assez rapidement la fonction elle-m√™me sous forme de code: <br><br><img src="https://habrastorage.org/webt/mf/5_/_9/mf5__9yydhgwip0lvemgqwcwocw.png"><br><br>  Notre t√¢che est de remplacer la structure d'origine des ch√®ques <br><br><pre><code class="plaintext hljs">if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_JOINT) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_JOINT; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;&lt;/code&gt;  &lt;code&gt; if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;</code> </pre> <br>  Il existe plusieurs fa√ßons de proc√©der. <br><br>  Le premier est le remplacement des instructions TST.W R0, # 1 avec TST.W R0, # 4 et MOVS R0, # 1 avec MOVS R0, # 4 dans la s√©quence de v√©rifications: <br><br><img src="https://habrastorage.org/webt/6e/zu/so/6ezusojttx0gavinlppmqeroet8.png"><br><br>  En bytecode, il s'agit du remplacement de x01 en x04.  Il est important de noter la s√©quence caract√©ristique d'octets par laquelle ce mod√®le peut √™tre trouv√©.  Sans entrer dans les d√©tails, je dirai que c'est essentiellement une recherche de s√©quence <br><br><pre> <code class="plaintext hljs">10 20 8D F8 04 00 9D F8 0D 00 10 F0 01 0F ?? ?? 10 F0 02 0F ?? ?? 10 F0 04 0F ?? ?? 10 F0 08 0F ?? ?? 08 20 ?? ?? 01 20 ?? ?? 02 20 ?? ?? 04 20</code> </pre> <br>  et son remplacement par <br><br><pre> <code class="plaintext hljs">?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ??</code> </pre> <br>  Cependant, cette m√©thode pr√©sente des inconv√©nients. <br><br>  Un certain nombre de compilateurs modifient la s√©quence d'ex√©cution des commandes en fonction de l'optimisation.  Et dans ce cas, il n'est pas possible de trouver le mod√®le souhait√©, et parfois le m√©canisme de v√©rification dans la structure est g√©n√©ralement introduit dans le code en ligne.  Par cons√©quent, il est plus fiable de modifier la constante <a href="">btif_av_sbc_default_config</a> . <br><br>  Pour commencer - trouvez-la.  Elle est au tout d√©but de notre fonction, car <br><br><pre> <code class="plaintext hljs">void bta_av_build_src_cfg (UINT8 *p_pref_cfg, UINT8 *p_src_cap) { tA2D_SBC_CIE src_cap; tA2D_SBC_CIE pref_cap; UINT8 status = 0; /* initialize it to default SBC configuration */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;btif_av_sbc_default_config, p_pref_cfg); /* now try to build a preferred one */ /* parse configuration */ if ((status = A2D_ParsSbcInfo(&amp;src_cap, p_src_cap, TRUE)) != 0) { APPL_TRACE_DEBUG(" Cant parse src cap ret = %d", status);</code> </pre> <br>  Et la voici: <br><br><img src="https://habrastorage.org/webt/xi/j2/dt/xij2dtvma0evlnggxkxzqxkvdn4.png"><br><br><img src="https://habrastorage.org/webt/7a/z9/36/7az936re6naesontslfi1ogkd5c.png"><br><br>  On peut voir que btif_av_sbc_default_config lui-m√™me est une s√©quence d'octets 20 01 10 04 01 35 02, tandis que le premier octet code la fr√©quence d'√©chantillonnage et peut √™tre 10 (48 kHz) et 20 (44 kHz), et donc non sp√©cifique.  Ainsi, notre t√¢che est de remplacer la s√©quence <br> <code>01 10 04 01 35 02</code> <br>  sur <br> <code>04 ?? ?? ?? ?? ??</code> <br> <br>  Cela vous permettra de changer la logique de la structure d'une mani√®re similaire, mais en m√™me temps, l'optimisation du compilateur ne posera pas de probl√®mes. <br><br>  Dans certains cas, les √©couteurs ou les haut-parleurs initient eux-m√™mes la connexion.  Dans ce cas, le mode est d√©termin√© par la fonction <a href="">bta_av_co_audio_init</a> . <br><br>  La fonction est <a href="">caract√©ris√©e par la ligne ¬´bta_av_co_audio_init:% d¬ª</a> et est facilement recherch√©e dans le code: <br><img src="https://habrastorage.org/webt/fi/5o/ku/fi5okug9tbn6gvleetxo93uk9qg.png"><br><br>  L'√©num√©ration des modes de connexion possibles est effectu√©e dans la commande suivante: <br><br><pre> <code class="plaintext hljs"> switch (index) { case BTIF_SV_AV_AA_SBC_INDEX: /* Set up for SBC codec for SRC*/ *p_codec_type = BTA_AV_CODEC_SBC; /* This should not fail because we are using constants for parameters */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;bta_av_co_sbc_caps, p_codec_info); /* Codec is valid */ return TRUE;</code> </pre> <br>  la <a href="">constante bta_av_co_sbc_caps a la structure suivante</a> : <br><br><pre> <code class="plaintext hljs">const tA2D_SBC_CIE bta_av_co_sbc_caps = { (A2D_SBC_IE_SAMP_FREQ_44), /* samp_freq */ (A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL), /* ch_mode */ (A2D_SBC_IE_BLOCKS_16 | A2D_SBC_IE_BLOCKS_12 | A2D_SBC_IE_BLOCKS_8 | A2D_SBC_IE_BLOCKS_4), /* block_len */ (A2D_SBC_IE_SUBBAND_4 | A2D_SBC_IE_SUBBAND_8), /* num_subbands */ (A2D_SBC_IE_ALLOC_MD_L | A2D_SBC_IE_ALLOC_MD_S), /* alloc_mthd */ BTA_AV_CO_SBC_MAX_BITPOOL, /* max_bitpool */ A2D_SBC_IE_MIN_BITPOOL /* min_bitpool */ };</code> </pre> <br>  La constante se retrouve facilement dans le code, dans mon cas c'est 20 0F F0 0C 03 35 02: <br><br><img src="https://habrastorage.org/webt/kj/hw/oi/kjhwoibpuk8brwa3kzvxiuxgeba.png"><br><br>  Faites attention √† l'octet <b>0F</b> - il offre la possibilit√© de se connecter √† l'un des modes valides, car <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL = x08 | x02 | x01 | x04</code> </pre> <br>  Notre t√¢che consiste √† modifier cette valeur comme suit: <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_DUAL = x04</code> </pre> <br>  Par cons√©quent, il est n√©cessaire de remplacer <br><br> <code>?? 0F F0 0C 03 35 02</code> <br>  sur <br> <code>?? 04 ?? ?? ?? ?? ??</code> <br> <br>  Nous avons donc forc√© la pile √† se connecter en mode Dual Channel √† la fois dans le cas de l'√©tablissement d'une connexion par le p√©riph√©rique et dans le cas de l'√©tablissement d'une connexion par le c√¥t√© r√©ception du signal. <br><br>  Vous devez maintenant supprimer les restrictions de d√©bit binaire ou augmenter son seuil sup√©rieur. <br><br>  Besoin de g√©rer <a href="">btif_media_task_get_sbc_rate</a> .  De m√™me, pour rechercher la <a href="">ligne caract√©ristique "non-edr a2dp sink d√©tect√©, limiter le taux √†% d", nous</a> recherchons la fonction dans le code: <br><img src="https://habrastorage.org/webt/kp/go/j2/kpgoj2xsq6vt8kbnexy81jy6j6s.png"><br><br>  La limite de d√©bit binaire est exprim√©e dans une cha√Æne <br>  D√©bit UINT16 = DEFAULT_SBC_BITRATE (qui √† son tour <a href="">est de 328 kbps</a> ) <br><br>  Dans le code, c'est comme √ßa: <br><br><img src="https://habrastorage.org/webt/tf/ba/bn/tfbabnrxfks3pejhzqzdegiwn04.png"><br><br>  Modifiez cette valeur √† 454 kbit / s - elle est sup√©rieure √† la norme et fonctionne avec la grande majorit√© des r√©cepteurs.  Pour ce faire, remplacez les octets <br><br> <code>B1 4F F4 A4 74 ?? E0</code> <br>  sur <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br> <br>  Vous devez √©galement rechercher par mod√®le. <br><br> <code>E0 4F F4 A4 74 ?? E0</code> <br>  et remplacez-le par <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br>  - Ceci est requis pour un certain nombre d'appareils. <br><br>  La valeur de E3 peut √™tre diff√©rente en fonction du d√©bit binaire maximum souhait√©: <br><br><ul><li>  E3 - 454 kbps </li><li>  F1 - 482 kbps </li><li>  F3 - 486 kbps </li><li>  10 √† 576 kbps </li><li>  48 - pas de limite </li></ul><br>  En g√©n√©ral, cela est d√©termin√© par le bytecode de l'op√©ration MOV.W R4, XXX. <br><br>  En pratique, il vaut la peine d'exp√©rimenter et de choisir la valeur maximale √† laquelle tous vos appareils r√©cepteurs re√ßoivent une r√©ception de signal stable, il n'y a pas de craquage, d'interruption ou de distorsion. <br><br>  Sur tous les r√©cepteurs de mon exp√©rience (je les ai indiqu√©s ci-dessus), cette valeur √©tait de 576 kbit / s, le t√©l√©phone Xiaomi Redmi 4x MIUI10 Android 7.1 √©tait la source du signal. <br><br>  Sur la base des actions d√©crites, un correctif g√©n√©rique a √©t√© cr√©√© qui trouve les mod√®les sp√©cifi√©s dans Bluetooth.default.so et les remplace?  y compris le mode Dual Channel forc√© et la d√©finition de la limite de d√©bit √† 454 kbps.  Si n√©cessaire, la valeur limite peut √™tre facilement modifi√©e en fonction de la recherche et du remplacement de l'octet correspondant - un lecteur attentif le fera sans difficult√©. <br><br>  Je souligne: le patch ne fonctionne que dans le cas de la pile bluedroid et ne r√©ussira probablement pas dans le cas de la pile Fluoride et d'Android version 8 et versions ult√©rieures. <br><br>  Le patch peut √™tre t√©l√©charg√© √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partir d'ici</a> . <br><br>  Il est fortement recommand√© de remplacer le fichier d'origine en tant que modules Magisk, pour moi, je l'ai fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme suit</a> .  <b>Veuillez noter</b> : ces modules ont √©t√© cr√©√©s par moi pour le t√©l√©phone Xiaomi Redmi 4x 3/32 Go avec le firmware MIUI 10 stable mondial actuel au moment de la r√©daction. Dans votre cas, le fichier bluetooth.default.so devra √™tre remplac√© par le v√¥tre, corrig√©, comme d√©crit ci-dessus.  Il est √©galement possible que le fichier doive √™tre dupliqu√© le long du chemin / syst√®me / lib64 / hw - cela d√©pend du mod√®le et de la version du firmware de votre t√©l√©phone. <br><br>  Cette approche utilisant des modules Magisk permet de changer facilement le d√©bit binaire maximum et g√©n√©ralement de d√©sactiver les modifications s'il s'av√®re que certains des appareils r√©cepteurs ne prennent pas en charge le double canal. <br><br><h2>  Conclusion </h2><br>  √Ä l'heure actuelle, dans la poursuite des ventes, de nombreuses entreprises pr√©sentent des innovations technologiques pour justifier un prix plus √©lev√©. <br><br>  Dans la pratique, il s'av√®re que les technologies existantes et moins ch√®res ne sont pas enti√®rement d√©velopp√©es et que les innovations technologiques ne sont pas pleinement mises en ≈ìuvre, ce qui affecte consid√©rablement la qualit√©. <br><br>  Tr√®s souvent, les utilisateurs ressentent ¬´l'effet placebo¬ª, se convaincant de la perfection d'un produit uniquement parce qu'il est plus r√©cent ou plus color√©.  En fait, cette qualit√© est imaginaire. <br><br>  Malgr√© la d√©t√©rioration √©vidente de la qualit√© de la transmission audio sans fil par rapport √† la version filaire, il semble que les fabricants d'appareils modernes visent une transition compl√®te vers les technologies sans fil.  Dans le m√™me temps, des astuces marketing sont utilis√©es pour justifier l'augmentation des prix: protection contre l'immersion du t√©l√©phone dans l'eau (comment parler sous l'eau? Pourquoi faire tomber l'appareil dans l'eau?), Utilisation de codecs plus chers, etc.  Dans le m√™me temps, le potentiel du codec SBC populaire existant n'est pas pleinement utilis√©. <br><br>  Nous n'avons pas pu obtenir de clarification de Google concernant la limite de d√©bit binaire de 328 kbps, ni √©liminer cette limite et ajouter l'option d'activer Dual Channel dans le menu Bluetooth des d√©veloppeurs de Lineage OS. <br><br>  Merci √† tous ceux qui ont lu jusqu'au bout! <br><br>  Une certaine suite caus√©e par la discussion dans les commentaires et un espace concernant le codec LDAC est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><img src="https://habrastorage.org/webt/ob/mr/cc/obmrccmcn21gzh8g1ca3g3ykfs4.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433502/">https://habr.com/ru/post/fr433502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433490/index.html">Critique de l'imprimante 3D Creality CR-X</a></li>
<li><a href="../fr433494/index.html">10 idiomes anglais que vous ne conna√Ætrez jamais</a></li>
<li><a href="../fr433496/index.html">Les entreprises publiques oblig√©es de passer aux logiciels nationaux d'ici 2022</a></li>
<li><a href="../fr433498/index.html">Sberbank - vous avez un "package" pour moi, mais je ne le prendrai pas ...</a></li>
<li><a href="../fr433500/index.html">Le robot de messagerie de Berkeley a grill√© en raison du manque d'√©tat du syst√®me de surveillance</a></li>
<li><a href="../fr433504/index.html">Comment arr√™ter d'√©crire le firmware des microcontr√¥leurs et commencer √† vivre</a></li>
<li><a href="../fr433506/index.html">L'UE demande le droit de r√©parer de gros appareils √©lectrom√©nagers</a></li>
<li><a href="../fr433508/index.html">Le propri√©taire de l'architecture MIPS a l'intention d'ouvrir son jeu d'instructions (ISA) en 2019</a></li>
<li><a href="../fr433510/index.html">Diff√©rence interculturelle dans les jeux</a></li>
<li><a href="../fr433512/index.html">Th√©orie du bonheur. Vol vertigineux d'un sandwich au beurre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>