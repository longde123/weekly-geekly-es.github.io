<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕯️ 🙏🏿 👨🏾‍🏫 Technologie audio sans fil Bluetooth: quelle est la meilleure? 😂 👨🏿‍🚒 🖕🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec le développement de la technologie, les écouteurs analogiques «à tube» si familiers entrent dans l'histoire - ils sont de plus en plus supplantés...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Technologie audio sans fil Bluetooth: quelle est la meilleure?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433502/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/_p/or/uz_por_7qlk9snfb7v_jg2x5iae.jpeg"></div><br>  Avec le développement de la technologie, les écouteurs analogiques «à tube» si familiers entrent dans l'histoire - ils sont de plus en plus supplantés par leurs homologues sans fil Bluetooth. <br><br>  Les smartphones modernes sont privés du connecteur habituel dans un souci de protection contre l'humidité et la poussière. <br><br>  Les développeurs publient toutes les nouvelles versions du protocole Bluetooth et toutes les nouvelles versions des codecs, promettant "plus vite, plus haut, plus fort" - moins de retards de lecture et une meilleure qualité. <br><br>  Est-ce que tout est si bon?  Voyons voir. <br><a name="habracut"></a><br><h2>  Présentation </h2><br>  Je ne m'étendrai pas sur la mise en œuvre technique des protocoles, ainsi que sur les spécifications ennuyeuses.  Cher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS</a> , qui dans une large mesure a été une source d'inspiration et même un consultant scientifique dans cet article, prépare un matériel complet sur les codecs - et tout y sera présenté de manière beaucoup plus détaillée et techniquement correcte. <br><br>  Je veux en dire plus sur l'expérience personnelle.  Eh bien, un peu de pratique divertissante (ennuyeuse?). <br><br>  Il y a un an et demi, je me suis enthousiasmé à l'idée d'aptX.  Oui, j'ai lu beaucoup de critiques comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celle-ci</a> et j'ai cru à tous ces rebondissements techniques.  Un enfant est né - et je voulais vraiment regarder des émissions avec des écouteurs la nuit avec ma femme, sans faire de bruit et sans réveiller personne dans la maison. <br><br>  Qu'est-ce que cela a donné? <br><br><h2>  La qualité </h2><br>  Commençons par les chiffres et les faits (bonjour, Wikipedia!) <br><br>  <b>SBC</b> est un bon vieux codec, conforme à la norme A2DP.  Le codec est le résultat des travaux de Frans de Bont <i>(F. de Bont, M. Groenewegen et W. Oomen, «A High Quality Audio-Coding System at 128 kb / s», 98th AES Convention, 25-28 février 1995)</i> et de son utilisation les algorithmes décrits dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">brevet EP-0400755B1</a> .  Il est à noter que les auteurs du brevet autorisent l'utilisation gratuite de SBC uniquement dans l'application Bluetooth, cependant, le brevet a expiré le 2 juin 2010.  Étant donné que la norme A2DP est très courante, il est extrêmement difficile de trouver des écouteurs ou des haut-parleurs qui ne prennent pas en charge SBC. <br><br>  Le codec fournit une fréquence d'échantillonnage de 16, 32, 44,1, 48 kHz avec un débit de 10 à 1500 kbit / s.  Oui, vous avez bien entendu.  Jusqu'à 1500 kbps.  Il n'y a tout simplement pas de limite de débit binaire dans le codec.  Mais plus à ce sujet plus tard. <br><br>  Le codec <b>aptX a été</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">développé en 1988 à l'Université Queen's de Belfast</a> .  Oui, avant Bluetooth, il y avait encore une douzaine d'années, donc le codec était utilisé dans les équipements audio professionnels.  Qualcomm détient actuellement les droits, et donc l'utilisation nécessite des licences et des redevances.  En 2014, le coût était approximativement le suivant: un paiement unique de 6 000 $ et 1 $ each pour chaque appareil libéré pour les parties comptant jusqu'à 10 000 appareils.  Pour cette raison, de nombreux appareils avec Snapdragon 835, 845, 821, 820, 810, 805, 801, 800, 650, 615, 410 sont tout à fait possibles et prennent en charge aptX, mais il n'y est pas activé, car la licence n'a pas été achetée.  À ce sujet - également ci-dessous. <br><br>  Avec une profondeur de bits de 16 bits et une fréquence d'échantillonnage de 48 kHz, le codec peut fournir un débit binaire de 384 kbit / s (double canal). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste des produits supportant officiellement aptX</a> .  Vous pouvez trouver beaucoup de systèmes inconnus avec le support aptX sur Aliexpress, mais soyez prêt pour le fait qu'il y aura en fait le même bon vieux SBC - et pas plus. <br><br>  <b>aptX HD</b> - le même codec, mais avec un profil d'encodage différent, a une vitesse de flux de 576 kbit / s, un support pour des fréquences d'échantillonnage jusqu'à 48 kHz et une profondeur de bits jusqu'à 24 bits.  Certaines personnes appellent ce codec aptX Lossless - mais cela n'a aucun sens, ne serait-ce que parce qu'il est impossible pour le moment d'obtenir la valeur d'un flux qui pourrait transporter des données sans perte.  Un avantage particulier de ce codec est un retard de codage réglable, qui peut être réduit à 1 ms à une fréquence d'échantillonnage de 48 kHz.  En outre, le codec est extrêmement avantageux du point de vue du chargement du processeur, ce qui exprime un avantage par rapport aux MP3 et AAS. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste des produits supportant officiellement aptX HD</a> .  Il est assez petit. <br><br>  <b>aptX Low latency</b> (ou LL) est une version spéciale du codec qui vous permet de réduire le temps de retard du son à moins de 40 ms.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste des produits supportant officiellement aptX LL</a> . <br><br><img src="https://habrastorage.org/webt/oz/nd/5q/oznd5qcoovjbj8f4xdtfydbl_ym.png" alt="image"><br><br>  Elle est là.  C'est cette photo qui à un moment donné m'a acheté avec des abats.  Retards!  Après tout, qui veut entendre le bruit d'une explosion dans un film d'action, le cri d'un monstre dans un film d'horreur ou le rugissement d'une foule lors d'un match de football quand tout est fini? <br><br>  Mais est-ce vraiment vrai? <br><br>  Hélas, non. <br><br>  Comme pour tout matériel marketing, les chiffres sont farfelus.  Le retard dépend en grande partie de la mise en mémoire tampon dans le système et la mise en œuvre du codec.  Ainsi, le retard avec SBC pourrait bien être inférieur à 40 ms, ce qui, compte tenu des normes de diffusion télévisuelle (+40 ms ... -60 ms), est parfaitement acceptable. <br><br>  <u>En résumé:</u> <br><br><ol><li>  Aucun codec existant ne peut être meilleur que la technologie filaire, car aucun codec ne peut atteindre une véritable compression sans perte. </li><li>  Le codec le plus populaire est SBC.  Il est le plus flexible dans les paramètres.  Et malgré le fait qu'aptX soit sorti plus tôt, il ne pouvait pas battre la popularité de SBC, apparemment parce que ce dernier était gratuit. </li><li>  La qualité sonore dépend extrêmement de la mise en œuvre du codec, ainsi que des performances matérielles des écouteurs / haut-parleurs en général - si le haut-parleur lui-même est faible, la qualité ne peut être améliorée par aucun codec.  Par conséquent, à l'avenir, en comparant la qualité, nous parlerons de la lecture du même contenu à partir de la même source sur les mêmes haut-parleurs / écouteurs, mais avec des codecs différents. </li></ol><br><h2>  Résultats pratiques et très subjectifs </h2><br><img src="https://habrastorage.org/webt/fj/uf/kj/fjufkjmv-sxcezemnqcz3ztyue4.jpeg"><br><br>  Les informations sont basées sur l'expérience d'un an et demi déjà mentionnée dans l'exploitation, la comparaison et l'attraction d'auditeurs extérieurs. <br><br>  L'expérience est basée sur l'écoute sans perte sur le lecteur SONY Walkman NWZ-A17, où le codec peut être sélectionné, ainsi que sur la visualisation de divers programmes avec sortie audio via Avantree Priva III. <br><br>  Il y avait trois écouteurs: Sennheiser PMX 60, Koss Porta Pro et Koss UR-20. <br><br>  Jabra BT3030 (SBC) et Avantree Clipper Pro (aptX) ont été utilisés comme récepteurs de signaux sans fil. <br><br>  Un haut-parleur Voombox Outdoor (SBC) et un casque à conduction osseuse Aftershokz Trekz Titanium (aptX) ont également été utilisés. <br><br>  Tous les égaliseurs et amplificateurs ont été désactivés - et c'est important. <br><br>  <u>Total:</u> <br><br><ol><li>  La qualité du son joué avec une connexion filaire est toujours meilleure.  C'est sans aucun doute. </li><li>  La différence entre SBC et aptX est extrêmement difficile à entendre - et seulement dans le cas de certains types de musique.  Par exemple, l'auteur de l'article a clairement entendu la différence dans les solos de violoncelle dans les compositions classiques, tandis que pour le violon et les instruments à basse fréquence, la différence était moins perceptible.  Dans les genres modernes - pop, musique électronique et rock - la différence n'est pas entendue.  Dans certains cas, il semblait subjectivement que SBC transmet le son mieux qu'aptX. </li><li>  Le délai entre SBC et aptX ne peut être vu que si vous vous connectez à la même source et insérez différents récepteurs dans différentes oreilles (enfin, le canal gauche est SBC, et le droit est aptX, par exemple).  Il est presque impossible de voir le retard avec l'image, mais parce que l'histoire selon laquelle aptX est destiné aux scènes et au contenu dynamiques est un mythe. </li><li>  La surprise a été causée par la qualité sonore de la Voombox Outdoor plutôt bon marché et "peu célèbre".  Apparemment, c'est la mise en œuvre réussie de SBC, qui a été mentionnée ci-dessus. </li><li>  La mise en œuvre d'aptX dans les écouteurs à conduction osseuse est totalement incompréhensible - la technologie est très spécifique, et donc la perte de qualité est importante en raison de la technologie elle-même.  Compte tenu de la petite plage de la «plage» de fonctionnement de l'appareil, de la mise en œuvre extrêmement médiocre du couplage avec deux appareils, je peux dire qu'Aftershokz est une entreprise qui investit plus dans le marketing que dans le développement. </li></ol><br><br>  Je ne dis pas que si vous connectez toutes sortes d’analyseurs spectraux et ainsi de suite, vous pouvez et devez voir la différence.  Mais l'oreille humaine, et pire encore - l'oreille humaine moyenne - n'est pas un appareil spectral, et n'entend donc pas toutes ces nuances. <br><br><h2>  Pratique: fixer ce qui peut être réparé </h2><br><h3>  Partie 1. Activez aptX </h3><br>  Comme déjà mentionné, dans certains appareils, l'utilisation d'aptX est désactivée, probablement afin d'éviter les poursuites en matière de brevets. <br><br>  Ce problème peut être résolu tout simplement en glissant le périphérique de bibliothèque pour implémenter le codec et en écrivant la possibilité de travailler avec ce codec dans build.prop. <br><br>  Sur Internet, il existe un grand nombre de solutions de cette nature.  J'ai pris la liberté de les combiner en un tout en le réalisant comme module pour Magisk.  Oui, j'aime vraiment ce projet et je pense que la mise en œuvre de modifications du système sous la forme de modules Magisk est une solution meilleure et plus sûre avec la possibilité de sauvegarder le système dans sa forme originale et de manière simple à restaurer. <br><br>  Le module peut être téléchargé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Oui, je connais github.  Et non, jusqu'à ce que j'aie le temps de le mettre là. <br><br>  Les entrées dans build.prop, y compris aptX et, si possible, aptX HD, seront émulées automatiquement par le module. <br><br><img src="https://habrastorage.org/webt/vg/lc/gu/vglcguyqsbbyxptonmhdw-5ta3y.png"><br><br><h3>  Partie 2. Augmentez le débit binaire SBC </h3><br>  Comme indiqué précédemment, le codec SBC n'a fondamentalement aucune restriction de débit binaire.  Cependant, les fabricants fixent généralement une limite de 342 kbit / s pour le mono et de 345 kbit / s pour la stéréo afin d'assurer un fonctionnement fiable avec tous les types d'appareils récepteurs. <br><br>  Dans le même temps, la spécification A2DP v1.2, qui était active de 2007 à 2015, exige que tous les dispositifs de décodage fonctionnent correctement avec des débits allant jusqu'à 320 kbit / s en mono et 512 kbit / s dans le cas d'un signal stéréo. <br><br>  Dans la nouvelle version de la spécification, il n'y a aucune limite de débit binaire.  Il est supposé que les écouteurs modernes sortis après 2015 et prenant en charge EDR peuvent prendre en charge des débits allant jusqu'à 730 kbps. <br><br>  En fait, ce n'est certainement pas le cas.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans une étude approfondie</a> menée par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS</a> , il a été constaté que presque tous les appareils récepteurs fonctionnent de manière fiable avec des débits binaires de 454 kbit / s, et un nombre assez important avec un débit binaire de 507 kbit / s. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans ses recherches,</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS a</a> également montré que, contrairement à la croyance populaire sur la qualité du codec aptX, il peut produire des résultats pires sur certains fichiers que SBC avec un débit binaire standard de 328 kbps, et le passage à un SBC à haut débit produira un son qui dépasse souvent aptX, sur n'importe quel casque. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Sur la base</a> de ces données, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">ValdikSS a</a> envoyé des commentaires aux développeurs de Lineage OS et de Google, mais jusqu'à présent, il n'y a eu aucune réaction. <br><br>  Ainsi, nous ne pouvons apporter que manuellement des modifications à la pile Bluetooth. <br><br>  Nous avons besoin d'un IDA Pro avec la possibilité de décompiler ARM, n'importe quel éditeur HEX (j'ai utilisé WinHEX) et le fichier bluetooth.default.so de notre appareil.  Habituellement, il se trouve sur le chemin / system / lib / hw et moins souvent - également sur le chemin / system / lib64 / hw (un accès root est définitivement nécessaire). <br><br>  Ouvrez donc le fichier bluetooth.default.so. Les opérations et modifications décrites ci-dessous s'appliquent uniquement à la pile Android d'origine (bluedroid).  Si vous voyez la ligne «Needed Library 'com.qualcomm.qti.bluetooth_audio@1.0.so'» ou similaire dans IDA Pro, il est fort probable que cette instruction ne vous aidera pas. <br><br><img src="https://habrastorage.org/webt/cf/3l/jb/cf3ljbjgckew4pd9tbutsy-tyaw.png"><br><br>  Notre première tâche consiste à remplacer Joint Stereo par Dual Channel dans une configuration standard. <br><br>  Nous travaillerons avec la <a href="">fonction bta_av_build_src_cfg</a> . <br><br>  Pour trouver cette procédure dans l'IDA, nous allons utiliser la recherche de <a href="">ligne pour un message caractéristique dans le journal de débogage "Cant parse src cap ret =% d"</a> : <br><br><img src="https://habrastorage.org/webt/wh/dk/ex/whdkexvibrxijvj7pqb-buzb0z8.png"><br><br><img src="https://habrastorage.org/webt/ea/2h/nh/ea2hnhbszbtyieokldywuch2qvi.png"><br><br>  En conséquence, nous trouvons assez rapidement la fonction elle-même sous forme de code: <br><br><img src="https://habrastorage.org/webt/mf/5_/_9/mf5__9yydhgwip0lvemgqwcwocw.png"><br><br>  Notre tâche est de remplacer la structure d'origine des chèques <br><br><pre><code class="plaintext hljs">if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_JOINT) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_JOINT; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;&lt;/code&gt;  &lt;code&gt; if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;</code> </pre> <br>  Il existe plusieurs façons de procéder. <br><br>  Le premier est le remplacement des instructions TST.W R0, # 1 avec TST.W R0, # 4 et MOVS R0, # 1 avec MOVS R0, # 4 dans la séquence de vérifications: <br><br><img src="https://habrastorage.org/webt/6e/zu/so/6ezusojttx0gavinlppmqeroet8.png"><br><br>  En bytecode, il s'agit du remplacement de x01 en x04.  Il est important de noter la séquence caractéristique d'octets par laquelle ce modèle peut être trouvé.  Sans entrer dans les détails, je dirai que c'est essentiellement une recherche de séquence <br><br><pre> <code class="plaintext hljs">10 20 8D F8 04 00 9D F8 0D 00 10 F0 01 0F ?? ?? 10 F0 02 0F ?? ?? 10 F0 04 0F ?? ?? 10 F0 08 0F ?? ?? 08 20 ?? ?? 01 20 ?? ?? 02 20 ?? ?? 04 20</code> </pre> <br>  et son remplacement par <br><br><pre> <code class="plaintext hljs">?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ??</code> </pre> <br>  Cependant, cette méthode présente des inconvénients. <br><br>  Un certain nombre de compilateurs modifient la séquence d'exécution des commandes en fonction de l'optimisation.  Et dans ce cas, il n'est pas possible de trouver le modèle souhaité, et parfois le mécanisme de vérification dans la structure est généralement introduit dans le code en ligne.  Par conséquent, il est plus fiable de modifier la constante <a href="">btif_av_sbc_default_config</a> . <br><br>  Pour commencer - trouvez-la.  Elle est au tout début de notre fonction, car <br><br><pre> <code class="plaintext hljs">void bta_av_build_src_cfg (UINT8 *p_pref_cfg, UINT8 *p_src_cap) { tA2D_SBC_CIE src_cap; tA2D_SBC_CIE pref_cap; UINT8 status = 0; /* initialize it to default SBC configuration */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;btif_av_sbc_default_config, p_pref_cfg); /* now try to build a preferred one */ /* parse configuration */ if ((status = A2D_ParsSbcInfo(&amp;src_cap, p_src_cap, TRUE)) != 0) { APPL_TRACE_DEBUG(" Cant parse src cap ret = %d", status);</code> </pre> <br>  Et la voici: <br><br><img src="https://habrastorage.org/webt/xi/j2/dt/xij2dtvma0evlnggxkxzqxkvdn4.png"><br><br><img src="https://habrastorage.org/webt/7a/z9/36/7az936re6naesontslfi1ogkd5c.png"><br><br>  On peut voir que btif_av_sbc_default_config lui-même est une séquence d'octets 20 01 10 04 01 35 02, tandis que le premier octet code la fréquence d'échantillonnage et peut être 10 (48 kHz) et 20 (44 kHz), et donc non spécifique.  Ainsi, notre tâche est de remplacer la séquence <br> <code>01 10 04 01 35 02</code> <br>  sur <br> <code>04 ?? ?? ?? ?? ??</code> <br> <br>  Cela vous permettra de changer la logique de la structure d'une manière similaire, mais en même temps, l'optimisation du compilateur ne posera pas de problèmes. <br><br>  Dans certains cas, les écouteurs ou les haut-parleurs initient eux-mêmes la connexion.  Dans ce cas, le mode est déterminé par la fonction <a href="">bta_av_co_audio_init</a> . <br><br>  La fonction est <a href="">caractérisée par la ligne «bta_av_co_audio_init:% d»</a> et est facilement recherchée dans le code: <br><img src="https://habrastorage.org/webt/fi/5o/ku/fi5okug9tbn6gvleetxo93uk9qg.png"><br><br>  L'énumération des modes de connexion possibles est effectuée dans la commande suivante: <br><br><pre> <code class="plaintext hljs"> switch (index) { case BTIF_SV_AV_AA_SBC_INDEX: /* Set up for SBC codec for SRC*/ *p_codec_type = BTA_AV_CODEC_SBC; /* This should not fail because we are using constants for parameters */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;bta_av_co_sbc_caps, p_codec_info); /* Codec is valid */ return TRUE;</code> </pre> <br>  la <a href="">constante bta_av_co_sbc_caps a la structure suivante</a> : <br><br><pre> <code class="plaintext hljs">const tA2D_SBC_CIE bta_av_co_sbc_caps = { (A2D_SBC_IE_SAMP_FREQ_44), /* samp_freq */ (A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL), /* ch_mode */ (A2D_SBC_IE_BLOCKS_16 | A2D_SBC_IE_BLOCKS_12 | A2D_SBC_IE_BLOCKS_8 | A2D_SBC_IE_BLOCKS_4), /* block_len */ (A2D_SBC_IE_SUBBAND_4 | A2D_SBC_IE_SUBBAND_8), /* num_subbands */ (A2D_SBC_IE_ALLOC_MD_L | A2D_SBC_IE_ALLOC_MD_S), /* alloc_mthd */ BTA_AV_CO_SBC_MAX_BITPOOL, /* max_bitpool */ A2D_SBC_IE_MIN_BITPOOL /* min_bitpool */ };</code> </pre> <br>  La constante se retrouve facilement dans le code, dans mon cas c'est 20 0F F0 0C 03 35 02: <br><br><img src="https://habrastorage.org/webt/kj/hw/oi/kjhwoibpuk8brwa3kzvxiuxgeba.png"><br><br>  Faites attention à l'octet <b>0F</b> - il offre la possibilité de se connecter à l'un des modes valides, car <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL = x08 | x02 | x01 | x04</code> </pre> <br>  Notre tâche consiste à modifier cette valeur comme suit: <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_DUAL = x04</code> </pre> <br>  Par conséquent, il est nécessaire de remplacer <br><br> <code>?? 0F F0 0C 03 35 02</code> <br>  sur <br> <code>?? 04 ?? ?? ?? ?? ??</code> <br> <br>  Nous avons donc forcé la pile à se connecter en mode Dual Channel à la fois dans le cas de l'établissement d'une connexion par le périphérique et dans le cas de l'établissement d'une connexion par le côté réception du signal. <br><br>  Vous devez maintenant supprimer les restrictions de débit binaire ou augmenter son seuil supérieur. <br><br>  Besoin de gérer <a href="">btif_media_task_get_sbc_rate</a> .  De même, pour rechercher la <a href="">ligne caractéristique "non-edr a2dp sink détecté, limiter le taux à% d", nous</a> recherchons la fonction dans le code: <br><img src="https://habrastorage.org/webt/kp/go/j2/kpgoj2xsq6vt8kbnexy81jy6j6s.png"><br><br>  La limite de débit binaire est exprimée dans une chaîne <br>  Débit UINT16 = DEFAULT_SBC_BITRATE (qui à son tour <a href="">est de 328 kbps</a> ) <br><br>  Dans le code, c'est comme ça: <br><br><img src="https://habrastorage.org/webt/tf/ba/bn/tfbabnrxfks3pejhzqzdegiwn04.png"><br><br>  Modifiez cette valeur à 454 kbit / s - elle est supérieure à la norme et fonctionne avec la grande majorité des récepteurs.  Pour ce faire, remplacez les octets <br><br> <code>B1 4F F4 A4 74 ?? E0</code> <br>  sur <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br> <br>  Vous devez également rechercher par modèle. <br><br> <code>E0 4F F4 A4 74 ?? E0</code> <br>  et remplacez-le par <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br>  - Ceci est requis pour un certain nombre d'appareils. <br><br>  La valeur de E3 peut être différente en fonction du débit binaire maximum souhaité: <br><br><ul><li>  E3 - 454 kbps </li><li>  F1 - 482 kbps </li><li>  F3 - 486 kbps </li><li>  10 à 576 kbps </li><li>  48 - pas de limite </li></ul><br>  En général, cela est déterminé par le bytecode de l'opération MOV.W R4, XXX. <br><br>  En pratique, il vaut la peine d'expérimenter et de choisir la valeur maximale à laquelle tous vos appareils récepteurs reçoivent une réception de signal stable, il n'y a pas de craquage, d'interruption ou de distorsion. <br><br>  Sur tous les récepteurs de mon expérience (je les ai indiqués ci-dessus), cette valeur était de 576 kbit / s, le téléphone Xiaomi Redmi 4x MIUI10 Android 7.1 était la source du signal. <br><br>  Sur la base des actions décrites, un correctif générique a été créé qui trouve les modèles spécifiés dans Bluetooth.default.so et les remplace?  y compris le mode Dual Channel forcé et la définition de la limite de débit à 454 kbps.  Si nécessaire, la valeur limite peut être facilement modifiée en fonction de la recherche et du remplacement de l'octet correspondant - un lecteur attentif le fera sans difficulté. <br><br>  Je souligne: le patch ne fonctionne que dans le cas de la pile bluedroid et ne réussira probablement pas dans le cas de la pile Fluoride et d'Android version 8 et versions ultérieures. <br><br>  Le patch peut être téléchargé à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partir d'ici</a> . <br><br>  Il est fortement recommandé de remplacer le fichier d'origine en tant que modules Magisk, pour moi, je l'ai fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme suit</a> .  <b>Veuillez noter</b> : ces modules ont été créés par moi pour le téléphone Xiaomi Redmi 4x 3/32 Go avec le firmware MIUI 10 stable mondial actuel au moment de la rédaction. Dans votre cas, le fichier bluetooth.default.so devra être remplacé par le vôtre, corrigé, comme décrit ci-dessus.  Il est également possible que le fichier doive être dupliqué le long du chemin / système / lib64 / hw - cela dépend du modèle et de la version du firmware de votre téléphone. <br><br>  Cette approche utilisant des modules Magisk permet de changer facilement le débit binaire maximum et généralement de désactiver les modifications s'il s'avère que certains des appareils récepteurs ne prennent pas en charge le double canal. <br><br><h2>  Conclusion </h2><br>  À l'heure actuelle, dans la poursuite des ventes, de nombreuses entreprises présentent des innovations technologiques pour justifier un prix plus élevé. <br><br>  Dans la pratique, il s'avère que les technologies existantes et moins chères ne sont pas entièrement développées et que les innovations technologiques ne sont pas pleinement mises en œuvre, ce qui affecte considérablement la qualité. <br><br>  Très souvent, les utilisateurs ressentent «l'effet placebo», se convaincant de la perfection d'un produit uniquement parce qu'il est plus récent ou plus coloré.  En fait, cette qualité est imaginaire. <br><br>  Malgré la détérioration évidente de la qualité de la transmission audio sans fil par rapport à la version filaire, il semble que les fabricants d'appareils modernes visent une transition complète vers les technologies sans fil.  Dans le même temps, des astuces marketing sont utilisées pour justifier l'augmentation des prix: protection contre l'immersion du téléphone dans l'eau (comment parler sous l'eau? Pourquoi faire tomber l'appareil dans l'eau?), Utilisation de codecs plus chers, etc.  Dans le même temps, le potentiel du codec SBC populaire existant n'est pas pleinement utilisé. <br><br>  Nous n'avons pas pu obtenir de clarification de Google concernant la limite de débit binaire de 328 kbps, ni éliminer cette limite et ajouter l'option d'activer Dual Channel dans le menu Bluetooth des développeurs de Lineage OS. <br><br>  Merci à tous ceux qui ont lu jusqu'au bout! <br><br>  Une certaine suite causée par la discussion dans les commentaires et un espace concernant le codec LDAC est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><img src="https://habrastorage.org/webt/ob/mr/cc/obmrccmcn21gzh8g1ca3g3ykfs4.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433502/">https://habr.com/ru/post/fr433502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433490/index.html">Critique de l'imprimante 3D Creality CR-X</a></li>
<li><a href="../fr433494/index.html">10 idiomes anglais que vous ne connaîtrez jamais</a></li>
<li><a href="../fr433496/index.html">Les entreprises publiques obligées de passer aux logiciels nationaux d'ici 2022</a></li>
<li><a href="../fr433498/index.html">Sberbank - vous avez un "package" pour moi, mais je ne le prendrai pas ...</a></li>
<li><a href="../fr433500/index.html">Le robot de messagerie de Berkeley a grillé en raison du manque d'état du système de surveillance</a></li>
<li><a href="../fr433504/index.html">Comment arrêter d'écrire le firmware des microcontrôleurs et commencer à vivre</a></li>
<li><a href="../fr433506/index.html">L'UE demande le droit de réparer de gros appareils électroménagers</a></li>
<li><a href="../fr433508/index.html">Le propriétaire de l'architecture MIPS a l'intention d'ouvrir son jeu d'instructions (ISA) en 2019</a></li>
<li><a href="../fr433510/index.html">Différence interculturelle dans les jeux</a></li>
<li><a href="../fr433512/index.html">Théorie du bonheur. Vol vertigineux d'un sandwich au beurre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>