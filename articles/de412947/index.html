<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚙 🍌 🍈 Lasttests in der Azure-Cloud. Wie teste ich einen großen Online-Shop unter realen Bedingungen? 🥒 🐨 🕴🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werden wir unsere eigenen praktischen Erfahrungen teilen, die wir beim Testen der Web Apps-Anwendung (Online-Shop) in der MS Azure-C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lasttests in der Azure-Cloud. Wie teste ich einen großen Online-Shop unter realen Bedingungen?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/virtocommerce/blog/412947/">  In diesem Artikel werden wir unsere eigenen praktischen Erfahrungen teilen, die wir beim Testen der Web Apps-Anwendung (Online-Shop) in der MS Azure-Cloud gesammelt haben, und beschreiben, welche Tools wir zur Lösung dieses Problems verwendet haben und welche Schlussfolgerungen auf der Grundlage der Ergebnisse gezogen wurden Ergebnisse. <br><img src="https://habrastorage.org/webt/qy/hw/ih/qyhwihvqkt2hrypk0odlioyxwz0.jpeg"><br><a name="habracut"></a><br><h4>  Testobjekt </h4><br>  Wir haben VirtoCommerce Storefront (eine Webanwendung, die als Front-End für Anwendungen verwendet wird, die auf der VirtoCommerce-Plattform erstellt wurden) als Testobjekte ausgewählt. <br><br>  Um ein reales Bild der Systemfunktionen zu erhalten, müssen Benutzeranforderungen so realitätsnah wie möglich simuliert werden.  Es macht keinen Sinn, die Hauptseite zu überprüfen, die sich möglicherweise im Cache befindet, und dann zu behaupten, dass unsere Geschwindigkeit 1k req / sec betrug.  Eine solche Leistungsmetrik macht im wirklichen Leben keinen Sinn. <br><br>  Damit unsere Testergebnisse statistisch signifikant sind und die Leistungsindikatoren für den realen Verkehr so ​​genau wie möglich widerspiegeln, wurde beschlossen, Abfragen zu verwenden, die dem tatsächlichen Benutzerverhalten im Online-Shop so nahe wie möglich kommen. <cut></cut><br><br>  Lassen Sie uns auf die folgenden Aktionen eingehen, aus denen unser "echter" Test bestehen wird: <br><br><table border="1"><tbody><tr><td><p>  <strong>Benutzeraktion (Testtyp)</strong> </p><br></td><td><p>  <strong>Prozentsatz aller Anfragen</strong> </p><br></td></tr><tr><td><p>  Zeigen Sie eine einzigartige Kategorieseite mit ihren Produkten an </p><br></td><td><p>  30% </p><br></td></tr><tr><td><p>  Zeigen Sie eine einzigartige Produktkarte an </p><br></td><td><p>  40% </p><br></td></tr><tr><td><p>  Artikel in den Warenkorb legen </p><br></td><td><p>  10% </p><br></td></tr><tr><td><p>  Suchen Sie nach Produkten anhand eines eindeutigen Schlüsselworts oder Attributs </p><br></td><td><p>  20% </p><br></td></tr></tbody></table><br>  <i>Abb.</i>  <i>1. Die Hauptaktionen der Benutzer und ihre spezifische Nutzungshäufigkeit.</i> <br><br><h4>  Vorbereitung der Testdaten </h4><br>  Die wichtigste Phase für jeden Test ist die Datenaufbereitung.  Testdaten sollten so ausgewählt werden, dass sie möglichst quantitativ und qualitativ (Kommunikation, Struktur usw.) den Daten in einem realen System entsprechen.  Wenn möglich, sollte die Gesamtdatenmenge ausreichend sein, damit beim Testen möglichst wenige wiederholte Aufrufe derselben Daten erfolgen, wodurch eine häufige Verwendung des Caches vermieden wird und das pessimistischste Bild der Systemleistung erhalten wird. <br><br>  Die wichtigsten Daten für den Online-Shop sind in der Regel: ein Katalog von Produkten und Kategorien mit Preisen, Rabatten und Informationen zu Salden. <br><br>  Als Füllung für die Testumgebung wurden echte Katalogdaten verwendet, die in der Hauptproduktionsumgebung verwendet werden: <br><br><img src="https://habrastorage.org/webt/kc/zm/o3/kczmo3vh9hjvjxaf6a0mn-zcaco.png"><br>  <i>Abb. 2.</i>  <i>Daten, die zum Auffüllen des zu testenden Systems verwendet werden.</i> <br><br>  Es ist klar, dass für einen Leser, der mit der Struktur des VirtoCommerce-Katalogs nicht vertraut ist, einige Datentypen möglicherweise nichts bedeuten, aber wir werden sie dennoch präsentieren, um zumindest eine Vorstellung von der quantitativen Reihenfolge zu haben. <br><br><h4>  Projektvorbereitungs- und Aufzeichnungstests </h4><br>  Als Hauptwerkzeug für Lasttests verwenden wir MS Visual Studio Enterprise 2017 (in anderen Editionen der Studio-Unterstützung für diesen Projekttyp möglicherweise nicht verfügbar) und den Projekttyp <b>Webleistungs- und Lasttestprojekt</b> . <br><br><img src="https://habrastorage.org/webt/pq/pi/hz/pqpihzjuik_rtvxt9esckqbkkj4.png"><br>  <i>Abb. 3.</i>  <i>Erstellen Sie ein neues Projekt.</i> <br><br>  Nach dem Erstellen des Projekts müssen wir Tests für jede der zuvor definierten Benutzeraktionen erstellen.  Wir beschränken uns darauf, einen Test für eine Benutzeraktion als Beispiel zu erstellen, da der Rest der Aktionen analog erstellt wird. <br><br>  Für Tests verwenden wir den in Visual Studio integrierten Standardtesttyp Web Performance Test. <br><br>  Unser erster Test, den wir erstellen, wird ein Test sein, der Produktdetails in einem Online-Shop enthüllt. <br><br>  Um einen Test zu erstellen, wählen Sie den <b>Testtyp „</b> <b>Web Performance Test“</b> aus der von Studio angebotenen Liste aus und setzen Sie den Namen <b>„Storefront-ProductDetail“</b> . <br><br><img src="https://habrastorage.org/webt/q2/hj/fk/q2hjfkrpoctrmaqtticvke7og-i.png"><br>  <i>Abb. 4.</i>  <i>Auswählen eines Testtyps in Visual Studio.</i> <br><br>  Für diese Art von Test versucht Visual Studio sofort, einen Browser zu öffnen, in dem Sie interaktiv auf die erforderlichen Aktionen direkt auf der Site klicken können. Wir werden dies jedoch nicht tun, sondern den Browser sofort schließen und die Aufzeichnung beenden.  Als Ergebnis erhalten wir einen leeren <b>Storefront-ProductDetail.webtest-</b> Test. <br><br>  Als Nächstes müssen wir eine Datenquelle für diesen Test hinzufügen, um verschiedene Abfrageparameter innerhalb desselben Tests verwenden zu können. Dazu bietet der V <b>S Studio-Webleistungstest</b> eine solche Möglichkeit. <br><br>  Als Datenquelle für unseren Test verwenden wir eine Tabelle in der Datenbank, in der Produktdatensätze gespeichert sind.  Danach können wir die Daten aus der verbundenen Quelle in der Anfrage verwenden, wodurch die Produktdetails der getesteten Anwendung geöffnet werden sollen.  Dies wird durch Einfügen der Konstruktion <i>"{{Datenquellenname. Tabellenname. Spaltenname}}" erreicht.</i> <br><br>  Infolgedessen wird unser erster Test nach allen Manipulationen diese Form annehmen. <br><br><img src="https://habrastorage.org/webt/40/jo/tz/40jotzcj3gqlek8yi5qdwl8vgri.png"><br>  <i>Abb.</i>  <i>5. Inhalt des Tests</i> <br><br>  Es ist Zeit für den ersten Lauf. Versuchen Sie, unseren Test auszuführen, und stellen Sie sicher, dass er ordnungsgemäß funktioniert. <br><br><img src="https://habrastorage.org/webt/r7/pb/c_/r7pbc_5z3mqk_hugwege27clcxe.png"><br>  <i>Abb.</i>  <i>6. Das Ergebnis eines einzelnen Tests</i> <br><br>  In Analogie werden wir Tests für alle unsere anderen Szenarien erstellen. <br><br><img src="https://habrastorage.org/webt/f_/tv/5a/f_tv5aw-ilxk-apr4vehc5c5jvo.png"><br>  <i>Abb.</i>  <i>7. Die resultierende Testsuite</i> <br><br>  Danach ist fast alles bereit, um einen kombinierten Test zu erstellen, der das tatsächliche Verhalten des Benutzers auf der Site emuliert. <br><br>  <b>Fügen Sie</b> dazu unserem Projekt einen neuen <b>LoadTest hinzu.</b> <br><br><img src="https://habrastorage.org/webt/ex/wd/ve/exwdvet-rwzbznri1na7mmqk2da.png"><br>  <i>Abb. 8.</i>  <i>Erstellen Sie einen neuen Belastungstest</i> <br><br>  Wählen Sie im angezeigten Assistenten den Typ <b>Lokaler Lasttest aus</b> . <br><br><img src="https://habrastorage.org/webt/oa/pw/vf/oapwvf0exwvlj8k3zvd8byagwgg.png"><br>  <i>Abb.</i>  <i>9. Auswahl eines Testtyps</i> <br><br>  Dieser Punkt bedarf einiger Klarstellung, da Sie zu Recht fragen: "Und was vor Ort?"  In diesem Artikel geht es um das Testen mit Teams Services und MS Azure. Da wir jedoch Datenquellen in Form von Tabellen oder anderen externen Diensten für Tests verwenden, kann dies zu Schwierigkeiten führen, wenn wir versuchen, diesen Test in der Cloud auszuführen. <br><br>  Nach vergeblichen Versuchen, solche Tests in der Cloud zum Laufen zu bringen, haben wir dieses Unternehmen aufgegeben und beschlossen, die sogenannten "aufgezeichneten" Tests zum Testen zu verwenden, die durch Aufzeichnen von Abfragen erhalten werden, die durch lokal ausgeführte Tests generiert und mit Datenquellen verbunden wurden. <br><br>  Zum Aufzeichnen von Tests verwenden wir Fiddler, mit dem Anforderungen in das <b>Visual Studio-Webtestformat</b> exportiert werden können.  Ein wenig weiter werden wir das Verfahren zur Aufzeichnung eines solchen Tests detaillierter beschreiben. <br><br>  In den nächsten Schritten wählen wir die Dauer des Tests, die Anzahl der Benutzer und vor allem aus, aus welchen Tests unser <b>MixedLoadTest</b> bestehen soll und in welchen Anteilen sie verwendet werden. <br><br><img src="https://habrastorage.org/webt/ii/gw/m1/iigwm179eca-z4wpfhjiuxkmcpy.png"><br>  <i>Abb. 10.</i>  <i>Komponenten testen</i> <br><br>  Als Ergebnis erhalten wir nach allen Aktionen einen kombinierten <b>MixedLoadTest</b> , der für die Ausführung für eine lokal bereitgestellte Anwendung konfiguriert ist. <br>  Als nächstes müssen wir diesen Test ausführen und versuchen, mit <b>Fiddler</b> alle Anforderungen aufzuzeichnen, die als Ergebnis des Tests generiert werden, sowie einen „Datensatz“ zu erhalten, den wir direkt in der Cloud ausführen können. <br><br>  Führen Sie zuerst <b>Fiddler</b> und unseren <b>MixedLoadTest-</b> Test aus. <br><br><img src="https://habrastorage.org/webt/vo/i3/iv/voi3ivm3p2xqpotj13ielj2lpgu.png"><br>  <i>Abb.</i>  <i>11. Das Ergebnis des Tests</i> <br><br>  Nachdem wir alle Daten verarbeitet haben, erhalten wir dieses Bild in Fiddler <br><br><img src="https://habrastorage.org/webt/a2/te/ne/a2teneaia7ipcwzdxiudn8y_fnw.png"><br>  <i>Abb.</i>  <i>12. Testsitzung bei Fiddler</i> <br><br>  Als Nächstes speichern wir in Fiddler alle Sitzungen im Format <b>Visual Studio-Webtests</b> , <i>Datei -&gt; Sitzungen exportieren -&gt; Alle Sitzungen -&gt; Visual Studio-Webtests</i> und fügen die resultierende Datei dem Projekt hinzu.  Ich möchte Sie daran erinnern, dass diese Aktion erforderlich ist, damit wir den Test ohne Bezugnahme auf externe Datenquellen erhalten können, da das Starten dieser Art von Tests Probleme in der Cloud verursachen kann. <br><br><img src="https://habrastorage.org/webt/o3/le/v4/o3lev4pmhf-xp8ygxdbpi4xjujs.png"><br>  <i>Abb.</i>  <i>13. Details des „aufgezeichneten“ Tests</i> <br><br>  Jetzt ist fast alles bereit, um unseren Test in der Cloud auszuführen. Der letzte Schritt bei der Vorbereitung des Tests besteht darin, den „aufgezeichneten“ <b>MixedLoadTest</b> in einem beliebigen Texteditor zu öffnen und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">localhost</a> : 8888 (Proxy-Adresse, Fiddler) durch die Adresse unseres Geschäfts in der Cloud zu ersetzen. <br><br><h4>  Ausführen eines Tests in der Cloud </h4><br>  Um die Tests in der Cloud auszuführen, benötigen wir ein gültiges Konto in <b>Visual Studio Team Services</b> . <br><br>  Erstellen Sie einen neuen LoadTest. Wählen Sie diesmal nur <b>Cloud-basierten</b> Lasttest <b>mit Visual Studio Team Services aus</b> . <br><br><img src="https://habrastorage.org/webt/un/a6/s_/una6s_qzrma_us5niajapmwrjdg.png"><br><br>  In den nächsten Schritten wählen wir das Rechenzentrum aus, aus dem Datenverkehr zur getesteten Ressource generiert wird, sowie die maximale Anzahl von Agenten (Benutzern) für das konstante Muster, oder wenn wir die Last schrittweise erhöhen möchten, müssen wir die entsprechenden Parameter festlegen. <br><br><img src="https://habrastorage.org/webt/mi/vq/lb/mivqlbjaoikw-bzr1ztj_eg7zr4.png"><br><br>  Bei der Auswahl der Tests wählen wir den einzigen Test aus, den wir zuvor mit <b>Fiddler</b> aufgezeichnet haben. Er emuliert die „echte“ Belastung der getesteten Ressource. <br><br><img src="https://habrastorage.org/webt/41/q4/os/41q4os13d7n0edb-hxxa5ouj1nq.png"><br><br>  Nach Abschluss der Erstellung starten wir einen Test, bei dem das Studio einige wichtige Metriken wie Leistung und Bandbreite anzeigt sowie Echtzeitdiagramme erstellt. <br><br><img src="https://habrastorage.org/webt/hc/wv/7b/hcwv7ba5ceomfnww-ccvbftn9_a.png"><br>  <i>Abb.</i>  <i>14. Der Vorgang zum Ausführen des Tests in der Cloud</i> <br><br>  Nach Abschluss des Tests können Sie den gespeicherten Webbericht auch in VSTS anzeigen: <br><br><img src="https://habrastorage.org/webt/2l/h3/jp/2lh3jpyjwrqkndq1bjaf1q2ue7y.png"><br><img src="https://habrastorage.org/webt/xe/dx/zr/xedxzrpsrabonavgxjgw49frpvs.png"><br>  <i>Abb.</i>  <i>15. Webbericht im Visual Studio Team Services-Portal</i> <br><br><h4>  Ergebnisanalyse </h4><br>  Der wichtigste Punkt ist die Verarbeitung und Analyse der Testergebnisse.  Für die betreffende Aufgabe musste die Leistung einer Anwendung bewertet werden, die auf verschiedenen Konfigurationen von Azure Web Apps B2- und B3-Tarifen ausgeführt wird. <br><br>  Zu diesem Zweck haben wir den Test „Aufgezeichnet“ für die Anwendung in verschiedenen Konfigurationen erneut ausgeführt und die Ergebnisse in einem Excel-Dokument aufgezeichnet. <br><br>  Als Ergebnis haben wir diesen Bericht erhalten: <br><br><img src="https://habrastorage.org/webt/bp/oz/xh/bpozxhhhsjiuwwmwl2gmfcblluq.png"><br>  <i>Abb.16.</i>  <i>Testergebnisbericht</i> <br><br>  Nach der Analyse der erhaltenen Daten konnte die maximale Belastung ermittelt werden, der unsere Anwendung standhalten kann - es sind etwa 60 gleichzeitige Benutzer oder 9 Anforderungen / Sek.  mit einer durchschnittlichen Seitenrücklaufzeit von 2,5 Sekunden.  Die Grafik zeigt, dass Leistungsprobleme nach einem bestimmten Schwellenwert für die Anzahl der Anforderungen abrupt beginnen. <br><br>  Wie sich später herausstellte, war der Grund dafür eine Prozessorlast von 100%, da wir eine Bibliothek eines Drittanbieters für das Rendern von Serverseiten verwendeten, bei der reguläre Ausdrücke zum Tokenisieren und Analysieren von Markups verwendet wurden. <br><br><h4>  Schlussfolgerungen </h4><br>  Die Produktivität einer sich aktiv entwickelnden Anwendung neigt immer sehr stark zur Verschlechterung, da jede Änderung, selbst die aus Sicht des Entwicklers unbedeutendste, zu dramatischen Konsequenzen für die Anwendungsleistung führen kann.  In diesem Zusammenhang ist die regelmäßige Leistungsprüfung ein wichtiges Verfahren, das regelmäßig durchgeführt werden und Teil der Prozesse der kontinuierlichen Integration sein sollte. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das Projekt selbst und die als Ergebnis der Tests erhaltenen Berichte sind auf GitHub verfügbar</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de412947/">https://habr.com/ru/post/de412947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de412933/index.html">Tesla hat den Quellcode für Model S / X 2018.12 teilweise geöffnet</a></li>
<li><a href="../de412937/index.html">Demo-Hack: PenTest Show zeigt, wie einfach es ist, das Büronetzwerk und die Sicherheitssysteme zu hacken, um etwas zu stehlen</a></li>
<li><a href="../de412939/index.html">Tester gegen das Testen</a></li>
<li><a href="../de412941/index.html">Java Eastern European Conference 2018: Berichte und Eindrücke</a></li>
<li><a href="../de412945/index.html">Abhängigkeitsmanager</a></li>
<li><a href="../de412949/index.html">Astrologen kündigen eine Woche iOS-Entwicklung in Avito an</a></li>
<li><a href="../de412951/index.html">DotVVM - Kommunikation zwischen Client und Server</a></li>
<li><a href="../de412953/index.html">Intel RealSense d435 Kamerakalibrierung mit OpenCV2 und ROS</a></li>
<li><a href="../de412955/index.html">UI-Tests in Xcode mit Embassy und Succulent</a></li>
<li><a href="../de412957/index.html">Mi Band 4 und Mi Band 5: Die Zukunft der Xiaomi Smart Bracelets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>