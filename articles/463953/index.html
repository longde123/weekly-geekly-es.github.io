<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§üüèº üç¶ ü•ö Implementaci√≥n del patr√≥n de dise√±o de comandos en Unity ü§æüèΩ üå∂Ô∏è üëãüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øAlguna vez te has preguntado c√≥mo se implementa la funci√≥n de reproducci√≥n en juegos como Super Meat Boy ? Una forma de implementarlo es llevar a cab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementaci√≥n del patr√≥n de dise√±o de comandos en Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463953/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/cfb/edf/fefcfbedf0b2e0711f2e831b0d069ebf.gif" alt="imagen"></div><br>  ¬øAlguna vez te has preguntado c√≥mo se implementa la funci√≥n de reproducci√≥n en juegos como <i>Super Meat Boy</i> ?  Una forma de implementarlo es llevar a cabo la entrada de la misma manera que lo hizo el jugador, lo que, a su vez, significa que la entrada debe almacenarse de alguna manera.  Puede usar <em>el patr√≥n de Comando</em> para esto y mucho m√°s. <br><br>  La plantilla de Comando tambi√©n es √∫til para crear funciones Deshacer y Rehacer en un juego de estrategia. <br><br>  En este tutorial, implementamos la plantilla de Comando en C # y la usamos para guiar al personaje bot a trav√©s de un laberinto tridimensional.  Del tutorial aprender√°s: <br><br><ul><li>  Los fundamentos del patr√≥n de comando. </li><li>  C√≥mo implementar el patr√≥n de comando </li><li>  C√≥mo crear una cola de comandos de entrada y retrasar su ejecuci√≥n. </li></ul><a name="habracut"></a><br><blockquote>  <em>Nota</em> : se supone que ya est√° familiarizado con Unity y tiene un conocimiento promedio de C #.  En este tutorial trabajaremos con <em>Unity 2019.1</em> y <em>C # 7</em> . </blockquote><br><h2>  Llegar al trabajo </h2><br>  Para comenzar, descargue los <a href="">materiales del proyecto</a> .  Descomprima el archivo y abra el proyecto <em>Starter</em> en Unity. <br><br>  Vaya a <em>RW / Scenes</em> y abra la escena <em>Principal</em> .  La escena consta de un bot y un laberinto, as√≠ como una interfaz de usuario de terminal que muestra instrucciones.  El dise√±o del nivel se realiza en forma de cuadr√≠cula, lo cual es √∫til cuando movemos visualmente el bot a trav√©s del laberinto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53b/ab9/660/53bab9660bdd0a5017b570d43a57b2d9.png"></div><br>  Si hace clic en <em>Reproducir</em> , veremos que las instrucciones no funcionan.  Esto es normal porque agregaremos esta funcionalidad al tutorial. <br><br>  La parte m√°s interesante de la escena es el GameObject <em>Bot</em> .  Selecci√≥nelo en la ventana Jerarqu√≠a haciendo clic en √©l. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/187/35e/acf/18735eacfd1f8df8920749ea80a12b8f.png"></div><br>  En el Inspector, puede ver que tiene un componente <em>Bot</em> .  Utilizaremos este componente emitiendo comandos de entrada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a5/2e3/2bc/2a52e32bc7feb6baafae6af958cc4910.png"></div><br><h2>  Entendemos la l√≥gica del bot. </h2><br>  Vaya a <em>RW / Scripts</em> y abra el script <em>Bot</em> en el editor de c√≥digo.  No necesita saber qu√© est√° sucediendo en el script de <em>Bot</em> .  Pero eche un vistazo a dos m√©todos: <code>Move</code> y <code>Shoot</code> .  Una vez m√°s, no tiene que descubrir qu√© est√° sucediendo dentro de estos m√©todos, pero debe comprender c√≥mo usarlos. <br><br>  Observe que el m√©todo <code>Move</code> recibe un par√°metro de entrada <code>CardinalDirection</code> .  <code>CardinalDirection</code> es una enumeraci√≥n.  Un elemento de enumeraci√≥n de tipo <code>CardinalDirection</code> puede ser <code>Up</code> , <code>Down</code> , <code>Right</code> o <code>Left</code> .  Dependiendo de <code>CardinalDirection</code> seleccionada <code>CardinalDirection</code> bot se mueve exactamente un cuadrado a lo largo de la cuadr√≠cula en la direcci√≥n correspondiente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02c/72e/8ca/02c72e8ca19f987e6e36774558242058.png"></div><br>  El m√©todo <code>Shoot</code> obliga al bot a disparar proyectiles que destruyen las <em>paredes amarillas</em> , pero son in√∫tiles contra otras paredes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b34/f18/2bb/b34f182bb9c0bb682606d0c5a1beb0fd.gif"></div><br>  Finalmente, eche un vistazo al m√©todo <code>ResetToLastCheckpoint</code> ;  para entender lo que est√° haciendo, mira el laberinto.  Hay puntos en el laberinto llamados <em>puntos de control</em> .  Para pasar el laberinto, el bot necesita llegar al punto de control <em>verde</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4c/d3b/fc9/e4cd3bfc9d59944e28d9a22206141888.png"></div><br>  Cuando un bot pisa un nuevo punto de control, se convierte en el <em>√∫ltimo</em> para √©l.  <code>ResetToLastCheckpoint</code> restablece la posici√≥n del bot, movi√©ndolo al √∫ltimo punto de control. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/829/617/95a/82961795afe53c9b45f1f8037896783c.gif"></div><br>  Si bien no podemos usar estos m√©todos, lo solucionaremos pronto.  Para comenzar, debe aprender sobre el patr√≥n de dise√±o de <em>Comando</em> . <br><br><h2>  ¬øQu√© es el patr√≥n de dise√±o de comandos? </h2><br>  El patr√≥n Command es uno de los 23 patrones de dise√±o descritos en el libro <i>Design Patterns: Elements of Reusable Object-Oriented Software</i> escrito por The Gang of Four por Erich Gamma, Richard Helm, Ralph Johnson y John Vlissides ( <em>GoF</em> , Gang of Four). <br><br>  Los autores informan que "el patr√≥n de Comando encapsula la solicitud como un objeto, lo que nos permite parametrizar otros objetos con diferentes solicitudes, solicitudes de cola o registro, y admitir operaciones reversibles". <br><br>  Wow!  Como es eso <br><br>  Entiendo que esta definici√≥n no es muy simple, as√≠ que analic√©mosla. <br><br>  <em>Encapsulaci√≥n</em> significa que una llamada al m√©todo se puede encapsular como un objeto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07d/5c3/214/07d5c32142de4fd36bd2cd73c543856a.png" width="50%" height="50%"></div><br>  El m√©todo encapsulado puede afectar muchos objetos dependiendo del par√°metro de entrada.  Esto se llama <em>parametrizaci√≥n de</em> otros objetos. <br><br>  El "comando" resultante se puede guardar junto con otros equipos hasta que se ejecuten.  Esta es la <em>cola de</em> solicitudes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/035/637/264/0356372640076e0829d2a427cf3552f1.png" width="50%" height="50%"></div><br>  <i>Cola de equipo</i> <br><br>  Finalmente, la <em>reversibilidad</em> significa que las operaciones se pueden revertir utilizando la funci√≥n Deshacer. <br><br>  OK, pero ¬øc√≥mo se refleja esto en el c√≥digo? <br><br>  La clase <em>Command</em> tendr√° un m√©todo <em>Execute</em> , que recibe como par√°metro de entrada el objeto (por el cual se ejecuta el comando) llamado <em>Receiver</em> .  Es decir, de hecho, el m√©todo Execute est√° <em>encapsulado</em> por la clase Command. <br><br>  Muchas instancias de la clase Command se pueden pasar como objetos ordinarios, es decir, se pueden almacenar en estructuras de datos como una cola, una pila, etc. <br><br>  Para ejecutar un comando, debe llamar a su m√©todo Execute.  La clase que comienza la ejecuci√≥n se llama <em>Invoker</em> . <br><br>  El proyecto actualmente contiene una clase vac√≠a llamada <code>BotCommand</code> .  En la siguiente secci√≥n, implementaremos la implementaci√≥n de lo anterior para permitir que el bot realice acciones utilizando la plantilla de Comando. <br><br><h2>  Mover el bot </h2><br><h3>  Implementaci√≥n del patr√≥n de comando </h3><br>  En esta secci√≥n, implementamos el patr√≥n de Comando.  Hay muchas formas de implementarlo.  En este tutorial cubriremos uno de ellos. <br><br>  Para comenzar, vaya a <em>RW / Scripts</em> y abra el script <em>BotCommand</em> en el editor.  La clase <code>BotCommand</code> todav√≠a <code>BotCommand</code> vac√≠a, pero no por mucho tiempo. <br><br>  Inserte el siguiente c√≥digo en la clase: <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private readonly string commandName; //2 public BotCommand(ExecuteCallback executeMethod, string name) { Execute = executeMethod; commandName = name; } //3 public delegate void ExecuteCallback(Bot bot); //4 public ExecuteCallback Execute { get; private set; } //5 public override string ToString() { return commandName; }</span></span></code> </pre> <br>  ¬øQu√© est√° pasando aqu√≠? <br><br><ol><li>  La variable <code>commandName</code> usa simplemente para almacenar el nombre del comando legible por humanos.  No es necesario usarlo en la plantilla, pero lo necesitaremos m√°s adelante en el tutorial. </li><li>  El constructor de <code>BotCommand</code> recibe una funci√≥n y una cadena.  Esto nos ayudar√° a configurar el m√©todo <code>Execute</code> del objeto Command y su <code>name</code> . </li><li>  El delegado <code>ExecuteCallback</code> define el tipo de m√©todo encapsulado.  El m√©todo encapsulado devolver√° nulo y aceptar√° como par√°metro de entrada un objeto de tipo <code>Bot</code> (componente <em>Bot</em> ). </li><li>  La propiedad <code>Execute</code> se referir√° al m√©todo encapsulado.  Lo usaremos para llamar al m√©todo encapsulado. </li><li>  El m√©todo <code>ToString</code> se reemplaza para devolver la cadena <code>commandName</code> .  Esto es conveniente, por ejemplo, para usar en la interfaz de usuario. </li></ol><br>  Guarde los cambios y listo.  Hemos implementado con √©xito el patr√≥n de comando. <br><br>  Queda por usarlo. <br><br><h3>  Trabajo en equipo </h3><br>  Abra <em>BotInputHandler</em> en la carpeta <em>RW / Scripts</em> . <br><br>  Aqu√≠ crearemos cinco instancias de <code>BotCommand</code> .  Estas instancias encapsular√°n m√©todos para mover el GameObject Bot hacia arriba, abajo, izquierda y derecha, as√≠ como para disparar. <br><br>  Para implementar esto, inserte lo siguiente en esta clase: <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private static readonly BotCommand MoveUp = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Up); }, "moveUp"); //2 private static readonly BotCommand MoveDown = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Down); }, "moveDown"); //3 private static readonly BotCommand MoveLeft = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Left); }, "moveLeft"); //4 private static readonly BotCommand MoveRight = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Right); }, "moveRight"); //5 private static readonly BotCommand Shoot = new BotCommand(delegate (Bot bot) { bot.Shoot(); }, "shoot");</span></span></code> </pre> <br>  En cada una de estas instancias, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">se</a> pasa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">un m√©todo an√≥nimo</a> al constructor.  Este m√©todo an√≥nimo se encapsular√° dentro del objeto de comando correspondiente.  Como puede ver, la firma de cada uno de los m√©todos an√≥nimos cumple con los requisitos especificados por el delegado <code>ExecuteCallback</code> . <br><br>  Adem√°s, el segundo par√°metro para el constructor es una cadena que indica el nombre del comando.  Este nombre ser√° devuelto por el m√©todo <code>ToString</code> de la instancia de comando.  M√°s tarde lo aplicaremos para la interfaz de usuario. <br><br>  En las primeras cuatro instancias, los m√©todos an√≥nimos llaman al m√©todo <code>Move</code> en el objeto <code>bot</code> .  Sin embargo, sus par√°metros de entrada son diferentes. <br><br>  Los <code>MoveUp</code> , <code>MoveDown</code> , <code>MoveLeft</code> y <code>MoveRight</code> pasan los par√°metros de <code>Move</code> <code>CardinalDirection.Up</code> , <code>CardinalDirection.Down</code> , <code>CardinalDirection.Left</code> y <code>CardinalDirection.Right</code> .  Como se menciona en la secci√≥n <i>Qu√© es el patr√≥n de dise√±o de comandos</i> , indican diferentes direcciones para que se mueva el GameObject Bot. <br><br>  En la quinta instancia, el m√©todo an√≥nimo llama al m√©todo <code>Shoot</code> para el objeto <code>bot</code> .  Gracias a esto, el bot disparar√° un shell durante la ejecuci√≥n del comando. <br><br>  Ahora que hemos creado los comandos, necesitamos acceder de alguna manera cuando el usuario realiza una entrada. <br><br>  Para hacer esto, <code>BotInputHandler</code> siguiente c√≥digo en <code>BotInputHandler</code> , inmediatamente despu√©s de las instancias de comando: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BotCommand </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.W)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveUp; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.S)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveDown; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.D)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveRight; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.A)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveLeft; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.F)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Shoot; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  El m√©todo <code>HandleInput</code> devuelve una instancia del comando dependiendo de la tecla presionada por el usuario.  Guarde sus cambios antes de continuar. <br><br><h3>  Aplicando comandos </h3><br>  Genial, ahora es el momento de usar los equipos que creamos.  Vaya a <em>RW / Scripts</em> nuevamente y abra el script <em>SceneManager</em> en el editor.  En esta clase, notar√° un enlace a una variable <code>uiManager</code> de tipo <code>UIManager</code> . <br><br>  La clase <code>UIManager</code> proporciona m√©todos de ayuda √∫tiles para la <em>interfaz de usuario</em> del <em>terminal</em> que usamos en esta escena.  Si se utiliza el m√©todo de <code>UIManager</code> , el tutorial explicar√° lo que hace, pero en general para nuestros prop√≥sitos no es necesario conocer su estructura interna. <br><br>  Adem√°s, la variable <code>bot</code> refiere al componente bot conectado al GameObject <em>Bot</em> . <br><br>  Ahora agregue el siguiente c√≥digo a la clase <code>SceneManager</code> , reemplaz√°ndolo con el comentario <code>//1</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private List&lt;BotCommand&gt; botCommands = new List&lt;BotCommand&gt;(); private Coroutine executeRoutine; //2 private void Update() { if (Input.GetKeyDown(KeyCode.Return)) { ExecuteCommands(); } else { CheckForBotCommands(); } } //3 private void CheckForBotCommands() { var botCommand = BotInputHandler.HandleInput(); if (botCommand != null &amp;&amp; executeRoutine == null) { AddToCommands(botCommand); } } //4 private void AddToCommands(BotCommand botCommand) { botCommands.Add(botCommand); //5 uiManager.InsertNewText(botCommand.ToString()); } //6 private void ExecuteCommands() { if (executeRoutine != null) { return; } executeRoutine = StartCoroutine(ExecuteCommandsRoutine()); } private IEnumerator ExecuteCommandsRoutine() { Debug.Log("Executing..."); //7 uiManager.ResetScrollToTop(); //8 for (int i = 0, count = botCommands.Count; i &lt; count; i++) { var command = botCommands[i]; command.Execute(bot); //9 uiManager.RemoveFirstTextLine(); yield return new WaitForSeconds(CommandPauseTime); } //10 botCommands.Clear(); bot.ResetToLastCheckpoint(); executeRoutine = null; }</span></span></code> </pre> <br>  Wow, cu√°nto c√≥digo!  Pero no te preocupes;  finalmente estamos listos para el primer lanzamiento real del proyecto en la ventana del juego. <br><br>  Explicar√© el c√≥digo m√°s tarde.  Recuerde guardar los cambios. <br><br><h3>  Ejecutar el juego para probar la plantilla de Comando </h3><br>  As√≠ que ahora es el momento de construir;  Haga clic en <em>Reproducir</em> en el editor de Unity. <br><br>  Deber√≠a poder ingresar comandos de movimiento con las <em>teclas WASD</em> .  Para ingresar el comando de disparo, presione la tecla <em>F.</em>  Para ejecutar comandos, presione <em>Entrar</em> . <br><br><blockquote>  <em>Nota</em> : hasta que se complete el proceso de ejecuci√≥n, no es posible ingresar nuevos comandos. </blockquote><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20b/ef8/483/20bef8483dd70829836bd9234178f5dd.gif"></div><br>  Observe que las l√≠neas se agregan a la interfaz de usuario del terminal.  Los equipos en la interfaz de usuario se indican con sus nombres.  Esto es posible gracias a la variable <code>commandName</code> . <br><br>  Adem√°s, observe c√≥mo se desplaza la IU antes de la ejecuci√≥n y c√≥mo se eliminan las l√≠neas durante la ejecuci√≥n. <br><br><h3>  Estudiamos los equipos m√°s de cerca. </h3><br>  Es hora de aprender el c√≥digo que agregamos en la secci√≥n "Aplicaci√≥n de comandos": <br><br><ol><li>  La lista <code>botCommands</code> almacena enlaces a instancias de <code>BotCommand</code> .  Recuerde que para ahorrar memoria, solo podemos crear cinco instancias de comandos, pero puede haber varias referencias a un comando.  Adem√°s, la variable <code>executeCoroutine</code> refiere a <code>ExecuteCommandsRoutine</code> , que controla la ejecuci√≥n del comando. </li><li>  <code>Update</code> comprueba si el usuario ha presionado la tecla Intro;  si es as√≠, llama a <code>ExecuteCommands</code> ; de lo contrario, se llama a <code>ExecuteCommands</code> . </li><li>  <code>CheckForBotCommands</code> utiliza el m√©todo est√°tico <code>HandleInput</code> del <code>BotInputHandler</code> para verificar si el usuario ha completado la entrada y, de ser as√≠, se <em>devuelve</em> el comando.  El comando devuelto se pasa a <code>AddToCommands</code> .  Sin embargo, si los comandos se ejecutan, es decir  si <code>executeRoutine</code> no <code>executeRoutine</code> nulo, regresar√° sin pasar nada a <code>AddToCommands</code> .  Es decir, el usuario debe esperar hasta su finalizaci√≥n. </li><li>  <code>AddToCommands</code> agrega un nuevo enlace a la instancia <em>devuelta</em> del comando en <code>botCommands</code> . </li><li>  El m√©todo <code>InsertNewText</code> de la clase <code>InsertNewText</code> agrega una nueva l√≠nea de texto a la interfaz de usuario del terminal.  Una cadena de texto es una cadena que se pasa como par√°metro de entrada.  En este caso, le pasamos commandName. </li><li>  El m√©todo <code>ExecuteCommandsRoutine</code> inicia <code>ExecuteCommandsRoutine</code> . </li><li>  <code>ResetScrollToTop</code> desde <code>UIManager</code> desplaza la IU del terminal hacia arriba.  Esto se hace justo antes del inicio de la ejecuci√≥n. </li><li>  <code>ExecuteCommandsRoutine</code> contiene un bucle <code>for</code> que itera sobre los comandos dentro de la lista <code>botCommands</code> y los ejecuta uno por uno, pasando el objeto <code>bot</code> al m√©todo devuelto por la propiedad <code>Execute</code> .  Despu√©s de cada ejecuci√≥n, se agrega una pausa en <code>CommandPauseTime</code> segundos. </li><li>  El m√©todo <code>RemoveFirstTextLine</code> de <code>UIManager</code> elimina la primera l√≠nea de texto en la interfaz de usuario del terminal, si existe.  Es decir, cuando se ejecuta un comando, su nombre se elimina de la interfaz de usuario. </li><li>  Despu√©s de completar todos los comandos <code>botCommands</code> se borra y el bot se restablece al √∫ltimo punto de interrupci√≥n usando <code>ResetToLastCheckpoint</code> .  Al final, <code>executeRoutine</code> <code>null</code> y el usuario puede continuar ingresando comandos. </li></ol><br><h2>  Implementaci√≥n de las funciones Deshacer y Rehacer </h2><br>  Ejecute la escena nuevamente e intente llegar al punto de control verde. <br><br>  Notar√° que si bien no podemos cancelar el comando ingresado.  Esto significa que si comete un error, no puede regresar hasta completar todos los comandos que ingresa.  Puede solucionar esto agregando las funciones <em>Deshacer</em> y <em>Rehacer</em> . <br><br>  Vuelva a <em>SceneManager.cs</em> y agregue la siguiente declaraci√≥n de variable inmediatamente despu√©s de la Declaraci√≥n de <i>lista</i> para <code>botCommands</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Stack&lt;BotCommand&gt; undoStack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;BotCommand&gt;();</code> </pre> <br>  La variable <code>undoStack</code> es una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">pila</a> (de la familia Colecciones) que almacenar√° todas las referencias a comandos que se pueden deshacer. <br><br>  Ahora agregamos dos m√©todos <code>UndoCommandEntry</code> y <code>RedoCommandEntry</code> que ejecutar√°n Deshacer y Rehacer.  En la clase <code>SceneManager</code> , <code>SceneManager</code> siguiente c√≥digo despu√©s de <code>ExecuteCommandsRoutine</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UndoCommandEntry</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1 if (executeRoutine != null || botCommands.Count == 0) { return; } undoStack.Push(botCommands[botCommands.Count - 1]); botCommands.RemoveAt(botCommands.Count - 1); //2 uiManager.RemoveLastTextLine(); } private void RedoCommandEntry() { //3 if (undoStack.Count == 0) { return; } var botCommand = undoStack.Pop(); AddToCommands(botCommand); }</span></span></code> </pre> <br>  Analicemos el c√≥digo: <br><br><ol><li>  Si se ejecutan comandos o la lista <code>botCommands</code> vac√≠a, el m√©todo <code>UndoCommandEntry</code> nada.  De lo contrario, escribe un enlace al √∫ltimo comando ingresado en la pila <code>undoStack</code> .  Esto tambi√©n elimina el enlace al comando de la lista de <code>botCommands</code> . </li><li>  El m√©todo <code>RemoveLastTextLine</code> de <code>UIManager</code> elimina la √∫ltima l√≠nea de texto de la interfaz de usuario del terminal para que coincida con el contenido de <code>botCommands</code> . </li><li>  Si la pila <code>undoStack</code> vac√≠a, entonces <code>RedoCommandEntry</code> no hace nada.  De lo contrario, extrae el √∫ltimo comando de la parte superior de <code>undoStack</code> y lo agrega de nuevo a la lista de <code>AddToCommands</code> usando <code>AddToCommands</code> . </li></ol><br>  Ahora agregaremos la entrada del teclado para usar estas funciones.  Dentro de la clase <code>SceneManager</code> reemplace el cuerpo del m√©todo <code>Update</code> con el siguiente c√≥digo: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.Return)) { ExecuteCommands(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.U)) <span class="hljs-comment"><span class="hljs-comment">//1 { UndoCommandEntry(); } else if (Input.GetKeyDown(KeyCode.R)) //2 { RedoCommandEntry(); } else { CheckForBotCommands(); }</span></span></code> </pre> <br><ol><li>  Cuando presiona la tecla <em>U</em> , se <code>UndoCommandEntry</code> m√©todo <code>UndoCommandEntry</code> . </li><li>  Cuando presiona la tecla <em>R</em> , se <code>RedoCommandEntry</code> m√©todo <code>RedoCommandEntry</code> . </li></ol><br><h3>  Manejo de cajas de borde </h3><br>  ¬°Genial, ya casi hemos terminado!  Pero primero, debemos hacer lo siguiente: <br><br><ol><li>  Al ingresar un nuevo comando, la pila <code>undoStack</code> debe <code>undoStack</code> . </li><li>  Antes de ejecutar comandos, la pila <code>undoStack</code> debe <code>undoStack</code> . </li></ol><br>  Para implementar esto, primero debemos agregar un nuevo m√©todo a <code>SceneManager</code> .  Inserte el siguiente m√©todo despu√©s de <code>CheckForBotCommands</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddNewCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BotCommand botCommand</span></span></span><span class="hljs-function">)</span></span> { undoStack.Clear(); AddToCommands(botCommand); }</code> </pre> <br>  Este m√©todo borra <code>undoStack</code> y luego llama al m√©todo <code>AddToCommands</code> . <br><br>  Ahora reemplace la llamada a <code>AddToCommands</code> dentro de <code>CheckForBotCommands</code> con el siguiente c√≥digo: <br><br><pre> <code class="cs hljs"> AddNewCommand(botCommand);</code> </pre> <br>  Luego inserte la siguiente l√≠nea despu√©s de la <code>if</code> dentro del m√©todo <code>ExecuteCommands</code> para borrar antes de ejecutar los comandos <code>undoStack</code> : <br><br><pre> <code class="cs hljs"> undoStack.Clear();</code> </pre> <br>  ¬°Y finalmente hemos terminado! <br><br>  Guarda tu trabajo.  Construye el proyecto y haz clic en el editor <em>Play</em> .  Ingrese los comandos como antes.  Presione <em>U</em> para cancelar los comandos.  Presione <em>R</em> para repetir los comandos cancelados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/cfb/edf/fefcfbedf0b2e0711f2e831b0d069ebf.gif" width="1024" height="576"></div><br>  Intenta llegar al punto de control verde. <br><br><h2>  ¬øA d√≥nde ir despu√©s? </h2><br>  Para aprender m√°s sobre los patrones de dise√±o utilizados en la programaci√≥n de juegos, te recomiendo que estudies los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Patrones de programaci√≥n de juegos de</a> Robert Nystrom. <br><br>  Para obtener m√°s informaci√≥n sobre las t√©cnicas avanzadas de C #, tome el curso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">Colecciones de C #, Lambdas y el</a> curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener">LINQ</a> . <br><br><h3>  Tarea </h3><br>  Como tarea, intenta llegar al punto de control verde al final del laberinto.  Escond√≠ una de las soluciones debajo del spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Soluci√≥n</b> <div class="spoiler_text"><ul><li>  moveUp √ó 2 </li><li>  moveRight √ó 3 </li><li>  moveUp √ó 2 </li><li>  moverse a la izquierda </li><li>  disparar </li><li>  moveLeft √ó 2 </li><li>  moveUp √ó 2 </li><li>  moveLeft √ó 2 </li><li>  moveDown √ó 5 </li><li>  moverse a la izquierda </li><li>  disparar </li><li>  moverse a la izquierda </li><li>  moveUp √ó 3 </li><li>  disparar √ó 2 </li><li>  moveUp √ó 5 </li><li>  moveRight √ó 3 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dab/f9e/05f/dabf9e05f3cb79ab20a6a663108295fe.png"></div></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/463953/">https://habr.com/ru/post/463953/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../463933/index.html">Un script de Python de 20 l√≠neas que les desea a los padres buenos d√≠as todos los d√≠as a trav√©s de WhatsApp</a></li>
<li><a href="../463937/index.html">No tengo nada que esconder</a></li>
<li><a href="../463939/index.html">SimbirSoft ha lanzado una soluci√≥n m√≥vil para compa√±√≠as de seguros</a></li>
<li><a href="../463943/index.html">Las desventuras del unicornio negro</a></li>
<li><a href="../463951/index.html">c.tech: Cassandra Meetup # 2</a></li>
<li><a href="../463955/index.html">¬øC√≥mo desarrollar un concepto para cambiar la plataforma IP? Instrucciones de uso</a></li>
<li><a href="../463957/index.html">C√≥mo implementar una lista de entrevistas enlazadas individualmente</a></li>
<li><a href="../463961/index.html">Mapeador propio o un poco sobre ExpressionTrees</a></li>
<li><a href="../463963/index.html">Reconocimiento facial en un sitio de construcci√≥n</a></li>
<li><a href="../463965/index.html">Aplicaci√≥n de composici√≥n tipogr√°fica en LaTeX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>