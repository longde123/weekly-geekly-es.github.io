<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óæÔ∏è üôèüèª üèáüèæ Interruptions √† partir de p√©riph√©riques externes dans un syst√®me x86. Partie 1. L'√©volution des contr√¥leurs d'interruption üôèüèª üê± üïé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je voudrais examiner les m√©canismes de livraison des interruptions √† partir de p√©riph√©riques externes dans le syst√®me x86 et essayer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interruptions √† partir de p√©riph√©riques externes dans un syst√®me x86. Partie 1. L'√©volution des contr√¥leurs d'interruption</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430548/">  Dans cet article, je voudrais examiner les m√©canismes de livraison des interruptions √† partir de p√©riph√©riques externes dans le syst√®me x86 et essayer de r√©pondre aux questions: <br><br><ul><li>  Qu'est-ce que le PIC et √† quoi sert-il? </li><li>  Qu'est-ce que l'APIC et √† quoi sert-il?  A quoi servent LAPIC et I / O APIC? </li><li>  Quelles sont les diff√©rences entre APIC, xAPIC et x2APIC? </li><li>  Qu'est-ce que MSI?  Quelles sont les diff√©rences entre MSI et MSI-X? </li><li>  Quel est le lien entre les tables $ PIR, MPtable et ACPI? </li></ul><br>  Si vous √™tes int√©ress√© √† recevoir une r√©ponse √† l'une de ces questions ou si vous voulez simplement vous familiariser avec l'√©volution des contr√¥leurs d'interruption dans le syst√®me x86, bienvenue √† cat. <br><a name="habracut"></a><br><h3>  Pr√©sentation </h3><br>  Nous savons tous ce qu'est une interruption.  Pour ceux qui ne le sont pas, citez wikipedia: <br><br><blockquote> Interruption (interruption en anglais) - signal provenant d'un logiciel ou d'un mat√©riel informant le processeur de la survenue de tout √©v√©nement n√©cessitant une attention imm√©diate.  L'interruption informe le processeur de l'occurrence d'un √©v√©nement de haute priorit√© n√©cessitant une interruption du code actuel ex√©cut√© par le processeur.  Le processeur r√©pond en suspendant son activit√© actuelle, en enregistrant son √©tat et en ex√©cutant une fonction appel√©e gestionnaire d'interruption (ou gestionnaire d'interruption) qui r√©pond √† l'√©v√©nement et le traite, apr√®s quoi il rend le contr√¥le au code interrompu. <br><br>  Selon la source du signal d'interruption, ils sont r√©partis en: <br><br><ul><li>  asynchrone ou externe (mat√©riel) - √©v√©nements qui proviennent de p√©riph√©riques mat√©riels externes (tels que des p√©riph√©riques) et peuvent se produire √† tout moment arbitraire: un signal provenant d'une minuterie, d'une carte r√©seau ou d'un lecteur de disque, des frappes de touches, un mouvement de souris.  Le fait qu'une telle interruption se produit dans le syst√®me est interpr√©t√© comme une demande d'interruption (IRQ) - les p√©riph√©riques signalent qu'ils n√©cessitent une attention de la part du syst√®me d'exploitation; </li><li>  √©v√©nements synchrones ou internes dans le processeur lui-m√™me r√©sultant de la violation de certaines conditions lors de l'ex√©cution du code machine: division par z√©ro ou d√©bordement de pile, acc√®s √† des adresses m√©moire non valides ou code op√©ration non valide; </li></ul></blockquote>  Dans cet article, je voudrais discuter des interruptions IRQ externes. <br><br>  Pourquoi sont-ils n√©cessaires?  Supposons que nous voulons effectuer une action avec un paquet d'entr√©e pour une carte r√©seau √† son arriv√©e.  Afin de ne pas demander constamment √† la carte r√©seau "avez-vous un nouveau package?"  et ne gaspillez pas les ressources du processeur √† ce sujet; vous pouvez utiliser l'interruption IRQ.  La ligne d'interruption du p√©riph√©rique est connect√©e √† la ligne INTR du processeur et lorsqu'un paquet est re√ßu, la carte r√©seau ¬´tire¬ª cette ligne.  Le processeur comprend qu'il contient des informations et lit le paquet. <br><br>  Mais que faire s'il y a beaucoup d'appareils?  Vous ne pouvez pas obtenir suffisamment de tous les p√©riph√©riques externes des jambes du processeur. <br><br><img src="https://habrastorage.org/webt/vg/3q/3v/vg3q3v7kx8vjttp43xo99o8pccs.png"><br><br>  Pour r√©soudre ce probl√®me, ils ont propos√© une puce - un contr√¥leur d'interruption. <br><br><h3>  Pic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">osdev</a> ) <br><br>  La premi√®re √©tait une puce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Intel 8259 PIC</a> .  8 lignes d'entr√©e (IRQ0-7) et une sortie reliant le contr√¥leur √† la ligne INTR du processeur.  Lorsqu'une interruption d'un p√©riph√©rique se produit, 8259 tire la ligne INTR, le processeur comprend que certains p√©riph√©riques signalent une interruption et interroge le PIC pour comprendre quel segment IRQx a provoqu√© l'interruption.  Il y a un d√©lai suppl√©mentaire pour cette enqu√™te, mais le nombre de lignes d'interruption passe √† 8. <br><br><img src="https://habrastorage.org/webt/le/yf/6e/leyf6enogyzp6flpijo2d0x1w9g.png"><br><br>  Cependant, 8 lignes se sont rapidement r√©v√©l√©es petites, et pour augmenter leur nombre, 2 contr√¥leurs 8259 (ma√Ætre et esclave) connect√©s en cascade (Dual PIC) ont commenc√© √† √™tre utilis√©s. <br><br>  Les IRQ 0 √† 7 sont trait√©s par le premier PIC Intel 8259 (ma√Ætre) et les IRQ 8 √† 15 sont trait√©s par le second PIC 8259 (esclave).  Seul un ma√Ætre signale l'occurrence d'une interruption.  Si une interruption se produit sur les lignes 8 √† 15, le deuxi√®me PIC (esclave) signale une interruption au ma√Ætre via IRQ 2, et le ma√Ætre √† son tour signale la CPU.  Cette interruption en cascade prend l'une des 16 lignes, mais donne finalement 15 interruptions disponibles pour les appareils. <br><br><img src="https://habrastorage.org/webt/xj/yn/dh/xjyndhabujjwz0alrbx831zfzt8.png"><br><br>  Le circuit s'est impos√©, et c'est ce qu'ils veulent dire quand ils parlent maintenant de PIC (Programm Interrupt Controller).  Par la suite, les contr√¥leurs 8259 ont re√ßu quelques am√©liorations et sont devenus connus sous le nom de 8259A, et ce circuit a √©t√© inclus dans le chipset.  √Ä une √©poque o√π le bus principal pour connecter des p√©riph√©riques externes √©tait le bus ISA, un tel syst√®me dans son ensemble √©tait suffisant.  Il √©tait seulement n√©cessaire de s'assurer que diff√©rents p√©riph√©riques ne se connectaient pas √† la m√™me ligne IRQ pour √©viter les conflits, car les interruptions ISA ne sont pas partag√©es. <br><br>  La disposition des interruptions pour les appareils √©tait g√©n√©ralement plus ou moins standard <br><br>  Exemple (tir√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'ici</a> ): <br>  IRQ 0 - minuterie syst√®me <br>  IRQ 1 - contr√¥leur de clavier <br>  IRQ 2 - cascade (interruption du contr√¥leur esclave) <br>  IRQ 3 - port s√©rie COM2 <br>  IRQ 4 - port s√©rie COM1 <br>  IRQ 5 - port parall√®le 2 et 3 ou carte son <br>  IRQ 6 - contr√¥leur de disquette <br>  IRQ 7 - port parall√®le 1 <br>  IRQ 8 - Minuterie RTC <br>  IRQ 9 - ACPI <br>  IRQ 10 - ouvert / SCSI / NIC <br>  IRQ 11 - ouvert / SCSI / NIC <br>  IRQ 12 - contr√¥leur de souris <br>  IRQ 13 - coprocesseur math√©matique <br>  IRQ 14 - Canal ATA 1 <br>  IRQ 15 - Canal ATA 2 <br><br>  La configuration et le travail avec les microcircuits 8259 sont effectu√©s via les ports d'E / S: <br><div class="scrollable-table"><table><tbody><tr><th>  Puce </th><th>  S'inscrire </th><th>  Port d'E / S </th></tr><tr><td>  Photo ma√Ætre </td><td>  Commande </td><td>  0x0020 </td></tr><tr><td>  Photo ma√Ætre </td><td>  Les donn√©es </td><td>  0x0021 </td></tr><tr><td>  Pic esclave </td><td>  Commande </td><td>  0x00A0 </td></tr><tr><td>  Pic esclave </td><td>  Les donn√©es </td><td>  0x00A1 </td></tr></tbody></table></div><br>  ‚Üí La documentation du 8259A est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici.</a> <br><br>  Le bus ISA a √©t√© remplac√© par le bus PCI.  Et le nombre de p√©riph√©riques a clairement commenc√© √† d√©passer le nombre 15, de plus, contrairement au bus ISA statique, dans ce cas, les p√©riph√©riques peuvent √™tre ajout√©s dynamiquement au syst√®me.  Mais heureusement, dans ce bus, les interruptions peuvent √™tre partag√©es (c'est-√†-dire que plusieurs appareils peuvent √™tre connect√©s √† la m√™me ligne IRQ).  En cons√©quence, afin de r√©soudre le probl√®me du manque de lignes IRQ, ils ont d√©cid√© de regrouper les interruptions de tous les p√©riph√©riques PCI en lignes PIRQ (Programmable Interrupt Request). <br><br>  Disons que nous avons 4 lignes d'interruption librement sur le contr√¥leur PIC et 20 p√©riph√©riques PCI.  Nous combinons les interruptions de 5 appareils par ligne PIRQx et connectons les lignes PIRQx au contr√¥leur.  Si une interruption se produit sur la ligne PIRQx, le processeur devra interroger tous les p√©riph√©riques connect√©s √† cette ligne afin de comprendre de qui provient l'interruption, mais en g√©n√©ral cela r√©sout le probl√®me.  Un p√©riph√©rique qui lie des lignes d'interruption PCI dans une ligne PIRQ est souvent appel√© un routeur PIR. <br><br>  Dans cette m√©thode, vous devez vous assurer que les lignes PIRQx ne sont pas connect√©es aux lignes IRQx sur lesquelles les interruptions ISA sont d√©j√† d√©marr√©es (car cela entra√Ænera des conflits), et que les lignes PIRQx sont √©quilibr√©es (apr√®s tout, plus nous avons connect√© d'appareils √† la m√™me ligne PIRQ, plus vous avez besoin d'appareils interrogera le processeur pour comprendre lequel de ces p√©riph√©riques a provoqu√© l‚Äôinterruption). <br><br><img src="https://habrastorage.org/webt/u_/jr/u9/u_jru9pemdeda2xvvbqihvgtp3y.png"><br><br>  <b>Remarque</b> : le p√©riph√©rique PCI -&gt; le mappage PIR est montr√© de mani√®re abstraite dans l'image, car en fait c'est un peu plus compliqu√©.  En r√©alit√©, chaque p√©riph√©rique PCI poss√®de 4 lignes d'interruption (INTA, INTB, INTC, INTD).  Chaque p√©riph√©rique PCI peut avoir jusqu'√† 8 fonctions, et maintenant chaque fonction a une interruption INTx.  L'INTx que chaque fonction de l'appareil va tirer est d√©termin√©e par la configuration du chipset. <br><br>  En substance, les fonctions sont des blocs logiques s√©par√©s.  Par exemple, dans un p√©riph√©rique PCI, il peut y avoir une fonction de contr√¥leur Smbus, une fonction de contr√¥leur SATA, une fonction de pont LPC.  C√¥t√© OS, chaque fonction est un p√©riph√©rique distinct avec son propre espace de configuration PCI Config. <br><br>  Le syst√®me d'exploitation a transmis des informations sur les interruptions de routage sur le BIOS du contr√¥leur PIC √† l'aide de la table $ PIR et en remplissant les registres 3Ch (INT_LN Interrupt Line (R / W)) et 3Dh (INT_PN Interrupt Pin (RO)) de l'espace de configuration PCI pour chaque fonction.  La sp√©cification de la table $ PIR √©tait auparavant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site Web de Microsoft</a> , mais maintenant elle n'est plus l√†.  Le contenu des lignes de la table $ PIR peut √™tre compris √† partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sp√©cification PCI BIOS</a> [4.2.2.  Obtenez les options de routage d'interruption PCI] ou lisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> <br><br><h3>  Apic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">osdev</a> ) <br><br>  La m√©thode pr√©c√©dente a fonctionn√© jusqu'√† l'apparition de syst√®mes multiprocesseurs.  Le fait est que dans son appareil, PIC peut transmettre des interruptions √† un seul processeur principal.  Mais je voudrais que la charge des processeurs due √† la gestion des interruptions soit √©quilibr√©e.  La solution √† ce probl√®me a √©t√© la nouvelle interface APIC (Advanced PIC). <br><br>  Pour chaque processeur, un contr√¥leur LAPIC sp√©cial (APIC local) est ajout√© et un contr√¥leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">APIC d'E / S</a> est ajout√© pour acheminer les interruptions des p√©riph√©riques.  Tous ces contr√¥leurs sont combin√©s dans un bus commun appel√© APIC (les nouveaux syst√®mes sont d√©sormais connect√©s via un bus syst√®me standard). <br><br>  Lorsqu'une interruption d'un p√©riph√©rique arrive √† la broche APIC d'E / S, le contr√¥leur achemine l'interruption vers le LAPIC de l'un des processeurs.  La pr√©sence d'E / S APIC vous permet d'√©quilibrer la r√©partition des interruptions des p√©riph√©riques externes entre les processeurs. <br><br>  La premi√®re puce APIC √©tait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">82489DX</a> , c'√©tait une puce s√©par√©e qui combine LAPIC et I / O APIC.  Pour cr√©er un syst√®me de 2 processeurs, 3 de ces microcircuits √©taient n√©cessaires.  2 fonctionneraient comme LAPIC et un comme I / O APIC.  Plus tard, la fonctionnalit√© LAPIC a √©t√© directement incluse dans les processeurs et la fonctionnalit√© I / O APIC a √©t√© encadr√©e dans la puce 82093AA. <br><br>  L'E / S APIC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">82093AA</a> contenait 24 broches d'entr√©e et l'architecture APIC pouvait prendre en charge jusqu'√† 16 CPU.  Pour maintenir la compatibilit√© avec les anciens syst√®mes, 0 √† 15 interruptions ont √©t√© allou√©es aux anciennes interruptions ISA.  Et les interruptions des p√©riph√©riques PCI ont commenc√© √† s'afficher sur la ligne IRQ 16-23.  Maintenant, il √©tait possible de ne pas penser aux conflits d'interruption des p√©riph√©riques ISA et PCI.  De plus, gr√¢ce √† l'augmentation du nombre de lignes d'interruption libres, il est √©galement devenu possible d'augmenter le nombre de lignes PIRQx. <br><br><img src="https://habrastorage.org/webt/mc/ra/hj/mcrahjn-owk9qrcmyiixcmhomcq.png"><br><br>  La programmation des E / S APIC et LAPIC se fait via MMIO.  Les registres LAPIC sont g√©n√©ralement situ√©s √† 0xFEE00000, les registres d'E / S APIC √† 0xFE00000.  Bien que, en principe, toutes ces adresses puissent √™tre reconfigur√©es. <br><br>  Comme dans le cas du PIC, au d√©part, les puces individuelles sont devenues plus tard une partie du chipset. <br><br>  Par la suite, l'architecture APIC a √©t√© modernis√©e et la nouvelle version a √©t√© appel√©e xAPIC (x - extended).  R√©trocompatibilit√© conserv√©e avec la version pr√©c√©dente.  Le nombre de CPU possibles dans le syst√®me est pass√© √† 256. <br><br>  La prochaine phase de d√©veloppement de l'architecture s'appelait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">x2APIC</a> .  Le nombre de CPU possibles dans le syst√®me est pass√© √† 2 ^ 32.  Les contr√¥leurs peuvent fonctionner en mode de compatibilit√© xAPIC, ou dans le nouveau mode x2APIC, o√π la programmation LAPIC est effectu√©e non pas via MMIO, mais via les registres MSR (ce qui est beaucoup plus rapide).  A en juger <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par ce lien, le</a> support IOMMU est requis pour que ce mode fonctionne. <br><br>  Il convient de noter que le syst√®me peut avoir plusieurs contr√¥leurs APIC d'E / S.  Par exemple, un pour 24 interruptions dans le pont sud, l'autre pour 32 dans le nord.  Dans le contexte des E / S, les interruptions APIC sont souvent appel√©es GSI (Global System Interrupt).  Donc, dans un tel syst√®me sera GSI 0-55. <br><br>  Y a-t-il un LAPIC int√©gr√© dans le CPU et quelle architecture peut √™tre comprise par les drapeaux de bits dans le CPUID. <br>  Pour que le syst√®me d√©tecte LAPIC et I / O APIC, le BIOS doit fournir des informations √† leur sujet au syst√®me via MPtable (l'ancienne m√©thode) ou via la table ACPI (MADT dans ce cas).  En plus des informations g√©n√©rales, la table MPtable et l'ACPI (cette fois dans la table DSDT) doivent contenir des informations sur le routage des interruptions, c'est-√†-dire des informations sur le p√©riph√©rique qui se trouve sur quelle ligne d'interruption (analogue √† la table $ PIR). <br><br>  Le tableau MPTable se trouve dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://web.archive.org/web/20121002210153/">sp√©cifications</a> officielles.  Auparavant, la sp√©cification √©tait sur le site Web d'Intel, mais maintenant elle ne peut √™tre trouv√©e que dans les archives.  La sp√©cification ACPI se trouve d√©sormais sur le site Web de l'UEFI (version actuelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.2</a> ).  Il convient de noter qu'en utilisant ACPI, vous pouvez sp√©cifier le routage d'interruption pour les syst√®mes sans APIC (au lieu d'utiliser la table $ PIR). <br><br><h3>  Msi </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> ) <br><br>  La version pr√©c√©dente avec APIC est bonne, mais pas sans d√©fauts.  Toutes ces lignes d'interruption de p√©riph√©rique compliquent les circuits et augmentent la probabilit√© d'erreurs.  Le bus PCI a √©t√© remplac√© par PCI express, dans lequel les lignes d'interruption ont simplement √©t√© d√©cid√©es d'√™tre supprim√©es.  Pour maintenir la compatibilit√©, les signaux d'interruption (INTx #) sont √©mul√©s par certains types de messages.  Dans ce sch√©ma, l'ajout logique de lignes d'interruption, qui se faisait auparavant par une connexion physique des fils, est tomb√© sur les √©paules des ponts PCI.  Cependant, la prise en charge des interruptions INTx h√©rit√©es ne prend en charge que la compatibilit√© descendante avec le bus PCI.  En fait, PCI express a propos√© une nouvelle m√©thode de livraison des messages d'interruption - MSI (Message Signaled Interrupts).  Dans cette m√©thode, pour signaler une interruption, l'appareil √©crit simplement dans la zone MMIO allou√©e au processeur LAPIC. <br><br><img src="https://habrastorage.org/webt/8z/qw/7h/8zqw7him-vupzm_wi5glkqtr1ja.png"><br><br>  Auparavant, seules 4 interruptions √©taient attribu√©es √† un p√©riph√©rique PCI (c'est-√†-dire √† toutes ses fonctions), mais il est d√©sormais possible d'adresser jusqu'√† 32 interruptions. <br><br>  Dans le cas de MSI, il n'y a pas de partage pour les lignes, chaque interruption correspond √† son appareil. <br><br>  Les interruptions MSI r√©solvent √©galement un autre probl√®me.  Supposons qu'un p√©riph√©rique effectue une transaction d'√©criture en m√©moire et souhaite signaler son ach√®vement via une interruption.  Mais une transaction d'√©criture peut √™tre retard√©e sur le bus pendant le processus de transfert (que le p√©riph√©rique ne conna√Æt pas du tout), et le signal d'interruption arrivera avant le processeur.  Ainsi, le CPU lira toujours les donn√©es invalides.  Si MSI est utilis√©, les informations sur MSI sont transmises ainsi que les donn√©es, et ne pourront tout simplement pas arriver plus t√¥t. <br><br>  Il convient de noter que les interruptions MSI ne peuvent pas fonctionner sans LAPIC, mais l'utilisation de MSI peut nous remplacer par I / O APIC (simplification de la conception). <br><br>  Par la suite, cette m√©thode a re√ßu l'extension MSI-X.  D√©sormais, chaque appareil peut avoir jusqu'√† 2048 interruptions.  Et il est devenu possible d'indiquer individuellement √† chaque interruption sur quel processeur elle devait √™tre ex√©cut√©e.  Cela peut √™tre tr√®s utile pour les appareils lourdement charg√©s tels que les cartes r√©seau. <br><br>  Aucune table BIOS suppl√©mentaire n'est requise pour la prise en charge MSI.  Mais le p√©riph√©rique doit signaler la prise en charge MSI dans l'une des capacit√©s de sa configuration PCI, et le pilote de p√©riph√©rique doit prendre en charge l'utilisation de MSI. <br><br><h3>  Conclusion </h3><br>  Dans cet article, nous avons examin√© l'√©volution des contr√¥leurs d'interruption et re√ßu des informations th√©oriques g√©n√©rales sur la livraison des interruptions √† partir de p√©riph√©riques externes dans un syst√®me x86. <br><br>  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie suivante,</a> nous verrons comment utiliser sous Linux chacun des contr√¥leurs d√©crits dans la pratique. <br><br><h4>  R√©f√©rences: </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contr√¥leurs d'interruption (Stuff in the Middle)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Que font les diff√©rentes interruptions dans PCIe?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©duction de la latence d'interruption gr√¢ce √† l'utilisation d'interruptions signal√©es par message</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Architecture de traitement des interruptions pour les syst√®mes compatibles Intel</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430548/">https://habr.com/ru/post/fr430548/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430534/index.html">Cr√©ation d'un mod√®le pour Zabbix en utilisant le DVR Trassir SDK comme exemple</a></li>
<li><a href="../fr430536/index.html">Conception de fonctions de fen√™tre r√©sum√©es en une unit√© avec un niveau donn√© de chevauchement</a></li>
<li><a href="../fr430538/index.html">Lisez-vous Scaladoc pour les m√©thodes de collecte ¬´√©videntes¬ª? Ou pourquoi la paresse n'est pas toujours bonne</a></li>
<li><a href="../fr430542/index.html">Webinaire ouvert ¬´Infrastructure en tant que code¬ª</a></li>
<li><a href="../fr430546/index.html">"On pensait que le code serait remplac√© par des diagrammes UML, mais il n'y a pas besoin de le tester": entretien avec Alexei Barantsev</a></li>
<li><a href="../fr430550/index.html">Construire un syst√®me de composants r√©actifs avec Kotlin</a></li>
<li><a href="../fr430552/index.html">D√©marrage de la journ√©e (septembre-octobre 2018)</a></li>
<li><a href="../fr430554/index.html">Chaussures VR brevet√©es par Google que vous pouvez marcher pour toujours</a></li>
<li><a href="../fr430556/index.html">GeekBrains lance un cours de formation de chef de produit</a></li>
<li><a href="../fr430558/index.html">Comment fonctionne la notation dans l'industrie de l'autopartage. Partie 1. Pr√©sentation des outils populaires sur les donn√©es r√©elles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>