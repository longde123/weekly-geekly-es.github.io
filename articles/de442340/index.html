<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåª üëéüèΩ üôçüèª Novtable-Optimierung üö∏ üõ©Ô∏è ‚ôçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mit dem Microsoft-Compiler k√∂nnen Sie beim Deklarieren einer Klasse die Erweiterung "novtable" f√ºr das Attribut "__declspec" hinzuf√ºgen. 

 Das erkl√§r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Novtable-Optimierung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442340/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/py/7c/hg/py7chgcvugycee-wnogzvn5pkog.png"></div><br>  Mit dem Microsoft-Compiler k√∂nnen Sie beim Deklarieren einer Klasse die Erweiterung "novtable" f√ºr das Attribut "__declspec" hinzuf√ºgen. <br><br>  Das erkl√§rte Ziel ist es, die Gr√∂√üe des generierten Codes erheblich zu reduzieren.  In Experimenten mit unseren Komponenten betrug die Abnahme 0,6 bis 1,2 Prozent der Gr√∂√üe der DLL. <br><br>  Anwendbarkeit: Klassen, die nicht direkt von ihnen instanziiert werden sollen. <br><br>  Zum Beispiel: reine Schnittstellenklassen. <br><br>  Im Code sieht es so aus: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> __</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">declspec</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">novtable</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDrawable</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; };</code> </pre> <br>  <i>Hinweis: Das Schl√ºsselwort struct wurde verwendet, um eine Schnittstellenklasse zu deklarieren, um das Beispiel irrelevanter Artikeldetails zu entfernen.</i>  <i>Im Fall der Verwendung einer Klasse m√ºsste man public verwenden, um die "Publizit√§t" von Methoden anzuzeigen.</i>  <i>Aus dem gleichen Grund werde ich der Schnittstellenklasse in diesem Artikel keinen virtuellen Destruktor hinzuf√ºgen.</i> <br><br>  Der Name "novtable" verspricht, dass es keine virtuelle Tabelle geben wird ... Aber wie funktioniert der Mechanismus zum Aufrufen virtueller Funktionen im folgenden Code: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   ,   IDrawable: class Rectangle : public IDrawable { virtual void Draw() const override { } int width; int height; }; ‚Ä¶ IDrawable* drawable = new Rectangle; drawable-&gt;Draw(); //   Rectangle::Draw ‚Ä¶</span></span></code> </pre><br><a name="habracut"></a><br>  Erinnern Sie sich daran, was hinzugef√ºgt wird, wenn eine virtuelle Funktion in einer Klasse deklariert wird: <br><br><ol><li>  Definieren einer Tabelle mit virtuellen Funktionen.  Eine Instanz dieser Tabelle wird f√ºr alle Instanzen der Klasse verwendet. </li><li>  Ein Zeiger auf die virtuelle Funktionstabelle wird den Klassendatenelementen hinzugef√ºgt. </li><li>  Der Code zum Initialisieren dieses Zeigers im Konstruktor der Klasse. </li></ol><br>  In unserem Beispiel gibt es daher eine Deklaration von zwei virtuellen Funktionstabellen: f√ºr IDrawable und f√ºr Rectangle.  Beim Erstellen eines Rechteckobjekts wird zuerst der IDrawable-Konstruktor ausgef√ºhrt, der einen Zeiger auf seine virtuelle Funktionstabelle initialisiert.  Schematisch sieht es so aus: <br><br><img src="https://habrastorage.org/webt/38/dk/dm/38dkdmuwzkydh8bkg9ttmojen60.png"><br>  Da die Zeichenfunktion in IDrawable als rein virtuell deklariert ist ("= 0" wird anstelle des Funktionsk√∂rpers angegeben), wird die Adresse der vom Compiler generierten Purecall-Funktion in die Tabelle der virtuellen Funktionen geschrieben. <br><br>  Dann wird der Rechteckkonstruktor ausgef√ºhrt, der denselben Zeiger initialisiert, jedoch auf seine virtuelle Funktionstabelle: <br><br><img src="https://habrastorage.org/webt/f7/s6/pn/f7s6pnrpvifpt59sangs9njm83a.png"><br><br><h1>  Was macht "novtable" und warum verspricht Microsoft, die Gr√∂√üe des Codes zu reduzieren? </h1><br>  Es ist die unn√∂tige Definition der virtuellen IDrawable-Funktionstabelle und die Initialisierung des Zeigers darauf im IDrawable-Konstruktor, die beim Hinzuf√ºgen von "novtable" aus dem resultierenden Code ausgeschlossen werden. <br><br>  In diesem Fall enth√§lt der Zeiger auf die virtuelle Funktionstabelle beim Erstellen eines IDrawable einen unvorhersehbaren Wert.  Dies sollte uns jedoch nicht st√∂ren, da das Erstellen einer Implementierung mit Zugriff auf virtuelle Funktionen vor der vollst√§ndigen Erstellung des Objekts normalerweise ein Fehler ist.  Wenn beispielsweise eine nicht virtuelle Funktion dieser Klasse im Konstruktor der Basisklasse aufgerufen wird, die wiederum eine virtuelle Funktion aufruft, wird die purecall-Funktion ohne novtable und unvorhersehbares Verhalten mit novtable aufgerufen.  Keine der Optionen ist m√∂glicherweise akzeptabel. <br><br>  Beachten Sie, dass nicht nur die Gr√∂√üe abnimmt, sondern auch das Programm etwas beschleunigt wird. <br><br><h1>  RTTI </h1><br>  Wie Sie wissen, k√∂nnen Sie mit std :: dynamic_cast Zeiger und Links von einer Instanz einer Klasse zu einem Zeiger und einen Link zu einer anderen umwandeln, wenn diese Klassen hierarchisch verwandt und polymorph sind (eine Tabelle mit virtuellen Funktionen enthalten).  Mit dem Operator typeid k√∂nnen Sie wiederum Informationen zur Laufzeit eines Objekts mithilfe des Zeigers (Links) auf das an ihn √ºbergebene Objekt abrufen.  Diese Funktionen werden vom RTTI-Mechanismus bereitgestellt, der Typinformationen verwendet, die sich auf die vtable der Klasse beziehen.  Die Details der Struktur und des Speicherorts h√§ngen vom Compiler ab.  Im Fall des Microsoft-Compilers sieht es so aus: <br><br><img src="https://habrastorage.org/webt/ru/kf/ir/rukfir6ii448tjdtrhpzt84naa4.png"><br><br>  Wenn der Compiler w√§hrend der Kompilierung angewiesen wird, RTTI zu aktivieren, schlie√üt novtable daher auch die Erstellung einer type_info-Definition f√ºr IDrawable und der daf√ºr erforderlichen Servicedaten aus. <br>  Beachten Sie, dass std :: static_cast effizienter ist und keine RTTI erfordert, wenn Sie das Wissen bereitstellen, dass ein reduzierbarer Zeiger (Link) auf die Basisklasse die Implementierung der Ableitung anzeigt. <br><br><h1>  Microsoft-spezifisch </h1><br>  Zus√§tzlich zu MSVC ist diese Funktion mit derselben Syntax in Clang beim Kompilieren unter Windows vorhanden. <br><br><h1>  Schlussfolgerungen </h1><br><ol><li>  __declspec (novtable) - hat keinen Einfluss auf die von Klasseninstanzen belegte Speicherkapazit√§t. </li><li>  Das Reduzieren der Gr√∂√üe und das Beschleunigen des Programms wird sichergestellt, indem die Definition nicht verwendeter virtueller Funktionstabellen, der RTTI-Overhead und das Ausschlie√üen des Initialisierungscodes f√ºr den Zeiger auf die virtuelle Funktionstabelle in den Schnittstellenklassenkonstruktoren eliminiert werden. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442340/">https://habr.com/ru/post/de442340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442328/index.html">H√§ufige Programmiererfehler bei der Bewerbung</a></li>
<li><a href="../de442330/index.html">Aufgaben aus dem Schulbuch II</a></li>
<li><a href="../de442332/index.html">Erwartungen bei der Entwicklung eines Dialogs mit einem Chat-Bot</a></li>
<li><a href="../de442336/index.html">Poker planen: Hinweise zum ersten Eindruck des Entwicklers</a></li>
<li><a href="../de442338/index.html">Redis √§ndert die Lizenz erneut</a></li>
<li><a href="../de442342/index.html">Geschwindigkeitsrekord f√ºr Glasfasernetzwerke mit 500 Gbit / s</a></li>
<li><a href="../de442344/index.html">Verbesserung der Entwicklungsproduktivit√§t mit Vue - Teil 2</a></li>
<li><a href="../de442346/index.html">Redux-Symbiote - Schreibaktionen und Reduzierungen fast schmerzfrei</a></li>
<li><a href="../de442348/index.html">Was wird beim Interview im Juni gefragt oder wie habe ich meinen zweiten Job in der IT gesucht?</a></li>
<li><a href="../de442350/index.html">Nicht-Technologieunternehmen beginnen, k√ºnstliche Intelligenz in gro√üem Umfang einzusetzen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>