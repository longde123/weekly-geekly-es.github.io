<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßôüèº üòé üòÉ Schutz von Zimbra OSE vor Brute-Force- und DoS-Angriffen ü§≠ üà∏ üåí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Open-Source-Edition der Zimbra Collaboration Suite verf√ºgt √ºber mehrere leistungsstarke Tools zur Gew√§hrleistung der Informationssicherheit. Unter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Schutz von Zimbra OSE vor Brute-Force- und DoS-Angriffen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/476640/">  Die Open-Source-Edition der Zimbra Collaboration Suite verf√ºgt √ºber mehrere leistungsstarke Tools zur Gew√§hrleistung der Informationssicherheit.  Unter anderem ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Postscreen</a> eine L√∂sung, um den Mailserver vor Angriffen durch Botnets zu sch√ºtzen, ClamAV ist ein Antivirus, der eingehende Dateien und Briefe auf Malware-Infektionen scannen kann, und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SpamAssassin</a> ist einer der besten Spam-Filter, die es derzeit gibt.  Diese Tools sind jedoch nicht in der Lage, das Zimbra OSE vor Angriffen wie Brute Force zu sch√ºtzen.  Nicht die eleganteste, aber dennoch recht effektive Aufz√§hlung von Passw√∂rtern in einem speziellen W√∂rterbuch birgt nicht nur die Wahrscheinlichkeit eines erfolgreichen Hacks mit allen sich daraus ergebenden Konsequenzen, sondern auch die Entstehung einer erheblichen Belastung des Servers, der alle erfolglosen Versuche verarbeitet, den Server mit Zimbra OSE zu hacken. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="Bild"><br><a name="habracut"></a><br>  Grunds√§tzlich k√∂nnen Sie sich mit Standard-Zimbra-OSE-Tools vor Gewalt sch√ºtzen.  Mit den Einstellungen f√ºr die Kennwortsicherheitsrichtlinie k√∂nnen Sie die Anzahl der fehlgeschlagenen Kennwortversuche festlegen, nach denen das m√∂glicherweise angegriffene Konto gesperrt wird.  Das Hauptproblem bei diesem Ansatz besteht darin, dass Situationen auftreten, in denen die Konten eines oder mehrerer Mitarbeiter aufgrund eines Brute-Force-Angriffs gesperrt werden, mit dem sie nichts zu tun haben, und die daraus resultierende einfache Arbeit der Mitarbeiter dem Unternehmen gro√üe Verluste bringen kann.  Aus diesem Grund sollte diese Option zum Schutz vor brachialer Gewalt nicht angewendet werden. <br><br><img src="https://habrastorage.org/webt/gz/cn/kg/gzcnkguoq2isuxplbgetg-y1ft4.png"><br><br>  Zum Schutz vor Brute Force ist ein spezielles Tool namens DoSFilter viel besser geeignet, das in Zimbra OSE integriert ist und sich automatisch √ºber HTTP von Zimbra OSE trennen kann.  Mit anderen Worten, das Funktionsprinzip von DoSFilter √§hnelt dem Funktionsprinzip von PostScreen, das nur f√ºr ein anderes Protokoll verwendet wird.  DoSFilter wurde urspr√ºnglich entwickelt, um die Anzahl der Aktionen zu begrenzen, die ein einzelner Benutzer ausf√ºhren kann, und bietet au√üerdem Schutz vor Brute-Force-Angriffen.  Der Hauptunterschied zum integrierten Tool in Zimbra besteht darin, dass nach einer bestimmten Anzahl von erfolglosen Versuchen nicht der Benutzer selbst blockiert wird, sondern die IP-Adresse, von der aus mehrere Anmeldeversuche f√ºr das eine oder andere Konto unternommen werden.  Dank dessen kann sich der Systemadministrator nicht nur vor Brute-Force-Angriffen sch√ºtzen, sondern auch verhindern, dass Mitarbeiter des Unternehmens blockiert werden, indem das interne Netzwerk seines Unternehmens einfach zur Liste der vertrauensw√ºrdigen IP-Adressen und Subnetze hinzugef√ºgt wird. <br><br>  Das gro√üe Plus von DoSFilter ist, dass Sie mit diesem Tool zus√§tzlich zu den zahlreichen Anmeldeversuchen f√ºr das eine oder andere Konto automatisch diejenigen Cyberkriminellen blockieren k√∂nnen, die die Authentifizierungsdaten des Mitarbeiters in Besitz genommen und sich dann erfolgreich in seinem Konto angemeldet und mit dem Senden von Hunderten von Anfragen an den Server begonnen haben. <br><br>  Sie k√∂nnen DoSFilter mit den folgenden Konsolenbefehlen konfigurieren: <br><br><ul><li>  <b>zimbraHttpDosFilterMaxRequestsPerSec</b> - Mit diesem Befehl k√∂nnen Sie die maximale Anzahl von Verbindungen festlegen, die f√ºr einen Benutzer zul√§ssig sind.  Standardm√§√üig betr√§gt dieser Wert 30 Verbindungen. </li><li>  <b>zimbraHttpDosFilterDelayMillis</b> - Mit diesem Befehl k√∂nnen Sie die Verz√∂gerung in Millisekunden f√ºr Verbindungen festlegen, die den mit dem vorherigen Befehl festgelegten Grenzwert √ºberschreiten.  Zus√§tzlich zu ganzzahligen Werten kann der Administrator 0 angeben, damit √ºberhaupt keine Verz√∂gerung auftritt, und -1, damit alle Verbindungen, die das angegebene Limit √ºberschreiten, einfach unterbrochen werden.  Standardm√§√üig ist dieser Wert -1. </li><li> <b>zimbraHttpThrottleSafeIPs</b> - Mit diesem Befehl kann der Administrator vertrauensw√ºrdige IP-Adressen und Subnetze angeben, die von den obigen Einschr√§nkungen nicht betroffen sind.  Beachten Sie, dass die Syntax dieses Befehls abh√§ngig vom gew√ºnschten Ergebnis variieren kann.  <b>Wenn Sie</b> beispielsweise den Befehl <b>zmprov mcf zimbraHttpThrottleSafeIPs 127.0.0.1 eingeben</b> , wird die gesamte Liste vollst√§ndig neu geschrieben und nur eine IP-Adresse <b>bleibt</b> darin.  Wenn Sie den Befehl <b>zmprov mcf + zimbraHttpThrottleSafeIPs 127.0.0.1 eingeben</b> , wird die eingegebene IP-Adresse zur <b>Whitelist</b> hinzugef√ºgt.  Ebenso k√∂nnen Sie mithilfe eines Subtraktionszeichens eine beliebige IP-Adresse aus der Liste der zul√§ssigen entfernen. </li></ul><br>  Beachten Sie, dass DoSFilter bei der Verwendung der Zextras Suite Pro-Erweiterungen eine Reihe von Problemen verursachen kann.  Um dies zu vermeiden, empfehlen wir, die Anzahl der gleichzeitigen Verbindungen mit dem Befehl <b>zmprov mcf zimbraHttpDosFilterMaxRequestsPerSec 100</b> von 30 auf 100 zu <b>erh√∂hen</b> .  Dar√ºber hinaus empfehlen wir, das interne Netzwerk des Unternehmens zur Liste der zul√§ssigen hinzuzuf√ºgen.  Dies kann mit dem Befehl <b>zmprov mcf + zimbraHttpThrottleSafeIPs 192.168.0.0/24 erfolgen</b> .  Stellen Sie nach √Ñnderungen an DoSFilter sicher, dass Sie den Mailserver mit dem Befehl <b>zmmailboxdctl restart neu starten</b> . <br><br>  Der Hauptnachteil von DoSFilter besteht darin, dass es auf Anwendungsebene funktioniert und daher die F√§higkeit von Angreifern, verschiedene Aktionen auf dem Server auszuf√ºhren, nur einschr√§nken kann, ohne die F√§higkeit zu beeintr√§chtigen, eine Verbindung mit dem Norden herzustellen.  Aus diesem Grund sind Authentifizierungsanfragen oder das Senden von Briefen an den Server, obwohl dies offensichtlich ein Fehler ist, immer noch eine gute alte DoS-Attacke, die auf einer so hohen Ebene nicht gestoppt werden kann. <br><br>  Um Ihren Unternehmensserver vollst√§ndig mit Zimbra OSE abzusichern, k√∂nnen Sie eine L√∂sung wie Fail2ban verwenden. Hierbei handelt es sich um ein Framework, das die Protokolle des Informationssystems st√§ndig auf wiederholte Aktionen √ºberwacht und den Angreifer durch √Ñndern der Firewall-Einstellungen blockiert.  Wenn Sie auf einer so niedrigen Ebene blockieren, k√∂nnen Sie Angreifer bereits in der Phase der IP-Verbindung zum Server deaktivieren.  Somit kann Fail2Ban den mit DoSFilter erstellten Schutz perfekt erg√§nzen.  Lassen Sie uns herausfinden, wie Sie Fail2Ban mit Zimbra OSE anfreunden und so die Sicherheit der IT-Infrastruktur Ihres Unternehmens erh√∂hen k√∂nnen. <br><br>  Wie jede andere Unternehmensanwendung verwaltet Zimbra Collaboration Suite Open-Source Edition detaillierte Protokolle seiner Arbeit.  Die meisten von ihnen werden als Dateien im Ordner <b>/ opt / zimbra / log /</b> gespeichert.  Hier sind nur einige davon: <br><br><ul><li>  mailbox.log - Jetty Mail Service-Protokolle </li><li>  audit.log - Authentifizierungsprotokolle </li><li>  clamd.log - Antivirus-Protokolle </li><li>  freshclam.log - Antivirus-Aktualisierungsprotokolle </li><li>  convertd.log - Konvertierungsprotokolle f√ºr Anh√§nge </li><li>  zimbrastats.csv - Server-Leistungsprotokolle </li></ul><br>  Zimbra-Protokolle finden Sie auch in der Datei <b>/var/log/zimbra.log</b> , in der die Protokolle von Postfix und Zimbra selbst gespeichert sind. <br><br>  Um unser System vor Brute Force zu sch√ºtzen, √ºberwachen wir <b>mailbox.log</b> , <b>audit.log</b> und <b>zimbra.log</b> . <br><br>  Damit alles funktioniert, m√ºssen Fail2Ban und iptables mit Zimbra OSE auf Ihrem Server installiert sein.  Wenn Sie Ubuntu verwenden, k√∂nnen Sie dies mit den <b>Befehlen dpkg -s fail2ban</b> tun. Wenn Sie jedoch CentOS verwenden, k√∂nnen Sie dies mit den in <b>yum-Liste installierten fail2ban-Befehlen</b> √ºberpr√ºfen.  Falls Sie Fail2Ban nicht installiert haben, ist die Installation kein Problem, da dieses Paket in fast allen Standard-Repositorys enthalten ist. <br><br>  Nachdem die gesamte erforderliche Software installiert wurde, k√∂nnen Sie mit der Konfiguration von Fail2Ban fortfahren.  Erstellen Sie dazu eine Konfigurationsdatei <b>/etc/fail2ban/filter.d/zimbra.conf</b> , in die regul√§re Ausdr√ºcke f√ºr Zimbra-OSE-Protokolle geschrieben werden, die falschen Anmeldeversuchen entsprechen und Fail2Ban-Mechanismen ausl√∂sen.  Hier ist ein Beispiel f√ºr den Inhalt von zimbra.conf mit einer Reihe regul√§rer Ausdr√ºcke, die verschiedenen Fehlern entsprechen, die von Zimbra OSE generiert werden, wenn ein Authentifizierungsversuch fehlschl√§gt: <br><br><pre><code class="plaintext hljs"># Fail2Ban configuration file [Definition] failregex = \[ip=&lt;HOST&gt;;\] account - authentication failed for .* \(no such account\)$ \[ip=&lt;HOST&gt;;\] security - cmd=Auth; .* error=authentication failed for .*, invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=soap; error=authentication failed for .* invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=imap; error=authentication failed for .* invalid password;$ \[oip=&lt;HOST&gt;;.* SoapEngine - handler exception: authentication failed for .*, account not found$ WARN .*;ip=&lt;HOST&gt;;ua=ZimbraWebClient .* security - cmd=AdminAuth; .* error=authentication failed for .*;$ ignoreregex =</code> </pre> <br>  Nachdem die regul√§ren Ausdr√ºcke f√ºr Zimbra OSE kompiliert wurden, ist es Zeit, die Konfiguration von Fail2ban selbst zu bearbeiten.  Die Einstellungen f√ºr dieses Dienstprogramm befinden sich in der Datei <b>/etc/fail2ban/jail.conf</b> .  <b>F√ºr alle F√§lle sichern</b> wir es mit dem Befehl <b>cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.conf.bak</b> .  Danach bringen wir diese Datei in das folgende Formular: <br><br><pre> <code class="plaintext hljs"># Fail2Ban configuration file [DEFAULT] ignoreip = 192.168.0.1/24 bantime = 600 findtime = 600 maxretry = 5 backend = auto [ssh-iptables] enabled = false filter = sshd action = iptables[name=SSH, port=ssh, protocol=tcp] sendmail-whois[name=SSH, dest=admin@company.ru, sender=fail2ban@company.ru] logpath = /var/log/messages maxretry = 5 [sasl-iptables] enabled = false filter = sasl backend = polling action = iptables[name=sasl, port=smtp, protocol=tcp] sendmail-whois[name=sasl, dest=support@company.ru] logpath = /var/log/zimbra.log [ssh-tcpwrapper] enabled = false filter = sshd action = hostsdeny sendmail-whois[name=SSH, dest=support@ company.ru] ignoreregex = for myuser from logpath = /var/log/messages [zimbra-account] enabled = true filter = zimbra action = iptables-allports[name=zimbra-account] sendmail[name=zimbra-account, dest=support@company.ru ] logpath = /opt/zimbra/log/mailbox.log bantime = 600 maxretry = 5 [zimbra-audit] enabled = true filter = zimbra action = iptables-allports[name=zimbra-audit] sendmail[name=Zimbra-audit, dest=support@company.ru] logpath = /opt/zimbra/log/audit.log bantime = 600 maxretry = 5 [zimbra-recipient] enabled = true filter = zimbra action = iptables-allports[name=zimbra-recipient] sendmail[name=Zimbra-recipient, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = 172800 maxretry = 5 [postfix] enabled = true filter = postfix action = iptables-multiport[name=postfix, port=smtp, protocol=tcp] sendmail-buffered[name=Postfix, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = -1 maxretry = 5</code> </pre> <br>  Obwohl dieses Beispiel sehr allgemein gehalten ist, sollten Sie einige Parameter erl√§utern, die Sie m√∂glicherweise √§ndern m√∂chten, wenn Sie Fail2Ban selbst einrichten: <br><br><ul><li>  <b>Ignoreip</b> ( <b>Ignorieren)</b> - Mit diesem Parameter k√∂nnen Sie eine bestimmte IP-Adresse oder ein bestimmtes Subnetz angeben, deren Adresse Fail2Ban nicht √ºberpr√ºfen soll.  In der Regel werden das interne Netzwerk des Unternehmens und andere vertrauensw√ºrdige Adressen zur Liste der ignorierten Adressen hinzugef√ºgt. </li><li>  <b>Bantime</b> - Die Zeit, f√ºr die der Eindringling <b>sperren</b> wird.  Gemessen in Sekunden.  Ein Wert von -1 bedeutet ein unbegrenztes Verbot. </li><li>  <b>Maxretry</b> - Die maximale <b>H√§ufigkeit</b> , mit der eine IP-Adresse versuchen kann, auf den Server zuzugreifen. </li><li>  <b>Sendmail</b> - Eine Einstellung, mit der Sie automatisch E-Mail-Benachrichtigungen √ºber den Betrieb von Fail2Ban senden k√∂nnen. </li><li>  <b>Findtime</b> - Eine Einstellung, mit der Sie das Zeitintervall festlegen k√∂nnen, nach dem die IP-Adresse erneut versuchen kann, auf den Server zuzugreifen, nachdem die maximale Anzahl fehlgeschlagener Versuche ersch√∂pft ist (maxretry-Parameter). </li></ul><br>  Nach dem Speichern der Datei mit den Fail2Ban-Einstellungen muss dieses Dienstprogramm nur noch mit dem <b>Dienst-Befehl fail2ban</b> restart neu gestartet werden.  Nach dem Neustart werden die Hauptprotokolle von Zimbra st√§ndig auf die Einhaltung der regul√§ren Ausdr√ºcke √ºberwacht.  Auf diese Weise kann der Administrator praktisch jeden Eindringling ausschlie√üen, der in die Mailboxen der Zimbra Collaboration Suite Open-Source Edition eindringt, und alle Dienste sch√ºtzen, die in der Zimbra OSE ausgef√ºhrt werden. <br><br>  Bei allen Fragen zur Zextras Suite k√∂nnen Sie sich per E-Mail an die Vertreterin von Zextras, Ekaterina Triandafilidi, wenden: katerina@zextras.com </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de476640/">https://habr.com/ru/post/de476640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de476620/index.html">SP701 + PCAM-5C + 15 Minuten + VITIS = Easy MIPI auf FPGA</a></li>
<li><a href="../de476624/index.html">Qualit√§tspipelines in der mobilen Entwicklung, Teil 1: Android</a></li>
<li><a href="../de476626/index.html">PVS-Studio in den Wolken: GitLab CI / CD</a></li>
<li><a href="../de476628/index.html">PVS-Studio geht in die Cloud: GitLab CI / CD</a></li>
<li><a href="../de476636/index.html">Optimieren von Firebird und Linux f√ºr eine Datenbank mit einer Gr√∂√üe von 691 GB und mehr als 1000 Benutzern</a></li>
<li><a href="../de476644/index.html">Sprachschichten</a></li>
<li><a href="../de476646/index.html">3-Wege-Fusion in Werf: Einsatz in Kubernetes mit Helm "auf Steroiden"</a></li>
<li><a href="../de476648/index.html">Lenovo auf der FINOPOLIS 2019</a></li>
<li><a href="../de476650/index.html">Der Ort der Aufz√§hlung in der sich ver√§ndernden Welt von heute</a></li>
<li><a href="../de476656/index.html">26. November Moskau - Alfa JS MeetUP # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>