<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïô ‚õ∑Ô∏è ü§üüèø H√§ufige Protokollierungsfehler üôåüèª üçï ü¶Å</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 


 Ich denke, fast jedes Programm hat Protokollierung. Dar√ºber hinaus werden in einer Reihe bereits neuer Anwendungen (dh mit einer Vielz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>H√§ufige Protokollierungsfehler</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458436/"><p>  Hallo Habr! </p><br><p>  Ich denke, fast jedes Programm hat Protokollierung.  Dar√ºber hinaus werden in einer Reihe bereits neuer Anwendungen (dh mit einer Vielzahl nicht trivialer Bedingungen) Protokolle auf einem Kampfserver h√§ufig von entscheidender Bedeutung. </p><br><p>  Trotz der Bedeutung und Verbreitung einer solchen Technologie habe ich festgestellt, dass Menschen bei der Arbeit mit ihnen h√§ufig Standardfehler machen.  Dieser Artikel beschreibt das Verhalten von .Net in vielerlei Hinsicht. Ich habe jedoch kleine Einf√ºgungen aus der Java-Welt erstellt, um einen Vergleich zu erm√∂glichen. </p><a name="habracut"></a><br><h1 id="allokacii-vydelenie-pamyati">  Zuordnungen (Speicherzuordnung) </h1><br><p> Der h√§ufigste Fehler (nach meinen Beobachtungen) ist eine Nachl√§ssigkeit in Bezug auf kleine Speicherzuordnungen in der N√§he des Ortes des Aufrufs der Funktion <code>log.Debug(...)</code> . </p><br><p>  Also, unser Standardcode in .Net: </p><br><pre> <code class="plaintext hljs">private static readonly ILog Log4NetLog = LogManager.GetLogger(typeof(Program)); private static readonly Logger NLogLog = NLog.LogManager.GetCurrentClassLogger(); private static void PublishData(int id, string name, EMail email, decimal amount) { Log4NetLog.Debug($"Id={id}"); // 1 Log4NetLog.DebugFormat("Id={0}", id); // 2 Log4NetLog.Debug($"Id={id}; name={name}; email={email.Normalize()}; amount={amount}"); // 3 Log4NetLog.DebugFormat("Id={0}; name={1}; email={2}; amount={3}", id, name, email.Normalize(), amount); // 4 NLogLog.Debug($"Id={id}"); // 5 NLogLog.Debug("Id={0}", id); // 6 NLogLog.Debug($"Id={id}; name={name}; email={email.Normalize()}; amount={amount}"); // 7 NLogLog.Debug("Id={0}; name={1}; email={2}; amount={3}", id, name, email.Normalize(), amount); // 8 }</code> </pre> <br><p>  In vielerlei Hinsicht habe ich nur die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">log4net-</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NLog-</a> Bibliotheken gesehen und werde sie daher in den Beispielen verwenden. </p><br><p>  Die Fragen sind also: </p><br><ul><li>  In welchen Zeilen wird Speicher zugewiesen, auch wenn Debug deaktiviert ist? </li><li>  Wie einfach ist es, in derselben dotTrace zu erkennen, dass speziell Logger f√ºr diese Speicherzuweisung verantwortlich sind, wenn Speicher zugewiesen wird? </li></ul><br><p>  Die richtige Antwort auf die erste Frage: Speicher wird nicht nur in Absatz "6" zugewiesen.  Und die Antwort auf die zweite Frage: Es ist unglaublich schwer zu fangen, da dieser Code h√§ufig √ºber das Projekt verteilt ist.  Sie k√∂nnen sich an eine typische .Net-Anwendung erinnern.  Es wird oft √§hnlichen Code geben, mit dem GC funktioniert. </p><br><p>  Lassen Sie uns jedoch die technischen Details durchgehen, um genau zu verstehen, wo wir einen Einfluss auf die Leistung haben werden. </p><br><p>  Also der erste Punkt: </p><br><pre> <code class="plaintext hljs">Log4NetLog.Debug($"Id={id}"); // 1</code> </pre> <br><p>  Tats√§chlich konvertiert der Compiler es in: </p><br><pre> <code class="plaintext hljs">var temp = string.Format("Id={0}", id); // &lt;--       Log4NetLog.Debug(temp);</code> </pre> <br><p>  Das hei√üt, der erste Ausdruck zwingt den Prozessor im Wesentlichen dazu, eine Zeichenfolge zu erstellen und diese an den Logger zu √ºbergeben.  Er wird schnell √ºberpr√ºfen, ob Sie sich nicht anmelden m√ºssen, und daher wurde die Zeile nur im Speicher erstellt.  Und was wichtig ist, wenn Sie mehr solchen Code kopieren, werden die Zeilen in Haufen von Programmstellen erstellt, dh das Programm arbeitet nur ein wenig langsamer.  √úberall. </p><br><p>  Das zweite Beispiel ist etwas effizienter, da darin keine Zeile erstellt wird: </p><br><pre> <code class="plaintext hljs">Log4NetLog.DebugFormat("Id={0}", id);</code> </pre> <br><p>  Hier wird jedoch noch Speicher zugewiesen, da Boxen auftreten wird.  Ich m√∂chte Sie an die Signatur der DebugFormat-Methode erinnern: </p><br><pre> <code class="plaintext hljs">void DebugFormat(string format, object arg0)</code> </pre> <br><p>  Wie Sie sehen k√∂nnen, erfordert die Eingabe einen Referenztyp.  Wir versuchen jedoch, einen aussagekr√§ftigen <code>int</code> Typ zu √ºbergeben.  Infolgedessen f√ºhrt jeder Aufruf dazu, dass die Heap-Parameter- <code>id</code> √ºbergeben wird, um sie an die Methode zu √ºbergeben.  Und ich m√∂chte Sie daran erinnern, dass der Parameter selbst in der Methode selbst nicht ben√∂tigt wird, da <code>Debug</code> durch die Bedingung der Aufgabe <code>Debug</code> ist. </p><br><p>  Das folgende Beispiel ist geladen und einfach: </p><br><pre> <code class="plaintext hljs">Log4NetLog.Debug($"Id={id}; name={name}; email={email.Normalize()}; amount={amount}"); // 3</code> </pre> <br><p>  Ich bin sicher, dass Sie bereits verstanden haben, dass die Linie wieder auf dem Haufen auffallen wird und so weiter.  √úberspringen Sie daher sofort dieses Beispiel.  Die folgende Aufrufmethode sieht effizienter aus: </p><br><pre> <code class="plaintext hljs">Log4NetLog.DebugFormat("Id={0}; name={1}; email={2}; amount={3}", id, name, email.Normalize(), amount); // 4</code> </pre> <br><p>  Berechnen wir jedoch, wie oft ein Speicher reserviert werden muss: </p><br><ul><li>  <code>email.Normalize()</code> f√ºhrt zur Erstellung eines Objekts.  Daher wird dieses Objekt auf dem Heap (oder auf dem Stapel - es spielt keine Rolle, da das Boxen es erforderlich macht, alles auf dem Heap auszuw√§hlen) zugewiesen. </li><li>  <code>id</code> wird auf einen Haufen gehen, wie wir bereits fr√ºher in Betracht gezogen haben. </li><li>  Log4net verf√ºgt √ºber die folgende Schnittstelle f√ºr solche lang formatierten Aufrufe: <code>void DebugFormat(string format, params object[] args)</code> .  Wie Sie sehen k√∂nnen, erstellt .Net ein Array auf dem Heap, um es an die <code>DebugFormat</code> Methode zu √ºbergeben. </li></ul><br><p>  Infolgedessen f√ºhrt ein ziemlich typischer Aufruf des Protokollierungsvorgangs zur Erstellung eines Haufens von Objekten im Speicher.  Das ist ziemlich entt√§uschend, da die Protokollierung selbst oft deaktiviert ist.  Fahren wir jedoch mit NLog fort. </p><br><p>  Diese Zeile provoziert die Zuordnung des Objekts auf dem Heap: </p><br><pre> <code class="plaintext hljs">NLogLog.Debug($"Id={id}");</code> </pre> <br><p>  Hier ist alles offensichtlich, aber die folgende Zeile hat keinen solchen Nachteil mehr: </p><br><pre> <code class="plaintext hljs">NLogLog.Debug("Id={0}", id);</code> </pre> <br><p>  Und der Grund ist, dass NLog eine spezielle Signatur f√ºr Ints hat: <code>void Debug(string message, int argument)</code> .  Selbst wenn Sie eine andere Struktur √ºbertragen, wird die <code>void Debug&lt;TArgument&gt;([Localizable(false)] string message, TArgument argument)</code> .  Und diese Methode erfordert kein Boxen, da nach JIT f√ºr jeden Typ eine eigene Funktion erstellt wird (dies ist nat√ºrlich nicht ganz richtig, aber der wichtige Punkt ist: Es wird kein Boxen geben). </p><br><p>  Ich √ºberspringe das leicht verst√§ndliche Skript mit einer gro√üen Eingabezeile und gehe direkt zu: </p><br><pre> <code class="plaintext hljs">NLogLog.Debug("Id={0}; name={1}; email={2}; amount={3}", id, name, email.Normalize(), amount);</code> </pre> <br><p>  Seltsamerweise hat NLog die Anzahl der generischen Parameter f√ºr Methoden nicht erh√∂ht, und daher wird die Signatur verwendet: <code>void Debug([Localizable(false)] string message, params object[] args)</code> .  Und es wird wieder zur Schaffung von Objekten in Haufen und so weiter f√ºhren. </p><br><h2 id="vyvody-i-uluchsheniya">  Schlussfolgerungen und Verbesserungen </h2><br><p>  Die Hauptschlussfolgerung: Wenn Sie viele Aufrufe an die Protokollierungsmethoden im Programm haben, die nicht zum physischen Schreiben in die Datei f√ºhren, k√∂nnen Sie aus heiterem Himmel viele unn√∂tige Objekte auf dem Heap zuweisen.  Und damit die Arbeit des Programms behindern. </p><br><p>  Schlussfolgerung 2: Wenn Sie nicht viele Objekte an eine Methode √ºbergeben, verwenden Sie NLog.  Aufgrund der Tatsache, dass die generischen Parameter ber√ºcksichtigt wurden, k√∂nnen Sie die Leistung entspannter gestalten. </p><br><p>  Um jedoch v√∂llig sicher zu sein, ist es logischer, dies zu tun: </p><br><pre> <code class="plaintext hljs">if (NLogLog.IsDebugEnabled) { NLogLog.Debug($"Id={id}; name={name}; email={email.Normalize()}; amount={amount}"); }</code> </pre> <br><p>  Hier wird die Protokollierungsmethode nicht aufgerufen, wenn dies nicht erforderlich ist.  Wenn Sie die Daten dennoch in das Protokoll kopieren m√ºssen, wird die praktische Zeichenfolgeninterpolation verwendet.  Im Inneren haben Logger (mindestens das gleiche NLog) Optimierungen, um eine Zeile direkt in die Protokolle zu schreiben (d. H. Die Formatierung erfolgt sofort in <code>Stream</code> , anstatt eine Zeile im Speicher zu erstellen).  Diese Optimierung von NLog verschwindet jedoch mit der Tatsache, dass Sie die Daten auf eine Datei zur√ºcksetzen m√ºssen. </p><br><h2 id="primer-iz-kotlin">  Kotlin Beispiel </h2><br><p>  Um die Beschreibung der Arbeit beliebter Logger in .Net zu verw√§ssern, werde ich eine interessante M√∂glichkeit geben, Anrufe in Kotlin zu verpacken.  Die Idee basiert buchst√§blich auf einem interessanten Merkmal der Sprache: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Inline-Methoden</a> .  Ein einfacher Code, um etwas zum Debuggen auszugeben: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeService</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : KLogging() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publishData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ logger.debug { <span class="hljs-string"><span class="hljs-string">"Identity: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br><p>  Und es wird vom Compiler in so etwas konvertiert: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeService</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : KLogging() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publishData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(logger.isDebugEnabled){ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = <span class="hljs-string"><span class="hljs-string">"Identity: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> logger.debug(message) }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception){ <span class="hljs-comment"><span class="hljs-comment">/*handle*/</span></span> } } } }</code> </pre> <br><p>  Hier ist es wichtig: Alles in geschweiften Klammern in der N√§he des <code>debug</code> ist ein Lambda.  Es wird jedoch in Ihre Methode eingebettet, dh es wird kein Funktionsobjekt im Heap erstellt.  Auf diese Weise k√∂nnen Sie gro√üe Operationen ausblenden, die nur aufgerufen werden, wenn Sie das Ergebnis zum <code>debug</code> ausgeben m√∂chten.  Zum Beispiel: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeService</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : KLogging() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publishData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ logger.debug { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> idList = getIdList() <span class="hljs-string"><span class="hljs-string">"Identity: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$idList</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br><p>  Hier wird <code>getIdList</code> nur aufgerufen, wenn Sie etwas an die Datei senden m√ºssen.  Und das alles, weil der Code konvertiert wird in: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeService</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : KLogging() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publishData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(logger.isDebugEnabled){ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> idList = getIdList() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = <span class="hljs-string"><span class="hljs-string">"Identity: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$idList</span></span></span><span class="hljs-string">"</span></span> logger.debug(message) }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (){ <span class="hljs-comment"><span class="hljs-comment">/*handle*/</span></span> } } logger.debug { <span class="hljs-string"><span class="hljs-string">"Identity: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br><h1 id="large-object--large-object-heap">  Gro√ües Objekt ==&gt; Gro√üer Objekthaufen </h1><br><p>  Neben dem vorherigen Beispiel.  Ich bin sicher, dass viele Leute wissen, dass .Net / JVM das Konzept des "Large Object Heap" hat.  Genauer gesagt gibt es in Java keine spezielle Definition. Allokatoren erstellen jedoch h√§ufig gro√üe Objekte sofort in der neuesten Generation (um die Bewegung von Objekten zu minimieren und das Problem der schnellen Speicherdurchdringung f√ºr einen Streaming-Allokator zu l√∂sen). </p><br><p>  Zur√ºck zum Beispiel: </p><br><pre> <code class="plaintext hljs">NLogLog.Debug($"Id={id}");</code> </pre> <br><p>  Wenn das <code>id</code> Objekt √ºber eine Implementierung von <code>ToString</code> , die eine Zeichenfolge von der Gr√∂√üe eines Megabytes erstellt, werden im LOH-Bereich die folgenden Treffer angezeigt: </p><br><ul><li>  <code>ToString</code> ruft sich selbst auf </li><li>  Formatieren von <code>$"Id={id}"</code> </li><li>  Und wenn die Entwickler des Loggers all diese Dinge nicht verstanden haben (und es √§u√üerst schwierig ist, einen Test f√ºr das Fehlen von Objekten in LOH zu schreiben), f√ºgt der Logger Probleme hinzu. </li></ul><br><p>  Und hier k√∂nnen Sie drei Methoden zum Protokollieren solcher Dinge verwenden: </p><br><ul><li>  Verwenden Sie ein spezielles Layout und ben√∂tigen Sie keinen Aufruf von <code>ToString</code> .  Beispielsweise verf√ºgt NLog √ºber ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JsonLayout</a> .  Auf diese Weise k√∂nnen Sie einfach ein Objekt an den Logger √ºbertragen, das sofort in den resultierenden Stream (z. B. in eine Datei) serialisiert wird. </li><li>  Schreiben Sie selbst in die Datei.  Oder mit anderen Worten - verwenden Sie den Logger nicht.  Ich kann nur selbst beraten, wie ich herausfinden kann, in welche Datei NLog schreiben wird: <code>var filePath = NLog.LogManager.Configuration.AllTargets.OfType&lt;FileTarget&gt;().First().FileName.Render(LogEventInfo.CreateNullEvent())</code> .  <code>FileTarget</code> gibt diese Funktion das erste <code>FileTarget</code> , das <code>FileTarget</code> wird. Wenn jedoch alle <code>FileTarget</code> in denselben Ordner schreiben, k√∂nnen Sie auf √§hnliche Weise den Ordner f√ºr die Aufzeichnung ermitteln und dann direkt einen Speicherauszug Ihres Objekts an die Datei senden. </li><li>  Wenn Sie log4j2 haben (das zweite ist wichtig), k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">StringBuilderFormattable verwenden</a> .  Es wurde nur erstellt, um Daten in Teilen in den Logger auszugeben (au√üerdem, um keinen Teil der Teile im Heap zuzuweisen, da sie bereits ausgew√§hlt sind). </li></ul><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilderFormattable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Writes a text representation of this object into the specified {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> StringBuilder}, ideally without allocating * temporary objects. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> buffer the StringBuilder to write into */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StringBuilder buffer)</span></span></span></span>; }</code> </pre> <br><h1 id="sinhronnost-i-problemy-asinhronnosti">  Synchronit√§t (und Asynchronit√§tsprobleme) </h1><br><p>  Einmal bemerkte ich in einem Programm, dass w√§hrend geladener Vorg√§nge etwa die H√§lfte der Wartezeit der Benutzeroberfl√§che durch Protokollierungsvorg√§nge ber√ºcksichtigt wurde.  Noch einmal: Die H√§lfte der Programmzeit wurde f√ºr einen Aufruf von <code>logger.Debug</code> oder √§hnlichem <code>logger.Debug</code> .  Und der Grund daf√ºr ist einfach: Wir haben log4net verwendet, das Dateien nur synchron schreiben kann. </p><br><p>  Von hier habe ich <strong>Regel 1</strong> abgeleitet: Der Logger sollte immer in einem anderen Thread arbeiten.  Sie sollten den Anwendungscode nicht aus Gr√ºnden der Ablaufverfolgung blockieren, da dies unglaublich seltsam ist.  Mit anderen Worten - mit NLog m√ºssen Sie immer <code>async=true</code> in das <code>nlog</code> Tag <code>nlog</code> (es ist das Haupt-Tag).  Oder wie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiel</a> sagt: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">targets</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> ... your targets go here ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">targets</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Wenn Sie log4net verwenden, leiten Sie es entweder zu NLog um oder erstellen Sie AsyncFileAppender. </p><br><p>  F√ºr die Java-Welt: Sowohl Logback als auch Log4J2 k√∂nnen asynchrone Protokollierung durchf√ºhren.  Hier ist ein Vergleich von der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Seite</a> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b9b/924/cb3/b9b924cb3725252b98aae0c6ffdc8aa0.png" alt="Bild"></p><br><p>  Wenn jedoch alles asynchron geschrieben wird, tritt ein anderes Problem auf - was ist bei kritischen Fehlern zu tun?  Schlie√ülich kommt es vor, dass ein Programm nicht beendet wird, weil es den Hauptthread verlassen hat (z. B. kann ein Programm durch Aufrufen von <code>Application.Exit</code> oder <code>Environment.FailFast</code> , was nicht sehr sch√∂n ist, aber tats√§chlich auftritt).  In diesem Fall m√ºssen Sie immer <code>Flush</code> aufrufen, bevor Sie Ihren Prozess <code>Flush</code> .  Andernfalls werden die wertvollsten Informationen √ºbersehen, wenn Sie auf den Kampfserver fallen. </p><br><h1 id="vyvod">  Fazit </h1><br><p>  Ich hoffe, dieser Artikel hilft Ihnen beim Schreiben schneller Programme mit bequemer Protokollierung.  Ich habe nur einen Teil der Probleme hervorgehoben, die ich im Code sehe.  Alle von ihnen sind nicht die offensichtlichsten, aber nicht die schwierigsten. </p><br><p>  Wie ich eingangs sagte, ist die Arbeit mit Loggern in fast jeder Anwendung.  Au√üerdem gibt nach meinen Notizen etwa die H√§lfte der Klassen selbst etwas in das Protokoll aus.  Der korrekte Betrieb mit diesen Funktionen wirkt sich somit auf fast die gesamte Anwendung aus. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458436/">https://habr.com/ru/post/de458436/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458422/index.html">√úbersicht √ºber Grant-Programme f√ºr Blockchain-Entwickler</a></li>
<li><a href="../de458424/index.html">Drohnen-Show: Inside Look</a></li>
<li><a href="../de458428/index.html">Google √∂ffnet den Parser-Quellcode robots.txt</a></li>
<li><a href="../de458432/index.html">Kombinieren mehrerer Pakete in einem einzigen Python-Namespace</a></li>
<li><a href="../de458434/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 11. VLAN-Grundlagen</a></li>
<li><a href="../de458440/index.html">Technischer Support an Wochentagen: Geschichten dar√ºber, was passiert, wenn Sie den Benutzer nicht erreichen k√∂nnen</a></li>
<li><a href="../de458442/index.html">Warum ruft LLVM m√∂glicherweise eine nie aufgerufene Funktion auf?</a></li>
<li><a href="../de458444/index.html">Internet f√ºr den Sommerbewohner. Teil 4. Eine SIM-Karte reicht aus</a></li>
<li><a href="../de458446/index.html">Hyperscale-Rechenzentren: Wer baut sie und wie viel kosten sie?</a></li>
<li><a href="../de458450/index.html">Eigenschaften von Quantencomputern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>