<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍💻 👼🏿 ⚰️ Bagaimana saya membuat layanan kontrol kualitas dari tabel dan stik 👫 🍭 💀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Seringkali, ketika berpikir untuk meluncurkan pilot, manajer mulai memperumit situasi, membangun peta jalan dan menunggu MVP dari pengemba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana saya membuat layanan kontrol kualitas dari tabel dan stik</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/472856/">  Halo, Habr!  Seringkali, ketika berpikir untuk meluncurkan pilot, manajer mulai memperumit situasi, membangun peta jalan dan menunggu MVP dari pengembang, alih-alih mengambil dan menguji ide sendiri.  Di bawah potongan, saya ingin berbagi kisah tentang menciptakan layanan kontrol kualitas berdasarkan formulir Google, VK dan puluhan baris kode, di mana tidak ada pengembang yang terluka, hanya 1 pemasar. <br><br><img src="https://habrastorage.org/webt/z0/h1/0h/z0h10hxua4cagzjcovtbf5t8oja.png"><br><a name="habracut"></a><br><blockquote>  <b>Penafian</b> : dalam artikel ini saya menunggu contoh kode yang akan menimbulkan pertanyaan, keraguan, bahkan air mata dan kebutaan yang berdarah.  Dalam pembenaran untuk itu, hanya ada satu hal yang bisa dikatakan - kode ini bekerja seperti Papa Carlo, dan memenuhi misinya 100%, dan beberapa skrip masih berfungsi. </blockquote><h2>  Penilaian Dodo Pizzeria Pertama </h2><br>  Salah satu prinsip utama perusahaan kami - <b>yang tidak dapat diukur, tidak ada</b> .  Pizza ada, yang berarti Anda perlu mengevaluasi kualitasnya. <br><br>  Semuanya dimulai pada 2013.  Saat itu, ada 7 pizza di jaringan.  Kemudian di Dodo mereka memutuskan untuk meluncurkan proyek untuk mengontrol kualitas dan standar produk - peringkat pizza terbuka untuk semua mitra. <br><br>  Dia terlihat seperti itu. <br><br><img src="https://habrastorage.org/webt/c9/rq/qj/c9rqqjnm6lxlqahi13lral5y7ni.png"><br><br>  Data diambil dari panggilan pelanggan, ulasan di sosial.  jaringan dan sedikit dari Dodo IS (sistem informasi kami). <br><br>  Nilai tambah yang jelas pada saat itu - peringkat mulai mendorong para pengelola pizza untuk bekerja pada kualitas agar menjadi yang teratas. <br><br><h2>  Pizzaria Toko Misteri Kedua </h2><br>  Sekitar setahun kemudian, kami menyadari bahwa kami perlu mengevaluasi produk itu sendiri dan mengambil model terkenal - "pembeli misteri".  Pada saat itu, kami membuat terobosan - yang pertama di Rusia memutuskan bahwa pelanggan kami akan menjadi pembeli misteri. <br><br><h4>  Munculnya grup tertutup VK </h4><br>  Awalnya, kami menemukan cara mereka bekerja dengan pembeli misteri di agen yang menyediakan layanan seperti itu.  Ternyata mereka berkomunikasi melalui email atau menelepon langsung untuk menawarkan verifikasi. <br><br>  Opsi ini tidak langsung menggoda kita.  Kami pasti tidak akan menelepon, karena bagi kami itu adalah waktu yang lama, tetapi bagi klien itu menyakitkan dan setara dengan spam.  Surat digunakan untuk surat massal, tetapi mereka segera ditinggalkan. <br><br>  Kami datang dengan: <br><br><ol><li>  Untuk komunikasi dengan agen rahasia dan koordinasi cek, mereka menggunakan halaman biasa di VK. </li><li>  Untuk mengumpulkan laporan foto, mereka membuat grup di VK dengan dinding terbuka. </li><li>  Dan untuk survei layanan, kami memilih formulir Google.  Apa?  Dengan mudah, Anda tidak perlu memotong layanan terpisah, dan itu ditampilkan dengan baik di ponsel. </li><li>  Semua instruksi ada di Google Documents. </li></ol><br>  Semuanya ada di lutut.  Semuanya sebagaimana mestinya untuk startup. <br><br><img src="https://habrastorage.org/webt/0x/bu/2u/0xbu2ung5j6no9ltwyi_re80aqe.jpeg"><br>  <i>Foto dari pembelanja misteri.</i>  <i>Ya, mereka mengukur lebar dengan penggaris, memotong pelek pizza untuk menunjukkan kualitas roti dan adonan.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Lebih banyak contoh dari laporan foto dari 2015 ada di sini.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-v/fx/nh/-vfxnheu2wvm1gxfcc2epiwqyxw.jpeg"><br><img src="https://habrastorage.org/webt/zd/kk/d0/zdkkd0crvk0xqgdidv9roxanw_c.jpeg"><br><img src="https://habrastorage.org/webt/qk/co/fz/qkcofzsjt7iz2qm0czous0dw84o.jpeg"><br><img src="https://habrastorage.org/webt/ca/zq/5a/cazq5atxyea8vjvdtmprmwnstly.jpeg"><br></div></div><br>  Peringkat itu terus berubah, kriteria evaluasi baru ditambahkan.  Misalnya, ini adalah 131 poin untuk mengevaluasi restoran pizza Abakan-1. <br><br><img src="https://habrastorage.org/webt/x9/6c/lj/x96cljo2g-fkxgmsrbbqy8_bcxe.gif"><br><br>  Seluruh proses neraka adalah bahwa semua pelanggaran dalam poin dicatat secara manual, tidak ada otomatisasi.  Dan semua ini dilakukan oleh satu karyawan. <br><br><h4>  Keajaiban Google spreadsheet </h4><br>  Pada 2016, kami belajar (matang) bahwa manusia telah lama menemukan fungsi selain = SUM.  Dan apa yang dapat dilakukan dengan menggunakan skrip dan fungsi impor data antar tabel ... Pembuatan CRM langsung. <br><br>  Misalnya, untuk mengevaluasi setiap restoran pizza dalam tabel adalah selembar, dan di dalamnya kriteria dan skor evaluasi.  1 pizzeria = 1 daun.  Semakin banyak pizza, semakin banyak lembaran.  Setiap minggu pertanda baru.  Dengan menekan tombol ajaib, lembar templat di tabel diperluas menjadi 120 lembar.  Wah, bagus sekali! <br><br><img src="https://habrastorage.org/webt/k-/s9/fv/k-s9fvqwy1wnaomulahpgn7a7no.gif"><br><br>  Tahap otomatisasi "Pengendalian Dodo" ini memakan waktu sekitar enam bulan.  Kami bergerak selangkah demi selangkah: kami mempelajari sesuatu yang baru - diterapkan, kami belajar sesuatu yang baru - diperkenalkan lagi. <br><br><h2>  Batasan sebagai pendorong kemajuan </h2><br>  Sejak awal, kami berbicara dengan pembeli misteri atas nama akun pribadi di VK.  Dan kemudian datang pada hari ketika kami dihadapkan dengan masalah-masalah dari halaman pribadi: <br><br><ul><li>  ada batas 10.000 teman; </li><li>  Ada batasan pengiriman pesan: kadang-kadang kami tidak dapat mengirim pesan, karena VK memblokir kami dengan kata-kata "Anda mengirim terlalu banyak pesan, datanglah besok". </li></ul><br>  Biasanya VK diblokir mengirim pesan sekitar 16:00.  Itu adalah saat yang menyenangkan ketika tim bisa beristirahat. <br><br>  Perlahan-lahan, kami menemui hampir semua keterbatasan VK dan hampir berhasil berhenti mencintai situs ini.  Tapi keajaiban terjadi, dan VK memberi kelompok kesempatan untuk menghubungkan widget pesan, bot obrolan dan barang lainnya. <br><br>  Sebenarnya, kemungkinan ini lebih awal dari Desember 2016, tetapi dengan batasan kritis bagi kami: grup hanya dapat menanggapi pesan dalam waktu 10 hari dari saat mengirim pesan terakhir dari klien.  Ketika mereka menghilangkan batasan ini, kehidupan tim kami mulai berkilau dengan warna-warna baru.  Sejak saat itu, kami telah memulai jalur otomatisasi menggunakan VK API dan Google spreadsheet. <br><br><h2>  Ketakutan dan Kebencian dalam Skrip Pengguna </h2><br>  Awalnya, untuk menjadi pembelanja misterius, Anda harus mengisi formulir, lalu mendaftar ke grup, menulis kata sandi kepada kami dan menunggu kami merespons.  Menunggu ini bisa bertahan hingga 48 jam.  Itu lama tidak senonoh dan keinginan untuk melakukan pemeriksaan setelah pendaftaran tersebut memudar. <br><br>  Dengan pengetahuan baru, kami mulai mengotomasi pendaftaran. <br><br>  Kami memiliki beberapa metode API, satu formulir, beberapa lusinan tabel, halaman arahan, bot dalam PHP, skrip dalam tabel yang ditulis oleh pemasar paling keren Dodo dan CFO pertama Dodo dalam satu orang, lusinan templat pesan untuk berbagai situasi.  Lalu saya bahkan tidak tahu bahwa ini disebut skrip pengguna: <br><br><ol><li>  Pembeli misteri mengisi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kuesioner</a> (ini adalah versi yang sudah ketinggalan zaman dan sekarang tidak berfungsi). </li><li>  Data dari formulir jatuh pertama ke dalam database, lalu ke dalam tabel.  Bot pertama kali mengetuk basis data untuk memeriksa data tentang profil, karena batas waktu respons pelat dalam puluhan ribu baris besar, dan basis data mencerna dengan mudah). </li><li>  Setelah mengisi kuesioner dalam formulir, sebuah pesan muncul di layar: "Terima kasih, tetap bergabung dengan grup (tautan) dan menulis kata sandi" Sherlock "". </li><li>  Kemudian pembelanja misterius mengirim aplikasi untuk bergabung dengan grup dan menulis kata sandi "Sherlock".  Kata adalah pemicu untuk menjalankan skrip validasi: <br>  - permintaan dikirim ke database apakah agen cocok untuk kita berdasarkan usia; <br>  - jika demikian, maka orang tersebut ditambahkan ke grup, dan di tabel di seberang kuesioner kandidat, statusnya ok / tidak ok <br>  - Lebih banyak data dicat dengan warna pirus dan itu penting.  Jadi dengan mata saya, lebih mudah untuk memahami siapa yang cocok dengan kita dan dengan siapa kita bisa berbicara.  Script dicat merah profil yang tidak cocok; <br>  - Selanjutnya, pembeli rahasia diterima secara otomatis dalam grup, dan pesan dikirim ke obrolan dengan langkah dan instruksi lebih lanjut. </li></ol><br><img src="https://habrastorage.org/webt/so/ty/se/sotysezhht_urug1ax9cnrvc9-g.png"><br><br>  Itulah otomatisasi registrasi.  Sekarang seluruh prosedur menjadi hampir sederhana dan mudah dimengerti. <br><br>  Selanjutnya, semuanya berjalan seperti jarum jam.  Menjadi jelas bahwa kami dapat mengirim pesan melalui tabel langsung ke PM ke agen rahasia melalui pesan grup. <br><br><img src="https://habrastorage.org/webt/zn/px/nd/znpxndqiyuxkqp0y6mnhov7fooc.gif"><br><br>  Dan Anda hanya memiliki 46 baris kode! <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = SpreadsheetApp.getActiveSpreadsheet().getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = range.getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> marray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> iarray = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>).getValues(); ss.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = range.getRowIndex(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> add = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> check = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'L'</span></span> + add).getValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (check != <span class="hljs-string"><span class="hljs-string">''</span></span>) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange(<span class="hljs-string"><span class="hljs-string">'K'</span></span> + add).setValue(<span class="hljs-string"><span class="hljs-string">""</span></span>).setBackground(<span class="hljs-string"><span class="hljs-string">"#ffff00"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = { <span class="hljs-string"><span class="hljs-string">"message"</span></span> : marray[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : <span class="hljs-string"><span class="hljs-string">"    "</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.74"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload, "muteHttpExceptions" : true, }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.send", options).getContentText()); if (jsonData['error'] != undefined) { SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getRange('K' + add).setValue("").setBackground("#ff0000"); } Logger.log(jsonData); var log = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Log'); var int = log.getRange('A1').getValue(); var d = new Date(); log.getRange('B' + int).setValue(d); log.getRange('C' + int).setValue(r[0] + ""); log.getRange('A1').setValue(int + 1); Utilities.sleep(400); }); }</span></span></code> </pre> <br>  Dalam tabel, kami membuat teks pesan dan membuat surat pribadi menggunakan halaman id.  Kami juga berhenti menyalin dan mengirim pesan secara manual.  Pada waktu puncak, kami dapat mengirim hingga 3000 pesan dalam 45 menit menggunakan tabel.  Jika kami melakukannya dengan tangan, maka saya tidak akan menulis artikel ini, tetapi akan terus mengirim pesan. <br><br>  Selanjutnya, saya memberi contoh tablet ajaib seperti itu.  Saya berusaha sangat keras untuk membuat UX / UI yang jelas dan fungsional.  Dengan mengklik tombol merah, distribusi pesan diluncurkan dengan proposal untuk melakukan pemeriksaan rahasia. <br><br><img src="https://habrastorage.org/webt/ht/be/ix/htbeixa27tdtlix28xnzhsmh6xg.png"><br><br><h2>  Lebih banyak fitur untuk mengotomatisasi proses neraka </h2><br>  Perusahaan memiliki banyak formulir Google yang membantu kami mengumpulkan beberapa metrik dari pizzeria secara berkelanjutan.  Setiap formulir memiliki daftar pizza yang perlu diperbarui.  Ada 53 formulir seperti itu secara total, masing-masing sebelumnya diperbarui secara manual. <br><br>  Sedikit lelah dengan pekerjaan ini, kami menyadari bahwa bisnis ini bisa otomatis.  Saya kembali beralih ke pemasar kami, setelah satu atau dua jam semuanya sudah siap dan hanya 47 baris kode. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> forms = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ranges = range.offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>).getValues(); forms.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> form = FormApp.openById(forms[i]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sources[i]).getRange(ranges[i]).getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = []; values.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">el,ei</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (el[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">''</span></span>) { arr.push(el[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = form.getItems()[<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(items[i])].asListItem(); item.setChoiceValues(arr); Logger.log(item.getTitle()); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getSheetByName(<span class="hljs-string"><span class="hljs-string">"    "</span></span>).getRange(<span class="hljs-string"><span class="hljs-string">"A2:C"</span></span>).getValues(); Logger.log(range); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ui = SpreadsheetApp.getUi(); <span class="hljs-comment"><span class="hljs-comment">// Or DocumentApp or FormApp. ui.createMenu('Custom Menu') .addItem('Change', 'myFunction') .addToUi(); } function update() { var ss = SpreadsheetApp.getActiveSpreadsheet(); var range = ss.getSheetByName(" ").getRange("A2:A"); range.activate(); myFunction(); } function createTimeDrivenTriggers() { ScriptApp.newTrigger('update').timeBased().everyDays(1).create(); }</span></span></code> </pre><br>  Bentuknya berbeda, dengan daftar pizza yang berbeda dan lokasi daftar pizza dalam bentuk.  Di suatu tempat kita membutuhkan orang asing, di suatu tempat dari Rusia. <br><br><img src="https://habrastorage.org/webt/wq/h8/g2/wqh8g2jyt3gmwqopaicz4h2u_h8.png"><br><br>  Kolom B dan C memberi tahu skrip dalam bentuk mana untuk memperbarui dan di mana formulir menampilkan daftar.  Dan kolom D dan E, dari lembar mana dan rentang Anda perlu mengambil daftar untuk memperbarui. <br><br>  Selanjutnya, mereka menetapkan pemicu untuk menjalankan skrip sekali sehari dan dengan demikian mampu mengalahkan proses pembaruan formulir pertama untuk departemen mereka, kemudian untuk seluruh perusahaan.  Skrip ini masih berfungsi. <br><br><h2>  Kasus paling sulit tentang siput </h2><br>  Pernah kami ingin menerima rekaman audio dari cek pengiriman. <br><br>  Dari mana asal rekaman audio: pembeli misteri mencatat pertemuan kurir dengan klien sebagai pesan audio di VK.  Biasanya ini adalah rekaman audio 10-15 detik. <br><br>  Bagaimana kami mendapatkannya: mereka mengambil 20 pesan terakhir pada alamat VK pembelanja misteri, mencari kata "Ulica" di antara mereka, lalu melangkah mundur satu pesan dan mengambil tautan ke rekaman audio.  (Spoiler: bukan kata terbaik, sering kali mereka menulis kata "Siput") kepada kami. <br><br>  Sudah ada lebih banyak baris kode, bersiap-siaplah. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastAudio</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ss = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = ss.getActiveRange().getValues(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tt = ss.getActiveRange().getRowIndex(); range.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r,i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ri = tt + i; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cuid = r[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ci = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload1 = { <span class="hljs-string"><span class="hljs-string">"q"</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'peer_id'</span></span> : r[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"access_token"</span></span> : token, <span class="hljs-string"><span class="hljs-string">"v"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.73"</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options1 = { <span class="hljs-comment"><span class="hljs-comment">//   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload1, "muteHttpExceptions" : true }; var jsonData = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.search", options1).getContentText()); Logger.log(jsonData); if (jsonData['response']['items'] == undefined) { ss.getRange("B" + ri).setValue(' ').setBackground('#f00'); return; } var cmid = jsonData['response']['items'][0]['id']; var date = new Date((jsonData['response']['items'][0]['date']*1000)); var fdate = Utilities.formatDate(date, "GMT+3", "dd-MM-yyyy HH:mm:ss"); ss.getRange("B" + ri).setValue(fdate); var payload2 = { "user_id" : cuid, "count" : '20', "access_token" : token, "v" : "5.73", }; var options2 = { //   http- "method" : "post", "header" : "Content-type: application/x-www-form-urlencoded", "payload" : payload2, "muteHttpExceptions" : true }; var jsonData2 = JSON.parse(UrlFetchApp.fetch("https://api.vk.com/method/messages.getHistory", options2).getContentText()); Logger.log(jsonData2); jsonData2['response']['items'].forEach(function (r,i) { if (r['id'] == cmid) { ci = i + 1; Logger.log(jsonData2['response']['items'][ci]); if (jsonData2['response']['items'][ci] == undefined) { ss.getRange("C" + ri).setValue(" "); } else { if (jsonData2['response']['items'][ci] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc'] != undefined &amp;&amp; jsonData2['response']['items'][ci]['attachments'][0]['doc']['url'] != undefined) { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['attachments'][0]['doc']['url']); } else { ss.getRange("C" + ri).setValue(jsonData2['response']['items'][ci]['body']); } } } }); }); }</span></span></code> </pre><br><h2>  Google spreadsheet tidak elastis, tetapi saya adalah pembuat enkode yang begitu-begitu </h2><br>  Jadi semuanya berputar, berputar, sampai kami tumbuh hingga 60 ribu pembeli misteri pada awal 2018. <br><br>  Jadi, kita sudah mengalami batasan tabel.  Kemudian satu tabel bisa berisi tidak lebih dari 2 juta sel, dan kami menggunakan 1,6 juta sel di salah satu label departemen tersibuk, di mana 135 ribu sel memiliki semua jenis fungsi tabel. <br><br>  Backend seperti itu.  Semuanya sangat melambat dan ketika beberapa orang bekerja bersama, plat itu berbunyi, "Dokumen itu terlalu populer, kembalilah nanti." <br><br>  Kemudian menjadi jelas bahwa saya adalah encoder yang buruk, sistem tidak menahan beban dan saya perlu diganti. <br><br><h2>  Dan kemudian pengembang yang sebenarnya datang ... </h2><br>  Tetapi ini adalah kisah yang sangat berbeda dan kami akan menulisnya nanti.  Saya berharap contoh-contoh ini akan membantu manajer dalam proyek mereka, di mana ada banyak proses neraka.  Proses dapat dan harus otomatis, baik tabel dan zapier (kami juga menggunakannya) dapat membantu, dan menampung solusi jika ada sumber daya, kami tidak memilikinya pada awalnya. <br><br>  Jika Anda memiliki seseorang di perusahaan yang mengetahui sesuatu tentang skrip, maka ia cocok untuk mengatur proses neraka di tablet.  Jika Anda sendiri ingin mempelajari sesuatu seperti ini, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Telegram</a> memiliki saluran yang sangat baik untuk ini, dari mana saya mengambil informasi tentang fungsi dan skrip. <br><br>  Nah, masthead untuk semua manajer - mengetahui tabel setiap hari menghemat waktu ketika bekerja dengan data dan memungkinkan Anda untuk berpikir dan memahami setidaknya sedikit apa yang dilakukan pengembang dengan data dan apa yang dapat Anda lakukan dengan data secara umum. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id472856/">https://habr.com/ru/post/id472856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id472840/index.html">Penyimpanan yang Ditentukan Perangkat Lunak, atau Apa yang Membunuh Dinosaurus?</a></li>
<li><a href="../id472848/index.html">Refleksi tentang karier di bidang TI</a></li>
<li><a href="../id472850/index.html">Profesi atau Kehidupan: Menangkan Kursus Netologi Jika Anda Tidak Takut</a></li>
<li><a href="../id472852/index.html">GitLab membuat perubahan untuk pengguna produk cloud dan komersial</a></li>
<li><a href="../id472854/index.html">Profiling Unity UI: Siapa yang merusak Batching Saya?</a></li>
<li><a href="../id472858/index.html">Python dan klien HTTP cepat</a></li>
<li><a href="../id472860/index.html">Cascading cache invalidation. Bagian 1</a></li>
<li><a href="../id472862/index.html">Cascading cache invalidation. Bagian 2</a></li>
<li><a href="../id472866/index.html">Jimat untuk komunikasi yang stabil</a></li>
<li><a href="../id472868/index.html">Manajemen server telepon: Klien seluler RUVDS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>