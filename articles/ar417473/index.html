<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐คฏ ๐ฆ ุชุฎุฒูู ููุซูู ุจู ูุน DRBD9 ู Proxmox (ุงูุฌุฒุก 1: NFS) ๐ช๏ธ ๐ฅง ๐ง</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุงููุญุชูู ุฃู ูู ุดุฎุต ูุงู ูู ุญูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ูู ุฎูุงู ุงูุจุญุซ ุนู ุชุฎุฒูู ุนุงูู ุงูุฃุฏุงุก ูุญุฏุฏู ุงูุจุฑูุงูุฌ ุนุงุฌูุงู ุฃู ุขุฌูุงู ุณูุน ุนู DRBD ุ ุฃู ุฑุจูุง ุชุนุงูู ูุนู. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุฎุฒูู ููุซูู ุจู ูุน DRBD9 ู Proxmox (ุงูุฌุฒุก 1: NFS)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417473/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f6a/771/043/f6a7710433c8887d6bbbe4792cc178e1.jpg" alt="ุงูุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุญุชูู ุฃู ูู ุดุฎุต ูุงู ูู ุญูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ูู ุฎูุงู ุงูุจุญุซ ุนู <strong>ุชุฎุฒูู</strong> ุนุงูู ุงูุฃุฏุงุก <strong>ูุญุฏุฏู ุงูุจุฑูุงูุฌ</strong> ุนุงุฌูุงู ุฃู ุขุฌูุงู ุณูุน ุนู <strong>DRBD</strong> ุ ุฃู ุฑุจูุง ุชุนุงูู ูุนู. </p><br><p style=";text-align:right;direction:rtl"> ุตุญูุญ ุ ูู ุฐุฑูุฉ ุดุนุจูุฉ <strong>Ceph</strong> ู <strong>GlusterFS</strong> ุ ุงูุชู ุชุนูู ุจุดูู ุฌูุฏ ูู ุญูุซ ุงููุจุฏุฃ ุ ูุงูุฃูู ูู ุฎุงุฑุฌ ุงูุตูุฏูู ุ ูุณู ุงูุฌููุน ุงููููู ุนููุง.  ุนูุงูุฉ ุนูู ุฐูู ุ ูู ูุฏุนู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู ุงููุณุฎ ุงููุชูุงุซู ูุฃูุซุฑ ูู ุนูุฏุชูู ุ ูุจุณุจุจ ูุฐุง ุ ุบุงูุจูุง ูุง ูุงุฌูุช ูุดุงูู ูุน <strong>ุงููุณุงู ุงูุฏูุงุบ</strong> ุ ูุงูุชู ูู ุงููุงุถุญ ุฃููุง ูู ุชุถูู ุฅูู ุดุนุจูุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ุงูุญู ููุณ ุฌุฏูุฏุงู ุ ููููู ุชูุงูุณู ุฌุฏุงู.  ูุน ุชูุงููู ููุฎูุถุฉ ูุณุจููุง ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุ ุชููุฑ <strong>DRBD</strong> ูุฒุงููุฉ ุณุฑูุนุฉ ูุขููุฉ ุญููุง ุนูู ูุณุชูู <strong>ุฌูุงุฒ ุงูุญุธุฑ</strong> .  ุทูุงู ูุฐุง ุงูููุช ุ ูุง ููู ูุทูุฑู LINBIT - DRBD ุณุงูููู ููููููู ุจุชุญุณููู ุจุงุณุชูุฑุงุฑ.  ุจุฏุกูุง ูู ุฅุตุฏุงุฑ <strong>DRBD9</strong> ุ ูู ูุนุฏ ูุฌุฑุฏ ูุฑุขุฉ ุดุจูุฉ ููุตุจุญ ุดูุฆูุง ุฃูุซุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุณูุทุช ููุฑุฉ ุฅูุดุงุก <strong>ุฌูุงุฒ ูุชูุฉ ููุฒุนุฉ</strong> ูุงุญุฏ ููุนุฏูุฏ ูู ุงูุฎูุงุฏู ูู ุงูุฎูููุฉ ุ ูุงูุขู ุชุญุงูู LINBIT ุชูููุฑ ุฃุฏูุงุช ูุชูุธูู ูุฅุฏุงุฑุฉ ุงูุนุฏูุฏ ูู ุฃุฌูุฒุฉ drbd ูู ูุฌููุนุฉ ูุชู ุฅูุดุงุคูุง ููู <strong>ุฃูุณุงู</strong> <strong>LVM</strong> ู <strong>ZFS</strong> . </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏุนู DRBD9 ูุง ูุตู ุฅูู 32 ูุณุฎุฉ ูุชูุงุซูุฉ ู RDMA ูุนูุฏ ุจุฏูู ูุฑุต ูุฃุฏูุงุช ุชูุธูู ุฌุฏูุฏุฉ ุชุชูุญ ูู ุงุณุชุฎุฏุงู ุงูููุทุงุช ูุงูุชุฑุญูู ุนุจุฑ ุงูุฅูุชุฑูุช ูุงููุฒูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃู <strong>DRBD9</strong> ูุญุชูู ุนูู ุฃุฏูุงุช ุชูุงูู ูุน <strong>Proxmox</strong> ู <strong>Kubernetes</strong> ู <strong>OpenStack</strong> ู <strong>OpenNebula</strong> ุ ูู ุงูููุช ุงูุญุงูู ูู ูู ูุถุน ุงูุชูุงูู ุ ุนูุฏูุง ูุง ูุชู ุฏุนู ุงูุฃุฏูุงุช ุงูุฌุฏูุฏุฉ ูู ูู ููุงู ุ ูุณูุชู ุงูุฅุนูุงู ุนู ุงูุฃุฏูุงุช ุงููุฏููุฉ ุนูู ุฃููุง <em>ูููููุฉ</em> ูุฑูุจูุง ุฌุฏูุง.  ูุฐู ูู <strong>DRBDmanage</strong> ู <strong>Linstor</strong> . </p><br><p style=";text-align:right;direction:rtl">  <strong>ุณุฃุณุชููุฏ</strong> ูู ูุฐู ุงููุญุธุฉ ูุนุฏู ุงูุฎูุถ ูู ุชูุงุตูู ูู ูููุง ูุซูุฑูุง ุ ูููู ููุญุต ุจูุฒูุฏ ูู ุงูุชูุตูู ุชูููู ููุจุงุฏุฆ ุงูุนูู ูุน <strong>DRBD9</strong> ููุณูุง. <a name="habracut"></a>  ูุง ูุฒุงู ูุชุนูู ุนููู ุงูุชุดุงู ุฐูู ุ ุฅุฐุง ูุงู ุฐูู ููุท ูุฃู ุงูุชูููู ุงููุชุญูู ููุฃุฎุทุงุก ูู ูุญุฏุฉ ุชุญูู Linstor ูุนูู ุถููููุง ุชุซุจูุชู ุนูู ุฃุญุฏ ูุฐู ุงูุฃุฌูุฒุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุฃูุฏ ุฃู ุฃุฎุจุฑูู ุนู <strong>DRBD9</strong> ูุฅููุงููุฉ ุงุณุชุฎุฏุงูู ูู <strong>Proxmox</strong> ุจุฏูู ุงูููููุงุช ุงูุฅุถุงููุฉ ุงูุฎุงุฑุฌูุฉ. </p><br><h2 id="drbdmanage-i-linstor" style=";text-align:right;direction:rtl">  ุฅุฏุงุฑุฉ ู ูููุณุชูุฑ </h2><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูู ุงูุฌุฏูุฑ ุจุงูุฐูุฑ ูุฑุฉ ุฃุฎุฑู ุนู <strong>DRBDmanage</strong> ุ ุงูุชู ุชุชูุงูู ุจุดูู ุฌูุฏ ููุบุงูุฉ ูู <strong>Proxmox</strong> .  ูููุฑ LINBIT ูููู DRBDmanage ุฌุงูุฒ ูู Proxmox ูุงูุฐู ูุณูุญ ูู ุจุงุณุชุฎุฏุงู ุฌููุน ูุธุงุฆูู ูุจุงุดุฑุฉ ูู ูุงุฌูุฉ <strong>Proxmox</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุงูุฃูุฑ ูุฏูุดูุง ุญููุง ุ ูููู ููุฃุณู ููุงู ุจุนุถ ุงูุนููุจ. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> ุฃููุงู ุ ูุฌุจ ุชุณููุฉ ุฃุณูุงุก <code>drbdpool</code> ุฃู <strong>ูุฌููุนุฉ LVM</strong> ุฃู <strong>ุชุฌูุน ZFS</strong> ุจู <code>drbdpool</code> . </li><li style=";text-align:right;direction:rtl">  ุนุฏู ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ุฃูุซุฑ ูู ุชุฌูุน ููู ุนูุฏุฉ </li><li style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุชูุงุตูู ุงูุญู ุ ูููู ุฃู ูููู <strong>ุญุฌู ูุญุฏุฉ ุงูุชุญูู</strong> ููุท ุนูู LVM ุนุงุฏู ูููุณ ุฎูุงู ุฐูู </li><li style=";text-align:right;direction:rtl">  ููุงุทู ุงูุฎูู ูู <strong>dbus</strong> ุงูุฏูุฑูุฉ ุ ูุงูุชู ุชุณุชุฎุฏู ุนู ูุซุจ ูู ูุจู <strong>DRBDmanage</strong> ููุชูุงุนู ูุน ุงูุนูุฏ. </li></ul><br><p style=";text-align:right;direction:rtl">  ููุชูุฌุฉ ูุฐูู ุ ูุฑุฑุช LINBIT ุงุณุชุจุฏุงู ูู ููุทู DRBDmanage ุงููุนูุฏ ุจุชุทุจูู ุจุณูุท ูุชูุงุตู ูุน ุงูุนูุฏ ุจุงุณุชุฎุฏุงู <strong>ุงุชุตุงู tcp</strong> ุนุงุฏู ููุนูู ุจุฏูู ุฃู ุณุญุฑ ููุงู.  ูุฐูู ูุงู ููุงู <strong>ูููุณุชูุฑ</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุนูู <strong>Linstor</strong> ุจุดูู ุฌูุฏ ููุบุงูุฉ.  ูุณูุก ุงูุญุธ ุ ุงุฎุชุงุฑ ุงููุทูุฑูู ูุบุฉ <strong>ุฌุงูุง</strong> ุจุงุนุชุจุงุฑูุง ุงููุบุฉ ุงูุฑุฆูุณูุฉ ููุชุงุจุฉ ุฎุงุฏู Linstor ุ ูููู ูุง ุชุฏุน ูุฐุง ูุฎููู ุ ูุฃู Linstor ููุณูุง ูุง ุชูุชู ุณูู <strong>ุจุชูุฒูุน</strong> ุชููููุงุช DRBD <strong>ูุชูุทูุน</strong> ุฃูุณุงู LVM / ZFS ุนูู ุงูุนูุฏ. </p><br><blockquote style=";text-align:right;direction:rtl">  ููุง ุงูุญููู <strong>ูุฌุงููุงู</strong> ููุชู ุชูุฒูุนููุง ุจููุฌุจ ุชุฑุฎูุต <strong>GPL3</strong> ุงููุฌุงูู <strong>.</strong> </blockquote><p style=";text-align:right;direction:rtl">  ููููู ุงููุฑุงุกุฉ ุนู ูู ูุงุญุฏ ูููู ูุนู ุฅุนุฏุงุฏ ุงููููู ุงูุฅุถุงูู ุงููุฐููุฑ ุฃุนูุงู ูู <strong>Proxmox</strong> ุนูู ูููุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Proxmox ุงูุฑุณูู</a> </p><br><h2 id="otkazoustoychivyy-nfs-server" style=";text-align:right;direction:rtl">  ุชุฌุงูุฒ ุงููุดู ุฎุงุฏู NFS </h2><br><p style=";text-align:right;direction:rtl">  ูุณูุก ุงูุญุธ ุ ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ <strong>ูู ููู</strong> ูุฏู <strong>Linstor ุณูู</strong> ุงูุชูุงูู ูุน <strong>Kubernetes</strong> .  ูููู ูู ููุงูุฉ ุงูุนุงู ุ ูู ุงููุชููุน ุฃู ุชููู ููุงู ุจุฑุงูุฌ ุชุดุบูู ูุจููุฉ ุฃูุธูุฉ <strong>Proxmox</strong> ู <strong>OpenNebula</strong> ู <strong>OpenStack</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูููู ุญุชู ุงูุขู ูุง ููุฌุฏ ุญู ุฌุงูุฒ ุ ููููุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ูุง ูุญุจ ุงูุญู ุงููุฏูู.  ุฏุนููุง ูุญุงูู ุงุณุชุฎุฏุงู DRBD9 ุจุงูุทุฑููุฉ ุงููุฏููุฉ ูุชูุธูู <strong>ูุตูู NFS</strong> ุฅูู ูุณู ูุดุชุฑู. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ูุฅู ูุฐุง ุงูุญู ุณูุซุจุช ุฃูุถูุง ุฃูู ูุง ูุฎูู ูู ุงููุฒุงูุง ุ ูุฃู ุฎุงุฏู NFS ุณูุณูุญ ูู ุจุชูุธูู <strong>ุงููุตูู ุงูุชูุงูุณู</strong> ุฅูู ูุธุงู ุงููููุงุช ูู ุงููุณุชูุฏุน ูู ุนุฏุฉ ุฎูุงุฏู ุฏูู ุงูุญุงุฌุฉ ุฅูู ุฃูุธูุฉ ูููุงุช ูุนูุฏุฉ ูุนูุฏุฉ ูุน DLM ุ ูุซู OCFS ู GFS2. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชุชููู ูู ุชุจุฏูู ุฃุฏูุงุฑ ุงูุนูุฏุฉ <strong>ุงูุฃุณุงุณูุฉ</strong> / <strong>ุงูุซุงูููุฉ</strong> ุจุจุณุงุทุฉ ุนู ุทุฑูู ุชุฑุญูู ุงูุญุงููุฉ ูุน ุฎุงุฏู NFS ูู ูุงุฌูุฉ Proxmox. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุฃูุถูุง ุชุฎุฒูู ุฃู ูููุงุช ุฏุงุฎู ูุธุงู ุงููููุงุช ูุฐุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฃูุฑุงุต ุงูุงูุชุฑุงุถูุฉ ูุงููุณุฎ ุงูุงุญุชูุงุทูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ ุงุณุชุฎุฏุงู <strong>Kubernetes ุ</strong> ุณุชุชููู ูู ุชุฑุชูุจ ูุตูู <strong>ReadWriteMany</strong> ุงูุฎุงุต ุจู ุฅูู <strong>PersistentVolumes</strong> . </p><br><h2 id="proxmox-i-lxc-konteynery" style=";text-align:right;direction:rtl">  ุญุงููุงุช Proxmox ู LXC </h2><br><p style=";text-align:right;direction:rtl">  ุงูุณุคุงู ุงูุขู: ููุงุฐุง Proxmoxุ </p><br><p style=";text-align:right;direction:rtl">  ูู ุญูุซ ุงููุจุฏุฃ ุ ูุจูุงุก ูุซู ูุฐุง ุงููุฎุทุท ุ ูููููุง ุงุณุชุฎุฏุงู Kubernetes ููุฐูู ุงููุฎุทุท ุงููุนุชุงุฏ ูุน ูุฏูุฑ ุงููุชูุฉ.  ููู <strong>Proxmox</strong> ูููุฑ ูุงุฌูุฉ ุฌุงูุฒุฉ ูุชุนุฏุฏุฉ ุงููุธุงุฆู ููุบุงูุฉ ููู ููุณ ุงูููุช ูุงุฌูุฉ ุจุณูุทุฉ ูุจุฏูููุฉ ููู ูุง ุชุญุชุงุฌู ุชูุฑูุจูุง.  ุฅูู ุฎุงุฑุฌ ุงูุตูุฏูู ูุงุฏุฑ ุนูู <strong>ุงูุชุฌููุน</strong> ููุฏุนู ุขููุฉ <strong>ุงููุจุงุฑุฒุฉ</strong> ุงููุงุฆูุฉ ุนูู softdog.  ูุนูุฏ ุงุณุชุฎุฏุงู <strong>ุญุงููุงุช LXC ุ</strong> ูุชูุญ ูู ุชุญููู ุงูุญุฏ ุงูุฃุฏูู ูู ุงููููุงุช ุนูุฏ ุงูุชุจุฏูู. <br>  ูู ูููู ููุญู ุงููุงุชุฌ <strong>ููุทุฉ</strong> ูุงุญุฏุฉ <strong>ูู ุงููุดู</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ุณูุณุชุฎุฏู Proxmox ูู ุงูููุงู ุงูุฃูู ููุฏูุฑ <strong>ูุฌููุนุฉ</strong> ุ ุญูุซ ูููููุง ุงูุชูููุฑ ูู <strong>ุญุงููุฉ LXC</strong> ูููุตูุฉ ูุฎุฏูุฉ ุชุนูู ูู ูุฌููุนุฉ HA ุงูููุงุณูููุฉ ุ ููุท ูุน ุงุฎุชูุงู ุฃู ุงูุญุงููุฉ ุชุฃุชู ุฃูุถูุง ูุน <strong>ูุธุงู ุงูุฌุฐุฑ ุงูุฎุงุต ุจูุง</strong> .  ุฃู ุฃูู ูุง ุชุญุชุงุฌ ุฅูู ุชุซุจูุช ุงูุนุฏูุฏ ูู ูุซููุงุช ุงูุฎุฏูุฉ ุนูู ูู ุฎุงุฏู ุจุดูู ูููุตู ุ ููููู ุงูููุงู ุจุฐูู ูุฑุฉ ูุงุญุฏุฉ ููุท ุฏุงุฎู ุงูุญุงููุฉ. <br>  ุฅุฐุง ููุช ูุฏ ุนููุช ูู ุฃู ููุช ูุถู ูุน <strong>ุจุฑูุงูุฌ ูุฏูุฑ ุงููุชูุฉ</strong> ูุชูููุฑ <strong>HA</strong> ููุชุทุจููุงุช ุ ูุณูู ุชููู ูุง ุฃุนููู. </p><br><h2 id="obschaya-shema" style=";text-align:right;direction:rtl">  ูุฎุทุท ุนุงู </h2><br><p style=";text-align:right;direction:rtl">  ุณูุดุจู ุงูุญู ุงูุฐู ููุฏูู ูุฎุทุท ุงููุณุฎ ุงููุชูุงุซู ุงูููุงุณู ููุงุนุฏุฉ ุจูุงูุงุช. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฏููุง <strong>ุซูุงุซ ุนูุฏ</strong> </li><li style=";text-align:right;direction:rtl">  ุชุญุชูู ูู ุนูุฏุฉ ุนูู <strong>ุฌูุงุฒ drbd</strong> ููุฒุน. </li><li style=";text-align:right;direction:rtl">  ุงูุฌูุงุฒ ุจู ูุธุงู ูููุงุช ุนุงุฏู ( <strong>ext4</strong> ) </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ูููู ุฎุงุฏู ูุงุญุฏ ููุท <strong>ุณูุฏ</strong> </li><li style=";text-align:right;direction:rtl">  ูุชู ุชุดุบูู <strong>ุฎุงุฏู NFS</strong> ูู <strong>ุญุงููุฉ LXC</strong> ุนูู ุงููุนุงูุฌ. </li><li style=";text-align:right;direction:rtl">  ุชุตู ุฌููุน ุงูุนูุฏ ุฅูู ุงูุฌูุงุฒ ุจุฏูุฉ ูู ุฎูุงู <strong>NFS.</strong> </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูููู ุฃู ููุชูู ุงููุนุงูุฌ ุฅูู ุนูุฏุฉ ุฃุฎุฑู ุ ุฅูู ุฌุงูุจ <strong>ุฎุงุฏู NFS</strong> </li></ul><br><p style=";text-align:right;direction:rtl">  ูุญุชูู <strong>DRBD9</strong> ุนูู ููุฒุฉ ุฑุงุฆุนุฉ ุฌุฏูุง ุชุจุณุท ูู ุดูุก ุจุดูู ูุจูุฑ: <br>  ูุตุจุญ ุฌูุงุฒ drbd ุชููุงุฆููุง ุฃุณุงุณููุง ูู ุงูููุช ุงูุฐู ูุชู ููู ุชุฑููุจู ุนูู ุจุนุถ ุงูุนูุฏุฉ.  ุฅุฐุง ุชู ูุถุน ุนูุงูุฉ ุนูู ุงูุฌูุงุฒ ุนูู ุฃูู <strong>ุฃุณุงุณู</strong> ุ ูุฅู ุฃู ูุญุงููุฉ ูุชุฑููุจู ุนูู ุนูุฏุฉ ุฃุฎุฑู ุณุชุคุฏู ุฅูู ุฎุทุฃ ูู ุงููุตูู.  ููุฐุง ูุถูู ุงูุญุธุฑ ูุงูุญูุงูุฉ ุงููุถูููุฉ ุถุฏ ุงููุตูู ุงููุชุฒุงูู ููุฌูุงุฒ. </p><br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ูุจุณุท ูู ูุฐุง ุฅูู ุญุฏ ูุจูุฑุ  ูุฃูู ุนูุฏูุง ุชุจุฏุฃ ุงูุญุงููุฉ ุ ูููู <strong>Proxmox</strong> ุชููุงุฆููุง ุจุชุซุจูุช ูุฐุง ุงูุฌูุงุฒ ููุตุจุญ <strong>ุฃุณุงุณููุง</strong> ูู ูุฐู ุงูุนูุฏุฉ ุ ูุนูุฏูุง ุชุชููู ุงูุญุงููุฉ ุ ูุชู ุฅูุบุงุก ุชุญูููู ุนูู ุงูุนูุณ ููุตุจุญ ุงูุฌูุงุฒ <strong>ุซุงููููุง</strong> ูุฑุฉ ุฃุฎุฑู. <br>  ูุจุงูุชุงูู ุ ูู ูุนุฏ ุจุญุงุฌุฉ ููููู ุจุดุฃู ุชุจุฏูู ุงูุฃุฌูุฒุฉ <strong>ุงูุฃุณุงุณูุฉ</strong> / <strong>ุงูุซุงูููุฉ</strong> ุ ูุณูููู Proxmox ุจุฐูู <strong>ุชููุงุฆููุง</strong> ุ ูุฑุญู! </p><br><h2 id="nastroyka-drbd" style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ DRBD </h2><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ููุฏ ุชูุตููุง ุฅูู ุงูููุฑุฉ ุ ููููุชูู ุงูุขู ุฅูู ุงูุชูููุฐ. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุงูุชุฑุงุถู <strong>ุ</strong> ูุชู ุชูููุฑ <strong>ุงูุฅุตุฏุงุฑ ุงูุซุงูู ูู drbd</strong> <strong>ูุน ููุงุฉ ููููุณ</strong> ุ ููุฃุณู ูุง <strong>ููุงุณุจูุง</strong> ููุญู ุจุญุงุฌุฉ ุฅูู ุชุซุจูุช ุงูุฅุตุฏุงุฑ ุงูุชุงุณุน ูู ุงููุญุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุชูุตูู ูุณุชูุฏุน LINBIT ููู ุจุชุซุจูุช ูู ูุง ุชุญุชุงุฌู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">wget -O- https://packages.linbit.com/package-signing-pubkey.asc | apt-key add - <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"deb http://packages.linbit.com/proxmox/ proxmox-5 drbd-9.0"</span></span> \ &gt; /etc/apt/sources.list.d/linbit.list apt-get update &amp;&amp; apt-get -y install pve-headers drbd-dkms drbd-utils drbdtop</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>pve-headers</code> kernel ุงููุงุฒูุฉ ูุจูุงุก ุงููุญุฏุฉ </li><li style=";text-align:right;direction:rtl">  <code>drbd-dkms</code> - ูุญุฏุฉ kernel ูู ุดูู DKMS </li><li style=";text-align:right;direction:rtl">  <code>drbd-utils</code> - ุงููุฑุงูู ุงูุฃุณุงุณูุฉ ูุฅุฏุงุฑุฉ DRBD </li><li style=";text-align:right;direction:rtl">  <code>drbdtop</code> ูู ุฃุฏุงุฉ ุชูุงุนููุฉ ูุซู ุงูููุฉ ูู DRBD ููุท </li></ul><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุซุจูุช <strong>ุงููุญุฏุฉ ุ ุณูู</strong> ูุชุญูู ููุง ุฅุฐุง ูุงู ูู ุดูุก ููุงุณุจูุง ููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># modprobe drbd # cat /proc/drbd version: 9.0.14-1 (api:2/proto:86-113)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุฑุฃูุช <strong>ุงูุฅุตุฏุงุฑ ุงูุซุงูู</strong> ูู ุฅุฎุฑุงุฌ ุงูุฃูุฑ ุ ุญุฏุซ ุฎุทุฃ ูุง ูุชู ุชุญููู ูุญุฏุฉ kernel <strong>ุฏุงุฎู ุงูุดุฌุฑุฉ</strong> .  ุชุญูู ูู <code>dkms status</code> ููุนุฑูุฉ ุงูุณุจุจ. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ููู ุนูุฏุฉ ูุฏููุง ููุณ <strong>ุฌูุงุฒ drbd</strong> ูุนูู ุนูู ุงูุฃูุณุงู ุงูุนุงุฏูุฉ.  ูุญุชุงุฌ ุฃููุงู ุฅูู ุฅุนุฏุงุฏ ูุฐุง ุงููุณู ูู drbd ุนูู ูู ุนูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูููู ูุฐุง ุงููุณู ุฃู <strong>ุฌูุงุฒ ูุชูุฉ</strong> ุ ูููู ุฃู ูููู lvm ุฃู zvol ุฃู ูุณู ุงููุฑุต ุฃู ุงููุฑุต ุจุฃูููู.  ูู ูุฐู ุงูููุงูุฉ ุณุฃุณุชุฎุฏู ูุฑุต nvme ูููุตู ูุน ูุณู ุชุญุช drbd: <code>/dev/nvme1n1p1</code> </p><br><p style=";text-align:right;direction:rtl">  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุฃุณูุงุก ุงูุฃุฌูุฒุฉ ุชููู ุฅูู ุงูุชุบููุฑ ูู ุจุนุถ ุงูุฃุญูุงู ุ ูุฐูู ูู ุงูุฃูุถู ุฃู ุชุฃุฎุฐูุง ุนูู ุงูููุฑ ูุนุงุฏุฉ ูุงุณุชุฎุฏุงู ุงุฑุชุจุงุท ุฑูุฒู ุซุงุจุช ููุฌูุงุฒ. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุงูุนุซูุฑ ุนูู ูุซู ูุฐุง ุงูุงุฑุชุจุงุท ุงูุฑูุฒู ูู <code>/dev/nvme1n1p1</code> ุจูุฐู ุงูุทุฑููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># find /dev/disk/ -lname '*/nvme1n1p1' /dev/disk/by-partuuid/847b9713-8c00-48a1-8dff-f84c328b9da2 /dev/disk/by-path/pci-0000:0e:00.0-nvme-1-part1 /dev/disk/by-id/nvme-eui.0000000001000000e4d25c33da9f4d01-part1 /dev/disk/by-id/nvme-INTEL_SSDPEKKA010T7_BTPY703505FB1P0H-part1</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ูุตู ููุงุฑุฏูุง ุนูู ุฌููุน ุงูุนูุฏ ุงูุซูุงุซ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat /etc/drbd.d/nfs1.res resource nfs1 { meta-disk internal; device /dev/drbd100; protocol C; net { after-sb-0pri discard-zero-changes; after-sb-1pri discard-secondary; after-sb-2pri disconnect; } on pve1 { address 192.168.2.11:7000; disk /dev/disk/by-partuuid/95e7eabb-436e-4585-94ea-961ceac936f7; node-id 0; } on pve2 { address 192.168.2.12:7000; disk /dev/disk/by-partuuid/aa7490c0-fe1a-4b1f-ba3f-0ddee07dfee3; node-id 1; } on pve3 { address 192.168.2.13:7000; disk /dev/disk/by-partuuid/847b9713-8c00-48a1-8dff-f84c328b9da2; node-id 2; } connection-mesh { hosts pve1 pve2 pve3; } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุณุชุญุณู ุงุณุชุฎุฏุงู <strong>ุดุจูุฉ ูููุตูุฉ</strong> ููุฒุงููุฉ drbd. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุฅูุดุงุก ุจูุงูุงุช ุงูุชุนุฑูู ูู drbd ููู ุจุชุดุบูููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># drbdadm create-md nfs1 initializing activity log initializing bitmap (320 KB) to all zero Writing meta data... New drbd meta data block successfully created. success # drbdadm up nfs1</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑุฑ ูุฐู ุงูุฎุทูุงุช ุนูู ุงูุนูุฏ ุงูุซูุงุซ ูุชุญูู ูู ุงูุญุงูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># drbdadm status nfs1 role:Secondary disk:Inconsistent pve2 role:Secondary peer-disk:Inconsistent pve3 role:Secondary peer-disk:Inconsistent</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฑุตูุง <strong>ุบูุฑ ุงููุชูุงุณู ููุฌูุฏ</strong> ุนูู ุฌููุน ุงูุนูุฏ ุงูุซูุงุซ ุ ูุฐูู ูุฃู drbd ูุง ูุนุฑู ุฃู ูุฑุต ูุฌุจ ุฃู ูุคุฎุฐ ุนูู ุฃูู ุงูุฃุตูู.  ูุฌุจ ูุถุน ุนูุงูุฉ ุนูู ุฃุญุฏูุง ุนูู ุฃูู <strong>ุฃุณุงุณู</strong> ุญุชู ุชุชู ูุฒุงููุฉ ุญุงูุชู ูุน ุงูุนูุฏ ุงูุฃุฎุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">drbdadm primary --force nfs1 drbdadm secondary nfs1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุงุดุฑุฉ ุจุนุฏ ุฐูู ุ ุณุชุจุฏุฃ <strong>ุงููุฒุงููุฉ</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># drbdadm status nfs1 role:Secondary disk:UpToDate pve2 role:Secondary replication:SyncSource peer-disk:Inconsistent done:26.66 pve3 role:Secondary replication:SyncSource peer-disk:Inconsistent done:14.20</span></span></code> </pre><br><p style=";text-align:right;direction:rtl">  ูุง ูุฌุจ ุฃู ููุชุธุฑ ุญุชู ููุชูู ููููููุง ุชูููุฐ ุฎุทูุงุช ุฃุฎุฑู ุจุงูุชูุงุฒู.  ูููู ุชูููุฐูุง ุนูู <strong>ุฃู ุนูุฏุฉ</strong> ุ ุจุบุถ ุงููุธุฑ ุนู ุญุงูุชูุง ุงูุญุงููุฉ ูููุฑุต ุงููุญูู ูู DRBD.  ุณุชุชู ุฅุนุงุฏุฉ ุชูุฌูู ุฌููุน ุงูุทูุจุงุช ุชููุงุฆููุง ุฅูู ุงูุฌูุงุฒ ุจุญุงูุฉ <strong>UpToDate</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุง ุชูุณู ุชูุนูู <strong>ุงูุชุดุบูู ุงูุชููุงุฆู</strong> ูุฎุฏูุฉ drbd ุนูู ุงูุนูุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> drbd.service</code> </pre> <br><h2 id="nastroyka-lxc-konteynera" style=";text-align:right;direction:rtl">  ุชูููู ุญุงููุฉ LXC </h2><br><p style=";text-align:right;direction:rtl">  ุณูุญุฐู ุฌุฒุก ุงูุชููุฆุฉ ูู <strong>ูุฌููุนุฉ Proxmox</strong> ูู ุซูุงุซ ุนูุฏ ุ ููุฐุง ุงูุฌุฒุก ููุตูู ุฌูุฏูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููููู ุงูุฑุณูู</a> </p><br><p style=";text-align:right;direction:rtl">  ููุง ููุช ูู ูุจู ุ ุณูุนูู <strong>ุฎุงุฏู NFS</strong> ูู <strong>ุญุงููุฉ LXC</strong> .  <code>/dev/drbd100</code> ุจุงูุญุงููุฉ ุนูู ุงูุฌูุงุฒ <code>/dev/drbd100</code> ุงูุฐู <code>/dev/drbd100</code> ููุชู. </p><br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ ุฃููุงู ุฅูู ุฅูุดุงุก <strong>ูุธุงู ูููุงุช</strong> ุนููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">mkfs <span class="hljs-literal"><span class="hljs-literal">-t</span></span> ext4 <span class="hljs-literal"><span class="hljs-literal">-O</span></span> mmp <span class="hljs-literal"><span class="hljs-literal">-E</span></span> mmp_update_interval=<span class="hljs-number"><span class="hljs-number">5</span></span> /dev/drbd100</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชุถูู <strong>Proxmox</strong> ุจุดูู ุงูุชุฑุงุถู <strong>ุญูุงูุฉ ูุชุนุฏุฏุฉ</strong> ุนูู ูุณุชูู ูุธุงู ุงููููุงุช ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ูููููุง ุงูุงุณุชุบูุงุก ุนููุง ุ ูุฃูู  ุชุชูุชุน DRBD ุจุญูุงูุชูุง ุงูุฎุงุตุฉ ุจุดูู ุงูุชุฑุงุถู ุ ููู ุจุจุณุงุทุฉ ุชููุน <strong>ุงูุฃุณุงุณู</strong> ุงูุซุงูู ููุฌูุงุฒ ุ ูููู ุงูุญุฐุฑ ูุง ูุคุฐููุง. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุชูุฒูู ูุงูุจ Ubuntu: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"># wget http://download.proxmox.com/images/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/ubuntu<span class="hljs-number"><span class="hljs-number">-16.04</span></span>-standard_16<span class="hljs-number"><span class="hljs-number">.04</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>_amd64.tar.gz -P /var/lib/vz/<span class="hljs-keyword"><span class="hljs-keyword">template</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>/</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃูุดุฆ ุญุงููุชูุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">pct create <span class="hljs-number"><span class="hljs-number">101</span></span> local:vztmpl/ubuntu<span class="hljs-literal"><span class="hljs-literal">-16</span></span>.<span class="hljs-number"><span class="hljs-number">04</span></span><span class="hljs-literal"><span class="hljs-literal">-standard_16</span></span>.<span class="hljs-number"><span class="hljs-number">04</span></span><span class="hljs-literal"><span class="hljs-literal">-1_amd64</span></span>.tar.gz \ -<span class="hljs-literal"><span class="hljs-literal">-hostname</span></span>=nfs1 \ -<span class="hljs-literal"><span class="hljs-literal">-net0</span></span>=name=eth0,bridge=vmbr0,gw=<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span>,ip=<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.11</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> \ -<span class="hljs-literal"><span class="hljs-literal">-rootfs</span></span>=volume=/dev/drbd100,shared=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงูุฃูุฑ ุ ูุดูุฑ ุฅูู ุฃู <strong>ูุธุงู ุงูุฌุฐุฑ</strong> <code>/dev/drbd100</code> ุณูููู ุนูู ุงูุฌูุงุฒ <code>/dev/drbd100</code> ูุฅุถุงูุฉ ุงููุนููุฉ <code>shared=1</code> ููุณูุงุญ <code>/dev/drbd100</code> ุงูุญุงููุฉ ุจูู ุงูุนูุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุญุฏุซ ุฎุทุฃ ูุง ุ ูููููู ุฏุงุฆููุง ุฅุตูุงุญู ูู ุฎูุงู ูุงุฌูุฉ <code>/etc/pve/lxc/101.conf</code> ุฃู ูู <code>/etc/pve/lxc/101.conf</code> ุญุงููุฉ <code>/etc/pve/lxc/101.conf</code> </p><br><p style=";text-align:right;direction:rtl">  ุณูููู Proxmox ุจูู ุงููุงูุจ ูุฅุนุฏุงุฏ <strong>ูุธุงู ุฌุฐุฑ</strong> ุงูุญุงููุฉ ููุง.  ุจุนุฏ ุฐูู ูููููุง ุฅุทูุงู ุงูุญุงููุฉ ุงูุฎุงุตุฉ ุจูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">pct <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span></code> </pre> <br><h2 id="nastroyka-nfs-servera" style=";text-align:right;direction:rtl">  ุชูููู ุฎุงุฏู NFS. </h2><br><p style=";text-align:right;direction:rtl">  ุงูุชุฑุงุถููุง ุ <strong>ูุง ูุณูุญ</strong> <strong>Proxmox ูุฎุงุฏู NFS</strong> ุจุงูุนูู ูู ุงูุญุงููุฉ ุ ูููู ููุงู ุนุฏุฉ ุทุฑู ูุชููููู. </p><br><p style=";text-align:right;direction:rtl">  ุฃุญุฏูุง ููุท ูุฅุถุงูุฉ <code>lxc.apparmor.profile: unconfined</code> <code>/etc/pve/lxc/100.conf</code> ุงูุฎุงุต <code>/etc/pve/lxc/100.conf</code> . </p><br><p style=";text-align:right;direction:rtl">  ุฃู ูููููุง <strong>ุชูููู NFS</strong> ูุฌููุน ุงูุญุงููุงุช ุนูู ุฃุณุงุณ ูุณุชูุฑ ุ ูุฐูู ูุญู ุจุญุงุฌุฉ ุฅูู ุชุญุฏูุซ ุงููุงูุจ ุงูููุงุณู ูู LXC ุนูู ุฌููุน ุงูุนูุฏ ุ ุฃุถู ุงูุฃุณุทุฑ ุงูุชุงููุฉ ุฅูู <code>/etc/apparmor.d/lxc/lxc-default-cgns</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">mount</span></span> fstype=nfs, mount fstype=nfs4, mount fstype=nfsd, mount fstype=rpc_pipefs,</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุชุบููุฑุงุช ุ ุฃุนุฏ ุชุดุบูู ุงูุญุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">pct shutdown <span class="hljs-number"><span class="hljs-number">101</span></span> pct <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนููุง ุชุณุฌูู ุงูุฏุฎูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs perl">pct <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span> bash</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุซุจูุช ุงูุชุญุฏูุซุงุช <strong>ูุฎุงุฏู NFS</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> update apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> <span class="hljs-literal"><span class="hljs-literal">-y</span></span> upgrade apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> <span class="hljs-literal"><span class="hljs-literal">-y</span></span> install nfs<span class="hljs-literal"><span class="hljs-literal">-kernel</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅูุดุงุก <strong>ุชุตุฏูุฑ</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">echo</span></span> '/<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> *(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rw</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">no_root_squash</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">no_subtree_check</span></span></span><span class="hljs-class">)' &gt;&gt; /etc/exports mkdir /</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> exportfs -a</span></span></code> </pre> <br><h2 id="nastroyka-ha" style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ HA </h2><br><p style=";text-align:right;direction:rtl">  ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ ูุญุชูู proxmox <strong>HA-manager</strong> ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎุทุฃ</a> ูุง ูุณูุญ ูุญุงููุฉ HA ุจุฅููุงู ุนูููุง ุจูุฌุงุญ ุ ููุชูุฌุฉ ูุฐูู ุ ุชููุน ุนูููุงุช <strong>ูุณุงุญุฉ ุงูููุงุฉ</strong> <strong>ูุฎุงุฏู nfs</strong> ุงูุชู ูู ุชููุชู ุชูุงููุง ุฌูุงุฒ drbd ูู ูุบุงุฏุฑุฉ <strong>ุงููุฑุญูุฉ ุงูุซุงูููุฉ</strong> .  ุฅุฐุง ููุช ูุฏ ูุงุฌูุช ูุซู ูุฐุง ุงููููู ุจุงููุนู ุ ููุง ุฏุงุนู ููุฐุนุฑ ูุชูููุฐ <code>killall -9 nfsd</code> ุนูู ุงูุนูุฏุฉ ุญูุซ ุชู ุฅุทูุงู ุงูุญุงููุฉ ุ ููู ุซู ูุฌุจ ุฃู "ูุทูู" ุฌูุงุฒ drbd ูุณูุฐูุจ ุฅูู <strong>ุงูุซุงููู</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุฅุตูุงุญ ูุฐุง ุงูุฎุทุฃ ุ ูู ุจุชุดุบูู ุงูุฃูุงูุฑ ุงูุชุงููุฉ ุนูู ุฌููุน ุงูุนูุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">sed <span class="hljs-literal"><span class="hljs-literal">-i</span></span> <span class="hljs-string"><span class="hljs-string">'s/forceStop =&gt; 1,/forceStop =&gt; 0,/'</span></span> /usr/share/perl5/PVE/HA/Resources/PVECT.pm systemctl restart pve<span class="hljs-literal"><span class="hljs-literal">-ha</span></span><span class="hljs-literal"><span class="hljs-literal">-lrm</span></span>.service</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุงูุงูุชูุงู ุฅูู ุชูููู <strong>HA-manager</strong> .  ูููู ุจุฅูุดุงุก ูุฌููุนุฉ HA ูููุตูุฉ ูุฌูุงุฒูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">ha<span class="hljs-literal"><span class="hljs-literal">-manager</span></span> groupadd nfs1 -<span class="hljs-literal"><span class="hljs-literal">-nodes</span></span> pve1,pve2,pve3 -<span class="hljs-literal"><span class="hljs-literal">-nofailback</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> -<span class="hljs-literal"><span class="hljs-literal">-restricted</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูุนูู ููุฑุฏูุง ููุท ุนูู ุงูุนูุฏ ุงููุญุฏุฏุฉ ููุฐู ุงููุฌููุนุฉ.  ุฃุถู ุญุงููุชูุง ููุฐู ุงููุฌููุนุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">ha<span class="hljs-literal"><span class="hljs-literal">-manager</span></span> add ct:<span class="hljs-number"><span class="hljs-number">101</span></span> -<span class="hljs-literal"><span class="hljs-literal">-group</span></span>=nfs1 -<span class="hljs-literal"><span class="hljs-literal">-max_relocate</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span> -<span class="hljs-literal"><span class="hljs-literal">-max_restart</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก.  ุจุณูุทุฉ ุ ุฃููุณ ูุฐููุ </p><br><p style=";text-align:right;direction:rtl">  ูููู ุชูุตูู <strong>ูุฑุฉ nfs</strong> ุงููุงุชุฌุฉ ุนูู ุงูููุฑ ุจู Proxmox ูุชุฎุฒูู ูุชุดุบูู ุงูุฃุฌูุฒุฉ ูุงูุญุงููุงุช ุงูุงูุชุฑุงุถูุฉ ุงูุฃุฎุฑู. </p><br><h2 id="rekomendacii-i-tyuning" style=";text-align:right;direction:rtl">  ุงูุชูุตูุงุช ูุงูุถุจุท </h2><br><h5 id="drbd" style=";text-align:right;direction:rtl">  DRBD </h5><br><p style=";text-align:right;direction:rtl">  ููุง ุฃุดุฑุช ุฃุนูุงู ุ ูู ุงููุณุชุญุณู ุฏุงุฆููุง ุงุณุชุฎุฏุงู ุดุจูุฉ ูููุตูุฉ ูููุณุฎ ุงููุชูุงุซู.  ูู ุงููุณุชุญุณู ููุบุงูุฉ ุงุณุชุฎุฏุงู <strong>ูุญููุงุช ุดุจูุฉ 10 ุฌูุฌุงุจุช</strong> ุ ูุฅูุง ูุณูู ุชูุงุฌู ุณุฑุนุฉ ุงููููุฐ. <br>  ุฅุฐุง ูุงู ุงููุณุฎ ุงููุชูุงุซู ูุจุฏู ุจุทูุฆูุง ุจูุง ููู ุงูููุงูุฉ ุ ูุฌุฑุจ ุจุนุถ ุงูุฎูุงุฑุงุช ูู <strong>DRBD</strong> .  ููุง ูู ุงูุชูููู ุ ููู ูู ุฑุฃูู ุงูุฃูุซู <strong>ูุดุจูุฉ 10G</strong> ุงูุฎุงุตุฉ ุจู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs swift"># cat /etc/drbd.d/global_common.conf global { usage-<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> yes; udev-always-use-vnr; } common { handlers { } startup { } options { } disk { <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-fill-target 10M; <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>-rate 720M; <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-plan-ahead <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>-rate 20M; } net { <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>-buffers 36k; sndbuf-size 1024k; rcvbuf-size 2048k; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุงูุญุตูู ุนูู ูุฒูุฏ ูู ุงููุนูููุงุช ุญูู ูู ูุนููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู DRBD ุงูุฑุณููุฉ.</a> </p><br><h5 id="nfs-server" style=";text-align:right;direction:rtl">  ุฎุงุฏู NFS </h5><br><p style=";text-align:right;direction:rtl">  ูุชุณุฑูุน ุนูููุฉ <strong>ุฎุงุฏู NFS ุ</strong> ูุฏ ูุณุงุนุฏ ูู ุฒูุงุฏุฉ ุงูุนุฏุฏ ุงูุฅุฌูุงูู <strong>ููุซููุงุช</strong> ุฎุงุฏู NFS ููุฏ ุงูุชุดุบูู.  ุจุดูู ุงูุชุฑุงุถู - <strong>8</strong> ุ ุดุฎุตููุง ุ ุณุงุนุฏูู ุนูู ุฒูุงุฏุฉ ูุฐุง ุงูุนุฏุฏ ุฅูู <strong>64</strong> . </p><br><p style=";text-align:right;direction:rtl">  ูุชุญููู ุฐูู ุ ูู ุจุชุญุฏูุซ <code>RPCNFSDCOUNT=64</code> ูุนููุฉ ูู <code>/etc/default/nfs-kernel-server</code> . <br>  ูุฅุนุงุฏุฉ ุงูุดูุงุทูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> nfs-utils systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> nfs-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br><h5 id="nfsv3-vs-nfsv4" style=";text-align:right;direction:rtl">  NFSv3 ููุงุจู NFSv4 </h5><br><p style=";text-align:right;direction:rtl">  ุชุนุฑู ุงููุฑู ุจูู <strong>NFSv3</strong> ู <strong>NFSv4</strong> ุ </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>NFSv3</strong> ูู <strong>ุจุฑูุชูููู ุนุฏูู ุงูุฌูุณูุฉ ุ</strong> ูููุงุนุฏุฉ ุนุงูุฉ ุ ูุฅูู ูุชุญูู ุจุดูู ุฃูุถู ุญุงูุงุช ุงููุดู ููุชุนุงูู ุจุดูู ุฃุณุฑุน. </li><li style=";text-align:right;direction:rtl">  <strong>NFSv4</strong> ูู <strong>ุจุฑูุชูููู ุฐู ุญุงูุฉ</strong> ุ ููู ูุนูู ุจุดูู ุฃุณุฑุน ููููู ุฑุจุทู ุจููุงูุฐ TCP ูุนููุฉ ุ ูููู ูุธุฑูุง ููุฌูุฏ ุงูุญุงูุฉ ุ ูุฅูู ุฃูุซุฑ ุญุณุงุณูุฉ ููุฅุฎูุงูุงุช.  ููุง ุฃู ูุฏููุง ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ุงููุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู Kerberos ููุฌููุนุฉ ูู ุงูููุฒุงุช ุงูุฃุฎุฑู ุงููุซูุฑุฉ ููุงูุชูุงู. </li></ul><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ุนูุฏ ุชุดุบูู <code>showmount -e nfs_server</code> ุ ูุชู ุงุณุชุฎุฏุงู ุจุฑูุชูููู NFSv3.  ูุณุชุฎุฏู Proxmox ุฃูุถูุง NFSv3.  ููุง ููุณุชุฎุฏู NFSv3 ุจุดูู ุดุงุฆุน ูุชูุธูู ุฃุฌูุฒุฉ ุชูููุฏ ุงูุดุจูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ุฅุฐุง ูู ููู ูุฏูู ุณุจุจ ูุนูู ูุงุณุชุฎุฏุงู NFSv4 ุ ูุญุงูู ุงุณุชุฎุฏุงู NFSv3 ูุฃูู ุฃูู ุฅููุงููุง ูุฃู ุฅุฎูุงูุงุช ุจุณุจุจ ุนุฏู ูุฌูุฏ ุญุงูุฉ ุนูู ูุฐุง ุงููุญู. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุชุฑููุจ ุงููุฑุฉ ุจุงุณุชุฎุฏุงู NFSv3 ุจุชุญุฏูุฏ ุงููุนููุฉ <code>-o vers=3</code> ูุฃูุฑ <strong>mount</strong> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">mount -o vers=3 nfs_server:/share /mnt</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู ุ ููููู ุชุนุทูู NFSv4 ููุฎุงุฏู ุนูู ุงูุฅุทูุงู ุ ููููุงู ุจุฐูู ุ ูู ุจุฅุถุงูุฉ ุงูุฎูุงุฑ <code>--no-nfs-version 4</code> ุฅูู ูุชุบูุฑ <code>--no-nfs-version 4</code> ูุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู ุ ุนูู ุณุจูู ุงููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">RPCNFSDCOUNT=<span class="hljs-string"><span class="hljs-string">"64 --no-nfs-version 4"</span></span></code> </pre> <br><h2 id="iscsi-i-lvm" style=";text-align:right;direction:rtl">  ุจุฑูุชูููู iSCSI ู LVM </h2><br><p style=";text-align:right;direction:rtl">  ูุจุงููุซู ุ ูููู ุชูููู ุจุฑูุงูุฌ <strong>tgt</strong> ููุชุธู ุฏุงุฎู ุงูุญุงููุฉ ุ ูุณุชูุชุฌ iSCSI ุฃุฏุงุกู ุฃุนูู ุจูุซูุฑ ูุนูููุงุช ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุ ูุณุชุนูู ุงูุญุงููุฉ ุจุณูุงุณุฉ ุฃูุจุฑ ูุฃู ุฎุงุฏู tgt ูุนูู ุชูุงููุง ูู ูุณุงุญุฉ ุงููุณุชุฎุฏู. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูุชู ุชูุทูุน <strong>LUN</strong> ุงูููุตุฏูุฑ ุฅูู ูุทุน ุนุฏูุฏุฉ ุจุงุณุชุฎุฏุงู <strong>LVM</strong> .  ููุน ุฐูู ุ ููุงู ุงูุนุฏูุฏ ูู ุงููุฑูู ุงูุฏูููุฉ ุงูุชู ูุฌุจ ูุฑุงุนุงุชูุง ุ ุนูู ุณุจูู ุงููุซุงู: ููู <strong>ูุชู</strong> ุชูููุฑ <strong>ุฃููุงู</strong> LVM ููุดุงุฑูุฉ ูุฌููุนุฉ ูุตุฏุฑุฉ ุนูู ูุถูููู ูุชุนุฏุฏูู. </p><br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ูุฐู ูุบูุฑูุง ูู ุงููุฑูู ุงูุฏูููุฉ ุงูุชู ุณุฃุตููุง ูู <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุงูุชุงููุฉ</a></strong> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar417473/">https://habr.com/ru/post/ar417473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../486150/index.html">Desarrollo de la esfera informรกtica en Eslovaquia. Beneficios laborales para jรณvenes profesionales.</a></li>
<li><a href="../486156/index.html">Como enseรฑรฉ, y luego escribรญ un manual de entrenamiento en Python</a></li>
<li><a href="../486158/index.html">Visualizaciรณn de traducciรณn automรกtica neural (modelos seq2seq con mecanismo de atenciรณn)</a></li>
<li><a href="../486164/index.html">Coronavirus 2019-nCoV. Preguntas frecuentes sobre protecciรณn respiratoria y desinfecciรณn</a></li>
<li><a href="../486174/index.html">Tengo cero rotaciรณn</a></li>
<li><a href="../ar417475/index.html">Glusterfs + ุชุดููุฑ ุงููุญู: ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ุงููุซูุฑ ุ ูุฑุฎูุตุฉ ูููุซููุฉ</a></li>
<li><a href="../ar417477/index.html">ููุชุจ ุณุงุฎู</a></li>
<li><a href="../ar417479/index.html">ุณูุณูุฉ ูุชุณูุณูุฉ ุฃุณุฑุน ุงูุนููุง ุจููุณู ูู Go</a></li>
<li><a href="../ar417481/index.html">ุญูู ุงููููุฏุงุช ูู JavaScript ES6 ุ ูููุงุฐุง ูููู ุงุฎุชูุงุฑููุง ูุฏุฑุงุณุชูุง</a></li>
<li><a href="../ar417483/index.html">ููุงุฑูุฉ ุฃุทุฑ JS: React ู Vue ู Hyperapp</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>