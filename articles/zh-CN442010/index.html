<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš¾ âœŒï¸ â˜€ï¸ Pythonå’ŒFPGAã€‚ æµ‹è¯•ä¸­ ğŸ‘©â€âš–ï¸ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ¤´ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« çš„ç»­ç¯‡ä¸­ï¼Œæˆ‘æƒ³ä»¥pythonä¸ºä¾‹æ¼”ç¤ºä½¿ç”¨FPGAï¼ˆFPGAï¼‰çš„ç¤ºä¾‹ã€‚ æœ¬æ–‡å°†æ›´è¯¦ç»†åœ°ä»‹ç»æµ‹è¯•æ–¹é¢ã€‚ å¦‚æœMyHDLæ¡†æ¶å…è®¸äººä»¬ä½¿ç”¨ç†Ÿæ‚‰çš„è¯­æ³•å’Œç”Ÿæ€ç³»ç»Ÿæ¥ç ”ç©¶pythonï¼Œé‚£ä¹ˆæœ‰ç»éªŒçš„FPGAå¼€å‘äººå‘˜å°†ä¸äº†è§£ä½¿ç”¨pythonçš„å«ä¹‰ã€‚ MyHDLå’ŒVerilogçš„ç¡¬ä»¶æè¿°èŒƒä¾‹ç›¸ä¼¼ï¼Œé€‰æ‹©ç‰¹å®šè¯­...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pythonå’ŒFPGAã€‚ æµ‹è¯•ä¸­</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442010/"> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€ç¯‡æ–‡ç« çš„</a>ç»­ç¯‡ä¸­ï¼Œæˆ‘æƒ³ä»¥pythonä¸ºä¾‹æ¼”ç¤ºä½¿ç”¨FPGAï¼ˆFPGAï¼‰çš„ç¤ºä¾‹ã€‚ æœ¬æ–‡å°†æ›´è¯¦ç»†åœ°ä»‹ç»æµ‹è¯•æ–¹é¢ã€‚ å¦‚æœ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MyHDL</a>æ¡†æ¶å…è®¸äººä»¬ä½¿ç”¨ç†Ÿæ‚‰çš„è¯­æ³•å’Œç”Ÿæ€ç³»ç»Ÿæ¥ç ”ç©¶pythonï¼Œé‚£ä¹ˆæœ‰ç»éªŒçš„FPGAå¼€å‘äººå‘˜å°†ä¸äº†è§£ä½¿ç”¨pythonçš„å«ä¹‰ã€‚  MyHDLå’ŒVerilogçš„ç¡¬ä»¶æè¿°èŒƒä¾‹ç›¸ä¼¼ï¼Œé€‰æ‹©ç‰¹å®šè¯­è¨€å–å†³äºä¹ æƒ¯å’Œå£å‘³ã€‚  Verilog / VHDLä»£è¡¨äº†ä½¿ç”¨è¿™äº›è¯­è¨€ç¼–å†™å›ºä»¶å¾ˆé•¿æ—¶é—´çš„äº‹å®ï¼Œå¹¶ä¸”äº‹å®ä¸Šï¼Œå®ƒä»¬æ˜¯æè¿°æ•°å­—è®¾å¤‡çš„æ ‡å‡†ã€‚ ä½œä¸ºè¯¥é¢†åŸŸçš„æ–°æ‰‹ï¼ŒPythonå¯ä»¥åœ¨ç¼–å†™æµ‹è¯•ç¯å¢ƒä¸­ç«äº‰ã€‚  FPGAå¼€å‘äººå‘˜çš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº†æµ‹è¯•ä»–ä»¬çš„è®¾è®¡ä¸Šã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘æƒ³ä»¥ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨MyHDLåœ¨pythonä¸­å®Œæˆæ­¤æ“ä½œã€‚ <br><br> å‡è®¾æœ‰ä¸€ä¸ªä»»åŠ¡æè¿°ä¸€ä¸ªä¸FPGAä¸Šçš„å­˜å‚¨å™¨ä¸€èµ·å·¥ä½œçš„å™¨ä»¶ã€‚ ä¸ºç®€å•èµ·è§ï¼Œæˆ‘å°†ä½¿ç”¨é€šè¿‡å¹¶è¡Œæ¥å£ï¼ˆè€Œä¸æ˜¯é€šè¿‡ä¸²è¡Œæ¥å£ï¼Œä¾‹å¦‚I2Cï¼‰ä¸å…¶ä»–è®¾å¤‡é€šä¿¡çš„å†…å­˜ã€‚ è€ƒè™‘åˆ°è¿™æ ·çš„å¾®ç”µè·¯å¹¶éæ€»æ˜¯å®ç”¨çš„ï¼Œå› ä¸ºéœ€è¦ä¸å®ƒä»¬ä¸€èµ·å·¥ä½œçš„è®¸å¤šå¼•è„šï¼›å¦ä¸€æ–¹é¢ï¼Œæä¾›äº†æ›´å¿«å’Œæ›´å®¹æ˜“çš„ä¿¡æ¯äº¤æ¢ã€‚ ä¾‹å¦‚ï¼Œå®¶ç”¨1645RU1UåŠå…¶ç±»ä¼¼ç‰©ã€‚ <br><br><img src="https://habrastorage.org/webt/e6/hh/ls/e6hhlsa3yvrcdjdzke3dc_jaxby.png"><br><a name="habracut"></a><br><h1> æ¨¡å—è¯´æ˜ </h1><br> è®°å½•å¦‚ä¸‹æ‰€ç¤ºï¼šFPGAæä¾›16ä½å•å…ƒåœ°å€ï¼Œ8ä½æ•°æ®ï¼Œå¹¶ç”Ÿæˆå†™ä¿¡å·WEï¼ˆå†™ä½¿èƒ½ï¼‰ã€‚ ç”±äºOEï¼ˆè¾“å‡ºä½¿èƒ½ï¼‰å’ŒCEï¼ˆèŠ¯ç‰‡ä½¿èƒ½ï¼‰å§‹ç»ˆå¤„äºå¯ç”¨çŠ¶æ€ï¼Œå› æ­¤åœ¨æ›´æ”¹å•å…ƒåœ°å€æ—¶ä¼šå‘ç”Ÿè¯»å–ã€‚ å¯ä»¥ä»ä¸€ä¸ªç‰¹å®šçš„adr_startåœ°å€å¼€å§‹ï¼ˆè®°å½•åœ¨adr_writeä¿¡å·çš„å‰æ²¿ï¼‰å¼€å§‹ï¼Œå¹¶åœ¨ä¸€ä¸ªè¡Œä¸­çš„å¤šä¸ªå•å…ƒä¸­ä¾æ¬¡è¿›è¡Œå†™å…¥å’Œè¯»å–ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»æ„åœ°å€å¤„è¿›è¡Œä¸€ä¸ªå•å…ƒï¼ˆéšæœºè®¿é—®ï¼‰ã€‚ <br><br> åœ¨MyHDLä¸Šï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼ˆå†™å…¥å’Œè¯»å–ä¿¡å·é‡‡ç”¨åå‘é€»è¾‘ï¼‰ï¼š <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> myhdl <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * @block <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ram_driver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data_in, data_out, adr, adr_start, adr_write, data_memory, read, write, we)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     mem_z = data_memory.driver() #      @always(adr_write.posedge, write.posedge, read.negedge) def write_start_adr(): if adr_write: #    adr.next = adr_start else: #    / adr.next = adr + 1 @always(write) def write_data(): if not write: mem_z.next = data_in we.next = 0 #    ,    else: mem_z.next = None #        data_out.next = data_memory we.next = 1 return write_data, write_start_adr</span></span></code> </pre> <br> å¦‚æœä½¿ç”¨ä»¥ä¸‹åŠŸèƒ½è½¬æ¢ä¸ºVerilogï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hdl)</span></span></span><span class="hljs-function">:</span></span> data_memory = TristateSignal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">8</span></span>:]) data_in = Signal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">8</span></span>:]) data_out = Signal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">8</span></span>:]) adr = Signal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">16</span></span>:]) adr_start = Signal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">16</span></span>:]) adr_write = Signal(bool(<span class="hljs-number"><span class="hljs-number">0</span></span>)) read, write, we = [Signal(bool(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">3</span></span>)] inst = ram_driver(data_in, data_out, adr, adr_start, adr_write, data_memory, read, write, we) inst.convert(hdl=hdl) convert(hdl=<span class="hljs-string"><span class="hljs-string">'Verilog'</span></span>)</code> </pre> <br> ç„¶åæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š <br><pre> <code class="vhdl hljs">`timescale <span class="hljs-number"><span class="hljs-number">1</span></span>ns/<span class="hljs-number"><span class="hljs-number">10</span></span>ps module ram_driver ( data_in, data_out, adr, adr_start, adr_write, data_memory, read, write, we ); input [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data_in; output [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data_out; reg [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data_out; output [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] adr; reg [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] adr; input [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] adr_start; input adr_write; <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data_memory; wire [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data_memory; input read; input write; output we; reg we; reg [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] mem_z; assign data_memory = mem_z; always @(write) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>: RAM_DRIVER_WRITE_DATA <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((!write)) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> mem_z &lt;= data_in; we &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> mem_z &lt;= <span class="hljs-symbol"><span class="hljs-symbol">'bz</span></span>; data_out &lt;= data_memory; we &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> always @(posedge adr_write, posedge write, negedge read) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>: RAM_DRIVER_WRITE_START_ADR <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (adr_write) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> adr &lt;= adr_start; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> adr &lt;= (adr + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endmodule</code> </pre> <br> æ— éœ€å°†é¡¹ç›®è½¬æ¢ä¸ºVerilogå³å¯è¿›è¡Œä»¿çœŸï¼›å‡çº§FPGAå°†éœ€è¦æ­¤æ­¥éª¤ã€‚ <br><br><h1> é€ å‹ </h1><br> åœ¨é€»è¾‘æè¿°ä¹‹åï¼Œåº”éªŒè¯é¡¹ç›®ã€‚ æ‚¨å¯ä»¥é™åˆ¶è‡ªå·±ï¼Œä¾‹å¦‚ï¼Œæ¨¡æ‹Ÿè¾“å…¥å½±å“å¹¶åœ¨æ—¶é—´å›¾ä¸­æŸ¥çœ‹æ¨¡å—çš„å“åº”ã€‚ ä½†æ˜¯ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œæ›´éš¾é¢„æµ‹æ¨¡å—ä¸å†…å­˜èŠ¯ç‰‡çš„äº¤äº’ã€‚ å› æ­¤ï¼Œè¦å®Œå…¨éªŒè¯åˆ›å»ºçš„è®¾å¤‡çš„è¿è¡Œï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªå†…å­˜æ¨¡å‹å¹¶æµ‹è¯•è¿™ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´çš„äº¤äº’ã€‚ <br><br> ç”±äºå·¥ä½œæ˜¯åœ¨pythonä¸­è¿›è¡Œçš„ï¼Œå› æ­¤ç»™å®šç±»å‹çš„å­—å…¸ï¼ˆå­—å…¸ï¼‰å»ºè®®å°†å…¶ç”¨äºå†…å­˜æ¨¡å‹ã€‚ æ•°æ®ä»¥{keyï¼švalue}çš„å½¢å¼å­˜å‚¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸º{addressï¼šdata}ã€‚ <br><br><pre> <code class="python hljs">memory = { <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">456</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-number"><span class="hljs-number">789</span></span> } memory[<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">123</span></span> memory[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">456</span></span></code> </pre> <br> å‡ºäºç›¸åŒçš„ç›®çš„ï¼Œåˆ—è¡¨æ•°æ®ç±»å‹æ˜¯åˆé€‚çš„ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æœ‰å…¶è‡ªå·±çš„åæ ‡ï¼Œä»¥æŒ‡ç¤ºå…ƒç´ åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼š <br><br><pre> <code class="python hljs">memory = [<span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-number"><span class="hljs-number">456</span></span>, <span class="hljs-number"><span class="hljs-number">789</span></span>] memory[<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">123</span></span> memory[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">456</span></span></code> </pre> <br> è€ƒè™‘åˆ°æ›´å¤§çš„å¯è§æ€§ï¼Œä½¿ç”¨å­—å…¸æ¥æ¨¡æ‹Ÿå†…å­˜ä¼¼ä¹æ˜¯å¯å–çš„ã€‚ <br><br> æµ‹è¯•å¤–å£³çš„æè¿°ï¼ˆåœ¨æ–‡ä»¶test_seq_access.pyä¸­ï¼‰ä»ä¿¡å·çš„å£°æ˜ï¼Œåˆå§‹çŠ¶æ€çš„åˆå§‹åŒ–ä»¥åŠå°†å®ƒä»¬æ‰”å…¥ä¸Šè¿°å†…å­˜é©±åŠ¨å™¨åŠŸèƒ½å¼€å§‹ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@block def testbench(): data_memory = TristateSignal(intbv(0)[8:]) data_in = Signal(intbv(0)[8:]) data_out = Signal(intbv(0)[8:]) adr = Signal(intbv(0)[16:]) adr_start = Signal(intbv(20)[16:]) adr_write = Signal(bool(0)) read, write, we = [Signal(bool(1)) for i in range(3)] ram = ram_driver(data_in, data_out, adr, adr_start, adr_write, data_memory, read, write, we)</span></span></code> </pre> <br> ä¸‹é¢ä»‹ç»å†…å­˜æ¨¡å‹ã€‚ åˆå§‹åŒ–åˆå§‹çŠ¶æ€ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå†…å­˜ä¸­ä¼šå¡«å……é›¶å€¼ã€‚ å°†å†…å­˜æ¨¡å‹é™åˆ¶ä¸º128ä¸ªå•å…ƒï¼š <br><br><pre> <code class="python hljs">memory = {i: intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">128</span></span>)}</code> </pre> <br> å¹¶æè¿°å†…å­˜çš„è¡Œä¸ºï¼šå½“WEå¤„äºä½ç”µå¹³çŠ¶æ€æ—¶ï¼Œå°†è¯¥è¡Œä¸­çš„å€¼å†™å…¥ç›¸åº”çš„å†…å­˜åœ°å€ï¼Œå¦åˆ™æ¨¡å‹ç»™å‡ºç»™å®šåœ°å€å¤„çš„å€¼ï¼š <br><br><pre> <code class="python hljs">mem_z = data_memory.driver() @always_comb <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">access</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> we: memory[int(adr.val)] = data_memory.val <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> we: data_out.next = memory[int(adr.val)] mem_z.next = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre> <br> ç„¶åï¼Œåœ¨åŒä¸€åŠŸèƒ½ä¸­ï¼Œæ‚¨å¯ä»¥æè¿°è¾“å…¥ä¿¡å·çš„è¡Œä¸ºï¼ˆå¯¹äºé¡ºåºå†™/è¯»çš„æƒ…å†µï¼‰ï¼šè®°å½•èµ·å§‹åœ°å€â†’è®°å½•8ä¸ªä¿¡æ¯å•å…ƒâ†’è®°å½•èµ·å§‹åœ°å€â†’è¯»å–8ä¸ªè®°å½•çš„ä¿¡æ¯å•å…ƒã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@instance def stimul(): init_adr = random.randint(0, 50) #   yield delay(100) write.next = 1 adr_write.next = 1 adr_start.next = init_adr #   yield delay(100) adr_write.next = 0 yield delay(100) for i in range(8): # 8    write.next = 0 data_in.next = random.randint(0, 100) yield delay(100) write.next = 1 yield delay(100) adr_start.next = init_adr #   adr_write.next = 1 yield delay(100) adr_write.next = 0 yield delay(100) for i in range(8): #   read.next = 0 yield delay(100) read.next = 1 yield delay(100) raise StopSimulation return stimul, ram, access</span></span></code> </pre> <br> è¿è¡Œæ¨¡æ‹Ÿï¼š <br><br><pre> <code class="python hljs">tb = testbench() tb.config_sim(trace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) tb.run_sim()</code> </pre> <br> å¯åŠ¨ç¨‹åºåï¼Œåœ¨å·¥ä½œæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆtestbench_seq_access.vcdæ–‡ä»¶ï¼Œåœ¨gtkwaveä¸­å°†å…¶æ‰“å¼€ï¼š <br><br><pre> <code class="bash hljs">gtkwave testbench_seq_access.vcd</code> </pre> <br> æˆ‘ä»¬çœ‹åˆ°äº†å›¾ç‰‡ï¼š <br><br><img src="https://habrastorage.org/webt/io/ak/oc/ioakocq8btz-hdlk_-m7xzeshse.jpeg"><br><br> å·²æˆåŠŸè¯»å–è®°å½•çš„ä¿¡æ¯ã€‚ <br><br> æ‚¨å¯ä»¥é€šè¿‡å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°testbenchæ¥æŸ¥çœ‹å†…å­˜çš„å†…å®¹ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> memory.items(): print(<span class="hljs-string"><span class="hljs-string">'adr:{}'</span></span>.format(key), <span class="hljs-string"><span class="hljs-string">'data:{}'</span></span>.format(value))</code> </pre> <br> æ§åˆ¶å°ä¸­å°†æ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼š <br><br><img src="https://habrastorage.org/webt/js/sb/ly/jssbly6h3kodhjqrw7ih9mtzamg.jpeg"><br><br><h1> æµ‹è¯•ä¸­ </h1><br> æ­¤åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ•°é‡æ›´å¤šçš„å¯å†™/å¯è¯»å•å…ƒæ ¼è¿›è¡Œä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ ä¸ºæ­¤ï¼Œå°†å‡ ä¸ªæµ‹è¯•å‘¨æœŸå’Œä¼ªå­—å…¸æ·»åŠ åˆ°testbenchï¼Œåœ¨å…¶ä¸­æ·»åŠ äº†ä¹¦é¢å’Œå¯è¯»ä¿¡æ¯ä»¥åŠassertç»“æ„ï¼Œå¦‚æœä¸¤ä¸ªå­—å…¸ä¸ç›¸ç­‰ï¼Œåˆ™ä¼šå¯¼è‡´é”™è¯¯ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@instance def stimul(): for time in range(100): temp_mem_write = {} temp_mem_read = {} init_adr = random.randint(0, 50) yield delay(100) write.next = 1 adr_write.next = 1 adr_start.next = init_adr yield delay(100) adr_write.next = 0 yield delay(100) for i in range(64): write.next = 0 data_in.next = random.randint(0, 100) temp_mem_write[i] = int(data_in.next) yield delay(100) write.next = 1 yield delay(100) adr_start.next = init_adr adr_write.next = 1 yield delay(100) adr_write.next = 0 yield delay(100) for i in range(64): read.next = 0 temp_mem_read[i] = int(data_out.val) yield delay(100) read.next = 1 yield delay(100) assert temp_mem_write == temp_mem_read, "   " for key, value in memory.items(): print('adr:{}'.format(key), 'data:{}'.format(value)) raise StopSimulation return stimul, ram, access</span></span></code> </pre><br> æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥åˆ›å»ºç¬¬äºŒä¸ªæµ‹è¯•å¹³å°æ¥æµ‹è¯•éšæœºè®¿é—®æ¨¡å¼ä¸‹çš„æ“ä½œï¼štest_random_access.pyã€‚ <br><br> ç¬¬äºŒä¸ªæµ‹è¯•çš„æƒ³æ³•æ˜¯ç›¸ä¼¼çš„ï¼šæˆ‘ä»¬åœ¨éšæœºåœ°å€å¤„å†™å…¥éšæœºä¿¡æ¯ï¼Œå¹¶å‘temp_mem_writeå­—å…¸ä¸­æ·»åŠ ä¸€å¯¹{addressï¼šdata}ã€‚ ç„¶åï¼Œæˆ‘ä»¬éå†æ­¤å­—å…¸ä¸­çš„åœ°å€ï¼Œå¹¶ä»å†…å­˜ä¸­è¯»å–ä¿¡æ¯ï¼Œå¹¶å°†å…¶è¾“å…¥åˆ°temp_mem_readå­—å…¸ä¸­ã€‚ æœ€åï¼Œassertæ„é€ æ£€æŸ¥ä¸¤ä¸ªå­—å…¸çš„å†…å®¹ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> myhdl <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ram_driver <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ram_driver @block <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testbench_random_access</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> data_memory = TristateSignal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">8</span></span>:]) data_in = Signal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">8</span></span>:]) data_out = Signal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">8</span></span>:]) adr = Signal(intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>)[<span class="hljs-number"><span class="hljs-number">16</span></span>:]) adr_start = Signal(intbv(<span class="hljs-number"><span class="hljs-number">20</span></span>)[<span class="hljs-number"><span class="hljs-number">16</span></span>:]) adr_write = Signal(bool(<span class="hljs-number"><span class="hljs-number">0</span></span>)) read, write, we = [Signal(bool(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">3</span></span>)] ram = ram_driver(data_in, data_out, adr, adr_start, adr_write, data_memory, read, write, we) memory ={i:intbv(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">128</span></span>)} mem_z = data_memory.driver() @always_comb <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">access</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> we: memory[int(adr.val)] = data_memory.val <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> we: data_out.next = memory[int(adr.val)] mem_z.next = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> @instance <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stimul</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): temp_mem_write = {} temp_mem_read = {} <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">64</span></span>): write.next = <span class="hljs-number"><span class="hljs-number">1</span></span> adr_write.next = <span class="hljs-number"><span class="hljs-number">1</span></span> adr_start.next = random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">126</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) adr_write.next = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) write.next = <span class="hljs-number"><span class="hljs-number">0</span></span> data_in.next = random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) temp_mem_write[int(adr_start.val)] = int(data_in.next) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) write.next = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> temp_mem_write.keys(): adr_start.next = key adr_write.next = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) adr_write.next = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) read.next = <span class="hljs-number"><span class="hljs-number">0</span></span> temp_mem_read[key] = int(data_out.val) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) read.next = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> delay(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> temp_mem_write == temp_mem_read, <span class="hljs-string"><span class="hljs-string">'  random access'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> StopSimulation <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stimul, ram, access tb = testbench_random_access() tb.config_sim(trace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) tb.run_sim()</code> </pre> <br>  Pythonæœ‰å‡ ä¸ªæ¡†æ¶å¯ä»¥è‡ªåŠ¨æ‰§è¡Œæµ‹è¯•ã€‚ ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘å°†ä½¿ç”¨pytestï¼Œå®ƒå¿…é¡»ä»pipå®‰è£…ï¼š <br><br><pre> <code class="bash hljs">pip3 install pytest</code> </pre> <br> å½“ä»æ§åˆ¶å°å¯åŠ¨â€œ pysestâ€å‘½ä»¤æ—¶ï¼Œæ¡†æ¶å°†åœ¨å·¥ä½œæ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾å¹¶æ‰§è¡Œæ‰€æœ‰æ–‡ä»¶åä¸­å¸¦æœ‰â€œ test_ *â€çš„æ–‡ä»¶ã€‚ <br><br><img src="https://habrastorage.org/webt/pv/sz/zr/pvszzr_l6vdb6hnfn1pwkelu5vo.jpeg"><br><br> æµ‹è¯•æˆåŠŸå®Œæˆã€‚ æˆ‘ä¼šåœ¨è®¾å¤‡è¯´æ˜ä¸­æ•…æ„çŠ¯ä¸€ä¸ªé”™è¯¯ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@block def ram_driver(data_in, data_out, adr, adr_start, adr_write, data_memory, read, write, we): mem_z = data_memory.driver() @always(adr_write.posedge, write.posedge, read.negedge) def write_start_adr(): if adr_write: adr.next = adr_start else: adr.next = adr + 1 @always(write) def write_data(): if not write: mem_z.next = data_in we.next = 1 #  ,    else: mem_z.next = None data_out.next = data_memory we.next = 1</span></span></code> </pre> <br> æˆ‘è¿è¡Œæµ‹è¯•ï¼š <br><br><img src="https://habrastorage.org/webt/q7/f3/4b/q7f34bqhdrvwapsxawc_sdquxdu.jpeg"><br><br> å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œåœ¨ä¸¤ä¸ªæµ‹è¯•ä¸­ï¼Œéƒ½è€ƒè™‘äº†åˆå§‹ä¿¡æ¯ï¼ˆé›¶ï¼‰ï¼Œå³æœªè®°å½•æ–°ä¿¡æ¯ã€‚ <br><br><h1> ç»“è®º </h1><br> å°†pythonä¸myHDLç»“åˆä½¿ç”¨ï¼Œå¯ä»¥ä½¿æ‚¨è‡ªåŠ¨ä¸ºFPGAå¼€å‘çš„å›ºä»¶è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä½¿ç”¨pythonç¼–ç¨‹è¯­è¨€çš„ä¸°å¯ŒåŠŸèƒ½åˆ›å»ºå‡ ä¹ä»»ä½•æµ‹è¯•ç¯å¢ƒã€‚ <br><br> æœ¬æ–‡è®¤ä¸ºï¼š <br><br><ul><li> åˆ›å»ºä¸€ä¸ªä¸å†…å­˜å…¼å®¹çš„æ¨¡å—ï¼› </li><li> åˆ›å»ºä¸€ä¸ªå†…å­˜æ¨¡å‹ï¼› </li><li> æµ‹è¯•æ¡ˆä¾‹åˆ›å»ºï¼› </li><li> ä½¿ç”¨pytestæ¡†æ¶è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN442010/">https://habr.com/ru/post/zh-CN442010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN441998/index.html">â€œè¿™äº›å®¹å™¨èµ¢å¾—äº†æˆ˜æ–—ï¼Œä½†åœ¨æ— æœåŠ¡å™¨æ¶æ„ä¸Šå´è¾“æ‰äº†è¿™åœºæˆ˜äº‰ã€‚â€-Simon Wardley</a></li>
<li><a href="../zh-CN442002/index.html">å¼•å…¥ç¥ç»ODE</a></li>
<li><a href="../zh-CN442004/index.html">SVGè¿‡æ»¤æ•ˆæœã€‚ ç¬¬7éƒ¨åˆ†ã€‚å‰è¿›</a></li>
<li><a href="../zh-CN442006/index.html">æ–‡ä»¶ç®¡ç†åšé”™äº†-ç¬¬2éƒ¨åˆ†ï¼šç‹—å±çš„æ°ä½œ</a></li>
<li><a href="../zh-CN442008/index.html">k3sæ˜¯ç”±Rancher Labsè®¤è¯çš„å°å‹ä½†ç»è¿‡è®¤è¯çš„Kubernetes</a></li>
<li><a href="../zh-CN442012/index.html">å®éªŒï¼šæˆ‘ä»¬æ”¶é›†å‘æ”¾æŠ¤ç…§çš„å•ä½ç›®å½•</a></li>
<li><a href="../zh-CN442014/index.html">Dart 2.2å‘å¸ƒï¼šæ›´é«˜æ•ˆçš„æœºå™¨ä»£ç ï¼Œæ”¯æŒSetæ–‡å­—</a></li>
<li><a href="../zh-CN442016/index.html">é»‘å®¢æ¯”ç»˜ç”»æˆ–å¦‚ä½•ä¿æŠ¤Webåº”ç”¨ç¨‹åºæ›´ç³Ÿç³•</a></li>
<li><a href="../zh-CN442018/index.html">å®ªæ³•è§„å®šçš„æ˜¥å­£æ³•å¾‹ã€‚ ä¸ºä»€ä¹ˆèƒ½</a></li>
<li><a href="../zh-CN442020/index.html">æ–°çš„AV1ç¼–è§£ç å™¨ï¼šåŠ é€Ÿæµè§ˆå™¨ä¸­çš„è§†é¢‘åŠ è½½</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>