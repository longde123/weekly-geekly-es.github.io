<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™¦ï¸ ğŸ” ğŸ“¦ C ++ä¸–ç•Œä¸­çš„Jinja2ï¼Œç¬¬äºŒéƒ¨åˆ†ã€‚ æ¸²æŸ“å›¾ â¬›ï¸ ğŸ™ï¸ ğŸ¥ </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™æ˜¯å…³äºå°†Jinja2æ¨¡æ¿å¼•æ“ç§»æ¤åˆ°C ++çš„æ•…äº‹çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»ç¬¬ä¸€ä¸ªæ¨¡æ¿ ï¼š ä¸‰é˜¶æ¨¡æ¿ï¼Œæˆ–è€…å¦‚ä½•å°†Jinja2ç§»æ¤åˆ°C ++ ã€‚ å®ƒå°†ç€é‡äºæ¸²æŸ“æ¨¡æ¿çš„è¿‡ç¨‹ã€‚ æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä»å¤´å¼€å§‹ç¼–å†™ç±»ä¼¼Pythonçš„è¯­è¨€çš„è§£é‡Šå™¨ã€‚ 
 è¿™æ ·æ¸²æŸ“ 


è§£æåï¼Œæ¨¡æ¿å˜æˆä¸€æ£µæ ‘ï¼Œå…¶ä¸­åŒ…å«ä¸‰ç§ç±»å‹çš„èŠ‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C ++ä¸–ç•Œä¸­çš„Jinja2ï¼Œç¬¬äºŒéƒ¨åˆ†ã€‚ æ¸²æŸ“å›¾</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419011/"><p><img src="https://habrastorage.org/getpro/habr/post_images/c81/fe0/548/c81fe0548837b911b9569cdf49d90ca2.jpg" alt="Jinja2å¾½æ ‡" align="left"> è¿™æ˜¯å…³äºå°†Jinja2æ¨¡æ¿å¼•æ“ç§»æ¤åˆ°C ++çš„æ•…äº‹çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»ç¬¬ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¨¡æ¿</a> ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‰é˜¶æ¨¡æ¿ï¼Œæˆ–è€…å¦‚ä½•å°†Jinja2ç§»æ¤åˆ°C ++</a> ã€‚ å®ƒå°†ç€é‡äºæ¸²æŸ“æ¨¡æ¿çš„è¿‡ç¨‹ã€‚ æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä»å¤´å¼€å§‹ç¼–å†™ç±»ä¼¼Pythonçš„è¯­è¨€çš„è§£é‡Šå™¨ã€‚ </p><a name="habracut"></a><br><h2 id="rendering-kak-takovoy"> è¿™æ ·æ¸²æŸ“ </h2><br><p>è§£æåï¼Œæ¨¡æ¿å˜æˆä¸€æ£µæ ‘ï¼Œå…¶ä¸­åŒ…å«ä¸‰ç§ç±»å‹çš„èŠ‚ç‚¹ï¼š <strong>çº¯æ–‡æœ¬</strong> ï¼Œ <strong>è®¡ç®—çš„è¡¨è¾¾å¼</strong>å’Œ<strong>æ§ä»¶ç»“æ„</strong> ã€‚ å› æ­¤ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œåº”å°†çº¯æ–‡æœ¬æ”¾ç½®åœ¨è¾“å‡ºæµä¸­ï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œåº”è¯¥è®¡ç®—è¡¨è¾¾å¼ï¼Œå°†å…¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œç„¶åå°†å…¶æ”¾ç½®åœ¨æµä¸­ï¼Œå¹¶ä¸”å¿…é¡»æ‰§è¡Œæ§åˆ¶ç»“æ„ã€‚ ä¹ä¸€çœ‹ï¼Œå®ç°æ¸²æŸ“è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼šæ‚¨åªéœ€è¦éå†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè®¡ç®—æ‰€æœ‰å†…å®¹ï¼Œæ‰§è¡Œæ‰€æœ‰å†…å®¹å¹¶ç”Ÿæˆæ–‡æœ¬ã€‚ ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ æ°å¥½æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼šaï¼‰æ‰€æœ‰å·¥ä½œä»…ä½¿ç”¨ä¸€ç§ç±»å‹çš„å­—ç¬¦ä¸²ï¼ˆstringæˆ–wstringï¼‰å®Œæˆï¼›  bï¼‰ä»…ä½¿ç”¨éå¸¸ç®€å•çš„è¡¨è¾¾å¼å’ŒåŸºæœ¬è¡¨è¾¾å¼ã€‚ å®é™…ä¸Šï¼Œæ­£æ˜¯å‡ºäºè¿™ç§é™åˆ¶ï¼Œå®ç°äº†injaå’ŒJinja2CppLightã€‚ å¯¹äºæˆ‘çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jinja2Cppï¼Œ</a>è¿™ä¸¤ä¸ªæ¡ä»¶å‡ä¸èµ·ä½œç”¨ã€‚ é¦–å…ˆï¼Œæˆ‘æœ€åˆä¸ºè¿™ä¸¤ç§ç±»å‹çš„å­—ç¬¦ä¸²æä¾›äº†é€æ˜çš„æ”¯æŒã€‚ å…¶æ¬¡ï¼Œæ•´ä¸ªå¼€å‘åªæ˜¯ä¸ºäº†å‡ ä¹å®Œå…¨æ”¯æŒJinja2è§„èŒƒè€Œå¼€å§‹çš„ï¼Œä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ˜¯ä¸€ç§æˆç†Ÿçš„è„šæœ¬è¯­è¨€ã€‚ å› æ­¤ï¼Œæˆ‘ä¸å¾—ä¸æ·±å…¥ç ”ç©¶æ¸²æŸ“è€Œä¸æ˜¯è§£æã€‚ </p><br><h3 id="vychislenie-vyrazheniy"> è¡¨è¾¾è¯„ä¼° </h3><br><p><img src="https://habrastorage.org/webt/46/i0/0y/46i00yfhkcaiybpae4famsictho.png" align="right"> å¦‚æœæ— æ³•å‚æ•°åŒ–æ¨¡æ¿ï¼Œåˆ™è¯¥æ¨¡æ¿å°†ä¸æ˜¯æ¨¡æ¿ã€‚ åŸåˆ™ä¸Šï¼ŒJinja2å…è®¸â€œæœ¬èº«â€é€‰æ‹©æ¨¡æ¿-å¯ä»¥åœ¨æ¨¡æ¿æœ¬èº«å†…éƒ¨è®¾ç½®æ‰€æœ‰å¿…éœ€çš„å˜é‡ï¼Œç„¶åè¿›è¡Œå‘ˆç°ã€‚ ä½†æ˜¯ï¼Œåœ¨å¸¦æœ‰ä»â€œå¤–éƒ¨â€è·å¾—çš„å‚æ•°çš„æ¨¡æ¿ä¸­å·¥ä½œä»ç„¶æ˜¯ä¸»è¦æƒ…å†µã€‚ å› æ­¤ï¼Œå¯¹è¡¨è¾¾å¼æ±‚å€¼çš„ç»“æœå–å†³äºåœ¨è®¡ç®—ç‚¹ä¸Šå“ªäº›å˜é‡ï¼ˆå‚æ•°ï¼‰çš„å€¼å¯è§ã€‚ è€Œä¸”è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Jinja2ä¸­ï¼Œä¸ä»…å­˜åœ¨èŒƒå›´ï¼ˆå¯ä»¥åµŒå¥—ï¼‰ï¼Œè€Œä¸”è¿˜å­˜åœ¨å¤æ‚çš„â€œé€æ˜â€è§„åˆ™ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼š </p><br><pre><code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">set</span></span></span><span class="hljs-template-tag"> param1=10 %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ param1 }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p> ç”±äºå…¶å‘ˆç°ï¼Œå°†æ”¶åˆ°æ–‡æœ¬<code>10</code> <br> è¯¥é€‰é¡¹ç¨å¾®å¤æ‚ä¸€äº›ï¼š </p><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">set</span></span></span><span class="hljs-template-tag"> param1=10 %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ param1 }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> param1 </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> range(10) %}</span></span><span class="xml"><span class="xml">-</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ param1 }}</span></span><span class="xml"><span class="xml">-</span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ param1 }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p> æ¸²æŸ“æœ€æ—©äº<code>10-0--1--2--3--4--5--6--7--8--9-10</code> <br> è¯¥å¾ªç¯ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰è‡ªå·±çš„å˜é‡å‚æ•°ï¼Œå¹¶ä¸”è¿™äº›å‚æ•°åœ¨ä½œç”¨åŸŸä¹‹å¤–å°†ä¸å¯è§ï¼Œå°±åƒå®ƒä»¬ä¸ä¼šåœ¨å¤–éƒ¨å˜é‡ä¸­ç ”ç£¨ç›¸åŒå‚æ•°çš„å€¼ä¸€æ ·ã€‚ ä½¿ç”¨æ‰©å±•/å—ç»“æ„æ›´åŠ æ£˜æ‰‹ï¼Œä½†æ˜¯æœ€å¥½åœ¨Jinja2æ–‡æ¡£ä¸­å¯¹æ­¤è¿›è¡Œé˜…è¯»ã€‚ </p><br><p> å› æ­¤ï¼Œå‡ºç°äº†è®¡ç®—çš„ä¸Šä¸‹æ–‡ã€‚ æˆ–æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ¸²æŸ“ï¼š </p><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderContext</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: RenderContext(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InternalValueMap&amp; extValues, IRendererCallback* rendererCallback); <span class="hljs-function"><span class="hljs-function">InternalValueMap&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnterScope</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExitScope</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; val, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; found)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> p = m_scopes.rbegin(); p != m_scopes.rend(); ++ p) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> valP = p-&gt;find(val); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (valP != p-&gt;end()) { found = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> valP; } } <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> valP = m_externalScope-&gt;find(val); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (valP != m_externalScope-&gt;end()) { found = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> valP; } found = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_externalScope-&gt;end(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function">&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCurrentScope</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function">&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCurrentScope</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function">&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetGlobalScope</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRendererCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">RenderContext </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> includeCurrentContext)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: InternalValueMap* m_currentScope; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InternalValueMap* m_externalScope; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;InternalValueMap&gt; m_scopes; IRendererCallback* m_rendererCallback; };</code> </pre> <br><p>  <a href="">ä»è¿™é‡Œ</a> ã€‚ </p><br><p> ä¸Šä¸‹æ–‡åŒ…å«æŒ‡å‘è°ƒç”¨æ¸²æŸ“å‡½æ•°æ—¶è·å¾—çš„å€¼çš„é›†åˆçš„æŒ‡é’ˆï¼Œä½œç”¨åŸŸåˆ—è¡¨ï¼ˆå †æ ˆï¼‰ï¼Œå½“å‰æ´»åŠ¨ä½œç”¨åŸŸä»¥åŠæŒ‡å‘å›è°ƒæ¥å£çš„æŒ‡é’ˆï¼Œä»¥åŠå„ç§å¯¹æ¸²æŸ“æœ‰ç”¨çš„å‡½æ•°ã€‚ ä½†æ˜¯è¿‡ä¸€ä¼šå„¿ã€‚ å‚æ•°æœç´¢åŠŸèƒ½æŒ‰é¡ºåºå°†ä¸Šä¸‹æ–‡åˆ—è¡¨ä¸Šç§»åˆ°å¤–éƒ¨åˆ—è¡¨ï¼Œç›´åˆ°æ‰¾åˆ°å¿…è¦çš„å‚æ•°ä¸ºæ­¢ã€‚ </p><br><p> ç°åœ¨ä»‹ç»ä¸€ä¸‹å‚æ•°æœ¬èº«ã€‚ ä»å¤–éƒ¨æ¥å£ï¼ˆåŠå…¶ç”¨æˆ·ï¼‰çš„è§’åº¦æ¥çœ‹ï¼ŒJinja2æ”¯æŒä»¥ä¸‹æœ‰æ•ˆç±»å‹çš„åˆ—è¡¨ï¼š </p><br><ul><li> æ•°å­—ï¼ˆæ•´æ•°ï¼ŒåŒç²¾åº¦ï¼‰ </li><li> å­—ç¬¦ä¸²ï¼ˆçª„ï¼Œå®½ï¼‰ </li><li> å¸ƒå°” </li><li> æ•°ç»„ï¼ˆæ›´åƒæ— é‡çº²å…ƒç»„ï¼‰ </li><li> è¾å…¸ </li><li> åæ˜ çš„C ++ç»“æ„ </li></ul><br><p> æ‰€æœ‰è¿™äº›éƒ½ç”±åœ¨boost :: variantåŸºç¡€ä¸Šåˆ›å»ºçš„ç‰¹æ®Šæ•°æ®ç±»å‹æè¿°ï¼š </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ValueData = boost::variant&lt;EmptyValue, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::wstring, <span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>, boost::recursive_wrapper&lt;ValuesList&gt;, boost::recursive_wrapper&lt;ValuesMap&gt;, GenericList, GenericMap&gt;; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Value</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Value() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; Value(T&amp;&amp; val, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::enable_if&lt;!<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_same&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">decay_t</span></span>&lt;T&gt;, Value&gt;::value&gt;::type* = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) : m_data(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::forward&lt;T&gt;(val)) { } Value(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* val) : m_data(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(val)) { } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> N&gt; Value(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> (&amp;val)[N]) : m_data(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(val)) { } Value(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val) : m_data(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int64_t</span></span>&gt;(val)) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> ValueData&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_data;} <span class="hljs-function"><span class="hljs-function">ValueData&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_data;} <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: ValueData m_data; };</code> </pre> <br><p>  <a href="">ä»è¿™é‡Œ</a> ã€‚ </p><br><p> å½“ç„¶ï¼Œæ•°ç»„å’Œå­—å…¸çš„å…ƒç´ å¯ä»¥æ˜¯ä»»ä½•åˆ—å‡ºçš„ç±»å‹ã€‚ ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå¯¹äºå†…éƒ¨ä½¿ç”¨ï¼Œè¿™ç»„ç±»å‹å¤ªç‹­çª„äº†ã€‚ ä¸ºäº†ç®€åŒ–å®ç°ï¼Œéœ€è¦ä»¥ä¸‹é™„åŠ ç±»å‹çš„æ”¯æŒï¼š </p><br><ul><li> ç›®æ ‡æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ å®ƒå¯ä»¥çª„ä¹Ÿå¯ä»¥å®½ï¼Œè¿™å–å†³äºè¦æ¸²æŸ“çš„æ¨¡æ¿ç±»å‹ã€‚ </li><li> å¯èµå›ç±»å‹ </li><li>  ASTæ ‘ç»„è£… </li><li> é”®å€¼å¯¹ </li></ul><br><p> é€šè¿‡æ­¤æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡å‘ˆç°ä¸Šä¸‹æ–‡ä¼ è¾“æœåŠ¡æ•°æ®ï¼Œå¦åˆ™å°†ä¸å¾—ä¸åœ¨å…¬å…±å¤´æ–‡ä»¶ä¸­â€œå±è”½â€ï¼Œä»¥åŠæ›´æˆåŠŸåœ°æ¦‚æ‹¬ä¸€äº›é€‚ç”¨äºæ•°ç»„å’Œå­—å…¸çš„ç®—æ³•ã€‚ </p><br><p> å¹¶éå¶ç„¶é€‰æ‹©Boost ::å˜ä½“ã€‚ å®ƒçš„ä¸°å¯ŒåŠŸèƒ½ç”¨äºå¤„ç†ç‰¹å®šç±»å‹çš„å‚æ•°ã€‚  Jinja2CppLightä½¿ç”¨å¤šæ€ç±»å‡ºäºç›¸åŒçš„ç›®çš„ï¼Œè€Œinjaä½¿ç”¨nlohmann jsonåº“ç±»å‹ç³»ç»Ÿã€‚  lasï¼Œè¿™ä¸¤ç§é€‰æ‹©éƒ½ä¸é€‚åˆæˆ‘ã€‚ åŸå› ï¼šå¯¹äºboost :: variantï¼ˆç°åœ¨æ˜¯std :: variantï¼‰è¿›è¡Œnå…ƒè°ƒåº¦çš„å¯èƒ½æ€§ã€‚ å¯¹äºå˜é‡ç±»å‹ï¼Œæ‚¨å¯ä»¥ä½¿é™æ€è®¿é—®è€…æ¥å—ä¸¤ä¸ªç‰¹å®šçš„å­˜å‚¨ç±»å‹ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºä¸€å¯¹å€¼ã€‚ ä¸€åˆ‡éƒ½ä¼šæ­£å¸¸è¿›è¡Œï¼ å¯¹äºå¤šæ€ç±»æˆ–ç®€å•è”åˆï¼Œè¿™ç§ä¾¿åˆ©å°†ä¸èµ·ä½œç”¨ï¼š </p><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringJoiner</span></span></span><span class="hljs-class"> :</span></span> BaseVisitor&lt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> BaseVisitor::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> (); <span class="hljs-function"><span class="hljs-function">InternalValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EmptyValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; str)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-function">InternalValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; left, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; right)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left + right; } };</code> </pre> <br><p>  <a href="">ä»è¿™é‡Œ</a> ã€‚ </p><br><p> è¿™æ ·çš„è®¿å®¢éå¸¸ç®€å•åœ°ç§°ä¸ºï¼š </p><br><pre> <code class="hljs php">InternalValue delimiter = m_args[<span class="hljs-string"><span class="hljs-string">"d"</span></span>]-&gt;Evaluate(context); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InternalValue&amp; val : values) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFirst) isFirst = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> result = Apply2&lt;visitors::StringJoiner&gt;(result, delimiter); result = Apply2&lt;visitors::StringJoiner&gt;(result, val); }</code> </pre> <br><p>  <code>Apply2</code>è¿™é‡Œæ˜¯<code>boost::apply_visitor</code>çš„åŒ…è£…å™¨ï¼Œè¯¥åŒ…è£…å™¨å°†templateå‚æ•°æŒ‡å®šçš„ç±»å‹çš„è®¿é—®è€…åº”ç”¨äºä¸€å¯¹å˜é‡å€¼ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿›è¡Œä¸€äº›è½¬æ¢ã€‚ å¦‚æœè®¿é—®è€…çš„è®¾è®¡å¸ˆéœ€è¦å‚æ•°ï¼Œåˆ™å°†å…¶ä¼ é€’ç»™è®¿é—®è€…æ‰€åº”ç”¨çš„å¯¹è±¡ä¹‹åï¼š </p><br><pre> <code class="hljs vbscript">comparator = [](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> KeyValuePair&amp; <span class="hljs-built_in"><span class="hljs-built_in">left</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> KeyValuePair&amp; <span class="hljs-built_in"><span class="hljs-built_in">right</span></span>) { return ConvertToBool(Apply2&lt;visitors::BinaryMathOperation&gt;(<span class="hljs-built_in"><span class="hljs-built_in">left</span></span>.value, <span class="hljs-built_in"><span class="hljs-built_in">right</span></span>.value, BinaryExpression::LogicalLt, BinaryExpression::CaseSensitive)); };</code> </pre> <br><p><img src="https://habrastorage.org/webt/ql/6e/qd/ql6eqdbjul3yrvjblr0nwjgqet8.png" align="left" width="60%" height="60%"> å› æ­¤ï¼Œå¸¦æœ‰å‚æ•°çš„è¿ç®—é€»è¾‘å¦‚ä¸‹ï¼šå˜é‡-&gt;ä½¿ç”¨è®¿é—®è€…è§£åŒ…-&gt;å¯¹ç‰¹å®šç±»å‹çš„ç‰¹å®šå€¼æ‰§è¡Œæ‰€éœ€çš„æ“ä½œ-&gt;å°†ç»“æœæ‰“åŒ…å›å˜é‡ä¸­ã€‚ å’Œæœ€å°‘çš„é­”æ³•å§åº•ã€‚ å¯èƒ½ä¼šå®ç°jsä¸­çš„æ‰€æœ‰åŠŸèƒ½ï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ‰§è¡Œæ“ä½œï¼ˆä¾‹å¦‚ï¼ŒåŠ æ³•ï¼‰ï¼Œé€‰æ‹©å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œå°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºåˆ—è¡¨ç­‰çš„ç‰¹å®šç³»ç»Ÿã€‚ æˆ‘é€‰æ‹©äº†ä¸€ç§æ›´ç®€å•ï¼Œæ›´å¯é¢„æµ‹çš„æ–¹å¼ï¼šå¦‚æœå¯¹ä¸€ä¸ªå€¼ï¼ˆæˆ–ä¸€å¯¹å€¼ï¼‰è¿›è¡Œçš„æ“ä½œæ˜¯ä¸å¯èƒ½æˆ–ä¸åˆé€»è¾‘çš„ï¼Œåˆ™è¿”å›ç©ºç»“æœã€‚ å› æ­¤ï¼Œåœ¨å°†æ•°å­—æ·»åŠ åˆ°å­—ç¬¦ä¸²æ—¶ï¼Œä»…å½“ä½¿ç”¨ä¸²è”æ“ä½œï¼ˆ'ã€œ'ï¼‰æ—¶ï¼Œæ‰èƒ½è·å¾—å­—ç¬¦ä¸²ã€‚ å¦åˆ™ï¼Œç»“æœå°†ä¸ºç©ºå€¼ã€‚ æ“ä½œçš„ä¼˜å…ˆçº§ç”±è¯­æ³•ç¡®å®šï¼Œå› æ­¤ï¼Œåœ¨ASTå¤„ç†æœŸé—´ä¸éœ€è¦å…¶ä»–æ£€æŸ¥ã€‚ </p><br><h3 id="filtry-i-testy"> ç­›é€‰å™¨å’Œæµ‹è¯• </h3><br><p><img src="https://habrastorage.org/webt/iy/zr/pp/iyzrppwjtrqdunkvflnjf1bv5ak.png" align="right" width="50%" height="50%">  Jinja2ä¸­å…¶ä»–è¯­è¨€ç§°ä¸ºâ€œæ ‡å‡†åº“â€çš„è¯­è¨€ç§°ä¸ºâ€œè¿‡æ»¤å™¨â€ã€‚ æœ¬è´¨ä¸Šï¼Œè¿‡æ»¤å™¨æ˜¯å¯¹'|'ç¬¦å·å·¦ä¾§çš„å€¼è¿›è¡Œçš„ä¸€ç§å¤æ‚è¿ç®—ï¼Œå…¶ç»“æœå°†æ˜¯ä¸€ä¸ªæ–°å€¼ã€‚ å¯ä»¥é€šè¿‡ç»„ç»‡ç®¡é“å°†è¿‡æ»¤å™¨æŒ‰é“¾æ’åˆ—ï¼š <br> <code>{{ menuItems | selectattr('visible') | map(attribute='title') | map('upper') | join(' -&gt; ') }}</code> <br> åœ¨è¿™é‡Œï¼Œåªä¼šä»menuItemsæ•°ç»„ä¸­é€‰æ‹©visibleå±æ€§è®¾ç½®ä¸ºtrueçš„é‚£äº›å…ƒç´ ï¼Œç„¶åå°†ä»è¿™äº›å…ƒç´ ä¸­è·å–titleå±æ€§ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¤§å†™å­—æ¯ï¼Œç„¶åå°†ç»“æœè¡Œåˆ—è¡¨ä¸åˆ†éš”ç¬¦'-&gt;'ç²˜åˆä¸ºä¸€è¡Œã€‚ æˆ–è€…è¯´ï¼Œä½œä¸ºç”Ÿæ´»ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼š </p><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">macro</span></span></span><span class="hljs-template-tag"> MethodsDecl(class, access) %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> method </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> class.methods | rejectattr('isImplicit') | selectattr('accessType', '</span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag">', access) %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ method.fullPrototype }}</span></span><span class="xml"><span class="xml">; </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">endmacro</span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p>  <a href="">ä»è¿™é‡Œ</a> ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ›¿ä»£é€‰æ‹©</b> <div class="spoiler_text"><pre> <code class="hljs mel">{% macro MethodsDecl(class, access) %} {{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> method <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> class.methods | rejectattr(<span class="hljs-string"><span class="hljs-string">'isImplicit'</span></span>) | selectattr(<span class="hljs-string"><span class="hljs-string">'accessType'</span></span>, <span class="hljs-string"><span class="hljs-string">'in'</span></span>, access) | map(attribute=<span class="hljs-string"><span class="hljs-string">'fullPrototype'</span></span>) | join(<span class="hljs-string"><span class="hljs-string">';\n'</span></span>) }}; {% endmacro %}</code> </pre> </div></div><br><p> æ­¤å®å¯¹ç»™å®šç±»çš„æ‰€æœ‰æ–¹æ³•è¿›è¡Œè¿­ä»£ï¼Œä¸¢å¼ƒå°†isImplicitå±æ€§è®¾ç½®ä¸ºtrueçš„é‚£äº›æ–¹æ³•ï¼Œé€‰æ‹©accessTypeå±æ€§å€¼ä¸ç»™å®šæ–¹æ³•ä¹‹ä¸€åŒ¹é…çš„å…¶ä½™æ–¹æ³•ï¼Œå¹¶æ˜¾ç¤ºå…¶åŸå‹ã€‚ æ¯”è¾ƒæ¸…æ¥šã€‚ è¿™æ¯”ä¸‰å±‚æ¥¼çš„å»ºç­‘è¦å®¹æ˜“å¾—å¤šã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">v.3</a>è§„èŒƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">èŒƒå›´å†…</a>å®ŒæˆC ++ä¸­çš„ç±»ä¼¼æ“ä½œã€‚ </p><br><p> å®é™…ä¸Šï¼Œä¸»è¦çš„æ—¶é—´é”™å¤±ä¸å¤§çº¦40ä¸ªè¿‡æ»¤å™¨çš„å®ç°ç›¸å…³ï¼Œæˆ‘å°†å…¶åŒ…æ‹¬åœ¨åŸºæœ¬é›†ä¸­ã€‚ ç”±äºæŸç§åŸå› ï¼Œæˆ‘è®¤ä¸ºæˆ‘å¯ä»¥åœ¨ä¸€ä¸¤ä¸ªæ˜ŸæœŸå†…å¤„ç†å¥½å®ƒã€‚ å¤ªä¹è§‚äº†ã€‚ å°½ç®¡è¯¥è¿‡æ»¤å™¨çš„å…¸å‹å®ç°éå¸¸ç®€å•ï¼šå–ä¸€ä¸ªå€¼å¹¶ä¸ºå…¶åº”ç”¨ä¸€äº›å‡½å­ï¼Œä½†å®ƒä»¬å¤ªå¤šäº†ï¼Œæˆ‘ä¸å¾—ä¸åŠ¨æ‰‹ã€‚ <br> åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªæœ‰è¶£çš„ä»»åŠ¡æ˜¯å¤„ç†å‚æ•°çš„é€»è¾‘ã€‚ åœ¨Jinja2ä¸­ï¼Œå°±åƒåœ¨pythonä¸­ä¸€æ ·ï¼Œä¼ é€’ç»™è°ƒç”¨çš„å‚æ•°å¯ä»¥å‘½åæˆ–å®šä½ã€‚ è¿‡æ»¤å™¨å£°æ˜ä¸­çš„å‚æ•°å¯ä»¥æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯é€‰çš„ï¼ˆå…·æœ‰é»˜è®¤å€¼ï¼‰ã€‚ æ­¤å¤–ï¼Œä¸C ++ä¸åŒï¼Œå¯é€‰å‚æ•°å¯ä»¥ä½äºå¹¿å‘Šä¸­çš„ä»»ä½•ä½ç½®ã€‚ è€ƒè™‘åˆ°ä¸åŒçš„æƒ…å†µï¼Œæœ‰å¿…è¦æå‡ºä¸€ç§å°†è¿™ä¸¤ä¸ªåˆ—è¡¨åˆå¹¶çš„ç®—æ³•ã€‚ å‡è®¾è¿™é‡Œæœ‰ä¸€ä¸ªèŒƒå›´å‡½æ•°ï¼š <code>range([start, ]stop[, step])</code> ã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨å®ƒï¼š </p><br><pre> <code class="hljs lisp">range(<span class="hljs-number"><span class="hljs-number">10</span></span>) // -&gt; range(<span class="hljs-name"><span class="hljs-name">start</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>, stop = <span class="hljs-number"><span class="hljs-number">10</span></span>, step = <span class="hljs-number"><span class="hljs-number">1</span></span>) range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) // -&gt; range(<span class="hljs-name"><span class="hljs-name">start</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, stop = <span class="hljs-number"><span class="hljs-number">10</span></span>, step = <span class="hljs-number"><span class="hljs-number">1</span></span>) range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) // -&gt; range(<span class="hljs-name"><span class="hljs-name">start</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, stop = <span class="hljs-number"><span class="hljs-number">10</span></span>, step = <span class="hljs-number"><span class="hljs-number">3</span></span>) range(<span class="hljs-name"><span class="hljs-name">step=2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) // -&gt; range(<span class="hljs-name"><span class="hljs-name">start</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>, stop = <span class="hljs-number"><span class="hljs-number">10</span></span>, step = <span class="hljs-number"><span class="hljs-number">2</span></span>) range(<span class="hljs-number"><span class="hljs-number">2</span></span>, step=2, <span class="hljs-number"><span class="hljs-number">10</span></span>) // -&gt; range(<span class="hljs-name"><span class="hljs-name">start</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span>, stop = <span class="hljs-number"><span class="hljs-number">10</span></span>, step = <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p> ä¾æ­¤ç±»æ¨ã€‚ æˆ‘éå¸¸å¸Œæœ›åœ¨å®ç°è¿‡æ»¤å™¨åŠŸèƒ½çš„ä»£ç ä¸­ä¸å¿…è€ƒè™‘æ‰€æœ‰è¿™äº›æƒ…å†µã€‚ ç»“æœï¼Œä»–å†³å®šåœ¨è¿‡æ»¤å™¨ä»£ç ï¼Œæµ‹è¯•å™¨æˆ–åŠŸèƒ½ä»£ç ä¸­ä¸¥æ ¼æŒ‰åç§°è·å–å‚æ•°ã€‚ é€šè¿‡æ£€æŸ¥æ˜¯å¦ä»¥ä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼ç»™å‡ºäº†æ‰€æœ‰å¿…éœ€çš„å‚æ•°ï¼Œä¸€ä¸ªå•ç‹¬çš„å‡½æ•°å°†å‚æ•°çš„å®é™…åˆ—è¡¨ä¸æœŸæœ›çš„å‚æ•°åˆ—è¡¨è¿›è¡Œæ¯”è¾ƒï¼š </p><br><div class="spoiler">  <b class="spoiler_title">å¤§å—ä»£ç </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">ParsedArguments </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseCallParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">initializer_list</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;ArgumentInfo&gt;&amp; args, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> CallParams&amp; params, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; isSucceeded)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArgInfo</span></span></span><span class="hljs-class"> {</span></span> ArgState state = NotFound; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> prevNotFound = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextNotFound = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ArgumentInfo* info = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; }; boost::container::small_vector&lt;ArgInfo, <span class="hljs-number"><span class="hljs-number">8</span></span>&gt; argsInfo(args.size()); boost::container::small_vector&lt;ParamState, <span class="hljs-number"><span class="hljs-number">8</span></span>&gt; posParamsInfo(params.posParams.size()); isSucceeded = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ParsedArguments result; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argIdx = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> firstMandatoryIdx = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> prevNotFound = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> foundKwArgs = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Find all provided keyword args for (auto&amp; argInfo : args) { argsInfo[argIdx].info = &amp;argInfo; auto p = params.kwParams.find(argInfo.name); if (p != params.kwParams.end()) { result.args[argInfo.name] = p-&gt;second; argsInfo[argIdx].state = Keyword; ++ foundKwArgs; } else { if (argInfo.mandatory) { argsInfo[argIdx].state = NotFoundMandatory; if (firstMandatoryIdx == -1) firstMandatoryIdx = argIdx; } else { argsInfo[argIdx].state = NotFound; } if (prevNotFound != -1) argsInfo[prevNotFound].nextNotFound = argIdx; argsInfo[argIdx].prevNotFound = prevNotFound; prevNotFound = argIdx; } ++ argIdx; } int startPosArg = firstMandatoryIdx == -1 ? 0 : firstMandatoryIdx; int curPosArg = startPosArg; int eatenPosArgs = 0; // Determine the range for positional arguments scanning bool isFirstTime = true; for (; eatenPosArgs &lt; posParamsInfo.size(); ++ eatenPosArgs) { if (isFirstTime) { for (; startPosArg &lt; args.size() &amp;&amp; (argsInfo[startPosArg].state == Keyword || argsInfo[startPosArg].state == Positional); ++ startPosArg) ; isFirstTime = false; continue; } int prevNotFound = argsInfo[startPosArg].prevNotFound; if (prevNotFound != -1) { startPosArg = prevNotFound; } else if (curPosArg == args.size()) { break; } else { int nextPosArg = argsInfo[curPosArg].nextNotFound; if (nextPosArg == -1) break; curPosArg = nextPosArg; } } // Map positional params to the desired arguments int curArg = startPosArg; for (int idx = 0; idx &lt; eatenPosArgs &amp;&amp; curArg != -1; ++ idx, curArg = argsInfo[curArg].nextNotFound) { result.args[argsInfo[curArg].info-&gt;name] = params.posParams[idx]; argsInfo[curArg].state = Positional; } // Fill default arguments (if missing) and check for mandatory for (int idx = 0; idx &lt; argsInfo.size(); ++ idx) { auto&amp; argInfo = argsInfo[idx]; switch (argInfo.state) { case Positional: case Keyword: continue; case NotFound: { if (!IsEmpty(argInfo.info-&gt;defaultVal)) result.args[argInfo.info-&gt;name] = std::make_shared&lt;ConstantExpression&gt;(argInfo.info-&gt;defaultVal); break; } case NotFoundMandatory: isSucceeded = false; break; } } // Fill the extra positional and kw-args for (auto&amp; kw : params.kwParams) { if (result.args.find(kw.first) != result.args.end()) continue; result.extraKwArgs[kw.first] = kw.second; } for (auto idx = eatenPosArgs; idx &lt; params.posParams.size(); ++ idx) result.extraPosArgs.push_back(params.posParams[idx]); return result; }</span></span></code> </pre> <br><p>  <a href="">ä»è¿™é‡Œ</a> ã€‚ </p></div></div><br><p> è¿™æ ·ç§°å‘¼ï¼ˆä¾‹å¦‚<code>range</code> ï¼‰ï¼š </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isArgsParsed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> args = helpers::ParseCallParams({{<span class="hljs-string"><span class="hljs-string">"start"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"stop"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-string"><span class="hljs-string">"step"</span></span>}}, m_params, isArgsParsed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isArgsParsed) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InternalValue();</code> </pre> <br><p> å¹¶è¿”å›ä»¥ä¸‹ç»“æ„ï¼š </p><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParsedArguments</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unordered_map</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, ExpressionEvaluatorPtr&lt;&gt;&gt; args; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unordered_map</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, ExpressionEvaluatorPtr&lt;&gt;&gt; extraKwArgs; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;ExpressionEvaluatorPtr&lt;&gt;&gt; extraPosArgs; ExpressionEvaluatorPtr&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>[](<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> p = args.find(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p == args.end()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ExpressionEvaluatorPtr&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p-&gt;second; } };</code> </pre> <br><p> ä»…é€šè¿‡å…¶åç§°å°±å¯ä»¥é‡‡ç”¨çš„å¿…è¦å‚æ•°ï¼š </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">auto</span></span> startExpr = args[<span class="hljs-string"><span class="hljs-string">"start"</span></span>]; <span class="hljs-attribute"><span class="hljs-attribute">auto</span></span> stopExpr = args[<span class="hljs-string"><span class="hljs-string">"stop"</span></span>]; <span class="hljs-attribute"><span class="hljs-attribute">auto</span></span> stepExpr = args[<span class="hljs-string"><span class="hljs-string">"step"</span></span>]; <span class="hljs-attribute"><span class="hljs-attribute">InternalValue</span></span> startVal = startExpr ? startExpr-&gt;Evaluate(values) : InternalValue(); <span class="hljs-attribute"><span class="hljs-attribute">InternalValue</span></span> stopVal = stopExpr ? stopExpr-&gt;Evaluate(values) : InternalValue(); <span class="hljs-attribute"><span class="hljs-attribute">InternalValue</span></span> stepVal = stepExpr ? stepExpr-&gt;Evaluate(values) : InternalValue();</code> </pre> <br><p> ä½¿ç”¨å®å’Œæµ‹è¯•å™¨æ—¶ï¼Œä½¿ç”¨ç±»ä¼¼çš„æœºåˆ¶ã€‚ å°½ç®¡æè¿°æ¯ä¸ªè¿‡æ»¤å™¨å’Œæµ‹è¯•çš„å‚æ•°ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„äº‹æƒ…ï¼Œä½†æ²¡æœ‰ï¼ˆå¦‚ä½•å®ç°ï¼‰ï¼Œä½†å³ä½¿æ˜¯åŒ…æ‹¬çº¦50ä¸ªè¿™æ ·çš„â€œåŸºæœ¬â€é›†åˆï¼Œä¹Ÿè¯æ˜äº†å®ç°éå¸¸åºå¤§ã€‚ è€Œä¸”è¿™æä¾›äº†å®ƒä¸åŒ…æ‹¬æ‰€æœ‰æ£˜æ‰‹çš„å†…å®¹ï¼Œä¾‹å¦‚ä¸ºHTMLï¼ˆæˆ–C ++ï¼‰æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä»¥xmlæˆ–jsonç­‰æ ¼å¼è¾“å‡ºå€¼ï¼Œç­‰ç­‰ã€‚ </p><br><p> åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»ä½¿ç”¨å‡ ä¸ªæ¨¡æ¿ï¼ˆå¯¼å‡ºï¼ŒåŒ…å«ï¼Œå®ï¼‰çš„å·¥ä½œçš„å®ç°ï¼Œä»¥åŠé€šè¿‡é”™è¯¯å¤„ç†çš„å®ç°è€Œå¼•äººå…¥èƒœçš„å†’é™©ä»¥åŠä½¿ç”¨ä¸åŒå®½åº¦çš„å­—ç¬¦ä¸²çš„å·¥ä½œã€‚ </p><br><p> ä¼ ç»Ÿä¸Šï¼Œé“¾æ¥ï¼š </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jinja2è§„æ ¼</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jinja2Cppå®ç°</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419011/">https://habr.com/ru/post/zh-CN419011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419001/index.html">æœªæ¥å·¥ä½œå¿…ä¸å¯å°‘çš„5ç§â€œè¶…çº§æŠ€èƒ½â€</a></li>
<li><a href="../zh-CN419003/index.html">åŒºå—é“¾æ–°é—»æ‘˜è¦</a></li>
<li><a href="../zh-CN419005/index.html">æ¸¸è§ˆå˜ç”µç«™220/110/20</a></li>
<li><a href="../zh-CN419007/index.html">64kç®€ä»‹çš„çº¹ç†ï¼šä»Šå¤©å¦‚ä½•å®Œæˆ</a></li>
<li><a href="../zh-CN419009/index.html">clangå’ŒIDEï¼šå…³äºå‹è°Šå’Œå‹è°Šçš„æ•…äº‹</a></li>
<li><a href="../zh-CN419013/index.html">SaaS B2Bä¸šåŠ¡åŸºäºæ¸ é“çš„å½’å› -å› ä¸ºæˆ‘ä»¬è€ƒè™‘äº†æ‰€æœ‰è¥é”€å·¥ä½œçš„ä»·å€¼</a></li>
<li><a href="../zh-CN419017/index.html">ConstraintLayout 1.1çš„æ–°å¢åŠŸèƒ½</a></li>
<li><a href="../zh-CN419019/index.html">AlterEgoï¼šä¸€ç§å¯ä»¥è¯»å–ï¼ˆä¸€äº›ï¼‰æ€æƒ³çš„è®¾å¤‡</a></li>
<li><a href="../zh-CN419021/index.html">å°åˆ·çš„ä¸»è¦ç±»å‹åŠå…¶åŠŸèƒ½</a></li>
<li><a href="../zh-CN419023/index.html">æˆ‘ä»¬å¦‚ä½•æ‰©å±•Nginxå¹¶æ‹¯æ•‘ä¸–ç•Œ54å¹´çš„æ¯å¤©ç­‰å¾…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>