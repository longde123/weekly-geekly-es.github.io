<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîô üßõüèº üñ•Ô∏è Como o JS funciona: classes e heran√ßa, transpila√ß√£o em Babel e TypeScript üë©üèº‚Äçü§ù‚Äçüë©üèª üåÑ üö•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As aulas s√£o uma das formas mais populares de estruturar projetos de software atualmente. Essa abordagem de programa√ß√£o tamb√©m √© usada em JavaScript. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o JS funciona: classes e heran√ßa, transpila√ß√£o em Babel e TypeScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/415377/">  As aulas s√£o uma das formas mais populares de estruturar projetos de software atualmente.  Essa abordagem de programa√ß√£o tamb√©m √© usada em JavaScript.  Hoje estamos publicando uma tradu√ß√£o da parte 15 da s√©rie de ecossistemas JS.  Este artigo discutir√° v√°rias abordagens para implementar classes em JavaScript, mecanismos de heran√ßa e transpira√ß√£o.  Come√ßaremos dizendo como os prot√≥tipos funcionam e analisando v√°rias maneiras de simular a heran√ßa baseada em classes em bibliotecas populares.  Em seguida, falaremos sobre como, gra√ßas √† transpila√ß√£o, √© poss√≠vel escrever programas JS que usam recursos que n√£o est√£o dispon√≠veis no idioma ou, embora existam na forma de novos padr√µes ou propostas que est√£o em diferentes est√°gios de aprova√ß√£o, ainda n√£o foram implementados no JS- motores.  Em particular, falaremos sobre as classes Babel, TypeScript e ECMAScript 2015. Depois disso, examinaremos alguns exemplos que demonstram os recursos da implementa√ß√£o interna de classes no mecanismo V8 JS. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/196/736/c87/196736c87449034c2354db7c52f1cd08.png" alt="imagem"></div><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">[Leitura recomendada] As outras 19 partes do ciclo</b> <div class="spoiler_text"> Parte 1: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vis√£o geral do mecanismo, mecanismos de tempo de execu√ß√£o, pilha de chamadas</a> <br>  Parte 2: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sobre os internos da V8 e otimiza√ß√£o de c√≥digo</a> <br>  Parte 3: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gerenciando a mem√≥ria, quatro tipos de vazamentos de mem√≥ria e lidando com eles</a> <br>  Parte 4: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Loop de eventos, ass√≠ncrono e cinco maneiras de melhorar seu c√≥digo com async / waitit</a> <br>  Parte 5: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WebSocket e HTTP / 2 + SSE.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que escolher?</a> <br>  Parte 6: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Recursos e escopo do WebAssembly</a> <br>  Parte 7: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Trabalhadores da Web e cinco cen√°rios de uso</a> <br>  Parte 8: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Trabalhadores de Servi√ßo</a> <br>  Parte 9: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Notifica√ß√µes por push da Web</a> <br>  Parte 10: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rastrear altera√ß√µes no DOM com MutationObserver</a> <br>  Parte 11: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mecanismos de renderiza√ß√£o de p√°ginas da Web e dicas para otimizar seu desempenho</a> <br>  Parte 12: O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">subsistema de rede dos navegadores, otimizando seu desempenho e seguran√ßa</a> <br>  Parte 12: O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">subsistema de rede dos navegadores, otimizando seu desempenho e seguran√ßa</a> <br>  Parte 13: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Anima√ß√£o com CSS e JavaScript</a> <br>  Parte 14: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o JS funciona: √Årvores de sintaxe abstratas, an√°lise e sua otimiza√ß√£o</a> <br>  Parte 15: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o JS funciona: classes e heran√ßa, transpila√ß√£o em Babel e TypeScript</a> <br>  Parte 16: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o JS funciona: armazenamento</a> <br>  Parte 17: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o JS funciona: Tecnologia Shadow DOM e componentes da Web</a> <br>  Parte 18: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o JS funciona: mecanismos de comunica√ß√£o WebRTC e P2P</a> <br>  Parte 19: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o JS funciona: elementos personalizados</a> </div></div><br><h2>  <font color="#3AC1EF">Revis√£o</font> </h2><br>  Em JavaScript, somos constantemente confrontados com objetos, mesmo quando parece que estamos trabalhando com tipos de dados primitivos.  Por exemplo, crie uma string literal: <br><br><pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = <span class="hljs-string"><span class="hljs-string">"SessionStack"</span></span>;</code> </pre> <br>  Depois disso, podemos chamar imediatamente o <code>name</code> para chamar v√°rios m√©todos de um objeto do tipo <code>String</code> , para o qual a string literal que criamos ser√° convertida automaticamente. <br><br><pre> <code class="hljs pgsql">console.log(<span class="hljs-type"><span class="hljs-type">name</span></span>.repeat(<span class="hljs-number"><span class="hljs-number">2</span></span>)); // SessionStackSessionStack console.log(<span class="hljs-type"><span class="hljs-type">name</span></span>.toLowerCase()); // sessionstack</code> </pre> <br>  Diferentemente de outros idiomas, no JavaScript, depois de criar uma vari√°vel que cont√©m, por exemplo, uma string ou um n√∫mero, podemos, sem realizar uma convers√£o expl√≠cita, trabalhar com essa vari√°vel como se ela tivesse sido originalmente criada usando a <code>new</code> palavra-chave e o construtor correspondente.  Como resultado, devido √† cria√ß√£o autom√°tica de objetos que encapsulam valores primitivos, √© poss√≠vel trabalhar com esses valores como se fossem objetos, em particular, referindo-se a seus m√©todos e propriedades. <br><br>  Outro fato digno de nota em rela√ß√£o ao sistema de tipos JavaScript √© que, por exemplo, matrizes tamb√©m s√£o objetos.  Se voc√™ observar a sa√≠da do comando <code>typeof</code> para a matriz, poder√° ver que ele relata que a entidade sob investiga√ß√£o possui o tipo de dados do <code>object</code> .  Como resultado, verifica-se que os √≠ndices dos elementos da matriz s√£o apenas propriedades de um objeto espec√≠fico.  Portanto, quando acessamos um elemento de uma matriz por √≠ndice, tudo se resume a trabalhar com uma propriedade de um objeto do tipo <code>Array</code> e obter o valor dessa propriedade.  Se falamos sobre como os dados s√£o armazenados dentro de objetos e matrizes comuns, as duas constru√ß√µes a seguir levam √† cria√ß√£o de estruturas de dados quase id√™nticas: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> names = [<span class="hljs-string"><span class="hljs-string">"SessionStack"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> names = { <span class="hljs-string"><span class="hljs-string">"0"</span></span>: <span class="hljs-string"><span class="hljs-string">"SessionStack"</span></span>, <span class="hljs-string"><span class="hljs-string">"length"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre> <br>  Como resultado, o acesso aos elementos da matriz e √†s propriedades do objeto √© realizado na mesma velocidade.  O autor deste artigo diz que descobriu durante a solu√ß√£o de um problema complexo.  Ou seja, uma vez que ele precisava realizar uma otimiza√ß√£o s√©ria de um trecho de c√≥digo muito importante no projeto.  Depois de tentar muitas abordagens simples, ele decidiu substituir todos os objetos usados ‚Äã‚Äãneste c√≥digo por matrizes.  Em teoria, acessar elementos de matriz √© mais r√°pido do que trabalhar com chaves de tabela de hash.  Para sua surpresa, essa substitui√ß√£o n√£o afetou o desempenho de nenhuma maneira, j√° que trabalhar com matrizes e objetos com JavaScript se resume a interagir com chaves de tabela de hash, o que, em ambos os casos, requer a mesma quantidade de tempo. <br><br><h2>  <font color="#3AC1EF">Simulando classes usando prot√≥tipos</font> </h2><br>  Quando pensamos em objetos, a primeira coisa que vem √† mente s√£o as classes.  Talvez cada um dos que est√£o envolvidos na programa√ß√£o de hoje tenha criado aplicativos cuja estrutura se baseia em classes e nos relacionamentos entre eles.  Embora objetos em JavaScript possam ser encontrados literalmente em qualquer lugar, a linguagem n√£o usa um sistema tradicional de heran√ßa baseado em classe.  JavaScript usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">prot√≥tipos</a> para resolver problemas semelhantes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/ba7/cab/633ba7cabdf251ed3747fb2a3764b344.png"></div><br>  <i><font color="#999999">Objeto e seu prot√≥tipo</font></i> <br><br>  No JavaScript, cada objeto √© associado a outro objeto - com seu pr√≥prio prot√≥tipo.  Quando voc√™ tenta acessar uma propriedade ou m√©todo de um objeto, a pesquisa do que voc√™ precisa √© realizada primeiro no pr√≥prio objeto.  Se a pesquisa n√£o tiver √™xito, ela continua no prot√≥tipo do objeto. <br><br>  Considere um exemplo simples que descreve uma fun√ß√£o de construtor para a classe base <code>Component</code> : <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Component</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } Component.prototype.render = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content); }</code> </pre> <br>  Aqui, atribu√≠mos a fun√ß√£o <code>render()</code> ao m√©todo prototype, pois precisamos de cada inst√¢ncia da classe <code>Component</code> para usar esse m√©todo.  Quando, em qualquer inst√¢ncia do <code>Component</code> , o m√©todo <code>render</code> √© chamado, sua pesquisa come√ßa no pr√≥prio objeto para o qual √© chamado.  Em seguida, a pesquisa continua no prot√≥tipo, onde o sistema encontra esse m√©todo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/553/6d8/74d/5536d874d81cc44b164174953614f725.png"></div><br>  <i><font color="#999999">Prot√≥tipo e duas inst√¢ncias da classe Component</font></i> <br><br>  Agora vamos tentar estender a classe <code>Component</code> .  Vamos criar um construtor para uma nova classe - <code>InputField</code> : <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputField</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span></span> {   this.content = `&lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> value=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{value}"</span></span> /&gt;`; }</code> </pre> <br>  Se precisamos que a classe <code>InputField</code> estenda a funcionalidade da classe <code>Component</code> e consigamos chamar seu m√©todo de <code>render</code> , precisamos alterar seu prot√≥tipo.  Quando um m√©todo √© chamado em uma inst√¢ncia de uma classe filho, n√£o faz sentido procur√°-lo em um prot√≥tipo vazio.  Precisamos, na busca por esse m√©todo, ser encontrado na classe <code>Component</code> .  Portanto, precisamos fazer o seguinte: <br><br><pre> <code class="hljs pgsql">InputField.prototype = <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Component());</code> </pre> <br>  Agora, ao trabalhar com uma inst√¢ncia da classe <code>InputField</code> e chamar o m√©todo da classe <code>Component</code> , esse m√©todo ser√° encontrado no prot√≥tipo da classe <code>Component</code> .  Para implementar o sistema de heran√ßa, voc√™ precisa conectar o prot√≥tipo <code>InputField</code> a uma inst√¢ncia da classe <code>Component</code> .  Muitas bibliotecas usam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Object.setPrototypeOf ()</a> para resolver esse problema. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5c/c43/ba8/f5cc43ba8e7a66cf1bb5c8aecec04572.png"></div><br>  <i><font color="#999999">Estendendo a classe Component com a classe InputField</font></i> <br><br>  No entanto, as a√ß√µes acima n√£o s√£o suficientes para implementar um mecanismo semelhante √† heran√ßa tradicional.  Cada vez que estendemos a classe, precisamos executar as seguintes a√ß√µes: <br><br><ul><li>  Fa√ßa do prot√≥tipo da classe descendente uma inst√¢ncia da classe pai. </li><li>  Chame, no construtor da classe descendente, o construtor da classe pai para garantir que a classe pai seja inicializada corretamente. </li><li>  Forne√ßa um mecanismo para chamar m√©todos da classe pai em situa√ß√µes em que a classe descendente substitua o m√©todo pai, mas √© necess√°rio chamar a implementa√ß√£o original desse m√©todo da classe pai. </li></ul><br>  Como voc√™ pode ver, se um desenvolvedor de JS quiser usar os recursos de heran√ßa baseada em classe, ele precisar√° constantemente executar as etapas acima.  No caso de voc√™ precisar criar muitas classes, tudo isso pode ser feito na forma de fun√ß√µes adequadas para reutiliza√ß√£o. <br><br>  De fato, a tarefa de organizar a heran√ßa com base em classes foi inicialmente resolvida na pr√°tica do desenvolvimento de JS dessa maneira.  Em particular, usando v√°rias bibliotecas.  Essas solu√ß√µes se tornaram muito populares, o que indicava claramente que algo estava claramente ausente no JavaScript.  √â por isso que o ECMAScript 2015 introduziu novas constru√ß√µes sint√°ticas destinadas a apoiar o trabalho com classes e a implementar os mecanismos de heran√ßa correspondentes. <br><br><h2>  <font color="#3AC1EF">Transpila√ß√£o de classe</font> </h2><br>  Ap√≥s a proposta dos novos recursos do ECMAScript 2015 (ES6), a comunidade JS quis aproveit√°-los o mais r√°pido poss√≠vel, sem aguardar a conclus√£o do longo processo de adi√ß√£o de suporte para esses recursos nos mecanismos e navegadores JS.  Ao resolver esses problemas, a transpila√ß√£o √© boa.  Nesse caso, a compila√ß√£o √© reduzida √† transforma√ß√£o do c√≥digo JS gravado de acordo com as regras do ES6 para uma visualiza√ß√£o compreens√≠vel para navegadores que at√© agora n√£o suportam recursos do ES6.  Como resultado, por exemplo, torna-se poss√≠vel declarar classes e implementar mecanismos de heran√ßa baseados em classes de acordo com as regras ES6 e converter essas constru√ß√µes em c√≥digo que funciona em qualquer navegador.  Esquematicamente, esse processo, usando o exemplo de processamento de uma fun√ß√£o de seta por um transpiler (outro novo recurso de idioma que precisa de tempo para suportar), pode ser representado como mostrado na figura abaixo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/802/37b/f2c/80237bf2c453fb8f9d7913c310a21384.png"></div><br>  <i><font color="#999999">Transpila√ß√£o</font></i> <br><br>  Um dos transpilers JavaScript mais populares √© o Babel.js.  Vamos ver como ele funciona executando uma compila√ß√£o do c√≥digo de declara√ß√£o da classe <code>Component</code> , sobre o qual falamos acima.  Ent√£o, aqui est√° o c√≥digo ES6: <br><br><pre> <code class="hljs javascript"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(content) {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } render() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content) } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Component(<span class="hljs-string"><span class="hljs-string">'SessionStack'</span></span>); component.render();</code> </pre> <br>  E aqui est√° o que esse c√≥digo se transforma ap√≥s a transpila√ß√£o: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Component = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Component</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{   _classCallCheck(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Component);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } _createClass(Component, [{   <span class="hljs-attr"><span class="hljs-attr">key</span></span>: <span class="hljs-string"><span class="hljs-string">'render'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content);   } }]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Component; }();</code> </pre> <br>  Como voc√™ pode ver, o c√≥digo ECMAScript 5 √© obtido na sa√≠da do transpiler, que pode ser executado em qualquer ambiente.  Al√©m disso, chamadas para algumas fun√ß√µes que fazem parte da biblioteca padr√£o Babel s√£o adicionadas aqui. <br><br>  Estamos falando das <code>_classCallCheck()</code> e <code>_createClass()</code> inclu√≠das no c√≥digo transpilado.  A primeira fun√ß√£o, <code>_classCallCheck()</code> , foi projetada para impedir que a fun√ß√£o construtora seja chamada como uma fun√ß√£o regular.  Para fazer isso, ele verifica se o contexto no qual a fun√ß√£o √© chamada √© o contexto da inst√¢ncia da classe <code>Component</code> .  O c√≥digo verifica se a palavra-chave this aponta para uma inst√¢ncia semelhante.  A segunda fun√ß√£o, <code>_createClass()</code> , cria propriedades do objeto que s√£o passadas a ele como uma matriz de objetos que cont√™m chaves e seus valores. <br><br>  Para entender como a heran√ßa funciona, analisamos a classe <code>InputField</code> , que √© a descendente da classe <code>Component</code> .  Veja como as rela√ß√µes de classe se re√∫nem no ES6: <br><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputField</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   constructor(value) {       const content = `&lt;input <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"text"</span></span> value=<span class="hljs-string"><span class="hljs-string">"${value}"</span></span> /&gt;`;       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(content);   } }</code> </pre> <br>  Aqui est√° o resultado da transpila√ß√£o desse c√≥digo usando Babel: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> InputField = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_Component</span></span></span><span class="hljs-function">) </span></span>{ _inherits(InputField, _Component); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputField</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{   _classCallCheck(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, InputField);   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-string"><span class="hljs-string">'&lt;input type="text" value="'</span></span> + value + <span class="hljs-string"><span class="hljs-string">'" /&gt;'</span></span>;   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _possibleConstructorReturn(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, (InputField.__proto__ || <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getPrototypeOf(InputField)).call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, content)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InputField; }(Component);</code> </pre> <br>  Neste exemplo, a l√≥gica dos mecanismos de heran√ßa √© encapsulada em uma chamada para a fun√ß√£o <code>_inherits()</code> .  Ele executa as mesmas a√ß√µes que descrevemos acima, associadas, em particular, √† grava√ß√£o no prot√≥tipo da classe descendente de uma inst√¢ncia da classe pai. <br><br>  Para transpor o c√≥digo, Babel realiza v√°rias de suas transforma√ß√µes.  Primeiro, o c√≥digo ES6 √© analisado e convertido em uma representa√ß√£o intermedi√°ria denominada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rvore de sintaxe abstrata</a> .  Em seguida, a √°rvore de sintaxe abstrata resultante √© convertida em outra √°rvore, cada n√≥ transformado em seu equivalente ES5.  Como resultado, essa √°rvore √© convertida em c√≥digo JS. <br><br><h2>  <font color="#3AC1EF">√Årvore de sintaxe abstrata em Babel</font> </h2><br>  Uma √°rvore de sintaxe abstrata cont√©m n√≥s, cada um dos quais possui apenas um n√≥ pai.  Babel tem um tipo de base para n√≥s.  Ele cont√©m informa√ß√µes sobre o que √© o n√≥ e onde ele pode ser encontrado no c√≥digo.  Existem v√°rios tipos de n√≥s, por exemplo, n√≥s para representar literais, como cadeias, n√∫meros, valores <code>null</code> e assim por diante.  Al√©m disso, existem n√≥s para representar express√µes usadas para controlar o fluxo de execu√ß√£o do programa ( <code>if</code> construido) e n√≥s para loops ( <code>for</code> <code>while</code> ).  H√° tamb√©m um tipo especial de n√≥ para representar classes.  √â um descendente da classe base do <code>Node</code> .  Ele estende essa classe adicionando campos para armazenar refer√™ncias √† classe base e ao corpo da classe como um n√≥ separado. <br>  Converta o seguinte fragmento de c√≥digo em uma √°rvore de sintaxe abstrata: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(content) {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content; } render() {   console.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content) } }</code> </pre> <br>  Aqui est√° como sua representa√ß√£o esquem√°tica ser√°. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8b/4c5/c1d/a8b4c5c1d077388bac770d1b452e51ed.png"></div><br>  <i><font color="#999999">√Årvore de sintaxe abstrata</font></i> <br><br>  Ap√≥s criar uma √°rvore, cada um de seus n√≥s √© transformado em seu n√≥ ES5 correspondente, ap√≥s o qual essa nova √°rvore √© convertida em c√≥digo compat√≠vel com o padr√£o ECMAScript 5. Durante o processo de convers√£o, localize primeiro o n√≥ localizado mais distante do n√≥ raiz, ap√≥s o qual este n√≥ √© convertido em c√≥digo usando trechos gerados para cada n√≥.  Depois disso, o processo √© repetido.  Essa t√©cnica √© chamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pesquisa profunda</a> . <br><br>  No exemplo acima, o c√≥digo para os dois n√≥s <code>MethodDefinition</code> ser√° gerado primeiro, ap√≥s o qual o c√≥digo para o n√≥ <code>ClassBody</code> ser√° gerado e, finalmente, o c√≥digo para o n√≥ <code>ClassDeclaration</code> . <br><br><h2>  <font color="#3AC1EF">Transpila√ß√£o TypeScript</font> </h2><br>  Outro sistema popular que usa transpila√ß√£o √© o TypeScript.  Essa √© uma linguagem de programa√ß√£o cujo c√≥digo √© transformado em c√≥digo ECMAScript 5 que √© compreens√≠vel para qualquer mecanismo JS.  Oferece nova sintaxe para escrever aplicativos JS.  Veja como implementar a classe <code>Component</code> no TypeScript: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   content: string;   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(content: string) {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content = content;   }   render() {       console.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.content)   } }</code> </pre> <br>  Aqui est√° a √°rvore de sintaxe abstrata para esse c√≥digo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/332/806/ad0/332806ad0bd9882f32c58c0280a8ae40.png"></div><br>  <i><font color="#999999">√Årvore de sintaxe abstrata</font></i> <br><br>  TypeScript suporta heran√ßa. <br><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputField</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   constructor(value: string) {       const content = `&lt;input <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"text"</span></span> value=<span class="hljs-string"><span class="hljs-string">"${value}"</span></span> /&gt;`;       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(content);   } }</code> </pre> <br>  Aqui est√° o resultado da transpila√ß√£o deste c√≥digo: <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> InputField = <span class="hljs-comment"><span class="hljs-comment">/** @class */</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_super)</span></span></span><span class="hljs-function"> </span></span>{   __extends(InputField, _super);   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputField</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _this = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-string"><span class="hljs-string">"&lt;input type=\"text\" value=\""</span></span> + value + <span class="hljs-string"><span class="hljs-string">"\" /&gt;"</span></span>;       _this = _super.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, content) || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _this;   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> InputField; }(Component));</code> </pre> <br>  Como voc√™ pode ver, este √© novamente um c√≥digo ES5, no qual, al√©m das constru√ß√µes padr√£o, h√° chamadas para algumas fun√ß√µes da biblioteca TypeScript.  Os recursos da fun√ß√£o <code>__extends()</code> semelhantes aos de que falamos no come√ßo deste material. <br><br>  Gra√ßas √† ampla ado√ß√£o do Babel e do TypeScript, os mecanismos para declarar classes e organizar a heran√ßa baseada em classes tornaram-se ferramentas padr√£o para estruturar aplicativos JS.  Isso contribuiu para a adi√ß√£o de suporte para esses mecanismos nos navegadores. <br><br><h2>  <font color="#3AC1EF">Suporte √† classe do navegador</font> </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O suporte √† classe</a> apareceu no navegador Chrome em 2014.  Isso permite que o navegador trabalhe com declara√ß√µes de classe sem o uso de transpila√ß√£o ou quaisquer bibliotecas auxiliares. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad5/860/a55/ad5860a550c7956d6bbf17cd1b0afbb6.png"></div><br>  <i><font color="#999999">Trabalhando com classes no console do Chrome JS</font></i> <br><br>  De fato, o suporte do navegador a esses mecanismos n√£o passa de a√ß√∫car sint√°tico.  Essas constru√ß√µes s√£o convertidas nas mesmas estruturas b√°sicas que j√° s√£o suportadas pelo idioma.  Como resultado, mesmo se voc√™ usar a nova sintaxe, em um n√≠vel inferior, tudo parecer√° como criar construtores e manipular prot√≥tipos de objetos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b61/d1c/a5b/b61d1ca5b3d35b3b1f431ae8e82c48bd.png"></div><br>  <i><font color="#999999">Suporte de classe √© a√ß√∫car sint√°tico</font></i> <br><br><h2>  <font color="#3AC1EF">Suporte de classe na V8</font> </h2><br>  Vamos falar sobre como o suporte √† classe ES6 funciona no mecanismo V8 JS.  No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">material anterior</a> dedicado √†s √°rvores de sintaxe abstrata, falamos sobre o fato de que, ao preparar o c√≥digo JS para execu√ß√£o, o sistema o analisa e forma uma √°rvore de sintaxe abstrata em sua base.  Ao analisar constru√ß√µes de declara√ß√µes de classe, os n√≥s do tipo <a href="">ClassLiteral</a> caem na √°rvore de sintaxe abstrata. <br><br>  Esses n√≥s armazenam algumas coisas interessantes.  Primeiro, √© um construtor como uma fun√ß√£o separada e, segundo, √© uma lista de propriedades de classe.  Podem ser m√©todos, getters, setters, campos p√∫blicos ou privados.  Al√©m disso, esse n√≥ armazena uma refer√™ncia √† classe pai, que estende a classe para a qual o n√≥ √© formado, que novamente armazena o construtor, a lista de propriedades e um link para sua pr√≥pria classe pai. <br><br>  Depois que o novo n√≥ <code>ClassLiteral</code> <a href="">transformado em c√≥digo</a> , ele √© convertido em constru√ß√µes que consistem em fun√ß√µes e prot√≥tipos. <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  O autor deste material diz que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SessionStack</a> se esfor√ßa para otimizar o m√°ximo poss√≠vel o c√≥digo de sua biblioteca, pois precisa resolver tarefas dif√≠ceis de coletar informa√ß√µes sobre tudo o que acontece nas p√°ginas da web.  Durante a solu√ß√£o desses problemas, a biblioteca n√£o deve desacelerar o trabalho da p√°gina analisada.  A otimiza√ß√£o desse n√≠vel requer levar em conta os menores detalhes do ecossistema JavaScript que afetam o desempenho, em particular, levar em conta os recursos de como as classes e os mecanismos de heran√ßa s√£o organizados no ES6. <br><br>  <b>Caros leitores!</b>  Voc√™ usa constru√ß√µes de sintaxe ES6 para trabalhar com classes em JavaScript? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415377/">https://habr.com/ru/post/pt415377/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415367/index.html">E se os alien√≠genas se tornarem m√°quinas com intelig√™ncia artificial?</a></li>
<li><a href="../pt415369/index.html">Pre√ßo de refatora√ß√£o</a></li>
<li><a href="../pt415371/index.html">Privacidade de Criptomoedas</a></li>
<li><a href="../pt415373/index.html">NumPy em Python. Parte 4</a></li>
<li><a href="../pt415375/index.html">Ovelhas Ocultas e Arqueologia Tipogr√°fica</a></li>
<li><a href="../pt415381/index.html">Brinque com o Kubernetes - servi√ßo para familiarizar-se com os K8s</a></li>
<li><a href="../pt415383/index.html">O comerciante iniciante fez neg√≥cios de ‚Ç¨ 5,5 bilh√µes devido a um erro no sistema da corretora brit√¢nica</a></li>
<li><a href="../pt415385/index.html">A situa√ß√£o do DCIM: como o gerenciamento de infraestrutura de data center mudou nos √∫ltimos anos</a></li>
<li><a href="../pt415387/index.html">Todo desenvolvedor quer saber como entrar em phishing.</a></li>
<li><a href="../pt415389/index.html">Hoje, o sistema de pagamento "VKontakte"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>