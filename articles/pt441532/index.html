<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüî¨ üêò üóΩ Batfish 1. Introdu√ß√£o üßëüèΩ‚Äçü§ù‚Äçüßëüèª üëª ü§úüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um dos problemas das redes modernas √© sua fragilidade. Muitas regras de filtragem, pol√≠ticas de troca de informa√ß√µes de roteamento, protocolos de rote...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Batfish 1. Introdu√ß√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441532/"><img src="https://habrastorage.org/webt/tm/-b/yz/tm-byzhobce3it0kku80cuyttny.png" alt="imagem"><br><br>  Um dos problemas das redes modernas √© sua fragilidade.  Muitas regras de filtragem, pol√≠ticas de troca de informa√ß√µes de roteamento, protocolos de roteamento din√¢mico tornam as redes confusas e sujeitas a fatores humanos.  Uma falha na rede pode ocorrer involuntariamente ao fazer altera√ß√µes em um mapa de rota ou ACL ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dois</a> ).  Definitivamente, n√£o temos uma ferramenta para avaliar o comportamento de uma rede com uma nova configura√ß√£o antes de fazer altera√ß√µes na produ√ß√£o.  Quero saber exatamente se a Rede A estar√° dispon√≠vel para mim se filtrar alguns dos an√∫ncios BGP recebidos do provedor B?  Qual rota os pacotes ir√£o da rede C para o servidor D se em um dos links de tr√¢nsito eu dobrar a m√©trica IGP?  O Batfish nos ajudar√° a responder a essas e muitas outras perguntas! <br><a name="habracut"></a><br><h2>  Revis√£o do Batfish </h2><br>  Batfish √© uma ferramenta de modelagem de rede.  Seu principal objetivo √© testar as altera√ß√µes na configura√ß√£o antes de faz√™-las na rede de produ√ß√£o.  O Batfish tamb√©m pode ser usado para analisar e verificar o status atual da rede.  Os processos de CI / CD existentes no mundo da rede claramente carecem de uma ferramenta para testar novas configura√ß√µes.  Batfish resolve esse problema. <br><br>  O Batfish n√£o requer acesso direto direto ao equipamento de rede existente. O Batfish modela o comportamento da rede com base nos dados contidos nos arquivos de configura√ß√£o do dispositivo. <br><br>  Batfish pode: <br><br><ul><li>  determinar o status do vizinho de protocolos de roteamento din√¢mico na rede (BGP, IS-IS, OSPF) </li><li>  calcular o RIB de cada elemento de rede </li><li>  verifique as configura√ß√µes de NTP, AAA, MTU </li><li>  permita determinar se o ACL obstrui a passagem do tr√°fego de rede (an√°logo do packet-tracer no Cisco ASA) </li><li>  verifique se h√° conectividade de ponta a ponta entre hosts na rede </li><li>  mostra o caminho do tr√°fego atrav√©s da rede (rastreamento virtual) </li></ul><br><br>  Plataformas suportadas: <br><br><ul><li>  Arista </li><li>  Aruba </li><li>  AWS (VPCs, ACLs de rede, VPN GW, NAT GW, Internet GW, Grupos de seguran√ßa) </li><li>  Cisco (NX-OS, IOS, IOS-XE, IOS-XR e ASA) </li><li>  Dell force10 </li><li>  Fundi√ß√£o </li><li>  iptables </li><li>  Juniper (MX, EX, QFX, SRX, s√©rie T, PTX) </li><li>  Mrv </li><li>  Redes de Palo alto </li><li>  Quagga / FRR </li><li>  Quanta </li><li>  Vyos </li></ul><br><img src="https://habrastorage.org/webt/p_/ai/gt/p_aigtayir28gmvf6yxdhec7vkm.png" alt="imagem"><br><br>  Batfish √© um aplicativo Java.  Para um trabalho conveniente, foi escrito Pybatfish - python SDK. <br><br>  Vamos seguir praticando.  Vou mostrar-lhe as possibilidades do Batfish com um exemplo. <br><br><h2>  Exemplo </h2><br>  Gerenciamos dois sistemas aut√¥nomos: AS 41214 e AS 10631. Como IGP, o AS-41214 usa IS-IS e o AS-10631 - OSPF.  Dentro de cada AS, √© utilizado o IBGP-fullmesh.  O LDN-CORE-01 anuncia o prefixo 135.65.0.0/19 dos vizinhos BGP, MSK-CORE-01 - 140.0.0.0/24.  A troca de informa√ß√µes de roteamento entre sistemas aut√¥nomos ocorre na jun√ß√£o de HKI-CORE-01 - SPB-CORE-01. <br><br>  <b>HKI-CORE-01, STH-CORE-01</b> - Roteadores Junos <br>  <b>LDN-CORE-01, AMS-CORE-01, SPB-CORE-01, MSK-CORE-01</b> - roteadores Cisco IOS <br><br> <a href=""><img src="https://habrastorage.org/webt/oc/a6/xv/oca6xv1rrtbzkou8autoshzlfte.png"></a> <br><br>  Instale o cont√™iner com o Batfish e o python SDK: <br><br><pre><code class="bash hljs">docker pull batfish/allinone docker run batfish/allinone docker container <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it &lt;container&gt; bash</code> </pre> <br>  Conhe√ßa a biblioteca atrav√©s do modo interativo python: <br><br><pre> <code class="bash hljs">root@ea9a1559d88e:/<span class="hljs-comment"><span class="hljs-comment"># python3 -------------------- &gt;&gt;&gt; from pybatfish.client.commands import bf_logger, bf_init_snapshot &gt;&gt;&gt; from pybatfish.question.question import load_questions &gt;&gt;&gt; from pybatfish.question import bfq &gt;&gt;&gt; import logging &gt;&gt;&gt; bf_logger.setLevel(logging.ERROR) &gt;&gt;&gt; load_questions() &gt;&gt;&gt; bf_init_snapshot('tmp/habr') 'ss_e8065858-a911-4f8a-b020-49c9b96d0381'</span></span></code> </pre> <br>  <b>bf_init_snapshot ('tmp / habr')</b> - a fun√ß√£o carrega os arquivos de configura√ß√£o no Batfish e os prepara para an√°lise. <br><br>  <b>/ tmp / habr</b> - um diret√≥rio com arquivos de configura√ß√£o do roteador. <br><br><pre> <code class="bash hljs">root@ea9a1559d88e:/tmp/habr<span class="hljs-comment"><span class="hljs-comment"># tree . `-- configs |-- AMS-CORE-01.cfg |-- HKI-CORE-01.cfg |-- LDN-CORE-01.cfg |-- MSK-CORE-01.cfg |-- SPB-CORE-01.cfg `-- STH-CORE-01.cfg 1 directory, 6 files</span></span></code> </pre> <br>  Agora vamos determinar o status das sess√µes BGP no roteador LDN-CORE-01: <br><br><pre> <code class="bash hljs">&gt;&gt;&gt; bgp_peers = bfq.bgpSessionStatus(nodes=<span class="hljs-string"><span class="hljs-string">'LDN-CORE-01'</span></span>).answer().frame() &gt;&gt;&gt; bgp_peers Node VRF Local_AS Local_IP Remote_AS Remote_Node Remote_IP Session_Type Est_Status 0 ldn-core-01 default 41214 172.20.20.1 41214 sth-core-01 172.20.20.2 IBGP EST 1 ldn-core-01 default 41214 172.20.20.1 41214 ams-core-01 172.20.20.3 IBGP EST 2 ldn-core-01 default 41214 172.20.20.1 41214 hki-core-01 172.20.20.4 IBGP EST</code> </pre><br>  Bem como?  Parece a verdade? <br><br><pre> <code class="bash hljs">LDN-CORE-01<span class="hljs-comment"><span class="hljs-comment">#show ip bgp summary ‚Ä¶ Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up/Down State/PfxRcd 172.20.20.2 4 41214 629 669 9 0 0 00:56:51 0 172.20.20.3 4 41214 826 827 9 0 0 01:10:18 0 172.20.20.4 4 41214 547 583 9 0 0 00:49:24 1</span></span></code> </pre><br>  Agora vamos ver quais rotas IS-IS est√£o no RIB no roteador HKI-CORE-01, de acordo com Batfish: <br><br><pre> <code class="bash hljs">&gt;&gt;&gt; isis_routes = bfq.routes(nodes=<span class="hljs-string"><span class="hljs-string">'HKI-CORE-01'</span></span>, protocols=<span class="hljs-string"><span class="hljs-string">'isis'</span></span>).answer().frame() &gt;&gt;&gt; isis_routes Node VRF Network Next_Hop Next_Hop_IP Protocol Admin_Distance Metric Tag 0 hki-core-01 default 172.20.20.3/32 ams-core-01 10.0.0.6 isisL2 18 20 None 1 hki-core-01 default 172.20.20.1/32 ams-core-01 10.0.0.6 isisL2 18 30 None 2 hki-core-01 default 172.20.20.2/32 sth-core-01 10.0.0.4 isisL2 18 10 None 3 hki-core-01 default 172.20.20.1/32 sth-core-01 10.0.0.4 isisL2 18 30 None 4 hki-core-01 default 10.0.0.0/31 sth-core-01 10.0.0.4 isisL2 18 20 None 5 hki-core-01 default 10.0.0.2/31 ams-core-01 10.0.0.6 isisL2 18 20 None</code> </pre><br>  Na linha de comando: <br><br><pre> <code class="bash hljs">showroute@HKI-CORE-01<span class="hljs-comment"><span class="hljs-comment"># run show route table inet.0 protocol isis inet.0: 18 destinations, 18 routes (18 active, 0 holddown, 0 hidden) + = Active Route, - = Last Active, * = Both 10.0.0.0/31 *[IS-IS/18] 00:51:25, metric 20 &gt; to 10.0.0.4 via ge-0/0/0.0 10.0.0.2/31 *[IS-IS/18] 00:51:45, metric 20 &gt; to 10.0.0.6 via ge-0/0/1.0 172.20.20.1/32 *[IS-IS/18] 00:51:25, metric 30 to 10.0.0.4 via ge-0/0/0.0 &gt; to 10.0.0.6 via ge-0/0/1.0 172.20.20.2/32 *[IS-IS/18] 00:51:25, metric 10 &gt; to 10.0.0.4 via ge-0/0/0.0 172.20.20.3/32 *[IS-IS/18] 00:51:45, metric 20 &gt; to 10.0.0.6 via ge-0/0/1.0</span></span></code> </pre><br>  √ìtimo!  Suponho que ficou mais claro para voc√™ que existe Batfish. <br><br>  No come√ßo do artigo, escrevi que o Batfish pode ser usado para verificar altera√ß√µes na configura√ß√£o antes de lev√°-las √† rede de "batalhas".  Agora, proponho considerar o processo de testar uma rede baseada no <b>RobotFramework</b> .  Para fazer isso, escrevi um pequeno m√≥dulo baseado no PyBatfish que permite executar as seguintes verifica√ß√µes: <br><br><ul><li>  Determinar o status das sess√µes BGP na rede </li><li>  Determinar o status de vizinho IS-IS </li><li>  Verifique a conectividade de ponta a ponta entre n√≥s em uma rede com demonstra√ß√£o de rastreamento </li><li>  Determine o tamanho do RIB no roteador para um protocolo de roteamento din√¢mico espec√≠fico </li></ul><br><div class="spoiler">  <b class="spoiler_title">LibraryBatfish.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logging <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pybatfish.client.commands <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bf_logger, bf_init_snapshot <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pybatfish.question.question <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_questions, list_questions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pybatfish.question <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bfq <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pybatfish.datamodel.flow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HeaderConstraints, PathConstraints <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> robot.api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logger <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LibraryBatfish</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, snapshot)</span></span></span><span class="hljs-function">:</span></span> bf_logger.setLevel(logging.ERROR) load_questions() bf_init_snapshot(snapshot) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_bgp_peers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> not_established_peers = list() bgp_peers = bfq.bgpSessionStatus().answer() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> peer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bgp_peers.rows: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> peer.get(<span class="hljs-string"><span class="hljs-string">'Established_Status'</span></span>) != <span class="hljs-string"><span class="hljs-string">'ESTABLISHED'</span></span>: not_established_peers.append(dict.fromkeys(peer.get(<span class="hljs-string"><span class="hljs-string">'Local_IP'</span></span>).split(), peer.get(<span class="hljs-string"><span class="hljs-string">'Remote_IP'</span></span>).get(<span class="hljs-string"><span class="hljs-string">'value'</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(not_established_peers) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: logger.warn(<span class="hljs-string"><span class="hljs-string">'BGP neighbors are not in an established state:'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> neighborship <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> not_established_peers: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> peer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> neighborship: logger.warn(<span class="hljs-string"><span class="hljs-string">'{} - {}'</span></span>.format(peer, neighborship.get(peer))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_routes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, node, protocol)</span></span></span><span class="hljs-function">:</span></span> routes = bfq.routes(nodes=node, protocols=protocol).answer() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> len(routes.rows) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_isis_neighbors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, description)</span></span></span><span class="hljs-function">:</span></span> not_isis_enabled_links = list() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> link <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self._get_isis_enabled_links(description): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> link <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self._get_isis_neighbors(): not_isis_enabled_links.append(link) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(not_isis_enabled_links) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> link <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> not_isis_enabled_links: logger.warn(<span class="hljs-string"><span class="hljs-string">'{} {} has no IS-IS neighbor'</span></span>.format(link.get(<span class="hljs-string"><span class="hljs-string">'hostname'</span></span>), link.get(<span class="hljs-string"><span class="hljs-string">'interface'</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, source_ip, destination_ip)</span></span></span><span class="hljs-function">:</span></span> ip_owners = bfq.ipOwners().answer() traceroute = self._get_traceroute_status(source_ip, destination_ip, ip_owners) reverse_traceroute = self._get_traceroute_status(destination_ip, source_ip, ip_owners) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> traceroute == <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> reverse_traceroute == <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: self._show_trace(source_ip, destination_ip, ip_owners) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: logger.warn(<span class="hljs-string"><span class="hljs-string">'Ping {} -&gt; {} failed'</span></span>.format(source_ip, destination_ip)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get_traceroute_status</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, source_ip, destination_ip, addresses)</span></span></span><span class="hljs-function">:</span></span> tracert = self._unidirectional_virtual_traceroute(source_ip, destination_ip, addresses) isAccepted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tracert != <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> trace <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tracert.rows[<span class="hljs-number"><span class="hljs-number">0</span></span>].get(<span class="hljs-string"><span class="hljs-string">'Traces'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> trace.get(<span class="hljs-string"><span class="hljs-string">'disposition'</span></span>) != <span class="hljs-string"><span class="hljs-string">'ACCEPTED'</span></span>: isAccepted = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isAccepted == <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get_paths</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, source_ip, destination_ip, addresses)</span></span></span><span class="hljs-function">:</span></span> tracert = self._unidirectional_virtual_traceroute(source_ip, destination_ip, addresses) traces = tracert.rows[<span class="hljs-number"><span class="hljs-number">0</span></span>].get(<span class="hljs-string"><span class="hljs-string">'Traces'</span></span>) paths = dict() path_number = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> trace <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> traces: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> trace.get(<span class="hljs-string"><span class="hljs-string">'disposition'</span></span>) == <span class="hljs-string"><span class="hljs-string">'ACCEPTED'</span></span>: path = list() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> hop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> trace.get(<span class="hljs-string"><span class="hljs-string">'hops'</span></span>): path.append(hop.get(<span class="hljs-string"><span class="hljs-string">'node'</span></span>).get(<span class="hljs-string"><span class="hljs-string">'name'</span></span>)) paths[path_number] = path path_number += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> paths <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_unidirectional_virtual_traceroute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, source_ip, destination_ip, addresses)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> address <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> addresses.rows: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> address.get(<span class="hljs-string"><span class="hljs-string">'IP'</span></span>) == source_ip: node = address.get(<span class="hljs-string"><span class="hljs-string">'Node'</span></span>).get(<span class="hljs-string"><span class="hljs-string">'name'</span></span>) int = address.get(<span class="hljs-string"><span class="hljs-string">'Interface'</span></span>) headers = HeaderConstraints(srcIps=source_ip, dstIps=destination_ip, ipProtocols=[<span class="hljs-string"><span class="hljs-string">'ICMP'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: tracert = bfq.traceroute(startLocation=<span class="hljs-string"><span class="hljs-string">"{}[{}]"</span></span>.format(node,int), headers=headers).answer() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tracert <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: logger.warn(<span class="hljs-string"><span class="hljs-string">'{} address has not been found'</span></span>.format(source_ip)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get_isis_enabled_links</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, description=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'core-link'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> isis_enabled_links = list() interfaces = bfq.interfaceProperties().answer() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> int <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> interfaces.rows: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int.get(<span class="hljs-string"><span class="hljs-string">'Description'</span></span>) != <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> description <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> int.get(<span class="hljs-string"><span class="hljs-string">'Description'</span></span>): isis_enabled_links.append({<span class="hljs-string"><span class="hljs-string">'hostname'</span></span> : int.get(<span class="hljs-string"><span class="hljs-string">'Interface'</span></span>).get(<span class="hljs-string"><span class="hljs-string">'hostname'</span></span>), <span class="hljs-string"><span class="hljs-string">'interface'</span></span> : int.get(<span class="hljs-string"><span class="hljs-string">'Interface'</span></span>).get(<span class="hljs-string"><span class="hljs-string">'interface'</span></span>)}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isis_enabled_links <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_get_isis_neighbors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> isis_neighbors = list() isis_adjacencies = bfq.edges(edgeType=<span class="hljs-string"><span class="hljs-string">'isis'</span></span>).answer() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> neighbor <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> isis_adjacencies.rows: isis_neighbors.append(neighbor.get(<span class="hljs-string"><span class="hljs-string">'Interface'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isis_neighbors <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_show_trace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, source_ip, destination_ip, addresses)</span></span></span><span class="hljs-function">:</span></span> logger.console(<span class="hljs-string"><span class="hljs-string">'\nTraceroute to {} from {}'</span></span>.format(destination_ip, source_ip)) paths = self._get_paths(source_ip, destination_ip, addresses) path_num = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> path <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> paths: n = <span class="hljs-number"><span class="hljs-number">1</span></span> logger.console(<span class="hljs-string"><span class="hljs-string">'\n Path N{}'</span></span>.format(path_num)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> hop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> paths.get(path): logger.console(<span class="hljs-string"><span class="hljs-string">' {} {}'</span></span>.format(n, hop)) n += <span class="hljs-number"><span class="hljs-number">1</span></span> path_num += <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">batfish-test.robot</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j8/fe/dt/j8fedtxnppjoyed3l4mkvgijmgw.png" alt="imagem"><br></div></div><br><h2>  Cen√°rio N1 </h2><br> <a href=""><img src="https://habrastorage.org/webt/oc/a6/xv/oca6xv1rrtbzkou8autoshzlfte.png"></a> <br><br>  Sob meu controle ainda √© a mesma rede.  Suponha que eu precise colocar os filtros na borda do <b>AS 41214</b> e do <b>AS 10631</b> e bloquear os pacotes de jun√ß√£o que cont√™m os endere√ßos IP de origem ou destino do intervalo BOGONS. <br><br>  Execute o teste antes de fazer altera√ß√µes. <br><br><img src="https://habrastorage.org/webt/83/7m/ev/837mevcx8y6uqg_ydag7giziw3y.png" alt="imagem"><br><br>  Testes aprovados. <br><br>  Faremos altera√ß√µes na configura√ß√£o de teste do roteador <b>HKI-CORE-01</b> - /tmp/habr/configs/HKI-CORE-01.cfg: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 0.0.0.0/8 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 10.0.0.0/8 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 100.64.0.0/10 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 127.0.0.0/8 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 169.254.0.0/16 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 172.16.0.0/12 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 192.0.2.0/24 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 192.88.99.0/24 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 192.168.0.0/16 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 198.18.0.0/15 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 198.51.100.0/24 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 203.0.113.0/24 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 224.0.0.0/4 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 from address 240.0.0.0/4 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM010 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> discard <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term PERMIT-IP-ANY-ANY <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> accept <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> interfaces ge-0/0/2.0 family inet filter input BOGONS <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> interfaces ge-0/0/2.0 family inet filter output BOGONS</code> </pre><br>  Execute o teste. <br><br><img src="https://habrastorage.org/webt/ef/y_/gn/efy_gnibn9qy2sbfxyiq_iysft0.png"><br><br>  Eu estava muito perto, mas como a sa√≠da de teste mostra, ap√≥s as altera√ß√µes feitas no BGP, o bairro 192.168.30.0 - 192.168.30.1 n√£o est√° no estado Estabelecido -&gt; como resultado, a conectividade IP entre os pontos 135.65.0.1 &lt;-&gt; 140.0.0.1 √© perdida.  O que est√° errado?  Observamos atentamente a configura√ß√£o do <b>HKI-CORE-01</b> e vemos que o peering do eBGP est√° instalado em endere√ßos privados: <br><br><pre> <code class="bash hljs">showroute@HKI-CORE-01<span class="hljs-comment"><span class="hljs-comment"># show interfaces ge-0/0/2 | display set set interfaces ge-0/0/2 description SPB-CORE-01 set interfaces ge-0/0/2 unit 0 family inet filter input BOGONS set interfaces ge-0/0/2 unit 0 family inet filter output BOGONS set interfaces ge-0/0/2 unit 0 family inet address 192.168.30.0/31</span></span></code> </pre><br>  Conclus√£o: √© necess√°rio alterar os endere√ßos na jun√ß√£o ou adicionar a sub-rede 192.168.30.0/31 √† exce√ß√£o. <br><br>  Adicionarei uma rede no cruzamento √† exce√ß√£o, atualizarei o /tmp/habr/configs/HKI-CORE-01.cfg novamente: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM005 from address 192.168.0.0/31 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> firewall family inet filter BOGONS term TERM005 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> accept</code> </pre><br>  Execute o teste. <br><br><img src="https://habrastorage.org/webt/83/7m/ev/837mevcx8y6uqg_ydag7giziw3y.png"><br><br>  Agora, o tr√°fego indesejado n√£o passar√° pela interface ebgp AS 41214 - AS 10631. √â poss√≠vel fazer altera√ß√µes com seguran√ßa, sem medo de consequ√™ncias. <br><br><h2>  Cen√°rio N2 </h2><br> <a href=""><img src="https://habrastorage.org/webt/zk/zy/aw/zkzyawxfphcnrmi2dsrd2xyz2ik.png"></a> <br><br>  Aqui eu preciso finalizar a rede 150.0.0.0/24 no roteador <b>MSK-CORE-01</b> e garantir a conectividade entre os pontos 135.65.0.1 e 150.0.0.1 <br><br>  Eu adiciono as seguintes linhas √† configura√ß√£o de teste do roteador MSK-CORE-01 - tmp / habr / configs / MSK-CORE-01.cfg: <br><br><pre> <code class="bash hljs">interface Loopback2 ip address 150.0.0.1 255.255.255.255 ! ip route 150.0.0.0 255.255.255.0 Null0 ! router bgp 10631 ! address-family ipv4 network 150.0.0.0 mask 255.255.255.0 !</code> </pre><br>  Eu mudo o script de teste e execute o teste: <br><br><pre> <code class="bash hljs">git diff HEAD~ diff --git a/batfish-robot.robot b/batfish-robot.robot index 8d963c5..ce8cb6a 100644 --- a/batfish-robot.robot +++ b/batfish-robot.robot @@ -5,7 +5,7 @@ Library LibraryBatfish.py tmp/habr <span class="hljs-variable"><span class="hljs-variable">${ISIS-ENABLED-LINK-DESCRIPTION}</span></span> ISIS-LINK <span class="hljs-variable"><span class="hljs-variable">${NODE}</span></span> HKI-CORE-01 <span class="hljs-variable"><span class="hljs-variable">${PROTOCOL}</span></span> ebgp -<span class="hljs-variable"><span class="hljs-variable">${RIB-SIZE}</span></span> 1 +<span class="hljs-variable"><span class="hljs-variable">${RIB-SIZE}</span></span> 2 *** Test Cases *** ISIS @@ -27,3 +27,8 @@ Ping [Documentation] Test end-to-end ICMP connectivity &amp; show traceroute <span class="hljs-variable"><span class="hljs-variable">${result}</span></span>= Ping 135.65.0.1 140.0.0.1 Should Be Equal As Integers <span class="hljs-variable"><span class="hljs-variable">${result}</span></span> 1 + +Ping2 + [Documentation] Test end-to-end ICMP connectivity &amp; show traceroute + <span class="hljs-variable"><span class="hljs-variable">${result}</span></span>= Ping 135.65.0.1 150.0.0.1 + Should Be Equal As Integers <span class="hljs-variable"><span class="hljs-variable">${result}</span></span> 1</code> </pre><br>  <i>Agora, espero ver duas rotas eBGP no roteador HKI-CORE-01, uma verifica√ß√£o de conectividade adicional √© adicionada</i> <br><br><img src="https://habrastorage.org/webt/0m/lo/1a/0mlo1aaedcfzwisajf7mz34mvai.png"><br><br>  N√£o h√° conex√£o entre 135.65.0.1 e 150.0.0.1, al√©m disso, no roteador <b>HKI-CORE-01, existe</b> apenas uma rota eBGP, em vez de duas. <br><br>  Verifique o conte√∫do do RIB no <b>HKI-CORE-01</b> ao adicionar uma nova configura√ß√£o ao roteador <b>MSK-CORE-01</b> : <br><br><pre> <code class="bash hljs">showroute@HKI-CORE-01<span class="hljs-comment"><span class="hljs-comment"># run show route table inet.0 protocol bgp inet.0: 20 destinations, 20 routes (19 active, 0 holddown, 1 hidden) + = Active Route, - = Last Active, * = Both 135.65.0.0/19 *[BGP/170] 02:25:38, MED 0, localpref 100, from 172.20.20.1 AS path: I, validation-state: unverified &gt; to 10.0.0.4 via ge-0/0/0.0 to 10.0.0.6 via ge-0/0/1.0 140.0.0.0/24 *[BGP/170] 01:38:02, localpref 100 AS path: 10631 I, validation-state: unverified &gt; to 192.168.30.1 via ge-0/0/2.0 showroute@HKI-CORE-01# run show route table inet.0 protocol bgp hidden detail inet.0: 20 destinations, 20 routes (19 active, 0 holddown, 1 hidden) 150.0.0.0/24 (1 entry, 0 announced) BGP /-101 Next hop type: Router, Next hop index: 563 Address: 0x940f43c Next-hop reference count: 4 Source: 192.168.30.1 Next hop: 192.168.30.1 via ge-0/0/2.0, selected Session Id: 0x9 State: &lt;Hidden Ext&gt; Local AS: 41214 Peer AS: 10631 Age: 1:42:03 Validation State: unverified Task: BGP_10631.192.168.30.1+179 AS path: 10631 I Localpref: 100 Router ID: 10.68.1.1 Hidden reason: rejected by import policy</span></span></code> </pre><br>  Observe a pol√≠tica de importa√ß√£o para os prefixos recebidos do <b>SPB-CORE-01</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> protocols bgp group AS10631 import FROM-AS10631 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> protocols bgp group AS10631 neighbor 192.168.30.1 description SPB-CORE-01 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> protocols bgp group AS10631 neighbor 192.168.30.1 peer-as 10631 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> policy-options policy-statement FROM-AS10631 term TERM010 from route-filter 140.0.0.0/24 exact <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> policy-options policy-statement FROM-AS10631 term TERM010 <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> accept <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> policy-options policy-statement FROM-AS10631 term DENY <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> reject</code> </pre><br>  A regra que permite 150.0.0.0/24 est√° ausente.  Adicione-o √† configura√ß√£o de teste e execute o teste: <br><br><pre> <code class="bash hljs">showroute@HKI-CORE-01<span class="hljs-comment"><span class="hljs-comment"># show | compare [edit policy-options policy-statement FROM-AS10631 term TERM010 from] route-filter 140.0.0.0/24 exact { ... } + route-filter 150.0.0.0/24 exact; [edit]</span></span></code> </pre><br><img src="https://habrastorage.org/webt/1j/yu/xk/1jyuxk-xbg4zvwcraua6o0p9hwm.png"><br><br>  √ìtimo, existe conectividade entre as redes, todos os testes foram aprovados!  Ent√£o voc√™ pode fazer essas altera√ß√µes no trabalho da rede "combate". <br><br><h2>  Conclus√£o </h2><br>  Na minha opini√£o, o Batfish √© uma ferramenta poderosa com enorme potencial.  Experimente e veja por si mesmo. <br><br>  Se este t√≥pico for interessante para voc√™ - participe do chat folgado, os desenvolvedores do Batfish ter√£o prazer em responder a quaisquer perguntas e rapidamente corrigir bugs. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">batfish-org.slack.com</a> <br><br>  Obrigado pela aten√ß√£o. <br><br><h2>  Refer√™ncias </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.batfish.org</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.youtube.com/channel/UCA-OUW_3IOt9U_s60KvmJYA</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/batfish/batfish</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">media.readthedocs.org/pdf/pybatfish/latest/pybatfish.pdf</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/showroute/batfish-habr</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441532/">https://habr.com/ru/post/pt441532/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441522/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel # 287 (18 de fevereiro a 24 de fevereiro)</a></li>
<li><a href="../pt441524/index.html">Novos resultados de estudo: transplante de medula √≥ssea pode retardar o envelhecimento</a></li>
<li><a href="../pt441526/index.html">Fatores do valor do Bitcoin</a></li>
<li><a href="../pt441528/index.html">Como minha vida se transformou em um livro de Kafka</a></li>
<li><a href="../pt441530/index.html">SDN ser√° lan√ßado no espa√ßo: por que isso √© necess√°rio</a></li>
<li><a href="../pt441534/index.html">Balanceadores de carga para sistemas de orquestra√ß√£o</a></li>
<li><a href="../pt441536/index.html">Variedades de SIMD</a></li>
<li><a href="../pt441538/index.html">Arquitetura de Data Warehouse: Tradicional e Cloud</a></li>
<li><a href="../pt441540/index.html">Vue mixins, a maneira expl√≠cita (por um exemplo de plugin de modificadores BEM)</a></li>
<li><a href="../pt441546/index.html">Hayabusa-2 "tocou o aster√≥ide pela primeira vez</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>