<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîü üöô üïë ¬øPor qu√© necesito soporte instrumental para la paginaci√≥n clave? üë®üèø‚Äçüè´ üéã üêç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Soy un desarrollador de backend, escribiendo microservicios en Java + Spring. Trabajo en uno de los equipos internos de desarrollo de pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øPor qu√© necesito soporte instrumental para la paginaci√≥n clave?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/485036/"><p>  Hola a todos!  Soy un desarrollador de backend, escribiendo microservicios en Java + Spring.  Trabajo en uno de los equipos internos de desarrollo de productos de Tinkoff. </p><br><p><img src="https://habrastorage.org/webt/u8/by/ai/u8byai9btfgtbvmupsjvgizvyra.png"></p><br><p>  Nuestro equipo a menudo plantea la cuesti√≥n de la optimizaci√≥n de consultas en el DBMS.  Siempre quieres un poco m√°s r√°pido, pero no siempre puedes sobrevivir con √≠ndices bien dise√±ados; tienes que buscar algunas soluciones.  Durante una de estas deambulaciones por la red en busca de optimizaciones razonables al trabajar con la base de datos, encontr√© el <a href="https://use-the-index-luke.com/">blog infinitamente √∫til de Marcus Vinand</a> , autor de SQL Performance Explained.  Este es el tipo muy raro de blog donde puedes leer todos los art√≠culos seguidos. </p><br><p>  Quiero traducirle un breve art√≠culo de Marcus.  Se puede llamar, en cierta medida, un manifiesto que busca llamar la atenci√≥n sobre el tema antiguo pero a√∫n relevante del rendimiento de la operaci√≥n de compensaci√≥n de acuerdo con el est√°ndar SQL. </p><a name="habracut"></a><br><p>  En algunos lugares, complementar√© al autor con explicaciones y comentarios.  Designar√© todos los lugares como "aprox." Para mayor claridad. </p><br><h3 id="nebolshoe-vvedenie">  Peque√±a introducci√≥n </h3><br><p>  Creo que muchas personas saben lo problem√°tico e inhibitorio que es trabajar con selecciones paginales a trav√©s de la compensaci√≥n.  ¬øPero sab√≠as que puede ser simplemente reemplazado por un dise√±o m√°s productivo? </p><br><p>  Entonces, la palabra clave offset le dice a la base de datos que omita las primeras n entradas en la solicitud.  Sin embargo, la base de datos todav√≠a tiene que leer estos primeros n registros del disco y en el orden especificado (nota: aplique la clasificaci√≥n si se especifica uno), y solo despu√©s de eso ser√° posible devolver registros a partir de n + 1 en adelante.  Lo m√°s interesante es que el problema no est√° en la implementaci√≥n concreta en el DBMS, sino en la definici√≥n inicial de acuerdo con el est√°ndar: </p><br><blockquote>  ... las filas se ordenan primero de acuerdo con la &lt;orden por cl√°usula&gt; y luego se limitan al soltar el n√∫mero de filas especificadas en la &lt;cl√°usula de compensaci√≥n de resultado&gt; desde el principio ... <br>  -SQL: 2016, Parte 2, 4.15.3 Tablas derivadas (nota: ahora el est√°ndar m√°s utilizado) </blockquote><p>  El punto clave aqu√≠ es que el desplazamiento toma un solo par√°metro: la cantidad de registros que se omiten, y eso es todo.  Siguiendo esta definici√≥n, un DBMS solo puede obtener todos los registros y luego descartar los innecesarios.  Obviamente, tal definici√≥n de desplazamiento te obliga a hacer un trabajo extra.  Y ni siquiera importa si es SQL o NoSQL. </p><br><h3 id="esche-nemnogo-boli">  Un poco mas de dolor </h3><br><p>  Los problemas de compensaci√≥n no terminan ah√≠, y aqu√≠ est√° el por qu√©.  Si otra operaci√≥n inserta un nuevo registro entre la lectura de dos p√°ginas de datos del disco, ¬øqu√© suceder√° en este caso? </p><br><p><img src="https://habrastorage.org/webt/lt/4y/qu/lt4yquxrhnlnnkrtgqdnuxlgfqc.png"></p><br><p>  Cuando se usa el desplazamiento para omitir registros de p√°ginas anteriores, en la situaci√≥n de agregar un nuevo registro entre las operaciones de lectura de diferentes p√°ginas, lo m√°s probable es que obtenga duplicados (nota: esto es posible cuando leemos p√°gina por p√°gina usando el orden por construcci√≥n, luego en el medio de nuestra salida puede obtener un nuevo registro). </p><br><p>  La figura representa claramente tal situaci√≥n.  La base lee los primeros 10 registros, despu√©s de lo cual se inserta un nuevo registro, que cambia todos los registros de lectura en 1. Luego, la base toma una nueva p√°gina de los siguientes 10 registros y comienza no desde el 11 como deber√≠a, sino desde el 10, duplicando este registro.  Hay otras anomal√≠as asociadas con el uso de esta expresi√≥n, pero esta es la m√°s com√∫n. </p><br><p>  Como ya hemos descubierto, estos no son problemas de un DBMS en particular o su implementaci√≥n.  El problema es la definici√≥n de paginaci√≥n seg√∫n el est√°ndar SQL.  Le decimos al DBMS qu√© p√°gina obtener o cu√°ntos registros omitir.  La base simplemente no puede optimizar dicha solicitud, ya que hay muy poca informaci√≥n para esto. </p><br><p> Tambi√©n vale la pena aclarar que este no es un problema espec√≠fico de palabras clave, sino m√°s bien la sem√°ntica de consultas.  Hay varias sintaxis que son id√©nticas en t√©rminos de problem√°tica: </p><br><ul><li>  La palabra clave offset, como se mencion√≥ anteriormente. </li><li>  La construcci√≥n de las dos palabras clave limit [offset] (aunque el l√≠mite en s√≠ mismo no es tan malo). </li><li>  Filtrado por l√≠mites inferiores seg√∫n la numeraci√≥n de l√≠nea (por ejemplo, row_number (), rownum, etc.). </li></ul><br><p>  Todas estas expresiones simplemente dicen cu√°ntas l√≠neas omitir, sin informaci√≥n adicional o contexto. </p><br><p>  M√°s adelante en este art√≠culo, la palabra clave offset se usa como una generalizaci√≥n de todas estas opciones. </p><br><h3 id="zhizn-bez-offset">  La vida sin una compensaci√≥n </h3><br><p>  Ahora imagine c√≥mo ser√≠a nuestro mundo sin todos estos problemas.  Resulta que la vida sin desplazamiento no es tan complicada: puede seleccionar solo aquellas l√≠neas que no hemos visto (nota: es decir, aquellas que no estaban en la √∫ltima p√°gina) usando la condici√≥n en d√≥nde. </p><br><p>  En este caso, nos basamos en el hecho de que las selecciones se ejecutan en un conjunto ordenado (buen orden anterior).  Como tenemos un conjunto ordenado, podemos usar un filtro bastante simple para obtener solo los datos que est√°n detr√°s del √∫ltimo registro de la p√°gina anterior: </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> &lt; ?last_seen_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FIRST</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ONLY</span></span></code> </pre> <br><p>  Ese es todo el principio de este enfoque.  Por supuesto, al ordenar por muchas columnas, todo se vuelve m√°s divertido, pero la idea es la misma.  Es importante tener en cuenta que esta construcci√≥n es aplicable a muchas soluciones <a href="https://docs.mongodb.com/manual/reference/method/cursor.skip/">N</a> <a href="https://developer.couchbase.com/documentation/server/5.0/n1ql/n1ql-language-reference/offset.html">o</a> <a href="http://orientdb.com/docs/last/Pagination.html">S</a> <a href="https://redis.io/commands/SORT">Q</a> <a href="https://lucene.apache.org/solr/guide/6_6/pagination-of-results.html">L.</a> </p><br><p>  Este enfoque se denomina m√©todo de b√∫squeda o paginaci√≥n de conjunto de claves.  Resuelve el problema con un resultado flotante (nota: la situaci√≥n con la escritura entre lecturas de p√°gina, descrita anteriormente) y, por supuesto, que todos amamos, funciona m√°s r√°pido y m√°s estable que el desplazamiento cl√°sico.  La estabilidad radica en el hecho de que el tiempo de procesamiento de la consulta no aumenta en proporci√≥n al n√∫mero de la tabla solicitada (nota: si desea obtener m√°s informaci√≥n sobre el trabajo de los diferentes enfoques de paginaci√≥n, puede <a href="https://use-the-index-luke.com/no-offset">consultar la presentaci√≥n del autor</a> . All√≠ tambi√©n puede encontrar puntos de referencia comparativos utilizando diferentes m√©todos). </p><br><p>  Una de las diapositivas <a href="https://www.slideshare.net/MarkusWinand/p2d2-pagination-done-the-postgresql-way/43">dice</a> que la paginaci√≥n de teclas, por supuesto, no es omnipotente: tiene sus propias limitaciones.  Lo m√°s significativo: no tiene la capacidad de leer p√°ginas aleatorias (nota: inconsistentemente).  Sin embargo, en la era del desplazamiento sin fin (nota: en el extremo frontal), este no es un problema.  En cualquier caso, especificar el n√∫mero de p√°gina para un clic es una mala decisi√≥n al desarrollar una interfaz de usuario (nota: opini√≥n del autor del art√≠culo). </p><br><h3 id="a-chto-s-instrumentami">  ¬øQu√© hay de las herramientas? </h3><br><p>  La paginaci√≥n clave a menudo no es adecuada debido a la falta de soporte instrumental para este m√©todo.  La mayor√≠a de las herramientas de desarrollo, incluidos varios marcos, no dan la opci√≥n de c√≥mo se realizar√° la paginaci√≥n. </p><br><p>  La situaci√≥n se ve agravada por el hecho de que el m√©todo descrito requiere soporte de extremo a extremo en las tecnolog√≠as utilizadas, desde el DBMS hasta la ejecuci√≥n de la solicitud AJAX en el navegador con desplazamiento sin fin.  En lugar de especificar solo el n√∫mero de p√°gina, ahora debe especificar el conjunto de claves para todas las p√°ginas a la vez. </p><br><p>  Sin embargo, el n√∫mero de marcos que admiten la paginaci√≥n clave est√° creciendo gradualmente.  Esto es lo que hay en este momento: </p><br><ul><li>  <a href="https://www.jooq.org/">jOOQ</a> para Java; </li><li>  <a href="https://github.com/glebm/order_query">order_query</a> para Ruby; </li><li>  <a href="https://github.com/peopledoc/django-chunkator">chunkator</a> y <a href="https://pypi.org/project/django-infinite-scroll-pagination/">Django Infinite Scroll Pagination</a> para Django; </li><li>  <a href="https://github.com/djrobstep/sqlakeyset">SQL Alchemy sqlakeyset</a> para Python; </li><li>  <a href="https://github.com/Blazebit/blaze-persistence">blaze-persistence</a> : API de criterios para implementaciones de JPA; </li><li>  <a href="https://metacpan.org/pod/DBIx::Class::Wrapper::Factory">DBIx :: Class :: Wrapper</a> para Perl; </li><li>  <a href="https://massivejs.org/">Massive.js</a> , un mapeador para Node.js <a href="https://massivejs.org/docs/options-objects">Keyset Documentation</a> . </li></ul><br><p>  (Nota: algunos enlaces se eliminaron debido al hecho de que en el momento de la traducci√≥n algunas bibliotecas no se actualizaron de 2017-2018. Si est√° interesado, puede consultar la fuente). </p><br><p>  Es en este momento que se necesita su ayuda.  Si est√° desarrollando o apoyando un marco que de alguna manera utiliza la paginaci√≥n, le pido, insto, le ruego que haga un soporte nativo para la paginaci√≥n clave.  Si tiene preguntas o necesita ayuda, con gusto lo ayudar√© ( <a href="https://ask.use-the-index-luke.com/">foro</a> , <a href="https://twitter.com/MarkusWinand">Twitter</a> , <a href="https://use-the-index-luke.com/contact">formulario de contacto</a> ) (nota: en mi experiencia con Marcus, puedo decir que est√° realmente entusiasmado con la difusi√≥n de este tema). </p><br><p>  Si utiliza soluciones preparadas que cree que son dignas de soporte para la paginaci√≥n de claves, cree una solicitud o incluso ofrezca una soluci√≥n preparada, si es posible.  Tambi√©n puede especificar este art√≠culo en el enlace. </p><br><h3 id="zaklyuchenie">  Conclusi√≥n </h3><br><p>  La raz√≥n por la cual un enfoque tan simple y √∫til como la paginaci√≥n clave no est√° generalizado no es que sea dif√≠cil en la implementaci√≥n t√©cnica o requiera un gran esfuerzo.  La raz√≥n principal es que muchos est√°n acostumbrados a ver y trabajar con desplazamiento: este enfoque est√° dictado por el est√°ndar mismo. </p><br><p>  Como resultado, pocas personas piensan en cambiar el enfoque de la paginaci√≥n, y debido a esto, el soporte instrumental de los marcos y las bibliotecas se est√° desarrollando deficientemente.  Por lo tanto, si est√° cerca de la idea y el objetivo de la paginaci√≥n sin complicaciones, ¬°ayude a difundirla! </p><br><p>  Fuente: <a href="https://use-the-index-luke.com/no-offset">https://use-the-index-luke.com/no-offset</a> <br>  Publicado por: Markus Winand </p></div></div><p>Source: <a href="https://habr.com/ru/post/485036/">https://habr.com/ru/post/485036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../485026/index.html">Oportunidades de Georgia para profesionales de TI</a></li>
<li><a href="../485028/index.html">CRM 2020</a></li>
<li><a href="../485030/index.html">Top 8 tarifas de IEO y su capitalizaci√≥n ahora</a></li>
<li><a href="../485032/index.html">C√≥mo hacer que una aplicaci√≥n React sea m√°s r√°pida con el cohospedaje estatal</a></li>
<li><a href="../485034/index.html">Automatizar la compilaci√≥n de un proyecto Qt en Windows en Travis CI</a></li>
<li><a href="../485042/index.html">Debido al soporte obligatorio 5G, los tel√©fonos inteligentes con Snapdragon 865 ser√°n peores en 2020</a></li>
<li><a href="../485044/index.html">Desmontamos el reloj digital de la nave espacial Soyuz</a></li>
<li><a href="../485046/index.html">C√≥mo planificar una estrategia de producto ganadora</a></li>
<li><a href="../485050/index.html">Hipercubo C√≥mo proporcionamos a los desarrolladores dispositivos de prueba y no los perdimos</a></li>
<li><a href="../485052/index.html">¬øQui√©n es un buen control de calidad?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>