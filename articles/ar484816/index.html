<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ด๐ฟ โ๏ธ ๐ ุงุณุชุฎุฏุงู ุนูููุงุช ุฑุจุท ุงููููุงุช ูููุณุฎ ุงูุงุญุชูุงุทู ุนูู ูุธุงู ุงูุชุดุบูู MacOS ุฃุซูุงุก ุงูุชููู ๐ โ๐ป ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ูุง ูุจุฑ! ุงุณูู ุฏูููุณ ููุจุฑูู ุ ูุฃุฑูุฏ ุงูููู ุฃู ุฃุชุญุฏุซ ุนู ููููุฉ ุญู ูุดููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ุนูุฏ ุงูุทูุจ ุนูู ูุธุงู ุงูุชุดุบูู MacOS. ูู ุงููุงูุน ุ ููุช ูููุฉ ุดููุฉ ู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงุณุชุฎุฏุงู ุนูููุงุช ุฑุจุท ุงููููุงุช ูููุณุฎ ุงูุงุญุชูุงุทู ุนูู ูุธุงู ุงูุชุดุบูู MacOS ุฃุซูุงุก ุงูุชููู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/484816/" style=";text-align:right;direction:rtl">  ูุฑุญุจุง ูุง ูุจุฑ!  ุงุณูู ุฏูููุณ ููุจุฑูู ุ ูุฃุฑูุฏ ุงูููู ุฃู ุฃุชุญุฏุซ ุนู ููููุฉ ุญู ูุดููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ุนูุฏ ุงูุทูุจ ุนูู ูุธุงู ุงูุชุดุบูู MacOS.  ูู ุงููุงูุน ุ ููุช ูููุฉ ุดููุฉ ูุงุฌูุชูุง ูู ุงููุนูุฏ ูู ุงูููุงูุฉ ุฅูู ูุดุฑูุน ุจุญุซู ูุจูุฑ ุญูู ุงูุนูู ูุน ูุธุงู ุงููููุงุช.  ูู ุงูุชูุงุตูู ุชุญุช ุงูุฎูุถ. <br><br> <a href="https://habr.com/ru/company/acronis/blog/484816/"><img src="https://habrastorage.org/getpro/habr/post_images/e81/10c/67b/e8110c67b5fe5edb2a8259a8a68fe632.jpg" alt="ุตูุฑุฉ"></a> <br><a name="habracut"></a><br>  ูู ุฃุจุฏุฃ ูู ุจุนูุฏ ุ ุฃุณุชุทูุน ููุท ุฃู ุฃููู ุฅู ูู ุดูุก ุจุฏุฃ ุจูุดุฑูุน ูู ูุนูุฏ ููุณูู ููููุฒูุงุก ูุงูุชูููููุฌูุง ุ ููุช ุจุชุทููุฑู ูุน ุงููุดุฑู ุงูุฎุงุต ุจู ูู ูุณู ูุงุนุฏุฉ ุฃูุฑูููุณ.  ููุฏ ูุงุฌููุง ูููุฉ ุชูุธูู ุชุฎุฒูู ุงููููุงุช ุนู ุจูุนุฏ ุ ุฃู ุจุงูุฃุญุฑู ุงูุญูุงุธ ุนูู ุงูุญุงูุฉ ุงูุญุงููุฉ ูููุณุฎ ุงูุงุญุชูุงุทูุฉ ุงูุฎุงุตุฉ ุจูุง. <br><br>  ูุถูุงู ุณูุงูุฉ ุงูุจูุงูุงุช ุ ูุณุชุฎุฏู ุงูุชุฏุงุฏ macOS kernel ุ ุงูุฐู ูุฌูุน ูุนูููุงุช ุญูู ุงูุฃุญุฏุงุซ ูู ุงููุธุงู.  ูุญุชูู KPI ูููุทูุฑูู ุนูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช KAUTH ุ ูุงูุชู ุชุชูุญ ูู ุชููู ุฅุนูุงูุงุช ุญูู ูุชุญ ูุฅุบูุงู ููู - ูุฐุง ูู ุดูุก.  ุฅุฐุง ููุช ุชุณุชุฎุฏู KAUTH ุ ูุฌุจ ุนููู ุญูุธ ุงูููู ุจุงููุงูู ุนูุฏ ูุชุญู ูููุชุงุจุฉ ุ ูุฃู ุฃุญุฏุงุซ ุงููุชุงุจุฉ ุฅูู ุงูููู ุบูุฑ ูุชููุฑุฉ ูููุทูุฑูู.  ูุฐู ุงููุนูููุงุช ูู ุชูู ูุงููุฉ ูููุงููุง.  ูู ุงููุงูุน ุ ูู ุฃุฌู ุงุณุชููุงู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูุจูุงูุงุช ุจุดูู ุฏุงุฆู ุ ูุฌุจ ุฃู ุชููู ุจุงูุถุจุท ุฃูู ูุงู ุงููุณุชุฎุฏู (ุฃู ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ :) ุจูุชุงุจุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุฅูู ุงูููู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d12/250/d5e/d12250d5e699b0841d0059eb5ba8846c.png" alt="ุตูุฑุฉ"><br><br>  ูููู ุฃู ูู ุงููุทูุฑูู ูุงููุง ุฎุงุฆููู ูู ูููุฏ ูุธุงู ุงูุชุดุบููุ  ุฅุฐุง ูู ุชุณูุญ ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช kernel ุจุงูุญุตูู ุนูู ูุนูููุงุช ุญูู ุนูููุงุช ุงููุชุงุจุฉ ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุงูุฎุฑูุฌ ุจุทุฑููุชู ุงูุฎุงุตุฉ ูู ุงูุงุนุชุฑุงุถ ูู ุฎูุงู ุฃุฏูุงุช kernel ุงูุฃุฎุฑู. <br><br>  ูู ุงูุจุฏุงูุฉ ุ ูู ููู ูุฑูุฏ ุชุตุญูุญ ุงูููุงุฉ ูููุงูููุง.  ุจุฏูุงู ูู ุฐูู ุ ุญุงูููุง ุฅูุดุงุก ูุญุฏุฉ ุชุฎุฒูู ุงูุชุฑุงุถูุฉ ูุงููุฉ ุชุณูุญ ููุง ุจุงุนุชุฑุงุถ ุฌููุน ุทูุจุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ ุงูุชู ุชูุฑ ุจูุง.  ูููู ุงุชุถุญ ุฃู ุฅุญุฏู ููุฒุงุช ูุธุงู ุงูุชุดุบูู MacOS ุบูุฑ ุงูุณุงุฑุฉ ูู: ุฃู ูุธุงู ุงูุชุดุบูู ูุนุชูุฏ ุฃูู ูุง ูุญุชูู ุนูู ูุญุฑู ุฃูุฑุงุต USB ูุงุญุฏ ุ ูููู ูุฏูู ูุฑุตุงู ุ ููุง ุฅูู ุฐูู.  ููู ุญูููุฉ ุฃู ูุญุฏุฉ ุงูุชุฎุฒูู ุงูุซุงููุฉ ุชุชุบูุฑ ุนูุฏ ุงูุนูู ูุน ุงูุฃูู ุ ูุจุฏุฃ ูุธุงู ุงูุชุดุบูู MacOS ุจุงูุนูู ุจุดูู ุบูุฑ ุตุญูุญ ูุน ูุญุฑูุงุช ุงูุฃูุฑุงุต.  ูุงูุช ููุงู ุงููุซูุฑ ูู ุงููุดุงูู ูู ูุฐู ุงูุทุฑููุฉ ูุฏุฑุฌุฉ ุฃููู ุงุถุทุฑุฑุช ุฅูู ุงูุชุฎูู ุนููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุจุญุซ ุนู ุญู ุขุฎุฑ </h3><br>  ุนูู ุงูุฑุบู ูู ุงููููุฏ ุงูููุฑูุถุฉ ุนูู KAUTH ุ ูุณูุญ ูู KPI ูุฐุง ุจุงูุฅุจูุงุบ ุนู ุงุณุชุฎุฏุงู ููู ููุชุณุฌูู ูุจู ุฌููุน ุงูุนูููุงุช.  ูุชู ููุญ ุงููุทูุฑูู ุญู ุงููุตูู ุฅูู ุชุฌุฑูุฏ ููู BSD ูู kernel - vnode.  ุงูุบุฑูุจ ุ ุงุชุถุญ ุฃู ุงูุชุฑููุน vnode ุฃุณูู ูู ุงุณุชุฎุฏุงู ุชุตููุฉ ูุญุฏุฉ ุงูุชุฎุฒูู.  ุชุญุชูู ุจููุฉ vnode ุนูู ุฌุฏูู ุงููุธุงุฆู ุงูุชู ุชููุฑ ุงูุนูู ูุน ุงููููุงุช ุงูุญููููุฉ.  ูุฐูู ุ ูุงู ูุฏููุง ููุฑุฉ ูุงุณุชุจุฏุงู ูุฐุง ุงูุฌุฏูู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b1/6c7/a9b/6b16c7a9b87a054f0ae5898d043aa91d.png" alt="ุตูุฑุฉ"><br><br>  ุชู ุงุนุชุจุงุฑ ุงูููุฑุฉ ุนูู ุงูููุฑ ููุฑุฉ ุฌูุฏุฉ ุ ูููู ูู ุงูุถุฑูุฑู ุชูููุฐูุง ููุนุซูุฑ ุนูู ุงูุฌุฏูู ูู ุจููุฉ vnode ุ ูุธุฑูุง ูุฃู Apple ูุง ุชูุซู ูููุนูุง ูู ุฃู ููุงู.  ููููุงู ุจุฐูู ุ ูุงู ูู ุงูุถุฑูุฑู ุฏุฑุงุณุฉ ุฑูุฒ ุงูุฌูุงุฒ ุงูุฎุงุต ุจุงูููุงุฉ ุ ููุฐูู ููุนุฑูุฉ ูุง ุฅุฐุง ูุงู ูู ุงููููู ุงููุชุงุจุฉ ุนูู ูุฐุง ุงูุนููุงู ุญุชู ูุง ูููุช ุงููุธุงู ุจุนุฏ ุฐูู. <br><br>  ุฅุฐุง ุชู ุงูุนุซูุฑ ุนูู ุงูุฌุฏูู ุ ููู ุจุจุณุงุทุฉ ุจูุณุฎู ูู ุงูุฐุงูุฑุฉ ุ ูุงุณุชุจุฏุงู ุงููุคุดุฑ ููุตู ุงูุฑุงุจุท ุฅูู ุงูุฌุฏูู ุงูุฌุฏูุฏ ูู vnode ุงูุญุงูู.  ุจูุถู ูุฐุง ุ ุณูุชู ุชุดุบูู ุฌููุน ุงูุนูููุงุช ูุน ุงููููุงุช ูู ุฎูุงู ุจุฑูุงูุฌ ุงูุชุดุบูู ุงูุฎุงุต ุจูุง ุ ูุณูู ูููู ูุงุฏุฑูู ุนูู ุชุณุฌูู ุฌููุน ุทูุจุงุช ุงููุณุชุฎุฏููู ุ ุจูุง ูู ุฐูู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ูุฐูู ุ ุฃุตุจุญ ุงูุจุญุซ ุนู ุงูุฌุฏูู ุงูุนุฒูุฒุฉ ูุฏููุง ุงูุฑุฆูุณู. <br><br>  ูุธุฑูุง ูุฃู Apple ูุง ุชุฑูุฏ ุฐูู ุญููุง ุ ูุญู ุงููุดููุฉ ุงูุชู ุชุญุชุงุฌ ุฅูููุง ููุญุงููุฉ "ุชุฎููู" ูููุน ุงูุฌุฏูู ุจุงุณุชุฎุฏุงู ุงูุงุณุชุฏูุงู ูููููุน ุงููุณุจู ููุญููู ุ ุฃู ุงูููุงู ุจูุธููุฉ ูุนุฑููุฉ ุจุงููุนู ุ ูุชูููููุง ูุงูุจุญุซ ุนู ุฅุฒุงุญุฉ ูู ูุฐู ุงููุนูููุงุช. <br><br>  <b>ููููุฉ ุงูุจุญุซ ุนู ุงูุฅุฒุงุญุฉ: ุทุฑููุฉ ุณููุฉ</b> <br><br>  ุฅู ุฃุจุณุท ุทุฑููุฉ ููุนุซูุฑ ุนูู ุฅุฒุงุญุงุช ุงูุฌุฏูู ูู vnode ูู ุฅุฑุดุงุฏู ูุณุชูุฏ ุฅูู ูููุน ุงูุญููู ูู ุจููุฉ ( <a href="">ุฑุงุจุท ุฅูู Github</a> ). <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vnode</span></span></span><span class="hljs-class"> {</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> (**v_op)(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *); <span class="hljs-comment"><span class="hljs-comment">/* vnode operations vector */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mount_t</span></span> v_mount; <span class="hljs-comment"><span class="hljs-comment">/* ptr to vfs we are in */</span></span> ... }</code> </pre> <br>  ุณูุณุชุฎุฏู ุงูุชุฑุงุถ ุฃู ุญูู v_op ุงูุฐู ูุญุชุงุฌ ุฅููู ูู ุฅุฒุงูุฉ 8 ุจุงูุชุงุช ุจุงูุถุจุท ูู v_mount.  ูููู ุงูุญุตูู ุนูู ูููุฉ ุงูุฃุฎูุฑ ุจุงุณุชุฎุฏุงู KPI ุงูุนุงู ( <a href="">ุฑุงุจุท ุฅูู ุฌูุซุจ</a> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">mount_t</span></span> vnode_mount(<span class="hljs-keyword"><span class="hljs-keyword">vnode_t</span></span> vp);</code> </pre><br>  ูุน ุงูุนูู ุจูููุฉ v_mount ุ ุณูุจุฏุฃ ูู ุงูุจุญุซ ุนู "ุฅุจุฑุฉ ูู ูููุฉ ูุด" - ุณูู ูุฏุฑู ูููุฉ ุงููุคุดุฑ ุฅูู vnode 'vp' ููุง uintptr_t ุ ููููุฉ vnode_mount (vp) ูู uintptr_t.  ูููู ุฐูู ุชูุฑุงุฑุงุช ูููููุฉ "ุงููุนูููุฉ" ูู i ุ ุญุชู ูุชู ุงูููุงุก ุจู "haystack [i] == needle".  ูุฅุฐุง ูุงู ุงูุงูุชุฑุงุถ ุญูู ูููุน ุงูุญููู ุตุญูุญูุง ุ ูุฅู ุงูุฅุฒุงุญุฉ v_op ูู i-1. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getVOPPtr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vnode_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> haystack = (<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>*) vp; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> needle = (<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>) vnode_mount(vp); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ATTEMPTCOUNT; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (haystack[i] == needle) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> haystack + (i - <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; }</code> </pre><br>  <b>ููููุฉ ุงูุจุญุซ ุนู ุฅุฒุงุญุฉ: ุชูููู</b> <br><br>  ุนูู ุงูุฑุบู ูู ุจุณุงุทุชู ุ ูุฅู ุงูุทุฑููุฉ ุงูุฃููู ููุง ุนูุจ ูุจูุฑ.  ุฅุฐุง ุบูุฑุช Apple ุชุฑุชูุจ ุงูุญููู ูู ุจููุฉ vnode ุ ูุณูู ุชููุทุน ุงูุทุฑููุฉ ุงูุจุณูุทุฉ.  ุทุฑููุฉ ุฃูุซุฑ ุนุงูููุฉ ุ ูููู ุฃูู ุชุงููุฉ ูู ูุชูููู ุงูููุงุฉ ุจุดูู ุญููู. <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ุถุน ูู ุงูุงุนุชุจุงุฑ ูุธููุฉ kernel ุงูููููุฉ VNOP_CREATE ( <a href="">ุฑุงุจุท ุฅูู Github</a> ) ุนูู ูุธุงู ุงูุชุดุบูู macOS 10.14.6.  ูุชู ุชุนููู ุงูุฅุฑุดุงุฏุงุช ุงูุชู ุชูููุง ุจุณูู -&gt;. <br><br> <code>_VNOP_CREATE: <br> 1 push rbp <br> 2 mov rbp, rsp <br> 3 push r15 <br> 4 push r14 <br> 5 push r13 <br> 6 push r12 <br> 7 push rbx <br> 8 sub rsp, 0x48 <br> 9 mov r15, r8 <br> 10 mov r12, rdx <br> 11 mov r13, rsi <br> -&gt; 12 mov rbx, rdi <br> 13 lea rax, qword [___stack_chk_guard] <br> 14 mov rax, qword [rax] <br> 15 mov qword [rbp+-48], rax <br> -&gt; 16 lea rax, qword [_vnop_create_desc] ; _vnop_create_desc <br> 17 mov qword [rbp+-112], rax <br> 18 mov qword [rbp+-104], rdi <br> 19 mov qword [rbp+-96], rsi <br> 20 mov qword [rbp+-88], rdx <br> 21 mov qword [rbp+-80], rcx <br> 22 mov qword [rbp+-72], r8 <br> -&gt; 23 mov rax, qword [rdi+0xd0] <br> -&gt; 24 movsxd rcx, dword [_vnop_create_desc] <br> 25 lea rdi, qword [rbp+-112] <br> -&gt; 26 call qword [rax+rcx*8] <br> 27 mov r14d, eax <br> 28 test eax, eax <br> โฆ.</code> <br> <pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">errno_t</span></span> VNOP_CREATE(<span class="hljs-keyword"><span class="hljs-keyword">vnode_t</span></span> dvp, <span class="hljs-keyword"><span class="hljs-keyword">vnode_t</span></span> * vpp, struct componentname * cnp, struct vnode_attr * vap, <span class="hljs-keyword"><span class="hljs-keyword">vfs_context_t</span></span> ctx) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _err; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vnop_create_args</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">;</span></span> a.a_desc = &amp;vnop;_create_desc; a.a_dvp = dvp; a.a_vpp = vpp; a.a_cnp = cnp; a.a_vap = vap; a.a_context = ctx; _err = (*dvp-&gt;v_op[vnop_create_desc.vdesc_offset])(&amp;a;); โฆ</code> </pre><br>  ุณูููู ุจูุณุญ ุฅุฑุดุงุฏุงุช ุงููุฌูุน ูุฅูุฌุงุฏ ุงูุชุญูู ูู vnode dvp.  "ุงูุบุฑุถ" ูู ุฑูุฒ ุงููุฌููุน ูู ุงุณุชุฏุนุงุก ุฏุงูุฉ ูู ุฌุฏูู v_op.  ููููุงู ุจุฐูู ุ ูุฌุจ ุฃู ูุชุจุน ุงููุนุงูุฌ ุงูุฎุทูุงุช ุงูุชุงููุฉ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญููู DVP ููุชุณุฌูู </li><li style=";text-align:right;direction:rtl">  ุฅูุบุงุก ุชุณุฌููู ููุญุตูู ุนูู v_op (ุงูุณุทุฑ 23) </li><li style=";text-align:right;direction:rtl">  ุงูุญุตูู ุนูู vnop_create_desc.vdesc_offset (ุงูุณุทุฑ 24) </li><li style=";text-align:right;direction:rtl">  ุงุณุชุฏุนุงุก ูุธููุฉ (ุฎุท 26) </li></ol><br>  ุฅุฐุง ูุงู ูู ุดูุก ูุงุถุญูุง ูู ุงูุฎุทูุงุช 2-4 ุ ูุณุชุธูุฑ ุตุนูุจุงุช ูู ุงูุฎุทูุฉ ุงูุฃููู.  ููู ูููู ุณุฌู dvp ุงูุฐู ุชู ุชุญููููุ  ููููุงู ุจุฐูู ุ ุงุณุชุฎุฏููุง ุทุฑููุฉ ููุญุงูุงุฉ ุฏุงูุฉ ุชุฑุงูุจ ุญุฑูุงุช ุงููุคุดุฑ ุงููุฑุบูุจ.  ููููุง ูุงุชูุงููุฉ ุงุณุชุฏุนุงุก ุงููุธุงู V x86_64 ุ ูุชู ุชูุฑูุฑ ุงููุณูุทุฉ ุงูุฃููู ูู ุณุฌู rdi.  ูุฐูู ุ ูุฑุฑูุง ุชุชุจุน ุฌููุน ุงูุณุฌูุงุช ุงูุชู ุชุญุชูู ุนูู rdi.  ูู ุงููุซุงู ุงูุฎุงุต ุจู ุ ูุฐู ูู ุณุฌูุงุช rbx ู rdi.  ุฃูุถูุง ุ ูููู ุญูุธ ูุณุฎุฉ ูู ุงูุณุฌู ุนูู ุงูููุฏุณ ุ ูุงูุชู ุชูุฌุฏ ูู ุฅุตุฏุงุฑ ุชุตุญูุญ ุงูุฃุฎุทุงุก ููููุงุฉ. <br><br>  ูุน ุงูุนูู ุฃู ุณุฌูุงุช rbx ู rdi ุชุฎุฒู dvp ุ ุงูุชุดููุง ูุฐุง ุงูุณุทุฑ 23 vnode ุงูููุถูู ููุญุตูู ุนููู v_op.  ูุฐูู ูุญู ููุชุฑุถ ุฃู ุงูุฅุฒุงุญุฉ ูู ุงููููู ูู 0xd0.  ูุชุฃููุฏ ุงููุฑุงุฑ ุงูุตุญูุญ ุ ููุงุตู ุงููุณุญ ูุงูุชุฃูุฏ ูู ุงุณุชุฏุนุงุก ุงููุธููุฉ ุจุดูู ุตุญูุญ (ุงูุฎุทุงู 24 ู 26). <br><br>  ูุฐู ุงูุทุฑููุฉ ุฃูุซุฑ ุฃูุงููุง ุ ูููู ูุณูุก ุงูุญุธ ุ ููุง ุฃูุถูุง ุนููุจ.  ูุฌุจ ุฃู ูุนุชูุฏ ุนูู ุญูููุฉ ุฃู ููุท ุงููุธููุฉ (ููู ุงูุฎุทูุงุช ุงูุฃุฑุจุน ุงูุชู ุชุญุฏุซูุง ุนููุง ุฃุนูุงู) ุณูููู ูู ููุณู.  ููุน ุฐูู ุ ูุฅู ุงุญุชูุงู ุชุบููุฑ ููุท ุงููุธููุฉ ูู ุชุฑุชูุจ ูู ุญูุซ ุงูุญุฌู ุฃูู ูู ุงุญุชูุงู ุชุบููุฑ ุชุฑุชูุจ ุงูุญููู.  ูุฐูู ูุฑุฑูุง ุงูุชููู ุนู ุงูุทุฑููุฉ ุงูุซุงููุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงุณุชุจุฏู ุงููุคุดุฑุงุช ูู ุงูุฌุฏูู </h3><br>  ุจุนุฏ ุฅูุฌุงุฏ v_op ุ ูุทุฑุญ ุงูุณุคุงู ุ ููู ูุณุชุฎุฏู ูุฐุง ุงููุคุดุฑุ  ููุงู ุทุฑููุชุงู ูุฎุชููุชุงู - ุงููุชุงุจุฉ ููู ุงููุธููุฉ ูู ุงูุฌุฏูู (ุงูุณูู ุงูุซุงูุซ ูู ุงูุตูุฑุฉ) ุฃู ุงููุชุงุจุฉ ููู ุงูุฌุฏูู ูู vnode (ุงูุณูู ุงูุซุงูู ูู ุงูุตูุฑุฉ). <br><br>  ูู ุงูุจุฏุงูุฉ ุ ูุจุฏู ุฃู ุงูุฎูุงุฑ ุงูุฃูู ุฃูุซุฑ ุฑุจุญูุฉ ุ ูุฃููุง ูุญุชุงุฌ ููุท ุฅูู ุงุณุชุจุฏุงู ูุคุดุฑ ูุงุญุฏ.  ููุน ุฐูู ุ ูุฅู ูุฐุง ุงูููุฌ ูู 2 ุนููุจ ูุจูุฑุฉ.  ุฃููุงู ุ ูููู ุงูุฌุฏูู v_op ูู ููุณู ุจุงููุณุจุฉ ููู vnode ููุธุงู ูููุงุช ูุนูู (v_op ูู HFS + ุ v_op ูู APFS ุ ...) ุ ูุฐูู ููุฒู ุงูุชุตููุฉ ุจูุงุณุทุฉ vnode ุ ูุงูุชู ูุฏ ุชููู ููููุฉ ููุบุงูุฉ - ุณูููู ุนููู ุชุตููุฉ vnode ุงูุฒุงุฆุฏ ุนูู ูู ุนูููุฉ ูุชุงุจุฉ.  ุซุงููุงู ุ ุงูุฌุฏูู ููุชูุจ ุนูู ุตูุญุฉ ูููุฑุงุกุฉ ููุท.  ูููู ุงูุชุญุงูู ุนูู ูุฐุง ุงูููุฏ ุฅุฐุง ููุช ุชุณุชุฎุฏู ุงูุชุณุฌูู ุนุจุฑ IOMappedWrite64 ุ ูุชุฌุงูุฒูุง ุงุฎุชุจุงุฑุงุช ุงููุธุงู.  ุฃูุถูุง ุ ุฅุฐุง ุชู ุดุญู kext ูุน ุจุฑูุงูุฌ ุชุดุบูู ูุธุงู ุงููููุงุช ุ ูุณูููู ูู ุงูุตุนุจ ูุนุฑูุฉ ููููุฉ ุฅุฒุงูุฉ ุงูุชุตุญูุญ. <br><br>  ุงูุฎูุงุฑ ุงูุซุงูู ุฃูุซุฑ ุงุณุชูุฏุงููุง ูุฃูุงููุง - ุณูุชู ุงุณุชุฏุนุงุก ุฃุฏุงุฉ ุงูุงุนุชุฑุงุถ ููุท ูู ุฃุฌู vnode ุงูุถุฑูุฑู ุ ูุชุชูุญ ุฐุงูุฑุฉ vnode ูู ุงูุจุฏุงูุฉ ุนูููุงุช ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ.  ูุธุฑูุง ูุฃูู ูุชู ุงุณุชุจุฏุงู ุงูุฌุฏูู ุจุฃูููู ุ ููู ุงูุถุฑูุฑู ุชุฎุตูุต ุฐุงูุฑุฉ ุฃูุซุฑ ููููุงู (80 ูุธููุฉ ุจุฏูุงู ูู ูุงุญุฏุฉ).  ููุธุฑูุง ูุฃู ุนุฏุฏ ุงูุฌุฏุงูู ูุณุงูู ุนุงุฏุฉู ุนุฏุฏ ุฃูุธูุฉ ุงููููุงุช ุ ูุฅู ุญุฏ ุงูุฐุงูุฑุฉ ูุง ููุงุฏ ูุฐูุฑ. <br><br>  ููุฐุง ุงูุณุจุจ ูุณุชุฎุฏู kext ุงูุทุฑููุฉ ุงูุซุงููุฉ ุ ุนูู ุงูุฑุบู ูู ุฃููู ุฃูุฑุฑ ูููููุฉ ุงูุฃููู ุฃู ูุฐุง ุงูุฎูุงุฑ ุฃุณูุฃ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f6/adc/957/0f6adc957cded9d732080d3f32cfa4d1.png" alt="ุตูุฑุฉ"><br><br>  ูุชูุฌุฉ ูุฐูู ุ ูุนูู ุณุงุฆููุง ุนูู ุงููุญู ุงูุชุงูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููุฑ KAUTH API vnode </li><li style=";text-align:right;direction:rtl">  ูุญู ุงุณุชุจุฏุงู ุงูุฌุฏูู vnode.  ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูุนุชุฑุถ ุงูุนูููุงุช ููุท ูู ุฃุฌู vnode "ุงููุซูุฑ ููุงูุชูุงู" ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุณุชูุฏุงุช ุงููุณุชุฎุฏู </li><li style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุงุนุชุฑุงุถ ุ ูุชุญูู ูู ุงูุนูููุฉ ุงูุชู ูุชู ุชุณุฌูููุง ุ ููููู ุจุชุตููุฉ "ูุฏููุง" </li><li style=";text-align:right;direction:rtl">  ูุฑุณู ุทูุจ UserSpace ูุชุฒุงูู ุฅูู ุงูุนููู ุ ุงูุฐู ููุฑุฑ ุจุงูุถุจุท ูุง ูุฌุจ ุญูุธู. </li></ol><br><h3 style=";text-align:right;direction:rtl">  ูุงุฐุง ุญุฏุซ </h3><br>  ูุฏููุง ุงูููู ูุญุฏุฉ ุชุฌุฑูุจูุฉ ุ ููู ุงูุชุฏุงุฏ ูููุงุฉ ูุงู ุฃู ุฅุณ ูุชุฑุงุนู ุฃู ุชุบููุฑุงุช ูู ูุธุงู ุงููููุงุช ุนูู ุงููุณุชูู ุงูุญุจูุจู.  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ูู ูุธุงู ุงูุชุดุบูู MacOS 10.15 ุ ูุฏูุช Apple ุฅุทุงุฑูุง ุฌุฏูุฏูุง ( <a href="https://developer.apple.com/documentation/endpointsecurity%3Flanguage%3Dobjc">ุฑุงุจุท ุฅูู EndpointSecurity</a> ) ูุชููู ุฅุฎุทุงุฑุงุช ุจุงูุชุบููุฑุงุช ุงูุชู ุชุทุฑุฃ ุนูู ูุธุงู ุงููููุงุช ุ ูุงูุชู ุชู ุงูุชุฎุทูุท ูุงุณุชุฎุฏุงููุง ูู Active Protection ุ ูุจุงูุชุงูู ุชู ุฅุนูุงู ุฅููุงู ุงูุญู ุงูููุถุญ ูู ุงูููุงูุฉ. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar484816/">https://habr.com/ru/post/ar484816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar484802/index.html">ูุถุน ุงูุชุฏููุฑ ุงูุฐุงุชู: ุชุญูู ุงููุจุณููุฉ ุจุงูููุธุงุฑ ุจุณุจุจ ุงูุถูุก</a></li>
<li><a href="../ar484804/index.html">ูุงุฐุง ุชุดููุฑ ูู ูุธุงู ุงูุดุฑูุงุชุ ูููุงุฐุง ูุฐุงุ</a></li>
<li><a href="../ar484806/index.html">ุงููุฑู ุจูู cPanel ู Plesk ุณุจุฌ</a></li>
<li><a href="../ar484812/index.html">ุชุฌุฑุจุชู ูุน ุจููุณู</a></li>
<li><a href="../ar484814/index.html">6. Fortinet ุจุฏุก ุงูุชุดุบูู v6.0. ุชุตููุฉ ุงูููุจ ูุงูุชุญูู ูู ุงูุชุทุจูู</a></li>
<li><a href="../ar484818/index.html">ูุชุงุจ "C ++. ููุงุฑุณุฉ ุงูุจุฑูุฌุฉ ูุชุนุฏุฏุฉ ูุคุดุฑุงุช ุงูุชุฑุงุจุท "</a></li>
<li><a href="../ar484820/index.html">FAQ.Net - ุจุฑูุงูุฌ ุชุฏููู ููุงุญุธุงุช ูุฌุงูู ููุธุงู Windows ูุน ุชุตููู ูุญุฏุซ</a></li>
<li><a href="../ar484822/index.html">Blazor: ููููุฉ ููุน ุฃุญุฏ ุงูููููุงุช ูู ุงููุฑุถ ุฃู ุทุฑููุชูู ููุตู ุงูุดูุฑุฉ ุนู ุงูุนูุงูุงุช</a></li>
<li><a href="../ar484824/index.html">ุงูุญุฑุจ ูุฅุทูุงุก ุงูุฃููุงุฑ</a></li>
<li><a href="../ar484826/index.html">ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุชูุงูู ุณูุก ุงูุทุจ ุฃูุซุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>