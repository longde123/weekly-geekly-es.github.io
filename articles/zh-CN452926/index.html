<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💜 🗼 🌨️ 静态测试或保存Private Ryan 🐬 🉑 🎻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="发行版通常会被忽视。 在他面前突然发现的任何错误都威胁着我们的时限，修复程序，工作到早晨以及紧张的时刻。 当这样的匆忙开始系统地发生时，我们意识到您已经不能再这样生活了。 决定开发一个全面的验证系统来挽救普通的Ryan开发人员Artyom，后者在晚上9点，10点或11点发布之前就回家了。 开发人员的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>静态测试或保存Private Ryan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/452926/"> 发行版通常会被忽视。 在他面前突然发现的任何错误都威胁着我们的时限，修复程序，工作到早晨以及紧张的时刻。 当这样的匆忙开始系统地发生时，我们意识到您已经不能再这样生活了。 决定开发一个全面的验证系统来挽救<s>普通的Ryan</s>开发人员Artyom，后者在晚上9点，10点或11点发布之前就回家了。 开发人员的想法是让开发人员找出错误，而更改尚未到达存储库，而他本人也没有丢失任务的上下文。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0c/050/6ad/e0c0506adfa607df0102904b82c0d96a.png"></div><br> 如今，首先在本地仔细检查所做的更改，然后在装配场进行一系列集成测试。 在本文中，我们将讨论验证的第一阶段-静态测试，它监视资源的正确性并分析代码。 这是链中的第一个子系统，它解决了发现的大部分错误。 <br><a name="habracut"></a><br><h2> 一切如何开始 </h2><br> 在发行前一周半的质量检查开始了手动检查发行前游戏的过程。 自然，需要尽快修复此阶段的错误。 <br><br> 由于缺乏时间来寻求一个好的解决方案，因此添加了一个临时的“拐杖”，该拐杖已经扎根很长时间，并被其他不太受欢迎的解决方案所包围。 <br><br> 首先，我们决定自动发现明显的错误：崩溃，无法完成游戏的主要操作（开设商店，进行购买，玩游戏）。 为此，游戏以特殊的自动游戏模式开始，如果出现问题，则在通过我们的农场测试后我们将立即知道。 <br><br> 但是测试人员和我们的自动烟雾测试都发现的大多数错误是缺少资源或不同系统的设置不正确。 因此，下一步是<i>静态测试</i> -在不启动应用程序的情况下检查资源的可用性，它们之间的关系和设置。 该系统是在装配场的另一步骤中启动的，大大简化了错误的查找和修复。 但是，如果即使在提交问题代码并将其放入存储库之前仍能检测到错误，为什么还要浪费汇编场的资源呢？ 这可以通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">precommit hooks</a>来<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">完成</a> ，它们在创建提交并将其发送到存储库之前刚刚启动。 <br><br> 是的，我们是如此的酷，以至于提交之前和在组装场上的静态测试都由一个代码执行，这大大简化了对它的支持。 <br><br> 我们的努力可以分为三个领域： <br><br><ul><li> 创建一个装配场-收集所有经过检查的物品的地方； </li><li> 开发静态测试-检查资源的正确性，它们之间的关系，启动代码分析器； </li><li> 开发运行时测试-以自动播放模式启动应用程序。 </li></ul><br> 另一个任务是组织开发人员在计算机上启动测试。 必须尽量减少本地执行时间（开发人员不必等待10分钟来提交一行），并确保进行更改的每个系统都安装了我们的系统。 <br><br><h2> 许多要求-一个系统 </h2><br> 在开发过程中，可以使用一整套程序集：带或不带作弊功能，beta或alpha版本，iOS或Android。 在每种情况下，可能需要不同的资源，设置甚至不同的代码。 为每个可能的组件编写用于静态测试的脚本会导致具有许多参数的复杂系统。 除了难以维护和修改之外，每个项目还具有自己的一套拐杖自行车。 <br><br> 通过反复试验，我们来到了一个系统，每个测试都可以考虑启动上下文，并决定是否运行它，确切地检查什么以及如何检查。 在测试开始时，我们确定了三个主要属性： <br><br><ul><li> 程序集的类型：对于发布和调试资源，检查的严格性，覆盖范围的完整性以及标识符的设置和可用功能的验证将有所不同； </li><li> 平台：适用于android的内容可能不适用于iOS，资源的收集方式也不同，并非android版本中的所有资源都将位于iOS中，反之亦然； </li><li> 启动位置：我们确切的启动位置-在需要所有可用测试的构建代理上，或在需要最小化启动列表的用户计算机上。 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e86/9b4/a61/e869b4a61b7f46ba9d545058baa4af5a.png"></div><br><h2> 静态测试系统 </h2><br> 系统的核心和基本的静态测试集是在python中实现的。 基础仅是少数几个实体： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d09/e44/1fd/d09e441fd62385fb616c3875cdc67a4d.png"></div><br>  <i>测试上下文</i>是一个广泛的概念。 它既存储了我们上面讨论过的build和launch参数，又存储了测试填充和使用的元信息。 <br><br> 首先，您需要了解要运行哪些测试。 为此，元信息包含我们对此发布特别感兴趣的资源类型。 资源类型由系统中注册的测试确定。 可以将一个测试与一个或多个类型“关联”，并且如果在提交时发现该测试检查的文件已更改，则关联的资源也已更改。 这很方便地适合我们的思想-在本地运行尽可能少的检查：如果负责测试的文件没有更改，则无需运行它。 <br><br> 例如，有一条鱼的描述，其中指示了3D模型和纹理，如果描述文件已更改，则检查其中所指示的模型和纹理是否存在。 在其他情况下，无需进行鱼检查。 <br><br> 另一方面，更改资源可能需要更改和依赖于它的实体：如果我们存储在xml文件中的纹理集已更改，则有必要检查其他3D模型，因为可能会发现您需要的纹理已被删除。 上述优化仅在提交时在用户计算机上本地应用，并且在组装场中启动时，假定所有文件均已更改，并且我们运行所有测试。 <br><br> 下一个问题是某些测试对其他测试的依赖：在找到所有纹理和模型之前不可能检查鱼。 因此，我们将所有执行分为两个阶段： <br><br><ul><li> 语境准备 </li><li> 检查 </li></ul><br> 在第一阶段，上下文中充满了有关找到的资源的信息（对于鱼，具有图案和纹理的标识符）。 在第二阶段，使用存储的信息，只需检查所需资源是否存在。 下面提供了简化的上下文。 <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationContext</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, app_path, build_type, platform, changed_files=None)</span></span></span><span class="hljs-function">:</span></span>       self.__app_path = app_path       self.__build_type = build_type       self.__platform = platform       <span class="hljs-comment"><span class="hljs-comment">#          self.__modified_resources = set()       self.__expected_resources = set()       #      ,              self.__changed_files = changed_files       # -  ,          self.__resources = {} def expect_resources(self, resources):   self.__expected_resources.update(resources) def is_resource_expected(self, resource):   return resource in self.__expected_resources def register_resource(self, resource_type, resource_id, resource_data=None):   self.__resources.setdefault(resource_type, {})[resource_id] = resource_data def get_resource(self, resource_type, resource_id):   if resource_type not in self.__resources or resource_id not in self.__resources[resource_type]:       return None, None   return resource_id, self.__resources[resource_type][resource_id]</span></span></code> </pre> <br> 确定了影响测试启动的所有参数后，我们设法将所有逻辑隐藏在基类中。 在特定的测试中，仅写测试本身和参数的必要值仍然是必要的。 <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, context, build_types=None, platforms=None, predicate=None,               expected_resources=None, modified_resources=None)</span></span></span><span class="hljs-function">:</span></span>      self.__name = name      self.__context = context      self.__build_types = build_types      self.__platforms = platforms      self.__predicate = predicate      self.__expected_resources = expected_resources      self.__modified_resources = modified_resources      <span class="hljs-comment"><span class="hljs-comment">#               #   ,          self.__need_run = self.__check_run()      self.__need_resource_run = False  @property  def context(self):      return self.__context  def fail(self, message):      print('Fail: {}'.format(message))  def __check_run(self):      build_success = self.__build_types is None or self.__context.build_type in self.__build_types      platform_success = self.__platforms is None or self.__context.platform in self.__platforms      hook_success = build_success      if build_success and self.__context.is_build('hook') and self.__predicate:          hook_success = any(self.__predicate(changed_file) for changed_file in self.__context.changed_files)      return build_success and platform_success and hook_success  def __set_context_resources(self):      if not self.__need_run:          return      if self.__modified_resources:          self.__context.modify_resources(self.__modified_resources)      if self.__expected_resources:          self.__context.expect_resources(self.__expected_resources)   def init(self):      """        ,                    ,          """      self.__need_resource_run = self.__modified_resources and any(self.__context.is_resource_expected(resource) for resource in self.__modified_resources)  def _prepare_impl(self):      pass  def prepare(self):      if not self.__need_run and not self.__need_resource_run:          return      self._prepare_impl()  def _run_impl(self):      pass  def run(self):      if self.__need_run:          self._run_impl()</span></span></code> </pre> <br> 回到鱼的例子，我们需要两个测试，一个测试找到纹理并将其注册到上下文中，另一个测试为找到的模型搜索纹理。 <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyTexture</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyTexture, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyTexture'</span></span>, context,                                          build_types=[<span class="hljs-string"><span class="hljs-string">'production'</span></span>, <span class="hljs-string"><span class="hljs-string">'hook'</span></span>],                                          platforms=[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span>],                                          expected_resources=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>,                                          modified_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                          predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.png'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_prepare_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      texture_dir = os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'textures'</span></span>)      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(texture_dir):          <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tex_file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files:              self.context.register_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, tex_file) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerifyModels</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TestCase)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, context)</span></span></span><span class="hljs-function">:</span></span>      super(VerifyModels, self).__init__(<span class="hljs-string"><span class="hljs-string">'VerifyModels'</span></span>, context,                                         expected_resources=[<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>],                                         predicate=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> file_path: os.path.splitext(file_path)[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'.obj'</span></span>)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_run_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      models_descriptions = etree.parse(os.path.join(self.context.app_path, <span class="hljs-string"><span class="hljs-string">'resources'</span></span>, <span class="hljs-string"><span class="hljs-string">'models.xml'</span></span>))      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> model_xml <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> models_descriptions.findall(<span class="hljs-string"><span class="hljs-string">'.//Model'</span></span>):          texture_id = model_xml.get(<span class="hljs-string"><span class="hljs-string">'texture'</span></span>)          texture = self.context.get_resource(<span class="hljs-string"><span class="hljs-string">'Texture'</span></span>, texture_id)          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> texture <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>:              self.fail(<span class="hljs-string"><span class="hljs-string">'Texture for model {} was not found: {}'</span></span>.format(model_xml.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>), texture_id))</code> </pre> <br><h2> 项目传播 </h2><br>  Playrix中的游戏开发是在其自己的引擎上进行的，因此，所有项目都使用相同的规则具有相似的文件结构和代码。 因此，有许多通用测试只能编写一次并在通用代码中。 项目足以更新测试系统的版本并将新的测试连接到其自身。 <br><br> 为了简化集成，我们编写了一个运行程序，该运行程序接收配置文件和设计测试（稍后将进行介绍）。 配置文件包含我们上面编写的基本信息：程序集的类型，平台，项目的路径。 <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runner</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span>  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config_str, setup_function)</span></span></span><span class="hljs-function">:</span></span>      self.__tests = []      config_parser = RawConfigParser()      config_parser.read_string(config_str)      app_path = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'app_path'</span></span>)      build_type = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'build_type'</span></span>)      platform = config_parser.get(<span class="hljs-string"><span class="hljs-string">'main'</span></span>, <span class="hljs-string"><span class="hljs-string">'platform'</span></span>)      <span class="hljs-string"><span class="hljs-string">'''      get_changed_files         CVS      '''</span></span>      changed_files = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> build_type != <span class="hljs-string"><span class="hljs-string">'hook'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> get_changed_files()      self.__context = VerificationContext(app_path, build_type, platform, changed_files)      setup_function(self)  @property  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.__context  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, test)</span></span></span><span class="hljs-function">:</span></span>      self.__tests.append(test)  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.init()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.prepare()      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.__tests:          test.run()</code> </pre> <br> 配置文件的优点在于，它可以在装配场中以自动模式为不同的装配生成。 但是通过此文件传递所有测试的设置可能不太方便。 为此，在项目存储库中存储了一个特殊的配置xml，并在其中写入了被忽略文件的列表，用于代码搜索的掩码等。 <br><br><div class="spoiler">  <b class="spoiler_title">配置文件示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">[main] app_path = {app_path} build_type = production platform = ios</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">调整xml示例</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">allow_utf8Bom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autofix_path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ci/autofix"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span>*android/tmp/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IgnoreFiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifySourceCodepage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NsStringConversion"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Checker</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LogConstructions"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VerifyCodeStructures</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br> 除了一般部分外，项目还有其自身的特点和差异；因此，有一些项目测试是通过运行程序的配置连接到系统的。 对于示例中的代码，只需几行就可以运行： <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(runner)</span></span></span><span class="hljs-function">:</span></span>  runner.add_test(VerifyTexture(runner.context))  runner.add_test(VerifyModels(runner.context)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span>  raw_config = <span class="hljs-string"><span class="hljs-string">'''  [main]  app_path = {app_path}  build_type = production  platform = ios  '''</span></span>  runner = Runner(raw_config, setup)  runner.run()</code> </pre> <br><h2> 收集耙 </h2><br> 尽管python本身是跨平台的，但我们经常遇到这样的问题，即用户拥有自己的独特环境，在这种环境中，他们可能没有我们期望的版本，多个版本或根本没有解释器。 结果，它不能按我们预期的那样工作或根本不工作。 有几个迭代可以解决此问题： <br><br><ol><li>  Python和所有软件包均由用户安装。 但是有两个“ buts”：并非所有用户都是程序员，并且通过pip install对设计人员进行安装，对于程序员也是如此。 </li><li> 有一个脚本可以安装所有必需的软件包。 这已经更好了，但是如果用户安装了错误的python，则工作中可能会发生冲突。 </li><li> 从工件存储（Nexus）提供正确的解释器版本和相关性，并在虚拟环境中运行测试。 </li></ol><br> 另一个问题是性能。 测试次数越多，在用户计算机上检查更改的时间越长。 每隔几个月就会对瓶颈进行概要分析和优化。 因此改善了上下文，出现了文本文件缓存，改进了谓词机制（确定此文件对于测试很有趣）。 <br><br> 然后剩下的只是解决如何在所有项目上实施该系统并迫使所有开发人员包括二手挂钩的问题，但这是一个完全不同的故事... <br><br><h2> 结论 </h2><br> 在开发过程中，我们在耙子上跳舞，奋力拼搏，但是仍然得到了一个系统，该系统可以使我们在提交期间发现错误，减少测试人员的工作，并且在发布纹理缺失之前的任务已经成为过去。 为了获得完全的幸福，简单的环境设置和单个测试的优化是不够的，但是来自ci部门的go在这方面努力工作。 <br><br> 在本文<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的存储库中</a>可以找到本文中用作示例的代码的完整示例。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN452926/">https://habr.com/ru/post/zh-CN452926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN452910/index.html">哈Ha！ 你好特康</a></li>
<li><a href="../zh-CN452914/index.html">面向微笑不怕实验的人，Scala上的ML面带微笑</a></li>
<li><a href="../zh-CN452916/index.html">起来吧 脊柱外科：什么时候做，有什么危险</a></li>
<li><a href="../zh-CN452922/index.html">灵活的CSS网格表</a></li>
<li><a href="../zh-CN452924/index.html">您需要采取什么措施来防止您的Google帐户被盗</a></li>
<li><a href="../zh-CN452928/index.html">我们从错误初始化的数据存储中还原虚拟机。 一个胡说八道的结局</a></li>
<li><a href="../zh-CN452938/index.html">3D打印机的喷枪又回来了，现在它们不再能停下来了</a></li>
<li><a href="../zh-CN452942/index.html">GeekBrains与编程专家举行12次免费在线会议</a></li>
<li><a href="../zh-CN452944/index.html">语言学家和数据分析专家的“对话”将是什么</a></li>
<li><a href="../zh-CN452946/index.html">重读Lou Greenaw的“ Windows 95 / NT编程哲学”</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>