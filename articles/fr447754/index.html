<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🏭 👩🏻‍🔬 🗯️ Application de barre de menus pour macOS 🗒️ 💊 🕑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les applications situées dans la barre de menus sont connues depuis longtemps des utilisateurs de macOS. Certaines de ces applications ont une partie ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Application de barre de menus pour macOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447754/"> Les applications situées dans la barre de menus sont connues depuis longtemps des utilisateurs de macOS.  Certaines de ces applications ont une partie «normale», d'autres se trouvent uniquement dans la barre de menus. <br>  Dans ce guide, vous allez écrire une application qui affiche plusieurs citations de personnes célèbres dans une fenêtre pop-up.  Au cours de la création de cette application, vous apprendrez: <br><br><ul><li>  attribuer une icône d'application dans la barre de menus </li><li>  faire l'application placée uniquement dans la barre de menu </li><li>  ajouter un menu personnalisé </li><li>  afficher une fenêtre contextuelle à la demande de l'utilisateur et la masquer si nécessaire, à l'aide de la <b>surveillance des événements</b> </li></ul><br><blockquote>  <b>Remarque:</b> ce guide suppose que vous connaissez bien Swift et macOS. </blockquote><a name="habracut"></a><br><h2>  Pour commencer </h2><br>  Lancez Xcode.  Ensuite, dans le menu <b>Fichier / Nouveau / Projet ...</b> , sélectionnez le modèle d' <b>application macOS / Application / Cocoa</b> et cliquez sur <b>Suivant</b> . <br><br>  Sur l'écran suivant, entrez Devis comme <b>nom de produit</b> , sélectionnez votre <b>nom d'</b> <b>organisation</b> et votre <b>identifiant d'organisation</b> .  Assurez-vous ensuite que Swift est sélectionné comme langue d'application et que la case <b>Utiliser les storyboards</b> est cochée.  Décochez les <b>cases</b> <b>Créer une application basée sur un document</b> , <b>Utiliser les données de base</b> , <b>Inclure les tests unitaires</b> et <b>Inclure les tests d'interface utilisateur</b> . <br><br><img src="https://habrastorage.org/webt/4c/_f/g6/4c_fg6hmxqq0k_vqkm8-zqrt_ok.png"><br><br>  Enfin, cliquez à nouveau sur <b>Suivant</b> , spécifiez l'emplacement où enregistrer le projet et cliquez sur <b>Créer</b> . <br>  Une fois le nouveau projet créé, ouvrez <b>AppDelegate.swift</b> et ajoutez la propriété suivante à la classe: <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusItem = <span class="hljs-type"><span class="hljs-type">NSStatusBar</span></span>.system.statusItem(withLength:<span class="hljs-type"><span class="hljs-type">NSStatusItem</span></span>.squareLength)</code> </pre> <br>  Ici, nous créons dans la barre de menu Élément d'état (icône d'application) une longueur fixe qui sera visible pour les utilisateurs. <br><br>  Ensuite, nous devons affecter notre image à ce nouvel élément dans la barre de menu afin de pouvoir distinguer notre nouvelle application. <br><br>  Dans le navigateur de projet, accédez à Assets.xcassets, <a href="">téléchargez une image</a> et faites-la glisser dans le catalogue d'actifs. <br><br>  Sélectionnez une image et ouvrez l'inspecteur d'attributs.  Modifiez l'option <b>Rendre en tant</b> qu'image de <b>modèle</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/wv/es/-o/wves-ouas8duyvk97fki1swuedk.png"></a> <br><br>  Si vous utilisez votre propre image, assurez-vous que l'image est en noir et blanc et configurez-la en tant <b>qu'image de modèle</b> afin que l'icône soit superbe à la fois dans la barre de menu sombre et claire. <br><br>  Revenez à <b>AppDelegate.swift</b> et ajoutez le code suivant à <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) }</code> </pre> <br>  Ici, nous attribuons l'icône d'application que nous venons d'ajouter à l'icône d'application et attribuons une <b>action</b> lorsque nous cliquons dessus. <br><br>  Ajoutez la méthode suivante à la classe: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteText = <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteAuthor = <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(quoteText) — \(quoteAuthor)"</span></span>) }</code> </pre> <br>  Cette méthode imprime simplement le devis sur la console. <br><br>  Faites attention à la <b>directive de</b> méthode <b>objc</b> .  Cela vous permet d'utiliser cette méthode en réponse à un clic sur un bouton. <br><br>  Générez et exécutez l'application, et vous verrez la nouvelle application dans la barre de menus.  Hourra! <br>  Chaque fois que vous cliquez sur l'icône dans la barre de menu, le célèbre dicton de Mark Twain s'affiche dans la console Xcode. <br><br><h2>  Nous masquons la fenêtre principale et l'icône dans le dock </h2><br>  Il y a quelques petites choses que nous devons faire avant de traiter directement avec la fonctionnalité: <br><br><ul><li>  supprimer l'icône du quai </li><li>  supprimer la fenêtre principale de l'application inutile </li></ul><br>  Pour supprimer l'icône du dock, ouvrez <b>Info.plist</b> .  Ajoutez une nouvelle clé <b>Application is agent (UIElement)</b> et définissez sa valeur sur <b>YES</b> . <br><br><img src="https://habrastorage.org/webt/-c/g_/pn/-cg_pnrysiiynfs2xfab8fyblhk.png"><br><br>  Il est maintenant temps de traiter avec la fenêtre principale de l'application. <br><br><ul><li>  ouvrir <b>Main.storyboard</b> </li><li>  sélectionnez la <b>scène du contrôleur de fenêtre</b> et supprimez-la </li><li>  <b>Voir la scène du contrôleur</b> quitter, nous l'utiliserons bientôt </li></ul><br><br> <a href=""><img src="https://habrastorage.org/webt/td/1q/vr/td1qvrwqe8qpgp2xvadbifvu_4o.png"></a> <br><br>  Générez et exécutez l'application.  Maintenant, l'application n'a pas à la fois la fenêtre principale et l'icône inutile dans le dock.  Super! <br><br><h2>  Ajouter un menu à l'élément d'état </h2><br>  Une réponse en un seul clic n'est clairement pas suffisante pour une application sérieuse.  La façon la plus simple d'ajouter des fonctionnalités consiste à ajouter un menu.  Ajoutez cette fonction à la fin d' <b>AppDelegate</b> . <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constructMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> menu = <span class="hljs-type"><span class="hljs-type">NSMenu</span></span>() menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Print Quote"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">AppDelegate</span></span>.printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"P"</span></span>)) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>.separator()) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Quit Quotes"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.terminate(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"q"</span></span>)) statusItem.menu = menu }</code> </pre> <br>  Et puis ajoutez cet appel à la fin de <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">constructMenu()</code> </pre> <br>  Nous créons <b>NSMenu</b> , y ajoutons 3 instances de <b>NSMenuItem</b> et définissons ce menu comme menu d'icônes d'application. <br><br>  Quelques points importants: <br><br><ul><li>  <b>Le titre</b> de l'élément de menu est le texte qui apparaît dans le menu.  Un bon endroit pour localiser l'application (si nécessaire). </li><li>  <b>l'action</b> , comme l' <b>action d'un</b> bouton ou d'un autre contrôle, est une méthode qui est appelée lorsque l'utilisateur clique sur un élément de menu </li><li>  <b>keyEquivalent</b> est un raccourci clavier que vous pouvez utiliser pour sélectionner un élément de menu.  Les caractères minuscules utilisent <b>Cmd</b> comme modificateur et les caractères minuscules utilisent <b>Cmd + Maj</b> .  Cela ne fonctionne que si l'application est tout en haut et est active.  Dans notre cas, il est nécessaire que le menu ou une autre fenêtre soit visible, car notre application n'a pas d'icône dans le dock </li><li>  <b>separatorItem</b> est un élément de menu inactif sous la forme d'une ligne grise entre d'autres éléments.  Utilisez-le pour regrouper </li><li>  <b>printQuote</b> est la méthode que vous avez déjà définie dans <b>AppDelegate</b> et <b>terminate</b> est la méthode définie par <b>NSApplication</b> . </li></ul><br>  Lancez l'application et vous verrez un menu en cliquant sur l'icône de l'application. <br><br><img src="https://habrastorage.org/webt/-w/2v/lv/-w2vlv2nfi_vxgosiihbqd19m5g.png"><br><br>  Essayez de cliquer sur le menu - sélectionner <b>Imprimer le devis</b> affiche le devis dans la console Xcode et <b>Quitter les devis</b> met fin à l'application. <br><br><h2>  Ajouter une popup </h2><br>  Vous avez vu à quel point il est facile d'ajouter un menu à partir du code, mais afficher un devis dans la console Xcode n'est clairement pas ce que les utilisateurs attendent de l'application.  Nous allons maintenant ajouter un simple contrôleur de vue pour afficher les devis de la bonne manière. <br><br>  Allez dans le menu <b>Fichier / Nouveau / Fichier ...</b> , sélectionnez le modèle de <b>classe macOS / Source / Cocoa</b> et cliquez sur <b>Suivant</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/m5/vd/7w/m5vd7wewsgjt16zajhbas3ca9mi.png"></a> <br><br><ul><li>  nommer la classe <b>QuotesViewController</b> </li><li>  faire un héritier de <b>NSViewController</b> </li><li>  assurez-vous que la case à cocher <b>Créer également un fichier XIB pour l'interface utilisateur n'est</b> pas cochée </li><li>  définir la langue sur Swift </li></ul><br>  Enfin, cliquez à nouveau sur <b>Suivant</b> , sélectionnez un emplacement pour enregistrer le fichier, puis cliquez sur <b>Créer</b> . <br>  Maintenant, ouvrez <b>Main.storyboard</b> .  Développez <b>View Controller Scene</b> et sélectionnez <b>View Controller instance</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/c4/dd/em/c4ddemmj9moxiu_whrzl7ilme_4.png"></a> <br><br>  Sélectionnez d'abord l' <b>inspecteur d'identité</b> et changez la classe en <b>QuotesViewController</b> , puis définissez l' <b>ID</b> du <b>storyboard</b> sur <b>QuotesViewController</b> <br><br>  Ajoutez maintenant le code suivant à la fin du fichier <b>QuotesViewController.swift</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuotesViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: Storyboard instantiation static func freshController() -&gt; QuotesViewController { //1. let storyboard = NSStoryboard(name: NSStoryboard.Name("Main"), bundle: nil) //2. let identifier = NSStoryboard.SceneIdentifier("QuotesViewController") //3. guard let viewcontroller = storyboard.instantiateController(withIdentifier: identifier) as? QuotesViewController else { fatalError("Why cant i find QuotesViewController? - Check Main.storyboard") } return viewcontroller } }</span></span></code> </pre> <br>  Que se passe-t-il ici: <br><br><ol><li>  nous obtenons un lien vers <b>Main.storyboard</b> . </li><li>  créer un <b>identifiant de scène</b> qui correspond à celui que nous venons d'installer juste au-dessus. </li><li>  créez une instance de <b>QuotesViewController</b> et renvoyez-la. </li></ol><br>  Vous créez cette méthode, donc maintenant, tous ceux qui utilisent le <b>QuotesViewController</b> n'ont pas besoin de savoir comment il est créé.  Ça marche juste. <br><br>  Notez le <b>fatalError</b> à l'intérieur de l'instruction <b>guard</b> .  Il peut être agréable de l'utiliser ou d' <b>assertionFailure de</b> sorte que si quelque chose se passe mal dans le développement, vous-même et les autres membres de l'équipe de développement soyez au courant. <br><br>  Revenons maintenant à <b>AppDelegate.swift</b> .  Ajoutez une nouvelle propriété. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> popover = <span class="hljs-type"><span class="hljs-type">NSPopover</span></span>()</code> </pre> <br>  Remplacez ensuite un <b>pplicationDidFinishLaunching (_ :) par le</b> code suivant: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationDidFinishLaunching</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aNotification: Notification)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(togglePopover(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) } popover.contentViewController = <span class="hljs-type"><span class="hljs-type">QuotesViewController</span></span>.freshController() }</code> </pre><br>  Vous avez modifié l'action de clic pour appeler la <b>méthode togglePopover (_ :)</b> , que nous écrirons un peu plus tard.  De plus, au lieu de configurer et d'ajouter un menu, nous avons configuré une fenêtre contextuelle qui affichera quelque chose de <b>QuotesViewController</b> . <br><br>  Ajoutez les trois méthodes suivantes à <b>AppDelegate</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">togglePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> popover.isShown { closePopover(sender: sender) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showPopover(sender: sender) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showPopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { popover.show(relativeTo: button.bounds, of: button, preferredEdge: <span class="hljs-type"><span class="hljs-type">NSRectEdge</span></span>.minY) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { popover.performClose(sender) }</code> </pre> <br>  <b>showPopover ()</b> affiche une fenêtre contextuelle.  Vous indiquez simplement d'où il vient, macOS le positionne et dessine une flèche, comme s'il apparaissait dans la barre de menus. <br><br>  <b>closePopover ()</b> ferme simplement la fenêtre contextuelle et <b>togglePopover ()</b> est une méthode qui affiche ou masque la fenêtre contextuelle, selon son état. <br><br>  Lancez l'application et cliquez sur son icône. <br><br><img src="https://habrastorage.org/webt/j6/gu/oq/j6guoqowcbou3xwtqr2cdunm4ns.png"><br><br>  Tout va bien, mais où est le contenu? <br><br><h2>  Nous implémentons Quote View Controller </h2><br>  Vous avez d'abord besoin d'un modèle pour stocker les citations et les attributs.  Allez dans le menu <b>Fichier / Nouveau / Fichier ...</b> et sélectionnez le <b>modèle de fichier macOS / Source / Swift</b> , puis <b>Suivant</b> .  Nommez le fichier <b>Quote</b> et cliquez sur <b>Créer</b> . <br><br>  Ouvrez le fichier <b>Quote.swift</b> et ajoutez-y le code suivant: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> author: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> all: [<span class="hljs-type"><span class="hljs-type">Quote</span></span>] = [ <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Efficiency is doing better what is already being done."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Peter Drucker"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"To infinity and beyond!"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Buzz Lightyear"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"May the Force be with you."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Han Solo"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Simplicity is the ultimate sophistication"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Leonardo da Vinci"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"It's not just what it looks like and feels like. Design is how it works."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Steve Jobs"</span></span>) ] } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomStringConvertible</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\"\(text)\" — \(author)"</span></span> } }</code> </pre> <br>  Ici, nous définissons une structure de devis simple et une propriété statique qui renvoie tous les devis.  Puisque nous avons rendu <b>Quote</b> compatible avec le protocole <b>CustomStringConvertible</b> , nous pouvons facilement obtenir du texte formaté de manière pratique. <br><br>  Il y a des progrès, mais nous avons encore besoin de contrôles pour afficher tout cela. <br><br><h2>  Ajouter des éléments d'interface </h2><br>  Ouvrez le tableau principal et retirez 3 boutons ( <b>bouton-</b> poussoir) et l'étiquette (étiquette <b>multiligne)</b> sur le contrôleur de vue. <br><br>  Positionnez les boutons et l'étiquette de manière à ce qu'ils ressemblent à ceci: <br><br><img src="https://habrastorage.org/webt/1v/ry/2_/1vry2_ydfrxoqiqdsklo2uouwne.png"><br><br>  Fixez le bouton gauche au bord gauche avec un écart de 20 et centrez verticalement. <br>  Fixez le bouton droit au bord droit avec un écart de 20 et centrez verticalement. <br>  Fixez le bouton inférieur au bord inférieur avec un espace de 20 et centrez horizontalement. <br>  Fixez les bords gauche et droit de la marque aux boutons avec un espace de 20, centrez verticalement. <br><br> <a href=""><img src="https://habrastorage.org/webt/jl/zi/tl/jlzitledfqmcexzv636ya6ir6sq.png"></a> <br><br>  Vous verrez plusieurs erreurs de mise en page, car il n'y a pas suffisamment d'informations pour que <b>la mise</b> en <b>page automatique</b> puisse le comprendre. <br><br>  Définissez la <b>Priorité d'étirement du contenu horizontal</b> sur 249 pour permettre à l'étiquette de se redimensionner. <br><br> <a href=""><img src="https://habrastorage.org/webt/a6/qp/s0/a6qps0r2_vobhsjkbcfiqohklgc.png"></a> <br><br>  Procédez maintenant comme suit: <br><br><ul><li>  définissez l' <b>image du</b> bouton gauche sur <b>NSGoLeftTemplate</b> et effacez le <b>titre</b> </li><li>  définissez l' <b>image du</b> bouton droit sur <b>NSGoRightTemplate</b> et effacez le <b>titre</b> </li><li>  définissez le <b>titre du</b> bouton ci-dessous sur <b>Quitter les devis</b> . </li><li>  définissez l' <b>alignement du texte de</b> l'étiquette au centre. </li><li>  vérifiez que le <b>saut de ligne</b> sur l'étiquette est défini sur <b>Retour à la ligne</b> . </li></ul><br><br>  Ouvrez maintenant <b>QuotesViewController.swift</b> et ajoutez le code suivant à l'implémentation de la classe <b>QuotesViewController</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textLabel: <span class="hljs-type"><span class="hljs-type">NSTextField!</span></span></code> </pre> <br><br>  Ajoutez cette extension à l'implémentation de classe.  Maintenant, dans <b>QuotesViewController.swift, il y a</b> deux extensions de classe. <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: Actions extension QuotesViewController { @IBAction func previous(_ sender: NSButton) { } @IBAction func next(_ sender: NSButton) { } @IBAction func quit(_ sender: NSButton) { } }</span></span></code> </pre> <br>  Nous venons d'ajouter une <b>sortie</b> pour l'étiquette que nous utiliserons pour afficher les citations et 3 méthodes de stub que nous connecterons avec les boutons. <br><br><h2>  Connexion du code avec Interface Builder </h2><br>  Remarque: Xcode a placé des cercles à gauche de votre code - à côté des mots clés <b>IBAction</b> et <b>IBOutlet</b> . <br><br><img src="https://habrastorage.org/webt/kv/48/k_/kv48k_pvgucw0v1jexqsna44dda.png"><br><br>  Nous les utiliserons pour connecter le code à l'interface utilisateur. <br><br>  Tout en maintenant la touche <b>alt</b> enfoncée, cliquez sur <b>Main.storyboard</b> dans le <b>navigateur de projet</b> .  Ainsi, le <b>storyboard</b> s'ouvre dans l' <b>Assistant Editor</b> à droite et le code à gauche. <br><br>  Faites glisser le cercle à gauche de <b>textLabel</b> sur l'étiquette dans le <b>générateur d'interface</b> .  De la même manière, combinez les méthodes <b>précédente</b> , <b>suivante</b> et <b>quitter</b> avec les boutons gauche, droit et bas, respectivement. <br><br> <a href=""><img src="https://habrastorage.org/webt/7-/qu/yb/7-quybzu1bexw545popvn_mbeea.png"></a> <br><br>  Lancez votre application. <br><br><img src="https://habrastorage.org/webt/tr/b2/6w/trb26wseu6kdpeyqyjdbeojwoxu.png"><br><br>  Nous avons utilisé la taille du popup par défaut.  Si vous voulez un popup plus grand ou plus petit, redimensionnez-le simplement dans le <b>storyboard</b> . <br><br><h2>  Écrire un code pour les boutons </h2><br>  Si vous n'avez pas déjà masqué l' <b>Editeur Assistant</b> , cliquez sur <b>Cmd-Retour</b> ou <b>Vue&gt; Editeur standard&gt; Afficher l'éditeur standard</b> <br><br>  Ouvrez <b>QuotesViewController.swift</b> et ajoutez les propriétés suivantes à l'implémentation de classe: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quotes = <span class="hljs-type"><span class="hljs-type">Quote</span></span>.all <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentQuoteIndex: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">didSet</span></span> { updateQuote() } }</code> </pre> <br>  La propriété <b>quotes</b> contient toutes les citations et <b>currentQuoteIndex</b> est l'index de la citation actuellement affichée.  <b>CurrentQuoteIndex</b> possède également un <b>observateur de propriétés</b> pour mettre à jour le contenu de l'étiquette avec un nouveau devis lorsque l'index change. <br><br>  Ajoutez maintenant les méthodes suivantes: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() currentQuoteIndex = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { textLabel.stringValue = <span class="hljs-type"><span class="hljs-type">String</span></span>(describing: quotes[currentQuoteIndex]) }</code> </pre> <br>  Lorsque la vue se charge, nous définissons l'index des devis à 0, ce qui entraîne une mise à jour de l'interface.  <b>updateQuote ()</b> met simplement à jour l'étiquette de texte pour afficher un devis.  <b>currentQuoteIndex</b> correspondant. <br><br>  Enfin, mettez à jour ces méthodes avec le code suivant: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">previous</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex - <span class="hljs-number"><span class="hljs-number">1</span></span> + quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.shared.terminate(sender) }</code> </pre> <br>  Les méthodes <b>next ()</b> et <b>previous ()</b> parcourent toutes les citations.  <b>quitter</b> ferme l'application. <br><br>  Lancez l'application: <br><br><img src="https://habrastorage.org/webt/wi/qh/ju/wiqhjuzkw5c8f7bmtofythu147k.png"><br><br><h2>  Suivi des événements </h2><br>  Il y a encore une chose que les utilisateurs attendent de notre application: masquer la fenêtre contextuelle lorsque l'utilisateur clique quelque part en dehors de celle-ci.  Pour ce faire, nous avons besoin d'un mécanisme appelé <b>moniteur d'événements global macOS</b> . <br><br>  Créez un nouveau fichier Swift, appelez-le <b>EventMonitor</b> et remplacez son contenu par le code suivant: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Cocoa public class EventMonitor { private var monitor: Any? private let mask: NSEvent.EventTypeMask private let handler: (NSEvent?) -&gt; Void public init(mask: NSEvent.EventTypeMask, handler: @escaping (NSEvent?) -&gt; Void) { self.mask = mask self.handler = handler } deinit { stop() } public func start() { monitor = NSEvent.addGlobalMonitorForEvents(matching: mask, handler: handler) } public func stop() { if monitor != nil { NSEvent.removeMonitor(monitor!) monitor = nil } } }</code> </pre> <br>  Lors de l'initialisation d'une instance de cette classe, nous lui transmettons un masque d'événement que nous écouterons (comme les frappes de touches, les molettes de la souris, etc.) et un gestionnaire d'événements. <br>  Lorsque nous sommes prêts à commencer à écouter, <b>start ()</b> appelle <b>addGlobalMonitorForEventsMatchingMask (_: handler :)</b> , qui renvoie l'objet que nous enregistrons.  Dès que l'événement contenu dans le masque se produit, le système appelle votre gestionnaire. <br><br>  Pour arrêter la surveillance des événements, <b>removeMonitor</b> <b>()</b> est appelé dans <b>stop ()</b> et nous supprimons l'objet en le <b>définissant</b> sur nil. <br><br>  Il ne nous reste plus qu'à appeler <b>start ()</b> et <b>stop ()</b> au bon moment.  La classe appelle également <b>stop ()</b> sur le deinitializer pour nettoyer. <br><br><h2>  Connexion du moniteur d'événements </h2><br>  Ouvrez <b>AppDelegate.swift une</b> dernière fois et ajoutez une nouvelle propriété: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventMonitor: <span class="hljs-type"><span class="hljs-type">EventMonitor?</span></span></code> </pre> <br>  Ajoutez ensuite ce code pour configurer le <b>moniteur d'événements</b> à la fin de <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">eventMonitor = <span class="hljs-type"><span class="hljs-type">EventMonitor</span></span>(mask: [.leftMouseDown, .rightMouseDown]) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> strongSelf = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, strongSelf.popover.isShown { strongSelf.closePopover(sender: event) } }</code> </pre> <br>  Cela informera votre application lorsque vous cliquez sur le bouton gauche ou droit.  Veuillez noter: le gestionnaire ne sera pas appelé en réponse aux clics de souris dans votre application.  C'est pourquoi la fenêtre contextuelle ne se fermera pas lorsque vous cliquez à l'intérieur. <br><br>  Nous utilisons une référence <b>faible</b> à <b>soi</b> pour éviter le danger d'un cycle de liens solides entre <b>AppDelegate</b> et <b>EventMonitor</b> . <br><br>  Ajoutez le code suivant à la fin de la <b>méthode showPopover (_ :)</b> : <br><br><pre> <code class="swift hljs">eventMonitor?.start()</code> </pre><br>  Ici, nous commençons à surveiller les événements lorsqu'une fenêtre contextuelle apparaît. <br><br>  Ajoutez maintenant le code à la fin de la <b>méthode closePopover (_ :)</b> : <br><br><pre> <code class="swift hljs">eventMonitor?.stop()</code> </pre><br>  Ici, nous terminons la surveillance lorsque le popup se ferme. <br><br>  L'application est prête! <br><br><h2>  Conclusion </h2><br>  Vous trouverez ici le code complet de ce projet. <br><br>  Vous avez appris à configurer le menu et la fenêtre contextuelle dans l'application située dans la barre de menus.  Pourquoi ne pas essayer plusieurs balises ou du texte formaté pour mieux voir les citations?  Ou connectez-vous à un backend pour recevoir des devis d'Internet?  Ou voulez-vous utiliser le clavier pour naviguer entre les guillemets? <br><br>  Un bon endroit pour rechercher est la documentation officielle: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NSMenu</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NSPopover</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NSStatusItem</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447754/">https://habr.com/ru/post/fr447754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447736/index.html">Vidéo drone - une nouvelle tendance dans les réseaux sociaux</a></li>
<li><a href="../fr447738/index.html">Julian Assange arrêté par la police britannique</a></li>
<li><a href="../fr447742/index.html">Quelle est la méthodologie DevOps et qui en a besoin</a></li>
<li><a href="../fr447744/index.html">Escalade d'Elbrus - Reconnaissance au combat. Partie technique 2. Interruptions, exceptions, minuterie système</a></li>
<li><a href="../fr447748/index.html">Systèmes de fichiers virtuels Linux: pourquoi sont-ils nécessaires et comment fonctionnent-ils? 2e partie</a></li>
<li><a href="../fr447756/index.html">Nouveau quadrant Gartner pour les solutions de surveillance des applications (APM)</a></li>
<li><a href="../fr447784/index.html">Musique le jour de la cosmonautique</a></li>
<li><a href="../fr447786/index.html">Contexte: Robot Fedor, qu'êtes-vous?</a></li>
<li><a href="../fr447788/index.html">Nous avons créé un agrégateur de nouvelles axé sur les crypto-monnaies - intwt.com</a></li>
<li><a href="../fr447790/index.html">Apprendre à écrire des contrats intelligents Waves sur RIDE et RIDE4DAPPS. Partie 1 (Portefeuille multi-utilisateur)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>