<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõµ üö• ‚ìÇÔ∏è So erstellen Sie eine Augmented Reality-Anwendung mit ARCore üöñ üë¶üèº üï∏Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Handbuch erfahren Sie, wie Sie der realen Welt 3D-Modelle hinzuf√ºgen. Mit der ARCore-Bibliothek von Google k√∂nnen Sie einem 2D-Bild (Bild od...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So erstellen Sie eine Augmented Reality-Anwendung mit ARCore</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439190/"><p><img src="https://habrastorage.org/getpro/habr/post_images/6a4/10f/e17/6a410fe175b5770acae9802ef64b4ced.jpg" alt="So erstellen Sie eine Augmented Reality-Anwendung mit ARCore"></p><br><p>  In diesem Handbuch erfahren Sie, wie Sie der realen Welt 3D-Modelle hinzuf√ºgen.  Mit der ARCore-Bibliothek von Google k√∂nnen Sie einem 2D-Bild (Bild oder Video) vollst√§ndige 3D-Modelle hinzuf√ºgen. </p><br><p>  Sie m√ºssen dem System eine Art Referenzbild zur Verf√ºgung stellen, nach dem ARCore in der realen Welt sucht, um dem darauf basierenden Bild ein 3D-Modell hinzuzuf√ºgen.  Augmented Reality ist beispielsweise in B√ºchern, Zeitungen, Zeitschriften usw. bereits weit verbreitet. </p><a name="habracut"></a><br><p> Bevor Sie in dieses Tutorial eintauchen, sollten Sie sich mit den beiden vorherigen Artikeln zu diesem Thema vertraut machen, in denen Sie die grundlegenden AR-Begriffe kennenlernen: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Was ist ARCore?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Alles was Sie wissen m√ºssen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellen Ihrer ersten ARCore-Anwendung</a> </li></ul><br><h2 id="chto-takoe-izobrazheniya-dopolnennoy-realnosti">  Was sind Augmented Reality-Bilder? </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Laut der Dokumentation f√ºr Entwickler</a> k√∂nnen Sie mit Augmented Reality-Bildern in ARCore Augmented Reality-Anwendungen erstellen, mit denen 2D-Bilder wie Poster oder Produktverpackungen ‚Äûanimiert‚Äú werden k√∂nnen. </p><br><p>  Sie laden einige Referenzbilder in ARCore hoch und erfahren dann, wie sie w√§hrend der AR-Sitzung erkannt werden, z. B. beim Aufnehmen eines Videos.  Diese Informationen werden verwendet, um das 3D-Modell auf einem 2D-Bild zu positionieren. </p><br><h2 id="ogranicheniya-ispolzovaniya-izobrazheniy-dopolnennoy-realnosti">  Einschr√§nkungen bei der Verwendung von Augmented Reality-Bildern </h2><br><p>  Im Folgenden sind einige der Einschr√§nkungen aufgef√ºhrt, die bei der Verwendung von Augmented-Reality-Bildern auftreten k√∂nnen: </p><br><ul><li>  ARCore kann nur bis zu 20 Referenzbilder gleichzeitig verarbeiten. </li><li>  Die physische Ebene in der realen Welt sollte flach sein und eine Fl√§che von mehr als 15 cm x 15 cm haben. </li><li>  ARCore kann keine bewegten Bilder und Objekte verfolgen. </li></ul><br><h2 id="vybor-podhodyaschego-opornogo-izobrazheniya">  Auswahl des richtigen Referenzbildes </h2><br><p>  Hier einige Tipps zur Auswahl eines guten Referenzbilds f√ºr ARCore: </p><br><ul><li>  Augmented Reality-Bilder unterst√ºtzen die Formate PNG, JPEG und JPG. </li><li>  Es spielt keine Rolle, ob das Bild farbig oder schwarzwei√ü ist. Hauptsache, es ist kontrastreich. </li><li>  Die Bildaufl√∂sung muss mindestens 300 x 300 Pixel betragen. </li><li>  Die Verwendung von hochaufl√∂senden Bildern bedeutet keine Leistungsverbesserung. </li><li>  Vermeiden Sie Bilder mit sich wiederholenden Mustern (z. B. Muster oder Tupfen). </li><li>  Verwenden Sie das <strong>Arcoreimg-</strong> Tool, um zu bewerten, wie gut Ihr Bild funktioniert.  Eine Bewertung von mindestens 75 Punkten wird empfohlen. </li></ul><br><h2 id="kak-ispolzovat-instrument-arcoreimg">  So verwenden Sie das Arcoreimg-Tool: </h2><br><ul><li>  Laden Sie das ARCore SDK f√ºr Android <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von diesem Link</a> herunter. </li><li>  Entpacken Sie den Inhalt der Datei an einen beliebigen Ort. </li><li>  Gehen Sie im extrahierten Ordner zu <strong>tools&gt; arcoreimg&gt; windows</strong> (auch wenn Sie Linux oder macOS haben). </li><li>  √ñffnen Sie eine Eingabeaufforderung in diesem Verzeichnis. </li><li>  Und geben Sie diesen Befehl ein: </li></ul><br><pre><code class="xml hljs">arcoreimg.exe eval-img --input_image_path=dog.png</code> </pre> <br><p>  Ersetzen Sie <strong>dog.png</strong> durch den vollst√§ndigen Pfad zu Ihrem Bild. </p><br><h2 id="nachalo-raboty-s-prilozheniem-dopolnennoy-realnosti">  Erste Schritte mit der Augmented Reality App </h2><br><p>  Nachdem Sie sich mit ARCore vertraut gemacht und ein gutes Bild mit einer Bewertung von 75+ ausgew√§hlt haben, k√∂nnen Sie mit dem Schreiben des Anwendungscodes beginnen. </p><br><h3 id="sozdanie-fragmenta">  Fragmenterstellung </h3><br><p>  Wir werden ein Fragment erstellen und es unserer Aktivit√§t hinzuf√ºgen.  Erstellen Sie eine Klasse namens <code>CustomArFragment</code> und erben Sie sie von <code>ArFragment</code> .  Hier ist der Code f√ºr <code>CustomArFragment</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.ayusch.augmentedimages; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Config; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Session; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.ux.ArFragment; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomArFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArFragment</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Config </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSessionConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Session session)</span></span></span><span class="hljs-function"> </span></span>{ getPlaneDiscoveryController().setInstructionView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Config config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Config(session); config.setUpdateMode(Config.UpdateMode.LATEST_CAMERA_IMAGE); session.configure(config); getArSceneView().setupSession(session); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config; } }</code> </pre> <br><p>  Zun√§chst schalten wir die Ebenenerkennung aus.  Auf diese Weise entfernen wir das Handsymbol vom Bildschirm, das unmittelbar nach der Initialisierung des Fragments angezeigt wird, und informieren den Benutzer √ºber die Notwendigkeit, sein Smartphone zu bewegen, um das Flugzeug zu finden.  Wir brauchen das nicht mehr, weil wir keine zuf√§lligen Ebenen finden, sondern ein konkretes Bild. </p><br><p>  Dann legen wir den Aktualisierungsmodus f√ºr die Sitzung <code>LATEST_CAMERA_IMAGE</code> .  Dies stellt sicher, dass wir √ºber Bildaktualisierungen informiert werden, wenn der Kamerarahmen aktualisiert wird. </p><br><h3 id="nastroyka-bazy-dannyh-izobrazheniy">  Einrichtung der Bilddatenbank </h3><br><p>  F√ºgen Sie das ausgew√§hlte Referenzbild (das Sie in der physischen Welt finden m√∂chten) zum Ordner " <strong>Assets"</strong> hinzu (erstellen Sie es, falls dies noch nicht geschehen ist).  Jetzt k√∂nnen wir Bilder zu unserer Datenbank hinzuf√ºgen. </p><br><p>  Wir werden diese Datenbank erstellen, sobald das Fragment erstellt wurde.  In den Protokollen zeigen wir das Ergebnis dieser Operation an: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((((MainActivity) getActivity()).setupAugmentedImagesDb(config, session))) { Log.d(<span class="hljs-string"><span class="hljs-string">"SetupAugImgDb"</span></span>, <span class="hljs-string"><span class="hljs-string">"Success"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Log.e(<span class="hljs-string"><span class="hljs-string">"SetupAugImgDb"</span></span>,<span class="hljs-string"><span class="hljs-string">"Faliure setting up db"</span></span>); }</code> </pre> <br><p>  So <code>CustomArFragment</code> aus: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.ayusch.augmentedimages; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Config; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Session; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.ux.ArFragment; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomArFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArFragment</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Config </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSessionConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Session session)</span></span></span><span class="hljs-function"> </span></span>{ getPlaneDiscoveryController().setInstructionView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Config config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Config(session); config.setUpdateMode(Config.UpdateMode.LATEST_CAMERA_IMAGE); session.configure(config); getArSceneView().setupSession(session); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((((MainActivity) getActivity()).setupAugmentedImagesDb(config, session))) { Log.d(<span class="hljs-string"><span class="hljs-string">"SetupAugImgDb"</span></span>, <span class="hljs-string"><span class="hljs-string">"Success"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Log.e(<span class="hljs-string"><span class="hljs-string">"SetupAugImgDb"</span></span>,<span class="hljs-string"><span class="hljs-string">"Faliure setting up db"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config; } }</code> </pre> <br><p>  In <code>setupAugmentedImagesDb</code> werden wir <code>setupAugmentedImagesDb</code> Methode <code>MainActivity</code> .  <code>CustomArFragment</code> wir nun <code>CustomArFragment</code> zu unserer <code>activity_main.xml</code> : </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fragment</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/sceneform_fragment"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ayusch.augmentedimages.CustomArFragment"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.constraint.ConstraintLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="dobavlenie-izobrazheniya-v-bazu-dannyh">  Hinzuf√ºgen eines Bildes zur Datenbank </h3><br><p>  Jetzt richten wir unsere Bilddatenbank ein, finden das Referenzbild in der realen Welt und f√ºgen dem Bild ein 3D-Modell hinzu. </p><br><p>  Beginnen wir mit der Einrichtung unserer Datenbank.  Erstellen Sie eine √∂ffentliche <code>setupAugmentedImagesDb</code> Methode in der <code>MainActivity</code> Klasse: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupAugmentedImagesDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config config, Session session)</span></span></span><span class="hljs-function"> </span></span>{ AugmentedImageDatabase augmentedImageDatabase; Bitmap bitmap = loadAugmentedImage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bitmap == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } augmentedImageDatabase = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AugmentedImageDatabase(session); augmentedImageDatabase.addImage(<span class="hljs-string"><span class="hljs-string">"tiger"</span></span>, bitmap); config.setAugmentedImageDatabase(augmentedImageDatabase); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadAugmentedImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (InputStream is = getAssets().open(<span class="hljs-string"><span class="hljs-string">"blanket.jpeg"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BitmapFactory.decodeStream(is); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { Log.e(<span class="hljs-string"><span class="hljs-string">"ImageLoad"</span></span>, <span class="hljs-string"><span class="hljs-string">"IO Exception"</span></span>, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre> <br><p>  Wir haben auch eine <code>loadAugmentedImage</code> Methode erstellt, die ein Bild aus einem Ressourcenordner l√§dt und eine Bitmap zur√ºckgibt. </p><br><p>  In <code>setupAugmentedImagesDb</code> initialisieren wir zuerst unsere Datenbank f√ºr die aktuelle Sitzung und f√ºgen dann das Image dieser Datenbank hinzu.  Wir haben unseren <strong>Bildtiger genannt</strong> .  Dann installieren wir diese Datenbank in der Konfiguration und geben <code>true</code> , was darauf hinweist, dass das Image erfolgreich hinzugef√ºgt wurde. </p><br><h3 id="obnaruzhenie-opornyh-izobrazheniy-v-realnom-mire">  Reale Referenzbilderkennung </h3><br><p>  Jetzt werden wir beginnen, unsere Referenzbilder in der realen Welt zu entdecken.  Zu diesem Zweck erstellen wir einen Listener, der jedes Mal aufgerufen wird, wenn der Videorahmen aktualisiert wird, und dieser Rahmen wird auf das Vorhandensein eines Referenzbilds dort analysiert. </p><br><p>  F√ºgen Sie diese Zeile der <code>onCreate()</code> -Methode in <code>MainActivity</code> : </p><br><pre> <code class="java hljs">arFragment.getArSceneView().getScene().addOnUpdateListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::onUpdateFrame);</code> </pre> <br><p>  <code>onUpdateFrame</code> nun die <code>onUpdateFrame</code> Methode zu <code>MainActivity</code> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.N) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUpdateFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FrameTime frameTime)</span></span></span><span class="hljs-function"> </span></span>{ Frame frame = arFragment.getArSceneView().getArFrame(); Collection&lt;AugmentedImage&gt; augmentedImages = frame.getUpdatedTrackables(AugmentedImage.class); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (AugmentedImage augmentedImage : augmentedImages) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (augmentedImage.getTrackingState() == TrackingState.TRACKING) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (augmentedImage.getName().equals(<span class="hljs-string"><span class="hljs-string">"tiger"</span></span>) &amp;&amp; shouldAddModel) { placeObject(arFragment, augmentedImage.createAnchor(augmentedImage.getCenterPose()), Uri.parse(<span class="hljs-string"><span class="hljs-string">"Mesh_BengalTiger.sfb"</span></span>)); shouldAddModel = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } } }</code> </pre> <br><p>  In der ersten Zeile erhalten wir den Rahmen selbst.  Ein Frame kann als normaler Screenshot eines Videos vorgestellt werden.  Wenn Sie mit der Funktionsweise des Videos vertraut sind, wissen Sie, dass es sich nur um eine Sammlung von Bildern handelt, die sich sehr schnell √§ndern und den Eindruck erwecken, dass sich etwas bewegt.  Wir machen nur eines dieser Bilder. </p><br><p>  Nachdem wir den Rahmen erhalten haben, analysieren wir ihn auf das Vorhandensein unseres Referenzbildes.  Wir erstellen eine Liste aller von ARCore mithilfe von frame.getUpdatedTrackables verfolgten <code>frame.getUpdatedTrackables</code> .  Dann iterieren wir dar√ºber und pr√ºfen, ob unser <strong>Tigerbild</strong> im Rahmen vorhanden ist. </p><br><p>  Wenn eine √úbereinstimmung gefunden wird, nehmen wir einfach das 3D-Modell und platzieren es auf dem erkannten Bild. </p><br><blockquote>  <em>Hinweis</em>  <em>Das Flag <code>shouldAddModel</code> verwendet, sodass das 3D-Modell nur einmal <code>shouldAddModel</code> .</em> </blockquote><br><h3 id="razmeschenie-3d-modeli-nad-opornym-izobrazheniem">  Platzieren eines 3D-Modells √ºber einem Referenzbild </h3><br><p>  Nachdem wir unser Referenzbild in der realen Welt gefunden haben, k√∂nnen wir ein 3D-Modell hinzuf√ºgen.  F√ºgen Sie die <code>addNodeToScene</code> <code>placeObject</code> und <code>addNodeToScene</code> : </p><br><ul><li>  <code>placeObject</code> : Mit dieser Methode wird ein gerendertes Objekt mit einem bestimmten <code>Uri</code> .  Sobald das Rendern abgeschlossen ist, wird das Objekt an die Methode <code>addNodeToScene</code> , wo das Objekt an den Knoten angeh√§ngt und dieser Knoten in der Szene platziert wird. </li><li>  <code>addNodeToScene</code> : Diese Methode erstellt einen Knoten aus dem resultierenden Anker, erstellt einen weiteren Knoten, mit dem das visualisierte Objekt verbunden wird, f√ºgt diesen Knoten dann dem <code>addNodeToScene</code> hinzu und platziert ihn auf der B√ºhne. </li></ul><br><p>  So sieht <code>MainActivity</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.ayusch.augmentedimages; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.Bitmap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.BitmapFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.net.Uri; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Anchor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.AugmentedImage; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.AugmentedImageDatabase; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Config; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Frame; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.Session; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.core.TrackingState; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.AnchorNode; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.FrameTime; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.rendering.ModelRenderable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.rendering.Renderable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.ux.ArFragment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ar.sceneform.ux.TransformableNode; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.InputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Collection; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ ArFragment arFragment; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> shouldAddModel = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); arFragment = (CustomArFragment) getSupportFragmentManager().findFragmentById(R.id.sceneform_fragment); arFragment.getPlaneDiscoveryController().hide(); arFragment.getArSceneView().getScene().addOnUpdateListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::onUpdateFrame); } <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.N) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">placeObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArFragment arFragment, Anchor anchor, Uri uri)</span></span></span><span class="hljs-function"> </span></span>{ ModelRenderable.builder() .setSource(arFragment.getContext(), uri) .build() .thenAccept(modelRenderable -&gt; addNodeToScene(arFragment, anchor, modelRenderable)) .exceptionally(throwable -&gt; { Toast.makeText(arFragment.getContext(), <span class="hljs-string"><span class="hljs-string">"Error:"</span></span> + throwable.getMessage(), Toast.LENGTH_LONG).show(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } ); } <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.N) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUpdateFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FrameTime frameTime)</span></span></span><span class="hljs-function"> </span></span>{ Frame frame = arFragment.getArSceneView().getArFrame(); Collection&lt;AugmentedImage&gt; augmentedImages = frame.getUpdatedTrackables(AugmentedImage.class); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (AugmentedImage augmentedImage : augmentedImages) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (augmentedImage.getTrackingState() == TrackingState.TRACKING) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (augmentedImage.getName().equals(<span class="hljs-string"><span class="hljs-string">"tiger"</span></span>) &amp;&amp; shouldAddModel) { placeObject(arFragment, augmentedImage.createAnchor(augmentedImage.getCenterPose()), Uri.parse(<span class="hljs-string"><span class="hljs-string">"Mesh_BengalTiger.sfb"</span></span>)); shouldAddModel = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupAugmentedImagesDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config config, Session session)</span></span></span><span class="hljs-function"> </span></span>{ AugmentedImageDatabase augmentedImageDatabase; Bitmap bitmap = loadAugmentedImage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bitmap == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } augmentedImageDatabase = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AugmentedImageDatabase(session); augmentedImageDatabase.addImage(<span class="hljs-string"><span class="hljs-string">"tiger"</span></span>, bitmap); config.setAugmentedImageDatabase(augmentedImageDatabase); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadAugmentedImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (InputStream is = getAssets().open(<span class="hljs-string"><span class="hljs-string">"blanket.jpeg"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BitmapFactory.decodeStream(is); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { Log.e(<span class="hljs-string"><span class="hljs-string">"ImageLoad"</span></span>, <span class="hljs-string"><span class="hljs-string">"IO Exception"</span></span>, e); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNodeToScene</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArFragment arFragment, Anchor anchor, Renderable renderable)</span></span></span><span class="hljs-function"> </span></span>{ AnchorNode anchorNode = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnchorNode(anchor); TransformableNode node = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransformableNode(arFragment.getTransformationSystem()); node.setRenderable(renderable); node.setParent(anchorNode); arFragment.getArSceneView().getScene().addChild(anchorNode); node.select(); } }</code> </pre> <br><p>  F√ºhren Sie nun Ihre Anwendung aus.  Sie sollten den Bildschirm wie unten gezeigt sehen.  Bewegen Sie das Telefon leicht √ºber das Referenzobjekt.  Sobald ARCore das Referenzbild in der realen Welt erkennt, f√ºgt es Ihr 3D-Modell hinzu. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/285/6ea/3ed/2856ea3edbaffc05bb1bcb92b53dc8e9.jpg" alt="Ergebnis"></p><br><blockquote>  Lesen Sie auch: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellen Ihrer ersten ARCore-Anwendung</a> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439190/">https://habr.com/ru/post/de439190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439176/index.html">Senden Sie eine E-Mail mit Anh√§ngen von JavaMailSender von SpringFramework</a></li>
<li><a href="../de439180/index.html">Rekko Herausforderung</a></li>
<li><a href="../de439182/index.html">Wie wir Bestellungen zwischen Fahrern in Yandex.Taxi verteilen</a></li>
<li><a href="../de439184/index.html">√Ñndern Sie Ihr Kennwort: Testen der Kennwortrichtlinien f√ºr Webdienste</a></li>
<li><a href="../de439186/index.html">UX Editor: wahre Geschichte, riales Leben</a></li>
<li><a href="../de439192/index.html">PC-Lautsprecher bis elf</a></li>
<li><a href="../de439194/index.html">Charakterverwaltung mit SharedEvents</a></li>
<li><a href="../de439196/index.html">JPMorgan-Analysten: Apple sollte Blizzard, Netflix oder Sonos kaufen, um die Anleger zu beruhigen</a></li>
<li><a href="../de439198/index.html">Barrier Island Generation</a></li>
<li><a href="../de439200/index.html">Komponist f√ºr die Kleinen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>