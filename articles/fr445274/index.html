<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï£ üõ≥Ô∏è üôéüèø Lorsque "Zo√´"! == "Zo√´", ou pourquoi vous devez normaliser les cha√Ænes Unicode üèúÔ∏è üèä üë©‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avez-vous d√©j√† entendu parler de la normalisation Unicode? Tu n'es pas seul. Mais tout le monde doit savoir cela. La normalisation peut vous √©viter be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lorsque "Zo√´"! == "Zo√´", ou pourquoi vous devez normaliser les cha√Ænes Unicode</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/445274/">  Avez-vous d√©j√† entendu parler de la normalisation Unicode?  Tu n'es pas seul.  Mais tout le monde doit savoir cela.  La normalisation peut vous √©viter beaucoup de probl√®mes.  T√¥t ou tard, quelque chose de similaire √† celui illustr√© dans la figure suivante se produit avec n'importe quel d√©veloppeur. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aed/667/54c/aed66754c254c8eb6c077d2a418f1db6.png"></div>  <i><font color="#999999">Zo√´ n'est pas Zo√´</font></i> <br><a name="habracut"></a><br>  Et cela, en passant, n'est pas un exemple d'un autre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©trange</a> JavaScript.  L'auteur du mat√©riel, dont nous publions la traduction aujourd'hui, dit qu'il peut montrer comment le m√™me probl√®me se manifeste en utilisant presque tous les langages de programmation existants.  En particulier, nous parlons de scripts Python, Go et m√™me shell.  Comment y faire face? <br><br><h2>  <font color="#3AC1EF">Contexte</font> </h2><br>  J'ai rencontr√© le probl√®me Unicode pour la premi√®re fois il y a de nombreuses ann√©es lorsque j'ai √©crit une application (en Objective-C) qui importait une liste de contacts du carnet d'adresses de l'utilisateur et de ses r√©seaux sociaux, apr√®s quoi j'ai √©limin√© les doublons.  Dans certaines situations, il s'est av√©r√© que certaines personnes figurent deux fois sur la liste.  Cela est d√ª au fait que leurs noms, selon le programme, n'√©taient pas la m√™me cha√Æne. <br><br>  Bien que dans l'exemple ci-dessus, les deux lignes se ressemblent exactement, la fa√ßon dont elles sont pr√©sent√©es dans le syst√®me, les octets dans lesquels elles sont stock√©es sur le disque diff√®rent.  Dans le pr√©nom, <code>"Zo√´"</code> le caract√®re √´ (e avec tr√©ma) repr√©sente un seul point de code Unicode.  Dans le second cas, nous avons affaire √† la d√©composition, avec l'approche de repr√©sentation des caract√®res √† l'aide de plusieurs caract√®res.  Si vous, dans votre application, travaillez avec des cha√Ænes Unicode, vous devez tenir compte du fait que les m√™mes caract√®res peuvent √™tre repr√©sent√©s de diff√©rentes mani√®res. <br><br><h2>  <font color="#3AC1EF">Comment nous sommes arriv√©s aux emoji: en bref sur l'encodage des caract√®res</font> </h2><br>  Les ordinateurs fonctionnent avec des octets, qui ne sont que des nombres.  Afin de pouvoir traiter des textes sur ordinateur, les gens se sont mis d'accord sur la correspondance des caract√®res et des nombres, et se sont mis d'accord sur l'apparence de la repr√©sentation visuelle des caract√®res. <br><br>  Le premier accord de ce type √©tait repr√©sent√© par le codage ASCII (American Standard Code for Information Interchange).  Cet encodage utilisait 7 bits et pouvait repr√©senter 128 caract√®res, dont l'alphabet latin (lettres majuscules et minuscules), les chiffres et les signes de ponctuation de base.  ASCII comprenait √©galement de nombreux caract√®res ¬´non imprimables¬ª, tels qu'un saut de ligne, des tabulations, des retours chariot et autres.  Par exemple, en ASCII, la lettre latine M (majuscule m) est cod√©e 77 (4D en notation hexad√©cimale). <br><br>  Le probl√®me avec ASCII est que m√™me si 128 caract√®res peuvent √™tre suffisants pour repr√©senter tous les caract√®res que les personnes travaillant avec des textes anglais utilisent habituellement, ce nombre de caract√®res n'est pas suffisant pour repr√©senter des textes dans d'autres langues et divers caract√®res sp√©ciaux comme les emojis. <br><br>  La solution √† ce probl√®me a √©t√© l'adoption de la norme Unicode, qui visait la possibilit√© de repr√©senter chaque caract√®re utilis√© dans tous les textes modernes et anciens, y compris les caract√®res comme les emojis.  Par exemple, dans la norme Unicode 12.0 la plus r√©cente, il y a plus de 137 000 caract√®res. <br><br>  La norme Unicode peut √™tre impl√©ment√©e √† l'aide de diverses m√©thodes de codage de caract√®res.  Les plus courants sont UTF-8 et UTF-16.  Il convient de noter que dans l'espace Web, le plus courant est la norme de codage des textes UTF-8. <br><br>  La norme UTF-8 utilise 1 √† 4 octets pour repr√©senter les caract√®res.  UTF-8 est un sur-ensemble d'ASCII, donc ses 128 premiers caract√®res correspondent aux caract√®res repr√©sent√©s dans la table de codes ASCII.  La norme UTF-16, d'autre part, utilise 2 √† 4 octets pour repr√©senter 1 caract√®re. <br><br>  Pourquoi existe-t-il les deux normes?  Le fait est que les textes dans les langues occidentales sont g√©n√©ralement plus efficacement encod√©s en utilisant la norme UTF-8 (car la plupart des caract√®res de ces textes peuvent √™tre repr√©sent√©s sous la forme de codes de 1 octet).  Si nous parlons des langues orientales, nous pouvons dire que les fichiers qui stockent des textes √©crits dans ces langues obtiennent g√©n√©ralement moins lors de l'utilisation de l'UTF-16. <br><br><h2>  <font color="#3AC1EF">Points de code Unicode et codage de caract√®res</font> </h2><br>  Chaque caract√®re de la norme Unicode se voit attribuer un num√©ro d'identification appel√© point de code.  Par exemple, un emoji de point de code <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png">  est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">U + 1F436</a> . <br><br>  Lors du codage de cette ic√¥ne, elle peut √™tre repr√©sent√©e sous la forme de diff√©rentes s√©quences d'octets: <br><br><ul><li>  UTF-8: 4 octets, <code>0xF0 0x9F 0x90 0xB6</code> </li><li>  UTF-16: 4 octets, <code>0xD83D 0xDC36</code> </li></ul><br>  Dans le code JavaScript ci-dessous, les trois commandes impriment le m√™me caract√®re sur la console du navigateur. <br><br> <code>//         <br> console.log(' <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> ') // =&gt; <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> <br> //     Unicode (ES2015+) <br> console.log('\u{1F436}') // =&gt; <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> <br> //        UTF-16 <br> //      ( 2  ) <br> console.log('\uD83D\uDC36') // =&gt; <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"></code> <br><br>  Les m√©canismes internes de la plupart des interpr√®tes JavaScript (y compris Node.js et les navigateurs modernes) utilisent UTF-16.  Cela signifie que l'ic√¥ne de chien que nous envisageons est stock√©e √† l'aide de deux unit√©s de code UTF-16 (16 bits chacune).  Par cons√©quent, ce que les sorties de code suivantes ne devraient pas vous sembler incompr√©hensibles: <br><br> <code>console.log(' <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> '.length) // =&gt; 2</code> <br> <br><h2>  <font color="#3AC1EF">Combinaison de caract√®res</font> </h2><br>  Revenons maintenant √† notre point de d√©part, √† savoir, pourquoi les symboles qui se ressemblent pour une personne ont une repr√©sentation interne diff√©rente. <br><br>  Certains caract√®res Unicode sont con√ßus pour modifier d'autres caract√®res.  Ils sont appel√©s combinaison de caract√®res.  Ils s'appliquent aux caract√®res de base. Par exemple: <br><br><ul><li> <code>n + Àú = √±</code> </li> <li> <code>u + ¬® = √º</code> </li> <li> <code>e + ¬¥ = √©</code> </li> </ul><br>  Comme vous pouvez le voir dans l'exemple pr√©c√©dent, les caract√®res combinables vous permettent d'ajouter des signes diacritiques aux caract√®res de base.  Mais les capacit√©s de transformation de caract√®res d'Unicode ne se limitent pas √† cela.  Par exemple, certaines s√©quences de caract√®res peuvent √™tre repr√©sent√©es sous forme de ligatures (donc ae peut se transformer en √¶). <br><br>  Le probl√®me est que les caract√®res sp√©ciaux peuvent √™tre repr√©sent√©s de diff√©rentes mani√®res. <br><br>  Par exemple, la lettre √© peut √™tre repr√©sent√©e de deux mani√®res: <br><br><ul><li>  En utilisant un seul point de code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">U + 00E9</a> . </li><li>  En utilisant une combinaison de la lettre e et du signe aigu, c'est-√†-dire en utilisant deux points de code - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">U + 0065</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">U + 0301</a> . </li></ul><br>  Les caract√®res r√©sultant de l'utilisation de l'une de ces fa√ßons de repr√©senter la lettre √© auront la m√™me apparence, mais en comparaison, il s'av√®re que les caract√®res sont diff√©rents.  Les lignes les contenant auront des longueurs diff√©rentes.  Vous pouvez le v√©rifier en ex√©cutant le code suivant dans la console du navigateur. <br><br><pre> <code class="plaintext hljs">console.log('\u00e9') // =&gt; √© console.log('\u0065\u0301') // =&gt; √© console.log('\u00e9' == '\u0065\u0301') // =&gt; false console.log('\u00e9'.length) // =&gt; 1 console.log('\u0065\u0301'.length) // =&gt; 2</code> </pre> <br>  Cela peut entra√Æner des erreurs inattendues.  Par exemple, ils peuvent s'exprimer par le fait que le programme, pour des raisons inconnues, n'est pas en mesure de trouver certaines entr√©es dans la base de donn√©es, en ce que l'utilisateur, en entrant le mot de passe correct, ne peut pas se connecter au syst√®me. <br><br><h2>  <font color="#3AC1EF">Normalisation de ligne</font> </h2><br>  Les probl√®mes ci-dessus ont une solution simple, qui consiste √† normaliser les cha√Ænes, √† les amener √† la "repr√©sentation canonique". <br><br>  Il existe quatre formes standard (algorithmes) de normalisation: <br><br><ul><li>  NFC: Forme de normalisation Composition canonique. </li><li>  NFD: D√©composition canonique de normalisation. </li><li>  NFKC: Composition de compatibilit√© de forme de normalisation. </li><li>  NFKD: d√©composition de compatibilit√© de forme de normalisation. </li></ul><br>  La forme de normalisation la plus couramment utilis√©e est le NFC.  Lors de l'utilisation de cet algorithme, tous les caract√®res sont d'abord d√©compos√©s, apr√®s quoi toutes les s√©quences de combinaison sont recompos√©es dans l'ordre d√©fini par la norme.  Pour une utilisation pratique, vous pouvez choisir n'importe quelle forme.  L'essentiel est de l'appliquer de mani√®re coh√©rente.  Par cons√©quent, la r√©ception des m√™mes donn√©es √† l'entr√©e du programme conduira toujours au m√™me r√©sultat. <br><br>  En JavaScript, √† partir de la norme ES2015 (ES6), il existe une m√©thode int√©gr√©e pour normaliser les cha√Ænes - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">String.prototype.normalize ([form])</a> .  Vous pouvez l'utiliser dans l'environnement Node.js et dans presque tous les navigateurs modernes.  L'argument <code>form</code> de cette m√©thode est l'identificateur de cha√Æne du formulaire de normalisation.  La valeur par d√©faut est le formulaire NFC. <br><br>  Nous revenons √† l'exemple pr√©c√©demment consid√©r√©, en appliquant cette fois la normalisation: <br><br><pre> <code class="plaintext hljs">const str = '\u0065\u0301' console.log(str == '\u00e9') // =&gt; false const normalized = str.normalize('NFC') console.log(normalized == '\u00e9') // =&gt; true console.log(normalized.length) // =&gt; 1</code> </pre> <br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Si vous d√©veloppez une application Web et utilisez ce que l'utilisateur y entre, normalisez toujours les donn√©es texte re√ßues.  En JavaScript, vous pouvez utiliser la m√©thode de cha√Æne standard <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">normalize ()</a> pour effectuer la normalisation. <br><br>  <b>Chers lecteurs!</b>  Avez-vous rencontr√© des probl√®mes avec les cha√Ænes qui peuvent √™tre r√©solus avec la normalisation? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445274/">https://habr.com/ru/post/fr445274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445264/index.html">Pr√©chargement, pr√©lecture et autres balises</a></li>
<li><a href="../fr445266/index.html">GeekBrains et Rostelecom organiseront un IoT Hackathon</a></li>
<li><a href="../fr445268/index.html">D√©tails GraphQL: quoi, comment et pourquoi</a></li>
<li><a href="../fr445270/index.html">[signet] Bash pour les d√©butants: 21 commandes utiles</a></li>
<li><a href="../fr445272/index.html">JavaScript est le meilleur langage de programmation pour les d√©butants. C'est vrai ou pas?</a></li>
<li><a href="../fr445276/index.html">Guide d'utilisation complet</a></li>
<li><a href="../fr445278/index.html">Comment cr√©er un jeu si vous n'√™tes jamais artiste</a></li>
<li><a href="../fr445280/index.html">Rentabilit√© des sites et des services</a></li>
<li><a href="../fr445284/index.html">ClickHouse Product Analytics VKontakte</a></li>
<li><a href="../fr445286/index.html">Repose-pieds pour le cerveau: Hedera Hashgraph Distributed Registry Platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>