<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóÉÔ∏è üõåüèΩ üè§ BIF-Muster: Sauberer Front-End-Code und bequemes Arbeiten mit Serverdaten üòÆ ‚ùÑÔ∏è üëßüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Material, dessen √úbersetzung wir heute ver√∂ffentlichen, konzentriert sich darauf, was in einer Situation zu tun ist, in der die vom Server empfang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>BIF-Muster: Sauberer Front-End-Code und bequemes Arbeiten mit Serverdaten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/416011/">  Das Material, dessen √úbersetzung wir heute ver√∂ffentlichen, konzentriert sich darauf, was in einer Situation zu tun ist, in der die vom Server empfangenen Daten nicht den Anforderungen des Clients entsprechen.  Zuerst werden wir ein typisches Problem dieser Art betrachten und dann verschiedene Wege analysieren, um es zu l√∂sen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/7dc/108/edd/7dc108edd1850ed1da6eb12f865f93a5.jpg" alt="Bild"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Das Problem der ausgefallenen Server-API</font> </h2><br>  Betrachten wir ein bedingtes Beispiel, das auf mehreren realen Projekten basiert.  Angenommen, wir entwickeln eine neue Website f√ºr eine Organisation, die seit einiger Zeit besteht.  Sie hat bereits REST-Endpunkte, aber sie sind nicht ganz auf das ausgelegt, was wir erstellen werden.  Hier m√ºssen wir nur auf den Server zugreifen, um den Benutzer zu authentifizieren, Informationen √ºber ihn zu erhalten und eine Liste der nicht angezeigten Benachrichtigungen von diesem Benutzer herunterzuladen.  Aus diesem Grund interessieren uns die folgenden Endpunkte der Server-API: <br><br><ul><li> <code>/auth</code> : Autorisiert den Benutzer und gibt ein Zugriffstoken zur√ºck. </li><li>  <code>/profile</code> : Gibt grundlegende Benutzerinformationen zur√ºck. </li><li>  <code>/notifications</code> : Erm√∂glicht das Abrufen ungelesener Benutzerbenachrichtigungen. </li></ul><br>  Stellen Sie sich vor, unsere Anwendung muss immer alle diese Daten in einer einzigen Einheit empfangen, das hei√üt, im Idealfall w√§re es sch√∂n, wenn wir anstelle von drei Endpunkten nur einen h√§tten. <br>  Wir haben jedoch viel mehr Probleme als zu viele Endpunkte.  Insbesondere sprechen wir dar√ºber, dass die Daten, die wir erhalten, nicht optimal aussehen. <br><br>  Beispielsweise wurde der Endpunkt <code>/profile</code> in der Antike erstellt und nicht in JavaScript geschrieben. Daher sehen die Namen der Eigenschaften in den zur√ºckgegebenen Daten f√ºr eine JS-Anwendung ungew√∂hnlich aus: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Profiles"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"David"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Gilbertson"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [       {         <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,         <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [           <span class="hljs-string"><span class="hljs-string">"/images/david.png"</span></span>         ]       }     ],     <span class="hljs-attr"><span class="hljs-attr">"Last_Login"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-01-01"</span></span>   } ] }</code> </pre> <br>  Im Allgemeinen - nichts Gutes. <br><br>  Richtig, wenn Sie sich ansehen, was der Endpunkt <code>/notifications</code> erzeugen, werden die obigen Daten von <code>/profile</code> ziemlich nett erscheinen: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"msg-1234"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529739612"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Alice"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Guthbertson"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Enhanced"</span></span>: <span class="hljs-string"><span class="hljs-string">"True"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/alice.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it re"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hey I like your hair, it really goes nice with your eyes"</span></span>   },   <span class="hljs-attr"><span class="hljs-attr">"msg-5678"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"1529731234"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"Christian_Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Surname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Smelthsen"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"Photographs"</span></span>: [         {           <span class="hljs-attr"><span class="hljs-attr">"Size"</span></span>: <span class="hljs-string"><span class="hljs-string">"Medium"</span></span>,           <span class="hljs-attr"><span class="hljs-attr">"URLS"</span></span>: [             <span class="hljs-string"><span class="hljs-string">"/images/smelth.png"</span></span>           ]         }       ]     },     <span class="hljs-attr"><span class="hljs-attr">"message_summary"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocu"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"I'm launching my own cryptocurrency soon and many thanks for you to look at and talk about"</span></span>   } } }</code> </pre> <br>  Hier ist die Liste der Nachrichten ein Objekt, kein Array.  Au√üerdem gibt es hier Benutzerdaten, die genauso unangenehm angeordnet sind wie im Fall des <code>/profile</code> Endpunkts.  Und - hier ist eine √úberraschung - die <code>timestamp</code> enth√§lt die Anzahl der Sekunden seit Anfang 1970. <br><br>  Wenn ich ein Diagramm der Architektur dieses h√∂llisch unbequemen Systems zeichnen m√ºsste, √ºber das wir gerade gesprochen haben, w√ºrde es wie das in der folgenden Abbildung gezeigte aussehen.  Die rote Farbe wird f√ºr diejenigen Teile dieser Schaltung verwendet, die schlecht vorbereiteten Daten f√ºr weitere Arbeiten entsprechen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e1/6c4/42f/8e16c442f3af8ad8ca702875e25207e0.png"><br>  <i><font color="#999999">Systemdiagramm</font></i> <br><br>  Unter diesen Umst√§nden bem√ºhen wir uns m√∂glicherweise nicht, die Architektur dieses Systems zu reparieren.  Sie k√∂nnen einfach Daten von diesen drei APIs laden und diese Daten in der Anwendung verwenden.  Wenn Sie beispielsweise den vollst√§ndigen Benutzernamen auf der Seite anzeigen m√ºssen, m√ºssen Sie die Eigenschaften <code>Christian_Name</code> und <code>Surname</code> kombinieren. <br><br>  Hier m√∂chte ich eine Bemerkung zu Namen machen.  Die Idee, den vollst√§ndigen Namen einer Person in einen pers√∂nlichen Vor- und Nachnamen zu unterteilen, ist charakteristisch f√ºr westliche L√§nder.  Wenn Sie etwas f√ºr den internationalen Gebrauch entwickeln, versuchen Sie, den vollst√§ndigen Namen der Person als unteilbare Zeichenfolge zu betrachten, und machen Sie keine Annahmen dar√ºber, wie diese Zeichenfolge in kleinere Teile zerlegt werden kann, um zu verwenden, was an Orten passiert ist, an denen brauchen K√ºrze oder m√∂chten den Benutzer in einem informellen Stil ansprechen. <br><br>  Zur√ºck zu unseren unvollst√§ndigen Datenstrukturen.  Das erste offensichtliche Problem, das hier zu sehen ist, dr√ºckt sich in der Notwendigkeit aus, unterschiedliche Daten im Benutzeroberfl√§chencode zu kombinieren.  Es besteht in der Tatsache, dass wir diese Aktion m√∂glicherweise an mehreren Stellen wiederholen m√ºssen.  Wenn Sie dies nur gelegentlich tun m√ºssen, ist das Problem nicht so schwerwiegend, aber wenn Sie dies h√§ufig ben√∂tigen, ist es viel schlimmer.  Infolgedessen gibt es unerw√ºnschte Ph√§nomene, die durch die Nicht√ºbereinstimmung der Anordnung der vom Server empfangenen Daten und ihrer Verwendung in der Anwendung verursacht werden. <br><br>  Das zweite Problem ist die Komplexit√§t des Codes, der zur Bildung der Benutzeroberfl√§che verwendet wird.  Ich glaube, dass ein solcher Code zum einen so einfach wie m√∂glich und zum anderen so klar wie m√∂glich sein sollte.  Je mehr interne Datentransformationen Sie auf dem Client durchf√ºhren m√ºssen, desto komplexer und komplexer ist der Code, an dem sich normalerweise Fehler verstecken. <br><br>  Das dritte Problem betrifft Datentypen.  Anhand der obigen Codefragmente k√∂nnen Sie erkennen, dass beispielsweise Nachrichtenkennungen Zeichenfolgen und Benutzerkennungen Zahlen sind.  Aus technischer Sicht ist alles in Ordnung, aber solche Dinge k√∂nnen den Programmierer verwirren.  Schauen Sie sich auch die Pr√§sentation der Daten an!  Aber was ist mit dem Durcheinander in dem Teil der Daten, der sich auf das Profilbild bezieht?  Schlie√ülich brauchen wir nur eine URL, die zur entsprechenden Datei f√ºhrt, und nicht etwas, aus dem wir diese URL selbst erstellen m√ºssen, um durch den Dschungel verschachtelter Datenstrukturen zu waten. <br><br>  Wenn wir diese Daten verarbeiten, an den Benutzeroberfl√§chencode √ºbergeben und dann die Module analysieren, k√∂nnen wir nicht sofort genau verstehen, womit wir dort arbeiten.  Das Konvertieren der internen Datenstruktur und ihres Typs bei der Arbeit mit ihnen f√ºhrt zu einer zus√§tzlichen Belastung f√ºr den Programmierer.  Aber ohne all diese Schwierigkeiten ist das durchaus m√∂glich. <br><br>  In der Tat w√§re es als Option m√∂glich, ein statisches Typsystem zu implementieren, um dieses Problem zu l√∂sen, aber eine strikte Typisierung ist nicht nur aufgrund ihrer Anwesenheit in der Lage, schlechten Code gut zu machen. <br><br>  Nachdem Sie nun den Ernst des Problems sehen k√∂nnen, mit dem wir konfrontiert sind, sprechen wir √ºber M√∂glichkeiten, es zu l√∂sen. <br><br><h2>  <font color="#3AC1EF">L√∂sung 1: √Ñndern der Server-API</font> </h2><br>  Wenn das unbequeme Ger√§t der vorhandenen API nicht aus wichtigen Gr√ºnden vorgegeben ist, hindert Sie nichts daran, eine neue Version zu erstellen, die den Anforderungen des Projekts besser entspricht, und diese neue Version beispielsweise unter <code>/v2</code> .  Vielleicht kann dieser Ansatz als die erfolgreichste L√∂sung f√ºr die oben genannten Probleme bezeichnet werden.  Das Schema eines solchen Systems ist in der folgenden Abbildung dargestellt. Die Datenstruktur, die perfekt zu den Anforderungen des Kunden passt, ist gr√ºn hervorgehoben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c59/59d/c18/c5959dc18590ec9bce0368e4b9ba1967.png"><br>  <i><font color="#999999">Die neue Server-API, die genau das produziert, was die Client-Seite des Systems ben√∂tigt</font></i> <br><br>  Ich beginne mit der Entwicklung eines neuen Projekts, dessen API zu w√ºnschen √ºbrig l√§sst, und bin immer an der M√∂glichkeit interessiert, den gerade beschriebenen Ansatz umzusetzen.  Manchmal hat das API-Ger√§t jedoch einige wichtige Ziele, obwohl es unpraktisch ist, oder eine √Ñnderung der Server-API ist einfach nicht m√∂glich.  In diesem Fall greife ich auf den folgenden Ansatz zur√ºck. <br><br><h2>  <font color="#3AC1EF">L√∂sung 2: BFF-Muster</font> </h2><br>  Dies ist ein gutes altes BFF <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">-</a> Muster ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Backend-For-the-Frontend</a> ).  Mit diesem Muster k√∂nnen Sie von den komplizierten universellen REST-Endpunkten abstrahieren und dem Frontend genau das geben, was es ben√∂tigt.  Hier ist eine schematische Darstellung einer solchen L√∂sung. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ea5/484/437/ea5484437a08ed68db006b5194dd9a9b.png"><br>  <i><font color="#999999">Anwenden des BFF-Musters</font></i> <br><br>  Die Bedeutung der Existenz der BFF-Schicht besteht darin, die Bed√ºrfnisse des Frontends zu befriedigen.  Vielleicht verwendet er zus√§tzliche REST-Endpunkte oder GraphQL-Dienste oder Web-Sockets oder irgendetwas anderes.  Das Hauptziel besteht darin, alles M√∂gliche f√ºr die Client-Seite der Anwendung zu tun. <br><br>  Meine Lieblingsarchitektur ist NodeJS BFF, mit der Front-End-Entwickler das tun k√∂nnen, was sie ben√∂tigen, und gro√üartige APIs f√ºr die von ihnen entwickelten Clientanwendungen erstellen.  Im Idealfall befindet sich der entsprechende Code im selben Repository wie der Code des Frontends selbst. Dies vereinfacht die gemeinsame Nutzung von Code, um beispielsweise gesendete Daten sowohl auf dem Client als auch auf dem Server zu √ºberpr√ºfen. <br><br>  Dies bedeutet au√üerdem, dass Aufgaben, die √Ñnderungen am Client-Teil der Anwendung und ihrer Server-API erfordern, in einem Repository ausgef√ºhrt werden.  Eine Kleinigkeit, wie sie sagen, aber nett. <br><br>  BFF wird jedoch m√∂glicherweise nicht immer verwendet.  Und diese Tatsache f√ºhrt uns zu einer anderen L√∂sung f√ºr das Problem der bequemen Verwendung fehlerhafter Server-APIs. <br><br><h2>  <font color="#3AC1EF">L√∂sung 3: BIF-Muster</font> </h2><br>  Das BIF-Muster (Backend In the Frontend) verwendet dieselbe Logik, die mit BFF (Kombination mehrerer APIs und Datenbereinigung) angewendet werden kann. Diese Logik wird jedoch auf die Clientseite verschoben.  Eigentlich ist diese Idee nicht neu, sie h√§tte vor zwanzig Jahren gesehen werden k√∂nnen, aber ein solcher Ansatz kann bei der Arbeit mit schlecht organisierten Server-APIs hilfreich sein. Deshalb sprechen wir dar√ºber.  So sieht es aus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/185/102/d39/185102d39436b6119ead19f230eb8196.png"><br>  <i><font color="#999999">Anwenden des BIF-Musters</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç Was ist ein BIF?</font> </h3><br>  Wie aus dem vorherigen Abschnitt ersichtlich ist, ist BIF ein Muster, dh ein Ansatz zum Verst√§ndnis des Codes und seiner Organisation.  Seine Verwendung f√ºhrt nicht dazu, dass Logik aus dem Projekt entfernt werden muss.  Es trennt lediglich die Logik eines Typs (√Ñnderung von Datenstrukturen) von der Logik eines anderen Typs (Bildung der Benutzeroberfl√§che).  Dies √§hnelt der Idee einer ‚ÄûAufgabentrennung‚Äú, die jeder h√∂rt. <br><br>  An dieser Stelle m√∂chte ich darauf hinweisen, dass ich, obwohl dies nicht als Katastrophe bezeichnet werden kann, h√§ufig Analphabeten-BIF-Implementierungen sehen musste.  Daher scheint es mir, dass viele daran interessiert sein werden, eine Geschichte dar√ºber zu h√∂ren, wie dieses Muster richtig implementiert werden kann. <br><br>  Der BIF-Code sollte als Code betrachtet werden, der einmal genommen und auf den Node.js-Server √ºbertragen werden kann. Danach funktioniert alles auf die gleiche Weise wie zuvor.  Oder √ºbertragen Sie es sogar auf ein privates NPM-Paket, das in mehreren Front-End-Projekten im Rahmen eines Unternehmens verwendet wird, was einfach erstaunlich ist. <br><br>  Denken Sie daran, dass wir oben die Hauptprobleme besprochen haben, die beim Arbeiten mit einer ausgefallenen Server-API auftreten.  Dazu geh√∂rt ein zu h√§ufiger Aufruf der API und die Tatsache, dass die von ihnen zur√ºckgegebenen Daten nicht den Anforderungen des Frontends entsprechen. <br><br>  Wir werden die L√∂sung f√ºr jedes dieser Probleme in separate Codebl√∂cke aufteilen, von denen jeder in einer eigenen Datei abgelegt wird.  Infolgedessen besteht die BIF-Schicht des Client-Teils der Anwendung aus zwei Dateien.  Zus√§tzlich wird ihnen eine Testdatei angeh√§ngt. <br><br><h3>  <font color="#3AC1EF">‚ñç API-Aufrufe kombinieren</font> </h3><br>  Das Aufrufen der Server-APIs in unserem Client-Code ist kein so ernstes Problem.  Ich m√∂chte es jedoch abstrahieren, um es zu erm√∂glichen, eine einzelne ‚ÄûAnfrage‚Äú (vom Anwendungscode bis zur BIF-Schicht) zu erf√ºllen und genau das zu erhalten, was als Antwort ben√∂tigt wird. <br><br>  In unserem Fall gibt es nat√ºrlich kein Entrinnen, drei HTTP-Anforderungen an den Server zu senden, aber die Anwendung muss nichts dar√ºber wissen. <br><br>  Die API meiner BIF-Schicht wird als Funktionen dargestellt.  Wenn die Anwendung einige Daten √ºber den Benutzer ben√∂tigt, ruft sie daher die Funktion <code>getUser()</code> , die diese Daten an sie <code>getUser()</code> .  So sieht diese Funktion aus: <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; import fetchJson from <span class="hljs-string"><span class="hljs-string">'./fetchJson'</span></span>; export const getUser = async () =&gt; { const auth = await fetchJson(<span class="hljs-string"><span class="hljs-string">'/auth'</span></span>); const [ <span class="hljs-type"><span class="hljs-type">profile</span></span>, <span class="hljs-type"><span class="hljs-type">notifications</span></span> ] = await Promise.all([   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">profile</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>),   <span class="hljs-type"><span class="hljs-type">fetchJson</span></span>(`/<span class="hljs-type"><span class="hljs-type">notifications</span></span>/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">auth.userId</span></span>}`, <span class="hljs-type"><span class="hljs-type">auth.jwt</span></span>), ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parseUserData(auth, profile, notifications); };</code> </pre> <br>  Hier wird zun√§chst eine Anforderung an den Authentifizierungsdienst gestellt, um ein Token zu erhalten, mit dem der Benutzer autorisiert werden kann (wir werden hier nicht √ºber Authentifizierungsmechanismen sprechen, unser Hauptziel ist jedoch BIF). <br><br>  Nach dem Empfang des Tokens k√∂nnen Sie gleichzeitig zwei Anforderungen ausf√ºhren, die Benutzerprofildaten und Informationen zu ungelesenen Benachrichtigungen erhalten. <br><br>  Schauen Sie sich √ºbrigens an, wie sch√∂n das Konstrukt <code>async/await</code> aussieht, wenn Sie mit <code>Promise.all</code> und destruktiver Zuweisung damit arbeiten. <br><br>  Dies war also der erste Schritt. Hier haben wir von der Tatsache abstrahiert, dass der Zugriff auf den Server drei Anforderungen umfasst.  Der Fall ist jedoch noch nicht abgeschlossen.  <code>parseUserData()</code> n√§mlich auf den Aufruf der Funktion <code>parseUserData()</code> , die, wie Sie anhand ihres Namens <code>parseUserData()</code> k√∂nnen, die vom Server empfangenen Daten <code>parseUserData()</code> .  Reden wir √ºber sie. <br><br><h3>  <font color="#3AC1EF">‚ñç Datenbereinigung</font> </h3><br>  Ich m√∂chte sofort eine Empfehlung aussprechen, die meines Erachtens ein Projekt, das zuvor keine BIF-Schicht hatte, ernsthaft beeintr√§chtigen kann, insbesondere ein neues Projekt.  Denken Sie eine Weile nicht dar√ºber nach, was Sie vom Server erhalten.  Konzentrieren Sie sich stattdessen darauf, welche Daten Ihre Anwendung ben√∂tigt. <br><br>  Dar√ºber hinaus ist es am besten, beim Entwerfen der Anwendung nicht zu versuchen, m√∂gliche zuk√ºnftige Anforderungen zu ber√ºcksichtigen, beispielsweise im Zusammenhang mit 2021.  Versuchen Sie einfach, die Anwendung genau so zu machen, wie sie heute sollte.  Tatsache ist, dass √ºberm√§√üige Begeisterung f√ºr die Planung und Versuche, die Zukunft vorherzusagen, der Hauptgrund f√ºr die ungerechtfertigte Komplikation von Softwareprojekten ist. <br><br>  Also zur√ºck zu unserem Gesch√§ft.  Jetzt wissen wir, wie die von den drei Server-APIs empfangenen Daten aussehen, und wir wissen, wie sie nach der Analyse umgewandelt werden sollen. <br><br>  Es scheint, dass hier einer dieser seltenen F√§lle ist, in denen die Verwendung von TDD wirklich Sinn macht.  Daher werden wir einen langen Test f√ºr die Funktion <code>parseUserData()</code> schreiben: <br><br><pre> <code class="hljs powershell">import parseUserData from <span class="hljs-string"><span class="hljs-string">'./parseUserData'</span></span>; it(<span class="hljs-string"><span class="hljs-string">'should parse the data'</span></span>, () =&gt; { const authApiData = {   userId: <span class="hljs-number"><span class="hljs-number">1234</span></span>,   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>, }; const profileApiData = {   Profiles: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>,       <span class="hljs-type"><span class="hljs-type">Christian_Name</span></span>: <span class="hljs-string"><span class="hljs-string">'David'</span></span>,       <span class="hljs-type"><span class="hljs-type">Surname</span></span>: <span class="hljs-string"><span class="hljs-string">'Gilbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">Photographs</span></span>: [         {           <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,           <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [             <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,           ],         },       ],       <span class="hljs-type"><span class="hljs-type">Last_Login</span></span>: <span class="hljs-string"><span class="hljs-string">'2018-01-01'</span></span>     },   ], }; const notificationsApiData = {   <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: {     <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529739612'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Alice'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Guthbertson'</span></span>,         Enhanced: <span class="hljs-string"><span class="hljs-string">'True'</span></span>,         Photographs: [           {             <span class="hljs-type"><span class="hljs-type">Size</span></span>: <span class="hljs-string"><span class="hljs-string">'Medium'</span></span>,             <span class="hljs-type"><span class="hljs-type">URLS</span></span>: [               <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>             ]           }         ]       },       message_summary: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it re'</span></span>,       message: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>: {       timestamp: <span class="hljs-string"><span class="hljs-string">'1529731234'</span></span>,       user: {         Christian_Name: <span class="hljs-string"><span class="hljs-string">'Bob'</span></span>,         Surname: <span class="hljs-string"><span class="hljs-string">'Smelthsen'</span></span>,       },       message_summary: <span class="hljs-string"><span class="hljs-string">'I\'</span></span>m launching my own cryptocu<span class="hljs-string"><span class="hljs-string">',       message: '</span></span>I\<span class="hljs-string"><span class="hljs-string">'m launching my own cryptocurrency soon and many thanks for you to look at and talk about'</span></span>     },   }, }; const parsedData = parseUserData(authApiData, profileApiData, notificationsApiData); expect(parsedData).toEqual({   jwt: <span class="hljs-string"><span class="hljs-string">'the jwt'</span></span>,   id: <span class="hljs-string"><span class="hljs-string">'1234'</span></span>,   name: <span class="hljs-string"><span class="hljs-string">'David Gilbertson'</span></span>,   photoUrl: <span class="hljs-string"><span class="hljs-string">'/images/david.png'</span></span>,   notifications: [     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-1234'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Alice Guthbertson'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">true</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/alice.png'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'Hey I like your hair, it really goes nice with your eyes'</span></span>     },     {       <span class="hljs-type"><span class="hljs-type">id</span></span>: <span class="hljs-string"><span class="hljs-string">'msg-5678'</span></span>,       <span class="hljs-built_in"><span class="hljs-built_in">dateTime</span></span>: <span class="hljs-type"><span class="hljs-type">expect.any</span></span>(<span class="hljs-type"><span class="hljs-type">Date</span></span>),       <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Bob Smelthsen'</span></span>,       <span class="hljs-type"><span class="hljs-type">premiumMember</span></span>: <span class="hljs-type"><span class="hljs-type">false</span></span>,       <span class="hljs-type"><span class="hljs-type">photoUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>,       <span class="hljs-type"><span class="hljs-type">message</span></span>: <span class="hljs-string"><span class="hljs-string">'I\'</span></span><span class="hljs-type"><span class="hljs-type">m</span></span> <span class="hljs-type"><span class="hljs-type">launching</span></span> <span class="hljs-type"><span class="hljs-type">my</span></span> <span class="hljs-type"><span class="hljs-type">own</span></span> <span class="hljs-type"><span class="hljs-type">cryptocurrency</span></span> <span class="hljs-type"><span class="hljs-type">soon</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">many</span></span> <span class="hljs-type"><span class="hljs-type">thanks</span></span> <span class="hljs-type"><span class="hljs-type">for</span></span> <span class="hljs-type"><span class="hljs-type">you</span></span> <span class="hljs-type"><span class="hljs-type">to</span></span> <span class="hljs-type"><span class="hljs-type">look</span></span> <span class="hljs-type"><span class="hljs-type">at</span></span> <span class="hljs-type"><span class="hljs-type">and</span></span> <span class="hljs-type"><span class="hljs-type">talk</span></span> <span class="hljs-type"><span class="hljs-type">about</span></span><span class="hljs-string"><span class="hljs-string">'     },   ], }); });</span></span></code> </pre> <br>  Und hier ist der Code der Funktion selbst: <br><br><pre> <code class="hljs powershell">const getPhotoFromProfile = profile =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> profile.Photographs[<span class="hljs-number"><span class="hljs-number">0</span></span>].URLS[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'/images/placeholder.jpg'</span></span>; //   } }; const getFullNameFromProfile = profile =&gt; `${profile.Christian_Name} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{profile.Surname}`; export default <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseUserData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(authApiData, profileApiData, notificationsApiData)</span></span></span></span> { const profile = profileApiData.Profiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const result = {   jwt: authApiData.jwt,   id: authApiData.userId.toString(), // ID        name: getFullNameFromProfile(profile),   photoUrl: getPhotoFromProfile(profile),   notifications: [], //      ,     }; Object.entries(notificationsApiData.data).forEach(([<span class="hljs-type"><span class="hljs-type">id</span></span>, <span class="hljs-type"><span class="hljs-type">notification</span></span>]) =&gt; {   result.notifications.push({     id,     dateTime: new Date(Number(notification.timestamp) * <span class="hljs-number"><span class="hljs-number">1000</span></span>), // ,   ,   ,     Unix,         name: getFullNameFromProfile(notification.user),     photoUrl: getPhotoFromProfile(notification.user),     message: notification.message,     premiumMember: notification.user.Enhanced === <span class="hljs-string"><span class="hljs-string">'True'</span></span>,   }) }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  Ich m√∂chte darauf hinweisen, dass, wenn es m√∂glich ist, zweihundert Codezeilen an einem Ort zu sammeln, die f√ºr die √Ñnderung der zuvor in der gesamten Anwendung verteilten Daten verantwortlich sind, dies ein wunderbares Gef√ºhl hervorruft.  Jetzt ist alles in einer Datei, Unit-Tests werden f√ºr diesen Code geschrieben und alle mehrdeutigen Momente werden mit Kommentaren versehen. <br><br>  Ich habe vorhin gesagt, dass BFF mein bevorzugter Ansatz zum Kombinieren und L√∂schen von Daten ist, aber es gibt einen Bereich, in dem BIF BFF √ºberlegen ist.  Die vom Server empfangenen Daten k√∂nnen n√§mlich JavaScript-Objekte enthalten, die JSON nicht unterst√ºtzen, wie z. B. <code>Date</code> oder <code>Map</code> (dies ist m√∂glicherweise eine der am wenigsten genutzten JavaScript-Funktionen).  In unserem Fall m√ºssen wir beispielsweise das Datum, das vom Server kam (ausgedr√ºckt in Sekunden, nicht in Millisekunden), in ein JS-Objekt vom Typ <code>Date</code> konvertieren. <br><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  Wenn Sie der Meinung sind, dass Ihr Projekt etwas mit dem gemeinsam hat, bei dem wir die Probleme nicht erfolgreicher APIs untersucht haben, analysieren Sie den Code, indem Sie sich die folgenden Fragen zur Verwendung von Daten vom Server auf dem Client stellen: <br><br><ul><li>  M√ºssen Sie Eigenschaften kombinieren, die niemals separat verwendet werden (z. B. Vor- und Nachname des Benutzers)? </li><li>  Muss der JS-Code mit Eigenschaftsnamen arbeiten, die so gebildet wurden, dass sie in JS nicht akzeptiert werden (so etwas wie PascalCase)? </li><li>  Was sind die Datentypen der verschiedenen Bezeichner?  Vielleicht sind das manchmal Zeichenfolgen, manchmal Zahlen? </li><li>  Wie werden Termine in Ihrem Projekt dargestellt?  Vielleicht sind dies manchmal <code>Date</code> JS-Objekte, die f√ºr die Verwendung in der Benutzeroberfl√§che bereit sind, und manchmal Zahlen oder sogar Zeichenfolgen? </li><li>  M√ºssen Sie h√§ufig Eigenschaften auf ihre Existenz √ºberpr√ºfen oder pr√ºfen, ob eine Entit√§t ein Array ist, bevor Sie mit der Aufz√§hlung der Elemente dieser Entit√§t beginnen, um auf ihrer Basis ein Fragment der Benutzeroberfl√§che zu bilden?  K√∂nnte es sein, dass diese Entit√§t kein Array ist, auch wenn sie leer ist? </li><li>  M√ºssen Sie beim Bilden der Schnittstelle Arrays sortieren oder filtern, die im Idealfall bereits korrekt sortiert und gefiltert sein sollten? </li><li>  Wenn sich herausstellt, dass beim √úberpr√ºfen der Eigenschaften auf ihre Existenz keine gesuchten Eigenschaften gesucht werden, m√ºssen Sie dann auf einige Standardwerte umschalten (verwenden Sie beispielsweise ein Standardbild, wenn die vom Server empfangenen Daten kein Benutzerfoto enthalten)? </li><li>  Sind die Eigenschaften einheitlich benannt?  Kommt es vor, dass dieselbe Entit√§t unterschiedliche Namen haben kann, was m√∂glicherweise durch die gemeinsame Verwendung von relativ alten "alten" und "neuen" Server-APIs verursacht wird? </li><li>  M√ºssen Sie zusammen mit n√ºtzlichen Daten Daten √ºbertragen, die niemals verwendet werden, und zwar nur, weil sie von der Server-API stammen?  Beeintr√§chtigen diese nicht verwendeten Daten das Debuggen? </li></ul><br>  Wenn Sie eine oder zwei Fragen aus dieser Liste positiv beantworten k√∂nnen, sollten Sie m√∂glicherweise etwas nicht reparieren, das bereits ordnungsgem√§√ü funktioniert. <br><br>  Wenn Sie jedoch beim Lesen dieser Fragen in jedem von ihnen die Probleme Ihres Projekts herausfinden, wenn das Ger√§t Ihres Codes aufgrund all dessen unn√∂tig kompliziert ist, wenn es schwer zu erkennen und zu testen ist, wenn es Fehler enth√§lt, die schwer zu erkennen sind, schauen Sie sich das BIF-Muster an. <br><br>  Abschlie√üend m√∂chte ich sagen, dass bei der Einf√ºhrung der BIF-Schicht in vorhandene Anwendungen die Dinge einfacher sind, da dies schrittweise und in kleinen Schritten erfolgen kann.  Nehmen wir an, die erste Version der Funktion zum Vorbereiten von Daten, nennen wir sie <code>parseData()</code> , kann einfach ohne √Ñnderungen zur√ºckgeben, was zu ihrer Eingabe kommt.  Anschlie√üend k√∂nnen Sie die Logik schrittweise vom Code, der f√ºr die Erstellung der Benutzeroberfl√§che verantwortlich ist, zu dieser Funktion verschieben. <br><br>  <b>Liebe Leser!</b>     ,          BIF? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416011/">https://habr.com/ru/post/de416011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416001/index.html">Nachrichten von einer Site in VK - einfach und effektiv - PHP + CUrl</a></li>
<li><a href="../de416003/index.html">Rendering von HTML-Dateien: Ein Kapitel aus dem Buch ReactPHP for Beginners von Skyeng</a></li>
<li><a href="../de416005/index.html">16 Reaktionstools f√ºr Schnittstellenentwickler</a></li>
<li><a href="../de416007/index.html">Fast kompliziert. Der Beginn der Schaffung eines drahtlosen "Smart Home". Basierend auf Linux-Technologie, Z-Wave- und MajorDoMo-Software</a></li>
<li><a href="../de416009/index.html">Probieren Sie Kaninchenkot, er ist kr√§ftig und f√§ngt - Extrakte in der Pharmakologie</a></li>
<li><a href="../de416013/index.html">So fangen Sie an zu investieren und Geld zu sparen: Die Experten von Dow Jones nannten die f√ºnf Hauptfehler von Anf√§ngern</a></li>
<li><a href="../de416015/index.html">Spielen mit Threads in Node.JS 10.5.0</a></li>
<li><a href="../de416017/index.html">Wir sammeln Kohortenanalyse / Analyse von Fl√ºssen am Beispiel von Excel</a></li>
<li><a href="../de416019/index.html">Wie gut ist das Open-Source-√ñkosystem von R f√ºr die L√∂sung von Gesch√§ftsproblemen?</a></li>
<li><a href="../de416021/index.html">Entwickeln Sie Ihr eigenes Framework und das berufliche Wachstum eines JS-Programmierers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>