<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòç üïö üìç MotionLayout: Animationen sind besser, weniger Code üï† üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ üçå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google verbessert unser Leben weiter, indem es neue praktische Bibliotheken und APIs ver√∂ffentlicht. Darunter war auch das neue MotionLayout. Angesich...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MotionLayout: Animationen sind besser, weniger Code</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/458854/"><img src="https://habrastorage.org/webt/wk/q7/cq/wkq7cqwqisgnz3lof9qfobt5bte.png"><br>  <i>Google verbessert unser Leben weiter, indem es neue praktische Bibliotheken und APIs ver√∂ffentlicht.</i>  <i>Darunter war auch das neue MotionLayout.</i>  <i>Angesichts der F√ºlle an Animationen in unseren Anwendungen implementierte mein Kollege Cedric Holtz sofort die wichtigste Animation unserer Anwendung - Voting in Dating - mithilfe der neuen API und sparte dabei eine gro√üe Menge Code.</i>  <i>Ich teile die √úbersetzung seines Artikels.</i> <br><br>  Die Google I / O 2019-Konferenz wurde k√ºrzlich beendet, auf der Updates und die neuesten Verbesserungen f√ºr unser geliebtes SDK angek√ºndigt wurden.  Pers√∂nlich war ich besonders an der Pr√§sentation von Nicholas Road und John Hoford √ºber die zuk√ºnftige Funktionalit√§t von ConstraintLayout interessiert.  Genauer gesagt √ºber seine Erweiterung in Form von MotionLayout. <br><br>  Nach der Beta-Version wollte ich eine Dating-Animation basierend auf dieser Bibliothek implementieren. <a name="habracut"></a><br><br>  Definieren wir zun√§chst die Begriffe: <br><br><blockquote>  "MotionLayout ist ein ConstraintLayout, mit dem Sie Layouts zwischen verschiedenen Status animieren k√∂nnen."  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> </blockquote><br><br>  Wenn Sie keine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikelserie von</a> Nicholas Road gelesen haben, in der die wichtigsten Ideen von MotionLayout erl√§utert werden, empfehle ich dringend, sie zu lesen. <br><br>  Nachdem die Einf√ºhrung abgeschlossen ist, wollen wir nun sehen, was wir bekommen m√∂chten: <br><br><img src="https://habrastorage.org/webt/wm/kb/qm/wmkbqmy_ulwafy_jvkvpadfafyu.gif"><br><br><h2>  Kartenstapel </h2><br><h3>  Wir zeigen die verschobene Karte </h3><br>  F√ºgen Sie zun√§chst MotionLayout zum Layoutverzeichnis hinzu, das bisher nur eine oberste Karte enth√§lt: <br><br><pre><code class="kotlin hljs">&lt;androidx.constraintlayout.motion.widget.MotionLayout android:id=<span class="hljs-string"><span class="hljs-string">"@+id/motionLayout"</span></span>     xmlns:android=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span>     xmlns:app=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span>     android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>     android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>     app:layoutDescription=<span class="hljs-string"><span class="hljs-string">"@xml/scene_swipe"</span></span>     app:motionDebug=<span class="hljs-string"><span class="hljs-string">"SHOW_ALL"</span></span>&gt;     &lt;FrameLayout         android:id=<span class="hljs-string"><span class="hljs-string">"@+id/topCard"</span></span>         android:layout_width=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span>         android:layout_height=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span> /&gt; &lt;/androidx.constraintlayout.motion.widget.MotionLayout&gt;</code> </pre> <br>  Beachten Sie diese Zeile: app: motionDebug = "SHOW_ALL".  Es erm√∂glicht uns, Debugging-Informationen, die Flugbahn von Objekten, die Zust√§nde mit dem Beginn und dem Ende der Animation sowie den aktuellen Fortschritt anzuzeigen.  Die Zeile hilft beim Debuggen sehr, aber vergessen Sie nicht, sie zu l√∂schen, bevor Sie sie an das Produkt senden: Es gibt keine Erinnerung daf√ºr. <br><br>  Wie Sie sehen, haben wir hier keine Einschr√§nkungen f√ºr die Ansicht festgelegt.  Sie werden aus der Szene (MotionScene) √ºbernommen, die wir jetzt definieren. <br><br>  Beginnen wir mit der Definition des Ausgangszustands: Eine Karte liegt in der Mitte des Bildschirms mit Einkerbungen. <br><br><pre> <code class="kotlin hljs">&lt;MotionScene xmlns:android=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span>    xmlns:app=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span>&gt;    &lt;ConstraintSet android:id=<span class="hljs-string"><span class="hljs-string">"@+id/rest"</span></span>&gt;        &lt;Constraint            android:id=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>            android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>            android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>            android:layout_marginBottom=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>            android:layout_marginEnd=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>            android:layout_marginStart=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>            android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>            app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>            app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>&gt;    &lt;/ConstraintSet&gt; &lt;/MotionScene&gt;</code> </pre> <br>  Hinzuf√ºgen von Constraint-Sets (ConstraintSet) pass und like.  Sie geben den Status der obersten Karte wieder, wenn sie vollst√§ndig nach links oder rechts verschoben ist.  Wir m√∂chten, dass die Karte angehalten wird, bevor sie vom Bildschirm verschwindet, um eine sch√∂ne Animation anzuzeigen, die unsere Entscheidung best√§tigt. <br><br><pre> <code class="kotlin hljs">&lt;ConstraintSet    android:id=<span class="hljs-string"><span class="hljs-string">"@+id/pass"</span></span>    app:deriveConstraintsFrom=<span class="hljs-string"><span class="hljs-string">"@+id/rest"</span></span>&gt;    &lt;Constraint        android:id=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>        android:layout_width=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span>        android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>        android:layout_marginBottom=<span class="hljs-string"><span class="hljs-string">"80dp"</span></span>        android:layout_marginEnd=<span class="hljs-string"><span class="hljs-string">"200dp"</span></span>        android:layout_marginStart=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>        android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"20dp"</span></span>        app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>        app:layout_constraintWidth_percent=<span class="hljs-string"><span class="hljs-string">"0.7"</span></span> /&gt; &lt;/ConstraintSet&gt; &lt;ConstraintSet    android:id=<span class="hljs-string"><span class="hljs-string">"@+id/like"</span></span>    app:deriveConstraintsFrom=<span class="hljs-string"><span class="hljs-string">"@id/rest"</span></span>&gt;    &lt;Constraint        android:id=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>        android:layout_width=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span>        android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>        android:layout_marginBottom=<span class="hljs-string"><span class="hljs-string">"80dp"</span></span>        android:layout_marginEnd=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>        android:layout_marginStart=<span class="hljs-string"><span class="hljs-string">"200dp"</span></span>        android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"20dp"</span></span>        app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>        app:layout_constraintWidth_percent=<span class="hljs-string"><span class="hljs-string">"0.7"</span></span> /&gt; &lt;/ConstraintSet&gt;</code> </pre><br>  F√ºgen Sie der vorherigen Szene beide S√§tze von Einschr√§nkungen hinzu.  Sie sind fast identisch und werden nur auf beiden Seiten des Bildschirms gespiegelt. <br><br>  Jetzt haben wir drei Arten von Einschr√§nkungen - Start, Like und Pass.  Definieren wir den √úbergang zwischen diesen Zust√§nden. <br><br>  F√ºgen Sie dazu einen √úbergang f√ºr den Wisch nach links und den anderen f√ºr den Wisch nach rechts hinzu. <br><br><pre> <code class="kotlin hljs">&lt;Transition    app:constraintSetEnd=<span class="hljs-string"><span class="hljs-string">"@+id/pass"</span></span>    app:constraintSetStart=<span class="hljs-string"><span class="hljs-string">"@+id/rest"</span></span>    app:duration=<span class="hljs-string"><span class="hljs-string">"300"</span></span>&gt;    &lt;OnSwipe        app:dragDirection=<span class="hljs-string"><span class="hljs-string">"dragLeft"</span></span>        app:onTouchUp=<span class="hljs-string"><span class="hljs-string">"autoComplete"</span></span>        app:touchAnchorId=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>        app:touchAnchorSide=<span class="hljs-string"><span class="hljs-string">"left"</span></span>        app:touchRegionId=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span> /&gt; &lt;/Transition&gt; &lt;Transition    app:constraintSetEnd=<span class="hljs-string"><span class="hljs-string">"@+id/like"</span></span>    app:constraintSetStart=<span class="hljs-string"><span class="hljs-string">"@+id/rest"</span></span>    app:duration=<span class="hljs-string"><span class="hljs-string">"300"</span></span>&gt;    &lt;OnSwipe        app:dragDirection=<span class="hljs-string"><span class="hljs-string">"dragRight"</span></span>        app:onTouchUp=<span class="hljs-string"><span class="hljs-string">"autoComplete"</span></span>        app:touchAnchorId=<span class="hljs-string"><span class="hljs-string">"@+id/topCard"</span></span>        app:touchAnchorSide=<span class="hljs-string"><span class="hljs-string">"right"</span></span>        app:touchRegionId=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span> /&gt; &lt;/Transition&gt;</code> </pre><br>  F√ºr die oberste Karte setzen wir die Wischanimation nach links und den gleichen Spiegel f√ºr den Wisch nach rechts. <br><br>  Diese Eigenschaften werden dazu beitragen, die Interaktion mit unserer Szene zu verbessern: <br><br><ul><li>  touchRegionId: Da wir die Karte aufgef√ºllt haben, m√ºssen wir sicherstellen, dass die Ber√ºhrung nur im Bereich der Karte selbst und nicht im gesamten MotionLayout erkannt wird.  Dies kann mit touchRegionId erfolgen. <br></li><li>  onTouchUp: Was passiert mit der Animation, nachdem wir die Karte freigegeben haben?  Es sollte entweder weitergehen oder in seinen Ausgangszustand zur√ºckkehren, damit die automatische Vervollst√§ndigung anwendbar ist. <br></li></ul><br>  Mal sehen, was passiert ist: <br><br><img src="https://habrastorage.org/webt/zs/zq/ox/zszqoxe4dsdpphvu3fro0_3tjtk.gif"><br><br><h3>  Die Karte wird automatisch vom Bildschirm entfernt </h3><br>  Jetzt arbeiten wir an der Animation, die startet, wenn die Karte vom Bildschirm verschwindet. <br><br>  Wir f√ºgen zwei weitere ConstraintSet-Sets f√ºr jeden Endzustand unserer Animationen hinzu: Die Karte verl√§sst den Bildschirm links und rechts. <br><br>  In den folgenden Beispielen werde ich zeigen, wie der Like-Status erstellt wird, und der Pass-Status wiederholt ihn gespiegelt.  Ein funktionierendes Beispiel ist vollst√§ndig im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository zu sehen</a> . <br><br><pre> <code class="kotlin hljs">&lt;ConstraintSet android:id=<span class="hljs-string"><span class="hljs-string">"@+id/offScreenLike"</span></span>&gt;    &lt;Constraint        android:id=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>        android:layout_width=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span>        android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>        android:layout_marginBottom=<span class="hljs-string"><span class="hljs-string">"80dp"</span></span>        android:layout_marginEnd=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>        android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"20dp"</span></span>        app:layout_constraintStart_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>        app:layout_constraintWidth_percent=<span class="hljs-string"><span class="hljs-string">"0.7"</span></span> /&gt;   &lt;/ConstraintSet&gt;</code> </pre> <br>  Jetzt m√ºssen Sie wie im vorherigen Beispiel den √úbergang vom Wischzustand zum Endzustand bestimmen.  Der √úbergang sollte unmittelbar nach der Animation des Wischens automatisch funktionieren.  Dies kann mit autoTransition erfolgen: <br><br><pre> <code class="kotlin hljs">&lt;Transition app:autoTransition=<span class="hljs-string"><span class="hljs-string">"animateToEnd"</span></span> app:constraintSetEnd=<span class="hljs-string"><span class="hljs-string">"@+id/offScreenLike"</span></span> app:constraintSetStart=<span class="hljs-string"><span class="hljs-string">"@+id/like"</span></span> app:duration=<span class="hljs-string"><span class="hljs-string">"150"</span></span> /&gt;</code> </pre><br>  Jetzt haben wir eine Wischkarte, die vom Bildschirm gewischt werden kann! <br><br><img src="https://habrastorage.org/webt/vt/ip/i0/vtipi0xzpmomh5mlkqpoytwedze.gif"><br><br><h3>  Animation der unteren Karte </h3><br><br>  Lassen Sie uns nun die unterste Karte erstellen, um die Illusion der Unendlichkeit des Decks zu erzeugen. <br><br>  F√ºgen Sie dem Layout eine weitere Karte hinzu, √§hnlich der ersten: <br><br><pre> <code class="kotlin hljs">&lt;FrameLayout    android:id=<span class="hljs-string"><span class="hljs-string">"@+id/bottomCard"</span></span>    android:layout_width=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span>    android:layout_height=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span>    android:background=<span class="hljs-string"><span class="hljs-string">"@color/colorAccent"</span></span> /&gt;</code> </pre> <br>  √Ñndern Sie das XML, um die Einschr√§nkungen festzulegen, die f√ºr diese Karte in jeder Phase der Animation gelten: <br><br><pre> <code class="kotlin hljs">&lt;ConstraintSet android:id=<span class="hljs-string"><span class="hljs-string">"@id/rest"</span></span>&gt;    &lt;!-- ... --&gt;    &lt;Constraint android:id=<span class="hljs-string"><span class="hljs-string">"@id/bottomCard"</span></span>&gt;        &lt;Layout            android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>            android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span>            android:layout_marginBottom=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>            android:layout_marginEnd=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>            android:layout_marginStart=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span>            android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"50dp"</span></span> /&gt;        &lt;Transform            android:scaleX=<span class="hljs-string"><span class="hljs-string">"0.90"</span></span>            android:scaleY=<span class="hljs-string"><span class="hljs-string">"0.90"</span></span> /&gt;    &lt;/Constraint&gt; &lt;/ConstraintSet&gt; &lt;ConstraintSet    android:id=<span class="hljs-string"><span class="hljs-string">"@+id/offScreenLike"</span></span>    app:deriveConstraintsFrom=<span class="hljs-string"><span class="hljs-string">"@id/like"</span></span>&gt;    &lt;!-- ... --&gt;    &lt;Constraint android:id=<span class="hljs-string"><span class="hljs-string">"@id/bottomCard"</span></span>&gt;        &lt;Transform            android:scaleX=<span class="hljs-string"><span class="hljs-string">"1"</span></span>            android:scaleY=<span class="hljs-string"><span class="hljs-string">"1"</span></span> /&gt;    &lt;/Constraint&gt; &lt;/ConstraintSet&gt;</code> </pre> <br>  Dazu k√∂nnen wir die bequeme ConstraintSet-Eigenschaft verwenden. <br><br>  Standardm√§√üig √ºbernimmt jeder neue Satz Attribute aus dem √ºbergeordneten MotionLayout.  Mit dem Flag deriveConstraintsFrom k√∂nnen Sie jedoch ein anderes √ºbergeordnetes Element f√ºr unser Set festlegen.  Es sollte ber√ºcksichtigt werden, dass wir, wenn wir Einschr√§nkungen mithilfe des Einschr√§nkungstags festlegen, alle Einschr√§nkungen aus dem √ºbergeordneten Satz neu definieren.  Um dies zu vermeiden, k√∂nnen Sie bestimmte Attribute in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tags</a> festlegen, sodass nur diese ersetzt werden. <br><br><img src="https://habrastorage.org/webt/vz/ff/zb/vzffzb5u7rlwpayywz7zfm6gnyk.png"><br><br>  In unserem Fall bedeutet dies, dass wir im Pass-Set das Layout-Tag nicht definieren, sondern vom √ºbergeordneten Tag kopieren.  Wir √ºberschreiben jedoch Transform. Daher ersetzen wir alle im Transform-Tag angegebenen Attribute durch unsere eigenen, in diesem Fall eine √Ñnderung der Skalierung. <br><br>  So einfach ist es, mit MotionLayout ein neues Element hinzuzuf√ºgen und es nahtlos in die Animationen unserer Szene zu integrieren. <br><br><img src="https://habrastorage.org/webt/_-/73/jp/_-73jp-vstz02uondgcnyzwcxqe.gif"><br><br><h3>  Die Animation endlos machen </h3><br><br>  Nachdem die Animation abgeschlossen ist, kann die oberste Karte nicht mehr weggewischt werden, da sie jetzt zu einer untersten Karte geworden ist.  Um endlose Animationen zu erhalten, m√ºssen Sie die Karten austauschen. <br><br>  Zuerst wollte ich dies mit einem neuen √úbergang tun: <br><br><pre> <code class="kotlin hljs">&lt;Transition    app:autoTransition=<span class="hljs-string"><span class="hljs-string">"jumpToEnd"</span></span>    app:constraintSetEnd=<span class="hljs-string"><span class="hljs-string">"@+id/rest"</span></span>    app:constraintSetStart=<span class="hljs-string"><span class="hljs-string">"@+id/offScreenLike"</span></span>    app:duration=<span class="hljs-string"><span class="hljs-string">"0"</span></span> /&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/jb/6h/lz/jb6hlzynphpyptximrzq1wgfqfw.gif"><br><br>  Die gesamte Animation wird so abgespielt, wie sie sollte.  Jetzt haben wir einen Kartenstapel, den Sie endlos durchziehen k√∂nnen! <br><br>  Mit einem kleinen Schlag bemerkte ich etwas.  Der √úbergang zum Ende der Deck-Animation stoppt, wenn Sie die Karte ber√ºhren.  Obwohl die Animationsdauer Null ist, stoppt sie immer noch, was schlecht ist. <br><br><img src="https://habrastorage.org/webt/yv/nq/mo/yvnqmowevaznpjimh5kbtiplwco.gif"><br><br>  Ich konnte nur auf eine Weise gewinnen - indem ich den aktiven √úbergang in MotionLayout programmgesteuert √§nderte. <br><br>  Dazu setzen wir nach Abschluss der Animation einen R√ºckruf.  Sobald offScreenLike und offScreenPass abgeschlossen sind, setzen wir den √úbergang einfach wieder in den Ruhezustand zur√ºck und setzen den Fortschritt auf Null. <br><br><pre> <code class="kotlin hljs">motionLayout.setTransitionListener(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : TransitionAdapter() {    <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTransitionCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(motionLayout: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">, currentId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {        <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (currentId) {            R.id.offScreenPass,            R.id.offScreenLike -&gt; {                motionLayout.progress = <span class="hljs-number"><span class="hljs-number">0f</span></span>                motionLayout.setTransition(R.id.rest, R.id.like)            }        }    }   })</code> </pre> <br>  Es spielt keine Rolle, welchen √úbergang wir setzen, bestehen oder m√∂gen, wenn wir wischen, wechseln wir zum gew√ºnschten. <br><br><img src="https://habrastorage.org/webt/li/9b/yo/li9byopqw8itzxzsgj2wgwbufxm.gif"><br><br>  Es sieht genauso aus, aber die Animation h√∂rt nicht auf!  Lass uns weitermachen! <br><br><h3>  Datenbindung </h3><br>  Erstellen Sie Testdaten, die auf den Karten angezeigt werden sollen.  Im Moment beschr√§nken wir uns darauf, die Hintergrundfarbe jeder Karte zu √§ndern. <br><br>  Wir erstellen ein ViewModel mit einer svayp-Methode, die nur neue Daten ersetzt.  Binden Sie es auf folgende Weise an Aktivit√§t: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> viewModel = ViewModelProviders .of(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(SwipeRightViewModel::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewModel</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modelStream</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">observe</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Observer { bindCard(it) }) motionLayout.setTransitionListener(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : TransitionAdapter() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTransitionCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(motionLayout: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">, currentId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (currentId) { R.id.offScreenPass, R.id.offScreenLike -&gt; { motionLayout.progress = <span class="hljs-number"><span class="hljs-number">0f</span></span> motionLayout.setTransition(R.id.rest, R.id.like) viewModel.swipe() } } } })</code> </pre><br>  Es bleibt, um ViewModel √ºber den Abschluss der Wischanimation zu informieren, und es aktualisiert die aktuell angezeigten Daten. <br><br><img src="https://habrastorage.org/webt/vl/j6/ar/vlj6arofcxa3lc7ny2z-ww1yxxg.gif"><br><br><h2>  Popup-Symbole </h2><br>  F√ºgen Sie zwei Ansichten hinzu, die beim Streichen auf einer der Seiten des Bildschirms angezeigt werden (nur eine wird unten angezeigt, die zweite wird gespiegelt). <br><br><pre> <code class="kotlin hljs">&lt;ImageView android:id=<span class="hljs-string"><span class="hljs-string">"@+id/likeIndicator"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"0dp"</span></span> /&gt;</code> </pre><br>  F√ºr die Karten m√ºssen Sie nun die Animationszust√§nde mit diesen Ansichten festlegen. <br><br><pre> <code class="kotlin hljs">&lt;ConstraintSet android:id=<span class="hljs-string"><span class="hljs-string">"@id/rest"</span></span>&gt;    &lt;!-- ... --&gt;    &lt;Constraint android:id=<span class="hljs-string"><span class="hljs-string">"@+id/like"</span></span>&gt;        &lt;Layout            android:layout_width=<span class="hljs-string"><span class="hljs-string">"40dp"</span></span>            android:layout_height=<span class="hljs-string"><span class="hljs-string">"40dp"</span></span>            app:layout_constraintBottom_toBottomOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>            app:layout_constraintStart_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>            app:layout_constraintTop_toTopOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> /&gt;        &lt;Transform            android:scaleX=<span class="hljs-string"><span class="hljs-string">"0.5"</span></span>            android:scaleY=<span class="hljs-string"><span class="hljs-string">"0.5"</span></span> /&gt;        &lt;PropertySet android:alpha=<span class="hljs-string"><span class="hljs-string">"0"</span></span> /&gt;    &lt;/Constraint&gt;   &lt;/ConstraintSet&gt; &lt;ConstraintSet    android:id=<span class="hljs-string"><span class="hljs-string">"@+id/like"</span></span>    app:deriveConstraintsFrom=<span class="hljs-string"><span class="hljs-string">"@id/rest"</span></span>&gt;    &lt;!-- ... --&gt;    &lt;Constraint android:id=<span class="hljs-string"><span class="hljs-string">"@+id/like"</span></span>&gt;        &lt;Layout            android:layout_width=<span class="hljs-string"><span class="hljs-string">"100dp"</span></span>            android:layout_height=<span class="hljs-string"><span class="hljs-string">"100dp"</span></span>            app:layout_constraintBottom_toBottomOf=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>            app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>            app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>            app:layout_constraintTop_toTopOf=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span> /&gt;        &lt;Transform            android:scaleX=<span class="hljs-string"><span class="hljs-string">"1"</span></span>            android:scaleY=<span class="hljs-string"><span class="hljs-string">"1"</span></span> /&gt;        &lt;PropertySet android:alpha=<span class="hljs-string"><span class="hljs-string">"1"</span></span> /&gt;    &lt;/Constraint&gt; &lt;/ConstraintSet&gt;</code> </pre><br>  Es ist nicht erforderlich, Einschr√§nkungen f√ºr Animationen festzulegen, die √ºber den Bildschirm hinausgehen, da sie von den Eltern geerbt werden.  Und in unserem Fall ist dies ein Schlagzustand. <br><br>  Das ist alles was wir tun m√ºssen.  Jetzt k√∂nnen Sie Animationsketten ganz einfach Komponenten hinzuf√ºgen. <br><br><img src="https://habrastorage.org/webt/wg/4g/1g/wg4g1grirk3zwqrfzwyahfp8i3i.gif"><br><br><h2>  F√ºhren Sie die Animation programmgesteuert aus </h2><br><br>  Wir k√∂nnen zwei Schaltfl√§chen auf den Karten erstellen, damit der Benutzer nicht nur wischen, sondern auch √ºber die Schaltfl√§chen steuern kann. <br><br>  Jede Schaltfl√§che startet dieselbe Animation wie das Wischen. <br><br>  Abonnieren Sie wie gewohnt Schaltfl√§chenklicks und starten Sie die Animation direkt auf dem MotionLayout-Objekt: <br><br><pre> <code class="kotlin hljs">likeButton.setOnClickListener {    motionLayout.transitionToState(R.id.like) } passButton.setOnClickListener {    motionLayout.transitionToState(R.id.pass) }</code> </pre><br>  Wir m√ºssen sowohl der oberen als auch der unteren Karte Schaltfl√§chen hinzuf√ºgen, damit die Animation kontinuierlich abgespielt wird.  F√ºr die untere Karte ist jedoch kein Klickabonnement erforderlich, da es entweder nicht sichtbar ist oder die obere Karte animiert ist und wir sie nicht unterbrechen m√∂chten. <br><br><img src="https://habrastorage.org/webt/ic/zj/_v/iczj_vz8nrpdzlxtmjsaqc3bmiu.gif"><br><br>  Ein weiteres gutes Beispiel daf√ºr, wie MotionLayout Status√§nderungen f√ºr uns handhabt.  Lassen Sie uns die Animation etwas verlangsamen: <br><br><img src="https://habrastorage.org/webt/d6/bk/ne/d6bkne2bvugopppwypug25l30m8.gif"><br><br>  Sehen Sie sich den √úbergang an, den MotionLayout ausf√ºhrt, wenn pass wie ersetzt.  Die Magie! <br><br><h1>  Wischen Sie die Karte entlang der Kurve </h1><br>  Angenommen, es gef√§llt uns, wenn sich die Karte nicht in einer geraden Linie, sondern in einer Kurve bewegt (um ehrlich zu sein, wollte ich das nur versuchen). <br><br>  Dann m√ºssen Sie KeyPosition f√ºr die Bewegung in beide Richtungen definieren, damit der Bewegungspfad durch einen Bogen gekr√ºmmt wird. <br><br>  F√ºgen Sie dies der Bewegungsszene hinzu: <br><br><pre> <code class="kotlin hljs">&lt;Transition    app:constraintSetEnd=<span class="hljs-string"><span class="hljs-string">"@+id/like"</span></span>    app:constraintSetStart=<span class="hljs-string"><span class="hljs-string">"@+id/rest"</span></span>    app:duration=<span class="hljs-string"><span class="hljs-string">"300"</span></span>&gt;    &lt;!-- ... --&gt;    &lt;KeyFrameSet&gt;        &lt;KeyPosition            app:drawPath=<span class="hljs-string"><span class="hljs-string">"path"</span></span>            app:framePosition=<span class="hljs-string"><span class="hljs-string">"50"</span></span>            app:keyPositionType=<span class="hljs-string"><span class="hljs-string">"pathRelative"</span></span>            app:motionTarget=<span class="hljs-string"><span class="hljs-string">"@id/topCard"</span></span>            app:percentX=<span class="hljs-string"><span class="hljs-string">"0.5"</span></span>            app:percentY=<span class="hljs-string"><span class="hljs-string">"-0.1"</span></span> /&gt;           &lt;/KeyFrameSet&gt; &lt;/Transition&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/ij/z4/4m/ijz44micij7kdu81k4-tc-zggjc.gif"><br>  Jetzt bewegt sich die Karte entlang eines nicht banal gekr√ºmmten Pfades.  Magisch! <br><br><h1>  Fazit </h1><br>  Wenn Sie die Menge an Code, die ich beim Erstellen dieser Animationen erhalten habe, mit unserer aktuellen Implementierung √§hnlicher Animationen in der Produktion vergleichen, ist das Ergebnis erstaunlich. <br><br>  MotionLayout behandelt unmerklich das Abbrechen von √úberg√§ngen (z. B. beim Ber√ºhren), das Erstellen von Animationsketten, das √Ñndern von Eigenschaften w√§hrend √úberg√§ngen und vieles mehr.  Dieses Tool √§ndert grundlegend alles und vereinfacht die UI-Logik erheblich. <br><br>  Es gibt noch einige andere Dinge, an denen es sich zu arbeiten lohnt (haupts√§chlich das Deaktivieren von Animationen und das bidirektionale Scrollen in RecyclerView), aber ich bin sicher, dass dies l√∂sbar ist. <br><br>  Denken Sie daran, dass sich die Bibliothek noch im Beta-Status befindet, aber bereits viele aufregende M√∂glichkeiten f√ºr uns er√∂ffnet.  Wir freuen uns auf die Ver√∂ffentlichung von MotionLayout, das sich in Zukunft sicherlich mehr als einmal als n√ºtzlich erweisen wird.  Sie k√∂nnen die voll funktionsf√§hige Anwendung aus diesem Artikel im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository sehen</a> . <br><br>  <i>PS: Und da sie mir das Wort als √úbersetzer gegeben haben, hat unser Android-Team einen Platz f√ºr einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwickler</a> .</i>  <i>Vielen Dank f√ºr Ihre Aufmerksamkeit.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458854/">https://habr.com/ru/post/de458854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458842/index.html">Geduld und Arbeit werden den gesamten Text extrahieren</a></li>
<li><a href="../de458844/index.html">Silozerst√∂rung durch VeriSM ‚Ñ¢ -Anpassungsansatz</a></li>
<li><a href="../de458846/index.html">So entwickeln Sie mit Unity einen weiteren Plattformer. Ein weiteres Tutorial</a></li>
<li><a href="../de458848/index.html">Rust 1.36.0 Release: Zuk√ºnftiges Merkmal, Allokationsstabilisierung und MaybeUninit <T></a></li>
<li><a href="../de458850/index.html">Lerne Englisch billig und effizient. Teil 2</a></li>
<li><a href="../de458856/index.html">G√ºnstige und teure AAA-Batterien</a></li>
<li><a href="../de458860/index.html">Optimieren der Linux-Kernelparameter zur Optimierung von PostgreSQL</a></li>
<li><a href="../de458864/index.html">Bot-Entwickler-Wettbewerb f√ºr TamTam</a></li>
<li><a href="../de458866/index.html">Wie der Team Balancer in World of Tanks Blitz funktioniert</a></li>
<li><a href="../de458868/index.html">Rauschen in Big Data. Entropieanalyse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>