<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçê ü§ôüèæ üíØ Station m√©t√©o autonome sur le contr√¥leur ATMEGA328P et aliment√©e par batterie avec un capteur √† distance sans fil ‚ô†Ô∏è üë©üèΩ‚Äçüîß üêà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Am√©liorant mon thermostat d'ambiance, dont j'ai parl√© plus t√¥t , je me suis propos√© de le compl√©ter avec un capteur de temp√©rature sans fil pour mesur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Station m√©t√©o autonome sur le contr√¥leur ATMEGA328P et aliment√©e par batterie avec un capteur √† distance sans fil</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470381/"><p>  Am√©liorant mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">thermostat d'ambiance, dont j'ai parl√© plus t√¥t</a> , je me suis propos√© de le compl√©ter avec un capteur de temp√©rature sans fil pour mesurer la temp√©rature de l'air ext√©rieur, d'assembler un thermostat aliment√© par batterie et de remplacer les modules √©metteur-r√©cepteur RF 433 MHz par une autre paire de modules radio avec une port√©e de communication plus longue √† une tension d'alimentation non plus de 3V.  Au cours de la r√©solution de ces probl√®mes, une station m√©t√©orologique autonome a vu le jour, qui sera discut√©e ci-dessous. </p><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dd/vj/6r/ddvj6rih_mxyi4izpiz4iplozik.gif"></div><br><p>  La station m√©t√©o se compose de deux n≈ìuds, appelons-les un analyseur et un thermom√®tre pour plus de simplicit√©.  Communication entre les n≈ìuds - sans fil, par voie hertzienne. </p><br><p>  L'analyseur est bas√© sur le contr√¥leur ATMEGA328P et mesure la temp√©rature et l'humidit√© dans la pi√®ce (capteur de temp√©rature et d'humidit√© DHT22) et la tension d'alimentation de l'analyseur, fournie par deux piles AA de 1,5 V.  Le contr√¥leur re√ßoit un signal du r√©cepteur LoRa, qui re√ßoit des informations du thermom√®tre (capteur √† distance) sur l'air.  Les informations du contr√¥leur s'affichent sur l'√©cran LCD du NOKIA 5110. </p><br><p>  Le thermom√®tre, √©galement mont√© sur le contr√¥leur ATMEGA328P, mesure la temp√©rature de l'air ext√©rieur (capteur de temp√©rature DS18B20) et la tension d'alimentation de l'unit√© distante, organis√©e sur deux piles AA de 1,5 V. Le transmetteur LoRa de cette unit√© transf√®re la temp√©rature et la tension d'alimentation √† l'analyseur. </p><br><p>  Le contr√¥leur ATMEGA328P et l'√©metteur LoRa du thermom√®tre sont mis en mode veille pour √©conomiser la batterie apr√®s les mesures et envoyer des informations.  La tension d'alimentation du capteur DS18B20 est appliqu√©e par programme uniquement pendant la dur√©e de la mesure de temp√©rature.  La mesure et l'envoi des donn√©es du thermom√®tre s'effectuent sur une p√©riode d'environ une minute. </p><br><p>  Dans le m√™me mode travail-sommeil, l'analyseur fonctionne √©galement.  La dur√©e du contr√¥leur et de l'analyseur du r√©cepteur pendant plusieurs secondes plus d'une minute.  Ceci est fait pour recevoir en toute confiance le signal du thermom√®tre - apr√®s tout, le fonctionnement du thermom√®tre et de l'analyseur ne sont pas synchronis√©s.  L'ATMEGA328P et le r√©cepteur LoRa sont ensuite mis en mode veille pendant 14 minutes avant de se r√©veiller et de d√©marrer le cycle suivant.  Le DHT22 fournit uniquement de l'√©nergie pendant la mesure. </p><br><p>  Pour programmer le mode veille des contr√¥leurs ATMEGA328P, la biblioth√®que LowPower.h est utilis√©e. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avec la d√©charge des batteries, la valeur de la tension diminue sur elles.</a> </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/hi/6z/obhi6ztutl3wckifbjzbg0p-pcs.png"></div><br><p>  La limite inf√©rieure de la tension de fonctionnement du contr√¥leur ATMEGA328P est de 1,8 V.  Dans le m√™me temps, l'installation en usine du fusible ATMEGA328P a √©t√© effectu√©e pour surveiller le seuil de la tension d'alimentation de 2,7 V, il est donc n√©cessaire de changer les param√®tres d'usine du fusible au seuil de surveillance de 1,8 V pour garantir le fonctionnement du contr√¥leur lorsqu'il est aliment√© par des piles √©puis√©es. </p><br><p>  Le g√©n√©rateur du contr√¥leur interne peut ne pas d√©marrer √† une fr√©quence de 16 MHz avec une tension d'alimentation de 3 V ou l√©g√®rement inf√©rieure.  Les deux contr√¥leurs fonctionnent avec du quartz 16 MHz √† une tension d'alimentation r√©duite de 2,7 ... 2,8 V, donc je n'ai pas chang√© le quartz 16 MHz en 8 MHz. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/kl/rf/orklrfdoalqoh5d3gsqxde-9x_c.jpeg"></div><br><p>  Pour assembler l'appareil, vous aurez besoin de composants, dont la liste et leur co√ªt estim√© aux prix du site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AliExpress</a> sont indiqu√©s dans le tableau. </p><br><table border="1"><tbody><tr><td>  <strong>Composant</strong> </td><td>  <strong>Prix, $</strong> </td></tr><tr><td colspan="2">  <em>analyseur</em> </td></tr><tr><td>  Contr√¥leur ATMEGA328P-PU </td><td>  1,59 </td></tr><tr><td>  Capteur de temp√©rature et d'humidit√© DHT22 </td><td>  2,34 </td></tr><tr><td>  √âmetteur LoRa Ra-01 </td><td>  3,95 </td></tr><tr><td>  LCD NOKIA 5110 </td><td>  1,91 </td></tr><tr><td>  Carte de montage (montage), fils de montage, piles AA, r√©sonateur √† quartz 16 MHz, r√©sistances, etc. </td><td>  4.00 </td></tr><tr><td colspan="2">  <em>thermom√®tre</em> </td></tr><tr><td>  Contr√¥leur ATMEGA328P-PU </td><td>  1,59 </td></tr><tr><td>  Capteur de temp√©rature DS18B20 </td><td>  0,63 </td></tr><tr><td>  √âmetteur LoRa Ra-01 </td><td>  3,95 </td></tr><tr><td>  Carte de d√©veloppement (fibre de verre), fils de montage, piles AA, r√©sonateur √† quartz 16 MHz, r√©sistances, etc. </td><td>  4.00 </td></tr><tr><td>  <strong>Total (environ):</strong> </td><td>  <strong>24</strong> </td></tr></tbody></table><br><p></p><h4>  Analyseur </h4><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/of/fu/xd/offuxdrjbzlmia_xnnsfqeliisc.jpeg"></div><br><p>  Le cerveau de l'analyseur est un contr√¥leur ATMEGA328P.  Il re√ßoit les signaux du capteur DHT22 et, via le protocole SPI, communique avec le r√©cepteur LoRa et l'√©cran NOKIA 5110. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/b3/wl/9b/b3wl9b2zijmxgg8yso3xxt1faxq.png"></div><br><p></p><p>  Il existe de nombreuses plaintes sur Internet concernant la faible pr√©cision du DHT22.  Aujourd'hui, il existe une alternative: des capteurs de temp√©rature et d'humidit√© plus modernes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HTU21 (GY21)</a> , (Vcc = 3 ... 5 V), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Si7021</a> , (Vcc = 1,9 ... 3,6 V), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SHT21</a> , (Vcc = 2.1 .... 3,6 V). </p><br><p>  J'utilise le DHT22, car la diff√©rence entre les lectures d'humidit√© de mon √©chantillon de ce capteur et du thermo-hygrom√®tre LaCrosse WS-9024IT disponible dans le commerce ne d√©passe pas 8 unit√©s, ce qui est tout √† fait acceptable √† des fins domestiques.  L'√©cart entre les lectures d'humidit√© augmente consid√©rablement si la tension d'alimentation du DHT22 est inf√©rieure √† 3V.  Cela est compr√©hensible, car la tension d'alimentation du DHT22 doit √™tre comprise entre 3 et 5 V.  En r√©sum√© - id√©alement dans ces conditions, le capteur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Si7021</a> s'int√®gre dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">circuit de</a> l'analyseur. </p><br><p>  Dans l'image ci-dessous - le brochage des √©l√©ments de la station m√©t√©o. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/ut/go/gqutgob1fbq1hd85xtnovdvphfw.png"></div><br><p></p><p>  Fusion et bien d'autres contr√¥leurs, y compris ATMEGA328P, peuvent √™tre lus et modifi√©s avec l'utilitaire SinaProg.  Si c'est la premi√®re fois que vous rencontrez ce programme, alors malgr√© l'interface intuitive, n'essayez pas de commencer √† travailler avec lui apr√®s avoir install√© l'application.  Lisez d'abord <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cet article</a> dans lequel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">HWman</a> fournit les modules compl√©mentaires SinaProg n√©cessaires lors de l'utilisation de la carte Arduino UNO comme chargeur de d√©marrage. </p><br><p>  Je vous conseille de lire d'abord les r√©glages d'usine de la fusion ATMEGA328P et de sauvegarder leurs valeurs afin d'y revenir en cas de panne.  Dans mes contr√¥leurs, les param√®tres d'usine pour le bit de fusible sont: <strong>LOW: 0xFF, HIGH: 0xDE, EXTENDED: 0x05</strong> (Vcc = 2.7V, BODLEVEL = 101).  Nouveaux fusibles pour surveiller le seuil de <strong>1,8 V</strong> que vous souhaitez d√©finir: <strong>LOW: 0xFF, HIGH: 0xDE, EXTENDED: 0x06</strong> (Vcc = 1,8 V, BODLEVEL = 110). </p><br><p>  L'esquisse de l'analyseur pour le chargement dans l'ATMEGA328P se trouve sous le becquet. </p><br><div class="spoiler">  <b class="spoiler_title">croquis de l'analyseur</b> <div class="spoiler_text">  `` `cpp <br>  / * <br>  Station m√©t√©o autonome sur le contr√¥leur ATMEGA328P et aliment√©e par batterie avec un capteur √† distance sans fil, un analyseur <br>  https://habr.com/en/post/470381/ <br>  * / <br><br>  #include &lt;SPI.h&gt; <br>  #include &lt;LoRa.h&gt; <br><br>  #include &lt;DHT.h&gt; <br>  #define DHTPIN 3 // √† quelle broche num√©rique nous sommes connect√©s <br>  #define DHTTYPE DHT22 // DHT 22 (AM2302), AM2321 <br>  DHT DHT (DHTPIN, DHTTYPE); <br><br>  √©tain flottant = 0; <br>  int Hin = 0; <br>  float BatteryInLevel;  // tension de base de la batterie <br>  String LoRaData, Tout_str, BatteryInLevel_str, BatteryOutLevel_str; <br><br>  // dormir <br>  #include &lt;LowPower.h&gt; <br>  #define PowerDHT (4) // Broche d'alimentation DHT22 <br>  unsigned int sleepCounter; <br><br>  // Nokia 5110 <br>  #include &lt;SPI.h&gt; <br>  #include &lt;Adafruit_GFX.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br>  #include &lt;Adafruit_PCD8544.h&gt; //https://esp8266.ru/forum/threads/esp8266-5110-nokia-lcd.1143/#post-16942 <br><br>  // minuterie <br>  #include &lt;SimpleTimer.h&gt; <br>  Minuterie SimpleTimer; <br><br>  Affichage Adafruit_PCD8544 = Adafruit_PCD8544 (5, 7, 6); <br><br>  void sendSensor () { <br>  digitalWrite (PowerDHT, 1); <br>  retard (2000); <br>  Hin = dht.readHumidity (); <br>  Tin = dht.readTemperature (); <br><br>  / * if (isnan (Hin) || isnan (Tin)) { <br>  // Serial.println ("Impossible de lire √† partir du capteur DHT!"); <br>  retour <br>  } * / <br><br>  digitalWrite (PowerDHT, 0); <br><br>  // mesure de la tension de la batterie: <br>  analogReference (INTERNAL); <br>  int sensorValue = analogRead (A4); <br>  BatteryInLevel = (sensorValue * 3.2 / 1024); <br>  } <br><br>  void draw () { <br>  display.clearDisplay (); <br>  // √âtain <br>  { <br>  display.setTextSize (2); <br>  display.setCursor (8, 0); <br>  display.println (√âtain, 1);  // une d√©cimale <br>  display.setCursor (68, 0); <br>  display.println ("C"); <br>  } <br>  // hin <br>  { <br>  display.setTextSize (2); <br>  display.setCursor (8, 16); <br>  display.println (String (Hin) + "%"); <br>  } <br>  // Tout <br>  { <br>  char chr_Tout [12]; <br><br>  Tout_str.toCharArray (chr_Tout, 5); <br>  display.setTextSize (1); <br>  display.setCursor (50, 16); <br>  display.println (String (chr_Tout) + "C"); <br>  } <br>  // Niveau de sortie de la batterie <br>  { <br>  char chr_BatteryOutLevel [12]; <br><br>  BatteryOutLevel_str.toCharArray (chr_BatteryOutLevel, 4); <br>  display.setTextSize (1); <br>  display.setCursor (2, 32); <br>  display.println ("BAT Out:" + String (chr_BatteryOutLevel) + "V"); <br>  } <br>  // Niveau de batterie <br>  { <br>  display.setTextSize (1); <br>  display.setCursor (2, 40); <br>  display.println ("BAT In:‚Äû); <br>  display.setCursor (56, 40); <br>  display.println (BatteryInLevel, 1);  // une d√©cimale <br>  display.setCursor (74, 40); <br>  display.println ("V"); <br>  } <br><br>  display.display (); <br>  / * <br>  Serial.println ("Tin:" + String (Tin) + "* C"); <br>  Serial.println ("Hin:" + String (Hin) + "%"); <br>  Serial.println ("Tout:" + String (Tout_str) + "* C"); <br>  Serial.println ("BAT_In:" + String (BatteryInLevel) + "V"); <br>  Serial.println ("BAT_Out:" + String (BatteryOutLevel_str) + "V"); <br>  Serial.println ("......"); <br>  * / <br>  } <br><br>  void sleepDevice () { <br>  // sleepCounter = 65 - 10 min <br>  // sleepCounter = 91 - 14 min <br>  pour (sleepCounter = 91; sleepCounter&gt; 0; sleepCounter--) // 91 !!! <br>  { <br>  LoRa.sleep (); <br>  LowPower.powerDown (SLEEP_8S, ADC_OFF, BOD_OFF); <br>  } <br>  LoRa.sleep (); <br>  } <br><br>  void SignalReception () { <br>  // essaie d'analyser le paquet <br>  int packetSize = LoRa.parsePacket (); <br>  if (packetSize) { <br>  // lire le paquet <br>  while (LoRa.available ()) { <br>  LoRaData = LoRa.readString (); <br>  // Serial.println ("Accepted:" + (LoRaData)); <br>  } <br>  int pos1 = LoRaData.indexOf ('#'); <br>  Tout_str = LoRaData.substring (0, pos1); <br>  BatteryOutLevel_str = LoRaData.substring (pos1 + 1, LoRaData.length ()); <br>  } <br>  } <br><br>  void setup () { <br>  //Serial.begin(9600); <br>  pinMode (PowerDHT, OUTPUT); <br><br>  // initialise et efface l'affichage <br>  display.begin (); <br>  display.clearDisplay (); <br>  display.display (); <br>  display.setContrast (60);  // r√©gler le contraste <br><br>  display.clearDisplay (); <br>  display.setTextSize (2); <br>  display.setCursor (12, 16); <br>  display.println ("&gt;&gt;&gt;&gt;&gt;");  // indication du d√©but du travail lorsqu'il est allum√© <br>  display.display (); <br><br>  dht.begin (); <br>  sendSensor (); <br>  draw (); <br><br>  while (! LoRa.begin (433E6)) { <br>  //Serial.println ("."); <br>  retard (500); <br>  } <br>  // La plage du mot de synchronisation est comprise entre "0 - 0xFF". <br>  LoRa.setSyncWord (0xF3); <br>  //Serial.println (initialisation wonLoRa "); <br>  timer.setInterval (20000, sendSensor); <br>  timer.setInterval (5000, tirage); <br>  timer.setInterval (65000, sleepDevice); <br>  } <br><br>  boucle vide () { <br>  R√©ception du signal (); <br>  timer.run (); <br>  } <br>  `` `` </div></div><br><br><p>  Pour travailler avec les contr√¥leurs ATMEGA328P, j'utilise la carte Arduino UNO comme programmeur.  Il y a une bonne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o sur</a> Youtube <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur l'installation du chargeur de d√©marrage</a> et le t√©l√©chargement de croquis sur le contr√¥leur ATMEGA328 en utilisant la carte Arduino UNO. </p><br><p>  L'esquisse commentait les commandes de sortie vers le moniteur de port s√©rie (s√©rie).  D√©commentez si n√©cessaire. </p><br><p>  Le cycle commence par l'√©coute de la diffusion et la r√©ception d'informations par le r√©cepteur LoRa.  La minuterie r√®gle la dur√©e d'√©coute - 65 secondes.  √Ä ce moment, avec une p√©riode de 5 secondes, les informations sur l'√©cran NOKIA sont mises √† jour et avec une p√©riode de 20 secondes (3 fois), le capteur DHT22 prend des mesures de temp√©rature, d'humidit√©, ainsi que le niveau de tension des batteries via l'une des entr√©es analogiques du contr√¥leur.  La tension d'alimentation du DHT22 n'est appliqu√©e que pendant les mesures avec un retard minimum de 2 secondes, pendant lesquelles le capteur fonctionne toujours.  La sortie de l'ADC dans l'esquisse est mise √† l'√©chelle de la tension des nouvelles batteries, qui est de 3,2 V (1,6 V x 2).  Le temps d'√©coute de l'air a √©t√© choisi un peu plus de 1 min pour recevoir en toute confiance un paquet d'un thermom√®tre qui fonctionne sur la transmission avec une p√©riode de 1 min, mais plus sur celui ci-dessous.  Ensuite, √† la 62e seconde, le contr√¥leur et le r√©cepteur sont mis en mode veille, ce qui dure environ 14 minutes, c'est-√†-dire  la dur√©e du cycle ¬´travail / sommeil¬ª de l'analyseur est d'environ 15 minutes.  Je note que le mode veille de l'analyseur est une mesure forc√©e con√ßue pour r√©duire consid√©rablement la consommation. </p><br><p>  A titre de comparaison, le tableau ci-dessous pr√©sente les caract√©ristiques du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">thermohygrom√®tre LaCrosse WS-9024IT</a> et de l'analyseur de ce projet. </p><br><p></p><table border="1"><tbody><tr><td>  <strong>Param√®tre</strong> </td><td>  <strong>LaCrosse WS-9024IT</strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td>  La nutrition </td><td>  2xAA, 3B, Durasell </td><td>  2xAA, 3V, GP Ultra +, 1800 mAh </td></tr><tr><td>  Consommation de sommeil </td><td></td><td>  350 ŒºA (10 ŒºA) </td></tr><tr><td>  Dur√©e du sommeil </td><td></td><td>  14 min </td></tr><tr><td>  Consommation op√©rationnelle </td><td>  &lt;200 ŒºA </td><td>  12-18 mA </td></tr><tr><td>  Dur√©e du travail </td><td></td><td>  environ 1 min </td></tr><tr><td>  P√©riode de travail / cycle de sommeil </td><td></td><td>  15 min </td></tr><tr><td>  Dur√©e de fonctionnement </td><td>  environ 2 ans </td><td>  environ 2,5 mois </td></tr></tbody></table><br><p>  La consommation actuelle de LaCrosse danse beaucoup.  Dans le tableau, j'ai donn√© la valeur mesur√©e maximale pour montrer l'ordre de consommation: pas plus de deux cents microamp√®res. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tg/h0/ke/tgh0kev0vv-b_tmlefcjddxmqlg.gif"></div><br><p>  Je voulais compl√©ter le tableau avec les r√©sultats de d√©veloppements amateurs similaires, mais je n'ai rien trouv√©.  Probablement parce que la plupart des amateurs transmettent des informations des capteurs √† un ordinateur, une tablette, un smartphone ou en transit vers l'un des services du r√©seau o√π le probl√®me de la dur√©e de vie de la batterie n'existe tout simplement pas. </p><br><p>  Le principal contributeur au sommeil de l'analyseur (350 ŒºA) est l'√©cran LCD.  Si vous l'√©teignez, la consommation chutera √† 10 ŒºA.  La consommation de pointe de 18 mA se produit lorsque le r√©cepteur LoRa re√ßoit le signal de l'√©metteur, mais le signal prend quelques microsecondes.  Ce temps est tr√®s court par rapport √† la minute o√π le r√©cepteur est en mode √©coute et la consommation de 10 mA, donc je n'ai pas pris en compte ce pic √† court terme lors du calcul du temps de fonctionnement sur un jeu de piles. </p><br><p>  Calcul des heures de travail. <br>  Consommation de courant moyenne: 10 mA / 15 + 0,35 mA = 1,0 mA, o√π 15 est le rapport cyclique.  Dur√©e de fonctionnement: 1800 mA * heure / 1,0 mA = 1800 heures (2,5 mois). <br>  Je vais clarifier: <br>  - Le calcul est tr√®s approximatif. <br>  - Les heures de fonctionnement de LaCrosse sont bas√©es sur ma propre exp√©rience.  J'ai cet appareil depuis longtemps. <br></p><br><h4>  Thermom√®tre </h4><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/tb/nx/rptbnxv-nlwql3ap7i1rcjdf_wk.jpeg"></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La capacit√© et la tension des batteries par temps froid sont consid√©rablement r√©duites</a> .  Par cons√©quent, afin de ne pas exposer les batteries et l'appareil dans son ensemble √† de tels tests, je n'ai sorti que le capteur de temp√©rature DS18B20 √† l'ext√©rieur de la pi√®ce, et l'unit√© et les piles sont dans la pi√®ce.  Le DS18B20 se connecte √† la carte h√¥te avec un mince c√¢ble √† trois fils.  J'ai rep√©r√© cette solution dans ma station m√©t√©o en s√©rie - les d√©veloppeurs sont s√ªrs qu'il y aura toujours un espace dans l'appartement pour la pose de fils d'un diam√®tre de plusieurs millim√®tres. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/ic/vq/me/icvqmeepxsfgd9ut_hhcais3xle.jpeg"></div><br><p>  Les fusibles du thermom√®tre ATMEGA328P sont les m√™mes que pour l'analyseur. </p><br><p>  L'ensemble thermom√®tre est √©galement construit sur le contr√¥leur ATMEGA328P.  Il re√ßoit le signal du capteur DS18B20, mesure la tension d'alimentation et contr√¥le l'√©metteur LoRa. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0d/ie/ww/0diewwzov4r4gwbrojlrvbyzbrq.png"></div><br><p></p><p>  Le croquis du thermom√®tre est sous le spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">croquis de thermom√®tre</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*     ATMEGA328P        ,  https://habr.com/ru/post/470381/ */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;OneWire.h&gt; OneWire ds(7); //pin 13, Atmega328P #include &lt;SPI.h&gt; #include &lt;LoRa.h&gt; #include &lt;LowPower.h&gt; #define PowerDS18B20 (6) //pin 12 (Atmega328P), e DS18B20 unsigned int sleepCounter; // ,    float Tout; // int i; //         (20   1 ) String messageTout; // LoRa- float batteryLevel; //   const int batteryPin = A0; // pin 23 (Atmega328P),        void Measurement () { //  byte data[2]; digitalWrite(PowerDS18B20, 1); ds.reset(); ds.write(0xCC); //     (1 ) ds.write(0x44); //    delay(700); ds.reset(); ds.write(0xCC); ds.write(0xBE); //      data[0] = ds.read(); data[1] = ds.read(); Tout = ((data[1] &lt;&lt; 8) | data[0]) * 0.0625; // Serial.println("Tout= "+ String(Tout)); digitalWrite(PowerDS18B20, 0); //   : analogReference(INTERNAL); int sensorValue = analogRead(A0); batteryLevel = (sensorValue * 3.2 / 1024); // Serial.println("BAT= "+ String(batteryLevel)); } void SetSynchLoRa () { int counter = 0; while (!LoRa.begin(433E6) &amp;&amp; counter &lt; 10) { // Serial.print("."); counter++; delay(500); } LoRa.setTxPower(4); //  2-20  /* if (counter == 10) { // Serial.println("Failed to initialize ..."); }*/ LoRa.setSyncWord(0xF3); } void SendMessage () { //   (,  ) messageTout = String(Tout) + "#" + String(batteryLevel); // Serial.println(messageTout); delay(250); LoRa.beginPacket(); LoRa.print(messageTout); LoRa.endPacket(); } void setup() { //Serial.begin(9600); // Serial.println("Initializing ..."); pinMode(PowerDS18B20, OUTPUT); SetSynchLoRa (); } void loop() { //Serial.println(""); //Serial.println("i = " + String(i)); if (i &gt;= 30) { // i &gt;= 30 (1 ) ‚Äî   (,  ‚Äî 1 /1 ) for (sleepCounter = 5; sleepCounter &gt; 0; sleepCounter--) { LoRa.sleep (); LowPower.powerDown(SLEEP_8S, ADC_OFF, BOD_OFF); } Measurement (); SendMessage (); LoRa.sleep (); } else { //   1 ,  ‚Äî 1 /2  Measurement (); SendMessage (); delay (1000); } i++; if (i &gt;= 30) i = 30; //    }</span></span></span></span></code> </pre> </div></div><br><p>  Une paire d'√©metteurs-r√©cepteurs LoRa offre une communication stable √† une distance de 1,5 km avec une visibilit√© directe et jusqu'√† 300 m dans les zones urbaines, bien s√ªr, √† la puissance maximale ou proche de la puissance maximale de l'√©metteur: 17-20 dB.  Pour une connexion stable dans l'appartement, 4 dB suffisaient. </p><br><p>  Au d√©but, lorsque l'alimentation est connect√©e, le thermom√®tre fonctionne en mode intensif pendant une minute.  Il mesure la temp√©rature, la tension des batteries et envoie leurs valeurs dans l'air toutes les 2 secondes.  C'est pour plus de commodit√©.  Supposons que vous n'ayez pas √† attendre une minute lors du remplacement des piles ou du d√©bogage.  Les informations du capteur appara√Ætront sur l'√©cran de l'analyseur dans les premi√®res secondes apr√®s avoir connect√© les piles du thermom√®tre et de l'analyseur.  Naturellement, vous devez vous d√©p√™cher et ne pas faire de diff√©rence de temps pendant plus d'une minute entre la connexion des batteries sur les deux n≈ìuds. </p><br><p>  Ensuite, le capteur √† distance passe en mode normal.  Apr√®s avoir mesur√© et envoy√© des informations qui durent un peu plus que la premi√®re seconde, le contr√¥leur et l'√©metteur sont mis en mode veille logiciel pendant environ 1 minute. </p><br><p>  Calcul des heures de travail. <br>  Consommation de courant moyenne: 14 mA / 60 + 0,005 mA = 0,24 mA, o√π 60 est le rapport cyclique.  Dur√©e de fonctionnement: 1800 mA * heure / 0,24 mA = 7500 heures (10 mois). <br>  Les pr√©cisions pr√©c√©dentes concernant la pr√©cision du temps de fonctionnement calcul√© √† partir d'un seul jeu de batteries restent valables. <br></p><br><p>  Et un tableau de comparaison.  Il contient les r√©sultats de quelques projets similaires sur Internet. </p><br><table border="1"><tbody><tr><td>  <strong>Param√®tre</strong> </td><td>  <strong>LaCrosse WS-9024IT</strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">maniacbug</a></strong> </td><td>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">avs24rus</a></strong> </td><td>  <strong>SadilTM</strong> </td></tr><tr><td>  La nutrition </td><td>  2xAAA, 3B, Durasell </td><td>  3V, CR2450 Renata, 540 mAh </td><td>  3V, CR2450, 550-610 mAh </td><td>  2xAA, 3V, GP Ultra +, 1800 mAh </td></tr><tr><td>  Consommation de sommeil </td><td></td><td>  0,14 mA (?) </td><td>  14 ŒºA </td><td>  5 ŒºA </td></tr><tr><td>  Dur√©e du sommeil </td><td></td><td></td><td></td><td>  1 min </td></tr><tr><td>  Consommation op√©rationnelle </td><td>  &lt;700 ŒºA </td><td>  13,57 mA </td><td>  16 - 18 mA </td><td>  14 mA </td></tr><tr><td>  Dur√©e du travail </td><td></td><td>  0,027 s </td><td></td><td>  1 sec </td></tr><tr><td>  P√©riode de travail / cycle de sommeil </td><td></td><td>  1 min </td><td>  10 min </td><td>  1 min </td></tr><tr><td>  Dur√©e de fonctionnement </td><td>  environ 2 ans </td><td></td><td>  plus de 0,5 an </td><td>  environ 10 mois </td></tr></tbody></table><br><p>  Si les n≈ìuds sont assembl√©s sans erreur, sur l'√©cran, nous verrons l'image suivante: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/vm/ry/-9/vmry-9owzy-rtsulc5mz5ghzh2g.png"></div><br><p>  Les tableaux comparatifs montrent que la consommation de pointe des appareils amateurs est d'un ordre de grandeur sup√©rieur √† celle des fonctions analogues de la LaCrosse industrielle.  Par exemple, 14 mA contre 700 ŒºA pour le capteur √† distance et 10 ... 18 mA contre 200 ŒºA pour l'analyseur.  Une telle diff√©rence frappante dans la consommation maximale s'explique, √† mon avis, par le fait que les contr√¥leurs des circuits amateurs sont programm√©s √† l'aide de la plate-forme Arduino IDE, des fonctions lourdes et des biblioth√®ques et des produits industriels - tr√®s probablement dans l'un des langages de bas niveau ou, par exemple, en C ++ (soit dit en passant, le langage de base d'Arduino) ou C (C).  Si vous utilisez ces langues, je suis s√ªr que vous pouvez atteindre une consommation comparable aux dessins et mod√®les industriels.  Cependant, cela a √©t√© d√©montr√© de mani√®re tr√®s convaincante par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">HWman</a> dans sa publication ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Why Many Don't Like Arduino</a> ¬ª.  L'ex√©cution de l'esquisse la plus simple d'une douzaine de lignes (Blink), r√©alis√©e dans l'IDE Arduino dans un cas et dans un autre - ¬´C simple¬ª, comme le dit l'auteur dans la vid√©o, entra√Æne une perte de performances de 26 fois.  En bref, l'augmentation de la consommation de ressources est un prix pour le confort et un petit effort de la part du programmeur - le reste sera fait par les fonctions ¬´gourmandes¬ª de l'environnement de d√©veloppement pour lui en Arduino.  Je pr√©vois que vous devrez forcer et ma√Ætriser au moins les bases du C / C ++, dont les fonctions sont compil√©es par l'IDE Arduino. </p><br><h4>  Conclusions </h4><br><p>  ‚Ä¢ L'analyseur et le thermom√®tre assembl√©s consomment trop de courant par rapport aux mod√®les industriels. </p><br><p>  ‚Ä¢ Un troisi√®me se propose pour les deux batteries dans les circuits, puis les probl√®mes suivants sont automatiquement r√©solus: il n'est pas n√©cessaire de r√©installer le fusible, le contr√¥leur fonctionne √† une fr√©quence de 16 MHz, les capteurs DHT22, DS18B20 sont loin du seuil inf√©rieur de leur tension d'alimentation.  Ce dernier est important, car la tension d'alimentation n'est pas directement fournie aux capteurs, mais par programmation via la cl√© de la broche du contr√¥leur, sur laquelle elle chute d'environ 1V. </p><br><p>  ‚Ä¢ L'utilisation de modules radio LoRa, avec une puissance d'√©mission programmable de 4 dB, a permis d'√©tablir une connexion stable au sein de l'appartement avec l'alimentation des modules √† partir de deux piles AA. </p><br><h4>  Liens connexes </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ensemble capteur sans fil basse consommation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Capteur d'√©clairage sans fil CR2450</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Capteur de temp√©rature, d'humidit√© et de pression atmosph√©rique sans fil sur nRF52832</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Thermom√®tre sans fil</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transformez Arduino en un programmeur AVRISP √† part enti√®re</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lora et le sommeil</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus sur les bits de configuration ATmega328P et comment les utiliser avec un cristal de quartz externe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AVR Fusion Calculator</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pourquoi beaucoup de gens n'aiment pas Arduino</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grand test de batterie</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Batteries dans le froid</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470381/">https://habr.com/ru/post/fr470381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470365/index.html">Travailler avec USB HID personnalis√© sur Android</a></li>
<li><a href="../fr470367/index.html">Food Design Digest, septembre 2019</a></li>
<li><a href="../fr470373/index.html">PHP Digest n ¬∞ 165 (23 septembre - 7 octobre 2019)</a></li>
<li><a href="../fr470375/index.html">Lorsque des tests et des autotests sont n√©cessaires, un aper√ßu du super syst√®me</a></li>
<li><a href="../fr470379/index.html">Le probl√®me des trois montagnes, la th√©orie insaisissable de l'esprit et le probl√®me de la p√©riodisation du d√©veloppement de l'enfant</a></li>
<li><a href="../fr470385/index.html">Le ratio d'or en √©conomie - 2</a></li>
<li><a href="../fr470393/index.html">Lunettes Cleverness - Impressions de Pegasi Dream Glasses</a></li>
<li><a href="../fr470395/index.html">OWASP API Security Top 10 RC</a></li>
<li><a href="../fr470401/index.html">Portage d'applications WPF vers netcore 3.0</a></li>
<li><a href="../fr470407/index.html">Comment Yandex m'a appris √† interviewer des programmeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>