<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèæ ü§∏üèΩ üåΩ Gravure de donn√©es avec travajs üí™üèø üë∂üèº üå•Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans mon article pr√©c√©dent, j'ai d√©crit les principaux points lors du d√©veloppement d'une autre biblioth√®que opensource . J'ai oubli√© de mentionner en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gravure de donn√©es avec travajs</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462189/"><img src="https://habrastorage.org/webt/kb/fw/tm/kbfwtmm5xe1jxdaa1l2avw8geuo.jpeg"><br><br>  Dans mon article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©c√©dent,</a> j'ai d√©crit les principaux points lors du d√©veloppement d'une autre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que opensource</a> .  J'ai oubli√© de mentionner encore une chose: si vous ne parlez √† personne de la biblioth√®que, quelle qu'elle soit, personne ne le saura probablement. <br><br>  Alors, rencontrez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trava.js</a> - une validation juteuse au profit du projet.  Soit dit en passant, nous utilisons de l'herbe depuis plus de six mois, et j'ai pens√© qu'il √©tait temps de vous parler des avantages de l'utiliser.  D√©j√† m√™me s√©ch√©, alors retenez votre souffle.  Et allez-y. <br><a name="habracut"></a><br><h2>  Concept </h2><br>  √Ä premi√®re vue, il semble que la validation soit un sujet banal qui ne n√©cessite pas d'attention particuli√®re.  La valeur est vraie ou non, ce qui pourrait √™tre plus simple: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// any checking... if (!check(value)) return false; return true; }</span></span></code> </pre> <br>  Mais g√©n√©ralement, ce serait bien de savoir ce qui s'est exactement pass√©: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!check1(value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'ERROR_1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!check2(value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'ERROR_2'</span></span>; }</code> </pre><br>  En fait, c'est tout, le probl√®me est r√©solu. <br><br>  Sinon pour un ¬´mais¬ª. <br><br>  De l'exp√©rience du d√©veloppement d'applications r√©elles, il a √©t√© remarqu√© que l'affaire ne s'arr√™te pas √† la validation.  Habituellement, ces donn√©es doivent √©galement √™tre converties dans un format sp√©cifique, pour une raison non prise en charge par le s√©rialiseur d√®s la sortie de l'emballage, par exemple, des dates, des ensembles ou d'autres types de donn√©es personnalis√©s.  √âtant donn√© qu'il s'agit principalement de JSON, en pratique, il s'av√®re que vous devez effectuer un double passage dans la structure de donn√©es d'entr√©e lors de la validation et de la transformation.  L'id√©e est venue, pourquoi ne pas combiner ces deux √©tapes en une seule.  Un plus possible serait √©galement la pr√©sence d'un sch√©ma de donn√©es d√©claratif explicite. <br><br>  Pour prendre en charge la conversion d'une valeur dans un format sp√©cifique, le validateur doit pouvoir renvoyer non seulement une erreur, mais √©galement une valeur r√©duite.  Dans le monde js, plusieurs options d'interface sont assez courantes avec des retours d'erreur possibles. <br><br><ol><li>  Le plus courant est probablement le retour du tuple [error, data]: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!check1(value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'ERROR_1'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!check2(value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'ERROR_2'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">null</span></span>, value]; }</code> </pre> <br>  Il existe √©galement une option similaire dans laquelle aucun tableau n'est renvoy√©, mais l'objet <i>{error, data}</i> , mais il n'y a aucune diff√©rence fondamentale.  L'avantage de cette approche est l'√©vidence, l'inconv√©nient est que maintenant partout o√π vous devez maintenir ce contrat.  Pour la validation, cela ne cause aucun inconv√©nient, mais pour les transformations, cela est clairement superflu. <br></li><li>  Utilisez des exceptions.  Bien qu'√† mon avis une erreur de validation soit une situation standard dans l'application, rien n'est exceptionnel.  Honn√™tement, je pense que les exceptions ne sont mieux utilis√©es que lorsque quelque chose a vraiment mal tourn√©.  En outre, des exceptions peuvent √™tre appel√©es accidentellement dans les valideurs eux-m√™mes, et vous ne savez peut-√™tre pas du tout que c'√©tait une erreur dans le code, et non dans la valeur.  L'avantage de l'approche est la simplification de l'interface - maintenant, toujours la valeur est retourn√©e de la mani√®re habituelle, et l'erreur est lev√©e comme exception. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Il existe une option</a> pour mettre une erreur dans une variable globale.  Mais je ne tirerais pas l'√âtat inutilement. <br></li><li>  Utilisez un type distinct pour les erreurs.  Cela ressemble √† l'option avec des exceptions, si vous leur enlevez le type d'erreur, mais ne le jetez pas. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!check1(value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Trava.ValidationError({ <span class="hljs-attr"><span class="hljs-attr">code</span></span>: <span class="hljs-number"><span class="hljs-number">401</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!check2(value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Trava.ValidationError({ <span class="hljs-attr"><span class="hljs-attr">code</span></span>: <span class="hljs-number"><span class="hljs-number">405</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parseOrTransform(value); <span class="hljs-comment"><span class="hljs-comment">// apply some parse or transform }</span></span></code> </pre> <br></li></ol>  J'ai opt√© pour cette derni√®re option, bien que ce soit aussi un compromis, mais globalement pas mal.  <i>Trava.ValidationError est</i> propos√© comme type d'erreur, qui h√©rite de l' <i>erreur</i> standard et ajoute la possibilit√© d'utiliser un type de donn√©es arbitraire pour signaler une erreur.  Il n'est pas n√©cessaire d'utiliser <i>Trava.ValidationError</i> , vous pouvez utiliser l' <i>erreur</i> standard, mais n'oubliez pas que le message d'erreur n'est que des cha√Ænes. <br><br>  Pour r√©sumer, nous pouvons dire que le validateur est une fonction propre et synchrone qui, en plus de la valeur, peut renvoyer une erreur.  Extr√™mement simple.  Et cette th√©orie fonctionne bien sans biblioth√®ques.  Dans la pratique, les validateurs sont combin√©s en cha√Ænes et hi√©rarchies, et ici l'herbe sera certainement utile. <br><br><h2>  La composition </h2><br>  La composition est peut-√™tre le cas le plus courant de travailler avec des valideurs.  La mise en ≈ìuvre de la composition peut √™tre diff√©rente.  Par exemple, dans les c√©l√®bres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®ques</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">joi</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">v8n,</a> cela se fait √† travers un objet et une cha√Æne de m√©thodes: <br><br><pre> <code class="javascript hljs">Joi.string().alphanum().min(<span class="hljs-number"><span class="hljs-number">0</span></span>).max(<span class="hljs-number"><span class="hljs-number">255</span></span>)</code> </pre> <br>  Bien qu'elle soit belle √† premi√®re vue, cette approche pr√©sente plusieurs inconv√©nients, dont l'un est fatal.  Et voici la chose.  D'apr√®s mon exp√©rience, un validateur est toujours une chose pour une application sp√©cifique, donc l'accent principal dans la biblioth√®que devrait √™tre sur la commodit√© d'√©tendre les validateurs et l'int√©gration avec l'approche existante, et non sur le nombre de primitives de base, qui, √† mon avis, ne font qu'ajouter du poids √† la biblioth√®que, mais la plupart ne seront pas utilis√©s.  Prenons par exemple le m√™me validateur pour la cha√Æne.  Ensuite, il s'av√®re que vous devez couper les espaces √† partir des extr√©mit√©s, puis soudain, vous devez autoriser l'utilisation de caract√®res sp√©ciaux dans un seul cas, et quelque part, vous devez conduire √† des minuscules, etc.  En fait, il peut y avoir une infinit√© de telles primitives, et je ne vois tout simplement pas l'int√©r√™t de commencer √† les ajouter √† la biblioth√®que.  √Ä mon avis, l'utilisation d'objets est √©galement redondante et entra√Æne une augmentation de la complexit√© lors de l'expansion, m√™me si √† premi√®re vue elle semble faciliter la vie.  Par exemple, c <i>joi n'est</i> pas si facile <a href="">d'√©crire votre validateur</a> . <br><br>  Une approche fonctionnelle et de l'herbe ici peuvent aider.  Le m√™me exemple de validation d'un nombre sp√©cifi√© dans la plage de 0 √† 255: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    const isNumber = n =&gt; typeof n == 'number' &amp;&amp; !isNaN(n); //  const numberValidator = Trava.Check(isNumber); const byteValidator = Trava.Compose([ numberValidator, Trava.Check(n =&gt; 0 &lt;= n &amp;&amp; n &lt; 256), ]); byteValidator(-1); // !</span></span></code> </pre><br>  L'instruction <b>Check</b> fait un validateur de la v√©rification de la v√©rit√© (valeur =&gt; vrai / faux).  Et <b>Compose encha√Æne les</b> validateurs.  Une fois ex√©cut√©e, la cha√Æne est interrompue apr√®s la premi√®re erreur.  L'important est que les fonctions ordinaires soient utilis√©es partout, ce qui est tr√®s simple √† d√©velopper et √† utiliser.  C'est cette facilit√© d'expansion, √† mon avis, qui est une caract√©ristique cl√© d'une biblioth√®que de validation valide. <br><br>  Traditionnellement, une place distincte dans la validation est occup√©e par la v√©rification de la valeur <i>nulle</i> et <i>non d√©finie</i> .  Il y a des op√©rateurs auxiliaires dans l'herbe pour cela: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   null  undefined const requiredNumberValidator = Trava.Required(numberValidator); requiredNumberValidator(undefined); // ! const optNumberValidator = Trava.Optional(numberValidator, 2); // 2 is default optNumberValidator(undefined); // 2 optNumberValidator(null); // null const nullNumberValidator = Trava.Nullable(numberValidator, 3); // 3 is default nullNumberValidator(undefined); // 3 nullNumberValidator(null); // 3</span></span></code> </pre><br>  Il y a plusieurs autres op√©rateurs auxiliaires dans l'herbe, et ils composent tous magnifiquement et √©tonnamment simplement se d√©veloppent.  Comme les fonctions ordinaires :) <br><br><h2>  Hi√©rarchie </h2><br>  Les types de donn√©es simples sont organis√©s dans une hi√©rarchie.  Les cas les plus courants sont les objets et les tableaux.  Il y a des op√©rateurs dans l'herbe qui facilitent le travail avec eux: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   const byteArrayValidator = Trava.Each(byteValidator); byteArrayValidator([1, -1, 2, -3]); // ValidationError: {"1":"Incorrect value","3":"Incorrect value"} //   const pointValidator = Trava.Keys({ x: numberValidator, y: numberValidator, }); pointValidator({x: 1, y: 'a'}); // ValidationError: {"y":"Incorrect value"}</span></span></code> </pre><br>  Lors de la validation des objets, il a √©t√© d√©cid√© de souligner la s√©v√©rit√© de la d√©finition: toutes les cl√©s sont requises par d√©faut (encapsul√©es dans <b>Obligatoire</b> ).  Les cl√©s non sp√©cifi√©es dans le validateur sont supprim√©es. <br><br>  Certains <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jsonschema</a> , solutions de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quatuor</a> pr√©f√®rent d√©crire les validateurs sous forme de donn√©es, par exemple {x: 'nombre', y: 'nombre'}, mais cela conduit aux m√™mes difficult√©s lors de l'expansion.  Un avantage significatif de cette approche est la possibilit√© de s√©rialisation et d'√©change de circuits, ce qui est impossible avec des fonctions.  Cependant, cela peut √™tre facilement impl√©ment√© au-dessus de l'interface fonctionnelle.  Pas besoin de cacher les fonctions derri√®re les lignes!  Les fonctions ont d√©j√† des noms et c'est tout ce qui est n√©cessaire. <br><br>  Pour faciliter l'utilisation √† l'int√©rieur des valideurs, les op√©rateurs <b>Composer</b> et <b>Cl√©s</b> peuvent √™tre omis; il est √©galement pratique d'envelopper le validateur racine dans <b>Trava</b> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pointValidator = Trava({ <span class="hljs-comment"><span class="hljs-comment">//  -&gt; Keys x: [numberValidator, Trava.Check(v =&gt; v &gt; 180)], //  -&gt; Compose y: [numberValidator, Trava.Check(v =&gt; v &lt; 180)], });</span></span></code> </pre> <br>  Si vous appelez <b>Trava</b> avec le deuxi√®me argument, la valeur de retour sera le r√©sultat de l'application du validateur: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> point = Trava({ <span class="hljs-attr"><span class="hljs-attr">x</span></span>: [numberValidator, Trava.Check(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">180</span></span>)], <span class="hljs-attr"><span class="hljs-attr">y</span></span>: [numberValidator, Trava.Check(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> v &lt; <span class="hljs-number"><span class="hljs-number">180</span></span>)], }, <span class="hljs-comment"><span class="hljs-comment">//      { x: 200, y: 100, }); // { x: 200, y: 100 }</span></span></code> </pre> <br>  Jusqu'√† pr√©sent, la prise en charge a √©t√© impl√©ment√©e uniquement pour les tableaux et les objets, comme  empoisonner JSON et √ßa suffit.  Tirez les demandes de Wellcome! <br><br><h2>  Contexte </h2><br>  Lorsque vous utilisez le validateur comme dernier param√®tre, vous pouvez passer le contexte qui sera accessible √† partir de tous les validateurs appel√©s comme dernier param√®tre.  Personnellement, cette opportunit√© ne m'a pas encore √©t√© utile, mais elle est possible. <br><br>  Pour certains validateurs qui peuvent renvoyer une erreur, il est possible de d√©finir un message d'erreur √† diff√©rents niveaux.  Un exemple: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pos = Trava.Check(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); pos(<span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ValidationError: "Incorrect value" (by default)</span></span></code> </pre><br>  Remplacer pour un seul cas: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pos = Trava.Check(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"    "</span></span>); pos(<span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ValidationError: "    "</span></span></code> </pre><br>  Remplacer pour tous les cas: <br><br><pre> <code class="javascript hljs">Trava.Check.ErrorMessage = <span class="hljs-string"><span class="hljs-string">" "</span></span>; pos(<span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ValidationError: " "</span></span></code> </pre><br>  De plus, pour une configuration plus d√©taill√©e, vous pouvez transf√©rer une fonction √† l'endroit de l'erreur, qui devrait retourner une erreur et sera appel√©e avec les param√®tres du validateur. <br><br><h2>  Cas d'utilisation </h2><br>  La plupart du temps, nous empoisonnons JSON sur le backend avec koa.  Le frontend s'assoit √©galement lentement.  Il est pratique d'avoir des valideurs communs aux deux extr√©mit√©s.  Et maintenant, je vais montrer un cas d'utilisation presque r√©el.  Supposons que vous souhaitiez impl√©menter une API pour cr√©er et mettre √† jour les donn√©es des patients. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// validators.js const trava = require('trava'); const { isFilledString, isDate, isNumber } = require('../common/validators'); const patientSchema = { name: isFilledString, dateOfBirth: isDate, height: isNumber, } //        //      const patientNew = trava(patientSchema); //      const patientPatch = trava(mapValues(patientSchema, trava.Optional)); module.exports = { patientNew, patientPatch, }; // controllers.js const validate = require('./validators'); const { ValidationError } = require('../common/errors'); function create (ctx) { const patientData = validate.patientNew(ctx.request.body); //       Error,             Error if (patientData instanceof Error) return ValidationError(ctx, patientData); // ...create new patient } function update (ctx) { const patientData = validate.patientPatch(ctx.request.body); if (patientData instanceof Error) return ValidationError(ctx, patientData); // ...update patient data }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">common / errors.js</b> <div class="spoiler_text">  const trava = require ('trava'); <br><br>  fonction ValidationError (ctx, params) { <br>  if (params instanceof Error) { <br>  params = trava.ValidationError.extractData (params); <br>  } <br>  ctx.body = { <br>  code: 'VALIDATION_ERROR', <br>  params, <br>  }; <br>  ctx.status = HttpStatus.BAD_REQUEST; <br>  } <br></div></div><br>  Bien que l'exemple soit tr√®s simple, il ne peut pas √™tre qualifi√© de simplifi√©.  Dans une application r√©elle, seuls les valideurs seront compliqu√©s.  Vous pouvez √©galement effectuer la validation dans un middleware - le validateur est appliqu√© enti√®rement au contexte ou au corps de la requ√™te. <br><br>  Dans le processus de travail et d'utilisation de la validation, nous sommes arriv√©s √† la conclusion que de simples valideurs synchrones et de simples messages d'erreur suffisent.  En fait, nous sommes arriv√©s √† la conclusion que nous n'utilisons que deux messages: ¬´REQUIS¬ª et ¬´INVALIDE¬ª, qui sont localis√©s sur le frontend avec des invites pour les champs.  Les autres v√©rifications qui n√©cessitent des actions suppl√©mentaires (par exemple, lors de l'inscription pour v√©rifier qu'un tel courrier existe d√©j√†) n'entrent pas dans le cadre de la validation.  En tout cas, l'herbe ne concerne pas ce cas. <br><br><h2>  En conclusion </h2><br>  Dans ce court article, j'ai d√©crit presque toutes les fonctionnalit√©s de la biblioth√®que, en dehors de la port√©e de l'article, il existe plusieurs assistants simplifiant la vie.  Je demande des d√©tails sur github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/uNmAnNeR/travajs</a> . <br><br>  Nous avions besoin d'un outil aussi personnalisable que possible, dans lequel il n'y a rien de superflu, mais en m√™me temps il y a tout le n√©cessaire pour le travail quotidien.  Et je pense qu'en g√©n√©ral cela a √©t√© r√©alis√©, j'esp√®re que quelqu'un facilitera √©galement la vie.  Je serai heureux de souhaits et suggestions. <br>  Pour la sant√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462189/">https://habr.com/ru/post/fr462189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr462175/index.html">Nous traitons les abr√©viations et les expressions latines en anglais</a></li>
<li><a href="../fr462177/index.html">Visite photographique du mus√©e min√©ralogique du nom de Fersman</a></li>
<li><a href="../fr462179/index.html">Cha√Ænes F ou comment rendre le code un peu plus rapide et plus lisible</a></li>
<li><a href="../fr462181/index.html">R√®gles pour une communication efficace dans les chats de groupe</a></li>
<li><a href="../fr462185/index.html">La r√©volution est finie. Existe-t-il une alternative √† une batterie lithium-ion?</a></li>
<li><a href="../fr462191/index.html">Mus√©e DataArt: visite du nord de l'Italie</a></li>
<li><a href="../fr462197/index.html">Conseils pour lib√©rer votre esprit et augmenter votre cr√©ativit√©</a></li>
<li><a href="../fr462203/index.html">KVM (sous) VDI avec des machines virtuelles uniques utilisant bash</a></li>
<li><a href="../fr462205/index.html">Gagner PHDays 9 The Standoff: la chronique de l'√©quipe True0xA3</a></li>
<li><a href="../fr462209/index.html">Solutions de vid√©oconf√©rence Polycom. Des souvenirs 6 ans plus tard ... √âtape 2. Partie 1. RMX1500</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>