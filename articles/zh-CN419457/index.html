<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â€¼ï¸ ğŸ‘µğŸ¾ ğŸ¤ğŸ» RabbitMQ-SQL Server ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘©ğŸ» ğŸ‘’ ğŸ‘¨ğŸ¿â€ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸€ä¸¤ä¸ªæ˜ŸæœŸå‰ï¼Œæˆ‘åœ¨RabbitMQç”¨æˆ·è®ºå›ä¸Šçœ‹åˆ°ä¸€æ¡æ¶ˆæ¯ ï¼Œå†…å®¹æ¶‰åŠå¦‚ä½•è®¾ç½®ä»SQL Serverå‘RabbitMQå‘é€æ¶ˆæ¯ã€‚ ç”±äºæˆ‘ä»¬ä¸Derivcoç´§å¯†åˆä½œï¼Œ å› æ­¤æˆ‘åœ¨æ­¤ç•™ä¸‹äº†ä¸€äº›å»ºè®®ï¼Œå¹¶è¯´æˆ‘æ­£åœ¨æ’°å†™æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„åšå®¢ã€‚ æˆ‘çš„éƒ¨åˆ†ä¿¡æ¯å¹¶ä¸å®Œå…¨æ­£ç¡®-è‡³å°‘åˆ°é‚£æ—¶ä¸ºæ­¢ï¼ˆå¯¹ä¸èµ·ï¼Œå…„å¼Ÿï¼Œä»–å¾ˆå¿™ï¼‰ã€‚ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RabbitMQ-SQL Server</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419457/"> ä¸€ä¸¤ä¸ªæ˜ŸæœŸå‰ï¼Œæˆ‘åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RabbitMQç”¨æˆ·</a>è®ºå›ä¸Šçœ‹åˆ°ä¸€æ¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¶ˆæ¯</a> ï¼Œå†…å®¹æ¶‰åŠå¦‚ä½•è®¾ç½®ä»SQL Serverå‘RabbitMQå‘é€æ¶ˆæ¯ã€‚ ç”±äºæˆ‘ä»¬ä¸<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Derivco</a>ç´§å¯†åˆä½œï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å› æ­¤</a>æˆ‘åœ¨æ­¤ç•™ä¸‹äº†ä¸€äº›å»ºè®®ï¼Œå¹¶è¯´æˆ‘æ­£åœ¨æ’°å†™æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„åšå®¢ã€‚ æˆ‘çš„éƒ¨åˆ†ä¿¡æ¯å¹¶ä¸å®Œå…¨æ­£ç¡®-è‡³å°‘åˆ°é‚£æ—¶ä¸ºæ­¢ï¼ˆå¯¹ä¸èµ·ï¼Œå…„å¼Ÿï¼Œä»–å¾ˆå¿™ï¼‰ã€‚ <br><br> å¤ªæ£’äº†ï¼Œè¿™æ˜¯æ‚¨çš„<b>SQL Server</b> ã€‚ ä½¿ç”¨å®ƒå¾ˆå®¹æ˜“å°†ä¿¡æ¯æ”¾å…¥æ•°æ®åº“ä¸­ã€‚ ä½¿ç”¨æŸ¥è¯¢ä»æ•°æ®åº“æ£€ç´¢æ•°æ®åŒæ ·å®¹æ˜“ã€‚ ä½†æ˜¯è·å–åˆšåˆšæ›´æ–°æˆ–ç²˜è´´çš„æ•°æ®å·²ç»æœ‰ç‚¹å›°éš¾äº†ã€‚ è€ƒè™‘ä¸€ä¸‹å®æ—¶äº‹ä»¶ï¼› è¿›è¡Œäº†è´­ä¹°-å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå¿…é¡»ç«‹å³é€šçŸ¥æœ‰äººã€‚ ä¹Ÿè®¸æœ‰äººä¼šè¯´è¿™æ ·çš„æ•°æ®ä¸åº”è¯¥ä»æ•°æ®åº“ä¸­å¼¹å‡ºï¼Œè€Œåº”è¯¥ä»å…¶ä»–åœ°æ–¹å¼¹å‡ºã€‚ å½“ç„¶æ˜¯è¿™ç§æƒ…å†µï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ ¹æœ¬åˆ«æ— é€‰æ‹©ã€‚ <br><a name="habracut"></a><br> æˆ‘ä»¬æœ‰ä¸€ä¸ªä»»åŠ¡ï¼šä»æ•°æ®åº“å¤–éƒ¨å‘é€äº‹ä»¶ä»¥è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œé—®é¢˜æ˜¯-å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ <br><br><h3>  SQL Serverä¸å¤–éƒ¨é€šè®¯ </h3><br> åœ¨å­˜åœ¨SQL Serverçš„è¿‡ç¨‹ä¸­ï¼Œæ›¾è¿›è¡Œè¿‡å‡ æ¬¡å°è¯•æ¥ç»„ç»‡æ•°æ®åº“å¤–éƒ¨çš„é€šä¿¡ã€‚  <b>SQL Serveré€šçŸ¥æœåŠ¡</b> ï¼ˆNSï¼‰ï¼Œå‡ºç°åœ¨SQL Server 2000ä¸­ï¼Œä»¥åŠæ›´é«˜ç‰ˆæœ¬ï¼Œå‡ºç°åœ¨SQL Server 2005ä¸­ï¼Œå‡ºç°äº†<b>SQL Server Service Broker</b> ï¼ˆSSBï¼‰ã€‚ æˆ‘ä¸Bob Boshemenå’ŒDan Sullivanä¸€èµ·åœ¨æˆ‘çš„ã€Š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¢å‘å¼€å‘äººå‘˜çš„SQL Server 2005åˆçœ‹</a> ã€‹ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€</a>ä¹¦ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†æè¿°ã€‚ æ­£å¦‚æˆ‘æ‰€è¯´ï¼ŒNSå‡ºç°åœ¨SQL Server 2000ä¸­ï¼Œå¹¶åœ¨SQL Server 2005çš„Betaç‰ˆä¸­è¿›è¡Œäº†é‡æ–°è®¾è®¡ã€‚ä½†æ˜¯ï¼ŒNSå·²<s>å®Œå…¨</s>æ’é™¤åœ¨SQL Server 2005çš„ç°æˆï¼ˆRTMï¼‰ç‰ˆæœ¬ä¸­ã€‚ <br><blockquote>  <b>æ³¨æ„ï¼š</b>å¦‚æœæ‚¨é˜…è¯»æœ¬ä¹¦ï¼Œå°†ä¼šå‘ç°RTMç‰ˆæœ¬ä¸­æ²¡æœ‰çš„è®¸å¤šåŠŸèƒ½ã€‚ </blockquote>  SSBå¹¸å­˜ä¸‹æ¥ï¼ŒMicrosoftåœ¨å…¶SQL Server 2008 Feature Packä¸­å¼•å…¥äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Service Brokerå¤–éƒ¨æ¿€æ´»å™¨</a> ï¼ˆEAï¼‰ã€‚ é€šè¿‡SSBï¼Œå¯ä»¥åœ¨æœ¬åœ°æ•°æ®åº“ä¹‹å¤–è¿›è¡Œäº¤äº’ã€‚ ä»ç†è®ºä¸Šè®²ï¼Œè¿™å¬èµ·æ¥ä¸é”™ï¼Œä½†å®é™…ä¸Š-å®ƒæ—¢éº»çƒ¦åˆä»¤äººå›°æƒ‘ã€‚ æˆ‘ä»¬è¿›è¡Œäº†ä¸€äº›æµ‹è¯•ï¼Œå¾ˆå¿«æ„è¯†åˆ°å®ƒæ²¡æœ‰æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚ æ­¤å¤–ï¼ŒSSBå¹¶æ²¡æœ‰ä¸ºæˆ‘ä»¬æä¾›æ‰€éœ€çš„æ€§èƒ½ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¾—ä¸å‘æ˜å…¶ä»–ä¸œè¥¿ã€‚ <br><br><h3>  SQLCLR </h3><br> ç»“æœï¼Œæˆ‘ä»¬å¾—å‡ºçš„ç»“è®ºæ˜¯åŸºäºSQLCLRæŠ€æœ¯çš„ã€‚  SQLCLRæ˜¯å†…ç½®åœ¨SQL Serveræ ¸å¿ƒä¸­çš„.NETå¹³å°ï¼Œå¯ç”¨äºåœ¨å†…æ ¸å†…éƒ¨æ‰§è¡Œ.NETä»£ç ã€‚ ç”±äºæˆ‘ä»¬æ‰§è¡Œ.NETä»£ç ï¼Œå› æ­¤æˆ‘ä»¬èƒ½å¤Ÿåƒå¸¸è§„.NETåº”ç”¨ç¨‹åºä¸€æ ·æ‰§è¡Œå‡ ä¹æ‰€æœ‰æ“ä½œã€‚ <br><blockquote>  <b>æ³¨æ„ï¼š</b>æˆ‘åœ¨ä¸Šé¢å†™äº†â€œå‡ ä¹â€ï¼Œå› ä¸ºå®é™…ä¸Šæœ‰ä¸€äº›é™åˆ¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™äº›é™åˆ¶å‡ ä¹ä¸ä¼šå½±å“æˆ‘ä»¬è¦åšçš„äº‹æƒ…ã€‚ <br></blockquote>  SQLCLRçš„æ“ä½œåŸç†å¦‚ä¸‹ï¼šå°†ä»£ç ç¼–è¯‘åˆ°dllåº“ä¸­ï¼Œç„¶åä½¿ç”¨SQL Serverå·¥å…·æ³¨å†Œè¯¥åº“ï¼š <br><br> æ„å»ºè£…é… <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ASSEMBLY</span></span> [RabbitMQ.SqlServer] AUTHORIZATION rmq <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">'F:\some_path\RabbitMQSqlClr4.dll'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> PERMISSION_SET = <span class="hljs-keyword"><span class="hljs-keyword">UNSAFE</span></span>; GO</code> </pre> <br>  <b>ä»£ç æ®µ1ï¼š</b>æ²¿ç»å¯¹è·¯å¾„åˆ›å»ºç¨‹åºé›† <br><br> è¯¥ä»£ç æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ul><li>  <code>CREATE ASSEMBLY</code>åˆ›å»ºå…·æœ‰ç»™å®šåç§°çš„ç¨‹åºé›†ï¼ˆæ— è®ºå…¶åç§°å¦‚ä½•ï¼‰ã€‚ </li><li>  <code>AUTHORIZATION</code> -æŒ‡ç¤ºç¨‹åºé›†çš„æ‰€æœ‰è€…ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œrmqæ˜¯é¢„å®šä¹‰çš„SQL Serverè§’è‰²ã€‚ </li><li>  <code>FROM</code>ç¡®å®šåŸå§‹è£…é…ä½“çš„ä½ç½®ã€‚ åœ¨<code>FROM</code> ï¼Œæ‚¨è¿˜å¯ä»¥ä»¥äºŒè¿›åˆ¶æˆ–UNCæ ¼å¼æŒ‡å®šè·¯å¾„ã€‚ è¯¥é¡¹ç›®çš„å®‰è£…æ–‡ä»¶ä½¿ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼ã€‚ </li><li>  <code>WITH PERMISSION_SET</code>è®¾ç½®æƒé™ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>UNSAFE</code>è¦æ±‚æœ€ä¸¥æ ¼ã€‚ </li></ul><br><blockquote>  <b>æ³¨æ„ï¼š</b>æ— è®ºåœ¨<code>AUTHORIZATION</code>å­å¥ä¸­ä½¿ç”¨ä»€ä¹ˆè§’è‰²æˆ–ç™»å½•åï¼Œéƒ½å¿…é¡»ä½¿ç”¨ä¸å°†ç¨‹åºé›†åŠ è½½åˆ°åŸŸä¸­æ—¶ç›¸åŒçš„åç§°æ¥åˆ›å»ºappdomainç±»ã€‚ å»ºè®®ä½¿ç”¨ä¸åŒçš„appdomainç±»åç§°æ¥åˆ†éš”ç¨‹åºé›†ï¼Œä»¥ä¾¿åœ¨ä¸€ä¸ªç¨‹åºé›†å¤±è´¥æ—¶ï¼Œå…¶ä½™ç¨‹åºé›†ä¸ä¼šæ‰çº¿ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç¨‹åºé›†ç›¸äº’ä¾èµ–ï¼Œåˆ™ä¸èƒ½å°†å®ƒä»¬åˆ’åˆ†ä¸ºä¸åŒçš„ç±»ã€‚ <br></blockquote> åˆ›å»ºç¨‹åºé›†åï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å°è£….NETæ–¹æ³•ï¼š <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> rmq.pr_clr_PostRabbitMsg @EndpointID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, @Message <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> [RabbitMQ.SqlServer].[RabbitMQSqlClr.RabbitMQSqlServer].[pr_clr_PostRabbitMsg]; GO</code> </pre><br>  <b>ä»£ç æ®µ2ï¼š</b> .NETæ–¹æ³•åŒ…è£…å™¨ <br><br> è¯¥ä»£ç æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ul><li> åˆ›å»ºä¸€ä¸ªåä¸º<code>rmq.pr_clr_PostRabbitMsg</code>çš„T-SQLå­˜å‚¨è¿‡ç¨‹ï¼Œè¯¥å­˜å‚¨è¿‡ç¨‹å…·æœ‰ä¸¤ä¸ªå‚æ•°ã€‚  <code>@EndpointID</code>å’Œ<code>@Message</code> ã€‚ </li><li> ä»£æ›¿è¯¥è¿‡ç¨‹çš„ä¸»ä½“ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨æºï¼Œè¯¥å¤–éƒ¨æºåŒ…æ‹¬ï¼š <br><ul><li> ä¸€ä¸ªåä¸º<code>RabbitMQ.SqlServer</code>çš„ç¨‹åºé›†ï¼Œå³æˆ‘ä»¬åœ¨ä¸Šé¢çš„<b>ä»£ç ç‰‡æ®µ1ä¸­</b>åˆ›å»ºçš„é›†åˆã€‚ </li><li> å®Œæ•´ç±»å‹ï¼ˆå‘½åç©ºé—´å’Œç±»ï¼‰ï¼š <code>RabbitMQSqlClr.RabbitMQSqlServer</code> </li><li> ä¸Šé¢çš„åç§°ç©ºé—´å’Œç±»ä¸­çš„æ–¹æ³•æ˜¯ï¼š <code>pr_clr_PostRabbitMsg</code> ã€‚ </li></ul></li></ul><br>  <code>rmq.pr_clr_PostRabbitMsg</code> <code>pr_clr_PostRabbitMsg</code>å°†è°ƒç”¨<code>pr_clr_PostRabbitMsg</code>æ–¹æ³•ã€‚ <br><blockquote>  <b>æ³¨æ„ï¼š</b>åˆ›å»ºè¿‡ç¨‹æ—¶ï¼Œç¨‹åºé›†åç§°ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™ä¸ç±»å‹å’Œæ–¹æ³•çš„å…¨åä¸åŒã€‚ åˆ›å»ºçš„è¿‡ç¨‹çš„åç§°ä¸å¿…ä¸æ–¹æ³•çš„åç§°åŒ¹é…ã€‚ ä½†æ˜¯ï¼Œå‚æ•°çš„æœ€ç»ˆæ•°æ®ç±»å‹å¿…é¡»åŒ¹é…ã€‚ </blockquote> å°±åƒæˆ‘ä¹‹å‰è¯´çš„ï¼Œæˆ‘ä»¬åœ¨Derivcoéœ€è¦å°†æ•°æ®å‘é€åˆ°SQL Serverä¹‹å¤–ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨SQLCLRå’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RabbitMQ</a> ï¼ˆRMQï¼‰ã€‚ <br><br><h3>  Rabbitmq </h3><br>  RMQæ˜¯ä¸€ä¸ªå¼€æºæ¶ˆæ¯ä»£ç†ï¼Œå®ƒå®ç°é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAMQPï¼‰å¹¶ç”¨Erlangç¼–å†™ã€‚ <br><br> ç”±äºRMQæ˜¯æ¶ˆæ¯ä»£ç†ï¼Œå› æ­¤éœ€è¦AMQPå®¢æˆ·ç«¯åº“æ‰èƒ½è¿æ¥åˆ°å®ƒã€‚ è¯¥åº”ç”¨ç¨‹åºå¼•ç”¨å®¢æˆ·ç«¯åº“ï¼Œå¹¶åœ¨å…¶å¸®åŠ©ä¸‹æ‰“å¼€è¿æ¥å¹¶å‘é€æ¶ˆæ¯-ä¾‹å¦‚ï¼Œé€šè¿‡ADO.NETè°ƒç”¨SQL Serverã€‚ ä½†æ˜¯ä¸ADO.NETä¸åŒçš„æ˜¯ï¼Œæ¯æ¬¡è®¿é—®æ•°æ®åº“æ—¶ï¼Œè¯¥è¿æ¥å¾ˆå¯èƒ½ä¼šæ‰“å¼€ï¼Œè€Œåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºæœŸé—´ï¼Œè¯¥è¿æ¥ä»ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚ <br><br> å› æ­¤ï¼Œä¸ºäº†èƒ½å¤Ÿä¸RabbitMQä»æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬éœ€è¦RabbitMQçš„åº”ç”¨ç¨‹åºå’Œ.NETå®¢æˆ·ç«¯åº“ã€‚ <br><blockquote>  <b>æ³¨æ„ï¼š</b>åœ¨æœ¬æ–‡çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œå°†æ‰¾åˆ°RabbitMQä»£ç ç‰‡æ®µï¼Œä½†æ²¡æœ‰è¯¦ç»†è¯´æ˜å®ƒä»¬çš„ä½œç”¨ã€‚ å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰RabbitMQï¼Œé‚£ä¹ˆå»ºè®®æ‚¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é˜…è¯»</a>å„ç§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RabbitMQæ•™ç¨‹ï¼Œ</a>ä»¥äº†è§£ä»£ç çš„ç”¨é€”ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hello World</a> Cï¼ƒæ•™ç¨‹æ˜¯ä¸€ä¸ªå¥½çš„å¼€å§‹ã€‚ æ•™ç§‘ä¹¦å’Œä»£ç ç¤ºä¾‹ä¹‹é—´çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ç¤ºä¾‹ä¸­æœªå£°æ˜äº¤æ¢å™¨ã€‚ å®ƒä»¬åº”è¯¥æ˜¯é¢„å®šä¹‰çš„ã€‚ </blockquote><h3>  RabbitMQ.SqlServer </h3><br>  <b>RabbitMQ.SqlServer</b>æ˜¯ä½¿ç”¨.NETå®¢æˆ·ç«¯åº“ç”¨äºRabbitMQçš„ç¨‹åºé›†ï¼Œå¹¶æä¾›äº†å°†æ¶ˆæ¯ä»æ•°æ®åº“å‘é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªRabbitMQç«¯ç‚¹ï¼ˆVHostå’Œäº¤æ¢å™¨ï¼‰çš„åŠŸèƒ½ã€‚ å¯ä»¥ä»æˆ‘åœ¨GitHubä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RabbitMQ-SqlServer</a>å­˜å‚¨åº“ä¸‹è½½/åˆ†å‰ä»£ç ã€‚ å®ƒåŒ…å«ç¨‹åºé›†æºä»£ç å’Œå®‰è£…æ–‡ä»¶ï¼ˆå³ï¼Œæ‚¨ä¸å¿…è‡ªå·±ç¼–è¯‘å®ƒä»¬ï¼‰ã€‚ <br><blockquote>  <b>æ³¨æ„ï¼š</b>è¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ˜¾ç¤ºSQL Serverå¦‚ä½•ä¸RabbitMQè¿›è¡Œäº¤äº’ã€‚ è¿™ä¸æ˜¯æˆå“ï¼Œç”šè‡³ä¸æ˜¯ä¸€éƒ¨åˆ†ã€‚ å¦‚æœæ­¤ä»£ç ä½¿æ‚¨ä¸çŸ¥æ‰€æª-ä¸è¦æ€ªæˆ‘ï¼Œå› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚ <br></blockquote><h3> åŠŸèƒ½æ€§ </h3><br> å½“ç¨‹åºé›†è¢«åŠ è½½æ—¶ï¼Œæˆ–å…¶æ˜¾å¼è°ƒç”¨è¢«åˆå§‹åŒ–æ—¶ï¼Œæˆ–åœ¨åŒ…è£…ç¨‹åºè¢«è°ƒç”¨æ—¶è¢«é—´æ¥è°ƒç”¨æ—¶ï¼Œè¯¥ç¨‹åºé›†å°†è¿æ¥å­—ç¬¦ä¸²åŠ è½½åˆ°å…¶å®‰è£…æ‰€åœ¨çš„æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œä»¥åŠä¸å…¶è¿æ¥çš„RabbitMQç«¯ç‚¹ï¼š <br><br> è¿æ¥æ–¹å¼ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InternalConnect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { connFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConnectionFactory(); connFactory.Uri = connString; connFactory.AutomaticRecoveryEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; connFactory.TopologyRecoveryEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; RabbitConn = connFactory.CreateConnection(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; channels; x++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = RabbitConn.CreateModel(); rabbitChannels.Push(ch); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br>  <b>ä»£ç æ®µ3ï¼š</b>è¿æ¥åˆ°ç«¯ç‚¹ <br><br> åŒæ—¶ï¼Œåˆ°ç«¯ç‚¹çš„éƒ¨åˆ†è¿æ¥ä¹Ÿä¼šåœ¨è¯¥è¿æ¥ä¸Šåˆ›å»ºIModelï¼Œå¹¶åœ¨å‘é€ï¼ˆæ·»åŠ åˆ°é˜Ÿåˆ—ï¼‰æ¶ˆæ¯æ—¶ä½¿ç”¨å®ƒä»¬ï¼š <br><br> è®¯æ¯å‘é€ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> exchange, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] msg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> topic</span></span></span><span class="hljs-function">)</span></span> { IModel <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> channelTryCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((!rabbitChannels.TryPop(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) &amp;&amp; channelTryCount &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>) { channelTryCount += <span class="hljs-number"><span class="hljs-number">1</span></span>; Thread.Sleep(<span class="hljs-number"><span class="hljs-number">50</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (channelTryCount == <span class="hljs-number"><span class="hljs-number">100</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> errMsg = <span class="hljs-string"><span class="hljs-string">$"Channel pool blocked when trying to post message to Exchange: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{exchange}</span></span></span><span class="hljs-string">."</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationException(errMsg); } <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.BasicPublish(exchange, topic, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, msg); rabbitChannels.Push(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _rabbitChannels.Push(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; } }</code> </pre> <br>  <code>Post</code>æ–¹æ³•æ˜¯ä»<code>pr_clr_PostRabbitMsg(int endPointId, string msgToPost)</code>æ–¹æ³•<code>pr_clr_PostRabbitMsg(int endPointId, string msgToPost)</code>è°ƒç”¨çš„ï¼Œè¯¥æ–¹æ³•æ˜¯ä½¿ç”¨ä»£ç ç‰‡æ®µ2ä¸­çš„<code>CREATE PROCEDURE</code>å­å¥ä½œä¸ºè¿‡ç¨‹å‘ˆç°çš„ï¼š <br><br> é‚®å¯„æ–¹å¼ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pr_clr_PostRabbitMsg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endPointId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> msgToPost</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(endPointId == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationException(<span class="hljs-string"><span class="hljs-string">"EndpointId cannot be 0"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isInitialised) { pr_clr_InitialiseRabbitMq(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msg = Encoding.UTF8.GetBytes(msgToPost); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (endPointId == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rep <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> remoteEndpoints) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exch = rep.Value.Exchange; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> topic = rep.Value.RoutingKey; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pub <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rabbitPublishers.Values) { pub.Post(exch, msg, topic); } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { RabbitPublisher pub; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rabbitPublishers.TryGetValue(endPointId, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> pub)) { pub.Post(remoteEndpoints[endPointId].Exchange, msg, remoteEndpoints[endPointId].RoutingKey); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationException(<span class="hljs-string"><span class="hljs-string">$"EndpointId: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{endPointId}</span></span></span><span class="hljs-string">, does not exist"</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; } }</code> </pre> <br>  <b>ä»£ç æ®µ5ï¼š</b>å°†æ–¹æ³•è¡¨ç¤ºä¸ºè¿‡ç¨‹ <br><br> å½“æ‰§è¡Œè¯¥æ–¹æ³•æ—¶ï¼Œå‡å®šè°ƒç”¨æ–¹å‘é€äº†å¿…é¡»å°†æ¶ˆæ¯å‘é€åˆ°çš„ç«¯ç‚¹çš„æ ‡è¯†ç¬¦ï¼Œå®é™…ä¸Šæ˜¯æ¶ˆæ¯æœ¬èº«ã€‚ å¦‚æœå°†å€¼-1ä½œä¸ºç«¯ç‚¹çš„æ ‡è¯†ç¬¦ä¼ é€’ï¼Œåˆ™æˆ‘ä»¬éå†æ‰€æœ‰ç‚¹ï¼Œå¹¶å‘æ¯ä¸ªç‚¹å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚ æ¶ˆæ¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å‡ºç°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Encoding.UTF8.GetBytes</code>ä»ä¸­è·å–å­—èŠ‚ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”å°†<code>Encoding.UTF8.GetBytes</code>è°ƒç”¨æ›¿æ¢ä¸ºåºåˆ—åŒ–ã€‚ <br><br><h3> å®‰è£…æ–¹å¼ </h3><br> è¦å®‰è£…å’Œè¿è¡Œè¯¥ç¤ºä¾‹ï¼Œæ‚¨éœ€è¦<code>src\SQL</code>æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚ è¦å®‰è£…ï¼Œè¯·æŒ‰ç…§ä¸‹åˆ—æ­¥éª¤æ“ä½œï¼š <br><br><ul><li> è¿è¡Œè„šæœ¬<code>01.create_database_and_role.sql</code> ã€‚ ä»–å°†åˆ›å»ºï¼š <br><ul><li>  <code>RabbitMQTest</code>æµ‹è¯•æ•°æ®åº“ï¼Œå°†åœ¨å…¶ä¸­åˆ›å»ºç¨‹åºé›†ã€‚ </li><li>  <code>rmq</code>è§’è‰²è¢«åˆ†é…ä¸ºç¨‹åºé›†æ‰€æœ‰è€… </li><li> æ–¹æ¡ˆï¼Œä¹Ÿç§°ä¸º<code>rmq</code> ã€‚ åœ¨æ­¤å›¾ä¸­ï¼Œåˆ›å»ºäº†å„ç§æ•°æ®åº“å¯¹è±¡ã€‚ <br></li></ul><br></li><li> è¿è¡Œ<code>02.create_database_objects.sql</code>æ–‡ä»¶ã€‚ ä»–å°†åˆ›å»ºï¼š <br><br><ul><li>  <code>rmq.tb_RabbitSetting</code>è¡¨ï¼Œè¯¥è¡¨ä¼šå°†è¿æ¥å­—ç¬¦ä¸²å­˜å‚¨åˆ°æœ¬åœ°æ•°æ®åº“ã€‚ </li><li>  <code>rmq.tb_RabbitEndpoint</code>è¡¨ï¼Œå°†åœ¨å…¶ä¸­å­˜å‚¨ä¸€ä¸ªæˆ–å¤šä¸ª<code>RabbitMQ</code>ç«¯ç‚¹ã€‚ </li></ul><br></li><li> åœ¨<code>03.create_localhost_connstring.sql</code>æ–‡ä»¶ä¸­<code>03.create_localhost_connstring.sql</code>å°†<code>@connString</code>å˜é‡çš„å€¼æ›´æ”¹ä¸ºæ­¥éª¤1ä¸­åˆ›å»ºçš„<code>RabbitMQTest</code>æ•°æ®åº“çš„æ­£ç¡®è¿æ¥å­—ç¬¦ä¸²ï¼Œç„¶åè¿è¡Œè„šæœ¬ã€‚ <br></li></ul><br> åœ¨ç»§ç»­ä¹‹å‰ï¼Œæ‚¨å¿…é¡»å…·æœ‰RabbitMQä»£ç†å’ŒVHostçš„è¿è¡Œå®ä¾‹ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒVHostè¡¨ç¤ºä¸º/ï¼‰ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬æœ‰å‡ ä¸ªç”¨äºéš”ç¦»çš„VHostã€‚ è¯¥ä¸»æœºè¿˜éœ€è¦ä¸€ä¸ªäº¤æ¢å™¨ï¼Œåœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>amq.topic</code> ã€‚ å‡†å¤‡å¥½RabbitMQä»£ç†åï¼Œç¼–è¾‘<code>rmq.pr_UpsertRabbitEndpoint</code>è¿‡ç¨‹<code>rmq.pr_UpsertRabbitEndpoint</code> ï¼Œè¯¥<code>rmq.pr_UpsertRabbitEndpoint</code>ä½äº<code>04.upsert_rabbit_endpoint.sql</code>æ–‡ä»¶ä¸­ï¼š <br><br> ç«¯ç‚¹RabbitMQ <br><br><pre> <code class="cs hljs">EXEC rmq.pr_UpsertRabbitEndpoint @Alias = <span class="hljs-string"><span class="hljs-string">'rabbitEp1'</span></span>, @ServerName = <span class="hljs-string"><span class="hljs-string">'RabbitServer'</span></span>, @Port = <span class="hljs-number"><span class="hljs-number">5672</span></span>, @VHost = <span class="hljs-string"><span class="hljs-string">'testHost'</span></span>, @LoginName = <span class="hljs-string"><span class="hljs-string">'rabbitAdmin'</span></span>, @LoginPassword = <span class="hljs-string"><span class="hljs-string">'some_secret_password'</span></span>, @Exchange = <span class="hljs-string"><span class="hljs-string">'amq.topic'</span></span>, @RoutingKey = <span class="hljs-string"><span class="hljs-string">'#'</span></span>, @ConnectionChannels = <span class="hljs-number"><span class="hljs-number">5</span></span>, @IsEnabled = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  <b>ä»£ç æ®µ6ï¼š</b>åœ¨RabbitMQä¸­åˆ›å»ºç«¯ç‚¹ <br><br> æ­¤æ—¶ï¼Œè¯¥éƒ¨ç½²ç¨‹åºé›†äº†ã€‚ å¯¹äºSQL Server 2014ä¹‹å‰çš„ç‰ˆæœ¬ï¼ˆ2005ã€2008ã€2008R2ã€2012ï¼‰å’Œ2014åŠæ›´é«˜ç‰ˆæœ¬ï¼ŒSQL Serverçš„éƒ¨ç½²é€‰é¡¹æœ‰æ‰€ä¸åŒã€‚ åŒºåˆ«åœ¨äºå—æ”¯æŒçš„CLRç‰ˆæœ¬ã€‚ åœ¨SQL Server 2014ä¹‹å‰ï¼Œ.NETå¹³å°åœ¨CLRç‰ˆæœ¬2ä¸­è¿è¡Œï¼Œåœ¨SQL Server 2014åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨ç‰ˆæœ¬4ã€‚ <br><br><h3>  SQL Server 2005å¹´-2012å¹´ </h3><br> è®©æˆ‘ä»¬ä»è¿è¡Œåœ¨CLR 2ä¸Šçš„SQL Serverç‰ˆæœ¬å¼€å§‹ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰è‡ªå·±çš„ç‰¹å¾ã€‚ æˆ‘ä»¬éœ€è¦éƒ¨ç½²åˆ›å»ºçš„ç¨‹åºé›†ï¼ŒåŒæ—¶éƒ¨ç½²RabbitMQå®¢æˆ·ç«¯.NETåº“ï¼ˆ <code>RabbitMQ.Client</code> ï¼‰ã€‚ ä»æˆ‘ä»¬çš„ç¨‹åºé›†ä¸­ï¼Œæˆ‘ä»¬å°†å¼•ç”¨RabbitMQå®¢æˆ·ç«¯åº“ã€‚ å› ä¸º ç”±äºæˆ‘ä»¬è®¡åˆ’ä½¿ç”¨CLR 2ï¼Œå› æ­¤æˆ‘ä»¬çš„ç¨‹åºé›†å’Œ<code>RabbitMQ.Client</code>åº”è¯¥åŸºäº.NET 3.5è¿›è¡Œç¼–è¯‘ã€‚ æœ‰é—®é¢˜ã€‚ <br><br>  <code>RabbitMQ.Client</code>åº“çš„æ‰€æœ‰æœ€æ–°ç‰ˆæœ¬éƒ½æ˜¯ä¸ºCLR 4ç¯å¢ƒç¼–è¯‘çš„ï¼Œå› æ­¤ä¸èƒ½åœ¨æˆ‘ä»¬çš„ç¨‹åºé›†ä¸­ä½¿ç”¨ã€‚  .NET 3.4.3ä¸Šç¼–è¯‘äº†CLR 2å®¢æˆ·ç«¯åº“çš„æœ€æ–°ç‰ˆæœ¬ã€‚ ä½†æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬å°è¯•éƒ¨ç½²æ­¤ç¨‹åºé›†ï¼Œä¹Ÿä¼šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ï¼š <br><br><img src="https://habrastorage.org/webt/db/yo/uj/dbyouj4az0fzhnwpkvtdkgj6i-q.png"><br>  <i><b>å›¾1ï¼š</b>ç¼ºå°‘System.ServiceModelç¨‹åºé›†</i> <br><br> æ­¤ç‰ˆæœ¬çš„<code>RabbitMQ.Client</code>å¼•ç”¨çš„ç»„ä»¶ä¸å±äºSQL Server CLRã€‚ è¿™æ˜¯WCFç¨‹åºé›†ï¼Œè¿™æ˜¯æˆ‘ä¸Šé¢æåˆ°çš„SQLCLRçš„å±€é™æ€§ä¹‹ä¸€ï¼šæ­¤ç‰¹å®šç¨‹åºé›†ç”¨äºä¸å…è®¸åœ¨SQL Serverä¸­æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹ã€‚  <code>RabbitMQ.Client</code>æœ€æ–°ç‰ˆæœ¬ä¸å…·æœ‰è¿™äº›ä¾èµ–å…³ç³»ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œè€ŒCLR 4çš„çƒ¦äººè¦æ±‚é™¤å¤–ã€‚æˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ <br><br> å¦‚æ‚¨æ‰€çŸ¥ï¼ŒRabbitMQæ˜¯å¼€æºçš„ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯å¼€å‘äººå‘˜ï¼Œå¯¹å—ï¼Ÿ  ;ï¼‰è®©æˆ‘ä»¬é‡æ–°ç¼–è¯‘ï¼ åœ¨<code>RabbitMQ.Client</code>çš„æœ€æ–°å‘è¡Œç‰ˆï¼ˆå³ç‰ˆæœ¬&lt;3.5.0ï¼‰ä¹‹å‰çš„ç‰ˆæœ¬ä¸­<code>RabbitMQ.Client</code>æˆ‘åˆ é™¤äº†æŒ‡å‘<code>System.ServiceModel</code>çš„é“¾æ¥å¹¶é‡æ–°ç¼–è¯‘ã€‚ æˆ‘å¿…é¡»ä½¿ç”¨<code>System.ServiceModel</code>åŠŸèƒ½æ›´æ”¹å‡ è¡Œä»£ç ï¼Œä½†è¿™åªæ˜¯æ¬¡è¦æ›´æ”¹ã€‚ <br><br> åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨å®¢æˆ·ç«¯ç‰ˆæœ¬3.4.3ï¼Œè€Œæ˜¯ä½¿ç”¨äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¨³å®šçš„ç‰ˆæœ¬3.6.6ï¼Œ</a>å¹¶ä½¿ç”¨.NET 3.5ï¼ˆCLR 2ï¼‰é‡æ–°ç¼–è¯‘ã€‚ å®ƒå‡ ä¹å¯ä»¥æ­£å¸¸å·¥ä½œ:)ï¼Œåªæ˜¯<code>RabbitMQ.Client</code>æ›´é«˜ç‰ˆæœ¬ä½¿ç”¨<code>Task</code> 'å¹¶ä¸”æœ€åˆä¸æ˜¯.NET 3.5çš„ä¸€éƒ¨åˆ†ã€‚ <br><br> å¹¸è¿çš„æ˜¯ï¼Œ.NET 3.5æœ‰ä¸€ä¸ªåŒ…å«<code>Task</code>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>System.Threading.dll</code></a>ç‰ˆæœ¬ã€‚ æˆ‘ä¸‹è½½äº†å®ƒï¼Œè®¾ç½®äº†é“¾æ¥ï¼Œä¸€åˆ‡é¡ºåˆ©ï¼ è¿™é‡Œçš„ä¸»è¦æŠ€å·§æ˜¯åº”å°†<code>System.Threading.dll</code>ä¸ç¨‹åºé›†ä¸€èµ·å®‰è£…ã€‚ <br><blockquote>  <b>æ³¨æ„ï¼š</b> <code>RabbitMQ.Client</code> <b>çš„</b>æºä»£ç ï¼ˆæˆ‘ä»ä¸­ç¼–è¯‘äº†.NET 3.5çš„ç‰ˆæœ¬ï¼‰ä½äºGitHub <a href="">RabbitMQ Client 3.6.6 .NET 3.5</a>ä¸Šçš„å­˜å‚¨åº“ä¸­ã€‚  .NET 3.5çš„dlläºŒè¿›åˆ¶æ–‡ä»¶ä»¥åŠ<code>System.Threading.dll</code>ä¹Ÿä½äºå­˜å‚¨åº“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼ˆRabbitMQ-SqlServerï¼‰</a>çš„<code>lib\NET3.5</code> ã€‚ <br></blockquote> è¦å®‰è£…å¿…è¦çš„ç¨‹åºé›†ï¼ˆ <code>System.Threading</code> ï¼Œ <code>RabbitMQ.Client</code>å’Œ<code>RabbitMQ.SqlServer</code> ï¼‰ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºä»<code>src\sql</code>ç›®å½•è¿è¡Œå®‰è£…è„šæœ¬ï¼š <br><br><ol><li>  <code>05.51.System.Threading.sql2k5-12.sql</code> -System.Threading </li><li>  <code>05.52.RabbitMQ.Client.sql2k5-12.sql</code> -RabbitMQ.Client </li><li>  <code>05.53.RabbitMQ.SqlServer.sql2k5-12.sql</code> -RabbitMQ.SqlServer </li></ol><br><h3>  SQL Server 2014ä»¥ä¸Šç‰ˆæœ¬ </h3><br> åœ¨SQL Server 2014åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œç¨‹åºé›†åœ¨.NET 4.XXä¸‹ç¼–è¯‘ï¼ˆæˆ‘çš„ç¤ºä¾‹åœ¨4.5.2ä¸Šï¼‰ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥å¼•ç”¨<code>RabbitMQ.Client</code>ä»»ä½•æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NuGet</a>è·å¾—è¯¥ç‰ˆæœ¬ã€‚ åœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯4.1.1ã€‚  <code>RabbitMQ.Client</code> ï¼Œå®ƒä¹Ÿä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“ï¼ˆRabbitMQ-SqlServerï¼‰</a>çš„<code>lib\NET4</code> ã€‚ <br><br> è¦å®‰è£…ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºä»<code>src\sql</code>ç›®å½•è¿è¡Œè„šæœ¬ï¼š <br><br><ol><li>  <code>05.141.RabbitMQ.Client.sql2k14+.sql</code> -RabbitMQ.Client </li><li>  <code>05.142.RabbitMQ.SqlServer.sql2k14+.sql</code> -RabbitMQ.SqlServer </li></ol><br><h3>  SQLæ–¹æ³•åŒ…è£… </h3><br> è¦åˆ›å»ºå°†åœ¨æˆ‘ä»¬çš„ç¨‹åº<code>06.create_sqlclr_procedures.sql</code>ä½¿ç”¨çš„è¿‡ç¨‹ï¼ˆ3.5æˆ–4ï¼‰ï¼Œè¯·è¿è¡Œè„šæœ¬<code>06.create_sqlclr_procedures.sql</code> ã€‚ ä»–å°†ä¸ºä¸‰ç§.NETæ–¹æ³•åˆ›å»ºT-SQLè¿‡ç¨‹ï¼š <br><br><ul><li>  <code>rmq.pr_clr_InitialiseRabbitMq</code>è°ƒç”¨<code>pr_clr_InitialiseRabbitMq</code> ã€‚ ç”¨äºåŠ è½½å’Œåˆå§‹åŒ–RabbitMQ.SqlServerç¨‹åºé›†ã€‚ </li><li>  <code>rmq.pr_clr_ReloadRabbitEndpoints</code>è°ƒç”¨<code>pr_clr_ReloadRabbitEndpoints</code> ã€‚ åŠ è½½å„ç§RabbitMQç«¯ç‚¹ã€‚ </li><li>  <code>rmq.pr_clr_PostRabbitMsg</code>è°ƒç”¨<code>pr_clr_PostRabbitMsg</code> ã€‚ ç”¨äºå‘RabbitMQå‘é€æ¶ˆæ¯ã€‚ </li></ul><br> è¯¥è„šæœ¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„T-SQLè¿‡ç¨‹<code>rmq.pr_PostRabbitMsg</code> ï¼Œè¯¥è¿‡ç¨‹é€‚ç”¨äº<code>rmq.pr_clr_PostRabbitMsg</code> ã€‚ è¿™æ˜¯ä¸€ä¸ªåŒ…è£…ç¨‹åºï¼Œå®ƒçŸ¥é“å¦‚ä½•å¤„ç†æ•°æ®ï¼Œå¤„ç†å¼‚å¸¸ç­‰ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æœ‰å‡ ç§ç±»ä¼¼çš„è¿‡ç¨‹å¯å¤„ç†å„ç§ç±»å‹çš„æ¶ˆæ¯ã€‚ åœ¨ä¸‹é¢é˜…è¯»æœ‰å…³æ­¤å†…å®¹çš„æ›´å¤šä¿¡æ¯ã€‚ <br><br><h3> ä½¿ç”¨æ–¹æ³• </h3><br> ä»ä»¥ä¸Šæ‰€æœ‰å†…å®¹å¯ä»¥æ˜æ˜¾çœ‹å‡ºï¼Œè¦å°†æ¶ˆæ¯å‘é€åˆ°RabbitMQï¼Œæˆ‘ä»¬è°ƒç”¨<code>rmq.pr_PostRabbitMsg</code>æˆ–<code>rmq.pr_clr_PostRabbitMsg</code> ï¼Œå¹¶ä»¥<code>rmq.pr_clr_PostRabbitMsg</code>ä¼ é€’å‚æ•°ç«¯ç‚¹çš„æ ‡è¯†ç¬¦å’Œæ¶ˆæ¯æœ¬èº«ã€‚ å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›éƒ½å¾ˆé…·ï¼Œä½†æ˜¯æˆ‘æƒ³çœ‹çœ‹å®ƒå¦‚ä½•åœ¨ç°å®ä¸­å‘æŒ¥ä½œç”¨ã€‚ <br><br> åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­å¤„ç†åº”è¯¥å‘é€åˆ°RabbitMQçš„æ•°æ®ï¼Œæˆ‘ä»¬æ”¶é›†è¦å‘é€çš„æ•°æ®ï¼Œå¹¶åœ¨è¿æ¥å—ä¸­è°ƒç”¨<code>rmq.pr_PostRabbitMsg</code>ç±»çš„è¿‡ç¨‹ã€‚ ä»¥ä¸‹æ˜¯æ­¤è¿‡ç¨‹çš„éå¸¸ç®€åŒ–çš„ç¤ºä¾‹ï¼š <br><br> æ•°æ®å¤„ç†ç¨‹åº <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> dbo.pr_SomeProcessingStuff @<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> NOCOUNT <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY <span class="hljs-comment"><span class="hljs-comment">--     DECLARE @endPointId int; --    DECLARE @msg nvarchar(max) = '{' --        SET @msg = @msg + '"Id":' + CAST(@id AS varchar(10)) + ',' --  -  SET @msg = @msg + '"FName":"Hello",'; SET @msg = @msg + '"LName":"World"'; SET @msg = @msg + '}'; -- -  --     -,  -  SELECT @endPointId = 1; --    --     EXEC rmq.pr_PostRabbitMsg @Message = @msg, @EndpointID = @endPointId; END TRY BEGIN CATCH DECLARE @errMsg nvarchar(max); DECLARE @errLine int; SELECT @errMsg = ERROR_MESSAGE(), @errLine = ERROR_LINE(); RAISERROR('Error: %s at line: %d', 16, -1, @errMsg, @errLine); END CATCH END</span></span></code> </pre> <br> åœ¨<b>ä»£ç ç‰‡æ®µ7ä¸­ï¼Œ</b>æˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨è¿‡ç¨‹ä¸­æ•è·å’Œå¤„ç†å¿…è¦çš„æ•°æ®å¹¶åœ¨å¤„ç†åå‘é€å®ƒä»¬ã€‚ è¦ä½¿ç”¨æ­¤è¿‡ç¨‹ï¼Œè¯·ä»<code>src\SQL</code>ç›®å½•è¿è¡Œ<code>07.create_processing_procedure.sql</code>è„šæœ¬ã€‚ <br><br><h3> è®©æˆ‘ä»¬å…¨éƒ¨è¿è¡Œ </h3><br> æ­¤æ—¶ï¼Œæ‚¨åº”è¯¥å‡†å¤‡å‘é€ä¸€äº›æ¶ˆæ¯ã€‚ åœ¨æµ‹è¯•ä¹‹å‰ï¼Œè¯·ç¡®ä¿<code>rmq.tb_RabbitEndpoint</code>çš„ç«¯ç‚¹äº¤æ¢å™¨ä¸Šçš„RabbitMQä¸­æœ‰é˜Ÿåˆ—ã€‚ <br><br> å› æ­¤ï¼Œè¦å¼€å§‹ï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br> æ‰“å¼€<code>99.test_send_message.sql</code>æ–‡ä»¶ã€‚ <br> è·‘ <br><br><pre> <code class="sql hljs">EXEC rmq.pr_clr_InitialiseRabbitMq;</code> </pre> <br> åˆå§‹åŒ–ç¨‹åºé›†å¹¶åŠ è½½RabbitMQç«¯ç‚¹ã€‚ è¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å»ºè®®æ‚¨åœ¨åˆ›å»ºæˆ–ä¿®æ”¹è£…é…åé¢„åŠ è½½è£…é…ã€‚ <br><br> è·‘ <br><br><pre> <code class="sql hljs">EXEC dbo.pr_SomeProcessingStuff @id = 101</code> </pre> <br>  ï¼ˆæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–å–œæ¬¢çš„æ ‡è¯†ç¬¦ï¼‰ã€‚ <br><br> å¦‚æœä¸€åˆ‡æ­£å¸¸è€Œæ²¡æœ‰é”™è¯¯ï¼Œé‚£ä¹ˆRabbitMQé˜Ÿåˆ—ä¸­å°†å‡ºç°ä¸€æ¡æ¶ˆæ¯ï¼ å› æ­¤ï¼Œæ‚¨ä½¿ç”¨äº†SQLCLRå°†æ¶ˆæ¯å‘é€åˆ°RabbitMQã€‚ <br><br> æ­å–œä½ ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419457/">https://habr.com/ru/post/zh-CN419457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419441/index.html">SpaceXä»Šå¤©é¦–æ¬¡é‡æ–°ä½¿ç”¨Falcon 9 Block 5ç«ç®­</a></li>
<li><a href="../zh-CN419443/index.html">ç¾å›½å®‡èˆªå±€å°†å†æ¬¡é£å¾€æœˆçƒï¼Œä½¿é£æœºçš„æ‰€æœ‰å…ƒç´ </a></li>
<li><a href="../zh-CN419449/index.html">Reduxä¸React Context API</a></li>
<li><a href="../zh-CN419451/index.html">é€æ­¥ä¸ºSymfony 4åˆ›å»ºæ†ç»‘åŒ…</a></li>
<li><a href="../zh-CN419453/index.html">æ±‚è§£éçº¿æ€§æ–¹ç¨‹ç»„çš„æ•°å€¼æ–¹æ³•</a></li>
<li><a href="../zh-CN419459/index.html">é“…é…¸ç”µæ± ï¼šè„‰å†²å……ç”µå­—æ¯</a></li>
<li><a href="../zh-CN419461/index.html">æ´—æ‰‹é—´é€šé£</a></li>
<li><a href="../zh-CN419467/index.html">ä»ç¯æ³¡åˆ°å¸å°˜å™¨å’Œæ— äººé©¾é©¶é£æœº-æˆ‘ä»¬å¦‚ä½•æ•™çˆ±ä¸½ä¸ç®¡ç†æ•°ç™¾ç§è®¾å¤‡</a></li>
<li><a href="../zh-CN419469/index.html">UE4 | æ˜¼å¤œå‘¨æœŸ| ä¿®æ”¹SkySphere</a></li>
<li><a href="../zh-CN419471/index.html">ä»jQueryåˆ°çº¯JavaScriptçš„è¿ç§»é€‰é¡¹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>