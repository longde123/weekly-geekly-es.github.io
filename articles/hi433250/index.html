<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯШП ЁЯЪ┤ЁЯП┐ ЁЯУВ рдЙрдиреНрдирдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рд╕рд╛рде OpenVPN ЁЯНЖ ЁЯд╢ЁЯП╗ тЪ╛я╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд▓реЗрдЦ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде OpenVPN рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░рддрд╛ рд╣реИ: 



- рдкреНрд░рд╛рдердорд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдкреНрд░рдорд╛рдгрдкрддреНрд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рд░реБрддреЛрдХрди) 
- LDAP ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЙрдиреНрдирдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рд╕рд╛рде OpenVPN</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433250/">  рд▓реЗрдЦ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде OpenVPN рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░рддрд╛ рд╣реИ: <br><br><ul><li>  рдкреНрд░рд╛рдердорд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдкреНрд░рдорд╛рдгрдкрддреНрд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рд░реБрддреЛрдХрди) </li><li>  LDAP рдорд╛рдзреНрдпрдорд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдмреИрдХрдПрдВрдб (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ ActiveDirectory рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдЖрдВрддрд░рд┐рдХ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдирд╛ (iptables рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) </li></ul><br>  рдпрд╣ рд▓рд┐рдирдХреНрд╕, рд╡рд┐рдВрдбреЛрдЬ рдФрд░ рдореИрдХрдУрдПрд╕ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рднреА рдмрддрд╛рддрд╛ рд╣реИред <br><a name="habracut"></a><br><h3>  рд╕рд░реНрд╡рд░ рд╕реЗрдЯрдЕрдк </h3><br><h4>  OpenVPN рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h4><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Nyr / openvpn- рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ</a> , рд░реВрдЯ рд╕реЗ рдЪрд▓рд╛рдПрдВред <br><br><pre><code class="plaintext hljs">git clone https://github.com/Nyr/openvpn-install.git cd openvpn-install</code> </pre> <br>  рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреБрдЫ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдЧреАред <br><br><ul><li>  udp рдкреНрд░реЛрдЯреЛрдХреЙрд▓ </li><li>  рдкреЛрд░реНрдЯ 1194 </li><li>  DNS рд╕рд░реНрд╡рд░ - рд╕реНрдерд╛рдиреАрдп </li><li>  рдмрд╛рд╣рд░реА рдЖрдИрдкреА - рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдкреНрд░рд╡реЗрд╢ рджреНрд╡рд╛рд░ рдХрд╛ рдкрддрд╛ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реАрдкреАрдПрди рд╕рд░реНрд╡рд░ рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ </li></ul><br>  рдореВрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛-рд╡рд░реНрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рднреА рд╣реИ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">github.com/Angristan/OpenVPN-install</a> ред  рдЗрд╕рдХреА рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХреЗ рд╕рд╛рде рдЕрдзрд┐рдХ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╣реИрдВред <br><br><h4>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдмрдВрдзрди </h4><br>  <b>рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛</b> <br>  рдпрджрд┐ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдПрдХ рдХрд╕реНрдЯрдо ovpn рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╡рд╣рд╛рдВ рд░реВрдЯ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  рдпрджрд┐ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЯреЛрдХрди рдкрд░ рдЕрдиреБрднрд╛рдЧ рджреЗрдЦреЗрдВ), рддреЛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЯреЛрдХрди рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрдиреНрди рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдореМрдЬреВрджрд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдЙрд╕реА рд╕реЗ рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ)ред  рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдпрд╣рд╛рдВ <code>/etc/openvpn/client-common.txt</code> ред  рдпрд╣ рдУрдкреЗрдирд╡реЛрди рдкреИрдХреЗрдЬ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред <br><br>  <b>рдирд┐рд╖реНрдХрд╛рд╕рди</b> <br>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛ рдЙрд╕реА рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдкреНрд░рдорд╛рдгрдкрддреНрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CRL</a> рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдирдпрд╛ CRL vpn рд╕рд░реНрд╡рд░ рдкрд░ рдзрдХреЗрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рд░реНрд╡рд░ рдЙрди рд╕рднреА рдкреНрд░рдорд╛рдгрдкрддреНрд░реЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рддрд╛ рд╣реИ рдЬреЛ CRL рдореЗрдВ рдЕрдорд╛рдиреНрдп рд╣реИрдВ рдФрд░ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХреИрд╕реЗ рдирд┐рд░рд╕реНрдд рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">cd /etc/openvpn/easyrsa #   ./easyrsa revoke $CLIENT #   crl ./easyrsa gen-crl #   crl rm -rf /etc/openvpn/crl.pem #    cp /etc/openvpn/easy-rsa/pki/crl.pem /etc/openvpn/crl.pem # openvpn    crl,       nobody chown nobody:nobody /etc/openvpn/crl.pem</code> </pre><br><h4>  рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдореЗрдЬрдмрд╛рди рдЫрд╛рдирдирд╛ </h4><br>  рдореЗрдЬрдмрд╛рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рд╡реЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рд╡реЗ рдУрдкрдирд╡реИрдк рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрддреЗ рд╣реИрдВред <br><br>  <b>рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ</b> <br><br>  рдпрд╣ рд╡рд┐рдЪрд╛рд░ <code>tun0</code> рдЗрдВрдЯрд░рдлреЗрд╕ рдкрд░ рднреА рдкреИрдХреЗрдЯ рдХреЛ рдкрдХрдбрд╝рдиреЗ рдХрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╡реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рдЖрддреЗ рд╣реИрдВ рдФрд░ рдПрдирдПрдЯреА рдореЗрдВ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЙрдиреНрд╣реЗрдВ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рддреЗ рд╣реИрдВред  NAT рдХреЗ рдмрд╛рдж, рдЙрдиреНрд╣реЗрдВ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдХрд╛рд░рдг рдирд╣реАрдВ рд╣реЛрдЧрд╛ - рд╡реЗ рд╕рднреА рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдПрдХ Openvpn рд╕рд░реНрд╡рд░ рдЖрдИрдкреА рдкрддрд╛ рд╣реЛрдЧрд╛ред  NAT рдореЗрдВ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдкреИрдХреЗрдЯ рдХрд╛ рдЕрдкрдирд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрдИрдкреА-рдкрддрд╛ (IP- рдкрддреЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрддреНрд░рд╛рдЪрд╛рд░ рдХреЗ рд▓рд┐рдП, <code>/etc/openvpn/ipp.txt</code> рджреЗрдЦреЗрдВ) рд╣реЛрддрд╛ рд╣реИред <br><br>  рдкреИрдХреЗрдЯ рдЬреЛ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдЧреБрдЬрд░рддреЗ рд╣реИрдВ (рд╕реАрдзреЗ рд╕реЗ рдирд╣реАрдВ рдЖрддреЗ рд╣реИрдВ рдФрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдирд╣реАрдВ рд╣реИрдВ, рдпрд╛рдиреА, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рд░реВрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ) рдлреЙрд░рд╡рд░реНрдб рдЯреЗрдмрд▓ рджреНрд╡рд╛рд░рд╛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  Iptables рдореЗрдВ рдЯреЗрдмрд▓реНрд╕ рдХреЛ рдКрдкрд░ рд╕реЗ рдиреАрдЪреЗ рддрдХ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрджрд┐ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдХреЛрдИ рднреА рдирд┐рдпрдо рдкреИрдХреЗрдЯ рдХреЗ рднрд╛рдЧреНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд┐рд░реНрдгрдп рдирд╣реАрдВ рд▓реЗрддрд╛ рд╣реИ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдирд┐рдпрдо рд╢реБрд░реВ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдлреЙрд░рд╡рд░реНрдб рдЯреЗрдмрд▓ рддреИрдпрд╛рд░ рдХрд░рдирд╛: <br><br><pre> <code class="plaintext hljs">#   iptables -F FORWARD #     FORWARD -    iptables -P FORWARD DROP #     iptables -I FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT</code> </pre><br>  рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЧреНрд░рд╛рд╣рдХ рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХреЗ рдирд┐рдпрдоред  рдЪреВрдВрдХрд┐ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдирд┐рдпрдо DROP рд╣реИ, рдпрд╣ рдХреЗрд╡рд▓ рдЙрди рд╣реЛрд╕реНрдЯ + рдкреЛрд░реНрдЯ рдЬреЛрдбрд╝реЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд░рд╣рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣реЛрд╕реНрдЯ рдкрд░ рдкреЛрд░реНрдЯ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ + рд╣реЛрд╕реНрдЯ рдХреЛ рд╣реА рдкрд┐рдВрдЧ рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">iptables -I FORWARD -s 10.8.0.3 -i tun0 -d 10.0.2.3 -p tcp --dport 443 -j ACCEPT iptables -I FORWARD -s 10.8.0.3 -i tun0 -d 10.0.2.3 -p icmp --icmp-type echo-request -j ACCEPT</code> </pre><br>  рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдореЗрдЬрдмрд╛рди 10.8.0.3 рдХреЛ рдореЗрдЬрдмрд╛рди 10.0.2.3 рдХреЗ рдкреЛрд░реНрдЯ 443 рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред <br><br>  рдкрд╣реБрдБрдЪ рдХреИрд╕реЗ рдмрдВрдж рдХрд░реЗрдВ: <br><br><pre> <code class="plaintext hljs">#         iptables -L FORWARD --line-numbers #     iptables -D FORWARD { }</code> </pre><br>  рдлрд┐рд░ рдЖрдкрдХреЛ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдЧреНрд░рд╛рд╣рдХ рдХреЗ рд▓рд┐рдП рд╕рднреА рдирд┐рдпрдореЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рджреМрд░рд╛рди, рдпрд╣ рджреЗрдЦрдирд╛ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рдХреМрди рд╕реЗ рдирд┐рдпрдо рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдирд┐рдпрдо рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдкреИрдХреЗрдЯ рдХрд╛ рдПрдХ рдХрд╛рдЙрдВрдЯрд░ рд╣реЛрддрд╛ рд╣реИред <br><br><pre> <code class="plaintext hljs">#  ,      watch iptables -nvL FORWARD #     iptables -Z FORWARD</code> </pre><br>  <b>рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ</b> <br><br>  рдПрдХ Openvpn рд╕рд░реНрд╡рд░ рдореЗрдВ рдХреБрдЫ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЬрдм рдХрдиреЗрдХреНрдЯрд┐рдВрдЧ рдФрд░ рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯрд┐рдВрдЧ рдХреНрд▓рд╛рдЗрдВрдЯред  рд▓рд┐рдкрд┐рдпреЛрдВ рдХреЛ рдХрд┐рд╕реА рднреА рдЪреАрдЬ рдкрд░ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдХреЗрд╡рд▓ рд╡реЗ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рд╣реЛрдВред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдЕрдВрджрд░, рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдореМрдЬреВрджрд╛ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╣рдо рдЪрд░ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ: <br><br><ul><li>  <code>common_name</code> (рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕реНрд╡рд╛рдореА рдХрд╛ рдирд╛рдо; рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдмрдирд╛рддреЗ рд╕рдордп рд╕рд╛рдорд╛рдиреНрдп рдирд╛рдо рдлрд╝реАрд▓реНрдб рдореЗрдВ рдХреНрдпрд╛ рдбреНрд░рд╛рдЗрд╡ рдХрд░рддрд╛ рд╣реИ) </li><li>  <code>ifconfig_pool_remote_ip</code> (tun0 рдкрд░ рдЧреНрд░рд╛рд╣рдХ рдХрд╛ рдЖрдИрдкреА рдкрддрд╛) </li><li>  <code>script_type</code> (рдЬреЛ рдИрд╡реЗрдВрдЯ рд╣реБрдЖ - рдХрдиреЗрдХреНрдЯ рдпрд╛ рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ)ред </li></ul><br>  Iptables рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  Openvpn рдХрд┐рд╕реА рдХреЛ рднреА рд░реАрд╕реЗрдЯ рдЕрдзрд┐рдХрд╛рд░ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж рдФрд░ рдЗрд╕рд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рддрд╛ рд╣реИред  рд╕реВрдбреЛ рдХреЗ рддрд╣рдд рдХрд┐рд╕реА рдХреЛ рдХреБрдЫ рднреА рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдмреБрд░рд╛ рд╣реИ, рдФрд░ рдирд┐рдпрдореЛрдВ рдореЗрдВ рддрд╛рд░рд╛рдВрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИ, рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рддрд░рд╣ рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ iptables рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/sudoers.d/50_openvpn # #    nobody ALL = NOPASSWD: /sbin/iptables -A FORWARD* #     nobody ALL = NOPASSWD: /sbin/iptables -L FORWARD* #    nobody ALL = NOPASSWD: /sbin/iptables -D FORWARD*</span></span></code> </pre><br>  рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, рдЖрдкрдХреЛ рддреГрддреАрдп-рдкрдХреНрд╖ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдФрд░ рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рджреЛ рд╣реБрдХ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><pre> <code class="bash hljs">script-security 2 client-connect /etc/openvpn/bin/hosts.rb client-disconnect /etc/openvpn/bin/hosts.rb</code> </pre><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реА, рдЬреЛ рд╡рд┐рдиреНрдпрд╛рд╕ рдкрдврд╝рддрд╛ рд╣реИ рдФрд░ iptables рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрд╕реА рд╕рд┐рджреНрдзрд╛рдВрддреЛрдВ рдкрд░ рдХрд╛рдо рдХрд░рддреА рд╣реИ рдЬреЛ рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">/openvpn/bin/hosts.rb</b> <div class="spoiler_text"><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/ruby # -*- coding: utf-8 -*- require 'pp' def log(string) puts 'hosts.rb: ' + string end def parse_config_file(name) config_path = "hosts/#{name}" unless File.exist?(config_path) puts "There is no specific configuration for #{name}." p name exit 0 end config_source = IO.read(config_path).split("\n") config = config_source.inject([]) do |result,line| ip, port, protocol = line.split(/\s+/) result &lt;&lt; { ip: ip, port: port, protocol: protocol || 'tcp' } end end def get_config(name) user_config = parse_config_file(name) if user_config everybody_config = parse_config_file('everybody') end everybody_config + user_config end def apply_rule(rule) command = "sudo iptables #{rule}" log(command) system(command) end def remove_rule(number) command = "sudo iptables -D FORWARD #{number}" log(command) system(command) end def allow_target(source_ip, options) #         . apply_rule("-A FORWARD -s #{source_ip} -i tun0 -d #{options[:ip]} -p #{options[:protocol]} --dport #{options[:port]} -j ACCEPT") #       apply_rule("-A FORWARD -s #{source_ip} -i tun0 -d #{options[:ip]} -p icmp --icmp-type echo-request -j ACCEPT") end def clear_targets(source_ip) #      FORWARD,  source_ip. rules_exist = true while rules_exist table = `sudo iptables -L FORWARD --line-number`.split("\n") the_line = table.find do |line| fields = line.split(/\s+/) ip = fields[4] ip == source_ip end if the_line number = the_line.split(/\s+/)[0] remove_rule(number) else rules_exist = false end end end ################################################################################ script_type = ENV['script_type'] log(script_type) name = ENV['common_name'] source_ip = ENV['ifconfig_pool_remote_ip'] case script_type when 'client-connect' config = get_config(name) config.each{|target| allow_target(source_ip, target)} when 'client-disconnect' clear_targets(source_ip) else puts "Unknown script type #{script_type}." end</span></span></code> </pre></div></div><br>  рдирд┐рдпрдореЛрдВ рдХреЛ <code>/etc/openvpn/hosts</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдирд╛рдо рдХреЗ рдЕрдиреБрд░реВрдк рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╡реЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реЗ рдЖрдИрдкреА рдкрддреЗ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдЧреНрд░рд╛рд╣рдХ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реИрдВред  рд╡рд┐рднрд╛рдЬрдХ - рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдХреА рдПрдХ рдордирдорд╛рдиреА рд╕рдВрдЦреНрдпрд╛ред  рдЖрдИрдкреА тАЛтАЛрдПрдбреНрд░реЗрд╕, рдкреЛрд░реНрдЯ рдФрд░ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (tcp рдпрд╛ udp) рд╡рд┐рднрд╛рдЬрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд┐рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs">10.0.0.24 53 udp 10.0.0.25 53 udp 10.0.2.3 443 tcp</code> </pre><br>  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдирд┐рдореНрди рд╕рдВрд░рдЪрдирд╛ <code>/etc/openvpn</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ <code>/etc/openvpn</code> рджреЗрдиреА рдЪрд╛рд╣рд┐рдП <br><br>  тФЬтФАтФА рдмрд┐рди <br>  S. s. hosts.rb <br>  тФЬтФАтФА рдпрдЬрдорд╛рди <br>  1 1 user1 <br>  2 2 рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 2 <br>  тФФтФАтФА тФФтФАтФА рд╣рд░ рдХреЛрдИ <br>  F server.conf <br>  тФФтФАтФА ... <br><br>  рдЙрдкрд░реНрдпреБрдХреНрдд рдкреНрд░рд╛рд░реВрдк рдореЗрдВ <code>User1</code> рдФрд░ <code>User1</code> рдлрд╛рдЗрд▓реЗрдВ рд╣реИрдВред  рд╡реЗ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд╛рдорд╛рдиреНрдп рдирд╛рдо рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреМрди рд╣реЛрд╕реНрдЯ рдХрд░рддрд╛ рд╣реИред <br><br>  рдПрдХ рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд <code>everybody</code> рдлрд╝рд╛рдЗрд▓ рд╣реИ, рдЗрд╕рдореЗрдВ рд╕рднреА рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдирд┐рдпрдо рд╣реИрдВ, рдмрд╢рд░реНрддреЗ рдХрд┐ рдЗрди рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рд╣реЛред  рдпрд╣реА рд╣реИ, рдЕрдЧрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдореЗрдЬрдмрд╛рдиреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд╣реИ рдЬрд╣рд╛рдВ рд╡рд╣ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реВрдЪреА рдФрд░ рдЙрди <code>everybody</code> рдореЗрдВ рд╕реВрдЪреАрдмрджреНрдз рдореЗрдЬрдмрд╛рдиреЛрдВ <code>everybody</code> рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдирд╣реАрдВ, рддреЛ <code>everybody</code> рдХреЛрдИ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдбреАрдПрдирдПрд╕ рд╕рд░реНрд╡рд░ рд░рдЦрдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред <br><br>  <b>рд▓реЙрдЧрд┐рдВрдЧ</b> <br><br>  рд╕реНрдерд╛рдкрдирд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХреЗрд╡рд▓ рд╡рд░реНрддрдорд╛рди рдХрдиреЗрдХреНрд╢рди ( <code>status)</code> рдкреИрд░рд╛рдореАрдЯрд░ <code>status)</code> рдХрд╛ рд▓реЙрдЧрд┐рдВрдЧ рд╢рд╛рдорд┐рд▓ рд╣реИред  рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рдпрдорд┐рдд рд▓реЙрдЧ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди ( <code>/etc/openvpn/server.conf</code> ) рдкрд░ рдПрдХ рдкрдВрдХреНрддрд┐ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-append /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/openvpn.log</code> </pre> <br><br>  <b>рдПрд▓рдбреАрдПрдкреА</b> <br><br>  рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Openvpn-Cort-ldap</a> рдкреНрд▓рдЧрдЗрди рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ LDAP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрд┐рд░ рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br><br>  рд╡рд┐рддрд░рд┐рдд рдкреИрдХреЗрдЬ: <br><br><pre> <code class="plaintext hljs">sudo yum install openvpn-auth-ldap</code> </pre> <br>  Server.conf рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="plaintext hljs">plugin /usr/lib64/openvpn/plugin/lib/openvpn-auth-ldap.so "/etc/openvpn/ldap.conf"</code> </pre> <br>  <code>/etc/openvpn/ldap.conf</code> рдореЗрдВ ldap рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдиреНрдпрд╛рд╕ рдмрдирд╛рдПрдБ: <br><pre> <code class="plaintext hljs">&lt;LDAP&gt; URL ldaps://{LDAP_DOMAIN_HERE} Timeout 15 TLSEnable no FollowReferrals yes BindDN "BIND_DN_HERE" Password "BIND_PASSWORD_HERE" &lt;/LDAP&gt; &lt;Authorization&gt; BaseDN "{BASE_DN_HERE}" SearchFilter "(&amp;(sAMAccountName=%u)(objectClass=organizationalPerson)(objectCategory=person)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))" RequireGroup false &lt;/Authorization&gt;</code> </pre><br>  рдХрд╕реНрдЯрдо ovpn config рдореЗрдВ рд▓рд╛рдЗрди рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="plaintext hljs">auth-user-pass</code> </pre> <br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд╣рд▓реЗ рдбреЛрдореЗрди рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдкреВрдЫрд╛ рдЬрд╛рдПрдЧрд╛, рдлрд┐рд░ рдЯреЛрдХрди рд╕реЗ рдкрд┐рдиред  рдпрджрд┐ рдЗрдирдореЗрдВ рд╕реЗ рдПрдХ рдЪрд░рдг рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  Ldap.conf рдХреЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг <a href="">рдкреНрд▓рдЧрдЗрди рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рд╣реИ</a> ред  рдпрд╣ рд╕рдореВрд╣ рд╕рджрд╕реНрдпрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рдЗрд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред <br><br><h4>  рдЧрддрд┐ </h4><br>  рдЧрддрд┐ рдореЗрдВ рд╕рдмрд╕реЗ рдмрдбрд╝реА рд╡реГрджреНрдзрд┐ udp рдореЛрдб рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рджреЗрддреА рд╣реИред  рдпрд╣ рд╕рднреА рдореИрдиреБрдЕрд▓ рдореЗрдВ рд╕рд▓рд╛рд╣ рджреА рдЬрд╛рддреА рд╣реИред  рдореБрджреНрджрд╛ рдпрд╣ рд╣реИ рдХрд┐ tcp рдЪреИрдирд▓ рдореЗрдВ tcp рдХреНрд▓рд╛рдЗрдВрдЯ рдХрдиреЗрдХреНрд╢рди рд╢реБрд░реВ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИред  рдкреИрдХреЗрдЯ рдкрд░ рд╕рд╣реА рд╡рд┐рддрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ рдкрд░ рдПрдХ tcp рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред  рдпрджрд┐ рдкреИрдХреЗрдЯ udp рдЪреИрдирд▓ рдореЗрдВ рдЦреЛ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдХреНрд▓рд╛рдЗрдВрдЯ tcp рдХрдиреЗрдХреНрд╢рди рд╡рд┐рддрд░рдг рд╕рдорд╛рдпреЛрдЬрди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдЧрд╛ред <br><br>  рдЧрддрд┐ рдХрдо рд╕реЗ рдХрдо рдмрдврд╝ рдЬрд╛рдПрдЧреА рдХреНрдпреЛрдВрдХрд┐ рдЪреИрдирд▓ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдкреИрдХреЗрдЯ рдХреЗ рд╡рд┐рддрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  Tcp рдХреЗ рд╕рд╛рде рдПрдХ рджреВрд╕рд░реА рд╕рдорд╕реНрдпрд╛ рд╣реИ - рдПрдХ рдЧреНрд░рд╛рд╣рдХ tcp рдкреИрдХреЗрдЯ рдЬреЛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рд╡рд╣ vpn рдЪреИрдирд▓ рдХреЗ рдПрдХ рдкреИрдХреЗрдЯ рдореЗрдВ рдлрд┐рдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред  рдПрдордЯреАрдпреВ рдПрдХ рд╣реА рд╣реИ, рд▓реЗрдХрд┐рди рд╣реЗрдбрд░ рдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдкреИрдХреЗрдЬ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдЖрдкрдХреЛ рдкреНрд░рддрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреИрдХреЗрдЯ vpn рдЪреИрдирд▓ рдХреЗ рднреАрддрд░ рджреЛ рдкреИрдХреЗрдЯ рднреЗрдЬрдиреЗ рд╣реЛрдВрдЧреЗред <br><br>  рдЬрдм рдпрд╣ рджреВрд╕рд░реЗ рддрд░реАрдХреЗ рд╕реЗ рдЕрд╕рдВрднрд╡ рд╣реЛ рддреЛ рдЯреАрд╕реАрдкреА рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрдм vpn ssh рдЪреИрдирд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред <br><br><h4>  рдПрдХ рдкреВрд░реНрдг рд╕рд░реНрд╡рд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдЙрджрд╛рд╣рд░рдг </h4><br><div class="spoiler">  <b class="spoiler_title">рдЙрджрд╛рд╣рд░рдг-server.conf</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">port 1194 proto tcp dev tun sndbuf 0 rcvbuf 0 ca ca.crt cert server.crt key server.key dh dh.pem tls-auth ta.key 0 topology subnet server 10.8.0.0 255.255.255.0 ifconfig-pool-persist ipp.txt push "redirect-gateway def1 bypass-dhcp" push "dhcp-option DNS 10.0.0.25" push "dhcp-option DNS 10.0.0.24" keepalive 10 120 cipher AES-256-CBC comp-lzo user nobody group nobody persist-key persist-tun status openvpn-status.log verb 3 crl-verify crl.pem log-append /var/log/openvpn.log script-security 2 client-connect /etc/openvpn/bin/hosts.rb client-disconnect /etc/openvpn/bin/hosts.rb</code> </pre><br></div></div><br><h3>  рдЯреЛрдХрди рд╕реЗрдЯрдЕрдк </h3><br><h4>  PKCS # 11 рд▓рд╛рдЗрдмреНрд░реЗрд░реА </h4><br>  рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдореБрдЦреНрдп рдЬреЛрдбрд╝реЗ рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдВрдмрдВрдз рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд┐рдВрдХ рджреНрд╡рд╛рд░рд╛ рд╕рднреА рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдХреЗ рд▓рд┐рдП рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ</a> ред <br><br>  рдЬрд╣рд╛рдБ рднреА librtpkcs11ecp.so рдмрд╛рдж рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИ рдЬрд┐рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдХрд╣реАрдВ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЬрдЧрд╣ рдкрд░ рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><h4>  рдЯреЛрдХрди рдкрд░ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдмрдирд╛рдирд╛ </h4><br>  рдЯреЛрдХрди рдкрд░ рдПрдХ рдкреНрд░рдореБрдЦ рдЬреЛрдбрд╝реА рдмрдирд╛рдПрдВред  рдЖрдИрдбреА рдкреИрд░рд╛рдореАрдЯрд░ рдпрд╣рд╛рдВ рдЯреЛрдХрди рдХреЗ рд╕реНрд▓реЙрдЯ рдХреА рдХреНрд░рдо рд╕рдВрдЦреНрдпрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдХреБрдВрдЬреА рдЬреЛрдбрд╝реА рдлрд┐рдЯ рд╣реЛрддреА рд╣реИред <br><br><pre> <code class="plaintext hljs">pkcs11-tool --module /usr/lib64/librtpkcs11ecp.so --keypairgen --key-type rsa:2048 -l --id 01</code> </pre><br>  рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВред  рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЕрдиреБрд░реЛрдз рдмрдирд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рдЬреАрд╡рдирдХрд╛рд▓ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдирд╛рдо рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рднреАрддрд░ рдЙрдкрд▓рдмреНрдз рдЖрдИрдкреА-рдкрддреЗ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рд╛рдорд╛рдиреНрдп рдирд╛рдо ActiveDirectory рдореЗрдВ рд▓реЙрдЧрд┐рди рд╕реЗ рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдХреЛрдИ рднреНрд░рдо рди рд╣реЛред <br><br><pre> <code class="plaintext hljs">openssl openssl&gt; engine -t dynamic -pre SO_PATH:/usr/lib64/openssl/engines/pkcs11.so -pre ID:pkcs11 -pre LIST_ADD:1 -pre LOAD -pre MODULE_PATH:/usr/lib64/librtpkcs11ecp.so openssl&gt; req -engine pkcs11 -new -key slot_0-id_01 -keyform engine -out /home/john/good.req</code> </pre><br>  рдкреНрд░рд╛рдкреНрдд рдЕрдиреБрд░реЛрдз рдХреЛ <code>/etc/openvpn/easy-rsa/pki/reqs/</code> рд▓реЗ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдлрд╝рд╛рдЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ <code>req</code> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br>  рдХрд┐рд╕реА рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛: <br><br><pre> <code class="plaintext hljs">cd /etc/openvpn/easy-rsa/ ./easyrsa sign-req client good</code> </pre><br>  рдЙрд╕рдХреЗ рдмрд╛рдж, рдЙрд╕реА рдирд╛рдо рд╡рд╛рд▓рд╛ рдПрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд▓реЗрдХрд┐рди рдПрдХреНрд╕рдЯреЗрдВрд╢рди <code>crt</code> рд╕рд╛рде <code>/etc/openvpn/easy-rsa/pki/issued/</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред <br><br>  рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рд╕реЗ рдкрд╣рд▓реЗ, рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЛ рдбреАрдИрдЖрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: <br><br><pre> <code class="plaintext hljs">openssl x509 -in /home/user/user-cert.pem -out /home/user/user-cert.crt -outform DER</code> </pre><br>  рдЯреЛрдХрди рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рд▓рд┐рдЦрдирд╛: <br><br><pre> <code class="plaintext hljs">pkcs11-tool --module /usr/lib/librtpkcs11ecp.so -l -y cert -w /home/user/user-cert.crt --id 45 --label TEST</code> </pre> <br>  рдпрд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">"рдУрдкрдирдПрд╕рдПрд╕рдПрд▓ (рдЖрд░рдПрд╕рдП) рдХреЗ рд╕рд╛рде рд░реБрдЯреЛрдХрди рдИрдбреАрдПрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ"</a> рд▓реЗрдЦ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред <br><br><h4>  рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h4><br>  рд╕рд░реНрд╡рд░ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдЖрдИрдбреА рдЦреЛрдЬреЗрдВ: <br><br><pre> <code class="plaintext hljs">$ openvpn --show-pkcs11-ids /usr/lib64/librtpkcs11ecp.so The following objects are available for use. Each object shown below may be used as parameter to --pkcs11-id option please remember to use single quote mark. Certificate DN: /CN=User1 Serial: 490B82C4000000000075 Serialized id: aaaa/bbb/41545F5349474E415455524581D2A1A1B23C4AA4CB17FAF7A4600</code> </pre><br>  рд╣рдо рдпрд╣рд╛рдВ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреНрдб рдЖрдИрдбреА рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред <br><br>  рдРрд╕реЗ рд╡рд┐рдХрд▓реНрдк рдЬреЛ рдУрд╡рдкрд░реНрди рдХреЙрдиреНрдлрд┐рдЧрд░ рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдП рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЯреЛрдХрди рдЙрдард╛рдПрдВ: <br><br><pre> <code class="plaintext hljs">pkcs11-providers /usr/lib64/librtpkcs11ecp.so pkcs11-id 'aaaa/bbb/41545F5349474E415455524581D2A1A1B23C4AA4CB17FAF7A4600'</code> </pre> <br>  <code>pkcs11-id</code> рд╡рд┐рдХрд▓реНрдк <b>рдХреЛ рдПрдХрд▓ рдЙрджреНрдзрд░рдгреЛрдВ рдореЗрдВ рд╕рдВрд▓рдЧреНрди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред</b> <br><br>  рдпрд╣ рдореИрдиреБрдЕрд▓ рд╕рднреА рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдкрд░ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИред  рдЖрдкрдХреЛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд▓рд┐рдП рдкрде рдФрд░ рдЯреЛрдХрди рдкрд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЖрдИрдбреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЛ рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, <code>.dll</code> , not <code>.so</code> , рд▓реЗрдХрд┐рди рдЕрд░реНрде рд╕рдорд╛рди рд╣реИред <br><br>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ ovpn рдлрд╝рд╛рдЗрд▓ рд╕реЗ <code>cert</code> рдФрд░ <code>key</code> рдЕрдиреБрднрд╛рдЧ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдФрд░ рдирд┐рдЬреА рдХреБрдВрдЬреА рдЯреЛрдХрди рд╕реЗ рд▓реА рдЬрд╛рдПрдЧреАред <br><br>  рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЙрдиреНрдлрд┐рдЧ (рд╡рд┐рдВрдбреЛрдЬрд╝ рдХреЗ рд▓рд┐рдП) рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><div class="spoiler">  <b class="spoiler_title">client.ovpn</b> <div class="spoiler_text"> <code>client <br> dev tun <br> proto tcp <br> sndbuf 0 <br> rcvbuf 0 <br> remote 78.47.37.247 22222 <br> resolv-retry infinite <br> nobind <br> persist-key <br> persist-tun <br> remote-cert-tls server <br> cipher AES-256-CBC <br> comp-lzo <br> setenv opt block-outside-dns <br> key-direction 1 <br> verb 3 <br> <br> pkcs11-providers "c://Windows//System32//rtPKCS11ECP.dll" <br> pkcs11-id 'Aktiv\x20Co\x2E/Rutoken\x20ECP/342b871d/Rutoken/01' <br> <br> -----BEGIN CERTIFICATE----- <br> {CERT_HERE} <br> -----END CERTIFICATE----- <br> <br> <br> &lt;tls-auth&gt; <br> # <br> # 2048 bit OpenVPN static key <br> # <br> -----BEGIN OpenVPN Static key V1----- <br> {KEY_HERE} <br> -----END OpenVPN Static key V1----- <br> &lt;/tls-auth&gt;</code> <br> </div></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рд╕реНрдорд╛рд░реНрдЯ рдХрд╛рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ OpenVPN рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рджреЛрд╣рд░реЗ-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреИрд╕реЗ рдЬреЛрдбрд╝реЗрдВ, рдЗрд╕рдХреЗ</a> рдЖрдзрд╛рд░ рдкрд░ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред <br><br><h3>  рдЧреНрд░рд╛рд╣рдХ рд╕реЗрдЯрдЕрдк </h3><br><h4>  рд▓рд┐рдирдХреНрд╕ </h4><br>  Openvpn рдореЗрдВ рдПрдХ рдмрдЧ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд┐рди рдХреЛрдб рдореЗрдВ рдЯреЛрдХрди рд╕реЗ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ рдЕрдЧрд░ рдкреИрдХреЗрдЬ рдХреЛ рд╕рд┐рд╕реНрдЯрдордб рд╕рдкреЛрд░реНрдЯ рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЪреВрдВрдХрд┐ рд╕рд┐рд╕реНрдЯрдордб рд╣рд░ рдЬрдЧрд╣ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рд╣реБрдЖ рд╣реИ, рд╕рднреА рдкреИрдХреЗрдЬ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ, рдЗрд╕рдХреЗ рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рде рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред  рд▓рд┐рдирдХреНрд╕ рдкрд░ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рдЕрдкрдиреЗ рджрдо рдкрд░ рдкреИрдХреЗрдЬ рдПрдХрддреНрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реИ рдЬреЛ рдЖрд░реНрдХ рд▓рд┐рдирдХреНрд╕ рдкрд░ рдореЗрд░реЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">./configure \ --prefix=/usr \ --sbindir=/usr/bin \ --enable-iproute2 \ --enable-pkcs11 \ --enable-plugins \ --enable-x509-alt-username</code> </pre><br>  рдЖрдк рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдУрдкрдирд╡рдкрди рдХреЛ рдирд┐рдореНрди рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд┐рд╕реНрдЯрдордб рдХреЗ рд╕рд╛рде рдпрд╛ рдЙрд╕рдХреЗ рдмрд┐рдирд╛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">openvpn --version | grep --color enable_systemd</code> </pre><br><h4>  рдорд╛рд╕ рдУрд╕ </h4><br>  рдореИрдХ рдУрдПрд╕ рдХреЗ рддрд╣рдд, рдХреЗрд╡рд▓ рдПрдХ рдореБрдлреНрдд рдЧреНрд░рд╛рд╣рдХ рд╣реИ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯрдирд▓рдмреНрд▓рд┐рдВрдХ</a> ред <br><br>  рд╡рд╣ рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рдХрд┐ рдЧреБрдИ рд╕реЗ рдЯреЛрдХрди рд╕реЗ рдкрд┐рди рдХреЛрдб рдХреИрд╕реЗ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рдПред  рдмрдЧ рдХрд╛ рд╡рд░реНрдгрди рдпрд╣рд╛рдБ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://groups.google.com/forum/#</a> .topic <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">/</a> tunnelblick-discuss <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">/</a> f_Rp_2nV-x8 рдХрдВрд╕реЛрд▓ рд╕реЗ рдУрдкрдирд╡реИрдк рд▓реЙрдиреНрдЪ рдХрд░рдХреЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ред  рдпрд╣ рдЖрд╢реНрдЪрд░реНрдп рдХреА рдмрд╛рдд рдирд╣реАрдВ рд╣реИ, рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ рд╡рд┐рдВрдбреЛрдЬрд╝ рдХреЗ рд▓рд┐рдП рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдпрд╣ рднреА рдирд╣реАрдВ рдкрддрд╛ рд╣реИред <br><br>  рдореИрдХ рдУрдПрд╕ рдХреЗ рддрд╣рдд (рд╡рд┐рдВрдбреЛрдЬрд╝ рдХреЗ рд╡рд┐рдкрд░реАрдд) рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдпрджрд┐ рдЖрдк рдмрд╕ рдХрдВрд╕реЛрд▓ рд╕реЗ рдУрдкреЗрдирд╡реЛрди рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ DNS рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ (рд╢рд╛рдпрдж рдХреБрдЫ рдФрд░, рдХреЗрд╡рд▓ DNS рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛)ред <br><br>  рдЯрдирд▓рдмреНрд▓рд┐рдХ рдореЗрдВ рдЗрди рдиреЗрдЯрд╡рд░реНрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рдХрдиреЗрдХреНрд╢рди рдХреА рд╕реНрдерд╛рдкрдирд╛ рдФрд░ рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╕рдордп рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЖрдкрдХреЛ ovpn config рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="bash hljs">script-security 2 up <span class="hljs-string"><span class="hljs-string">"/Applications/Tunnelblick.app/Contents/Resources/client.up.tunnelblick.sh -9 -d -f -m -w -ptADGNWradsgnw"</span></span> down <span class="hljs-string"><span class="hljs-string">"/Applications/Tunnelblick.app/Contents/Resources/client.down.tunnelblick.sh -9 -d -f -m -w -ptADGNWradsgnw"</span></span></code> </pre> <br>  рдПрдХ рдУрдкрдирд╡реИрдк рдХрдиреЗрдХреНрд╢рди рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ, рдЬрд┐рд╕реЗ рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░ рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдорд╛рдЙрд╕ рдХреЗ рд╕рд╛рде рдкреЛрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">#!/bin/bash tunnelblick=/Applications/Tunnelblick.app/Contents/Resources/openvpn/openvpn-2.4.2-openssl-1.0.2k sudo $tunnelblick/openvpn --config $tunnelblick/user.ovpn</code> </pre><br><h4>  рд╡рд┐рдВрдбреЛрдЬ </h4><br>  рдЦрд┐рдбрд╝рдХрд┐рдпреЛрдВ рдХреЗ рдиреАрдЪреЗ, рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░рдиреЗ рд▓рдЧрддрд╛ рд╣реИред  рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЯреЛрдХрди рд╕реЗ рдкрд┐рди рдХреЛрдб рдХреИрд╕реЗ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдпрд╣ рдХрдВрд╕реЛрд▓ рд╕реЗ рд╣рд╛рде рд╕реЗ рдУрдкрдирд╡реИрдк рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИред <br><br>  рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рддрд╣рдд рд╕рдм рдХреБрдЫ рдХрд░рдирд╛ рд╣реИред  рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдЪрд▓рд╛рдПрдБред  рдПрдХ рдЯрд░реНрдорд┐рдирд▓ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ Openvpn рднреА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдпрд╣ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛ред <br><br>  рд╡рд┐рдВрдбреЛрдЬ рдХреЗ рддрд╣рдд, рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдорд╛рд░реНрдЧ рдбрдмрд▓ рд╕реНрд▓реИрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрд╣ ovpn config рдФрд░ <code>--show-pkcs11-ids</code> рджреЛрдиреЛрдВ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдкрд░ рд╡рд┐рдХрд▓реНрдк рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред <br><br><pre> <code class="bash hljs">pkcs11-providers <span class="hljs-string"><span class="hljs-string">"c://Windows//System32//rtPKCS11ECP.dll"</span></span> pkcs11-id <span class="hljs-string"><span class="hljs-string">'Aktiv\x20Co\x2E/Rutoken\x20ECP/342b871d/Rutoken/01'</span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi433250/">https://habr.com/ru/post/hi433250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi433234/index.html">рдПрдХ рдкрд░рд┐рдкреВрд░реНрдг рдирд╛рдиреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ; рд╕рдореНрдорд╛рди рдФрд░ рдЕрдЪреНрдЫреЗ рд╢рд┐рд╖реНрдЯрд╛рдЪрд╛рд░ рдХрд╛ рдЖрдХрд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдЖрдИ рд╕реНрдХреИрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ</a></li>
<li><a href="../hi433236/index.html">Google рдХреЗ рдкреНрд░рдореБрдЦ рдХрд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ AI рдХрд╛ рдбрд░ "рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдЪрд┐рдд" рд╣реИ</a></li>
<li><a href="../hi433242/index.html">рд╡рд┐рд╖рд╛рдХреНрдд рдореБрдЦреМрдЯрд╛</a></li>
<li><a href="../hi433246/index.html">рдлреНрд░реЗрдорд╡рд░реНрдХ: рдбреАрдПрд▓рдЯреА рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
<li><a href="../hi433248/index.html">OtterCTF рдХреЗ рд╕рд╛рде рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдореЗрдореЛрд░реА рдлреЛрд░реЗрдВрд╕рд┐рдХ рдФрд░ рдЕрд╕реНрдерд┐рд░рддрд╛ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХрд╛ рдкрд░рд┐рдЪрдп</a></li>
<li><a href="../hi433252/index.html">рдЯрд░реНрдмреЛрдЬреЗрдЯ-рдЗрд▓реЗрдХреНрдЯреНрд░рд┐рдХ рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХреЙрдкреНрдЯрд░ рдкрд░ рдкреБрддрд▓рд╛</a></li>
<li><a href="../hi433254/index.html">рд╣рдо рдХреЗрд╡рд▓ рдореМрдд рд╕реЗ рд▓рдбрд╝ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ рдЖрдк? рдпрд╛ рдХрдВрдкрдирд┐рдпрд╛рдВ рдЬреЛ рд╢рд╛рдирджрд╛рд░ рджрд╡рд╛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреА рд╣реИрдВ</a></li>
<li><a href="../hi433256/index.html">рд╕реНрдкрдВрджрди рдХреЗ рд╕рд╛рде рдпреВрдЖрдИ рд╡рд┐рдХрд╛рд╕</a></li>
<li><a href="../hi433258/index.html">рдЖрдк рдЫреБрдЯреНрдЯреА рдкрд░ рднреА рдпреВрд░реЛрдк рдореЗрдВ рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХ рдШрдЯрдХ рдЦрд░реАрдж рд╕рдХрддреЗ рд╣реИрдВред рдмреБрд▓реНрдЧрд╛рд░рд┐рдпрд╛ рдореЗрдВ рдореМрд╕рд░ рдореЗрдВ рдЦрд░реАрджрд╛рд░реА рдХрд╛ рдЕрдиреБрднрд╡</a></li>
<li><a href="../hi433260/index.html">рд╕рдкреНрддрд╛рд╣рд╛рдВрдд рдкрдврд╝рдиреЗ: рдкреАрдбреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рд╛рдордЧреНрд░реА, рдбреЗрдЯрд╛ рд╕реЗрдВрдЯрд░ рдореЗрдВ рд▓реЛрд╣реЗ рдХреА рд╕рдореАрдХреНрд╖рд╛рдПрдВ рдФрд░ рдЖрдИрдПрдПрдПрд╕ рдкреНрд░рджрд╛рддрд╛ рдХреА "рд░рд╕реЛрдИ"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>