<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂üèΩ üë¥üèø üêÉ 5 Cara Membuat Server Python di Raspberry Pi Bagian 2 üëÜüèª üöÅ üêµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai, Habr. 

 Hari ini kita akan terus mempelajari kemampuan jaringan Raspberry Pi, atau lebih tepatnya implementasinya dalam Python. Pada bagian pert...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>5 Cara Membuat Server Python di Raspberry Pi Bagian 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472464/">  Hai, Habr. <br><br>  Hari ini kita akan terus mempelajari kemampuan jaringan Raspberry Pi, atau lebih tepatnya implementasinya dalam Python.  Pada bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pertama,</a> kami memeriksa fungsi-fungsi dasar dari server web paling sederhana yang berjalan pada Raspberry Pi.  Sekarang kita akan melangkah lebih jauh, dan mempertimbangkan beberapa cara untuk membuat server kami interaktif. <br><br><img src="https://habrastorage.org/webt/el/mj/q2/elmjq2v_pe9vuinjagdxacuz2u0.png"><br><br>  Artikel ini dirancang untuk pemula. <a name="habracut"></a><br><br>  Sebelum Anda memulai beberapa catatan. <br><br>  Pertama-tama, saya sendiri ragu apakah akan melanjutkan dan mengharapkan aliran kritik yang lebih besar dan peringkat yang rendah, tetapi seperti yang ditunjukkan oleh survei di bagian pertama, 85% pembaca berpendapat bahwa informasi yang disediakan di sana bermanfaat.  Saya mengerti bahwa beberapa artikel pro untuk "boneka" itu menyebalkan, tetapi semuanya dimulai sekali, jadi Anda harus menunggu. <br><br>  Kedua, saya akan menulis tentang pemrograman, bukan tentang administrasi.  Jadi masalah konfigurasi Raspbian, konfigurasi, VPN, keamanan, dan hal-hal lain tidak akan dipertimbangkan di sini.  Meskipun ini juga penting, seseorang tidak dapat merangkul yang besar.  Ini hanya tentang Python, dan cara membuat server di atasnya. <br><br>  Mereka yang tidak tertarik dapat mengklik tombol kembali di browser sekarang dan tidak membuang waktu berharga mereka;) <br><br>  Dan kita akan mulai. <br><br>  Biarkan saya mengingatkan Anda bahwa pada bagian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sebelumnya</a> kami akhirnya meluncurkan server web sederhana pada Raspberry Pi, menampilkan halaman statis: <br><br><img src="https://habrastorage.org/webt/9y/ur/j9/9yurj9o1c452hvs930r3kdlpyng.png" alt="gambar"><br><br>  Sekarang kita akan melangkah lebih jauh dan membuat server kami interaktif, tambahkan kontrol LED ke halaman web.  Tentu saja, alih-alih LED, mungkin ada perangkat lain yang dapat dikendalikan oleh GPIO, tetapi dengan LED itu yang paling mudah untuk melakukan percobaan. <br><br><h2>  Persiapan </h2><br>  Saya tidak akan menjelaskan cara menghubungkan LED ke Raspberry Pi, siapa pun dapat menemukannya di Google dalam 5 menit.  Kami akan menulis beberapa fungsi untuk menggunakan GPIO sekaligus, yang kemudian kami masukkan ke server kami. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RPi.GPIO <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GPIO <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ModuleNotFoundError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> led_pin = <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raspberrypi_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.setmode(GPIO.BCM) GPIO.setup(led_pin, GPIO.OUT) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rasperrypi_pinout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: int, value: bool)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"LED ON"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">"LED OFF"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.output(pin, value) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rasperrypi_cleanup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.cleanup() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  Seperti yang Anda lihat, setiap fungsi panggilan GPIO "dibungkus" dalam blok coba-tangkap.  Mengapa ini dilakukan?  Ini memungkinkan Anda untuk men-debug server pada PC apa pun, termasuk Windows, yang cukup nyaman.  Sekarang kita bisa memasukkan fungsi-fungsi ini ke dalam kode server web. <br><br>  Tugas kami adalah menambahkan tombol ke halaman web yang memungkinkan kami untuk mengontrol LED dari browser.  3 cara implementasi akan dipertimbangkan. <br><br><h2>  Metode 1: Salah </h2><br>  Metode ini tidak bisa disebut cantik, tetapi metode ini pendek dan paling mudah dipahami. <br><br>  Buat garis dengan halaman HTML. <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;a href="/led/on"&gt;&lt;button class="button button_led"&gt;Led ON&lt;/button&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/led/off"&gt;&lt;button class="button button_led"&gt;Led OFF&lt;/button&gt;&lt;/a&gt;&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Ada 3 poin yang perlu diperhatikan di sini: <br><br><ul><li>  Kami menggunakan CSS untuk menentukan gaya tombol.  Anda tidak bisa melakukan ini dan bergaul dengan hanya 4 baris kode HTML, tetapi kemudian halaman kami akan terlihat seperti "salam dari tahun 90-an": <br><br><img src="https://habrastorage.org/webt/cc/fc/qu/ccfcquo-kundjijwwobgpqpea_c.png"></li><li>  Untuk setiap tombol, kami membuat tautan lokal seperti / led / on dan / led / off </li><li>  Mencampur sumber daya dan kode adalah gaya pemrograman yang buruk, dan idealnya, HTML sebaiknya dipisahkan dari kode Python.  Tetapi tujuan saya adalah untuk menunjukkan kode yang berfungsi minimal di mana ada minimum berlebihan, sehingga beberapa hal dihilangkan untuk kesederhanaan.  Selain itu, akan lebih mudah bila kode hanya dapat disalin dari sebuah artikel, tanpa kerepotan dengan file tambahan. </li></ul><br>  Kami sudah memeriksa server di bagian sebelumnya, masih menambahkan proses '/ led / on' dan '/ led / off' untuk itu.  Seluruh kode diperbarui: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> http.server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseHTTPRequestHandler, HTTPServer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseHTTPRequestHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, Path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>): rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>): rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">server_thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(port)</span></span></span><span class="hljs-function">:</span></span> server_address = (<span class="hljs-string"><span class="hljs-string">''</span></span>, port) httpd = HTTPServer(server_address, ServerHandler) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: httpd.serve_forever() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> httpd.server_close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: port = <span class="hljs-number"><span class="hljs-number">8000</span></span> print(<span class="hljs-string"><span class="hljs-string">"Starting server at port %d"</span></span> % port) raspberrypi_init() server_thread(port) rasperrypi_cleanup()</code> </pre><br>  Kami memulainya, dan jika semuanya dilakukan dengan benar, maka kami dapat mengontrol LED melalui server web kami: <br><br><img src="https://habrastorage.org/webt/np/f3/ip/npf3ipmqfd-movc084uxpgibhxa.png"><br><br>  Anda dapat menguji server tidak hanya pada Raspberry Pi, tetapi juga pada Windows atau OSX, di konsol akan ada pesan LED ON, LED OFF ketika Anda mengklik tombol yang sesuai: <br><br><img src="https://habrastorage.org/webt/bf/a1/hn/bfa1hne52ewrqpimi76d4bqyzxq.png"><br><br>  Sekarang kita mencari tahu mengapa metode ini buruk, dan mengapa itu "salah."  Contoh ini cukup berhasil, dan cukup sering disalin dalam berbagai tutorial.  Tetapi ada dua masalah - pertama, salah memuat ulang seluruh halaman saat kami hanya ingin menyalakan LED.  Tapi ini masih setengah dari masalah.  Masalah kedua, dan yang lebih serius, adalah ketika kita menekan tombol untuk menyalakan LED, alamat halaman menjadi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://192.168.1.106:8000/led/on</a> .  Peramban biasanya mengingat halaman yang terakhir dibuka, dan saat berikutnya Anda membuka peramban, perintah untuk menyalakan LED akan bekerja lagi, bahkan jika kami tidak mau.  Karena itu, kita akan beralih ke cara selanjutnya yang lebih benar. <br><br><h2>  Metode 2: Benar </h2><br>  Untuk melakukan semuanya dengan benar, kami mematikan dan mematikan fungsi LED dalam permintaan terpisah, dan kami akan memanggilnya secara asinkron menggunakan Javascript.  Kode HTML untuk halaman sekarang akan terlihat seperti ini: <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;script type="text/javascript" charset="utf-8"&gt; function httpGetAsync(method, callback) { var xmlHttp = new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200) callback(xmlHttp.responseText); } xmlHttp.open("GET", window.location.href + method, true); xmlHttp.send(null); } function ledOn() { console.log("Led ON..."); httpGetAsync("led/on", function(){ console.log("Done"); }); } function ledOff() { console.log("Led OFF..."); httpGetAsync("led/off", function(){ console.log("Done"); }); } &lt;/script&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOn();"&gt;Led ON&lt;/button&gt;&lt;/p&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOff();"&gt;Led OFF&lt;/button&gt;&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Seperti yang Anda lihat, kami meninggalkan href, dan kami memanggil fungsi ledOn dan ledOff, yang pada gilirannya memanggil metode server yang sesuai secara tidak sinkron (metode asinkron diperlukan agar halaman tidak memblokir sampai respons dari server tiba). <br><br>  Sekarang tinggal menambahkan pemrosesan permintaan get ke server: <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path))</code> </pre> <br>  Sekarang, seperti yang Anda lihat, halaman tidak lagi dimuat ketika Anda mencoba menyalakan LED, setiap metode hanya melakukan apa yang seharusnya dilakukan. <br><br><h2>  Metode 3: Lebih Benar </h2><br>  Semuanya sepertinya sudah bekerja.  Tetapi tentu saja, kode di atas dapat (dan harus) ditingkatkan.  Faktanya adalah bahwa kita menggunakan permintaan GET untuk mengontrol LED.  Ini menghemat ruang kita dalam kode, tetapi secara metodologi ini tidak sepenuhnya benar - permintaan GET dirancang untuk <i>membaca data</i> dari server, mereka dapat di-cache oleh browser, dan umumnya tidak boleh digunakan untuk <i>memodifikasi</i> data.  Cara yang benar adalah dengan menggunakan POST (bagi mereka yang tertarik dengan detail, lebih detail di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.w3schools.com/tags/ref_">sini</a> ). <br><br>  Kami akan mengubah panggilan dalam HTML dari posting, tetapi pada saat yang sama, karena kode ini tidak sinkron, kami akan menampilkan status respons server dan tampilan hasilnya.  Untuk jaringan lokal ini tidak akan terlihat, tetapi untuk koneksi yang lambat sangat nyaman.  Untuk membuatnya lebih menarik, kita akan menggunakan JSON untuk meneruskan parameter. <br><br>  Versi final terlihat seperti ini: <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;script type="text/javascript" charset="utf-8"&gt; function httpPostAsync(method, params, callback) { var xmlHttp = new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200) callback(xmlHttp.responseText); else callback(`Error ${xmlHttp.status}`) } xmlHttp.open("POST", window.location.href + method, true); xmlHttp.setRequestHeader("Content-Type", "application/json"); xmlHttp.send(params); } function ledOn() { document.getElementById("textstatus").textContent = "Making LED on..."; httpPostAsync("led", JSON.stringify({ "on": true }), function(resp) { document.getElementById("textstatus").textContent = `Led ON: ${resp}`; }); } function ledOff() { document.getElementById("textstatus").textContent = "Making LED off..."; httpPostAsync("led", JSON.stringify({ "on": false }), function(resp) { document.getElementById("textstatus").textContent = `Led OFF: ${resp}`; }); } &lt;/script&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOn();"&gt;Led ON&lt;/button&gt;&lt;/p&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOff();"&gt;Led OFF&lt;/button&gt;&lt;/p&gt; &lt;span id="textstatus"&gt;Status: Ready&lt;/span&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Tambahkan dukungan untuk permintaan GET dan POST ke server: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseHTTPRequestHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_POST</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> content_length = int(self.headers[<span class="hljs-string"><span class="hljs-string">'Content-Length'</span></span>]) body = self.rfile.read(content_length) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: print(<span class="hljs-string"><span class="hljs-string">"POST request, path:"</span></span>, self.path, <span class="hljs-string"><span class="hljs-string">"body:"</span></span>, body.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led"</span></span>: data_dict = json.loads(body.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'on'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data_dict: rasperrypi_pinout(led_pin, data_dict[<span class="hljs-string"><span class="hljs-string">'on'</span></span>]) self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-string"><span class="hljs-string">'Bad Request: Method does not exist'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) self.end_headers() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> err: print(<span class="hljs-string"><span class="hljs-string">"do_POST exception: %s"</span></span> % str(err))</code> </pre> <br>  Seperti yang Anda lihat, kami sekarang menggunakan satu fungsi yang dipimpin, di mana parameter "on" dilewatkan menggunakan json, yang menerima True atau False (ketika dipanggil dalam HTML, string json dari bentuk {"on": true} ditransmisikan, masing-masing).  Perlu juga diperhatikan untuk mencoba-menangkap - ini memblokir server agar tidak jatuh, misalnya, jika seseorang mengirim string dengan json yang tidak valid ke server. <br><br>  Jika semuanya dilakukan dengan benar, kami mendapatkan server dengan umpan balik, yang seharusnya terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/2b/tz/nv/2btznv4uxbfp8hhu4yxljcbfztc.png"><br><br>  Umpan balik, dalam kasus kami, pesan "OK", memungkinkan Anda untuk melihat konfirmasi dari server bahwa kode sebenarnya telah diproses. <br><br>  Bisakah server ini diperbaiki?  Anda dapat, misalnya, masuk akal untuk mengganti penggunaan fungsi cetak dengan menggunakan pencatatan, ini lebih tepat, dan memungkinkan Anda untuk menampilkan log server tidak hanya di layar, tetapi juga jika Anda ingin menulisnya ke file dengan rotasi otomatis.  Mereka yang berharap dapat melakukan ini sendiri. <br><br><h2>  Kesimpulan </h2><br>  Jika semuanya dilakukan dengan benar, kami akan mendapatkan mini-server yang memungkinkan Anda untuk mengontrol LED atau perangkat lain melalui browser dari perangkat jaringan apa pun. <br><br>  <b>Penting: Tindakan Pencegahan Keselamatan</b> <br><br>  Sekali lagi saya perhatikan bahwa tidak ada perlindungan atau otentikasi di sini, jadi Anda tidak boleh "memposting" halaman seperti itu di Internet jika Anda berencana untuk mengelola beberapa beban yang lebih atau kurang bertanggung jawab.  Meskipun kasus-kasus serangan pada server semacam itu tidak saya ketahui, masih ada gunanya memberikan siapa pun yang ingin bisa membuka pintu garasi dari jarak jauh atau menyalakan pemanas kilowatt.  Jika Anda ingin mengontrol dari jarak jauh melalui halaman seperti itu, ada baiknya menyiapkan VPN atau yang serupa. <br><br>  Sebagai kesimpulan, saya ulangi bahwa materi ini dirancang untuk pemula, dan saya harap ini lebih atau kurang bermanfaat.  Jelas bahwa tidak semua orang di Khabr puas dengan ketersediaan artikel "untuk boneka", jadi apakah bagian selanjutnya akan tergantung pada nilai akhir.  Jika ada, maka akan mempertimbangkan kerangka kerja Flask dan WSGI, serta metode otentikasi dasar. <br><br>  Semua percobaan berhasil. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id472464/">https://habr.com/ru/post/id472464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id472446/index.html">Cara membuat pewarnaan kode yang benar pada "Habr√©" dan mengapa itu sangat sulit</a></li>
<li><a href="../id472448/index.html">Tema bagian Frontend di DUMP Kazan: ML untuk pengembang front-end, pixel magic, SvelteJS, tawa, keringat dan air mata</a></li>
<li><a href="../id472452/index.html">Bagaimana cara menambahkan dukungan untuk masa tenggang (Billing Grace Period) di aplikasi iOS?</a></li>
<li><a href="../id472454/index.html">Tinjauan server VPS murah</a></li>
<li><a href="../id472462/index.html">iFest di Nizhny Novgorod: ITU sangat mengesankan</a></li>
<li><a href="../id472466/index.html">Urutkan berdasarkan distribusi</a></li>
<li><a href="../id472468/index.html">ClusterJ - bekerja dengan MySQL NDB Cluster dari Java</a></li>
<li><a href="../id472470/index.html">Tikus transgenik dan anti-penuaan</a></li>
<li><a href="../id472472/index.html">Pondok di musim dingin: menjadi atau tidak menjadi?</a></li>
<li><a href="../id472474/index.html">Bug kosmetik lucu di Google Chrome</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>